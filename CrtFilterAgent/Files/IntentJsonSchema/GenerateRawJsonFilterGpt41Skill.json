{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LlmFilterRequest",
  "type": "object",
  "additionalProperties": false,
  "description": "Request wrapper that includes the root schema name and the filter definition.",
  "properties": {
    "filter": {
      "$ref": "#/$defs/Filter"
    },
    "rootSchemaName": {
      "type": "string",
      "description": "The root entity/schema name the filter applies to."
    }
  },
  "required": ["filter", "rootSchemaName"],
  "$defs": {
    "Filter": {
      "type": "object",
      "additionalProperties": false,
      "description": "Group of filters, which can be combined by logical operation.\r\nFilter group can contain other filter groups.",
      "properties": {
        "backwardReferenceFilters": {
          "description": "if you need to filter by backward reference relation, use this property.",
          "items": {
            "$ref": "#/$defs/BackwardReferenceFilter"
          },
          "type": "array"
        },
        "filters": {
          "items": {
            "anyOf": [
              { "$ref": "#/$defs/BooleanComparisonFilter" },
              { "$ref": "#/$defs/MathComparisonFilter" },
              { "$ref": "#/$defs/StringComparisonFilter" },
              { "$ref": "#/$defs/DateComparisonFilter" },
              { "$ref": "#/$defs/RelativeDateComparisonFilter" },
              { "$ref": "#/$defs/LookupComparisonFilter" },
              { "$ref": "#/$defs/IsNullComparisonFilter" },
              { "$ref": "#/$defs/IsNotNullComparisonFilter" },
              { "$ref": "#/$defs/Filter" }
            ]
          },
          "type": "array"
        },
        "logicalOperation": {
          "description": "Logical operation to combine filters in the group. Default is \"AND\"",
          "enum": ["AND", "OR"],
          "type": "string"
        }
      },
      "required": ["filters", "backwardReferenceFilters", "logicalOperation"]
    },

    "BackwardReferenceAggregationType": {
      "description": "Defines how records in backward reference relation should be aggregated.",
      "enum": ["COUNT", "SUM", "MIN", "MAX", "AVG", "EXISTS", "NOT_EXISTS"],
      "type": "string"
    },
    "BackwardReferenceComparisonType": {
      "description": "Defines how records in backward reference relation should be compared.\r\nIf user asks to filter by column with date-related values, or mentions some numeric value you cannot use NULL.\r\nuse EQUAL if aggregationType is EXISTS or NOT_EXISTS.",
      "enum": ["EQUAL", "NOT_EQUAL", "LESS", "LESS_OR_EQUAL", "GREATER", "GREATER_OR_EQUAL"],
      "type": "string"
    },
    "BackwardReferenceFilter": {
      "additionalProperties": false,
      "description": "Filter for filtering entities by backward reference.\r\nUse it when you need to filter entities with backward reference relation",
      "properties": {
        "aggregationType": {
          "$ref": "#/$defs/BackwardReferenceAggregationType"
        },
        "aggregationValue": {
          "description": "value to compare with the result of aggregation.\r\nAlways provide a value, when use any aggregation type except EXISTS and NOT_EXISTS.\r\nExamples: 1. show count of accounts which has cases - value will be null,\r\nbecause user does not specify any value to compare with and asked\r\nonly to count rows which satisfy the condition exists.\r\nExample 2: Show count of accounts which have more than 10 cases - value will be 10.\r\nExample 3: Show count of accounts which have first created case in 2023 - value will be \"2023-01-01T00:00:00Z\"",
          "type": "string"
        },
        "columnPath": {
          "description": "path to the column in the backward reference relation.\r\nIt has specific format: \"[BackwardReferenceEntityName:ColumnInBackwardReferenceEntityToLink].ColumnInMainEntityToLink\".\r\nExample: user prompt - \"show me count of contacts which are owners of activity\". In this example,\r\nthe columnPath will be \"[Activity:Owner].Id\".\r\nExplanation: In this example, contact is main entity,\r\nbecause we create a widget to show count of contacts.\r\nActivity is backward reference entity, which has a lookup column Owner to Contact entity.\r\n\r\nOther example: \"show count of marketing campaigns for brand Neckew\". In this example,\r\nthere is a backward reference relation from Brand to CampaignPlanner.\r\nthe columnPath will be [CampaignPlanner:Brand].Id",
          "type": "string"
        },
        "comparisonType": {
          "$ref": "#/$defs/BackwardReferenceComparisonType"
        },
        "subFilters": {
          "$ref": "#/$defs/Filter"
        }
      },
      "required": [
        "columnPath",
        "comparisonType",
        "aggregationType",
        "aggregationValue",
        "subFilters"
      ],
      "type": "object"
    },
    "BooleanComparisonFilter": {
      "additionalProperties": false,
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "const": "EQUAL",
          "type": "string"
        },
        "value": {
          "description": "Boolean value to compare with. For example, true or false",
          "type": "boolean"
        }
      },
      "required": ["columnPath", "comparisonType", "value"],
      "type": "object"
    },
    "DateComparisonFilter": {
      "additionalProperties": false,
      "description": "Filter for comparing columns with date.\r\nUse it when you need to compare with absolute date. Do not use it for relative dates",
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "$ref": "#/$defs/DateComparisonType"
        },
        "value": {
          "description": "Date in ISO format, for example \"2023-10-01T00:00:00Z\"",
          "type": "string"
        }
      },
      "required": ["columnPath", "comparisonType", "value"],
      "type": "object"
    },
    "DateComparisonType": {
      "enum": ["EQUAL", "NOT_EQUAL", "LESS", "LESS_OR_EQUAL", "GREATER", "GREATER_OR_EQUAL"],
      "type": "string"
    },
    "IsNotNullComparisonFilter": {
      "additionalProperties": false,
      "description": "Filter for comparing columns with not null values.\r\nUse it when you need to check if a column is not null.",
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "const": "IS_NOT_NULL",
          "type": "string"
        }
      },
      "required": ["columnPath", "comparisonType"],
      "type": "object"
    },
    "IsNullComparisonFilter": {
      "additionalProperties": false,
      "description": "Filter for comparing columns with null values.\r\nUse it when you need to check if a column is null.",
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "const": "IS_NULL",
          "type": "string"
        }
      },
      "required": ["columnPath", "comparisonType"],
      "type": "object"
    },
    "LookupComparisonFilter": {
      "additionalProperties": false,
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "$ref": "#/$defs/LookupComparisonType"
        },
        "value": {
          "anyOf": [
            { "type": "string" },
            {
              "items": { "type": "string" },
              "type": "array"
            }
          ],
          "description": "Id of the lookup value to compare with or array of ids.\r\nExamples:\r\n- \"59970ea3-1ee6-4b13-af5a-26908a5e3de4\"\r\n- [\"59970ea3-1ee6-4b13-af5a-26908a5e3de4\", \"69111d53-5d21-4133-913f-2d499c642d79\"]"
        }
      },
      "required": ["columnPath", "comparisonType", "value"],
      "type": "object"
    },
    "LookupComparisonType": {
      "description": "Allows to compare column with lookup values (single or multiple).\r\nExample of comparing column with multiple lookup values:\r\n1. In case \"from USA or UK\"\r\nfilter should be `{\r\n\"columnPath\": \"CountryId\",\r\n\"comparisonType\": \"EQUAL\" ,\r\n\"value\": [\"f7bf32c8-f36b-1410-fc98-00155d043204\", \"69111d53-5d21-4133-913f-2d499c642d79\"]\r\n}`",
      "enum": ["EQUAL", "NOT_EQUAL", "EXISTS", "NOT_EXISTS"],
      "type": "string"
    },
    "MathComparisonFilter": {
      "additionalProperties": false,
      "description": "Filter for comparing columns with numbers. Use it when you need to compare numbers.",
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "$ref": "#/$defs/MathComparisonType"
        },
        "value": {
          "description": "Number value to compare with. For example, 125",
          "type": "number"
        }
      },
      "required": ["columnPath", "comparisonType", "value"],
      "type": "object"
    },
    "MathComparisonType": {
      "enum": ["EQUAL", "NOT_EQUAL", "LESS", "LESS_OR_EQUAL", "GREATER", "GREATER_OR_EQUAL"],
      "type": "string"
    },
    "RelativeDateComparisonFilter": {
      "additionalProperties": false,
      "description": "Filter for comparing columns with date.\r\nUse it when you need to compare with relative date. Do not use it for absolute dates.",
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "$ref": "#/$defs/RelativeDateComparisonType"
        },
        "value": {
          "description": "function-calling string, which is composed of relative date parts.\r\nPart 1 can be \"PREVIOUS\", \"CURRENT\" or \"NEXT\",\r\npart 2 can be \"HOUR\", \"DAY\", \"WEEK\", \"MONTH\", \"QUARTER\", \"HALFYEAR\", \"YEAR\".\r\nBetween them is underscore \"_\". part 3 is call of the function with number as argument\r\nFor example, \"PREVIOUS_WEEK()\" or \"NEXT_MONTH()\".\r\nNote, Yesterday, Today, Tomorrow are cast to \"PREVIOUS_DAY()\", \"CURRENT_DAY()\" and \"NEXT_DAY()\"\r\nAlso, allowed functions are:\r\nDAY_OF_WEEK(n) - (example: \"DAY_OF_WEEK(2)\" means \"each Monday\"). n - number of day of week starting from Sunday:\r\n1 - Sunday, 2 - Monday, 3 - Tuesday, 4 - Wednesday, 5 - Thursday, 6 - Friday, 7 - Saturday.\r\nDAY_OF_MONTH(n) - (example: \"DAY_OF_MONTH(14)\" means \"each 14th day of the month\"),\r\nMONTH(n) - (example: \"MONTH(5)\" means \"each May\"),\r\nEXACT_YEAR(n) - (example: \"EXACT_YEAR(1985)\" means \"in 1985\"),\r\nEXACT_TIME(h,m,s) - (example: \"EXACT_TIME(15,20,0)\" means \"at 15:20:00\")\r\nWITHIN_PREV_HOURS(n), WITHIN_NEXT_HOURS(n) - means \"within the last n hours\" and \"within the next n hours\" respectively.\r\nWITHIN_PREV_DAYS(n), WITHIN_NEXT_DAYS(n) - means \"within the last n days\" and \"within the next n days\" respectively.\r\nANNIVERSARY_TODAY() - means \"each year, today\"\r\nANNIVERSARY_EXACTLY_IN_DAYS(n) - means \"each year, exactly in n days after today\"\r\nANNIVERSARY_WITHIN_NEXTDAYS(n) - means \"each year, within the next n days\"\r\nANNIVERSARY_WITHIN_PREVDAYS(n) - means \"each year, within the previous n days\"",
          "type": "string"
        }
      },
      "required": ["columnPath", "comparisonType", "value"],
      "type": "object"
    },
    "RelativeDateComparisonType": {
      "description": "Specifics of working with periods:\r\nIf value is period (PREVIOUS_YEAR(), CURRENT_MONTH(), etc.),\r\nuse comparisonType \"EQUAL\" to check if the date is in that period.\r\nExample:\r\n1. In case \"created in the previous month\"\r\n\tfilter should be `{ \"columnPath\": \"CreatedOn\", \"comparisonType\": \"EQUAL\" , \"value\": \"PREVIOUS_MONTH()\" }`",
      "enum": ["EQUAL", "NOT_EQUAL", "LESS", "LESS_OR_EQUAL", "GREATER", "GREATER_OR_EQUAL"],
      "type": "string"
    },
    "StringComparisonFilter": {
      "additionalProperties": false,
      "description": "Filter for comparing values.\r\nUse it when you need to compare strings. Do not use for dates.\r\nDo not use it for lookup filters.\r\nBut if lookup Id search fails, use lookup display name columns with format \"LookupEntity.DisplayColumn\".",
      "properties": {
        "columnPath": {
          "description": "name of column to filter by. By default, it is a column name, for example \"Age\"",
          "type": "string"
        },
        "comparisonType": {
          "$ref": "#/$defs/StringComparisonType"
        },
        "value": {
          "description": "String value to compare with. For example, \"John Doe\"",
          "type": "string"
        }
      },
      "required": ["columnPath", "comparisonType", "value"],
      "type": "object"
    },
    "StringComparisonType": {
      "enum": ["EQUAL", "NOT_EQUAL", "START_WITH", "NOT_START_WITH", "CONTAIN", "NOT_CONTAIN", "END_WITH", "NOT_END_WITH", "EXISTS", "NOT_EXISTS"],
      "type": "string"
    }
  }
}
