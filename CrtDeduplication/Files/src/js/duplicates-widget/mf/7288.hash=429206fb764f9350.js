(self.webpackChunkapp_studio_enterprise_duplicates_widget=self.webpackChunkapp_studio_enterprise_duplicates_widget||[]).push([[7288],{34645:(S,ca,y)=>{var ne={"./basketball.json":[99523,9523],"./beaver.json":[37497,7497],"./cat.json":[7780,7780],"./dashboard.json":[44340,4340],"./email.json":[2160,2160],"./landingPage.json":[2888,2888],"./loader.json":[33475,3475],"./raccoon.json":[59425,9425],"./search.json":[9780,9780]};function tn(O){if(!y.o(ne,O))return Promise.resolve().then(()=>{var A=new Error("Cannot find module '"+O+"'");throw A.code="MODULE_NOT_FOUND",A});var r=ne[O],et=r[0];return y.e(r[1]).then(()=>y.t(et,19))}tn.keys=()=>Object.keys(ne),tn.id=34645,S.exports=tn},77288:(S,ca,y)=>{var ne=y(76608),tn=y(74369),O=y(5757),r=y(22307),et=y(44951),A=y(79772);const vt="CRT_CSRF",li="CRT_LOADER",nn="CRT_SESSIONID",sn="bpmHref",Mt="bpmRef";var w=y(67057),c=y(62278),u=y(36486);const Iu=new r.InjectionToken("CustomEventApplicationIdToken"),$g=new r.InjectionToken("CustomEventServiceToken");class Ws{constructor(e,t=null){this.document=e,this.appId=t,this.customEventName="TSCustomEventChannel",this.appId=t||Math.random().toString()}subscribe(e){return this.customEventObserver$=this.customEventObserver$||(0,c.fromEvent)(document,this.customEventName),this.customEventObserver$.pipe((0,u.filter)(t=>t.detail.eventName===e&&t.detail.sender!==this.appId),(0,u.map)(t=>t.detail.payload))}createOutboundChannel(e){const t=new c.Subject;return t.asObservable().subscribe(n=>{const i=new CustomEvent(this.customEventName,{detail:{eventName:e,sender:this.appId,payload:n}});this.document.dispatchEvent(i)}),t}getDataViaEvent(e,t={}){return new c.Observable(n=>{this.subscribe(e).pipe((0,u.first)()).subscribe(i=>{n.next(i),n.complete()}),this.createOutboundChannel(e).next(t)})}getDataStreamViaEvent(e,t={}){return new c.Observable(n=>{const i=this.subscribe(e).subscribe(a=>{n.next(a)},c.noop,()=>n.complete());return this.createOutboundChannel(e).next(t),()=>{i.unsubscribe()}})}static{this.\u0275fac=function(t){return new(t||Ws)(r.\u0275\u0275inject(w.DOCUMENT),r.\u0275\u0275inject(Iu,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ws,factory:Ws.\u0275fac,providedIn:"root"})}}var Eu=y(34268),la=y.n(Eu);const Au="(?=^.{1,250}$)^[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?\\.)+[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?$",xu=()=>new RegExp(Au,"g"),zg=()=>new RegExp(CONTAINS_EMAIL_PATTERN,"g");function Ru(s){return xu().test(s)}function Hg(s){return CONTAINS_EMAIL_REGEXP().test(s)}const Xo={name:"uponSanitizeElement",func:(s,e)=>{const t=e.tagName;Ru(t)&&s.insertAdjacentText("afterbegin",`<${t}>`)}},Qo={name:"afterSanitizeAttributes",func:(s,e)=>{const t=window?.location?.origin;if(s.nodeName==="A"&&!s.getAttribute("href")?.toLowerCase().startsWith(t)){s.setAttribute("target","_blank");let n=s.getAttribute("rel")||"";["noopener","noreferrer"].forEach(i=>{n.includes(i)||(n+=" "+i)}),s.setAttribute("rel",n.trim())}}},Gg=new r.InjectionToken("Represents a DOM purifier",{factory:()=>(la().addHook(Xo.name,Xo.func),la().addHook(Qo.name,Qo.func),la()),providedIn:"platform"});function qg(s){return s?Array.isArray(s)?s:[s]:[]}function Wg(s){return s||{}}function Zg(){}function Tu(){return()=>{}}var Kg=y(26714);class Pu{static create(e){return new e}}class rn{constructor(){this.speechResult=new c.Subject,this.speechEnd=new c.Subject}static _getInternalApiClass(){return window.SpeechRecognition||window.webkitSpeechRecognition}static isSupported(){return rn._getInternalApiClass()!==void 0}_subscribeEvents(){this._internalApi.addEventListener("result",this.onResult.bind(this)),this._internalApi.addEventListener("speechend",this.onSpeechEnd.bind(this))}_unsubscribeEvents(){this._internalApi.removeEventListener("result",this.onResult),this._internalApi.removeEventListener("speechend",this.onSpeechEnd)}init(e){const t=rn._getInternalApiClass();this._internalApi=Pu.create(t),this._internalApi.continuous=!0,this._internalApi.lang=e.lang||"en-US",this._subscribeEvents()}onResult(e){const{resultIndex:t,results:n}=e,i=n[t][0];if(!i)throw new Error("No results to transcript");this.speechResult.next(i.transcript)}onSpeechEnd(){this.speechEnd.next()}destroy(){this._unsubscribeEvents(),this._internalApi=null}startRecognition(){this._internalApi.start()}stopRecognition(){this._internalApi.stop()}static{this.\u0275fac=function(t){return new(t||rn)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:rn,factory:rn.\u0275fac})}}var Nu=y(73436);class Du{get messages$(){return this._messages$}constructor(e,t){this._ngZone=t;const n=new c.Subject;this._messages$=n.pipe(this._runInZone(this._ngZone)),this._broadcastChannel=new Nu.BroadcastChannel(e),this._broadcastChannel.onmessage=i=>n.next(i)}_runInZone(e){return t=>new c.Observable(n=>{t.subscribe(i=>e.run(()=>n.next(i)))})}publish(e){return(0,c.from)(this._broadcastChannel.postMessage(e))}}class an{constructor(e){this._ngZone=e}createInstance(e){return new Du(e,this._ngZone)}static{this.\u0275fac=function(t){return new(t||an)(r.\u0275\u0275inject(r.NgZone))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:an,factory:an.\u0275fac,providedIn:"root"})}}class Jg{static toColdObservable(e){return new Observable(t=>{e().subscribe(i=>{t.next(i),t.complete()})})}}class Zs{log(e,t,...n){console.log(e,...n)}warn(e,t,...n){console.warn(e,...n)}error(e,t,...n){console.error(e,...n)}exception(e,t,...n){(console.exception||console.error)(e,...n)}static{this.\u0275fac=function(t){return new(t||Zs)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Zs,factory:Zs.\u0275fac})}}const Yg={dataAccess:"data-access",feature:"feature",ui:"ui",util:"util",components:"components",deprecated:"deprecated"},Xg={studioFree:"studio-free",studioEnterprise:"studio-enterprise",sdk:"sdk"};var b=y(73308);class Ks{constructor(e,t,n=null){this._injector=e,this._registrationMap=t,this._defaultInstanceType=n}_getInstance(e,t,n){return t?"injectable"in t&&t.injectable!=null?n.get(t.injectable):"useFactory"in t&&typeof t.useFactory=="function"?t.useFactory(e):"useValue"in t?t.useValue:null:null}_getDefaultInstance(e,t){return this._getInstance(e,this._defaultInstanceType,t)}_getInstanceByType(e,t){if(this._registrationMap.has(e)){const n=this._registrationMap.get(e);return this._getInstance(e,n,t)}}_getInstanceByPredicate(e,t){for(const[n,i]of this._registrationMap){if(typeof n!="function")continue;if(n(e,this._injector))return this._getInstance(e,i,t)}}_getInstanceByPredicateAsync(e,t){var n=this;return(0,b.A)(function*(){for(const[i,a]of n._registrationMap){if(typeof i!="function")continue;const l=i(e,n._injector);if(l instanceof Promise?yield l:l)return n._getInstance(e,a,t)}return null})()}create(e=null,t){const n=t??this._injector;return e==null?this._getDefaultInstance(e,n):this._getInstanceByType(e,n)??this._getInstanceByPredicate(e,n)??this._getDefaultInstance(e,n)}createAsync(){var e=this;return(0,b.A)(function*(t=null,n){const i=n??e._injector;return t==null?e._getDefaultInstance(t,i):e._getInstanceByType(t,i)??(yield e._getInstanceByPredicateAsync(t,i))??e._getDefaultInstance(t,i)}).apply(this,arguments)}static{this.\u0275fac=function(t){r.\u0275\u0275invalidFactory()}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ks,factory:Ks.\u0275fac,providedIn:"root"})}}var v=y(28399);class Vu{static _createMappings(e){const t=new Map;return e=e??[],e.forEach(n=>{const i=n.predicate,a=(0,v.omit)(n,"predicate");t.set(i,a)}),t}static create(e){const{mappings:t,default:n,token:i,predicateToken:a}=e??{};return{provide:i,useFactory:o=>{const l=a?o.get(a,[],{optional:!0}):[],d=this._createMappings([...t??[],...l??[]]);return new Ks(o,d,n)},deps:[r.Injector]}}static createForPredicates(e){const{mappings:t,predicateToken:n}=e??{};return!n&&!t?.length?[]:t.map(i=>({provide:n,useValue:i,multi:!0}))}}function ua(s){return Array.isArray(s)?s:[s]}function Ou(s,e){return e.forEach(({replaceMacros:t,replaceValue:n})=>{s=s.map(i=>i===t?n??"":i)}),s}function Qg(s,e){if(!s)return"";if(!e)return s;let t=[s];return e=ua(e),t=Bu(t,e),t=Ou(t,e),t.join("")}function Bu(s,e){if(!s)return[];let t=ua(s);if(!e)return t;const n=ua(e),i=n.map(({replaceMacros:a})=>a);return n.forEach(({searchValue:a,replaceMacros:o})=>{if(a&&o){const l=new RegExp(`(${o})`,"g"),d=t.map(h=>i.includes(h)?h:h.split(a).join(o).split(l));t=flatten(d)}}),t}var e_=y(4930);function on(s){return function(e){Reflect.defineMetadata("requestType",s.requestType,e)}}function t_(s){return e=>{const t=e.pipe(share()),n=t.pipe(tap(s),take(1));return concat(n,t)}}function n_(s){return e=>e.pipe(concatMap((t,n)=>s(t,n).pipe(map(i=>[t,i]))))}function ec(s){return e=>e.pipe((0,u.mergeMap)((t,n)=>s(t,n).pipe((0,u.map)(i=>[t,i]))))}function da(s){return e=>e.pipe((0,u.mergeMap)((t,n)=>s(t,n).pipe((0,u.map)(()=>t))))}function tc(s){return e=>e.pipe((0,u.switchMap)((t,n)=>s(t,n).pipe((0,u.map)(i=>[t,i]))))}function tt(s){return e=>e.pipe((0,u.switchMap)((t,n)=>s(t,n).pipe((0,u.map)(()=>t))))}function ku(s){return e=>s?new c.Observable(t=>{const n=o=>s.run(()=>t.next(o)),i=o=>s.run(()=>t.error(o)),a=()=>s.run(()=>t.complete());return e.subscribe({next:n,error:i,complete:a})}):e}function i_(s){return e=>s?new Observable(t=>{const n=o=>s.runOutsideAngular(()=>t.next(o)),i=o=>s.runOutsideAngular(()=>t.error(o)),a=()=>s.runOutsideAngular(()=>t.complete());return e.subscribe({next:n,error:i,complete:a})}):e}var ha=y(23710);class nc{static initialize(){ha.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),ha.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",n="_"){const i=new RegExp(`^${t}`);return t+e.replace(i,"")+n+ha.generate()}static getUniqueIncrementalName(e,t){if(!t.includes(e))return e;let n;for(let i=1;i<=t.length;i++)if(n=`${e}-${i}`,!t.includes(n))return n;return n}}nc.initialize();const s_=new r.InjectionToken("An abstraction over window.navigator object",{factory:()=>window.navigator,providedIn:"root"}),Lu="00000000-0000-0000-0000-000000000000",Fu=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function ui(s){let e="";for(let t=0;t<s;t++)e+=((1+Math.random())*65536|0).toString(16).substring(1);return e}function D(){return[ui(2),ui(1),ui(1),ui(1),ui(3)].join("-")}function ic(s){return!!s&&Fu.test(s)}function ju(s){return!s||s===Lu}const sc=new r.InjectionToken("CURRENT_TAB_ID_TOKEN"),r_={provide:sc,useValue:D()},a_=new r.InjectionToken("Dialog token"),Ie=new r.InjectionToken("WindowToken",{providedIn:"root",factory:rc});function rc(){return window}const o_={provide:Ie,useFactory:rc};class Js{constructor(e){this._window=e,this._hasFocus=!1,this._window.addEventListener("focus",()=>{this._hasFocus=!0}),this._window.addEventListener("blur",()=>{this._hasFocus=!1})}_getIsDocumentVisible(){return document.visibilityState!=="hidden"}get hasFocus(){return this._hasFocus}get isActive(){return this._getIsDocumentVisible()}focus(){this._window.focus()}static{this.\u0275fac=function(t){return new(t||Js)(r.\u0275\u0275inject(Ie))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Js,factory:Js.\u0275fac,providedIn:"root"})}}var ac=y(40409);class di{constructor(e){this._injector=e}defineComponent(e,t,n=null){const i=(0,ac.createCustomElement)(t,{injector:n||this._injector});customElements.get(e)||customElements.define(e,i)}static{this.\u0275fac=function(t){return new(t||di)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:di,factory:di.\u0275fac,providedIn:"root"})}}function $u(s,e){return s.creatio.tabId=e,(0,c.of)(void 0)}const c_={provide:r.APP_INITIALIZER,multi:!0,useFactory:(s,e)=>()=>$u(s,e),deps:[Ie,sc]},oc=new r.InjectionToken("LOCAL_STORAGE_SERVICE_CONFIG");class Ys{static forRoot(e={}){return{ngModule:Ys,providers:[{provide:oc,useValue:e}]}}static{this.\u0275fac=function(t){return new(t||Ys)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Ys})}static{this.\u0275inj=r.\u0275\u0275defineInjector({})}}const pa="LOCAL_STORAGE_NOT_SUPPORTED";class hi{constructor(e={}){this._isSupported=!1,this._prefix="ls",this._storageType="localStorage";const{prefix:t,storageType:n}=e||{};t!=null&&this._setPrefix(t),n!=null&&this._setStorageType(n),this._isSupported=this._checkSupport()}_deriveKey(e){return`${this._prefix}${e}`}_checkSupport(){try{const e=this._storageType in window&&window[this._storageType]!==null;if(e){this._webStorage=window[this._storageType];const t=this._deriveKey(`__${Math.round(Math.random()*1e7)}`);this._webStorage.setItem(t,""),this._webStorage.removeItem(t)}return e}catch(e){return console.error(e.message),!1}}_setPrefix(e){this._prefix=e;const t=".";this._prefix&&!this._prefix.endsWith(t)&&(this._prefix=this._prefix?`${this._prefix}${t}`:"")}_setStorageType(e){this._storageType=e}get(e){if(!this._isSupported)return console.warn(pa),null;const t=this._webStorage?this._webStorage.getItem(this._deriveKey(e)):null;if(!t||t==="null")return null;try{return JSON.parse(t)}catch{return null}}set(e,t){const n=t===void 0?null:JSON.stringify(t);if(!this._isSupported)return console.warn(pa),!1;try{this._webStorage&&this._webStorage.setItem(this._deriveKey(e),n)}catch(i){return console.error(i.message),!1}return!0}remove(...e){let t=!0;return e.forEach(n=>{this._isSupported||(console.warn(pa),t=!1);try{this._webStorage.removeItem(this._deriveKey(n))}catch(i){console.error(i.message),t=!1}}),t}static{this.\u0275fac=function(t){return new(t||hi)(r.\u0275\u0275inject(oc,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:hi,factory:hi.\u0275fac,providedIn:"root"})}}class Xs{playFromSource(e){return(0,b.A)(function*(t,n=!1){const i=new Audio(t),a=i.play();if(a!==void 0)try{yield a}catch(o){if(i.muted=!0,n)throw o}}).apply(this,arguments)}static{this.\u0275fac=function(t){return new(t||Xs)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Xs,factory:Xs.\u0275fac,providedIn:"root"})}}var nt;(function(s){s.Small="small",s.Medium="medium",s.Large="large",s.XL="xl",s.XXL="xxl"})(nt||(nt={}));class Qs{constructor(e,t){this._window=e,this._document=t,this._minScreenSize=600,this._mediumScreenSize=790,this._largeScreenSize=1079,this._xlScreenSize=1280,this._screenSizeChanges$=new c.BehaviorSubject(this._currentScreenSizeType),this._changeScreenSizeType()}get currentScreenSizeType(){return this._currentScreenSizeType}get currentScreenSize(){return this._currentScreenSize}get isSmallScreen(){return this._currentScreenSizeType===nt.Small}_setScreenSizeTypeAttribute(e){this._document.body.setAttribute("screen-size-type",e)}_getScreenSizeType(){return this._currentScreenSize=this._window.innerWidth,this._currentScreenSize<=this._minScreenSize?nt.Small:this._currentScreenSize<=this._mediumScreenSize?nt.Medium:this._currentScreenSize<=this._largeScreenSize?nt.Large:this._currentScreenSize<=this._xlScreenSize?nt.XL:nt.XXL}_changeScreenSizeType(){const e=this._getScreenSizeType();return e===this._currentScreenSizeType?!1:(this._currentScreenSizeType=e,this._setScreenSizeTypeAttribute(e),!0)}screenSizeTypeChangeNotifier(){return this._screenSizeChanges$.asObservable()}refreshCurrentScreenSizeType(){this._changeScreenSizeType()&&this._screenSizeChanges$.next(this._currentScreenSizeType)}static{this.\u0275fac=function(t){return new(t||Qs)(r.\u0275\u0275inject(Ie),r.\u0275\u0275inject(w.DOCUMENT))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Qs,factory:Qs.\u0275fac,providedIn:"root"})}}const l_=new r.InjectionToken("DESKTOP_NOTIFICATION_SENDER_PROVIDER");class er{static get isMobile(){const e=window.navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}}var cc;(function(s){s[s.StayLoggedIn=0]="StayLoggedIn",s[s.Exit=1]="Exit",s[s.NotSet=2]="NotSet"})(cc||(cc={}));var tr=y(27075);class nr{constructor(){this._liveAnnouncer=(0,r.inject)(tr.LiveAnnouncer),this._translateService=(0,r.inject)(A.TranslateService)}announce(e,t){var n=this;return(0,b.A)(function*(i,a,o=200){const l=n._translateService.instant(i);yield n._liveAnnouncer.announce(l,a,o)}).apply(this,arguments)}static{this.\u0275fac=function(t){return new(t||nr)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:nr,factory:nr.\u0275fac,providedIn:"root"})}}function Uu(s){return s.endsWith("/")||(s+="/"),s}function zu(s){return s.replace(/(^([/\\])+)|(([/\\])+$)/,"")}function Hu(s){return s=s.replace(location.hash,""),s.replace(location.search,"")}function Gu(s){return`${qu()}/Navigation/Navigation.aspx?schemaName=${s}`}function u_(){return"/"}function it(){let s=location.pathname;const e=s.match(/.*?\/\d\/?/);return e&&e.length===1?s=Uu(e[0]):s="",Wu(location.origin,s)}function lc(){let s=location.href.replace(it(),"");return s=Hu(s),s||"/"}function d_(){const s=lc(),e=it(),t=s.split("/").filter(Boolean)[0];return t?`${e}${t}/`:e}function ir(){let e=it().replace(location.origin,"");return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function qu(){return it().replace(/\/0\/?$|\/+$/,"")}function Wu(...s){return s.map(e=>zu(e)).join("/")}function h_(s,e){return`${Gu(s)}&recordId=${e}`}function p_(s,e){function t(o,l){return o.toLowerCase().replace(l,"").split("/").filter(d=>d).join("/")}const n=it().toLowerCase(),i=t(s,n),a=t(e,n);return i===a}function m_(s){return s?ir()+imageServiceUrl+s:null}function f_(){return ir()+esqServiceUrl}function g_(s){const{uId:e,name:t,packageUId:n,userLevelSchema:i}=s;if(!e&&!t)throw new Error("uId or name is required");const a=it(),o=lc(),l=`#/InterfaceDesigner/${e||t}`,d=new URLSearchParams;return n&&d.append("packageUId",n),i&&d.append("userLevelSchema","true"),`${a}${o}${l}?${d.toString()}`}const Zu="Translations/Custom/",Ku="CommonFeatures.UseCustomCoreLocalizations";var m=y(5960);const W=new r.InjectionToken("FEATURE_VALUES",{factory:()=>({})});var ce;(function(s){s.Memory="Memory",s.Persistent="Persistent",s.PersistentAndMemory="PersistentAndMemory"})(ce||(ce={}));const ma=new r.InjectionToken("USE_SYSTEM_CLIENT_CACHE",{providedIn:"root",factory:()=>!!window.__useSystemClientCache});var $e;(function(s){s.CacheRegistry="cache-registry",s.Images="images",s.BusinessRules="business-rules",s.RuntimeEntitySchema="runtime-entity-schema",s.RuntimeFreedomUISchemas="runtime-freedom-ui-schemas",s.UserInfo="user-info",s.SystemSettingsCache="system-settings",s.ApplicationInfo="application-info",s.Features="features",s.Rights="rights",s.Auth="auth",s.Acl="acl",s.UserLevelSchema="user-level-schema",s.ConfigurationData="configuration-data"})($e||($e={}));var Ju=y(40234);const Yu={name:"crt-shell-db",version:15,objectStoresMeta:Object.values($e).map(s=>({store:s,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]})),isDefault:!0};class cn{constructor(e){this.dbService=e,this._shouldRemoveDataBaseErrorNames=["VersionError","InvalidStateError","UnknownError"],this._dbReady=!0,this.dbService||(this._dbReady=!1,console.info("For using persistent cache, you need to register NgxIndexedDBService."))}_getErrorMessage(e){return e instanceof Error?`Name: ${e.name}, Message: ${e.message}`:e instanceof Event&&e.target&&"error"in e.target?`${e.target.error?.message}`:typeof e=="string"?e:JSON.stringify(e)}_handleError(e){const t=typeof e=="string"||e instanceof Error&&this._shouldRemoveDataBaseErrorNames.includes(e.name);return this._dbReady&&t?(indexedDB.deleteDatabase(Yu.name),console.warn(`IndexedDB has been refreshed. ${this._getErrorMessage(e)}`),this._dbReady=!1,(0,c.of)(void 0)):(console.warn(`IndexedDB request error. ${this._getErrorMessage(e)}`),(0,c.of)(void 0))}_executeIndexedDBOperation(e,t){return this._dbReady?e():(0,c.of)(t)}get dbReady(){return this._dbReady}add(e,t){return this._executeIndexedDBOperation(()=>this.dbService.add(e,t),void 0).pipe((0,c.catchError)(n=>this._handleError(n)))}bulkAdd(e,t){return this._executeIndexedDBOperation(()=>this.dbService.bulkAdd(e,t),[]).pipe((0,c.catchError)(n=>this._handleError(n)))}getByKey(e,t){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(e,"key",t),null).pipe((0,c.catchError)(n=>this._handleError(n)))}getByKeys(e,t){if(t.length===0)return(0,c.of)([]);const n=t.map(i=>this._executeIndexedDBOperation(()=>this.getByKey(e,i),null));return(0,c.forkJoin)(n).pipe((0,c.map)(i=>i.filter(Boolean)),(0,c.catchError)(i=>this._handleError(i)))}clear(e){return this._executeIndexedDBOperation(()=>this.dbService.clear(e),!1).pipe((0,c.catchError)(t=>this._handleError(t)))}update(e,t){return this._executeIndexedDBOperation(()=>this.dbService.update(e,t),void 0).pipe((0,c.catchError)(n=>this._handleError(n)))}bulkUpdate(e,t){return this._executeIndexedDBOperation(()=>this.dbService.bulkPut(e,t),[]).pipe((0,c.catchError)(n=>this._handleError(n)))}delete(e,t){return this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(e,t),!0).pipe((0,c.catchError)(n=>this._handleError(n)))}deleteByIndex(e,t){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(e,"key",t),null).pipe((0,c.switchMap)(n=>n?this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(e,n.id),!1):(0,c.of)(!0)),(0,c.catchError)(n=>this._handleError(n)))}getAll(e){return this._executeIndexedDBOperation(()=>this.dbService.getAll(e),null).pipe((0,c.catchError)(t=>this._handleError(t)))}static{this.\u0275fac=function(t){return new(t||cn)(r.\u0275\u0275inject(Ju.NgxIndexedDBService,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:cn,factory:cn.\u0275fac,providedIn:"root"})}}function Xu(s){const e=document.cookie.match(new RegExp("(^| )"+s+"=([^;]+)"));return e?e[2]:null}function Qu(){return Xu("UserType")==="SSP"?"ssp/":""}class uc{constructor(e,t,n){this._indexedDBService=e,this.memoryCache=n,this._tableName=t.tableName,this._keyPrefix=t.keyPrefix}_getPrefixedKey(e){return this._keyPrefix?`${this._keyPrefix}_${e}`:e}_getIndexedDBRecord(e){return(0,c.firstValueFrom)(this._indexedDBService.getByKey(this._tableName,e))}_getIndexedDBRecords(e){return(0,c.firstValueFrom)(this._indexedDBService.getByKeys(this._tableName,e))}has(e){var t=this;return(0,b.A)(function*(){if(yield t.memoryCache?.has(t._getPrefixedKey(e)))return!0;const n=yield t._getIndexedDBRecord(t._getPrefixedKey(e));return yield t.memoryCache?.set(t._getPrefixedKey(e),n?.data),!!n?.data})()}get(e){var t=this;return(0,b.A)(function*(){if(yield t.memoryCache?.has(t._getPrefixedKey(e)))return t.memoryCache.get(t._getPrefixedKey(e));const n=yield t._getIndexedDBRecord(t._getPrefixedKey(e));return yield t.memoryCache?.set(t._getPrefixedKey(e),n?.data),n?.data??null})()}getAll(){var e=this;return(0,b.A)(function*(){const t=yield e.memoryCache?.getAll();return t?.length>0?t:yield(0,c.firstValueFrom)(e._indexedDBService.getAll(e._tableName).pipe((0,c.map)(n=>n.map(i=>({key:i.key,value:i.data}))),(0,c.tap)(n=>e.memoryCache?.bulkSet(n))))})()}set(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._getIndexedDBRecord(n._getPrefixedKey(e));i?yield(0,c.firstValueFrom)(n._indexedDBService.update(n._tableName,{id:i.id,key:n._getPrefixedKey(e),data:t})):yield(0,c.firstValueFrom)(n._indexedDBService.add(n._tableName,{key:n._getPrefixedKey(e),data:t})),yield n.memoryCache?.set(n._getPrefixedKey(e),t)})()}bulkSet(e){var t=this;return(0,b.A)(function*(){if(!e||e.length===0)return;const n=(yield t._getIndexedDBRecords(e.map(a=>t._getPrefixedKey(a.key))))||[],i=e.map(a=>{const o=n.filter(Boolean).find(d=>d.key===t._getPrefixedKey(a.key)),l={key:t._getPrefixedKey(a.key),data:a.value};return o?.id?{...l,id:o.id}:l});yield(0,c.firstValueFrom)(t._indexedDBService.bulkUpdate(t._tableName,i)),yield t.memoryCache?.bulkSet(e)})()}delete(e){var t=this;return(0,b.A)(function*(){yield(0,c.firstValueFrom)(t._indexedDBService.deleteByIndex(t._tableName,t._getPrefixedKey(e))),yield t.memoryCache?.delete(t._getPrefixedKey(e))})()}clear(){var e=this;return(0,b.A)(function*(){yield(0,c.firstValueFrom)(e._indexedDBService.clear(e._tableName)),yield e.memoryCache?.clear()})()}}class dc{constructor(){this._cache=new Map}has(e){return Promise.resolve(this._cache.has(e))}get(e){return Promise.resolve(this._cache.get(e))}getAll(){return Promise.resolve([...this._cache].map(([e,t])=>({key:e,value:t})))}set(e,t){return this._cache.set(e,t),Promise.resolve()}bulkSet(e){return e.forEach(t=>{this._cache.set(t.key,t.value)}),Promise.resolve()}delete(e){return this._cache.delete(e),Promise.resolve()}clear(){return this._cache.clear(),Promise.resolve()}}class pi{constructor(e){this._indexedDBService=e}create(e){switch(e.type){case ce.Memory:return new dc;case ce.Persistent:return new uc(this._indexedDBService,e.options);case ce.PersistentAndMemory:return new uc(this._indexedDBService,e.options,new dc);default:throw new Error(`Unsupported cache type: ${e.type}`)}}static{this.\u0275fac=function(t){return new(t||pi)(r.\u0275\u0275inject(cn))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:pi,factory:pi.\u0275fac,providedIn:"root"})}}const hc="ClientCacheVersion";class ed{constructor(e,t,n,i){this._injector=e,this._systemCaches=t,this._useSystemClientCache=n,this._usePersistentCache=i,this._caches=new Map}_getPersistentCacheRegistryItems(){var e=this;return(0,b.A)(function*(){return(yield(0,c.firstValueFrom)(e._indexedDBService.getAll($e.CacheRegistry)))?.map(n=>n.data)??[]})()}_initializePersistentCacheRegistry(){var e=this;return(0,b.A)(function*(){if(!e._usePersistentCache){e._persistentCacheRegistry=new Map;return}const n=(yield e._getPersistentCacheRegistryItems()).map(i=>[i.name,i]);e._persistentCacheRegistry=new Map(n)})()}_initializeRegisteredCaches(){this._persistentCacheRegistry.forEach(e=>{const t=this._cacheFactory.create({name:e.name,type:e.useMemoryCache?ce.PersistentAndMemory:ce.Persistent,options:{tableName:e.tableName}});this._caches.set(e.name,t)})}_registerPersistentCache(e){var t=this;return(0,b.A)(function*(){if(!t._usePersistentCache)return;const n={name:e.name,tableName:e.options.tableName,useMemoryCache:e.type===ce.PersistentAndMemory,hash:""};yield(0,c.firstValueFrom)(t._indexedDBService.add($e.CacheRegistry,{key:e.name,data:n})),t._persistentCacheRegistry.set(e.name,n)})()}_updatePersistentCacheHash(e,t){var n=this;return(0,b.A)(function*(){const i=n._persistentCacheRegistry.get(e);i.hash=t,n._persistentCacheRegistry.set(e,i);const a=yield(0,c.firstValueFrom)(n._indexedDBService.getByKey($e.CacheRegistry,e));a?.data&&(a.data.hash=t,yield(0,c.firstValueFrom)(n._indexedDBService.update($e.CacheRegistry,{id:a.id,key:e,data:i})))})()}_isPersistentCache(e){return e===ce.Persistent||e===ce.PersistentAndMemory}_initializeSystemCaches(){var e=this;return(0,b.A)(function*(){const t=e._systemCaches||[];if(t.length===0)return;const n=t.filter(i=>!e._caches.has(i.name));yield Promise.all(n.map(i=>e._create(i)))})()}_create(e){var t=this;return(0,b.A)(function*(){if(t._caches.has(e.name))throw new Error(`Cache instance with name "${e.name}" already exists.`);const n=t._cacheFactory.create({...e,type:t._usePersistentCache?e.type:ce.Memory});return t._caches.set(e.name,n),t._isPersistentCache(e.type)&&(yield t._registerPersistentCache(e)),n})()}_internalInitialize(){var e=this;return(0,b.A)(function*(){e._indexedDBService=e._injector.get(cn),e._cacheFactory=e._injector.get(pi),e._httpClient=e._injector.get(O.HttpClient),e._caches.clear(),yield e._initializePersistentCacheRegistry(),e._initializeRegisteredCaches(),yield e._initializeSystemCaches(),yield e._validateSystemCaches()})()}_validateSystemCaches(){var e=this;return(0,b.A)(function*(){if(!e._caches.size||!e._indexedDBService.dbReady||!e._usePersistentCache)return;const t=Qu(),{hashes:n=[],cacheVersion:i=0}=yield(0,c.lastValueFrom)(e._httpClient.get(`${t}api/ClientCache/Hashes`).pipe((0,u.catchError)(()=>(console.warn("Failed to get system hashes"),(0,c.of)({hashes:[],cacheVersion:0})))));if(e._getIsNeedForceClearCache(i)){yield e._innerClearAll();return}yield Promise.all(n.map(({name:o,value:l})=>e._internalValidateCache(o,l)))})()}_getIsNeedForceClearCache(e){const t=this._injector.get(hi),n=t.get(hc),i=e&&e!==n;return i&&t.set(hc,e),i}_internalValidateCache(e,t){var n=this;return(0,b.A)(function*(){if(!n._persistentCacheRegistry.has(e)||!n._usePersistentCache)return;if(n._persistentCacheRegistry.get(e).hash!==t){const a=n._caches.get(e);a&&(yield a.clear(),yield n._updatePersistentCacheHash(e,t))}})()}_innerClearAll(){var e=this;return(0,b.A)(function*(){yield Promise.all([...e._caches.values()].map(t=>t.clear()))})()}whenInitialized(){return this._initialized??=this._internalInitialize(),this._initialized}get(e){var t=this;return(0,b.A)(function*(){yield t.whenInitialized();const n=t._caches.get(e);if(!n)throw new Error(`Cache instance with name "${e}" does not exist.`);return n})()}getOrCreate(e){var t=this;return(0,b.A)(function*(){if(yield t.whenInitialized(),!t._caches.has(e.name)){if(!e.type)throw new Error(`Cache type must be specified for cache "${e.name}".`);yield t._create({...e,type:e.type})}return t._caches.get(e.name)})()}clearAll(){var e=this;return(0,b.A)(function*(){yield e.whenInitialized(),yield e._innerClearAll()})()}validateCache(e,t){var n=this;return(0,b.A)(function*(){yield n.whenInitialized(),yield n._internalValidateCache(e,t)})()}executeWithCache(e,t,n){return this._useSystemClientCache?(0,c.from)(this.whenInitialized()).pipe((0,c.map)(()=>this._caches.get(e)),(0,c.switchMap)(function(){var i=(0,b.A)(function*(a){return{cacheValue:yield a?.get(t),cacheInstance:a}});return function(a){return i.apply(this,arguments)}}()),(0,c.switchMap)(({cacheValue:i,cacheInstance:a})=>i!=null?(0,c.of)(i):n.pipe((0,c.tap)(o=>a?.set(t,o))))):n}executeWithBulkCache(e,t){return this._useSystemClientCache?(0,c.from)(this.whenInitialized()).pipe((0,c.map)(()=>this._caches.get(e)),(0,c.switchMap)(function(){var n=(0,b.A)(function*(i){return{cachedItems:yield i?.getAll(),cacheInstance:i}});return function(i){return n.apply(this,arguments)}}()),(0,c.switchMap)(({cachedItems:n,cacheInstance:i})=>n?.length?(0,c.of)(n):t.pipe((0,c.switchMap)(function(){var a=(0,b.A)(function*(o){return yield i?.bulkSet(o),o});return function(o){return a.apply(this,arguments)}}())))):t}}var Ee;(function(s){s.Share="Share",s.Own="Own",s.TryConnectToShared="TryConnectToShared"})(Ee||(Ee={}));const fa=new r.InjectionToken("SYSTEM_CACHE"),td=new r.InjectionToken("CACHE_MODE"),ga=window;class fe{get _cacheManager(){switch(this._cacheMode){case Ee.Share:return ga.cacheManager;case Ee.Own:return this._innerCacheManager;case Ee.TryConnectToShared:return ga.cacheManager??this._innerCacheManager;default:throw new Error("Unknown cache mode")}}set _cacheManager(e){switch(this._cacheMode){case Ee.Share:ga.cacheManager=e;break;case Ee.Own:case Ee.TryConnectToShared:this._innerCacheManager=e;break;default:throw new Error("Unknown cache mode")}}constructor(e,t,n,i){this._innerCacheManager=null,this._cacheMode=i||Ee.TryConnectToShared;const a=this._cacheMode!==Ee.TryConnectToShared;this._cacheManager||(this._cacheManager=new ed(e,t??[],n===!0,a))}whenInitialized(){return this._cacheManager.whenInitialized()}get(e){return this._cacheManager.get(e)}getOrCreate(e){return this._cacheManager.getOrCreate(e)}clearAll(){return this._cacheManager.clearAll()}validateCache(e,t){return this._cacheManager.validateCache(e,t)}executeWithCache(e,t,n){return this._cacheManager.executeWithCache(e,t,n)}executeWithBulkCache(e,t){return this._cacheManager.executeWithBulkCache(e,t)}static{this.\u0275fac=function(t){return new(t||fe)(r.\u0275\u0275inject(r.Injector),r.\u0275\u0275inject(fa,8),r.\u0275\u0275inject(ma,8),r.\u0275\u0275inject(td,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac,providedIn:"root"})}}const nd=new r.InjectionToken("USE_MEASURE_PERFORMANCE_TOOLS",{providedIn:"root",factory:()=>!!window.__useMeasurePerformanceTools});class z{constructor(e){this._useMeasurePerformanceTools=e,this._consequentMeasureStartTimeCorrection=.001,this._lastNowStartTime=0,this.rendering$=new c.BehaviorSubject(null)}_getNowStartTimeWithCorrection(){const e=performance.now(),t=e<=this._lastNowStartTime?this._lastNowStartTime+this._consequentMeasureStartTimeCorrection:e;return this._lastNowStartTime=t,t}measure(e,t,n){if(!this._useMeasurePerformanceTools)return t();const i=n||this._getNowStartTimeWithCorrection(),a=t();return performance.measure(e,{start:i}),a}measureCallback(e,t){var n=this;return(0,b.A)(function*(){if(!n._useMeasurePerformanceTools)return t();const i=n._getNowStartTimeWithCorrection(),a=yield t();return performance.measure(e,{start:i}),a})()}measure$(e){if(!this._useMeasurePerformanceTools)return n=>n;let t;return n=>(0,c.of)(null).pipe((0,u.tap)(()=>t=this._getNowStartTimeWithCorrection()),(0,c.switchMap)(()=>n),(0,u.tap)(()=>{const i=typeof e=="string"?e:e();performance.measure(i,{start:t})}))}static{this.\u0275fac=function(t){return new(t||z)(r.\u0275\u0275inject(nd,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac,providedIn:"root"})}}const _a="features-cache",__={provide:fa,useValue:{name:_a,type:ce.PersistentAndMemory,options:{tableName:$e.Features}},multi:!0},id=new Array("constructor","ngOnDestroy");let ya=!1;const pc=new Proxy({},{get(s,e){if(ya||id.includes(e))return s[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),y_={provide:W,useFactory:()=>pc},sd=new r.InjectionToken("FEATURE_SERVICE_GET_FEATURES_STATES_ENDPOINT",{factory:()=>"rest/FeatureService/GetFeatureStates",providedIn:"root"});let sr=class ta{constructor(e,t,n,i,a){this.httpClient=e,this._getFeatureStatesEndpoint=t,this._useSystemClientCache=n,this._cacheManager=i,this._measurePerformanceService=a,this._cachedCodes=new Map,this._featuresLoaded=!1,this._destroyed$=new c.Subject,this._isDevMode=(0,r.isDevMode)()}_getFeaturesFromURL(){const e=location.hash,t=e.indexOf("?");if(this._isDevMode&&t>=0){const n=e.substring(t+1);return[...new URLSearchParams(n.startsWith("?")?n.slice(1):n)].filter(([a])=>a.startsWith("feature:")).map(([a,o])=>({key:a.substring(8),value:o==="true"}))}return[]}_loadFeaturesValues(){const e=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,u.map)(t=>t.GetFeatureStatesResult.map(n=>({key:n.Key,value:n.Value===1}))));return this._useSystemClientCache?(0,c.from)(this._cacheManager.getOrCreate({name:_a,type:ce.Memory})).pipe((0,u.switchMap)(()=>this._cacheManager.executeWithBulkCache(_a,e)),this._measurePerformanceService.measure$("FeatureService: load features with cache bulk")):e}_enrichFeaturesWithUrlValues(e){const t=this._getFeaturesFromURL();return[...e,...t]}updateCachedFeatureValues(e,t){Object.assign(e,t),Object.freeze(e)}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this._loadFeaturesValues().pipe((0,u.map)(e=>this._enrichFeaturesWithUrlValues(e)),(0,u.map)(e=>{e.forEach(n=>{this._cachedCodes.set(n.key,n.value)});const t=e.map(n=>[n.key,n.value]);return Object.fromEntries(t)}),(0,u.tap)(e=>{this.updateCachedFeatureValues(pc,e),this._featuresLoaded=!0,ya=!0}),(0,u.catchError)(()=>(ya=!0,this._featuresLoaded=!0,(0,c.of)(null))),(0,c.shareReplay)({bufferSize:1,refCount:!1}),(0,u.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._featuresLoaded?(0,c.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,u.map)(()=>this._cachedCodes.get(e)||!1)):(0,c.of)(!1)}getFeaturesState(e){return(0,c.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const n=typeof t=="string"?this.getFeatureState(t):t;return new Promise(i=>n.pipe((0,u.first)()).subscribe({next:i}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||ta)(r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(sd),r.\u0275\u0275inject(ma,8),r.\u0275\u0275inject(fe),r.\u0275\u0275inject(z))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ta,factory:ta.\u0275fac,providedIn:"root"})}};sr=(0,m.__decorate)([on({requestType:"crt.FeatureService"}),(0,m.__metadata)("design:paramtypes",[O.HttpClient,String,Boolean,fe,z])],sr);const mc=new r.InjectionToken("FETCH_MULTI_TRANSLATE_RESOURCES_SOURCES"),fc=new r.InjectionToken("FETCH_MULTI_TRANSLATE_CUSTOM_RESOURCES_SOURCES");class st{constructor(e,t,n){this._resourceSources=e,this._customResourceSources=t,this._featureService=n}_getCustomResourcesSource(){return this._customResourceSources?.length?this._customResourceSources:[{prefix:w.Location.joinWithSlash(it(),Zu),suffix:".json"}]}getResourceOptions(){return(0,c.from)(this._featureService.getFeatureState(Ku)).pipe((0,c.map)(e=>e?this._getCustomResourcesSource():[]),(0,c.map)(e=>[...this._resourceSources??[],...e]))}static{this.\u0275fac=function(t){return new(t||st)(r.\u0275\u0275inject(mc),r.\u0275\u0275inject(fc,8),r.\u0275\u0275inject(sr))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac})}}const rd=new r.InjectionToken("NestedTranslateLoader");class wt{constructor(e){this._optionsProvider=e}_fetchTranslation(e){return fetch(e,{cache:"no-cache"}).then(t=>{if(!t.ok&&t.status!==304)throw new Error(`Loading translations failed: ${e} (${t.status})`);return t.json()})}_handleFetchResults(e){for(const n of e.filter(i=>i.status==="rejected"))console.error(n.reason);const t=e.filter(n=>n.status==="fulfilled").map(n=>n.value||{});return(0,v.merge)({},...t)}getTranslation(e){return this._optionsProvider.getResourceOptions().pipe((0,c.switchMap)(t=>{const n=t.map(({prefix:i,suffix:a})=>this._fetchTranslation(`${i}${e}${a}`));return(0,c.from)(Promise.allSettled(n)).pipe((0,c.map)(i=>this._handleFetchResults(i)))}))}static{this.\u0275fac=function(t){return new(t||wt)(r.\u0275\u0275inject(st))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:wt,factory:wt.\u0275fac})}}class mi{static _getResourceSourcesProviders(e){const{resourceSources:t,customResourceSources:n}=e??{},i=(n??[]).map(a=>({...a,provide:fc,multi:!0}));return[{provide:mc,useValue:t},...i]}static forRoot(e){const t=A.TranslateModule.forRoot({...e,loader:{provide:A.TranslateLoader,useClass:wt}});return t.providers.push(st,...this._getResourceSourcesProviders(e)),t}static forNested(e){const t=A.TranslateModule.forRoot(e);return t.providers.push({provide:rd,useClass:wt},st,...this._getResourceSourcesProviders(e)),t}static with(e){return{ngModule:mi,providers:[wt,st,...this._getResourceSourcesProviders(e)]}}static{this.\u0275fac=function(t){return new(t||mi)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:mi})}static{this.\u0275inj=r.\u0275\u0275defineInjector({})}}var rr=y(29957);class ad{constructor(e,t,n){this.entitySchemaName=e,this.entityId=t,this.duplicates=n}}var Ae=y(32667),B=y(37851);class Ue{constructor(e,t){this.el=e,this.render=t}set dataItemMarker(e){this.render.setAttribute(this.el.nativeElement,"data-item-marker",e)}static{this.\u0275fac=function(t){return new(t||Ue)(r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(r.Renderer2))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:Ue,selectors:[["","tsDataItemMarker",""]],inputs:{dataItemMarker:[0,"tsDataItemMarker","dataItemMarker"]}})}}const od=["*",[["mat-icon"]]],cd=["*","mat-icon"];function ld(s,e){s&1&&(r.\u0275\u0275elementStart(0,"div",7),r.\u0275\u0275projection(1,1),r.\u0275\u0275elementEnd())}function ud(s,e){s&1&&r.\u0275\u0275element(0,"mat-icon",8)}class ln{set backgroundImageName(e){this._backgroundImageName=e}get backgroundImageName(){return this._backgroundImageName}constructor(e){this._directionality=e,this.isRtl=!1,this.hasCustomIcon=!1,this.widgetHeaderClick=new r.EventEmitter,this._initializeDirectionality()}_initializeDirectionality(){this.isRtl=this._directionality.value==="rtl"}onClickHandler(){this.widgetHeaderClick.emit()}static{this.\u0275fac=function(t){return new(t||ln)(r.\u0275\u0275directiveInject(Ae.Directionality))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:ln,selectors:[["crt-card-widget-header"]],hostVars:2,hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("click",function(){return n.onClickHandler()}),t&2&&r.\u0275\u0275classProp("rtl",n.isRtl)},inputs:{isRtl:"isRtl",caption:"caption",hasCustomIcon:"hasCustomIcon",backgroundImageName:"backgroundImageName"},outputs:{widgetHeaderClick:"widgetHeaderClick"},ngContentSelectors:cd,decls:9,vars:4,consts:[[1,"card-widget-header"],[1,"card-widget-header-text"],[1,"card-widget-header-text-caption"],[3,"tsDataItemMarker"],[1,"card-widget-header-text-content"],["class","custom-icon-container",4,"ngIf"],["class","card-widget-header-arrow","svgIcon","widget-header-arrow",4,"ngIf"],[1,"custom-icon-container"],["svgIcon","widget-header-arrow",1,"card-widget-header-arrow"]],template:function(t,n){t&1&&(r.\u0275\u0275projectionDef(od),r.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),r.\u0275\u0275text(4),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(5,"div",4),r.\u0275\u0275projection(6),r.\u0275\u0275elementEnd()(),r.\u0275\u0275template(7,ld,2,0,"div",5)(8,ud,1,0,"mat-icon",6),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275advance(3),r.\u0275\u0275property("tsDataItemMarker","card-widget-header-text-caption"),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",n.caption," "),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",n.hasCustomIcon),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.hasCustomIcon))},dependencies:[w.NgIf,B.MatIcon,Ue],styles:[`crt-card-widget-header{position:relative;display:block}crt-card-widget-header.rtl .card-widget-header-arrow{transform:rotate(180deg)}.card-widget-header{padding:16px 16px 12px;min-height:60px;width:100%;display:flex;flex-direction:row;align-items:center;cursor:pointer;background-size:cover}.card-widget-header .card-widget-header-text{width:calc(100% - 26px)}.card-widget-header .card-widget-header-text .card-widget-header-text-caption{font-size:14px;line-height:18px;letter-spacing:1.5px;color:#fff;text-transform:uppercase;font-family:Montserrat,serif;font-weight:700;overflow:hidden;flex-wrap:wrap}.card-widget-header .card-widget-header-text .card-widget-header-text-caption label{cursor:pointer}.card-widget-header .card-widget-header-text .card-widget-header-text-content{cursor:pointer;display:flex;flex-direction:row;font-size:12px;line-height:16px;color:#fff;flex-wrap:wrap;opacity:.8}.card-widget-header .card-widget-header-text .card-widget-header-text-content *{cursor:pointer}.card-widget-header .card-widget-header-arrow{width:26px;height:26px}
`],encapsulation:2,changeDetection:0})}}class un{set duplicates(e){this._duplicates=e,this.updateContentText()}get duplicates(){return this._duplicates}set isLoading(e){this._isLoading=e,this.updateContentText()}get isLoading(){return this._isLoading}constructor(e){this._translateService=e,this._isLoading=!1,this._emptyContentCaption="",this._foundDuplicatesContentCaption="",this._processingDuplicatesContentCaption="",this.content="",this.backgroundImageName="duplicates-background-image",this.isHoverEnabled=!1,this.widgetClick=new r.EventEmitter}updateContentText(){this.isLoading?this.content=this._processingDuplicatesContentCaption:this.duplicates&&this.duplicates.length?this.content=rr.String.Format(this._foundDuplicatesContentCaption,this.duplicates.length):this.content=this._emptyContentCaption,this.isHoverEnabled=!this.isLoading&&this.duplicates&&this.duplicates.length>0}ngOnInit(){this._emptyContentCaption=this._translateService.instant("DuplicatesWidgetContent.Empty"),this._foundDuplicatesContentCaption=this._translateService.instant("DuplicatesWidgetContent.FoundDuplicates"),this.caption=this._translateService.instant("DuplicatesWidgetContent.Caption"),this._processingDuplicatesContentCaption=this._translateService.instant("DuplicatesWidgetContent.ProcessingDuplicates"),this.updateContentText()}widgetHeaderClick(){this.widgetClick.emit(new ad(this.entitySchemaName,this.entityId,this.duplicates))}static{this.\u0275fac=function(t){return new(t||un)(r.\u0275\u0275directiveInject(A.TranslateService))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:un,selectors:[["crt-duplicates-widget"]],inputs:{entitySchemaName:"entitySchemaName",entityId:"entityId",duplicates:"duplicates",isLoading:"isLoading"},outputs:{widgetClick:"widgetClick"},decls:5,vars:8,consts:[[1,"duplicates-widget-container"],[3,"widgetHeaderClick","hasCustomIcon","caption","backgroundImageName"],[3,"tsDataItemMarker"],["svgIcon","spinner",1,"spinner",3,"tsDataItemMarker"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0)(1,"crt-card-widget-header",1),r.\u0275\u0275listener("widgetHeaderClick",function(){return n.widgetHeaderClick()}),r.\u0275\u0275elementStart(2,"label",2),r.\u0275\u0275text(3),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(4,"mat-icon",3),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275styleProp("pointer-events",n.isHoverEnabled?"auto":"none"),r.\u0275\u0275advance(),r.\u0275\u0275property("hasCustomIcon",n.isLoading)("caption",n.caption)("backgroundImageName",n.backgroundImageName),r.\u0275\u0275advance(),r.\u0275\u0275property("tsDataItemMarker","duplicates-widget-caption"),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",n.content," "),r.\u0275\u0275advance(),r.\u0275\u0275property("tsDataItemMarker","duplicates-widget-spinner"))},dependencies:[ln,B.MatIcon,Ue],styles:[`.duplicates-widget-container .card-widget-header{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjk4IiBoZWlnaHQ9IjYwIiB2aWV3Qm94PSIwIDAgMjk4IDYwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDp1cmwoI2EpO30uYntmaWxsOnVybCgjYik7fS5je29wYWNpdHk6MC41NTtjbGlwLXBhdGg6dXJsKCNjKTt9LmQsLmUsLmd7ZmlsbDpub25lO30uZHtzdHJva2U6I2ZmZjtzdHJva2Utd2lkdGg6MzRweDt9LmQsLmV7b3BhY2l0eTowLjA2O30uZiwuaHtzdHJva2U6bm9uZTt9Lmh7ZmlsbDojZmZmO308L3N0eWxlPjxyYWRpYWxHcmFkaWVudCBpZD0iYSIgY3g9IjAiIGN5PSIxLjA0MSIgcj0iMS40OTIiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuNjU0IDAuNDEzKSByb3RhdGUoLTQ5LjM2KSIgZ3JhZGllbnRVbml0cz0ib2JqZWN0Qm91bmRpbmdCb3giPjxzdG9wIG9mZnNldD0iMCIgc3RvcC1jb2xvcj0iIzA5ZiIvPjxzdG9wIG9mZnNldD0iMC41ODQiIHN0b3AtY29sb3I9IiNhMDMzZmYiLz48c3RvcCBvZmZzZXQ9IjAuODk0IiBzdG9wLWNvbG9yPSIjZmY1MjgwIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjZmY3MDYxIi8+PC9yYWRpYWxHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImIiIHgxPSIwLjUiIHgyPSIwLjUiIHkyPSIxIiBncmFkaWVudFVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMjg0NTc4Ii8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMTQyMzNjIi8+PC9saW5lYXJHcmFkaWVudD48Y2xpcFBhdGggaWQ9ImMiPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMjk4IiBoZWlnaHQ9IjYwIiByeD0iMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCkiLz48L2NsaXBQYXRoPjwvZGVmcz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjI5OCIgaGVpZ2h0PSI2MCIgcng9IjMiLz48ZyBjbGFzcz0iYyI+PGcgY2xhc3M9ImQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE5MCAtMTUyKSI+PHJlY3QgY2xhc3M9ImYiIHdpZHRoPSIzNzYiIGhlaWdodD0iMzU3Ii8+PHJlY3QgY2xhc3M9ImciIHg9IjE3IiB5PSIxNyIgd2lkdGg9IjM0MiIgaGVpZ2h0PSIzMjMiLz48L2c+PGcgY2xhc3M9ImQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI0IC02NCkiPjxlbGxpcHNlIGNsYXNzPSJmIiBjeD0iMTA0IiBjeT0iMTAxIiByeD0iMTA0IiByeT0iMTAxIi8+PGVsbGlwc2UgY2xhc3M9ImciIGN4PSIxMDQiIGN5PSIxMDEiIHJ4PSI4NyIgcnk9Ijg0Ii8+PC9nPjxnIGNsYXNzPSJlIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxOTYuMzA4IC04Ny45OTgpIHJvdGF0ZSg5MCkiPjxwYXRoIGNsYXNzPSJmIiBkPSJNMTI3LjE1MiwwLDI1NC4zLDI3MC43ODlIMFoiLz48cGF0aCBjbGFzcz0iaCIgZD0iTSAxMjcuMTUyMDkxOTc5OTgwNSA3OS45OTMxNjQwNjI1IEwgNTMuNTI2ODU1NDY4NzUgMjM2Ljc4ODU1ODk1OTk2MDkgTCAyMDAuNzc3MjgyNzE0ODQzOCAyMzYuNzg4NTU4OTU5OTYwOSBMIDEyNy4xNTIwOTE5Nzk5ODA1IDc5Ljk5MzE2NDA2MjUgTSAxMjcuMTUyMDk5NjA5Mzc1IDMuMDUxNzU3ODEyNWUtMDUgTCAyNTQuMzA0MTY4NzAxMTcxOSAyNzAuNzg4NTQzNzAxMTcxOSBMIC0zLjA1MTc1NzgxMjVlLTA1IDI3MC43ODg1NDM3MDExNzE5IEwgMTI3LjE1MjA5OTYwOTM3NSAzLjA1MTc1NzgxMjVlLTA1IFoiLz48L2c+PC9nPjwvc3ZnPg==);background-position:center;background-repeat:no-repeat;background-color:transparent;height:60px;max-width:300px}
`],encapsulation:2,changeDetection:0})}}class ge{static{this.\u0275fac=function(t){return new(t||ge)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:ge})}static{this.\u0275inj=r.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(ge,{declarations:[Ue],exports:[Ue]})})();var _e=y(44635),rt=y(10821),It=y(16441);const ba="crtInput:",Ca="crtOutput:",gc="crtValidationInput:",b_="crtInject:",_c="module",yc="viewElement",bc="mobileViewElement",Sa="interfaceDesignerItem",va="mobileInterfaceDesignerItem",Cc="requestHandler",Sc="designTimeViewElement",vc="validator",Mc="converter";function dd(s,e){Reflect.defineMetadata(_c,s,e)}function hd(s){const e=Reflect.getMetadata(_c,s);if(!e)throw new Error(`Module metadata was not found on '${s.name}' class`);return e}function pd(s,e){Reflect.defineMetadata(yc,s,e)}function md(s,e){Reflect.defineMetadata(bc,s,e)}function C_(s){return Reflect.getMetadata(yc,s)}function S_(s){return Reflect.getMetadata(bc,s)}function v_(s,e){Reflect.defineMetadata(vc,s,e)}function M_(s){const e=Reflect.getOwnMetadata(vc,s);if(!e)throw new Error(`Validator metadata was not found on '${s.name}' class`);return e}function w_(s,e){Reflect.defineMetadata(Mc,s,e)}function I_(s){const e=Reflect.getOwnMetadata(Mc,s);if(!e)throw new Error(`Converter metadata was not found on '${s.name}' class`);return e}function fd(s,e){Reflect.defineMetadata(Sa,s,e)}function gd(s,e){Reflect.defineMetadata(va,s,e)}function E_(s){return Reflect.getOwnMetadata(Sa,s)}function A_(s){return Reflect.getOwnMetadata(va,s)}function x_(s,e){Reflect.defineMetadata(Sc,s,e)}function R_(s){const e=Reflect.getOwnMetadata(Sc,s);if(!e)throw new Error(`Design time view element metadata was not found on '${s.name}' class`);return e}function T_(s){return Reflect.hasOwnMetadata(Sa,s)}function P_(s){return Reflect.hasOwnMetadata(va,s)}function N_(s,e){Reflect.defineMetadata(Cc,s,e)}function D_(s){const e=Reflect.getMetadata(Cc,s);if(!e)throw new Error(`Request handler metadata was not found on '${s.name}' class`);return e}function V_(s){const e=Reflect.getMetadata("requestType",s);if(!e)throw new Error(`requestType was not found on '${s.name}' class`);return{requestType:e,typeRef:s}}function _d(s){const t=Reflect.getMetadataKeys(s).filter(n=>n.startsWith(ba));return Object.fromEntries(t.map(n=>{const i=Reflect.getMetadata(n,s);return[n.replace(ba,""),i]}))}function yd(s){const t=Reflect.getMetadataKeys(s).filter(n=>n.startsWith(Ca));return Object.fromEntries(t.map(n=>{const i=Reflect.getMetadata(n,s);return[n.replace(Ca,""),i]}))}function bd(s){const t=Reflect.getMetadataKeys(s).filter(n=>n.startsWith(gc));return Object.fromEntries(t.map(n=>{const i=Reflect.getMetadata(n,s);return[n.replace(gc,""),i]}))}function Cd(s){const t=Reflect.getOwnMetadataKeys(s).filter(n=>n.startsWith(crtInjectPrefix));return Object.fromEntries(t.map(n=>{const i=Number(n.replace(crtInjectPrefix,"")),a=Reflect.getMetadata(n,s);return[i,a]}))}function Sd(s){const e=s.prototype?Object.getPrototypeOf(s.prototype):null;return e?e.constructor:null}function vd(s){const e=Reflect.getOwnMetadata("design:paramtypes",s);if(!e){if(s.length>0)throw new Error(`Dependency Injection error. Cannot read dependencies of class '${s.name}'. Please make sure class '${s.name}' has decorator and 'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.`);const n=Sd(s);return n&&n!==Object?vd(n):[]}const t=Cd(s);return Object.entries(t).forEach(([n,i])=>e[n]=i),e}function wc(s){return e=>dd(s,e)}var Ma=y(78927);class Et{constructor(){this._directionality=(0,r.inject)(Ae.Directionality),this.loadingText="SkeletonLoader.Loading",this.documentDirection=this._directionality?.value,this.animation="progress",this.appearance="line",this.count=1,this.styles={}}set ariaLabel(e){this.loadingText=e??this.loadingText}ngOnInit(){this.documentDirection=this._directionality?.value==="rtl"?"rtl":null}static{this.\u0275fac=function(t){return new(t||Et)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Et,selectors:[["crt-skeleton-loader"]],inputs:{animation:"animation",appearance:"appearance",count:"count",styles:"styles",ariaLabel:"ariaLabel"},decls:3,vars:14,consts:[[1,"crt-skeleton-loader",3,"theme","appearance","count","ariaLabel","loadingText","animation"]],template:function(t,n){t&1&&(r.\u0275\u0275element(0,"ngx-skeleton-loader",0),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275pipe(2,"translate")),t&2&&(r.\u0275\u0275styleProp("width",n.styles==null?null:n.styles.width),r.\u0275\u0275property("theme",n.styles)("appearance",n.appearance)("count",n.count)("ariaLabel",r.\u0275\u0275pipeBind1(1,10,n.loadingText))("loadingText",r.\u0275\u0275pipeBind1(2,12,n.loadingText))("animation",n.animation),r.\u0275\u0275attribute("appearance",n.appearance)("dir",n.documentDirection))},dependencies:[Ma.NgxSkeletonLoaderComponent,A.TranslatePipe],styles:["[_nghost-%COMP%]{overflow:hidden;display:flex;width:100%}[_nghost-%COMP%]   .crt-skeleton-loader[_ngcontent-%COMP%]{display:block;min-width:0;flex:auto;width:200px}[_nghost-%COMP%]   .crt-skeleton-loader[appearance=circle][_ngcontent-%COMP%]{width:50px}"]})}}const Md="crt-web-element-skeleton-loader";class wd{static init(e){const{injector:t,tag:n,component:i}=e;if(customElements.get(n))return;const a=(0,ac.createCustomElement)(i,{injector:t});customElements.define(n,a)}}class dn{constructor(e){this.injector=e;const t={injector:this.injector,tag:Md,component:Et};wd.init(t)}static{this.\u0275fac=function(t){return new(t||dn)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:dn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[Ma.NgxSkeletonLoaderModule,A.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(dn,{declarations:[Et],imports:[Ma.NgxSkeletonLoaderModule,A.TranslateModule],exports:[Et]})})();var ar=y(49489);function Id(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"ng-lottie",1),r.\u0275\u0275listener("animationCreated",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(a.onAnimationCreated(i))})("click",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(i.onClick())}),r.\u0275\u0275elementEnd()}if(s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("options",t.options)("width",t.width)("height",t.height)}}class hn{set config(e){this._setConfig(e).then()}constructor(e,t){this._changeDetectorRef=e,this._ngZone=t,this.options=null,this.width="100px",this.height="100px"}_setConfig(e){var t=this;return(0,b.A)(function*(){const n=yield e.animationData();t.options={animationData:n,loop:e.loop,autoplay:e.autoplay},t._changeDetectorRef.markForCheck()})()}onAnimationCreated(e){this._animationItem=e}onClick(){this._ngZone.runOutsideAngular(()=>{this._animationItem.stop(),this._animationItem.play()})}static{this.\u0275fac=function(t){return new(t||hn)(r.\u0275\u0275directiveInject(r.ChangeDetectorRef),r.\u0275\u0275directiveInject(r.NgZone))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:hn,selectors:[["crt-lottie"]],inputs:{width:"width",height:"height",config:"config"},decls:1,vars:1,consts:[["class","lottie-animation",3,"options","width","height","animationCreated","click",4,"ngIf"],[1,"lottie-animation",3,"animationCreated","click","options","width","height"]],template:function(t,n){t&1&&r.\u0275\u0275template(0,Id,1,3,"ng-lottie",0),t&2&&r.\u0275\u0275property("ngIf",n.options)},dependencies:[w.NgIf,ar.LottieComponent],styles:[".lottie-animation[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})}}class pn{static{this.\u0275fac=function(t){return new(t||pn)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:pn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[(0,ar.provideLottieOptions)({player:()=>y.e(9730).then(y.t.bind(y,89730,23))})],imports:[w.CommonModule,ar.LottieComponent]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(pn,{declarations:[hn],imports:[w.CommonModule,ar.LottieComponent],exports:[hn]})})();class At{constructor(e,t){this._domSanitizer=e,this._matIconRegistry=t}_register(e,t,n){const i=this._domSanitizer.bypassSecurityTrustHtml(t);n?this._matIconRegistry.addSvgIconLiteralInNamespace(n,e,i):this._matIconRegistry.addSvgIconLiteral(e,i)}addIcons(e,t){if(e){if(Array.isArray(e)){e.forEach(({name:n,icon:i})=>this._register(n,i,t));return}Object.entries(e).forEach(([n,i])=>this._register(n,i,t))}}static{this.\u0275fac=function(t){return new(t||At)(r.\u0275\u0275inject(ne.DomSanitizer),r.\u0275\u0275inject(B.MatIconRegistry))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac,providedIn:"root"})}}var Ed=y(26828),Ad=y.n(Ed);const xd="crt-resize",Rd=new r.InjectionToken("Represents the resize observer",{factory:()=>new(Ad())(s=>{window.requestAnimationFrame(()=>{s.forEach(e=>{const t={width:e.target?.clientWidth||e.contentRect.width,height:e.target?.clientHeight||e.contentRect.height};e.target.dispatchEvent(new CustomEvent(xd,{detail:t}))})})}),providedIn:"root"});class or{set crtResizableDisabled(e){this._resizeDisabled$.next(e)}get resized(){const e=this._resized.asObservable().pipe((0,u.filter)(a=>this._isElementSizeValid(a))),t=new c.BehaviorSubject(null),n=t.pipe((0,u.switchMap)(()=>e.pipe((0,u.take)(1)))),i=e.pipe((0,u.debounce)(()=>(0,c.timer)(this.delay)),(0,u.tap)(()=>t.next()));return(0,c.merge)(n,i).pipe((0,u.distinctUntilChanged)((a,o)=>this._isElementSizesEqual(a,o)))}constructor(e,t){this.elementRef=e,this._resizeObserver=t,this._resized=new r.EventEmitter,this._destroyed$=new c.Subject,this._resizeDisabled$=new c.BehaviorSubject(!1),this.delay=200}_isElementSizeValid(e){return e&&e.width>0&&e.height>0}_isElementSizesEqual(e,t){return e.width===t.width&&e.height===t.height}ngOnInit(){this._nativeElement=this.elementRef?.nativeElement,this._nativeElement&&this._resizeDisabled$.pipe((0,u.distinctUntilChanged)(),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>{e?this._resizeObserver.unobserve(this._nativeElement):this._resizeObserver.observe(this._nativeElement)})}onResized(e){this._resizeDisabled$.value||this._resized.emit(e?.detail)}ngOnDestroy(){this._nativeElement&&this._resizeObserver.unobserve(this._nativeElement),this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||or)(r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(Rd))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:or,selectors:[["","crtResizable",""]],hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("crt-resize",function(a){return n.onResized(a)})},inputs:{delay:"delay",crtResizableDisabled:"crtResizableDisabled"},outputs:{resized:"resized"},standalone:!0})}}const Td={macrosName:"ResourceString",macrosHandler:function(s,e){if(!s)throw new Error("Context is not defined");if(!s.Resources?.Strings)throw new Error("Context does not contain property Resources.Strings");const t=s.Resources.Strings[e[0]];return t instanceof Promise?(0,c.from)(t):(0,c.of)(t)}};function Pd(s){return{macrosName:"ResourceString",macrosHandler:function(e,t){if(e?.strings){for(const n of t){const i=e.strings[n];if(i)return(0,c.of)(s.findLocalizableValue(i))}throw new Error(`Localized resource string not found. ${t}`)}if(e?.Strings){for(const n of t){const i=e.Strings[n];if(i)return(0,c.from)(i)}throw new Error(`Localized string in ViewModel metadata not found. ${t}`)}return Td.macrosHandler(e,t)}}}function Nd(s=!1){return{macrosName:"DataSourceEntityName",macrosHandler:(e,t)=>{if(!e)throw new Error("Context is not defined");let n=t[0],i;if(s)e.constructor.name==="BaseViewModel"?i=e.dataSchemas?.[n]?.dataSourceConfig?.config?.entitySchemaName:i=e.modelConfig?.dataSources?.[n]?.config?.entitySchemaName;else{n||(n=e.modelConfig.primaryDataSourceName);const a=e.modelConfig.dataSources?.[n];if(!a)throw new Error(`DataSource '${n}' is not defined`);i=a.config.entitySchemaName}return(0,c.of)(i)}}}function Dd(s,e=!1){return{macrosName:"MacrosTemplateString",macrosHandler:(t,n)=>{const i=n.join(", "),a=/\[#([^\]]*)#\]/.test(i);return e||!a?(0,c.of)(i):s.getTemplate(i)}}}const cr=new r.InjectionToken("MACROS_HANDLER");function Ic(s){return s===null||typeof s!="object"?[]:Object.keys(s).filter(e=>s[e]instanceof Object).map(e=>Ic(s[e]).map(t=>[e,...t])).reduce((e,t)=>[...e,...t],Object.keys(s).map(e=>[e]))}function Ec(s,e){return Object.keys(s).every(t=>Object.prototype.hasOwnProperty.call(e,t)?typeof s[t]=="object"?Vd(s[t],e[t]):!0:!1)}function Vd(s,e){return Ec(s,e)&&Ec(e,s)}function Od(s,e){const t=Array.isArray(e)?e:e.split(".");let n=s;for(const i of t)if(n instanceof Map)n=n.get(i);else if(n&&typeof n=="object")n=n[i];else return;return n}function O_(s){const e=JSON.stringify(s);let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);return t.toString(16)}class ye{static create(e){const t=new ye;return Object.assign(t,e),t}get isDebugEnabled(){return!!window.Terrasoft?.isDebug}static{this.\u0275fac=function(t){return new(t||ye)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac,providedIn:"root"})}}class mn{constructor(e,t,n){this.handlers=e,this._featureValues=t,this._applicationInfo=n}get _includeProcessedHandlers(){return!!this._featureValues?.IncludeProcessedMacrosHandlers}_findClosingBracket(e,t){let n=t,i=1;for(;i>0&&n<e.length;){const a=e[++n];a==="("?i++:a===")"&&i--}return n}_getMacroses(e){const t=new Array;let n=e.indexOf("#");for(;n>=0;){const i=e.indexOf("(",n);if(i<0)return t;const a=this._findClosingBracket(e,i),o=e.indexOf("#",a);if(o<0)return t;t.push({macrosName:e.substring(n+1,i),macrosArgs:e.substring(i+1,a),macrosBody:e.substring(n,o+1)}),n=e.indexOf("#",o+1)}return t}_processMacroses({macroses:e,macrosNameFilter:t,context:n,options:i,value:a}){let o={...a};const l=d=>!!(t&&t!==d&&t.split(",").indexOf(d)===-1);return(0,c.forkJoin)({...e.map(({macrosName:d,macrosArgs:h,macrosBody:p})=>{if(l(d))return(0,c.of)(null);const g=this.getHandler(d);return g?this.internalHandle(h,n,t,i).pipe((0,u.switchMap)(C=>{const E=g(n,`${C.value}`.split(",").map(T=>T.trim()));return(E instanceof c.Observable?E:(0,c.of)(E)).pipe((0,u.catchError)(T=>(this._applicationInfo.isDebugEnabled&&console.warn(T),(0,c.of)(p))),(0,u.tap)(T=>{const R=typeof T=="number"?T:T||"";o={isChanged:!0,value:o.value.replace(p,R)}}))}),(0,u.catchError)(C=>(i&&i.errorHandler?i.errorHandler(C):this._applicationInfo.isDebugEnabled&&console.warn(C),(0,c.of)(p)))):(0,c.of)(null)}),default:(0,c.of)(null)}).pipe((0,u.map)(()=>o))}_forEachStringInObject(e,t,n=[],i=[]){if(!(e instanceof Object))return;const a=l=>!n.includes(l),o=(l,d)=>{typeof l=="string"?t(i.concat(d),l):typeof l=="object"&&l!==null&&(i.push(d),this._forEachStringInObject(l,t,n,i),i.pop())};if(e instanceof Map)for(const l of Array.from(e.keys()).filter(a))o(e.get(l),l);else Object.keys(e).filter(a).forEach(l=>{o(e[l],l)})}_set(e,t,n){const i=t.slice(),a=i.pop(),o=i.length===0?e:Od(e,i);o&&(o[a]=n)}getHandler(e){return this.handlers.filter(t=>t.macrosName===e).pop()?.macrosHandler}internalHandle(e,t,n,i){const a={value:e,isChanged:!1};return(0,c.of)(a).pipe((0,u.switchMap)(l=>{if(typeof e!="string")return(0,c.of)(l);const d=this._getMacroses(e);return d.length?this._processMacroses({macroses:d,macrosNameFilter:n,context:t,options:i,value:a}):(0,c.of)(l)}))}handle(e,t){const n=(0,v.cloneDeep)(e);return(0,c.forkJoin)([...Ic(n).map(i=>{const a=(0,v.get)(n,i);return this.internalHandle(a,t).pipe((0,u.tap)(({value:o})=>{(0,v.set)(n,i,o)}))}),(0,c.of)(null)]).pipe((0,u.map)(()=>n))}handleMarcos(...e){return this.handleMacros.call(this,...e)}handleResourceMacros(e,t,n){return this.handleMacros("MacrosTemplateString,ResourceString",(0,v.cloneDeep)(e),t,n)}handleMacros(e,t,n,i){const a=[(0,c.of)(null)];return this._forEachStringInObject(t,(o,l)=>{const d=this._getMacroses(l);if(!d.length)return;const h=this._processMacroses({macroses:d,context:n,options:i,macrosNameFilter:e,value:{isChanged:!1,value:l}}).pipe((0,u.tap)(p=>{p.isChanged!==!1&&(i?.setPropertyFn?i.setPropertyFn({source:t,keys:o,value:p.value}):this._set(t,o,p.value))}));a.push(h)},this._includeProcessedHandlers?[]:["__preprocessed"]),(0,c.forkJoin)(a).pipe((0,u.map)(()=>t))}static{this.\u0275fac=function(t){return new(t||mn)(r.\u0275\u0275inject(cr),r.\u0275\u0275inject(W,8),r.\u0275\u0275inject(ye))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:mn,factory:mn.\u0275fac})}}var fn;(function(s){s.string="Strings",s.image="Images"})(fn||(fn={}));const fi="Resources";class gn extends Array{constructor(e){super(),Object.setPrototypeOf(this,Object.create(gn.prototype)),Array.isArray(e)&&this._fillFromSource(e)}_fillFromSource(e){e.filter(t=>t?.cultureName!=null).forEach(t=>{this.setValueLocalizableString(t.cultureName,t.value)})}getValue(e){const t=this.getLocalizableString(e);return t?t.value:""}hasCultureValue(e,t=!1){const n=this.getLocalizableString(e);return t?(n?.value||null)!=null:n?.value!=null}getLocalizableString(e){return this.find(t=>t.cultureName===e)||null}setValueLocalizableString(e,t){const n=this.getLocalizableString(e);return n?n.value=t:this.push({cultureName:e,value:t}),this}setValues(e,t=!1){return e.forEach(n=>{this.hasCultureValue(n.cultureName)&&t||this.setValueLocalizableString(n.cultureName,n.value)}),this}clone(){return new gn(this)}}const Bd="user-info-cache",kd="currentUserInfo",Ac="application-info-cache",Ld="applicationInfo",Fd="A5420246-0A8E-E111-84A3-00155D054C03",xc="en-US";class lr{constructor(e){Object.assign(this,e)}static getDefaultCulture(){return new lr({sysCultureId:Fd,sysCultureName:xc,decimalSeparator:".",thousandSeparator:","})}}class ur{constructor(){const e=this.constructor;if((0,r.inject)(e,r.InjectFlags.Optional|r.InjectFlags.SkipSelf))throw Error(`[${e.name}]: trying to create multiple instances,
			but this service should be a singleton.`)}}class _n{constructor(){this.cultureInfo=new lr,this.defCultureInfo=new lr}}const pe="Information about the current user is not initialized yet. Use UserInfoService to load current user information.";function jd(){return{get id(){throw new ReferenceError(pe)},get contactId(){throw new ReferenceError(pe)},get contactName(){throw new ReferenceError(pe)},get accountId(){throw new ReferenceError(pe)},get accountName(){throw new ReferenceError(pe)},get isSSP(){throw new ReferenceError(pe)},get timeZoneId(){throw new ReferenceError(pe)},get cultureInfo(){throw new ReferenceError(pe)},get defCultureInfo(){throw new ReferenceError(pe)},get timeZoneOffsetHours(){throw new ReferenceError(pe)},get photoId(){throw new ReferenceError(pe)},get accessType(){throw new ReferenceError(pe)},get sessionId(){throw new ReferenceError(pe)}}}const le=jd(),Rc={get id(){return le.id},get contactId(){return le.contactId},get contactName(){return le.contactName},get accountId(){return le.accountId},get accountName(){return le.accountName},get isSSP(){return le.isSSP},get timeZoneId(){return le.timeZoneId},get cultureInfo(){return le.cultureInfo},get defCultureInfo(){return le.defCultureInfo},get timeZoneOffsetHours(){return le.timeZoneOffsetHours},get photoId(){return le.photoId},get accessType(){return le.accessType},get sessionId(){return le.sessionId}};Object.freeze(Rc);const $d={provide:_n,useFactory:()=>Rc};class gi extends ur{constructor(e,t,n){super(),this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._serviceEndpoint="/ServiceModel/UserInfoService.svc"}_applyUserInfo(e){Object.keys(le).forEach(t=>{delete le[t]}),Object.assign(le,e)}loadCurrentUserInfo(){if(!this._userInfo$){const e=`${this._serviceEndpoint}/GetCurrentUserInfo`;this._userInfo$=this._cacheManager.executeWithCache(Bd,kd,this._httpClient.post(e,null)).pipe(this._measurePerformanceService.measure$("UserInfoService: load current user info with cache"),(0,c.tap)(t=>this._applyUserInfo(t?.userInfo)),(0,c.shareReplay)({bufferSize:1,refCount:!1}))}return this._userInfo$}static{this.\u0275fac=function(t){return new(t||gi)(r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(fe),r.\u0275\u0275inject(z))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:gi,factory:gi.\u0275fac,providedIn:"root"})}}class yn{constructor(e){this.userInfo=e,this._resourceMacrosRegExpPattern="(?<macrosBody>#ResourceString\\((?<macrosArgs>[^)]*)\\)#)",this._viewModelAttributeRegExpPattern=`\\$${fi}.${fn.string}.(?<macrosArgs>[\\S\\s]*)`,this._sysCultureName=this.userInfo.cultureInfo.sysCultureName,this._defCultureName=this.userInfo.defCultureInfo.sysCultureName}_getLczResource(e){const t={};return e.forEach(n=>t[n.cultureName]=n.value),t}_getResourceValueMatches(e){const t=new RegExp(this._resourceMacrosRegExpPattern,"g"),n=new RegExp(this._viewModelAttributeRegExpPattern,"g");let i=[...(e??"").matchAll(n)];return i.length||(i=[...(e??"").matchAll(t)]),i}_findStringPropertyResource(e,t){const{resourceName:n,useMacrosTemplate:i}=this.findResourcesName(e);if(n)return{path:t,resourceName:n,useMacrosTemplate:i}}_findArrayPropertyResources(e,t=""){return e.flatMap((n,i)=>this.findPropertyResources(n,t?`${t}.${i}`:`${i}`))}_findObjectPropertyResources(e,t=""){return Object.entries(e).flatMap(([n,i])=>this.findPropertyResources(i,t?`${t}.${n}`:n))}findLocalizableValue(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return null;let t;return Array.isArray(e)?t=e?.filter(n=>n.value).reduce((n,i)=>Object.assign(n,{[i.cultureName]:i.value}),{}):t=e,(t[this._sysCultureName]??t[this._defCultureName])?.toString()??null}findResourcesName(e){const n=this._getResourceValueMatches(e)[0]?.groups.macrosArgs,i=e?.startsWith("#MacrosTemplateString");return{resourceName:n,useMacrosTemplate:i}}findLocalizationFromResourceString(e,t,n=""){const{resourceName:i}=this.findResourcesName(e),a=i!==void 0&&t.strings[i];if(a){const d=Object.entries(a).map(([h,p])=>({cultureName:h,value:p}));return new gn(d)}const o=i===void 0&&e||n,l=this._sysCultureName||this._defCultureName;return new gn([{cultureName:l,value:o}])}findValueFromResource(e,t){const n=this.findLocalizationFromResourceString(e,t),i=this._getLczResource(n);return this.findLocalizableValue(i)}findViewModelResourceValue(e,t,n){var i=this;return(0,b.A)(function*(){const{resourceName:a}=i.findResourcesName(e);let o;return a&&(o=yield t.Strings[a]),o||n||e})()}findPropertyResources(e,t=""){return e?Array.isArray(e)?this._findArrayPropertyResources(e,t):typeof e=="object"?this._findObjectPropertyResources(e,t):typeof e=="string"?[this._findStringPropertyResource(e,t)].filter(Boolean):[]:[]}static{this.\u0275fac=function(t){return new(t||yn)(r.\u0275\u0275inject(_n))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:yn,factory:yn.\u0275fac,providedIn:"root"})}}class _i{constructor(e){this._httpClient=e,this._serviceEndpoint="rest/MacrosHelperService"}static isMacros(e){return typeof e!="string"?!1:e?.startsWith("#")??!1}getTemplate(e,t){return this.getTemplateByEntity({textTemplate:e},t)}getTemplateByEntity(e,t){const n=`${this._serviceEndpoint}/GetTemplate`;return this._httpClient.post(n,{request:e}).pipe((0,u.map)(i=>{const a=i?.GetTemplateResult;return a?.success?t?a.textTemplate:a.textTemplate.replace(/\s?<.+?>(.+?)<(.+?)\/?(.+?)>/g,""):e.textTemplate}))}getMultiLanguageTemplate(e,t,n){const i=`${this._serviceEndpoint}/GetMultiLanguageTextTemplate`;return this._httpClient.post(i,{request:{entityId:e,entityName:t,templateId:n}}).pipe((0,u.map)(a=>a?.GetMultiLanguageTextTemplateResult))}static{this.\u0275fac=function(t){return new(t||_i)(r.\u0275\u0275inject(O.HttpClient))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:_i,factory:_i.\u0275fac,providedIn:"root"})}}const xt=new r.InjectionToken("IS_DESIGN_TIME");class bn{static{this.\u0275fac=function(t){return new(t||bn)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:bn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[mn,{provide:cr,useFactory:Pd,deps:[yn],multi:!0},{provide:cr,useFactory:Nd,deps:[[new r.Optional,xt]],multi:!0},{provide:cr,useFactory:Dd,deps:[_i,[new r.Optional,xt]],multi:!0}],imports:[w.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(bn,{imports:[w.CommonModule]})})();class Cn{constructor(e,t){this.caption="",e.addSvgIconLiteral("placeholder",t.bypassSecurityTrustHtml(y(49967)))}static{this.\u0275fac=function(t){return new(t||Cn)(r.\u0275\u0275directiveInject(B.MatIconRegistry),r.\u0275\u0275directiveInject(ne.DomSanitizer))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Cn,selectors:[["crt-view-element-placeholder"]],inputs:{caption:"caption"},decls:4,vars:1,consts:[[1,"placeholder-container"],["svgIcon","placeholder",1,"icon"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275element(1,"mat-icon",1),r.\u0275\u0275elementStart(2,"span"),r.\u0275\u0275text(3),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate(n.caption))},dependencies:[B.MatIcon],styles:[".placeholder-container[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;align-content:center;justify-content:center;border-radius:8px;position:relative;overflow:hidden}.placeholder-container[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:100%;max-height:64px;width:72px;align-self:center}.placeholder-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;top:50%;left:8px;right:8px;transform:translateY(-50%);overflow:hidden;width:calc(100% - 16px);text-overflow:ellipsis}@supports (background: -webkit-named-image(i)){.placeholder-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:initial;height:initial}}"]})}}class at{static{this.\u0275fac=function(t){return new(t||at)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:at})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[w.CommonModule,B.MatIconModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(at,{declarations:[Cn],imports:[w.CommonModule,B.MatIconModule],exports:[Cn]})})();const Ud=new r.InjectionToken("A factory of expression interpreter");var Y;(function(s){s.ChangeAttributeValue="change-attribute-value",s.ModelDataLoaded="model-data-loaded-event",s.BeforeModelLoad="before-model-load",s.LoadDefaultValues="load-default-values",s.StartLoadModelAttributes="start-load-model-attributes",s.FinishLoadModelAttributes="finish-load-model-attributes",s.ViewEvent="view-event"})(Y||(Y={}));function yi(s,e){return wa.apply(this,arguments)}function wa(){return wa=(0,b.A)(function*(s,e){const t=typeof e=="string"?e.split("."):e;let n=t.shift(),i=s;for(;n;)i=yield i[n],n=t.shift();return i}),wa.apply(this,arguments)}const ze=Symbol("InternalViewModelInjector");var He=y(59247),k;(function(s){s.Add="add",s.Remove="remove",s.Move="move",s.Reload="reload"})(k||(k={}));class dr extends Error{constructor(e){super(`Argument with name '${e}' is out of range.`)}}var M;(function(s){s.Init="init",s.Create="create",s.Update="update",s.Copy="copy",s.Delete="delete",s.Unknown="unknown"})(M||(M={}));const hr=new r.InjectionToken("SCOPE_NAME"),zd=new r.InjectionToken("VIEW_EVENT_ZONE_NAME"),Hd=new r.InjectionToken("INJECTION_CONTEXT");class ve extends Array{constructor(...e){return super(),this._changed=new c.Subject,this._createdItems=[],this._deletedItems=[],this._itemsChanged=new c.Subject,this._itemAttributeChanged=new c.Subject,this._destroyed$=new c.Subject,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[],this._trackChanges=!0,this._isDestroyed=!1,typeof e[0]=="number"?new Array(e[0]):([this._viewModelGenerator,this._viewModelConfig={},this._model,this._host,this._hostAttributeName]=e,this._measurePerformanceService=this._host?.[ze]?.get(z,null,{optional:!0}),this._featureValues=this._host?.[ze]?.get(W,{},{optional:!0})??{},this._ngZone=this._host?.[ze]?.get(r.NgZone,null,{optional:!0}),Object.setPrototypeOf(this,Object.create(ve.prototype)),this._subscribeItemsModelModesChanges(),this._subscribeItemsAttributesChanges(),new Proxy(this,{set:(t,n,i,a)=>{const o=t[n];if(t[n]=i,this._trackChanges){const l=n==="length"&&i!==o,d=!isNaN(parseInt(n));(l||d)&&this._onItemsChanged()}return!0}}))}get changed(){return this._changed.asObservable().pipe(ku(this._ngZone),(0,u.takeUntil)(this._destroyed$))}get itemAttributeChanged(){return this._itemAttributeChanged.asObservable().pipe((0,u.takeUntil)(this._destroyed$))}get isChanged(){return this.getChangedItems().length>0}get formApiModel(){return this._formApiModel||this._updateFormApiModelValues({emitEvent:!1}),this._formApiModel}_isItemPrimaryAttributeEqual(e,t){return(0,b.A)(function*(){if(!e)return!1;const n=yield e[e.primaryAttributeName];return t.includes(n)})()}_getNewCallbacksMap(){return new Map([[k.Add,[]],[k.Remove,[]],[k.Move,[]],[k.Reload,[]]])}_insertItem(e,t){typeof t!="number"&&(t=this.length),t=Math.max(t,0),t=Math.min(t,this.length),this._triggerChangesAfter(()=>super.splice(t,0,e))}_generateItem(e){const t=()=>{const n=this._model?.createCollectionItemModel(M.Create),i=this._host?.[ze]?r.Injector.create({providers:[{provide:hr,useValue:null}],parent:this._host?.[ze]}):null,a={viewModelConfig:this._viewModelConfig,modelConfig:n?{primaryDataSourceName:n.name}:void 0,models:n?[n]:void 0,parentViewModel:this._host,businessRulesActive:e.businessRulesActive??!1},o=p=>{n?.name&&(p.dataSchemas[n.name]=this._host.dataSchemas[n.name])},l=p=>n?.name?p.create(n.name,e.initialModelValues).pipe((0,u.map)(()=>p)):(0,c.of)(p),d=p=>{Object.entries(e.initialAttributeValues??{}).forEach(([g,C])=>p[g]=C),p._markAsPristine(e.initialAttributeValues??{}),this._model?.childrenChange()},h=this._viewModelGenerator.generate(a,i).pipe((0,u.tap)(o),(0,u.switchMap)(l),(0,u.tap)(d));return(0,c.lastValueFrom)(h)};return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.generateItem",()=>t()):t()}_mergeItems(e,t){const n=()=>{const i=(e[0]||t[0])?.primaryAttributeName;for(const a of t){const o=e.findIndex(l=>{const d=l.attributes?.[i],h=a.attributes?.[i];return d&&d===h});o===-1?e.push(a):e.splice(o,1,a)}return e};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.mergeItems",()=>n()):n()}_triggerChangesAfter(e,t){this._trackChanges=!1;const n=e.call(this);return this._trackChanges=!0,this._isDestroyed||(this._onItemsChanged(),t&&this._executeChangesCallbacksWhenReady(t)),n}_executeChangesCallbacks(e){this._onCollectionChangeCallbacksMap.get(e.action).forEach(n=>{this._safeExecuteCallback(n,{...e,collection:[...this]},e.action)})}_executeChangesCallbacksWhenReady(e){Promise.resolve().then(()=>this._executeChangesCallbacks(e))}_onItemsChanged(){const e=this.map(t=>({item:t,itemModelMode:t?.getPrimaryModelMode?.()}));this._updateCollectionState(e,!0)}_subscribeItemsModelModesChanges(){this._itemsChanged.pipe((0,u.switchMap)(()=>this._getItemsModelModesChanges()),(0,u.tap)(e=>this._updateCollectionState([e],!1)),(0,u.takeUntil)(this._destroyed$)).subscribe()}_subscribeItemsAttributesChanges(){const e=t=>{this._onItemAttributesChangesCallbacks.forEach(n=>{try{n(t)}catch(i){console.error("An error occurred during execution of item attributes change callback:",i)}})};this._itemsChanged.pipe((0,u.switchMap)(()=>this._getItemsWithAttributesChanges()),(0,u.tap)(t=>e(t)),(0,u.tap)(()=>this._itemAttributeChanged.next()),(0,u.takeUntil)(this._destroyed$)).subscribe()}_getItemsWithAttributesChanges(){const e=t=>{const n=t.events$?.pipe((0,u.map)(i=>i.type===Y.ChangeAttributeValue&&!i.payload.silent));return t?.events$?n.pipe((0,u.map)(i=>i?t:null)):(0,c.of)(null)};return(0,c.merge)(...this.map(e)).pipe((0,u.filter)(Boolean))}_getItemsModelModesChanges(){const e=[...this,...this._deletedItems].map(t=>t?._getPrimaryModelModeChanges?.()?.pipe((0,u.map)(n=>({item:t,itemModelMode:n})))).filter(Boolean);return e.length?(0,c.merge)(...e):c.EMPTY}_updateCollectionState(e,t){this._trackChanges=!1;const n=e.map(i=>this._onItemModelModeChanged(i)).some(i=>!!i);this._trackChanges=!0,!(!t&&!n)&&(this._updateFormApiModelValues(),this._updateFormApiModelPristineState(),this._changed.next(),this._itemsChanged.next())}_onItemModelModeChanged(e){const{item:t,itemModelMode:n}=e;if(!t||n==null)return!1;switch(n){case M.Create:return this._onCreateItem(t);case M.Update:return this._onUpdateItem(t);case M.Delete:return this._onDeleteItem(t);default:return!1}}_onCreateItem(e){const t=this._deletedItems.indexOf(e);return t!==-1?(this._deletedItems.splice(t,1),!0):(this._createdItems.indexOf(e)===-1&&this._createdItems.push(e),!1)}_onUpdateItem(e){const t=this._createdItems.indexOf(e);if(t!==-1)return this._createdItems.splice(t,1),!1;const n=this._deletedItems.indexOf(e);if(n!==-1){const i=this._deletedItems.splice(n,1);super.push(...i)}return!0}_onDeleteItem(e){const t=this._createdItems.indexOf(e),n=this._deletedItems.indexOf(e);t!==-1?this._createdItems.splice(t,1):n===-1&&this._deletedItems.push(e);const i=this.indexOf(e);return i===-1?!1:(super.splice(i,1),this._executeChangesCallbacks({collection:[],affectedElements:[e],action:k.Remove,index:i}),!0)}_updateFormApiModelValues(e){if(this._featureValues.DisableBaseViewModelCollectionOptimization){this._formApiModel??=new He.FormArray([]),this._formApiModel.clear({emitEvent:!1}),this.filter(n=>n?.formApiModel).forEach(n=>{this._formApiModel.push(n.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity();return}if(!this._formApiModel||!this._formApiModel.length){const n=new He.FormArray(this.filter(i=>i?.formApiModel)?.map(i=>i.formApiModel));this._formApiModel||(this._formApiModel=n),this._formApiModel.length||this._host?.formApiModel?.setControl(this._hostAttributeName,n)}else this._formApiModel.clear({emitEvent:!1}),this.filter(n=>n?.formApiModel).forEach(n=>{this._formApiModel.push(n.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity()}_updateFormApiModelPristineState(){const e=this.formApiModel.pristine,t=this.some(n=>n?.formApiModel?.dirty);if(t&&e){this.formApiModel.markAsDirty();return}!t&&!e&&this.formApiModel.markAsPristine()}_reload(e){const t=()=>{for(const a of[...this._deletedItems,...this])this.removeChildModel(a,{triggerNotification:!1});this._model?.childrenChange();const n=[],i=a=>n.push(a.destroy());return this._createdItems.forEach(i),this._createdItems.splice(0,this._createdItems.length),this._deletedItems.forEach(i),this._deletedItems.splice(0,this._deletedItems.length),this.forEach(i),this.splice(0,this.length,...e),(0,c.forkJoin)(n).pipe((0,u.defaultIfEmpty)(void 0),(0,u.map)(()=>{}))};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.reload",()=>t()):t()}_unregisterCallbackByAction(e,t){if(!this._onCollectionChangeCallbacksMap.get(e).find(a=>a===t))return!1;const i=this._onCollectionChangeCallbacksMap.get(e).filter(a=>a!==t);return this._onCollectionChangeCallbacksMap.set(e,i),!0}_safeExecuteCallback(e,t,n){const i=()=>{try{e(t)}catch(a){console.error(`An error occurred during execution of collection ${n} callback:`,a)}};if(this._ngZone){this._ngZone.run(i);return}i()}registerOnCollectionChangeCallback(e,t){const n=this._onCollectionChangeCallbacksMap.get(t);if(t&&!n)throw new Error(`Action type ${t} is not supported. Please use one of: ${Object.values(k).join(", ")} or empty value for all actions`);if(t){const i=[...n,e];this._onCollectionChangeCallbacksMap.set(t,i);return}this._onCollectionChangeCallbacksMap.forEach((i,a)=>{const o=[...i,e];this._onCollectionChangeCallbacksMap.set(a,o)})}unregisterOnCollectionChangeCallback(e,t){if(t){if(!this._unregisterCallbackByAction(t,e))throw new Error("The provided callback is not registered.");return}if(![...this._onCollectionChangeCallbacksMap.keys()].map(i=>this._unregisterCallbackByAction(i,e)).some(i=>i))throw new Error("The provided callback is not registered.")}registerOnItemAttributesChangesCallback(e){this._onItemAttributesChangesCallbacks.push(e)}unregisterOnItemAttributesChangesCallback(e){if(!this._onItemAttributesChangesCallbacks.includes(e))throw new Error("The provided callback is not registered.");this._onItemAttributesChangesCallbacks=this._onItemAttributesChangesCallbacks.filter(t=>t!==e)}removeChildModel(e,t){const n=t?.triggerNotification??!0,i=this._model?.name,a=e.getModelByName(i);this._model?.removeChild(a),n&&this._model?.childrenChange()}copyWithin(e,t,n){const i={collection:[],affectedElements:this.slice(t,n),action:k.Move,index:e};return this._triggerChangesAfter(()=>super.copyWithin(e,t,n),i)}fill(e,t,n){const i=n??this.length-1-(t??0),a={collection:[],affectedElements:new Array(i).fill(e),action:k.Add,index:t};return this._triggerChangesAfter(()=>super.fill(e,t,n),a)}push(...e){const t={collection:[],affectedElements:[...e],action:k.Add,index:this.length};return this._triggerChangesAfter(()=>super.push(...e),t)}reverse(){const e={collection:[],affectedElements:this.slice(),action:k.Add,index:0};return this._triggerChangesAfter(()=>super.reverse(),e)}shift(){const e={collection:[],affectedElements:this.length?[this[0]]:[],action:k.Remove,index:0};return this._triggerChangesAfter(()=>super.shift(),e)}sort(e){const t={collection:[],affectedElements:this.slice(),action:k.Move};return this._triggerChangesAfter(()=>super.sort(e),t)}splice(e,t,...n){const i=typeof t=="number"?t:this.length-e,a=i>0?this.slice(e,e+i):[],o=a.length>0,l={collection:[],affectedElements:o?a:[...n],action:o?k.Remove:k.Add,index:e};return this._triggerChangesAfter(()=>super.splice(e,t,...n),l)}pop(){const e=this.length?this.length-1:void 0,t={collection:[],affectedElements:e!==void 0?[this[e]]:[],action:k.Remove,index:e};return this._triggerChangesAfter(()=>super.pop(),t)}unshift(...e){const t={collection:[],affectedElements:[...e],action:k.Add,index:0};return this._triggerChangesAfter(()=>super.unshift(...e),t)}getChangedItems(){const e=[...this._deletedItems];return this.filter(n=>{if(n.attributes.IsChanged)return!0;const i=n.getPrimaryModelMode();return i&&i!==M.Update}).concat(e)}createItem(e){var t=this;const n=function(){var i=(0,b.A)(function*(){const a=yield t._generateItem(e||{});t._insertItem(a,e?.index);const o={collection:[...t],affectedElements:[a],action:k.Add,index:t.indexOf(a)};return t._executeChangesCallbacksWhenReady(o),a});return function(){return i.apply(this,arguments)}}();return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.createItem",()=>n()):n()}getPrimaryAttributeValues(){return Promise.all(this.map(e=>e?.[e?.primaryAttributeName]))}findByPrimaryAttribute(e){var t=this;return(0,b.A)(function*(){for(const n of t)if(yield t._isItemPrimaryAttributeEqual(n,[e]))return n})()}filterByPrimaryAttributes(e){var t=this;return(0,b.A)(function*(){const n=[];for(const i of t)(yield t._isItemPrimaryAttributeEqual(i,e))&&n.push(i);return n})()}merge(e){const t=()=>{this._triggerChangesAfter(()=>{const n=this._mergeItems([...this],e),i=n.length>this.length;super.splice(0,this.length,...n),this._createdItems.splice(0,this._createdItems.length),e instanceof ve&&this._mergeItems(this._deletedItems,e._deletedItems);const a={collection:[...this],affectedElements:e,action:i?k.Add:k.Reload};this._executeChangesCallbacksWhenReady(a)})};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.merge",()=>t()):t()}reload(e,t=k.Reload){const n=[...this],i={collection:[],affectedElements:t===k.Reload?[...e]:n,action:t};return(0,c.lastValueFrom)(this._reload(e).pipe((0,u.finalize)(()=>this._executeChangesCallbacksWhenReady(i))))}remove(e){const[t,n]=typeof e=="number"?[e,this[e]]:[this.indexOf(e),e];if(t>=0&&t<this.length){this.splice(t,1);const i={collection:[],affectedElements:[n],action:k.Remove,index:t};return this._executeChangesCallbacksWhenReady(i),(0,c.lastValueFrom)(n.destroy())}return Promise.resolve()}clear(){return this.reload([],k.Remove)}moveTo(e,t){if(t>=this.length)throw new dr("Target index cannot be greater than collection length");const n=this.indexOf(e);if(n===t||t<0)return;const i={collection:[],affectedElements:[e],action:k.Move,index:t};this._triggerChangesAfter(()=>super.splice(t,0,super.splice(n,1)[0]),i)}destroy(){this._isDestroyed=!0,this._host=null,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[];const e=this._reload([]);return this._formApiModel.clear({emitEvent:!1}),this._itemAttributeChanged.complete(),this._itemsChanged.complete(),this._destroyed$.next(),this._destroyed$.complete(),(0,c.lastValueFrom)(e)}}function Gd(s,e){return!s?.length||!e?.length?null:s[e.length-1]??null}function bi(s){for(;s.parent;)s=s.parent;return s}function Ia(s,e){const t=s.split(".").slice(0,-1),n=Tc(e),i=n.map(a=>a.viewModel$.pipe((0,u.take)(1)));return(0,c.forkJoin)(i).pipe((0,u.map)(a=>({viewModels:a,rootViewModel:Gd(a,n)})),(0,u.filter)(({rootViewModel:a})=>!a?._destroyed),(0,u.map)(({viewModels:a,rootViewModel:o})=>{const l=[],h=!o?.[ze].get(W,null)?.["ViewModel.DisableFixedNestedCollectionPathCheck"],p=h?qd:Wd;let g=n.length-1,C=[];for(const E of t){l.push(E);const T=h?o:a[g];if(T&&p(T,l)&&(C=[...l],g--,g<0))return null}return{context:n[g],contextPath:C.join(".")}}))}function Tc(s){const e=[s];return s.parent&&e.push(...Tc(s.parent)),e}function qd(s,e){let t=s._attributeConfigs,n=null;for(const i of e){if(n=t?.[i],!n)return!1;t=n.viewModelConfig?.attributes}return n.isCollection}function Wd(s,e){let t=s;for(const n of e)t=t?.attributes?t.attributes[n]:t?.[n];return t instanceof ve}function Zd(s){return(s?.parameters??[]).map(e=>Pc(e)).flat()}function Pc(s){const e=[];if(s.attributePath&&e.push(s.attributePath),s.attributeProperty){const n=s.attributeProperty.split(":").shift();e.push(n)}const t=(s.converters??[]).map(n=>Zd(n)).flat();return e.push(...t),e.filter(n=>!isEmpty(n))}function Me(s){return typeof s=="string"&&s.startsWith("$")&&s.length>1}function pr(s){return Me(s)&&/^\$(\w+\.)*\w+$/.test(s)}function Nc(s){return typeof s=="string"&&s.startsWith(`$${fi}.${fn.string}.`)}function Dc(s){return/^\$(?<AttributeName>.+):(?<PropertyName>.+?)(?=(?==(?<defValue>.*))|(?=$))/.test(s)}function Ea(s){return typeof s=="string"&&/@event\b/.test(s)}function Kd(s){return typeof s=="string"&&/^([^\d.][\w.]+)(\s*:\s*[\w'".$]+)+.*$/.test(s)}function Vc(s){return!!s.match(/^'.*'$/)}function Oc(s){return!isNaN(Number(s))&&!isNaN(parseFloat(s))}function Bc(s){return s==="true"||s==="false"}function Jd(s){return Vc(s)||Oc(s)||Bc(s)}function Aa(s){const e={expression:s},t=s.split("|").map(n=>n.trim());if(Me(s)){const n=t.shift();e.binding=n,Nc(n)&&(e.resourcePath=n.substring(1)),Dc(n)&&(e.attributeProperty=n.substring(1)),pr(n)&&(e.attributePath=n.substring(1))}else if(Ea(s)){const n=t.shift();e.event=n.substring(7)}else if(!Kd(s))return e.value=s,e;return e.converters=t.map(n=>{const[i,...a]=n.split(":").map(o=>o.trim());return{type:i,parameters:a.map(o=>Aa(o))}}),e}function B_(s){if(!isString(s)||isEmpty(s))return[];const e=Aa(s);return Pc(e)}function k_(s){return Me(s)?s.slice(1):s}function xa(s,e){if(!s)return e;if(!e.startsWith(s))throw new Error(`Attribute path '${e}' should start with '${s}'`);return e.substring(s.length+1)}function Yd(s){if(!Me(s))throw new Error(`'${s}' is not binding expression`);const e=s.indexOf("|");return e>-1&&(s=s.substring(0,e).trimEnd()),s.substring(1)}function kc(s,e){return Ra.apply(this,arguments)}function Ra(){return Ra=(0,b.A)(function*(s,e){const t=e.match(/^(?:(?<attributeHostPath>.+)\.)?(?<attributeName>[^.]+)$/),{attributeHostPath:n,attributeName:i}=t.groups,a=n?yield yi(s,n):s;return{attributeName:i,attributeHost:a}}),Ra.apply(this,arguments)}class Lc{getAttributeValuesStream(e,t){return e?e.events$.pipe((0,u.filter)(n=>n.type===Y.ChangeAttributeValue),(0,u.filter)(n=>n?.payload?.attributeName===t),(0,u.switchMap)(n=>t in e?Promise.resolve(e[t]):Promise.resolve(n.payload.value)),(0,u.share)()):(0,c.of)(null)}getAttributeInitialValueStream(e,t,n){return e?(0,c.from)(yi(e,t)).pipe((0,u.takeUntil)(n)):(0,c.of)(null)}getAttributeLocationChanges(e,t){return Ia(e,t).pipe((0,u.tap)(n=>{if(!n)throw new Error(`Target binding context for attribute "${e} was not found"`)}),(0,u.switchMap)(({context:n,contextPath:i})=>(0,c.combineLatest)([n.viewModel$,(0,c.of)(xa(i,e))])),(0,u.switchMap)(([n,i])=>n?kc(n,i):(0,c.of)({attributeName:void 0,attributeHost:void 0})))}evaluate(e,t){const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,u.switchMap)(i=>this.getAttributeValueChanges(i)))}}class xe extends Lc{getAttributeValueChanges({attributeHost:e,attributeName:t}){const n=this.getAttributeValuesStream(e,t),i=this.getAttributeInitialValueStream(e,t,n);return(0,c.merge)(i,n)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(xe)))(n||xe)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac})}}class Rt extends xe{removeConvertersFromExpression(e){const t=e.indexOf("|");return t===-1?e:(console.warn(`Cannot use converters in control binding expression: ${e}`),e.substring(0,t).trimEnd())}evaluate(e,t){e=this.removeConvertersFromExpression(e);const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,u.map)(({attributeHost:i,attributeName:a})=>i?i.getAttributeControl(a):new He.FormControl(null)))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(Rt)))(n||Rt)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Rt,factory:Rt.\u0275fac})}}const Xd="DisableAttributeDeactivationUntilBRulesExecution";class Sn extends Lc{constructor(e){super(),this._featureService=e,this._readonlyProperties=["readonly","disabled"]}getAttributeValueChangesInHybridMode(e,t,n,i){const a=e.getControl(t),o=i.slice(1);return this._getValuesStream(e,t,n,()=>{const l=this.getAttributeValuesStream(e,o).pipe((0,u.tap)(p=>a.setPropertyValue(n,p))),d=this.getAttributeValuesStream(e,`${t}:${n}`).pipe((0,u.filter)(()=>{const p=Object.getOwnPropertyDescriptor(e,o),g=!!p?.get,C=!!p?.set;return!(g&&!C)}),(0,u.tap)(p=>e[o]=p)),h=(0,c.from)(yi(e,o)).pipe((0,u.tap)(p=>a.setPropertyValue(n,p,!0)),(0,u.takeUntil)(l));return(0,c.merge)(h,l,d)})}_getDefaultValue(e){if(!e)return null;try{return JSON.parse(e)}catch{return e}}_getValuesStream(e,t,n,i){return this._readonlyProperties.includes(n)?(0,c.forkJoin)({disableAttributeDeactivation:this._featureService.getFeatureState(Xd),hasBRulesAffectingAttribute:e._getIsAffectedByBusinessRules({name:t})}).pipe((0,u.switchMap)(({disableAttributeDeactivation:a,hasBRulesAffectingAttribute:o})=>a||o!==!0?i():e._businessRulesActivated$.pipe((0,u.switchMap)(l=>l?i():(0,c.of)(!0))))):i()}getAttributeValueChanges(e){const{attributeHost:t}=e;if(!t)return(0,c.of)(null);const[n,i]=e.attributeName.split(":"),[a,o]=i.split("="),l=t.getControl(n),d=this._getDefaultValue(o);if(typeof d=="string"&&d?.startsWith("$"))return this.getAttributeValueChangesInHybridMode(t,n,a,d);if(d!=null){const h=l.getPropertyByName(a,!0);h.hasInitialValue||h.setInitialValue(d)}return this._getValuesStream(t,n,a,()=>{const h=this.getAttributeValuesStream(t,`${n}:${a}`),p=(0,c.of)(l.getPropertyValue(a)).pipe((0,u.filter)(g=>g!=null),(0,u.takeUntil)(h));return(0,c.merge)(p,h)})}static{this.\u0275fac=function(t){return new(t||Sn)(r.\u0275\u0275inject(sr))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Sn,factory:Sn.\u0275fac})}}class vn{evaluate(e,t){const n=e.slice(1);return bi(t).viewModel$.pipe((0,u.switchMap)(i=>i?yi(i,n):(0,c.of)(null)))}static{this.\u0275fac=function(t){return new(t||vn)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:vn,factory:vn.\u0275fac})}}class Ci{static{this.\u0275fac=function(t){return new(t||Ci)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ci,factory:Ci.\u0275fac})}}const Fc=window;class Si{constructor(){this.store={typeInfos:new Map}}static{this._prefix="creatio.registry."}static get store(){if(!this._instance){let e=(0,v.get)(Fc,this._prefix+this.registryKey);e||(e=new this,(0,v.set)(Fc,this._prefix+this.registryKey,e)),this._instance=e}return this._instance.store}}function vi(s,e){if(s.split(".").length<2)throw new Error(`Error when register ${s}. Type property should have format "VendorPrefix.${e}"`)}function L_(s,e){return vi(s,e)}function Qd(s){const[e,t]=s.split("."),n=$c(t);if(!e||n!==t)throw new Error(`Error when register ${s}. Type property should have Pascal case, e.g. ${e+"."+n}. The first letter of each word in a compound word should be capitalized`)}function jc(s){const[e,t]=s.split("."),n=$c(t);if(e.toLowerCase()==="crt"&&n!==t)throw new Error(`Error when register ${s}. Type property should have Pascal case, e.g. ${e+"."+n}. The first letter of each word in a compound word should be capitalized`)}function $c(s){return(0,v.upperFirst)((0,v.camelCase)(s))}function F_(s,e){if(!e)throw new Error(`Error when resolve ${s}. Type was not registered.`)}function Uc(s,e,t){if(t.has(s)&&!(0,v.isEqual)(t.get(s),e))throw new Error(`Error when register ${s}. Element with this type has already exist`)}class zc extends Si{static{this.registryKey="ConverterRegistry"}static has(e){return this.store.typeInfos.has(e)}static find(e){return this.store.typeInfos.get(e)}static get(e){const t=this.find(e);if(!t)throw new Error(`'${e}' converter doesn't exist`);return t}static register(e){vi(e.type,"ConverterTypeName"),jc(e.type);const t=this.find(e.type);this.store.typeInfos.set(e.type,{...t??{},...e})}static clear(){this.store.typeInfos.clear()}}class Mi{constructor(){this._converterRegistry=zc,this._injector=(0,r.inject)(r.Injector)}get(e,t){return this._converterRegistry.get(e).instantiate(t)}register(e,t){throw new Error("NotImplemented")}clear(){this._converterRegistry.clear()}static{this.\u0275fac=function(t){return new(t||Mi)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Mi,factory:Mi.\u0275fac,providedIn:"root"})}}class eh extends Error{constructor(){super("Next handler already specified")}}class Hc{constructor(){this._refs=new Set,this.lazyLoadingDisabled=!1}static{this._globalInstancePath="creatio._lazyModulesManager"}static get instance(){if(!this._instance){let e=(0,v.get)(window,this._globalInstancePath);e||(e=new this,(0,v.set)(window,this._globalInstancePath,e)),this._instance=e}return this._instance}add(e){this._refs.add(e)}size(){return this._refs.size}loadAll(){return Promise.all(Array.from(this._refs).map(e=>e.loadAndBootstrap()))}clear(){this._refs.clear()}}var Ta;(function(s){s[s.Schema=0]="Schema",s[s.Remote=1]="Remote",s[s.Host=2]="Host"})(Ta||(Ta={}));class th extends Si{static{this.registryKey="pkgTopology"}static get items(){return this.store.typeInfos}static get(e){const t=this.items.get(e);if(t===void 0)throw new Error(`Package with name ${e} not found in topology`);return t}}class nh{constructor(e){this._request=e;const t=[...this._request.scopes??[]].reverse().map((n,i)=>[n,i]);this._scopesOrder=Object.fromEntries(t)}_getOrderByScopes(e){if(!e.scopes)return Number.MAX_VALUE;const t=e.scopes.filter(n=>n in this._scopesOrder).map(n=>this._scopesOrder[n]);return Math.min(...t)}_getOrderByPkgTopology(e){return e.source.type===Ta.Host?Number.MAX_VALUE:th.get(e.source.packageName)}compare(e,t){const n=this._getOrderByScopes(e),i=this._getOrderByScopes(t);let a=n-i;if(a)return a;const o=this._getOrderByPkgTopology(e),l=this._getOrderByPkgTopology(t);return a=o-l,a||(a=e.source.type-t.source.type,a)}}function ih(s){console.error("Not supported: lazy modules should not be dependent on other lazy modules. Some functions may not work correctly",s)}function Gc(s){if(!Array.isArray(s))return[];if(s.length===0)return[];const e=new Set,t=[...s];for(;t.length>0;){const n=t.pop();if(!n||e.has(n))continue;if(typeof n!="function"){ih(n);continue}e.add(n);const i=hd(n)?.includes||[];t.push(...i)}return[...e]}function qc(s,e){return s?.length?s.some(t=>e?.includes(t)):!0}const Pa=window;Pa.creatio??={},Pa.creatio._bootstrappedCrtModules??=new Map;const Wc=Pa.creatio._bootstrappedCrtModules;function Na(s){Wc.forEach((e,t)=>{e.root&&s(e,t)})}function j_(s){Na(e=>e.options?.onContextCreate?.(s))}function Zc(s){Na(e=>e.options?.onContextUpdate?.(s))}function sh(s){Na(e=>e.options?.onContextDestroy?.(s))}class rh{constructor(){var e=this;this._handlers=[],this._requestListeners=new Map,this._handlersCache=new Map,this._handlersScopesByContextId=new Map,this.handlerChain$={process:function(){var t=(0,b.A)(function*(n){let i;if(e._hasCacheHandler(n))i=e._getCacheHandler(n);else{const a=e._getMatchedHandlers(n);Hc.instance.lazyLoadingDisabled||(yield e._loadLazyHandlers(n,a)),i=e._buildHandlersChain(n,a)}return e._requestListeners.forEach(a=>a?.(n)),i?.handle(n)});return function(i){return t.apply(this,arguments)}}(),register:t=>(this._handlersCache.delete(t.requestType),this._handlers.push(t),()=>{const n=this._handlers.indexOf(t);n>-1?(this._handlers.splice(n,1),this._handlersCache.delete(t.requestType)):console.warn(`${t?.requestType} not found to unsubscribe`)}),update:t=>{const n=this._handlers.find(i=>i.type===t.type);n&&(n.createHandler=t.createHandler)},subscribe:(t,n)=>{if(!t)return()=>{};const i=D(),a=o=>{(!n||o.$context===n)&&t(o)};return this._requestListeners.set(i,a),()=>this._requestListeners.delete(i)}}}clearContextedHandlersCache(e){return(this._handlersScopesByContextId.get(e)??[]).every(({requestType:n,scope:i})=>this._handlersCache.get(n)?.delete(i))}clear(){this._handlers.splice(0),this._requestListeners.clear(),this._handlersCache.clear(),this._handlersScopesByContextId.clear()}_getCacheHandler(e){const t=this._handlersCache.get(e.type),n=this._getCacheScopesKey(e);return t.get(n)}_hasCacheHandler(e){const t=this._handlersCache.get(e.type),n=this._getCacheScopesKey(e);return t&&t.has(n)}_getCacheScopesKey(e){const t=this._getInjectionContext(e?.$context)?.id??"";return(e.scopes||[""]).join("_").concat(t)}_getInjectionContext(e){return e?._injectionContext||e?.parent&&this._getInjectionContext(e.parent)}_setContextedScopes(e,t){const n=this._getInjectionContext(e?.$context)?.id,i=this._handlersScopesByContextId.has(n)?this._handlersScopesByContextId.get(n):[];i.push({requestType:e.type,scope:t}),this._handlersScopesByContextId.set(n,i)}_setCacheHandler(e,t){const n=this._handlersCache.has(e.type)?this._handlersCache.get(e.type):new Map,i=this._getCacheScopesKey(e);n.set(i,t),this._getInjectionContext(e?.$context)?.id&&this._setContextedScopes(e,i),this._handlersCache.set(e.type,n)}_isRequestHandler(e){return typeof e.handle=="function"&&typeof e.setNext=="function"}_checkHandlerInstanceOf(e){if(!this._isRequestHandler(e))throw new Error('Handler should implement "BaseRequestHandler"')}_loadLazyHandlers(e,t){var n=this;return(0,b.A)(function*(){const i=new Set;t.forEach(l=>{l.lazy&&!l.createHandler&&i.add(l.lazyModuleRef)});const a=[...i];yield Promise.all(a.map(l=>l.loadAndBootstrap()));const o=n._getInjectionContext(e?.$context);if(o&&i.size){const l=yield Gc(a.map(d=>d.typeRef));for(const d of l)o.addLazyModule(d);Zc(o)}})()}_getMatchedHandlers(e){return this._handlers.filter(t=>t.requestType!==e.type?!1:qc(t.scopes,e.scopes))}_buildHandlersChain(e,t){const n=new nh(e);t.sort((l,d)=>n.compare(l,d));const i=this._getInjectionContext(e?.$context),a=t.map(l=>l.createHandler.call(l,i));a.forEach(l=>this._checkHandlerInstanceOf(l)),this._joinHandlersInChain(a);const o=a[0];return this._setCacheHandler(e,o),o}_joinHandlersInChain(e){for(let t=0;t<e.length-1;t++)try{e[t].setNext(e[t+1])}catch(n){throw n instanceof eh?new Error("Handler factory should return new instance of BaseRequestHandler class or its subclass (next handler should not be specified)"):n}}}const Kc=window;class ot{get _chain(){return Kc.handlerChain}set _chain(e){Kc.handlerChain=e}static get instance(){return ot._instance||(ot._instance=new ot)}constructor(){this._chain||this._createGlobalHandlerChain()}_createGlobalHandlerChain(){this._chain=new rh}clearContextedHandlersCache(e){return this._chain.clearContextedHandlersCache(e)}register(e){return this._chain.handlerChain$.register(e)}update(e){return this._chain.handlerChain$.update(e)}process(e){return this._chain.handlerChain$.process(e)}subscribe(e,t){return this._chain.handlerChain$.subscribe(e,t)}clear(){this._chain.clear()}}var f;(function(s){s[s.Guid=0]="Guid",s[s.Text=1]="Text",s[s.Integer=4]="Integer",s[s.Float=5]="Float",s[s.Money=6]="Money",s[s.DateTime=7]="DateTime",s[s.Date=8]="Date",s[s.Time=9]="Time",s[s.Lookup=10]="Lookup",s[s.Enum=11]="Enum",s[s.Boolean=12]="Boolean",s[s.Blob=13]="Blob",s[s.Image=14]="Image",s[s.CUSTOM_OBJECT=15]="CUSTOM_OBJECT",s[s.IMAGELOOKUP=16]="IMAGELOOKUP",s[s.COLLECTION=17]="COLLECTION",s[s.Color=18]="Color",s[s.LOCALIZABLE_STRING=19]="LOCALIZABLE_STRING",s[s.ENTITY=20]="ENTITY",s[s.ENTITY_COLLECTION=21]="ENTITY_COLLECTION",s[s.ENTITY_COLUMN_MAPPING_COLLECTION=22]="ENTITY_COLUMN_MAPPING_COLLECTION",s[s.HASH_TEXT=23]="HASH_TEXT",s[s.SECURE_TEXT=24]="SECURE_TEXT",s[s.FILE=25]="FILE",s[s.MAPPING=26]="MAPPING",s[s.SHORT_TEXT=27]="SHORT_TEXT",s[s.MEDIUM_TEXT=28]="MEDIUM_TEXT",s[s.MAXSIZE_TEXT=29]="MAXSIZE_TEXT",s[s.LONG_TEXT=30]="LONG_TEXT",s[s.FLOAT1=31]="FLOAT1",s[s.FLOAT2=32]="FLOAT2",s[s.FLOAT3=33]="FLOAT3",s[s.FLOAT4=34]="FLOAT4",s[s.LOCALIZABLE_PARAMETER_VALUES_LIST=35]="LOCALIZABLE_PARAMETER_VALUES_LIST",s[s.METADATA_TEXT=36]="METADATA_TEXT",s[s.STAGE_INDICATOR=37]="STAGE_INDICATOR",s[s.OBJECT_LIST=38]="OBJECT_LIST",s[s.COMPOSITE_OBJECT_LIST=39]="COMPOSITE_OBJECT_LIST",s[s.FLOAT8=40]="FLOAT8",s[s.FILE_LOCATOR=41]="FILE_LOCATOR",s[s.PHONE_TEXT=42]="PHONE_TEXT",s[s.RICH_TEXT=43]="RICH_TEXT",s[s.WEB_TEXT=44]="WEB_TEXT",s[s.EMAIL_TEXT=45]="EMAIL_TEXT",s[s.COMPOSITE_OBJECT=46]="COMPOSITE_OBJECT",s[s.FLOAT0=47]="FLOAT0",s[s.MONEY0=48]="MONEY0",s[s.MONEY1=49]="MONEY1",s[s.MONEY3=50]="MONEY3"})(f||(f={}));var X;(function(s){s.LoadNext="loadNext",s.Load="load",s.Reload="reload"})(X||(X={}));var P;(function(s){s.PrimaryColumnValue="primaryColumnValue",s.ColumnValue="columnValue",s.Filter="filter",s.PrimaryDisplayValueFilter="primaryDisplayValueFilter",s.Empty="empty",s.Never="never"})(P||(P={}));var Re;(function(s){s.ViewElement="viewElement",s.Page="page"})(Re||(Re={}));function ah(s){return s.getFullYear()<1970}function oh(s){const e=s.getTimezoneOffset()*6e4;return new Date(s.getTime()-e).toISOString().slice(0,-1)}function ch(s){const e=s.getFullYear(),t=wi(s.getMonth()+1),n=wi(s.getDate()),i=wi(s.getHours()),a=wi(s.getMinutes()),o=wi(s.getSeconds()),l=lh(s.getMilliseconds());return`${e}-${t}-${n}T${i}:${a}:${o}.${l}`}function wi(s){return String(s).padStart(2,"0")}function lh(s){return String(s).padStart(3,"0")}function Jc(s){if(!(s instanceof Date))throw new TypeError;return ah(s)?ch(s):oh(s)}function Yc(s){return`"${Jc(s)}"`}function Te(s){return function(e,t,n){const i=function(...a){const o=ot.instance.process({type:s?.requestType?s.requestType:this.requestType,method:s?.methodName?s.methodName:t,args:a});return s?.omitResult?Promise.resolve(void 0):o};n?n.value=i:e[t]=i}}class mr{}class Tt extends mr{constructor(){super(...arguments),this.requestType="crt.SysSettingsService"}}(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],Tt.prototype,"getByCodes",void 0),(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],Tt.prototype,"getByCode",void 0),(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],Tt.prototype,"update",void 0),(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],Tt.prototype,"updateMany",void 0);var Ge;(function(s){s.Model="Model",s.ViewModel="ViewModel"})(Ge||(Ge={}));var ct;(function(s){s.Unknown="Unknown",s.Init="Init",s.Create="Create",s.Copy="Copy",s.Update="Update"})(ct||(ct={}));function uh(s,e){return!!e?.find(n=>!n.scopeId&&n.triggers.find(i=>i.name===s.name))}function dh(s,e){return!!e?.find(n=>n.scopeName===s.scopeName&&n.triggers?.find(i=>i.name===s.name))}function hh(s,e,t){if(e.scopeName===s){if(uh(e,t))return!1}else if(dh(e,t))return!1;return!0}function fr(s,e){return s===e||Xc(s)&&Xc(e)}function Xc(s){return!s||s==="null"}var Ii;(function(s){s.PTP="PTPMsg",s.BROADCAST="BroadcastMsg",s.SERVER="ServerMsg"})(Ii||(Ii={}));class Qc{constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.enabled=!0,this.uId=e?.uId||D(),e&&(this.enabled=e.enabled)}toMetadata(){return{typeName:this.typeName,uId:this.uId,enabled:this.enabled}}getTypeName(){return this.typeName}getApplicability(){return[]}isValid(){return!0}onDataSourceAttributeNameChanged(e,t,n){}isAttributeUsed(e,t){return!1}getAffectedItems(){return[]}getRequiredItems(){return[]}hasScopeAttributes(e){return!1}}const ph="businessRuleActionDesignerType";function be(s){return function(e){Reflect.defineMetadata(ph,s,e)}}const x="DataValueType",Da={[f.Date]:{type:f.Date,id:"603d4960-a1a2-45e9-b232-206a54421b01",name:"Date",icon:"data-type-date-icon.svg",designerIcon:y(26861),translateKey:`${x}.DateCaption`},[f.Time]:{type:f.Time,id:"04cc757b-8f06-482c-8a1a-0c0e171d2410",name:"Time",icon:"data-type-time-icon.svg",designerIcon:y(8510),translateKey:`${x}.TimeCaption`},[f.DateTime]:{type:f.DateTime,id:"d21e9ef4-c064-4012-b286-fa1a8171da44",name:"DateTime",icon:"data-type-datetime-icon.svg",designerIcon:y(55146),translateKey:`${x}.DateTimeCaption`},[f.Text]:{type:f.Text,id:"8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",name:"Text",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${x}.TextCaption`},[f.SHORT_TEXT]:{type:f.SHORT_TEXT,id:"325a73b8-0f47-44a0-8412-7606f78003ac",name:"ShortText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${x}.ShortTextCaption`},[f.PHONE_TEXT]:{type:f.PHONE_TEXT,id:"26cba63c-daf1-4f36-b2ea-73c0d675d90c",name:"PhoneText",icon:"data-type-phone-icon.svg",designerIcon:y(59155),translateKey:`${x}.PhoneTextCaption`},[f.WEB_TEXT]:{type:f.WEB_TEXT,id:"26cba64c-daf1-4f36-b2ea-73c0d695d90c",name:"WebText",icon:"data-type-text-icon.svg",designerIcon:y(64337),translateKey:`${x}.WebTextCaption`},[f.EMAIL_TEXT]:{type:f.EMAIL_TEXT,id:"66cba64c-daf1-4f36-b8ea-73c0d695d90c",name:"EmailText",icon:"data-type-text-icon.svg",designerIcon:y(71011),translateKey:`${x}.EmailTextCaption`},[f.MEDIUM_TEXT]:{type:f.MEDIUM_TEXT,id:"ddb3a1ee-07e8-4d62-b7a9-d0e618b00fbd",name:"MediumText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${x}.MediumTextCaption`},[f.LONG_TEXT]:{type:f.LONG_TEXT,id:"5ca35f10-a101-4c67-a96a-383da6afacfc",name:"LongText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${x}.LongTextCaption`},[f.MAXSIZE_TEXT]:{type:f.MAXSIZE_TEXT,id:"c0f04627-4620-4bc0-84e5-9419dc8516b1",name:"MaxSizeText",icon:"data-type-unlimited-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${x}.MaxSizeTextCaption`},[f.Integer]:{type:f.Integer,id:"6b6b74e2-820d-490e-a017-2b73d4ccf2b0",name:"Integer",icon:"data-type-integer-icon.svg",designerIcon:y(60521),translateKey:`${x}.IntegerCaption`},[f.FLOAT0]:{type:f.FLOAT0,id:"60532cfd-8645-4a54-be81-bef507aa2339",name:"Float0",icon:"data-type-float0-icon.svg",designerIcon:y(68877),translateKey:`${x}.FLOAT0Caption`},[f.FLOAT1]:{type:f.FLOAT1,id:"07ba84ce-0bf7-44b4-9f2c-7b15032eb98c",name:"Float1",icon:"data-type-float1-icon.svg",designerIcon:y(68877),translateKey:`${x}.FLOAT1Caption`},[f.FLOAT2]:{type:f.FLOAT2,id:"5cc8060d-6d10-4773-89fc-8c12d6f659a6",name:"Float2",icon:"data-type-float2-icon.svg",designerIcon:y(68877),translateKey:`${x}.FLOAT2Caption`},[f.FLOAT3]:{type:f.FLOAT3,id:"3f62414e-6c25-4182-bcef-a73c9e396f31",name:"Float3",icon:"data-type-float3-icon.svg",designerIcon:y(68877),translateKey:`${x}.FLOAT3Caption`},[f.FLOAT4]:{type:f.FLOAT4,id:"ff22e049-4d16-46ee-a529-92d8808932dc",name:"Float4",icon:"data-type-float4-icon.svg",designerIcon:y(68877),translateKey:`${x}.FLOAT4Caption`},[f.FLOAT8]:{type:f.FLOAT8,id:"a4aaf398-3531-4a0d-9d75-a587f5b5b59e",name:"Float8",icon:"data-type-float8-icon.svg",designerIcon:y(68877),translateKey:`${x}.FLOAT8Caption`},[f.Guid]:{type:f.Guid,id:"23018567-a13c-4320-8687-fd6f9e3699bd",name:"Guid",icon:"data-type-guid-icon.svg",designerIcon:y(92458),translateKey:`${x}.GuidCaption`},[f.Lookup]:{type:f.Lookup,id:"b295071f-7ea9-4e62-8d1a-919bf3732ff2",name:"Lookup",icon:"data-type-lookup-icon.svg",designerIcon:y(61631),translateKey:`${x}.LookupCaption`},[f.Boolean]:{type:f.Boolean,id:"90b65bf8-0ffc-4141-8779-2420877af907",name:"Boolean",icon:"data-type-boolean-icon.svg",designerIcon:y(36659),translateKey:`${x}.BooleanCaption`},[f.HASH_TEXT]:{type:f.HASH_TEXT,id:"ecbcce18-2a17-4ead-829a-9d02fa9578a4",name:"HashText",icon:"data-type-crs-text-icon.svg",designerIcon:y(97180),translateKey:`${x}.HashTextCaption`},[f.SECURE_TEXT]:{type:f.SECURE_TEXT,id:"3509b9dd-2c90-4540-b82e-8f6ae85d8248",name:"SecureText",icon:"data-type-encrypted-text-icon.svg",designerIcon:y(28010),translateKey:`${x}.SecureTextCaption`},[f.IMAGELOOKUP]:{type:f.IMAGELOOKUP,id:"b039feb0-ee7c-4884-8aa6-d6d45d84316f",name:"ImageLookup",icon:"data-type-image-link-icon.svg",designerIcon:y(65689),translateKey:`${x}.ImageLookupCaption`},[f.Money]:{type:f.Money,id:"969093e2-2b4e-463b-883a-3d3b8c61f0cd",name:"Money",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${x}.MoneyCaption`},[f.MONEY0]:{type:f.MONEY0,id:"6cc9cbe3-a486-4ed3-bea6-5c96f36d77ff",name:"Money0",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${x}.Money0Caption`},[f.MONEY1]:{type:f.MONEY1,id:"8842ed44-069a-4fae-b1a2-ee17384689eb",name:"Money1",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${x}.Money1Caption`},[f.MONEY3]:{type:f.MONEY3,id:"85ff33ce-d57d-4197-9e9b-c2dcb1cfc35e",name:"Money3",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${x}.Money3Caption`},[f.Float]:{type:f.Float,id:"57ee4c31-5ec4-45fa-b95d-3a2868aa89a8",name:"Float",icon:"data-type-float1-icon.svg",designerIcon:y(68877),translateKey:`${x}.FloatCaption`},[f.FILE]:{type:f.FILE,id:"a33c9252-d401-453e-949d-169157067ed9",name:"File",icon:"data-type-file-icon.svg",designerIcon:y(55039),translateKey:`${x}.FileCaption`},[f.Image]:{type:f.Image,id:"fa6e6e49-b996-475e-a77e-73904e4c5a88",name:"Image",icon:"data-type-image-icon.svg",designerIcon:y(55039),translateKey:`${x}.ImageCaption`},[f.Blob]:{type:f.Blob,id:"b7342b7a-5dde-40de-aa7c-24d2a57b3202",name:"Blob",icon:"data-type-blob-icon.svg",designerIcon:y(55039),translateKey:`${x}.BlobCaption`},[f.Color]:{type:f.Color,id:"dafb71f9-ee9f-4e0b-a4d7-37aa15987155",name:"Color",icon:"data-type-color-icon.svg",designerIcon:y(39078),translateKey:`${x}.ColorCaption`},[f.RICH_TEXT]:{type:f.RICH_TEXT,id:"79bccffa-8c8b-4863-b376-a69d2244182b",name:"RichText",icon:"data-type-rich-text-icon.svg",designerIcon:y(67021),translateKey:`${x}.RichCaption`},[f.ENTITY]:{type:f.ENTITY,id:"ebd85d37-0abf-4bbf-bb32-97dc3dffcc8c",name:"Entity",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.Entity`},[f.ENTITY_COLLECTION]:{type:f.ENTITY_COLLECTION,id:"51fb23ba-3eb2-11e2-b7d5-b0c76188709b",name:"EntityCollection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.EntityCollection`},[f.ENTITY_COLUMN_MAPPING_COLLECTION]:{type:f.ENTITY_COLUMN_MAPPING_COLLECTION,id:"b53eaa2a-4bb7-4a6b-9f4f-58ccab293e31",name:"EntityColumnMappingCollection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.EntityColumnMappingCollection`},[f.CUSTOM_OBJECT]:{type:f.CUSTOM_OBJECT,id:"84ed6865-9692-4c98-aaed-4d15b96a95c2",name:"CustomObject",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.CustomObject`},[f.OBJECT_LIST]:{type:f.OBJECT_LIST,id:"4b51a8b5-1ee9-4437-9d58-f35e083cbcdf",name:"ObjectList",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.ObjectList`},[f.COMPOSITE_OBJECT_LIST]:{type:f.COMPOSITE_OBJECT_LIST,id:"651ec16f-d140-46db-b9e2-825c985a8ac2",name:"CompositeObjectList",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.CompositeObjectList`},[f.COMPOSITE_OBJECT]:{type:f.COMPOSITE_OBJECT,id:"632e4371-0a7f-46cd-a284-a623b3933027",name:"CompositeObject",icon:"data-type-composite-object-icon.svg",designerIcon:y(97180),translateKey:`${x}.CompositeObject`},[f.COLLECTION]:{type:f.COLLECTION,name:"Collection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${x}.Collection`},[f.LOCALIZABLE_STRING]:{type:f.LOCALIZABLE_STRING,id:"95c6e6c4-2cc8-46be-a1cb-96f942655f86",name:"LocalizableString",icon:"data-type-text-icon.svg",designerIcon:y(97180),translateKey:`${x}.LocalizableString`},[f.METADATA_TEXT]:{type:f.METADATA_TEXT,id:"394e160f-c8e0-46fa-9c0d-75d97e9e9169",name:"MetaDataText",icon:"data-type-text-icon.svg",designerIcon:y(97180),translateKey:`${x}.MetaDataText`}},$_={DateTime:[f.Date,f.Time,f.DateTime],Text:[f.Text,f.SHORT_TEXT,f.MEDIUM_TEXT,f.LONG_TEXT,f.PHONE_TEXT,f.WEB_TEXT,f.EMAIL_TEXT,f.MAXSIZE_TEXT,f.LOCALIZABLE_STRING,f.RICH_TEXT],Number:[f.FLOAT0,f.FLOAT1,f.FLOAT2,f.FLOAT3,f.FLOAT4,f.FLOAT8,f.Integer,f.MONEY0,f.MONEY1,f.Money,f.MONEY3,f.Float],Lookup:[f.Lookup,f.IMAGELOOKUP]};var Pt;(function(s){s.Const="Const",s.SysValue="SysValue",s.SysSetting="SysSetting",s.AttributeValue="AttributeValue",s.AttributeProperty="AttributeProperty",s.Formula="Formula"})(Pt||(Pt={}));class Nt{get dataValueTypeName(){return this._dataValueTypeName}set dataValueTypeName(e){this._dataValueTypeName=e}get isLookup(){return this.dataValueTypeName===Da[f.Lookup].name}get referenceSchemaName(){return this._referenceSchemaName}set referenceSchemaName(e){this._referenceSchemaName!==e&&(this._referenceSchemaName=e)}constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleExpression",this._dataValueTypeName="",this._referenceSchemaName="",this.type=Pt.Const,this.uId=e?.uId||D(),e&&(this._dataValueTypeName=e.dataValueTypeName??"",this.type=e.type||this.type,this._referenceSchemaName=e.referenceSchemaName??"")}toMetadata(){return{typeName:this.typeName,uId:this.uId,type:this.type,dataValueTypeName:this.dataValueTypeName,referenceSchemaName:this.referenceSchemaName}}copy(){return new Nt({...this.toMetadata(),uId:D()})}isValid(){return!!this.uId}onDataSourceAttributeNameChanged(e,t,n){}getAffectedItem(){return null}clear(){throw new Error(`clear not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}setValue(e){throw new Error(`setValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}getValue(){throw new Error(`getValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isEmpty(){throw new Error(`isEmpty not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isAttributeUsed(e,t){return!1}hasScopeAttributes(e){return!1}}class gr{static{this._expressionsTypes=new Map}static register(e,t){this._expressionsTypes.set(e,t)}static _getExpressionType(e){return this._expressionsTypes.get(e)??null}get(e){if(!e)return new Nt;const t=gr._getExpressionType(e.typeName);return t?new t(e):new Nt(e)}}function Va(s){return function(e){gr.register(s.typeName,e)}}var Oa;let Ba=Oa=class extends Nt{get displayValue(){return this._displayValue}set displayValue(e){this._displayValue=e}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression",this._displayValue="",this.path="",this.scopeId="",this.type=Pt.AttributeValue,e&&(this.path=e.path,this.scopeId=e.scopeId==="null"?"":e.scopeId)}toMetadata(){return{...super.toMetadata(),path:this.path,scopeId:this.scopeId}}copy(){return new Oa({...this.toMetadata(),uId:D()})}isValid(){return super.isValid()&&!!this.path}onDataSourceAttributeNameChanged(e,t,n){this.scopeId===e&&this.path===t&&(this.path=n)}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t&&fr(this.scopeId,e)}hasScopeAttributes(e){return fr(this.scopeId,e)}isEmpty(){return!this.path}getValue(){return{value:this.path,displayValue:this.displayValue}}};Ba=Oa=(0,m.__decorate)([Va({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression"}),(0,m.__metadata)("design:paramtypes",[Object])],Ba);var _r;let lt=_r=class extends Qc{constructor(e){super(e),this._expressionFactory=new gr,this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.executorName="",e&&(this.executorName=e.executorName,this.expression=new Ba(e.expression),e.value&&(this.value=this._expressionFactory.get(e.value)))}getExpressionAffectedItems(){const e=this.expression?.getAffectedItem()??null;return e?[e]:[]}toMetadata(){return{...super.toMetadata(),executorName:this.executorName,expression:this.expression?.toMetadata(),value:this.value?.toMetadata()}}clone(){return new _r(this.toMetadata())}copy(){const e=new _r({...this.toMetadata(),uId:D()});return e.expression=this.expression?.copy(),e.value=this.value?.copy(),e}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();return t?[{path:t}]:[]}isValid(){return super.isValid()&&!!this.expression?.isValid()&&!!this.value?.isValid()}getAffectedItems(){const e=this.getExpressionAffectedItems();return[...super.getAffectedItems(),...e]}};lt=_r=(0,m.__decorate)([be("BusinessRuleDesignAction"),(0,m.__metadata)("design:paramtypes",[Object])],lt);class mh extends Qc{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetProperty"}}class Mn extends mh{constructor(e){super(e),this.items=[],e&&(Array.isArray(e.items)?this.items=e.items:this.items=e.items?.length>0?e.items.split(","):[])}_getAffectedItems(){return(this.items??[]).map(t=>({name:t}))}toMetadata(){return{...super.toMetadata(),items:this.items?.length>0?this.items.join(","):""}}getApplicability(){return this.isValid()?this.items.map(e=>({path:e})):[]}isValid(){return super.isValid()&&this.items?.length>0}getAffectedItems(){return[...super.getAffectedItems(),...this._getAffectedItems()]}isAttributeUsed(e,t){return this.items.includes(t)}}var yr;const fh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement";let ka=yr=class extends Mn{constructor(){super(...arguments),this.typeName=fh}clone(){return new yr(this.toMetadata())}copy(){return new yr({...this.toMetadata(),uId:D()})}};ka=yr=(0,m.__decorate)([be("BusinessRuleEditableElementDesignAction")],ka);var La;let br=La=class extends Nt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression",this.path="",this.filterExpression="",e&&(this.path=e.path,this.filterExpression=e.filterExpression==="null"?"":e.filterExpression)}toMetadata(){return{...super.toMetadata(),path:this.path,filterExpression:this.filterExpression}}copy(){return new La({...this.toMetadata(),uId:D()})}isValid(){return super.isValid()&&!!this.path&&!!this.filterExpression}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t}hasScopeAttributes(e){return!1}};br=La=(0,m.__decorate)([Va({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression"}),(0,m.__metadata)("design:paramtypes",[Object])],br);var Cr;let Fa=Cr=class extends lt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup",this.clearValue=!1,this.populateValue=!1,e?(this.clearValue=e.clearValue??!1,this.populateValue=e.populateValue??!1):(this.clearValue=!0,this.populateValue=!0),this._processMetadata(e)}_isOldMetadataFormat(e){const t=!!e.expression?.path&&e.expression.path!=="null",n=e.value,i=!!n?.value&&n.value!=="null";return t&&i}_convertOldMetadata(e){const t={...e},n=e.expression?.path||"",a=e.value?.value,o={path:a,filterExpression:""},l={path:n,filterExpression:""};if(a.includes(".")){const[d,...h]=a.split(".");o.path=d,o.filterExpression=h.join(".")}return{...t,leftExpression:o,rightExpression:l}}_processMetadata(e){e&&(this._isOldMetadataFormat(e)&&(e=this._convertOldMetadata(e)),delete this.expression,delete this.value,this.leftExpression=new br(e?.leftExpression),this.rightExpression=new br(e?.rightExpression))}toMetadata(){return{...super.toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue}}clone(){return new Cr({...this.toMetadata()})}copy(){return new Cr({...super.copy().toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue})}getApplicability(){return this.leftExpression?.path?[{path:this.leftExpression.path}]:[]}isValid(){return!!this.leftExpression?.isValid()&&!!this.rightExpression?.path}getAffectedItems(){const e=this.leftExpression?.getAffectedItem()??null,t=[...super.getAffectedItems()];return e&&t.push(e),t}getRequiredItems(){return[this.rightExpression?.getAffectedItem()].filter(e=>e)}isAttributeUsed(e,t){return this.leftExpression.isAttributeUsed(e,t)||this.rightExpression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.leftExpression.hasScopeAttributes(e)||this.rightExpression.hasScopeAttributes(e)}};Fa=Cr=(0,m.__decorate)([be("BusinessRuleFilterLookupAction"),(0,m.__metadata)("design:paramtypes",[Object])],Fa);var Sr;let ja=Sr=class extends Mn{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"}clone(){return new Sr(this.toMetadata())}copy(){return new Sr({...this.toMetadata(),uId:D()})}};ja=Sr=(0,m.__decorate)([be("BusinessRuleHideElementDesignAction")],ja);var vr;const el="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionOptionalElement";let $a=vr=class extends Mn{constructor(){super(...arguments),this.typeName=el}clone(){return new vr(this.toMetadata())}copy(){return new vr({...this.toMetadata(),uId:D()})}};$a=vr=(0,m.__decorate)([be("BusinessRuleOptionalElementDesignAction")],$a);var Mr;const gh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement";let Ua=Mr=class extends Mn{constructor(){super(...arguments),this.typeName=gh}clone(){return new Mr(this.toMetadata())}copy(){return new Mr({...this.toMetadata(),uId:D()})}};Ua=Mr=(0,m.__decorate)([be("BusinessRuleReadOnlyElementDesignAction")],Ua);var wr;const tl="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionRequiredElement";let za=wr=class extends Mn{constructor(){super(...arguments),this.typeName=tl}clone(){return new wr(this.toMetadata())}copy(){return new wr({...this.toMetadata(),uId:D()})}};za=wr=(0,m.__decorate)([be("BusinessRuleRequiredElementDesignAction")],za);const _h=Symbol("CreateModelFrom");class ut extends mr{constructor(e){super(),this.requestType="crt.ModelGenerator",this._crtModel=e}static get instance(){return this._instance||(this._instance=new ut),this._instance}get name(){return this._crtModel?.name}static[_h](e){return new ut(e)}static create(e){var t=this;return(0,b.A)(function*(){const n=yield t.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},"");return new ut(n)})()}getSchema(){return this._crtModel._getAsyncResult(this._crtModel.getSchema())}load(e){return e?.loadOptions&&!e?.options&&(e.options=e.loadOptions),this._crtModel._getAsyncResult(this._crtModel.load(e))}insert(e){return this._crtModel._getAsyncResult(this._crtModel.insert(e))}update(e,t){var n=this;return(0,b.A)(function*(){const i=Object.keys(e);if(i.length){const o=(yield n.getSchema()).primaryAttributeName;i.filter(l=>l!==o).forEach(l=>n._crtModel.attributeChanged(l))}return n._crtModel._getAsyncResult(n._crtModel.update(e,t))})()}copy(e,t={}){return this._crtModel._getAsyncResult(this._crtModel.copy(e,t))}create(e={}){return this._crtModel._getAsyncResult(this._crtModel.create(e))}delete(e){return this._crtModel._getAsyncResult(this._crtModel.delete(e))}canSave(e){return this._crtModel._getAsyncResult(this._crtModel.canSave(e))}canDelete(e){return this._crtModel._getAsyncResult(this._crtModel.canDelete(e))}insertInTransaction(e,t){return this._crtModel.insertInTransaction(e,t)}updateInTransaction(e,t,n){return this._crtModel.updateInTransaction(e,t,n)}deleteInTransaction(e,t){return this._crtModel.deleteInTransaction(e,t)}}(0,m.__decorate)([Te({methodName:"generateOne"}),(0,m.__metadata)("design:type",Function)],ut.prototype,"_create",void 0);class yh{static _getPrimaryDisplayAttributeName(e){return(0,b.A)(function*(){return(yield e.getSchema()).primaryDisplayAttributeName})()}static getLookupValue(e,t){var n=this;return(0,b.A)(function*(){const i=yield ut.create(e),a=yield i.getSchema(),o=[a.primaryAttributeName,a.primaryDisplayAttributeName];a.primaryColorAttributeName&&o.push(a.primaryColorAttributeName);const l=yield i.load({parameters:[{type:P.PrimaryColumnValue,value:t}],attributes:o});if(!l||l.length===0)throw new Error(`Can't find value for '${t}'`);if(l.length>1)throw new Error(`Load more than 1 data row for '${t}'`);const d=l[0],h=yield n._getPrimaryDisplayAttributeName(i),p={value:t,displayValue:d[h]};return a.primaryColorAttributeName&&(p.primaryColorValue=d[a.primaryColorAttributeName]),p})()}}var Ha;let Ga=Ha=class extends Nt{get value(){return this._value}set value(e){this._value!==e&&(this._displayValueInitialized=!1,this._value=e)}get referenceSchemaName(){return super.referenceSchemaName}set referenceSchemaName(e){this.referenceSchemaName!==e&&(super.referenceSchemaName=e,this._displayValueInitialized=!1)}get displayValue(){return this.isLookup&&this.referenceSchemaName?this._displayValueInitialized?this._displayValue:null:(this._displayValue=this.value,this._displayValueInitialized=!0,this._displayValue)}set displayValue(e){this._displayValue=e??"",this._displayValueInitialized=e!=null}get dataValueTypeName(){return super.dataValueTypeName}set dataValueTypeName(e){this.dataValueTypeName!==e&&(super.dataValueTypeName=e,this._displayValueInitialized=!1)}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression",this._value="",this._displayValue="",this._displayValueInitialized=!1,e&&(this._value=e.value)}initDisplayValue(){var e=this;return(0,b.A)(function*(){if(e._displayValueInitialized)return Promise.resolve(e._displayValue);if(e.isLookup&&e.referenceSchemaName&&e._value){const t=yield yh.getLookupValue(e.referenceSchemaName,e._value);e._displayValue=t.displayValue}else e._displayValue=e.value;return e._displayValueInitialized=!0,Promise.resolve(e._displayValue)})()}toMetadata(){return{...super.toMetadata(),value:this.value}}copy(){return new Ha({...this.toMetadata(),uId:D()})}isValid(){return super.isValid()?this.isLookup?ic(this.value):this.value!=null&&this.value!=="":!1}clear(){this._value="",this._displayValue="",this._displayValueInitialized=!1}setValue(e){e?(this.value=e.value,this.displayValue=e.displayValue):this.clear()}getValue(){return{value:this.value,displayValue:this.displayValue}}isEmpty(){return!this.value}};Ga=Ha=(0,m.__decorate)([Va({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression"}),(0,m.__metadata)("design:paramtypes",[Object])],Ga);var Ir;let qa=Ir=class extends lt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter",e&&(this.value=new Ga(e.value))}clone(){return new Ir(this.toMetadata())}copy(){return new Ir(super.copy().toMetadata())}getApplicability(){return this.expression?.path?[{path:this.expression.path}]:[]}isAttributeUsed(e,t){return this.expression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.expression.hasScopeAttributes(e)}};qa=Ir=(0,m.__decorate)([be("BusinessRuleSetFilterAction"),(0,m.__metadata)("design:paramtypes",[Object])],qa);var Er;let Wa=Er=class extends lt{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"}clone(){return new Er(this.toMetadata())}copy(){return new Er(super.copy().toMetadata())}};Wa=Er=(0,m.__decorate)([be("BusinessRuleSetValueDesignAction")],Wa);var Za;(function(s){s.DataSource="DataSource",s.Page="Page"})(Za||(Za={}));var Ar;let Ka=Ar=class extends lt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleSetValueItem",this.scope=e?.scopeId??"",this.scope==="null"&&(this.scope="")}clone(){return new Ar(this.toMetadata())}copy(){return new Ar({...super.copy().toMetadata(),scopeId:this.scope})}toMetadata(){return{...super.toMetadata(),scopeId:this.scope}}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();if(!t)return[];const n={path:t};return this.scope!==""&&(n.applicability=Za.DataSource,n.scope=this.scope),[n]}isAttributeUsed(e,t){return this.expression.path===t&&fr(this.scope,e)}hasScopeAttributes(e){return fr(this.scope,e)}};Ka=Ar=(0,m.__decorate)([be("BusinessRuleSetValueItem"),(0,m.__metadata)("design:paramtypes",[Object])],Ka);var xr;let Ja=xr=class extends lt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues",this.items=[],e&&(this.items=e.items?.map(t=>new Ka(t)))}getExpressionAffectedItems(){return[]}clone(){return new xr(this.toMetadata())}copy(){return new xr({...super.copy().toMetadata(),items:this.items.map(e=>e.toMetadata())})}toMetadata(){const e={...super.toMetadata(),items:this.items?.length>0?this.items.map(t=>t.toMetadata()):[]};return this.items?.length>0&&(delete e.expression,delete e.value),e}getApplicability(){return this.items?.length?this.items.flatMap(e=>e.getApplicability()):[]}isValid(){return this.items?.length>0&&this.items.every(e=>e.isValid())}getAffectedItems(){const t=(this.items??[]).map(n=>n.getAffectedItems()).flat();return[...super.getAffectedItems(),...t]}getRequiredItems(){return this.getAffectedItems()}isAttributeUsed(e,t){return this.items.some(n=>n.isAttributeUsed(e,t))}hasScopeAttributes(e){return this.items.some(t=>t.hasScopeAttributes(e))}};Ja=xr=(0,m.__decorate)([be("BusinessRuleSetValuesDesignAction"),(0,m.__metadata)("design:paramtypes",[Object])],Ja);var Rr;let Ya=Rr=class extends Mn{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"}clone(){return new Rr(this.toMetadata())}copy(){return new Rr({...this.toMetadata(),uId:D()})}};Ya=Rr=(0,m.__decorate)([be("BusinessRuleShowElementDesignAction")],Ya);class wn{get(e){return e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"?new Ya(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"?new ja(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement"?new Ua(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement"?new ka(e):e.typeName===el?new $a(e):e.typeName===tl?new za(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup"?new Fa(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter"?new qa(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"?new Wa(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues"?new Ja(e):new lt(e)}static{this.\u0275fac=function(t){return new(t||wn)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:wn,factory:wn.\u0275fac,providedIn:"root"})}}var Tr;(function(s){s[s.Condition=0]="Condition",s[s.Action=1]="Action",s[s.Trigger=2]="Trigger",s[s.Context=3]="Context",s[s.Unknown=4]="Unknown"})(Tr||(Tr={}));const bh="crt-business-rules-cache";class Ch{}class In extends Ch{constructor(e,t,n){super(),this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._cachedLoadScopesRequests=new Map,this.serviceEndpoint="/ServiceModel/BusinessRulesManagerService.svc/",this.getBusinessRulesConfigMethodName="GetBusinessRules"}_getBusinessRulesCache(){return this._cache?(0,c.of)(this._cache):(0,c.from)(this._cacheManager.get(bh)).pipe((0,c.tap)(e=>this._cache=e))}_getCachedBusinessRulesScopes(e){return e.length?this._getBusinessRulesCache().pipe((0,c.switchMap)(t=>{const n=e.map(i=>{const a=this._getContextCacheKey(i.scopeType,i.scopeName);return(0,c.from)(t.get(a)).pipe((0,c.map)(o=>o?{rules:o,scopeName:i.scopeName,scopeType:i.scopeType}:null))});return(0,c.forkJoin)(n)}),this._measurePerformanceService.measure$("BusinessRulesManager: get business rules from cache")):(0,c.of)([])}_getScopeType(e){return e==="Model"?Ge.Model:Ge.ViewModel}_mapResponseToBusinessRules(e){return!e?.businessRules||e.businessRules.length===0?[]:e.businessRules.map(t=>{const n=JSON.parse(t.businessRulesConfig);return{scopeName:t.schemaName,scopeType:this._getScopeType(t.type),rules:n}})}_getContextsScopeNames(e){return e.map(t=>t.scopeName)}_getContextCacheKey(e,t){return`Type:#${e}#-Name:#${t}#`}_getContextsScopeNamesRequestKey(e){return e.map(n=>this._getContextCacheKey(n.scopeType,n.scopeName)).join("_")}_getCachedLoadScopesRequest(e){const t=e.map(i=>this._getContextCacheKey(i.scopeType,i.scopeName)),n=[...this._cachedLoadScopesRequests.keys()].find(i=>t.every(a=>i.includes(a)));return this._cachedLoadScopesRequests.get(n)}_getNotLoadedBusinessRulesScopes(e){if(e.length===0)return(0,c.of)([]);const t=this._getContextsScopeNames(e),n=this._getCachedLoadScopesRequest(e);if(n)return n.request$.pipe((0,c.map)(l=>l.filter(d=>t.includes(d.scopeName))));const i=`${this.serviceEndpoint}${this.getBusinessRulesConfigMethodName}`,a={scopes:Array.from(new Map(e.map(l=>[this._getContextCacheKey(l.scopeType,l.scopeName),{name:l.scopeName,type:l.scopeType,modelType:l.modelType}])).values())},o=this._httpClient.post(i,a).pipe((0,c.map)(l=>this._mapResponseToBusinessRules(l)),(0,c.switchMap)(l=>l.length?this._getBusinessRulesCache().pipe((0,c.switchMap)(d=>{const h=l.map(p=>{const g=this._getContextCacheKey(p.scopeType,p.scopeName);return(0,c.from)(d.set(g,p.rules))});return(0,c.forkJoin)(h).pipe((0,c.map)(()=>l))}),this._measurePerformanceService.measure$("BusinessRulesManager: set loaded business rules to cache")):(0,c.of)(l)),(0,c.tap)(()=>{const l=this._getContextsScopeNamesRequestKey(e);this._cachedLoadScopesRequests.delete(l)}),(0,c.share)());return this._cachedLoadScopesRequests.set(this._getContextsScopeNamesRequestKey(e),{request$:o,scopeNames:t}),o}getBusinessRulesByContexts(e){const t=e.filter(n=>n.scopeName&&n.modelType!=="crt.PageParametersDataSource");return this._getCachedBusinessRulesScopes(t).pipe((0,c.switchMap)(n=>{const i=t.filter(o=>!n?.some(l=>l?.scopeName===o.scopeName&&l.scopeType===o.scopeType));return this._getNotLoadedBusinessRulesScopes(i).pipe((0,c.map)(o=>[...n,...o].filter(Boolean)),(0,c.catchError)(o=>{const l=t?.map(d=>d.scopeName).join(", ");return console.warn(`An error occurred during getting business rules execution for scopes: ${l}.`,o),(0,c.of)([])}))}))}clearCachedBusinessRules(){return this._getBusinessRulesCache().pipe((0,c.switchMap)(e=>(0,c.from)(e.clear())),(0,c.map)(()=>!0),this._measurePerformanceService.measure$("BusinessRulesManager: clear business rules from cache"))}static{this.\u0275fac=function(t){return new(t||In)(r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(fe),r.\u0275\u0275inject(z))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:In,factory:In.\u0275fac,providedIn:"root"})}}var H;(function(s){s.ChangeAttributeValue="ChangeAttributeValue",s.ChangeAttributeProperty="ChangeAttributeProperty",s.DataLoaded="DataLoaded",s.ContextReady="ContextReady"})(H||(H={}));const nl=new Map([[0,H.ChangeAttributeValue],[1,H.ChangeAttributeProperty],[2,H.DataLoaded]]);function Pr(s){return nl.has(s)?nl.get(s):H.DataLoaded}class Ei{canExecute(e,t,n){const i=n.map(o=>o.triggers).flat();return i.length===0?!1:(e?.triggers??[]).some(o=>o.type===H.ContextReady)?n.some(o=>o.triggers.some(l=>Pr(l.type)===H.DataLoaded&&!l.name)):i.some(o=>{const l=Pr(o.type);if(l===H.DataLoaded&&e.scopeType===Ge.Model)return e.triggers.some(h=>h.type===H.DataLoaded);if(!o.scopeId)return e.triggers.some(h=>h.name===o.name&&h.type===l);const d=t.find(h=>h.scopeId===o.scopeId);return d==null?!1:d.triggers.some(h=>h.name===o.name&&h.type===l)})}static{this.\u0275fac=function(t){return new(t||Ei)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ei,factory:Ei.\u0275fac})}}const Sh="Terrasoft.Core.BusinessRules.Models.Conditions.BusinessRuleGroupCondition";function il(s){return s&&"path"in s?s.path:""}function vh(s){const e=[];return s.conditions&&s.conditions.forEach(t=>{const n=sl(t);e.push(...n)}),e}function sl(s){if(rl(s))return vh(s);const e=s;return[il(e.leftExpression),il(e.rightExpression)].filter(t=>t)}function Mh(s,e){return s.flatMap(t=>e.get(t).getRequiredItems()).map(t=>t.name)}function rl(s){return s.typeName===Sh}function al(s){return s.map(e=>sl(e)).flat().filter(e=>e!=null)}function wh(s,e){return s.flatMap(t=>t.cases.flatMap(n=>Mh(n.actions,e)))}function Ih(s){return!s.cases||s.cases.length===0?[]:s.cases.map(e=>e.condition).filter(e=>e!=null)}function ol(s){return s.map(e=>Ih(e)).flat()}const Eh=[Pt.Const,Pt.SysValue,Pt.SysSetting],Ah=new Set(Eh);function cl(s){return s?!!s.type&&Ah.has(s.type):!0}function xh(s){return s.conditions?s.conditions.every(e=>ll(e)):!1}function ll(s){if(!s)return!1;if(rl(s))return xh(s);const e=s;return(0,v.isNil)(e.leftExpression)&&(0,v.isNil)(e.rightExpression)?!1:cl(e.leftExpression)&&cl(e.rightExpression)}function ul(s){return s.some(e=>e.type===H.ContextReady)}function Rh(s,e){return ul(s)?e.some(t=>ll(t)):!1}function Th(s,e){return ul(s)?e.some(t=>t.cases?.some(n=>!n.condition)):!1}class Ai{_canExecuteByConditionsAttributePaths(e,t){const n=e.filter(a=>a.type!==H.DataLoaded).map(a=>a.name);if(!n||n.length===0)return!1;const i=new Set(al(t));return n.some(a=>i.has(a))}canExecute(e,t){if(!t||t.length===0)return!1;const n=ol(t),i=Rh(e.triggers,n),a=Th(e.triggers,t);return i||a?!0:this._canExecuteByConditionsAttributePaths(e.triggers,n)}static{this.\u0275fac=function(t){return new(t||Ai)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ai,factory:Ai.\u0275fac})}}class Xa extends Error{constructor(e){super(`Argument with name '${e}' is empty.`)}}class G{static checkArgumentEmpty(e,t){if(t==null)throw new Xa(e)}static checkArrayEmpty(e,t){if(G.checkArgumentEmpty(e,t),t.length===0)throw new Xa(e)}static checkStringIsNotEmpty(e,t){if(this.checkArgumentEmpty(e,t),t==="")throw new Xa(e);return t}static checkArgumentOutOfRange(e,t,n){if(n.begin&&t<n.begin)throw new dr(e);if(n.end&&t>n.end)throw new dr(e)}static checkEnumOutOfRange(e,t,n){if(!n||!Object.values(n).includes(t))throw new dr(e)}}class Ph{get closed(){return this._closed}constructor(e){this._initialTeardown=e,this._closed=!1}unsubscribe(){this._closed||(this._closed=!0,(0,v.isFunction)(this._initialTeardown)&&this._initialTeardown())}}var Nh=y(52874);const Dh=new r.InjectionToken("MessageChannelAccessTokenFactory");var dl=y(66736);class xi{constructor(e){this._zone=e,this._message$=new c.Subject}init(e,t){return this._zone.runOutsideAngular(()=>{const n=t?{accessTokenFactory:t,withCredentials:!0}:void 0;return this._connection=new dl.HubConnectionBuilder().withUrl(e,n).withAutomaticReconnect().withHubProtocol(new dl.JsonHubProtocol).build(),this._connection.on("ServerMessage",i=>this._zone.run(()=>this._message$.next(i))),(0,c.from)(this._connection.start())})}sendMessage(e){return(0,c.from)(this._connection.send("SendMessage",e))}getMessages(){return this._message$}ngOnDestroy(){this._connection.off("ServerMessage"),this._message$.complete(),this._connection.stop().then()}static{this.\u0275fac=function(t){return new(t||xi)(r.\u0275\u0275inject(r.NgZone))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:xi,factory:xi.\u0275fac,providedIn:"root"})}}var Vh=y(5766);const Oh=1e3,hl=3e4,pl=1e4,ml="ping",Qa="pong";class Ri{constructor(e){this._ngZone=e}_createHeartbeatRequestMessage(){return{Id:D(),Header:{Sender:"ConsoleCommand",BodyTypeName:"System.String"},Body:ml}}_isHeartbeatRequestMessage(e){const t=e.Header?.Sender==="ConsoleCommand",n=e.Body===ml;return t&&n}_isHeartbeatResponseMessage(e){const t=e.Header?.Sender==="CommandService",n=e.Body===Qa;return t&&n}startHeartbeat(e){this.stopHeartbeat(),this._ngZone.runOutsideAngular(()=>{console.log(`WS-Heartbeat: connection ping scheduled for every [${hl/1e3}] sec`);const t=(0,c.timer)(Oh,hl).pipe((0,c.tap)(()=>{e.next(this._createHeartbeatRequestMessage())}),(0,c.concatMap)(()=>(0,c.race)(e.pipe((0,c.filter)(n=>this._isHeartbeatResponseMessage(n)),(0,c.take)(1),(0,c.map)(n=>n.Body)),(0,c.of)("timeout").pipe((0,c.delay)(pl)))));this._subscription=t.subscribe(n=>{switch(n){case Qa:console.log(`WS-Heartbeat: Server responded with: ${Qa}`);break;case"timeout":console.error(`WS-Heartbeat: Server failed to respond in ${pl/1e3} seconds`);break}})})}stopHeartbeat(){this._subscription?.unsubscribe()}excludeHeartbeatResponses(){return(0,c.filter)(e=>!this._isHeartbeatRequestMessage(e)&&!this._isHeartbeatResponseMessage(e))}ngOnDestroy(){this.stopHeartbeat()}static{this.\u0275fac=function(t){return new(t||Ri)(r.\u0275\u0275inject(r.NgZone))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ri,factory:Ri.\u0275fac,providedIn:"root"})}}const fl=[1,2e3,5e3,1e4,2e4,...Array(10).fill(3e4)],Bh=fl.length;class Ti{constructor(e){this._heartbeatService=e,this._reconnectAttempts=0,this._webSocketCreated$=new c.ReplaySubject(1),this._reconnected$=new c.Subject,this._isInitialConnection=!0}get reconnected$(){return this._reconnected$.asObservable()}_maxReconnectAttemptsReached(){return this._reconnectAttempts>=Bh}_resetReconnectAttempts(){this._reconnectAttempts=0}_getWebSocketUrl(){var e=this;return(0,b.A)(function*(){const t=yield e._accessTokenFactory?.();return t?`${e._serverUrl}?access_token=${encodeURIComponent(t)}`:e._serverUrl})()}_scheduleReconnectionAttempt(e){if(this._maxReconnectAttemptsReached()){console.error("WebSocket: Max reconnect attempts reached",e);return}const t=fl[this._reconnectAttempts];setTimeout(()=>{this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!0}).catch(console.error),this._reconnectAttempts++},t)}_handleWebSocketClosed(e){this._heartbeatService.stopHeartbeat(),this._scheduleReconnectionAttempt(e)}_createAndConnectWebSocketAsync(e){var t=this;return(0,b.A)(function*(){let n;try{n=yield t._getWebSocketUrl()}catch(i){throw e.reconnectOnAccessTokenFactoryError&&t._scheduleReconnectionAttempt(i),i}return new Promise(i=>{t._webSocket$=(0,Vh.webSocket)({url:n,openObserver:{next:()=>{console.log(`Websocket channel opened for url: ${t._serverUrl}`),t._heartbeatService.startHeartbeat(t._webSocket$),t._resetReconnectAttempts(),t._isInitialConnection||(console.log("WebSocket reconnected successfully"),t._reconnected$.next()),t._isInitialConnection=!1,i()}}}),t._webSocketSubscription?.unsubscribe(),t._webSocketSubscription=t._webSocket$.subscribe({error:a=>t._handleWebSocketClosed(a),complete:()=>t._handleWebSocketClosed()}),t._webSocketCreated$.next(t._webSocket$)})})()}_subscribeToSocketMessages(e,t){return e.pipe(this._heartbeatService.excludeHeartbeatResponses()).subscribe({next:n=>t.next(n),error:()=>{this._maxReconnectAttemptsReached()&&t.error(new Error("Max reconnect attempts reached"))}})}init(e,t){return this._serverUrl=e,this._accessTokenFactory=t,(0,c.from)(this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!1}))}sendMessage(e){return new c.Observable(t=>{this._webSocket$.next(e),t.next(),t.complete()})}getMessages(){return new c.Observable(e=>{let t;const n=this._webSocketCreated$.subscribe(i=>{t?.unsubscribe(),t=this._subscribeToSocketMessages(i,e)});return()=>{t.unsubscribe(),n.unsubscribe()}})}ngOnDestroy(){this._heartbeatService.stopHeartbeat(),this._webSocket$?.complete(),this._webSocketSubscription?.unsubscribe(),this._reconnected$.complete()}static{this.\u0275fac=function(t){return new(t||Ti)(r.\u0275\u0275inject(Ri))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ti,factory:Ti.\u0275fac,providedIn:"root"})}}var eo;(function(s){s.Production="production",s.PreProduction="pre-production",s.Development="development"})(eo||(eo={}));const gl=ye.create({serviceUrl:"",clientConnectionClassName:""}),U_={provide:ye,useFactory:()=>gl};let Pi=class na{constructor(e,t,n){this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._serviceEndpoint="ServiceModel/ApplicationInfoService.svc/"}_initApplicationInfo(){const e=this._serviceEndpoint+"GetApplicationInfo";this._applicationInfoObservable$=this._cacheManager.executeWithCache(Ac,Ld,this._httpClient.post(e,null)).pipe(this._measurePerformanceService.measure$("ApplicationInfoService: load application info with cache"),(0,u.map)(t=>{const n=t?.applicationInfo,i=ye.create(n);return Object.assign(gl,i),t}),(0,u.shareReplay)({bufferSize:1,refCount:!1})),this._applicationInfoObservable$.subscribe()}loadApplicationInfo(){return this._applicationInfoObservable$||this._initApplicationInfo(),this._applicationInfoObservable$}loadApplicationResources(){const e=this._serviceEndpoint+"GetApplicationResources";return this._cacheManager.executeWithCache(Ac,"AppResources",this._httpClient.post(e,null))}loadSysValues(){return this.loadApplicationInfo().pipe((0,u.map)(e=>e?.applicationInfo?.sysValues))}getCoreVersion(){return this._coreVersion?(0,c.of)(this._coreVersion):this.loadSysValues().pipe((0,c.tap)(e=>this._coreVersion=e?.coreVersion),(0,u.map)(()=>this._coreVersion))}getIsProductionEnvironment(){return(this._environmentType?(0,c.of)(this._environmentType):this.loadSysValues().pipe((0,c.tap)(t=>this._environmentType=t?.environmentType),(0,u.map)(()=>this._environmentType))).pipe((0,u.map)(t=>t===eo.Production))}static{this.\u0275fac=function(t){return new(t||na)(r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(fe),r.\u0275\u0275inject(z))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:na,factory:na.\u0275fac,providedIn:"root"})}};Pi=(0,m.__decorate)([on({requestType:"crt.SysValuesService"}),(0,m.__metadata)("design:paramtypes",[O.HttpClient,fe,z])],Pi);const z_={provide:r.APP_INITIALIZER,useFactory:s=>()=>s.loadApplicationInfo(),deps:[Pi],multi:!0};let Nr=class ia{get reconnected$(){return this.msgChannel?.reconnected$||c.EMPTY}constructor(e,t,n,i){this.injector=i,this._destroyed$=new c.Subject,this.init$=new c.ReplaySubject(1),this.messageEvent$=new c.Subject,!e.clientConnectionClassName||e.clientConnectionClassName===""?t.loadApplicationInfo().subscribe(a=>{this._initialize(a.applicationInfo,n)}):this._initialize(e,n)}_initialize(e,t){this.msgChannel=this._getChannel(e.clientConnectionClassName),this._initChannel(e.serviceUrl,t)}_getChannel(e){switch(e){case"Terrasoft.WebSocketChannel":return this.injector.get(Ti);case"Terrasoft.SignalRChannel":return this.injector.get(xi)}}_buildMessageEvent(e){let t;if(e.Body&&typeof e.Body=="string")try{t=JSON.parse(e.Body)}catch(n){return(0,r.isDevMode)()&&console.warn(`MessageChannelService. Parse error: ${n}`),null}else e.Body&&typeof e.Body=="object"&&(t=e.Body);return{header:{sender:e?.Header?.Sender,bodyTypeName:e?.Header?.BodyTypeName},body:t,id:e.Id}}_subscribeToMsgChannel(){this.msgChannel.getMessages().pipe((0,u.takeUntil)(this._destroyed$)).subscribe(e=>{const t=this._buildMessageEvent(e);t&&this.messageEvent$.next(t)})}_initChannel(e,t){this.msgChannel.init(e,t).subscribe({complete:()=>{this.init$.next(this.msgChannel),this._subscribeToMsgChannel()}})}_sendMessageInternal(e,t,n){const i={Id:Nh.Guid.create().toString(),Header:{Sender:e,BodyTypeName:"System.String",ChannelType:t},Body:JSON.stringify(n)};return this.init$.pipe((0,c.take)(1),(0,u.switchMap)(()=>this.msgChannel.sendMessage(i)))}getMessages(e){return G.checkArgumentEmpty("sender",e),this.messageEvent$.pipe((0,u.filter)(t=>t.header.sender===e))}subscribe(e,t){G.checkArgumentEmpty("sender",e),G.checkArgumentEmpty("callback",t);const n=this.getMessages(e).subscribe(t);return Promise.resolve(new Ph(()=>n.unsubscribe()))}sendMessage(e,t,n){let i,a;const o=!!n;o?(i=e,a=t,G.checkStringIsNotEmpty("sender",i),G.checkEnumOutOfRange("channelType",n,Ii)):(a=e,i=t,G.checkArgumentEmpty("channelType",i),G.checkEnumOutOfRange("channelType",i,Ii));const l=this._sendMessageInternal(i,n,a);return o?(0,c.firstValueFrom)(l):l}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.init$.complete(),this.messageEvent$.complete()}static{this.\u0275fac=function(t){return new(t||ia)(r.\u0275\u0275inject(ye),r.\u0275\u0275inject(Pi),r.\u0275\u0275inject(Dh,8),r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ia,factory:ia.\u0275fac,providedIn:"root"})}};Nr=(0,m.__decorate)([on({requestType:"crt.MessageChannelService"}),(0,m.__metadata)("design:paramtypes",[ye,Pi,Function,r.Injector])],Nr);class to extends mr{constructor(){super(...arguments),this.requestType="crt.FeatureService"}}(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],to.prototype,"getFeatureState",void 0),(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],to.prototype,"getFeaturesState",void 0);class Ni{constructor(e,t){this._businessRulesManager=e,this._businessRuleDesignActionFactory=t,this._scopeAttributes=[]}_filterTriggers(e,t){const n=t.filter(o=>o.scopeName===e.parentScopeId),a=t.find(o=>o.scopeName===e.scopeName&&o.scopeType===e.scopeType)?.rules.map(o=>o.triggers).flat();return e.triggers.filter(o=>{if(o.type===H.ContextReady||o.type===H.DataLoaded)return!0;const l=a?.some(p=>p&&p.name===o.name&&Pr(p.type)===o.type),h=n.flatMap(p=>p.rules.flatMap(g=>g.triggers)).some(p=>p.name===o.name&&Pr(p.type)===o.type);return l||h})}_filterAttributes(e){const n=this._scopeAttributes.filter(o=>o.scopeName===e.scopeName).map(o=>o.attributes).flat(),i=this._scopeAttributes.filter(o=>o.scopeName!==e.scopeName).flatMap(o=>[...o.attributes]);return e.attributes.filter(o=>n.includes(o.attributeName)||i.includes(o.attributeName)||o.isSignificant)}_cacheUsedAttributes(e){e.forEach(t=>{if(!this._scopeAttributes.find(n=>n.scopeName===t.scopeName&&n.scopeType===t.scopeType)){const n=ol(t.rules),i=al(n),a=wh(t.rules,this._businessRuleDesignActionFactory),o=t.rules.flatMap(l=>l.triggers?.map(d=>d.name)).filter(Boolean);this._scopeAttributes.push({scopeName:t.scopeName,scopeType:t.scopeType,attributes:[...i,...a,...o]})}})}_hasActiveRules(e,t){return(t.find(o=>o.scopeName===e.scopeName&&o.scopeType===e.scopeType)?.rules??[]).filter(o=>o.enabled===!0).length>0}clearCachedScopeAttributes(){this._scopeAttributes=[]}filter(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,c.tap)(t=>this._cacheUsedAttributes(t)),(0,c.map)(t=>e.map(i=>({...i,attributes:this._filterAttributes(i),triggers:this._filterTriggers(i,t)})).filter(i=>this._hasActiveRules(i,t)?!0:i.attributes.length>0)))}static{this.\u0275fac=function(t){return new(t||Ni)(r.\u0275\u0275inject(In),r.\u0275\u0275inject(wn))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ni,factory:Ni.\u0275fac,providedIn:"root"})}}class Di{constructor(e,t,n,i,a,o,l){this._businessRulesManager=e,this._businessRulesTriggerExecutor=t,this._businessRulesConditionExecutor=n,this._httpClient=i,this._messageChannelService=a,this._featureService=o,this._contextFilter=l,this._businessRulesResponseEventName="BusinessRuleExecutionResponse",this._serviceUrl="ServiceModel/BusinessRulesEngineService.svc/Execute",this._businessRulesRequestEventName="BusinessRuleExecutionRequest",this._businessRuleDesignActionFactory=new wn,this._configurationStructureChangedSubscribe()}_configurationStructureChangedSubscribe(){this._messageChannelService.getMessages("ConfigurationStructureChanged").pipe((0,u.switchMap)(()=>(this._contextFilter.clearCachedScopeAttributes(),this._businessRulesManager.clearCachedBusinessRules()))).subscribe()}_featureStates(){return(0,c.from)(this._featureService.getFeaturesState(["BRules-UseWebSocketChannel","BRules-DisableContextOptimization"])).pipe((0,u.map)(([e,t])=>({useHttpChannel:!e,disableContextOptimization:t})))}_sendWebSocketMessage(e){const t=D();return e.businessRulesSessionId=t,new c.Observable(n=>{const i=this._messageChannelService.messageEvent$.pipe((0,u.map)(a=>a.body),(0,u.filter)(a=>a!=null),(0,u.filter)(a=>a.eventName===this._businessRulesResponseEventName),(0,u.filter)(a=>a.businessRulesSessionId===t),(0,u.map)(a=>a.payload)).subscribe({next:a=>{i.unsubscribe(),a.success?n.next(a.businessRulesResponse):(console.error("An error occurred during business rules execution. "+a.errorInfo.errorCode+": "+a.errorInfo.message),n.next([])),n.complete()},error:a=>{i.unsubscribe(),console.error("An error occurred during business rules execution. "+a.errorCode+": "+a.message),n.next([]),n.complete()},complete:()=>{i.unsubscribe(),n.error("WebSocket channel closed")}});this._messageChannelService.sendMessage(e,Ii.PTP).pipe((0,c.take)(1)).subscribe()})}_createWebSocketRequest(e){return{eventName:this._businessRulesRequestEventName,contexts:e}}_executeUsingWebSocket(e){const t=this._createWebSocketRequest(e);return this._sendWebSocketMessage(t)}_logErrorMessageAndReturnDefBusinessRuleResponse(e){return console.error("An error occurred during business rules execution. "+e.errorCode+": "+e.message),(0,c.of)([])}_executeUsingHttp(e){return this._httpClient.post(this._serviceUrl,{contexts:e},{headers:new O.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,u.mergeMap)(t=>t.success?(0,c.of)(t.businessRulesResponse):this._logErrorMessageAndReturnDefBusinessRuleResponse(t.errorInfo)),(0,u.catchError)(t=>this._logErrorMessageAndReturnDefBusinessRuleResponse(t)))}_canExecuteBusinessRulesByContexts(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,u.map)(t=>{const n=t.filter(i=>i.rules&&i.rules.length>0);return n.length===0?!1:n.some(i=>{const a=e.find(h=>h.scopeName===i.scopeName&&h.scopeType===i.scopeType),o=e.filter(h=>h.parentScopeId===a.scopeId),l=this._businessRulesTriggerExecutor.canExecute(a,o,i.rules),d=this._businessRulesConditionExecutor.canExecute(a,i.rules);return l||d})}))}_getContextsWithScope(e){return e.filter(t=>t.scopeName&&t.scopeId)}_getBusinessRuleActions(e){return e.cases.map(t=>t.actions).flat().filter(t=>t.enabled).map(t=>this._businessRuleDesignActionFactory.get(t))}_getBusinessRuleAffectedAttributes(e){return this._getBusinessRuleActions(e).map(n=>n.getAffectedItems()).flat()}_getAffectedAttributes(e){let t=e.rules.filter(n=>n.enabled).map(n=>this._getBusinessRuleAffectedAttributes(n)).flat();return t=this._getUniqueAffectedAttributes(t),t.forEach(n=>{n.scopeName=e.scopeName}),t}_getUniqueAffectedAttributes(e){const t=e.map(i=>[i.name,i]);return[...new Map(t).values()]}_execute(e){return this._featureStates().pipe((0,u.switchMap)(({useHttpChannel:t,disableContextOptimization:n})=>(0,c.forkJoin)({useHttpChannel:(0,c.of)(t),executionContexts:n?(0,c.of)(e):this._contextFilter.filter(e)})),(0,u.switchMap)(({useHttpChannel:t,executionContexts:n})=>(t?this._executeUsingHttp(n):this._executeUsingWebSocket(n)).pipe((0,u.map)(i=>({executionResults:i,executionContexts:n})))),(0,u.switchMap)(({executionResults:t,executionContexts:n})=>this._logUnsuccessfulBusinessRulesExecution(t,n).pipe((0,u.map)(()=>t))))}_logUnsuccessfulBusinessRulesExecution(e,t){const n=e?.filter(i=>i?.errors?.length>0).map(i=>i.errors).flat();return n?.length===0?(0,c.of)(void 0):(0,c.from)(this._featureService.getFeatureState("BRules-ShowChildRules")).pipe((0,u.switchMap)(i=>this._businessRulesManager.getBusinessRulesByContexts(t).pipe((0,u.map)(a=>a.map(o=>o.rules).flat()),(0,u.tap)(a=>{n.map(o=>this._getUnsuccessfulBusinessRuleExecutionMessage(o,a,i)).forEach(o=>{console.error(o)})}),(0,u.map)(()=>{}))))}_getUnsuccessfulBusinessRuleExecutionMessage(e,t,n){const i="Business rule execution error: ",a=`Error message: "${e.message}"`,o=e.type===Tr.Unknown?"":`The error occurred in the business rule ${Tr[e.type]?.toLocaleLowerCase()}s.`;let l=t.find(C=>C.uId===e.businessRuleId);if(!l)return`${i}Rule id - "${e.businessRuleId}". ${a}. ${o}`;!ju(l.parentUId)&&!n&&(l=t.find(C=>C.uId===l.parentUId));const d=l.caption||"",h=l.name,p=`Rule Title - "${d}"`,g=`Rule Code - "${h}"`;return`${i}${p}, ${g}. ${a}. ${o}`}execute(e){const t=this._getContextsWithScope(e);return t.length===0?(0,c.of)([]):this._canExecuteBusinessRulesByContexts(e).pipe((0,u.switchMap)(n=>n?this._execute(t):(0,c.of)([])),(0,u.catchError)(n=>(console.warn(`An error occurred during business rules execution for scopes: ${e?.map(i=>i.scopeName).join(", ")}.`,n),(0,c.of)([]))))}getAffectedAttributes(e){var t=this;return(0,b.A)(function*(){if(e.length===0)return[];const n=e.filter(o=>o.scopeName!=null),a=(yield(0,c.firstValueFrom)(t._businessRulesManager.getBusinessRulesByContexts(n))).filter(o=>o.rules&&o.rules.length>0);return a.length===0?[]:a.map(o=>t._getAffectedAttributes(o)).flat()})()}static{this.\u0275fac=function(t){return new(t||Di)(r.\u0275\u0275inject(In),r.\u0275\u0275inject(Ei),r.\u0275\u0275inject(Ai),r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(Nr),r.\u0275\u0275inject(to),r.\u0275\u0275inject(Ni))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Di,factory:Di.\u0275fac})}}class Dt{static{this._actionAppliers=new Map}static register(e,t){Dt._actionAppliers.set(e,t)}get(e){const t=Dt._actionAppliers.get(e.typeName);if(!t)throw new Error(`Business rule applier for change type ${e.typeName} not found.`);return new t(e)}static{this.\u0275fac=function(t){return new(t||Dt)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Dt,factory:Dt.\u0275fac})}}class Vi{constructor(e){this._actionApplierFactory=e}_applyBusinessRuleAction(e,t,n){const i=this._actionApplierFactory.get(n);return(0,c.firstValueFrom)(i.apply(e,t))}_applyBusinessRule(e,t){var n=this;return(0,b.A)(function*(){const i={id:t.scopeId,name:t.scopeName,type:t.scopeType,triggers:t.triggers};if(t.actions.length===0)return Promise.resolve(null);const a=[];for(const o of t.actions){const l=yield n._applyBusinessRuleAction(e,i,o);a.push(l)}return a})()}_applyBusinessRules(e,t){var n=this;return(0,b.A)(function*(){const i=[];for(const a of t){const o=yield n._applyBusinessRule(e,a);i.push(o)}return i})()}applyRules(e,t){return t&&t.length>0?(0,c.from)(this._applyBusinessRules(e,t)):(0,c.of)(null)}static{this.\u0275fac=function(t){return new(t||Vi)(r.\u0275\u0275inject(Dt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Vi,factory:Vi.\u0275fac})}}class kh{constructor(e={preventAttributeChangeRequest:!1,preventRunBusinessRules:!1,preventStateChange:!1,isMaskedValue:!1}){this._preventAttributeChangeRequest=!1,this._preventStateChange=!1,this._preventRunBusinessRules=!1,this._isMaskedValue=!1,this._setOptions(e)}_setUsingSilent(e){this._preventStateChange=e,this._preventRunBusinessRules=e,this._preventAttributeChangeRequest=!1}_setOptions(e){this._preventAttributeChangeRequest=e?.preventAttributeChangeRequest??this._preventAttributeChangeRequest,this._preventStateChange=e?.preventStateChange??this._preventStateChange,this._preventRunBusinessRules=e?.preventRunBusinessRules??this._preventRunBusinessRules,this._isMaskedValue=e?.isMaskedValue??this._isMaskedValue}getAsSilent(){return this._preventRunBusinessRules&&this._preventStateChange}getIsMaskedValue(){return this._isMaskedValue}setOptions(e){if((0,v.isUndefined)(e?.silent)){const t=(0,v.pick)(e,"preventAttributeChangeRequest","preventStateChange","preventRunBusinessRules","isMaskedValue");this._setOptions(t)}else this._setUsingSilent(e?.silent)}getOptions(){return{preventAttributeChangeRequest:this._preventAttributeChangeRequest,preventRunBusinessRules:this._preventRunBusinessRules,preventStateChange:this._preventStateChange,isMaskedValue:this._isMaskedValue}}reset(){this._preventAttributeChangeRequest=!1,this._preventRunBusinessRules=!1,this._preventStateChange=!1,this._isMaskedValue=!1}}var Dr;(function(s){s.EntityDataSource="crt.EntityDataSource",s.WebServiceDataSource="crt.WebServiceDataSource",s.PageParametersDataSource="crt.PageParametersDataSource"})(Dr||(Dr={}));var En;(function(s){s.Reload="reload",s.Merge="merge"})(En||(En={}));class no extends Error{}function H_(s){const e=Object.keys(DataValueTypeGroup).find(t=>DataValueTypeGroup[t].includes(s));return DataValueTypeGroup[e]}function G_(s){return s===DataValueType.Lookup||s===DataValueType.Guid}function q_(s){return DataValueTypeItems[s]?.icon||null}function io(s){return Object.values(Da).find(e=>e.name===s)?.type}function Lh(s){return!(s&&!s?.value)}function Fh(s){let e=!1;const t=[];return Object.keys(s).forEach(n=>{_l(n,s)&&(e=!0,t.push(n))}),{hasCycles:e,cycledModelsNames:t}}function _l(s,e,t=[]){if(!e[s])return!1;const n=Object.values(e[s]);return n.some(a=>t.includes(yl(a)))?!0:(t.push(s),!n.every(a=>!_l(yl(a),e,t)))}function yl(s){return s.relationPath.split(".")[0]}class jh{}var Vr;(function(s){s.AddTask="addTask",s.RemoveTask="removeTask"})(Vr||(Vr={}));class bl extends jh{constructor(e,t,n){super(),this.action=e,this.taskName=t,this.$context=n,this.type="crt.SchemaViewMaskRequest"}}class so extends mr{constructor(){super(...arguments),this.requestType="crt.MaskService"}showMask(e,t){return(0,b.A)(function*(){const n=new bl(Vr.AddTask,e,t);yield ot.instance.process(n)})()}hideMask(e,t){return(0,b.A)(function*(){const n=new bl(Vr.RemoveTask,e,t);yield ot.instance.process(n)})()}}(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],so.prototype,"showBodyMask",void 0),(0,m.__decorate)([Te(),(0,m.__metadata)("design:type",Function)],so.prototype,"hideBodyMask",void 0);const $h=new r.InjectionToken("DEVKIT_MASK_SERVICE",{providedIn:"root",factory:()=>new so});class Cl{constructor(e){this.ngZone=e}run(e,t,n){return this.ngZone.runOutsideAngular(e)}}class Uh extends Cl{constructor(e){super(e)}run(e,t,n){return this.ngZone.run(e,t,n)}}var ro;(function(s){s.Root="root",s.Angular="angular",s.ExecutionTracking="executionTracking"})(ro||(ro={}));var Oi;(function(s){s[s.Busy=0]="Busy",s[s.Idle=1]="Idle"})(Oi||(Oi={}));var Or;(function(s){s.ReadyStateChange="readystatechange"})(Or||(Or={}));class zh{constructor(e){this._trackedTasks=[],this._trackedEventTasks=[],this._enableDebugTracking=!1,this._disableWaits=!1,this._pendingFunctions=new Map,this.onStateChange$=new r.EventEmitter(!1),this._parentZone=Zone.current,this._rootZone=Zone.root,this._isBusy=!1,this._ignoredTaskSources=["setInterval","requestAnimationFrame"],this._eventTaskFilters=[t=>t.source.startsWith("XMLHttpRequest")&&t.source.endsWith(Or.ReadyStateChange)],this._zone=this._parentZone.fork({name:e,properties:{currentExecutionZone:this},onInvokeTask:this._onInvokeTask.bind(this),onCancelTask:this._onCancelTask.bind(this),onScheduleTask:this._onScheduleTask.bind(this),onHasTask:this._onHasTask.bind(this)})}wait(e){if(this._disableWaits)return e();this._isBusy||(this._isBusy=!0,this.onStateChange$.next(Oi.Busy));const t=D();return this._pendingFunctions.set(t,this._enableDebugTracking?e:null),e().finally(()=>{this._pendingFunctions.delete(t),!this._pendingFunctions.size&&this._zone.run(()=>new Promise(n=>setTimeout(n)))}).catch(n=>{throw n})}_cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(e,t){if(e.type==="eventTask"&&(e.state==="running"||e.state==="scheduled")){const n=e;n.eventName===Or.ReadyStateChange&&n.target.readyState===XMLHttpRequest.DONE&&t.cancelTask(n)}}_onInvokeTask(e,t,n,i,a,o){this._unTrackTask(i);let l;try{l=e.invokeTask(n,i,a,o),this._cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(i,t)}catch(d){console.error(d),t.cancelTask(i)}return l}_onCancelTask(e,t,n,i){return this._unTrackTask(i),e.zone.runGuarded(()=>e.cancelTask(n,i))}_onScheduleTask(e,t,n,i){return this._getCanScheduleTask(i)?(this._trackTask(i),e.scheduleTask(n,i)):(i.cancelScheduleRequest(),this._parentZone.scheduleTask(i))}_onHasTask(e,t,n,i){e.hasTask(n,i);const a=i.eventTask||i.macroTask||i.microTask||this._pendingFunctions.size>0;this._isBusy!==a&&(this._rootZone.run(()=>this.onStateChange$.next(a?Oi.Busy:Oi.Idle)),this._isBusy=a)}_trackTask(e){this._enableDebugTracking&&(e.type==="eventTask"&&this._trackedEventTasks.push(e),this._trackedTasks.push(e))}_unTrackTask(e){if(!this._enableDebugTracking)return;const t=this._trackedTasks.indexOf(e);t>-1&&this._trackedTasks.splice(t,1)}_getCanScheduleTask(e){return e.type==="eventTask"?this._eventTaskFilters.some(t=>t(e)):this._ignoredTaskSources.indexOf(e.source)===-1}run(e,t,n){return this._zone.run(e,t,n)}}class An{constructor(e){this._ngZone=e}createDefaultZones(){return{root:new Cl(this._ngZone),angular:new Uh(this._ngZone)}}createZone(e,t){if(t===ro.ExecutionTracking)return new zh(e);throw new Error(`Zone ${e} with type ${t} is not supported`)}static{this.\u0275fac=function(t){return new(t||An)(r.\u0275\u0275inject(r.NgZone))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:An,factory:An.\u0275fac,providedIn:"root"})}}var Vt;(function(s){s.Root="root",s.Angular="angular"})(Vt||(Vt={}));let ao=class sa{constructor(e){this._zoneProvider=e,this._zones=e.createDefaultZones()}init(e){var t=this;return(0,b.A)(function*(){t._disableExecutionTrackingZone=yield(0,c.lastValueFrom)(e("DisableExecutionTrackingZone"))})()}runInZone(e,t,n,i){return this._disableExecutionTrackingZone&&e!==Vt.Angular&&(e=Vt.Root),(this._zones[e]??this._zones[Vt.Root]).run(t,n,i)}register(e,t){if(this._zones[e])throw new Error(`Zone ${e} already registered`);const n=this._zoneProvider.createZone(e,t);return this._zones[e]=n,n}get(e){return this._zones[e]}runOutside(e){return this.runInZone(Vt.Root,e)}static{this.\u0275fac=function(t){return new(t||sa)(r.\u0275\u0275inject(An))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:sa,factory:sa.\u0275fac,providedIn:"root"})}};ao=(0,m.__decorate)([on({requestType:"crt.ZoneService"}),(0,m.__metadata)("design:paramtypes",[An])],ao);const Sl=new r.InjectionToken("CRT_METADATA_PREPROCESSOR");class Hh{constructor(e,t){this.id=e,this._baseHostInjector=t,this._hostModuleTypes=[],this._hostModuleRefs=[],this._lazyModulesBySource=new Map,this._hostInjector=this._baseHostInjector}_createDynamicNgModule(e){const n=this._hostInjector.get(Sl,[]).map(o=>({provide:Sl,useValue:o,multi:!0})),i=(0,r.NgModule)({providers:n})(class{}),a=(0,r.NgModule)({imports:[i,...e]})(class{});return(0,r.createNgModule)(a,this._hostInjector)}inject(e){return this._hostInjector.get(e)}addLazyModule(e){const t=Wc.get(e);if(!t)throw new Error("Module was not bootstrapped");const{source:n}=t;this._lazyModulesBySource.has(n)||this._lazyModulesBySource.set(n,new Set),this._lazyModulesBySource.get(n).add(e)}getLazyModules(e){return[...this._lazyModulesBySource.get(e)??[]]}connectHostLazyModules(){const e=this.getLazyModules("host");if((0,v.isEqual)(e,this._hostModuleTypes))return;const t=this._createDynamicNgModule(e);this._hostModuleTypes=e,this._hostModuleRefs.push(t),this._hostInjector=t.injector}destroy(){for(const e of this._hostModuleRefs)e.destroy();this._hostModuleRefs=[]}}class xn extends ur{constructor(){super(...arguments),this._injectionContextsMap=new Map}createContext(e,t){const n=new Hh(e,t);return this._injectionContextsMap.set(e,n),n}injectFromContext(e,t){return this._injectionContextsMap.get(e)?.inject(t)}removeContext(e){return this._injectionContextsMap.get(e)?.destroy(),this._injectionContextsMap.delete(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(xn)))(n||xn)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:xn,factory:xn.\u0275fac,providedIn:"root"})}}const Gh=new r.InjectionToken("Terrasoft global object",{providedIn:"root",factory:()=>(0,v.get)((0,r.inject)(Ie),["Terrasoft"])||{}}),qh=new r.InjectionToken("Flag indicating that this is an angular host",{providedIn:"root",factory:()=>(0,v.get)((0,r.inject)(Gh),["isAngularHost"])}),vl=100;class Rn extends ur{constructor(){super(...arguments),this._window=(0,r.inject)(Ie),this._requestBuffer=[],this._requestIter=0,this._cachedRequestIter=0,this._compressedRequestIter=0}_onRequest(e){const t=e.getEntries();for(const n of t){if(!n.name.startsWith(this._window.location.origin))return;this._requestIter++,n.transferSize||this._cachedRequestIter++,n.encodedBodySize!==n.decodedBodySize&&this._compressedRequestIter++,n.fetchStart&&n.responseStart&&n.responseEnd&&this._requestBuffer.push({name:n.name,initiatorType:n.initiatorType,transferSize:n.transferSize,responseStart:n.responseStart,responseEnd:n.responseEnd,fetchStart:n.fetchStart})}}_calculateLatency(e,t){return e/(t/1e3)/1e3/1e3||0}_normalizeUrl(e,t){try{return(e+new URL(t)?.pathname.replace("/0/","/")).slice(0,vl)}catch{return t?.slice(0,vl)}}_reset(){this._resourcePerformanceObserver?.disconnect(),this._markPerformanceObserver?.disconnect(),this._requestBuffer=[],this._compressedRequestIter=0,this._cachedRequestIter=0,this._requestIter=0}_downlink(){let e=0,t=0;return this._requestBuffer.forEach(i=>{i.initiatorType==="xmlhttprequest"&&(e+=i.transferSize,t+=i.responseEnd-i.responseStart)}),+this._calculateLatency(e,t).toFixed(1)}_withCache(){return Math.round(this._cachedRequestIter/this._requestIter*100)||0}_withCompression(){return Math.round(this._compressedRequestIter/this._requestIter*100)||0}_topRequests(e){const t=[];for(let n=this._requestBuffer.length-1;n>=0;n--){const i=this._requestBuffer[n],a=Math.round(i.responseEnd-i.fetchStart);if(a>=e.topRequestThreshold&&t.length<e.topRequestCount){const o=this._normalizeUrl(a,i.name);if(t.push(o),t.length===e.topRequestThreshold)return t}}return t}start(){this._reset(),this._resourcePerformanceObserver=this._resourcePerformanceObserver??new PerformanceObserver(this._onRequest.bind(this)),this._resourcePerformanceObserver.observe({type:"resource",buffered:!this._firstStart}),this._firstStart=!0}measure(e={topRequestThreshold:400,topRequestCount:5}){const t={transferred:0};return this._requestBuffer.sort((n,i)=>n.fetchStart-i.fetchStart),t.duration=this._calculateDuration(),t.transferred=this._calculateTransferred(),t.downlink=this._downlink(),t.cache=this._withCache(),t.compression=this._withCompression(),t.topRequests=this._topRequests(e),this._reset(),t}_calculateDuration(){let e=this._requestBuffer[0]?.responseEnd,t=this._requestBuffer[0]?.responseEnd-this._requestBuffer[0]?.fetchStart;return this._requestBuffer.forEach(n=>{e<n.fetchStart?t+=n.responseEnd-n.fetchStart:e<n.responseEnd&&(t+=n.responseEnd-e),e=Math.max(e,n.responseEnd)}),Math.round(t)||0}_calculateTransferred(){let e=this._requestBuffer.reduce((t,n)=>t+n.transferSize,0);return e=Math.round(e/1e3)||0,e}ngOnDestroy(){this._reset()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(Rn)))(n||Rn)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Rn,factory:Rn.\u0275fac,providedIn:"root"})}}var Pe;(function(s){s.PageStartLoading="PageStartLoading",s.PageFinishLoading="PageFinishLoading"})(Pe||(Pe={}));class Bi extends ur{constructor(){super(),this._ngZone=(0,r.inject)(r.NgZone),this._window=(0,r.inject)(Ie),this._featureValues=(0,r.inject)(W,{optional:!0}),this._isAngularHost=(0,r.inject)(qh,{optional:!0}),this._performanceNetworkObserver=(0,r.inject)(Rn),this._measureName="PageLoadDuration",this._debounceTime=100,this._subscriptions=new c.Subscription,this._measurements=[],this._tasks=new Set,this._loadingStarted=!1,this._loadingStartedCount=new Set,this._loadingFinishedCount=new Set,this._tasksQueueSubject=new c.Subject,this._pageLoadLifeCycleSubject=new c.Subject,this._iterationCounter=0,this.pageLoadDuration$=new c.Subject,this._enableMeasurement=!!this._isAngularHost&&!this._featureValues?.DisablePerformancePageLoadMeasurement,this._initSubscriptions(),(0,v.set)(this._window,"creatio.performance.measurePerformancePageLoadService",this)}_initSubscriptions(){this._enableMeasurement&&(this._subscriptions.add(this._tasksQueueSubject.pipe((0,c.debounceTime)(this._debounceTime),(0,u.filter)(e=>this._loadingStartedCount.size===this._loadingFinishedCount.size&&this._loadingStarted&&e.size===1&&e.has(Pe.PageStartLoading))).subscribe({next:()=>this._pageLoadLifeCycleSubject.next(Pe.PageFinishLoading)})),this._subscriptions.add(this._pageLoadLifeCycleSubject.subscribe({next:e=>{this._ngZone.runOutsideAngular(()=>{e===Pe.PageStartLoading&&this._onStartPageLoadMeasure(),e===Pe.PageFinishLoading&&this._onEndPageLoadMeasure()})}})))}_onStartPageLoadMeasure(){this.addTask(Pe.PageStartLoading)}_getLocationInfo(){const e=this._window.location.hash,[t,n]=e.slice(1).split("/");return{moduleName:t,schemaName:n,hash:e}}_getMeasurementDetail(){const t=((0,v.get)(this._window,"creatio.performance")??{}).focusLossDuringLoad,n={iteration:this._iterationCounter++,location:this._getLocationInfo(),isReuse:!!this._isReuseMode,focusLossDuringLoad:!!t};return this._featureValues.DisablePerformancePageNetworkMeasurement||(n.network=this._performanceNetworkObserver.measure()),n}_onEndPageLoadMeasure(){this.removeTask(Pe.PageFinishLoading),this.removeTask(Pe.PageStartLoading);const e={start:this._startTime,detail:this._getMeasurementDetail(),end:this._window.performance.now()};this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this.pageLoadDuration$.next(e),this._reset()}_reset(){const e=(0,v.get)(this._window,"creatio.performance");e.initialLoad?e.initialLoad=!1:e.focusLossDuringLoad=null,this._startTime=null,this._tasks.clear(),this._loadingStarted=!1,this._loadingStartedCount.clear(),this._loadingFinishedCount.clear(),this._isReuseMode=null}setReuseMode(e){this._enableMeasurement&&this._isReuseMode===null&&(this._isReuseMode=e)}startPageLoadMeasure(e=performance.now()){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{this._reset(),this._startTime=e,this._pageLoadLifeCycleSubject.next(Pe.PageStartLoading),this._featureValues.DisablePerformancePageNetworkMeasurement||this._performanceNetworkObserver.start()})}addTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&(this._loadingStartedCount.add(e),this._loadingStarted=!0),this._tasks.add(e),this._tasksQueueSubject.next(this._tasks)})}removeTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&this._loadingFinishedCount.add(e),this._tasks.delete(e),this._tasksQueueSubject.next(this._tasks)})}getMeasurements(){const e=this._measurements.map(t=>t());return this._measurements=[],e}getMeasureDataOnTimeout$(){const e={start:this._startTime,end:this._window.performance.now(),detail:this._getMeasurementDetail(),timeout:!0};return this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this._reset(),(0,c.of)(e)}ngOnDestroy(){this._reset(),this._subscriptions.unsubscribe(),this._tasksQueueSubject.complete(),this._pageLoadLifeCycleSubject.complete(),this.pageLoadDuration$.complete()}static{this.\u0275fac=function(t){return new(t||Bi)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Bi,factory:Bi.\u0275fac,providedIn:"root"})}}var Tn;(function(s){s.Readonly="READONLY_PROPERTY",s.Disabled="DISABLED_PROPERTY"})(Tn||(Tn={}));class Ml{constructor(e,t,n=!1){this.name=e,this._value=t,this._locked=n,this._isValueInitialized=!1,this._pendingValue=void 0,this._onChanged=new r.EventEmitter,this._hasInitialValue=!1,t!=null&&(this._isValueInitialized=!0,this._hasInitialValue=!0,this._initialValue=t,this._value=(0,v.cloneDeep)(t),this._oldValue=(0,v.cloneDeep)(t))}get onChanged(){return this._onChanged}get value(){return this.getValue()}set value(e){this.setValue(e)}get initialValue(){return this._initialValue}set initialValue(e){this.setInitialValue(e)}get hasInitialValue(){return this._hasInitialValue}get isLocked(){return this._locked}emitValueChanged(e){this.onChanged.emit(e)}areValuesEqual(e,t){return(0,v.isEqual)(e,t)}getValue(){return this._value}setValue(e,t=!1){if(this._locked)return;this._isValueInitialized=!0,this._pendingValue=e;const n=this._oldValue;this.areValuesEqual(this._oldValue,e)||(this._oldValue=(0,v.cloneDeep)(e),this._value=(0,v.cloneDeep)(e),!t&&this.emitValueChanged({name:this.name,value:e,oldValue:n}))}resetValue(){this.hasInitialValue&&(this._oldValue=null,this.setValue(this.initialValue))}setInitialValue(e){this._hasInitialValue=!0,this._initialValue=e,this._isValueInitialized||this.setValue(e,!0)}setPending(e){const t=typeof this._pendingValue>"u"?this.value:this._pendingValue;this.value=e,this._pendingValue=t}resetPending(){this._oldValue=null,this.value=this._pendingValue,this._pendingValue=void 0}}class wl extends Ml{constructor(e,t,n,i,a=!1){super(e,t,a),this._validatorTypeResolver=n,this._injectionContext=i,this._onValidatorChanged=new r.EventEmitter}get onValidatorChanged(){return this._onValidatorChanged}_createValidatorInfo(){return{name:this.validatorTypeName,instance:this._validatorTypeResolver.getValidator(this.validatorTypeName,{injectionContext:this._injectionContext}),disabled:!0}}emitValueChanged(e){super.emitValueChanged(e),this.hasValidator&&this.updateValidator(e)&&this._onValidatorChanged.emit()}get hasValidator(){return!1}updateValidator(e){return!1}setValidatorInfo(e,t=!1){this.validatorInfo=e}initializeValidator(e,t=!1){if(!this.hasValidator||this._validatorTypeResolver==null)return e;let n=e.find(a=>a.name===this.validatorTypeName),i=!1;return n==null&&(n=this._createValidatorInfo(),i=!0),this.setValidatorInfo(n,t),i?[...e,n]:e}}class Wh{static{this._properties=new Map}static _get(e){if(!e)return wl;if(this._properties.has(e))return this._properties.get(e);throw new Error(`CrtControlProperty with type ${e} doesn't registered`)}static register(e,t){this._properties.set(e,t)}static create(e){const t=this._get(e.typeName);return new t(e.name,e.value,e.validatorTypeResolver,e.injectionContext,e.locked===!0)}}const Zh="DataValueType";class Br extends Ml{get propertiesConfig(){return[{name:"visible",defaultValue:!0},{name:"displayColor"},{name:"required",typeName:"crt.Required",defaultValue:!1}]}get formControl(){return this._formControl||(this._formControl=new He.FormControl(this.value),this._subscribeOnFormControl(this._formControl)),this._formControl}set formControl(e){this._formControl=e,this._subscribeOnFormControl(this._formControl)}get properties(){return this._properties}get onPropertyChanged(){return this._onPropertyChanged}get visible(){return this.getPropertyByName("visible").getValue()}set visible(e){const t=this.getPropertyByName("visible");t.value=e}get required(){return this.getPropertyByName("required").getValue()}set required(e){const t=this.getPropertyByName("required");t.value=e}get displayColor(){return this.getPropertyByName("displayColor").getValue()}set displayColor(e){const t=this.getPropertyByName("displayColor");t.value=e}get isDirty(){return this.formControl.dirty}constructor(e=null,t,n=null,i=!1,a="",o=[],l,d,h,p){super(a,e),this._featureValues=t,this.validationState=n,this.disabled=i,this._subscription=new c.Subscription,this._appliedValidatorsCache=new Map,this._onPropertyChanged=new r.EventEmitter,this._crtControlStateAdapter=l,this._validatorTypeResolver=d,this._injectionContext=p,this._initProperties(o),this._subscribeOnPropertiesEvents(),this._initializeValidators(h??[],!0)}_subscribeOnFormControl(e){this._formControlSubscription?.unsubscribe(),this._formControlSubscription=e.valueChanges.pipe((0,u.startWith)(e.value),(0,u.distinctUntilChanged)((t,n)=>this.areValuesEqual(t,n))).subscribe(t=>{this.setValue(t)})}_initProperties(e){const t=[...this.propertiesConfig,...e];this._properties=new Map,t.forEach(n=>{const i=Wh.create({typeName:n.typeName,name:n.name,value:n.defaultValue,locked:n.locked===!0,validatorTypeResolver:this._validatorTypeResolver,injectionContext:this._injectionContext});this._properties.set(n.name,i)})}_subscribeOnPropertyEvents(e){this._subscription.add(e.onChanged.subscribe(({name:t,value:n,oldValue:i})=>{this.onPropertyChanged.emit({name:t,value:n,oldValue:i})})),this._subscription.add(e.onValidatorChanged.subscribe(()=>{this._refreshValidators()}))}_subscribeOnPropertiesEvents(){this.properties.forEach(e=>{this._subscribeOnPropertyEvents(e)})}_initializeValidators(e,t=!1){this._validatorInfo=e,this._properties.forEach(n=>{this._validatorInfo=n.initializeValidator(this._validatorInfo,t)}),this._refreshValidators()}_useValidatorsMerging(){return!this._featureValues.DisableControlValidatorsMerging}_getEnabledValidatorFns(e=!1){return this._validatorInfo.filter(t=>!t.disabled&&t.instance.isAsync===e).map(t=>{if(this._useValidatorsMerging()){const i=this._appliedValidatorsCache.get(t.name);if(i)return i.validatorFn}const n=this._crtControlStateAdapter.transform(t);return this._useValidatorsMerging()&&this._appliedValidatorsCache.set(t.name,{validatorInfo:t,validatorFn:n}),n})??[]}_mergeValidators(e,t){for(const n of this._appliedValidatorsCache.values())if(n.validatorInfo.instance.isAsync){const a=n.validatorFn;t.includes(a)?this.formControl.hasAsyncValidator(a)||this.formControl.addAsyncValidators(a):this.formControl.removeAsyncValidators(a)}else{const a=n.validatorFn;e.includes(a)?this.formControl.hasValidator(a)||this.formControl.addValidators(a):this.formControl.removeValidators(a)}}_refreshValidators(){const e=this._getEnabledValidatorFns(),t=this._getEnabledValidatorFns(!0);this._useValidatorsMerging()?this._mergeValidators(e,t):(this.formControl.setValidators(e),this.formControl.setAsyncValidators(t)),this.formControl.updateValueAndValidity()}_updateValidator(e,t=!1){const n=this._validatorInfo.find(i=>i.name===e);if(!n)throw new Error(`Validator ${e} does not exist on ${this.name} attribute.`);n.disabled!==t&&(n.disabled=t,this._refreshValidators())}findPropertyByName(e){return this.properties.has(e)?this.properties.get(e):null}static create(e){return new Br(e.value,e.featureValues,null,!1,e.name,e.propertiesConfig??[],e.crtControlStateAdapter,e.validatorTypeResolver,e.validatorsInfo,e.injectionContext)}setValue(e,t){const n=this.formControl;this.areValuesEqual(e,n.value)||(n.dirty||n.markAsDirty(),n.setValue(e,{onlySelf:!!t})),super.setValue(e,t)}enableValidator(e){this._updateValidator(e,!1)}disableValidator(e){this._updateValidator(e,!0)}change(e){this.setValue(e)}getPropertyByName(e,t=!1){let n=this.findPropertyByName(e);return!n&&t&&(n=new wl(e,null,this._validatorTypeResolver,this._injectionContext),this._properties.set(e,n),this._subscribeOnPropertyEvents(n)),n}hasPropertyValue(e){return!!this.getPropertyByName(e)}getPropertyValue(e){const t=this.getPropertyByName(e);return t?t.getValue():null}setPropertyValue(e,t,n=!1){this.getPropertyByName(e,!0).setValue(t,n)}setPropertyInitialValue(e,t){this.getPropertyByName(e,!0).setInitialValue(t)}getPropertyInitialValue(e){return this.getPropertyByName(e)?.initialValue}getValue(){return this._formControl?this._formControl.value:super.getValue()}destroy(){this._formControlSubscription?.unsubscribe(),this._subscription.unsubscribe()}getInvariabilityPropertyName(){const e=this.getPropertyValue(Tn.Readonly),t=this.getPropertyValue(Tn.Disabled);return e??t}toggle(e){const t=this.getInvariabilityPropertyName(),n=this.getPropertyByName(t);n&&(e?n.resetPending():n.setPending(!0))}}const kr="maskState",oo="maskedValue",co="unMaskedValue";var lo;(function(s){s.Unmasked="unmasked",s.Masked="masked"})(lo||(lo={}));const Il=Symbol("isAttributeValueMasked"),Kh=Symbol("getMaskedValue"),Jh=Symbol("getUnmaskedValue"),Yh=Symbol("setMaskedState"),Xh=Symbol("getMaskedState"),Qh="calculated",ep=new r.InjectionToken("View model attribute creator factory");function El(s){const e=s;return e?!!e?.modelConfig||!!e?.embeddedModel||!!e?.value:!1}function Al(s){const e=s;return e?!!e.from||!!e.triggers||!!e.converter:!1}function xl(s,e){const{dots:t}=e??{};return s?.replace(/\.+/g,t??"").replace(/\[+/g,"").replace(/\]+/g,"").replace(/:+/g,"")??""}const tp="DS",np="DYN";function ki(s){for(;s?.parent;)s=s.parent;return s}function Ot(s){return s?.getDataSource()?.scope===Re.Page}function W_(s){const e=[];return s?._modelsMap.forEach((t,n)=>{Ot(t)&&e.push(n)}),e}class Li{static{this._dataCache=new WeakMap}static _getDataSourceColumns(e){const t={};let n=!1;for(const[i,a]of Object.entries(e.dataSourceConfig.config.attributes)){const o=a.path;t[xl(i)]=o,o==="Id"&&(n=!0)}return!n&&e.includePrimaryAttributes!==!1&&(t.Id="Id"),t}static _createAttributesConfigMap(e,t,n,i,a){const o={},l=this.getAttributeDataSourceOldName(e,i);for(const[d]of Object.entries(t)){const h=a.config?.useOriginalAttributesName?`${d}`:`${l}_${d}`,p=a.config.attributes[d],g={path:`${n}.${d}`,type:p?.type,functionConfig:p?.functionConfig,aggregationConfig:p?.aggregationConfig};o[h]={modelConfig:g}}return o}static _createAttributePagingConfig(e){return e.pagingConfig||{rowCount:30}}static _createAttributeSortingConfig(e){return e.sortingConfig||{attributeName:e.attributeName+"Sorting"}}static _createAttributeFiltersConfig(e){return e.filtersConfig?.map(t=>{const n={...t};return delete n.value,n})||[]}static _getDataSourceNameForDynamicModel(e,t){return e.getBoundDataSourceNameByAttributePath(t)||this._getAttributeDataSourceDefaultName(t)}static _getDynamicDataSourceNamePrefix(){return`${np}_`}static _isDynamicDataSourceName(e){return e.startsWith(this._getDynamicDataSourceNamePrefix())}static _getAttributeDataSourceDefaultName(e){return`${e}${tp}`}static _getLoadData(e,t,n,i){let a;return this._dataCache.has(e)?a=this._dataCache.get(e):(a=t.load(n,[]).pipe((0,u.share)(),(0,u.tap)(()=>this._dataCache.delete(e))),this._dataCache.set(e,a)),(0,c.lastValueFrom)(a.pipe((0,c.map)(()=>i())),{defaultValue:null})}static createAttributeConfig(e,t,n){const i=n.attributeName,a=n.dataSourceConfig,o=this._getDataSourceColumns(n),l=this._createAttributesConfigMap(e,o,t,i,a),d=this._createAttributePagingConfig(n),h=this._createAttributeSortingConfig(n),p=this._createAttributeFiltersConfig(n);return{isCollection:!0,modelConfig:{path:t,pagingConfig:d,sortingConfig:h,filterAttributes:p,hierarchyConfig:n.hierarchyConfig},viewModelConfig:{attributes:l}}}static getAttributeDataSourceOldName(e,t){let n=this._getDataSourceNameForDynamicModel(e,t);return(!n||this._isDynamicDataSourceName(n))&&(n=this._getAttributeDataSourceDefaultName(t)),n}static createDynamicDataSourceNameFromAttributeName(e,t){const n=this._getDynamicDataSourceNamePrefix(),i=this._getDataSourceNameForDynamicModel(e,t);return this._isDynamicDataSourceName(i)?i:`${n}${i}`}static defineAsyncAttribute(e,t,n,i,a){const o=n.modelConfig?.path?.split(".")[0],l=e.getModelByName(o),d="isLookup"in n&&n.isLookup,h="isCollection"in n&&n.isCollection;Object.defineProperty(e,t,{get:()=>l&&h&&!d&&!l?.isLoaded?this._getLoadData(l,e,o,i):Promise.resolve(i()),set:a,configurable:!0})}static deferUpdatingValueAndValidity(e,t,n){if(n?.["ViewModel.DontDeferUpdatingValueAndValidity"])return t();const i=e.formApiModel.updateValueAndValidity;if(i.callbackCount)i.callbackCount++;else{const l=Tu();l.callbackCount=1,l.originalFn=i.bind(e.formApiModel),e.formApiModel.updateValueAndValidity=l}const a=t(),o=()=>{const l=e.formApiModel.updateValueAndValidity;l.callbackCount===1?(e.formApiModel.updateValueAndValidity=l.originalFn,e.formApiModel.updateValueAndValidity()):l.callbackCount--};return a instanceof Promise?a.finally(o):a.pipe((0,u.finalize)(o))}}class Pn{transform(e){return function(t){const{instance:n,params:i}=e,a={value:t.value};return n.validate(a,i)}}static{this.\u0275fac=function(t){return new(t||Pn)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Pn,factory:Pn.\u0275fac,providedIn:"root"})}}class Rl{constructor(e){this.injector=e}}class Nn{resolveModelConfig(e){return null}static{this.\u0275fac=function(t){return new(t||Nn)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Nn,factory:Nn.\u0275fac,providedIn:"root"})}}class Lr{constructor(){this.account={attributes:{Name:{},Ships:{isCollection:!0,viewModelConfig:"ship"},Employee:{viewModelConfig:"employee"}}},this.ship={attributes:{Id:{}}},this.employee={attributes:{Name:{},Age:{}}}}resolveModelConfig(e){return(0,c.of)(this[e]).pipe((0,u.delay)(50))}static{this.\u0275fac=function(t){return new(t||Lr)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Lr,factory:Lr.\u0275fac,providedIn:"root"})}}class Fi{constructor(e){this.injector=e,this.initDependencies()}initDependencies(){this.repository=this.injector.get(Nn),this.ngZone=this.injector.get(r.NgZone)}static{this.\u0275fac=function(t){return new(t||Fi)(r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Fi,factory:Fi.\u0275fac})}}const ip=y(85088);class ji{sort(e,t){const n=[];let i=[];Object.entries(e||{}).forEach(([o,l])=>{if(Al(l)){let d=l.from;d=Array.isArray(d)?d:[d];const h=d.map(p=>[o,p]);i=i.concat(h)}else n.push(o)});const a=ip(i).reverse();return[...n,...a].filter(Boolean).filter((o,l,d)=>d.indexOf(o)===l).map(o=>{const l=a.includes(o)?e[o]??t[o]:e[o];return[o,l]})}static{this.\u0275fac=function(t){return new(t||ji)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ji,factory:ji.\u0275fac,providedIn:"root"})}}class $i{constructor(e,t,n,i,a,o,l){this._crtControlStateAdapter=e,this._validatorTypeResolver=t,this._viewModelGenerator=n,this._attributeCreator=i,this._viewModelRepository=a,this._attributesTopologicalSorting=o,this._injector=l,this._featureValues=this._injector.get(W,null,{optional:!0}),this._measurePerformanceService=this._injector.get(z)}_generateAttributes(e,t,n){const i=this._attributesTopologicalSorting.sort(t,e._attributeConfigs);return Promise.all(i.map(([a,o])=>e._systemAttributes.includes(a)?(console.warn(`Overriding of system attributes is denied. Attribute name:"${a}"`),Promise.resolve()):(n.disableDefaultConfig||(o??={}),e._attributeConfigs[a]=o,o?"viewModelConfig"in o||"viewModelName"in o?o.isCollection?this._generateNestedModelCollectionAttribute(e,a,o,n):this._generateNestedModelAttribute(e,a,o,n):Al(o)?this._generateCalculatedAttribute(e,a,o,n):this._generateModelAttribute(e,a,o,n):this._removeViewModelAttribute(e,a))))}_generateNestedModelCollectionAttribute(e,t,n,i){var a=this;return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedCollectionAttribute.${t}`,(0,b.A)(function*(){const o=e.getBoundDataSourceNameByAttributePath(t),l=e.getModelByName(o),d="viewModelConfig"in n?n.viewModelConfig:yield(0,c.lastValueFrom)(a._viewModelRepository.resolveModelConfig(n.viewModelName)),h=new ve(a._viewModelGenerator,d,l,e,t);a._registerOrSetFormControl(e.formApiModel,t,h.formApiModel);const p=e.attributes[t];e.attributes[t]=h,a._defineNestedModelAttribute(e,t,n,i),a._subscribeOnCollectionChanged(e,t,h,i),p!==void 0&&i.onChangeAttributeValue(t,h,p)}))}_defineNestedModelAttribute(e,t,n,i){const a=l=>{const d=e.attributes[t];e.attributes[t]=l,d instanceof ve&&l instanceof ve&&this._subscribeOnCollectionChanged(e,t,l,i),i.onChangeAttributeValue(t,l,d)},o=()=>e.attributes[t];Li.defineAsyncAttribute(e,t,n,o,a)}_generateNestedModelAttribute(e,t,n,i){return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedModelAttribute.${t}`,()=>{const a="viewModelConfig"in n?n.viewModelConfig:n.viewModelName,o=e?.[ze];return(0,c.lastValueFrom)(this._viewModelGenerator.generate({viewModelConfig:a,parentViewModel:e},o?r.Injector.create({providers:[{provide:hr,useValue:null}],parent:o}):null).pipe((0,c.map)(l=>{this._registerOrSetFormControl(e.formApiModel,t,l.formApiModel);const d=e.attributes[t];e.attributes[t]=l,this._defineNestedModelAttribute(e,t,n,i),d!==void 0&&i.onChangeAttributeValue(t,l,d)})))})}_subscribeOnCollectionChanged(e,t,n,i){if(e._collectionSubscription.has(t)){const o=e._collectionSubscription.get(t);o.unsubscribe(),e._subscriptions.remove(o)}const a=new c.Subscription;a.add(n.changed.subscribe(()=>{i.onChangeAttributeValue(t,n,null)})),a.add(n.itemAttributeChanged.subscribe(()=>{i.onChangeAttributeValue(t,n,null)})),e._collectionSubscription.set(t,a),e._subscriptions.add(a)}_generateCalculatedAttribute(e,t,n,i){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateCalculatedAttribute.${t}`,()=>{this._attributeCreator.create(Qh,e?.[ze])?.defineAttribute({viewModel:e,attribute:t,attributeConfig:n,generateOptions:i})})}_getCrtControlPropertiesConfig(e,t,n){const i=Object.entries(n.properties??[]).map(([a,o])=>({name:a,defaultValue:o.defaultValue,locked:o.locked===!0}));return this._addDataValueTypePropertyConfig(i,n),this._addMaskedPropertyConfig(e,t,i,n),this._disableSystemAttributes(e,t,i),i}_addDataValueTypePropertyConfig(e,t){t.dataValueTypeName&&e.push({name:Zh,defaultValue:f[t.dataValueTypeName]})}_addMaskedPropertyConfig(e,t,n,i){this._isNotAllowMaskedPropertyConfig(e,t,i)||(i.isValueMasked=!0,this._getOrCreatePropertyConfig(n,kr),this._getOrCreatePropertyConfig(n,oo),this._getOrCreatePropertyConfig(n,co))}_isNotAllowMaskedPropertyConfig(e,t,n){const a=e.getBoundDataSchemaAttributeByAttributePath(t)?.isValueMasked,o=n.isValueMasked;return a&&o===!1||!a&&!o}_disableSystemAttributes(e,t,n){if(this._featureValues?.DisableBlockingSystemColumns===!0)return;if(e.getBoundDataSchemaAttributeByAttributePath(t)?.isSystem){const a=this._getOrCreatePropertyConfig(n,"readonly");a.locked=!0,a.defaultValue=!0}}_getOrCreatePropertyConfig(e,t){let n=this._findPropertyConfigByName(e,t);return n||(n={name:t},e.push(n)),n}_findPropertyConfigByName(e,t){return e.find(n=>n.name===t)}_generateModelAttribute(e,t,n,i){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateModelAttribute.${t}`,()=>{const a=e.attributes[t],o=n?.value,l=this._getCrtControlPropertiesConfig(e,t,n),d=Br.create({name:t,value:o,crtControlStateAdapter:this._crtControlStateAdapter,validatorTypeResolver:this._validatorTypeResolver,validatorsInfo:e._validators[t],propertiesConfig:l,injectionContext:e._injectionContext??ki(e)?._injectionContext,featureValues:this._featureValues});e._subscriptions.add(d.onChanged.subscribe(g=>{e.attributes[t]=g.value,i.onChangeAttributeValue(g.name,g.value,g.oldValue)})),e._subscriptions.add(d.onPropertyChanged.subscribe(({name:g,value:C,oldValue:E})=>{i.onChangeAttributeValue(`${t}:${g}`,C,E)})),e._crtControls.set(t,d),this._registerOrSetFormControl(e.formApiModel,t,d.formControl),e.attributes[t]=o??null;const h=e._getDataSourceAttributeDataValueType(t);this._attributeCreator.create(h).defineAttribute({viewModel:e,attribute:t,attributeConfig:n,control:d}),a!==void 0&&i.onChangeAttributeValue(t,o,a)})}_registerOrSetFormControl(e,t,n){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.registerOrSetFormControl.${t}`,()=>{if(this._featureValues?.DisableAttributeOnlyRegisteringControl){e.setControl(t,n);return}e.contains(t)?e.setControl(t,n):e.registerControl(t,n)})}_removeViewModelAttribute(e,t){return delete e._attributeConfigs[t],delete e.attributes[t],delete e[t],Promise.resolve()}generate(e,t,n){var i=this;return this._measurePerformanceService.measureCallback("BaseViewModelAttributeGenerator.generateAttributes",()=>Li.deferUpdatingValueAndValidity(e,(0,b.A)(function*(){yield i._generateAttributes(e,t,n),!i._featureValues?.DisableAttributeOnlyRegisteringControl&&e.formApiModel.updateValueAndValidity()}),this._featureValues))}static{this.\u0275fac=function(t){return new(t||$i)(r.\u0275\u0275inject(Pn),r.\u0275\u0275inject(Rl),r.\u0275\u0275inject(Fi),r.\u0275\u0275inject(ep),r.\u0275\u0275inject(Nn),r.\u0275\u0275inject(ji),r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:$i,factory:$i.\u0275fac,providedIn:"root"})}}class Ui{_defineResourceAttribute(e,t,n,i,a){return new c.Observable(o=>{const l=e._getDataSourceAttributeCaption(i,a);if(this._defineResourceProperty(t,n,l),i.includes(".")){const d=i.split(".")[1];this._defineResourceProperty(t,d,l)}o.next(),o.complete()})}_defineResourceProperty(e,t,n){e[t]||Object.defineProperty(e,t,{get:()=>Promise.resolve(n??""),configurable:!0})}_getResourceNameByPath(e){const t=e.split(".");return t.length>1?t.join("_"):e}generate(e,t){return Object.entries(t||{}).map(([n,i])=>{const a=e[fi][fn.string],o=this._getResourceNameByPath(n);return this._defineResourceAttribute(e,a,o,n,i)})}static{this.\u0275fac=function(t){return new(t||Ui)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ui,factory:Ui.\u0275fac,providedIn:"root"})}}const Fr="HasUnsavedData",zi="IsChanged",uo="PrimaryModelMode",ho="BusinessRulesActivated",jr="State";var dt;(function(s){s.DebouncingBusinessRules="DebouncingBusinessRules",s.RunningBusinessRules="RunningBusinessRules",s.ProcessingAttributeChangeRequest="ProcessingAttributeChangeRequest",s.AttributeLoading="AttributeLoading"})(dt||(dt={}));var po;(function(s){s.Paused="Paused",s.Active="Active"})(po||(po={}));var V;(function(s){s.OwnAttribute="Own",s.ForwardReferenceAttribute="ForwardReference",s.BackReferenceAttribute="BackReference",s.AggregationAttribute="Aggregation",s.FunctionAttribute="Function"})(V||(V={}));var Tl;(function(s){s[s.General=0]="General",s[s.Advanced=1]="Advanced",s[s.None=2]="None"})(Tl||(Tl={}));var Dn;(function(s){s[s.EntitySchema=3]="EntitySchema",s[s.ClientUnitSchema=4]="ClientUnitSchema"})(Dn||(Dn={}));const sp=new r.InjectionToken("Represents a list of schema change message predicates"),rp=new r.InjectionToken("Represents a list of schema remove message predicates"),ap=new r.InjectionToken("Represents a list of schema rights message predicates");class Bt{constructor(e,t,n,i,a){this._messageChannelService=e,this._broadcastChannelFactory=t,this._changePredicates=n,this._removePredicates=i,this._rightsPredicates=a,this._destroyed$=new c.Subject,this.schemaChanged$=new c.Subject,this.schemaRemoved$=new c.Subject,this.rightsChanged$=new c.Subject,this.requireJsChanged$=new c.Subject,this._subscribeMessageChannelEvent()}_getSchemaType(e){let t;switch(e){case"ClientUnitSchemaManager":t=Dn.ClientUnitSchema;break;case"EntitySchemaManager":t=Dn.EntitySchema;break}return t}_processMessage(e,t){const n=e.body,i=this._getSchemaType(n.ManagerName);i&&t.next({name:n.Name,uId:n.UId,schemaType:i,userId:n.UserId,isNew:n.IsNew,extendParent:n.ExtendParent})}_subscribeMessageChannelEvent(){this._messageChannelService.messageEvent$.pipe((0,u.filter)(e=>this._changePredicates?.some(t=>t(e))),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaChanged$)),this._messageChannelService.messageEvent$.pipe((0,u.filter)(e=>this._removePredicates?.some(t=>t(e))),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaRemoved$)),this._messageChannelService.messageEvent$.pipe((0,u.filter)(e=>this._rightsPredicates?.some(t=>t(e))),(0,u.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.rightsChanged$)),this._broadcastChannelFactory.createInstance("schema-requirejs-path-changed").messages$.subscribe(e=>this._processMessage({body:e},this.requireJsChanged$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.schemaChanged$.complete()}static{this.\u0275fac=function(t){return new(t||Bt)(r.\u0275\u0275inject(Nr),r.\u0275\u0275inject(an),r.\u0275\u0275inject(sp,8),r.\u0275\u0275inject(rp,8),r.\u0275\u0275inject(ap,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Bt,factory:Bt.\u0275fac,providedIn:"root"})}}class Hi{constructor(e){this.schemaChangeListener=e,this._repository=new Map,this._uIdMap=new Map,this._destroyed$=new c.Subject,this.schemaChangeListener.schemaChanged$.pipe((0,u.filter)(t=>t.schemaType===this.provider.schemaType),(0,u.takeUntil)(this._destroyed$)).subscribe(t=>this.clearSchemaCacheByUId(t.uId))}add(e){this._repository.set(e.name,e),this._uIdMap.set(e.uId,e.name)}getCachedSchema(e){return this._repository.get(e)}getIsSchemaCached(e){return this._repository.has(e)}getCachedSchemesNames(){return[...this._repository.keys()]}getSchemaByName(e){const t=this.getCachedSchema(e);return t?(0,c.of)(t):this.provider.getSchemaByName(e).pipe((0,u.tap)(n=>this.add(n)))}getSchemaByUId(e){const t=this._uIdMap.get(e),n=t&&this.getCachedSchema(t);return n?(0,c.of)(n):this.provider.getSchemaByUId(e).pipe((0,u.tap)(i=>this.add(i)))}clearSchemaCacheByName(e){const t=this.getCachedSchema(e);t&&this._uIdMap.delete(t.uId),this._repository.delete(e)}clearSchemaCacheByUId(e){const t=this._uIdMap.get(e);t&&this._repository.delete(t),this._uIdMap.delete(e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Hi)(r.\u0275\u0275inject(Bt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Hi,factory:Hi.\u0275fac})}}class $r{static getPathItemInfo(e){const n=/\[([\w-]+):([\w-]+):?([\w-]*)]$/g.exec(e);if(n){const i=n[1],a=n[2],o=n[3];return{isBackReference:!0,referenceSchemaName:i,referenceSchemaColumnName:a,columnName:o}}return{isBackReference:!1,columnName:e}}static getLastBackwardSchemaNameByColumnPath(e){let t="";return e?.split(".").reverse()?.forEach(i=>{t||i.includes("[")&&(t=this.getPathItemInfo(i).referenceSchemaName)}),t}static getLastForwardColumnPath(e){const t=e?.split(".")||[],n=t.map(i=>i.includes("[")).lastIndexOf(!0);return n===-1?e:t.slice(n+1).join(".")}}var Ur;(function(s){s.List="List",s.SelectionWindow="SelectionWindow"})(Ur||(Ur={}));class mo{get isLookupType(){return this.dataValueType?this.dataValueType===f.Lookup:!1}constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.columnCaptionPath=e.columnCaptionPath,this.dataValueType=e.dataValueType,this.usageType=e.usageType,this.referenceSchemaUId=e.referenceSchemaUId,this.referenceSchemaName=e.referenceSchemaName,this.isRequired=e.isRequired,this.isValueCloneable=e.isValueCloneable,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.defaultValueSchema=e.defaultValueSchema,this.lookupMode=e.lookupMode,this.useSeconds=e.useSeconds)}}class op{constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.extendParent=e.extendParent,this.packageUId=e.packageUId)}}class Pl extends op{getPrimaryColumn(){return this.primaryColumnUId&&this.columns?.find(e=>e.uId===this.primaryColumnUId)}getPrimaryDisplayColumn(){return this.primaryDisplayColumnUId&&this.columns?.find(e=>e.uId===this.primaryDisplayColumnUId)}getPrimaryColorColumn(){return this.primaryColorColumnUId&&this.columns?.find(e=>e.uId===this.primaryColorColumnUId)}getHierarchyColumn(){return this.hierarchyColumnUId&&this.columns?.find(e=>e.uId===this.hierarchyColumnUId)}getCreatedOnColumn(){return this.createdOnColumnUId&&this.columns?.find(e=>e.uId===this.createdOnColumnUId)}getCreatedByColumn(){return this.createdByColumnUId&&this.columns?.find(e=>e.uId===this.createdByColumnUId)}getModifiedOnColumn(){return this.modifiedOnColumnUId&&this.columns?.find(e=>e.uId===this.modifiedOnColumnUId)}getModifiedByColumn(){return this.modifiedByColumnUId&&this.columns?.find(e=>e.uId===this.modifiedByColumnUId)}}var Ne;(function(s){s[s.None=0]="None",s[s.Const=1]="Const",s[s.Settings=2]="Settings",s[s.SystemValue=3]="SystemValue",s[s.Sequence=4]="Sequence"})(Ne||(Ne={}));class cp{static _getDefaultValue(e){if(!e)return null;if(e.source===Ne.Sequence)return{valueSourceType:Ne.Sequence,value:"Sequence",sequencePrefix:e.sequencePrefix,sequenceNumberOfChars:e.sequenceNumberOfChars};if(e.source===Ne.Const){const t=e.value,n=typeof t=="string"?t:t.value;return{valueSourceType:Ne.Const,value:n,valueSource:n,sequenceNumberOfChars:0}}return e.source===Ne.Settings?{valueSourceType:Ne.Settings,value:e.calculatedValue,valueSource:e.value,sequenceNumberOfChars:0}:e.source===Ne.SystemValue?{valueSourceType:Ne.SystemValue,value:e.calculatedValue,valueSource:e.sourceValue,sequenceNumberOfChars:0}:{valueSourceType:e.source,value:null,sequenceNumberOfChars:0}}static _getPrimaryDisplayColorColumnUId(e){if(!e.primaryColorColumnName)return null;const t=Object.values(e.columns).find(n=>n.name===e.primaryColorColumnName);if(!t)throw new Error(`Primary color column set in object ${e.name} but column ${e.primaryColorColumnName} does not exist`);return t?.uId}static map(e,t){const n={};return Object.entries(e.columns).forEach(([,i])=>{const a=i,o=a.dataValueTypeName==="Binary"?"Blob":a.dataValueTypeName,l=Object.entries(Da).find(([,p])=>p.name===o),d=l?Number(l[0]):a.dataValueType,h=this._getDefaultValue(a.defaultValue);n[a.uId]={uId:a.uId,name:a.name,caption:{[t]:a.caption},dataValueType:d,isInherited:!!a.isInherited,isRequired:!!a.isRequired,isValueCloneable:!!a.isValueCloneable,usageType:a.usageType,referenceSchemaName:a.referenceSchemaName,isMasked:!!a.isMasked,isFormatValidated:!!a.isFormatValidated,isSimpleLookup:!!a.isSimpleLookup,isSensitiveData:!!a.isSensitiveData,isValueMasked:!!a.isValueMasked,valueMaskingSettings:a.valueMaskingSettings,useSeconds:!!a.useSeconds,defValue:h}}),{administratedByOperations:e.administratedByOperations,administratedByRecords:e.administratedByRecords,useMasterRecordRights:e.useMasterRecordRights,masterRecordSchemaName:e.masterRecordSchemaName,primaryColumnUId:e.primaryColumn?.uId,primaryDisplayColumnUId:e.primaryDisplayColumn?.uId,primaryColorColumnUId:this._getPrimaryDisplayColorColumnUId(e),hierarchyColumnUId:e.hierarchyColumnUId,createdOnColumnUId:e.createdOnColumnUId,createdByColumnUId:e.createdByColumnUId,modifiedOnColumnUId:e.modifiedOnColumnUId,modifiedByColumnUId:e.modifiedByColumnUId,uId:e.uId,name:e.name,caption:{[t]:e.caption},columns:{Items:n},isVirtual:!!e.isVirtual,isDBView:!!e.isDBView,administratedByColumns:!!e.administratedByColumns,description:{[t]:e.description},parentUId:e.parentUId,isTrackChangesInDB:!!e.isTrackChangesInDB,extendParent:!!e.extendParent}}}const lp="runtime-entity-schema";let fo=class{constructor(e){this._window=e}_getItems(e,t=[]){var n=this;let i=[];const a=[...t];return new Promise(o=>{this._window.require(e,(0,b.A)(function*(...l){i=yield Promise.all(l.map(d=>n.map(d))),o({schemes:i,notFoundSchemes:a})}),l=>{const d=l.requireModules??[];a.push(...d),e=e.filter(h=>!d.includes(h)),e.length===0&&o({schemes:i,notFoundSchemes:a}),o(this._getItems(e,a))})})}map(e){return Promise.resolve(e)}get(e){var t=this;return new Promise(n=>{this._window.require([e],function(){var i=(0,b.A)(function*(a){const o=yield t.map(a);n(o)});return function(a){return i.apply(this,arguments)}}(),()=>{n(null)})})}getItems(e){return this._getItems(e,[])}};fo=(0,m.__decorate)([(0,m.__param)(0,(0,r.Inject)(Ie)),(0,m.__metadata)("design:paramtypes",[Object])],fo);class kt{constructor(e,t){this._userInfo=e,this._httpClient=t}_getServiceUrlSspPart(){return this._userInfo.isSSP?"ssp/":""}_getDataServiceUrlWithSspPart(){return`DataService/${this._getServiceUrlSspPart()}`}getSchemaDesignerServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/SchemaDesignerRequest"}getRuntimeEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemaRequest"}getEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/EntitySchemaRequest"}getRuntimeEntitySchemeServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemesRequest"}getEntity(e){return(0,c.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemaServiceEndpoint(),{name:e}))}getEntities(e){return(0,c.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemeServiceEndpoint(),e))}static{this.\u0275fac=function(t){return new(t||kt)(r.\u0275\u0275inject(_n),r.\u0275\u0275inject(O.HttpClient))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:kt,factory:kt.\u0275fac,providedIn:"root"})}}const go=["SysSettings"];class Gi extends fo{constructor(e,t,n,i,a,o,l){super(e),this._featureValues=t,this._userInfo=n,this._entityHttpService=i,this._cacheManager=a,this._schemaChangeListener=o,this._measurePerformanceService=l,this._destroyed$=new c.Subject,this._schemaChangeListener.schemaChanged$.pipe((0,u.filter)(d=>d.schemaType===Dn.EntitySchema),(0,u.switchMap)(d=>(0,c.from)(this._clearSchemaCacheByName(d.name))),(0,u.takeUntil)(this._destroyed$)).subscribe()}get _entitySchemaCache(){return this._cacheManager.getOrCreate({name:lp,type:ce.Memory})}_clearSchemaCacheByName(e){var t=this;return(0,b.A)(function*(){t._featureValues.DisableRuntimeEntitySchemaCaching||(yield t._measurePerformanceService.measureCallback("EntityRequireService: clear schema cache",(0,b.A)(function*(){yield(yield t._entitySchemaCache).delete(e)})))})()}_getLookupEntities(e){const t=e.flatMap(i=>Object.values(i.columns.Items).filter(a=>a.dataValueType===f.Lookup&&a.referenceSchemaName&&!e.find(o=>o.name===a.referenceSchemaName)).map(a=>a.referenceSchemaName)),n=[...new Set(t)];return this.getItems(n)}_getReferenceEntityNameFromBackReferencePath(e){return $r.getPathItemInfo(e).referenceSchemaName}_getReferenceSchemaName(e,t){const n=this._getReferenceEntityNameFromBackReferencePath(e);let i;if(n)i=n;else{const a=Object.entries(t.columns.Items).find(([,l])=>l.name===e);if(!a)throw new Error(`Can't find column '${e}' in EntitySchema '${t.name}'`);const[,o]=a;i=o.referenceSchemaName}return i}_loadSchemasByPath(e,t,n){var i=this;return(0,b.A)(function*(){const a=n.find(g=>g.name===e);if(!a)return{schemas:[],notFoundSchemas:[e]};const o=[...t],l=o.shift(),d=i._getReferenceSchemaName(l,a);if(!d)return{schemas:[],notFoundSchemas:[]};let h=n.find(g=>g.name===d);if(!h)try{if(h=yield i.get(d),h)n.push(h);else return{schemas:[],notFoundSchemas:[d]}}catch{return{schemas:[],notFoundSchemas:[d]}}const p=o.length?yield i._loadSchemasByPath(h.name,o,n):{schemas:[],notFoundSchemas:[]};return{schemas:[h,...p.schemas],notFoundSchemas:p.notFoundSchemas}})()}_getForwardReferenceSchemas(e,t){var n=this;return(0,b.A)(function*(){const i=yield Promise.all(e.filter(a=>a.forwardReferencePaths).flatMap(a=>a.forwardReferencePaths.flatMap(o=>n._loadSchemasByPath(a.name,o.split("."),t))));return{schemes:i.flatMap(a=>a.schemas),notFoundSchemes:i.flatMap(a=>a.notFoundSchemas)}})()}_getEntitiesToLoadLookups(e,t){return t.schemes.filter(n=>e.requests.find(i=>i.loadLookupColumns===!0&&i.name===n.name))}map(e){return Promise.resolve(cp.map(e,this._userInfo.cultureInfo.sysCultureName))}get(e){var t=()=>super.get,n=this;return(0,b.A)(function*(){let i;return n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schema from cache",(0,b.A)(function*(){const o=yield(yield n._entitySchemaCache).get(e);if(o)return o}))),go.includes(e)?i=(yield n._entityHttpService.getEntity(e)).schema:i=yield t().call(n,e),n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: set schema to cache",(0,b.A)(function*(){yield(yield n._entitySchemaCache).set(e,i)}))),i})()}getItems(e){var t=()=>super.getItems,n=this;return(0,b.A)(function*(){const i=[...new Set(e)];let a=i,o=[];n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",(0,b.A)(function*(){const C=yield n._entitySchemaCache;o=(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",()=>Promise.all(i.map(R=>C.get(R))))).filter(R=>!!R);const T=o.map(R=>R.name);if(a=i.filter(R=>!T.includes(R)),a.length===0)return{schemes:[...o],notFoundSchemes:[]}})));const l=a.filter(C=>go.includes(C)),d=a.filter(C=>!go.includes(C));let h={success:!0,schemes:[],notFoundSchemes:[]};if(l.length!==0){const C={requests:l.map(E=>({name:E,loadLookupColumns:!1}))};h=yield n._entityHttpService.getEntities(C)}const p=yield t().call(n,d),g=[...p.schemes,...h.schemes];return n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: set schemas to cache",(0,b.A)(function*(){yield(yield n._entitySchemaCache).bulkSet((0,v.uniqBy)(g,"name").map(E=>({key:E.name,value:E})))}))),{schemes:[...g,...o],notFoundSchemes:[...p.notFoundSchemes,...h.notFoundSchemes]}})()}getEntity(e){var t=this;return(0,b.A)(function*(){const n=yield t.get(e);return{success:!!n,schema:n}})()}getEntities(e){var t=this;return(0,b.A)(function*(){const n=e.requests.map(d=>d.name),i=yield t.getItems(n),a=t._getEntitiesToLoadLookups(e,i),o=yield t._getLookupEntities(a),l=yield t._getForwardReferenceSchemas(e.requests,[...i.schemes,...o.schemes]);return{success:!0,schemes:[...i.schemes,...o.schemes,...l.schemes],notFoundSchemes:[...i.notFoundSchemes,...o.notFoundSchemes,...l.notFoundSchemes]}})()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Gi)(r.\u0275\u0275inject(Ie),r.\u0275\u0275inject(W),r.\u0275\u0275inject(_n),r.\u0275\u0275inject(kt),r.\u0275\u0275inject(fe),r.\u0275\u0275inject(Bt),r.\u0275\u0275inject(z))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Gi,factory:Gi.\u0275fac,providedIn:"root"})}}class qi{constructor(e,t,n,i){this.httpClient=e,this._entityRequire=t,this._entityHttp=n,this._featureValues=i}_useRequire(){return this._featureValues?.UseRequireEntitySchema8x??!1}getEntity(e){var t=this;return(0,b.A)(function*(){return t._useRequire()?t._entityRequire.getEntity(e):t._entityHttp.getEntity(e)})()}getEntities(e){var t=this;return(0,b.A)(function*(){return t._useRequire()?t._entityRequire.getEntities(e):t._entityHttp.getEntities(e)})()}static{this.\u0275fac=function(t){return new(t||qi)(r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(Gi),r.\u0275\u0275inject(kt),r.\u0275\u0275inject(W,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:qi,factory:qi.\u0275fac,providedIn:"root"})}}class Lt{constructor(e,t,n,i){this.httpClient=e,this._userInfo=t,this._schemaLoader=n,this._entityHttp=i,this._entitySchemaServiceRequests=new Map,this._destroyed$=new c.Subject}_convertToEntitySchema(e){const t=new Pl;return t.uId=e.uId,t.name=e.name,t.caption=this._getCaptionElement(e),t.extendParent=e.extendParent,t.packageUId=e.packageUId,t.administratedByColumns=e.administratedByColumns,t.administratedByOperations=e.administratedByOperations,t.administratedByRecords=e.administratedByRecords,t.description=e.description,t.isDBView=e.isDBView,t.isTrackChangesInDB=e.isTrackChangesInDB,t.isVirtual=e.isVirtual,t.masterRecordSchemaName=e.masterRecordSchemaName,t.primaryColumnUId=e.primaryColumnUId,t.primaryDisplayColumnUId=e.primaryDisplayColumnUId,t.primaryColorColumnUId=e.primaryColorColumnUId,t.hierarchyColumnUId=e.hierarchyColumnUId,t.createdOnColumnUId=e.createdOnColumnUId,t.createdByColumnUId=e.createdByColumnUId,t.modifiedOnColumnUId=e.modifiedOnColumnUId,t.modifiedByColumnUId=e.modifiedByColumnUId,t.useMasterRecordRights=e.useMasterRecordRights,t.parentUId=e.parentUId,t.columns=Object.values(e.columns.Items).map(n=>{const i=new mo;return i.uId=n.uId,i.name=n.name,i.caption=this._getCaptionElement(n),i.dataValueType=n.dataValueType,i.usageType=n.usageType,i.referenceSchemaUId=n.referenceSchemaUId,i.referenceSchemaName=n.referenceSchemaName,i.isRequired=n.isRequired,i.isValueCloneable=n.isValueCloneable,i.isMasked=n.isMasked,i.isFormatValidated=n.isFormatValidated,i.isSensitiveData=n.isSensitiveData,i.isValueMasked=n.isValueMasked,i.valueMaskingSettings=n.valueMaskingSettings,i.defaultValueSchema=n.defValue,i.lookupMode=n.isSimpleLookup?Ur.List:Ur.SelectionWindow,i.useSeconds=n.useSeconds,i}),t}_getCaptionElement(e){return e.caption[this._userInfo.cultureInfo.sysCultureName]||e.caption[xc]}_createEntitySchemaColumnFromInformationObject(e){const t=new mo;return t.uId=e.columnUId,t.name=e.columnName,t.caption=e.columnCaption,t.dataValueType=e.columnDataValueType,t.usageType=e.columnUsageType,t.referenceSchemaUId=e.referenceSchemaUId,t.referenceSchemaName=e.referenceSchemaName,t.columnCaptionPath=e.columnCaptionPath,t}_getEntitySchemaFromEndpoint(e,t){return this.httpClient.post(e,t).pipe((0,u.mergeMap)(n=>n.schema?(0,c.of)({success:!0,entitySchema:this._convertToEntitySchema(n.schema)}):(0,c.throwError)({success:!1,entitySchema:null,errorInfo:n.errorInfo})))}_getEntitySchemaColumnByPath(e,t,n="."){const i=`${e}_${n}_${t}`;if(this._entitySchemaServiceRequests.has(i))return this._entitySchemaServiceRequests.get(i);const a=this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),{getSchemaColumnInformation:{entitySchemaUId:e,schemaColumnPath:t,schemaColumnCaptionPathDelimiter:n}}).pipe((0,u.tap)(({success:o})=>{if(!o)throw new Error("SchemaDesignerService request has failed")}),(0,u.map)(({getSchemaColumnInformationResponse:o})=>this._createEntitySchemaColumnFromInformationObject(o)),(0,u.tap)(()=>this._entitySchemaServiceRequests.delete(i)),(0,u.share)());return this._entitySchemaServiceRequests.set(i,a),a}_combineEntitySchemaColumnInformationRequestsWithPaths(e,t){return t.reduce((n,i)=>({...n,[i]:this._getEntitySchemaColumnByPath(e,i)}),{})}getEntitySchemaByUId(e,t){const n=`${e}_${t}`;if(this._entitySchemaServiceRequests.has(n))return this._entitySchemaServiceRequests.get(n);const i=t?this._entityHttp.getEntitySchemaServiceEndpoint():this._entityHttp.getRuntimeEntitySchemaServiceEndpoint(),a={uId:e};t&&(a.packageUId=t);const o=this._getEntitySchemaFromEndpoint(i,a).pipe((0,u.tap)(()=>this._entitySchemaServiceRequests.delete(n)),(0,u.share)());return this._entitySchemaServiceRequests.set(n,o),o}getEntitySchemaByName(e){if(this._entitySchemaServiceRequests.has(e))return this._entitySchemaServiceRequests.get(e);const t=(0,c.from)(this._schemaLoader.getEntity(e)).pipe((0,u.map)(n=>({success:n.success,entitySchema:n.schema?this._convertToEntitySchema(n.schema):null,errorInfo:n.errorInfo})),(0,u.tap)(()=>this._entitySchemaServiceRequests.delete(e)),(0,u.share)(),(0,u.catchError)(n=>(this._entitySchemaServiceRequests.delete(e),(0,c.throwError)(()=>n))));return this._entitySchemaServiceRequests.set(e,t),t}getEntitySchemes(e){const t=JSON.stringify(e);if(this._entitySchemaServiceRequests.has(t))return this._entitySchemaServiceRequests.get(t);const n=(0,c.from)(this._schemaLoader.getEntities(e)).pipe((0,u.map)(i=>({success:i.success,schemes:i.schemes.map(a=>this._convertToEntitySchema(a)),notFoundSchemes:i.notFoundSchemes})),(0,u.tap)(()=>this._entitySchemaServiceRequests.delete(t)),(0,u.share)(),(0,u.catchError)(i=>(0,c.throwError)(()=>i)));return this._entitySchemaServiceRequests.set(t,n),n}getEntitySchemaColumnsInformationByMetaPath(e,t){const n={getSchemaColumnsInformation:{entitySchemaUId:e,schemaColumnMetaPaths:t}};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),n).pipe((0,u.tap)(({success:i})=>{if(!i)throw new Error("SchemaDesignerService request is failed")}),(0,u.map)(({getSchemaColumnsInformationResponse:i})=>i.map(a=>({column:this._createEntitySchemaColumnFromInformationObject(a),columnMetaPath:a.columnMetaPath,columnPath:a.columnPath,columnCaptionPath:a.columnCaptionPath}))))}getEntitySchemaColumnsInformationByPath(e,t,n){return this._getEntitySchemaColumnByPath(e,t,n)}getEntitySchemaColumnsInformationByPathsArray(e,t){return(0,c.forkJoin)(this._combineEntitySchemaColumnInformationRequestsWithPaths(e,t))}getColumnCaptionPathByMetaPath(e){const t={getColumnCaptionPathByMetaPath:e};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),t).pipe((0,u.tap)(({success:n})=>{if(!n)throw new Error("SchemaDesignerService request is failed")}),(0,u.map)(({columnCaptionPath:n})=>n))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Lt)(r.\u0275\u0275inject(O.HttpClient),r.\u0275\u0275inject(_n),r.\u0275\u0275inject(qi),r.\u0275\u0275inject(kt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac,providedIn:"root"})}}class Wi{constructor(e){this._entitySchemaService=e,this.schemaType=Dn.EntitySchema}_getSchema(e){return e.pipe((0,u.switchMap)(t=>t.success===!0?(0,c.of)(t):(0,c.throwError)(()=>new Error(t.errorInfo?.message))),(0,u.map)(t=>t.entitySchema))}_getScheme(e){return e.pipe((0,u.switchMap)(t=>t.success===!0?(0,c.of)(t):(0,c.throwError)(()=>new Error(t.errorInfo?.message))),(0,u.map)(t=>t.schemes))}getSchemaByUId(e){const t=this._entitySchemaService.getEntitySchemaByUId(e);return this._getSchema(t).pipe((0,u.catchError)(n=>{const i=n.message||`Entity schema with UId '${e}' not found`;return console.error(i),(0,c.throwError)(()=>new Error(i))}))}getSchemaByName(e){const t=this._entitySchemaService.getEntitySchemaByName(e);return this._getSchema(t).pipe((0,u.catchError)(n=>{const i=n.message||`Entity schema with name '${e}' not found`;return console.error(i),(0,c.throwError)(()=>new Error(i))}))}getSchemes(e){const t=this._entitySchemaService.getEntitySchemes(e);return this._getScheme(t).pipe((0,u.catchError)(n=>{const i=n.message||"Entity schemas not found: "+JSON.stringify(e);return console.error(i),(0,c.throwError)(()=>new Error(i))}))}static{this.\u0275fac=function(t){return new(t||Wi)(r.\u0275\u0275inject(Lt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Wi,factory:Wi.\u0275fac,providedIn:"root"})}}class qe extends Hi{constructor(e,t){super(t),this.provider=e,this.schemaChangeListener=t}_checkPath(e){if(!e||e.length===0)throw new Error("Path is null or empty")}_getEntitySchemaColumn(e,t){const n=e.columns.find(i=>i.name===t);return n||null}_findEntitySchemesByPath(e,t){this._checkPath(t);const n=[...t],i=this.getCachedSchema(e);if(!i)return null;const a=n.shift(),o=$r.getPathItemInfo(a);let l=[];if(o.isBackReference)l=this._findEntitySchemesByPath(o.referenceSchemaName,n);else{const h=this._getEntitySchemaColumn(i,o.columnName);if(n.length===0)return[i];if(!h?.isLookupType)return null;l=this._findEntitySchemesByPath(h.referenceSchemaName,n)}if(!l)return null;const d=l.filter(h=>h.name!==i.name);return[i,...d]}_getAreSchemesCached(e){for(const t of e){const n=this.getCachedSchema(t.name);if(!n)return!1;const i=n.columns.filter(o=>o.isLookupType).every(o=>this.getIsSchemaCached(o.referenceSchemaName));if(t.loadLookupColumns&&!i)return!1;const a=t.forwardReferencePaths??[];for(const o of a){const l=o.split(".");if(!this.findEntitySchemaColumnByPath(t.name,l))return!1}}return!0}_addSchemaIfNotExists(e,t){e.has(t.name)||e.set(t.name,t)}_addSchemesIfNotExists(e,t){t.forEach(n=>{this._addSchemaIfNotExists(e,n)})}_getCachedSchemes(e){const t=new Map;return e.forEach(n=>{const i=this.getCachedSchema(n.name);if(!i)return;if(this._addSchemaIfNotExists(t,i),n.loadLookupColumns){const o=i.columns.filter(l=>l.isLookupType).map(l=>this.getCachedSchema(l.referenceSchemaName)).filter(l=>l!=null);this._addSchemesIfNotExists(t,o)}(n.forwardReferencePaths??[]).forEach(o=>{const l=o.split("."),d=this._findEntitySchemesByPath(n.name,l);d&&this._addSchemesIfNotExists(t,d)})}),[...t.values()]}getSchemes(e){if(this._getAreSchemesCached(e))return(0,c.of)(this._getCachedSchemes(e));const t={requests:e,cachedSchemesNames:this.getCachedSchemesNames()};return this.provider.getSchemes(t).pipe((0,u.tap)(n=>n.forEach(i=>this.add(i))),(0,u.map)(()=>this._getCachedSchemes(e)))}findEntitySchemaByPath(e,t){this._checkPath(t);const n=this.getCachedSchema(e);if(!n)return null;const i=[...t],a=i.shift(),o=$r.getPathItemInfo(a);if(o.isBackReference)return this.findEntitySchemaByPath(o.referenceSchemaName,i);const l=this._getEntitySchemaColumn(n,o.columnName);return l?i.length===0?n:l?.isLookupType?this.findEntitySchemaByPath(l.referenceSchemaName,i):null:null}findEntitySchemaColumnByPath(e,t){const n=this.findEntitySchemaByPath(e,t);if(!n)return null;const i=[...t].pop(),a=$r.getPathItemInfo(i);return this._getEntitySchemaColumn(n,a.columnName)}static{this.\u0275fac=function(t){return new(t||qe)(r.\u0275\u0275inject(Wi),r.\u0275\u0275inject(Bt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:qe,factory:qe.\u0275fac,providedIn:"root"})}}class up{}class ht{get attributes(){return this._parent?[...this._parent.attributes,...this._attributes]:[...this._attributes]}get parent(){return this._parent}constructor(e){if(e!=null){this.name=e.name,this.type=e.type,e.caption&&(this.caption=typeof e.caption=="string"?e.caption:{...e.caption}),this.primaryAttributeName=e.primaryAttributeName,this.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this.primaryColorAttributeName=e.primaryColorAttributeName,this.hierarchyAttributeName=e.hierarchyAttributeName,this.createdByAttributeName=e.createdByAttributeName,this.createdOnAttributeName=e.createdOnAttributeName,this.modifiedByAttributeName=e.modifiedByAttributeName,this.modifiedOnAttributeName=e.modifiedOnAttributeName,e.dataSourceConfig&&(this.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig.config}}),this._parent=e.parent;const t=e.attributes??[];this._attributes=[],t.forEach(n=>{if(this._parent){this._parent.findAttributeByName(n.name)||this._attributes.push(n.clone());return}this._attributes.push(n.clone())})}else this._attributes=[]}clearAttributes(){this._attributes=[]}addAttribute(e){if(this._parent){this._parent.findAttributeByName(e.name)||this._attributes.push(e);return}this._attributes.push(e)}findAttributeByName(e){return this.attributes.find(t=>t.name===e)??null}getPrimaryAttributesNames(){return[this.primaryAttributeName]}getPrimaryLoadAttributes(){const e=[];return this.primaryAttributeName&&e.push(this.primaryAttributeName),this.primaryDisplayAttributeName&&e.push(this.primaryDisplayAttributeName),e}clone(){return new ht(this)}createChild(){const e=new ht;return e.name=this.name,e.type=this.type,this.caption&&(e.caption=typeof this.caption=="string"?this.caption:{...this.caption}),e.primaryAttributeName=this.primaryAttributeName,e.primaryDisplayAttributeName=this.primaryDisplayAttributeName,e.primaryColorAttributeName=this.primaryColorAttributeName,e.hierarchyAttributeName=this.hierarchyAttributeName,e.createdByAttributeName=this.createdByAttributeName,e.createdOnAttributeName=this.createdOnAttributeName,e.modifiedByAttributeName=this.modifiedByAttributeName,e.modifiedOnAttributeName=this.modifiedOnAttributeName,this.dataSourceConfig&&(e.dataSourceConfig={...this.dataSourceConfig,config:{...this.dataSourceConfig.config}}),e._attributes=[],e._parent=this,e}}class Nl extends Error{get isCritical(){return!0}constructor(e,t){super(t),this.dataSource=e}}class _o extends Nl{constructor(e,t){super(e,t)}}class dp extends Nl{get isCritical(){return!1}constructor(e,t){super(e,t)}}class yo{constructor(e,t){this.dataSourceName=e,this.injector=t,this._errors=[],this.supportTransactions=!1}get scope(){return this._scope}get hasErrors(){return this._errors.length!==0}get hasCriticalErrors(){return this._errors.some(e=>e.isCritical)}get affectedAttributes(){return[]}get isForceUpdateUnchangedData(){return!1}getLastError(){return this.hasErrors?this._errors[this._errors.length-1]:null}get isAggregate(){return!1}getEmptySchema(){return new ht}init(e,t){return this.initialConfig=e,this._scope=t,(0,c.of)(this)}load(e,t,n){return this.innerLoad(e,t,n)}save(e,t){return this.innerSave(e,t)}insert(e){return this.innerInsert(e)}delete(e){return this.innerDelete(e)}getSchema(){return this.dataSchema?(0,c.of)(this.dataSchema):this.innerGetSchema().pipe((0,u.tap)(e=>{this.dataSchema=e}))}getLookupDataSchema(e){return this.innerGetLookupDataSchema(e)}getDefaultValues(){return this.innerGetDefaultValues()}canEdit(e){return this.innerCanEdit(e)}canDelete(e){return this.innerCanDelete(e)}canCreate(e){return this.innerCanCreate(e)}getOwnLoadParameters(){return null}getAllowCopyingRecords(){return!1}}const Dl="crt.EntityDataSource",Vl="crt.PageParametersDataSource",Z_="PageParameters";var K=y(78240);class Zi{static{this._instanceOfKey="devkit_BaseFilter"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isEnabled=!0,this.trimDateTimeParameterToDate=!1,this.filterType=e}static fromJson(e,t,n){throw new Error(`fromJson not supported on filter type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,K.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,K.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class De extends Zi{static{this._instanceOfKey="devkit_SingleFilter"}static get _instanceOfKeys(){return[...Zi._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(e),this.comparisonType=t,this.leftExpression=n?.clone()}toJson(){return{...super.toJson(),leftExpression:this.serializeItem(this.leftExpression)}}_getUsedColumns(){return this.leftExpression._getUsedColumns()}}var q;(function(s){s[s.None=0]="None",s[s.Compare=1]="Compare",s[s.IsNull=2]="IsNull",s[s.Between=3]="Between",s[s.In=4]="In",s[s.Exists=5]="Exists",s[s.FilterGroup=6]="FilterGroup"})(q||(q={}));class Ve extends De{static{this._instanceOfKey="devkit_CompareFilter"}static get _instanceOfKeys(){return[...De._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(q.Compare,e,t),this.filterType=q.Compare,this.rightExpression=n?.clone()}static fromJson(e,t,n){return new Ve(e.comparisonType,n.fromJson(e.leftExpression,t),n.fromJson(e.rightExpression,t))}clone(){const e=new Ve(this.comparisonType,this.leftExpression,this.rightExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpression:this.serializeItem(this.rightExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightExpression._getUsedColumns()]}}var Z;(function(s){s[s.Between=0]="Between",s[s.Contain=11]="Contain",s[s.End_with=13]="End_with",s[s.Equal=3]="Equal",s[s.Exists=15]="Exists",s[s.Greater=7]="Greater",s[s.Greater_or_equal=8]="Greater_or_equal",s[s.Is_not_null=2]="Is_not_null",s[s.Is_null=1]="Is_null",s[s.Less=5]="Less",s[s.Less_or_equal=6]="Less_or_equal",s[s.Not_contain=12]="Not_contain",s[s.Not_end_with=14]="Not_end_with",s[s.Not_equal=4]="Not_equal",s[s.Not_exists=16]="Not_exists",s[s.Not_start_with=10]="Not_start_with",s[s.Start_with=9]="Start_with"})(Z||(Z={}));var ue;(function(s){s[s.SchemaColumn=0]="SchemaColumn",s[s.Function=1]="Function",s[s.Parameter=2]="Parameter",s[s.SubQuery=3]="SubQuery",s[s.ArithmeticOperation=4]="ArithmeticOperation"})(ue||(ue={}));class Oe{static{this._instanceOfKey="devkit_BaseExpression"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isBlock=!1,this.isBlock=e?.isBlock}static fromJson(e,t,n){throw new Error(`fromJson not supported on expression type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,K.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,K.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class U extends Oe{static{this._instanceOfKey="devkit_ColumnExpression"}static get _instanceOfKeys(){return[...Oe._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ue.SchemaColumn,this.columnPath=e?.columnPath}static fromJson(e){return new U({columnPath:e.columnPath})}clone(){return new U(this)}_getUsedColumns(){return[{path:this.columnPath}]}}class J extends Oe{static{this._instanceOfKey="devkit_ParameterExpression"}static get _instanceOfKeys(){return[...Oe._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ue.Parameter;const t=e?.value;if(t instanceof Date){const n=new Date;n.setTime(t.getTime()),this.value=n}else t?this.value=typeof t=="object"?{...t}:t:this.value=t;this.dataValueType=e?.dataValueType??f.Text,this.parameter={dataValueType:this.dataValueType,...this._getParameterValueMetadata()}}static fromJson(e){return new J(e.parameter)}_convertStringToBlobArray(e){const t=[];let n=0;for(let i=0;i<e.length;i++){const a=e.charCodeAt(i);a<128?t[n++]=String.fromCharCode(a):a<2048?(t[n++]=String.fromCharCode(a>>6|192),t[n++]=String.fromCharCode(a&63|128)):(t[n++]=String.fromCharCode(a>>12|224),t[n++]=String.fromCharCode(a>>6&63|128),t[n++]=String.fromCharCode(a&63|128))}return t}_getParameterValueMetadata(){return this.dataValueType===f.Blob?{arrayValue:this.value?this._convertStringToBlobArray(this.value):[]}:this.value instanceof Date?{value:Yc(this.value)}:{value:this.value}}clone(){return new J(this)}_getUsedColumns(){return[]}}(0,m.__decorate)([(0,K.Exclude)(),(0,m.__metadata)("design:type",Object)],J.prototype,"value",void 0),(0,m.__decorate)([(0,K.Exclude)(),(0,m.__metadata)("design:type",Number)],J.prototype,"dataValueType",void 0);const hp=new r.InjectionToken("COPILOT_INTENT_REPOSITORY_TOKEN");class Ol{static{this._codeCharactersRegex=new RegExp("^[A-Za-z0-9\\s_]*$")}static{this._wordsMatchRegex=new RegExp(/\w+/g)}static generateCode(e,t=-1){const i=(e.match(this._wordsMatchRegex)||[]).filter(a=>a.length!==0).map(a=>a[0].toUpperCase()+a.substring(1)).join("");return t>=0?i.slice(0,t):i}static isTextUsableForCodeGeneration(e){return this._codeCharactersRegex.test(e)}}class Ki{constructor(){this._sysSettingsService=(0,r.inject)(Tt),this._defaultCodeMaxLength=41}_checkCodeIsUnique(e,t){return e?!e.includes(t):!0}_generateCode(e){const{prefix:t,options:n,generateFromName:i,name:a}=e,{codeMaxLength:o,defaultNewCode:l}=n;if(i){if(!Ol.isTextUsableForCodeGeneration(a))return null;const d=t+l,h=(o??this._defaultCodeMaxLength)-d.length,p=Ol.generateCode(a,h);return d+p}return nc.generateUnique(l,t)}generate(e,t,n){const i={generateFromName:!!t,name:t,prefix:null,options:n};return(0,c.from)(this._sysSettingsService.getByCode("SchemaNamePrefix")).pipe((0,c.map)(a=>a.value),(0,c.tap)(a=>i.prefix=a),(0,c.repeat)(i.generateFromName?1:void 0),(0,c.map)(()=>this._generateCode(i)),(0,c.filter)(a=>this._checkCodeIsUnique(e,a)),(0,c.take)(1),(0,c.defaultIfEmpty)(null))}static{this.\u0275fac=function(t){return new(t||Ki)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ki,factory:Ki.\u0275fac})}}class Ji{constructor(){this._designItems=new Map}getDesignItem(e){return this._designItems.get(e)}getDesignItems(){return Array.from(this._designItems.values())}setDesignItem(e){this._designItems.set(e.UId,e)}static{this.\u0275fac=function(t){return new(t||Ji)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ji,factory:Ji.\u0275fac})}}class Ft{constructor(){this._repository=(0,r.inject)(hp),this._copilotCodeGenerator=(0,r.inject)(Ki),this._designRepository=(0,r.inject)(Ji)}_loadIntentUIdByActionUId(e){return(0,c.from)(ut.create("CopilotAction")).pipe((0,c.switchMap)(t=>t.load({attributes:["Intent"],parameters:[{type:P.Filter,value:new Ve(Z.Equal,new U({columnPath:"Id"}),new J({value:e}))}]})),(0,c.map)(t=>{const n=t[0]||{};return(0,v.isEmpty)(n)?null:n.Intent?.value}))}_applyActionToIntent(e,t){const i=(e.Actions||[]).findIndex(o=>o.Id===t.Id);if(i===-1)return!1;const a=e.Actions[i];return e.Actions.splice(i,1,{...a,...t}),!0}_applyParameterToIntent(e,t){const n=t.SourceCollection==="InputParameters"?e.InputParameters:e.OutputParameters,i=n.findIndex(a=>a.UId===t.UId);return i!==-1?(n.splice(i,1,{...n[i],...t}),!0):!1}_getSuccessResponse(){return{success:!0}}_getSuccessResponseObservable(){return(0,c.of)(this._getSuccessResponse())}_getDesignIntent(e){return(0,c.of)(this._designRepository.getDesignItem(e))}_getDesignIntents(){return Array.from(this._designRepository.getDesignItems())}_setDesignIntent(e){this._designRepository.setDesignItem(e)}_getIntentByParameterUId(e){for(const t of this._getDesignIntents()){if(t.InputParameters.find(a=>a.UId===e))return(0,c.of)({intent:t,sourceCollection:"InputParameters"});if(t.OutputParameters.find(a=>a.UId===e))return(0,c.of)({intent:t,sourceCollection:"OutputParameters"})}return(0,c.of)({})}getIntent(e){return this._repository.get(e).pipe((0,c.tap)(t=>{this._setDesignIntent(t)}))}getAllSkills(){return this._repository.getAllCodes("CopilotIntent")}getAllAgents(){return this._repository.getAllCodes("CopilotAgent")}getIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,c.map)(({intent:t,sourceCollection:n})=>n==="InputParameters"?t.InputParameters:t.OutputParameters),(0,c.map)(t=>t.find(n=>n.UId===e)))}getIntentParameters(e,t){return this._getDesignIntent(e).pipe((0,c.map)(n=>t==="InputParameters"?n.InputParameters:n.OutputParameters))}updateIntentParameter(e){return this._getIntentByParameterUId(e.UId).pipe((0,c.switchMap)(({intent:t,sourceCollection:n})=>(e.SourceCollection=n,this._applyParameterToIntent(t,e)?this._getSuccessResponseObservable():this._getSuccessResponseObservable())))}createIntentParameter(e){return this._getDesignIntent(e.Intent.value).pipe((0,c.map)(t=>((e.SourceCollection==="InputParameters"?t.InputParameters:t.OutputParameters).push(e),this._getSuccessResponse())))}deleteIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,c.map)(({intent:t,sourceCollection:n})=>{const i=n==="InputParameters"?t?.InputParameters:t?.OutputParameters,a=(i??[]).findIndex(o=>o.UId===e);return a!==-1&&i.splice(a,1),t}),(0,c.switchMap)(t=>this._repository.update(t)))}createIntent(e){return this._repository.create(e.UId).pipe((0,c.map)(t=>(Object.assign(t,e),t)),(0,c.switchMap)(t=>this._repository.update(t)))}updateIntent(e){return(0,c.forkJoin)([this._getDesignIntent(e.UId),this._repository.get(e.UId)]).pipe((0,c.map)(([t,n])=>{const i={...n,...t,...e};return this._setDesignIntent(i),i}),(0,c.switchMap)(t=>this._repository.update(t)))}createAction(e){return this._repository.get(e.Intent.value).pipe((0,c.map)(t=>(t.Actions.push(e),t)),(0,c.switchMap)(t=>this._repository.update(t)))}createSubIntent(e,t){return this._repository.createSubIntent(e,t)}deleteSubIntent(e,t){return this._repository.deleteSubIntent(e,t)}getActionByUId(e){return this._loadIntentUIdByActionUId(e).pipe((0,c.switchMap)(t=>t?this._repository.get(t).pipe((0,c.map)(n=>n.Actions.filter(i=>i.Id===e)),(0,c.map)(n=>n[0])):(0,c.of)({})))}getIntentByActionUId(e){return this.getActionByUId(e).pipe((0,c.switchMap)(t=>t?.Intent?this.getIntent(t.Intent.value):(0,c.of)({})))}updateAction(e){return this._loadIntentUIdByActionUId(e.Id).pipe((0,c.switchMap)(t=>this._repository.get(t).pipe((0,c.switchMap)(n=>this._applyActionToIntent(n,e)?this._repository.update(n):(0,c.of)({})))))}generateActionCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Action"})}generateSkillCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Skill"})}generateAgentCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Agent"})}deleteAction(e,t){return this._repository.get(e).pipe((0,c.map)(n=>(n.Actions=n.Actions.filter(i=>i.Id!==t),n)),(0,c.switchMap)(n=>this._repository.update(n)))}static{this.\u0275fac=function(t){return new(t||Ft)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ft,factory:Ft.\u0275fac})}}var bo;(function(s){s[s.None=0]="None",s[s.Self=1]="Self",s[s.ExplicitEntry=2]="ExplicitEntry",s[s.Delegated=4]="Delegated",s[s.FuncRoleFromOrgRole=8]="FuncRoleFromOrgRole",s[s.UpHierarchy=16]="UpHierarchy",s[s.AsManager=32]="AsManager",s[s.All=63]="All"})(bo||(bo={}));class zr{get queryDtoType(){return this._queryDtoType}constructor(e,t){this.operationType=e,this.rootSchemaName=t,G.checkArgumentEmpty("_operationType",e),G.checkArgumentEmpty("_rootSchemaName",t)}getMetadata(){return(0,K.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}(0,m.__decorate)([(0,K.Exclude)(),(0,m.__metadata)("design:type",String)],zr.prototype,"_queryDtoType",void 0),(0,m.__decorate)([(0,K.Expose)({name:"__type"}),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[])],zr.prototype,"queryDtoType",null);class Yi extends De{static{this._instanceOfKey="devkit_BetweenFilter"}static get _instanceOfKeys(){return[...De._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(q.Between,Z.Between,e),this.filterType=q.Between,this.rightLessExpression=t?.clone(),this.rightGreaterExpression=n?.clone()}static fromJson(e,t,n){return new Yi(n.fromJson(e.leftExpression,t),n.fromJson(e.rightLessExpression,t),n.fromJson(e.rightGreaterExpression,t))}clone(){const e=new Yi(this.leftExpression,this.rightLessExpression,this.rightGreaterExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightLessExpression:this.serializeItem(this.rightLessExpression),rightGreaterExpression:this.serializeItem(this.rightGreaterExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightLessExpression._getUsedColumns(),...this.rightGreaterExpression._getUsedColumns()]}}class jt extends De{static{this._instanceOfKey="devkit_ExistsFilter"}static get _instanceOfKeys(){return[...De._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n=Z.Exists,i=!0){super(q.Exists,n,e),this.filterType=q.Exists,this.subFilters=t?.clone(),this.isAggregative=i}static fromJson(e,t,n){const i=n.fromJson(e.leftExpression,t),a=e.subFilters;let o;return a&&(o=t.fromJson(e.subFilters)),new jt(i,o,e.comparisonType,e.isAggregative)}clone(){const e=new jt(this.leftExpression,this.subFilters,this.comparisonType,this.isAggregative);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[...super._getUsedColumns(),...this.subFilters?._getUsedColumns()??[]]}}class $t extends De{static{this._instanceOfKey="devkit_InFilter"}static get _instanceOfKeys(){return[...De._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(q.In,e,t),this.filterType=q.In,this.rightExpressions=n.map(i=>i?.clone())??[]}static fromJson(e,t,n){const i=e.rightExpressions??[];return new $t(e.comparisonType,n.fromJson(e.leftExpression,t),i.map(a=>n.fromJson(a,t)))}clone(){const e=new $t(this.comparisonType,this.leftExpression,this.rightExpressions);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpressions:this.rightExpressions.map(e=>this.serializeItem(e))}}_getUsedColumns(){const e=this.rightExpressions.map(t=>t._getUsedColumns()).flat();return[...super._getUsedColumns(),...e]}}class We extends De{static{this._instanceOfKey="devkit_IsNullFilter"}static get _instanceOfKeys(){return[...De._instanceOfKeys,this._instanceOfKey]}constructor(e,t){[Z.Is_null,Z.Is_not_null].includes(e)||console.warn(`Invalid comparison type: ${Z[e]} in IsNullFilter.`),super(q.IsNull,We._getComparisonType(e),t),this.filterType=q.IsNull,this.isNull=!0,this.isNull=this.comparisonType===Z.Is_null}static _getComparisonType(e){return e===Z.Is_not_null?e:Z.Is_null}static fromJson(e,t,n){return new We(We._getComparisonType(e.comparisonType),n.fromJson(e.leftExpression,t))}clone(){const e=new We(We._getComparisonType(this.comparisonType),this.leftExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}}var Hr;(function(s){s[s.And=0]="And",s[s.Or=1]="Or"})(Hr||(Hr={}));var Vn;(function(s){s[s.None=0]="None",s[s.CurrentUser=1]="CurrentUser",s[s.CurrentUserContact=2]="CurrentUserContact",s[s.Yesterday=3]="Yesterday",s[s.Today=4]="Today",s[s.Tomorrow=5]="Tomorrow",s[s.PreviousWeek=6]="PreviousWeek",s[s.CurrentWeek=7]="CurrentWeek",s[s.NextWeek=8]="NextWeek",s[s.PreviousMonth=9]="PreviousMonth",s[s.CurrentMonth=10]="CurrentMonth",s[s.NextMonth=11]="NextMonth",s[s.PreviousQuarter=12]="PreviousQuarter",s[s.CurrentQuarter=13]="CurrentQuarter",s[s.NextQuarter=14]="NextQuarter",s[s.PreviousHalfYear=15]="PreviousHalfYear",s[s.CurrentHalfYear=16]="CurrentHalfYear",s[s.NextHalfYear=17]="NextHalfYear",s[s.PreviousYear=18]="PreviousYear",s[s.CurrentYear=19]="CurrentYear",s[s.PreviousHour=20]="PreviousHour",s[s.CurrentHour=21]="CurrentHour",s[s.NextHour=22]="NextHour",s[s.NextYear=23]="NextYear",s[s.NextNDays=24]="NextNDays",s[s.PreviousNDays=25]="PreviousNDays",s[s.NextNHours=26]="NextNHours",s[s.PreviousNHours=27]="PreviousNHours",s[s.PrimaryColumn=34]="PrimaryColumn",s[s.PrimaryDisplayColumn=35]="PrimaryDisplayColumn",s[s.PrimaryImageColumn=36]="PrimaryImageColumn",s[s.DayOfYearToday=37]="DayOfYearToday",s[s.DayOfYearTodayPlusDaysOffset=38]="DayOfYearTodayPlusDaysOffset",s[s.NextNDaysOfYear=39]="NextNDaysOfYear",s[s.PreviousNDaysOfYear=40]="PreviousNDaysOfYear",s[s.PrimaryColorColumn=41]="PrimaryColorColumn"})(Vn||(Vn={}));class Gr extends Oe{static{this._instanceOfKey="devkit_FunctionExpression"}static get _instanceOfKeys(){return[...Oe._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ue.Function}}var de;(function(s){s[s.None=0]="None",s[s.Macros=1]="Macros",s[s.Aggregation=2]="Aggregation",s[s.DatePart=3]="DatePart",s[s.Length=4]="Length",s[s.Window=5]="Window",s[s.DateAdd=6]="DateAdd",s[s.DateDiff=7]="DateDiff"})(de||(de={}));class Ut extends Gr{static{this._instanceOfKey="devkit_MacrosFunctionExpression"}static get _instanceOfKeys(){return[...Gr._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=de.Macros,this.macrosType=e?.macrosType,this.functionArgument=e?.functionArgument}static fromJson(e,t,n){const i=t&&n&&e.functionArgument?n.fromJson(e.functionArgument,t):void 0;return new Ut({functionArgument:i,macrosType:e.macrosType})}clone(){return new Ut(this)}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class Ce extends Zi{static{this._instanceOfKey="devkit_FilterGroup"}static get _instanceOfKeys(){return[...Zi._instanceOfKeys,this._instanceOfKey]}get items(){const e={};return this.filters.forEach((t,n)=>{e[n]=this.serializeItem(t)}),e}constructor(e=Hr.And,t){super(q.FilterGroup),this.filterType=q.FilterGroup,this.filters=new Map,this.logicalOperation=e,this.rootSchemaName=t}static fromJson(e,t){const n=e.logicalOperation,i=new Ce(n||Hr.And,e.rootSchemaName);return Object.entries(e.items).forEach(([a,o])=>{i.add(t.fromJson(o),a)}),i}toJson(){const e={};return e.filterType=this.filterType,e.isEnabled=this.isEnabled,e.logicalOperation=this.logicalOperation,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e.items=this.items,this.rootSchemaName&&(e.rootSchemaName=this.rootSchemaName),e}_createParameterValueExpressions(e){return e.map(t=>new J({value:t}))}getItemByIndex(e){return this.items[Object.keys(this.items)[e]]}addSchemaColumnFilterWithParameter(e,t,n,i){const a=new U({columnPath:t}),o=new J({value:n}),l=new Ve(e,a,o);this.add(l,i)}addSchemaColumnInFilterWithParameters(e,t,n,i){const a=new U({columnPath:t}),o=this._createParameterValueExpressions(n),l=new $t(e,a,o);this.add(l,i)}addPrimarySchemaColumnInFilter(e,t){const n=new Ut({macrosType:Vn.PrimaryColumn}),i=this._createParameterValueExpressions(e),a=new $t(Z.Equal,n,i);this.add(a,t)}addSchemaColumnIsNullFilter(e,t){const n=new U({columnPath:e}),i=new We(Z.Is_null,n);this.add(i,t)}addSchemaColumnIsNotNullFilter(e,t){const n=new U({columnPath:e}),i=new We(Z.Is_not_null,n);this.add(i,t)}addSchemaColumnBetweenFilterWithParameters(e,t,n,i){const a=new U({columnPath:e}),o=new J({value:t}),l=new J({value:n}),d=new Yi(a,o,l);this.add(d,i)}addExistsFilter(e,t,n){const i=new U({columnPath:e}),a=new jt(i,t);this.add(a,n)}addNotExistsFilter(e,t,n){const i=new U({columnPath:e}),a=new jt(i,t,Z.Not_exists);this.add(a,n)}add(e,t){G.checkArgumentEmpty("filter",e);const n=t||D();this.filters.set(n,e)}clone(){const e=new Ce(this.logicalOperation,this.rootSchemaName);return this.filters.forEach((t,n)=>{e.filters.set(n,t.clone())}),e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}_getUsedColumns(){const e=[];return this.filters.forEach(t=>{let n=t._getUsedColumns?t._getUsedColumns():[];n=n.map(i=>({path:i.path,schemaName:i.schemaName??this.rootSchemaName})),e.push(...n)}),e}}(0,m.__decorate)([(0,K.Exclude)(),(0,m.__metadata)("design:type",Object)],Ce.prototype,"filters",void 0),(0,m.__decorate)([(0,K.Expose)(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[])],Ce.prototype,"items",null);class qr extends zr{constructor(e,t){super(e,t),this.filters=new Ce}clearFilters(){this.filters.filters.clear()}getMetadata(){return{...super.getMetadata(),filters:this.filters.toJson()}}_getUsedColumns(){const e=this.filters._getUsedColumns();return e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),e}}(0,m.__decorate)([(0,K.Exclude)(),(0,m.__metadata)("design:type",Object)],qr.prototype,"filters",void 0);var On;(function(s){s[s.Select=0]="Select",s[s.Insert=1]="Insert",s[s.Update=2]="Update",s[s.Delete=3]="Delete"})(On||(On={}));class Bl extends qr{constructor(e){super(On.Update,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.UpdateQuery",this.isForceUpdate=!1}get columnValues(){return{items:(0,K.classToPlain)(this._columnValues)}}addColumn(e,t,n){G.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new J({value:t,dataValueType:n}))}}(0,m.__decorate)([(0,K.Expose)(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[])],Bl.prototype,"columnValues",null);class kl extends zr{constructor(e){super(On.Insert,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.InsertQuery"}get columnValues(){return{items:(0,K.classToPlain)(this._columnValues)}}addColumn(e,t,n){G.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new J({value:t,dataValueType:n}))}}(0,m.__decorate)([(0,K.Expose)(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[])],kl.prototype,"columnValues",null);class pp extends qr{constructor(e){super(On.Delete,e),this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.DeleteQuery"}}var Co;(function(s){s.None="",s.Count="Count",s.Sum="Sum",s.Avg="Avg",s.Min="Min",s.Max="Max",s.TopOne="TopOne"})(Co||(Co={}));const So="rights-cache",K_={provide:fa,useValue:{name:So,type:ce.PersistentAndMemory,options:{tableName:$e.Rights}},multi:!0};class mp{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class fp extends mp{constructor(){super(...arguments),this.httpClient=(0,r.inject)(O.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const n=this.getFromCache(t);if((0,v.isUndefined)(n)){const i=e().pipe((0,c.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,i),i}return n}getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const n=this.getMethodEndpoint(e),i=this._createCacheKey(e,t),a=()=>this.httpClient.post(n,t);return this._cacheRequest(a,i)}executeGetRequestWithCache(e){const t=this.getMethodEndpoint(e),n=this._createCacheKey(e),i=()=>this.httpClient.get(t);return this._cacheRequest(i,n)}resetCache(e,t={}){const n=this._createCacheKey(e,t);this.deleteFromCache(n)}}let vo=class qs extends fp{constructor(){super(...arguments),this._persistentCache=null,this._cacheManager=(0,r.inject)(fe),this._measurePerformanceService=(0,r.inject)(z),this._useSystemClientCache=(0,r.inject)(ma,{optional:!0})??!1,this.serviceEndpoint="rest/RightsService"}_getPersistentCacheInstance(){return this._persistentCache?(0,c.of)(this._persistentCache):(0,c.from)(this._cacheManager.getOrCreate({name:So,type:ce.Memory})).pipe((0,u.tap)(e=>this._persistentCache=e))}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,u.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,u.map)(n=>({result:n&&n.GetCanDeleteResult?.length===0,message:n?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(i=>this.getFromCache(`GetCanAdd_${i}`)).filter(i=>!!i),n=e.filter(i=>!t.find(a=>a.schemaName===i));return{cachedResult:t,requestSchemaNames:n}}_internalGetExecuteOperation(e){return this._cacheManager.executeWithCache(So,e,this.httpClient.post(this.getMethodEndpoint("GetCanExecuteOperation"),{operation:e}).pipe((0,u.map)(t=>t?.GetCanExecuteOperationResult))).pipe(this._measurePerformanceService.measure$("RightsService: get execute operation with cache"))}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,u.mergeMap)(t=>(0,c.of)((t||[])[0])))}getCanExecuteOperations(e){return this._useSystemClientCache?this._getPersistentCacheInstance().pipe((0,u.switchMap)(t=>t.getAll()),(0,u.switchMap)(t=>{const n=e.map(i=>{const a=t.find(o=>o.key===i);return a?(0,c.of)(a.value):this._internalGetExecuteOperation(i)});return(0,c.combineLatest)(n)})):(0,c.combineLatest)(e.map(t=>this._internalGetExecuteOperation(t)))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,u.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:n,requestSchemaNames:i}=this._getCanAddData(e);if(!i.length)return(0,c.of)(n);const a=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(a,i).pipe((0,u.map)(o=>o.map(l=>({schemaName:l.Key,result:(0,v.isEmpty)(l.Value),errorMessage:l.Value}))),(0,u.tap)(o=>o.forEach(l=>this.setToCache(`${t}_${l.schemaName}`,l))),(0,u.map)(o=>o.concat(n)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,u.map)(n=>({result:n&&n.GetCanEditResult?.length===0,message:n?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,u.map)(t=>{const n=t?.GetCanEditColumnsResult??[],i={};return n.forEach(a=>i[a.Key]=a.Value),i}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,u.map)(t=>{const n=t?.GetCanReadColumnsResult??[],i={};return n.forEach(a=>i[a.Key]=a.Value),i}))}getCanExecuteEntityOperation(e,t){const n=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,i={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(n,i).pipe((0,u.mergeMap)(a=>(0,c.of)(a?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,c.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}applyChanges(e){const t=`${this.serviceEndpoint}/ApplyChanges`;return(0,c.firstValueFrom)(this.httpClient.post(t,e)).then(()=>!0,n=>{throw console.error(`Error while making request to ApplyChanges: ${n}`),n})}getRecordRights(e){return(0,c.firstValueFrom)(this.executePostRequestWithCache("GetRecordRights",e)).then(t=>t,t=>{throw console.error(`Error while making request to GetRecordRights: ${t}`),t})}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(qs)))(n||qs)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:qs,factory:qs.\u0275fac,providedIn:"root"})}};vo=(0,m.__decorate)([on({requestType:"crt.RightsService"})],vo);class Bn{static{this.\u0275fac=function(t){return new(t||Bn)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Bn,factory:Bn.\u0275fac})}}function J_(s){return s=s||new Date,new Date(s.getFullYear(),s.getMonth(),s.getDate())}function Y_(s){return s=s||new Date,new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999)}function gp(s){if(!s)return null;function e(){throw new Error(`String "${s}" is not a valid serialized date.`)}typeof s!="string"&&e();const[t,n]=s.split("T");if(n&&(n[n.length-1]==="Z"||n.indexOf("+")!==-1||n.indexOf("-")!==-1)){const a=Date.parse(s);return isNaN(a)&&e(),new Date(a)}try{const[a,o,l]=t.split("-"),[d,h,p]=n.split(":"),[g,C]=p.split(".");return new Date(parseInt(a),parseInt(o)-1,parseInt(l),parseInt(d),parseInt(h),parseInt(g),parseInt(C))}catch{e()}}function X_(s,e){e==null&&(e=0),s.setSeconds(s.getSeconds()+e*3600)}function Q_(s,e,t){const n=t||{hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat(e.sysCultureName,n).format(s)}function ey(s,e,t){const n=Math.abs(e.getTime()-s.getTime()),i=Math.floor(n/(1e3*60*60)),a=Math.floor(n%(1e3*60*60)/(1e3*60)),o=Math.floor(n%(1e3*60)/1e3),l={hours:i,minutes:a,seconds:o};return new Intl.DurationFormat(t.sysCultureName).format(l)}function Ll(s,e){switch(G.checkArgumentEmpty("dataValueType",e),e){case f.Date:case f.Time:case f.DateTime:return gp(s);default:return s}}function _p(s,e){if(ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),!s)return s;const t={};return Object.keys(s).forEach(n=>{const i=s[n];t[n]=e[n]?Ll(i,e[n]):i}),t}function ty(s,e){return ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),s&&s.map(t=>t&&_p(t,e))}var kn;(function(s){s.Entity="Entity",s.ClientUnit="ClientUnit",s.Intent="Intent"})(kn||(kn={}));class zt{constructor(){this._phoneUtil=null,this._phoneNumberType=null,this._phoneMaskOverrides=new Map([["id",["+{62} 000 000 000 000","+{62} 000 000 00"]]])}getAllPhoneMasks(e){let t=[];for(const i in this._phoneNumberType)if(isNaN(Number(i))){const a=this._phoneUtil.getExampleNumberForType(e,this._phoneNumberType[i]);if(!a)continue;const o=a.getCountryCode().toString(),l=this._phoneUtil.format(a,null),d=`+{${o.replace("0","\\0")}} ${l.replace(/-/g," ").replace(/\d/g,"0")}`;t.find(h=>h===d)||t.push(d)}const n=this._phoneMaskOverrides.get(e);return n&&(t.push(...n),t=Array.from(new Set(t))),t}initialize(){var e=this;return(0,b.A)(function*(){if(!(e._phoneUtil&&e._phoneNumberType))try{const t=yield y.e(1588).then(y.t.bind(y,1588,23));e._phoneUtil=t.PhoneNumberUtil.getInstance(),e._phoneNumberType=t.PhoneNumberType}catch(t){throw console.error("Error loading google-libphonenumber:",t),t}})()}isValidPhoneNumber(e){if(!this._phoneUtil)return!0;try{const t=this._phoneUtil.parse(e);return this._phoneUtil.isValidNumber(t)}catch{return!1}}static{this.\u0275fac=function(t){return new(t||zt)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:zt,factory:zt.\u0275fac,providedIn:"root"})}}const Mo={ShortTextCaption:50,MediumTextCaption:250,LongTextCaption:500},Wr={Integer:{max:2147483647,min:-2147483647},Float:{max:6999999999999999e-2,min:-6999999999999999e-2}};function yp(s){let e;switch(s){case f.SHORT_TEXT:e=Mo.ShortTextCaption;break;case f.PHONE_TEXT:case f.MEDIUM_TEXT:e=Mo.MediumTextCaption;break;case f.LONG_TEXT:case f.EMAIL_TEXT:e=Mo.LongTextCaption;break;default:return}return{maxLength:e}}function bp(s){if([f.Float,f.FLOAT0,f.FLOAT1,f.FLOAT2,f.FLOAT3,f.FLOAT4,f.FLOAT8,f.MONEY0,f.MONEY1,f.Money,f.MONEY3].includes(s))return{minValue:Wr.Float.min,maxValue:Wr.Float.max};if(s===f.Integer)return{minValue:Wr.Integer.min,maxValue:Wr.Integer.max}}class Xi{get isDate(){return this.dataValueType===f.Date||this.dataValueType===f.DateTime||this.dataValueType===f.Time}get isImage(){return this.dataValueType===f.IMAGELOOKUP||this.dataValueType===f.Image}get isLookup(){return this.dataValueType===f.Lookup}set isSystem(e){this._isSystem=e}get isSystem(){return this._isSystem}get isAggregate(){return this.attributeType===V.AggregationAttribute?!0:this.attributeType===V.FunctionAttribute&&this.functionConfig?.type==="aggregation"}constructor(e){if(this._isSystem=!1,e!=null){this.name=e.name,this.caption=e.caption,this.path=e.path,this.dataValueType=e.dataValueType,e.validators&&(this.validators={...e.validators||{}});const t=e.defaultValue;t&&(t instanceof c.Observable?this.defaultValue=t.pipe((0,u.map)(n=>this._getConvertDefaultValue(n))):this.defaultValue=(0,c.of)(this._getConvertDefaultValue(t))),this.defaultValueSchema=e.defaultValueSchema,this.isValueCloneable=e.isValueCloneable,this.attributeType=e.attributeType,this.referenceSchemaName=e.referenceSchemaName,this.functionConfig=e.functionConfig,this.aggregationConfig=e.aggregationConfig,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.usageType=e.usageType,this.isRequired=e.isRequired,this.lookupMode=e.lookupMode,this.isSystem=!!e.isSystem,this.useSeconds=e.useSeconds}}_getConvertDefaultValue(e){if(this.isDate)if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}else return e;else return typeof e=="object"?{...e}:e}clone(){return new Xi(this)}addDefaultValidators(){const e=this.validators??{};this.isRequired&&(e["crt.Required"]={type:"crt.Required"}),!this.validators&&Object.keys(e).length>0&&(this.validators=e)}}class Fl{constructor(e=null,t,n){e==null?this._dataSchema=new ht:this._dataSchema=t?.useClone?e.clone():e.createChild(),this._phoneValidationService=n||r.Injector.create({providers:[{provide:zt,useClass:zt}]}).get(zt)}_createDataSchemaAttributeByConfig(e){const t=new Xi;return t.name=e.name,t.caption=e.caption,t.path=e.path,t.dataValueType=e.dataValueType,t.validators={...e.validators||{}},t.defaultValue=(0,c.of)(typeof e.defaultValue=="object"?{...e.defaultValue}:e.defaultValue),t.defaultValueSchema=e.defaultValueSchema,t.isValueCloneable=e.isValueCloneable,t.attributeType=e.attributeType,t.referenceSchemaName=e.referenceSchemaName,t.functionConfig=e.functionConfig,t.aggregationConfig=e.aggregationConfig,t.usageType=e.usageType,t.isMasked=e.isMasked,t.isFormatValidated=e.isFormatValidated,t.isSensitiveData=e.isSensitiveData,t.isValueMasked=e.isValueMasked,t.valueMaskingSettings=e.valueMaskingSettings,t.isRequired=e.isRequired,t.lookupMode=e.lookupMode,t.isSystem=e.isSystem??!1,t.useSeconds=e.useSeconds??!1,t}setEntitySchemaColumnValidators(e,t){return e.isRequired&&this.setAttributeRequiredValidator(t),this.setAttributeTextDataValueTypeValidator(t,e.dataValueType).setAttributeNumberDataValueTypeValidator(t,e.dataValueType).setAttributePhoneDataValueTypeValidator(t,e)}setAttributeValidator(e,t,n){const i=this._dataSchema.attributes.find(o=>o.name===e),a=i.validators||{};return a[t]=n,i.validators=a,this}setAttributeRequiredValidator(e){return this.setAttributeValidator(e,"crt.Required",{type:"crt.Required"})}setAttributeMaxLengthValidator(e,t){return this.setAttributeValidator(e,"crt.MaxLength",{type:"crt.MaxLength",params:{maxLength:t}})}setAttributeTextDataValueTypeValidator(e,t){const n=yp(t);return n?this.setAttributeMaxLengthValidator(e,n.maxLength):this}setAttributeMinValueValidator(e,t){return this.setAttributeValidator(e,"crt.Min",{type:"crt.Min",params:{min:t}})}setAttributeMaxValueValidator(e,t){return this.setAttributeValidator(e,"crt.Max",{type:"crt.Max",params:{max:t}})}setAttributeMinMaxValidator(e,t,n){return this.setAttributeMinValueValidator(e,t).setAttributeMaxValueValidator(e,n)}setAttributeNumberDataValueTypeValidator(e,t){const n=bp(t);return n&&this.setAttributeMinMaxValidator(e,n.minValue,n.maxValue),this}setAttributePhoneDataValueTypeValidator(e,t){return[f.PHONE_TEXT].includes(t.dataValueType)&&t.isMasked&&(this._phoneValidationService.initialize().then(),this.setAttributeValidator(e,"crt.PhoneNumber",{type:"crt.PhoneNumber"})),this}setAttributesDefaultValue(e){return this._dataSchema.attributes.forEach(t=>{t.defaultValue=e.pipe((0,u.map)(n=>n[t.name]))}),this}addAttribute(e,t){const{name:n,caption:i,dataValueType:a,isValueCloneable:o,referenceSchemaName:l,isMasked:d,isFormatValidated:h,usageType:p,isRequired:g,isSensitiveData:C,isValueMasked:E,valueMaskingSettings:T}=e,R=new Xi;return R.name=t.attributeName||n,R.path=t.attributePath||n,R.caption=i,R.dataValueType=a,R.isValueCloneable=!!o,R.attributeType=t.attributeType||V.OwnAttribute,R.referenceSchemaName=l,R.validators={},R.isMasked=d,R.isFormatValidated=h,R.isSensitiveData=C,R.isValueMasked=E,R.valueMaskingSettings=T,R.usageType=p,R.isRequired=g,R.defaultValueSchema=e.defaultValueSchema,R.lookupMode=e.lookupMode,R.useSeconds=e.useSeconds,R.isSystem=(0,v.compact)([this._dataSchema.createdByAttributeName,this._dataSchema.createdOnAttributeName,this._dataSchema.modifiedByAttributeName,this._dataSchema.modifiedOnAttributeName,this._dataSchema.primaryAttributeName,"ProcessListeners"]).includes(R.name),this._dataSchema.addAttribute(R),t.attributeType===V.OwnAttribute&&this.setEntitySchemaColumnValidators(e,R.name),t.attributeType===V.AggregationAttribute&&(R.aggregationConfig=t.aggregationConfig),t.attributeType===V.FunctionAttribute&&(R.functionConfig=t.functionConfig),this}addOwnAttribute(e){return this.addAttribute(e,{attributeType:V.OwnAttribute})}setEntitySchema(e){return this._dataSchema.dataSourceConfig={type:"crt.EntityDataSource",config:{entitySchemaName:e.name}},this._dataSchema.name=e.name,this._dataSchema.type=kn.Entity,this._dataSchema.primaryAttributeName=e.getPrimaryColumn()?.name,this._dataSchema.primaryDisplayAttributeName=e.getPrimaryDisplayColumn()?.name,this._dataSchema.primaryColorAttributeName=e.getPrimaryColorColumn()?.name,this._dataSchema.hierarchyAttributeName=e.getHierarchyColumn()?.name,this._dataSchema.caption=e.caption,this._dataSchema.createdByAttributeName=e.columns.find(t=>t.uId===e.createdByColumnUId)?.name,this._dataSchema.createdOnAttributeName=e.columns.find(t=>t.uId===e.createdOnColumnUId)?.name,this._dataSchema.modifiedByAttributeName=e.columns.find(t=>t.uId===e.modifiedByColumnUId)?.name,this._dataSchema.modifiedOnAttributeName=e.columns.find(t=>t.uId===e.modifiedOnColumnUId)?.name,this._dataSchema.clearAttributes(),e.columns.forEach(t=>{this.addOwnAttribute(t)}),this}setDataSchemaConfig(e){return this._dataSchema.name=e.name,this._dataSchema.type=e.type,this._dataSchema.caption=typeof e.caption=="string"?e.caption:{...e.caption},this._dataSchema.primaryAttributeName=e.primaryAttributeName,this._dataSchema.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this._dataSchema.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig?.config}},(e.attributes||[]).forEach(n=>{const i=this._createDataSchemaAttributeByConfig(n);this._dataSchema.addAttribute(i)}),this}build(){return this._dataSchema.clone()}}class Cp extends _o{get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,`Entity schema with name '${t}' not found.`),this._entitySchemaName=t}}class Sp extends _o{constructor(e){super(e,`Entity schema name for data source ${e.dataSourceName} is not provided`)}}class vp extends Error{constructor(e){super(`Item with key '${e}' does not exist.`)}}var Ln;(function(s){s[s.None=0]="None",s[s.Asc=1]="Asc",s[s.Desc=2]="Desc"})(Ln||(Ln={}));class Ze{constructor(e){this.orderDirection=Ln.None,this.orderPosition=-1,this.isVisible=!0,this.expression=e}withOrdering(e,t){return G.checkArgumentEmpty("orderDirection",e),G.checkArgumentEmpty("orderPosition",t),G.checkArgumentOutOfRange("orderPosition",t,{begin:-1}),this.orderDirection=e,this.orderPosition=t,this}withOptions(e){return G.checkArgumentEmpty("options",e),this.isVisible=e.isVisible??!0,this}withCaption(e){return G.checkArgumentEmpty("caption",e),this.caption=e,this}_getUsedColumns(){return this.expression._getUsedColumns()}toJson(){return(0,K.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class Mp extends Ze{constructor(e){super(new U({columnPath:e}))}}class Qi extends Oe{static{this._instanceOfKey="devkit_SubQueryExpression"}static get _instanceOfKeys(){return[...Oe._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ue.SubQuery,this.columnPath=e?.columnPath;const t=e?.subFilters;typeof t?.clone=="function"?this.subFilters=t.clone():t?(this.subFilters=new Ce(t.logicalOperation,t.rootSchemaName),this.subFilters.isEnabled=t.isEnabled,Object.entries(t.items).forEach(([n,i])=>{this.subFilters.add(i,n)})):this.subFilters=t,this.subOrderDirection=e.subOrderDirection,this.subOrderColumn=e.subOrderColumn}static fromJson(e,t){return new Qi({columnPath:e.columnPath,subFilters:t.fromJson(e.subFilters),subOrderDirection:e.subOrderDirection,subOrderColumn:e.subOrderColumn})}clone(){return new Qi(this)}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[{path:this.columnPath},...this.subFilters?._getUsedColumns()??[]]}}class es extends Qi{static{this._instanceOfKey="devkit_AggregationSubQueryExpression"}static get _instanceOfKeys(){return[...Qi._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.aggregationType=e?.aggregationType,this.functionType=e?.functionType}static fromJson(e,t){const n=super.fromJson(e,t);return new es({aggregationType:e.aggregationType,functionType:e.functionType,...n})}clone(){return new es(this)}}class wp extends Ze{constructor(e,t,n,i,a){super(new es({aggregationType:t,columnPath:e,subFilters:n,subOrderDirection:i,subOrderColumn:a}))}}class Ip extends Ze{constructor(e,t){super(new J({value:e,dataValueType:t}))}}class ts extends Oe{static{this._instanceOfKey="devkit_ArithmeticExpression"}static get _instanceOfKeys(){return[...Oe._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ue.ArithmeticOperation,this.arithmeticOperation=e?.arithmeticOperation,this.leftArithmeticOperand=e?.leftArithmeticOperand.clone(),this.rightArithmeticOperand=e?.rightArithmeticOperand.clone()}static fromJson(e,t,n){const i=n?.fromJson(e.leftArithmeticOperand,t),a=n?.fromJson(e.rightArithmeticOperand,t),o={leftArithmeticOperand:i,rightArithmeticOperand:a,arithmeticOperation:e.arithmeticOperation,isBlock:e.isBlock};return new ts(o)}clone(){return new ts(this)}_getUsedColumns(){return[...this.leftArithmeticOperand._getUsedColumns(),...this.rightArithmeticOperand._getUsedColumns()]}}class Ep extends Ze{constructor(e,t,n){super(new ts({arithmeticOperation:e,leftArithmeticOperand:t,rightArithmeticOperand:n}))}}class Ap extends Ze{constructor(e){super(new Ut({macrosType:e}))}}class pt extends Gr{static{this._instanceOfKey="devkit_ArgumentFunctionExpression"}static get _instanceOfKeys(){return[...Gr._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionArgument=e?.functionArgument?.clone()}toJson(){const e=super.toJson();return this.functionArgument&&(e.functionArgument=this.serializeItem(this.functionArgument)),e}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class Ht extends pt{static{this._instanceOfKey="devkit_DatePartFunctionExpression"}static get _instanceOfKeys(){return[...pt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=de.DatePart,this.datePartType=e?.datePartType}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t),a=e.datePartType;return new Ht({functionArgument:i,datePartType:a,isBlock:e.isBlock})}clone(){return new Ht(this)}}class xp extends Ze{constructor(e,t){super(new Ht({datePartType:e,functionArgument:t}))}get datePartType(){return this.expression?.datePartType}}class ns extends pt{static{this._instanceOfKey="devkit_AggregationFunctionExpression"}static get _instanceOfKeys(){return[...pt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=de.Aggregation,this.aggregationType=e?.aggregationType,this.aggregationEvalType=e?.aggregationEvalType}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t),a=e.aggregationType,o=e.aggregationEvalType;return new ns({functionArgument:i,aggregationType:a,aggregationEvalType:o,isBlock:e.isBlock})}clone(){return new ns(this)}}class Rp extends Ze{constructor(e,t,n){super(new ns({aggregationType:e,aggregationEvalType:t,functionArgument:n}))}}class is extends pt{static{this._instanceOfKey="devkit_LengthFunctionExpression"}static get _instanceOfKeys(){return[...pt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=de.Length}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t);return new is({functionArgument:i,isBlock:e.isBlock})}clone(){return new is(this)}}class Tp extends Ze{constructor(e){super(new is({functionArgument:e}))}}class ss extends pt{static{this._instanceOfKey="devkit_WindowFunctionExpression"}static get _instanceOfKeys(){return[...pt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=de.Window}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t);return new ss({functionArgument:i,isBlock:e.isBlock})}clone(){return new ss(this)}}class Pp extends Ze{constructor(e){super(new ss({functionArgument:e}))}}var Zr;(function(s){s[s.None=0]="None",s[s.All=1]="All",s[s.Distinct=2]="Distinct"})(Zr||(Zr={}));class jl extends qr{constructor(e){super(On.Select,e),this._columns=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.SelectQuery",this.isDistinct=!1,this.rowCount=-1,this.rowsOffset=-1,this.useLocalization=!0,this.useRecordDeactivation=!1,this.isHierarchical=!1,this.hierarchicalMaxDepth=0,this.hierarchicalFullDataLoad=!1,this.hierarchicalColumnFiltersValue=new Ce,this._getIsPageable=()=>this.rowCount>0&&this.rowsOffset>-1}_internalAddColumn(e,t){this._columns.has(e)||this._columns.set(e,t)}getColumn(e){if(!this._columns.has(e))throw new vp(e);return this.findColumn(e)}findColumn(e){return this._columns.get(e)}getMetadata(){return{...super.getMetadata(),columns:{items:(0,K.classToPlain)(this._columns,{exposeUnsetFields:!1,excludePrefixes:["_"]})},allColumns:!1,isDistinct:this.isDistinct,ignoreDisplayValues:!1,rowCount:this.rowCount,rowsOffset:this.rowsOffset,adminUnitRoleSources:this.adminUnitRoleSources,isPageable:this._getIsPageable(),conditionalValues:this.conditionalValues?this.conditionalValues:null,isHierarchical:this.isHierarchical,hierarchicalMaxDepth:this.hierarchicalMaxDepth,hierarchicalColumnName:this.hierarchicalColumnName,hierarchicalColumnValue:this.hierarchicalColumnValue,hierarchicalFullDataLoad:this.hierarchicalFullDataLoad,useLocalization:this.useLocalization,useRecordDeactivation:this.useRecordDeactivation}}addColumn(e,t){return this._internalAddColumn(t,e),e}addSchemaColumn(e,t){G.checkArgumentEmpty("columnPath",e);const n=new Mp(e);return this._internalAddColumn(t||e,n),n}addAggregationSubQueryColumn(e,t,n,i){const a=new wp(e,t,n.filter,n.sortByDirection,n.sortByColumn);return this._internalAddColumn(i||e,a),a}addParameterColumn(e,t,n){const i=new Ip(e,t);return this._internalAddColumn(n,i),i}addArithmeticColumn(e,t,n,i){const a=new Ep(e,t,n);return this._internalAddColumn(i,a),a}addMacrosFunctionColumn(e,t){const n=new Ap(e);return this._internalAddColumn(t,n),n}addDatePartFunctionColumn(e,t,n){const i=new U({columnPath:e}),a=new xp(t,i);return this._internalAddColumn(n,a),a}addAggregationFunctionColumn(e,t,n,i=Zr.None){const a=new U({columnPath:e}),o=new Rp(t,i,a);return this._internalAddColumn(n,o),o}addLengthFunctionColumn(e,t){const n=new U({columnPath:e}),i=new Tp(n);return this._internalAddColumn(t,i),i}addWindowFunctionColumn(e,t,n,i=Zr.None){const a=new ns({aggregationType:t,aggregationEvalType:i,functionArgument:new U({columnPath:e})}),o=new Pp(a);return this._internalAddColumn(n,o),o}_getUsedColumns(){const e=[];return this._columns.forEach(t=>{e.push(...t._getUsedColumns())}),e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),[...e,...super._getUsedColumns()]}}function Np(s){switch(s){case"asc":return Ln.Asc;case"desc":return Ln.Desc;default:return Ln.None}}const Dp=new r.InjectionToken("A factory of entity schema column appender"),Vp=new r.InjectionToken("A factory of data schema to data source attribute converter");class Op{_getExpressionColumnPath(e,t){const n="[{referenceSchemaName}:{referenceAttributeName}:{attributeName}]",i=e.relationData.map(h=>rr.String.format(n,h)).join("."),a=e.attributePath.split("."),o=a.length>1?"{ownColumnPath}.{relationString}.{columnPath}":"{relationString}.{columnPath}";a.pop();const d={ownColumnPath:a.join("."),relationString:i,columnPath:t};return rr.String.format(o,d)}_updateFilterLeftExpression(e,t){switch(e.expressionType){case ue.SchemaColumn:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case ue.SubQuery:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case ue.Function:e.functionType!==de.Macros&&this._updateFilterLeftExpression(e.functionArgument,t);break}}_updateRelatedFilterGroup(e,t){e instanceof Ce?this._updateRelatedFilterGroupInstance(e,t):this._updateRelatedFilterGroupObject(e,t)}_updateRelatedFilterGroupObject(e,t){Object.values(e.items).forEach(n=>{this._updateRelatedFilter(n,t)})}_updateRelatedFilterGroupInstance(e,t){e.filters.forEach(n=>this._updateRelatedFilter(n,t))}_updateRelatedFilter(e,t){if(e.filterType!==q.FilterGroup){const n=e.leftExpression;n&&this._updateFilterLeftExpression(n,t)}else this._updateRelatedFilterGroup(e,t)}convertToRelatedFilter(e,t=[]){if(!e)return e;let n;if(e instanceof Zi)n=e.clone();else{const i=JSON.stringify(e);n=JSON.parse(i)}return[...t].reverse().forEach(i=>{i.relationData&&i.relationData.length!==0&&this._updateRelatedFilter(n,i)}),n}}const Bp="invalidate-data-schema-cache";class mt{constructor(e,t){this._entitySchemaRepository=e,this._broadcastChannelFactory=t,this._dataSchemas=new Map,this._subscribeOnChangesInDesigner()}_subscribeOnChangesInDesigner(){this._broadcastChannelFactory.createInstance(Bp).messages$.subscribe(({schemaName:e})=>{this._removeCachedSchema(e)})}_createEntityDataSchema(e){const t=new Fl;return t.setEntitySchema(e),(0,c.of)(t.build())}_getEntityDataSchema(e){return this._entitySchemaRepository.getSchemaByName(e).pipe((0,u.switchMap)(t=>this._createEntityDataSchema(t)))}_removeCachedSchema(e){this._dataSchemas.has(e)&&(this._dataSchemas.delete(e),this._entitySchemaRepository.clearSchemaCacheByName(e))}get(e){return this._dataSchemas.has(e)?(0,c.of)(this._dataSchemas.get(e)):this._getEntityDataSchema(e).pipe((0,u.tap)(t=>this._dataSchemas.set(e,t)))}getByEntitySchema(e){const t=e.name;return this._dataSchemas.has(t)?(0,c.of)(this._dataSchemas.get(t)):this._createEntityDataSchema(e).pipe((0,u.tap)(n=>this._dataSchemas.set(t,n)))}static{this.\u0275fac=function(t){return new(t||mt)(r.\u0275\u0275inject(qe),r.\u0275\u0275inject(an))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:mt,factory:mt.\u0275fac,providedIn:"platform"})}}class rs{constructor(e,t){this._dataSchemaRepository=e,this._featureValues=t}_getDataSchema(e){var t=this;return(0,b.A)(function*(){const n=yield(0,c.firstValueFrom)(t._dataSchemaRepository.get(e));if(!n)throw new Error(`Can not find DataSchema with name '${e}'`);return n})()}_getDataSchemaAttribute(e,t){var n=this;return(0,b.A)(function*(){const i=e instanceof ht?e:yield n._getDataSchema(e),a=i.findAttributeByName(t);if(!a)throw new Error(`Can not find column '${t}' in Schema '${i.name}'`);return a})()}_getDataSchemaPrimaryAttribute(e){var t=this;return(0,b.A)(function*(){const n=yield t._getDataSchema(e);return t._getDataSchemaAttribute(n,n.primaryAttributeName)})()}_createRelationPathItemFromForwardPathItem(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._getDataSchemaAttribute(e,t);let a=null,o=null;const l=i.dataValueType===f.Lookup;return l&&(a=i.referenceSchemaName,o=(yield n._getDataSchema(a)).primaryAttributeName),{isJoin:l,referenceSchemaName:a,referenceAttributeName:o,ownSchemaAttributeName:t,ownSchemaName:e}})()}_createRelationPathItemFromJoinPathItem(e,t,n,i){var a=this;return(0,b.A)(function*(){const o=n?yield a._getDataSchemaAttribute(t,n):yield a._getDataSchemaPrimaryAttribute(t);return{isJoin:!0,referenceSchemaName:t,referenceAttributeName:o.name,ownSchemaAttributeName:i,ownSchemaName:e}})()}_createRelationPathItem(e,t){const i=/(?<joinType>.*)\[(?<refSchema>.*?):(?<ownColumn>.*?)(?::(?<refColumn>.*))?]/.exec(t);if(i){const a=i.groups;return this._createRelationPathItemFromJoinPathItem(e,a.refSchema,a.refColumn,a.ownColumn)}return this._createRelationPathItemFromForwardPathItem(e,t)}_getReverseRelationPath(e){const t=[...e],n=[];let i;for(;(i=t.pop())!=null;)n.push({isJoin:!0,ownSchemaName:i.referenceSchemaName,ownSchemaAttributeName:i.referenceAttributeName,referenceSchemaName:i.ownSchemaName,referenceAttributeName:i.ownSchemaAttributeName});return n}_buildRelationPath(e,t){var n=this;return(0,b.A)(function*(){const i=t.split("."),a=[];let o=e;for(const l of i){const d=yield n._createRelationPathItem(o,l);o=d.referenceSchemaName,a.push(d)}return a})()}_getRelationPathToSourceSchema(e,t,n){var i=this;return(0,b.A)(function*(){const a=[...t],o=a.pop(),l=n.split("."),h=(yield i._buildRelationPath(e,n)).pop(),p={isJoin:!0,ownSchemaName:o.isJoin?o.referenceSchemaName:o.ownSchemaName,ownSchemaAttributeName:o.isJoin?o.referenceAttributeName:o.ownSchemaAttributeName,referenceSchemaName:h.ownSchemaName,referenceAttributeName:l.pop()},g=[...a,...o.isJoin?[o]:[],p];return i._featureValues.DisableDsDepsJoinOptimization||g.length===1?g:g.filter(C=>{if(!C.isJoin)return!0;const E=C.ownSchemaName===C.referenceSchemaName,T=C.ownSchemaAttributeName===C.referenceAttributeName;return!(E&&T)})})()}_buildRelationDataFromPath(e){return e.map(t=>({attributeName:t.ownSchemaAttributeName,referenceAttributeName:t.referenceAttributeName,referenceSchemaName:t.referenceSchemaName}))}_getDataSourceParameterRelationData(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._buildRelationPath(t.dataSchemaName,t.relationPath),a=yield n._getRelationPathToSourceSchema(e,i,t.attributePath),o=n._getReverseRelationPath(a);return n._buildRelationDataFromPath(o)})()}_getIsSelfSchemaRelation(e,t){return!this._featureValues.DisableSkipDSEqualRelations&&t.dataSchemaName===e&&t.attributePath===t.relationPath&&t.attributePath.split(".").length===1}_convertEntityDataSourceParameter(e,t){var n=this;return(0,b.A)(function*(){if(!t.relationsConfigs||t.relationsConfigs.length===0)return t;let i=e.name;const a=[];for(const o of t.relationsConfigs){if(n._getIsSelfSchemaRelation(i,o)){o.attributePath===e.primaryAttributeName||a.push({...o,relationData:[{referenceSchemaName:o.dataSchemaName,attributeName:o.attributePath,referenceAttributeName:o.relationPath}]});continue}const d=yield n._getDataSourceParameterRelationData(i,o);i=d[d.length-1].referenceSchemaName,a.push({...o,relationData:d})}return{...t,relationsConfigs:a}})()}convert(e,t,n=!1){return t.length===0?Promise.resolve([]):n?Promise.resolve(t):Promise.all(t.map(i=>this._convertEntityDataSourceParameter(e,i)))}static{this.\u0275fac=function(t){return new(t||rs)(r.\u0275\u0275inject(mt),r.\u0275\u0275inject(W))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:rs,factory:rs.\u0275fac,providedIn:"root"})}}class Fn{constructor(e,t){this._dataSchemaRepository=e,this._parametersConverter=t}_createPrimaryColumnValueFilter(e,t){const a=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(a).pipe((0,c.map)(o=>{const l=new U({columnPath:o.primaryAttributeName}),d=new J({value:t.value});return new Ve(Z.Equal,l,d)}))}_createColumnValueFilter(e){const t=e.value.attributePath,n=e.value.attributeValue,i=new U({columnPath:t}),a=new J({value:n}),o=new Ve(Z.Equal,i,a);return(0,c.of)(o)}_createPrimaryDisplayValueFilter(e,t){const a=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(a).pipe((0,c.map)(o=>{const l=new U({columnPath:o.primaryDisplayAttributeName}),d=new J({value:t.value});return new Ve(t.comparisonType,l,d)}))}_createCustomFilter(e){let t={};return e.value&&(t=typeof e.value=="string"?JSON.parse(e.value):e.value),(0,c.of)(t)}_createEmptyParameterFiler(e){const t=e.relationsConfigs||[];if(t.length===0)return(0,c.of)({});const n=t[0];return this._dataSchemaRepository.get(n.dataSchemaName).pipe((0,c.map)(i=>i.primaryAttributeName),(0,c.map)(i=>{const a=new U({columnPath:i});return new jt(a,null)}))}_createEsqFilter(e,t){switch(t.type){case P.PrimaryColumnValue:return this._createPrimaryColumnValueFilter(e,t);case P.ColumnValue:return this._createColumnValueFilter(t);case P.PrimaryDisplayValueFilter:return this._createPrimaryDisplayValueFilter(e,t);case P.Filter:return this._createCustomFilter(t);case P.Empty:return this._createEmptyParameterFiler(t)}}applyParameters(e,t){if(e.length===0)return(0,c.of)(t);const n=e.map(i=>this._createEsqFilter(t.rootSchemaName,i).pipe((0,c.map)(a=>new Op().convertToRelatedFilter(a,i.relationsConfigs))));return(0,c.forkJoin)(n).pipe((0,c.tap)(i=>{i.forEach(a=>{(0,v.isEmpty)(a)||t.filters.add(a)})}),(0,c.map)(()=>t))}convertToEntityDataSourceParameters(e,t,n=!1){return(0,c.from)(this._parametersConverter.convert(e,t,n))}static{this.\u0275fac=function(t){return new(t||Fn)(r.\u0275\u0275inject(mt),r.\u0275\u0275inject(rs))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Fn,factory:Fn.\u0275fac,providedIn:"root"})}}class as{constructor(e,t,n){this.entitySchemaQueryUtils=e,this._entitySchemaColumnAppenderFactory=t,this._dataSchemaToDataSourceAttributeConverter=n}_addPagingToEsq(e,t){t&&(e.rowsOffset=t.rowsOffset,e.rowCount=t.rowCount)}_addSortingToEsq(e,t){t&&t.columns.forEach((n,i)=>{const a=e.findColumn(n.columnName),o=Np(n.direction);a?a.withOrdering(o,i):e.addSchemaColumn(n.columnName).withOrdering(o,i)})}_addIsDistinctToEsq(e,t){t&&(e.isDistinct=!0)}_excludeHierarchyFiltersFromFiltersCollection(e,t){return t.map(n=>n?.type!==P.Filter||!n?.value||e.hierarchicalColumnFiltersValue!==n.value?n:null).filter(n=>!!n)}_addHierarchyOptionsToEsq(e,t){t&&(t.hierarchicalFullDataLoad&&(e.hierarchicalFullDataLoad=t.hierarchicalFullDataLoad),t.hierarchicalColumnName&&(e.hierarchicalColumnName=t.hierarchicalColumnName,e.isHierarchical=!0),t.hierarchicalColumnValue&&(e.hierarchicalColumnValue=t.hierarchicalColumnValue),t.hierarchicalMaxDepth&&(e.hierarchicalMaxDepth=t.hierarchicalMaxDepth),t.hierarchicalColumnFiltersValue&&(e.hierarchicalColumnFiltersValue=t.hierarchicalColumnFiltersValue))}_addColumnToEsq(e,t){t.filter(Boolean).forEach(n=>{this._entitySchemaColumnAppenderFactory.create(n).addColumn(e,n)})}_prepareAttributePairsForLoad(e,t){return t.map(n=>{if(typeof n=="string"){const i=n,a=e.attributes.find(o=>o.name===i);return a?this._dataSchemaToDataSourceAttributeConverter.create(a.attributeType).convert(a):{name:i,path:i}}else return n})}_applyESQParameters(e,t){return e.hierarchicalColumnFiltersValue&&(t=this._excludeHierarchyFiltersFromFiltersCollection(e,t)),this.entitySchemaQueryUtils.applyParameters(t,e)}build(e,t,n,i){if(n.some(a=>a.type===P.Never))throw new Error('Failed to build entity schema query: parameters contains "Never" model parameter.');return(0,c.forkJoin)([this.entitySchemaQueryUtils.convertToEntityDataSourceParameters(e,n),(0,c.of)(this._prepareAttributePairsForLoad(e,t))]).pipe((0,c.map)(([a,o])=>({esq:new jl(e.name),esqParameters:a,dataSourceAttributes:o})),(0,c.tap)(({esq:a,dataSourceAttributes:o})=>this._addColumnToEsq(a,o)),(0,c.tap)(({esq:a})=>this._addSortingToEsq(a,i?.sortingConfig)),(0,c.tap)(({esq:a})=>this._addPagingToEsq(a,i?.pagingConfig)),(0,c.tap)(({esq:a})=>this._addIsDistinctToEsq(a,i?.isDistinct)),(0,c.tap)(({esq:a})=>this._addHierarchyOptionsToEsq(a,i?.hierarchyConfig)),(0,c.switchMap)(({esq:a,esqParameters:o})=>this._applyESQParameters(a,o)))}static{this.\u0275fac=function(t){return new(t||as)(r.\u0275\u0275inject(Fn),r.\u0275\u0275inject(Dp),r.\u0275\u0275inject(Vp))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:as,factory:as.\u0275fac,providedIn:"root"})}}const wo=s=>{switch(s){case f.Guid:return f.Guid;case f.Text:case f.SHORT_TEXT:case f.PHONE_TEXT:case f.WEB_TEXT:case f.EMAIL_TEXT:case f.MEDIUM_TEXT:case f.MAXSIZE_TEXT:case f.LONG_TEXT:case f.HASH_TEXT:case f.SECURE_TEXT:case f.RICH_TEXT:return f.Text;case f.Integer:case f.Enum:return f.Integer;case f.Float:case f.FLOAT0:case f.FLOAT1:case f.FLOAT2:case f.FLOAT3:case f.FLOAT4:case f.FLOAT8:case f.MONEY0:case f.MONEY1:case f.Money:case f.MONEY3:return f.Float;case f.DateTime:case f.Date:case f.Time:return f.DateTime;case f.Lookup:case f.IMAGELOOKUP:return f.Lookup;case f.Boolean:return f.Boolean;case f.Blob:return f.Blob;case f.Image:return f.Image;case f.Color:return f.Color;default:throw new Error(`Type ${s} not implemented`)}};function ny(s,e=null,t=DataValueType.Float){if(!s||s.length===0)return e;if(s.length===1)return s[0];let n=s.map(i=>wo(i)).map(i=>DataValueTypeGroup.Number.includes(i)?t:i);return n=[...new Set(n)],n.length===1?n[0]:e}class kp extends yo{constructor(){super(...arguments),this.supportTransactions=!0}}class os extends kp{get isForceUpdateUnchangedData(){return!!this.initialConfig?.isForceUpdateUnchangedData}get affectedAttributes(){return[...this._affectedAttributes]}get isAggregate(){return this.dataSchema?this.dataSchema.attributes.some(t=>t.isAggregate):!1}get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._affectedAttributes=[],this._errorReferenceAttributes=[],this.type=Dl,this._featureValues=t.get(W),this._queryExecutor=t.get(Bn),this._entitySchemaService=t.get(Lt),this._httpClient=this.injector.get(O.HttpClient),this._rightsService=this.injector.get(vo),this.dataSchemaRepository=this.injector.get(mt),this._entitySchemaRepository=this.injector.get(qe),this._entitySchemaQueryBuilder=this.injector.get(as),this._entitySchemaQueryUtils=this.injector.get(Fn),this._window=this.injector.get(Ie),this._measurePerformanceService=this.injector.get(z);const n=this.injector.get(_n);this._entityDefaultValuesUrl=n.isSSP?"/ssp/rest/EntitySchemaService/GetEntityDefaultValues":"/rest/EntitySchemaService/GetEntityDefaultValues",this.translateService=this.injector.get(A.TranslateService)}_buildSelectEsq(e,t,n){return this.getSchema().pipe((0,u.switchMap)(i=>this._entitySchemaQueryBuilder.build(i,e,t,n)),(0,u.map)(i=>(this._featureValues["DataSource-DisableRecordDeactivation"]!==!0&&(i.useRecordDeactivation=this.initialConfig.useRecordDeactivation),i.adminUnitRoleSources=this._getEsqAdminUnitRoleSources(),i)))}_getEsqAdminUnitRoleSources(){let e;const t=this.initialConfig.adminUnitRoleSources;return(0,v.isNumber)(t)?t:((0,v.isArray)(t)&&t.forEach(n=>{const i=bo[n];(0,v.isNumber)(i)&&(e=e|i)}),e)}_normalizeValue(e,t){switch(t){case f.Lookup:return e||null;case f.Date:case f.Time:case f.DateTime:return e instanceof Date?Yc(e):typeof e=="string"&&Date.parse(e)>0?`"${e}"`:e;default:return e}}_buildUpdateEsq(e,t){return this.getSchema().pipe((0,u.switchMap)(n=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(n,e,!0)),(0,u.map)(n=>({updateQuery:new Bl(this._entitySchemaName),esqParameters:n})),(0,u.tap)(({updateQuery:n})=>{n.isForceUpdate=!!this.initialConfig.isForceUpdate,Object.keys(t).forEach(i=>{const a=this._findEntitySchemaColumn(i);if(!a)throw new Error(`Column ${i} not found`);const o=t[i];this._isEntityColumnValue(o)&&n.addColumn(a.name,this._normalizeValue(o,a.dataValueType),wo(a.dataValueType))})}),(0,u.switchMap)(({updateQuery:n,esqParameters:i})=>this._entitySchemaQueryUtils.applyParameters(i,n)),(0,u.catchError)(n=>(0,c.throwError)(()=>n)))}_buildInsertEsq(e){const t=new kl(this._entitySchemaName);return Object.keys(e).forEach(n=>{const i=this._findEntitySchemaColumn(n);if(!i)throw new Error(`Column ${n} not found`);const a=e[n];this._isEntityColumnValue(a)&&t.addColumn(i.name,this._normalizeValue(a,i.dataValueType),wo(i.dataValueType))}),t}_buildDeleteEsq(e){return this.getSchema().pipe((0,u.switchMap)(t=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(t,e,!0)),(0,u.switchMap)(t=>{const n=new pp(this._entitySchemaName);return this._entitySchemaQueryUtils.applyParameters(t,n)}))}_checkOwnAttributes(e){return this.getSchema().pipe((0,u.switchMap)(t=>{const n=t.attributes.filter(i=>i.attributeType!==V.OwnAttribute).filter(i=>!(0,v.isUndefined)(e[i.name]));return n.length!==0?(0,c.throwError)(()=>new Error(`Not valid attributes for this data source: ${n.map(i=>i.name).join(",")}`)):(0,c.of)(null)}))}_findEntitySchemaColumn(e){return this._entitySchema.columns.find(t=>t.name===e)}_isEntityColumnValue(e){const t=n=>typeof n=="object"&&(n===null||"value"in n);return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||e instanceof Date||t(e)}_parseDefaultValues(e,t){const n=new Map(e.attributes.map(i=>[i.name,i.dataValueType]));return t.reduce((i,a)=>{const{defaultValue:o,name:l}=a;if((0,v.isNil)(o.value))return i;if(o.displayValue)return{...i,[l]:o};const d=Ll(o.value,n.get(l));return{...i,[l]:d}},{})}_getDefaultValues(e){const t=`${this._entityDefaultValuesUrl}?entityName=${e}`;return this._httpClient.get(t).pipe((0,u.catchError)(n=>this._catchErrorResponse(n)),(0,u.map)(n=>n.GetEntityDefaultValuesResult),(0,u.mergeMap)(n=>this.getSchema().pipe((0,u.tap)(i=>{let a=this._window.defaultValueStorage;const o=n?.find(l=>l.name===i.primaryAttributeName)?.defaultValue?.value;if(a=a||{},o){const l=`${e}_${o}`;a[l]=n,this._window.defaultValueStorage=a}}),(0,u.map)(i=>this._parseDefaultValues(i,n)))))}_catchErrorResponse(e){return console.log(e),(0,c.of)({GetEntityDefaultValuesResult:[]})}_requestEntitySchemaColumnsInfo(e){const t=e.map(n=>n.attributePath);return this._entitySchemaService.getEntitySchemaColumnsInformationByPathsArray(this._entitySchema.uId,t).pipe((0,u.map)(n=>e.map(i=>({column:n[i.attributePath],config:i}))))}_getEntitySchemaForwardReferenceColumnsInfo(e){const t={name:this._entitySchemaName,loadLookupColumns:!1,forwardReferencePaths:e.map(n=>n.attributePath)};return this._entitySchemaRepository.getSchemes([t]).pipe((0,u.map)(()=>e.map(n=>{const i=n.attributePath.split("."),a=this._entitySchemaRepository.findEntitySchemaColumnByPath(this._entitySchemaName,i);return{column:new mo(a),config:n}})))}_createReferenceAttributes(e,t){return t.length===0?(0,c.of)(e):(0,c.of)(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"]).pipe((0,u.switchMap)(n=>n?this._requestEntitySchemaColumnsInfo(t):this._getEntitySchemaForwardReferenceColumnsInfo(t))).pipe((0,u.tap)(n=>{n.forEach(({column:i,config:a})=>{a.attributeType===V.AggregationAttribute&&a.aggregationConfig?.aggregationFunction===Co.Count&&(i.dataValueType=f.Integer),e.addAttribute(i,a)})}),(0,u.map)(()=>e))}_createAttributesFromInitialConfig(e,t={}){const n=[];return Object.entries(t).forEach(([i,a])=>{const o=a;o.type===V.ForwardReferenceAttribute&&n.push({attributeName:i,attributeType:V.ForwardReferenceAttribute,attributePath:o.path}),o.type===V.AggregationAttribute&&n.push({attributeName:i,attributeType:V.AggregationAttribute,attributePath:o.path,aggregationConfig:o.aggregationConfig}),o.type===V.FunctionAttribute&&n.push({attributeName:i,attributeType:V.FunctionAttribute,attributePath:o.path,functionConfig:o.functionConfig})}),this._createReferenceAttributes(e,n).pipe((0,u.catchError)(i=>{const a=i.message&&i.toString(),o=new dp(this,a);return this._errors.push(o),n.forEach(l=>{this._errorReferenceAttributes.push(l)}),(0,c.of)(e)}))}_shouldSkipLoad(e){return e.some(t=>t.type===P.Never)}_setValidValuesForLookupAttributes(e,t){return Object.keys(t).forEach(n=>{const i=e.attributes.find(a=>a.name===n);i&&(i.dataValueType===f.Lookup||i.dataValueType===f.IMAGELOOKUP)&&t[n]===""&&(t[n]=null)}),t}_throwErrorResponse(e){const t=typeof e=="string"?e:e?.message;return(0,c.throwError)(()=>({success:!1,rowsAffected:0,errorInfo:t}))}_mapOperationResult(e){return{success:e.success,rowsAffected:e.rowsAffected}}_getIsAffectedAttributeStored(e){return this._affectedAttributes.some(t=>t.path===e.path&&t.schemaName===e.schemaName)}_collectUsedAttributes(e){let t=e._getUsedColumns();t=t.filter(n=>!this._getIsAffectedAttributeStored(n)),this._affectedAttributes.push(...t)}_findErrorReferenceAttribute(e){const t=typeof e=="string"?e:e.name;return this._errorReferenceAttributes.find(n=>n.attributeName===t)}_load(e,t,n,i){if(this.hasErrors){if(this.hasCriticalErrors)return(0,c.throwError)(()=>this.getLastError());if(e.length!==0&&e.every(o=>this._findErrorReferenceAttribute(o)!=null))return(0,c.throwError)(()=>this.getLastError())}return this._shouldSkipLoad(t)?(0,c.of)([]):this._buildSelectEsq(e,t,n||{}).pipe((0,u.tap)(a=>this._collectUsedAttributes(a)),(0,u.switchMap)(a=>{let o;const l={throttled:n?.throttled};return i?(a.queryId=i.id,o=this._queryExecutor.executeSelectQuery(a,l,i.transactionId),i.markAsReady()):o=this._queryExecutor.executeSelectQuery(a,l),o.pipe(this._measurePerformanceService.measure$(`EntityDataSource.load.executeSelectQuery.${this.dataSourceName}`),(0,u.catchError)(d=>d instanceof no?(0,c.throwError)(()=>d):(0,c.throwError)(()=>new Error(this.translateService.instant("BaseViewModel.LoadingModelErrorMessage")))))}),(0,u.map)(a=>a),(0,u.mergeMap)(a=>this.getSchema().pipe((0,u.map)(o=>(o.attributes&&a.forEach(l=>{this._setValidValuesForLookupAttributes(o,l)}),a)))))}_save(e,t,n){return this.hasCriticalErrors?(0,c.throwError)(()=>this.getLastError()):this._checkOwnAttributes(t).pipe((0,u.switchMap)(()=>this._buildUpdateEsq(e,t)),(0,u.switchMap)(i=>{if(n){i.queryId=n.id;const a=this._queryExecutor.executeUpdateQuery(i,n.transactionId);return n.markAsReady(),a}return this._queryExecutor.executeUpdateQuery(i)}),(0,u.map)(i=>this._mapOperationResult(i)),(0,u.catchError)(i=>this._throwErrorResponse(i)))}_insert(e,t){return this.hasCriticalErrors?(0,c.throwError)(()=>this.getLastError()):this._checkOwnAttributes(e).pipe((0,u.map)(()=>this._buildInsertEsq(e)),(0,u.switchMap)(n=>{let i;return t?(n.queryId=t.id,i=this._queryExecutor.executeInsertQuery(n,t.transactionId),t.markAsReady()):i=this._queryExecutor.executeInsertQuery(n),(0,c.forkJoin)({response:i,dataSchema:this.getSchema()})}),(0,u.map)(({response:n,dataSchema:i})=>({...this._mapOperationResult(n),primaryAttributes:[{[i.primaryAttributeName]:n.id}]})),(0,u.catchError)(n=>this._throwErrorResponse(n)))}_delete(e,t){return this.hasCriticalErrors?(0,c.throwError)(()=>this.getLastError()):this._buildDeleteEsq(e).pipe((0,u.tap)(n=>{n.queryId=t?.id}),(0,u.switchMap)(n=>{if(t){n.queryId=t.id;const i=this._queryExecutor.executeDeleteQuery(n,t.transactionId);return t.markAsReady(),i}return this._queryExecutor.executeDeleteQuery(n)}),(0,u.map)(n=>this._mapOperationResult(n)),(0,u.catchError)(n=>this._throwErrorResponse(n)))}innerLoad(e,t,n){return this._load(e,t,n)}innerSave(e,t){return this._save(e,t)}innerInsert(e){return this._insert(e)}innerDelete(e){return this._delete(e)}innerGetSchema(){return this.hasCriticalErrors?(0,c.throwError)(()=>this.getLastError()):this.dataSchemaRepository.get(this._entitySchemaName).pipe((0,u.map)(e=>new Fl(e)),(0,u.switchMap)(e=>this._createAttributesFromInitialConfig(e,this.initialConfig.attributes)),(0,u.tap)(e=>{const t=this._getDefaultValues(this._entitySchemaName).pipe((0,u.shareReplay)({bufferSize:1,refCount:!0}));e.setAttributesDefaultValue(t)}),(0,u.map)(e=>e.build()))}innerGetLookupDataSchema(e){if(this.hasCriticalErrors)return(0,c.throwError)(()=>this.getLastError());const n=e.split(".")[0],i=this._findEntitySchemaColumn(n);return i?i.dataValueType!==f.Lookup?(0,c.throwError)(()=>new Error(`DataValueType for column '${n}' isn't lookup`)):i.referenceSchemaName?this.dataSchemaRepository.get(i.referenceSchemaName):(0,c.throwError)(()=>new Error(`referenceSchemaName for column '${n}' is absent`)):(0,c.throwError)(()=>new Error(`Can't find column with name '${n}'`))}innerGetDefaultValues(){return this.hasCriticalErrors?(0,c.throwError)(()=>this.getLastError()):this._getDefaultValues(this._entitySchemaName)}innerCanDelete(e){return this.hasCriticalErrors?(0,c.of)({result:!1}):this._rightsService.getCanDelete({schemaName:this.initialConfig.entitySchemaName,primaryColumnValue:e.primaryColumnValue})}innerCanCreate(e){if(this.hasCriticalErrors)return(0,c.of)({result:!1});const t={isNew:!0,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}innerCanEdit(e){if(this.hasCriticalErrors)return(0,c.of)({result:!1});const t={primaryColumnValue:e.primaryColumnValue,isNew:!1,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}getEmptySchema(){return this._entitySchemaName?new ht({name:this._entitySchemaName}):super.getEmptySchema()}init(e,t){return super.init(e,t).pipe((0,u.mergeMap)(n=>{if(!this.initialConfig.entitySchemaName){const i=new Sp(this);return this._errors.push(i),(0,c.throwError)(()=>i)}return(0,c.of)(n)}),(0,u.tap)(()=>this._entitySchemaName=this.initialConfig.entitySchemaName),(0,u.mergeMap)(n=>this._entitySchemaRepository.getSchemaByName(this.initialConfig.entitySchemaName).pipe((0,u.tap)(i=>this._entitySchema=i),(0,u.catchError)(()=>{this._entitySchema=new Pl,this._entitySchema.name=this._entitySchemaName,this._entitySchema.columns=[];const i=new Cp(this,this._entitySchemaName);return this._errors.push(i),(0,c.throwError)(()=>i)}),(0,u.map)(()=>n))))}getOwnLoadParameters(){return this.initialConfig?.loadParameters}getAllowCopyingRecords(){return this.initialConfig?.allowCopyingRecords}loadInTransaction(e,t,n,i){return this._load(t,n,i,e)}saveInTransaction(e,t,n){return this._save(t,n,e)}insertInTransaction(e,t){return this._insert(t,e)}deleteInTransaction(e,t){return this._delete(t,e)}}class Lp extends os{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotActionDataSource",this._intentManager=this.injector.get(Ft)}_getActionUId(e){return e.filter(n=>n.type===P.PrimaryColumnValue)[0]?.value}innerDelete(e){return(0,c.of)(void 0)}innerInsert(e){const t=e;return(0,c.forkJoin)([this._intentManager.createAction(t),this.getSchema()]).pipe((0,c.map)(([n,i])=>({success:n.success,rowsAffected:1,errorInfo:n.errorInfo?.message,primaryAttributes:n.success?[{[i.primaryAttributeName]:t.Id}]:null})))}innerLoad(e,t,n){const i=this._getActionUId(t);return i?this._intentManager.getActionByUId(i).pipe((0,c.map)(a=>[a])):(0,c.of)([])}innerSave(e,t){const n=this._getActionUId(e),i=t;return i.Id=n,this._intentManager.updateAction(i).pipe((0,c.map)(a=>({success:a.success,rowsAffected:1,errorInfo:a.errorInfo?.message})))}}class $l{}const Fp="CopilotIntentStatus",jp=new Map([["InDevelopment","4670b068-ad03-4364-9350-6cc61efd1b7f"],["Active","1d73b111-07a9-49e2-aa15-c9415cce7470"],["Deactivated","2c547e71-7a05-42e1-8b65-2bf63f200156"]]),$p="CopilotIntentMode",Up={Chat:"Chat",Api:"API"},zp=new Map([["Chat","326bba59-302a-4a5e-857c-2576e1a38ab0"],["API","5f2dc095-4543-4972-b6bc-6599bf6bc3fd"]]),Ul={System:{value:"35f3b644-4fa3-4d1e-8e62-5c3fdc4d3e52",displayValue:"System",primaryColorValue:"#22AC14"},Skill:{value:"6d940b75-21c8-4a90-89ab-9867e6e4a045",displayValue:"Skill",primaryColorValue:"#7848EE"},Agent:{value:"a8fbe253-be1b-4ec4-bc58-65b8047013da",displayValue:"Agent",primaryColorValue:"#E67E22"}};function Hp(){return(0,c.of)(Object.values(Ul))}class cs{constructor(e){this._entitySchemaService=e}_loadPrimaryColumns(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,u.map)(t=>{const n=t.entitySchema.getPrimaryColumn(),i=t.entitySchema.getPrimaryDisplayColumn();if((0,v.isEmpty)(i))throw new Error(`Entity ${e} should have primary display column`);return{primaryColumnName:n.name,primaryDisplayColumnName:i?.name}}))}getColumnLookupValues(e){if((0,v.isEmpty)(e))return(0,c.of)(null);const t=this._loadPrimaryColumns(e),n=(0,c.from)(ut.create(e));return(0,c.forkJoin)([t,n]).pipe((0,u.switchMap)(([i,a])=>(0,c.from)(a.load({attributes:[i.primaryColumnName,i.primaryDisplayColumnName]})).pipe((0,u.map)(l=>l.map(d=>({value:d[i.primaryColumnName],displayValue:d[i.primaryDisplayColumnName]}))))))}static{this.\u0275fac=function(t){return new(t||cs)(r.\u0275\u0275inject(Lt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:cs,factory:cs.\u0275fac,providedIn:"root"})}}class ls{constructor(e,t){this._columnLookupValuesService=e,this._injector=t,this._intentStatuses=jp,this._intentModes=zp}convertToDataSourceModel(e){const t=this._injector.get($l);return(0,c.combineLatest)([this._columnLookupValuesService.getColumnLookupValues(Fp),this._columnLookupValuesService.getColumnLookupValues($p),Hp(),t.getAllLlmModels()]).pipe((0,c.map)(([n,i,a])=>{const o=this._intentStatuses.get(e.Status),l=n.find(T=>T.value===o),d=this._intentModes.get(e.Mode)??this._intentModes.get(Up.Chat),h=i.find(T=>T.value===d),p=a.find(T=>T.displayValue===e.Type),g=t.getModelByCodeSync(e.LlmModel),C={Id:e.UId,Code:e.Code,Description:e.Description,Prompt:e.Prompt,Type:p,Name:e.Title,Status:l,PackageUId:e.PackageUId,LlmModel:g?{value:g.Id,displayValue:g.Name}:null,ResponseFormatJsonSchema:e.ResponseFormatJsonSchema};return e.Type==="Agent"?{...C,Restrictions:e.Restrictions,RoleDescription:e.RoleDescription}:{...C,Mode:h}}))}convertToModel(e){const t={};for(const[n,i]of Object.entries(e)){let a=n,o=i;n==="Name"&&(a="Title"),n==="Id"&&(a="UId"),n==="Status"&&(o=[...this._intentStatuses].filter(([,l])=>l===e.Status.value).map(([l])=>l).shift()),n==="Mode"&&(o=[...this._intentModes].filter(([,l])=>l===e.Mode.value).map(([l])=>l).shift()),n==="Type"&&(o=Object.values(Ul).filter(l=>l.value===e.Type.value).map(l=>l.displayValue).shift()),n==="LlmModel"&&(o=this._injector.get($l).getModelByNameSync(e.LlmModel?.displayValue)?.Code),t[a]=o}return t}static{this.\u0275fac=function(t){return new(t||ls)(r.\u0275\u0275inject(cs),r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ls,factory:ls.\u0275fac,providedIn:"root"})}}class Gp extends os{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._defaultValuesMap=new Map,this.type="crt.CopilotIntentDataSource",this._intentManager=this.injector.get(Ft),this._copilotIntentDataSourceModelConvertor=this.injector.get(ls),this._initDefaultValuesMap()}_initDefaultValuesMap(){this._defaultValuesMap.set("CopilotIntent",{UId:D(),Status:"Active",Mode:"Chat",Type:"Skill",Prompt:this.translateService.instant("CopilotIntentDataSource.DefaultValues.Prompt")}),this._defaultValuesMap.set("CopilotAgent",{UId:D(),Status:"Active",Type:"Agent"})}innerGetDefaultValues(){const e=this.initialConfig.entitySchemaName,t=this._defaultValuesMap.get(e);return this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(t)}innerInsert(e){const t=this._copilotIntentDataSourceModelConvertor.convertToModel({...e});return(0,c.forkJoin)([this._intentManager.createIntent(t),this.getSchema()]).pipe((0,c.map)(([n,i])=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message,primaryAttributes:[{[i.primaryAttributeName]:n.schemaUid}]})),(0,u.switchMap)(n=>n.success?(0,c.of)(n):(0,c.throwError)(()=>n)))}innerLoad(e,t,n){const i=t.filter(a=>a.type===P.PrimaryColumnValue);if(i.length)return this._intentManager.getIntent(i[0].value).pipe((0,u.switchMap)(a=>this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(a).pipe((0,c.map)(o=>[o]))))}innerSave(e,t){const i=e.filter(o=>o.type===P.PrimaryColumnValue)[0].value,a=this._copilotIntentDataSourceModelConvertor.convertToModel({...t});return a.UId=i,this._intentManager.updateIntent(a).pipe((0,c.map)(o=>({success:o.success,rowsAffected:o.success?1:0,errorInfo:o.errorInfo?.message})),(0,u.switchMap)(o=>o.success?(0,c.of)(o):(0,c.throwError)(()=>o)))}}class qp{static fromJson(e){throw new Error("not implemented")}}class Wp{static resolve(e){return{[q.Compare]:Ve,[q.FilterGroup]:Ce,[q.In]:$t,[q.IsNull]:We,[q.Exists]:jt,[q.Between]:Yi}[e]}}class Zp{static fromJson(e,t){throw new Error("not implemented")}}class Kp{static resolve(e){return{[de.Macros]:Ut,[de.Length]:is,[de.Window]:ss,[de.DatePart]:Ht,[de.DateAdd]:Ht,[de.DateDiff]:Ht}[e.functionType]}}class Jp{static resolve(e,t){return{[ue.SchemaColumn]:U,[ue.Parameter]:J,[ue.SubQuery]:es,[ue.ArithmeticOperation]:ts,[ue.Function]:Kp.resolve(t)}[e]}}class Io extends Zp{static fromJson(e,t){const n=e.expressionType;return Jp.resolve(n,e).fromJson(e,t,Io)}}class us extends qp{static fromJson(e){const t=e.filterType,n=e.isEnabled,i=e.trimDateTimeParameterToDate,a=Wp.resolve(t).fromJson(e,us,Io);return a.isEnabled=n!==!1,a.trimDateTimeParameterToDate=i===!0,a}}class ds{convertToDataSourceModel(e){return(0,c.of)({Id:e.UId,Intent:e.Intent,Code:e.Code,Name:e.Name,Description:e.Description,SourceCollection:e.SourceCollection,DataValueTypeUId:e.DataValueTypeUId})}convertToModel(e){const t={};return Object.entries(e).forEach(([n,i])=>{n==="Id"&&(n="UId"),t[n]=i}),t}static{this.\u0275fac=function(t){return new(t||ds)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ds,factory:ds.\u0275fac,providedIn:"root"})}}class Yp extends os{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotIntentParameterDataSource",this._intentManager=this.injector.get(Ft),this._modelConvertor=this.injector.get(ds)}_getPrimaryColumnParameter(e){return e.find(t=>t.type===P.PrimaryColumnValue&&ic(t.value))}_getIsIntentUIdParameter(e){return(e.relationsConfigs??[]).some(t=>t.dataSchemaName==="CopilotIntent"&&t.attributePath==="Intent")}_getSourceCollectionFilterValue(e){const t=e.find(a=>a.type===P.Filter);if(!t?.value)return null;const n=us.fromJson(t.value);let i;return n.filters.forEach(a=>{a instanceof Ve&&a.leftExpression instanceof U&&a.leftExpression.columnPath==="SourceCollection"&&a.rightExpression instanceof J&&(i=a.rightExpression.value)}),i}innerGetDefaultValues(){return this._modelConvertor.convertToDataSourceModel({UId:D()})}innerInsert(e){const t=this._modelConvertor.convertToModel({...e});return this._intentManager.createIntentParameter(t).pipe((0,c.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message,primaryAttributes:[{Id:t.UId}]})),(0,c.switchMap)(n=>n.success?(0,c.of)(n):(0,c.throwError)(()=>n)))}innerLoad(e,t,n){const i=this._getPrimaryColumnParameter(t),a=this._getSourceCollectionFilterValue(t)??"InputParameters";return i?(this._getIsIntentUIdParameter(i)?this._intentManager.getIntentParameters(i.value,a):this._intentManager.getIntentParameter(i.value).pipe((0,c.map)(l=>[l]))).pipe((0,c.mergeMap)(l=>(0,c.from)(l).pipe((0,c.mergeMap)(d=>this._modelConvertor.convertToDataSourceModel(d)),(0,c.toArray)())),(0,c.catchError)(()=>(0,c.of)([]))):(0,c.of)([])}innerSave(e,t){const n=this._getPrimaryColumnParameter(e)?.value,i=this._modelConvertor.convertToModel({...t});return i.UId=n,this._intentManager.updateIntentParameter(i).pipe((0,c.map)(a=>({success:a.success,rowsAffected:a.success?1:0,errorInfo:a.errorInfo?.message})),(0,c.switchMap)(a=>a.success?(0,c.of)(a):(0,c.throwError)(()=>a)))}innerDelete(e){const t=this._getPrimaryColumnParameter(e)?.value;return this._intentManager.deleteIntentParameter(t).pipe((0,c.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message})),(0,c.switchMap)(n=>n.success?(0,c.of)(n):(0,c.throwError)(()=>n)))}}class Xp extends os{innerDelete(e){return(0,c.of)(null)}innerInsert(e){return(0,c.of)(null)}innerLoad(e,t){return(0,c.of)([])}innerSave(e,t){return(0,c.of)(null)}innerGetLookupDataSchema(e){return(0,c.of)(null)}innerGetDefaultValues(){return(0,c.of)(null)}innerCanDelete(e){return(0,c.of)(null)}innerCanEdit(e){return(0,c.of)(null)}innerCanCreate(e){return(0,c.of)(null)}}var we;(function(s){s.Create="create",s.Update="update",s.Delete="delete"})(we||(we={}));const Eo=window;class hs{constructor(){this._event$=new c.Subject}static get instance(){return Eo.__modelEventNotificationService||(Eo.__modelEventNotificationService=new hs),Eo.__modelEventNotificationService}get event$(){return this._event$.asObservable()}notify(e){this._event$.next(e)}}class ps{constructor(){this.changedValues$=new c.Subject,this._valuesStore={}}setValues(e){if(e){const t={};Object.entries(e).forEach(([n,i])=>{const a=this._valuesStore[n]!==i;this._valuesStore[n]=(0,v.cloneDeep)(i),a&&(t[n]=this._valuesStore[n])}),(0,v.isEmpty)(t)||this.changedValues$.next(t)}}get values(){return this._valuesStore}static{this.\u0275fac=function(t){return new(t||ps)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ps,factory:ps.\u0275fac})}}const zl="PrimaryValue",Hl="DisplayValue",Ao="PrimaryColorValue";class ms{constructor(e,t){this._queryExecutor=e,this._entitySchemaRepository=t}_getInFilter(e){const t=new Ut({macrosType:Vn.PrimaryColumn});return new $t(Z.Equal,t,e.map(n=>new J({value:n})))}_getEsq(e,t){const n=new jl(e);return this._entitySchemaRepository.getSchemaByName(e).pipe((0,u.map)(i=>{n.addMacrosFunctionColumn(Vn.PrimaryColumn,zl),n.addMacrosFunctionColumn(Vn.PrimaryDisplayColumn,Hl);const a=i.getPrimaryColorColumn();a&&n.addSchemaColumn(a.name,Ao);const o=this._getInFilter(t);return n.filters.add(o),n}))}_getSchemaLookupData(e,t){const n={};for(let i=0;i<t.length;i++){const a=t[i],[o,l]=e[i];n[o]={};for(const d of l){const h=a.find(p=>p[zl]===d);if(h){const p=[h[Hl]];h[Ao]&&p.push(h[Ao]),n[o][d]=h?p:null}}}return n}load(e){const t=Object.entries(e);return(0,c.forkJoin)(t.map(([n,i])=>this._getEsq(n,i))).pipe((0,c.switchMap)(n=>this._queryExecutor.executeBatchSelectQuery(n).pipe((0,u.map)(i=>this._getSchemaLookupData(t,i)))))}static{this.\u0275fac=function(t){return new(t||ms)(r.\u0275\u0275inject(Bn),r.\u0275\u0275inject(qe))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ms,factory:ms.\u0275fac,providedIn:"root"})}}class Qp extends yo{constructor(e,t){super(e,t),this.dataSourceName=e,this._injector=t,this.type=Vl,this._schemaParametersStore=this._injector.get(ps),this._lookupDataLoadService=this._injector.get(ms),this._featureValues=this._injector.get(W),this._featureValues.DisableCommunicationBetweenSchemas||this._subscribeParametersChanged()}_subscribeParametersChanged(){this._schemaParametersStore.changedValues$.subscribe(e=>{hs.instance.notify({modelId:D(),dataSchemaName:this.dataSchema.name,type:we.Update,payload:{primaryAttributesValues:null,changedAttributes:Object.keys(e)}})})}_getCanSuccessfullyExecuteOperationResult(){return(0,c.of)({result:!0})}_fillLookupValues(e,t,n){Object.entries(n).forEach(([i,[a,o]])=>{(t[i]||[]).forEach(d=>{e[d]=o?{value:i,displayValue:a,primaryColorValue:o}:{value:i,displayValue:a}})})}_fillSchemaParameterValueNameMap(e,t,n,i){const a=i;let o=e[t];o||(o={},e[t]=o);let l=o[a];l||(l=[],o[a]=l),l.push(n)}_fillSchemaNamePrimaryValuesMap(e,t,n){const i=n;let a=e[t];a||(a=[],e[t]=a),a.push(i)}_isLookupValue(e){return!!e?.value}_shouldFillSchemaLookupValueMaps(e,t){return e&&t&&t.referenceSchemaName&&!this._isLookupValue(e)}_load(e,t){const n={},i=this._schemaParametersStore.values,a=t.attributes,o={},l={};for(const h of e){const p=i[h],g=a.find(C=>C.name===h);if(this._shouldFillSchemaLookupValueMaps(p,g)){this._fillSchemaNamePrimaryValuesMap(l,g.referenceSchemaName,p),this._fillSchemaParameterValueNameMap(o,g.referenceSchemaName,h,p);continue}n[h]=p??null}return Object.keys(l).length===0?(0,c.of)([n]):this._lookupDataLoadService.load(l).pipe((0,c.map)(h=>{for(const[p,g]of Object.entries(h)){const C=o[p];this._fillLookupValues(n,C,g)}return[n]}))}_getValuesForStore(e){const t={};return Object.entries(e).forEach(([n,i])=>{const a=this.initialConfig.parameters[n];if(!a)return;io(a.dataValueTypeName)===f.Lookup?t[n]=i?.value:t[n]=i}),t}innerLoad(e,t,n){return this.getSchema().pipe((0,c.switchMap)(i=>this._load(e,i)))}innerSave(e,t){const n=this._getValuesForStore(t);return this._schemaParametersStore.setValues(n),(0,c.of)({success:!0,rowsAffected:1})}innerInsert(e){const t=this._getValuesForStore(e);return this._schemaParametersStore.setValues(t),(0,c.of)({success:!0,rowsAffected:1,primaryAttributes:[]})}innerDelete(e){return(0,c.of)({success:!0,rowsAffected:1})}innerGetSchema(){const e=[],t=this.initialConfig.parameters;return t&&Object.entries(t).forEach(([n,i])=>{const a=new Xi({name:n,caption:i.caption,dataValueType:io(i.dataValueTypeName),attributeType:V.OwnAttribute,path:n,isRequired:!!i.isRequired,referenceSchemaName:i.referenceSchemaName,isMasked:!1,isFormatValidated:!0});a.addDefaultValidators(),e.push(a)}),(0,c.of)(new ht({name:this.initialConfig.schemaName,type:kn.ClientUnit,attributes:e}))}innerGetLookupDataSchema(e){return(0,c.of)(null)}innerGetDefaultValues(){return(0,c.of)({})}innerCanEdit(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanDelete(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanCreate(e){return this._getCanSuccessfullyExecuteOperationResult()}}class em extends yo{constructor(){super(...arguments),this.type="crt.WebServiceDataSource"}innerLoad(e,t,n){throw new Error("Method not implemented.")}innerSave(e,t){throw new Error("Method not implemented.")}innerInsert(e){throw new Error("Method not implemented.")}innerDelete(e){throw new Error("Method not implemented.")}innerGetSchema(){throw new Error("Method not implemented.")}innerGetLookupDataSchema(e){throw new Error("Method not implemented.")}innerGetDefaultValues(){throw new Error("Method not implemented.")}innerCanDelete(e){throw new Error("Method not implemented.")}innerCanEdit(e){throw new Error("Method not implemented.")}innerCanCreate(e){throw new Error("Method not implemented.")}}class fs{resolve(e){let t=null;switch(e){case Dl:t=os;break;case Vl:t=Qp;break;case"crt.WebServiceDataSource":t=em;break;case"crt.CopilotIntentDataSource":t=Gp;break;case"crt.CopilotIntentParameterDataSource":t=Yp;break;case"crt.CopilotActionDataSource":t=Lp;break;case"crt.DashboardDataSource":t=Xp;break}return(0,c.of)(t)}static{this.\u0275fac=function(t){return new(t||fs)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:fs,factory:fs.\u0275fac})}}class Gt{constructor(e,t){this.injector=e,this.resolver=t}create(e,t,n){const{type:i,scope:a,config:o}=t;return this.resolver.resolve(i).pipe((0,u.switchMap)(d=>d?new d(e,n||this.injector).init(o,a):(0,c.throwError)(()=>new Error(`Data source type '${i}' not supported.`))),(0,u.catchError)(d=>d instanceof _o?(0,c.of)(d.dataSource):(0,c.throwError)(()=>d)))}static{this.\u0275fac=function(t){return new(t||Gt)(r.\u0275\u0275inject(r.Injector),r.\u0275\u0275inject(fs))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Gt,factory:Gt.\u0275fac})}}class tm{}function Gl(s,e,t){return!s||!e||!t}function ql(s,e){return`/img/entity/hash/${s}/${e}/`}function Wl(s,e="SysImage",t="Data"){if(Gl(s,e,t))return"";const n=ql(e,t);return`${ir()}${n}${s}`}function iy(s,e="SysImage",t="Data"){return Gl(s,e,t)?"":`${ql(e,t)}${s}`}function nm(s){let e="";if(typeof s=="string"){const n=new TextEncoder().encode(s);e=String.fromCharCode(...n)}else if(s instanceof ArrayBuffer){const t=new Uint8Array(s);for(let n=0;n<t?.byteLength;n++)e+=String.fromCharCode(t[n])}return window.btoa(e)}function sy(s){const e=new DOMParser().parseFromString(s,"text/html"),t=e?.querySelectorAll("svg");return t.length>0&&t.forEach(n=>{const i=e.createElement("img"),a=nm(n.outerHTML);i.src=`data:image/svg+xml;base64,${a}`,n?.parentNode.replaceChild(i,n)}),e?.body.innerHTML||s}class Q{static _setImageLookupTypeUrl(e,t){const n=e[t],i=n?.value;i&&(n.url=Wl(i))}static _setBlobTypeUrl(e,t,n){const i=t[n];if(i){const a=t.Id;t[n]={value:i,url:Wl(a,e,n)}}}static _addImageUrl(e,t,n){t.forEach(i=>{switch(i.dataValueType){case f.IMAGELOOKUP:{this._setImageLookupTypeUrl(n,i.name);break}case f.Image:{this._setBlobTypeUrl(e,n,i.name);break}default:break}})}static serializeRecordPrimaryAttributesValues(e){return e.map(t=>`${t.name}:${t.value}`).join(";")}static getModelPrimaryAttributeValues(e,t){const n=e.getPrimaryAttributesNames();return t.map(i=>n.map(a=>({name:a,value:i[a]})))}static getOwnColumnsValues(e,t){const n=t??{};if(e.attributes.length){const i=e.attributes.filter(a=>a.attributeType===V.OwnAttribute).map(a=>a.name).filter(a=>!(0,v.isUndefined)(n[a])).map(a=>[a,n[a]]);return Object.fromEntries(i)}else return n}static getPrimaryAttributeValuesFromParameters(e,t){const n=t.filter(i=>i.type===P.PrimaryColumnValue);return n.length?n.map(i=>({[e.primaryAttributeName]:i.value})):[]}static getPrimaryAttributeValuesFromData(e,t){const n=e.getPrimaryAttributesNames();return n.length?n.filter(i=>t[i]).map(i=>({[i]:t[i]})):[]}static getPrimaryAttributeValues(e,t,n){const i=this.getPrimaryAttributeValuesFromData(e,t);return i.length?i:this.getPrimaryAttributeValuesFromParameters(e,n)}static getDataSourceLoadOptions(e){const t={loadType:e?.loadType||X.Load};return e?.pagingConfig&&(t.pagingConfig=e.pagingConfig),e?.sortingConfig&&(t.sortingConfig=e.sortingConfig),e?.hierarchyConfig&&(t.hierarchyConfig=e.hierarchyConfig),e?.isDistinct&&(t.isDistinct=e.isDistinct),t}static getImageAttributes(e,t){const n=[];return(t||[]).forEach(i=>{const a=e.findAttributeByName(i);a?.isImage&&n.push(a)}),n}static processImageData(e,t,n){const i=Q.getImageAttributes(e,n);return i.length>0&&t.forEach(a=>this._addImageUrl(e.name,i,a)),t}static removeNotRequestedData(e,t){return Object.keys(t).forEach(n=>{e.includes(n)||delete t[n]}),t}static getLoadRequestSignature(e,t,n,i){return JSON.stringify(e)+JSON.stringify(t)+JSON.stringify(n)+JSON.stringify(i)}}const im={[M.Init]:[M.Create,M.Copy,M.Update,M.Delete],[M.Copy]:[M.Delete,M.Update],[M.Create]:[M.Copy,M.Delete,M.Update],[M.Delete]:[M.Copy,M.Create,M.Update,M.Init],[M.Update]:[M.Delete],[M.Unknown]:[]};function xo(s){const e={success:!1,rowsAffected:0,errorInfo:""};return typeof s=="string"?Object.assign(e,{errorInfo:s}):s instanceof Error?Object.assign(e,{errorInfo:s.message}):Object.assign(e,typeof s=="object"?s:{errorInfo:s})}class jn{get _children(){return this._children$.value}static get instance(){return this._instance||(this._instance=new jn(null,null)),this._instance}constructor(e,t){this.injector=e,this.dataSource=t,this._lookupDataSourceName="lookupDataSource",this._id=D(),this._modeChanges=new c.Subject,this._destroyed$=new c.Subject,this._children$=new c.BehaviorSubject([]),this._childrenDirty$=new c.BehaviorSubject(!1),this._childrenModes$=new c.BehaviorSubject([]),this._isCollectionModel=!1,this._isCollectionItemModel=!1,this._mode=M.Init,this._isInitialized=!1,this._isLoaded=!1,this._dirtyAttributes=new Set,this._newLoadingRequestArrived=new c.Subject,this._attributesMap=[],this._selfDirty$=new c.BehaviorSubject(!1),this._isLoading=!1,this._destroyed=!1,this._doNotAllowCancelRequest=!1,this._dirty$=(0,c.combineLatest)([this._selfDirty$,this._childrenDirty$,this._childrenModes$]).pipe((0,u.map)(([n,i,a])=>n||i||a.includes(M.Copy)||a.includes(M.Create)),(0,u.distinctUntilChanged)()),this._loadedData=new Set,this.injector&&(this._dataSourceFactory=this.injector.get(Gt),this._lifecycleHookNotificationService=this.injector.get(tm,null,{optional:!0}),this._measurePerformanceService=this.injector.get(z,null,{optional:!0}),this._doNotAllowCancelRequest=this.injector.get(W,null,{optional:!0})?.DoNotAllowCancelRequest)}get name(){return this.dataSource?this.dataSource.dataSourceName:""}get mode(){return this._isCollectionModel?M.Unknown:this._mode}get _modeChanges$(){return this._modeChanges.asObservable()}get _isChanged(){return!!this._dirtyAttributes?.size}set _isCollection(e){this._isCollectionModel=e,this._isCollectionModel&&(this._mode=M.Unknown)}get isLoaded(){return this._isLoaded}get event$(){return hs.instance.event$.pipe((0,u.filter)(()=>this._isInitialized),(0,u.filter)(()=>!this._isCollectionItemModel),(0,u.filter)(({dataSchemaName:e})=>e===this._dataSchemaName),(0,u.tap)(({type:e,modelId:t,payload:n})=>this._updateLoadedData(e,t,n)),(0,u.filter)(({modelId:e})=>e!==this._id&&!this._isChild(e)),(0,u.map)(e=>({event:e,ownPrimaryAttributesValues:e.payload?.primaryAttributesValues?.filter(t=>{const n=Q.serializeRecordPrimaryAttributesValues(t);return this._loadedData.has(n)})})),(0,u.filter)(({event:e,ownPrimaryAttributesValues:t})=>e.type===we.Update||e.type===we.Delete?!t||t.length!==0:!0),(0,u.map)(({event:e,ownPrimaryAttributesValues:t})=>({event:e,primaryAttributesValues:e.type===we.Create?e.payload.primaryAttributesValues:t})),(0,u.map)(({event:e,primaryAttributesValues:t})=>({modelId:e.modelId,dataSchemaName:e.dataSchemaName,type:e.type,payload:{...e.payload,primaryAttributesValues:t}})),(0,u.takeUntil)(this._destroyed$))}get dataSchemaName(){return this._dataSchemaName}get allowSync(){return!this._disableSync}get disableSync(){return this._disableSync}set disableSync(e){this._disableSync=e}get isLoading(){return this._isLoading}get hasErrors(){return this.dataSource?this.dataSource.hasErrors:!0}get hasCriticalErrors(){return this.dataSource?this.dataSource.hasCriticalErrors:!0}get affectedAttributes(){return this.dataSource?this.dataSource.affectedAttributes:[]}get isAggregate(){return this.dataSource?this.dataSource.isAggregate:!1}get supportsTransactions(){return!1}get isCollectionItemModel(){return this._isCollectionItemModel}get isInitialized(){return this._isInitialized}_isChild(e){return this._children.some(t=>t?._id===e)}_subscribeChildrenModeChanges(){this._children$.pipe((0,u.map)(e=>e.map(t=>(0,c.merge)((0,c.of)(t.mode),t._modeChanges$))),(0,u.switchMap)(e=>e?.length?(0,c.combineLatest)(e):(0,c.of)([])),(0,u.tap)(e=>this._childrenModes$.next(e)),(0,u.takeUntil)(this._destroyed$)).subscribe()}_subscribeChildrenDirtyChanges(){this._children$.pipe((0,u.map)(e=>e.map(t=>t._dirty$)),(0,u.switchMap)(e=>e?.length?(0,c.combineLatest)(e):(0,c.of)([])),(0,u.map)(e=>e.some(t=>t)),(0,u.tap)(e=>this._childrenDirty$.next(e)),(0,u.takeUntil)(this._destroyed$)).subscribe()}_updateLoadedData(e,t,n){this._isCollectionModel&&e===we.Create&&this._isChild(t)&&n.primaryAttributesValues.forEach(i=>{const a=Q.serializeRecordPrimaryAttributesValues(i);this._loadedData.add(a)})}_setMode(e){if(this._mode===e)return;if(!im[this._mode]?.includes(e))throw Error(`Unable to mark model with '${this._mode}' mode for '${e}'.`);const n=this._mode;this._mode=e,e===M.Delete&&this._selfDirty$.next(n!==M.Create)}_markForNotCollection(e){this._isCollectionModel||this.markFor(e)}_registerPrimaryAttributeValues(e){e.forEach(t=>{this._loadedData.add(Q.serializeRecordPrimaryAttributesValues(t))})}_getDependentAttributesNames(e){return this._attributesMap.filter(t=>e.includes(t.name)).filter(t=>t.dependentAttributes.length!==0).map(t=>t.dependentAttributes).flat()}_getDefaultLoadAttributes(){return this.getSchema().pipe((0,u.map)(e=>e.getPrimaryLoadAttributes()))}_checkAttributesInDataSchema(e){return this.getSchema().pipe((0,u.tap)(t=>{const n=e.filter(i=>t.findAttributeByName(i)==null);if(n.length>0)throw new Error(`data has unknown attributes names: ${n.join(", ")}`)}))}_createDataSource(e,t,n=null){const i=n??t.dataSourceConfig;return this._dataSourceFactory.create(e,i)}_notifyEventByParameters(e,t){return this.getSchema().pipe((0,u.map)(n=>Q.getPrimaryAttributeValuesFromParameters(n,e)),(0,u.mergeMap)(n=>this._notifyDataChange(n,t)))}_notifyDataChange(e,t){return this.getSchema().pipe((0,u.map)(n=>Q.getModelPrimaryAttributeValues(n,e)),(0,u.tap)(n=>{hs.instance.notify({modelId:this._id,dataSchemaName:this._dataSchemaName,type:t,payload:{primaryAttributesValues:n}})}),(0,u.map)(()=>null))}_mapSaveResult(e,t,n){return this.getSchema().pipe((0,u.map)(i=>({result:e,actionType:we.Update,data:Q.getPrimaryAttributeValues(i,t,n)})))}_mapInsertResult(e){return{data:e.primaryAttributes??[],result:e,actionType:we.Create}}_getLoadAttributes(e){if(e&&e.length!==0){let t=null;if(e.every(i=>(0,v.isString)(i)))return t=this._getDependentAttributesNames(e),(0,c.of)([...e,...t]);{const i=e.map(a=>a.name);return t=this._getDependentAttributesNames(i),this.getSchema().pipe((0,u.map)(a=>(t=t.map(o=>a.findAttributeByName(o)).map(o=>({name:o.name,path:o.path,caption:o.caption,dataValueType:o.dataValueType,aggregationConfig:o.aggregationConfig})),[...e,...t])))}}return this._getDefaultLoadAttributes()}_getChangedAttributesValues(e){return this._persistedState?Object.entries({...this._persistedState,...e}).filter(([t])=>this._dirtyAttributes.has(t)).reduce((t,[n,i])=>Object.assign(t,{[n]:i}),{}):e}_load(e,t,n,i,a=M.Update){const o={attributes:t,parameters:n,options:i,mode:a},l=(0,v.cloneDeep)(this._lastRequestPayload),d=(0,v.isEqual)((0,v.omit)(o,"options.loadType"),(0,v.omit)(l,"options.loadType"));return this._loadingRequest&&d?this._loadingRequest:(this._lastRequestPayload&&!d&&(this._newLoadingRequestArrived.next(null),this._newLoadingRequestArrived=new c.Subject),this._lastRequestPayload=o,this._loadingRequest=this._getLoadAttributes(t).pipe(tt(()=>this._onBeforeLoad(o,l)),(0,u.switchMap)(h=>e(h,n,i)),(0,u.raceWith)(this._newLoadingRequestArrived.pipe((0,u.switchMap)(()=>(0,c.throwError)(()=>new no)))),(0,u.tap)(()=>this._markForNotCollection(a)),ec(()=>this.getSchema()),(0,u.tap)(([h,p])=>{this._registerPrimaryAttributeValues(Q.getModelPrimaryAttributeValues(p,h))}),(0,u.tap)(()=>this._persistedState={}),(0,u.map)(([h,p])=>Q.processImageData(p,h,t)),(0,u.tap)(()=>this._isLoaded=!0),tt(()=>this._onAfterLoad(o,l)),(0,u.catchError)(h=>(this._isLoaded=!1,(0,c.throwError)(()=>h))),(0,u.tap)(()=>{this._dirtyAttributes.size===0&&this._markAsPristine(),this._loadingRequest=null}),(0,u.share)()),(0,c.iif)(()=>!this._doNotAllowCancelRequest,this._loadingRequest.pipe((0,u.takeUntil)(this._destroyed$)),this._loadingRequest))}_updateAttributesDependencies(){this._attributesMap.forEach(t=>t.dependentAttributes=[]),this._attributesMap.filter(t=>t.attributeType!==V.OwnAttribute).forEach(t=>{const n=t.path.split(".");if(n.length===1)return;const i=n.shift(),a=this._attributesMap.find(o=>o.path===i);a?.dependentAttributes.push(t.name)})}_buildAttributesMap(e){const t=e.attributes??[];this._attributesMap=t.map(n=>({name:n.name,path:n.path,attributeType:n.attributeType,dependentAttributes:[],isSchemaAttribute:!0})),this._updateAttributesDependencies()}_loadDependentDataForCreate(e){return this.getSchema().pipe((0,u.map)(t=>t.attributes.filter(n=>n.dataValueType===f.Lookup).filter(n=>n.name in e).map(n=>n.name)),(0,u.switchMap)(t=>{if(t.length===0)return(0,c.of)([]);const n=t.map(i=>this.reloadDependentData(i,e[i]));return(0,c.forkJoin)(n)}),(0,u.map)(t=>{let n={};return t.forEach(i=>{n={...n,...i[0]||{}}}),{...n,...e}}))}_getDependentAttributesInfo(e){return this.getSchema().pipe((0,u.map)(t=>e.map(n=>{const i=t.findAttributeByName(n),a=i?.path??n,o=i?.name??n,l=i?.aggregationConfig??null,d=i?.dataValueType??null,h=i?.attributeType??null,p=a.split(".");p.shift();const g=p.length===1?p[0]:o;let C;return h===V.AggregationAttribute?C=V.AggregationAttribute:C=p.length===1?V.OwnAttribute:V.ForwardReferenceAttribute,{alias:g,attributeName:o,config:{path:p.join("."),aggregationConfig:l,dataValueType:d,type:C},type:C}})))}_markAsPristine(){this._selfDirty$.next(!1)}_onBeforeLoad(e,t){return this._lifecycleHookNotificationService?.onBeforeLoad?(0,c.from)(this._lifecycleHookNotificationService.onBeforeLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})).pipe((0,u.map)(n=>{if(n===!1)throw Error('Loading is disallowed by a "OnBeforeLoad" model lifecycle event')})):(0,c.of)(void 0)}_onAfterLoad(e,t){return this._lifecycleHookNotificationService?.onAfterLoad?(0,c.from)(this._lifecycleHookNotificationService.onAfterLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})):(0,c.of)(void 0)}_onBeforeInsert(e){return this._lifecycleHookNotificationService?.onBeforeInsert?this.getSchema().pipe((0,u.map)(t=>Q.getModelPrimaryAttributeValues(t,[e])),(0,u.map)(t=>t.pop()),(0,u.switchMap)(t=>this._lifecycleHookNotificationService.onBeforeInsert({model:this,payload:{data:e,primaryAttributesValues:t}})),(0,u.map)(t=>{if(t===!1)throw Error('Inserting is disallowed by a "OnBeforeInsert" model lifecycle event')})):(0,c.of)(void 0)}_insert(e,t){return t(e).pipe((0,u.map)(n=>this._mapInsertResult(n)),(0,u.tap)(()=>this._persistedState={}),(0,u.tap)(()=>this._markAsPristine()),(0,u.tap)(()=>this._markForNotCollection(M.Update)),ec(()=>this.getSchema()),(0,u.tap)(([,n])=>{this._registerPrimaryAttributeValues(Q.getModelPrimaryAttributeValues(n,[e]))}),(0,u.map)(([n])=>n),da(({data:n,actionType:i})=>this._notifyDataChange(n,i)),(0,u.map)(({result:n})=>n))}_onAfterInsert(e){return this._lifecycleHookNotificationService?.onAfterInsert?(0,c.from)(this._lifecycleHookNotificationService.onAfterInsert({model:this,payload:{data:e}})):(0,c.of)(void 0)}_onBeforeUpdate(e,t){return this._lifecycleHookNotificationService?.onBeforeUpdate?(0,c.from)(this._lifecycleHookNotificationService.onBeforeUpdate({model:this,payload:{data:e,parameters:t}})).pipe((0,u.map)(n=>{if(n===!1)throw Error('Updating is disallowed by a "OnBeforeUpdate" model lifecycle event')})):(0,c.of)(void 0)}_update(e,t,n){return n(t,e).pipe((0,u.mergeMap)(i=>this._mapSaveResult(i,e,t)),da(()=>this._notifyEventByParameters(t,we.Update)),(0,u.map)(({result:i})=>i),(0,u.tap)(()=>this.setLoadedState()))}_onAfterUpdate(e,t){return this._lifecycleHookNotificationService?.onAfterUpdate?(0,c.from)(this._lifecycleHookNotificationService.onAfterUpdate({model:this,payload:{data:e,parameters:t}})):(0,c.of)(void 0)}_onBeforeDelete(e){return this._lifecycleHookNotificationService?.onBeforeDelete?(0,c.from)(this._lifecycleHookNotificationService.onBeforeDelete({model:this,payload:{parameters:e}})).pipe((0,u.map)(t=>{if(t===!1)throw Error('Deleting is disallowed by a "OnBeforeDelete" model lifecycle event')})):(0,c.of)(void 0)}_delete(e,t){return t(e).pipe((0,u.tap)(()=>this._markAsPristine()),(0,u.tap)(()=>this._markForNotCollection(M.Init)),da(()=>this._notifyEventByParameters(e,we.Delete)))}_onAfterDelete(e){return this._lifecycleHookNotificationService?.onAfterDelete?(0,c.from)(this._lifecycleHookNotificationService.onAfterDelete({model:this,payload:{parameters:e}})):(0,c.of)(void 0)}innerInsert(e,t){const i=this.getSchema().pipe((0,u.map)(a=>({dataSchema:a,data:{...this._persistedState??{},...t}})),(0,u.map)(({data:a,dataSchema:o})=>Q.getOwnColumnsValues(o,a))).pipe(tt(a=>this._onBeforeInsert(a)),tc(a=>this._insert(a,e)),tt(([a])=>this._onAfterInsert(a)),(0,u.map)(([,a])=>a),(0,u.tap)(()=>{this._isLoaded=!0}),(0,u.catchError)(a=>(0,c.of)(xo(a))));return(0,c.iif)(()=>!this._doNotAllowCancelRequest,i.pipe((0,u.takeUntil)(this._destroyed$)),i)}innerUpdate(e,t,n){const a=this.getSchema().pipe((0,u.map)(o=>Q.getOwnColumnsValues(o,t)),(0,u.map)(o=>this._getChangedAttributesValues(o))).pipe(tt(o=>this._onBeforeUpdate(o,n)),tc(o=>this._update(o,n,e)),tt(([o])=>this._onAfterUpdate(o,n)),(0,u.map)(([,o])=>o),(0,u.catchError)(o=>(0,c.of)(xo(o))));return(0,c.iif)(()=>!this._doNotAllowCancelRequest,a.pipe((0,u.takeUntil)(this._destroyed$)),a)}innerDelete(e,t){return this._onBeforeDelete(t).pipe((0,u.switchMap)(()=>this._delete(t,e)),tt(()=>this._onAfterDelete(t)),(0,u.catchError)(n=>(0,c.of)(xo(n))))}innerLoad(e,t){if(this._destroyed)return(0,c.of)([]);this._isLoading=!0;const n=t?.attributes,i=t?.parameters||[],a=Q.getDataSourceLoadOptions(t?.options),o=this._load(e,n,i,a).pipe((0,u.tap)(()=>this._isLoading=!1),(0,u.catchError)(l=>(this._isLoading=!1,(0,c.throwError)(()=>l))));return(0,c.iif)(()=>!this._doNotAllowCancelRequest,o.pipe((0,u.takeUntil)(this._destroyed$)),o)}createChildModel(){return new jn(this.injector,this.dataSource)}static create(e){return(0,c.from)(this.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},""))}init(){return this.getSchema().pipe((0,u.tap)(e=>this._dataSchemaName=e.name),(0,u.tap)(e=>this._buildAttributesMap(e)),(0,u.map)(()=>this),(0,u.tap)(()=>this._isInitialized=!this.hasCriticalErrors),(0,u.tap)(()=>{this._subscribeChildrenModeChanges(),this._subscribeChildrenDirtyChanges()}),(0,u.take)(1))}getSchema(){if(!this.dataSource)return(0,c.of)(null);if(this.hasCriticalErrors)return(0,c.of)(this.dataSource.getEmptySchema());const e=this.dataSource.getSchema();return this._measurePerformanceService?e.pipe(this._measurePerformanceService.measure$(`model.getSchema.${this.name}`)):e}getDataSource(){return this.dataSource}load(e){return this.innerLoad((t,n,i)=>this.dataSource.load(t,n,i),e)}updateDependentAttributes(e){this._attributesMap=this._attributesMap.filter(i=>i.isSchemaAttribute);const t=this._attributesMap.map(i=>i.name),n=e.filter(i=>!t.includes(i.path)).map(i=>({name:i.path,path:i.path,attributeType:i.type??V.ForwardReferenceAttribute,dependentAttributes:[],isSchemaAttribute:!1}));this._attributesMap.push(...n),this._updateAttributesDependencies()}canReloadDependentData(e){return this._getDependentAttributesNames([e]).length!==0}getDependentAttributesNames(e){return this._getDependentAttributesNames([e])}reloadDependentData(e,t){const n=this._getDependentAttributesNames([e]);if(n.length===0)return(0,c.of)([]);if(t==null)return(0,c.of)([Object.fromEntries(n.map(o=>[o,null]))]);const i=[{type:P.PrimaryColumnValue,value:t}],a=[];return(0,c.forkJoin)([this._getDependentAttributesInfo(n),this.dataSource.getLookupDataSchema(e)]).pipe((0,u.switchMap)(([o,l])=>{const d=o.filter(p=>p.type!==V.OwnAttribute).map(p=>[p.alias,p.config]),h={type:l.dataSourceConfig.type,config:{...l.dataSourceConfig.config,attributes:Object.fromEntries(d)}};return o.forEach(p=>{a.push({ownAttributeName:p.attributeName,alias:p.alias})}),this._createDataSource(`${this.name}_reloadData`,l,h)}),(0,u.switchMap)(o=>o.load([...new Set(a.map(l=>l.alias))],i,{throttled:!0})),(0,u.map)(o=>o.map(l=>{const d={};return a.forEach(h=>{d[h.ownAttributeName]=l[h.alias]}),d})))}create(e={}){return this._isLoading=!0,this.getSchema().pipe((0,u.map)(t=>Q.getOwnColumnsValues(t,e)),(0,u.switchMap)(t=>(0,c.forkJoin)([(0,c.of)(t),this.dataSource.getDefaultValues()])),(0,u.tap)(()=>this._markForNotCollection(M.Create)),(0,u.map)(([t,n])=>(this._persistedState={...n,...t},this._persistedState)),(0,u.switchMap)(t=>this._loadDependentDataForCreate(t)),(0,u.tap)(()=>this._isLoading=!1))}copy(e,t={}){return this._isLoading=!0,this.getSchema().pipe((0,u.map)(n=>({schema:n,attributes:n.attributes.filter(i=>i.attributeType===V.OwnAttribute&&i.isValueCloneable).map(i=>i.name),parameters:typeof e=="string"?[{type:P.PrimaryColumnValue,value:e}]:n.getPrimaryAttributesNames().filter(i=>e[i]).map(i=>({type:P.PrimaryColumnValue,value:{[i]:e[i]}}))})),(0,u.mergeMap)(({schema:n,attributes:i,parameters:a})=>this._load((o,l,d)=>this.dataSource.load(o,l,d),i,a,{},M.Copy).pipe((0,u.tap)(()=>{this._isLoaded=!1}),(0,u.tap)(o=>{if(o.length>1)throw new Error("More than one record loaded for copy");if(o.length===0)throw new Error("No records loaded for copy")}),(0,u.map)(o=>Q.removeNotRequestedData(i,{...o[0]})),(0,u.map)(o=>{n.getPrimaryAttributesNames().forEach(d=>delete o[d]);const l=Q.getOwnColumnsValues(n,t);return{...o,...l}}),(0,u.switchMap)(o=>this.dataSource.getDefaultValues().pipe((0,u.map)(l=>({...l,...o})))),(0,u.tap)(o=>{this._persistedState={...o}}),(0,u.switchMap)(o=>this._loadDependentDataForCreate(o)),(0,u.tap)(()=>{this._isLoaded=!0,this._isLoading=!1}),(0,u.catchError)(o=>(this._isLoading=!1,this._markForNotCollection(M.Update),(0,c.throwError)(()=>new Error(o)))))))}insert(e){return this.innerInsert(t=>this.dataSource.insert(t),e)}update(e,t){return this.innerUpdate((n,i)=>this.dataSource.save(n,i),e,t)}insertOrUpdate(e,t){return this._mode===M.Update?this.update(e,t):this.insert(e)}delete(e){return this.innerDelete(t=>this.dataSource.delete(t),e)}setValue(e){const t=Object.keys(e);return this._checkAttributesInDataSchema(t).pipe((0,u.tap)(()=>{t.length>0&&(this._dirtyAttributes=new Set([...this._dirtyAttributes,...t]),this._persistedState={...this._persistedState??{},...e})}),(0,u.map)(()=>null))}_getPersistedState(){return{...this._persistedState??{}}}markFor(e){this.mode!==e&&(this._setMode(e),this._modeChanges.next(e))}resetMode(){this._mode!==M.Init&&(this._mode=M.Init,this._modeChanges.next(this._mode))}loadLookupList(e,t,n={}){if(!this.dataSource)throw Error("DataSource is null");const i=this.dataSource.getLookupDataSchema(e).pipe((0,u.switchMap)(a=>{const o=a.getPrimaryLoadAttributes();return this._createDataSource(this._lookupDataSourceName,a).pipe((0,u.switchMap)(l=>l.load(o,t,n)),(0,u.map)(l=>({primaryAttributeName:a.primaryAttributeName,primaryDisplayAttributeName:a.primaryDisplayAttributeName,data:l})))}));return(0,c.iif)(()=>!this._doNotAllowCancelRequest,i.pipe((0,u.takeUntil)(this._destroyed$)),i)}canDelete(e){return(0,c.lastValueFrom)(this.dataSource.canDelete(e),{defaultValue:null})}canSave(e){switch(this._mode){case M.Init:return Promise.resolve({result:!1});case M.Create:case M.Copy:return(0,c.lastValueFrom)(this.dataSource.canCreate(e),{defaultValue:null});case M.Update:return(0,c.lastValueFrom)(this.dataSource.canEdit(e),{defaultValue:null});case M.Delete:return this.canDelete(e);default:throw Error(`Unable to verify the possibility of operation executing: the '${this._mode}' is not supported.`)}}attributeChanged(e,t){t||this._selfDirty$.next(!0),this._dirtyAttributes.add(e)}setLoadedState(e=null){if(this._isCollectionModel||!e){this._dirtyAttributes.clear(),this._markAsPristine();return}e.forEach(t=>this._dirtyAttributes.delete(t)),this._dirtyAttributes.size||this._markAsPristine()}createCollectionItemModel(e){const t=this.createChildModel();return t._isCollectionItemModel=!0,t._isLoaded=!0,t._isInitialized=!0,t._persistedState={},t._dataSchemaName=this._dataSchemaName,t._attributesMap=this._attributesMap,e!=null&&(t._setMode(e),t._selfDirty$.next(!1)),this._children.push(t),t}childrenChange(){this._children$.next(this._children)}removeChild(e){const t=e?._id,n=this._children.findIndex(i=>i?._id===t);n!==-1&&this._children.splice(n,1)}_getAsyncResult(e){return(0,c.firstValueFrom)(e)}getLastError(){return this.dataSource?this.dataSource.getLastError():new Error("DataSource is null")}destroy(){this._isInitialized=!1,this._destroyed$.next(),this._destroyed$.complete(),this._selfDirty$.complete(),this._children$.complete(),this._childrenDirty$.complete(),this._childrenModes$.complete(),this._destroyed=!0}getOwnLoadParameters(){return this.dataSource.getOwnLoadParameters()}getAllowCopyingRecords(){return this.dataSource.getAllowCopyingRecords()}}(0,m.__decorate)([Te({requestType:"crt.ModelGenerator",methodName:"generateOne"}),(0,m.__metadata)("design:type",Function)],jn.prototype,"_create",void 0);class Ro extends jn{get supportsTransactions(){return this.dataSource?this.dataSource.supportTransactions:!1}createChildModel(){return new Ro(this.injector,this.dataSource)}loadInTransaction(e,t){return e.createOperation(n=>(0,c.firstValueFrom)(this.innerLoad((i,a,o)=>this.dataSource.loadInTransaction(n,i,a,o),t)))}insertInTransaction(e,t){return e.createOperation(n=>(0,c.firstValueFrom)(this.innerInsert(i=>this.dataSource.insertInTransaction(n,i),t)))}updateInTransaction(e,t,n){return e.createOperation(i=>(0,c.firstValueFrom)(this.innerUpdate((a,o)=>this.dataSource.saveInTransaction(i,a,o),t,n)))}insertOrUpdateInTransaction(e,t,n){return this.mode===M.Update?this.updateInTransaction(e,t,n):this.insertInTransaction(e,t)}deleteInTransaction(e,t){return e.createOperation(n=>(0,c.firstValueFrom)(this.innerDelete(i=>this.dataSource.deleteInTransaction(n,i),t)))}}let To=class ra{constructor(e,t,n,i){this.dataSourceFactory=e,this.entitySchemaRepository=t,this._featureValues=n,this._injector=i}get _transactionsEnabled(){return this._featureValues["DataSource-DisableTransactions"]!==!0}_createModel(e=null,t=!1,n){const i=e.supportTransactions&&this._transactionsEnabled?new Ro(n||this._injector,e):new jn(n||this._injector,e);return i.disableSync=t,i.init()}_validateModelConfig(e){if(e.primaryDataSourceName&&!e.dataSources[e.primaryDataSourceName])throw new Error(`Data source "${e.primaryDataSourceName}" cannot be primary data source. Data source "${e.primaryDataSourceName}" not found in model config.`);if(e.primaryDataSourceName&&e.dataSources[e.primaryDataSourceName]?.scope===Re.ViewElement)throw new Error(`Data source "${e.primaryDataSourceName}" with scope "viewElement" cannot be primary. Only data sources with scope "page" can be primary`)}_getEntitySchemesRequest(e){return e.map(([,t])=>t).filter(t=>t.type==="crt.EntityDataSource").map(t=>t.config).filter(t=>!!t.entitySchemaName).map(t=>{let n=[];return t.attributes&&(n=Object.entries(t.attributes).filter(([,i])=>i.type===V.ForwardReferenceAttribute).map(([,i])=>i.path)),{name:t.entitySchemaName,loadLookupColumns:!0,forwardReferencePaths:n}})}_generateFromConfig(e,t){let n,i;const a=t?.get(z,null,{optional:!0});return a?(n=Object.entries(e?.dataSources||{}).filter(([o,l])=>l.type?!0:(console.warn(`Data source ${o} without type not supported.`),!1)),n.length===0?(0,c.of)([]):(this._validateModelConfig(e),i=n.map(([o,l])=>this.generateOne(l,o,t)),this.preInitializeDataSources(n).pipe(a.measure$("modelGenerator.generateFromConfig"),(0,c.switchMap)(()=>(0,c.forkJoin)(i))))):(n=Object.entries(e?.dataSources||{}).filter(([o,l])=>l.type?!0:(console.warn(`Data source ${o} without type not supported.`),!1)),n.length===0?(0,c.of)([]):(this._validateModelConfig(e),i=n.map(([o,l])=>this.generateOne(l,o,t)),this.preInitializeDataSources(n).pipe((0,c.switchMap)(()=>(0,c.forkJoin)(i)))))}preInitializeDataSources(e){if(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"])return(0,c.of)(null);const t=this._getEntitySchemesRequest(e);return this.entitySchemaRepository.getSchemes(t).pipe((0,u.catchError)(n=>(0,c.of)([])),(0,u.map)(n=>null))}generate(e,t){return this._generateFromConfig(e,t)}generateOne(e,t,n){const i=n?.get(z,null,{optional:!0});return i?this.dataSourceFactory.create(t,e,n).pipe(i.measure$(`modelGenerator.generateOne.${t}`),(0,u.mergeMap)(a=>this._createModel(a,e.disableSync,n))):this.dataSourceFactory.create(t,e,n).pipe((0,u.mergeMap)(a=>this._createModel(a,e.disableSync,n)))}static{this.\u0275fac=function(t){return new(t||ra)(r.\u0275\u0275inject(Gt),r.\u0275\u0275inject(qe),r.\u0275\u0275inject(W),r.\u0275\u0275inject(r.Injector))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ra,factory:ra.\u0275fac})}};To=(0,m.__decorate)([on({requestType:"crt.ModelGenerator"}),(0,m.__metadata)("design:paramtypes",[Gt,qe,up,r.Injector])],To);class gs{constructor(e,t,n){this._sysSettingsService=e,this._dataSchemaRepository=t,this._featureValues=n,this._searchComparisonTypeSysSettingCode="StringColumnSearchComparisonType"}_getParameterValue(e,t,n){if(typeof t=="string"){if(t.startsWith("@requestPayload")){const i=t.replace("@requestPayload.","");return(0,v.get)(n,i)}if(t.startsWith("$"))return e.attributes[t.substring(1)];if(e.attributes[t])return e.attributes[t]}return t}_applyFilterMacros(e,t){let n=null;switch(typeof t){case"object":n=JSON.stringify((0,K.classToPlain)(t));break;case"string":n=t;break;default:return t}const i=/##ViewModelMacro\.\$([^#]+)##/g;let a=!1;return[...n.matchAll(i)].forEach(o=>{const l=o[1],d=(0,v.get)(e.attributes,l);let h=d?.toString();typeof d=="object"&&(a=!0,h=JSON.stringify(d)),n=n.replace(o[0],h)}),typeof t=="object"||a?JSON.parse(n):n}_createPrimaryDisplayColumnValueFilter(e){var t=this;return(0,b.A)(function*(){const n=t._searchComparisonTypeSysSettingCode,a=(yield t._sysSettingsService.getByCode(n))?.value===1?Z.Contain:Z.Start_with;return{type:P.PrimaryDisplayValueFilter,value:e,comparisonType:a}})()}_createColumnValueFilter(e,t,n){const i=t;return Promise.resolve({type:P.ColumnValue,value:{attributePath:i.attributePath,attributeValue:this._getParameterValue(e,i.attributeValue,n)}})}_getOwnLoadParameters(e,t){return e.getModelByName(t)?.getOwnLoadParameters()}_getDataSourceFilteringParameters(e,t){return(0,b.A)(function*(){const i=e._dataSourcesInfos.get(t).getFilteringConfig();return e._checkFilteringAttributes(t,i),i.length?(yield Promise.all(i.map(o=>e[o.name]))).map(o=>({type:P.Filter,value:o})):Promise.resolve([])})()}_getDataSourceOwnFilteringParameters(e,t){return this._getOwnLoadParameters(e,t)?.parameters??[]}_getPrimaryAttributeName(e,t){var n=this;return(0,b.A)(function*(){if(!t)return null;let i=Object.values(e.dataSchemas).find(a=>a.name===t);return i||(i=yield(0,c.lastValueFrom)(n._dataSchemaRepository.get(t))),i?.primaryAttributeName})()}_getParameterRelationsConfigs(e){return e.relationsConfigs||[]}_createRelationParameter(e,t){const n={...e},i=this._getParameterRelationsConfigs(n);return n.relationsConfigs=[{dataSchemaName:t.dataSchemaName,attributePath:t.attributePath,relationPath:t.relationPath},...i],n}_validateAllowedRelations(e,t,n){const a=n?.relationPath?.split(".")?.shift(),o=e.dataSchemas[t],l=o?.findAttributeByName(a);if(o&&l&&o.primaryAttributeName!==a&&l.dataValueType!==f.Lookup&&!this._featureValues.DataSourceAllowRelationsByNonLookupColumn){const d="Filtration of data sources by page data is currently supported by lookup and primaryAttribute fields only",h=new Error(`${d}, please see the console for more details`);throw h.stack=`${d} , data source name: ${t}, relation config: ${JSON.stringify(n)}`,h}}_createRelationParameterWithAttributeValue(e,t,n,i){var a=this;return(0,b.A)(function*(){const o={...n},l=a._getParameterRelationsConfigs(o),d=e.dataSchemas[t],h=i.relationPath.split("."),p=h.shift(),g=d.findAttributeByName(p);if(g.dataValueType!==f.Lookup&&(a._featureValues.DataSourceAllowRelationsByNonLookupColumn||d.primaryAttributeName===p))return o.type=P.ColumnValue,o.value={attributePath:i.attributePath,attributeValue:i.value},o.relationsConfigs=l,o;const C={dataSchemaName:i.dataSchemaName,attributePath:i.attributePath,relationPath:i.relationPath};o.value=i.value,o.type=P.PrimaryColumnValue,d.primaryAttributeName!==p&&(C.dataSchemaName=g.referenceSchemaName);const E=d.type!==kn.Entity?C.dataSchemaName:i.dataSchemaName;return C.relationPath=h.length===0?yield a._getPrimaryAttributeName(e,E):h.join("."),o.relationsConfigs=[C,...l],o})()}_convertToRelationParameters(e,t,n,i){var a=this;return(0,b.A)(function*(){const o=[];a._validateAllowedRelations(e,t,i);for(const l of n){const d=i.useAttributeValue?yield a._createRelationParameterWithAttributeValue(e,t,l,i):a._createRelationParameter(l,i);o.push(d)}return o})()}_getRelationParameters(e,t,n){var i=this;return(0,b.A)(function*(){const a=e._modelDependencies[t]||[];if(a.length===0)return Promise.resolve([]);const o=a.map(h=>i.getLoadParametersByRelation(e,h,t,n)),d=(yield Promise.all(o)).flat();return i._featureValues.DisableDsDepsJoinOptimization?d:i._selectOptimizedParametersForJoin(d)})()}_getPagingConfigRowCount(e,t,n,i){return typeof t=="string"&&(t=(0,v.isNil)(e.attributes[t])?0:e.attributes[t]),i&&(!t||t+n>i)&&(t=i-n),t}_getPagingConfigRowsOffset(e,t,n,i){const a=e._dataSourcesInfos.get(i).collectionViewModelAttributeName,o=e.attributes[a]?.length??0;if(typeof t=="number")throw new Error("Rows offset parameter cannot be set to number");return!t&&n===X.LoadNext?o:!t&&n===X.Reload?0:(e.attributes[t]=(0,v.isNil)(e.attributes[t])?0:e.attributes[t],n===X.Reload?e.attributes[t]:e.attributes[t]+o)}_getModelPagingConfig(e,t,n,i){if(!t){const l=this._getOwnLoadParameters(e,i);return Promise.resolve(l?.options?.pagingConfig??null)}const a=this._getPagingConfigRowsOffset(e,t.rowsOffset,n,i),o=this._getPagingConfigRowCount(e,t.rowCount,a,t.rowsLimit);return Promise.resolve({rowCount:o,rowsOffset:a})}_mergeSorting(e,t){return(0,v.unionBy)(e??[],t??[],"columnName")??null}_getModelSortingConfig(e,t,n){var i=this;return(0,b.A)(function*(){const o=i._getOwnLoadParameters(e,n)?.options?.sortingConfig,l=t?.attributeName;if(!l||!e.attributes[l])return o?Promise.resolve(o):Promise.resolve(null);const d=yield Promise.all(e.attributes[l].map(function(){var h=(0,b.A)(function*(p){return{columnName:yield p.columnName,direction:yield p.direction}});return function(p){return h.apply(this,arguments)}}()));return{columns:i._mergeSorting(d,o?.columns)}})()}_getHierarchyFilterAttributeValues(e,t){return(0,b.A)(function*(){if(!t?.length)return Promise.resolve(null);let n;for(const i of t){const a=yield e[i.name];if(!a)continue;const o=typeof a=="string"?Ce.fromJson(JSON.parse(a),us):"filters"in a?a:Ce.fromJson(a,us);o&&(n?o.filters.forEach(l=>{n.add(l)}):n=o)}return n?.filters?.size>0?n:null})()}_getHierarchyColumnValue(e,t){return(0,b.A)(function*(){if(!t)return Promise.resolve(null);const n=yield e[t];return(typeof n=="string"?n:n?.value)??null})()}_getModelHierarchyConfig(e,t,n,i){var a=this;return(0,b.A)(function*(){const o={},d=a._getOwnLoadParameters(e,n)?.options?.hierarchyConfig;if(!d||!d.hierarchicalFullDataLoad)return Promise.resolve(null);const h=yield a._getHierarchyFilterAttributeValues(i,t?.hierarchicalFilterAttributes),p=yield a._getHierarchyColumnValue(i,t?.hierarchicalColumnValueAttributeName);return o.hierarchicalFullDataLoad=d.hierarchicalFullDataLoad,o.hierarchicalColumnName=d.hierarchicalColumnName,o.hierarchicalMaxDepth=d.hierarchicalMaxDepth,o.hierarchicalColumnValue=p??null,o.hierarchicalColumnFiltersValue=h??null,Promise.resolve(o)})()}_updateLastEventLoadParameters(e,t,n,i){n&&n.length!==0?e._lastEventLoadParameters.set(t,n):i!==!0&&e._lastEventLoadParameters.set(t,[{type:P.Empty,value:""}])}_getModelLoadParameters(e,t,n,i,a,o,l){var d=this;return(0,b.A)(function*(){const h=yield d.getModelParameters(e,n,i);o!==!0&&d._updateLastEventLoadParameters(e,t,h,a);const p=a!==!0?h:e._lastEventLoadParameters.get(t)||[{type:P.Never,value:""}],[g,C,E]=yield Promise.all([d._getDataSourceFilteringParameters(e,t),d._getDataSourceOwnFilteringParameters(e,t),d._getRelationParameters(e,t,l)]);return[...p,...C,...g,...E]})()}_selectOptimizedParametersForJoin(e){if(e.every(({type:o})=>o===P.Empty))return e;const n=e.filter(({type:o,value:l})=>o!==P.Empty&&(o!==P.Filter||!!l)),i=e.filter(({type:o,relationsConfigs:l})=>o===P.Empty&&l?.length);if(!i.length)return n;const[a]=[...i].sort((o,l)=>l.relationsConfigs.length-o.relationsConfigs.length);return[...n,a]}getLoadParametersByRelation(e,t,n,i){var a=this;return(0,b.A)(function*(){const o=t.relationPath.split("."),l=o.shift(),d=e.dataSchemas[l],h={dataSchemaName:d.name,attributePath:t.attributePath,relationPath:o.join(".")},p=o.shift(),C=e._dataSourcesInfos.get(l).getMappedAttributeNames(p)?.[0]??null,E=e.getModelMode(l),T=i?.[l]?.[h.relationPath];if(e.getModelByName(n)?.getAllowCopyingRecords()&&T)h.value=T,h.useAttributeValue=!0;else{const Go=e.getIsDirty(C)||E===M.Create||E===M.Copy||d.type!==kn.Entity;if(C&&Go){h.useAttributeValue=!0;const ae=e.attributes[C];if(h.value=ae?.value?ae.value:ae,h.value)return a._validateAllowedRelations(e,l,h),Promise.resolve([{type:P.ColumnValue,value:{attributePath:h.attributePath,attributeValue:h.value},relationsConfigs:[]}])}}const Hs=yield a._getModelLoadParameters(e,l,null,null,!0,!1);return a._convertToRelationParameters(e,l,Hs,h)})()}getModelParameters(e,t,n){if(n?.parameters&&(t=[...t,...n.parameters]),!t||t.length===0)return Promise.resolve([]);const i=t.map(a=>{switch(a.type){case P.PrimaryColumnValue:return Promise.resolve({type:a.type,value:this._getParameterValue(e,a.value,n)});case P.Filter:return Promise.resolve({type:a.type,value:this._applyFilterMacros(e,a.value)});case P.PrimaryDisplayValueFilter:return this._createPrimaryDisplayColumnValueFilter(this._getParameterValue(e,a.value,n));case P.ColumnValue:return this._createColumnValueFilter(e,a.value,n)}});return Promise.all(i)}getModelLoadParameters(e,t,n,i=X.Load,{payload:a,useLastLoadParameters:o,doNotUpdateLastLoadParameters:l,modelLoadConfiguration:d}={}){const h=t.name,p=i??X.Load,g=p===X.Load?null:t.getPagingConfig(),C=t.getSortingConfig(),E=t.getHierarchyConfig();return Promise.all([this._getModelLoadParameters(e,h,n,a,o,l,d),this._getModelPagingConfig(e,g,p,h),this._getModelSortingConfig(e,C,h),this._getModelHierarchyConfig(e,E,h,e)])}static{this.\u0275fac=function(t){return new(t||gs)(r.\u0275\u0275inject(Tt),r.\u0275\u0275inject(mt),r.\u0275\u0275inject(W))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:gs,factory:gs.\u0275fac,providedIn:"root"})}}class Ke{get attributesMap(){return this._attributesMap}get mappedViewModelAttributes(){return this._mappedViewModelAttributes}get isCollection(){return this._isCollection}get collectionViewModelAttributeName(){return this._collectionViewModelAttributeName}constructor(e){this._attributesMap=new Map,this._mappedViewModelAttributes=new Set,this.attributes=[],this.includePrimaryAttributes=!0,this.name=e}static _getDataSourceInfo(e,t){if(!e.has(t)){const n=new Ke(t);return e.set(t,n),n}return e.get(t)}static _extractViewModelAttributeMapInfo(e){const t=e.split(".");return{dataSourceName:t.shift(),dataSourceAttributePath:t.join(".")}}static _getByDefaultAttribute(e,t,n,i=""){const a=t.modelConfig;if(!a||!a.path)return;const o=this._extractViewModelAttributeMapInfo(a.path);if(!o.dataSourceAttributePath){this._getByViewModelCollectionAttribute(e,t,n);return}if(i&&i!==o.dataSourceName)throw new Error(`Attribute '${e}' mapped on a few DataSources`);const l=this._getDataSourceInfo(n,o.dataSourceName),d=a.aggregationConfig?.aggregationFunction?xl(o.dataSourceAttributePath):o.dataSourceAttributePath;l.attributes.push({path:d,type:a.type,functionConfig:a.functionConfig,aggregationConfig:a.aggregationConfig}),l._mappedViewModelAttributes.add(e),l._attributesMap.set(e,o.dataSourceAttributePath)}static _getByInlineViewModelAttribute(e,t,n,i=""){const a=t.viewModelConfig||{};Object.entries(a.attributes||{}).forEach(([o,l])=>{const d=`${e}.${o}`;this._processViewModelAttribute(d,l,n,i)})}static _getByViewModelCollectionAttribute(e,t,n){const i=t.modelConfig;if(!i||!i.path)return;const o=this._extractViewModelAttributeMapInfo(i.path).dataSourceName,l=this._getDataSourceInfo(n,o);l._isCollection=!0,l._collectionViewModelAttributeName=e,l._pagingConfig=i.pagingConfig,l._sortingConfig=i.sortingConfig,l._hierarchyConfig=i.hierarchyConfig,l._filteringConfig=i.filterAttributes,l.includePrimaryAttributes=i.includePrimaryAttributes===void 0?!0:i.includePrimaryAttributes;const d=t?.viewModelConfig;Object.entries(d?.attributes||{}).forEach(([h,p])=>{this._processViewModelAttribute(`${e}.${h}`,p,n,o)})}static _processViewModelAttribute(e,t,n,i=""){"viewModelConfig"in t||"viewModelName"in t?t.isCollection?this._getByViewModelCollectionAttribute(e,t,n):this._getByInlineViewModelAttribute(e,t,n,i):"from"in t||this._getByDefaultAttribute(e,t,n,i)}static getFromViewModelConfig(e,t=[]){const n=new Map;return Object.entries(e?.attributes||{}).forEach(([i,a])=>{this._processViewModelAttribute(i,a,n)}),t.filter(i=>!n.has(i.name)).forEach(({name:i})=>{const a=new Ke(i);n.set(i,a)}),n}static getLookupListDataSourceInfo(e,t){const n=new Ke("");return n._isCollection=!0,n._collectionViewModelAttributeName=e,Object.entries(t).forEach(([i,a])=>{n.attributes.push({path:a}),n._mappedViewModelAttributes.add(i),n._attributesMap.set(i,a)}),n}_getRowModelDto(e){const t=e.length>0?e[0]:{},n={};return Object.entries(t).forEach(([i,a])=>{this.getMappedAttributeNames(i).forEach(l=>{const d=l.split(".");this.isCollection&&d.length>1&&d.shift(),(0,v.set)(n,d.join("."),a)})}),n}_getCollectionModelDto(e){const t=this._collectionViewModelAttributeName,n=e.map(i=>this._getRowModelDto([i]));return{[t]:n}}getMappedAttributes(){return Array.from(this._mappedViewModelAttributes.values())}getMappedAttributeNames(e){return Array.from(this._attributesMap.entries()).filter(([,t])=>t===e).map(([t])=>t)}getDataSourceAttributePath(e){return this._attributesMap.has(e)?this._attributesMap.get(e):""}getIsMapOnCollection(e){return this._isCollection&&this._collectionViewModelAttributeName===e}getPagingConfig(){return this._pagingConfig}getSortingConfig(){return this._sortingConfig}getHierarchyConfig(){return this._hierarchyConfig}getFilteringConfig(){return this._filteringConfig||[]}getModelDto(e){return this._isCollection?this._getCollectionModelDto(e):this._getRowModelDto(e)}addNewAttribute(e,t,n){const i=new Map;i.set(this.name,this),Ke._getByDefaultAttribute(e,t,i,n)}getIsDataSourceAttributePathExists(e){return this.attributes.find(t=>t.path===e)!==void 0}}class sm{}var qt;(function(s){s.None="None",s.OneToMany="OneToMany",s.ManyToOne="ManyToOne",s.ManyToMany="ManyToMany",s.CircularDependency="CircularDependency"})(qt||(qt={}));function ry(s,e){return!!s?.some(t=>t.relationPath.split(".").shift()===e)}function Zl(s){return s.dataValueType===f.Guid}function Kl(s,e){return Zl(e)&&s.primaryAttributeName===e.name}function rm(s,e,t,n){const i=t.findAttributeByName(n),a=s.findAttributeByName(e);return(a.isLookup||Zl(a))&&Kl(t,i)?qt.OneToMany:Kl(s,a)&&i.isLookup?qt.ManyToOne:qt.ManyToMany}function Po(s){const e=s.split("."),t=e.shift(),n=e.shift();return{dependOnModelName:t,dependOnAttributeName:n}}function Jl(s){Object.values(s.controls||{}).forEach(e=>{e instanceof He.FormGroup||e instanceof He.FormArray?Jl(e):e.updateValueAndValidity({onlySelf:!0})})}function ay(s){s?.markAsPristine(),s?.markAsUntouched(),s?.updateValueAndValidity()}function oy(s){return Object.values(s?.errors||{}).map(e=>e?.message).filter(Boolean)}function Yl(s){return s.statusChanges.pipe((0,u.startWith)(s.status),(0,u.first)(()=>s.status.toLowerCase()!=="pending"),(0,u.map)(()=>{}))}const am=500;class Be{static{this._skippedProperties=["schedule","then"]}constructor(e,t,n,i,a,o,l,d){this.viewModelGenerator=e,this.injector=t,this.viewModelConfig=n,this.resources=i,this._eventScopes=o,this._modelsInitConfig=l,this._defaultPrimaryAttributeName="Id",this._models$=new c.BehaviorSubject([]),this._businessRulesActive=!0,this._dropdownPageSizeSettingsCode="DropdownPageSize",this._dataSourcesInfos=new Map,this._attributesToDataSourceNameMap=new Map,this._dropdownPageSize=null,this._replayEvents$=new c.ReplaySubject,this._loadedDataSources=new Set,this._conflictedModels=[],this.__destroyed=!1,this._disableViewModelWaitingForAsyncTasks=!1,this._disableViewModelLoadUnblockingThread=!1,this._blockFieldsAffectedByBusinessRules=!1,this._asyncTasksExecutingSubject=new c.BehaviorSubject(new Set),this._modelsRequestedToLoad=new Set,this._attributesAffectedByBusinessRules=[],this._businessRulesAreActivated=!1,this._destroySubject=new c.Subject,this._modelSourceRecordId={},this._modelLoadParametersSetted$=new c.Subject,this._modelsNamesWithParameters=new Set,this.saveModelTaskName="MODEL_SAVING",this._modelLoaded$=new c.Subject,this._viewModelAttributeChangeEventOptions=new kh({preventAttributeChangeRequest:!1,preventStateChange:!0,preventRunBusinessRules:!0}),this._dynamicModelNames=new Set,this._attributeConfigs={},this._eventsSubject$=new c.Subject,this._collectionSubscription=new Map,this._crtControls=new Map,this._subscriptions=new c.Subscription,this._destroy$=this._destroySubject.asObservable(),this._businessRulesActivated$=new c.BehaviorSubject(!1),this.attributes={},this.dataSchemas={},this.events$=(0,c.merge)(this._eventsSubject$,this._replayEvents$),this._systemAttributes=[],this.initDependencies(),this._subscribeModelsChanges(),this.handlerChain=ot.instance,a?this.formApiModel=a:this.formApiModel=this.formBuilder.group({}),this.parent=d;const h=this._appInfo?.isDebugEnabled?this._createProxy(this):this;return this._viewModelDataDelayerService&&!this.parent&&this._viewModelDataDelayerService.setViewModel(h),h}get models(){return this._models$.value}get IsChanged(){return Promise.resolve(this.attributes[zi])}set IsChanged(e){}get HasUnsavedData(){return Promise.resolve(this.attributes[Fr])}set HasUnsavedData(e){}set BusinessRulesActivated(e){}get BusinessRulesActivated(){return Promise.resolve(this._businessRulesAreActivated)}get _isChanged(){return console.warn("Warning: The `_isChanged` property of the view-model is deprecated. It will be removed in future versions. Use `IsChanged` or `HasUnsavedData` attribute instead."),Object.keys(this._attributeConfigs).filter(e=>!(0,v.isEmpty)(this._attributeConfigs[e].modelConfig)).some(e=>this.formApiModel.controls[e]?.dirty)}get _scopes(){return[...this._eventScopes??[]]}get _injectionContext(){return this._context}get[ze](){return this.injector}get primaryAttributeName(){if(!this._primaryModelName)return this._defaultPrimaryAttributeName in this._attributeConfigs?this._defaultPrimaryAttributeName:null;const t=this.dataSchemas[this._primaryModelName].primaryAttributeName,n=this._dataSourcesInfos.get(this._primaryModelName);return this._getMappedAttributeName(n,t)}get PrimaryModelMode(){return this.getPrimaryModelMode()}get State(){return ki(this).attributes[jr]}get _destroyed(){return this.__destroyed}get modelInitConfigs(){return this._modelsInitConfig}_createProxy(e){return new Proxy(e,{get(t,n){return!(typeof n=="string")||n in t||Be._skippedProperties.includes(n)||console.debug(`Attribute ${n} not found.`),t[n]}})}_executeWithOptions(e,t){let n;try{return n=this._viewModelAttributeChangeEventOptions.getOptions(),this._viewModelAttributeChangeEventOptions.setOptions(t),e()}finally{this._viewModelAttributeChangeEventOptions.setOptions(n)}}_setSystemAttributeValue(e,t){const n=this.attributes[e];this.attributes[e]=t,this._executeWithOptions(()=>{this._fireChangeAttributeEvent({type:Y.ChangeAttributeValue,payload:{attributeName:e,oldValue:n,value:t}})},{preventStateChange:!0,preventRunBusinessRules:!0})}_fireChangeAttributeEvent(e){e.payload.silent??=this._viewModelAttributeChangeEventOptions.getAsSilent(),Object.assign(e.payload,this._viewModelAttributeChangeEventOptions.getOptions()),this._eventsSubject$.next(e)}_getViewModelValidators(e){const t=this.viewModelConfig.attributes[e]??{};return("validators"in t&&t.validators)??{}}_initDataSourceValidators(){return this._measurePerformanceService?.measure(`ViewModel.initDataSourceValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._validators={},this._dataSourcesInfos.forEach(e=>{e.attributesMap.forEach((t,n)=>{const i=this.viewModelConfig.attributes[n]??{};if("modelConfig"in i&&i.modelConfig?.ignoreValidators)return;this._validators[n]=this._validators[n]||[];const a=this._getDataSourceAttributeSchema(e,t);if(a?.validators){for(const[o,l]of Object.entries(a.validators))if(l?.type){const d=this._injectionContext??ki(this)?._injectionContext,h=this.validatorTypeResolver.getValidator(l.type,{validationParameters:l?.params,injectionContext:d}),p=this._getViewModelValidators(n),g=Object.values(p).find(C=>C.type===l.type);this._validators[n].push({name:o,instance:h,disabled:!!g?.disabled,params:l?.params})}}})}),(0,c.of)(null)))}_initSchemaValidators(e){this._measurePerformanceService.measure(`ViewModel.initSchemaValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{Object.entries(e||{}).forEach(([t])=>{const n=this._getViewModelValidators(t);this._validators[t]=this._validators[t]||[];for(const[i,a]of Object.entries(n))if(a?.type){const o=this._injectionContext??ki(this)?._injectionContext,l=this.validatorTypeResolver.getValidator(a.type,{validationParameters:a.params,injectionContext:o});this._validators[t].push({name:i,instance:l,disabled:a.disabled,params:a?.params})}})})}_waitAsyncValidation(){return(0,c.from)(this.waitAsyncTasksFinish()).pipe((0,u.switchMap)(()=>this.formApiModel.statusChanges.pipe((0,u.startWith)(this.formApiModel.status),(0,u.filter)(e=>e.toLowerCase()!=="pending"),(0,u.first)(),(0,u.map)(()=>null))))}_getResourcesStrings(){const e=this.resources?.strings??{};return{...e,...this._getResourceStringsByAttributes(e)}}_getChangedResourcesStrings(e){const t=Object.entries(e).reduce((i,[a,o])=>{const l=this.resources?.strings[a]||{},d=o&&{...l,...o};return{...i,[a]:d}},{}),n={...this.resources?.strings,...t};return JSON.parse(JSON.stringify(n))}_generateResourceAttribute(){this[fi]={},this[fi][fn.string]={};const e=this._getResourcesStrings();return this._attributeResourceGenerator.generate(this,e)}_getBoundAttributeNames(){const e=new Set;return this._dataSourcesInfos.forEach(t=>{for(const n of t.mappedViewModelAttributes)e.add(n)}),Array.from(e.values())}_getDataSourceInfoByViewModelAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e);return this._dataSourcesInfos.has(t)?this._dataSourcesInfos.get(t):null}_getResourceStringsByAttributes(e){const t=Object.keys(e);return this._getBoundAttributeNames().filter(i=>!t.includes(i)).reduce((i,a)=>(i[a]={},i),{})}_getDataSourceAttributeSchema(e,t){return this.dataSchemas[e.name]?.attributes?.find(n=>n.name===t)}_generatePrimaryAttributes(){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{const e=Array.from(this._dataSourcesInfos.values()).map(t=>{const n=t.name,i=this.dataSchemas[n],o=(t.includePrimaryAttributes?[i?.primaryAttributeName,i?.primaryDisplayAttributeName]:[]).filter(l=>l&&!t.getIsDataSourceAttributePathExists(l)).map(l=>{const d=D(),h=`${n}_${l}_${d}`,p=i.findAttributeByName(l),g={modelConfig:{path:`${n}.${l}`},dataValueTypeName:f[p.dataValueType]};return this._attributeConfigs[h]=g,t.addNewAttribute(h,g),this._attributeGenerate({[h]:g})});return o.length===0?(0,c.of)(null):(0,c.forkJoin)(o)});return e.length===0?(0,c.of)(null):(0,c.forkJoin)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.forkJoin.${this._injectionContext?.id}.parent.${!!this.parent}`))})}_getDataSourceDto(e){const t={},n=this._dataSourcesInfos.get(e);return n.attributesMap.forEach((i,a)=>{if(!n.getIsMapOnCollection(a)){const o=this.attributes[a],l=this._getDataSourceAttributeSchema(n,i);!o&&l?.dataValueType===f.Lookup?t[i]=null:t[i]=o}}),(0,c.of)(t)}_checkFilteringAttributes(e,t){if(t.some(i=>(0,v.isNil)(i.name)))throw new Error(`Filtering attributes for ${e} are not valid!`)}_attributeGenerate(e,t){return this._attributeGenerator.generate(this,e,{...t,onChangeAttributeValue:(n,i,a)=>{this._fireChangeAttributeEvent({type:Y.ChangeAttributeValue,payload:{attributeName:n,value:i,oldValue:a,silent:this._viewModelAttributeChangeEventOptions.getAsSilent()}})}})}_getDataSourceNamesAffectedByFilteringAttribute(e,t){return[...this._dataSourcesInfos.entries()].filter(([,n])=>n.isCollection).filter(([n])=>{const i=this.getModelByName(n);return t.has(i?.name)||i?.isLoaded||i?.isLoading}).filter(([n,i])=>this._getIsAnyFilterAttributesChanged(i,e,n)?!0:this._getIsAnyHierarchyFilterAttributesChanged(i,e,n)).map(([n])=>n)}_getIsAnyFilterAttributesChanged(e,t,n){const i=e.getFilteringConfig(),a=i.some(o=>o?.name===t&&o?.loadOnChange);return a&&this._checkFilteringAttributes(n,i),a}_getIsAnyHierarchyFilterAttributesChanged(e,t,n){const i=e.getHierarchyConfig();if(!i?.hierarchicalFilterAttributes&&!i?.hierarchicalColumnValueAttributeName)return!1;if(t===i?.hierarchicalColumnValueAttributeName)return!0;const a=i.hierarchicalFilterAttributes;if(a?.some(l=>l?.name===t&&l?.loadOnChange))return this._checkFilteringAttributes(n,a),!0}_createRequestsForReloadingDataSources(e){return e.map(t=>({type:"crt.LoadDataRequest",$context:this,dataSourceName:t,config:{loadType:X.Reload}}))}_dispatchStartLoadModelAttributes(e){const t=`${dt.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.addTask(t,{targetTask:!0}),this._replayEvents$.next({type:Y.StartLoadModelAttributes,payload:e})}_dispatchFinishLoadModelAttributes(e){const t=`${dt.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.removeTask(t,{targetTask:!0}),this._replayEvents$.next({type:Y.FinishLoadModelAttributes,payload:e})}_processEmptyLoadDataForCollection(e,t){var n=this;return(0,b.A)(function*(){if(!e.isCollection||!e.collectionViewModelAttributeName)return;const i=t.find(d=>d.type===P.PrimaryColumnValue);if(!i)return;const a=i.value?.value,o=n.attributes[e.collectionViewModelAttributeName];if(!a||!o)return;const l=yield o.findByPrimaryAttribute(a);l&&o.remove(l)})()}_loadDynamicModel(e){const t=e.attributeName,n=e.dataSourceConfig,i=e.dataSourceName||Li.createDynamicDataSourceNameFromAttributeName(this,t),a=Li.createAttributeConfig(this,i,e),o=this._createAndSetDataSourceInfo(i,t,a);return this._defineOrUpdateAttribute(t,a),this._setupSortingAttribute(e.sortingConfig),this._setupFiltersAttributes(e.filtersConfig),this._modelGenerator.generateOne(n,i).pipe((0,u.tap)(l=>this._markModelAsCollection(l,o)),(0,u.tap)(l=>this._dynamicModelNames.add(l.name)),(0,u.tap)(l=>this._upsertModel(i,l)),(0,u.tap)(l=>this._addModelDependencies(l,e.dependencies)),(0,u.switchMap)(l=>(0,c.forkJoin)([(0,c.of)(l),this._addDataSchemaToDataSchemas(l)])),(0,u.switchMap)(([l])=>(0,c.forkJoin)([(0,c.of)(l),(0,c.of)(this._replaceAttributesToDataSourceNameMap(o))])),(0,u.switchMap)(([l])=>(0,c.forkJoin)([(0,c.of)(l),this._reGenerateResourcesAttributes()])),(0,u.switchMap)(([l])=>this._loadModelData({model:l,dataSourceInfo:o,parametersConfig:[],loadType:X.Reload,useLastLoadParameters:e.useLastLoadParameters}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${e.dataSourceName}`))))}_defineOrUpdateAttribute(e,t){this.attributes[e]?this._attributeConfigs[e]=t:this._attributeGenerate({[e]:t})}_createAndSetDataSourceInfo(e,t,n){const a=Ke.getFromViewModelConfig({attributes:{[t]:n}}).get(e);return this._dataSourcesInfos.set(e,a),a}_setupSortingAttribute(e){if(!e?.default)return;const t=e.attributeName;this.attributes[t]=e.default}_setupFiltersAttributes(e){e?.forEach(t=>{if(!t.value)return;const n=t.name,i=t.value;this[n]=i.value||i})}_addModelDependencies(e,t){this._modelDependencies[e.name]=t||[]}_addDataSchemaToDataSchemas(e){return e.getSchema().pipe((0,u.tap)(t=>this.dataSchemas[e.name]=t))}_reGenerateResourcesAttributes(){return(0,c.forkJoin)([...this._generateResourceAttribute(),(0,c.of)(null)])}_replaceAttributesToDataSourceNameMap(e){const t=this._getDataSourceAttributesMap(e),n=[...Array.from(this._attributesToDataSourceNameMap.entries()),...t];this._initializeAttributesToDataSourceNameMap(n)}_getMappedAttributeName(e,t){if(!e)return"";const n=e.getMappedAttributeNames(t);return!n||n.length===0?"":n[0]}_getMappedAttributeNames(e,t){return e?e.getMappedAttributeNames(t):[]}_getModelAttributesToLoad(e,t){const n=this._dataSourcesInfos.get(e.name);if(t?.attributes){const i=t.attributes.filter(a=>{const o=this._getMappedAttributeName(n,a);return!this.getIsDirty(o)});return this._getModelDependentAttributes(e,i)}return n?.attributes.map(i=>i.path)}_loadStaticModel(e,t,n,i,a,o){const l=this.getModelByName(e),d=this._dataSourcesInfos.get(l.name);return this._loadModelData({model:l,dataSourceInfo:d,parametersConfig:t,loadType:n,payload:i,useLastLoadParameters:a,doNotUpdateLastLoadParameters:o})}_waitDataDelay(e){return this._viewModelDataDelayerService?.shouldBeDelayed()?(0,c.of)(e).pipe((0,u.delayWhen)(()=>this._viewModelDataDelayerService.loadTrigger$)):(0,c.of)(e)}_updateTrackedAttributes(e){const t=this._modelDependencies[e.name];if(!t||!e.isAggregate)return;const n=/^.{0,2}\[\w+:\w+(:\w+)?]/;t.forEach(i=>{const a=i.relationPath.split(".")[0],o=this.getModelByName(a),l=e.affectedAttributes.filter(h=>h.schemaName===o.dataSchemaName).map(h=>h.path.split(".")[0]).filter(h=>!n.test(h)),d=new Set([...i.trackByAttributes??[],...l]);i.trackByAttributes=[...d.values()]})}_waitForModelLoad(e){var t=this;return(0,b.A)(function*(){const n=t.getModelByName(e);!n||n?.isLoaded||n.mode===M.Create||n.mode===M.Copy||(yield(0,c.firstValueFrom)(t._modelLoaded$.pipe((0,u.filter)(i=>i===e),(0,u.take)(1))))})()}_waitForModelsLoad(e){var t=this;return(0,b.A)(function*(){if(e.length===0||t._isDesignTime)return;const n=e.map(i=>t._waitForModelLoad(i));yield Promise.all(n)})()}_waitForModelsLoadParameters(e,t){var n=this;return(0,b.A)(function*(){if(e.length===0||n._isDesignTime||!t||t.mode===M.Create||t.mode===M.Copy)return;const i=e.map(a=>n._waitForModelLoadParameters(a));yield Promise.all(i)})()}_waitForModelLoadParameters(e){var t=this;return(0,b.A)(function*(){t._lastEventLoadParameters.has(e)||t._modelsNamesWithParameters.has(e)||(yield(0,c.firstValueFrom)(t._modelLoadParametersSetted$.pipe((0,u.filter)(()=>t._modelsNamesWithParameters.has(e)),(0,u.take)(1))))})()}_getAffectedAttributes(e,t,n){const a=this.dataSchemas[e].primaryAttributeName,o=[...t];return a&&!t.includes(a)&&n?.length>0&&n?.[0][a]&&o.push(a),o}_getModelLoadParameters(e,t,n,i,a,o){return this._modelParametersBuilder.getModelLoadParameters(this,e,t,n,{payload:i,useLastLoadParameters:a,doNotUpdateLastLoadParameters:o}).catch(l=>(console.error(l),this._showNotification({message:l.message}),[[{type:P.Never}],{},{},{}]))}_getRelationTypeForRootModel(e){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return null;const t=this._modelDependencies[e],n=Ot(this.getModelByName(e));if(t?.length!==1||!this._primaryModelName||!n)return null;const i=this.dataSchemas[this._primaryModelName],a=t[0],{dependOnModelName:o,dependOnAttributeName:l}=Po(a.relationPath);return o!==this._primaryModelName?null:rm(this.dataSchemas[e],a.attributePath,i,l)}_isManyToOneRootModelRelation(e){return this._getRelationTypeForRootModel(e)===qt.ManyToOne}_isOneToManyRootModelRelation(e){return this._getRelationTypeForRootModel(e)===qt.OneToMany}_getOneToManyRelationDefaultValues(e){const t=this._modelDependencies[e]?.[0];if(!t)return{};const n=this.dataSchemas[this._primaryModelName],i=this.getViewModelAttributePaths(this._primaryModelName,n.primaryAttributeName)?.[0],a=this.getViewModelAttributePaths(this._primaryModelName,n.primaryDisplayAttributeName)?.[0];return{[t.attributePath]:{value:this.attributes[i],displayValue:this.attributes[a]}}}_getDependOnModelLoadConfiguration(e){const t=this._getDependOnModelsNames(e),n={};return t.forEach(i=>{this._modelSourceRecordId[i]&&(n[i]={[this.dataSchemas[i].primaryAttributeName??"Id"]:this._modelSourceRecordId[i]})}),n}_isPrimaryModel(e){return this._primaryModelName===e}_isIndependentRootModel(e){return Ot(e)?this._getDependOnModelsNames(e.name).length===0:!1}_checkAndProcessPageDataSourceData(e,t){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return(0,c.of)(t);if(this._isManyToOneRootModelRelation(e.name)&&t.length===0)return this._clearModelValues(e.name),e.setLoadedState(),(0,c.of)(t);const i=this._isOneToManyRootModelRelation(e.name),a=this._isIndependentRootModel(e);if(!(i&&t.length===0||a&&t.length===0&&!this._isPrimaryModel(e.name)))return(0,c.of)(t);e.resetMode();const l=this._getOneToManyRelationDefaultValues(e.name);if(this.PrimaryModelMode===M.Copy){const d=this.dataSchemas[e.name].primaryAttributeName??"Id",h=this._getDependOnModelLoadConfiguration(e.name);return(0,c.from)(this.getDataSourceLoadParameters(e.name,h)).pipe((0,u.switchMap)(({parameters:p,options:g})=>e.load({attributes:[d],parameters:p,options:{loadType:X.Reload,pagingConfig:g.pagingConfig,sortingConfig:g.sortingConfig,hierarchyConfig:g.hierarchyConfig}})),(0,u.switchMap)(p=>{e.resetMode();const g=p?.length?p[0][d]:null;return g?this.copy(e.name,g,l):this.create(e.name,l)}),(0,u.map)(()=>t))}return this.create(e.name,l).pipe((0,u.map)(()=>t))}_isRowsLimitReached(e){var t=this;return(0,b.A)(function*(){const n=e.collectionViewModelAttributeName,i=e.getPagingConfig()?.rowsLimit;return!i||!n?!1:(yield t[n])?.length>=i})()}_setDataSourceLoaded(e,t,n,i){var a=this;return(0,b.A)(function*(){n.length<i?.rowCount||(yield a._isRowsLimitReached(t))?a._loadedDataSources.add(e):a._loadedDataSources.delete(e)})()}_getModelDependedOnEntityDataSource(e){return e.filter(t=>this.models.find(a=>a.name===t).getDataSource().type===Dr.EntityDataSource)}_loadModelData({model:e,dataSourceInfo:t,parametersConfig:n,loadType:i,payload:a,useLastLoadParameters:o,doNotUpdateLastLoadParameters:l}){const d=e.name;this._modelsRequestedToLoad.add(d);const h=this._getModelAttributesToLoad(e,a),p=a?.attributes;if(!t)return(0,c.of)([]);if(p&&h.length===0)return(0,c.of)([]);if(this._conflictedModels.includes(d))return(0,c.of)([]);const g=this._getDataSourceMappingAttributes(t,h),C=this._getLoadTypeForDataSource(t,i);if(C===X.LoadNext&&this._loadedDataSources.has(d))return(0,c.of)([]);this._dispatchStartLoadModelAttributes(g);const E=!this._isSyncForModelAllowed(e)||p===null||e.mode===M.Init,T=this._getDependOnModelsNames(d);this._checkAndLoadUnloadedDependOnModels(T);const R=this._getModelDependedOnEntityDataSource(T),Hs=T.filter(ae=>!R.includes(ae)),Go=Promise.all([this._waitForModelsLoad(Hs),this._waitForModelsLoadParameters(R,e)]);return(0,c.from)(this._featureValues.DisableSequentialLoadDependentDS?this._waitForModelsLoad(T):Go).pipe((0,u.switchMap)(ae=>(0,c.from)(this._getModelLoadParameters(t,n,C,a,o,l)).pipe((0,u.tap)(()=>{!this._featureValues.DisableSequentialLoadDependentDS&&!t.isCollection&&(this._modelDependencies[d]?.map(Gs=>Gs.relationPath)||[]).forEach(Gs=>{const{dependOnModelName:oe,dependOnAttributeName:ci}=Po(Gs),[qo]=this.getViewModelAttributePaths(oe,ci);this.getAttributeControl(qo).markAsPristine()})}),(0,u.tap)(()=>{if(!this._featureValues.DisableSequentialLoadDependentDS){this._setModalLoadParameters(d);const je=this._getAffectedAttributes(d,h,[]);this._reloadDependentModels(e,je,Re.Page)}}))),(0,u.mergeMap)(ae=>this._waitDataDelay(ae)),(0,u.switchMap)(([ae,je,wu,Gs])=>e.load({attributes:h,parameters:ae,options:{loadType:i,pagingConfig:je,sortingConfig:wu,hierarchyConfig:Gs}}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.model.load.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${d}`),(0,u.catchError)(oe=>this._handleLoadErrorResponse(oe,[])),(0,u.tap)(()=>this._updateTrackedAttributes(e)),(0,u.tap)(oe=>{oe.length===0&&this._dispatchFinishLoadModelAttributes(g)}),(0,u.mergeMap)(oe=>oe.length===0?(0,c.from)(this._processEmptyLoadDataForCollection(t,ae)).pipe((0,u.map)(()=>oe)):(0,c.of)(oe)),(0,u.switchMap)(oe=>this._checkAndProcessPageDataSourceData(e,oe)),(0,u.map)(oe=>({data:oe,viewModelAttributes:t.getModelDto(oe)})),(0,u.switchMap)(({data:oe,viewModelAttributes:ci})=>this.setValue(ci,{collectionLoadType:C===X.Reload?En.Reload:En.Merge,silent:!0,isMaskedValue:!0}).pipe(tt(()=>!t.isCollection||!ci?(0,c.of)(void 0):(Object.keys(ci).forEach(qo=>{this.attributes[qo]?.forEach(jg=>{jg.formApiModel.updateValueAndValidity()})}),(0,c.from)(this._setDataSourceLoaded(d,t,oe,je)))),(0,u.tap)(()=>this._markAsPristine(ci)),(0,u.map)(()=>oe))))),(0,u.tap)(()=>this._modelLoaded$.next(d)),(0,u.switchMap)(ae=>this._runBusinessRulesForModel(e,ae)),(0,u.tap)(ae=>{const je=this._getAffectedAttributes(d,h,ae);this._featureValues.DisableSequentialLoadDependentDS&&this._reloadDependentModels(e,je,Re.Page),E||this._reloadDependentModels(e,je,Re.ViewElement)}),(0,u.tap)(ae=>{const je=ae[0]??{};e.setLoadedState(Object.keys(je)),this._dispatchFinishLoadModelAttributes(g)}),(0,u.takeUntil)(this._destroy$))}_checkAndLoadUnloadedDependOnModels(e){const t=e.filter(n=>{const i=!this._modelsRequestedToLoad.has(n),a=!Ot(this.getModelByName(n));return i&&a});this._requestReloadModels(t)}_createChangeAttributeTriggers(e){return e.map(t=>({type:H.ChangeAttributeValue,name:t,scopeId:""}))}_runBusinessRulesForModel(e,t,n=!1,i=[]){const a=this._dataSourcesInfos.get(e.name);if(a.isCollection||!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,c.of)(t);const o=t[0]??{},l=n?[...a.mappedViewModelAttributes]:Object.keys(o).flatMap(g=>this._getMappedAttributeNames(a,g)).filter(g=>g!=null),d=this._createChangeAttributeTriggers(l),h={type:H.DataLoaded,name:e.name,scopeId:""},p=this.models.filter(g=>g!==e).filter(g=>g.mode!==M.Init).filter(g=>g.getDataSource().scope===Re.Page).map(g=>this._getModelBusinessRuleContext(g.name,[]));return(0,c.forkJoin)([this._getModelBusinessRuleContext(a.name,[h,...i]),...p,(0,c.of)(this._getViewModelBusinessRuleContext([...d,...i,h]))]).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRulesForModel.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.switchMap)(g=>this._runBusinessRulesForContexts(g)),(0,u.map)(()=>t))}_runInitialBusinessRules(){if(!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,c.of)(null);const e={type:H.ContextReady,name:null,scopeId:""};return this._prepareBusinessRulesContexts([e]).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitialBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.mergeMap)(t=>t.length===0?(0,c.of)(null):this._runBusinessRulesForContexts(t)))}_createViewModelAttributesValues(e,t){const n=Object.entries(this.dataSchemas),[,i]=n.find(([o])=>o===e),a={};for(const o of i.attributes){const l=t[o.name],d=this.getViewModelAttributePath(e,o.name);d&&(a[d]=l??null)}return a}_createModelData(e,t){const n=this._dataSourcesInfos.get(e),i=this._getDataSourceMappingAttributes(n);this._dispatchStartLoadModelAttributes(i);const a=this.getModelByName(e),o=a.disableSync,l=this._getModelAttributesToLoad(a,null);return a.disableSync=!0,a.create(t).pipe((0,u.switchMap)(d=>{const h=this._createViewModelAttributesValues(e,d),p=this._isOneToManyRootModelRelation(e)?{silent:!0}:null;return this.setValue(h,p).pipe((0,u.tap)(()=>this._forEachControl(h,g=>{g.markAsPristine(),g.markAsUntouched()})))}),(0,u.tap)(()=>{a.disableSync=o,this._modelLoaded$.next(e),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e)}),(0,u.switchMap)(()=>this._runBusinessRulesForModel(a,[],!0)),(0,u.tap)(()=>{this._isSyncForModelAllowed(a)&&this._reloadDependentModels(a,l)}),(0,u.tap)(()=>{this._dispatchFinishLoadModelAttributes(i),a.setLoadedState()}),(0,u.map)(()=>null))}_copyModelData(e,t,n){const i=this._dataSourcesInfos.get(e),a=this._getDataSourceMappingAttributes(i);this._dispatchStartLoadModelAttributes(a);let o;const l=this.getModelByName(e),d=this._getModelAttributesToLoad(l,null),h=l.disableSync;return l.disableSync=!0,this._modelSourceRecordId[e]=t,l.copy(t,n).pipe((0,u.catchError)(p=>this._handleLoadErrorResponse(p,{})),(0,u.map)(p=>({data:[p],viewModelAttributes:i.getModelDto([p])})),(0,u.switchMap)(({data:p,viewModelAttributes:g})=>this.setValue(g).pipe((0,u.tap)(()=>this._markAsPristine(g)),(0,u.map)(()=>p))),(0,u.tap)(()=>{l.disableSync=h,this._modelLoaded$.next(e)}),(0,u.switchMap)(p=>this._runBusinessRulesForModel(l,p,!0)),(0,u.tap)(()=>{this._isSyncForModelAllowed(l)&&(this._reloadDependentModels(l,d),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e))}),(0,u.tap)(()=>{this._dispatchFinishLoadModelAttributes(a),l.setLoadedState()}),(0,u.mergeMap)(()=>(0,c.of)(o)))}_getDataSourceMappingAttributes(e,t=null){const n=t??e?.attributes.map(a=>a.path);if(!n)return{};const i=Object.fromEntries(n.map(a=>[this._getMappedAttributeName(e,a),!0]));return e.collectionViewModelAttributeName&&(i[e.collectionViewModelAttributeName]=!0),i}_handleLoadErrorResponse(e,t){if(e instanceof no)return(0,c.of)(t);const n=1e4;return console.error(e),this._showNotification({message:e.message,duration:n}),(0,c.of)(t)}_canExecuteBusinessRulesByModelAttributeValue(e,t,n){return t&&e?this._isModelAttributeValueValid(e,t,n):!0}_canExecuteBusinessRulesByViewModelAttributeValue(e,t){const n=this._getDataSourceInfoByViewModelAttributePath(e);if(n){const i=n.getDataSourceAttributePath(e);return this._canExecuteBusinessRulesByModelAttributeValue(n,i,t)}return!0}_getContextAttributeValue(e){return e instanceof Date?Jc(e):e}_getNormalizedContextAttributeValue(e,t,n){const i=e;return f[t]===f.Lookup||i?.displayValue?i?.value??e:n===!0||!t?e:[f.RICH_TEXT,f.Image].includes(f[t])?null:f[t]===f.MAXSIZE_TEXT&&e?e.slice(0,500):e}_getHasValueContextAttributeValue(e,t){return!!(t&&f[t]===f.Boolean||e!=null&&e!=="")}_getViewModelAttributeInfos(e,t,n){return Object.keys(t).filter(i=>!(t[i]instanceof ve)).map(i=>{if(t[i]instanceof Be)return this._getViewModelAttributeInfos(e?`${e}.${i}`:i,t[i]?.attributes??{},n);const a=this._attributeConfigs[i]?.dataValueTypeName,o=this._getContextAttributeValue(t[i]),l=this._getNormalizedContextAttributeValue(o,a,n);return{name:e?`${e}.${i}`:i,value:l??null,displayValue:t[i]?.displayValue,dataValueTypeName:a,hasValue:this._getHasValueContextAttributeValue(o,a)}}).flat()}_runBusinessRulesForContexts(e){const t=`${dt.RunningBusinessRules}-${D()}`;return this._onAsyncTaskStarted(t),(0,c.of)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.map)(n=>n?.filter(i=>!(0,v.isNil)(i))??[]),(0,u.mergeMap)(n=>{if(n.length===0)return(0,c.of)(null);const i=n.map(a=>({scopeName:a.scopeName,scopeId:a.scopeId,scopeType:a.scopeType,triggers:a.triggers}));return this._toggleControlsAffectedByBusinessRules(!1,i),this._businessRulesEngine.execute(n).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.execute.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.tap)(a=>{a.forEach(o=>{const l=i.find(d=>d.scopeId===o.scopeId&&d.scopeName===o.scopeName&&d.scopeType===o.scopeType);o.triggers=l?.triggers??[]})}),(0,u.switchMap)(a=>a?this._businessRulesApplier.applyRules(this,a):(0,c.of)(null)),(0,u.tap)(()=>{this._toggleControlsAffectedByBusinessRules(!0,i)}))}),(0,u.tap)(()=>this._onAsyncTaskFinished(t)))}_createViewModelContext(e,t){return{scopeType:Ge.ViewModel,scopeName:this._scopeName,scopeId:this._scopeName,scopeState:ct.Unknown,parentScopeId:null,attributes:t,triggers:e}}_getViewModelBusinessRuleContext(e){const t=this._featureValues["BRules-EnableCompareLargeAttributeValues"],n=this._getViewModelAttributeInfos(null,this.attributes,t);return this._createViewModelContext(e,[...n].map(i=>({attributeName:i.name,value:i.value,displayValue:i.displayValue,dataValueTypeName:i.dataValueTypeName,hasValue:i.hasValue})))}_prepareModelBusinessRuleTrigger(e,t){return t.map(n=>{if(n.type===H.DataLoaded||n.type===H.ContextReady)return n;const i=this._getDataSourceInfoByViewModelAttributePath(n.name);return!i||i.name!==e?null:{type:H.ChangeAttributeValue,name:i.getDataSourceAttributePath(n.name),scopeId:""}}).filter(n=>n!=null)}_getModelContextScopeStateType(e){switch(e.mode){case M.Init:return ct.Init;case M.Create:return ct.Create;case M.Copy:return ct.Copy;case M.Update:return ct.Update;default:return ct.Unknown}}_getModelBusinessRuleContext(e,t){const n=this._dataSourcesInfos.get(e),i=this.getModelByName(e),a=this.dataSchemas[e],o=this._prepareModelBusinessRuleTrigger(e,t),l=this._getModelContextScopeStateType(i);return this._getDataSourceDto(e).pipe((0,u.map)(d=>({...i._getPersistedState(),...d})),(0,u.map)(d=>({enableCompareLargeAttributeValues:this._featureValues["BRules-EnableCompareLargeAttributeValues"],modelDto:d})),(0,u.map)(({enableCompareLargeAttributeValues:d,modelDto:h})=>Object.entries(h).map(([p,g])=>{let C;const E=this._getMappedAttributeName(n,p);if(E)C=this._attributeConfigs[E]?.dataValueTypeName;else{const Hs=a.findAttributeByName(p);C=f[Hs.dataValueType]}const T=this._getContextAttributeValue(g),R=this._getNormalizedContextAttributeValue(T,C,d);return{attributeName:p,value:R,displayValue:g?.displayValue,dataValueTypeName:C,hasValue:this._getHasValueContextAttributeValue(T,C),isSignificant:p===a.primaryAttributeName}})),(0,u.map)(d=>({scopeType:Ge.Model,scopeName:i.dataSchemaName,scopeId:e,scopeState:l,parentScopeId:this._scopeName,attributes:d,triggers:o,modelType:i.getDataSource()?.type})))}_prepareDataSourceNamesForBusinessRules(){return this._modelsMap.size===0?[]:[...this._modelsMap.values()].filter(e=>!this._dataSourcesInfos.get(e.name).isCollection).map(e=>e.name)}_getModelsBusinessRuleContexts(e){return this._prepareDataSourceNamesForBusinessRules().map(n=>n?this._getModelBusinessRuleContext(n,e):(0,c.of)(null))}_prepareBusinessRulesContexts(e){const t=this._getModelsBusinessRuleContexts(e);if(!this._scopeName)return t.length===0?(0,c.of)([]):(0,c.forkJoin)([...t]);const i=[(0,c.of)(this._getViewModelBusinessRuleContext(e)),...t];return i.length===0?(0,c.of)([]):(0,c.forkJoin)(i)}_isAttributeChange(e){return!e.attributeName?.includes(":")}_businessRulesSubscribeOnChangeAttributes(){if(!this._businessRulesProcessingEnabled||this._isDesignTime)return;const e=this.events$.pipe((0,u.filter)(()=>this._businessRulesActive),(0,u.filter)(n=>n.type===Y.ChangeAttributeValue),(0,u.filter)(n=>this._isAttributeChange(n.payload)),(0,u.filter)(n=>!n.payload.silent),(0,u.filter)(n=>!n.payload?.preventRunBusinessRules),(0,u.filter)(n=>{const i=n.payload;return this._canExecuteBusinessRulesByViewModelAttributeValue(i.attributeName,i.value)}),(0,u.filter)(n=>{const i=n.payload,a=this._getAttributeDataValueTypeName(i.attributeName);return a&&io(a)===f.Lookup?i.value?.value!==i.oldValue?.value:!0}),(0,u.map)(n=>n.payload.attributeName)),t=e.pipe((0,u.tap)(()=>this._onAsyncTaskStarted(dt.DebouncingBusinessRules)),(0,u.buffer)(e.pipe((0,u.debounceTime)(am))),(0,u.map)(n=>Array.from(new Set(n))),(0,u.map)(n=>this._createChangeAttributeTriggers(n)),(0,u.mergeMap)(n=>this._prepareBusinessRulesContexts(n)),(0,u.tap)(()=>this._onAsyncTaskFinished(dt.DebouncingBusinessRules)),(0,u.filter)(n=>n.length>0),(0,u.mergeMap)(n=>this._runBusinessRulesForContexts(n)));this._subscriptions.add(t.subscribe())}_subscribeOnChangeAttributes(){const e=this.events$.pipe((0,u.filter)(t=>t.type===Y.ChangeAttributeValue),(0,u.map)(t=>t),(0,u.map)(t=>{const n=this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),i=this._dataSourcesInfos.get(n)?.attributesMap.get(t.payload.attributeName),a=this.getBoundDataSchemaAttributeByAttributePath(t.payload.attributeName);return{changeEvent:t,model:this.getModelByName(n),modelAttributeInfo:{name:a?.name??i,isLookup:!!a?.isLookup}}}),(0,u.filter)(({model:t,modelAttributeInfo:n})=>!!(t&&n.name)),(0,u.tap)(({changeEvent:t,model:n,modelAttributeInfo:i})=>{const a=t.payload,o=i.isLookup,l=o?a.oldValue?.value:a.oldValue,d=o?a.value?.value:a.value;l!==d&&n?.attributeChanged(i.name,a?.preventStateChange??a?.silent)}));this._subscriptions.add(e.subscribe())}_getHasRelation(e=[],t,n){return e.map(a=>{const o=a.trackByAttributes??[],{dependOnModelName:l,dependOnAttributeName:d}=Po(a.relationPath);return o.push(d),{rootModelName:l,trackedAttributes:d}}).filter(({rootModelName:a})=>a===t).filter(({trackedAttributes:a})=>this._dataSourcesInfos.get(t).isCollection?!0:n.some(o=>a.includes(o))).length!==0}_getDependentModelsNames(e,t=[]){return e?Object.entries(this._modelDependencies).filter(([n])=>n!==e).filter(([,n])=>this._getHasRelation(n,e,t)).map(([n])=>n).map(n=>[n,...this._getDependentModelsNames(n)]).flat():[]}_getIsModelDataChanged(e){if(!this.getModelByName(e)?.isLoaded)return!1;const n=this._dataSourcesInfos.get(e);if(n.isCollection){const a=n.collectionViewModelAttributeName,o=this.attributes[a];return o?o.isChanged:!1}return n.getMappedAttributes().some(a=>this.getIsDirty(a))}_requestReloadModels(e){this._createRequestsForReloadingDataSources(e).forEach(n=>{this._ngZone.runOutsideAngular(()=>this.processRequest(n))})}_isModelAttributeValueValid(e,t,n){return this._getDataSourceAttributeSchema(e,t)?.dataValueType===f.Lookup?Lh(n):!0}_canReloadModelDependentData(e,t){return e.canReloadDependentData(t)?!0:this._conflictedModels.includes(e.name)?!1:this._getDependentModelsNames(e.name,[t]).length>0}_getModelDependentAttributes(e,t){return[...t,...t.map(n=>e.getDependentAttributesNames(n)).flat()]}_getChangedModelsNames(e){return e.filter(t=>this._getIsModelDataChanged(t))}_showNotification(e){this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.NotificationRequest",$context:this,...e}))}_isSyncForModelAllowed(e){return e.allowSync}_subscribeOnReloadDataEvents(){if(this._isDesignTime)return;const e=this.events$.pipe((0,u.filter)(()=>this._modelSynchronizationEnabled),(0,u.filter)(t=>t.type===Y.ChangeAttributeValue),(0,u.filter)(t=>t.payload.silent!==!0),(0,u.map)(t=>({modelName:this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),attributeName:t.payload.attributeName,attributeValue:t.payload.value})),(0,u.filter)(({modelName:t})=>t!=null),(0,u.map)(({modelName:t,attributeName:n,attributeValue:i})=>{const a=this._dataSourcesInfos.get(t),o=a?.attributesMap.get(n);return{model:this.getModelByName(t),dataSourceInfo:a,modelAttribute:o,attributeValue:i}})).pipe((0,u.filter)(({model:t})=>t!=null),(0,u.filter)(({dataSourceInfo:t})=>!t.isCollection),(0,u.filter)(({model:t})=>this._isSyncForModelAllowed(t)),(0,u.filter)(({dataSourceInfo:t,modelAttribute:n,attributeValue:i})=>this._isModelAttributeValueValid(t,n,i)),(0,u.filter)(({model:t,modelAttribute:n})=>this._canReloadModelDependentData(t,n))).pipe((0,u.tap)(({model:t,dataSourceInfo:n,modelAttribute:i,attributeValue:a})=>{const o=this._getModelDependentAttributes(t,[i]),l=Object.fromEntries(o.map(d=>[this._getMappedAttributeName(n,d),!0]));this._dispatchStartLoadModelAttributes(l),t.reloadDependentData(i,a).pipe((0,u.switchMap)(d=>{if(d.length===0)return(0,c.of)(d);const h=n.getModelDto(d);return this.setValue(h,{silent:!0,isMaskedValue:!0}).pipe((0,u.switchMap)(()=>this._runBusinessRulesForModel(t,d)))}),(0,u.tap)(()=>this._reloadDependentModels(t,[i])),(0,u.tap)(()=>this._dispatchFinishLoadModelAttributes(l))).subscribe()}));this._subscriptions.add(e.subscribe())}_subscribeOnChangeRequests(){const e=this.events$.pipe((0,u.filter)(t=>t.type===Y.ChangeAttributeValue),(0,u.mergeMap)(t=>{const n=t.payload.attributeName,i=this._attributeConfigs[n];return Array.isArray(i?.change)?i.change:[i?.change]}),(0,u.filter)(t=>t!=null),(0,u.map)(t=>({type:t.request,$context:this,scopes:this._scopeName?[this._scopeName]:[],...t.params})),(0,u.tap)(t=>this._ngZone.runOutsideAngular(()=>this.handlerChain.process(t))));this._subscriptions.add(e.subscribe())}_subscribeOnFilteringEvents(){const e=new Set;this._subscriptions.add(this._modelLoaded$.pipe((0,u.tap)(n=>{e.add(n)})).subscribe());const t=this.events$.pipe((0,u.filter)(n=>n.type===Y.ChangeAttributeValue),(0,u.map)(n=>{const i=n.payload.attributeName;return this._getDataSourceNamesAffectedByFilteringAttribute(i,e)}),(0,u.map)(n=>this._createRequestsForReloadingDataSources(n)),(0,u.tap)(n=>{n.forEach(i=>{this._ngZone.runOutsideAngular(()=>this.processRequest(i))})}));this._subscriptions.add(t.subscribe())}_saveModel(e,t,n){const i=this.getModelByName(e),a=i.mode,o=this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(l,d)=>i.insertOrUpdate(l,d),onSavedAction:(l,d)=>this._updateLastLoadParameters(e,a,l,d),getInvalidAction:l=>(0,c.of)(l)});return this.handleSaveModelStream(o,n)}_initSubscriptions(){return this._measurePerformanceService.measure(`ViewModel.initSubscriptions.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._subscribeOnFilteringEvents(),this._subscribeModelsEvents(),this._subscribeOnChangeAttributes(),this._subscribeOnChangeRequests(),this._subscribeOnReloadDataEvents(),this._businessRulesSubscribeOnChangeAttributes(),this._subscribeOnChangeAttributesToHandleModelDependenciesConstrains(),this._subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(),(0,c.of)(null)))}_subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(){if(this._featureValues.DisableMultipleDataSources)return;const e=this.events$.pipe((0,u.filter)(t=>this._primaryModelName!=null),(0,u.filter)(t=>t.type===Y.ChangeAttributeValue),(0,u.map)(t=>t),(0,u.map)(({payload:t})=>{const n=t.attributeName,i=t.value;return{modelName:this.getBoundDataSourceNameByAttributePath(n),attributeName:n,attributeValue:i}}),(0,u.filter)(({modelName:t})=>this._isPrimaryModel(t)),(0,u.filter)(({attributeName:t})=>{const n=this.getBoundDataSchemaByAttributePath(t),i=this.getBoundDataSchemaAttributeByAttributePath(t);return!n||!i?!1:n.primaryDisplayAttributeName===i.name}),(0,u.map)(({modelName:t,attributeValue:n})=>{const i=this.dataSchemas[this._primaryModelName],o=this._getDependentModelsNames(t,[i.primaryAttributeName]).filter(l=>this._isOneToManyRootModelRelation(l));return{primaryDisplayValue:n,dependentModelsNames:o}}),(0,u.filter)(({dependentModelsNames:t})=>t.length>0),(0,u.tap)(({dependentModelsNames:t,primaryDisplayValue:n})=>{const i=this.dataSchemas[this._primaryModelName],a=this.getViewModelAttributePaths(this._primaryModelName,i.primaryAttributeName)[0],o=this.attributes[a],l={};t.map(d=>{const p=this._modelDependencies[d][0].attributePath;return this.getViewModelAttributePaths(d,p)}).flat().forEach(d=>{l[d]={value:o,displayValue:n}}),this.setValue(l,{silent:!0,preventAttributeChangeRequest:!0,preventRunBusinessRules:!1,preventStateChange:!0})}));this._subscriptions.add(e.subscribe())}_getDataSchemas(){if(this.models&&this.models.length!==0){const e=this.models.map(t=>t.getSchema().pipe((0,u.map)(n=>[t.name,n])));return(0,c.combineLatest)(e).pipe((0,u.take)(1),(0,u.map)(t=>Object.fromEntries(t)))}return(0,c.of)({})}_setAttributesDefaultValues(e){var t=this;return(0,c.from)((0,b.A)(function*(){let n=Object.entries(t.dataSchemas);e&&(n=n.filter(([i])=>i===e));for(const[i,a]of n){const o={};for(const l of a.attributes){const d=yield(0,c.lastValueFrom)(l.defaultValue,{defaultValue:null});if(!(0,v.isNil)(d)){const h=t.getViewModelAttributePath(i,l.name);h&&(o[h]=d)}}t.setValue(o).subscribe()}})())}_generateDataSourcesInfo(){return this._dataSourcesInfos=Ke.getFromViewModelConfig(this.viewModelConfig,this.models),(0,c.of)(this._dataSourcesInfos)}_generateAttributesToDataSourceNameMap(e){const t=Array.from(e.values()).map(n=>this._getDataSourceAttributesMap(n)).flat();return this._initializeAttributesToDataSourceNameMap(t),(0,c.of)(this._attributesToDataSourceNameMap)}_initializeAttributesToDataSourceNameMap(e){this._attributesToDataSourceNameMap=new Map(e)}_getDataSourceAttributesMap(e){const n=e.getMappedAttributes().map(i=>[i,e.name]);return e.isCollection&&n.push([e.collectionViewModelAttributeName,e.name]),n}_getDataSourceLoadType(e){return e?e||X.Reload:null}_getLoadTypeForDataSource(e,t){if(t===X.Load)return t;const n=e.getPagingConfig();return!t&&n?X.LoadNext:t}_loadDefaultSorting(e){this._measurePerformanceService.measure(`ViewModel._loadDefaultSorting.${this._injectionContext?.id}.parent.${!!this.parent}.dsNames.${e?.toString()}`,()=>{const t=Array.from(this._dataSourcesInfos.entries()).filter(([n])=>!e?.length||e.includes(n)).map(([,n])=>n.getSortingConfig()).filter(n=>!!n?.default).reduce((n,i)=>(n[i.attributeName]=i.default,n),{});this.setValue(t,{silent:!0}).subscribe()})}_getDropdownPageSize(){var e=this;return(0,b.A)(function*(){if(!(0,v.isEmpty)(e._dropdownPageSize))return e._dropdownPageSize;const t=yield e.sysSettingsService.getByCode(e._dropdownPageSizeSettingsCode);return e._dropdownPageSize={pagingConfig:{rowCount:t?.value,rowsOffset:0}},e._dropdownPageSize})()}_mergeCollectionModels(e,t){this._measurePerformanceService.measure(`ViewModel.mergeCollectionModels.${this._injectionContext?.id}.parent.${!!this.parent}.collection.${e}`,()=>{const n=this.attributes[e];this._featureValues.DisableBaseViewModelCollectionOptimization||n.length?n.merge(t):n.push(...t)})}_getEmbeddedModels(){const e=Object.entries(this.viewModelConfig?.attributes??{}).filter(([,i])=>i&&"embeddedModel"in i&&i.embeddedModel).map(([i,a])=>({attributeName:i,embeddedModel:a.embeddedModel}));if(e.length===0)return(0,c.of)([]);const t={},n=[];if(e.forEach(({attributeName:i,embeddedModel:{name:a,config:o}})=>{a?t[a]&&n.push(`Duplicated embedded model : ${a}.`):n.push(`Embedded model name is not provided for ${i}.`),t[a]=o}),n.length>0)throw new Error(n.join(" "));return this._modelGenerator.generate({dataSources:t},this.injector)}_concatModelsWithEmbedded(e=null){return this._getEmbeddedModels().pipe((0,u.map)(t=>{const n=[...e??[],...t??[]],i=n.map(a=>a.name).filter((a,o,l)=>l.indexOf(a)!==o);if(i.length>0)throw new Error(`Duplicated model names found : ${i.join(",")}.`);return n}))}_updateModelsMap(){const e=this.models.map(t=>[t.name,t]);this._modelsMap=new Map(e)}_subscribeModelsChanges(){this._subscriptions.add(this._models$.subscribe(()=>this._updateModelsMap()))}_subscribeModelsEvents(){this._isDesignTime||this.models.forEach(e=>this._subscribeModelEvents(e))}_subscribeModelEvents(e){this._subscriptions.add(e.event$.pipe((0,u.mergeMap)(t=>this._waitDataDelay(t)),(0,u.mergeMap)(t=>this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.HandleModelEventRequest",$context:this,scopes:this._eventScopes,modelName:e.name,modelEvent:t})),1)).subscribe())}_upsertModel(e,t){const n=[...this.models],i=n.findIndex(({name:a})=>a===e);i===-1?n.push(t):n.splice(i,1,t).forEach(a=>a.destroy()),this._subscribeModelEvents(t),this._models$.next(n)}_replaceDataSourceInfo(e,t){!e||!t||(this._loadedDataSources.has(e)&&this._loadedDataSources.delete(e),this._dataSourcesInfos.set(e,t),this._replaceAttributesToDataSourceNameMap(t))}_updateModels(e){e.forEach((t,n)=>{const i=this.getModelByName(n);i&&(this._markModelAsCollection(i,t),this._updateModelDependentAttributes(i,t))})}_markModelAsCollection(e,t){t.isCollection&&(e._isCollection=!0)}_setModalLoadParameters(e){this._modelsNamesWithParameters.add(e),this._modelLoadParametersSetted$.next()}_updateModelDependentAttributes(e,t){const n=t.attributes.map(i=>({path:i.path,type:i.type}));e.updateDependentAttributes(n)}_initIsChangedAttribute(){this._systemAttributes.push(zi),this.attributes[zi]=!1;const e=this._models$.pipe((0,u.switchMap)(t=>t?.length?(0,c.combineLatest)(t.map(n=>n._dirty$)):(0,c.of)([])),(0,u.map)(t=>t.some(n=>n)),(0,u.filter)(()=>!this._viewModelAttributeChangeEventOptions.getOptions().preventStateChange),(0,u.distinctUntilChanged)()).subscribe(t=>{this._setSystemAttributeValue(zi,t)});this._subscriptions.add(e)}_initHasUnsavedDataAttribute(){this._systemAttributes.push(Fr),this.attributes[Fr]=!1;const e=this.events$.pipe((0,u.filter)(o=>o?.type===Y.ChangeAttributeValue&&o.payload?.attributeName===zi),(0,u.map)(o=>o.payload.value)),t=(0,c.merge)(this.IsChanged,e),i=this._models$.pipe((0,u.map)(o=>o.map(l=>l._modeChanges$.pipe((0,u.map)(d=>({mode:d,name:l.name})),(0,u.startWith)({mode:l.mode,name:l.name})))),(0,u.switchMap)(o=>o?.length?(0,c.combineLatest)(o):(0,c.of)([]))).pipe((0,u.map)(o=>o.some(({mode:l,name:d})=>{const h=!this._isDesignTime&&!this._featureValues.DisableMultipleDataSources&&!this._isPrimaryModel(d)&&this._isIndependentRootModel(this.getModelByName(d)),p=this._isOneToManyRootModelRelation(d);return(l===M.Create||l===M.Copy)&&!p&&!h}))),a=(0,c.combineLatest)([t,i]).pipe((0,u.map)(([o,l])=>!!(o||l)),(0,u.distinctUntilChanged)()).subscribe(o=>{this._setSystemAttributeValue(Fr,o)});this._subscriptions.add(a)}_initPrimaryModelModeAttribute(){const e=this._getPrimaryModelModeChanges();if(!e)return;this._systemAttributes.push(uo),this.attributes[uo]=this.getPrimaryModelMode();const t=e.pipe((0,u.startWith)(this.getPrimaryModelMode())).subscribe(n=>this._setSystemAttributeValue(uo,n));this._subscriptions.add(t)}_initStateAttribute(){this._systemAttributes.push(jr),this.attributes[jr]=po.Active}_initBusinessRulesActivatedAttribute(){if(this._systemAttributes.push(ho),this.attributes[ho]=this._businessRulesAreActivated,this._businessRulesAreActivated)return;const e=this._businessRulesActivated$.pipe((0,u.filter)(t=>t===!0)).subscribe(t=>{this._setSystemAttributeValue(ho,t)});this._subscriptions.add(e)}_initSystemAttributes(){var e=this;return(0,b.A)(function*(){yield e._measurePerformanceService.measureCallback(`ViewModel.initSystemAttributes.${e._injectionContext?.id}.parent.${!!e.parent}`,()=>(e._initIsChangedAttribute(),e._initPrimaryModelModeAttribute(),e._initHasUnsavedDataAttribute(),e._featureValues.DisableDelayingModelEvents||e._initStateAttribute(),e._initBusinessRulesActivatedAttribute(),Promise.resolve()))})()}_handleCircularDependencies(){const e=Fh(this._modelDependencies);if(e.hasCycles){const t=this._translateService.instant("BaseViewModel.WarningModelsWithCircularDependencies");this._showNotification({message:t,duration:1e4}),console.warn(t,e.cycledModelsNames)}this._conflictedModels=e?.cycledModelsNames}_forEachControl(e,t){Object.keys(e).forEach(i=>{if(this.attributes[i]instanceof ve){const a=this.attributes[i],o=e[i];a.forEach(l=>{const d=l.primaryAttributeName,h=l.attributes[d],p=o.find(g=>g[d]===h);p&&l._forEachControl(p,t)})}else if(this.attributes[i]instanceof Be)this.attributes[i]._forEachControl(e[i],t);else{const a=this.getControl(i);t(a.formControl)}})}_getModelsErrors(e){return(e??[]).filter(t=>!t.isCollectionItemModel&&t.hasErrors).map(t=>t.getLastError())}_notifyAboutModelsErrors(e){const t=this._getModelsErrors(e);if(t.length>0){const n=t.map(i=>i.message).join(" ");this._showNotification({message:n})}}_initFeaturesStates(){this._disableViewModelWaitingForAsyncTasks=this._featureValues.DisableViewModelWaitingForAsyncTasks,this._disableViewModelLoadUnblockingThread=this._featureValues.DisableViewModelLoadUnblockingThread,this._blockFieldsAffectedByBusinessRules=this._featureValues.BlockFieldsWhileRunBusinessRules,this._modelSynchronizationEnabled=!this._featureValues.ModelSynchronizationDisabled}_handleAsyncTasksCycle(e){let t=null;const n=100,i=Array.from(e).filter(a=>a.startsWith(dt.ProcessingAttributeChangeRequest));if(!(!e.size||!i.length))return i.length&&(t=setTimeout(()=>{console.warn("[ViewModel]: Clearing executing tasks by exceeded timeout",i),i.forEach(a=>e.delete(a)),this._asyncTasksExecutingSubject.next(e)},n)),t}_getAffectedViewModelAttributes(e,t){return this.models.filter(i=>i.dataSchemaName===e).map(i=>i.name).flatMap(i=>this.getViewModelAttributePaths(i,t))}_toggleControlsAffectedByBusinessRules(e,t){if(!this._blockFieldsAffectedByBusinessRules)return;this._attributesAffectedByBusinessRules?.filter(i=>hh(this._scopeName,i,t))?.forEach(i=>{i.scopeName===this._scopeName?this.getControl(i.name).toggle(e):this._getAffectedViewModelAttributes(i.scopeName,i.name).forEach(o=>{this.getControl(o).toggle(e)})})}_initAttributesAffectedByBusinessRules(){var e=this;return(0,b.A)(function*(){const n=e._prepareDataSourceNamesForBusinessRules().filter(a=>!!a).map(a=>e.getModelByName(a)).map(a=>({scopeId:a.name,scopeName:a.dataSchemaName,scopeType:Ge.Model,modelType:a.getDataSource()?.type})),i={scopeName:e._scopeName,scopeType:Ge.ViewModel,scopeId:e._scopeName};e._attributesAffectedByBusinessRules=yield e._businessRulesEngine.getAffectedAttributes([i,...n])})()}_initBusinessRules(){var e=this;return this._measurePerformanceService.measureCallback(`ViewModel.initBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`,(0,b.A)(function*(){e._businessRulesProcessingEnabled=!e._featureValues.BusinessRulesProcessingDisabled&&e.viewModelConfig.supportBusinessRules!==!1,e._businessRulesProcessingEnabled&&(yield e._initAttributesAffectedByBusinessRules()),e._businessRulesAreActivated=e._businessRulesProcessingEnabled&&e._businessRulesActive!==!1,e._businessRulesActivated$.next(e._businessRulesAreActivated)}))}_attributeGenerate$(e,t){return(0,c.of)(this._featureValues.UseDesignerHotSwapViewModel).pipe((0,u.switchMap)(n=>n&&this._isDesignTime?this._initDataSourceValidators().pipe((0,u.tap)(()=>{this._initSchemaValidators(e)}),(0,u.switchMap)(()=>this._attributeGenerate(e,t))):this._attributeGenerate(e,t)))}_validateByDataSourceName(e){var t=this;return(0,b.A)(function*(){const n={},i=t._getBoundDataSourceAttributeControls(e);return yield Promise.all(Object.entries(i).map(([a,o])=>(o.markAsTouched(),o.updateValueAndValidity(),(0,c.lastValueFrom)(Yl(o).pipe((0,u.tap)(()=>{o.errors&&(n[a]=o.errors)})))))),n})()}_validateAll(){var e=this;return(0,b.A)(function*(){const t={};return e.formApiModel.markAllAsTouched(),e.formApiModel.updateValueAndValidity(),Jl(e.formApiModel),yield(0,c.lastValueFrom)(Yl(e.formApiModel).pipe((0,u.tap)(()=>{Object.entries(e.formApiModel.controls).forEach(([i,a])=>{a.errors&&(t[i]=a.errors)})}))),t})()}_getDependentModelsNamesOnRelationAttributeName(e){const t=this.getBoundDataSourceNameByAttributePath(e),i=this._dataSourcesInfos.get(t)?.attributesMap.get(e);return this._getDependentModelsNames(t,[i])}_setAttributeValue(e,t,n){this._executeWithOptions(()=>this[e]=t,n)}_subscribeOnChangeAttributesToHandleModelDependenciesConstrains(){if(this._isDesignTime)return;const e=this.events$.pipe((0,u.filter)(t=>t.type===Y.ChangeAttributeValue),(0,u.filter)(t=>this._isAttributeChange(t.payload)),(0,u.tap)(t=>{const n=t;!n?.payload?.value&&n.payload?.attributeName&&this._clearValuesForManyToOne(n.payload.attributeName)}));this._subscriptions.add(e.subscribe())}_clearValuesForManyToOne(e){this._getDependentModelsNamesOnRelationAttributeName(e).forEach(n=>{this._isManyToOneRootModelRelation(n)&&this._clearModelValues(n)})}_clearModelValues(e){const t=this._dataSourcesInfos.get(e),n=t?.isCollection?[]:t.getMappedAttributes();if(n.length){const i=n.reduce((a,o)=>({...a,[o]:null}),{});this.setValue(i).subscribe(()=>{this._markAsPristine(i),this._markAsUntouched(i)})}}_markAsUntouched(e){this._forEachControl(e,t=>{t.markAsUntouched()})}_setSingleSubmodelValue(e,t,n){return this.attributes[e].setValue(t[e],{silent:n?.silent,isMaskedValue:n?.isMaskedValue,preventAttributeChangeRequest:n?.preventAttributeChangeRequest,preventStateChange:n?.preventStateChange,preventRunBusinessRules:n?.preventRunBusinessRules})}_setCollectionSubmodelValue(e,t,n){const i=this._attributeConfigs[e],a=i.viewModelConfig||i.viewModelName,o=!this._featureValues.DisableDataGridEditingMode,l=(t[e]||[]).map(d=>{const h=this.getBoundDataSourceName(e),g=this._getDataSourceInfoByViewModelAttributePath(e)?.isCollection&&this.getModelByName(h)?.createCollectionItemModel(M.Update);return this.viewModelGenerator.generate({viewModelConfig:a,modelConfig:o&&g?{primaryDataSourceName:g.name}:void 0,models:o&&g?[g]:void 0,parentViewModel:this,businessRulesActive:!1},r.Injector.create({providers:[{provide:hr,useValue:null}],parent:this.injector})).pipe(this._measurePerformanceService.measure$(`ViewModel.setValue.generateViewModel.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${g?.name}`),(0,u.tap)(C=>{h&&(C.dataSchemas[h]=this.dataSchemas[h])}),(0,u.tap)(C=>{C.deactivateBusinessRules()}),(0,u.switchMap)(C=>C.setValue(d,{silent:n?.silent,isMaskedValue:n?.isMaskedValue,preventAttributeChangeRequest:n?.preventAttributeChangeRequest,preventStateChange:n?.preventStateChange,preventRunBusinessRules:n?.preventRunBusinessRules}).pipe((0,u.tap)(()=>g&&g.setLoadedState()),(0,u.map)(()=>C))))});return!l.length&&n?.collectionLoadType===En.Reload&&this.attributes[e].clear(),l.length===0?(0,c.of)(null):(0,c.forkJoin)([...l]).pipe((0,u.tap)(d=>{const h=this.getBoundDataSourceName(e);this.getModelByName(h)?.childrenChange(),this._executeWithOptions(()=>{n?.collectionLoadType===En.Reload||!n?.collectionLoadType?this.attributes[e].reload(d):this.getBoundDataSchema(e)?this._mergeCollectionModels(e,d):this.attributes[e].push(...d)},n)}))}_setSubmodelValues(e,t,n){return(0,c.forkJoin)([...e.filter(i=>t?.[i]).map(i=>this.attributes[i]instanceof Be?this._setSingleSubmodelValue(i,t,n):this._setCollectionSubmodelValue(i,t,n)),(0,c.of)(this)])}_findAttributePathInDataSourceNameMap(e){for(const t of this._attributesToDataSourceNameMap.keys()){const n=t.indexOf(".");if(n<0)continue;const i=n+1,a=e.length;if(t.startsWith(e,i)&&(t.length===i+a||t.charAt(i+a)==="."))return t}}_getBoundDataSourceAttributeControls(e){return Object.fromEntries(Array.from(this._attributesToDataSourceNameMap.entries()).filter(([t,n])=>n===e).map(([t])=>[t,this.getAttributeControl(t)]))}_resetMaskDataForAttribute(e){this[Il](e)&&(this.setAttributePropertyValue(e,kr,null),this.setAttributePropertyValue(e,oo,null),this.setAttributePropertyValue(e,co,null))}_staticLoader(e){const t=e[0],n=e[1],i=e[2];this._checkDataSourceName(t);const a=this._getDataSourceLoadType(i?.loadType);return this._loadStaticModel(t,n,a,i?.payload,i?.useLastLoadParameters,i?.doNotUpdateLastLoadParameters).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${t}`))}_dynamicLoader(e){const t=e[0];return this._loadDynamicModel(t).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.model.${t.dataSourceName}`))}showLoadMaskAndValidateFields(e){this.maskService.showMask(this.saveModelTaskName,this);const t=this._getBoundDataSourceAttributeControls(e);Object.keys(t).forEach(n=>this.formApiModel.controls[n].updateValueAndValidity())}deleteModel(e,t,n,i){return(0,c.from)(this._modelParametersBuilder.getModelParameters(this,t,i?.payload)).pipe((0,u.switchMap)(a=>n(e,a)))}handleSaveModelStream(e,t){return e.pipe((0,u.finalize)(()=>this.maskService.hideMask(this.saveModelTaskName,this)),(0,u.catchError)(n=>{const i=typeof n=="string"?n:n?.message||n?.errorInfo;return t?.silent===!0?(0,c.of)({success:!1,rowsAffected:0,errorInfo:i}):(0,c.throwError)(()=>new Error(i))}))}_updateLastLoadParameters(e,t,n,i){const a=t===M.Create||t===M.Copy,o=this.dataSchemas[e],l=o.dataSourceConfig?.type===Dr.EntityDataSource;if(i.success&&a&&l){const d=o.primaryAttributeName,h=n[d];this._loadedDataSources.add(e),this._lastEventLoadParameters.set(e,[{type:P.PrimaryColumnValue,value:h}])}}getSaveParameters(e,t){return(0,c.forkJoin)({parameters:this._modelParametersBuilder.getModelParameters(this,t),dto:this._getDataSourceDto(e)})}getSaveModelStream$(e){return this.showLoadMaskAndValidateFields(e.dataSourceName),(0,c.from)(this.isValid(e.dataSourceName)).pipe((0,u.switchMap)(t=>{if(!t){const n=this.injector.get(A.TranslateService);return e.getInvalidAction({success:!1,rowsAffected:0,errorInfo:n.instant("HomePage.DialogMessages.RequiredFieldsAreNotFilled")})}return this.getSaveParameters(e.dataSourceName,e.parametersConfig).pipe((0,u.mergeMap)(({parameters:n,dto:i})=>(0,c.forkJoin)({result:e.saveAction(i,n),dto:(0,c.of)(i)})),(0,u.tap)(({result:n,dto:i})=>e.onSavedAction(i,n)),(0,u.map)(({result:n})=>n))}))}_checkDataSourceName(e){if(!e)throw new Error("Data source name is not provided")}innerSave(e,t,n){return(0,c.from)(this.waitAsyncTasksFinish()).pipe((0,u.switchMap)(()=>(this._checkDataSourceName(n),this.getModelMode(n)===M.Delete?t():e())))}initDependencies(){this.formBuilder=this.injector.get(He.FormBuilder),this.resourceFinderService=this.injector.get(yn),this.validatorTypeResolver=this.injector.get(Rl),this.maskService=this.injector.get($h),this.sysSettingsService=this.injector.get(Tt),this.crtControlStateAdapter=this.injector.get(Pn),this._businessRulesEngine=this.injector.get(Di),this._businessRulesApplier=this.injector.get(Vi),this._featureValues=this.injector.get(W),this._modelGenerator=this.injector.get(To),this._ngZone=this.injector.get(r.NgZone),this._translateService=this.injector.get(A.TranslateService),this._scopeName=this.injector.get(hr,null),this._attributeGenerator=this.injector.get($i),this._attributeResourceGenerator=this.injector.get(Ui),this._crtZoneService=this.injector.get(ao),this._viewEventZoneName=this.injector.get(zd,Vt.Root),this._modelParametersBuilder=this.injector.get(gs),this._context=this.injector.get(Hd,null),this._crtInjectionContextService=this.injector.get(xn),this._viewModelDataDelayerService=this.injector.get(sm,null),this._isDesignTime=this.injector.get(xt,null),this._measurePerformanceService=this.injector.get(z,null),this._measurePerformancePageLoadService=this.injector.get(Bi),this._appInfo=this.injector.get(ye,null)}processRequest(e){return this.handlerChain.process(e)}runInitFlow(e=null){return this._concatModelsWithEmbedded(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitFlow.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,u.tap)(t=>this._notifyAboutModelsErrors(t)),(0,u.tap)(t=>this._models$.next(t)),(0,u.tap)(()=>this._initFeaturesStates()),(0,u.mergeMap)(()=>this._generateDataSourcesInfo()),(0,u.tap)(t=>this._updateModels(t)),(0,u.mergeMap)(t=>this._generateAttributesToDataSourceNameMap(t)),(0,u.mergeMap)(t=>this._getDataSchemas()),(0,u.tap)(t=>this.dataSchemas=t),(0,u.mergeMap)(()=>this._initDataSourceValidators()),(0,u.switchMap)(()=>this._initBusinessRules()),(0,u.tap)(()=>{this._initSchemaValidators(this.viewModelConfig.attributes)}),(0,u.mergeMap)(()=>(0,c.forkJoin)([...this._generateResourceAttribute(),this._initSystemAttributes(),this._attributeGenerate(this.viewModelConfig.attributes),(0,c.of)(this),this._initSubscriptions()])),(0,u.mergeMap)(()=>this._generatePrimaryAttributes()),(0,u.tap)(()=>this._loadDefaultSorting()),(0,u.mergeMap)(()=>this._runInitialBusinessRules()),(0,u.tap)(()=>this._viewModelAttributeChangeEventOptions.reset())).pipe((0,u.switchMap)(()=>(0,c.of)(this)))}[Il](e){return this._attributeConfigs[e]?.isValueMasked??!1}[Kh](e){return this.getAttributePropertyValue(e,oo)}[Jh](e){return this.getAttributePropertyValue(e,co)}[Yh](e,t){this.setAttributePropertyValue(e,kr,t)}[Xh](e){return this.getAttributePropertyValue(e,kr)||lo.Unmasked}init(e,t){return this._primaryModelName=t?.primaryModelName,this._modelDependencies=t?.modelDependencies||{},this._modelsLoadingConfig=t?.modelsLoadingConfig||{},this._lastEventLoadParameters=new Map,t?.businessRulesActive||this.deactivateBusinessRules(),this._modelDependencies&&this._handleCircularDependencies(),this._ngZone.runOutsideAngular(()=>this.runInitFlow(e))}setValue(e,t){const n=[],i=[];for(const a of Object.keys(this._attributeConfigs))"viewModelConfig"in this._attributeConfigs[a]||"viewModelName"in this._attributeConfigs[a]?i.push(a):n.push(a);return this._executeWithOptions(()=>{this._measurePerformanceService.measure(`ViewModel.setValue.updateViewModelModelAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.data.${Object.keys(e).toString()}`,()=>{for(const a in e)n.includes(a)&&(this._resetMaskDataForAttribute(a),this.set(a,e[a],{isMaskedValue:t?.isMaskedValue}))})},t),Li.deferUpdatingValueAndValidity(this,()=>this._setSubmodelValues(i,e,t),this._featureValues)}deactivateBusinessRules(){this._businessRulesActive=!1}activateBusinessRules(){const e=this._businessRulesActive;if(this._businessRulesActive=!0,e)return(0,c.of)(null);const t=this.models.filter(n=>n.isLoaded);if(t.length>0){const n={type:H.ContextReady,name:null,scopeId:""};return(0,c.forkJoin)(t.map(i=>this._runBusinessRulesForModel(i,[],!0,[n]))).pipe((0,u.tap)(()=>this._businessRulesAreActivated=this._businessRulesProcessingEnabled),(0,u.tap)(()=>this._businessRulesActivated$.next(this._businessRulesAreActivated)))}}_getDependOnModelsNames(e){const t=this._modelDependencies[e];if(!t)return[];const n=t.map(i=>i.relationPath.split(".")[0]);return[...new Set(n)]}_getModelDependencies(e){return this._modelDependencies[e]??[]}_getIsAffectedByBusinessRules(e){if(!this._businessRulesProcessingEnabled)return Promise.resolve(!1);const t=e.name,n=this._attributesAffectedByBusinessRules;if(n.length===0||!t)return Promise.resolve(!1);const i=n.some(d=>d.name===t),a=this.getBoundDataSchemaByAttributePath(t),o=this.getBoundDataSchemaAttributeByAttributePath(t);if(!o)return Promise.resolve(i);const l=n.filter(d=>d.scopeName===a.name).some(d=>d.name===o.name);return Promise.resolve(l||i)}executeRequest(e){return e.scopes=e.scopes||this._eventScopes,this._crtZoneService.runInZone(this._viewEventZoneName,()=>this.processRequest(e))}getAttributeControl(e){let t=this.formApiModel;yi(this,e).then(v.noop);for(const n of e.split("."))t=t.get(n);return t??new He.FormControl}loadLookupList(e,t=[],n){const i=e.control,a=e.items,o=this._getDataSourceInfoByViewModelAttributePath(a);if(o){const l=this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.LoadDataRequest",$context:this,dataSourceName:o.name,parameters:t,config:{payload:n}}));Promise.resolve(l)}else{const l=this._getDataSourceInfoByViewModelAttributePath(i);if(l){const d=l.getDataSourceAttributePath(i);(0,c.forkJoin)([this._getDropdownPageSize(),this._modelParametersBuilder.getModelParameters(this,t,n)]).pipe((0,u.mergeMap)(([h,p])=>this.getModelByName(l.name).loadLookupList(d,p,h)),(0,u.map)(h=>Ke.getLookupListDataSourceInfo(a,{value:h.primaryAttributeName,displayValue:h.primaryDisplayAttributeName}).getModelDto(h.data)),(0,u.mergeMap)(h=>this.setValue(h,{silent:!0}))).subscribe()}}}load(...e){const t=this._disableViewModelLoadUnblockingThread?(0,c.of)(null):(0,c.timer)(0,c.asyncScheduler),n=typeof e[0]=="string"?this._staticLoader(e):this._dynamicLoader(e);return t.pipe((0,u.switchMap)(()=>this.__destroyed?(0,c.of)([]):n))}setSorting(e,t){const i=this._dataSourcesInfos.get(e).getSortingConfig(),a=i&&i.attributeName;return a&&(this[a]=t),(0,c.of)(null)}create(e,t){return this._checkDataSourceName(e),this._createModelData(e,t)}copy(e,t,n){return this._checkDataSourceName(e),this._copyModelData(e,t,n)}loadDefaultValues(e){return this._setAttributesDefaultValues(e)}save(e,t,n){return this.innerSave(()=>this._saveModel(e,t,n),()=>this.delete(e,t,n),e)}delete(e,t,n){return this._checkDataSourceName(e),this.deleteModel(e,t,(i,a)=>this.getModelByName(i).delete(a),n)}resume(){return(0,c.of)(void 0)}pause(){return(0,c.of)(void 0)}destroy(){this._subscriptions.unsubscribe(),Array.from(this._collectionSubscription.values()).forEach(t=>t.unsubscribe()),this._collectionSubscription.clear(),this._crtControls.forEach(t=>{t.destroy()}),this.models?.forEach(t=>t.destroy()),this._crtControls.clear(),this._eventsSubject$.complete(),this._replayEvents$.complete(),this._modelLoaded$.complete();const e=[];for(const t of Object.values(this.attributes))t instanceof Be&&e.push(t.destroy()),t instanceof ve&&e.push((0,c.from)(t.destroy()));return(0,c.forkJoin)(e).pipe((0,u.defaultIfEmpty)(void 0),(0,u.map)(()=>{}),(0,u.finalize)(()=>{this.parent||(this._crtInjectionContextService.removeContext(this._injectionContext?.id),sh(this._injectionContext),this._context=null,this._viewModelDataDelayerService?.destroy(),this._viewModelDataDelayerService=null),this._asyncTasksExecutingSubject.complete(),this._dataSourcesInfos.clear(),this.__destroyed=!0,this._destroySubject.next(),this._destroySubject.complete()}))}getBoundDataSourceName(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(t!==null)return t;if(!e)return null;const n=this._findAttributePathInDataSourceNameMap(e);return this.getBoundDataSourceNameByAttributePath(n)}getBoundDataSourceAttributeControls(e){return Object.values(this._getBoundDataSourceAttributeControls(e))}getBoundDataSourceNameByAttributePath(e){return this._attributesToDataSourceNameMap.get(e)??null}getBoundDataSchema(e){return this.dataSchemas[this.getBoundDataSourceName(e)]}getBoundDataSchemaByAttributePath(e){return this.dataSchemas[this.getBoundDataSourceNameByAttributePath(e)]??null}getBoundDataSchemaAttributeByAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e),n=this.getBoundDataSchemaByAttributePath(e),i=this._getDataSourceInfoByViewModelAttributePath(e);if(!t||!n||!i)return null;const a=i.getDataSourceAttributePath(e);return n.findAttributeByName(a)}getPrimaryModelName(){return Promise.resolve(this._primaryModelName)}getPrimaryDataSchema(){return this.getPrimaryModelName().then(e=>this.dataSchemas[e])}isValid(e){const t=this._waitAsyncValidation().pipe((0,u.map)(()=>e?this.getBoundDataSourceAttributeControls(e).every(n=>!n.invalid):this.formApiModel.valid));return(0,c.lastValueFrom)(t)}validate(e){return this._ngZone.run(()=>e?this._validateByDataSourceName(e):this._validateAll())}getViewModelAttributePath(e,t){const n=this._dataSourcesInfos.get(e);return this._getMappedAttributeName(n,t)}getViewModelAttributePaths(e,t){return this._dataSourcesInfos.get(e)?.getMappedAttributeNames(t)}getCollectionViewModelAttributePath(e){return this._dataSourcesInfos.get(e)?.collectionViewModelAttributeName}canDelete(e,t){var n=this;return(0,b.A)(function*(){return n.getModelByName(e).canDelete(t)})()}canSave(e,t){var n=this;return(0,b.A)(function*(){return n.getModelByName(e).canSave(t)})()}enableAttributeValidator(e,t){this.getControl(e).enableValidator(t)}disableAttributeValidator(e,t){this.getControl(e).disableValidator(t)}_hotSwap(e){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap`,()=>{const t=e?.attributes?.changed||[],n=(0,v.isEmpty)(e.resources?.strings);if((0,v.isEmpty)(t)&&n)return(0,c.of)(!1);n||(this.resources={strings:this._getChangedResourcesStrings(e.resources.strings)}),this.viewModelConfig=e.actualViewModelConfig;const i=Ke.getFromViewModelConfig(this.viewModelConfig),a=Object.fromEntries(t.map(g=>[g,this.viewModelConfig.attributes[g]])),o=e?.models?.changed??[],l=o.map(g=>g.name),d=this.models.filter(g=>g.isLoaded||g.isLoading).filter(g=>l.includes(g.name)).map(g=>g.name),h=o.map(g=>{const C=i.get(g.name);return this._upsertModel(g.name,g),this._replaceDataSourceInfo(g.name,C),this._addDataSchemaToDataSchemas(g)}),p=this._attributeGenerate$(a,{disableDefaultConfig:!0});return(0,c.forkJoin)([...h,p]).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap.forkJoin`),(0,u.switchMap)(()=>this._reGenerateResourcesAttributes()),(0,u.tap)(()=>this._loadDefaultSorting(l)),(0,u.tap)(()=>this._requestReloadModels(d)),(0,u.map)(()=>!0))})}set(e,t,n){return this._setAttributeValue(e,t,n),Promise.resolve()}_markAsPristine(e){this._forEachControl(e,t=>{t.markAsPristine()})}getAttributeNameByViewItemName(e){return Object.keys(this._attributeConfigs).find(t=>this._attributeConfigs[t].viewItemName===e)}getControl(e){return this._crtControls.has(e)?this._crtControls.get(e):Br.create({name:e,value:null,propertiesConfig:[],featureValues:this._featureValues})}getAttributePropertyValue(...e){let t,n;if(e.length===2)t=e[0],n=e[1];else if(e.length===1){const a=e[0].split(":");t=a[0],n=a[1]}else throw new Error("ArgumentException");return this.getControl(t).getPropertyValue(n)}setAttributePropertyValue(...e){let t,n,i;if(e.length===3)t=e[0],n=e[1],i=e[2];else if(e.length===2){const o=e[0].split(":");t=o[0],n=o[1],i=e[1]}else throw new Error("ArgumentException");return this.getControl(t).setPropertyValue(n,i)}resetAttributePropertyValue(...e){let t,n;if(e.length===1)[t,n]=e[0].split(":");else if(e.length===2)t=e[0],n=e[1];else throw new Error("ArgumentException");this.getControl(t).getPropertyByName(n)?.resetValue()}getInvariabilityPropertyName(e){return this.getControl(e).getInvariabilityPropertyName()}setModelValues(e,t){return this.getModelByName(e).setValue(t)}_getBoundAttributesNames(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(!t)return null;const n=this._dataSourcesInfos.get(t),i=n.attributesMap.get(e);return Array.from(n.attributesMap.entries()).filter(([a,o])=>o===i&&a!==e).map(([a])=>a)}_getAttributeDataValueTypeName(e){return this._attributeConfigs[e].dataValueTypeName}getDataSourceLoadParameters(e,t){const n=this._dataSourcesInfos.get(e);return n?this._modelParametersBuilder.getModelLoadParameters(this,n,[],X.Load,{modelLoadConfiguration:t}).then(([i,a,o,l])=>({parameters:i,options:{pagingConfig:a,sortingConfig:o,hierarchyConfig:l}})):null}getAttributeViewModelConfig(e){return this._attributeConfigs[e]?.viewModelConfig?.attributes}isDataSourceForCollection(e){return!!this._dataSourcesInfos.get(e)?.isCollection}_getDataSourceAttributeDataValueType(e){const t=this._getDataSourceInfoByViewModelAttributePath(e);let n=null;if(t){const i=t.getDataSourceAttributePath(e);i&&(n=this._getDataSourceAttributeSchema(t,i)?.dataValueType)}return n}_getModelNamesByLoadType(e){return Object.entries(this._modelsLoadingConfig).filter(([t,n])=>n.type===e).map(([t,n])=>t)}_reloadDependentModels(e,t=[],n=null){const i=this._getDependentModelsForLoad(e,t);this._requestReloadModels(i.filter(a=>{const o=Ot(this.getModelByName(a));return!n||o&&n===Re.Page||!o&&n===Re.ViewElement}))}_getDependentModelsForLoad(e,t=[]){const n=this._getDependentModelsNames(e.name,t),i=this._getChangedModelsNames(n).filter(a=>!Ot(this.getModelByName(a)));return i.length!==0&&this._showNotification({message:"BaseViewModel.RefreshModelDataConflict"}),n.filter(a=>!i.includes(a)).filter(a=>this._modelsRequestedToLoad.has(a)||Ot(this.getModelByName(a)))}_getDataSourceAttributeCaption(e,t){let n=this.resourceFinderService.findLocalizableValue(t);const i=this._getDataSourceInfoByViewModelAttributePath(e);if(n==null&&i){const a=i.getDataSourceAttributePath(e),o=a?this._getDataSourceAttributeSchema(i,a):"";n=o?o.caption:this._translateService.instant("BaseViewModel.DataSourceAttributeRemoved")}return n}getIsDirty(e){return this.getControl(e).isDirty}getModelByName(e){return this._modelsMap.get(e)}getModelMode(e){return this.getModelByName(e)?.mode}getPrimaryModelMode(){return this.getModelMode(this._primaryModelName)}_getModelModeChanges(e){return this.getModelByName(e)?._modeChanges$}_getPrimaryModelModeChanges(){return this._getModelModeChanges(this._primaryModelName)}markModelFor(e,t){this.getModelByName(e)?.markFor(t)}markPrimaryModelFor(e){this.markModelFor(this._primaryModelName,e)}_setStateAttribute(e){this._setSystemAttributeValue(jr,e)}_onAsyncTaskStarted(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.add(e),this._asyncTasksExecutingSubject.next(t)}_onAsyncTaskFinished(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.delete(e),this._asyncTasksExecutingSubject.next(t)}waitAsyncTasksFinish(){let e;return(0,c.firstValueFrom)(this._asyncTasksExecutingSubject.pipe((0,u.tap)(t=>{clearTimeout(e),e=this._handleAsyncTasksCycle(t)}),(0,u.filter)(t=>t.size===0),(0,u.take)(1),(0,u.map)(()=>{})))}destroyModel(e){const t=this.getModelByName(e);t&&t.destroy();const n=this.models.filter(i=>i.name!==e);this._models$.next(n),this._dataSourcesInfos.delete(e),[...this._attributesToDataSourceNameMap.entries()].filter(([i,a])=>e===a).forEach(([i])=>this._attributesToDataSourceNameMap.delete(i))}}class ft extends xe{_getViewModelCollectionValue(e,t){if(!t.length)return Promise.resolve(e);const n=Array.from(e).map(i=>this._getObjectProp(i,t));return Promise.all(n)}_getObjectProp(e,t){var n=this;return(0,b.A)(function*(){const i=t.shift();return i?(e=yield e[i],e instanceof Be?n._getObjectProp(e,t):e instanceof ve?n._getViewModelCollectionValue(e,t):n._getObjectProp(e,t)):e})()}evaluate(e,t){const n=e.slice(1);return Ia(n,t).pipe((0,u.map)(i=>i??{context:bi(t),contextPath:""}),(0,u.switchMap)(i=>(0,c.combineLatest)([i.context.viewModel$,(0,c.of)(xa(i.contextPath,n))])),(0,u.switchMap)(([i,a])=>i?this._getObjectProp(i,a.split(".")):(0,c.of)(null)),(0,u.take)(1))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(ft)))(n||ft)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ft,factory:ft.\u0275fac})}}class $n{_getStringValue(e){return e.match(/^'(.*)'$/)[1]}_getBooleanValue(e){if(e==="true")return!0;if(e==="false")return!1;throw new Error(`${e} is not Boolean value`)}evaluate(e){if(Vc(e))return(0,c.of)(this._getStringValue(e));if(Oc(e))return(0,c.of)(parseFloat(e));if(Bc(e))return(0,c.of)(this._getBooleanValue(e));throw new Error(`Failed to parse primitive value binding expression: ${e}`)}static{this.\u0275fac=function(t){return new(t||$n)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:$n,factory:$n.\u0275fac})}}class gt extends Ci{constructor(e,t,n,i=!1){super(),this._convertersRegistry=e,this._objectPropBindingExpressionInterpreter=t,this._fixedValueBindingExpressionInterpreter=n,this._isDesignTime=i}_evaluateParam(e,t){if(Jd(e))return this._fixedValueBindingExpressionInterpreter.evaluate(e);if(Me(e))return this._objectPropBindingExpressionInterpreter.evaluate(e,t);throw new Error(`Cannot parse parameter expression: ${e}`)}_evaluateParams(e,t){const n=e.map(i=>this._evaluateParam(i,t).pipe((0,u.first)()));return(0,c.forkJoin)(n).pipe((0,u.defaultIfEmpty)([]))}_getConverters(e,t){return e.split("|").map(i=>i.trim()).map(i=>{const[a,...o]=i.split(":").map(h=>h.trim()),l=this._evaluateParams(o,t),d=t.viewModel$.pipe((0,u.first)());return(0,c.forkJoin)([d,l]).pipe((0,u.map)(([h,p])=>g=>{if(!h)return null;const C=h._injectionContext;return this._convertersRegistry.get(a,C).convert(g,h,...p)}))})}_applyConverters(e,t){for(const[n,i]of Object.entries(t))if(e=i(e),e instanceof Promise){const a=parseInt(n,10)+1;return this._applyAsyncConverters(e,[...t].slice(a))}return e}_applyAsyncConverters(e,t){return(0,b.A)(function*(){let n=yield e;for(const i of t)n=i(n),n instanceof Promise&&(n=yield n);return n})()}evaluate(e,t){if(this._isDesignTime||(0,v.isEmpty)(e))return(0,c.of)(i=>i);const n=this._getConverters(e,t);return(0,c.forkJoin)(n).pipe((0,u.map)(i=>a=>this._applyConverters(a,i)))}static{this.\u0275fac=function(t){return new(t||gt)(r.\u0275\u0275inject(Mi),r.\u0275\u0275inject(ft),r.\u0275\u0275inject($n),r.\u0275\u0275inject(xt,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:gt,factory:gt.\u0275fac})}}class Wt{constructor(e,t,n,i){this._attributeBindingExpressionInterpreter=e,this._attributePropertyBindingExpressionInterpreter=t,this._resourceBindingExpressionInterpreter=n,this._converterExpressionInterpreter=i}_applyConverter(e,t){return(0,b.A)(function*(){return e=t(e),e instanceof Promise&&(e=yield e),e})()}evaluateInputValueExpression(e,t){return Nc(e)?this._resourceBindingExpressionInterpreter.evaluate(e,t):Dc(e)?this._attributePropertyBindingExpressionInterpreter.evaluate(e,t):this._attributeBindingExpressionInterpreter.evaluate(e,t)}evaluate(e,t){const n=/\|(.*)/,[i,a]=e.split(n).map(d=>d.trim()),o=this.evaluateInputValueExpression(i,t),l=this._converterExpressionInterpreter.evaluate(a,t);return o.pipe((0,u.switchMap)(d=>l.pipe((0,u.switchMap)(h=>this._applyConverter(d,h)))))}static{this.\u0275fac=function(t){return new(t||Wt)(r.\u0275\u0275inject(xe),r.\u0275\u0275inject(Sn),r.\u0275\u0275inject(vn),r.\u0275\u0275inject(gt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Wt,factory:Wt.\u0275fac})}}class Un extends Wt{constructor(e,t){super(null,null,null,t),this._objectPropBindingExpressionInterpreter=e}_evaluateEventBindingExpression(e,t){const n=t.initialEvent,i=e.replace(/@event\.?/,"");return(0,c.of)(i?(0,v.get)(n,i):n)}evaluateInputValueExpression(e,t){return Ea(e)?this._evaluateEventBindingExpression(e,t):this._objectPropBindingExpressionInterpreter.evaluate(e,t)}static{this.\u0275fac=function(t){return new(t||Un)(r.\u0275\u0275inject(ft),r.\u0275\u0275inject(gt))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Un,factory:Un.\u0275fac})}}class zn{constructor(e){this._requestParamBindingExpressionInterceptor=e}_evaluate(e,t){var n=this;return(0,b.A)(function*(){const i={};for(const[a,o]of Object.entries(e))i[a]=yield n._evaluateConfigValue(o,t);return i})()}_evaluateConfigValue(e,t){return Array.isArray(e)?Promise.all(e.map(n=>this._evaluateConfigValue(n,t))):Me(e)||Ea(e)?(0,c.lastValueFrom)(this._requestParamBindingExpressionInterceptor.evaluate(e,t),{defaultValue:null}):e&&typeof e=="object"?this._evaluate(e,t):Promise.resolve(e)}evaluate(e,t){return(0,c.from)(this._evaluate(e,t))}static{this.\u0275fac=function(t){return new(t||zn)(r.\u0275\u0275inject(Un))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:zn,factory:zn.\u0275fac})}}class Hn{constructor(e){this._requestParamsBindingConfigInterpreter=e}_evaluateParams(e,t){return e?this._requestParamsBindingConfigInterpreter.evaluate(e,t):(0,c.of)({})}_getRequestBindingContext(e,t){return e.useRelativeContext?t:bi(t)}evaluate(e,t){return this._evaluateParams(e.params,t).pipe((0,u.withLatestFrom)(this._getRequestBindingContext(e,t).viewModel$),(0,u.map)(([n,i])=>({type:e.request,$context:i,...n})),(0,u.first)())}static{this.\u0275fac=function(t){return new(t||Hn)(r.\u0275\u0275inject(zn))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Hn,factory:Hn.\u0275fac})}}class Zt extends xe{_getValidationStateChanges(e,t){const n=t.attributeHost.getAttributeControl(t.attributeName);return(0,c.merge)(e,n.statusChanges).pipe((0,u.map)(()=>({value:n.value,validationInfo:(0,v.pick)(n,"valid","errors","dirty","touched")})),(0,u.distinctUntilChanged)(v.isEqual))}evaluate(e,t){const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,u.switchMap)(i=>i.attributeHost?this._getValidationStateChanges(super.evaluate(e,t),i):(0,c.of)({value:null,validationInfo:{valid:!0,errors:null,dirty:!1,touched:!1}})))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(Zt)))(n||Zt)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Zt,factory:Zt.\u0275fac})}}const Xl=[xe,Sn,Rt,Wt,gt,ft,$n,Hn,Un,zn,vn,Zt,Vu.create({token:Ud,mappings:[{predicate:"converter",injectable:gt}]})],Kr=new r.InjectionToken("CRT_BINDING_CONTEXT"),Ql=new r.InjectionToken("CRT_BINDING_CONTEXT_DESIGN_TIME"),om=s=>({viewModel$:s.viewModel$,parent:s.parent}),cm=(s,e)=>{const t=new c.ReplaySubject(1);return t.next(null),(s.viewModel$??e?.viewModel$)?.subscribe(t),{viewModel$:t.asObservable(),parent:s.viewModel$?e:e?.parent,viewModelSubject:t}};class Kt{set viewModel(e){(e instanceof Be||e===void 0||e===null)&&(this.viewModel$?this.viewModel$.next(e):(this.viewModel$=new c.ReplaySubject(1),this.viewModel$.next(e)))}ngOnDestroy(){this.viewModel=null,this.viewModel$?.complete()}static{this.\u0275fac=function(t){return new(t||Kt)}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:Kt,selectors:[["","crtViewModel",""]],inputs:{viewModel:[0,"crtViewModel","viewModel"]},features:[r.\u0275\u0275ProvidersFeature([{provide:Kr,useFactory:om,deps:[[new r.Inject(Ql),new r.Self]],multi:!1},{provide:Ql,useFactory:cm,deps:[(0,r.forwardRef)(()=>Kt),[new r.Inject(Kr),new r.SkipSelf,new r.Optional]],multi:!1}])]})}}var _s=y(94123);class lm{static{this._addItemListeners=[]}static{this._removeItemListeners=[]}static{this._requestHandlersMap=new Map}static{this._handlersByRequestMap=new Map}static get requestHandlersMap(){return this._requestHandlersMap}static get handlersByRequestMap(){return this._handlersByRequestMap}static onAddRequestHandler(e){return this._addItemListeners.push(e),()=>{this._addItemListeners.splice(this._addItemListeners.indexOf(e),1)}}static onRemoveRequestHandler(e){return this._removeItemListeners.push(e),()=>{this._removeItemListeners.splice(this._removeItemListeners.indexOf(e),1)}}static addRequestHandler(e,t){const n=this._requestHandlersMap.get(e);if(n&&(!n.instanceConfig?.lazy||n.instanceType))return;const i={instanceType:t.instanceType,instanceConfig:{...n?.instanceConfig??{},...t.instanceConfig}};this._requestHandlersMap.set(e,i);for(const l of this._addItemListeners)l(e,i);const a=t.instanceConfig.requestType;let o=this._handlersByRequestMap.get(a);o||(o=new Map,this._handlersByRequestMap.set(a,o)),o.set(e,i)}static removeRequestHandler(e){const t=this._requestHandlersMap.get(e);if(!t)return;this._requestHandlersMap.delete(e);for(const a of this._removeItemListeners)a(e,t);const n=t.instanceConfig.requestType,i=this._handlersByRequestMap.get(n);i&&i.delete(e)}static clear(){for(const e of this._requestHandlersMap.keys())this.removeRequestHandler(e)}}const ys=window;ys.creatio??={},ys.creatio.requestHandlerRegistry||Object.defineProperty(ys.creatio,"requestHandlerRegistry",{get:()=>lm,configurable:!1});const um=ys.creatio.requestHandlerRegistry;class No{static{this._internalRegistry=ys.creatio.requestHandlerRegistry}static find(e){return No._internalRegistry.requestHandlersMap.get(e)}static register(e,t){const n=e.requestType,i=e.type;if(!n)throw new Error(`Error when register ${i}. Request type not specified.`);const a={instanceType:t,instanceConfig:e};No._internalRegistry.addRequestHandler(i,a)}}class cy{}const dm="ValidatorRegistry";class Jr extends Si{static{this.registryKey=dm}static _hasWithAnotherTypeRef(e,t){const n=Jr.items.get(e);return!n||n.lazy&&!n.typeRef?!1:n.typeRef!==t}static validate(e){if(vi(e.type,"ValidatorTypeName"),e.typeRef&&Jr._hasWithAnotherTypeRef(e.type,e.typeRef))throw new Error(`Error when register ${e.type}. Element with this type has already exist`)}static get items(){return this.store.typeInfos}static register(e){const t=this.items.get(e.type);this.items.set(e.type,{...t??{},...e})}}const hm="InterfaceDesignerItemRegistry";class pm extends Si{static get _interfaceDesignerItemRegistrationInfos(){return this.store.typeInfos}static validate(e){vi(e.type,"InterfaceDesignerItemTypeName"),jc(e.type),Uc(e.type,e,this._interfaceDesignerItemRegistrationInfos)}static register(e,t){if(typeof e=="string"&&t)this._interfaceDesignerItemRegistrationInfos.set(e,t);else if(typeof e!="string")this._interfaceDesignerItemRegistrationInfos.set(e.type,e);else throw new Error("Invalid arguments provided to register method.")}static get(e){return this._interfaceDesignerItemRegistrationInfos.get(e)}static has(e){return this._interfaceDesignerItemRegistrationInfos.has(e)}static getAll(){return this._interfaceDesignerItemRegistrationInfos}static values(){return[...this._interfaceDesignerItemRegistrationInfos.values()]}static clear(){this._interfaceDesignerItemRegistrationInfos.clear()}}class mm extends pm{static{this.registryKey=hm}}class bs{constructor(){this.registry=mm}get(e){return this.registry.get(e)}getInternal(e){return this.registry.get(e)}register(e,t){this.registry.register(e,t)}getAll(){return this.registry.getAll()}has(e){return this.registry.has(e)}values(){return this.registry.values()}clear(){this.registry.clear()}static{this.\u0275fac=function(t){return new(t||bs)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:bs,factory:bs.\u0275fac})}}class fm extends Si{static validate(e){vi(e.type,"ViewElementTypeName");const t=this.viewElements.get(e.type);t?.lazy&&!("selector"in t)&&!t.typeRef||Uc(e.type,e,this.viewElements)}static get viewElements(){return this.store.typeInfos}static register(e){const t=this.viewElements.get(e.type);this.viewElements.set(e.type,{...t??{},...e})}static getFormControlRelatesAttribute(e){const t=this.store.typeInfos.get(e);return t&&"formControlConfig"in t&&t.formControlConfig?.relatesTo||null}static getValuePropertyName(e){const t=this.store.typeInfos.get(e);return t&&"valuePropertyName"in t&&t.valuePropertyName||null}static getViewElementInputs(e){return this.store.typeInfos.get(e)?.inputs??{}}static getViewElementOutputs(e){return this.store.typeInfos.get(e)?.outputs??{}}static getViewElementPropertiesDefaultValues(e){const t=this.store.typeInfos.get(e);return[...Object.entries(t?.inputs??{}).filter(([i,a])=>Object.prototype.hasOwnProperty.call(a,"defaultValue")).map(([i,a])=>({name:i,defaultValue:a.defaultValue})),{name:"visible",defaultValue:!0}]}static getViewElementCompatiblePlatformAPIsOptions(e,t){return this.store.typeInfos.get(e)?.compatibleAPIs?.[t]??{}}static isViewElementAvailableByCompatibleAPIs(e,...t){const n=this.store.typeInfos.get(e);return Object.entries(n?.compatibleAPIs??{}).filter(([i,a])=>t.includes(i)).some(([i,a])=>typeof a=="boolean"?a:(a||{}).enable)}}const gm="ViewElementRegistry";class Yr extends fm{static{this.registryKey=gm}}class _m{canResolve(e){return this.registry.viewElements.has(e)}getViewElementRegistryItem(e){return this.registry.viewElements.get(e)}isViewElementAvailableByCompatibleAPIs(e,...t){return this.registry.isViewElementAvailableByCompatibleAPIs(e,...t)}getViewElementCompatiblePlatformAPIsOptions(e,t){return this.registry.getViewElementCompatiblePlatformAPIsOptions(e,t)}getFormControlRelatesAttribute(e){return this.registry.getFormControlRelatesAttribute(e)}getValuePropertyName(e){return this.registry.getValuePropertyName(e)||this.getFormControlRelatesAttribute(e)}getViewElementInputs(e){return this.registry.getViewElementInputs(e)}getViewElementOutputs(e){return this.registry.getViewElementOutputs(e)}getViewElementPropertiesDefaultValues(e){return this.registry.getViewElementPropertiesDefaultValues(e)}getViewElementType(e){const t=this.getViewElementRegistryItem(e.type);return this.getViewElementTypeByRegistryItem(t)}getCrtInputs(e){return this.getViewElementRegistryItem(e)?.inputs}getSelector(e){const t=this.getViewElementRegistryItem(e);return this.getSelectorByRegistryItem(t)}getSelectorByRegistryItem(e){return e&&"selector"in e?e.selector:null}getViewElementTypeByRegistryItem(e){return e&&"typeRef"in e?e.typeRef:null}}class ie extends _m{constructor(){super(...arguments),this.registry=Yr}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(ie)))(n||ie)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:ie,factory:ie.\u0275fac})}}function ym(s,e){if(typeof s=="string"){const t=s.startsWith("$"),n=s.slice(1).split(".").pop()||"",i=e?.[n]!=null;return t&&i}return!1}class Cs{constructor(){this._designerResolver=(0,r.inject)(bs),this._viewResolver=(0,r.inject)(ie),this._viewElementContentSlotsCache=new Map}_getViewConfigInfo(e,t,n,i,a){const o=[];if(Array.isArray(n))for(let l=0;l<n.length;l++){const d=n[l];t.includes(d[e])&&o.push({viewConfig:d,parentName:i,index:l,parentPropertyName:a}),this.getViewElementContentSlots(d.type)?.forEach(p=>{const g=d[p];if(g){const C=this._getViewConfigInfo(e,t,g,d.name,p);o.push(...C)}})}return o}_getViewConfigInfoByFilter(e,t,n,i){const a=[];if(Array.isArray(t))for(let o=0;o<t.length;o++){const l=t[o];e(l)&&a.push({viewConfig:l,parentName:n,index:o,parentPropertyName:i}),this.getViewElementContentSlots(l.type)?.forEach(h=>{const p=l[h];if(p){const g=this._getViewConfigInfoByFilter(e,p,l.name,h);a.push(...g)}})}return a}_getViewConfigsBindingMap(e,t,n){const i=new Map;if(Array.isArray(e))for(let a=0;a<e.length;a++){const o=e[a],l=this._viewResolver.getValuePropertyName(o.type),d=o[l]??"";if(d.startsWith("$")){const p=d.substring(1),g={viewConfig:o,parentName:t,index:a,parentPropertyName:n};i.has(p)?i.get(p).push(g):i.set(p,[g])}this.getViewElementContentSlots(o.type)?.forEach(p=>{const g=o[p];g&&this._getViewConfigsBindingMap(g,o.name,p).forEach((E,T)=>{i.has(T)?i.get(T).push(...E):i.set(T,E)})})}return i}_isViewModelAttributeBound(e,t){if(!t)return!1;const n=e.viewConfig,i=`\\W\\$${t}\\W`;return this._isAttributeUseInConfig(n,i)}_isViewModelAttributeBoundInViewModel(e,t){if(!t)return!1;const n=(0,v.cloneDeep)(this.getViewModelConfig(e));n.attributes=n.attributes||{},delete n?.attributes[t];const i=`\\W${t}\\W`;return this._isAttributeUseInConfig(n,i)}_isAttributeUseInConfig(e,t){const n=JSON.stringify(e);return new RegExp(t).test(n)}_findViewConfigItem(e,t,n){if(n(t))return e.push(t),!0;const i=this.getViewElementContentSlots(t.type);for(const a of i){const o=t[a];if(o){for(const l of o)if(this._findViewConfigItem(e,l,n))return e.push(t),!0}}}_getViewConfigArray(e){return e?Array.isArray(e)?e:[e]:[]}_getCollectionPropertyNames(e){return this._designerResolver.get(e)?.collectionPropertyNames||["items"]}_getContentSlots(e){const t=[];return this._viewResolver.getViewElementRegistryItem(e)?.contentSlots?.forEach(i=>{if(typeof i=="string")t.push(i);else{const a=i?.name;t.push(a)}}),t}_getPossibleResourceValues(e){return[`#ResourceString(${e})#`]}getViewElementContentSlots(e){if(this._viewElementContentSlotsCache.has(e))return this._viewElementContentSlotsCache.get(e);const t=this._getContentSlots(e),n=this._getCollectionPropertyNames(e),i=[...new Set([...t,...n])];return this._viewElementContentSlotsCache.set(e,i),i}getViewConfigPathByPropertyValue(e,t,n){const i=[],a=this._getViewConfigArray(n);for(const o of a)if(this._findViewConfigItem(i,o,l=>l[e]===t))break;return i}getViewConfigInfoByPropertyForValues(e,t,n){const i=[],a=this._getViewConfigArray(n);for(let o=0;o<a.length;o++){const l=a[o];t.includes(l[e])&&i.push({viewConfig:l,index:o}),this.getViewElementContentSlots(l.type)?.forEach(h=>{const p=l[h];if(p){const g=this._getViewConfigInfo(e,t,p,l.name,h);i.push(...g)}})}return i}getViewConfigInfoByProperty(e,t,n){return this.getViewConfigInfoByPropertyForValues(e,[t],n)}getViewConfigInfoByType(e,t){return this.getViewConfigInfoByProperty("type",t,e).map(n=>n?.viewConfig).filter(Boolean)}getViewConfigInfoByFilter(e,t){const n=[],i=t??[];for(let a=0;a<i.length;a++){const o=i[a];e(o)&&n.push({viewConfig:o,index:a}),this.getViewElementContentSlots(o.type)?.forEach(d=>{const h=o[d];if(h){const p=this._getViewConfigInfoByFilter(e,h,o.name,d);n.push(...p)}})}return n}getViewConfigsBindingMap(e){return this._getViewConfigsBindingMap(e??[],"","")}getViewModelAttribute(e,t){return this.getViewModelConfig(e)?.attributes?.[t]}getViewConfigInfoByName(e,t){return this.getViewConfigInfoByProperty("name",t,e?.viewConfig)[0]||{}}getViewModelConfig(e,t=!1){return!e.viewModelConfig&&t&&(e.viewModelConfig={}),e.viewModelConfig||{}}isViewModelAttributeBound(e,t){return t?this._isViewModelAttributeBound(e,t)||this._isViewModelAttributeBoundInViewModel(e,t):!1}addViewModelAttributeChangeRequest(e,t){const{attributeName:n,requests:i,options:a}=t??{};if(!n||!i?.length)return;const o=!!a?.createAttributeIfEmpty,l=this.getViewModelConfig(e,o);if(!l?.attributes&&!o)return;const d=l.attributes??={};if(!d[n]&&!o)return;const h=d[n]??={};h.change??=[],Array.isArray(h.change)||(h.change=[h.change]),h.change.push(...i)}findResourceDependencies(e,t){const n=this._getPossibleResourceValues(e),i={viewElements:[],attributes:[]},a=(o,l)=>{o&&(typeof o=="string"?n.forEach(d=>{o.includes(d)&&i.viewElements.push(l)}):Array.isArray(o)?o.forEach(d=>a(d,l)):typeof o=="object"&&Object.values(o).forEach(d=>a(d,l)))};return Object.entries(t).forEach(([o,l])=>a(l,o)),i}getDependentModelsNames(e,t,n){return Object.entries(e||{}).filter(([,a])=>{let o=t;return n&&(o=`${t}.${n}`),a.some(l=>l.relationPath.startsWith(o))}).map(([a])=>a)}getDataSourceModelName(e,t){return e?.dataSources?.[t]?.config?.entitySchemaName}findAllAttributesByDataSourceAttributePath(e,t){const n=this.getViewModelConfig(e,!0).attributes??{},i=Object.keys(n).filter(o=>{const l=n[o]??{};return El(l)&&l.modelConfig?.path===t});if(i.length>0)return i;const a=t.split(".");if(a.length>2){const o=a[0],d=e?.modelConfig?.dataSources?.[o]?.config?.attributes;if(d){const h=a.slice(1).join("."),p=Object.keys(d).find(g=>d[g].path===h);if(p)return this.findAllAttributesByDataSourceAttributePath(e,`${o}.${p}`)}}return[]}getLoadParametersByDataSourceName(e,t){return t.modelConfig?.dataSources?.[e]?.config?.loadParameters}getSortingConfigByDataSourceName(e,t){return this.getLoadParametersByDataSourceName(e,t)?.options?.sortingConfig}getCollectionViewConfigs(e,t){return t?.length?this.getViewConfigInfoByPropertyForValues("type",t,e.viewConfig).filter(n=>!!n).map(({viewConfig:n})=>n).filter(({name:n})=>n)||[]:[]}getCollectionViewConfigsWithItemsBinding(e,t){return this.getCollectionViewConfigs(e,t).filter(({items:n})=>ym(n,e.viewModelConfig?.attributes))}getRequestBindingConfigs(e,t,n){const i=[];return t===void 0||this.getViewConfigInfoByFilter(a=>{const o=Object.values(a).filter(l=>{const d=l;return d?.request===t&&(n?n(d):!0)});return i.push(...o),!1},e),i}findAllAttributesByDataSource(e,t){const n=this.getViewModelConfig(e,!0).attributes;return typeof n=="object"?Object.keys(n).filter(i=>{const a=n[i];return El(a)&&a.modelConfig?.path?.startsWith(t)}):[]}static{this.\u0275fac=function(t){return new(t||Cs)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Cs,factory:Cs.\u0275fac})}}class eu{constructor(){this.viewElements=new Set,this.requests=new Set,this.converters=new Set,this.validators=new Set}}class Ss{constructor(){this._metadataSchemaUtils=(0,r.inject)(Cs),this._viewElementTypeResolver=(0,r.inject)(ie)}_forEachStringInObject(e,t,n=[]){for(const i in e){const a=e[i];typeof a=="string"?t(n.concat(i),a):typeof a=="object"&&a!==null&&(n.push(i),this._forEachStringInObject(a,t,n),n.pop())}}_searchInContentSlots(e,t,n){const i=this._metadataSchemaUtils.getViewElementContentSlots(e.type)??[];for(const a of i){const o=e[a];Array.isArray(o)&&this._searchInViewConfig(e[a]??[],n)}}_searchInBindingExpression(e,t){Aa(e).converters?.forEach(n=>t.converters.add(n.type))}_searchInRequestConfig(e,t){const n=Array.isArray(e)?e:[e];for(const i of n)t.requests.add(i.request),i.params&&this._forEachStringInObject(i.params,(a,o)=>{Me(o)&&this._searchInBindingExpression(o,t)})}_searchInViewConfig(e,t){for(const n of e){t.viewElements.add(n.type);const i=this._viewElementTypeResolver.getViewElementRegistryItem(n.type);if(i)for(const[a,o]of Object.entries(n))i.inputs&&a in i.inputs&&Me(o)&&this._searchInBindingExpression(o,t),o&&i.outputs&&a in i.outputs&&this._searchInRequestConfig(o,t);this._searchInContentSlots(n,i,t)}}_searchInValidatorsConfig(e,t){for(const n of Object.values(e))t.validators.add(n.type)}_searchInViewModelConfig(e,t){if("attributes"in e)for(const n of Object.values(e.attributes))"change"in n&&this._searchInRequestConfig(n.change,t),"validators"in n&&this._searchInValidatorsConfig(n.validators,t),"viewModelConfig"in n&&this._searchInViewModelConfig(n.viewModelConfig,t),"converter"in n&&this._searchInBindingExpression("$value | "+n.converter,t)}*_getRequestHandlersMetadata(e){for(const t of e){const n=um.handlersByRequestMap.get(t);if(n)for(const i of n.values())yield i}}_addModuleRefIfLazy(e,t,n){t?.lazy&&(!n||n(t))&&e.add(t.lazyModuleRef)}getUsedItemsInSchema(e){const t=new eu;return this._searchInViewConfig(e.viewConfig??[],t),this._searchInViewModelConfig(e.viewModelConfig??{},t),t}getUsedItemsInViewConfig(...e){const t=new eu;return this._searchInViewConfig(e,t),t}getUsedViewElements(e){return this.getUsedItemsInViewConfig(...e).viewElements}getLazyModuleRefs(e,t){const n=new Set,{viewElements:i,requests:a,converters:o,validators:l}=e;for(const p of i)this._addModuleRefIfLazy(n,this._viewElementTypeResolver.getViewElementRegistryItem(p));for(const p of o)this._addModuleRefIfLazy(n,zc.find(p));for(const p of l)this._addModuleRefIfLazy(n,Jr.items.get(p));const d=this._getRequestHandlersMetadata(a),h=t?.requestScopes?p=>qc(p.scopes,t.requestScopes):void 0;for(const p of d)this._addModuleRefIfLazy(n,p.instanceConfig,h);return n}static{this.\u0275fac=function(t){return new(t||Ss)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ss,factory:Ss.\u0275fac})}}function bm(s){const e=new c.Subscription;for(const t of s)e.add(t);return e}class ee{constructor(e=new c.Subscription,t=Promise.resolve()){this._subscription=e,this.ready=t}static all(e){const t=bm(e.map(i=>i._subscription)),n=Promise.all(e.map(i=>i.ready)).then(()=>{});return new ee(t,n)}static subscribe(e,t,n=!1){e=e.pipe((0,u.share)());const i=e.subscribe({next:t}),a=n?(0,c.lastValueFrom)(e.pipe((0,u.first)(),(0,u.map)(()=>{})),{defaultValue:null}):Promise.resolve();return new ee(i,a)}unsubscribe(){this._subscription.unsubscribe()}}const Do="Change",Xr="ValidationInfo";function Vo(s,e){return!!Yr.viewElements.get(s)?.inputs?.[e]}function Oo(s,e){return!!Yr.viewElements.get(s)?.outputs?.[e]}function ly(s,e){return!!ViewElementRegistry.viewElements.get(s)?.validationInputs?.[e]}function Bo(s){return s+Do}function uy(s,e){const t=Bo(e);return Oo(s,t)}function Cm(s){return s+Xr}function tu(s,e){const t=e+Xr;return!!Yr.viewElements.get(s)?.validationInputs?.[t]}function Sm(s){let e=null;if(s.endsWith(Do))e=s.replace(new RegExp(Do+"$"),"");else if(s.endsWith(Xr))e=s.replace(new RegExp(Xr+"$"),"");else return null;return e}function dy(s,e){const t=Sm(e);return!!t&&Vo(s,t)}function nu(s,e){return ko.apply(this,arguments)}function ko(){return ko=(0,b.A)(function*(s,e){const t=Ia(s,e),n=yield(0,c.firstValueFrom)(t,{defaultValue:null});if(!n)return null;const i=yield(0,c.firstValueFrom)(n.context.viewModel$);if(!i)return null;const a=xa(n.contextPath,s);return yield kc(i,a)}),ko.apply(this,arguments)}function vm(s,e,t){return Lo.apply(this,arguments)}function Lo(){return Lo=(0,b.A)(function*(s,e,t){const n=yield nu(s,t);if(!n)return;const{attributeHost:i,attributeName:a}=n;i.getAttributeControl(a).markAsDirty(),i[a]=e}),Lo.apply(this,arguments)}function Mm(s,e){return Fo.apply(this,arguments)}function Fo(){return Fo=(0,b.A)(function*(s,e){const t=yield nu(s,e);if(!t)return;const{attributeHost:n,attributeName:i}=t,a=n.getAttributeControl(i);a.touched||(a.markAsTouched(),a.updateValueAndValidity())}),Fo.apply(this,arguments)}const iu="bindTo";class su{constructor(e){this.injector=e,this._loadingAttributeName="loading",this.bindingExpressionInterpreter=e.get(Wt),this.attrCtrlExpInterpreter=e.get(Rt),this.requestBindingConfigInterpreter=e.get(Hn),this.validationBindingInterpreter=e.get(Zt),this._bindingContext=e.get(Kr,null),this._macrosHandlerService=e.get(mn),this._isDesignTime=e.get(xt,!1);const t=e.get(W);this._isSafeBinding=!t.DisableSafePropertiesBinding,this._viewElementTypeResolver=e.get(ie)}_useMacros(e,t){if(!this._bindingContext)return t(e);let n;const i=new c.Subject,a=this._bindingContext.viewModel$.pipe((0,u.switchMap)(o=>this._macrosHandlerService.handleResourceMacros(e,o)),(0,u.map)((o,l)=>{n?.unsubscribe(),n=t(o),l===0&&n.ready.then(()=>{i.next(),i.complete()})}),(0,u.finalize)(()=>n?.unsubscribe())).subscribe();return new ee(a,(0,c.lastValueFrom)(i,{defaultValue:null}))}_bindLoadingProperty(e,t){if(Object.keys(e).some(l=>l===this._loadingAttributeName))return new ee;const i=(0,v.chain)(e).entries().filter(([l,d])=>this.isInputBinding(l,d,t,e)&&Me(d)).value();if(!i.length)return new ee;const a=i.map(([l,d])=>Yd(d)),o=bi(this._bindingContext).viewModel$.pipe((0,u.switchMap)(l=>{if(!l)return(0,c.of)();let d=[];const h=l.events$.pipe((0,u.filter)(g=>g.type===Y.StartLoadModelAttributes),(0,u.filter)(g=>{const C=Object.keys(g.payload);return a.some(E=>C.includes(E))}),(0,u.tap)(g=>{d=Object.keys(g.payload)}),(0,u.tap)(()=>t.setPropertyValue("loading",!0))),p=l.events$.pipe((0,u.filter)(g=>g.type===Y.FinishLoadModelAttributes),(0,u.filter)(g=>{const C=Object.keys(g.payload);return d.every(E=>C.includes(E))}),(0,u.tap)(()=>t.setPropertyValue("loading",!1)),(0,u.tap)(()=>d=[]));return(0,c.merge)(h,p)})).subscribe();return new ee(o)}_isControlProperty(e,t){const n=this._viewElementTypeResolver.getFormControlRelatesAttribute(t.type);return e===n}_getViewElementInputProperties(e){const t=this._viewElementTypeResolver.getViewElementRegistryItem(e.type);return t?[...Object.keys(t.inputs??{}).filter(n=>t.inputs[n].propertyBindable)]:["visible"]}_getViewElementEntries(e,t){const n=this._viewElementTypeResolver.getFormControlRelatesAttribute(t.type),i=e.find(([o])=>o===iu);let a=e.filter(([o])=>o!==iu);if(i){const[,o]=i;if(!o)return a;this._getViewElementInputProperties(t).forEach(d=>{if(d!==n){let h=o;h=`${h}:${d}`;const p=t[d];p!=null&&(h+=`=${p}`),a=a.filter(([g])=>g!==d),a.push([d,h])}})}return a}_bindInputWithValidation(e,t,n){const i=this.validationBindingInterpreter.evaluate(t,this._bindingContext).pipe((0,u.startWith)(null),(0,c.pairwise)()),a=Cm(e),o=([l,d])=>{l?.value!==d?.value&&n.setPropertyValue(e,d.value),n.setPropertyValue(a,d?.validationInfo)};return ee.subscribe(i,o)}_bindFocusout(e,t){const n=t.getEvent("focusout"),i=e.slice(1),a=()=>Mm(i,this._bindingContext);return ee.subscribe(n,a)}_bindInputs(e,t){const[n,i]=(0,v.chain)(e).entries().filter(([d,h])=>this.isInputBinding(d,h,t,e)&&!this.isTwoWayBinding(d,h,t,e)).partition(([,d])=>Me(d)).value();i.forEach(([d,h])=>{h=this._isControlProperty(d,e)?new He.FormControl(h):h,t.setPropertyValue(d,h)});const o=this._getViewElementEntries(n,e).map(([d,h])=>{const C=(this._isControlProperty(d,e)?this.attrCtrlExpInterpreter:this.bindingExpressionInterpreter).evaluate(h,this._bindingContext);if(tu(e.type,d)&&pr(h))return this._bindInputWithValidation(d,h,t);{const E=T=>t.setPropertyValue(d,T);return ee.subscribe(C,E,!1)}}),l=this._bindLoadingProperty(e,t);return ee.all([...o,l])}_createRequest(e,t){const n={...this._bindingContext,initialEvent:t};return this.requestBindingConfigInterpreter.evaluate(e,n).pipe((0,u.map)(i=>({...i,$initialEvent:t})))}_bindOutputSafely(e,t,n){const i=e.getEvent(t),a=bi(this._bindingContext).viewModel$.pipe((0,u.switchMap)(l=>l._destroy$)),o=l=>(0,c.lastValueFrom)(this._createRequest(n,l).pipe((0,u.switchMap)(d=>d.$context.executeRequest(d)),(0,u.takeUntil)(a))).catch(()=>null);return ee.subscribe(i,o)}_bindOutputUnsafely(e,t,n){const i=e.getEvent(t).pipe((0,u.switchMap)(o=>this._createRequest(n,o))),a=o=>o.$context.executeRequest(o);return ee.subscribe(i,a)}_bindOutput(e,t,n){return this._isSafeBinding?this._bindOutputSafely(e,t,n):this._bindOutputUnsafely(e,t,n)}_bindOutputs(e,t){const i=Object.entries(e).filter(([a,o])=>this.isOutputBinding(a,o,t,e)).map(([a,o])=>this._bindOutput(t,a,o));return ee.all(i)}_bindTwoWays(e,t){const n=Object.entries(e).filter(([a,o])=>this.isTwoWayBinding(a,o,t,e)),i=[];return n.forEach(([a,o])=>{const l=this.bindingExpressionInterpreter.evaluate(o,this._bindingContext),d=R=>t.setPropertyValue(a,R);tu(e.type,a)&&pr(o)?i.push(this._bindInputWithValidation(a,o,t)):i.push(ee.subscribe(l,d));const h=o.slice(1),p=Bo(a),g=this.getViewEventsStream(t,p),C=R=>vm(h,R,this._bindingContext),E=ee.subscribe(g,C);i.push(E);const T=this._bindFocusout(o,t);i.push(T)}),ee.all(i)}isInputBinding(e,t,n,i){return Vo(i.type,e)}isOutputBinding(e,t,n,i){return Oo(i.type,e)}isTwoWayBinding(e,t,n,i){const a=Bo(e);return pr(t)&&Vo(i.type,e)&&Oo(i.type,a)&&!(a in i)}bind(e,t){const n=i=>ee.all([this._bindInputs(i,e),this._bindOutputs(i,e),this._bindTwoWays(i,e)]);return this._isDesignTime?this._useMacros(t,n):n(t)}}class ru extends su{isInputBinding(e,t,n,i){return super.isInputBinding(e,t,n,i)||!this.isOutputBinding(e,t,n,i)}isOutputBinding(e,t,n,i){return super.isOutputBinding(e,t,n,i)||n.getPropertyValue(e)instanceof r.EventEmitter}getViewEventsStream(e,t){return e.getEvent(t)}}class au{constructor(e,t,n,i,a,o,l){this._componentRef=e,this._inputs=t,this._ngZone=i,this._changeDetectorRef=a,this.nativeElement=o,this.hostView=l,this._propertyValues=new Map,this.instance=n;const d=this._componentRef.injector.get(W,null);this._enableInstanceValueSetFeature=d?.["ComponentViewElementRef.EnableInstanceValueSet"]}setValue(e,t){if(this._inputs?.[e])this._componentRef.setInput(e,t);else if(this._enableInstanceValueSetFeature)(0,v.set)(this.instance,e,t);else{const n=["selected","layoutConfig","dragging","currentLayoutConfig"];if(e in this.instance&&!n.includes(e)){const i=this._componentRef.componentType.name;let a=`Can't set value of the '${e}' input on the '${i}' component. `;a+=`Make sure that the '${e}' property is annotated with @Input() or a mapped @Input('${e}') exists.`,console.error(a)}}this._changeDetectorRef.detectChanges()}getPropertyValue(e){return(0,v.get)(this.instance,e)}getEvent(e){const t=this.getPropertyValue(e);return!t&&this.nativeElement?(0,c.fromEvent)(this.nativeElement,e):t}on(e,t){const i=this.getEvent(e).subscribe(t);return()=>{i.unsubscribe()}}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this._ngZone.run(()=>this.setValue(e,t)))}destroy(){this.hostView?.destroy(),this._componentRef?.destroy(),this.nativeElement=null}}class wm{constructor(e,t){this._ngZone=t,this._propertyValues=new Map,this.instance=e}setValue(e,t){(0,v.set)(this.instance,e,t)}getPropertyValue(e){return(0,v.get)(this.instance,e)}getEvent(e){return this.getPropertyValue(e)}on(e,t){const i=this.getPropertyValue(e).subscribe(t);return()=>{i.unsubscribe()}}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this._ngZone.run(()=>this.setValue(e,t)))}destroy(){this.instance=null}}var Je;(function(s){s.Default="default",s.OnViewport="on-viewport"})(Je||(Je={}));class Im extends su{getViewEventsStream(e,t){return e.getEvent(t).pipe((0,c.map)(n=>n.detail))}}class ou{constructor(e){this.injector=e}}const Gn=new r.InjectionToken("CRT_VIEW_ELEMENT_CONFIG");class Em{constructor(e){this._propertyValues=new Map,this.instance=e}getPropertyValue(e){return this.instance[e]}getEvent(e){return(0,c.fromEvent)(this.instance,e)}on(e,t){return this.instance.addEventListener(e,t),()=>this.instance.removeEventListener(e,t)}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this.instance[e]=t)}destroy(){}}class Am extends ou{createComponent(e){const t=this.injector.get(ie),n=this.injector.get(r.Renderer2),i=this.injector.get(r.ViewContainerRef),a=this.injector.get(Gn),o=t.getSelector(a.type),l=document.createElement(o);return e?.forEach(({name:d,value:h})=>{n.setAttribute(l,d,h)}),n.appendChild(i.element.nativeElement.parentElement,l),this._initDirectionality(l),new Em(l)}_initDirectionality(e){this.injector.get(Ae.Directionality)?.value==="rtl"&&e.setAttribute("dir","rtl")}}class cu extends ou{createComponent(e){const t=this.injector.get(ie),n=this.injector.get(Gn),i=t.getViewElementType(n);if(!i)throw new Error(`Component for type ${n.type} not found`);const a=this.injector.get(r.ViewContainerRef),o=this.injector.get(r.Renderer2),l=t.getCrtInputs(n.type),d=a.createComponent(i,{index:0,injector:this.injector});e?.forEach(({name:C,value:E})=>{o.setAttribute(d.location.nativeElement,C,E)});const h=d.injector.get(r.ChangeDetectorRef),p=d.injector.get(r.ElementRef).nativeElement;d.changeDetectorRef.detectChanges();const g=this.injector.get(r.NgZone);return new au(d,l,d.instance,g,h,p,d.hostView)}}class xm{}const lu=new r.InjectionToken("VIEW_ELEMENT_COMPONENT_CREATOR");class uu extends xm{constructor(e){super(),this.injector=e,this.viewElementConfig=this.injector.get(Gn),this.featureValues=this.injector.get(W,{optional:!0}),this.measurePerformanceService=this.injector.get(z),this._componentCreator=this.injector.get(lu)}_getElementName(){return`${this.viewElementConfig.type.split(".")?.[1]} ${this.viewElementConfig.name}`}_getDOMAttributes(){const e=[];return this.featureValues?.UseViewElementDataItemMarker&&e.push({name:"data-item-marker",value:this.viewElementConfig.dataItemMarker||this.viewElementConfig.name}),e}createComponent(e){return this._componentCreator.createComponent(e)}getComponentRef(){const e=this._getElementName(),t=this._getDOMAttributes();return this.measurePerformanceService.measure(e,()=>this.createComponent(t))}show(){const e=this.getComponentRef();return(0,c.of)(e)}hide(){}}class Rm extends uu{constructor(e,t,n){super(e),this.injector=e,this._creator=t,this._destroyed=n,this._renderer=this.injector.get(r.Renderer2),this._container=this.injector.get(r.ViewContainerRef),this._resolver=this.injector.get(ie),this._initMinHeight(),this._subscribeDestroyed()}get _parentElement(){return this._container.element.nativeElement.parentElement}_handleIntersection(e,t){if(this._parentElement){if(e&&!this._componentRef?.hostView){this._initResizeObservable(),t.next(this.getComponentRef()),t.complete();return}this._componentRef?.hostView&&(e?this._showElement():this._hideElement())}}_initIntersectionObserver(e){let t=this.viewElementConfig.selected;this._intersectionObserver=new IntersectionObserver(n=>{n.forEach(i=>{t?t=!1:this._handleIntersection(i.isIntersecting,e)})}),this._intersectionObserver.observe(this._parentElement),t&&this._handleIntersection(!0,e)}_initResizeObservable(){this._resizeObserver||(this._resizeObserver=new ResizeObserver(e=>{const{height:t,width:n}=e[0].contentRect;this._minHeight=`${t}px`,this._minWidth=`${n}px`}),this._resizeObserver.observe(this._parentElement))}_showElement(){this._display?this._renderer.setStyle(this._componentRef.nativeElement,"display",this._display):this._renderer.removeStyle(this._componentRef.nativeElement,"display"),this._removeMinSize()}_hideElement(){this._applyMinSize(),this._display=this._componentRef.nativeElement?.style.display,this._renderer.setStyle(this._componentRef.nativeElement,"display","none")}_removeMinSize(){this._renderer.removeStyle(this._parentElement,"min-height"),this._minWidth&&this._renderer.removeStyle(this._parentElement,"min-width")}_applyMinSize(){this._renderer.setStyle(this._parentElement,"min-height",this._minHeight),this._minWidth&&this._renderer.setStyle(this._parentElement,"min-width",this._minWidth)}_initMinHeight(){const e=this._resolver.getViewElementRegistryItem(this.viewElementConfig.type);e?e.renderStrategy===Je.OnViewport&&(this._minHeight=e.placeholderSize.height):console.warn(`View element with type "${this.viewElementConfig.type}" not found`)}_subscribeDestroyed(){this._destroyed?.subscribe(()=>{const e=this._componentRef?.hostView;e&&!e.destroyed&&(e.detach(),e.destroy()),this._componentRef&&(this._componentRef.instance=null),this._componentRef=null,this._container.detach(),this._container.clear(),this._container=null,this._resizeObserver?.disconnect(),this._intersectionObserver?.disconnect()})}createComponent(e){return this._componentRef=this._creator.createComponent(e),this._removeMinSize(),this._componentRef}show(){return this._applyMinSize(),new c.Observable(e=>{this._initIntersectionObserver(e)})}hide(){this._resizeObserver?.disconnect(),this._intersectionObserver?.disconnect()}}const du=new r.InjectionToken("COMPONENT_PROPERTIES_BINDER"),hu=new r.InjectionToken("DIRECTIVE_PROPERTIES_BINDER"),pu=new r.InjectionToken("VIEW_ELEMENT_RENDER_STRATEGY"),jo=new r.InjectionToken("VIEW_ELEMENT_RENDER_STRATEGY_VALUE"),Tm=function(s){const e=s.get(Gn);return s.get(ie).getSelector(e.type)},$o=function(s){return!!Tm(s)},Pm=function(s){return s.get(W,{optional:!0})},Nm=function(s){return s.get(xt,!1)},Dm=function(s){return $o(s)?new Im(s):new ru(s)},Vm=function(s){return $o(s)?new Am(s):new cu(s)},Om=function(s,e){const t=s.get(jo)||Je.Default,i={[Je.Default]:mu,[Je.OnViewport]:Fm}[t];if(!i)throw new Error(`Unsupported render strategy type: ${t}`);return i(s,e)},Bm=function(s,e){return s||e},mu=function(s){return new uu(s)},km=function(s){return Pm(s).UseLazyComponentCreationInDesignTime},Lm=function(s){const e=s.get(Gn);return s.get(ie).getViewElementRegistryItem(e.type)?.renderStrategy===Je.Default},Fm=function(s,e){const t=Lm(s),n=km(s),i=$o(s),a=!Nm(s);return t||i||a||!n?mu(s):new Rm(s,new cu(s),e)},jm=new r.InjectionToken("Ignore view elements not found warning");class he{constructor(e,t,n,i,a,o){this._resolver=e,this.parentDirective=t,this.injector=n,this._container=i,this._isDesignTime=a,this._ngZone=o,this._ownProperties=[{property:"visible",defaultValue:!0,omitForViewModelBinding:!0},{property:"bindTo",defaultValue:null,omitForViewModelBinding:!1}],this._destroyed$=new c.Subject,this._showElementSubscription=new c.Subscription,this._bindingContext=null,this._isCreating=!1,this._visible=!1,this._schemaAnalysisUtils=(0,r.inject)(Ss),this._componentRefSubject=new c.ReplaySubject(1),this._visibilitySubject=new c.ReplaySubject(1),this.visibilityChanged=(0,_s.outputFromObservable)(this._visibilitySubject.asObservable().pipe((0,u.distinctUntilChanged)(),(0,u.takeUntil)(this._destroyed$))),this.componentRef$=this._componentRefSubject.asObservable().pipe((0,u.distinctUntilChanged)(),(0,u.takeUntil)(this._destroyed$)),this.nested=[],this.total=0,this.viewElementShow=new r.EventEmitter,this._featureValues=(0,r.inject)(W,{optional:!0}),this._shouldLoadLazyModules=!this._featureValues.DisableLoadingLazyModulesFromViewElementDirective,this._measurePerformanceService=(0,r.inject)(z),this._directiveRef=new wm(this,this._ngZone)}get visible(){return this._visible}set visible(e){this._visible=e,this._setViewElementVisibility(e||this._isDesignTime)}_bindSelfToViewModel(){const e=this._ownProperties.reduce((t,{property:n,defaultValue:i})=>({...t,[n]:this.viewElementConfig[n]??i}),{});this._ngZone.runOutsideAngular(()=>this.bindDirectiveProperties(e))}_bindComponentToViewModel(){const e=(0,v.omit)(this.viewElementConfig,...this._ownProperties.filter(({omitForViewModelBinding:t})=>t===!0).map(({property:t})=>t));this._ngZone.runOutsideAngular(()=>this.bindComponentProperties(e))}_setViewElementVisibility(e){e&&!this.componentRef?this._showViewElement():!e&&this.componentRef&&this._hideViewElement(),this._visibilitySubject.next(!!e)}_setComponentRef(e){this.componentRef=e,this._componentRefSubject.next(e)}_showViewElement(){const e=this.viewElementConfig.type;if(this._typeName=e,!!this._typeName)if(this._resolver.canResolve(e))this._showComponent();else{if(this.injector.get(jm,!1))return;const n=this._container.createComponent(Cn);n.instance.caption=e;const i=n.injector.get(r.ElementRef).nativeElement,a=this._resolver.getCrtInputs(e);console.warn(`View element with type "${e}" not found`),this._setComponentRef(new au(n,a,n.instance,this._ngZone,n.changeDetectorRef,i,n.hostView))}}_getLazyModuleRefs(e){return this._measurePerformanceService.measure("ViewElementDirective.SEARCHING_SCHEMA_LAZY_ITEMS",()=>{const t=this._schemaAnalysisUtils.getUsedItemsInViewConfig(this.viewElementConfig);return this._schemaAnalysisUtils.getLazyModuleRefs(t,{requestScopes:e?._scopes})})}_getInjectionContext(e){const t=e;return t._injectionContext||ki(t)._injectionContext}_addLazyModulesToContext(e,t){const n=this._getInjectionContext(e);for(const i of t)n.addLazyModule(i);Zc(n)}_loadLazyModules(){return this._shouldLoadLazyModules?this._featureValues.DisableFreedomUiLazyLoading?(0,c.from)(Hc.instance.loadAll()):(this._bindingContext?.viewModel$??(0,c.of)(null)).pipe((0,u.switchMap)(t=>{const n=this._getLazyModuleRefs(t);if(n.size===0||t?._destroyed)return(0,c.of)(void 0);const i=(0,c.from)(Promise.all(Array.from(n,a=>a.loadAndBootstrap())));return t?i.pipe((0,u.map)(a=>Gc(a)),(0,u.tap)(a=>this._addLazyModulesToContext(t,a))):i}),(0,u.take)(1),this._measurePerformanceService.measure$("ViewElementDirective.LOADING_SCHEMA_LAZY_ITEMS")):(0,c.of)(void 0)}_showComponent(){this._isCreating||(this._isCreating=!0,this._renderStrategyInstance&&this._renderStrategyInstance.hide(),this._renderStrategyInstance=this.injector.get(pu),this._showElementSubscription.add(this._loadLazyModules().pipe((0,u.switchMap)(()=>this._renderStrategyInstance.show()),(0,u.filter)(e=>!!e)).subscribe(e=>{this._setComponentRef(e),this._measurePerformanceService.measure(`binding ${this.viewElementConfig.name}`,()=>this._bindComponentToViewModel()),this.viewElementShow.emit(this),this._isCreating=!1,this._featureValues?.UseMeasurePerformanceTools&&this._measurePerformanceService.rendering$.next()})))}_hideViewElement(){this._componentBinding?.unsubscribe(),this._showElementSubscription.unsubscribe(),this._renderStrategyInstance.hide(),this._container.clear(),this.componentRef?.destroy(),this._setComponentRef(null)}bindDirectiveProperties(e){this._directiveBinding?.unsubscribe(),this._directiveBinding=this._directivePropertiesBinder.bind(this._directiveRef,e)}bindComponentProperties(e){this._componentBinding?.unsubscribe(),this.componentRef&&(this._componentBinding=this._componentPropertiesBinder.bind(this.componentRef,e))}updateViewElementConfig(e){this.viewElementConfig=e,this._bindSelfToViewModel(),this._bindComponentToViewModel()}ngOnInit(){this._shouldLoadLazyModules&&(this._bindingContext=this.injector.get(Kr,null)),this._directivePropertiesBinder=this.injector.get(hu),this._componentPropertiesBinder=this.injector.get(du),this.parentDirective&&this.parentDirective.attachNested(this),this._bindSelfToViewModel()}attachNested(e){this.nested.push(e)}detachNested(e){this.nested.splice(this.nested.indexOf(e),1)}ngOnDestroy(){this.parentDirective&&this.parentDirective.detachNested(this),this.nested.forEach(e=>e.ngOnDestroy()),this.componentRef?.destroy(),this._setComponentRef(null),this.viewElementConfig=null,this._componentBinding?.unsubscribe(),this._directiveBinding?.unsubscribe(),this._showElementSubscription.unsubscribe(),this._container.clear(),this._directiveRef.destroy(),this._renderStrategyInstance=null,this._componentRefSubject.complete(),this._visibilitySubject.complete(),this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||he)(r.\u0275\u0275directiveInject(ie),r.\u0275\u0275directiveInject(he,12),r.\u0275\u0275directiveInject(r.Injector),r.\u0275\u0275directiveInject(r.ViewContainerRef),r.\u0275\u0275directiveInject(xt,8),r.\u0275\u0275directiveInject(r.NgZone))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:he,selectors:[["","crtViewElement",""]],inputs:{viewElementConfig:[0,"crtViewElement","viewElementConfig"],renderStrategy:"renderStrategy",visible:"visible"},outputs:{visibilityChanged:"visibilityChanged",viewElementShow:"viewElementShow"},features:[r.\u0275\u0275ProvidersFeature([{provide:Gn,useFactory:e=>e.viewElementConfig,deps:[(0,r.forwardRef)(()=>he)],multi:!1},{provide:du,useFactory:Dm,deps:[r.Injector],multi:!1},{provide:hu,useFactory:e=>new ru(e),deps:[r.Injector],multi:!1},{provide:lu,useFactory:Vm,deps:[r.Injector],multi:!1},{provide:jo,useFactory:(e,t)=>Bm(e.renderStrategy,t),deps:[(0,r.forwardRef)(()=>he),[new r.Inject(jo),new r.SkipSelf,new r.Optional]],multi:!1},{provide:pu,useFactory:(e,t)=>Om(e,t._destroyed$),deps:[r.Injector,(0,r.forwardRef)(()=>he)],multi:!1},...Xl])]})}}class vs{constructor(){this._viewElementTypeResolver=(0,r.inject)(ie)}_updateAttributeProperties(e,t,n,i){const a=e[t]||{},o={};i.forEach(h=>{let p=h.defaultValue;Object.prototype.hasOwnProperty.call(n,h.name)&&(p=n[h.name]??h.defaultValue),o[h.name]={defaultValue:p}});const l=this._viewElementTypeResolver.getViewElementInputs(n.type);Object.entries(l).filter(([,h])=>h.propertyName!=null).forEach(([h,p])=>{o[p.propertyName]={defaultValue:h,locked:!0}}),a.properties={...a.properties??{},...o}}updateAttributeProperties(e,t,n){const i=e.bindTo.replace("$",""),a=t?.viewModelConfig?.attributes||{};this._updateAttributeProperties(a,i,e,n)}updateCollectionAttributeProperties(e,t,n,i){const a=e.bindTo.replace(`${n}.`,""),o=n.replace("$",""),d=(t?.viewModelConfig?.attributes||{})[o];if(!d)return;const h=d?.viewModelConfig?.attributes;h&&this._updateAttributeProperties(h,a,e,i)}static{this.\u0275fac=function(t){return new(t||vs)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:vs,factory:vs.\u0275fac})}}const fu="bindTo",$m="visible";class Ms{constructor(){this._viewElementTypeResolver=(0,r.inject)(ie)}_getViewElementInputProperties(e){const t=this._viewElementTypeResolver.getViewElementRegistryItem(e.type);return[...Object.keys(t.inputs??{}).filter(n=>t.inputs[n].propertyBindable),$m]}createLayoutConfigComponentParts(e,t,n){for(const[i,a]of Object.entries(t))n.attributes["layout-config-"+(0,v.kebabCase)(i)]={value:a}}createVisibleComponentPartsWrapper(e,t,n,i){const a=Me(t);let o=t;const l=[];a&&(o=t,l.push({name:"crtBinding",arguments:[{value:e,propertyKey:this.getContextPropertyName(e+"|propertyName",n)},{value:i,propertyKey:this.getContextPropertyName(e+"|viewElementConfig",n)}]}));const d=n.directives.find(h=>h.selector==="crtIf");if(d)d.values.unshift({propertyKey:this.getContextPropertyName(e,n),value:o,pipes:l});else{const h={values:[{propertyKey:this.getContextPropertyName(e,n),value:o,pipes:l}],selector:"crtIf",useAsterisk:!0};this.addCrtIfDirectiveAdditionalInputs(h,i),n.directives.push(h)}return n}getContextPropertyName(e,t){return t.name+":"+e}getViewElementEntries(e){const t=this._viewElementTypeResolver.getFormControlRelatesAttribute(e.type),n=Object.entries(e),i=n.find(([o])=>o===fu);let a=n.filter(([o])=>o!==fu);if(i){const o=this._getViewElementInputProperties(e),[,l]=i;o.forEach(d=>{if(d!==t){const h=e[d];if(h==null||typeof h!="string"||typeof h=="string"&&!h.includes("|")){let p=l;p=`${p}:${d}`,h!=null&&(p+=`=${JSON.stringify(h)}`),a=a.filter(([g])=>g!==d),a.push([d,p])}}})}return a}addCrtIfDirectiveAdditionalInputs(e,{visibilityStrategyMode:t}){if(!t)return;const n=e.additionalInputs||[];n.push({propertyKey:"visibilityStrategyMode",value:t}),e.additionalInputs=[...n]}static{this.\u0275fac=function(t){return new(t||Ms)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Ms,factory:Ms.\u0275fac})}}class _t{static{this.\u0275fac=function(t){return new(t||_t)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:_t})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[ie,vs,Ms,...Xl],imports:[w.CommonModule,bn,at,at]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(_t,{declarations:[Kt,he],imports:[w.CommonModule,bn,at],exports:[Kt,he,at]})})();const Um="39px";function gu(s){(0,v.isEmpty)(s.renderStrategy)&&"placeholderSize"in s&&(s.renderStrategy=Je.OnViewport),s.renderStrategy===Je.OnViewport&&!s.placeholderSize&&(s.placeholderSize={height:Um})}var yt;(function(s){s[s.Reuse=0]="Reuse",s[s.Rerender=1]="Rerender"})(yt||(yt={}));function _u(s,e){return function(t){Qd(s.type);const n=_d(t),i=yd(t),a=bd(t),o={...s,inputs:n,outputs:i,validationInputs:a},l="selector"in s?{...o,selector:s.selector}:{...o,typeRef:t};l.reuseStrategy=s?.reuseStrategy??yt.Rerender,gu(l),e==="web"?pd(l,t):md(l,t)}}function ws(s){return _u(s,"web")}var Is;(function(s){s.Charts="Charts",s.Components="Components",s.LayoutElements="LayoutElements",s.Inputs="Inputs",s.CustomElements="CustomElements"})(Is||(Is={}));function zm(s,e){function t(){if(!s.typeCaption&&s.toolbarConfig){const n=Array.isArray(s.toolbarConfig)?s.toolbarConfig[0]:s.toolbarConfig;s.typeCaption=n.caption}}return function(n){s.typeRef=n,s.viewElementGroupType??=Is.CustomElements,t(),gu(s),e==="mobile"?gd(s,n):fd(s,n)}}function yu(s){return zm(s,"web")}function I(s){return function(e,t){s||(s={propertyBindable:!1}),Reflect.defineMetadata(ba+t.toString(),s,e.constructor)}}function Qr(){return function(s,e){Reflect.defineMetadata(Ca+e.toString(),{},s.constructor)}}function Hm(s){return()=>y(34645)(`./${s}.json`)}var te;(function(s){s.None="none",s.Default="default",s.ExtraSmall="extra-small",s.Small="small",s.Medium="medium",s.Large="large",s.ExtraLarge="extra-large",s.X2Large="xxl",s.X3Large="xxxl"})(te||(te={}));const Gm=Object.values(te);function hy(s){return!!s&&typeof s=="string"&&Gm.includes(s.toLowerCase())}var ke;(function(s){s.OnlyText="only-text",s.LeftIcon="left-icon",s.RightIcon="right-icon",s.OnlyIcon="only-icon"})(ke||(ke={}));class qm{constructor(e){this.injector=e}}const Wm=new r.InjectionToken("Add delay before enabling skeleton loader");class Se extends qm{set shape(e){this._shape=e;const t=this._classes.indexOf("crt-component-rounded");this.shape==="rounded"?t===-1&&this._classes.push("crt-component-rounded"):t>=0&&this._classes.splice(t,1)}get shape(){return this._shape}get classes(){return this.getClasses()}set classes(e){this.setClasses(e)}get loading(){return this._loading$.value}set loading(e){this._loading$.next(!!e),typeof e=="boolean"&&(e?this.handleStartLoadViewModelAttributes():this.handleFinishLoadViewModelAttributes())}constructor(e){super(e),this.injector=e,this._loading$=new c.BehaviorSubject(!1),this._classes=[],this.destroyed$=new c.Subject,this.loaderVisible=!1,this.documentDirection=null,this.documentDirection=e.get(Ae.Directionality)?.value==="rtl"?"rtl":null,this.changeDetectorRef=this.injector.get(r.ChangeDetectorRef),this.directionality=this.injector.get(Ae.Directionality),this.elementRef=this.injector.get(r.ElementRef),this._subscribeLoadingChanges()}_subscribeLoadingChanges(){const e=this.injector.get(Wm,0,{optional:!0});this._loading$.pipe((0,u.switchMap)(t=>t?(0,c.of)(t).pipe((0,c.delay)(e)):(0,c.of)(t)),(0,u.tap)(t=>{this.loaderVisible=t,this.changeDetectorRef.markForCheck()}),(0,u.takeUntil)(this.destroyed$)).subscribe()}handleStartLoadViewModelAttributes(){}handleFinishLoadViewModelAttributes(){}setClasses(e){this._classes=e||[]}getClasses(){return this._classes}toggleClass(e,t,n){const i=e.indexOf(n);t&&i===-1&&e.push(n),!t&&i>=0&&e.splice(i,1)}switchClass(e,t,n){n.forEach(([i,a])=>{this.toggleClass(e,i===t,a)})}setValuesFromConfig(e,t=[]){const n=(0,v.omit)(e,["id","name","type",...t]);Object.entries(n).forEach(([i,a])=>{this[i]=a})}detectChanges(){this.changeDetectorRef.detectChanges()}isRtl(){return this.directionality.value==="rtl"}focus(){this.elementRef?.nativeElement.focus()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Se)(r.\u0275\u0275directiveInject(r.Injector))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:Se,hostVars:2,hostBindings:function(t,n){t&2&&r.\u0275\u0275attribute("element-name",n.name)("dir",n.documentDirection)},inputs:{name:"name",id:"id",tabIndex:"tabIndex",styles:"styles",shape:"shape",classes:"classes",loading:"loading"},features:[r.\u0275\u0275InheritDefinitionFeature]})}}(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],Se.prototype,"name",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],Se.prototype,"id",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Number)],Se.prototype,"tabIndex",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],Se.prototype,"styles",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],Se.prototype,"shape",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Array),(0,m.__metadata)("design:paramtypes",[Array])],Se.prototype,"classes",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean),(0,m.__metadata)("design:paramtypes",[Boolean])],Se.prototype,"loading",null);const py=null,Es={type:"animation",width:"32px",height:"32px",autoplay:!0,loop:!0},my="Components.Button.DefaultActionNotificationMessageText",Zm=["buttonElement"],Km=["menuViewElement"];class N extends Se{get _buttonElement(){return this.buttonElementRef?.nativeElement}set icon(e){this._icon=e,this.isIconAnimated&&this._buildIconAnimationConfig()}get icon(){return this.getIcon()}set size(e){!e||e===te.Default?this._size=te.Large:this._size=e}get size(){return this._size}set iconSize(e){!e||e===te.Default?this._iconSize=te.Large:this._iconSize=e}get iconSize(){return this._iconSize}set attributes(e){this._attributes=e,this._setAttributes()}get attributes(){return this._attributes}set type(e){e&&e!=="button"&&e!=="reset"&&e!=="submit"||(this._type=e)}get type(){return this._type}set disableRipple(e){this._disableRipple=e===!0}get disableRipple(){return this._disableRipple||this._displayType==="text"}set clickMode(e){this._clickMode=e||"default"}get clickMode(){return this._clickMode}get menuItems(){return this._menuItems}set menuItems(e){this._menuItems=Array.isArray(e)?e:[],this._updateMenuViewConfig()}get showMenuItems(){return this.menuItems?.length>0}set useGlassmorphism(e){const t=e===!0;this._useGlassmorphism!==t&&(this._useGlassmorphism=t,this._updateMenuViewConfig())}get useGlassmorphism(){return this._useGlassmorphism}set menuPanelClass(e){this._menuPanelClass!==e&&(this._menuPanelClass=e,this._updateMenuViewConfig())}get menuPanelClass(){return this._menuPanelClass}set color(e){this.colorThemePalette=this._getColorTheme(e)}set displayType(e){this._displayType=e}get displayType(){return this._displayType||"contained"}set menuViewElementDirective(e){e&&(this._menuViewElementDirective=e,this._menuViewElementDirective.componentRef$.pipe((0,_s.takeUntilDestroyed)(this._destroyRef)).subscribe(t=>{this._menuComponent=t?.instance,this._syncMenuComponentProperties()}))}constructor(e){super(e),this._isIconModeSizePx=40,this._renderer=(0,r.inject)(r.Renderer2),this._destroyRef=(0,r.inject)(r.DestroyRef),this._type="button",this._size=te.Large,this._iconSize=te.Large,this._displayType="contained",this._disableRipple=!1,this._menuItems=[],this._clickMode="default",this._menuViewElementName=`crt-base-button-menu-${D()}`,this._useGlassmorphism=!1,this.skeletonStyles={height:"36px",width:"120px"},this.isMenuOpened=!1,this.caption="",this.iconPosition=ke.RightIcon,this.title="",this.isIconModeSizePx=this._isIconModeSizePx,this.contentAlign="center",this.displayMenuIcon=!1,this.clicked=new r.EventEmitter,this.focused=new r.EventEmitter,this.blurred=new r.EventEmitter,this._updateMenuViewConfig()}get isIconVisible(){return!!this.icon&&this.iconPosition!==ke.OnlyText}get isTextVisible(){return!this.isIconMode&&this.iconPosition!==ke.OnlyIcon}get isMenuIconVisible(){return this.displayMenuIcon||this.isTextVisible}get iconClasses(){return this._getIconClasses()}get contentAlignClasses(){return this._getContentAlignClasses()}get menuDisabled(){return this.allowMenuOnDisabled?!1:this.disabled}get isIconAnimated(){return typeof this._icon=="string"?!1:!!(this._icon?.name||this._icon?.animationData)}get menuViewConfig(){return this._menuViewConfig}get menuComponent(){return this._menuComponent??null}_buildIconAnimationConfig(){const{name:e,loop:t,autoplay:n,width:i,height:a,animationData:o}=this.icon;this.animationIconConfig={...Es,autoplay:typeof n=="boolean"?n:Es.autoplay,loop:typeof t=="boolean"?t:Es.loop,width:i||Es.width,height:a||Es.height,animationData:o||Hm(e)}}_updateMenuViewConfig(){this._menuViewConfig?(this._menuViewConfig.items=this._menuItems,this._menuViewConfig.panelClass=this.menuPanelClass,this._menuViewConfig.useGlassmorphism=this.useGlassmorphism):this._menuViewConfig={type:"crt.Menu",name:this._menuViewElementName,items:this._menuItems,panelClass:this.menuPanelClass,useGlassmorphism:this.useGlassmorphism},this._syncMenuComponentProperties()}_syncMenuComponentProperties(){this._menuComponent&&(this._menuComponent.items=this._menuItems,this._menuComponent.panelClass=this.menuPanelClass,this._menuComponent.useGlassmorphism=this.useGlassmorphism,this.detectChanges())}_getColorTheme(e){if(e!=="default")return e}_getIconClasses(){const e=[];return this.switchClass(e,this.iconSize,this.getIconSizeClassMap()),e}_getContentAlignClasses(){const e=[];return this.switchClass(e,this.contentAlign,[["start","button-content-align-start"],["center","button-content-align-center"],["end","button-content-align-end"]]),e}_setAttributes(){!this._attributes||!this._buttonElement||Object.entries(this._attributes).forEach(([e,t])=>{t==null?this._renderer.removeAttribute(this._buttonElement,e):this._renderer.setAttribute(this._buttonElement,e,t)})}getSizeClassMap(){return[[te.None,"button-size-none"],[te.Small,"button-size-small"],[te.Medium,"button-size-medium"],[te.Large,"button-size-large"],[te.ExtraLarge,"button-size-extra-large"]]}getIconSizeClassMap(){return[[te.Small,"button-icon-size-small"],[te.Medium,"button-icon-size-medium"],[te.Large,"button-icon-size-large"],[te.ExtraLarge,"button-icon-size-extra-large"]]}getClasses(){const e=super.getClasses();return this.switchClass(e,this.iconPosition,[[ke.LeftIcon,"button-icon-position-left"],[ke.RightIcon,"button-icon-position-right"],[ke.OnlyIcon,"button-icon-position-only-icon"]]),this.switchClass(e,this._size,this.getSizeClassMap()),this.toggleClass(e,!!this.icon,"button-with-icon"),e}getIcon(){return this._icon}focus(){this._buttonElement?.focus()}getTitle(){return this.title?this.title:this.isIconMode||this.iconPosition===ke.OnlyIcon?this.caption:null}isDividerShown(){return!!this.menuItems?.length&&this.clickMode==="default"&&this.isTextVisible}onMenuOpened(){this.isMenuOpened=!0}onMenuClosed(){this.isMenuOpened=!1}onClick(e){e?.stopPropagation(),e?.preventDefault(),!this.disabled&&this.clickMode==="default"&&this.clicked.next(e)}onFocus(e){this.focused.next(e)}onBlur(e){this.blurred.next(e)}ngAfterViewInit(){this.autofocus&&this.focus(),this._setAttributes()}static{this.\u0275fac=function(t){return new(t||N)(r.\u0275\u0275directiveInject(r.Injector))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:N,viewQuery:function(t,n){if(t&1&&(r.\u0275\u0275viewQuery(Zm,5,r.ElementRef),r.\u0275\u0275viewQuery(Km,5,he)),t&2){let i;r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.buttonElementRef=i.first),r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.menuViewElementDirective=i.first)}},hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("click",function(a){return n.onClick(a)})("focus",function(a){return n.onFocus(a)})("blur",function(a){return n.onBlur(a)})},inputs:{disabled:"disabled",autofocus:"autofocus",caption:"caption",icon:"icon",size:"size",iconSize:"iconSize",iconPosition:"iconPosition",ariaLabel:"ariaLabel",attributes:"attributes",title:"title",textTransform:"textTransform",type:"type",disableRipple:"disableRipple",isIconModeSizePx:"isIconModeSizePx",allowMenuOnDisabled:"allowMenuOnDisabled",clickMode:"clickMode",contentAlign:"contentAlign",menuItems:"menuItems",displayMenuIcon:"displayMenuIcon",useGlassmorphism:"useGlassmorphism",menuPanelClass:"menuPanelClass",pressed:"pressed",color:"color",displayType:"displayType"},outputs:{clicked:"clicked",focused:"focused",blurred:"blurred"},features:[r.\u0275\u0275InheritDefinitionFeature]})}}(0,m.__decorate)([I({propertyBindable:!0,defaultValue:!1,propertyName:Tn.Disabled}),(0,m.__metadata)("design:type",Boolean)],N.prototype,"disabled",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean)],N.prototype,"autofocus",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],N.prototype,"caption",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[Object])],N.prototype,"icon",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"size",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"iconSize",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],N.prototype,"iconPosition",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],N.prototype,"ariaLabel",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[Object])],N.prototype,"attributes",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],N.prototype,"title",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],N.prototype,"textTransform",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"type",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean),(0,m.__metadata)("design:paramtypes",[Boolean])],N.prototype,"disableRipple",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Number)],N.prototype,"isIconModeSizePx",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean)],N.prototype,"allowMenuOnDisabled",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"clickMode",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],N.prototype,"contentAlign",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Array),(0,m.__metadata)("design:paramtypes",[Array])],N.prototype,"menuItems",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],N.prototype,"displayMenuIcon",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean),(0,m.__metadata)("design:paramtypes",[Boolean])],N.prototype,"useGlassmorphism",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"menuPanelClass",null),(0,m.__decorate)([Qr(),(0,m.__metadata)("design:type",Object)],N.prototype,"clicked",void 0),(0,m.__decorate)([Qr(),(0,m.__metadata)("design:type",Object)],N.prototype,"focused",void 0),(0,m.__decorate)([Qr(),(0,m.__metadata)("design:type",Object)],N.prototype,"blurred",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean)],N.prototype,"pressed",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"color",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],N.prototype,"displayType",null);var As=y(30421);class Ye extends _e.MatMenuTrigger{set crtMenuTriggerFor(e){this._menuComponent=e,this.menu=e?.menu}set crtMenuTriggerData(e){this.menuData=e}set crtMenuTriggerRestoreFocus(e){this.restoreFocus=e}constructor(e,t,n,i,a,o,l,d){super(e,t,n,i,a,o,l,d),this._elementRef=t,this._internalFocusMonitor=d,this._isCrtButton=this._elementRef.nativeElement.localName==="crt-button",this._isCrtButton&&this._subscribeToMenuToggle()}_subscribeToMenuToggle(){(0,c.merge)(this.menuClosed,this.menuOpened).pipe((0,c.tap)(()=>this._setButtonAttribute("aria-expanded",this.menuOpen?"true":"false")),(0,_s.takeUntilDestroyed)()).subscribe()}_setButtonAttribute(e,t){this._elementRef.nativeElement.getElementsByClassName("crt-button")[0]?.setAttribute(e,t)}onClick(e){this._triggeredTarget=e.currentTarget,super._handleClick(e)}focus(e,t){if(!this._triggeredTarget)return super.focus(e,t);this._internalFocusMonitor&&e&&this._internalFocusMonitor.focusVia(this._triggeredTarget,e,t),this._triggeredTarget=null}_handleClick(e){this._isCrtButton||super._handleClick(e)}openMenu(){if(this.crtMenuTriggerDisabled)return;this._menuComponent&&typeof this._menuComponent.setFocusOrigin=="function"&&this._menuComponent.setFocusOrigin(this._openedBy),super.openMenu()}ngAfterViewInit(){this._isCrtButton&&(this._setButtonAttribute("aria-expanded",this.menuOpen?"true":"false"),this._setButtonAttribute("aria-haspopup","menu"))}static{this.\u0275fac=function(t){return new(t||Ye)(r.\u0275\u0275directiveInject(As.Overlay),r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(r.ViewContainerRef),r.\u0275\u0275directiveInject(_e.MAT_MENU_SCROLL_STRATEGY),r.\u0275\u0275directiveInject(_e.MAT_MENU_PANEL,8),r.\u0275\u0275directiveInject(_e.MatMenuItem,10),r.\u0275\u0275directiveInject(Ae.Directionality,8),r.\u0275\u0275directiveInject(tr.FocusMonitor))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:Ye,selectors:[["","crtMenuTriggerFor",""]],hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("clicked",function(a){return n.onClick(a)})},inputs:{crtMenuTriggerDisabled:"crtMenuTriggerDisabled",crtMenuTriggerFor:"crtMenuTriggerFor",crtMenuTriggerData:"crtMenuTriggerData",crtMenuTriggerRestoreFocus:"crtMenuTriggerRestoreFocus"},exportAs:["crtMenuTrigger"],features:[r.\u0275\u0275InheritDefinitionFeature]})}}const Jm=["*"],bu=s=>({$implicit:s});function Ym(s,e){if(s&1&&r.\u0275\u0275element(0,"crt-skeleton-loader",8),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("styles",t.skeletonStyles)}}function Xm(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function Qm(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"button",10,3),r.\u0275\u0275listener("click",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(a.onClick(i))})("focus",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(a.onFocus(i))})("blur",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(a.onBlur(i))}),r.\u0275\u0275elementStart(3,"span",11),r.\u0275\u0275template(4,Xm,1,0,"ng-container",12),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementContainerEnd()}if(s&2){let t;const n=r.\u0275\u0275nextContext(2),i=r.\u0275\u0275reference(4);r.\u0275\u0275advance(),r.\u0275\u0275styleProp("text-transform",n.textTransform),r.\u0275\u0275classProp("icon-mode",n.isIconMode)("crt-button--text",n.displayType==="text")("crt-button--contained",n.displayType==="contained"),r.\u0275\u0275property("color",n.colorThemePalette)("disabled",n.disabled)("disableRipple",n.disableRipple)("ngClass",n.classes),r.\u0275\u0275attribute("aria-label",n.ariaLabel||n.getTitle()||null)("aria-pressed",(t=n.pressed)!==null&&t!==void 0?t:null)("type",n.type)("tabIndex",n.tabIndex)("title",n.getTitle()),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngTemplateOutlet",i)}}function ef(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function tf(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",14)(2,"button",15,3),r.\u0275\u0275listener("click",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(a.onClick(i))})("focus",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(a.onFocus(i))})("blur",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(a.onBlur(i))}),r.\u0275\u0275elementStart(4,"span",11),r.\u0275\u0275template(5,ef,1,0,"ng-container",12),r.\u0275\u0275element(6,"mat-divider",16),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(7,"button",17),r.\u0275\u0275listener("click",function(i){return r.\u0275\u0275restoreView(t),i.preventDefault(),r.\u0275\u0275resetView(i.stopPropagation())})("menuOpened",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.onMenuOpened())})("menuClosed",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.onMenuClosed())}),r.\u0275\u0275elementStart(8,"span",11),r.\u0275\u0275element(9,"mat-icon",18),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementContainer(10,13,5),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}if(s&2){const t=r.\u0275\u0275nextContext(3),n=r.\u0275\u0275reference(4);r.\u0275\u0275advance(2),r.\u0275\u0275styleProp("text-transform",t.textTransform),r.\u0275\u0275classProp("crt-button--text",t.displayType==="text")("crt-button--contained",t.displayType==="contained")("icon-mode",t.isIconMode),r.\u0275\u0275property("color",t.colorThemePalette)("disabled",t.disabled)("disableRipple",t.disableRipple)("ngClass",t.classes),r.\u0275\u0275attribute("aria-label",t.ariaLabel||t.getTitle()||null)("type",t.type)("tabIndex",t.tabIndex)("title",t.getTitle()),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngTemplateOutlet",n),r.\u0275\u0275advance(),r.\u0275\u0275property("vertical",!0),r.\u0275\u0275advance(),r.\u0275\u0275classProp("crt-button--text",t.displayType==="text")("crt-button--contained",t.displayType==="contained")("crt-button-menu-opened",t.isMenuOpened),r.\u0275\u0275property("ngClass",t.classes)("color",t.colorThemePalette)("disabled",t.menuDisabled)("disableRipple",t.disableRipple)("crtMenuTriggerFor",t.menuComponent)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(32,bu,t.menuItems)),r.\u0275\u0275attribute("aria-label",t.ariaLabel||t.caption||null),r.\u0275\u0275advance(3),r.\u0275\u0275property("crtViewElement",t.menuViewConfig)}}function nf(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function sf(s,e){s&1&&r.\u0275\u0275element(0,"mat-icon",18)}function rf(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"button",19,3),r.\u0275\u0275listener("menuOpened",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.onMenuOpened())})("menuClosed",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(i.onMenuClosed())}),r.\u0275\u0275elementStart(2,"span",11),r.\u0275\u0275template(3,nf,1,0,"ng-container",12)(4,sf,1,0,"mat-icon",20),r.\u0275\u0275elementEnd()()}if(s&2){let t;const n=r.\u0275\u0275nextContext(3),i=r.\u0275\u0275reference(4);r.\u0275\u0275styleProp("text-transform",n.textTransform),r.\u0275\u0275classProp("crt-button--text",n.displayType==="text")("crt-button--contained",n.displayType==="contained")("crt-button-menu-opened",n.isMenuOpened)("icon-mode",n.isIconMode),r.\u0275\u0275property("color",n.colorThemePalette)("disabled",n.menuDisabled)("disableRipple",n.disableRipple)("ngClass",n.classes)("crtMenuTriggerFor",n.menuComponent)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(23,bu,n.menuItems)),r.\u0275\u0275attribute("aria-label",n.ariaLabel||n.getTitle()||null)("aria-pressed",(t=n.pressed)!==null&&t!==void 0?t:null)("type",n.type)("tabIndex",n.tabIndex)("title",n.getTitle()),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngTemplateOutlet",i),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.isMenuIconVisible)}}function af(s,e){if(s&1&&(r.\u0275\u0275template(0,tf,12,34,"ng-container",9)(1,rf,5,25,"ng-template",null,4,r.\u0275\u0275templateRefExtractor),r.\u0275\u0275elementContainer(3,13,5)),s&2){const t=r.\u0275\u0275reference(2),n=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("ngIf",n.isDividerShown())("ngIfElse",t),r.\u0275\u0275advance(3),r.\u0275\u0275property("crtViewElement",n.menuViewConfig)}}function of(s,e){if(s&1&&r.\u0275\u0275template(0,Qm,5,18,"ng-container",9)(1,af,5,3,"ng-template",null,2,r.\u0275\u0275templateRefExtractor),s&2){const t=r.\u0275\u0275reference(2),n=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",!n.showMenuItems)("ngIfElse",t)}}function cf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"span",25),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext(3);r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function lf(s,e){s&1&&r.\u0275\u0275projection(0)}function uf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,cf,3,1,"ng-container",9)(2,lf,1,0,"ng-template",null,6,r.\u0275\u0275templateRefExtractor),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275reference(3),n=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function df(s,e){if(s&1&&r.\u0275\u0275element(0,"mat-icon",26),s&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("svgIcon",t.icon)("ngClass",t.iconClasses)}}function hf(s,e){if(s&1&&r.\u0275\u0275element(0,"crt-lottie",27),s&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("config",t.animationIconConfig)("width",t.animationIconConfig.width)("height",t.animationIconConfig.height)}}function pf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"span",21),r.\u0275\u0275template(1,uf,4,2,"ng-container",22)(2,df,1,2,"mat-icon",23)(3,hf,1,3,"crt-lottie",24),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngClass",t.contentAlignClasses),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.isTextVisible),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.isIconVisible&&!t.isIconAnimated),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.isIconVisible&&t.isIconAnimated&&t.animationIconConfig)}}let bt=class aa extends N{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(aa)))(n||aa)}})()}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:aa,selectors:[["crt-button"]],features:[r.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:Jm,decls:5,vars:2,consts:[["componentView",""],["defaultBtnContent",""],["btnWithMenu",""],["buttonElement",""],["btnWithMenuClickMode",""],["menuViewElement",""],["content",""],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],[4,"ngIf","ngIfElse"],["mat-flat-button","",1,"crt-button",3,"click","focus","blur","color","disabled","disableRipple","ngClass"],[1,"crt-button-inner-container"],[4,"ngTemplateOutlet"],[3,"crtViewElement"],[1,"crt-button-wrapper"],["mat-flat-button","",1,"crt-button","crt-button-with-menu","crt-menu-with-default-action",3,"click","focus","blur","color","disabled","disableRipple","ngClass"],[3,"vertical"],["mat-flat-button","",1,"crt-button","crt-button-menu-trigger-icon",3,"click","menuOpened","menuClosed","ngClass","color","disabled","disableRipple","crtMenuTriggerFor","crtMenuTriggerData"],["svgIcon","menu-arrow"],["mat-flat-button","",1,"crt-button","crt-button-with-menu",3,"menuOpened","menuClosed","color","disabled","disableRipple","ngClass","crtMenuTriggerFor","crtMenuTriggerData"],["svgIcon","menu-arrow",4,"ngIf"],[1,"btn-reversible-content",3,"ngClass"],[4,"ngIf"],["matSuffix","",3,"svgIcon","ngClass",4,"ngIf"],[3,"config","width","height",4,"ngIf"],[1,"crt-button-caption"],["matSuffix","",3,"svgIcon","ngClass"],[3,"config","width","height"]],template:function(t,n){if(t&1&&(r.\u0275\u0275projectionDef(),r.\u0275\u0275template(0,Ym,1,1,"crt-skeleton-loader",7)(1,of,3,2,"ng-template",null,0,r.\u0275\u0275templateRefExtractor)(3,pf,4,4,"ng-template",null,1,r.\u0275\u0275templateRefExtractor)),t&2){const i=r.\u0275\u0275reference(2);r.\u0275\u0275property("ngIf",n.loading)("ngIfElse",i)}},dependencies:[rt.MatButton,w.NgClass,w.NgIf,w.NgTemplateOutlet,B.MatIcon,Et,It.MatDivider,Ye,hn,he],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{display:inline-block;height:fit-content;width:fit-content;max-width:100%}.crt-button[_ngcontent-%COMP%]{display:block;max-width:100%;min-width:0}.crt-button.button-size-none.mat-mdc-unelevated-button.mat-mdc-button-base[_ngcontent-%COMP%]{height:unset}.crt-button[_ngcontent-%COMP%]:focus-visible, .crt-button.cdk-keyboard-focused[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.crt-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px;display:flex;min-width:8px;flex-shrink:0}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-small[_ngcontent-%COMP%]{height:8px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-medium[_ngcontent-%COMP%]{height:12px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-large[_ngcontent-%COMP%]{height:16px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-extra-large[_ngcontent-%COMP%]{height:24px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x2-large[_ngcontent-%COMP%]{height:32px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x3-large[_ngcontent-%COMP%]{height:40px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-small[_ngcontent-%COMP%]{width:8px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-medium[_ngcontent-%COMP%]{width:12px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-large[_ngcontent-%COMP%]{width:16px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-extra-large[_ngcontent-%COMP%]{width:24px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x2-large[_ngcontent-%COMP%]{width:32px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x3-large[_ngcontent-%COMP%]{width:40px}.crt-button.icon-mode[_ngcontent-%COMP%]{width:100%;padding:0 4px}.crt-button.crt-button-with-menu.crt-button--contained[_ngcontent-%COMP%]{padding-inline-end:8px}.crt-button.crt-button-with-menu.crt-button--contained.crt-menu-with-default-action[_ngcontent-%COMP%]{padding:0;margin-inline-end:-2px}.crt-button.crt-button-with-menu.crt-button--contained.crt-menu-with-default-action[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin-inline-end:2px}.crt-button.crt-button-with-menu.crt-button--contained.crt-menu-with-default-action[_ngcontent-%COMP%]   .btn-reversible-content[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0;padding-inline-start:16px;padding-inline-end:8px}.crt-button.crt-button-with-menu.crt-button--contained[_ngcontent-%COMP%]:not(.button-icon-position-only-icon)   .btn-reversible-content[_ngcontent-%COMP%]{padding-inline-end:8px}.crt-button.crt-button-with-menu.crt-button--text.crt-menu-with-default-action[_ngcontent-%COMP%]{padding:0;margin-inline-end:-2px}.crt-button.crt-button-with-menu.crt-button--text.crt-menu-with-default-action[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin-inline-end:2px}.crt-button.crt-button-with-menu.crt-button--text.crt-menu-with-default-action[_ngcontent-%COMP%]   .btn-reversible-content[_ngcontent-%COMP%]{padding-inline-end:4px}.crt-button.crt-button-with-menu.crt-button--text[_ngcontent-%COMP%]:not(.button-icon-position-only-icon)   .btn-reversible-content[_ngcontent-%COMP%]{padding-inline-end:8px}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content.button-content-align-start[_ngcontent-%COMP%]{justify-content:start}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content.button-content-align-center[_ngcontent-%COMP%]{justify-content:center}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content.button-content-align-end[_ngcontent-%COMP%]{justify-content:end}.crt-button.crt-button--text[_ngcontent-%COMP%]{padding:0}.crt-button[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{border-color:currentColor;border-width:1px;height:16px}.crt-button.button-size-small[_ngcontent-%COMP%]{line-height:18px}.crt-button.button-size-medium[_ngcontent-%COMP%]{line-height:24px}.crt-button.button-size-large[_ngcontent-%COMP%]{line-height:32px}.crt-button.button-size-extra-large[_ngcontent-%COMP%]{line-height:40px}.crt-button.button-size-x2-large[_ngcontent-%COMP%]{line-height:48px}.crt-button.button-size-x3-large[_ngcontent-%COMP%]{line-height:56px}.crt-button.button-size-small[_ngcontent-%COMP%]{height:18px}.crt-button.button-size-medium[_ngcontent-%COMP%]{height:24px}.crt-button.button-size-large[_ngcontent-%COMP%]{height:32px}.crt-button.button-size-extra-large[_ngcontent-%COMP%]{height:40px}.crt-button.button-size-x2-large[_ngcontent-%COMP%]{height:48px}.crt-button.button-size-x3-large[_ngcontent-%COMP%]{height:56px}.crt-button.button-size-small[_ngcontent-%COMP%]{font-size:10px}.crt-button.button-size-medium[_ngcontent-%COMP%]{font-size:12px}.crt-button.button-size-large[_ngcontent-%COMP%], .crt-button.button-size-extra-large[_ngcontent-%COMP%]{font-size:14px}.crt-button.button-size-x2-large[_ngcontent-%COMP%]{font-size:48px}.crt-button.button-size-x3-large[_ngcontent-%COMP%]{font-size:56px}.crt-button.crt-button--contained.button-size-small[_ngcontent-%COMP%]{padding:0 4px}.crt-button.crt-button--contained.button-size-medium[_ngcontent-%COMP%]{padding:0 12px}.crt-button.crt-button--contained.button-size-large[_ngcontent-%COMP%], .crt-button.crt-button--contained.button-size-extra-large[_ngcontent-%COMP%]{padding:0 16px}.crt-button.crt-button--contained.button-size-x2-large[_ngcontent-%COMP%]{padding:48px}.crt-button.crt-button--contained.button-size-x3-large[_ngcontent-%COMP%]{padding:56px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-small[_ngcontent-%COMP%]{padding:0 5px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-medium[_ngcontent-%COMP%]{padding:0 6px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-large[_ngcontent-%COMP%], .crt-button.crt-button--contained.button-icon-position-only-icon.button-size-extra-large[_ngcontent-%COMP%]{padding:0 8px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-x2-large[_ngcontent-%COMP%]{padding:48px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-x3-large[_ngcontent-%COMP%]{padding:56px}.crt-button[_ngcontent-%COMP%]   .crt-button-caption[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.crt-button-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.crt-button-wrapper[_ngcontent-%COMP%]   .crt-button.crt-button--contained.crt-button-menu-trigger-icon[_ngcontent-%COMP%]{width:32px;padding:0 8px}.crt-button-wrapper[_ngcontent-%COMP%]   .crt-button.crt-button--text.crt-button-menu-trigger-icon[_ngcontent-%COMP%]{padding-inline-start:4px}"],changeDetection:0})}};bt=(0,m.__decorate)([ws({type:"crt.Button",reuseStrategy:yt.Reuse}),yu({toolbarConfig:{position:10,icon:y(19127),defaultPropertyValues:{caption:"",color:"default",disabled:!1},defaultLocalizableStrings:{caption:"Components.Button.Caption"}},propertiesPanelComponentTypeName:"crt.ButtonPropertiesPanel",collectionPropertyNames:["menuItems"],typeCaption:"Components.Button.Caption",viewElementGroupType:Is.Components})],bt);class xs{constructor(e){this.viewContainerRef=e}static{this.\u0275fac=function(t){return new(t||xs)(r.\u0275\u0275directiveInject(r.ViewContainerRef))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:xs,selectors:[["","tsViewContainerRef",""]]})}}class qn{static{this.\u0275fac=function(t){return new(t||qn)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:qn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(qn,{declarations:[xs],exports:[xs]})})();var Uo=y(20637);const mf=["tooltipEl"],ff=s=>({rtl:s});class Xe{constructor(e,t){this._directionality=e,this._sanitizer=t,this._defaultCssClass="base-tooltip crt-base-tooltip"}setInnerHTML(){this.tooltipEl&&(this.tooltipEl.nativeElement.innerHTML=this._sanitizer.sanitize(r.SecurityContext.HTML,this._tooltipConfig?.value))}set tooltipConfig(e){this._tooltipConfig!==e&&(this._tooltipConfig=e)}get tooltipConfig(){return this._tooltipConfig}get cssClasses(){let e=this._tooltipConfig?.cssClasses||this._defaultCssClass;const t=typeof e=="string";return t&&(e=e.split(" ")),e.includes("base-tooltip")&&this._directionality.value==="rtl"&&!e.includes("base-tooltip_rtl")&&e.push("base-tooltip_rtl"),t?e.join(" "):e}isRtl(){return this._directionality.value==="rtl"}ngAfterViewInit(){this.setInnerHTML()}static{this.\u0275fac=function(t){return new(t||Xe)(r.\u0275\u0275directiveInject(Ae.Directionality),r.\u0275\u0275directiveInject(ne.DomSanitizer))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Xe,selectors:[["crt-base-tooltip"]],viewQuery:function(t,n){if(t&1&&r.\u0275\u0275viewQuery(mf,5,r.ElementRef),t&2){let i;r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.tooltipEl=i.first)}},inputs:{tooltipConfig:"tooltipConfig"},decls:3,vars:6,consts:[["tooltipEl",""],[1,"tooltip-value",3,"ngClass"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div"),r.\u0275\u0275element(1,"span",1,0),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275classMap(n.cssClasses),r.\u0275\u0275advance(),r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction1(4,ff,n.isRtl())))},dependencies:[w.NgClass],styles:[".base-tooltip[_ngcontent-%COMP%]{max-width:320px;max-height:50vh;overflow-y:auto;overflow-x:auto;box-shadow:0 2px 4px #18181840;padding-left:8px;padding-right:8px;margin:10px;opacity:1;word-wrap:break-word}.base-tooltip_rtl[_ngcontent-%COMP%]{padding-left:0;padding-right:8px}.base-tooltip[_ngcontent-%COMP%]   .rtl[_ngcontent-%COMP%]{direction:rtl;text-align:right}  .base-tooltip img{max-width:100%;height:auto}"]})}}class Rs{constructor(e){this.showEvent="mouseenter",this.hideEvent="mouseleave",this.capture=!1,this.closeOnOutsideClick=!1,er.isMobile&&(e.closeOnOutsideClick=!0,e.showEvent="touchstart",e.hideEvent="touched"),Object.assign(this,e)}}var gf=y(36931),Ct=y(89422);const _f=500;class Le{constructor(e,t,n,i){this._overlay=e,this._overlayPositionBuilder=t,this._elementRef=n,this._ngZone=i,this._delayTime=_f,this._allowedKeyboardEvent=[Ct.Key.Enter,Ct.Key.Escape,Ct.Key.Tab],this._class="crt-tooltip-trigger"}set tooltipConfig(e){if(!e)return;this._tooltipConfig=this._normalizeTooltipEvents(e);const t=er.isMobile?"touchstart":"click";if(this._tooltipConfig.showEvent.includes(t)||this._elementRef.nativeElement.addEventListener(t,this._handleScreenReaderEnterEvent.bind(this)),this._tooltipRef){if(this._tooltipRef.instance.tooltipConfig=this._tooltipConfig.tooltipConfig,!this._tooltipRef.instance.tooltipConfig)return;this._tooltipRef.instance.tooltipConfig.cssClasses=this._tooltipConfig?.panelClass}}get tooltipConfig(){return this._tooltipConfig}set crtTooltip(e){!e||Array.isArray(e)&&e.length===0||(this.tooltipConfig=new Rs({tooltipConfig:{value:Array.isArray(e)?e.join("<br>"):e},componentType:Xe}))}_createEventObservables(e,t){return e?e?.map(n=>(0,c.fromEvent)(t,n,{capture:this._tooltipConfig?.capture})):[]}_createShowEventStream(e){const t=this._createEventObservables(this._tooltipConfig?.showEvent,this._elementRef.nativeElement);return this._ngZone.runOutsideAngular(()=>(0,c.merge)(...t).pipe((0,u.auditTime)(this._delayTime),(0,u.takeUntil)(e)))}_createHideEventStream(e){const t=this._createEventObservables(this._tooltipConfig?.hideEvent,e);return this._ngZone.runOutsideAngular(()=>(0,c.merge)(...t))}_createEventsStream(e,t){this._subscription=t.subscribe(),this._subscription.add(e.subscribe());const n=(0,c.merge)(e,t);n.pipe((0,u.takeUntil)(t));const i=n.subscribe(a=>{if(this._tooltipConfig.showEvent?.includes(a.type)&&this.show(a),this._tooltipConfig.hideEvent?.includes(a.type)){let o=a.relatedTarget;this._overlayRef?.overlayElement.contains(o)||(o=this._elementRef.nativeElement,this.hide(),this._subscription.unsubscribe());const l=this._createHideEventStream(o),d=this._createShowEventStream(l);this._createEventsStream(d,l)}});this._subscription.add(i)}_createKeyboardEvent(){const e=this._ngZone.runOutsideAngular(()=>(0,c.fromEvent)(this._elementRef.nativeElement,"keydown",{capture:this._tooltipConfig?.capture}).pipe((0,u.filter)(n=>this._allowedKeyboardEvent.includes(n.key)))),t=this._ngZone.runOutsideAngular(()=>(0,c.fromEvent)(this._elementRef.nativeElement,"blur",{capture:this._tooltipConfig?.capture}));this._createKeyboardEventsStream(e,t)}_createKeyboardEventsStream(e,t){this._keypressSubscription=t.subscribe();const n=(0,c.merge)(e,t);n.pipe((0,u.takeUntil)(t));const i=n.subscribe(a=>{a instanceof KeyboardEvent?this._onHandleKeyboardEvent(a):a instanceof FocusEvent&&this._onHandleFocusEvent(a)});this._keypressSubscription.add(i)}_onHandleKeyboardEvent(e){switch(e.key){case Ct.Key.Enter:e.stopPropagation(),this._overlayRef?.hasAttached()?this.hide():this.show(e);break;case Ct.Key.Escape:this._overlayRef?.hasAttached()&&e.stopPropagation(),this.hide(),this._keypressSubscription.unsubscribe(),this._createKeyboardEvent();break;case Ct.Key.Tab:this._overlayRef?.hasAttached()&&(this.hide(),this._keypressSubscription.unsubscribe(),this._createKeyboardEvent());break}}_handleScreenReaderEnterEvent(e){e.stopPropagation();const t=document.activeElement===this._elementRef.nativeElement;if(e.isPrimary&&e.buttons===1&&t){const n=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,charCode:13,bubbles:!0,cancelable:!0});this._onHandleKeyboardEvent(n)}}_onHandleFocusEvent(e){if(e.type!=="blur")return;const t=e.relatedTarget;this._overlayRef?.overlayElement.contains(t)||(this.hide(),this._keypressSubscription.unsubscribe()),this._createKeyboardEvent()}_getPreferredPositions(){return[{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass},{originX:"end",originY:"bottom",overlayX:"center",overlayY:"top",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass},{originX:"center",originY:"center",overlayX:"end",overlayY:"top",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass}]}_prepareTooltipConfigFromOverlayConfig(e){const t=e.tooltipConfig;return this._tooltipConfig.tooltipConfig&&e.panelClass&&(t.cssClasses=e.panelClass),t}_createOverlay(){if(!this._tooltipConfig)return;const e=this._tooltipConfig?.preferredPositions??this._getPreferredPositions(),t=this._overlayPositionBuilder.flexibleConnectedTo(this._elementRef).withPositions(e),n={scrollStrategy:this._overlay.scrollStrategies.close(),positionStrategy:t};this._tooltipConfig?.width&&Object.assign(n,{width:this._tooltipConfig?.width}),this._tooltipConfig?.height&&Object.assign(n,{height:this._tooltipConfig?.height}),this._overlayRef=this._overlay.create(n),this._tooltipConfig.closeOnOutsideClick&&this._overlayRef.outsidePointerEvents().subscribe(()=>this.hide()),this._overlayRef.keydownEvents().pipe((0,u.filter)(i=>i.key===Ct.Key.Escape)).subscribe(()=>{this.hide()})}_subscribeOnClickToHide(){this._ngZone.runOutsideAngular(()=>(0,c.fromEvent)(this._elementRef.nativeElement,er.isMobile?"touchstart":"click").subscribe(e=>{e.ignoreHandle=this._overlayRef?.hasAttached(),this.hide()}))}_normalizeTooltipEvents(e){const t=Array.isArray(e.showEvent)?e.showEvent:[e.showEvent],n=Array.isArray(e.hideEvent)?e.hideEvent:[e.hideEvent];return{...e,showEvent:t,hideEvent:n}}hide(){this._overlayRef?.hasAttached()&&(this._overlayRef.detach(),this._overlayRef.dispose(),this._overlayRef=null)}show(e){if(e.ignoreHandle)return;const t=e.relatedTarget;!this._tooltipConfig||t&&!document.body.contains(t)||(e?.stopPropagation(),this._overlayRef||this._createOverlay(),this._overlayRef.hasAttached()||(this._tooltipRef=this._overlayRef.attach(new gf.ComponentPortal(this._tooltipConfig.componentType))),this._tooltipRef&&(this._tooltipRef.instance.tooltipConfig=this._prepareTooltipConfigFromOverlayConfig(this._tooltipConfig),this._tooltipRef.location.nativeElement.setAttribute("id",this.id)))}ngAfterViewInit(){const e=this._createHideEventStream(this._elementRef.nativeElement),t=this._createShowEventStream(e);this._createEventsStream(t,e),this._createKeyboardEvent(),this._subscribeOnClickToHide()}ngOnDestroy(){this.hide(),this._subscription?.unsubscribe(),this._keypressSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||Le)(r.\u0275\u0275directiveInject(As.Overlay),r.\u0275\u0275directiveInject(As.OverlayPositionBuilder),r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(r.NgZone))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:Le,selectors:[["","crtTooltip",""]],hostVars:2,hostBindings:function(t,n){t&2&&r.\u0275\u0275classMap(n._class)},inputs:{id:[0,"crtTooltipId","id"],tooltipConfig:"tooltipConfig",crtTooltip:"crtTooltip"},exportAs:["crtTooltip"]})}}(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],Le.prototype,"id",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Rs),(0,m.__metadata)("design:paramtypes",[Rs])],Le.prototype,"tooltipConfig",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object),(0,m.__metadata)("design:paramtypes",[Object])],Le.prototype,"crtTooltip",null);class Ts{constructor(){this.tooltipId=D(),this.ariaLabel="",this.type="default",this.tabIndex=0,this.icon="info-icon"}set tooltip(e){e instanceof Rs?this._tooltipConfig=e:this._tooltipConfig=this._createTooltipConfig(e)}get tooltip(){return this._tooltipConfig}get tooltipMode(){return{error:"Tooltip.Mode.Error",default:"Tooltip.Mode.Default",none:""}[this.type]||""}get iconClass(){return{error:"invalid-icon",default:"tooltip-icon",none:""}[this.type]||""}_createTooltipConfig(e){return new Rs({showEvent:["focus","mouseenter"],hideEvent:["blur","mouseleave"],componentType:Xe,tooltipConfig:{value:e},preferredPositions:[{originX:"end",originY:"center",overlayX:"start",overlayY:"center"}]})}static{this.\u0275fac=function(t){return new(t||Ts)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ts,selectors:[["crt-icon-tooltip"]],inputs:{tooltip:"tooltip",ariaLabel:"ariaLabel",type:"type",tabIndex:"tabIndex",icon:"icon"},decls:2,vars:9,consts:[["matSuffix","","crtTooltip","","role","button","aria-hidden","false",3,"crtTooltipId","tooltipConfig","ngClass","svgIcon","tabindex"]],template:function(t,n){t&1&&(r.\u0275\u0275element(0,"mat-icon",0),r.\u0275\u0275pipe(1,"translate")),t&2&&(r.\u0275\u0275property("crtTooltipId",n.tooltipId)("tooltipConfig",n.tooltip)("ngClass",n.iconClass)("svgIcon",n.icon)("tabindex",n.tabIndex),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(1,7,n.tooltipMode)+" "+n.ariaLabel)("aria-describedby",n.tooltipId))},dependencies:[w.NgClass,B.MatIcon,Le,A.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{height:20px}.mat-icon[_ngcontent-%COMP%]{width:16px;height:16px;padding:2px}.mat-icon[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}"],changeDetection:0})}}class Ps{constructor(){this.showDelay=100,this.hideDelay=100,this.infoTooltipClass="",this.icon="info-tooltip",this.tooltipPosition="above"}static{this.\u0275fac=function(t){return new(t||Ps)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ps,selectors:[["ts-info-tooltip-icon"]],inputs:{message:"message",showDelay:"showDelay",hideDelay:"hideDelay",infoTooltipClass:"infoTooltipClass",icon:"icon",tooltipPosition:"tooltipPosition"},decls:1,vars:6,consts:[[3,"svgIcon","matTooltip","matTooltipClass","matTooltipShowDelay","matTooltipHideDelay","matTooltipPosition"]],template:function(t,n){t&1&&r.\u0275\u0275element(0,"mat-icon",0),t&2&&r.\u0275\u0275property("svgIcon",n.icon)("matTooltip",n.message)("matTooltipClass",n.infoTooltipClass)("matTooltipShowDelay",n.showDelay)("matTooltipHideDelay",n.hideDelay)("matTooltipPosition",n.tooltipPosition)},dependencies:[B.MatIcon,Uo.MatTooltip],styles:["[_nghost-%COMP%]{height:22px;width:22px}mat-icon[_ngcontent-%COMP%]{color:#22ac14;width:22px;height:22px;cursor:pointer}"]})}}var Wn;(function(s){s[s.Primary=0]="Primary",s[s.Secondary=1]="Secondary",s[s.Cancel=2]="Cancel",s[s.Delete=3]="Delete"})(Wn||(Wn={}));const Cu={caption:"ConfirmationDialog.YES",result:Wn.Secondary},yf={caption:"ConfirmationDialog.NO",result:Wn.Primary},fy={caption:"ConfirmationDialog.CANCEL",result:Wn.Cancel},gy={caption:"ConfirmationDialog.DELETE",result:Wn.Delete};var se=y(23681);function bf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"button",6),r.\u0275\u0275text(1),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("mat-dialog-close",t.secondaryButton.result),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(2,2,t.secondaryButton.caption)," ")}}function Cf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"button",6),r.\u0275\u0275text(1),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275elementEnd()),s&2){const t=e.$implicit;r.\u0275\u0275property("mat-dialog-close",t.result),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(2,2,t.caption)," ")}}class Zn{constructor(e){this.data=e,this.buttons=[],e&&(this.primaryButton=e.primaryButton,this.secondaryButton=e.secondaryButton,this.message=e.message,this.buttons=e.buttons),this.buttons?.length||(this.primaryButton??=yf,this.secondaryButton??=Cu)}static{this.\u0275fac=function(t){return new(t||Zn)(r.\u0275\u0275directiveInject(se.MAT_DIALOG_DATA))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Zn,selectors:[["ts-confirmation-dialog"]],decls:9,vars:7,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngIf"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngFor","ngForOf"],["mat-button","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0)(1,"span",1),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(3,"div",2)(4,"button",3),r.\u0275\u0275text(5),r.\u0275\u0275pipe(6,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(7,bf,3,4,"button",4)(8,Cf,3,4,"button",5),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),r.\u0275\u0275advance(2),r.\u0275\u0275property("mat-dialog-close",n.primaryButton.result),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(6,5,n.primaryButton.caption)," "),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngIf",n.secondaryButton),r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",n.buttons))},dependencies:[w.NgForOf,w.NgIf,rt.MatButton,se.MatDialogClose,se.MatDialogActions,se.MatDialogContent,A.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{margin:27px 0 0!important;justify-content:flex-end}"]})}}class Kn{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||Kn)(r.\u0275\u0275directiveInject(se.MAT_DIALOG_DATA))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Kn,selectors:[["ts-error-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","warn","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0)(1,"span",1),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(3,"div",2)(4,"button",3),r.\u0275\u0275text(5),r.\u0275\u0275pipe(6,"translate"),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[rt.MatButton,se.MatDialogClose,se.MatDialogActions,se.MatDialogContent,A.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class Jn{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||Jn)(r.\u0275\u0275directiveInject(se.MAT_DIALOG_DATA))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Jn,selectors:[["ts-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0)(1,"span",1),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(3,"div",2)(4,"button",3),r.\u0275\u0275text(5),r.\u0275\u0275pipe(6,"translate"),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[rt.MatButton,se.MatDialogClose,se.MatDialogActions,se.MatDialogContent,A.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class Jt{constructor(e,t,n,i){this.document=e,this._ngZone=t,this._translateService=n,this.dialog=i}_stopEventPropagation(e,t){e.afterOpened().pipe((0,u.takeUntil)(t)).subscribe(n=>{const a=this.document.getElementsByClassName("cdk-overlay-container")[0];a&&a.addEventListener("click",function(o){o.stopImmediatePropagation()})})}getMessageDialogConfig(e){const t={width:"450px",panelClass:["dialog-top-border"],data:{}};if(typeof e=="string")return t.data.message=e,t;e.panelClass?.length>0&&t.panelClass.push(...e.panelClass);const n=e;return n.primaryButton&&(t.data.primaryButton=n.primaryButton),n.secondaryButton&&(t.data.secondaryButton=n.secondaryButton),n.buttons&&(t.data.buttons=n.buttons),t.data.message=n.message,t}open(e,t){return this._ngZone.run(()=>{const n=this.dialog.open(e,t),i=n.afterClosed();return this._stopEventPropagation(n,i),i})}openInfoDialog(e){return this.open(Jn,this.getMessageDialogConfig(e))}openErrorDialog(e){return this.open(Kn,this.getMessageDialogConfig(e))}openConfirmationDialog(e){return this.open(Zn,this.getMessageDialogConfig(e))}openOperationPermissionsErrorDialog(e){const t=rr.String.format(this._translateService.instant("OperationPermissionsErrorDialog.ErrorTemplate"),e);return this.openInfoDialog(t)}closeById(e){this.dialog.getDialogById(e)?.close()}closeAll(){this.dialog.closeAll()}hasOpenDialogs(){return!!this.dialog.openDialogs?.length}getOpenDialogs(){return this.dialog.openDialogs}static{this.\u0275fac=function(t){return new(t||Jt)(r.\u0275\u0275inject(w.DOCUMENT),r.\u0275\u0275inject(r.NgZone),r.\u0275\u0275inject(A.TranslateService),r.\u0275\u0275inject(se.MatDialog))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Jt,factory:Jt.\u0275fac})}}function Sf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"span"),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(t.translate("OperationsPoint"))}}function vf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"li"),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),s&2){const t=e.$implicit;r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(t)}}function Mf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"ol"),r.\u0275\u0275template(1,vf,2,1,"li",3),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",t.data==null?null:t.data.byOperations)}}function wf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"span"),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(t.translate("RecordsPoint"))}}function If(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"li"),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),s&2){const t=e.$implicit;r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(t)}}function Ef(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"ol"),r.\u0275\u0275template(1,If,2,1,"li",3),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",t.data==null?null:t.data.byRecords)}}class ea extends Xe{set tooltipConfig(e){this.data=e.value}constructor(e,t,n,i,a){super(e,t),this.directionality=e,this._translateService=n,this._dialogService=i,this._environment=a,this._translatePrefix="ObjectPermissions."}translate(e){return this._translateService.instant(this._translatePrefix+e)}getUrl(){return this._url||(this._url=this._environment.workspaceBaseUrl+"ClientApp/#/AdministratedObjects"),this._url}updateObjectPermissions(){this._dialogService.openConfirmationDialog(this.translate("UpdateObjectPermissionsMessage")).pipe((0,c.map)(e=>{e===Cu.result&&this.data.setObjectPermissionsFn(this.data.targetId).subscribe()})).subscribe()}static{this.\u0275fac=function(t){return new(t||ea)(r.\u0275\u0275directiveInject(Ae.Directionality),r.\u0275\u0275directiveInject(ne.DomSanitizer),r.\u0275\u0275directiveInject(A.TranslateService),r.\u0275\u0275directiveInject(Jt),r.\u0275\u0275directiveInject("environment"))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:ea,selectors:[["crt-object-permissions-warning"]],features:[r.\u0275\u0275InheritDefinitionFeature],decls:17,vars:14,consts:[[4,"ngIf"],["target","_blank",3,"href"],["target","_blank",1,"update-permissions-link",3,"click"],[4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div")(1,"span"),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(3,Sf,2,1,"span",0)(4,Mf,2,1,"ol",0)(5,wf,2,1,"span",0)(6,Ef,2,1,"ol",0),r.\u0275\u0275elementStart(7,"span"),r.\u0275\u0275text(8),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(9,"a",1),r.\u0275\u0275text(10),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(11,"span"),r.\u0275\u0275text(12),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(13,"a",2),r.\u0275\u0275listener("click",function(){return n.updateObjectPermissions()}),r.\u0275\u0275text(14),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(15,"p"),r.\u0275\u0275text(16),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275classMapInterpolate1("component-container ",n.cssClasses,""),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.translate("Warning")),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",(n.data==null||n.data.byOperations==null?null:n.data.byOperations.length)>0),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",(n.data==null||n.data.byOperations==null?null:n.data.byOperations.length)>0),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",(n.data==null||n.data.byRecords==null?null:n.data.byRecords.length)>0),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",(n.data==null||n.data.byRecords==null?null:n.data.byRecords.length)>0),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.translate("SetProperPermissionsBegin")),r.\u0275\u0275advance(),r.\u0275\u0275propertyInterpolate("href",n.getUrl(),r.\u0275\u0275sanitizeUrl),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(n.translate("ObjectPermissions")),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.translate("SetProperPermissionsEnd")),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.translate("Link")),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate(n.translate("End")))},dependencies:[w.NgForOf,w.NgIf],styles:[".component-container[_ngcontent-%COMP%]{min-width:450px;max-width:450px;border-bottom:0px!important}.component-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.component-container[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:4px;padding-inline-start:20px}.component-container[_ngcontent-%COMP%]   a.update-permissions-link[_ngcontent-%COMP%]{display:block;line-height:40px}"]})}}function Af(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"div"),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),s&2){const t=e.$implicit,n=r.\u0275\u0275nextContext();r.\u0275\u0275classMapInterpolate1("rule ",n.getValidationClass(t.valid),""),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",t.caption," ")}}class Ns extends Xe{set tooltipConfig(e){this.validationTooltipConfig=e.value}constructor(e,t){super(e,t),this.directionality=e}getValidationClass(e){return e?"valid":typeof e=="boolean"?"invalid":"not-validated"}setInnerHTML(){}static{this.\u0275fac=function(t){return new(t||Ns)(r.\u0275\u0275directiveInject(Ae.Directionality),r.\u0275\u0275directiveInject(ne.DomSanitizer))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ns,selectors:[["crt-validation-result-tooltip"]],features:[r.\u0275\u0275InheritDefinitionFeature],decls:5,vars:5,consts:[[1,"header"],[1,"rules"],[3,"class",4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div")(1,"div",0),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"div",1),r.\u0275\u0275template(4,Af,2,4,"div",2),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275classMapInterpolate1("component-container ",n.cssClasses,""),r.\u0275\u0275advance(2),r.\u0275\u0275textInterpolate1("",n.validationTooltipConfig==null?null:n.validationTooltipConfig.header,":"),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngForOf",n.validationTooltipConfig==null?null:n.validationTooltipConfig.validations))},dependencies:[w.NgForOf],styles:[".component-container[_ngcontent-%COMP%]{max-width:400px;display:flex;flex-direction:column;padding:16px;border-width:1px;border-style:solid}.component-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{text-align:left;font-weight:700;padding-bottom:6px}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule[_ngcontent-%COMP%]{width:50%;position:relative;left:24px;text-indent:-24px;padding-right:30px;box-sizing:border-box;margin-bottom:9px}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule[_ngcontent-%COMP%]:before{padding-right:8px;top:3px;position:relative}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.valid[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTUiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2M4MjIzIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3OSIgZGF0YS1uYW1lPSJQYXRoIDExODc5IiBkPSJNMTcuMDkzLDI4LjE4bDIuNSwzLDQuNS01IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NzMuNDA3IDU1MS4zMikiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNjODIyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPC9nPgo8L3N2Zz4K)}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.invalid[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTQiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzIzZjIzIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3NyIgZGF0YS1uYW1lPSJQYXRoIDExODc3IiBkPSJNMTQyOCw0ODF2NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE3My41MDkgLTc3MS45ODgpIHJvdGF0ZSg0NSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2MyM2YyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3OCIgZGF0YS1uYW1lPSJQYXRoIDExODc4IiBkPSJNMTQyOCw0ODF2NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTg0NS45ODggLTg3LjUwOSkgcm90YXRlKDEzNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2MyM2YyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPC9nPgo8L3N2Zz4K)}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.not-validated[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTMiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNzU3NTc1IiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K)}"]})}}class Ds{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||Ds)(r.\u0275\u0275directiveInject(se.MAT_DIALOG_DATA))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ds,selectors:[["ts-info-with-header-dialog"]],decls:9,vars:10,consts:[[1,"header-message"],[1,"message"],[1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275text(1),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(3,"div",1),r.\u0275\u0275text(4),r.\u0275\u0275pipe(5,"translate"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(6,"button",2),r.\u0275\u0275text(7),r.\u0275\u0275pipe(8,"translate"),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(2,4,n.data==null?null:n.data.headerMessage)),r.\u0275\u0275advance(3),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(5,6,n.data==null?null:n.data.message)),r.\u0275\u0275advance(2),r.\u0275\u0275property("mat-dialog-close",n.data==null||n.data.button==null?null:n.data.button.result),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",r.\u0275\u0275pipeBind1(8,8,n.data==null||n.data.button==null?null:n.data.button.caption),`
`))},dependencies:[se.MatDialogClose,A.TranslatePipe],styles:[".header-message[_ngcontent-%COMP%]{margin-bottom:24px}.message[_ngcontent-%COMP%]{margin-bottom:40px;white-space:pre-wrap}.action-button[_ngcontent-%COMP%]{float:right;text-transform:none;border-radius:16px;padding:0 16px}"]})}}class Yn{static{this.\u0275fac=function(t){return new(t||Yn)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Yn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[Jt,{provide:tr.FocusTrapFactory,useClass:tr.ConfigurableFocusTrapFactory}],imports:[w.CommonModule,rt.MatButtonModule,se.MatDialogModule,A.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(Yn,{declarations:[Zn,Kn,Jn,Ds],imports:[w.CommonModule,rt.MatButtonModule,se.MatDialogModule,A.TranslateModule],exports:[Zn,Jn,Ds,Kn]})})();class Xn{constructor(e){this._materialIconsRegistrator=e,this._materialIconsRegistrator.addIcons([{name:"tooltip-icon",icon:y(92825)}])}static{this.\u0275fac=function(t){return new(t||Xn)(r.\u0275\u0275inject(At))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Xn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[w.CommonModule,B.MatIconModule,Uo.MatTooltipModule,A.TranslateModule,Yn]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(Xn,{declarations:[Ps,Xe,Le,Ns,ea,Ts],imports:[w.CommonModule,B.MatIconModule,Uo.MatTooltipModule,A.TranslateModule,Yn],exports:[Ps,Xe,Le,Ns,Ts]})})();class St{constructor(e){this._elementRef=e,this._debounceTime=300}_setTitleAttribute(){const e="title",t=this._elementRef.nativeElement;if(this._isElementOverflowed(t)){const n=t.value||t.innerText||"";t.setAttribute(e,n)}else t.removeAttribute(e)}_isElementOverflowed(e){return e.offsetWidth<e.scrollWidth||e.offsetHeight<e.scrollHeight}onMouseEnter(){(0,v.debounce)(()=>this._setTitleAttribute(),this._debounceTime,{leading:!0,trailing:!1})()}static{this.\u0275fac=function(t){return new(t||St)(r.\u0275\u0275directiveInject(r.ElementRef))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:St,selectors:[["","crtTextOverflowTitle",""]],hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("mouseenter",function(){return n.onMouseEnter()})}})}}class Qn{static{this.\u0275fac=function(t){return new(t||Qn)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Qn})}static{this.\u0275inj=r.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(Qn,{declarations:[St],exports:[St]})})();function xf(s){return _u(s,"mobile")}class Vs{constructor(e){this.translateService=e}_getTranslations(e){const t=this.translateService.translations[e];return t?(0,c.of)({translation:t,cultureName:e}):this.translateService.currentLoader.getTranslation(e).pipe((0,u.map)(n=>({translation:n,cultureName:e})))}getAllCultureValues(e,t){return(0,c.forkJoin)(e.map(n=>this._getTranslations(n))).pipe((0,u.map)(n=>{const i=new gn;for(const{translation:a,cultureName:o}of n){const l=(0,v.get)(a,t);i.setValueLocalizableString(o,l)}return i}))}isTranslateKey(e){return/^\S+\.\S+$/.test(e)}static{this.\u0275fac=function(t){return new(t||Vs)(r.\u0275\u0275inject(A.TranslateService))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Vs,factory:Vs.\u0275fac})}}class me extends Se{constructor(){super(...arguments),this._translateService=(0,r.inject)(A.TranslateService),this._translateUtilsService=(0,r.inject)(Vs,{optional:!0}),this.clicked=new r.EventEmitter}get caption(){return this._caption}set caption(e){this._translateUtilsService?.isTranslateKey(e)?(this._caption=this._translateService.instant(e),console.warn(`You should pass already translated value to menu item. Please fix it for '${e}'.`)):this._caption=e}set iconColor(e){["primary","accent","warn","default"].includes(e)?(this.colorPalette=e,this.customColor=void 0):(this.colorPalette=void 0,this.customColor=e)}get ariaDisabled(){return this.disabled?"true":"false"}handleItemClick(e){this.disabled||this.clicked.next(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(me)))(n||me)}})()}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:me,hostVars:1,hostBindings:function(t,n){t&2&&r.\u0275\u0275attribute("aria-disabled",n.ariaDisabled)},inputs:{caption:"caption",icon:"icon",iconColor:"iconColor",visible:"visible",disabled:"disabled",items:"items",handleItemClick:"handleItemClick"},outputs:{clicked:"clicked"},features:[r.\u0275\u0275InheritDefinitionFeature]})}}(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],me.prototype,"caption",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],me.prototype,"icon",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],me.prototype,"iconColor",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],me.prototype,"visible",void 0),(0,m.__decorate)([I({propertyBindable:!0,defaultValue:!1,propertyName:Tn.Disabled}),(0,m.__metadata)("design:type",Boolean)],me.prototype,"disabled",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Array)],me.prototype,"items",void 0),(0,m.__decorate)([Qr(),(0,m.__metadata)("design:type",Object)],me.prototype,"clicked",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Function),(0,m.__metadata)("design:paramtypes",[Event]),(0,m.__metadata)("design:returntype",void 0)],me.prototype,"handleItemClick",null);function Rf(s,e){if(s&1&&r.\u0275\u0275element(0,"mat-icon",3),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275styleProp("color",t.disabled?null:t.customColor),r.\u0275\u0275property("svgIcon",t.icon)("color",t.colorPalette)}}function Tf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"span",4),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",t.caption," ")}}let Yt=class oa extends me{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(oa)))(n||oa)}})()}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:oa,selectors:[["crt-menu-item"]],features:[r.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[["mat-flat-button","",1,"crt-menu-item",3,"click","disabled"],[3,"svgIcon","color",4,"ngIf"],["class","caption","crtTextOverflowTitle","",4,"ngIf"],[3,"svgIcon","color"],["crtTextOverflowTitle","",1,"caption"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"button",0),r.\u0275\u0275listener("click",function(a){return n.handleItemClick(a)}),r.\u0275\u0275template(1,Rf,1,4,"mat-icon",1)(2,Tf,2,1,"span",2),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275property("disabled",n.disabled),r.\u0275\u0275attribute("data-item-marker",n.caption||n.icon),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.icon),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.caption))},dependencies:[w.NgIf,B.MatIcon,St],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center}.crt-menu-item[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;border:none;background:none;outline:none;cursor:pointer;padding:8px 16px 8px 40px;position:relative;height:40px}.crt-menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{min-width:16px;width:16px;min-height:16px;height:16px;margin-right:0;position:absolute;left:16px}.crt-menu-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}"]})}};Yt=(0,m.__decorate)([ws({type:"crt.MenuItem",reuseStrategy:yt.Reuse}),yu({propertiesPanelComponentTypeName:"crt.MenuItemPropertiesPanel",typeCaption:"TypeCaptions.MenuItem",viewElementGroupType:Is.Components})],Yt);var zo;const Pf=["nestedMenuViewElement"],Os=s=>({$implicit:s});function Nf(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",18),r.\u0275\u0275listener("keydown",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(2).$implicit,o=r.\u0275\u0275nextContext().$implicit,l=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(l.onMenuActionItemKeydown(i,a,o))}),r.\u0275\u0275elementStart(2,"crt-menu-action-item",19),r.\u0275\u0275listener("itemSelected",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2).$implicit,a=r.\u0275\u0275nextContext().$implicit,o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onItemSelected({code:i.code,data:a}))}),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementContainerEnd()}if(s&2){const t=r.\u0275\u0275nextContext(2).$implicit,n=r.\u0275\u0275nextContext().$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("crtMenuItem",t)("disableRipple",!0),r.\u0275\u0275advance(),r.\u0275\u0275property("item",t)("data",n)}}function Df(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275element(1,"crt-menu-divider-item",20),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext(2).$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("crtMenuItem",t)}}function Vf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275element(1,"crt-menu-label-item",21),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext(2).$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("crtMenuItem",t)("item",t)}}function Of(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",23,2),r.\u0275\u0275listener("keydown",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275reference(2),o=r.\u0275\u0275nextContext(3).$implicit,l=r.\u0275\u0275nextContext().$implicit,d=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(d.onMenuActionItemKeydown(i,o,l,a))}),r.\u0275\u0275elementStart(3,"crt-menu-action-item",19),r.\u0275\u0275listener("itemSelected",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(3).$implicit,a=r.\u0275\u0275nextContext().$implicit,o=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(o.onItemSelected({code:i.code,data:a}))}),r.\u0275\u0275elementEnd()(),r.\u0275\u0275elementStart(4,"crt-menu",24,3),r.\u0275\u0275listener("itemSelected",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(5);return r.\u0275\u0275resetView(a.onItemSelected(i))}),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}if(s&2){const t=r.\u0275\u0275reference(5),n=r.\u0275\u0275nextContext(3).$implicit,i=r.\u0275\u0275nextContext().$implicit,a=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("disableRipple",!0)("crtMenuItem",n)("crtMenuTriggerFor",t)("crtMenuTriggerData",r.\u0275\u0275pureFunction1(9,Os,i))("crtMenuTriggerDisabled",n.disabled),r.\u0275\u0275advance(2),r.\u0275\u0275property("item",n)("data",i),r.\u0275\u0275advance(),r.\u0275\u0275property("menuItems",n.items)("panelClass",a.nestedMenuClasses)}}function Bf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,Of,6,11,"ng-container",22),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext(2).$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.items&&t.items.length>0)}}function kf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0,16),r.\u0275\u0275template(1,Nf,3,4,"ng-container",17)(2,Df,2,1,"ng-container",17)(3,Vf,2,2,"ng-container",17)(4,Bf,2,1,"ng-container",17),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext().$implicit;r.\u0275\u0275property("ngSwitch",t.type),r.\u0275\u0275advance(),r.\u0275\u0275property("ngSwitchCase","action"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngSwitchCase","divider"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngSwitchCase","label"),r.\u0275\u0275advance(),r.\u0275\u0275property("ngSwitchCase","menu")}}function Lf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,kf,5,5,"ng-container",15),r.\u0275\u0275elementContainerEnd()),s&2){const t=e.$implicit,n=r.\u0275\u0275nextContext().$implicit,i=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",i.isItemVisible(t,n))}}function Ff(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function jf(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",26),r.\u0275\u0275listener("keydown",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(2).$implicit,o=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(o.onMenuItemKeydown(i,a))}),r.\u0275\u0275template(2,Ff,1,0,"ng-container",27),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}if(s&2){const t=r.\u0275\u0275nextContext(2).$implicit;r.\u0275\u0275nextContext(2);const n=r.\u0275\u0275reference(5);r.\u0275\u0275advance(),r.\u0275\u0275property("disableRipple",!0)("crtMenuViewElementItem",t),r.\u0275\u0275attribute("aria-current",t.selected),r.\u0275\u0275advance(),r.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",r.\u0275\u0275pureFunction1(5,Os,t))}}function $f(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function Uf(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",29,8),r.\u0275\u0275listener("keydown",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275reference(2),o=r.\u0275\u0275nextContext(4).$implicit,l=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(l.onMenuItemKeydown(i,o,a))}),r.\u0275\u0275template(4,$f,1,0,"ng-container",27),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementContainerEnd()}if(s&2){const t=e.ngIf,n=r.\u0275\u0275reference(3),i=r.\u0275\u0275nextContext(4).$implicit;r.\u0275\u0275nextContext(2);const a=r.\u0275\u0275reference(5);r.\u0275\u0275advance(),r.\u0275\u0275property("disableRipple",!0)("crtMenuTriggerFor",t)("crtMenuViewElementItem",i)("crtMenuTriggerDisabled",n.getDisabledState()),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngTemplateOutlet",a)("ngTemplateOutletContext",r.\u0275\u0275pureFunction1(6,Os,i))}}function zf(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function Hf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"div",30),r.\u0275\u0275template(1,zf,1,0,"ng-container",27),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext(4).$implicit;r.\u0275\u0275nextContext(2);const n=r.\u0275\u0275reference(5);r.\u0275\u0275property("disableRipple",!0)("crtMenuViewElementItem",t),r.\u0275\u0275advance(),r.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",r.\u0275\u0275pureFunction1(4,Os,t))}}function Gf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,Uf,5,8,"ng-container",25)(2,Hf,2,6,"ng-template",null,6,r.\u0275\u0275templateRefExtractor),r.\u0275\u0275elementContainer(4,28,7),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275reference(3),n=r.\u0275\u0275nextContext(3).$implicit,i=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",i.getNestedMenuComponentByConfig(n))("ngIfElse",t),r.\u0275\u0275advance(3),r.\u0275\u0275property("crtViewElement",i.getNestedMenuConfig(n))}}function qf(s,e){if(s&1&&r.\u0275\u0275template(0,Gf,6,3,"ng-container",25),s&2){r.\u0275\u0275nextContext();const t=r.\u0275\u0275reference(5),n=r.\u0275\u0275nextContext().$implicit;r.\u0275\u0275property("ngIf",(n==null||n.items==null?null:n.items.length)>0)("ngIfElse",t)}}function Wf(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function Zf(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"div",31),r.\u0275\u0275template(1,Wf,1,0,"ng-container",27),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext(2).$implicit;r.\u0275\u0275nextContext(2);const n=r.\u0275\u0275reference(5);r.\u0275\u0275property("crtMenuViewElementItem",t),r.\u0275\u0275advance(),r.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",r.\u0275\u0275pureFunction1(3,Os,t))}}function Kf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,jf,3,7,"ng-container",25)(2,qf,1,2,"ng-template",null,4,r.\u0275\u0275templateRefExtractor)(4,Zf,2,5,"ng-template",null,5,r.\u0275\u0275templateRefExtractor),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275reference(3),n=r.\u0275\u0275nextContext().$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.type==="crt.MenuItem"&&!(n.items!=null&&n.items.length))("ngIfElse",t)}}function Jf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,Kf,6,2,"ng-container",22),r.\u0275\u0275elementContainerEnd()),s&2){const t=e.$implicit,n=r.\u0275\u0275nextContext().$implicit,i=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",i.isItemVisible(t,n))}}function Yf(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,Lf,2,1,"ng-container",13)(2,Jf,2,1,"ng-container",14),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",t.menuItems)("ngForTrackBy",t.trackByIndex),r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",t.items)}}function Xf(s,e){if(s&1&&r.\u0275\u0275elementContainer(0,33),s&2){const t=r.\u0275\u0275nextContext().$implicit,n=r.\u0275\u0275nextContext();r.\u0275\u0275property("crtViewElement",t)("crtViewModel",n.context)}}function Qf(s,e){if(s&1&&r.\u0275\u0275elementContainer(0,28),s&2){const t=r.\u0275\u0275nextContext().$implicit;r.\u0275\u0275property("crtViewElement",t)}}function eg(s,e){if(s&1&&r.\u0275\u0275template(0,Xf,1,2,"ng-container",32)(1,Qf,1,1,"ng-template",null,9,r.\u0275\u0275templateRefExtractor),s&2){const t=r.\u0275\u0275reference(2),n=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",n.context)("ngIfElse",t)}}const Su="nested-menu",tg="crt-menu-glassmorphism";let re=class Wo{static{zo=this}set menuItems(e){const t=this._menuItems.length===0&&e?.length>0;this._menuItems=Array.isArray(e)?e:[],this._updateNestedMenuConfigs(),t&&this.menu.focusFirstItem(this._focusOrigin)}get menuItems(){return this._menuItems}set items(e){const t=this._adjustItems(e);if(this._items===t)return;const n=this._items.length===0&&t?.length>0;this._items=t,this._updateNestedMenuConfigs(),n&&this.menu.focusFirstItem(this._focusOrigin)}get items(){return this._items}set panelClass(e){this._panelClass!==e&&(this._panelClass=e,this._preparePanelClasses(),this._updateNestedMenuConfigs())}set useGlassmorphism(e){this._useGlassmorphism!==e&&(this._useGlassmorphism=e,this._preparePanelClasses(),this._updateNestedMenuConfigs())}set nestedMenuViewElements(e){this._nestedMenuViewElements=e,e?.length&&(this._teardownNestedMenuSubscriptions(),this._subscribeToNestedMenuComponents())}get wrapClasses(){return this._wrapClasses}get nestedMenuClasses(){return this.wrapClasses?`${this.wrapClasses} ${Su}`:Su}constructor(e,t){this._overlayContainer=e,this._renderer=t,this._destroyRef=(0,r.inject)(r.DestroyRef),this._useGlassmorphism=!1,this._menuItems=[],this._items=[],this._nestedMenuConfigs=[],this._nestedMenuConfigsMap=new Map,this._nestedMenuComponentsMap=new Map,this._nestedMenuSubscriptions=new Map,this.xPosition="after",this.yPosition="below",this.stopOverlayClickPropagation=!1,this.itemSelected=new r.EventEmitter}_preparePanelClasses(){const e=" ",t=this._panelClass?.split(e)||[];this._useGlassmorphism&&t.push(tg),this._wrapClasses=t.join(e)}_adjustItems(e){return(e??[]).map(t=>({...t,name:t?.name||D()}))}_updateNestedMenuConfigs(){const t=this._items.filter(n=>n.items?.length>0).map(n=>({id:this._getNestedMenuId(n),name:n.name,type:"crt.Menu",items:n.items,panelClass:this._panelClass,useGlassmorphism:this._useGlassmorphism,visible:!0}));(0,v.isEqual)(this._nestedMenuConfigs,t)||this._rebuildNestedMenuConfigs(t)}_rebuildNestedMenuConfigs(e){this._teardownNestedMenuSubscriptions(),this._nestedMenuConfigs=e,this._nestedMenuConfigsMap.clear(),e.forEach(t=>this._nestedMenuConfigsMap.set(t.id,t))}_getNestedMenuId(e){return`nested-menu-${e.name}`}_teardownNestedMenuSubscriptions(){this._nestedMenuComponentsMap.clear(),this._nestedMenuSubscriptions.forEach(e=>e.unsubscribe()),this._nestedMenuSubscriptions.clear()}_registerNestedMenuComponent(e,t){this._nestedMenuComponentsMap.set(e,t)}_handleItemClick(e,t){const n=this._getCrtMenuItemComponent(t);n instanceof Yt&&n.handleItemClick(e)}_isActionButtonPressed(e){return e.code===Ct.Key.Enter||e.code==="Space"}_getCrtMenuItemComponent(e){return this.crtMenuItemComponents?.find(n=>n?.componentRef?.getPropertyValue("name")===e?.name)?.componentRef?.instance}_subscribeToNestedMenuComponents(){this._nestedMenuViewElements.map(e=>{const t=e.viewElementConfig,n=this._getNestedMenuId(t);return{directive:e,id:n}}).filter(({directive:e,id:t})=>e&&t).map(({directive:e,id:t})=>{const n=e.componentRef$.pipe((0,c.filter)(i=>i?.instance instanceof zo),(0,_s.takeUntilDestroyed)(this._destroyRef)).subscribe(i=>{this._setupNestedMenuComponent(t,i.instance)});return{id:t,subscription:n}}).forEach(({id:e,subscription:t})=>{this._nestedMenuSubscriptions.set(e,t)})}_setupNestedMenuComponent(e,t){this._registerNestedMenuComponent(e,t),t.panelClass=this.nestedMenuClasses,t.useGlassmorphism=this._useGlassmorphism,t.itemSelected.pipe((0,_s.takeUntilDestroyed)(this._destroyRef)).subscribe(n=>{this.onItemSelected(n)})}ngOnInit(){this.stopOverlayClickPropagation&&this._overlayContainer&&(this._overlayClickUnlisten=this._renderer.listen(this._overlayContainer.getContainerElement(),"click",e=>{e.stopPropagation()}))}ngOnDestroy(){this._teardownNestedMenuSubscriptions(),this._overlayClickUnlisten?.()}getNestedMenuConfig(e){const t=this._getNestedMenuId(e);return this._nestedMenuConfigsMap.get(t)}getNestedMenuComponentByConfig(e){const t=this._getNestedMenuId(e);return this._nestedMenuComponentsMap.get(t)}isItemVisible(e,t){const{visible:n}=e;if(typeof n=="boolean")return n;if(typeof n=="function")return n(t);if(typeof n=="string"&&t instanceof Be){const i=n.split(".")[1];return t.attributes[i]}return!0}isItemDisabled(e){const t=this._getCrtMenuItemComponent(e);return t instanceof Yt&&t?.disabled||!1}onItemSelected(e){this.itemSelected.emit(e)}trackByIndex(e){return e}onMenuItemKeydown(e,t,n){!this._isActionButtonPressed(e)||this.isItemDisabled(t)||(n&&n?.openMenu(),(t?.clicked||t?.handleItemClick)&&(this._handleItemClick(e,t),this.menu.closed.emit("click")))}onMenuActionItemKeydown(e,t,n,i){!this._isActionButtonPressed(e)||t.disabled||(i&&i?.openMenu(),t?.handler&&(t.handler(n,e),this.menu.closed.emit("click")),this.onItemSelected({code:t.code,data:n}))}setFocusOrigin(e){this._focusOrigin=e}static{this.\u0275fac=function(t){return new(t||Wo)(r.\u0275\u0275directiveInject(As.OverlayContainer,8),r.\u0275\u0275directiveInject(r.Renderer2))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Wo,selectors:[["crt-menu"]],viewQuery:function(t,n){if(t&1&&(r.\u0275\u0275viewQuery(_e.MatMenu,7),r.\u0275\u0275viewQuery(he,5),r.\u0275\u0275viewQuery(Pf,5,he)),t&2){let i;r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.menu=i.first),r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.crtMenuItemComponents=i),r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.nestedMenuViewElements=i)}},inputs:{menuItems:"menuItems",items:"items",context:"context",xPosition:"xPosition",yPosition:"yPosition",stopOverlayClickPropagation:"stopOverlayClickPropagation",panelClass:"panelClass",useGlassmorphism:"useGlassmorphism"},outputs:{itemSelected:"itemSelected"},decls:6,vars:5,consts:[["menu","matMenu"],["menuItem",""],["crtMenuTrigger","crtMenuTrigger"],["nestedMenu",""],["menu",""],["other",""],["menuItemOnly",""],["nestedMenuViewElement",""],["crtMenuTrigger","crtMenuTrigger","menuViewElementItem","crtMenuViewElementItem"],["withoutContext",""],[3,"xPosition","yPosition","overlapTrigger"],[1,"menu-items-container"],[4,"matMenuContent"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf"],[3,"ngSwitch",4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","crtMenuItem","disableRipple"],[3,"itemSelected","item","data"],[3,"crtMenuItem"],[3,"crtMenuItem","item"],[4,"ngIf"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","disableRipple","crtMenuItem","crtMenuTriggerFor","crtMenuTriggerData","crtMenuTriggerDisabled"],[3,"itemSelected","menuItems","panelClass"],[4,"ngIf","ngIfElse"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","disableRipple","crtMenuViewElementItem"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"crtViewElement"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","disableRipple","crtMenuTriggerFor","crtMenuViewElementItem","crtMenuTriggerDisabled"],["mat-menu-item","",1,"crt-menu-item-container",3,"disableRipple","crtMenuViewElementItem"],[3,"crtMenuViewElementItem"],[3,"crtViewElement","crtViewModel",4,"ngIf","ngIfElse"],[3,"crtViewElement","crtViewModel"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"mat-menu",10,0)(2,"div",11),r.\u0275\u0275template(3,Yf,3,3,"ng-container",12),r.\u0275\u0275elementEnd()(),r.\u0275\u0275template(4,eg,3,2,"ng-template",null,1,r.\u0275\u0275templateRefExtractor)),t&2&&(r.\u0275\u0275classMap("crt-menu "+n.wrapClasses||0),r.\u0275\u0275property("xPosition",n.xPosition)("yPosition",n.yPosition)("overlapTrigger",!1))},styles:[".menu-items-container[_ngcontent-%COMP%]   .mat-mdc-menu-item[_ngcontent-%COMP%]{padding:0;min-height:40px}.menu-items-container[_ngcontent-%COMP%]   .crt-menu-item-container[aria-disabled=true][_ngcontent-%COMP%]{pointer-events:none}"]})}};(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Array),(0,m.__metadata)("design:paramtypes",[Array])],re.prototype,"menuItems",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Array),(0,m.__metadata)("design:paramtypes",[Array])],re.prototype,"items",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Be)],re.prototype,"context",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],re.prototype,"xPosition",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],re.prototype,"yPosition",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],re.prototype,"stopOverlayClickPropagation",void 0),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String),(0,m.__metadata)("design:paramtypes",[String])],re.prototype,"panelClass",null),(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Boolean),(0,m.__metadata)("design:paramtypes",[Boolean])],re.prototype,"useGlassmorphism",null),re=zo=(0,m.__decorate)([xf({type:"crt.Menu"}),ws({type:"crt.Menu",reuseStrategy:yt.Reuse}),(0,m.__metadata)("design:paramtypes",[As.OverlayContainer,r.Renderer2])],re);let Bs=class Zo{static{this.\u0275fac=function(t){return new(t||Zo)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Zo,selectors:[["crt-menu-divider"]],decls:1,vars:0,template:function(t,n){t&1&&r.\u0275\u0275element(0,"mat-divider")},dependencies:[It.MatDivider],styles:["mat-divider[_ngcontent-%COMP%]{margin:8px 0}"]})}};Bs=(0,m.__decorate)([ws({type:"crt.MenuDivider",reuseStrategy:yt.Reuse})],Bs);let Xt=class Ko{static{this.\u0275fac=function(t){return new(t||Ko)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ko,selectors:[["crt-menu-label"]],inputs:{caption:"caption"},decls:2,vars:2,consts:[["crtTextOverflowTitle","",1,"crt-menu-label",3,"title"]],template:function(t,n){if(t&1&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),t&2){let i;r.\u0275\u0275property("title",(i=n.caption)!==null&&i!==void 0?i:""),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",n.caption,`
`)}},dependencies:[St],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.crt-menu-label[_ngcontent-%COMP%]{font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased;color:var(--crt-palette-label-500);padding:8px 24px 4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}"]})}};(0,m.__decorate)([I(),(0,m.__metadata)("design:type",String)],Xt.prototype,"caption",void 0),Xt=(0,m.__decorate)([ws({type:"crt.MenuLabel",reuseStrategy:yt.Reuse})],Xt);function ng(s,e){if(s&1&&r.\u0275\u0275element(0,"mat-icon",3),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("svgIcon",t.item.icon)}}function ig(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"span",4),r.\u0275\u0275text(1),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate(r.\u0275\u0275pipeBind1(2,1,t.item.caption))}}class ks{static{this.\u0275fac=function(t){return new(t||ks)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:ks,selectors:[["crt-menu-clickable-item"]],inputs:{item:"item"},decls:3,vars:4,consts:[[1,"crt-menu-clickable-item",3,"disabled"],[3,"svgIcon",4,"ngIf"],["crtTextOverflowTitle","",4,"ngIf"],[3,"svgIcon"],["crtTextOverflowTitle",""]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"button",0),r.\u0275\u0275template(1,ng,1,1,"mat-icon",1)(2,ig,3,3,"span",2),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275property("disabled",n.item==null?null:n.item.disabled),r.\u0275\u0275attribute("data-item-marker",(n.item==null?null:n.item.caption)||(n.item==null?null:n.item.icon)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.item==null?null:n.item.icon),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.item==null?null:n.item.caption))},dependencies:[w.NgIf,B.MatIcon,St,A.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center}.crt-menu-clickable-item[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;border:none;background:none;outline:none;cursor:pointer;padding:8px 16px 8px 40px;position:relative;height:40px}.crt-menu-clickable-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{min-width:16px;width:16px;min-height:16px;height:16px;margin-right:0;position:absolute;left:16px}.crt-menu-clickable-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.crt-menu-clickable-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--crt-menu-item-icon-color)}"]})}}class Ls{static{this.\u0275fac=function(t){return new(t||Ls)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ls,selectors:[["crt-menu-extra-button"]],inputs:{itemConfig:"itemConfig"},decls:2,vars:3,consts:[["crtTooltip","","type","button",1,"crt-menu-extra-button",3,"click","tooltipConfig"],[1,"crt-menu-extra-button-icon",3,"svgIcon"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"button",0),r.\u0275\u0275listener("click",function(){return n.itemConfig.handler()}),r.\u0275\u0275element(1,"mat-icon",1),r.\u0275\u0275elementEnd()),t&2&&(r.\u0275\u0275property("tooltipConfig",n.itemConfig.tooltip),r.\u0275\u0275attribute("aria-label",n.itemConfig.tooltip.tooltipConfig.value),r.\u0275\u0275advance(),r.\u0275\u0275property("svgIcon",n.itemConfig.icon))},dependencies:[B.MatIcon,Le],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{width:auto;height:100%;display:flex;align-items:center;justify-content:end}.crt-menu-extra-button[_ngcontent-%COMP%]{height:24px;width:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;background-color:transparent;border:none;border-radius:4px;transition:background-color .2s ease,transform .1s ease}.crt-menu-extra-button[_ngcontent-%COMP%]:hover{background-color:var(--crt-menu-item-background-active-color)}.crt-menu-extra-button[_ngcontent-%COMP%]:active{transform:scale(.95);background-color:var(--crt-palette-primary-100)}.crt-menu-extra-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0;height:16px;width:16px}"]})}}function sg(s,e){if(s&1&&r.\u0275\u0275element(0,"crt-menu-extra-button",2),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("itemConfig",t.item.extraButtonConfig)}}class Fs{constructor(){this.itemSelected=new r.EventEmitter}onClick(e){this.item.handler&&this.item.handler(this.data,e),this.itemSelected.emit(this.item)}static{this.\u0275fac=function(t){return new(t||Fs)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Fs,selectors:[["crt-menu-action-item"]],hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("click",function(a){return n.onClick(a)})},inputs:{item:"item",data:"data"},outputs:{itemSelected:"itemSelected"},decls:2,vars:2,consts:[[3,"item"],[3,"itemConfig",4,"ngIf"],[3,"itemConfig"]],template:function(t,n){t&1&&(r.\u0275\u0275element(0,"crt-menu-clickable-item",0),r.\u0275\u0275template(1,sg,1,1,"crt-menu-extra-button",1)),t&2&&(r.\u0275\u0275property("item",n.item),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.item==null?null:n.item.extraButtonConfig))},dependencies:[w.NgIf,ks,Ls],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]})}}class js{static{this.\u0275fac=function(t){return new(t||js)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:js,selectors:[["crt-menu-divider-item"]],decls:1,vars:0,template:function(t,n){t&1&&r.\u0275\u0275element(0,"mat-divider")},dependencies:[It.MatDivider],styles:["mat-divider[_ngcontent-%COMP%]{margin:8px 0}"]})}}class $s{static{this.\u0275fac=function(t){return new(t||$s)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:$s,selectors:[["crt-menu-label-item"]],inputs:{item:"item"},decls:1,vars:1,consts:[[3,"caption"]],template:function(t,n){t&1&&r.\u0275\u0275element(0,"crt-menu-label",0),t&2&&r.\u0275\u0275property("caption",n.item==null?null:n.item.caption)},dependencies:[Xt],encapsulation:2,changeDetection:0})}}class ei{constructor(){this.crtMenuItem=""}get _ariaDisabled(){return this.item?.disabled===!0}get itemType(){return this.item?.type}static{this.\u0275fac=function(t){return new(t||ei)}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:ei,selectors:[["","crtMenuItem",""]],hostVars:3,hostBindings:function(t,n){t&2&&r.\u0275\u0275attribute("aria-disabled",n._ariaDisabled)("crt-menu-item",n.crtMenuItem)("crt-menu-item-type",n.itemType)},inputs:{item:[0,"crtMenuItem","item"]}})}}(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],ei.prototype,"item",void 0);class ti{constructor(e,t){this._elementRef=e,this._cdr=t}get itemName(){return this.item?.name||""}get ariaDisabled(){const e=this._elementRef.nativeElement.querySelector("crt-menu-item");return e?e.getAttribute("aria-disabled"):null}getDisabledState(){const e=this.ariaDisabled;return e===null?!1:e==="true"}ngAfterViewInit(){this._cdr.detectChanges()}static{this.\u0275fac=function(t){return new(t||ti)(r.\u0275\u0275directiveInject(r.ElementRef),r.\u0275\u0275directiveInject(r.ChangeDetectorRef))}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:ti,selectors:[["","crtMenuViewElementItem",""]],hostVars:2,hostBindings:function(t,n){t&2&&r.\u0275\u0275attribute("crt-menu-view-element-item",n.itemName)("aria-disabled",n.ariaDisabled)},inputs:{item:[0,"crtMenuViewElementItem","item"]},exportAs:["crtMenuViewElementItem"]})}}(0,m.__decorate)([I(),(0,m.__metadata)("design:type",Object)],ti.prototype,"item",void 0);let Qt=class Jo{static{this.\u0275fac=function(t){return new(t||Jo)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Jo})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[_t,w.CommonModule,It.MatDividerModule,B.MatIconModule,_e.MatMenuModule,qn,ge,Qn,A.TranslateModule,Xn]})}};Qt=(0,m.__decorate)([wc({viewElements:[re,Bs,Yt,Xt]})],Qt),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(Qt,{declarations:[Fs,ks,re,js,Ls,$s,ei,ti,Ye,Bs,Yt,Xt],imports:[_t,w.CommonModule,It.MatDividerModule,B.MatIconModule,_e.MatMenuModule,qn,ge,Qn,A.TranslateModule,Xn],exports:[re,Ye,Bs,Yt,Xt]})}(),r.\u0275\u0275setComponentScope(re,[Kt,he,w.NgForOf,w.NgIf,w.NgTemplateOutlet,w.NgSwitch,w.NgSwitchCase,_e.MatMenu,_e.MatMenuItem,_e.MatMenuContent,Fs,re,js,$s,ei,ti,Ye],[]);let en=class Yo{constructor(e){this._materialIconsRegistrator=e,this._materialIconsRegistrator.addIcons([{name:"menu-arrow",icon:y(67566)}])}static{this.\u0275fac=function(t){return new(t||Yo)(r.\u0275\u0275inject(At))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Yo})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[rt.MatButtonModule,w.CommonModule,B.MatIconModule,dn,It.MatDividerModule,Qt,pn,_t]})}};en=(0,m.__decorate)([wc({viewElements:[bt]}),(0,m.__metadata)("design:paramtypes",[At])],en),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(en,{declarations:[bt],imports:[rt.MatButtonModule,w.CommonModule,or,B.MatIconModule,dn,It.MatDividerModule,Qt,pn,_t],exports:[bt]})}();const rg=["container"],ag=s=>({collapsed:s}),og=(s,e)=>({$implicit:s,hideSeparator:!0,class:"first-item",width:e}),cg=s=>({$implicit:s}),lg=s=>({$implicit:s,class:"last-item",isLastItem:!0});function ug(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"crt-button",10),r.\u0275\u0275listener("clicked",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.onBackClicked())}),r.\u0275\u0275elementEnd()}if(s&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275styleProp("filter",t.backButtonFilter),r.\u0275\u0275property("tsDataItemMarker","breadcrumbs-back-arrow")("disableRipple",!0)("ariaLabel",t.backLabel)("title",t.backLabel)("classes",t.backButtonClasses)}}function dg(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function hg(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function pg(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,hg,1,0,"ng-container",7),r.\u0275\u0275elementContainerEnd()),s&2){const t=e.$implicit;r.\u0275\u0275nextContext(3);const n=r.\u0275\u0275reference(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",r.\u0275\u0275pureFunction1(2,cg,t))}}function mg(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,pg,2,4,"ng-container",11),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",t.middleItems)}}function fg(s,e){s&1&&r.\u0275\u0275elementContainer(0)}function gg(s,e){if(s&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,fg,1,0,"ng-container",7),r.\u0275\u0275elementContainerEnd()),s&2){const t=r.\u0275\u0275nextContext(2),n=r.\u0275\u0275reference(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",r.\u0275\u0275pureFunction1(2,lg,t.lastItem))}}function _g(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"div",4),r.\u0275\u0275template(1,ug,1,7,"crt-button",5),r.\u0275\u0275elementStart(2,"div",6,2),r.\u0275\u0275pipe(4,"translate"),r.\u0275\u0275template(5,dg,1,0,"ng-container",7)(6,mg,2,1,"ng-container",8)(7,gg,2,4,"ng-container",9),r.\u0275\u0275elementEnd()()),s&2){const t=r.\u0275\u0275nextContext(),n=r.\u0275\u0275reference(2),i=r.\u0275\u0275reference(4);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.hasBackButton),r.\u0275\u0275advance(),r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction1(10,ag,t.collapsedBreadcrumbs)),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(4,8,"Breadcrumbs.AriaLabel")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",r.\u0275\u0275pureFunction2(12,og,t.firstItem,t.firstItemWidth)),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.showAllBreadcrumbs)("ngIfElse",i),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.lastItem)}}function yg(s,e){s&1&&(r.\u0275\u0275elementStart(0,"span",14),r.\u0275\u0275text(1,"/"),r.\u0275\u0275elementEnd())}function bg(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275template(0,yg,2,0,"span",12),r.\u0275\u0275elementStart(1,"span",13),r.\u0275\u0275listener("click",function(){const i=r.\u0275\u0275restoreView(t),a=i.$implicit,o=i.isLastItem,l=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(l.navigateToItem(a,o))})("keydown.enter",function(){const i=r.\u0275\u0275restoreView(t),a=i.$implicit,o=i.isLastItem,l=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(l.navigateToItem(a,o))}),r.\u0275\u0275text(2),r.\u0275\u0275elementEnd()}if(s&2){let t,n;const i=e.$implicit,a=e.hideSeparator,o=e.class,l=e.width,d=e.isLastItem;r.\u0275\u0275property("ngIf",!a),r.\u0275\u0275advance(),r.\u0275\u0275styleProp("width",(t=l)!==null&&t!==void 0?t:""),r.\u0275\u0275propertyInterpolate("title",i.caption),r.\u0275\u0275property("tabindex",d?-1:0)("ngClass",(n=o)!==null&&n!==void 0?n:""),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",i.caption," ")}}function Cg(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"span",14),r.\u0275\u0275text(1,"/"),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(2,"span",15),r.\u0275\u0275listener("click",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(i.navigateToItem(i.secondLastItem))})("keydown.enter",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(i.navigateToItem(i.secondLastItem))}),r.\u0275\u0275text(3,"..."),r.\u0275\u0275elementEnd()}if(s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275advance(2),r.\u0275\u0275propertyInterpolate("title",t.secondLastItem.caption)}}class ni{set breadcrumbs(e){const t=e?.length,n=t-1;this.firstItem=e[0]||null,this.lastItem=t>1?e[n]:null,this.secondLastItem=e[t-2]||null,this.middleItems=e?.slice(1,n),this._resetBreadcrumbsDisplay()}constructor(e,t){this._changeDetector=e,this._translationService=t,this._changedBreadcrumbs=!1,this.middleItems=[],this.backLabel="",this.backButtonClasses=["breadcrumbs-back-button"],this.firstItemWidth="",this.collapsedBreadcrumbs=!0,this.hasBackButton=!1,this.itemClicked=new r.EventEmitter}_resetBreadcrumbsDisplay(){this.showAllBreadcrumbs=!0,this.firstItemWidth="",this._changedBreadcrumbs=!0,this._changeDetector.detectChanges()}_updateBreadcrumbsDisplay(){if(!this._changedBreadcrumbs)return;this._changedBreadcrumbs=!1;const e=this.container.nativeElement,t=e.scrollWidth>e.offsetWidth,n=t&&!!this.middleItems.length,i=!this.collapsedBreadcrumbs||!n;if(this.showAllBreadcrumbs!==i&&(this.showAllBreadcrumbs=i,this._changeDetector.detectChanges()),t){const a=this._calculateFirstItemWidth();a&&(this.firstItemWidth=`${a}px`,this._changeDetector.detectChanges())}}_getWidth(e){return e.getBoundingClientRect().width}_calculateFirstItemWidth(){const e=this.container.nativeElement,n=this._getWidth(e)-2,i=[...e.children],a=this._getWidth(i[0]),o=i.slice(1,-1).reduce((C,E)=>C+this._getWidth(E),0),l=this._getWidth(i.at(-1)),d=n*.4,h=n-o-l,p=Math.max(d,h),g=Math.min(p,a);return a===g?null:g}navigateToItem(e,t=!1){t||this.itemClicked.emit(e)}onBackClicked(){this.itemClicked.emit(this.secondLastItem)}ngOnInit(){this.backLabel=this._translationService.instant("Components.Breadcrumbs.Back")}ngAfterViewChecked(){requestAnimationFrame(()=>{this._updateBreadcrumbsDisplay()})}static{this.\u0275fac=function(t){return new(t||ni)(r.\u0275\u0275directiveInject(r.ChangeDetectorRef),r.\u0275\u0275directiveInject(A.TranslateService))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:ni,selectors:[["crt-breadcrumbs"]],viewQuery:function(t,n){if(t&1&&r.\u0275\u0275viewQuery(rg,5),t&2){let i;r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.container=i.first)}},hostVars:2,hostBindings:function(t,n){t&2&&r.\u0275\u0275styleProp("--text-color",n.textColor)},inputs:{breadcrumbs:"breadcrumbs",collapsedBreadcrumbs:"collapsedBreadcrumbs",hasBackButton:"hasBackButton",textColor:"textColor",backButtonFilter:"backButtonFilter"},outputs:{itemClicked:"itemClicked"},decls:5,vars:1,consts:[["breadcrumbItem",""],["hiddenBreadcrumbs",""],["container",""],["class","breadcrumbs",4,"ngIf"],[1,"breadcrumbs"],["icon","back-button-icon","iconPosition","only-icon","shape","rounded","class","crt-breadcrumbs-back-button","size","medium",3,"tsDataItemMarker","disableRipple","ariaLabel","title","filter","classes","clicked",4,"ngIf"],["role","navigation",1,"breadcrumbs-container",3,"ngClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["icon","back-button-icon","iconPosition","only-icon","shape","rounded","size","medium",1,"crt-breadcrumbs-back-button",3,"clicked","tsDataItemMarker","disableRipple","ariaLabel","title","classes"],[4,"ngFor","ngForOf"],["class","separator","aria-hidden","true",4,"ngIf"],["role","link",1,"breadcrumb",3,"click","keydown.enter","title","tabindex","ngClass"],["aria-hidden","true",1,"separator"],["role","link","tabindex","0",1,"breadcrumb","truncate",3,"click","keydown.enter","title"]],template:function(t,n){t&1&&r.\u0275\u0275template(0,_g,8,15,"div",3)(1,bg,3,7,"ng-template",null,0,r.\u0275\u0275templateRefExtractor)(3,Cg,4,1,"ng-template",null,1,r.\u0275\u0275templateRefExtractor),t&2&&r.\u0275\u0275property("ngIf",n.firstItem)},dependencies:[w.NgClass,w.NgForOf,w.NgIf,w.NgTemplateOutlet,Ue,bt,A.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}crt-breadcrumbs{width:100%}crt-breadcrumbs .breadcrumbs{display:flex;padding:0 16px;max-width:100%}crt-breadcrumbs .breadcrumbs .crt-breadcrumbs-back-button{--crt-button-default-hover-color: var(--crt-glass-color-light-100);--crt-button-default-pressed-color: var(--crt-glass-color-light-300);margin-right:6px;height:24px;width:24px}crt-breadcrumbs .breadcrumbs .breadcrumbs-container{display:block;max-width:100%;margin:8px 0;min-width:16px;flex-grow:1;padding:1px}crt-breadcrumbs .breadcrumbs .breadcrumbs-container.collapsed{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}crt-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb{background-color:transparent;border:none;cursor:pointer;max-width:100%;vertical-align:top;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}crt-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb.last-item{cursor:default}crt-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb.first-item{display:inline-block}crt-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb:focus-visible{box-shadow:0 0 0 1px var(--focus-outline-inner-color),0 0 0 2px var(--focus-outline-outer-color);outline:none;border-radius:4px}crt-breadcrumbs .breadcrumbs .breadcrumbs-container .separator{padding:0 4px}
`],encapsulation:2,changeDetection:0})}}class ii{static{this.\u0275fac=function(t){return new(t||ii)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:ii})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[w.CommonModule,B.MatIconModule,ge,en,A.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(ii,{declarations:[ni],imports:[w.CommonModule,B.MatIconModule,ge,en,A.TranslateModule],exports:[ni]})})();var Sg=y(88412),vg=y.n(Sg),L;(function(s){s.LightGreen="#A6DE00",s.Green="#20A959",s.DarkGreen="#22AC14",s.Orange="#FFAC07",s.OrangeRed="#FF8800",s.Coral="#F9307F",s.BrightRed="#FF602E",s.Red="#FF4013",s.Purple="#B87CCF",s.Violet="#7848EE",s.CelestialBlue="#247EE5",s.Blue="#0058EF",s.LightBlue="#009DE3",s.NavyBlue="#4F43C2",s.DarkTurquoise="#08857E",s.Turquoise="#00BFA5",s.BurntCoral="#BE1B5A",s.CadmiumRed="#E00022",s.ForestGreen="#0B6A32",s.SteelBlue="#1566B9",s.VividPurple="#9641A9",s.RustyOrange="#F86700",s.DarkBlue="#0D2E4E"})(L||(L={}));var F;(function(s){s.LightGreen="#7DA112",s.Green="#008537",s.DarkGreen="#0B8500",s.Orange="#EF6F00",s.OrangeRed="#DB3C00",s.Coral="#C2185B",s.BrightRed="#DC3A00",s.Red="#DB2D00",s.Purple="#A400AA",s.Violet="#512DA8",s.CelestialBlue="#0058EF",s.Blue="#014BCB",s.LightBlue="#0073EA",s.NavyBlue="#28216B",s.DarkTurquoise="#00665C",s.Turquoise="#118574",s.BurntCoral="#A10E47",s.CadmiumRed="#B8001C",s.ForestGreen="#0A592A",s.SteelBlue="#145597",s.VividPurple="#7B2D8D",s.RustyOrange="#9C3305",s.DarkBlue="#071D35"})(F||(F={}));var _;(function(s){s.BurntCoral="burnt-coral",s.CadmiumRed="cadmium-red",s.ForestGreen="forest-green",s.SteelBlue="steel-blue",s.VividPurple="vivid-purple",s.RustyOrange="rusty-orange",s.DarkTurquoise="dark-turquoise",s.Green="green",s.LightBlue="light-blue",s.CelestialBlue="celestial-blue",s.BrightRed="bright-red",s.OrangeRed="orange-red",s.Orange="orange",s.LightGreen="light-green",s.Turquoise="turquoise",s.DarkGreen="dark-green",s.Red="red",s.Coral="coral",s.Purple="purple",s.Violet="violet",s.Blue="blue",s.NavyBlue="navy-blue",s.DarkBlue="dark-blue"})(_||(_={}));const si="#FFFFFF",j=new Map([[_.BurntCoral,L.BurntCoral],[_.CadmiumRed,L.CadmiumRed],[_.ForestGreen,L.ForestGreen],[_.SteelBlue,L.SteelBlue],[_.VividPurple,L.VividPurple],[_.RustyOrange,L.RustyOrange],[_.DarkTurquoise,L.DarkTurquoise],[_.Green,L.Green],[_.LightBlue,L.LightBlue],[_.CelestialBlue,L.CelestialBlue],[_.BrightRed,L.BrightRed],[_.OrangeRed,L.OrangeRed],[_.Orange,L.Orange],[_.LightGreen,L.LightGreen],[_.Turquoise,L.Turquoise],[_.DarkGreen,L.DarkGreen],[_.Red,L.Red],[_.Coral,L.Coral],[_.Purple,L.Purple],[_.Violet,L.Violet],[_.Blue,L.Blue],[_.NavyBlue,L.NavyBlue],[_.DarkBlue,L.DarkBlue]]),_y=new Map([[_.BurntCoral,F.BurntCoral],[_.CadmiumRed,F.CadmiumRed],[_.ForestGreen,F.ForestGreen],[_.SteelBlue,F.SteelBlue],[_.VividPurple,F.VividPurple],[_.RustyOrange,F.RustyOrange],[_.DarkTurquoise,F.DarkTurquoise],[_.Green,F.Green],[_.LightBlue,F.LightBlue],[_.CelestialBlue,F.CelestialBlue],[_.BrightRed,F.BrightRed],[_.OrangeRed,F.OrangeRed],[_.Orange,F.Orange],[_.LightGreen,F.LightGreen],[_.Turquoise,F.Turquoise],[_.DarkGreen,F.DarkGreen],[_.Red,F.Red],[_.Coral,F.Coral],[_.Purple,F.Purple],[_.Violet,F.Violet],[_.Blue,F.Blue],[_.NavyBlue,F.NavyBlue],[_.DarkBlue,F.DarkBlue]]),$=new Map([[_.BurntCoral,{angle:224,colors:[{value:"#E92170",stop:0},{value:"#9C1548",stop:100}],clip:"padding-box"}],[_.CadmiumRed,{angle:224,colors:[{value:"#E23911",stop:0},{value:"#A11818",stop:100}],clip:"padding-box"}],[_.ForestGreen,{angle:224,colors:[{value:"#118F45",stop:0},{value:"#085C2B",stop:100}],clip:"padding-box"}],[_.SteelBlue,{angle:224,colors:[{value:"#057ADD",stop:0},{value:"#274D8F",stop:100}],clip:"padding-box"}],[_.VividPurple,{angle:224,colors:[{value:"#A758C5",stop:0},{value:"#841189",stop:100}],clip:"padding-box"}],[_.RustyOrange,{angle:224,colors:[{value:"#DE5C14",stop:0},{value:"#B51E00",stop:100}],clip:"padding-box"}],[_.LightGreen,{angle:224,colors:[{value:"#A6DE00",stop:0},{value:"#98CB00",stop:100}],clip:"padding-box"}],[_.Green,{angle:224,colors:[{value:"#20A959",stop:0},{value:"#007E37",stop:100}],clip:"padding-box"}],[_.DarkGreen,{angle:224,colors:[{value:"#22AC14",stop:100},{value:"#0B8500",stop:100}],clip:"padding-box"}],[_.Orange,{angle:224,colors:[{value:"#FFAC07",stop:0},{value:"#FF7700",stop:100}],clip:"padding-box"}],[_.OrangeRed,{angle:224,colors:[{value:"#FF8800",stop:0},{value:"#FF4E00",stop:100}],clip:"padding-box"}],[_.Coral,{angle:224,colors:[{value:"#F9307F",stop:0},{value:"#C2185B",stop:100}],clip:"padding-box"}],[_.BrightRed,{angle:224,colors:[{value:"#FF6534",stop:0},{value:"#DB2D00",stop:100}],clip:"padding-box"}],[_.Red,{angle:224,colors:[{value:"#FF4013",stop:0},{value:"#D32F2F",stop:100}],clip:"padding-box"}],[_.Purple,{angle:224,colors:[{value:"#B87CCF",stop:0},{value:"#A400AA",stop:100}],clip:"padding-box"}],[_.Violet,{angle:224,colors:[{value:"#7848EE",stop:0},{value:"#512DA8",stop:100}],clip:"padding-box"}],[_.CelestialBlue,{angle:224,colors:[{value:"#0091EA",stop:0},{value:"#0058EF",stop:100}],clip:"padding-box"}],[_.Blue,{angle:224,colors:[{value:"#0058EF",stop:0},{value:"#014BCB",stop:100}],clip:"padding-box"}],[_.LightBlue,{angle:224,colors:[{value:"#03A9F4",stop:0},{value:"#0075EA",stop:100}],clip:"padding-box"}],[_.NavyBlue,{angle:224,colors:[{value:"#4F43C2",stop:0},{value:"#28216B",stop:100}],clip:"padding-box"}],[_.DarkBlue,{angle:224,colors:[{value:"#06427C",stop:0},{value:"#0D2E4E",stop:100}],clip:"padding-box"}],[_.DarkTurquoise,{angle:224,colors:[{value:"#078A7E",stop:0},{value:"#084C45",stop:100}],clip:"padding-box"}],[_.Turquoise,{angle:224,colors:[{value:"#00BFA5",stop:0},{value:"#04A58F",stop:100}],clip:"padding-box"}]]),vu=new Map([[_.BurntCoral,{color:j.get(_.BurntCoral),gradient:$.get(_.BurntCoral)}],[_.CadmiumRed,{color:j.get(_.CadmiumRed),gradient:$.get(_.CadmiumRed)}],[_.ForestGreen,{color:j.get(_.ForestGreen),gradient:$.get(_.ForestGreen)}],[_.SteelBlue,{color:j.get(_.SteelBlue),gradient:$.get(_.SteelBlue)}],[_.VividPurple,{color:j.get(_.VividPurple),gradient:$.get(_.VividPurple)}],[_.RustyOrange,{color:j.get(_.RustyOrange),gradient:$.get(_.RustyOrange)}],[_.DarkTurquoise,{color:j.get(_.DarkTurquoise),gradient:$.get(_.DarkTurquoise)}],[_.Green,{color:j.get(_.Green),gradient:$.get(_.Green)}],[_.LightBlue,{color:j.get(_.LightBlue),gradient:$.get(_.LightBlue)}],[_.CelestialBlue,{color:j.get(_.CelestialBlue),gradient:$.get(_.CelestialBlue)}],[_.BrightRed,{color:j.get(_.BrightRed),gradient:$.get(_.BrightRed)}],[_.OrangeRed,{color:j.get(_.OrangeRed),gradient:$.get(_.OrangeRed)}],[_.Orange,{color:j.get(_.Orange),gradient:$.get(_.Orange)}],[_.LightGreen,{color:j.get(_.LightGreen),gradient:$.get(_.LightGreen)}],[_.Turquoise,{color:j.get(_.Turquoise),gradient:$.get(_.Turquoise)}],[_.DarkGreen,{color:j.get(_.DarkGreen),gradient:$.get(_.DarkGreen)}],[_.Red,{color:j.get(_.Red),gradient:$.get(_.Red)}],[_.Coral,{color:j.get(_.Coral),gradient:$.get(_.Coral)}],[_.Purple,{color:j.get(_.Purple),gradient:$.get(_.Purple)}],[_.Violet,{color:j.get(_.Violet),gradient:$.get(_.Violet)}],[_.Blue,{color:j.get(_.Blue),gradient:$.get(_.Blue)}],[_.NavyBlue,{color:j.get(_.NavyBlue),gradient:$.get(_.NavyBlue)}],[_.DarkBlue,{color:j.get(_.DarkBlue),gradient:$.get(_.DarkBlue)}]]);function Mu(s){return{get color(){return vu.get(s)?.color||s},get gradient(){let e=s;const t=vu.get(s),n=t?.gradient;if(n){const o=n.colors.map(({value:l,stop:d})=>`${l} ${d}%`);e=`linear-gradient(${n.angle}deg, ${o.join(",")}) ${n.clip}`}const a="radial-gradient(85% 85% at 50% 50%, "+(t?.color||s)+"99 21.17%, rgb(0 0 0 / 0%) 100%), rgb(24 24 24 / 50%)";return{linear:e,radial:a}}}}var Fe;(function(s){s.FullFill="full-fill",s.WithoutFill="without-fill",s.PartialFill="partial-fill",s.Glassmorphism="glassmorphism",s.Transparent="transparent"})(Fe||(Fe={}));var Ho;(function(s){s.Area="area",s.Bar="bar",s.Doughnut="doughnut",s.HorizontalBar="horizontal-bar",s.Line="line",s.Pie="pie",s.Scatter="scatter",s.Spline="spline",s.Funnel="tsfunnel"})(Ho||(Ho={}));function Mg(s){return`CDK.ChartWidget.${(0,v.startCase)(s).replace(" ","")}.Caption`}function wg(s){return`chart-widget-${s}-menu.icon`}function Ig(s,e,t,n="CDK.ChartWidget.ChangeChartType.Caption"){return{type:"crt.MenuItem",caption:s.instant(n),icon:"bars-button-icon",items:Eg(e,t,s)}}function Eg(s,e,t){if(!s||s.size===0)return[];const n=[];return s.forEach((i,a)=>{a!==Ho.Pie&&n.push({handleItemClick:()=>e(i),type:"crt.MenuItem",caption:t.instant(Mg(a)),icon:wg(a)})}),n}function yy(s,e,t){return{type:"crt.Label",labelTextAlign:"center",caption:e.instant(s),labelColor:t?"#FFFFFF":"#004FD6",labelBackgroundColor:"transparent",labelStyle:{"text-transform":"uppercase"}}}const Ag=["headerTools"],xg=["fullScreenButton"],Rg=(s,e,t,n,i)=>({"not-full-screen":s,"menu-not-active":e,"is-mobile":t,"tools-rtl":n,"tools-ltr":i}),Tg=s=>({title:s});function Pg(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",12)(1,"crt-breadcrumbs",13),r.\u0275\u0275listener("itemClicked",function(i){r.\u0275\u0275restoreView(t);const a=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(a.onBreadcrumbItemClicked(i))}),r.\u0275\u0275elementEnd()()}if(s&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("breadcrumbs",t.breadcrumbs)("hasBackButton",!0)("textColor",t.titleColor)("ngClass",t.breadcrumbsCssClass)("backButtonFilter",t.buttonFilter)}}function Ng(s,e){s&1&&(r.\u0275\u0275elementStart(0,"span"),r.\u0275\u0275text(1," \xA0|\xA0 "),r.\u0275\u0275elementEnd())}function Dg(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",8),r.\u0275\u0275template(1,Pg,2,5,"div",9),r.\u0275\u0275elementStart(2,"div",10),r.\u0275\u0275listener("keydown.enter",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(i.handleFullScreenClick())})("click",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(i.handleFullScreenClick())}),r.\u0275\u0275template(3,Ng,2,0,"span",11),r.\u0275\u0275text(4),r.\u0275\u0275elementEnd()()}if(s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275styleProp("color",t.titleColor),r.\u0275\u0275property("title",t.title),r.\u0275\u0275attribute("data-qa",t.title),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.breadcrumbs==null?null:t.breadcrumbs.length),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngIf",t.breadcrumbs==null?null:t.breadcrumbs.length),r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",t.title," ")}}function Vg(s,e){if(s&1){const t=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",16)(1,"crt-button",17,1),r.\u0275\u0275listener("clicked",function(){r.\u0275\u0275restoreView(t);const i=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(i.handleFullScreenClick())}),r.\u0275\u0275elementEnd()()}if(s&2){const t=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275styleProp("filter",t.buttonFilter),r.\u0275\u0275property("ariaLabel",t.fullScreenLabel)("tsDataItemMarker","widget-header-resize-button")("icon",t.isFullScreenMode?"minimize-icon":"maximize-icon")}}function Og(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"div",16),r.\u0275\u0275element(1,"crt-button",18,2),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275element(4,"crt-menu",19,3),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275reference(5),n=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275styleProp("filter",n.buttonFilter),r.\u0275\u0275property("crtMenuTriggerFor",t)("tsDataItemMarker","widget-header-menu-button")("ariaLabel",r.\u0275\u0275pipeBind2(3,7,"HeaderWidget.Menu.Caption",r.\u0275\u0275pureFunction1(10,Tg,n.title))),r.\u0275\u0275advance(3),r.\u0275\u0275property("items",n.menuItems)("useGlassmorphism",n.useGlassmorphism)}}function Bg(s,e){if(s&1&&(r.\u0275\u0275elementStart(0,"div",14,0),r.\u0275\u0275template(2,Vg,3,5,"div",15)(3,Og,6,12,"div",15),r.\u0275\u0275elementEnd()),s&2){const t=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngClass",r.\u0275\u0275pureFunction5(3,Rg,!t.isFullScreenMode,!(t.menuTrigger!=null&&t.menuTrigger.menuOpen),t.isMobile,t.isRtl,!t.isRtl)),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngIf",t.headerConfig==null?null:t.headerConfig.showFullScreen),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",t.hasAnyVisibleMenuItem)}}class Qe{static{this._hexToFilterCache=new Map}get hasAnyVisibleMenuItem(){return this.menuItems?.some(e=>e.visible===!0||e.visible===void 0)}get fullScreenLabel(){const e=this.isFullScreenMode?"CollapseLabel":"ExpandLabel";return this._translationService.instant("HeaderWidget.Fullscreen."+e,{title:this.title})}get useGlassmorphism(){return this._widgetConfig?.theme===Fe.Glassmorphism}set widgetConfig(e){(0,v.isEqual)(e,this._widgetConfig)||(this.title=this._headerConfig?.hideTitle?"":e?.title,this._widgetConfig=e,this._setTheme(this._widgetConfig))}get widgetConfig(){return this._widgetConfig}set headerConfig(e){e&&(this.showTools=e.showTools,this.isFullScreenMode=e.isFullScreenMode,this.title=e?.hideTitle?"":e?.title,this.chartsSeries=e.chartsSeries,this._headerConfig=e,this.isShowLayoutTools=e.showLayoutTools,this._setTheme({theme:e.theme,color:e.color}),this.menu?.menu.closed.emit("click"),this.menuItems=this._createMenu())}get headerConfig(){return this._headerConfig}set fullScreenButton(e){this._fullScreenButton=e,this.fullScreenButtonAttached.emit(e?.buttonElementRef.nativeElement)}get fullScreenButton(){return this._fullScreenButton}constructor(){this._directionality=(0,r.inject)(Ae.Directionality),this._translationService=(0,r.inject)(A.TranslateService),this._dialogService=(0,r.inject)(Jt),this.iconPosition=ke.OnlyIcon,this.isShowLayoutTools=!1,this.isFullScreenMode=!1,this.directionTypes=["column","row","row-reverse"],this.isRtl=!1,this.showTools=!1,this.showChartSeriesDrilldown=new r.EventEmitter,this.showDataAsTable=new r.EventEmitter,this.switchChartType=new r.EventEmitter,this.switchDirectionType=new r.EventEmitter,this.fullScreenStateChanged=new r.EventEmitter,this.breadcrumbItemClick=new r.EventEmitter,this.fullScreenButtonAttached=new r.EventEmitter,this._initializeDirectionality(),this._initializeUserAgent()}_createMenu(){let e=[];return this._createChartSeriesMenu(e,this.headerConfig?.displayDataSeries),e=e.concat(this._headerConfig.toolbarMenuItems||[]),e.push({type:"crt.MenuItem",icon:"change-layout-icon",items:this._createDirectionOptionsMenu(),visible:!!this.headerConfig?.showLayoutTools,caption:this._translationService.instant("CDK.HeaderWidget.Direction.Menu.Caption")}),this.chartsSeries&&this._setChartTypeMenuItems(e,this.chartsSeries),e}_createChartSeriesMenu(e,t){!t||t.length<=0||(e.push({type:"crt.MenuItem",caption:this._translationService.instant("CDK.ChartWidget.Common.ShowSeriesDataCaption"),icon:"chart-show-data.icon",items:this._createChartSeriesMenuItems(t)}),e.push({type:"crt.MenuItem",caption:this._translationService.instant("CDK.ChartWidget.Common.ShowDataAsTableCaption"),icon:"chart-show-data-as-table.icon",handleItemClick:()=>this.handleDataAsTableClick()}))}_createChartSeriesMenuItems(e){const t=[];return e.forEach(n=>{const i=Mu(n.color);t.push({handleItemClick:()=>this.handleSeriesClick(n),type:"crt.MenuItem",caption:n.label,iconColor:i?.color,icon:"dot.icon"})}),t}_setChartTypeMenuItems(e,t){e.push(Ig(this._translationService,t,this.handleMenuItemClick.bind(this)))}_createDirectionOptionsMenu(){const e=[];return this.directionTypes.forEach(t=>{e.push({handleItemClick:()=>this.handleDirectionMenuItemClick(t),type:"crt.MenuItem",caption:this._translationService.instant(this.getChangeDirectionOptionCaption(t)),icon:this.getChangeDirectionOptionIconName(t)})}),e}static _hexToFilter(e){const t=this._hexToFilterCache.get(e);if(t)return t;const n=vg().hexToFilter(e).color;return this._hexToFilterCache.set(e,n),n}_setTheme(e){const{theme:t,color:n=si}=e||{},i=Mu(n);switch(t){case Fe.Transparent:case Fe.WithoutFill:{this.headerThemeCssClass=Fe.WithoutFill,this.background=si,this.titleColor=i.color,this.buttonFilter=Qe._hexToFilter(this.titleColor);break}case Fe.PartialFill:{this.headerThemeCssClass=Fe.PartialFill,this.breadcrumbsCssClass="widget-header-breadcrumbs-partial-fill",this.background=`${i.gradient.linear} no-repeat 0% 0% / 100% 13px`,this.titleColor=i.color,this.buttonFilter=Qe._hexToFilter(this.titleColor);break}case Fe.Glassmorphism:{this.headerThemeCssClass=Fe.Glassmorphism,this.titleColor=si,this.background="unset",this.buttonFilter=Qe._hexToFilter(si);break}default:this.headerThemeCssClass="",this.titleColor=si,this.background=i.gradient.linear||"",this.buttonFilter=Qe._hexToFilter(si)}this.headerConfig?.background&&(this.background=this.headerConfig.background),this.headerThemeCssClass+=` widget-header-${this.isRtl?"rtl":"ltr"} ${this.showTools?"tools-shows":""}`,this.isRtl&&(this.breadcrumbsCssClass=`${this.breadcrumbsCssClass} widget-header-breadcrumbs-rtl`)}_convertDirectionOption(e){return!this.isRtl||e==="column"?e:e==="row"?"row-reverse":"row"}_initializeDirectionality(){this.isRtl=this._directionality?.value==="rtl"}getChangeDirectionOptionCaption(e){const t=this._convertDirectionOption(e);return`CDK.HeaderWidget.Direction.${(0,v.startCase)(t).replace(/\s/g,"")}.Caption`}getChangeDirectionOptionIconName(e){return`layout-position-${this._convertDirectionOption(e)}`}onKeydownHandler(e){if(e.key==="Escape"){const t=this._dialogService.hasOpenDialogs();this.isFullScreenMode&&!t&&this.handleFullScreenClick()}}onBreadcrumbItemClicked(e){this.breadcrumbItemClick.emit(e)}handleDirectionMenuItemClick(e){this.switchDirectionType.emit(e)}handleFullScreenClick(){this.isFullScreenMode=!this.isFullScreenMode,this.fullScreenStateChanged.emit(this.isFullScreenMode)}handleMenuItemClick(e){this.switchChartType.emit(e)}handleSeriesClick(e){this.showChartSeriesDrilldown.emit(e.index)}handleDataAsTableClick(){this.showDataAsTable.emit()}_initializeUserAgent(){this.isMobile=er.isMobile}static{this.\u0275fac=function(t){return new(t||Qe)}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Qe,selectors:[["crt-widget-header"]],viewQuery:function(t,n){if(t&1&&(r.\u0275\u0275viewQuery(re,5),r.\u0275\u0275viewQuery(Ag,5),r.\u0275\u0275viewQuery(xg,5,bt),r.\u0275\u0275viewQuery(Ye,5)),t&2){let i;r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.menu=i.first),r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.headerTools=i.first),r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.fullScreenButton=i.first),r.\u0275\u0275queryRefresh(i=r.\u0275\u0275loadQuery())&&(n.menuTrigger=i.first)}},hostBindings:function(t,n){t&1&&r.\u0275\u0275listener("keydown",function(a){return n.onKeydownHandler(a)},!1,r.\u0275\u0275resolveDocument)},inputs:{breadcrumbs:"breadcrumbs",widgetConfig:"widgetConfig",headerConfig:"headerConfig",showTools:"showTools",chartsSeries:"chartsSeries"},outputs:{showChartSeriesDrilldown:"showChartSeriesDrilldown",showDataAsTable:"showDataAsTable",switchChartType:"switchChartType",switchDirectionType:"switchDirectionType",fullScreenStateChanged:"fullScreenStateChanged",breadcrumbItemClick:"breadcrumbItemClick",fullScreenButtonAttached:"fullScreenButtonAttached"},decls:4,vars:5,consts:[["headerTools",""],["fullScreenButton",""],["trigger","crtMenuTrigger"],["dirTypes",""],[1,"widget-header",3,"ngClass"],[1,"widget-header-container"],["class","widget-title",3,"title","color",4,"ngIf"],["class","tools",3,"ngClass",4,"ngIf"],[1,"widget-title",3,"title"],["class","breadcrumbs-block",4,"ngIf"],["tabindex","-1",1,"title-block",3,"keydown.enter","click"],[4,"ngIf"],[1,"breadcrumbs-block"],[1,"widget-header-breadcrumbs",3,"itemClicked","breadcrumbs","hasBackButton","textColor","ngClass","backButtonFilter"],[1,"tools",3,"ngClass"],["class","tool-item",4,"ngIf"],[1,"tool-item"],["iconPosition","only-icon","size","medium",1,"action-button",3,"clicked","ariaLabel","tsDataItemMarker","icon"],["icon","menu","iconPosition","only-icon","size","medium",1,"action-button",3,"crtMenuTriggerFor","tsDataItemMarker","ariaLabel"],[3,"items","useGlassmorphism"]],template:function(t,n){t&1&&(r.\u0275\u0275elementStart(0,"div",4)(1,"div",5),r.\u0275\u0275template(2,Dg,5,7,"div",6)(3,Bg,4,9,"div",7),r.\u0275\u0275elementEnd()()),t&2&&(r.\u0275\u0275styleProp("background",n.background),r.\u0275\u0275property("ngClass",n.headerThemeCssClass),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngIf",n.title),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.showTools))},dependencies:[w.NgClass,w.NgIf,Ue,bt,re,Ye,ni,A.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.crt-full-screen-element .tools.not-full-screen.menu-not-active{opacity:0}.crt-full-screen-element .tools.not-full-screen.menu-not-active.is-mobile{opacity:1}.crt-full-screen-element:hover .tools.not-full-screen.menu-not-active,.crt-full-screen-element:focus-within .tools.not-full-screen.menu-not-active{opacity:1}.widget-header{display:flex;height:46px;align-items:flex-start;border-radius:8px 8px 0 0;background-size:cover;background-repeat:no-repeat;cursor:pointer}.widget-header .widget-header-container .widget-title{display:flex;min-width:0}.widget-header.partial-fill{background-size:100% 5px}.widget-header.partial-fill .widget-header-container{justify-content:space-between;margin-top:5px;height:27px;line-height:27px;border-radius:8px 8px 0 0}.widget-header.tools-shows .widget-header-container{padding-inline:16px}.widget-header .action-button{border:none;padding:0;outline:none;cursor:pointer;box-sizing:content-box;width:24px;height:24px;display:flex;align-items:center;justify-content:center;background-color:transparent}.widget-header .action-button mat-icon{width:16px;height:16px}.widget-header .widget-header-container{width:100%;height:38px;padding:0 16px;font-size:16px;line-height:38px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:flex}.widget-header .widget-header-container .breadcrumbs-block{display:flex;max-width:45%}.widget-header .widget-header-container .title-block{display:block;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.widget-header .widget-header-container .breadcrumbs-holder{max-width:100%}.widget-header .tools{margin:0;display:flex;align-items:center;transition:opacity .35s;margin-inline-start:auto}.widget-header .tools .tool-item{position:relative}.widget-header .tools .tool-item crt-button{--crt-button-default-hover-color: var(--crt-glass-color-light-100);--crt-button-default-pressed-color: var(--crt-glass-color-light-300)}.widget-header .tools .tool-item .chart-icon{display:flex;width:16px;height:16px;line-height:16px}.widget-header .tools .tool-item .arrow-down{display:flex;width:8px;height:16px;line-height:16px;margin-left:4px}crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs{padding:0}crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs-back-button{margin-top:7px}crt-breadcrumbs.widget-header-breadcrumbs .separator{vertical-align:top}crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs .breadcrumbs-container{display:flex;margin:11px 0 8px;width:100%}crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb,crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb:not(.last-item):hover,crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs .breadcrumbs-container .separator{color:inherit;font-size:14px}crt-breadcrumbs.widget-header-breadcrumbs .breadcrumbs .breadcrumbs-container .breadcrumb.first-item{max-width:60%}crt-breadcrumbs.widget-header-breadcrumbs-partial-fill .breadcrumbs .breadcrumbs-container{margin:6px 6px 8px 0;width:100%}crt-breadcrumbs.widget-header-breadcrumbs-partial-fill .breadcrumbs-back-button{margin-top:2px}crt-breadcrumbs.widget-header-breadcrumbs-rtl .breadcrumbs-back-button{transform:rotate(180deg)}
`],encapsulation:2,changeDetection:0})}}class ri{constructor(e,t){this._matIconRegistry=e,this._domSanitizer=t,this._registerIcons()}_registerIcons(){[{name:"layout-position-column",icon:y(81279)},{name:"layout-position-row-reverse",icon:y(18650)},{name:"layout-position-row",icon:y(98207)},{name:"menu",icon:y(66255)},{name:"maximize-icon",icon:y(19146)},{name:"minimize-icon",icon:y(73144)},{name:"switch-chart-type",icon:y(30766)},{name:"widget-header-arrow",icon:y(54008)},{name:"chart-show-data.icon",icon:y(83894)},{name:"chart-show-data-as-table.icon",icon:y(75470)},{name:"chart-widget-tsfunnel-menu.icon",icon:y(97422)},{name:"chart-widget-doughnut-menu.icon",icon:y(77271)},{name:"chart-widget-horizontal-bar-menu.icon",icon:y(73825)},{name:"chart-widget-bar-menu.icon",icon:y(68354)},{name:"chart-widget-area-menu.icon",icon:y(58054)},{name:"chart-widget-spline-menu.icon",icon:y(90766)},{name:"chart-widget-scatter-menu.icon",icon:y(4967)},{name:"chart-widget-line-menu.icon",icon:y(62011)},{name:"dot.icon",icon:y(34880)},{name:"change-layout-icon",icon:y(19693)},{name:"create-dashboard.icon",icon:y(84198)}].forEach(({name:t,icon:n})=>{this._matIconRegistry.addSvgIconLiteral(t,this._domSanitizer.bypassSecurityTrustHtml(n))})}static{this.\u0275fac=function(t){return new(t||ri)(r.\u0275\u0275inject(B.MatIconRegistry),r.\u0275\u0275inject(ne.DomSanitizer))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:ri})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[w.CommonModule,B.MatIconModule,_e.MatMenuModule,ge,en,Qt,ii,A.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(ri,{declarations:[Qe,ln],imports:[w.CommonModule,B.MatIconModule,_e.MatMenuModule,ge,en,Qt,ii,A.TranslateModule],exports:[Qe,ln]})})();class ai{constructor(e,t){this._matIconRegistry=e,this._domSanitizer=t,this._registerIcons()}_registerIcons(){[{name:"duplicates-background-image",icon:y(71133)},{name:"spinner",icon:y(36897)}].forEach(({name:t,icon:n})=>{this._matIconRegistry.addSvgIconLiteral(t,this._domSanitizer.bypassSecurityTrustHtml(n))})}static{this.\u0275fac=function(t){return new(t||ai)(r.\u0275\u0275inject(B.MatIconRegistry),r.\u0275\u0275inject(ne.DomSanitizer))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:ai})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[w.CommonModule,ri,B.MatIconModule,ge,A.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(ai,{declarations:[un],imports:[w.CommonModule,ri,B.MatIconModule,ge,A.TranslateModule],exports:[un]})})();class Us{_buildRequestUrl(e){return this._isAbsoluteUrl(e)?e:w.Location.joinWithSlash(this.getUrl(),e)}_isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}getUrl(){return ir()}intercept(e,t){return e=e.clone({url:this._buildRequestUrl(e.url)}),t.handle(e).pipe((0,u.catchError)(n=>(console.log(n),(0,c.throwError)(n))))}static{this.\u0275fac=function(t){return new(t||Us)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Us,factory:Us.\u0275fac})}}class oi extends Us{getUrl(){return it()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=r.\u0275\u0275getInheritedFactory(oi)))(n||oi)}})()}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:oi,factory:oi.\u0275fac})}}const kg=y.p+"assets/i18n/libs/";function Lg(s,e){return()=>(0,c.lastValueFrom)(s.loadCurrentUserInfo().pipe((0,u.switchMap)(t=>e.use(t?.userInfo?.cultureInfo?.sysCultureName))),{defaultValue:null})}class zs{constructor(e){this._customElementsBootstrapService=e}ngDoBootstrap(){this._customElementsBootstrapService.defineComponent("crt-duplicates-widget-component",un)}static{this.\u0275fac=function(t){return new(t||zs)(r.\u0275\u0275inject(di))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:zs})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[{provide:r.APP_INITIALIZER,useFactory:Lg,deps:[gi,A.TranslateService],multi:!0},$d,{provide:O.HTTP_INTERCEPTORS,useClass:oi,multi:!0},(0,O.provideHttpClient)((0,O.withInterceptorsFromDi)(),(0,O.withXsrfConfiguration)({cookieName:vt,headerName:vt}))],imports:[ne.BrowserModule,et.BrowserAnimationsModule,ai,mi.forRoot({defaultLanguage:"en-US",resourceSources:[{prefix:kg,suffix:".json"}]})]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(zs,{imports:[ne.BrowserModule,et.BrowserAnimationsModule,ai,A.TranslateModule]})})(),ne.platformBrowser().bootstrapModule(zs).catch(s=>console.error(s))},92825:S=>{S.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1592 7.99998C13.1592 5.15064 10.8494 2.84079 8.00004 2.84079C5.1507 2.84079 2.84085 5.15064 2.84085 7.99998C2.84085 10.8493 5.1507 13.1592 8.00004 13.1592C10.8494 13.1592 13.1592 10.8493 13.1592 7.99998ZM8.00004 1.50079C11.5894 1.50079 14.4992 4.41058 14.4992 7.99998C14.4992 11.5894 11.5894 14.4992 8.00004 14.4992C4.41064 14.4992 1.50085 11.5894 1.50085 7.99998C1.50085 4.41058 4.41064 1.50079 8.00004 1.50079ZM7.16167 5.39671C7.16167 4.93555 7.53551 4.56171 7.99667 4.56171H8.00333C8.46449 4.56171 8.83833 4.93555 8.83833 5.39671C8.83833 5.85786 8.46449 6.23171 8.00333 6.23171H7.99667C7.53551 6.23171 7.16167 5.85786 7.16167 5.39671ZM7.99979 6.95437C8.46095 6.95477 8.83447 7.32893 8.83407 7.79009L8.83163 10.6063C8.83123 11.0674 8.45706 11.4409 7.9959 11.4405C7.53475 11.4401 7.16123 11.066 7.16163 10.6048L7.16407 7.78864C7.16447 7.32749 7.53864 6.95397 7.99979 6.95437Z" fill="currentColor"/>
</svg>
`},71133:S=>{S.exports='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="298" height="60" viewBox="0 0 298 60"><defs><style>.a{fill:url(#a);}.b{fill:url(#b);}.c{opacity:0.55;clip-path:url(#c);}.d,.e,.g{fill:none;}.d{stroke:#fff;stroke-width:34px;}.d,.e{opacity:0.06;}.f,.h{stroke:none;}.h{fill:#fff;}</style><radialGradient id="a" cx="0" cy="1.041" r="1.492" gradientTransform="translate(-0.654 0.413) rotate(-49.36)" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#09f"/><stop offset="0.584" stop-color="#a033ff"/><stop offset="0.894" stop-color="#ff5280"/><stop offset="1" stop-color="#ff7061"/></radialGradient><linearGradient id="b" x1="0.5" x2="0.5" y2="1" gradientUnits="objectBoundingBox"><stop offset="0" stop-color="#284578"/><stop offset="1" stop-color="#14233c"/></linearGradient><clipPath id="c"><rect class="a" width="298" height="60" rx="3" transform="translate(0)"/></clipPath></defs><rect class="b" width="298" height="60" rx="3"/><g class="c"><g class="d" transform="translate(190 -152)"><rect class="f" width="376" height="357"/><rect class="g" x="17" y="17" width="342" height="323"/></g><g class="d" transform="translate(24 -64)"><ellipse class="f" cx="104" cy="101" rx="104" ry="101"/><ellipse class="g" cx="104" cy="101" rx="87" ry="84"/></g><g class="e" transform="translate(196.308 -87.998) rotate(90)"><path class="f" d="M127.152,0,254.3,270.789H0Z"/><path class="h" d="M 127.1520919799805 79.9931640625 L 53.52685546875 236.7885589599609 L 200.7772827148438 236.7885589599609 L 127.1520919799805 79.9931640625 M 127.152099609375 3.0517578125e-05 L 254.3041687011719 270.7885437011719 L -3.0517578125e-05 270.7885437011719 L 127.152099609375 3.0517578125e-05 Z"/></g></g></svg>'},36897:S=>{S.exports=`<svg
	width="24"
	height="24"
	viewBox="-25 -25 250 250"
	fill="none"
	xmlns="http://www.w3.org/2000/svg"
>
	<defs>
		<linearGradient id="spinner-secondHalf">
			<stop offset="0%" stop-opacity="0" stop-color="#fff" />
			<stop offset="50%" stop-opacity="0.15" stop-color="#fff" />
			<stop offset="100%" stop-opacity="0.5" stop-color="#fff" />
		</linearGradient>
		<linearGradient id="spinner-firstHalf">
			<stop offset="0%" stop-opacity="1" stop-color="#fff" />
			<stop offset="100%" stop-opacity="0.5" stop-color="#fff" />
		</linearGradient>
	</defs>

	<g stroke-width="34">
		<path stroke="url(#spinner-firstHalf)" d="M 196 100 A 96 96 0 0 1 4 100" />
		<path stroke="url(#spinner-secondHalf)" d="M 4 100 A 96 96 0 0 1 196 100" />

		<!-- 1deg extra path to have the round end cap -->
		<path
			stroke="#fff"
			stroke-linecap="round"
			d="M 4 100 A 96 96 0 0 1 4 98"
		/>
	</g>

	<animateTransform
		from="0 0 0"
		to="360 0 0"
		attributeName="transform"
		type="rotate"
		repeatCount="indefinite"
		dur="1300ms"
	/>
</svg>
`},19127:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
  <g id="Group_12169" data-name="Group 12169" transform="translate(-464 -425)">
    <g id="Group_9771" data-name="Group 9771" transform="translate(399 129)">
      <rect id="Rectangle_21438" data-name="Rectangle 21438" width="56" height="24" rx="3" transform="translate(73 316)" fill="#006ce0"/>
      <text id="OK" transform="translate(101 332)" fill="#fff" font-size="10" font-family="OpenSans-SemiBold, Open Sans" font-weight="600" letter-spacing="0.02em"><tspan x="-7.231" y="0">OK</tspan></text>
    </g>
    <rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" transform="translate(464 425)" fill="none"/>
  </g>
</svg>
`},67566:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
	<path fill="currentColor" d="m4 7 4 4 4-4Z"/>
	<path fill="none" d="M0 0h16v16H0z"/>
</svg>
`},49967:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="65.898" height="50" viewBox="0 0 65.898 50">
  <g id="Group_10554" data-name="Group 10554" transform="translate(-630.824 -282)">
    <g id="Group_10553" data-name="Group 10553" transform="translate(-8 4)">
      <rect id="Rectangle_23319" data-name="Rectangle 23319" width="24" height="8" transform="translate(640 311) rotate(-90)" fill="#757575" opacity="0.15"/>
      <rect id="Rectangle_23320" data-name="Rectangle 23320" width="15" height="8" transform="translate(655 313) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23321" data-name="Rectangle 23321" width="50" height="8" transform="translate(671 328) rotate(-90)" fill="#757575" opacity="0.16"/>
      <rect id="Rectangle_23326" data-name="Rectangle 23326" width="20" height="8" transform="translate(671 298) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23322" data-name="Rectangle 23322" width="30" height="8" transform="translate(687 311) rotate(-90)" fill="#757575" opacity="0.12"/>
      <rect id="Rectangle_23327" data-name="Rectangle 23327" width="17" height="8" transform="translate(687 298) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23323" data-name="Rectangle 23323" width="11" height="8" transform="translate(640 298) rotate(-90)" fill="#757575" opacity="0.15"/>
      <rect id="Rectangle_23324" data-name="Rectangle 23324" width="25" height="8" transform="translate(655 313) rotate(-90)" fill="#757575" opacity="0.19"/>
      <path id="Path_9959" data-name="Path 9959" d="M223.923,2054c8.8,1.753,9.21,7.979,18.455,7.661s19.38-15.618,29.076-15.618,13.109-8.362,16.091-8.043" transform="translate(416.077 -1753.707)" fill="none" stroke="#757575" stroke-linecap="round" stroke-width="2" opacity="0.36"/>
    </g>
  </g>
</svg>
`},19693:S=>{S.exports=`<svg id="Component_5492_3" data-name="Component 5492 \u2013 3" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <rect id="Rectangle_6579" data-name="Rectangle 6579" width="16" height="16" fill="none"/>
  <g id="Group_16870" data-name="Group 16870" transform="translate(-696 -7212)">
    <path id="Path_12008" data-name="Path 12008" d="M703.172,7214.3v5" transform="translate(0.828 -0.297)" fill="none" stroke="currentColor" stroke-width="1"/>
    <path id="Path_12009" data-name="Path 12009" d="M703.172,7214.3v5" transform="translate(1407.172 14440.297) rotate(180)" fill="none" stroke="currentColor" stroke-width="1"/>
    <path id="Polygon_401" data-name="Polygon 401" d="M3,0,6,3H0Z" transform="translate(701 7212)" fill="currentColor"/>
    <path id="Polygon_402" data-name="Polygon 402" d="M3,0,6,3H0Z" transform="translate(707 7228) rotate(180)" fill="currentColor"/>
    <path id="Path_12010" data-name="Path 12010" d="M703.172,7214.3v5" transform="translate(7924.297 6516.829) rotate(90)" fill="none" stroke="currentColor" stroke-width="1"/>
    <path id="Path_12011" data-name="Path 12011" d="M703.172,7214.3v5" transform="translate(-6516.297 7923.172) rotate(-90)" fill="none" stroke="currentColor" stroke-width="1"/>
    <path id="Polygon_403" data-name="Polygon 403" d="M3,0,6,3H0Z" transform="translate(712 7217) rotate(90)" fill="currentColor"/>
    <path id="Polygon_404" data-name="Polygon 404" d="M3,0,6,3H0Z" transform="translate(696 7223) rotate(-90)" fill="currentColor"/>
  </g>
</svg>
`},75470:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1">
	<rect x="1" y="1" width="14" height="14" fill="none" stroke="currentColor" />
	<line x1="1" y1="5.33" x2="15" y2="5.33" />
	<line x1="1" y1="10.66" x2="15" y2="10.66" />
	<line x1="5.33" y1="1" x2="5.33" y2="15" />
	<line x1="10.66" y1="1" x2="10.66" y2="15" />
</svg>
`},83894:S=>{S.exports=`<svg id="Component_186_3" data-name="Component 186 \u2013 3" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <rect id="Rectangle_6381" data-name="Rectangle 6381" width="16" height="16" fill="none"/>
  <line id="Line_39" data-name="Line 39" x1="6.5" transform="translate(2 8.5)" fill="none" stroke="currentColor" stroke-width="1"/>
  <line id="Line_215" data-name="Line 215" y2="12" transform="translate(14 4.5) rotate(90)" fill="none" stroke="currentColor" stroke-width="1"/>
  <line id="Line_216" data-name="Line 216" y2="12" transform="translate(14 12.5) rotate(90)" fill="none" stroke="currentColor" stroke-width="1"/>
</svg>
`},58054:S=>{S.exports=`<svg id="Icon_d6_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_8060" data-name="Group 8060" transform="translate(443.494 617.718)">
    <path id="Path_7426" data-name="Path 7426" d="M-434.241-610.29h0a3.835,3.835,0,0,1-3.917,2.5c-2.177,0-3.115-3.378-4.236-3.351v7.423h14v-11.5c-3.376,0-4.447,2.218-5.847,4.929" transform="translate(-0.018)" fill="#ff4013"/>
  </g>
  <rect id="Rectangle_7514" data-name="Rectangle 7514" width="16" height="16" fill="none"/>
</svg>
`},68354:S=>{S.exports=`<svg id="Icon_d1_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_8058" data-name="Group 8058" transform="translate(530.688 580.22)">
    <path id="Path_7420" data-name="Path 7420" d="M-531.087-569.14h3v5h-3Z" transform="translate(1.399 -2.079)" fill="#0058ef"/>
    <path id="Path_11907" data-name="Path 11907" d="M-531.087-569.14h3v3h-3Z" transform="translate(6.399 -0.079)" fill="#0058ef"/>
    <path id="Path_11904" data-name="Path 11904" d="M-531.087-569.14h3v6h-3Z" transform="translate(1.399 -9.079)" fill="#ff4013"/>
    <path id="Path_11908" data-name="Path 11908" d="M-531.087-569.14h3v6h-3Z" transform="translate(6.399 -7.079)" fill="#ff4013"/>
    <path id="Path_11906" data-name="Path 11906" d="M-531.087-569.14h3v3h-3Z" transform="translate(11.399 -10.08)" fill="#ff4013"/>
    <path id="Path_7421" data-name="Path 7421" d="M-519.087-579.14h3v9h-3Z" transform="translate(-0.601 3.92)" fill="#0058ef"/>
  </g>
  <rect id="Rectangle_7516" data-name="Rectangle 7516" width="16" height="16" fill="none"/>
</svg>
`},77271:S=>{S.exports=`<svg id="Icon_d3_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Icon_d3_16x16-2" data-name="Icon_d3_16x16" transform="translate(613.219 -455.729) rotate(-90)">
    <g id="Group_8053" data-name="Group 8053" transform="translate(1.543 1.5)">
      <path id="Subtraction_789" data-name="Subtraction 789" d="M826.77-4130.124h-3.021a4.005,4.005,0,0,0-3.575-3.575v-3.021a7.109,7.109,0,0,1,4.535,2.062,7.1,7.1,0,0,1,2.06,4.533Z" transform="translate(-1285 3523)" fill="#ff4013"/>
      <path id="Subtraction_791" data-name="Subtraction 791" d="M816.5-4125.093h0a7.156,7.156,0,0,1-1.731-4.617,6.974,6.974,0,0,1,1.907-4.8,7.068,7.068,0,0,1,4.69-2.206v3.021a3.987,3.987,0,0,0-2.555,1.288,3.991,3.991,0,0,0-1.041,2.691,3.96,3.96,0,0,0,.854,2.47l-2.121,2.154Z" transform="translate(-1287 3523)" fill="#ff6b00"/>
      <path id="Subtraction_790" data-name="Subtraction 790" d="M819.762-4124.719a6.96,6.96,0,0,1-4.617-1.731l2.136-2.136a3.959,3.959,0,0,0,2.488.868,3.989,3.989,0,0,0,2.691-1.041,3.987,3.987,0,0,0,1.289-2.554h3.021a7.066,7.066,0,0,1-2.206,4.689A6.979,6.979,0,0,1,819.762-4124.719Z" transform="translate(-1285 3525)" fill="#0061d9"/>
    </g>
    <rect id="Rectangle_7510" data-name="Rectangle 7510" width="16" height="16" transform="translate(-471.729 -613.219)" fill="none"/>
  </g>
</svg>
`},73825:S=>{S.exports=`<svg id="Icon_d2_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Icon_d2_16x16-2" data-name="Icon_d2_16x16" transform="translate(-569.219 529.687) rotate(90)">
    <g id="Group_8058" data-name="Group 8058" transform="translate(1.001 -3.999)">
      <rect id="Rectangle_44591" data-name="Rectangle 44591" width="3" height="10" transform="translate(-529.688 -576.22)" fill="#22ac14"/>
      <rect id="Rectangle_44592" data-name="Rectangle 44592" width="3" height="6" transform="translate(-524.688 -572.22)" fill="#22ac14"/>
      <rect id="Rectangle_44593" data-name="Rectangle 44593" width="3" height="14" transform="translate(-519.688 -580.22)" fill="#22ac14"/>
    </g>
    <rect id="Rectangle_7516" data-name="Rectangle 7516" width="16" height="16" transform="translate(-529.687 -585.219)" fill="none"/>
  </g>
</svg>
`},62011:S=>{S.exports=`<svg id="Icon_d5_16x16" xmlns="http://www.w3.org/2000/svg" width="16.265" height="16" viewBox="0 0 16.265 16">
  <g id="Group_8067" data-name="Group 8067" transform="translate(560.687 615.219)">
    <path id="Path_11909" data-name="Path 11909" d="M-560.687-605.37h4l3,3,2-7,3,1,2-6" transform="translate(1 1.151)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-linecap="round" stroke-width="2"/>
  </g>
  <rect id="Rectangle_7511" data-name="Rectangle 7511" width="16" height="16" fill="none"/>
</svg>
`},4967:S=>{S.exports=`<svg id="Icon_d7_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <circle id="Ellipse_1393" data-name="Ellipse 1393" cx="1.5" cy="1.5" r="1.5" transform="translate(1 6)" fill="#ff4013"/>
  <circle id="Ellipse_2400" data-name="Ellipse 2400" cx="1.5" cy="1.5" r="1.5" transform="translate(12 2)" fill="#ff4013"/>
  <circle id="Ellipse_2396" data-name="Ellipse 2396" cx="1.5" cy="1.5" r="1.5" transform="translate(1 11)" fill="#604edc"/>
  <circle id="Ellipse_2398" data-name="Ellipse 2398" cx="1.5" cy="1.5" r="1.5" transform="translate(12 7)" fill="#604edc"/>
  <circle id="Ellipse_2399" data-name="Ellipse 2399" cx="1.5" cy="1.5" r="1.5" transform="translate(7 11)" fill="#ff4013"/>
  <rect id="Rectangle_7517" data-name="Rectangle 7517" width="16" height="16" fill="none"/>
</svg>
`},90766:S=>{S.exports=`<svg id="Icon_d4_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_8067" data-name="Group 8067" transform="translate(560.687 615.219)">
    <path id="Path_7440" data-name="Path 7440" d="M-550.537-615.2c-4.731-.6-3.84,15.355-12,8.078" transform="translate(3.85 3)" fill="none" stroke="#604edc" stroke-linecap="round" stroke-width="2"/>
    <path id="Path_7441" data-name="Path 7441" d="M-562.537-609.554c7.048-7.875,8.508,6.168,12,5.578" transform="translate(3.85 1.739)" fill="none" stroke="#ff7043" stroke-linecap="round" stroke-width="2"/>
  </g>
  <rect id="Rectangle_7511" data-name="Rectangle 7511" width="16" height="16" fill="none"/>
</svg>
`},97422:S=>{S.exports=`<svg id="Icon_d8_16x16" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_8059" data-name="Group 8059" transform="translate(563.553 580.106)">
    <path id="Path_7422" data-name="Path 7422" d="M-548.687-579.14l-1.73,5h-10.539l-1.73-5Z" transform="translate(0.134 0.034)" fill="#ff4013"/>
    <path id="Path_7423" data-name="Path 7423" d="M-551.387-565.14l-1.065,3h-4.87l-1.065-3Z" transform="translate(-0.666 -2.966)" fill="#22ac14"/>
    <path id="Path_7424" data-name="Path 7424" d="M-550.187-571.14l-1.328,4h-7.344l-1.328-4Z" transform="translate(-0.366 -1.966)" fill="#0091ea"/>
  </g>
  <rect id="Rectangle_7515" data-name="Rectangle 7515" width="16" height="16" fill="none"/>
</svg>
`},84198:S=>{S.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 9V17" stroke="currentColor" stroke-miterlimit="10"/>
<path d="M16 13H8" stroke="currentColor" stroke-miterlimit="10"/>
<path d="M1 7L4.08317 4.34374L7.49809 5.45037L15 1" stroke="currentColor" stroke-miterlimit="10"/>
<path d="M1.5 10.9727H4.5V16.5H1.5V10.9727Z" stroke="currentColor" stroke-miterlimit="10"/>
<path d="M9.5 14.225V16.5001H6.5V11.5001V8.18311H9.5V11.274" stroke="currentColor" stroke-miterlimit="10"/>
<path d="M14.5 10.7061V5.74365H11.5V7.63313M14.5 16.9969L14.5 15.2096" stroke="currentColor" stroke-miterlimit="10"/>
</svg>`},34880:S=>{S.exports=`<svg id="Component_3013_78" data-name="Component 3013 \u2013 78" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
	<circle id="Ellipse_2192" data-name="Ellipse 2192" cx="5" cy="5" r="5" transform="translate(3 3)" fill="currentColor"/>
	<rect id="Rectangle_44619" data-name="Rectangle 44619" width="16" height="16" fill="none"/>
</svg>
`},81279:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_16843" data-name="Group 16843" transform="translate(-7204 1034) rotate(-90)">
    <rect id="Rectangle_6408" data-name="Rectangle 6408" width="16" height="16" transform="translate(1018 7220) rotate(-90)" fill="none"/>
    <path id="Path_6208" data-name="Path 6208" d="M1859.754,240.671h1v6h2l-2.5,3-2.5-3h2Z" transform="translate(779.329 9071.754) rotate(-90)" fill="currentColor"/>
    <path id="Path_11993" data-name="Path 11993" d="M1032,7205.261v14" transform="translate(-0.5 -0.261)" fill="none" stroke="currentColor" stroke-width="1"/>
  </g>
</svg>
`},18650:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_16841" data-name="Group 16841" transform="translate(-1018 -7204)">
    <rect id="Rectangle_6408" data-name="Rectangle 6408" width="16" height="16" transform="translate(1018 7220) rotate(-90)" fill="none"/>
    <path id="Path_6208" data-name="Path 6208" d="M1859.754,240.671h1v6h2l-2.5,3-2.5-3h2Z" transform="translate(779.329 9071.754) rotate(-90)" fill="currentColor"/>
    <path id="Path_11993" data-name="Path 11993" d="M1032,7205.261v14" transform="translate(-0.5 -0.261)" fill="none" stroke="currentColor" stroke-width="1"/>
  </g>
</svg>
`},98207:S=>{S.exports=`<svg id="Group_16842" data-name="Group 16842" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <rect id="Rectangle_6408" data-name="Rectangle 6408" width="16" height="16" transform="translate(0 16) rotate(-90)" fill="none"/>
  <path id="Path_6208" data-name="Path 6208" d="M2,9H3V3H5L2.5,0,0,3H2Z" transform="translate(5 10) rotate(-90)" fill="currentColor"/>
  <path id="Path_11993" data-name="Path 11993" d="M1032,7205.261v14" transform="translate(-1029.5 -7204.261)" fill="none" stroke="currentColor" stroke-width="1"/>
</svg>
`},19146:S=>{S.exports=`<svg id="Component_3021_13" data-name="Component 3021 \u2013 13" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <rect id="Rectangle_6428" data-name="Rectangle 6428" width="16" height="16" fill="none"/>
  <path id="Path_6910" data-name="Path 6910" d="M-347,453.292h-5v-5Z" transform="translate(354 -439.293)" fill="#000"/>
  <path id="Path_6911" data-name="Path 6911" d="M-340,446.292v-5h-5Z" transform="translate(354 -439.293)" fill="#000"/>
  <line id="Line_295" data-name="Line 295" y1="4" x2="4" transform="translate(9 3)" fill="none" stroke="#000" stroke-width="1"/>
  <line id="Line_296" data-name="Line 296" y1="4" x2="4" transform="translate(3 9)" fill="none" stroke="#000" stroke-width="1"/>
</svg>
`},66255:S=>{S.exports=`<svg id="Component_170_54" data-name="Component 170 \u2013 54" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_7345" data-name="Group 7345" transform="translate(-2064.059 107.242)">
    <rect id="Rectangle_6419" data-name="Rectangle 6419" width="2" height="2" transform="translate(2071.059 -105.242)" fill="#000"/>
    <rect id="Rectangle_6420" data-name="Rectangle 6420" width="2" height="2" transform="translate(2071.059 -100.242)" fill="#000"/>
    <rect id="Rectangle_6421" data-name="Rectangle 6421" width="2" height="2" transform="translate(2071.059 -95.242)" fill="#000"/>
  </g>
  <rect id="Rectangle_6422" data-name="Rectangle 6422" width="16" height="16" fill="none"/>
</svg>
`},73144:S=>{S.exports=`<svg id="Component_654_35" data-name="Component 654 \u2013 35" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <rect id="Rectangle_6580" data-name="Rectangle 6580" width="16" height="16" fill="none"/>
  <line id="Line_831" data-name="Line 831" y1="4" x2="4" transform="translate(2 10)" fill="none" stroke="#000" stroke-width="1"/>
  <line id="Line_832" data-name="Line 832" y1="4" x2="4" transform="translate(10 2)" fill="none" stroke="#000" stroke-width="1"/>
  <path id="Path_7086" data-name="Path 7086" d="M-57.433,448.76h-4.5v-4.5Z" transform="translate(70.933 -441.76)" fill="#000"/>
  <path id="Path_7087" data-name="Path 7087" d="M-69.585,451.912h4.5v4.5Z" transform="translate(72.085 -442.912)" fill="#000"/>
</svg>
`},30766:S=>{S.exports=`<svg id="Component_211_1" data-name="Component 211 \u2013 1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <g id="Group_7552" data-name="Group 7552" transform="translate(530.326 -406.05)">
    <g id="Path_7008" data-name="Path 7008" fill="none">
      <path d="M-519.789,420.05h-5.017l-4.52-12h14Z" stroke="none"/>
      <path d="M -520.484130859375 419.05029296875 L -516.7650146484375 409.05029296875 L -527.8809814453125 409.05029296875 L -524.1146240234375 419.05029296875 L -520.484130859375 419.05029296875 M -519.7891235351562 420.05029296875 L -524.8065795898438 420.05029296875 L -529.326171875 408.05029296875 L -515.326171875 408.05029296875 L -519.7891235351562 420.05029296875 Z" stroke="none" fill="#fff"/>
    </g>
    <line id="Line_802" data-name="Line 802" x2="9.762" transform="translate(-527.326 412.55)" fill="none" stroke="#fff" stroke-width="1"/>
    <line id="Line_803" data-name="Line 803" x2="6.451" transform="translate(-525.326 416.55)" fill="none" stroke="#fff" stroke-width="1"/>
  </g>
  <rect id="Rectangle_6546" data-name="Rectangle 6546" width="16" height="16" fill="none"/>
</svg>
`},54008:S=>{S.exports='<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><defs><style>.a{fill:#fff;}.b{fill:none;}</style></defs><path class="a" d="M930-390l6.662,9.444L930-373.136l10.675-7.42Z" transform="translate(-922.581 393.109)"/><rect class="b" width="26" height="26"/></svg>'},78683:S=>{S.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 1.49845H0.783829V4.00128H2.48383V0.000488281H0V1.49845Z" fill="#FF4013"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14 1.00089H5.08699V3.00089H14V1.00089ZM14 6.00052H5.08699V8.00052H14V6.00052ZM0 12.7274V13.9998H3.19044V9.99979H0V11.1761H1.5V11.5073H0.75V12.3962H1.5V12.7274H0ZM14 10.9998H5.08699V12.9998H14V10.9998Z" fill="#FF4013"/>
<path d="M2.14577e-05 7.56383V8.99972L3.15902 8.99977V7.56383L2.26167 7.56378L3.15902 6.86625L3.15902 5.00135L2.14577e-05 5.00128L0 6.43327H1.5L2.14577e-05 7.56383Z" fill="#FF4013"/>
</svg>
`},36659:S=>{S.exports=`<svg id="Boolean_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_12" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-width="2"><rect width="14" height="14" stroke="none"/><rect x="1" y="1" width="12" height="12" fill="none"/></g><path id="Path_30" d="M10.5,4.5,5.912,9,4,7.162" transform="translate(1 0.5)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-width="2"/></svg>
`},39078:S=>{S.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8.183.779c2.084.007 2.813.35 4.468 1.861l-1.875 2.424-2.95-1.229Z" fill="#ff1c06"/><path d="M7.643 14.846c-2.083-.006-2.813-.35-4.467-1.861l1.875-2.424L8 11.79Z" fill="#ffc6b8"/><path d="M15.024 8.156c-.064 2.22-.431 3.006-2 4.809l-2.4-1.931 1.322-3.175Z" fill="#ff4013"/><path d="M13.074 3.143c1.5 1.443 1.8 2.195 1.949 4.431l-3.03.46-1.286-2.925Z" fill="#ff320e"/><path d="M3.224 12.86c-1.5-1.443-1.795-2.195-1.948-4.43l3.029-.46 1.287 2.925Z" fill="#ffe8e3"/><path d="M12.999 12.98c-1.578 1.562-2.386 1.878-4.769 2.1l-.4-3.055 3.149-1.384Z" fill="#ff795a"/><g transform="translate(-798.326 92.909)" fill="none"><path d="M798.326-92.909h16v16h-16z"/><circle cx="7" cy="7" r="7" transform="translate(799.326 -91.909)" stroke="#ff4013" stroke-width="2"/><circle cx="3" cy="3" r="3" transform="translate(803.326 -87.909)" stroke="#ff4013" stroke-width="2"/><g stroke="#ff4013" stroke-width="2"><path d="M806.326-81.454v3.686"/><path d="M806.326-88.519v-3.386"/><path d="M803.211-84.909h-3.685"/><path d="M812.826-84.909h-3.387"/><path d="M804.126-87.162c-.8-.8-2.306-2.252-3.1-3.05"/><path d="M811.628-79.605c-.729-.73-2.31-2.2-3.04-2.926"/><path d="m804.02-82.6-3 3"/><path d="m811.629-90.213-3.088 2.978"/></g></g></svg>
`},26861:S=>{S.exports=`<svg id="Date_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_6448" transform="translate(1 3)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="14" height="12" stroke="none"/><rect x="1" y="1" width="12" height="10" fill="none"/></g><line id="Line_764" x2="12" transform="translate(2 7)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_11729" d="M176.171,1073.754v3" transform="translate(-171.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/><path id="Path_11730" d="M176.171,1073.754v3" transform="translate(-165.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/></svg>
`},55146:S=>{S.exports=`<svg id="Datetime_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Icon_left_panel_date_time_16x16_heavy" transform="translate(0)"><rect id="Rectangle_6448" width="16" height="16" fill="none"/><path id="Path_6271" d="M1895.033,260.278h-4.149v-9h12v2" transform="translate(-1889.884 -248.278)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7772" d="M0,0H4.5" transform="translate(1 6)" fill="none" stroke="#ff4013" stroke-width="2"/><line id="Line_771" y2="4" transform="translate(4)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_772" y2="4" transform="translate(10)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Path_6272" transform="translate(-1889.764 -248.582)" fill="none" stroke-miterlimit="10"><path d="M1905.764,258.584a5,5,0,1,1-5-5A5,5,0,0,1,1905.764,258.584Z" stroke="none"/><path d="M 1900.7626953125 261.5840454101562 C 1902.417602539062 261.5840454101562 1903.763916015625 260.23828125 1903.763916015625 258.5840759277344 C 1903.763916015625 256.9292602539062 1902.417602539062 255.5829772949219 1900.7626953125 255.5829772949219 C 1899.109130859375 255.5829772949219 1897.763916015625 256.9292602539062 1897.763916015625 258.5840759277344 C 1897.763916015625 260.23828125 1899.109130859375 261.5840454101562 1900.7626953125 261.5840454101562 M 1900.7626953125 263.5840454101562 C 1898.000244140625 263.5840454101562 1895.763916015625 261.3454284667969 1895.763916015625 258.5840759277344 C 1895.763916015625 255.8215942382812 1898.000244140625 253.5829772949219 1900.7626953125 253.5829772949219 C 1903.524169921875 253.5829772949219 1905.763916015625 255.8215942382812 1905.763916015625 258.5840759277344 C 1905.763916015625 261.3454284667969 1903.524169921875 263.5840454101562 1900.7626953125 263.5840454101562 Z" stroke="none" fill="#ff4013"/></g><path id="Path_6273" d="M1900.1,255.194v4h2.5" transform="translate(-1889.098 -249.194)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},71011:S=>{S.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2 3.5H14V12C14 12.1326 13.9473 12.2598 13.8536 12.3536C13.7598 12.4473 13.6326 12.5 13.5 12.5H2.5C2.36739 12.5 2.24021 12.4473 2.14645 12.3536C2.05268 12.2598 2 12.1326 2 12V3.5Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14 3.5L8 9L2 3.5" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},55039:S=>{S.exports=`<svg id="File_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Group_7055" transform="translate(-733.278 92.545)"><g id="Rectangle_6454" transform="translate(735.278 -91.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="12" height="14" stroke="none"/><rect x="1" y="1" width="10" height="12" fill="none"/></g><line id="Line_774" x2="6" transform="translate(738.278 -87.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_775" x2="6" transform="translate(738.278 -84.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_777" x2="4" transform="translate(738.278 -81.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},68877:S=>{S.exports=`<svg id="Float_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_14515" transform="translate(-144 -422)"><rect id="Rectangle_39433" width="16" height="16" transform="translate(144 422)" fill="none"/></g><path id="Path_11302" d="M6.957-4.64a6.469,6.469,0,0,1-.8,3.6A2.764,2.764,0,0,1,3.707.127,2.732,2.732,0,0,1,1.285-1.079,6.377,6.377,0,0,1,.47-4.64a6.53,6.53,0,0,1,.793-3.621A2.752,2.752,0,0,1,3.707-9.426,2.739,2.739,0,0,1,6.135-8.208,6.39,6.39,0,0,1,6.957-4.64Zm-4.539,0a7.22,7.22,0,0,0,.3,2.447,1.022,1.022,0,0,0,.993.74A1.033,1.033,0,0,0,4.7-2.2,7.02,7.02,0,0,0,5-4.64a7,7,0,0,0-.308-2.453,1.034,1.034,0,0,0-.987-.746,1.025,1.025,0,0,0-.99.746A7.208,7.208,0,0,0,2.418-4.64ZM7.759-.908a1.064,1.064,0,0,1,.286-.806,1.158,1.158,0,0,1,.832-.273,1.125,1.125,0,0,1,.816.279,1.061,1.061,0,0,1,.289.8,1.061,1.061,0,0,1-.292.79,1.105,1.105,0,0,1-.812.289,1.138,1.138,0,0,1-.825-.282A1.057,1.057,0,0,1,7.759-.908ZM13.69,0H11.728V-5.37l.019-.882.032-.965q-.489.489-.679.641l-1.066.857L9.088-6.9l2.99-2.38H13.69Z" transform="translate(0.53 12.426)" fill="#ff4013"/></svg>
`},92458:S=>{S.exports=`<svg id="Guid_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_42308" width="16" height="16" fill="none"/><path id="Path_11737" d="M1.162,0H3.43V-9.8H1.162Zm9.926-10.388v3.654a2.894,2.894,0,0,0-2.254-.91A3.661,3.661,0,0,0,5.068-3.766,3.661,3.661,0,0,0,8.834.112a2.9,2.9,0,0,0,2.352-.98V0h2.086V-10.388ZM9.212-1.68A1.911,1.911,0,0,1,7.28-3.766,1.911,1.911,0,0,1,9.212-5.852,1.908,1.908,0,0,1,11.13-3.766,1.908,1.908,0,0,1,9.212-1.68Z" transform="translate(0.838 13)" fill="#ff4013" stroke="rgba(0,0,0,0)" stroke-width="1"/></svg>
`},65689:S=>{S.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1742_819)">
<path d="M10.913 8.99277L7.40833 13.0074H13.0074V11.2395L10.913 8.99277ZM10.8641 6.00745L15.0074 10.4519V15.0074H3.00745L10.8641 6.00745Z" fill="#ff4013"/>
<path d="M3.43597 9.72806C2.87697 10.2871 2.20496 9.92807 1.64496 9.37007C1.08596 8.81107 0.726988 8.13807 1.28699 7.57907L3.07794 5.78806C3.63694 5.22906 4.30898 5.58806 4.86798 6.14606C5.42798 6.70506 5.78595 7.37706 5.22595 7.93706L3.43597 9.72806Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M7.93689 5.22705C7.37689 5.78605 6.70591 5.42704 6.14691 4.86804C5.58691 4.30904 5.22894 3.63704 5.78894 3.07804L7.57892 1.28704C8.13892 0.728043 8.80993 1.08704 9.36993 1.64604C9.92993 2.20504 10.2879 2.87704 9.72888 3.43704L7.93689 5.22705Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M4.70691 6.51907L6.51791 4.70807" stroke="#ff4013" stroke-width="2"/>
<path d="M11.301 2.00702H14.0079V14.007H2.00793V11.581" stroke="#ff4013" stroke-width="2"/>
</g>
<defs>
<clipPath id="clip0_1742_819">
<rect width="16.007" height="16.007" fill="#ff4013"/>
</clipPath>
</defs>
</svg>
`},60521:S=>{S.exports=`<svg id="Integer_icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99433 4.65198C9.48732 5.09802 9.74027 5.69781 9.74027 6.39946C9.74027 7.11039 9.46186 7.74386 8.95863 8.29085L8.95331 8.29664C8.68048 8.58037 8.17318 8.98047 7.44252 9.47417L7.44143 9.4749C7.00788 9.76552 6.67964 10.0338 6.4484 10.2773C6.39755 10.3308 6.35224 10.3822 6.31202 10.4316H9.03463C9.42976 10.4316 9.75009 10.7519 9.75009 11.1471C9.75009 11.5422 9.42976 11.8625 9.03463 11.8625H4.36201V11.5055C4.36201 10.774 4.62396 10.1113 5.14954 9.53003C5.45393 9.18287 5.98212 8.74216 6.73359 8.22779C7.28336 7.835 7.61754 7.57002 7.77738 7.40238C8.08169 7.07198 8.22096 6.73348 8.22096 6.38964C8.22096 6.03409 8.11952 5.81409 7.95289 5.66027C7.78277 5.50324 7.51683 5.40148 7.12478 5.40148C6.72877 5.40148 6.47218 5.52561 6.29884 5.75228L6.29169 5.76164L6.28392 5.77051C6.13055 5.94579 6.0142 6.20942 5.96505 6.5873C5.91679 6.95826 5.61042 7.29659 5.18377 7.29659C4.7751 7.29659 4.39395 6.95656 4.44447 6.49553C4.51728 5.83108 4.75991 5.26428 5.17392 4.82141C5.68203 4.26788 6.36125 4 7.15424 4C7.87626 4 8.49451 4.21025 8.99122 4.6492L8.99433 4.65198ZM14.8743 4.5961C15.3635 5.01371 15.6083 5.57814 15.6083 6.262C15.6083 6.71398 15.4974 7.12093 15.2526 7.45671C15.1531 7.59318 15.0352 7.71289 14.9008 7.81669C15.0605 7.92572 15.2015 8.0545 15.3211 8.20545C15.6165 8.55303 15.7556 8.98069 15.7556 9.46307C15.7556 10.1963 15.4914 10.8144 14.9713 11.2883C14.4419 11.7715 13.7612 12 12.9634 12C12.2299 12 11.6078 11.8045 11.1119 11.4124L11.1064 11.408C10.628 11.014 10.3332 10.4794 10.2052 9.83055C10.1107 9.35139 10.5042 8.97835 10.9288 8.97835C11.3492 8.97835 11.6378 9.30727 11.7079 9.64478C11.7693 9.94025 11.9002 10.158 12.0891 10.3154C12.3147 10.495 12.5969 10.5985 12.9634 10.5985C13.3872 10.5985 13.6961 10.4769 13.9229 10.2668C14.1282 10.0596 14.2363 9.80805 14.2363 9.49253C14.2363 9.15687 14.1319 8.93882 13.9486 8.7817C13.7609 8.62082 13.483 8.52399 13.0419 8.52399H12.7866C12.4159 8.52399 12.1154 8.22345 12.1154 7.85271C12.1154 7.48197 12.4159 7.18143 12.7866 7.18143H13.0125C13.4306 7.18143 13.6903 7.08609 13.85 6.9535C14.0037 6.81675 14.0989 6.61783 14.0989 6.31109C14.0989 6.00164 14.0017 5.79895 13.8513 5.66111L13.8504 5.66027C13.6842 5.50686 13.4217 5.4113 13.0223 5.4113C12.6106 5.4113 12.3484 5.51295 12.1702 5.68456L12.1656 5.68906C12.0215 5.82278 11.914 6.00455 11.8495 6.25293C11.766 6.57474 11.481 6.87436 11.0816 6.87436C10.6572 6.87436 10.2506 6.49494 10.3668 6.00508C10.4953 5.4634 10.7597 5.01133 11.1524 4.66211C11.6438 4.20736 12.2763 4 13.0125 4C13.739 4 14.3777 4.18225 14.8711 4.59337L14.8743 4.5961ZM3.41307 4.92822V11.1029C3.41307 11.5224 3.07297 11.8625 2.65342 11.8625C2.23388 11.8625 1.89377 11.5224 1.89377 11.1029V6.23307C1.68552 6.37174 1.46266 6.49124 1.22573 6.59268C0.723506 6.80771 0.244141 6.40276 0.244141 5.92406C0.244141 5.5872 0.467589 5.3135 0.755873 5.2089C0.963927 5.13341 1.17934 5.03405 1.39555 4.90741C1.64533 4.74519 1.85627 4.57307 2.04007 4.3863C2.18718 4.23681 2.39336 4.13748 2.62233 4.13748C3.05905 4.13748 3.41307 4.4915 3.41307 4.92822Z" fill="#ff4013"/>
</svg>
`},61631:S=>{S.exports=`<svg id="Lookup_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_6916" transform="translate(2.277 2)"><g id="Group_6915" transform="translate(-0.277)"><circle id="Ellipse_237" cx="4.5" cy="4.5" r="4.5" fill="none" stroke="#ff4013" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path id="Path_6243" d="M.344.344,4.123,4.123" transform="translate(7.877 7.876)" fill="none" stroke="#ff4013" stroke-width="2"/></g></g><rect id="Rectangle_24756" width="16" height="16" fill="none"/></svg>
`},32643:S=>{S.exports=`<svg id="Money_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><path id="Path_7070" d="M-318.645,863.293h-6v-8h14v4" transform="translate(325.645 -852.293)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7071" d="M-322.646,855.292a2,2,0,0,1-2,2" transform="translate(326.646 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7072" d="M-312.246,857.292a2,2,0,0,1-2-2" transform="translate(326.246 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7073" d="M-324.646,861.692a2,2,0,0,1,2,2" transform="translate(326.646 -853.692)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Ellipse_1363" transform="translate(6 5)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="2" cy="2" r="2" stroke="none"/><circle cx="2" cy="2" r="1" fill="none"/></g><path id="Path_7074" d="M-310.846,861.425c0,.737-1.12,1.333-2.5,1.333s-2.5-.6-2.5-1.333,1.12-1.333,2.5-1.333S-310.846,860.69-310.846,861.425Z" transform="translate(325.846 -851.092)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7075" d="M-310.846,863.292c0,.589-1.12,1.333-2.5,1.333s-2.5-.744-2.5-1.333" transform="translate(325.846 -850.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},59155:S=>{S.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.3353 1.83815L6.26378 1.46676L6.26378 1.46676L5.3353 1.83815ZM6.03813 3.59524L5.10965 3.96663L5.10965 3.96663L6.03813 3.59524ZM5.82454 4.94398L5.05632 4.3038L5.0563 4.30383L5.82454 4.94398ZM5.44629 5.39792L6.21451 6.03811L6.21453 6.03808L5.44629 5.39792ZM5.52758 7.19434L4.82047 7.90144L4.8205 7.90147L5.52758 7.19434ZM6.8057 8.47236L7.5128 7.76526L7.51278 7.76523L6.8057 8.47236ZM8.60205 8.55382L7.96198 7.7855L7.96187 7.78559L8.60205 8.55382ZM9.05613 8.17554L9.69619 8.94386L9.69631 8.94376L9.05613 8.17554ZM10.4048 7.96192L10.7762 7.03345L10.7761 7.03344L10.4048 7.96192ZM12.1617 8.66476L11.7903 9.59322L11.7903 9.59323L12.1617 8.66476ZM12.9999 9.90268H11.9999V9.90272L12.9999 9.90268ZM13 11.7369H14V11.7368L13 11.7369ZM4.09733 2C4.23363 2 4.3562 2.08298 4.40682 2.20954L6.26378 1.46676C5.90943 0.580885 5.05144 0 4.09733 0V2ZM4.40682 2.20953L5.10965 3.96663L6.96661 3.22386L6.26378 1.46676L4.40682 2.20953ZM5.10965 3.96663C5.15517 4.08044 5.13462 4.20985 5.05632 4.3038L6.59277 5.58417C7.14152 4.92566 7.28485 4.01947 6.96661 3.22385L5.10965 3.96663ZM5.0563 4.30383L4.67804 4.75777L6.21453 6.03808L6.59279 5.58414L5.0563 4.30383ZM4.67807 4.75774C3.90567 5.68462 3.96693 7.0479 4.82047 7.90144L6.23468 6.48723C6.11298 6.36552 6.10396 6.17076 6.21451 6.03811L4.67807 4.75774ZM4.8205 7.90147L6.09862 9.17949L7.51278 7.76523L6.23466 6.4872L4.8205 7.90147ZM6.09859 9.17947C6.95196 10.0328 8.31517 10.0946 9.24224 9.32204L7.96187 7.78559C7.82939 7.89599 7.63468 7.88713 7.5128 7.76526L6.09859 9.17947ZM9.24212 9.32213L9.69619 8.94386L8.41606 7.40722L7.96198 7.7855L9.24212 9.32213ZM9.69631 8.94376C9.79033 8.86541 9.91963 8.8449 10.0334 8.8904L10.7761 7.03344C9.98045 6.71516 9.07438 6.85861 8.41594 7.40732L9.69631 8.94376ZM10.0333 8.89039L11.7903 9.59322L12.5331 7.73629L10.7762 7.03345L10.0333 8.89039ZM11.7903 9.59323C11.917 9.64389 11.9999 9.76649 11.9999 9.90268H13.9999C13.9999 8.94847 13.4189 8.09059 12.5331 7.73628L11.7903 9.59323ZM11.9999 9.90272L12 11.7369L14 11.7368L13.9999 9.90264L11.9999 9.90272ZM12 11.7369C12 11.8823 11.8822 12 11.737 12V14C12.987 14 14 12.9867 14 11.7369H12ZM11.737 12C6.35945 12 2 7.64067 2 2.26318H0C0 8.74528 5.25492 14 11.737 14V12ZM2 2.26318C2 2.11782 2.11785 2 2.26316 2V0C1.01322 0 0 1.0133 0 2.26318H2ZM2.26316 2H4.09733V0H2.26316V2Z" fill="#FF4013"/>
</svg>
`},67021:S=>{S.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15H13C14.1046 15 15 14.1046 15 13V3C15 1.89543 14.1046 1 13 1Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M9 12H7V6H4V4H12V6H9V12Z" fill="#FF4013"/>
</svg>
`},28010:S=>{S.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.14 6.90901C5.13775 7.50618 5.25259 8.098 5.478 8.65101L1.5 12.629V15.229H4.1V13.669H5.66V12.109H7.22L8.078 11.251C8.631 11.4764 9.22282 11.5912 9.82 11.589C10.7456 11.589 11.6504 11.3145 12.4201 10.8003C13.1897 10.286 13.7895 9.55512 14.1438 8.69996C14.498 7.84481 14.5907 6.90381 14.4101 5.99598C14.2295 5.08815 13.7838 4.25426 13.1293 3.59975C12.4747 2.94524 11.6409 2.49951 10.733 2.31893C9.82519 2.13835 8.8842 2.23103 8.02904 2.58525C7.17388 2.93947 6.44297 3.53932 5.92872 4.30894C5.41448 5.07856 5.14 5.98339 5.14 6.90901ZM12.4832 5.95178C12.4832 6.84671 11.7577 7.57221 10.8628 7.57221C9.96785 7.57221 9.24236 6.84671 9.24236 5.95178C9.24236 5.05684 9.96785 4.33135 10.8628 4.33135C11.7577 4.33135 12.4832 5.05684 12.4832 5.95178Z" fill="#FF4013"/>
</svg>
`},97180:S=>{S.exports=`<svg id="Text_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_39432" width="16" height="16" fill="none"/><path id="Path_11304" d="M5.113,0H2.994V-8.23H.28V-9.994H7.827V-8.23H5.113Z" transform="translate(4 13)" fill="#ff4013"/></svg>
`},8510:S=>{S.exports=`<svg id="Time_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Ellipse_1346" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="7" cy="7" r="7" stroke="none"/><circle cx="7" cy="7" r="6" fill="none"/></g><path id="Path_6908" d="M1824.814,31.345v6h3" transform="translate(-1816.814 -29.345)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},64337:S=>{S.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 8H14" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 13.8375C9.38071 13.8375 10.5 11.2239 10.5 7.99998C10.5 4.77601 9.38071 2.16248 8 2.16248C6.61929 2.16248 5.5 4.77601 5.5 7.99998C5.5 11.2239 6.61929 13.8375 8 13.8375Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},73308:(S,ca,y)=>{y.d(ca,{A:()=>tn});function ne(O,r,et,A,vt,li,nn){try{var sn=O[li](nn),Mt=sn.value}catch(w){return void et(w)}sn.done?r(Mt):Promise.resolve(Mt).then(A,vt)}function tn(O){return function(){var r=this,et=arguments;return new Promise(function(A,vt){var li=O.apply(r,et);function nn(Mt){ne(li,A,vt,nn,sn,"next",Mt)}function sn(Mt){ne(li,A,vt,nn,sn,"throw",Mt)}nn(void 0)})}}}}]);
