(self.webpackChunkapp_studio_enterprise_relationship_diagram=self.webpackChunkapp_studio_enterprise_relationship_diagram||[]).push([[8395],{34645:(D,xd,y)=>{var Fe={"./basketball.json":[99523,9523],"./beaver.json":[37497,7497],"./cat.json":[7780,7780],"./dashboard.json":[44340,4340],"./email.json":[2160,2160],"./landingPage.json":[2888,2888],"./loader.json":[33475,3475],"./raccoon.json":[59425,9425],"./search.json":[9780,9780]};function Lo(M){if(!y.o(Fe,M))return Promise.resolve().then(()=>{var Ms=new Error("Cannot find module '"+M+"'");throw Ms.code="MODULE_NOT_FOUND",Ms});var U=Fe[M],s=U[0];return y.e(U[1]).then(()=>y.t(s,19))}Lo.keys=()=>Object.keys(Fe),Lo.id=34645,D.exports=Lo},48395:(D,xd,y)=>{var Fe=y(76608),Lo=y(74369),M=y(67057),U=y(5757),s=y(22307),Ms=y(44951),Bo=y(77901),T=y(79772);const Ed="CRT_CSRF",$S="CRT_LOADER",GS="CRT_SESSIONID",HS="bpmHref",WS="bpmRef";var l=y(62278),d=y(36486);const Tm=new s.InjectionToken("CustomEventApplicationIdToken"),ZS=new s.InjectionToken("CustomEventServiceToken");class ii{constructor(e,t=null){this.document=e,this.appId=t,this.customEventName="TSCustomEventChannel",this.appId=t||Math.random().toString()}subscribe(e){return this.customEventObserver$=this.customEventObserver$||(0,l.fromEvent)(document,this.customEventName),this.customEventObserver$.pipe((0,d.filter)(t=>t.detail.eventName===e&&t.detail.sender!==this.appId),(0,d.map)(t=>t.detail.payload))}createOutboundChannel(e){const t=new l.Subject;return t.asObservable().subscribe(n=>{const i=new CustomEvent(this.customEventName,{detail:{eventName:e,sender:this.appId,payload:n}});this.document.dispatchEvent(i)}),t}getDataViaEvent(e,t={}){return new l.Observable(n=>{this.subscribe(e).pipe((0,d.first)()).subscribe(i=>{n.next(i),n.complete()}),this.createOutboundChannel(e).next(t)})}getDataStreamViaEvent(e,t={}){return new l.Observable(n=>{const i=this.subscribe(e).subscribe(r=>{n.next(r)},l.noop,()=>n.complete());return this.createOutboundChannel(e).next(t),()=>{i.unsubscribe()}})}static{this.\u0275fac=function(t){return new(t||ii)(s.\u0275\u0275inject(M.DOCUMENT),s.\u0275\u0275inject(Tm,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ii,factory:ii.\u0275fac,providedIn:"root"})}}var Dm=y(34268),Dc=y.n(Dm);const Om="(?=^.{1,250}$)^[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?\\.)+[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?$",Rm=()=>new RegExp(Om,"g"),KS=()=>new RegExp(CONTAINS_EMAIL_PATTERN,"g");function jm(o){return Rm().test(o)}function JS(o){return CONTAINS_EMAIL_REGEXP().test(o)}const Id={name:"uponSanitizeElement",func:(o,e)=>{const t=e.tagName;jm(t)&&o.insertAdjacentText("afterbegin",`<${t}>`)}},Ad={name:"afterSanitizeAttributes",func:(o,e)=>{const t=window?.location?.origin;if(o.nodeName==="A"&&!o.getAttribute("href")?.toLowerCase().startsWith(t)){o.setAttribute("target","_blank");let n=o.getAttribute("rel")||"";["noopener","noreferrer"].forEach(i=>{n.includes(i)||(n+=" "+i)}),o.setAttribute("rel",n.trim())}}},qS=new s.InjectionToken("Represents a DOM purifier",{factory:()=>(Dc().addHook(Id.name,Id.func),Dc().addHook(Ad.name,Ad.func),Dc()),providedIn:"platform"});function XS(o){return o?Array.isArray(o)?o:[o]:[]}function Pd(o){return o||{}}function QS(){}function km(){return()=>{}}var Nm=y(35293);class Vm{static generate(){return"_"+this.generateUUID()}static generateUUID(){return(0,Nm.A)()}}var ws=y(26714);function V(o){return(e,t,n)=>{for((e.$inject===void 0||e.$inject instanceof Array&&!e.hasOwnProperty("$inject"))&&(e.$inject=[]);e.$inject.length<=n;)e.$inject.push(null);e.$inject[n]=o||t}}class Lm{static create(e){return new e}}class si{constructor(){this.speechResult=new l.Subject,this.speechEnd=new l.Subject}static _getInternalApiClass(){return window.SpeechRecognition||window.webkitSpeechRecognition}static isSupported(){return si._getInternalApiClass()!==void 0}_subscribeEvents(){this._internalApi.addEventListener("result",this.onResult.bind(this)),this._internalApi.addEventListener("speechend",this.onSpeechEnd.bind(this))}_unsubscribeEvents(){this._internalApi.removeEventListener("result",this.onResult),this._internalApi.removeEventListener("speechend",this.onSpeechEnd)}init(e){const t=si._getInternalApiClass();this._internalApi=Lm.create(t),this._internalApi.continuous=!0,this._internalApi.lang=e.lang||"en-US",this._subscribeEvents()}onResult(e){const{resultIndex:t,results:n}=e,i=n[t][0];if(!i)throw new Error("No results to transcript");this.speechResult.next(i.transcript)}onSpeechEnd(){this.speechEnd.next()}destroy(){this._unsubscribeEvents(),this._internalApi=null}startRecognition(){this._internalApi.start()}stopRecognition(){this._internalApi.stop()}static{this.\u0275fac=function(t){return new(t||si)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:si,factory:si.\u0275fac})}}var Bm=y(73436);class Fm{get messages$(){return this._messages$}constructor(e,t){this._ngZone=t;const n=new l.Subject;this._messages$=n.pipe(this._runInZone(this._ngZone)),this._broadcastChannel=new Bm.BroadcastChannel(e),this._broadcastChannel.onmessage=i=>n.next(i)}_runInZone(e){return t=>new l.Observable(n=>{t.subscribe(i=>e.run(()=>n.next(i)))})}publish(e){return(0,l.from)(this._broadcastChannel.postMessage(e))}}class ri{constructor(e){this._ngZone=e}createInstance(e){return new Fm(e,this._ngZone)}static{this.\u0275fac=function(t){return new(t||ri)(s.\u0275\u0275inject(s.NgZone))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ri,factory:ri.\u0275fac,providedIn:"root"})}}class eM{static toColdObservable(e){return new Observable(t=>{e().subscribe(i=>{t.next(i),t.complete()})})}}class Rt{log(e,t,...n){console.log(e,...n)}warn(e,t,...n){console.warn(e,...n)}error(e,t,...n){console.error(e,...n)}exception(e,t,...n){(console.exception||console.error)(e,...n)}static{this.\u0275fac=function(t){return new(t||Rt)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Rt,factory:Rt.\u0275fac})}}const tM={dataAccess:"data-access",feature:"feature",ui:"ui",util:"util",components:"components",deprecated:"deprecated"},nM={studioFree:"studio-free",studioEnterprise:"studio-enterprise",sdk:"sdk"};var b=y(73308);class Fo{constructor(e,t,n=null){this._injector=e,this._registrationMap=t,this._defaultInstanceType=n}_getInstance(e,t,n){return t?"injectable"in t&&t.injectable!=null?n.get(t.injectable):"useFactory"in t&&typeof t.useFactory=="function"?t.useFactory(e):"useValue"in t?t.useValue:null:null}_getDefaultInstance(e,t){return this._getInstance(e,this._defaultInstanceType,t)}_getInstanceByType(e,t){if(this._registrationMap.has(e)){const n=this._registrationMap.get(e);return this._getInstance(e,n,t)}}_getInstanceByPredicate(e,t){for(const[n,i]of this._registrationMap){if(typeof n!="function")continue;if(n(e,this._injector))return this._getInstance(e,i,t)}}_getInstanceByPredicateAsync(e,t){var n=this;return(0,b.A)(function*(){for(const[i,r]of n._registrationMap){if(typeof i!="function")continue;const c=i(e,n._injector);if(c instanceof Promise?yield c:c)return n._getInstance(e,r,t)}return null})()}create(e=null,t){const n=t??this._injector;return e==null?this._getDefaultInstance(e,n):this._getInstanceByType(e,n)??this._getInstanceByPredicate(e,n)??this._getDefaultInstance(e,n)}createAsync(){var e=this;return(0,b.A)(function*(t=null,n){const i=n??e._injector;return t==null?e._getDefaultInstance(t,i):e._getInstanceByType(t,i)??(yield e._getInstanceByPredicateAsync(t,i))??e._getDefaultInstance(t,i)}).apply(this,arguments)}static{this.\u0275fac=function(t){s.\u0275\u0275invalidFactory()}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Fo,factory:Fo.\u0275fac,providedIn:"root"})}}var v=y(28399),zm=y.n(v);class Um{static _createMappings(e){const t=new Map;return e=e??[],e.forEach(n=>{const i=n.predicate,r=(0,v.omit)(n,"predicate");t.set(i,r)}),t}static create(e){const{mappings:t,default:n,token:i,predicateToken:r}=e??{};return{provide:i,useFactory:a=>{const c=r?a.get(r,[],{optional:!0}):[],h=this._createMappings([...t??[],...c??[]]);return new Fo(a,h,n)},deps:[s.Injector]}}static createForPredicates(e){const{mappings:t,predicateToken:n}=e??{};return!n&&!t?.length?[]:t.map(i=>({provide:n,useValue:i,multi:!0}))}}function Oc(o){return Array.isArray(o)?o:[o]}function $m(o,e){return e.forEach(({replaceMacros:t,replaceValue:n})=>{o=o.map(i=>i===t?n??"":i)}),o}function iM(o,e){if(!o)return"";if(!e)return o;let t=[o];return e=Oc(e),t=Gm(t,e),t=$m(t,e),t.join("")}function Gm(o,e){if(!o)return[];let t=Oc(o);if(!e)return t;const n=Oc(e),i=n.map(({replaceMacros:r})=>r);return n.forEach(({searchValue:r,replaceMacros:a})=>{if(r&&a){const c=new RegExp(`(${a})`,"g"),h=t.map(p=>i.includes(p)?p:p.split(r).join(a).split(c));t=flatten(h)}}),t}var sM=y(4930);function Xe(o){return function(e){Reflect.defineMetadata("requestType",o.requestType,e)}}function rM(o){return e=>{const t=e.pipe(share()),n=t.pipe(tap(o),take(1));return concat(n,t)}}function oM(o){return e=>e.pipe(concatMap((t,n)=>o(t,n).pipe(map(i=>[t,i]))))}function Td(o){return e=>e.pipe((0,d.mergeMap)((t,n)=>o(t,n).pipe((0,d.map)(i=>[t,i]))))}function Rc(o){return e=>e.pipe((0,d.mergeMap)((t,n)=>o(t,n).pipe((0,d.map)(()=>t))))}function Dd(o){return e=>e.pipe((0,d.switchMap)((t,n)=>o(t,n).pipe((0,d.map)(i=>[t,i]))))}function jt(o){return e=>e.pipe((0,d.switchMap)((t,n)=>o(t,n).pipe((0,d.map)(()=>t))))}function Hm(o){return e=>o?new l.Observable(t=>{const n=a=>o.run(()=>t.next(a)),i=a=>o.run(()=>t.error(a)),r=()=>o.run(()=>t.complete());return e.subscribe({next:n,error:i,complete:r})}):e}function aM(o){return e=>o?new Observable(t=>{const n=a=>o.runOutsideAngular(()=>t.next(a)),i=a=>o.runOutsideAngular(()=>t.error(a)),r=()=>o.runOutsideAngular(()=>t.complete());return e.subscribe({next:n,error:i,complete:r})}):e}var zo=y(23710),jc=y.n(zo);class Od{static initialize(){zo.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),zo.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",n="_"){const i=new RegExp(`^${t}`);return t+e.replace(i,"")+n+zo.generate()}static getUniqueIncrementalName(e,t){if(!t.includes(e))return e;let n;for(let i=1;i<=t.length;i++)if(n=`${e}-${i}`,!t.includes(n))return n;return n}}Od.initialize();const cM=new s.InjectionToken("An abstraction over window.navigator object",{factory:()=>window.navigator,providedIn:"root"}),Wm="00000000-0000-0000-0000-000000000000",Zm=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function xs(o){let e="";for(let t=0;t<o;t++)e+=((1+Math.random())*65536|0).toString(16).substring(1);return e}function L(){return[xs(2),xs(1),xs(1),xs(1),xs(3)].join("-")}function Rd(o){return!!o&&Zm.test(o)}function Ym(o){return!o||o===Wm}const jd=new s.InjectionToken("CURRENT_TAB_ID_TOKEN"),lM={provide:jd,useValue:L()},uM=new s.InjectionToken("Dialog token"),Qe=new s.InjectionToken("WindowToken",{providedIn:"root",factory:kd});function kd(){return window}const dM={provide:Qe,useFactory:kd};class Uo{constructor(e){this._window=e,this._hasFocus=!1,this._window.addEventListener("focus",()=>{this._hasFocus=!0}),this._window.addEventListener("blur",()=>{this._hasFocus=!1})}_getIsDocumentVisible(){return document.visibilityState!=="hidden"}get hasFocus(){return this._hasFocus}get isActive(){return this._getIsDocumentVisible()}focus(){this._window.focus()}static{this.\u0275fac=function(t){return new(t||Uo)(s.\u0275\u0275inject(Qe))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Uo,factory:Uo.\u0275fac,providedIn:"root"})}}var Nd=y(40409);class Es{constructor(e){this._injector=e}defineComponent(e,t,n=null){const i=(0,Nd.createCustomElement)(t,{injector:n||this._injector});customElements.get(e)||customElements.define(e,i)}static{this.\u0275fac=function(t){return new(t||Es)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Es,factory:Es.\u0275fac,providedIn:"root"})}}function Km(o,e){return o.creatio.tabId=e,(0,l.of)(void 0)}const hM={provide:s.APP_INITIALIZER,multi:!0,useFactory:(o,e)=>()=>Km(o,e),deps:[Qe,jd]},Vd=new s.InjectionToken("LOCAL_STORAGE_SERVICE_CONFIG");class $o{static forRoot(e={}){return{ngModule:$o,providers:[{provide:Vd,useValue:e}]}}static{this.\u0275fac=function(t){return new(t||$o)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:$o})}static{this.\u0275inj=s.\u0275\u0275defineInjector({})}}const kc="LOCAL_STORAGE_NOT_SUPPORTED";class oi{constructor(e={}){this._isSupported=!1,this._prefix="ls",this._storageType="localStorage";const{prefix:t,storageType:n}=e||{};t!=null&&this._setPrefix(t),n!=null&&this._setStorageType(n),this._isSupported=this._checkSupport()}_deriveKey(e){return`${this._prefix}${e}`}_checkSupport(){try{const e=this._storageType in window&&window[this._storageType]!==null;if(e){this._webStorage=window[this._storageType];const t=this._deriveKey(`__${Math.round(Math.random()*1e7)}`);this._webStorage.setItem(t,""),this._webStorage.removeItem(t)}return e}catch(e){return console.error(e.message),!1}}_setPrefix(e){this._prefix=e;const t=".";this._prefix&&!this._prefix.endsWith(t)&&(this._prefix=this._prefix?`${this._prefix}${t}`:"")}_setStorageType(e){this._storageType=e}get(e){if(!this._isSupported)return console.warn(kc),null;const t=this._webStorage?this._webStorage.getItem(this._deriveKey(e)):null;if(!t||t==="null")return null;try{return JSON.parse(t)}catch{return null}}set(e,t){const n=t===void 0?null:JSON.stringify(t);if(!this._isSupported)return console.warn(kc),!1;try{this._webStorage&&this._webStorage.setItem(this._deriveKey(e),n)}catch(i){return console.error(i.message),!1}return!0}remove(...e){let t=!0;return e.forEach(n=>{this._isSupported||(console.warn(kc),t=!1);try{this._webStorage.removeItem(this._deriveKey(n))}catch(i){console.error(i.message),t=!1}}),t}static{this.\u0275fac=function(t){return new(t||oi)(s.\u0275\u0275inject(Vd,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:oi,factory:oi.\u0275fac,providedIn:"root"})}}class Go{playFromSource(e){return(0,b.A)(function*(t,n=!1){const i=new Audio(t),r=i.play();if(r!==void 0)try{yield r}catch(a){if(i.muted=!0,n)throw a}}).apply(this,arguments)}static{this.\u0275fac=function(t){return new(t||Go)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Go,factory:Go.\u0275fac,providedIn:"root"})}}var kt;(function(o){o.Small="small",o.Medium="medium",o.Large="large",o.XL="xl",o.XXL="xxl"})(kt||(kt={}));class Ho{constructor(e,t){this._window=e,this._document=t,this._minScreenSize=600,this._mediumScreenSize=790,this._largeScreenSize=1079,this._xlScreenSize=1280,this._screenSizeChanges$=new l.BehaviorSubject(this._currentScreenSizeType),this._changeScreenSizeType()}get currentScreenSizeType(){return this._currentScreenSizeType}get currentScreenSize(){return this._currentScreenSize}get isSmallScreen(){return this._currentScreenSizeType===kt.Small}_setScreenSizeTypeAttribute(e){this._document.body.setAttribute("screen-size-type",e)}_getScreenSizeType(){return this._currentScreenSize=this._window.innerWidth,this._currentScreenSize<=this._minScreenSize?kt.Small:this._currentScreenSize<=this._mediumScreenSize?kt.Medium:this._currentScreenSize<=this._largeScreenSize?kt.Large:this._currentScreenSize<=this._xlScreenSize?kt.XL:kt.XXL}_changeScreenSizeType(){const e=this._getScreenSizeType();return e===this._currentScreenSizeType?!1:(this._currentScreenSizeType=e,this._setScreenSizeTypeAttribute(e),!0)}screenSizeTypeChangeNotifier(){return this._screenSizeChanges$.asObservable()}refreshCurrentScreenSizeType(){this._changeScreenSizeType()&&this._screenSizeChanges$.next(this._currentScreenSizeType)}static{this.\u0275fac=function(t){return new(t||Ho)(s.\u0275\u0275inject(Qe),s.\u0275\u0275inject(M.DOCUMENT))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ho,factory:Ho.\u0275fac,providedIn:"root"})}}const pM=new s.InjectionToken("DESKTOP_NOTIFICATION_SENDER_PROVIDER");class Nc{static get isMobile(){const e=window.navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}}var Ld;(function(o){o[o.StayLoggedIn=0]="StayLoggedIn",o[o.Exit=1]="Exit",o[o.NotSet=2]="NotSet"})(Ld||(Ld={}));var ai=y(27075);class Wo{constructor(){this._liveAnnouncer=(0,s.inject)(ai.LiveAnnouncer),this._translateService=(0,s.inject)(T.TranslateService)}announce(e,t){var n=this;return(0,b.A)(function*(i,r,a=200){const c=n._translateService.instant(i);yield n._liveAnnouncer.announce(c,r,a)}).apply(this,arguments)}static{this.\u0275fac=function(t){return new(t||Wo)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Wo,factory:Wo.\u0275fac,providedIn:"root"})}}var oe=y(78240),u=y(5960);class Vc extends Error{constructor(e){super(`Argument with name '${e}' is empty.`)}}class Zo extends Error{constructor(e){super(`Argument with name '${e}' is out of range.`)}}class B{static checkArgumentEmpty(e,t){if(t==null)throw new Vc(e)}static checkArrayEmpty(e,t){if(B.checkArgumentEmpty(e,t),t.length===0)throw new Vc(e)}static checkStringIsNotEmpty(e,t){if(this.checkArgumentEmpty(e,t),t==="")throw new Vc(e);return t}static checkArgumentOutOfRange(e,t,n){if(n.begin&&t<n.begin)throw new Zo(e);if(n.end&&t>n.end)throw new Zo(e)}static checkEnumOutOfRange(e,t,n){if(!n||!Object.values(n).includes(t))throw new Zo(e)}}class Yo{get queryDtoType(){return this._queryDtoType}constructor(e,t){this.operationType=e,this.rootSchemaName=t,B.checkArgumentEmpty("_operationType",e),B.checkArgumentEmpty("_rootSchemaName",t)}getMetadata(){return(0,oe.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}(0,u.__decorate)([(0,oe.Exclude)(),(0,u.__metadata)("design:type",String)],Yo.prototype,"_queryDtoType",void 0),(0,u.__decorate)([(0,oe.Expose)({name:"__type"}),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[])],Yo.prototype,"queryDtoType",null);class Is{static{this._instanceOfKey="devkit_BaseFilter"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isEnabled=!0,this.trimDateTimeParameterToDate=!1,this.filterType=e}static fromJson(e,t,n){throw new Error(`fromJson not supported on filter type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,oe.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,oe.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class et extends Is{static{this._instanceOfKey="devkit_SingleFilter"}static get _instanceOfKeys(){return[...Is._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(e),this.comparisonType=t,this.leftExpression=n?.clone()}toJson(){return{...super.toJson(),leftExpression:this.serializeItem(this.leftExpression)}}_getUsedColumns(){return this.leftExpression._getUsedColumns()}}var ee;(function(o){o[o.None=0]="None",o[o.Compare=1]="Compare",o[o.IsNull=2]="IsNull",o[o.Between=3]="Between",o[o.In=4]="In",o[o.Exists=5]="Exists",o[o.FilterGroup=6]="FilterGroup"})(ee||(ee={}));var K;(function(o){o[o.Between=0]="Between",o[o.Contain=11]="Contain",o[o.End_with=13]="End_with",o[o.Equal=3]="Equal",o[o.Exists=15]="Exists",o[o.Greater=7]="Greater",o[o.Greater_or_equal=8]="Greater_or_equal",o[o.Is_not_null=2]="Is_not_null",o[o.Is_null=1]="Is_null",o[o.Less=5]="Less",o[o.Less_or_equal=6]="Less_or_equal",o[o.Not_contain=12]="Not_contain",o[o.Not_end_with=14]="Not_end_with",o[o.Not_equal=4]="Not_equal",o[o.Not_exists=16]="Not_exists",o[o.Not_start_with=10]="Not_start_with",o[o.Start_with=9]="Start_with"})(K||(K={}));class As extends et{static{this._instanceOfKey="devkit_BetweenFilter"}static get _instanceOfKeys(){return[...et._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(ee.Between,K.Between,e),this.filterType=ee.Between,this.rightLessExpression=t?.clone(),this.rightGreaterExpression=n?.clone()}static fromJson(e,t,n){return new As(n.fromJson(e.leftExpression,t),n.fromJson(e.rightLessExpression,t),n.fromJson(e.rightGreaterExpression,t))}clone(){const e=new As(this.leftExpression,this.rightLessExpression,this.rightGreaterExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightLessExpression:this.serializeItem(this.rightLessExpression),rightGreaterExpression:this.serializeItem(this.rightGreaterExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightLessExpression._getUsedColumns(),...this.rightGreaterExpression._getUsedColumns()]}}class tt extends et{static{this._instanceOfKey="devkit_CompareFilter"}static get _instanceOfKeys(){return[...et._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(ee.Compare,e,t),this.filterType=ee.Compare,this.rightExpression=n?.clone()}static fromJson(e,t,n){return new tt(e.comparisonType,n.fromJson(e.leftExpression,t),n.fromJson(e.rightExpression,t))}clone(){const e=new tt(this.comparisonType,this.leftExpression,this.rightExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpression:this.serializeItem(this.rightExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightExpression._getUsedColumns()]}}class gn extends et{static{this._instanceOfKey="devkit_ExistsFilter"}static get _instanceOfKeys(){return[...et._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n=K.Exists,i=!0){super(ee.Exists,n,e),this.filterType=ee.Exists,this.subFilters=t?.clone(),this.isAggregative=i}static fromJson(e,t,n){const i=n.fromJson(e.leftExpression,t),r=e.subFilters;let a;return r&&(a=t.fromJson(e.subFilters)),new gn(i,a,e.comparisonType,e.isAggregative)}clone(){const e=new gn(this.leftExpression,this.subFilters,this.comparisonType,this.isAggregative);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[...super._getUsedColumns(),...this.subFilters?._getUsedColumns()??[]]}}class fn extends et{static{this._instanceOfKey="devkit_InFilter"}static get _instanceOfKeys(){return[...et._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(ee.In,e,t),this.filterType=ee.In,this.rightExpressions=n.map(i=>i?.clone())??[]}static fromJson(e,t,n){const i=e.rightExpressions??[];return new fn(e.comparisonType,n.fromJson(e.leftExpression,t),i.map(r=>n.fromJson(r,t)))}clone(){const e=new fn(this.comparisonType,this.leftExpression,this.rightExpressions);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpressions:this.rightExpressions.map(e=>this.serializeItem(e))}}_getUsedColumns(){const e=this.rightExpressions.map(t=>t._getUsedColumns()).flat();return[...super._getUsedColumns(),...e]}}class gt extends et{static{this._instanceOfKey="devkit_IsNullFilter"}static get _instanceOfKeys(){return[...et._instanceOfKeys,this._instanceOfKey]}constructor(e,t){[K.Is_null,K.Is_not_null].includes(e)||console.warn(`Invalid comparison type: ${K[e]} in IsNullFilter.`),super(ee.IsNull,gt._getComparisonType(e),t),this.filterType=ee.IsNull,this.isNull=!0,this.isNull=this.comparisonType===K.Is_null}static _getComparisonType(e){return e===K.Is_not_null?e:K.Is_null}static fromJson(e,t,n){return new gt(gt._getComparisonType(e.comparisonType),n.fromJson(e.leftExpression,t))}clone(){const e=new gt(gt._getComparisonType(this.comparisonType),this.leftExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}}var Ps;(function(o){o[o.And=0]="And",o[o.Or=1]="Or"})(Ps||(Ps={}));var ci;(function(o){o[o.None=0]="None",o[o.CurrentUser=1]="CurrentUser",o[o.CurrentUserContact=2]="CurrentUserContact",o[o.Yesterday=3]="Yesterday",o[o.Today=4]="Today",o[o.Tomorrow=5]="Tomorrow",o[o.PreviousWeek=6]="PreviousWeek",o[o.CurrentWeek=7]="CurrentWeek",o[o.NextWeek=8]="NextWeek",o[o.PreviousMonth=9]="PreviousMonth",o[o.CurrentMonth=10]="CurrentMonth",o[o.NextMonth=11]="NextMonth",o[o.PreviousQuarter=12]="PreviousQuarter",o[o.CurrentQuarter=13]="CurrentQuarter",o[o.NextQuarter=14]="NextQuarter",o[o.PreviousHalfYear=15]="PreviousHalfYear",o[o.CurrentHalfYear=16]="CurrentHalfYear",o[o.NextHalfYear=17]="NextHalfYear",o[o.PreviousYear=18]="PreviousYear",o[o.CurrentYear=19]="CurrentYear",o[o.PreviousHour=20]="PreviousHour",o[o.CurrentHour=21]="CurrentHour",o[o.NextHour=22]="NextHour",o[o.NextYear=23]="NextYear",o[o.NextNDays=24]="NextNDays",o[o.PreviousNDays=25]="PreviousNDays",o[o.NextNHours=26]="NextNHours",o[o.PreviousNHours=27]="PreviousNHours",o[o.PrimaryColumn=34]="PrimaryColumn",o[o.PrimaryDisplayColumn=35]="PrimaryDisplayColumn",o[o.PrimaryImageColumn=36]="PrimaryImageColumn",o[o.DayOfYearToday=37]="DayOfYearToday",o[o.DayOfYearTodayPlusDaysOffset=38]="DayOfYearTodayPlusDaysOffset",o[o.NextNDaysOfYear=39]="NextNDaysOfYear",o[o.PreviousNDaysOfYear=40]="PreviousNDaysOfYear",o[o.PrimaryColorColumn=41]="PrimaryColorColumn"})(ci||(ci={}));var Se;(function(o){o[o.SchemaColumn=0]="SchemaColumn",o[o.Function=1]="Function",o[o.Parameter=2]="Parameter",o[o.SubQuery=3]="SubQuery",o[o.ArithmeticOperation=4]="ArithmeticOperation"})(Se||(Se={}));class nt{static{this._instanceOfKey="devkit_BaseExpression"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isBlock=!1,this.isBlock=e?.isBlock}static fromJson(e,t,n){throw new Error(`fromJson not supported on expression type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,oe.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,oe.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class X extends nt{static{this._instanceOfKey="devkit_ColumnExpression"}static get _instanceOfKeys(){return[...nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Se.SchemaColumn,this.columnPath=e?.columnPath}static fromJson(e){return new X({columnPath:e.columnPath})}clone(){return new X(this)}_getUsedColumns(){return[{path:this.columnPath}]}}class Ko extends nt{static{this._instanceOfKey="devkit_FunctionExpression"}static get _instanceOfKeys(){return[...nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Se.Function}}var xe;(function(o){o[o.None=0]="None",o[o.Macros=1]="Macros",o[o.Aggregation=2]="Aggregation",o[o.DatePart=3]="DatePart",o[o.Length=4]="Length",o[o.Window=5]="Window",o[o.DateAdd=6]="DateAdd",o[o.DateDiff=7]="DateDiff"})(xe||(xe={}));class _n extends Ko{static{this._instanceOfKey="devkit_MacrosFunctionExpression"}static get _instanceOfKeys(){return[...Ko._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=xe.Macros,this.macrosType=e?.macrosType,this.functionArgument=e?.functionArgument}static fromJson(e,t,n){const i=t&&n&&e.functionArgument?n.fromJson(e.functionArgument,t):void 0;return new _n({functionArgument:i,macrosType:e.macrosType})}clone(){return new _n(this)}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}function Jm(o){return o.getFullYear()<1970}function qm(o){const e=o.getTimezoneOffset()*6e4;return new Date(o.getTime()-e).toISOString().slice(0,-1)}function Xm(o){const e=o.getFullYear(),t=Ts(o.getMonth()+1),n=Ts(o.getDate()),i=Ts(o.getHours()),r=Ts(o.getMinutes()),a=Ts(o.getSeconds()),c=Qm(o.getMilliseconds());return`${e}-${t}-${n}T${i}:${r}:${a}.${c}`}function Ts(o){return String(o).padStart(2,"0")}function Qm(o){return String(o).padStart(3,"0")}function Bd(o){if(!(o instanceof Date))throw new TypeError;return Jm(o)?Xm(o):qm(o)}function Fd(o){return`"${Bd(o)}"`}var _;(function(o){o[o.Guid=0]="Guid",o[o.Text=1]="Text",o[o.Integer=4]="Integer",o[o.Float=5]="Float",o[o.Money=6]="Money",o[o.DateTime=7]="DateTime",o[o.Date=8]="Date",o[o.Time=9]="Time",o[o.Lookup=10]="Lookup",o[o.Enum=11]="Enum",o[o.Boolean=12]="Boolean",o[o.Blob=13]="Blob",o[o.Image=14]="Image",o[o.CUSTOM_OBJECT=15]="CUSTOM_OBJECT",o[o.IMAGELOOKUP=16]="IMAGELOOKUP",o[o.COLLECTION=17]="COLLECTION",o[o.Color=18]="Color",o[o.LOCALIZABLE_STRING=19]="LOCALIZABLE_STRING",o[o.ENTITY=20]="ENTITY",o[o.ENTITY_COLLECTION=21]="ENTITY_COLLECTION",o[o.ENTITY_COLUMN_MAPPING_COLLECTION=22]="ENTITY_COLUMN_MAPPING_COLLECTION",o[o.HASH_TEXT=23]="HASH_TEXT",o[o.SECURE_TEXT=24]="SECURE_TEXT",o[o.FILE=25]="FILE",o[o.MAPPING=26]="MAPPING",o[o.SHORT_TEXT=27]="SHORT_TEXT",o[o.MEDIUM_TEXT=28]="MEDIUM_TEXT",o[o.MAXSIZE_TEXT=29]="MAXSIZE_TEXT",o[o.LONG_TEXT=30]="LONG_TEXT",o[o.FLOAT1=31]="FLOAT1",o[o.FLOAT2=32]="FLOAT2",o[o.FLOAT3=33]="FLOAT3",o[o.FLOAT4=34]="FLOAT4",o[o.LOCALIZABLE_PARAMETER_VALUES_LIST=35]="LOCALIZABLE_PARAMETER_VALUES_LIST",o[o.METADATA_TEXT=36]="METADATA_TEXT",o[o.STAGE_INDICATOR=37]="STAGE_INDICATOR",o[o.OBJECT_LIST=38]="OBJECT_LIST",o[o.COMPOSITE_OBJECT_LIST=39]="COMPOSITE_OBJECT_LIST",o[o.FLOAT8=40]="FLOAT8",o[o.FILE_LOCATOR=41]="FILE_LOCATOR",o[o.PHONE_TEXT=42]="PHONE_TEXT",o[o.RICH_TEXT=43]="RICH_TEXT",o[o.WEB_TEXT=44]="WEB_TEXT",o[o.EMAIL_TEXT=45]="EMAIL_TEXT",o[o.COMPOSITE_OBJECT=46]="COMPOSITE_OBJECT",o[o.FLOAT0=47]="FLOAT0",o[o.MONEY0=48]="MONEY0",o[o.MONEY1=49]="MONEY1",o[o.MONEY3=50]="MONEY3"})(_||(_={}));class ae extends nt{static{this._instanceOfKey="devkit_ParameterExpression"}static get _instanceOfKeys(){return[...nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Se.Parameter;const t=e?.value;if(t instanceof Date){const n=new Date;n.setTime(t.getTime()),this.value=n}else t?this.value=typeof t=="object"?{...t}:t:this.value=t;this.dataValueType=e?.dataValueType??_.Text,this.parameter={dataValueType:this.dataValueType,...this._getParameterValueMetadata()}}static fromJson(e){return new ae(e.parameter)}_convertStringToBlobArray(e){const t=[];let n=0;for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);r<128?t[n++]=String.fromCharCode(r):r<2048?(t[n++]=String.fromCharCode(r>>6|192),t[n++]=String.fromCharCode(r&63|128)):(t[n++]=String.fromCharCode(r>>12|224),t[n++]=String.fromCharCode(r>>6&63|128),t[n++]=String.fromCharCode(r&63|128))}return t}_getParameterValueMetadata(){return this.dataValueType===_.Blob?{arrayValue:this.value?this._convertStringToBlobArray(this.value):[]}:this.value instanceof Date?{value:Fd(this.value)}:{value:this.value}}clone(){return new ae(this)}_getUsedColumns(){return[]}}(0,u.__decorate)([(0,oe.Exclude)(),(0,u.__metadata)("design:type",Object)],ae.prototype,"value",void 0),(0,u.__decorate)([(0,oe.Exclude)(),(0,u.__metadata)("design:type",Number)],ae.prototype,"dataValueType",void 0);class Ee extends Is{static{this._instanceOfKey="devkit_FilterGroup"}static get _instanceOfKeys(){return[...Is._instanceOfKeys,this._instanceOfKey]}get items(){const e={};return this.filters.forEach((t,n)=>{e[n]=this.serializeItem(t)}),e}constructor(e=Ps.And,t){super(ee.FilterGroup),this.filterType=ee.FilterGroup,this.filters=new Map,this.logicalOperation=e,this.rootSchemaName=t}static fromJson(e,t){const n=e.logicalOperation,i=new Ee(n||Ps.And,e.rootSchemaName);return Object.entries(e.items).forEach(([r,a])=>{i.add(t.fromJson(a),r)}),i}toJson(){const e={};return e.filterType=this.filterType,e.isEnabled=this.isEnabled,e.logicalOperation=this.logicalOperation,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e.items=this.items,this.rootSchemaName&&(e.rootSchemaName=this.rootSchemaName),e}_createParameterValueExpressions(e){return e.map(t=>new ae({value:t}))}getItemByIndex(e){return this.items[Object.keys(this.items)[e]]}addSchemaColumnFilterWithParameter(e,t,n,i){const r=new X({columnPath:t}),a=new ae({value:n}),c=new tt(e,r,a);this.add(c,i)}addSchemaColumnInFilterWithParameters(e,t,n,i){const r=new X({columnPath:t}),a=this._createParameterValueExpressions(n),c=new fn(e,r,a);this.add(c,i)}addPrimarySchemaColumnInFilter(e,t){const n=new _n({macrosType:ci.PrimaryColumn}),i=this._createParameterValueExpressions(e),r=new fn(K.Equal,n,i);this.add(r,t)}addSchemaColumnIsNullFilter(e,t){const n=new X({columnPath:e}),i=new gt(K.Is_null,n);this.add(i,t)}addSchemaColumnIsNotNullFilter(e,t){const n=new X({columnPath:e}),i=new gt(K.Is_not_null,n);this.add(i,t)}addSchemaColumnBetweenFilterWithParameters(e,t,n,i){const r=new X({columnPath:e}),a=new ae({value:t}),c=new ae({value:n}),h=new As(r,a,c);this.add(h,i)}addExistsFilter(e,t,n){const i=new X({columnPath:e}),r=new gn(i,t);this.add(r,n)}addNotExistsFilter(e,t,n){const i=new X({columnPath:e}),r=new gn(i,t,K.Not_exists);this.add(r,n)}add(e,t){B.checkArgumentEmpty("filter",e);const n=t||L();this.filters.set(n,e)}clone(){const e=new Ee(this.logicalOperation,this.rootSchemaName);return this.filters.forEach((t,n)=>{e.filters.set(n,t.clone())}),e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}_getUsedColumns(){const e=[];return this.filters.forEach(t=>{let n=t._getUsedColumns?t._getUsedColumns():[];n=n.map(i=>({path:i.path,schemaName:i.schemaName??this.rootSchemaName})),e.push(...n)}),e}}(0,u.__decorate)([(0,oe.Exclude)(),(0,u.__metadata)("design:type",Object)],Ee.prototype,"filters",void 0),(0,u.__decorate)([(0,oe.Expose)(),(0,u.__metadata)("design:type",Object),(0,u.__metadata)("design:paramtypes",[])],Ee.prototype,"items",null);class Jo extends Yo{constructor(e,t){super(e,t),this.filters=new Ee}clearFilters(){this.filters.filters.clear()}getMetadata(){return{...super.getMetadata(),filters:this.filters.toJson()}}_getUsedColumns(){const e=this.filters._getUsedColumns();return e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),e}}(0,u.__decorate)([(0,oe.Exclude)(),(0,u.__metadata)("design:type",Object)],Jo.prototype,"filters",void 0);var li;(function(o){o[o.Select=0]="Select",o[o.Insert=1]="Insert",o[o.Update=2]="Update",o[o.Delete=3]="Delete"})(li||(li={}));class eg extends Error{constructor(e){super(`Item with key '${e}' does not exist.`)}}var ui;(function(o){o[o.None=0]="None",o[o.Asc=1]="Asc",o[o.Desc=2]="Desc"})(ui||(ui={}));class ft{constructor(e){this.orderDirection=ui.None,this.orderPosition=-1,this.isVisible=!0,this.expression=e}withOrdering(e,t){return B.checkArgumentEmpty("orderDirection",e),B.checkArgumentEmpty("orderPosition",t),B.checkArgumentOutOfRange("orderPosition",t,{begin:-1}),this.orderDirection=e,this.orderPosition=t,this}withOptions(e){return B.checkArgumentEmpty("options",e),this.isVisible=e.isVisible??!0,this}withCaption(e){return B.checkArgumentEmpty("caption",e),this.caption=e,this}_getUsedColumns(){return this.expression._getUsedColumns()}toJson(){return(0,oe.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class tg extends ft{constructor(e){super(new X({columnPath:e}))}}class Ds extends nt{static{this._instanceOfKey="devkit_SubQueryExpression"}static get _instanceOfKeys(){return[...nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Se.SubQuery,this.columnPath=e?.columnPath;const t=e?.subFilters;typeof t?.clone=="function"?this.subFilters=t.clone():t?(this.subFilters=new Ee(t.logicalOperation,t.rootSchemaName),this.subFilters.isEnabled=t.isEnabled,Object.entries(t.items).forEach(([n,i])=>{this.subFilters.add(i,n)})):this.subFilters=t,this.subOrderDirection=e.subOrderDirection,this.subOrderColumn=e.subOrderColumn}static fromJson(e,t){return new Ds({columnPath:e.columnPath,subFilters:t.fromJson(e.subFilters),subOrderDirection:e.subOrderDirection,subOrderColumn:e.subOrderColumn})}clone(){return new Ds(this)}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[{path:this.columnPath},...this.subFilters?._getUsedColumns()??[]]}}class Os extends Ds{static{this._instanceOfKey="devkit_AggregationSubQueryExpression"}static get _instanceOfKeys(){return[...Ds._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.aggregationType=e?.aggregationType,this.functionType=e?.functionType}static fromJson(e,t){const n=super.fromJson(e,t);return new Os({aggregationType:e.aggregationType,functionType:e.functionType,...n})}clone(){return new Os(this)}}class ng extends ft{constructor(e,t,n,i,r){super(new Os({aggregationType:t,columnPath:e,subFilters:n,subOrderDirection:i,subOrderColumn:r}))}}class ig extends ft{constructor(e,t){super(new ae({value:e,dataValueType:t}))}}class Rs extends nt{static{this._instanceOfKey="devkit_ArithmeticExpression"}static get _instanceOfKeys(){return[...nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Se.ArithmeticOperation,this.arithmeticOperation=e?.arithmeticOperation,this.leftArithmeticOperand=e?.leftArithmeticOperand.clone(),this.rightArithmeticOperand=e?.rightArithmeticOperand.clone()}static fromJson(e,t,n){const i=n?.fromJson(e.leftArithmeticOperand,t),r=n?.fromJson(e.rightArithmeticOperand,t),a={leftArithmeticOperand:i,rightArithmeticOperand:r,arithmeticOperation:e.arithmeticOperation,isBlock:e.isBlock};return new Rs(a)}clone(){return new Rs(this)}_getUsedColumns(){return[...this.leftArithmeticOperand._getUsedColumns(),...this.rightArithmeticOperand._getUsedColumns()]}}class sg extends ft{constructor(e,t,n){super(new Rs({arithmeticOperation:e,leftArithmeticOperand:t,rightArithmeticOperand:n}))}}class rg extends ft{constructor(e){super(new _n({macrosType:e}))}}class Nt extends Ko{static{this._instanceOfKey="devkit_ArgumentFunctionExpression"}static get _instanceOfKeys(){return[...Ko._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionArgument=e?.functionArgument?.clone()}toJson(){const e=super.toJson();return this.functionArgument&&(e.functionArgument=this.serializeItem(this.functionArgument)),e}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class yn extends Nt{static{this._instanceOfKey="devkit_DatePartFunctionExpression"}static get _instanceOfKeys(){return[...Nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=xe.DatePart,this.datePartType=e?.datePartType}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t),r=e.datePartType;return new yn({functionArgument:i,datePartType:r,isBlock:e.isBlock})}clone(){return new yn(this)}}class og extends ft{constructor(e,t){super(new yn({datePartType:e,functionArgument:t}))}get datePartType(){return this.expression?.datePartType}}class js extends Nt{static{this._instanceOfKey="devkit_AggregationFunctionExpression"}static get _instanceOfKeys(){return[...Nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=xe.Aggregation,this.aggregationType=e?.aggregationType,this.aggregationEvalType=e?.aggregationEvalType}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t),r=e.aggregationType,a=e.aggregationEvalType;return new js({functionArgument:i,aggregationType:r,aggregationEvalType:a,isBlock:e.isBlock})}clone(){return new js(this)}}class ag extends ft{constructor(e,t,n){super(new js({aggregationType:e,aggregationEvalType:t,functionArgument:n}))}}class ks extends Nt{static{this._instanceOfKey="devkit_LengthFunctionExpression"}static get _instanceOfKeys(){return[...Nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=xe.Length}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t);return new ks({functionArgument:i,isBlock:e.isBlock})}clone(){return new ks(this)}}class cg extends ft{constructor(e){super(new ks({functionArgument:e}))}}class Ns extends Nt{static{this._instanceOfKey="devkit_WindowFunctionExpression"}static get _instanceOfKeys(){return[...Nt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=xe.Window}static fromJson(e,t,n){const i=n?.fromJson(e.functionArgument,t);return new Ns({functionArgument:i,isBlock:e.isBlock})}clone(){return new Ns(this)}}class lg extends ft{constructor(e){super(new Ns({functionArgument:e}))}}var qo;(function(o){o[o.None=0]="None",o[o.All=1]="All",o[o.Distinct=2]="Distinct"})(qo||(qo={}));class Cn extends Jo{constructor(e){super(li.Select,e),this._columns=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.SelectQuery",this.isDistinct=!1,this.rowCount=-1,this.rowsOffset=-1,this.useLocalization=!0,this.useRecordDeactivation=!1,this.isHierarchical=!1,this.hierarchicalMaxDepth=0,this.hierarchicalFullDataLoad=!1,this.hierarchicalColumnFiltersValue=new Ee,this._getIsPageable=()=>this.rowCount>0&&this.rowsOffset>-1}_internalAddColumn(e,t){this._columns.has(e)||this._columns.set(e,t)}getColumn(e){if(!this._columns.has(e))throw new eg(e);return this.findColumn(e)}findColumn(e){return this._columns.get(e)}getMetadata(){return{...super.getMetadata(),columns:{items:(0,oe.classToPlain)(this._columns,{exposeUnsetFields:!1,excludePrefixes:["_"]})},allColumns:!1,isDistinct:this.isDistinct,ignoreDisplayValues:!1,rowCount:this.rowCount,rowsOffset:this.rowsOffset,adminUnitRoleSources:this.adminUnitRoleSources,isPageable:this._getIsPageable(),conditionalValues:this.conditionalValues?this.conditionalValues:null,isHierarchical:this.isHierarchical,hierarchicalMaxDepth:this.hierarchicalMaxDepth,hierarchicalColumnName:this.hierarchicalColumnName,hierarchicalColumnValue:this.hierarchicalColumnValue,hierarchicalFullDataLoad:this.hierarchicalFullDataLoad,useLocalization:this.useLocalization,useRecordDeactivation:this.useRecordDeactivation}}addColumn(e,t){return this._internalAddColumn(t,e),e}addSchemaColumn(e,t){B.checkArgumentEmpty("columnPath",e);const n=new tg(e);return this._internalAddColumn(t||e,n),n}addAggregationSubQueryColumn(e,t,n,i){const r=new ng(e,t,n.filter,n.sortByDirection,n.sortByColumn);return this._internalAddColumn(i||e,r),r}addParameterColumn(e,t,n){const i=new ig(e,t);return this._internalAddColumn(n,i),i}addArithmeticColumn(e,t,n,i){const r=new sg(e,t,n);return this._internalAddColumn(i,r),r}addMacrosFunctionColumn(e,t){const n=new rg(e);return this._internalAddColumn(t,n),n}addDatePartFunctionColumn(e,t,n){const i=new X({columnPath:e}),r=new og(t,i);return this._internalAddColumn(n,r),r}addAggregationFunctionColumn(e,t,n,i=qo.None){const r=new X({columnPath:e}),a=new ag(t,i,r);return this._internalAddColumn(n,a),a}addLengthFunctionColumn(e,t){const n=new X({columnPath:e}),i=new cg(n);return this._internalAddColumn(t,i),i}addWindowFunctionColumn(e,t,n,i=qo.None){const r=new js({aggregationType:t,aggregationEvalType:i,functionArgument:new X({columnPath:e})}),a=new lg(r);return this._internalAddColumn(n,a),a}_getUsedColumns(){const e=[];return this._columns.forEach(t=>{e.push(...t._getUsedColumns())}),e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),[...e,...super._getUsedColumns()]}}class Oe{static{this.\u0275fac=function(t){return new(t||Oe)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Oe,factory:Oe.\u0275fac})}}const Q=new s.InjectionToken("FEATURE_VALUES",{factory:()=>({})}),Vs=new s.InjectionToken("SYSTEM_CACHE");var ce;(function(o){o.Memory="Memory",o.Persistent="Persistent",o.PersistentAndMemory="PersistentAndMemory"})(ce||(ce={}));var $e;(function(o){o.CacheRegistry="cache-registry",o.Images="images",o.BusinessRules="business-rules",o.RuntimeEntitySchema="runtime-entity-schema",o.RuntimeFreedomUISchemas="runtime-freedom-ui-schemas",o.UserInfo="user-info",o.SystemSettingsCache="system-settings",o.ApplicationInfo="application-info",o.Features="features",o.Rights="rights",o.Auth="auth",o.Acl="acl",o.UserLevelSchema="user-level-schema",o.ConfigurationData="configuration-data"})($e||($e={}));const Lc="configuration-data-cache",mM={provide:Vs,useValue:{name:Lc,type:ce.PersistentAndMemory,options:{tableName:$e.ConfigurationData}},multi:!0},zd="user-info-cache",ug="currentUserInfo",Ud="application-info-cache",dg="applicationInfo",hg="A5420246-0A8E-E111-84A3-00155D054C03",$d="en-US";class Xo{constructor(e){Object.assign(this,e)}static getDefaultCulture(){return new Xo({sysCultureId:hg,sysCultureName:$d,decimalSeparator:".",thousandSeparator:","})}}class di{constructor(){const e=this.constructor;if((0,s.inject)(e,s.InjectFlags.Optional|s.InjectFlags.SkipSelf))throw Error(`[${e.name}]: trying to create multiple instances,
			but this service should be a singleton.`)}}var pg=y(40234);const mg={name:"crt-shell-db",version:15,objectStoresMeta:Object.values($e).map(o=>({store:o,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]})),isDefault:!0};class hi{constructor(e){this.dbService=e,this._shouldRemoveDataBaseErrorNames=["VersionError","InvalidStateError","UnknownError"],this._dbReady=!0,this.dbService||(this._dbReady=!1,console.info("For using persistent cache, you need to register NgxIndexedDBService."))}_getErrorMessage(e){return e instanceof Error?`Name: ${e.name}, Message: ${e.message}`:e instanceof Event&&e.target&&"error"in e.target?`${e.target.error?.message}`:typeof e=="string"?e:JSON.stringify(e)}_handleError(e){const t=typeof e=="string"||e instanceof Error&&this._shouldRemoveDataBaseErrorNames.includes(e.name);return this._dbReady&&t?(indexedDB.deleteDatabase(mg.name),console.warn(`IndexedDB has been refreshed. ${this._getErrorMessage(e)}`),this._dbReady=!1,(0,l.of)(void 0)):(console.warn(`IndexedDB request error. ${this._getErrorMessage(e)}`),(0,l.of)(void 0))}_executeIndexedDBOperation(e,t){return this._dbReady?e():(0,l.of)(t)}get dbReady(){return this._dbReady}add(e,t){return this._executeIndexedDBOperation(()=>this.dbService.add(e,t),void 0).pipe((0,l.catchError)(n=>this._handleError(n)))}bulkAdd(e,t){return this._executeIndexedDBOperation(()=>this.dbService.bulkAdd(e,t),[]).pipe((0,l.catchError)(n=>this._handleError(n)))}getByKey(e,t){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(e,"key",t),null).pipe((0,l.catchError)(n=>this._handleError(n)))}getByKeys(e,t){if(t.length===0)return(0,l.of)([]);const n=t.map(i=>this._executeIndexedDBOperation(()=>this.getByKey(e,i),null));return(0,l.forkJoin)(n).pipe((0,l.map)(i=>i.filter(Boolean)),(0,l.catchError)(i=>this._handleError(i)))}clear(e){return this._executeIndexedDBOperation(()=>this.dbService.clear(e),!1).pipe((0,l.catchError)(t=>this._handleError(t)))}update(e,t){return this._executeIndexedDBOperation(()=>this.dbService.update(e,t),void 0).pipe((0,l.catchError)(n=>this._handleError(n)))}bulkUpdate(e,t){return this._executeIndexedDBOperation(()=>this.dbService.bulkPut(e,t),[]).pipe((0,l.catchError)(n=>this._handleError(n)))}delete(e,t){return this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(e,t),!0).pipe((0,l.catchError)(n=>this._handleError(n)))}deleteByIndex(e,t){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(e,"key",t),null).pipe((0,l.switchMap)(n=>n?this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(e,n.id),!1):(0,l.of)(!0)),(0,l.catchError)(n=>this._handleError(n)))}getAll(e){return this._executeIndexedDBOperation(()=>this.dbService.getAll(e),null).pipe((0,l.catchError)(t=>this._handleError(t)))}static{this.\u0275fac=function(t){return new(t||hi)(s.\u0275\u0275inject(pg.NgxIndexedDBService,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:hi,factory:hi.\u0275fac,providedIn:"root"})}}function gg(o){const e=document.cookie.match(new RegExp("(^| )"+o+"=([^;]+)"));return e?e[2]:null}function fg(){return gg("UserType")==="SSP"?"ssp/":""}class Gd{constructor(e,t,n){this._indexedDBService=e,this.memoryCache=n,this._tableName=t.tableName,this._keyPrefix=t.keyPrefix}_getPrefixedKey(e){return this._keyPrefix?`${this._keyPrefix}_${e}`:e}_getIndexedDBRecord(e){return(0,l.firstValueFrom)(this._indexedDBService.getByKey(this._tableName,e))}_getIndexedDBRecords(e){return(0,l.firstValueFrom)(this._indexedDBService.getByKeys(this._tableName,e))}has(e){var t=this;return(0,b.A)(function*(){if(yield t.memoryCache?.has(t._getPrefixedKey(e)))return!0;const n=yield t._getIndexedDBRecord(t._getPrefixedKey(e));return yield t.memoryCache?.set(t._getPrefixedKey(e),n?.data),!!n?.data})()}get(e){var t=this;return(0,b.A)(function*(){if(yield t.memoryCache?.has(t._getPrefixedKey(e)))return t.memoryCache.get(t._getPrefixedKey(e));const n=yield t._getIndexedDBRecord(t._getPrefixedKey(e));return yield t.memoryCache?.set(t._getPrefixedKey(e),n?.data),n?.data??null})()}getAll(){var e=this;return(0,b.A)(function*(){const t=yield e.memoryCache?.getAll();return t?.length>0?t:yield(0,l.firstValueFrom)(e._indexedDBService.getAll(e._tableName).pipe((0,l.map)(n=>n.map(i=>({key:i.key,value:i.data}))),(0,l.tap)(n=>e.memoryCache?.bulkSet(n))))})()}set(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._getIndexedDBRecord(n._getPrefixedKey(e));i?yield(0,l.firstValueFrom)(n._indexedDBService.update(n._tableName,{id:i.id,key:n._getPrefixedKey(e),data:t})):yield(0,l.firstValueFrom)(n._indexedDBService.add(n._tableName,{key:n._getPrefixedKey(e),data:t})),yield n.memoryCache?.set(n._getPrefixedKey(e),t)})()}bulkSet(e){var t=this;return(0,b.A)(function*(){if(!e||e.length===0)return;const n=(yield t._getIndexedDBRecords(e.map(r=>t._getPrefixedKey(r.key))))||[],i=e.map(r=>{const a=n.filter(Boolean).find(h=>h.key===t._getPrefixedKey(r.key)),c={key:t._getPrefixedKey(r.key),data:r.value};return a?.id?{...c,id:a.id}:c});yield(0,l.firstValueFrom)(t._indexedDBService.bulkUpdate(t._tableName,i)),yield t.memoryCache?.bulkSet(e)})()}delete(e){var t=this;return(0,b.A)(function*(){yield(0,l.firstValueFrom)(t._indexedDBService.deleteByIndex(t._tableName,t._getPrefixedKey(e))),yield t.memoryCache?.delete(t._getPrefixedKey(e))})()}clear(){var e=this;return(0,b.A)(function*(){yield(0,l.firstValueFrom)(e._indexedDBService.clear(e._tableName)),yield e.memoryCache?.clear()})()}}class Hd{constructor(){this._cache=new Map}has(e){return Promise.resolve(this._cache.has(e))}get(e){return Promise.resolve(this._cache.get(e))}getAll(){return Promise.resolve([...this._cache].map(([e,t])=>({key:e,value:t})))}set(e,t){return this._cache.set(e,t),Promise.resolve()}bulkSet(e){return e.forEach(t=>{this._cache.set(t.key,t.value)}),Promise.resolve()}delete(e){return this._cache.delete(e),Promise.resolve()}clear(){return this._cache.clear(),Promise.resolve()}}class Ls{constructor(e){this._indexedDBService=e}create(e){switch(e.type){case ce.Memory:return new Hd;case ce.Persistent:return new Gd(this._indexedDBService,e.options);case ce.PersistentAndMemory:return new Gd(this._indexedDBService,e.options,new Hd);default:throw new Error(`Unsupported cache type: ${e.type}`)}}static{this.\u0275fac=function(t){return new(t||Ls)(s.\u0275\u0275inject(hi))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ls,factory:Ls.\u0275fac,providedIn:"root"})}}const Wd="ClientCacheVersion";class _g{constructor(e,t,n,i){this._injector=e,this._systemCaches=t,this._useSystemClientCache=n,this._usePersistentCache=i,this._caches=new Map}_getPersistentCacheRegistryItems(){var e=this;return(0,b.A)(function*(){return(yield(0,l.firstValueFrom)(e._indexedDBService.getAll($e.CacheRegistry)))?.map(n=>n.data)??[]})()}_initializePersistentCacheRegistry(){var e=this;return(0,b.A)(function*(){if(!e._usePersistentCache){e._persistentCacheRegistry=new Map;return}const n=(yield e._getPersistentCacheRegistryItems()).map(i=>[i.name,i]);e._persistentCacheRegistry=new Map(n)})()}_initializeRegisteredCaches(){this._persistentCacheRegistry.forEach(e=>{const t=this._cacheFactory.create({name:e.name,type:e.useMemoryCache?ce.PersistentAndMemory:ce.Persistent,options:{tableName:e.tableName}});this._caches.set(e.name,t)})}_registerPersistentCache(e){var t=this;return(0,b.A)(function*(){if(!t._usePersistentCache)return;const n={name:e.name,tableName:e.options.tableName,useMemoryCache:e.type===ce.PersistentAndMemory,hash:""};yield(0,l.firstValueFrom)(t._indexedDBService.add($e.CacheRegistry,{key:e.name,data:n})),t._persistentCacheRegistry.set(e.name,n)})()}_updatePersistentCacheHash(e,t){var n=this;return(0,b.A)(function*(){const i=n._persistentCacheRegistry.get(e);i.hash=t,n._persistentCacheRegistry.set(e,i);const r=yield(0,l.firstValueFrom)(n._indexedDBService.getByKey($e.CacheRegistry,e));r?.data&&(r.data.hash=t,yield(0,l.firstValueFrom)(n._indexedDBService.update($e.CacheRegistry,{id:r.id,key:e,data:i})))})()}_isPersistentCache(e){return e===ce.Persistent||e===ce.PersistentAndMemory}_initializeSystemCaches(){var e=this;return(0,b.A)(function*(){const t=e._systemCaches||[];if(t.length===0)return;const n=t.filter(i=>!e._caches.has(i.name));yield Promise.all(n.map(i=>e._create(i)))})()}_create(e){var t=this;return(0,b.A)(function*(){if(t._caches.has(e.name))throw new Error(`Cache instance with name "${e.name}" already exists.`);const n=t._cacheFactory.create({...e,type:t._usePersistentCache?e.type:ce.Memory});return t._caches.set(e.name,n),t._isPersistentCache(e.type)&&(yield t._registerPersistentCache(e)),n})()}_internalInitialize(){var e=this;return(0,b.A)(function*(){e._indexedDBService=e._injector.get(hi),e._cacheFactory=e._injector.get(Ls),e._httpClient=e._injector.get(U.HttpClient),e._caches.clear(),yield e._initializePersistentCacheRegistry(),e._initializeRegisteredCaches(),yield e._initializeSystemCaches(),yield e._validateSystemCaches()})()}_validateSystemCaches(){var e=this;return(0,b.A)(function*(){if(!e._caches.size||!e._indexedDBService.dbReady||!e._usePersistentCache)return;const t=fg(),{hashes:n=[],cacheVersion:i=0}=yield(0,l.lastValueFrom)(e._httpClient.get(`${t}api/ClientCache/Hashes`).pipe((0,d.catchError)(()=>(console.warn("Failed to get system hashes"),(0,l.of)({hashes:[],cacheVersion:0})))));if(e._getIsNeedForceClearCache(i)){yield e._innerClearAll();return}yield Promise.all(n.map(({name:a,value:c})=>e._internalValidateCache(a,c)))})()}_getIsNeedForceClearCache(e){const t=this._injector.get(oi),n=t.get(Wd),i=e&&e!==n;return i&&t.set(Wd,e),i}_internalValidateCache(e,t){var n=this;return(0,b.A)(function*(){if(!n._persistentCacheRegistry.has(e)||!n._usePersistentCache)return;if(n._persistentCacheRegistry.get(e).hash!==t){const r=n._caches.get(e);r&&(yield r.clear(),yield n._updatePersistentCacheHash(e,t))}})()}_innerClearAll(){var e=this;return(0,b.A)(function*(){yield Promise.all([...e._caches.values()].map(t=>t.clear()))})()}whenInitialized(){return this._initialized??=this._internalInitialize(),this._initialized}get(e){var t=this;return(0,b.A)(function*(){yield t.whenInitialized();const n=t._caches.get(e);if(!n)throw new Error(`Cache instance with name "${e}" does not exist.`);return n})()}getOrCreate(e){var t=this;return(0,b.A)(function*(){if(yield t.whenInitialized(),!t._caches.has(e.name)){if(!e.type)throw new Error(`Cache type must be specified for cache "${e.name}".`);yield t._create({...e,type:e.type})}return t._caches.get(e.name)})()}clearAll(){var e=this;return(0,b.A)(function*(){yield e.whenInitialized(),yield e._innerClearAll()})()}validateCache(e,t){var n=this;return(0,b.A)(function*(){yield n.whenInitialized(),yield n._internalValidateCache(e,t)})()}executeWithCache(e,t,n){return this._useSystemClientCache?(0,l.from)(this.whenInitialized()).pipe((0,l.map)(()=>this._caches.get(e)),(0,l.switchMap)(function(){var i=(0,b.A)(function*(r){return{cacheValue:yield r?.get(t),cacheInstance:r}});return function(r){return i.apply(this,arguments)}}()),(0,l.switchMap)(({cacheValue:i,cacheInstance:r})=>i!=null?(0,l.of)(i):n.pipe((0,l.tap)(a=>r?.set(t,a))))):n}executeWithBulkCache(e,t){return this._useSystemClientCache?(0,l.from)(this.whenInitialized()).pipe((0,l.map)(()=>this._caches.get(e)),(0,l.switchMap)(function(){var n=(0,b.A)(function*(i){return{cachedItems:yield i?.getAll(),cacheInstance:i}});return function(i){return n.apply(this,arguments)}}()),(0,l.switchMap)(({cachedItems:n,cacheInstance:i})=>n?.length?(0,l.of)(n):t.pipe((0,l.switchMap)(function(){var r=(0,b.A)(function*(a){return yield i?.bulkSet(a),a});return function(a){return r.apply(this,arguments)}}())))):t}}var it;(function(o){o.Share="Share",o.Own="Own",o.TryConnectToShared="TryConnectToShared"})(it||(it={}));const Bc=new s.InjectionToken("USE_SYSTEM_CLIENT_CACHE",{providedIn:"root",factory:()=>!!window.__useSystemClientCache}),yg=new s.InjectionToken("CACHE_MODE"),Fc=window;class Ce{get _cacheManager(){switch(this._cacheMode){case it.Share:return Fc.cacheManager;case it.Own:return this._innerCacheManager;case it.TryConnectToShared:return Fc.cacheManager??this._innerCacheManager;default:throw new Error("Unknown cache mode")}}set _cacheManager(e){switch(this._cacheMode){case it.Share:Fc.cacheManager=e;break;case it.Own:case it.TryConnectToShared:this._innerCacheManager=e;break;default:throw new Error("Unknown cache mode")}}constructor(e,t,n,i){this._innerCacheManager=null,this._cacheMode=i||it.TryConnectToShared;const r=this._cacheMode!==it.TryConnectToShared;this._cacheManager||(this._cacheManager=new _g(e,t??[],n===!0,r))}whenInitialized(){return this._cacheManager.whenInitialized()}get(e){return this._cacheManager.get(e)}getOrCreate(e){return this._cacheManager.getOrCreate(e)}clearAll(){return this._cacheManager.clearAll()}validateCache(e,t){return this._cacheManager.validateCache(e,t)}executeWithCache(e,t,n){return this._cacheManager.executeWithCache(e,t,n)}executeWithBulkCache(e,t){return this._cacheManager.executeWithBulkCache(e,t)}static{this.\u0275fac=function(t){return new(t||Ce)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(Vs,8),s.\u0275\u0275inject(Bc,8),s.\u0275\u0275inject(yg,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ce,factory:Ce.\u0275fac,providedIn:"root"})}}const Cg=new s.InjectionToken("USE_MEASURE_PERFORMANCE_TOOLS",{providedIn:"root",factory:()=>!!window.__useMeasurePerformanceTools});class q{constructor(e){this._useMeasurePerformanceTools=e,this._consequentMeasureStartTimeCorrection=.001,this._lastNowStartTime=0,this.rendering$=new l.BehaviorSubject(null)}_getNowStartTimeWithCorrection(){const e=performance.now(),t=e<=this._lastNowStartTime?this._lastNowStartTime+this._consequentMeasureStartTimeCorrection:e;return this._lastNowStartTime=t,t}measure(e,t,n){if(!this._useMeasurePerformanceTools)return t();const i=n||this._getNowStartTimeWithCorrection(),r=t();return performance.measure(e,{start:i}),r}measureCallback(e,t){var n=this;return(0,b.A)(function*(){if(!n._useMeasurePerformanceTools)return t();const i=n._getNowStartTimeWithCorrection(),r=yield t();return performance.measure(e,{start:i}),r})()}measure$(e){if(!this._useMeasurePerformanceTools)return n=>n;let t;return n=>(0,l.of)(null).pipe((0,d.tap)(()=>t=this._getNowStartTimeWithCorrection()),(0,l.switchMap)(()=>n),(0,d.tap)(()=>{const i=typeof e=="string"?e:e();performance.measure(i,{start:t})}))}static{this.\u0275fac=function(t){return new(t||q)(s.\u0275\u0275inject(Cg,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:q,factory:q.\u0275fac,providedIn:"root"})}}class _t{constructor(){this.cultureInfo=new Xo,this.defCultureInfo=new Xo}}const Re="Information about the current user is not initialized yet. Use UserInfoService to load current user information.";function bg(){return{get id(){throw new ReferenceError(Re)},get contactId(){throw new ReferenceError(Re)},get contactName(){throw new ReferenceError(Re)},get accountId(){throw new ReferenceError(Re)},get accountName(){throw new ReferenceError(Re)},get isSSP(){throw new ReferenceError(Re)},get timeZoneId(){throw new ReferenceError(Re)},get cultureInfo(){throw new ReferenceError(Re)},get defCultureInfo(){throw new ReferenceError(Re)},get timeZoneOffsetHours(){throw new ReferenceError(Re)},get photoId(){throw new ReferenceError(Re)},get accessType(){throw new ReferenceError(Re)},get sessionId(){throw new ReferenceError(Re)}}}const be=bg(),Zd={get id(){return be.id},get contactId(){return be.contactId},get contactName(){return be.contactName},get accountId(){return be.accountId},get accountName(){return be.accountName},get isSSP(){return be.isSSP},get timeZoneId(){return be.timeZoneId},get cultureInfo(){return be.cultureInfo},get defCultureInfo(){return be.defCultureInfo},get timeZoneOffsetHours(){return be.timeZoneOffsetHours},get photoId(){return be.photoId},get accessType(){return be.accessType},get sessionId(){return be.sessionId}};Object.freeze(Zd);const vg={provide:_t,useFactory:()=>Zd};class pi extends di{constructor(e,t,n){super(),this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._serviceEndpoint="/ServiceModel/UserInfoService.svc"}_applyUserInfo(e){Object.keys(be).forEach(t=>{delete be[t]}),Object.assign(be,e)}loadCurrentUserInfo(){if(!this._userInfo$){const e=`${this._serviceEndpoint}/GetCurrentUserInfo`;this._userInfo$=this._cacheManager.executeWithCache(zd,ug,this._httpClient.post(e,null)).pipe(this._measurePerformanceService.measure$("UserInfoService: load current user info with cache"),(0,l.tap)(t=>this._applyUserInfo(t?.userInfo)),(0,l.shareReplay)({bufferSize:1,refCount:!1}))}return this._userInfo$}static{this.\u0275fac=function(t){return new(t||pi)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:pi,factory:pi.\u0275fac,providedIn:"root"})}}var mi;(function(o){o[o.EntitySchema=3]="EntitySchema",o[o.ClientUnitSchema=4]="ClientUnitSchema"})(mi||(mi={}));class Sg{get closed(){return this._closed}constructor(e){this._initialTeardown=e,this._closed=!1}unsubscribe(){this._closed||(this._closed=!0,(0,v.isFunction)(this._initialTeardown)&&this._initialTeardown())}}var Bs;(function(o){o.PTP="PTPMsg",o.BROADCAST="BroadcastMsg",o.SERVER="ServerMsg"})(Bs||(Bs={}));var Yd=y(52874);const Mg=new s.InjectionToken("MessageChannelAccessTokenFactory");var Kd=y(66736);class Fs{constructor(e){this._zone=e,this._message$=new l.Subject}init(e,t){return this._zone.runOutsideAngular(()=>{const n=t?{accessTokenFactory:t,withCredentials:!0}:void 0;return this._connection=new Kd.HubConnectionBuilder().withUrl(e,n).withAutomaticReconnect().withHubProtocol(new Kd.JsonHubProtocol).build(),this._connection.on("ServerMessage",i=>this._zone.run(()=>this._message$.next(i))),(0,l.from)(this._connection.start())})}sendMessage(e){return(0,l.from)(this._connection.send("SendMessage",e))}getMessages(){return this._message$}ngOnDestroy(){this._connection.off("ServerMessage"),this._message$.complete(),this._connection.stop().then()}static{this.\u0275fac=function(t){return new(t||Fs)(s.\u0275\u0275inject(s.NgZone))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Fs,factory:Fs.\u0275fac,providedIn:"root"})}}var wg=y(5766);const xg=1e3,Jd=3e4,qd=1e4,Xd="ping",zc="pong";class zs{constructor(e){this._ngZone=e}_createHeartbeatRequestMessage(){return{Id:L(),Header:{Sender:"ConsoleCommand",BodyTypeName:"System.String"},Body:Xd}}_isHeartbeatRequestMessage(e){const t=e.Header?.Sender==="ConsoleCommand",n=e.Body===Xd;return t&&n}_isHeartbeatResponseMessage(e){const t=e.Header?.Sender==="CommandService",n=e.Body===zc;return t&&n}startHeartbeat(e){this.stopHeartbeat(),this._ngZone.runOutsideAngular(()=>{console.log(`WS-Heartbeat: connection ping scheduled for every [${Jd/1e3}] sec`);const t=(0,l.timer)(xg,Jd).pipe((0,l.tap)(()=>{e.next(this._createHeartbeatRequestMessage())}),(0,l.concatMap)(()=>(0,l.race)(e.pipe((0,l.filter)(n=>this._isHeartbeatResponseMessage(n)),(0,l.take)(1),(0,l.map)(n=>n.Body)),(0,l.of)("timeout").pipe((0,l.delay)(qd)))));this._subscription=t.subscribe(n=>{switch(n){case zc:console.log(`WS-Heartbeat: Server responded with: ${zc}`);break;case"timeout":console.error(`WS-Heartbeat: Server failed to respond in ${qd/1e3} seconds`);break}})})}stopHeartbeat(){this._subscription?.unsubscribe()}excludeHeartbeatResponses(){return(0,l.filter)(e=>!this._isHeartbeatRequestMessage(e)&&!this._isHeartbeatResponseMessage(e))}ngOnDestroy(){this.stopHeartbeat()}static{this.\u0275fac=function(t){return new(t||zs)(s.\u0275\u0275inject(s.NgZone))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:zs,factory:zs.\u0275fac,providedIn:"root"})}}const Qd=[1,2e3,5e3,1e4,2e4,...Array(10).fill(3e4)],Eg=Qd.length;class Us{constructor(e){this._heartbeatService=e,this._reconnectAttempts=0,this._webSocketCreated$=new l.ReplaySubject(1),this._reconnected$=new l.Subject,this._isInitialConnection=!0}get reconnected$(){return this._reconnected$.asObservable()}_maxReconnectAttemptsReached(){return this._reconnectAttempts>=Eg}_resetReconnectAttempts(){this._reconnectAttempts=0}_getWebSocketUrl(){var e=this;return(0,b.A)(function*(){const t=yield e._accessTokenFactory?.();return t?`${e._serverUrl}?access_token=${encodeURIComponent(t)}`:e._serverUrl})()}_scheduleReconnectionAttempt(e){if(this._maxReconnectAttemptsReached()){console.error("WebSocket: Max reconnect attempts reached",e);return}const t=Qd[this._reconnectAttempts];setTimeout(()=>{this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!0}).catch(console.error),this._reconnectAttempts++},t)}_handleWebSocketClosed(e){this._heartbeatService.stopHeartbeat(),this._scheduleReconnectionAttempt(e)}_createAndConnectWebSocketAsync(e){var t=this;return(0,b.A)(function*(){let n;try{n=yield t._getWebSocketUrl()}catch(i){throw e.reconnectOnAccessTokenFactoryError&&t._scheduleReconnectionAttempt(i),i}return new Promise(i=>{t._webSocket$=(0,wg.webSocket)({url:n,openObserver:{next:()=>{console.log(`Websocket channel opened for url: ${t._serverUrl}`),t._heartbeatService.startHeartbeat(t._webSocket$),t._resetReconnectAttempts(),t._isInitialConnection||(console.log("WebSocket reconnected successfully"),t._reconnected$.next()),t._isInitialConnection=!1,i()}}}),t._webSocketSubscription?.unsubscribe(),t._webSocketSubscription=t._webSocket$.subscribe({error:r=>t._handleWebSocketClosed(r),complete:()=>t._handleWebSocketClosed()}),t._webSocketCreated$.next(t._webSocket$)})})()}_subscribeToSocketMessages(e,t){return e.pipe(this._heartbeatService.excludeHeartbeatResponses()).subscribe({next:n=>t.next(n),error:()=>{this._maxReconnectAttemptsReached()&&t.error(new Error("Max reconnect attempts reached"))}})}init(e,t){return this._serverUrl=e,this._accessTokenFactory=t,(0,l.from)(this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!1}))}sendMessage(e){return new l.Observable(t=>{this._webSocket$.next(e),t.next(),t.complete()})}getMessages(){return new l.Observable(e=>{let t;const n=this._webSocketCreated$.subscribe(i=>{t?.unsubscribe(),t=this._subscribeToSocketMessages(i,e)});return()=>{t.unsubscribe(),n.unsubscribe()}})}ngOnDestroy(){this._heartbeatService.stopHeartbeat(),this._webSocket$?.complete(),this._webSocketSubscription?.unsubscribe(),this._reconnected$.complete()}static{this.\u0275fac=function(t){return new(t||Us)(s.\u0275\u0275inject(zs))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Us,factory:Us.\u0275fac,providedIn:"root"})}}class ze{static create(e){const t=new ze;return Object.assign(t,e),t}get isDebugEnabled(){return!!window.Terrasoft?.isDebug}static{this.\u0275fac=function(t){return new(t||ze)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac,providedIn:"root"})}}var Uc;(function(o){o.Production="production",o.PreProduction="pre-production",o.Development="development"})(Uc||(Uc={}));const eh=ze.create({serviceUrl:"",clientConnectionClassName:""}),gM={provide:ze,useFactory:()=>eh};let $s=class Cc{constructor(e,t,n){this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._serviceEndpoint="ServiceModel/ApplicationInfoService.svc/"}_initApplicationInfo(){const e=this._serviceEndpoint+"GetApplicationInfo";this._applicationInfoObservable$=this._cacheManager.executeWithCache(Ud,dg,this._httpClient.post(e,null)).pipe(this._measurePerformanceService.measure$("ApplicationInfoService: load application info with cache"),(0,d.map)(t=>{const n=t?.applicationInfo,i=ze.create(n);return Object.assign(eh,i),t}),(0,d.shareReplay)({bufferSize:1,refCount:!1})),this._applicationInfoObservable$.subscribe()}loadApplicationInfo(){return this._applicationInfoObservable$||this._initApplicationInfo(),this._applicationInfoObservable$}loadApplicationResources(){const e=this._serviceEndpoint+"GetApplicationResources";return this._cacheManager.executeWithCache(Ud,"AppResources",this._httpClient.post(e,null))}loadSysValues(){return this.loadApplicationInfo().pipe((0,d.map)(e=>e?.applicationInfo?.sysValues))}getCoreVersion(){return this._coreVersion?(0,l.of)(this._coreVersion):this.loadSysValues().pipe((0,l.tap)(e=>this._coreVersion=e?.coreVersion),(0,d.map)(()=>this._coreVersion))}getIsProductionEnvironment(){return(this._environmentType?(0,l.of)(this._environmentType):this.loadSysValues().pipe((0,l.tap)(t=>this._environmentType=t?.environmentType),(0,d.map)(()=>this._environmentType))).pipe((0,d.map)(t=>t===Uc.Production))}static{this.\u0275fac=function(t){return new(t||Cc)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Cc,factory:Cc.\u0275fac,providedIn:"root"})}};$s=(0,u.__decorate)([Xe({requestType:"crt.SysValuesService"}),(0,u.__metadata)("design:paramtypes",[U.HttpClient,Ce,q])],$s);const fM={provide:s.APP_INITIALIZER,useFactory:o=>()=>o.loadApplicationInfo(),deps:[$s],multi:!0};let Qo=class bc{get reconnected$(){return this.msgChannel?.reconnected$||l.EMPTY}constructor(e,t,n,i){this.injector=i,this._destroyed$=new l.Subject,this.init$=new l.ReplaySubject(1),this.messageEvent$=new l.Subject,!e.clientConnectionClassName||e.clientConnectionClassName===""?t.loadApplicationInfo().subscribe(r=>{this._initialize(r.applicationInfo,n)}):this._initialize(e,n)}_initialize(e,t){this.msgChannel=this._getChannel(e.clientConnectionClassName),this._initChannel(e.serviceUrl,t)}_getChannel(e){switch(e){case"Terrasoft.WebSocketChannel":return this.injector.get(Us);case"Terrasoft.SignalRChannel":return this.injector.get(Fs)}}_buildMessageEvent(e){let t;if(e.Body&&typeof e.Body=="string")try{t=JSON.parse(e.Body)}catch(n){return(0,s.isDevMode)()&&console.warn(`MessageChannelService. Parse error: ${n}`),null}else e.Body&&typeof e.Body=="object"&&(t=e.Body);return{header:{sender:e?.Header?.Sender,bodyTypeName:e?.Header?.BodyTypeName},body:t,id:e.Id}}_subscribeToMsgChannel(){this.msgChannel.getMessages().pipe((0,d.takeUntil)(this._destroyed$)).subscribe(e=>{const t=this._buildMessageEvent(e);t&&this.messageEvent$.next(t)})}_initChannel(e,t){this.msgChannel.init(e,t).subscribe({complete:()=>{this.init$.next(this.msgChannel),this._subscribeToMsgChannel()}})}_sendMessageInternal(e,t,n){const i={Id:Yd.Guid.create().toString(),Header:{Sender:e,BodyTypeName:"System.String",ChannelType:t},Body:JSON.stringify(n)};return this.init$.pipe((0,l.take)(1),(0,d.switchMap)(()=>this.msgChannel.sendMessage(i)))}getMessages(e){return B.checkArgumentEmpty("sender",e),this.messageEvent$.pipe((0,d.filter)(t=>t.header.sender===e))}subscribe(e,t){B.checkArgumentEmpty("sender",e),B.checkArgumentEmpty("callback",t);const n=this.getMessages(e).subscribe(t);return Promise.resolve(new Sg(()=>n.unsubscribe()))}sendMessage(e,t,n){let i,r;const a=!!n;a?(i=e,r=t,B.checkStringIsNotEmpty("sender",i),B.checkEnumOutOfRange("channelType",n,Bs)):(r=e,i=t,B.checkArgumentEmpty("channelType",i),B.checkEnumOutOfRange("channelType",i,Bs));const c=this._sendMessageInternal(i,n,r);return a?(0,l.firstValueFrom)(c):c}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.init$.complete(),this.messageEvent$.complete()}static{this.\u0275fac=function(t){return new(t||bc)(s.\u0275\u0275inject(ze),s.\u0275\u0275inject($s),s.\u0275\u0275inject(Mg,8),s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:bc,factory:bc.\u0275fac,providedIn:"root"})}};Qo=(0,u.__decorate)([Xe({requestType:"crt.MessageChannelService"}),(0,u.__metadata)("design:paramtypes",[ze,$s,Function,s.Injector])],Qo);const Ig=new s.InjectionToken("Represents a list of schema change message predicates"),Ag=new s.InjectionToken("Represents a list of schema remove message predicates"),Pg=new s.InjectionToken("Represents a list of schema rights message predicates");class bn{constructor(e,t,n,i,r){this._messageChannelService=e,this._broadcastChannelFactory=t,this._changePredicates=n,this._removePredicates=i,this._rightsPredicates=r,this._destroyed$=new l.Subject,this.schemaChanged$=new l.Subject,this.schemaRemoved$=new l.Subject,this.rightsChanged$=new l.Subject,this.requireJsChanged$=new l.Subject,this._subscribeMessageChannelEvent()}_getSchemaType(e){let t;switch(e){case"ClientUnitSchemaManager":t=mi.ClientUnitSchema;break;case"EntitySchemaManager":t=mi.EntitySchema;break}return t}_processMessage(e,t){const n=e.body,i=this._getSchemaType(n.ManagerName);i&&t.next({name:n.Name,uId:n.UId,schemaType:i,userId:n.UserId,isNew:n.IsNew,extendParent:n.ExtendParent})}_subscribeMessageChannelEvent(){this._messageChannelService.messageEvent$.pipe((0,d.filter)(e=>this._changePredicates?.some(t=>t(e))),(0,d.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaChanged$)),this._messageChannelService.messageEvent$.pipe((0,d.filter)(e=>this._removePredicates?.some(t=>t(e))),(0,d.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaRemoved$)),this._messageChannelService.messageEvent$.pipe((0,d.filter)(e=>this._rightsPredicates?.some(t=>t(e))),(0,d.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.rightsChanged$)),this._broadcastChannelFactory.createInstance("schema-requirejs-path-changed").messages$.subscribe(e=>this._processMessage({body:e},this.requireJsChanged$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.schemaChanged$.complete()}static{this.\u0275fac=function(t){return new(t||bn)(s.\u0275\u0275inject(Qo),s.\u0275\u0275inject(ri),s.\u0275\u0275inject(Ig,8),s.\u0275\u0275inject(Ag,8),s.\u0275\u0275inject(Pg,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:bn,factory:bn.\u0275fac,providedIn:"root"})}}class Gs{constructor(e){this.schemaChangeListener=e,this._repository=new Map,this._uIdMap=new Map,this._destroyed$=new l.Subject,this.schemaChangeListener.schemaChanged$.pipe((0,d.filter)(t=>t.schemaType===this.provider.schemaType),(0,d.takeUntil)(this._destroyed$)).subscribe(t=>this.clearSchemaCacheByUId(t.uId))}add(e){this._repository.set(e.name,e),this._uIdMap.set(e.uId,e.name)}getCachedSchema(e){return this._repository.get(e)}getIsSchemaCached(e){return this._repository.has(e)}getCachedSchemesNames(){return[...this._repository.keys()]}getSchemaByName(e){const t=this.getCachedSchema(e);return t?(0,l.of)(t):this.provider.getSchemaByName(e).pipe((0,d.tap)(n=>this.add(n)))}getSchemaByUId(e){const t=this._uIdMap.get(e),n=t&&this.getCachedSchema(t);return n?(0,l.of)(n):this.provider.getSchemaByUId(e).pipe((0,d.tap)(i=>this.add(i)))}clearSchemaCacheByName(e){const t=this.getCachedSchema(e);t&&this._uIdMap.delete(t.uId),this._repository.delete(e)}clearSchemaCacheByUId(e){const t=this._uIdMap.get(e);t&&this._repository.delete(t),this._uIdMap.delete(e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Gs)(s.\u0275\u0275inject(bn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Gs,factory:Gs.\u0275fac})}}class ea{static getPathItemInfo(e){const n=/\[([\w-]+):([\w-]+):?([\w-]*)]$/g.exec(e);if(n){const i=n[1],r=n[2],a=n[3];return{isBackReference:!0,referenceSchemaName:i,referenceSchemaColumnName:r,columnName:a}}return{isBackReference:!1,columnName:e}}static getLastBackwardSchemaNameByColumnPath(e){let t="";return e?.split(".").reverse()?.forEach(i=>{t||i.includes("[")&&(t=this.getPathItemInfo(i).referenceSchemaName)}),t}static getLastForwardColumnPath(e){const t=e?.split(".")||[],n=t.map(i=>i.includes("[")).lastIndexOf(!0);return n===-1?e:t.slice(n+1).join(".")}}var ta;(function(o){o.List="List",o.SelectionWindow="SelectionWindow"})(ta||(ta={}));class $c{get isLookupType(){return this.dataValueType?this.dataValueType===_.Lookup:!1}constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.columnCaptionPath=e.columnCaptionPath,this.dataValueType=e.dataValueType,this.usageType=e.usageType,this.referenceSchemaUId=e.referenceSchemaUId,this.referenceSchemaName=e.referenceSchemaName,this.isRequired=e.isRequired,this.isValueCloneable=e.isValueCloneable,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.defaultValueSchema=e.defaultValueSchema,this.lookupMode=e.lookupMode,this.useSeconds=e.useSeconds)}}class Tg{constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.extendParent=e.extendParent,this.packageUId=e.packageUId)}}class th extends Tg{getPrimaryColumn(){return this.primaryColumnUId&&this.columns?.find(e=>e.uId===this.primaryColumnUId)}getPrimaryDisplayColumn(){return this.primaryDisplayColumnUId&&this.columns?.find(e=>e.uId===this.primaryDisplayColumnUId)}getPrimaryColorColumn(){return this.primaryColorColumnUId&&this.columns?.find(e=>e.uId===this.primaryColorColumnUId)}getHierarchyColumn(){return this.hierarchyColumnUId&&this.columns?.find(e=>e.uId===this.hierarchyColumnUId)}getCreatedOnColumn(){return this.createdOnColumnUId&&this.columns?.find(e=>e.uId===this.createdOnColumnUId)}getCreatedByColumn(){return this.createdByColumnUId&&this.columns?.find(e=>e.uId===this.createdByColumnUId)}getModifiedOnColumn(){return this.modifiedOnColumnUId&&this.columns?.find(e=>e.uId===this.modifiedOnColumnUId)}getModifiedByColumn(){return this.modifiedByColumnUId&&this.columns?.find(e=>e.uId===this.modifiedByColumnUId)}}var st;(function(o){o[o.None=0]="None",o[o.Const=1]="Const",o[o.Settings=2]="Settings",o[o.SystemValue=3]="SystemValue",o[o.Sequence=4]="Sequence"})(st||(st={}));const O="DataValueType",Gc={[_.Date]:{type:_.Date,id:"603d4960-a1a2-45e9-b232-206a54421b01",name:"Date",icon:"data-type-date-icon.svg",designerIcon:y(26861),translateKey:`${O}.DateCaption`},[_.Time]:{type:_.Time,id:"04cc757b-8f06-482c-8a1a-0c0e171d2410",name:"Time",icon:"data-type-time-icon.svg",designerIcon:y(8510),translateKey:`${O}.TimeCaption`},[_.DateTime]:{type:_.DateTime,id:"d21e9ef4-c064-4012-b286-fa1a8171da44",name:"DateTime",icon:"data-type-datetime-icon.svg",designerIcon:y(55146),translateKey:`${O}.DateTimeCaption`},[_.Text]:{type:_.Text,id:"8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",name:"Text",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${O}.TextCaption`},[_.SHORT_TEXT]:{type:_.SHORT_TEXT,id:"325a73b8-0f47-44a0-8412-7606f78003ac",name:"ShortText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${O}.ShortTextCaption`},[_.PHONE_TEXT]:{type:_.PHONE_TEXT,id:"26cba63c-daf1-4f36-b2ea-73c0d675d90c",name:"PhoneText",icon:"data-type-phone-icon.svg",designerIcon:y(59155),translateKey:`${O}.PhoneTextCaption`},[_.WEB_TEXT]:{type:_.WEB_TEXT,id:"26cba64c-daf1-4f36-b2ea-73c0d695d90c",name:"WebText",icon:"data-type-text-icon.svg",designerIcon:y(64337),translateKey:`${O}.WebTextCaption`},[_.EMAIL_TEXT]:{type:_.EMAIL_TEXT,id:"66cba64c-daf1-4f36-b8ea-73c0d695d90c",name:"EmailText",icon:"data-type-text-icon.svg",designerIcon:y(71011),translateKey:`${O}.EmailTextCaption`},[_.MEDIUM_TEXT]:{type:_.MEDIUM_TEXT,id:"ddb3a1ee-07e8-4d62-b7a9-d0e618b00fbd",name:"MediumText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${O}.MediumTextCaption`},[_.LONG_TEXT]:{type:_.LONG_TEXT,id:"5ca35f10-a101-4c67-a96a-383da6afacfc",name:"LongText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${O}.LongTextCaption`},[_.MAXSIZE_TEXT]:{type:_.MAXSIZE_TEXT,id:"c0f04627-4620-4bc0-84e5-9419dc8516b1",name:"MaxSizeText",icon:"data-type-unlimited-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:y(97180),designerAutonumberIcon:y(78683),translateKey:`${O}.MaxSizeTextCaption`},[_.Integer]:{type:_.Integer,id:"6b6b74e2-820d-490e-a017-2b73d4ccf2b0",name:"Integer",icon:"data-type-integer-icon.svg",designerIcon:y(60521),translateKey:`${O}.IntegerCaption`},[_.FLOAT0]:{type:_.FLOAT0,id:"60532cfd-8645-4a54-be81-bef507aa2339",name:"Float0",icon:"data-type-float0-icon.svg",designerIcon:y(68877),translateKey:`${O}.FLOAT0Caption`},[_.FLOAT1]:{type:_.FLOAT1,id:"07ba84ce-0bf7-44b4-9f2c-7b15032eb98c",name:"Float1",icon:"data-type-float1-icon.svg",designerIcon:y(68877),translateKey:`${O}.FLOAT1Caption`},[_.FLOAT2]:{type:_.FLOAT2,id:"5cc8060d-6d10-4773-89fc-8c12d6f659a6",name:"Float2",icon:"data-type-float2-icon.svg",designerIcon:y(68877),translateKey:`${O}.FLOAT2Caption`},[_.FLOAT3]:{type:_.FLOAT3,id:"3f62414e-6c25-4182-bcef-a73c9e396f31",name:"Float3",icon:"data-type-float3-icon.svg",designerIcon:y(68877),translateKey:`${O}.FLOAT3Caption`},[_.FLOAT4]:{type:_.FLOAT4,id:"ff22e049-4d16-46ee-a529-92d8808932dc",name:"Float4",icon:"data-type-float4-icon.svg",designerIcon:y(68877),translateKey:`${O}.FLOAT4Caption`},[_.FLOAT8]:{type:_.FLOAT8,id:"a4aaf398-3531-4a0d-9d75-a587f5b5b59e",name:"Float8",icon:"data-type-float8-icon.svg",designerIcon:y(68877),translateKey:`${O}.FLOAT8Caption`},[_.Guid]:{type:_.Guid,id:"23018567-a13c-4320-8687-fd6f9e3699bd",name:"Guid",icon:"data-type-guid-icon.svg",designerIcon:y(92458),translateKey:`${O}.GuidCaption`},[_.Lookup]:{type:_.Lookup,id:"b295071f-7ea9-4e62-8d1a-919bf3732ff2",name:"Lookup",icon:"data-type-lookup-icon.svg",designerIcon:y(61631),translateKey:`${O}.LookupCaption`},[_.Boolean]:{type:_.Boolean,id:"90b65bf8-0ffc-4141-8779-2420877af907",name:"Boolean",icon:"data-type-boolean-icon.svg",designerIcon:y(36659),translateKey:`${O}.BooleanCaption`},[_.HASH_TEXT]:{type:_.HASH_TEXT,id:"ecbcce18-2a17-4ead-829a-9d02fa9578a4",name:"HashText",icon:"data-type-crs-text-icon.svg",designerIcon:y(97180),translateKey:`${O}.HashTextCaption`},[_.SECURE_TEXT]:{type:_.SECURE_TEXT,id:"3509b9dd-2c90-4540-b82e-8f6ae85d8248",name:"SecureText",icon:"data-type-encrypted-text-icon.svg",designerIcon:y(28010),translateKey:`${O}.SecureTextCaption`},[_.IMAGELOOKUP]:{type:_.IMAGELOOKUP,id:"b039feb0-ee7c-4884-8aa6-d6d45d84316f",name:"ImageLookup",icon:"data-type-image-link-icon.svg",designerIcon:y(65689),translateKey:`${O}.ImageLookupCaption`},[_.Money]:{type:_.Money,id:"969093e2-2b4e-463b-883a-3d3b8c61f0cd",name:"Money",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${O}.MoneyCaption`},[_.MONEY0]:{type:_.MONEY0,id:"6cc9cbe3-a486-4ed3-bea6-5c96f36d77ff",name:"Money0",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${O}.Money0Caption`},[_.MONEY1]:{type:_.MONEY1,id:"8842ed44-069a-4fae-b1a2-ee17384689eb",name:"Money1",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${O}.Money1Caption`},[_.MONEY3]:{type:_.MONEY3,id:"85ff33ce-d57d-4197-9e9b-c2dcb1cfc35e",name:"Money3",icon:"data-type-currency-icon.svg",designerIcon:y(32643),translateKey:`${O}.Money3Caption`},[_.Float]:{type:_.Float,id:"57ee4c31-5ec4-45fa-b95d-3a2868aa89a8",name:"Float",icon:"data-type-float1-icon.svg",designerIcon:y(68877),translateKey:`${O}.FloatCaption`},[_.FILE]:{type:_.FILE,id:"a33c9252-d401-453e-949d-169157067ed9",name:"File",icon:"data-type-file-icon.svg",designerIcon:y(55039),translateKey:`${O}.FileCaption`},[_.Image]:{type:_.Image,id:"fa6e6e49-b996-475e-a77e-73904e4c5a88",name:"Image",icon:"data-type-image-icon.svg",designerIcon:y(55039),translateKey:`${O}.ImageCaption`},[_.Blob]:{type:_.Blob,id:"b7342b7a-5dde-40de-aa7c-24d2a57b3202",name:"Blob",icon:"data-type-blob-icon.svg",designerIcon:y(55039),translateKey:`${O}.BlobCaption`},[_.Color]:{type:_.Color,id:"dafb71f9-ee9f-4e0b-a4d7-37aa15987155",name:"Color",icon:"data-type-color-icon.svg",designerIcon:y(39078),translateKey:`${O}.ColorCaption`},[_.RICH_TEXT]:{type:_.RICH_TEXT,id:"79bccffa-8c8b-4863-b376-a69d2244182b",name:"RichText",icon:"data-type-rich-text-icon.svg",designerIcon:y(67021),translateKey:`${O}.RichCaption`},[_.ENTITY]:{type:_.ENTITY,id:"ebd85d37-0abf-4bbf-bb32-97dc3dffcc8c",name:"Entity",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.Entity`},[_.ENTITY_COLLECTION]:{type:_.ENTITY_COLLECTION,id:"51fb23ba-3eb2-11e2-b7d5-b0c76188709b",name:"EntityCollection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.EntityCollection`},[_.ENTITY_COLUMN_MAPPING_COLLECTION]:{type:_.ENTITY_COLUMN_MAPPING_COLLECTION,id:"b53eaa2a-4bb7-4a6b-9f4f-58ccab293e31",name:"EntityColumnMappingCollection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.EntityColumnMappingCollection`},[_.CUSTOM_OBJECT]:{type:_.CUSTOM_OBJECT,id:"84ed6865-9692-4c98-aaed-4d15b96a95c2",name:"CustomObject",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.CustomObject`},[_.OBJECT_LIST]:{type:_.OBJECT_LIST,id:"4b51a8b5-1ee9-4437-9d58-f35e083cbcdf",name:"ObjectList",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.ObjectList`},[_.COMPOSITE_OBJECT_LIST]:{type:_.COMPOSITE_OBJECT_LIST,id:"651ec16f-d140-46db-b9e2-825c985a8ac2",name:"CompositeObjectList",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.CompositeObjectList`},[_.COMPOSITE_OBJECT]:{type:_.COMPOSITE_OBJECT,id:"632e4371-0a7f-46cd-a284-a623b3933027",name:"CompositeObject",icon:"data-type-composite-object-icon.svg",designerIcon:y(97180),translateKey:`${O}.CompositeObject`},[_.COLLECTION]:{type:_.COLLECTION,name:"Collection",icon:"data-type-other-icon.svg",designerIcon:y(97180),translateKey:`${O}.Collection`},[_.LOCALIZABLE_STRING]:{type:_.LOCALIZABLE_STRING,id:"95c6e6c4-2cc8-46be-a1cb-96f942655f86",name:"LocalizableString",icon:"data-type-text-icon.svg",designerIcon:y(97180),translateKey:`${O}.LocalizableString`},[_.METADATA_TEXT]:{type:_.METADATA_TEXT,id:"394e160f-c8e0-46fa-9c0d-75d97e9e9169",name:"MetaDataText",icon:"data-type-text-icon.svg",designerIcon:y(97180),translateKey:`${O}.MetaDataText`}},_M={DateTime:[_.Date,_.Time,_.DateTime],Text:[_.Text,_.SHORT_TEXT,_.MEDIUM_TEXT,_.LONG_TEXT,_.PHONE_TEXT,_.WEB_TEXT,_.EMAIL_TEXT,_.MAXSIZE_TEXT,_.LOCALIZABLE_STRING,_.RICH_TEXT],Number:[_.FLOAT0,_.FLOAT1,_.FLOAT2,_.FLOAT3,_.FLOAT4,_.FLOAT8,_.Integer,_.MONEY0,_.MONEY1,_.Money,_.MONEY3,_.Float],Lookup:[_.Lookup,_.IMAGELOOKUP]};class Dg{static _getDefaultValue(e){if(!e)return null;if(e.source===st.Sequence)return{valueSourceType:st.Sequence,value:"Sequence",sequencePrefix:e.sequencePrefix,sequenceNumberOfChars:e.sequenceNumberOfChars};if(e.source===st.Const){const t=e.value,n=typeof t=="string"?t:t.value;return{valueSourceType:st.Const,value:n,valueSource:n,sequenceNumberOfChars:0}}return e.source===st.Settings?{valueSourceType:st.Settings,value:e.calculatedValue,valueSource:e.value,sequenceNumberOfChars:0}:e.source===st.SystemValue?{valueSourceType:st.SystemValue,value:e.calculatedValue,valueSource:e.sourceValue,sequenceNumberOfChars:0}:{valueSourceType:e.source,value:null,sequenceNumberOfChars:0}}static _getPrimaryDisplayColorColumnUId(e){if(!e.primaryColorColumnName)return null;const t=Object.values(e.columns).find(n=>n.name===e.primaryColorColumnName);if(!t)throw new Error(`Primary color column set in object ${e.name} but column ${e.primaryColorColumnName} does not exist`);return t?.uId}static map(e,t){const n={};return Object.entries(e.columns).forEach(([,i])=>{const r=i,a=r.dataValueTypeName==="Binary"?"Blob":r.dataValueTypeName,c=Object.entries(Gc).find(([,m])=>m.name===a),h=c?Number(c[0]):r.dataValueType,p=this._getDefaultValue(r.defaultValue);n[r.uId]={uId:r.uId,name:r.name,caption:{[t]:r.caption},dataValueType:h,isInherited:!!r.isInherited,isRequired:!!r.isRequired,isValueCloneable:!!r.isValueCloneable,usageType:r.usageType,referenceSchemaName:r.referenceSchemaName,isMasked:!!r.isMasked,isFormatValidated:!!r.isFormatValidated,isSimpleLookup:!!r.isSimpleLookup,isSensitiveData:!!r.isSensitiveData,isValueMasked:!!r.isValueMasked,valueMaskingSettings:r.valueMaskingSettings,useSeconds:!!r.useSeconds,defValue:p}}),{administratedByOperations:e.administratedByOperations,administratedByRecords:e.administratedByRecords,useMasterRecordRights:e.useMasterRecordRights,masterRecordSchemaName:e.masterRecordSchemaName,primaryColumnUId:e.primaryColumn?.uId,primaryDisplayColumnUId:e.primaryDisplayColumn?.uId,primaryColorColumnUId:this._getPrimaryDisplayColorColumnUId(e),hierarchyColumnUId:e.hierarchyColumnUId,createdOnColumnUId:e.createdOnColumnUId,createdByColumnUId:e.createdByColumnUId,modifiedOnColumnUId:e.modifiedOnColumnUId,modifiedByColumnUId:e.modifiedByColumnUId,uId:e.uId,name:e.name,caption:{[t]:e.caption},columns:{Items:n},isVirtual:!!e.isVirtual,isDBView:!!e.isDBView,administratedByColumns:!!e.administratedByColumns,description:{[t]:e.description},parentUId:e.parentUId,isTrackChangesInDB:!!e.isTrackChangesInDB,extendParent:!!e.extendParent}}}const Og="runtime-entity-schema";let Hc=class{constructor(e){this._window=e}_getItems(e,t=[]){var n=this;let i=[];const r=[...t];return new Promise(a=>{this._window.require(e,(0,b.A)(function*(...c){i=yield Promise.all(c.map(h=>n.map(h))),a({schemes:i,notFoundSchemes:r})}),c=>{const h=c.requireModules??[];r.push(...h),e=e.filter(p=>!h.includes(p)),e.length===0&&a({schemes:i,notFoundSchemes:r}),a(this._getItems(e,r))})})}map(e){return Promise.resolve(e)}get(e){var t=this;return new Promise(n=>{this._window.require([e],function(){var i=(0,b.A)(function*(r){const a=yield t.map(r);n(a)});return function(r){return i.apply(this,arguments)}}(),()=>{n(null)})})}getItems(e){return this._getItems(e,[])}};Hc=(0,u.__decorate)([(0,u.__param)(0,(0,s.Inject)(Qe)),(0,u.__metadata)("design:paramtypes",[Object])],Hc);class vn{constructor(e,t){this._userInfo=e,this._httpClient=t}_getServiceUrlSspPart(){return this._userInfo.isSSP?"ssp/":""}_getDataServiceUrlWithSspPart(){return`DataService/${this._getServiceUrlSspPart()}`}getSchemaDesignerServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/SchemaDesignerRequest"}getRuntimeEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemaRequest"}getEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/EntitySchemaRequest"}getRuntimeEntitySchemeServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemesRequest"}getEntity(e){return(0,l.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemaServiceEndpoint(),{name:e}))}getEntities(e){return(0,l.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemeServiceEndpoint(),e))}static{this.\u0275fac=function(t){return new(t||vn)(s.\u0275\u0275inject(_t),s.\u0275\u0275inject(U.HttpClient))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:vn,factory:vn.\u0275fac,providedIn:"root"})}}const Wc=["SysSettings"];class Hs extends Hc{constructor(e,t,n,i,r,a,c){super(e),this._featureValues=t,this._userInfo=n,this._entityHttpService=i,this._cacheManager=r,this._schemaChangeListener=a,this._measurePerformanceService=c,this._destroyed$=new l.Subject,this._schemaChangeListener.schemaChanged$.pipe((0,d.filter)(h=>h.schemaType===mi.EntitySchema),(0,d.switchMap)(h=>(0,l.from)(this._clearSchemaCacheByName(h.name))),(0,d.takeUntil)(this._destroyed$)).subscribe()}get _entitySchemaCache(){return this._cacheManager.getOrCreate({name:Og,type:ce.Memory})}_clearSchemaCacheByName(e){var t=this;return(0,b.A)(function*(){t._featureValues.DisableRuntimeEntitySchemaCaching||(yield t._measurePerformanceService.measureCallback("EntityRequireService: clear schema cache",(0,b.A)(function*(){yield(yield t._entitySchemaCache).delete(e)})))})()}_getLookupEntities(e){const t=e.flatMap(i=>Object.values(i.columns.Items).filter(r=>r.dataValueType===_.Lookup&&r.referenceSchemaName&&!e.find(a=>a.name===r.referenceSchemaName)).map(r=>r.referenceSchemaName)),n=[...new Set(t)];return this.getItems(n)}_getReferenceEntityNameFromBackReferencePath(e){return ea.getPathItemInfo(e).referenceSchemaName}_getReferenceSchemaName(e,t){const n=this._getReferenceEntityNameFromBackReferencePath(e);let i;if(n)i=n;else{const r=Object.entries(t.columns.Items).find(([,c])=>c.name===e);if(!r)throw new Error(`Can't find column '${e}' in EntitySchema '${t.name}'`);const[,a]=r;i=a.referenceSchemaName}return i}_loadSchemasByPath(e,t,n){var i=this;return(0,b.A)(function*(){const r=n.find(f=>f.name===e);if(!r)return{schemas:[],notFoundSchemas:[e]};const a=[...t],c=a.shift(),h=i._getReferenceSchemaName(c,r);if(!h)return{schemas:[],notFoundSchemas:[]};let p=n.find(f=>f.name===h);if(!p)try{if(p=yield i.get(h),p)n.push(p);else return{schemas:[],notFoundSchemas:[h]}}catch{return{schemas:[],notFoundSchemas:[h]}}const m=a.length?yield i._loadSchemasByPath(p.name,a,n):{schemas:[],notFoundSchemas:[]};return{schemas:[p,...m.schemas],notFoundSchemas:m.notFoundSchemas}})()}_getForwardReferenceSchemas(e,t){var n=this;return(0,b.A)(function*(){const i=yield Promise.all(e.filter(r=>r.forwardReferencePaths).flatMap(r=>r.forwardReferencePaths.flatMap(a=>n._loadSchemasByPath(r.name,a.split("."),t))));return{schemes:i.flatMap(r=>r.schemas),notFoundSchemes:i.flatMap(r=>r.notFoundSchemas)}})()}_getEntitiesToLoadLookups(e,t){return t.schemes.filter(n=>e.requests.find(i=>i.loadLookupColumns===!0&&i.name===n.name))}map(e){return Promise.resolve(Dg.map(e,this._userInfo.cultureInfo.sysCultureName))}get(e){var t=()=>super.get,n=this;return(0,b.A)(function*(){let i;return n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schema from cache",(0,b.A)(function*(){const a=yield(yield n._entitySchemaCache).get(e);if(a)return a}))),Wc.includes(e)?i=(yield n._entityHttpService.getEntity(e)).schema:i=yield t().call(n,e),n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: set schema to cache",(0,b.A)(function*(){yield(yield n._entitySchemaCache).set(e,i)}))),i})()}getItems(e){var t=()=>super.getItems,n=this;return(0,b.A)(function*(){const i=[...new Set(e)];let r=i,a=[];n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",(0,b.A)(function*(){const C=yield n._entitySchemaCache;a=(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",()=>Promise.all(i.map(E=>C.get(E))))).filter(E=>!!E);const w=a.map(E=>E.name);if(r=i.filter(E=>!w.includes(E)),r.length===0)return{schemes:[...a],notFoundSchemes:[]}})));const c=r.filter(C=>Wc.includes(C)),h=r.filter(C=>!Wc.includes(C));let p={success:!0,schemes:[],notFoundSchemes:[]};if(c.length!==0){const C={requests:c.map(S=>({name:S,loadLookupColumns:!1}))};p=yield n._entityHttpService.getEntities(C)}const m=yield t().call(n,h),f=[...m.schemes,...p.schemes];return n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: set schemas to cache",(0,b.A)(function*(){yield(yield n._entitySchemaCache).bulkSet((0,v.uniqBy)(f,"name").map(S=>({key:S.name,value:S})))}))),{schemes:[...f,...a],notFoundSchemes:[...m.notFoundSchemes,...p.notFoundSchemes]}})()}getEntity(e){var t=this;return(0,b.A)(function*(){const n=yield t.get(e);return{success:!!n,schema:n}})()}getEntities(e){var t=this;return(0,b.A)(function*(){const n=e.requests.map(h=>h.name),i=yield t.getItems(n),r=t._getEntitiesToLoadLookups(e,i),a=yield t._getLookupEntities(r),c=yield t._getForwardReferenceSchemas(e.requests,[...i.schemes,...a.schemes]);return{success:!0,schemes:[...i.schemes,...a.schemes,...c.schemes],notFoundSchemes:[...i.notFoundSchemes,...a.notFoundSchemes,...c.notFoundSchemes]}})()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Hs)(s.\u0275\u0275inject(Qe),s.\u0275\u0275inject(Q),s.\u0275\u0275inject(_t),s.\u0275\u0275inject(vn),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(bn),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Hs,factory:Hs.\u0275fac,providedIn:"root"})}}class Ws{constructor(e,t,n,i){this.httpClient=e,this._entityRequire=t,this._entityHttp=n,this._featureValues=i}_useRequire(){return this._featureValues?.UseRequireEntitySchema8x??!1}getEntity(e){var t=this;return(0,b.A)(function*(){return t._useRequire()?t._entityRequire.getEntity(e):t._entityHttp.getEntity(e)})()}getEntities(e){var t=this;return(0,b.A)(function*(){return t._useRequire()?t._entityRequire.getEntities(e):t._entityHttp.getEntities(e)})()}static{this.\u0275fac=function(t){return new(t||Ws)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Hs),s.\u0275\u0275inject(vn),s.\u0275\u0275inject(Q,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ws,factory:Ws.\u0275fac,providedIn:"root"})}}class Sn{constructor(e,t,n,i){this.httpClient=e,this._userInfo=t,this._schemaLoader=n,this._entityHttp=i,this._entitySchemaServiceRequests=new Map,this._destroyed$=new l.Subject}_convertToEntitySchema(e){const t=new th;return t.uId=e.uId,t.name=e.name,t.caption=this._getCaptionElement(e),t.extendParent=e.extendParent,t.packageUId=e.packageUId,t.administratedByColumns=e.administratedByColumns,t.administratedByOperations=e.administratedByOperations,t.administratedByRecords=e.administratedByRecords,t.description=e.description,t.isDBView=e.isDBView,t.isTrackChangesInDB=e.isTrackChangesInDB,t.isVirtual=e.isVirtual,t.masterRecordSchemaName=e.masterRecordSchemaName,t.primaryColumnUId=e.primaryColumnUId,t.primaryDisplayColumnUId=e.primaryDisplayColumnUId,t.primaryColorColumnUId=e.primaryColorColumnUId,t.hierarchyColumnUId=e.hierarchyColumnUId,t.createdOnColumnUId=e.createdOnColumnUId,t.createdByColumnUId=e.createdByColumnUId,t.modifiedOnColumnUId=e.modifiedOnColumnUId,t.modifiedByColumnUId=e.modifiedByColumnUId,t.useMasterRecordRights=e.useMasterRecordRights,t.parentUId=e.parentUId,t.columns=Object.values(e.columns.Items).map(n=>{const i=new $c;return i.uId=n.uId,i.name=n.name,i.caption=this._getCaptionElement(n),i.dataValueType=n.dataValueType,i.usageType=n.usageType,i.referenceSchemaUId=n.referenceSchemaUId,i.referenceSchemaName=n.referenceSchemaName,i.isRequired=n.isRequired,i.isValueCloneable=n.isValueCloneable,i.isMasked=n.isMasked,i.isFormatValidated=n.isFormatValidated,i.isSensitiveData=n.isSensitiveData,i.isValueMasked=n.isValueMasked,i.valueMaskingSettings=n.valueMaskingSettings,i.defaultValueSchema=n.defValue,i.lookupMode=n.isSimpleLookup?ta.List:ta.SelectionWindow,i.useSeconds=n.useSeconds,i}),t}_getCaptionElement(e){return e.caption[this._userInfo.cultureInfo.sysCultureName]||e.caption[$d]}_createEntitySchemaColumnFromInformationObject(e){const t=new $c;return t.uId=e.columnUId,t.name=e.columnName,t.caption=e.columnCaption,t.dataValueType=e.columnDataValueType,t.usageType=e.columnUsageType,t.referenceSchemaUId=e.referenceSchemaUId,t.referenceSchemaName=e.referenceSchemaName,t.columnCaptionPath=e.columnCaptionPath,t}_getEntitySchemaFromEndpoint(e,t){return this.httpClient.post(e,t).pipe((0,d.mergeMap)(n=>n.schema?(0,l.of)({success:!0,entitySchema:this._convertToEntitySchema(n.schema)}):(0,l.throwError)({success:!1,entitySchema:null,errorInfo:n.errorInfo})))}_getEntitySchemaColumnByPath(e,t,n="."){const i=`${e}_${n}_${t}`;if(this._entitySchemaServiceRequests.has(i))return this._entitySchemaServiceRequests.get(i);const r=this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),{getSchemaColumnInformation:{entitySchemaUId:e,schemaColumnPath:t,schemaColumnCaptionPathDelimiter:n}}).pipe((0,d.tap)(({success:a})=>{if(!a)throw new Error("SchemaDesignerService request has failed")}),(0,d.map)(({getSchemaColumnInformationResponse:a})=>this._createEntitySchemaColumnFromInformationObject(a)),(0,d.tap)(()=>this._entitySchemaServiceRequests.delete(i)),(0,d.share)());return this._entitySchemaServiceRequests.set(i,r),r}_combineEntitySchemaColumnInformationRequestsWithPaths(e,t){return t.reduce((n,i)=>({...n,[i]:this._getEntitySchemaColumnByPath(e,i)}),{})}getEntitySchemaByUId(e,t){const n=`${e}_${t}`;if(this._entitySchemaServiceRequests.has(n))return this._entitySchemaServiceRequests.get(n);const i=t?this._entityHttp.getEntitySchemaServiceEndpoint():this._entityHttp.getRuntimeEntitySchemaServiceEndpoint(),r={uId:e};t&&(r.packageUId=t);const a=this._getEntitySchemaFromEndpoint(i,r).pipe((0,d.tap)(()=>this._entitySchemaServiceRequests.delete(n)),(0,d.share)());return this._entitySchemaServiceRequests.set(n,a),a}getEntitySchemaByName(e){if(this._entitySchemaServiceRequests.has(e))return this._entitySchemaServiceRequests.get(e);const t=(0,l.from)(this._schemaLoader.getEntity(e)).pipe((0,d.map)(n=>({success:n.success,entitySchema:n.schema?this._convertToEntitySchema(n.schema):null,errorInfo:n.errorInfo})),(0,d.tap)(()=>this._entitySchemaServiceRequests.delete(e)),(0,d.share)(),(0,d.catchError)(n=>(this._entitySchemaServiceRequests.delete(e),(0,l.throwError)(()=>n))));return this._entitySchemaServiceRequests.set(e,t),t}getEntitySchemes(e){const t=JSON.stringify(e);if(this._entitySchemaServiceRequests.has(t))return this._entitySchemaServiceRequests.get(t);const n=(0,l.from)(this._schemaLoader.getEntities(e)).pipe((0,d.map)(i=>({success:i.success,schemes:i.schemes.map(r=>this._convertToEntitySchema(r)),notFoundSchemes:i.notFoundSchemes})),(0,d.tap)(()=>this._entitySchemaServiceRequests.delete(t)),(0,d.share)(),(0,d.catchError)(i=>(0,l.throwError)(()=>i)));return this._entitySchemaServiceRequests.set(t,n),n}getEntitySchemaColumnsInformationByMetaPath(e,t){const n={getSchemaColumnsInformation:{entitySchemaUId:e,schemaColumnMetaPaths:t}};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),n).pipe((0,d.tap)(({success:i})=>{if(!i)throw new Error("SchemaDesignerService request is failed")}),(0,d.map)(({getSchemaColumnsInformationResponse:i})=>i.map(r=>({column:this._createEntitySchemaColumnFromInformationObject(r),columnMetaPath:r.columnMetaPath,columnPath:r.columnPath,columnCaptionPath:r.columnCaptionPath}))))}getEntitySchemaColumnsInformationByPath(e,t,n){return this._getEntitySchemaColumnByPath(e,t,n)}getEntitySchemaColumnsInformationByPathsArray(e,t){return(0,l.forkJoin)(this._combineEntitySchemaColumnInformationRequestsWithPaths(e,t))}getColumnCaptionPathByMetaPath(e){const t={getColumnCaptionPathByMetaPath:e};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),t).pipe((0,d.tap)(({success:n})=>{if(!n)throw new Error("SchemaDesignerService request is failed")}),(0,d.map)(({columnCaptionPath:n})=>n))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Sn)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(_t),s.\u0275\u0275inject(Ws),s.\u0275\u0275inject(vn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Sn,factory:Sn.\u0275fac,providedIn:"root"})}}class Zs{constructor(e){this._entitySchemaService=e,this.schemaType=mi.EntitySchema}_getSchema(e){return e.pipe((0,d.switchMap)(t=>t.success===!0?(0,l.of)(t):(0,l.throwError)(()=>new Error(t.errorInfo?.message))),(0,d.map)(t=>t.entitySchema))}_getScheme(e){return e.pipe((0,d.switchMap)(t=>t.success===!0?(0,l.of)(t):(0,l.throwError)(()=>new Error(t.errorInfo?.message))),(0,d.map)(t=>t.schemes))}getSchemaByUId(e){const t=this._entitySchemaService.getEntitySchemaByUId(e);return this._getSchema(t).pipe((0,d.catchError)(n=>{const i=n.message||`Entity schema with UId '${e}' not found`;return console.error(i),(0,l.throwError)(()=>new Error(i))}))}getSchemaByName(e){const t=this._entitySchemaService.getEntitySchemaByName(e);return this._getSchema(t).pipe((0,d.catchError)(n=>{const i=n.message||`Entity schema with name '${e}' not found`;return console.error(i),(0,l.throwError)(()=>new Error(i))}))}getSchemes(e){const t=this._entitySchemaService.getEntitySchemes(e);return this._getScheme(t).pipe((0,d.catchError)(n=>{const i=n.message||"Entity schemas not found: "+JSON.stringify(e);return console.error(i),(0,l.throwError)(()=>new Error(i))}))}static{this.\u0275fac=function(t){return new(t||Zs)(s.\u0275\u0275inject(Sn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Zs,factory:Zs.\u0275fac,providedIn:"root"})}}class rt extends Gs{constructor(e,t){super(t),this.provider=e,this.schemaChangeListener=t}_checkPath(e){if(!e||e.length===0)throw new Error("Path is null or empty")}_getEntitySchemaColumn(e,t){const n=e.columns.find(i=>i.name===t);return n||null}_findEntitySchemesByPath(e,t){this._checkPath(t);const n=[...t],i=this.getCachedSchema(e);if(!i)return null;const r=n.shift(),a=ea.getPathItemInfo(r);let c=[];if(a.isBackReference)c=this._findEntitySchemesByPath(a.referenceSchemaName,n);else{const p=this._getEntitySchemaColumn(i,a.columnName);if(n.length===0)return[i];if(!p?.isLookupType)return null;c=this._findEntitySchemesByPath(p.referenceSchemaName,n)}if(!c)return null;const h=c.filter(p=>p.name!==i.name);return[i,...h]}_getAreSchemesCached(e){for(const t of e){const n=this.getCachedSchema(t.name);if(!n)return!1;const i=n.columns.filter(a=>a.isLookupType).every(a=>this.getIsSchemaCached(a.referenceSchemaName));if(t.loadLookupColumns&&!i)return!1;const r=t.forwardReferencePaths??[];for(const a of r){const c=a.split(".");if(!this.findEntitySchemaColumnByPath(t.name,c))return!1}}return!0}_addSchemaIfNotExists(e,t){e.has(t.name)||e.set(t.name,t)}_addSchemesIfNotExists(e,t){t.forEach(n=>{this._addSchemaIfNotExists(e,n)})}_getCachedSchemes(e){const t=new Map;return e.forEach(n=>{const i=this.getCachedSchema(n.name);if(!i)return;if(this._addSchemaIfNotExists(t,i),n.loadLookupColumns){const a=i.columns.filter(c=>c.isLookupType).map(c=>this.getCachedSchema(c.referenceSchemaName)).filter(c=>c!=null);this._addSchemesIfNotExists(t,a)}(n.forwardReferencePaths??[]).forEach(a=>{const c=a.split("."),h=this._findEntitySchemesByPath(n.name,c);h&&this._addSchemesIfNotExists(t,h)})}),[...t.values()]}getSchemes(e){if(this._getAreSchemesCached(e))return(0,l.of)(this._getCachedSchemes(e));const t={requests:e,cachedSchemesNames:this.getCachedSchemesNames()};return this.provider.getSchemes(t).pipe((0,d.tap)(n=>n.forEach(i=>this.add(i))),(0,d.map)(()=>this._getCachedSchemes(e)))}findEntitySchemaByPath(e,t){this._checkPath(t);const n=this.getCachedSchema(e);if(!n)return null;const i=[...t],r=i.shift(),a=ea.getPathItemInfo(r);if(a.isBackReference)return this.findEntitySchemaByPath(a.referenceSchemaName,i);const c=this._getEntitySchemaColumn(n,a.columnName);return c?i.length===0?n:c?.isLookupType?this.findEntitySchemaByPath(c.referenceSchemaName,i):null:null}findEntitySchemaColumnByPath(e,t){const n=this.findEntitySchemaByPath(e,t);if(!n)return null;const i=[...t].pop(),r=ea.getPathItemInfo(i);return this._getEntitySchemaColumn(n,r.columnName)}static{this.\u0275fac=function(t){return new(t||rt)(s.\u0275\u0275inject(Zs),s.\u0275\u0275inject(bn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac,providedIn:"root"})}}class Ys{constructor(e,t,n,i,r){this.httpClient=e,this._userInfo=t,this._entitySchemaRepository=n,this._cacheManager=i,this._featureValues=r,this._serviceEndpoint=(this._userInfo.isSSP?"ssp/":"")+"rest/ConfigurationDataService/",this._cachedEntityConfigurationData=new Map,this._cachedEntityUIdsData=new Map}_getUncachedEntities(e){return e.filter(t=>!this._cachedEntityConfigurationData.has(t))}_loadEntitiesData(e){const t=this._serviceEndpoint+"GetEntityData";return this.httpClient.post(t,e)}_getEntitiesData(e,t){return this._loadEntitiesData(e).pipe((0,d.map)(n=>!n.success||!(0,v.isEmpty)(n.errorInfo)?n:(this._setEntitiesDataToCache(n.data),this._getEntitiesDataResponse(t))))}_setEntitiesDataToCache(e){const{entitiesStructure:t,modulesStructure:n}=e;this._setEntityStructureToCache(t),this._setModuleStructureToCache(n)}_setEntityStructureToCache(e){e.forEach(t=>{const n=t.entitySchemaName,i={entityStructure:t,moduleStructure:null};this._cachedEntityConfigurationData.set(n,i)})}_setModuleStructureToCache(e){e.forEach(t=>{const n=t.entitySchemaName,i=this._cachedEntityConfigurationData.get(n);i&&(i.moduleStructure=t,this._cachedEntityConfigurationData.set(n,i))})}_getEntitiesDataFromCache(e){const t={entitiesStructure:[],modulesStructure:[]};return e.forEach(n=>{const i=this._cachedEntityConfigurationData.get(n);i&&(t.entitiesStructure.push(i.entityStructure),t.modulesStructure.push(i.moduleStructure))}),t}_getEntitiesDataResponse(e){return{data:this._getEntitiesDataFromCache(e),success:!0}}getData(e=!1){const t=this._serviceEndpoint+"GetData",n=this.httpClient.post(t,e),r=!this._featureValues.DisableGenerateViewModuleScriptOptimization?this._cacheManager.executeWithCache(Lc,"configuration-data",n):n;return e?(0,l.from)(this._cacheManager.get(Lc)).pipe((0,l.concatMap)(a=>a.clear()),(0,l.concatMap)(()=>r),(0,d.shareReplay)({refCount:!0})):r.pipe((0,d.shareReplay)({refCount:!0}))}getEntityData(e,t=!1){return this.getEntitiesData([e],t).pipe((0,d.map)(n=>({data:{entityStructure:n?.data?.entitiesStructure[0],moduleStructure:n?.data?.modulesStructure[0]},success:n?.success,errorInfo:n?.errorInfo})))}getEntityUId(e){return this._cachedEntityUIdsData.has(e)?(0,l.of)(this._cachedEntityUIdsData.get(e)):this._entitySchemaRepository.getSchemaByName(e).pipe((0,d.map)(t=>{const n={data:{entityUIds:[{entitySchemaName:e,entitySchemaUId:t.uId}]},success:!0};return this._cachedEntityUIdsData.set(e,n),n}))}getEntitiesData(e,t=!1){const n=(0,v.uniq)(e);if(t)return this._getEntitiesData(n,n);const i=this._getUncachedEntities(n);return(0,v.isEmpty)(i)?(0,l.of)(this._getEntitiesDataResponse(n)):this._getEntitiesData(i,n)}static{this.\u0275fac=function(t){return new(t||Ys)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(_t),s.\u0275\u0275inject(rt),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(Q,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ys,factory:Ys.\u0275fac,providedIn:"root"})}}class Mn{constructor(e,t){this.queryExecutor=e,this.configurationDataService=t}_buildUrlWithCardModule(e,t,n){return window.location.origin+window.location.pathname+`#${e}/${t}/edit/${n}`}_getPageSchemaNameForRecord(e,t){const n=e?.pages;if(!n)return(0,l.of)(null);if(n.length===1){const i=n[0];return(0,l.of)(i)}return e.typeColumnName?this._getPageSchemaNameForRecordByType(e,t):(0,l.of)(n.find(i=>i.isDefault))}_getPageSchemaNameByType(e,t){const n=e?.pages;return n?n.length===1?n[0]:this._findPageByType(e,t):null}_getPageSchemaNameForRecordByType(e,t){return new l.Observable(n=>{this._getRecordTypeValue(e,t).subscribe(i=>{const r=this._findPageByType(e,i);n.next(r),n.complete()})})}_findPageByType(e,t){const n=e.pages;t=typeof t=="object"?t.value:t;let i=n.find(r=>r.typeId===t);return(!i||!t)&&(i=n[0]),i}_getRecordTypeValue(e,t){return new l.Observable(n=>{const i=e.entitySchemaName,r=e.typeColumnName,a=new Cn(i);a.rowCount=1,a.addSchemaColumn(r),a.filters.addSchemaColumnFilterWithParameter(K.Equal,"Id",t),this.queryExecutor.executeSelectQuery(a).subscribe(c=>{c=c||[];const m=(c[0]||{})[r].value;n.next(m),n.complete()})})}buildPageUrlByEntityName(e,t,n){const i=n.moduleStructure?.cardModule,a=this._getPageSchemaNameByType(n.entityStructure,t.typeId)?.cardSchemaName;return this._buildUrlWithCardModule(i,a,t.Id)}buildPageUrl(e,t){return new l.Observable(n=>{this.configurationDataService.getEntityData(e).subscribe(i=>{const r=i.data?.entityStructure;this._getPageSchemaNameForRecord(r,t).subscribe(a=>{const c=i.data?.moduleStructure?.cardModule,h=a?.cardSchemaName,p=this._buildUrlWithCardModule(c,h,t);n.next(p),n.complete()})})})}static{this.\u0275fac=function(t){return new(t||Mn)(s.\u0275\u0275inject(Oe),s.\u0275\u0275inject(Ys))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Mn,factory:Mn.\u0275fac})}}function Rg(o){return o.endsWith("/")||(o+="/"),o}function jg(o){return o.replace(/(^([/\\])+)|(([/\\])+$)/,"")}function kg(o){return o=o.replace(location.hash,""),o.replace(location.search,"")}function Ng(o){return`${Vg()}/Navigation/Navigation.aspx?schemaName=${o}`}function yM(){return"/"}function yt(){let o=location.pathname;const e=o.match(/.*?\/\d\/?/);return e&&e.length===1?o=Rg(e[0]):o="",Lg(location.origin,o)}function Zc(){let o=location.href.replace(yt(),"");return o=kg(o),o||"/"}function CM(){const o=Zc(),e=yt(),t=o.split("/").filter(Boolean)[0];return t?`${e}${t}/`:e}function na(){let e=yt().replace(location.origin,"");return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function Vg(){return yt().replace(/\/0\/?$|\/+$/,"")}function Lg(...o){return o.map(e=>jg(e)).join("/")}function bM(o,e){return`${Ng(o)}&recordId=${e}`}function vM(o,e){function t(a,c){return a.toLowerCase().replace(c,"").split("/").filter(h=>h).join("/")}const n=yt().toLowerCase(),i=t(o,n),r=t(e,n);return i===r}function SM(o){return o?na()+imageServiceUrl+o:null}function MM(){return na()+esqServiceUrl}function wM(o){const{uId:e,name:t,packageUId:n,userLevelSchema:i}=o;if(!e&&!t)throw new Error("uId or name is required");const r=yt(),a=Zc(),c=`#/InterfaceDesigner/${e||t}`,h=new URLSearchParams;return n&&h.append("packageUId",n),i&&h.append("userLevelSchema","true"),`${r}${a}${c}?${h.toString()}`}const Bg="Translations/Custom/",Fg="CommonFeatures.UseCustomCoreLocalizations",Yc="features-cache",xM={provide:Vs,useValue:{name:Yc,type:ce.PersistentAndMemory,options:{tableName:$e.Features}},multi:!0},zg=new Array("constructor","ngOnDestroy");let Kc=!1;const nh=new Proxy({},{get(o,e){if(Kc||zg.includes(e))return o[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),EM={provide:Q,useFactory:()=>nh},Ug=new s.InjectionToken("FEATURE_SERVICE_GET_FEATURES_STATES_ENDPOINT",{factory:()=>"rest/FeatureService/GetFeatureStates",providedIn:"root"});let ia=class vc{constructor(e,t,n,i,r){this.httpClient=e,this._getFeatureStatesEndpoint=t,this._useSystemClientCache=n,this._cacheManager=i,this._measurePerformanceService=r,this._cachedCodes=new Map,this._featuresLoaded=!1,this._destroyed$=new l.Subject,this._isDevMode=(0,s.isDevMode)()}_getFeaturesFromURL(){const e=location.hash,t=e.indexOf("?");if(this._isDevMode&&t>=0){const n=e.substring(t+1);return[...new URLSearchParams(n.startsWith("?")?n.slice(1):n)].filter(([r])=>r.startsWith("feature:")).map(([r,a])=>({key:r.substring(8),value:a==="true"}))}return[]}_loadFeaturesValues(){const e=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,d.map)(t=>t.GetFeatureStatesResult.map(n=>({key:n.Key,value:n.Value===1}))));return this._useSystemClientCache?(0,l.from)(this._cacheManager.getOrCreate({name:Yc,type:ce.Memory})).pipe((0,d.switchMap)(()=>this._cacheManager.executeWithBulkCache(Yc,e)),this._measurePerformanceService.measure$("FeatureService: load features with cache bulk")):e}_enrichFeaturesWithUrlValues(e){const t=this._getFeaturesFromURL();return[...e,...t]}updateCachedFeatureValues(e,t){Object.assign(e,t),Object.freeze(e)}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this._loadFeaturesValues().pipe((0,d.map)(e=>this._enrichFeaturesWithUrlValues(e)),(0,d.map)(e=>{e.forEach(n=>{this._cachedCodes.set(n.key,n.value)});const t=e.map(n=>[n.key,n.value]);return Object.fromEntries(t)}),(0,d.tap)(e=>{this.updateCachedFeatureValues(nh,e),this._featuresLoaded=!0,Kc=!0}),(0,d.catchError)(()=>(Kc=!0,this._featuresLoaded=!0,(0,l.of)(null))),(0,l.shareReplay)({bufferSize:1,refCount:!1}),(0,d.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._featuresLoaded?(0,l.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,d.map)(()=>this._cachedCodes.get(e)||!1)):(0,l.of)(!1)}getFeaturesState(e){return(0,l.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const n=typeof t=="string"?this.getFeatureState(t):t;return new Promise(i=>n.pipe((0,d.first)()).subscribe({next:i}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||vc)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Ug),s.\u0275\u0275inject(Bc,8),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:vc,factory:vc.\u0275fac,providedIn:"root"})}};ia=(0,u.__decorate)([Xe({requestType:"crt.FeatureService"}),(0,u.__metadata)("design:paramtypes",[U.HttpClient,String,Boolean,Ce,q])],ia);const ih=new s.InjectionToken("FETCH_MULTI_TRANSLATE_RESOURCES_SOURCES"),sh=new s.InjectionToken("FETCH_MULTI_TRANSLATE_CUSTOM_RESOURCES_SOURCES");class Vt{constructor(e,t,n){this._resourceSources=e,this._customResourceSources=t,this._featureService=n}_getCustomResourcesSource(){return this._customResourceSources?.length?this._customResourceSources:[{prefix:M.Location.joinWithSlash(yt(),Bg),suffix:".json"}]}getResourceOptions(){return(0,l.from)(this._featureService.getFeatureState(Fg)).pipe((0,l.map)(e=>e?this._getCustomResourcesSource():[]),(0,l.map)(e=>[...this._resourceSources??[],...e]))}static{this.\u0275fac=function(t){return new(t||Vt)(s.\u0275\u0275inject(ih),s.\u0275\u0275inject(sh,8),s.\u0275\u0275inject(ia))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Vt,factory:Vt.\u0275fac})}}const rh=new s.InjectionToken("NestedTranslateLoader");class wn{constructor(e){this._optionsProvider=e}_fetchTranslation(e){return fetch(e,{cache:"no-cache"}).then(t=>{if(!t.ok&&t.status!==304)throw new Error(`Loading translations failed: ${e} (${t.status})`);return t.json()})}_handleFetchResults(e){for(const n of e.filter(i=>i.status==="rejected"))console.error(n.reason);const t=e.filter(n=>n.status==="fulfilled").map(n=>n.value||{});return(0,v.merge)({},...t)}getTranslation(e){return this._optionsProvider.getResourceOptions().pipe((0,l.switchMap)(t=>{const n=t.map(({prefix:i,suffix:r})=>this._fetchTranslation(`${i}${e}${r}`));return(0,l.from)(Promise.allSettled(n)).pipe((0,l.map)(i=>this._handleFetchResults(i)))}))}static{this.\u0275fac=function(t){return new(t||wn)(s.\u0275\u0275inject(Vt))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:wn,factory:wn.\u0275fac})}}const oh=new s.InjectionToken("Custom event name for get translations");class Ks extends T.TranslateLoader{constructor(e,t,n,i){super(),this.customEventService=e,this._store=t,this._getTranslationsEventName=n,this._nestedTranslateLoader=i,this._destroyed$=new l.Subject}getTranslation(e){return new l.Observable(t=>{(0,l.combineLatest)([this.customEventService.subscribe(this._getTranslationsEventName),this._nestedTranslateLoader?this._nestedTranslateLoader.getTranslation(e):(0,l.of)({})]).pipe((0,d.map)(([n,i])=>{const r=v.merge(n,i);return this._store.langs.forEach(a=>{const c=this._store.translations[a];this._store.translations[a]=v.merge(c,r)}),r}),(0,d.takeUntil)(this._destroyed$)).subscribe(n=>{t.next(n)},l.noop,()=>{t.complete()}),this.customEventService.createOutboundChannel(this._getTranslationsEventName).next()})}ngOnDestroy(){this._destroyed$.next()}static{this.\u0275fac=function(t){return new(t||Ks)(s.\u0275\u0275inject(ii),s.\u0275\u0275inject(T.TranslateStore),s.\u0275\u0275inject(oh),s.\u0275\u0275inject(rh,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ks,factory:Ks.\u0275fac})}}class Js{static _getResourceSourcesProviders(e){const{resourceSources:t,customResourceSources:n}=e??{},i=(n??[]).map(r=>({...r,provide:sh,multi:!0}));return[{provide:ih,useValue:t},...i]}static forRoot(e){const t=T.TranslateModule.forRoot({...e,loader:{provide:T.TranslateLoader,useClass:wn}});return t.providers.push(Vt,...this._getResourceSourcesProviders(e)),t}static forNested(e){const t=T.TranslateModule.forRoot(e);return t.providers.push({provide:rh,useClass:wn},Vt,...this._getResourceSourcesProviders(e)),t}static with(e){return{ngModule:Js,providers:[wn,Vt,...this._getResourceSourcesProviders(e)]}}static{this.\u0275fac=function(t){return new(t||Js)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Js})}static{this.\u0275inj=s.\u0275\u0275defineInjector({})}}class ah extends Error{constructor(){super("Next handler already specified")}}class ch{constructor(){this._refs=new Set,this.lazyLoadingDisabled=!1}static{this._globalInstancePath="creatio._lazyModulesManager"}static get instance(){if(!this._instance){let e=(0,v.get)(window,this._globalInstancePath);e||(e=new this,(0,v.set)(window,this._globalInstancePath,e)),this._instance=e}return this._instance}add(e){this._refs.add(e)}size(){return this._refs.size}loadAll(){return Promise.all(Array.from(this._refs).map(e=>e.loadAndBootstrap()))}clear(){this._refs.clear()}}var Jc;(function(o){o[o.Schema=0]="Schema",o[o.Remote=1]="Remote",o[o.Host=2]="Host"})(Jc||(Jc={}));const lh=window;class qs{constructor(){this.store={typeInfos:new Map}}static{this._prefix="creatio.registry."}static get store(){if(!this._instance){let e=(0,v.get)(lh,this._prefix+this.registryKey);e||(e=new this,(0,v.set)(lh,this._prefix+this.registryKey,e)),this._instance=e}return this._instance.store}}class $g extends qs{static{this.registryKey="pkgTopology"}static get items(){return this.store.typeInfos}static get(e){const t=this.items.get(e);if(t===void 0)throw new Error(`Package with name ${e} not found in topology`);return t}}class Gg{constructor(e){this._request=e;const t=[...this._request.scopes??[]].reverse().map((n,i)=>[n,i]);this._scopesOrder=Object.fromEntries(t)}_getOrderByScopes(e){if(!e.scopes)return Number.MAX_VALUE;const t=e.scopes.filter(n=>n in this._scopesOrder).map(n=>this._scopesOrder[n]);return Math.min(...t)}_getOrderByPkgTopology(e){return e.source.type===Jc.Host?Number.MAX_VALUE:$g.get(e.source.packageName)}compare(e,t){const n=this._getOrderByScopes(e),i=this._getOrderByScopes(t);let r=n-i;if(r)return r;const a=this._getOrderByPkgTopology(e),c=this._getOrderByPkgTopology(t);return r=a-c,r||(r=e.source.type-t.source.type,r)}}const qc="crtInput:",Xc="crtOutput:",uh="crtValidationInput:",IM="crtInject:",dh="module",hh="viewElement",ph="mobileViewElement",Qc="interfaceDesignerItem",el="mobileInterfaceDesignerItem",mh="requestHandler",gh="designTimeViewElement",fh="validator",_h="converter";function Hg(o,e){Reflect.defineMetadata(dh,o,e)}function Wg(o){const e=Reflect.getMetadata(dh,o);if(!e)throw new Error(`Module metadata was not found on '${o.name}' class`);return e}function Zg(o,e){Reflect.defineMetadata(hh,o,e)}function Yg(o,e){Reflect.defineMetadata(ph,o,e)}function AM(o){return Reflect.getMetadata(hh,o)}function PM(o){return Reflect.getMetadata(ph,o)}function TM(o,e){Reflect.defineMetadata(fh,o,e)}function DM(o){const e=Reflect.getOwnMetadata(fh,o);if(!e)throw new Error(`Validator metadata was not found on '${o.name}' class`);return e}function OM(o,e){Reflect.defineMetadata(_h,o,e)}function RM(o){const e=Reflect.getOwnMetadata(_h,o);if(!e)throw new Error(`Converter metadata was not found on '${o.name}' class`);return e}function Kg(o,e){Reflect.defineMetadata(Qc,o,e)}function Jg(o,e){Reflect.defineMetadata(el,o,e)}function jM(o){return Reflect.getOwnMetadata(Qc,o)}function kM(o){return Reflect.getOwnMetadata(el,o)}function NM(o,e){Reflect.defineMetadata(gh,o,e)}function VM(o){const e=Reflect.getOwnMetadata(gh,o);if(!e)throw new Error(`Design time view element metadata was not found on '${o.name}' class`);return e}function LM(o){return Reflect.hasOwnMetadata(Qc,o)}function BM(o){return Reflect.hasOwnMetadata(el,o)}function qg(o,e){Reflect.defineMetadata(mh,o,e)}function FM(o){const e=Reflect.getMetadata(mh,o);if(!e)throw new Error(`Request handler metadata was not found on '${o.name}' class`);return e}function zM(o){const e=Reflect.getMetadata("requestType",o);if(!e)throw new Error(`requestType was not found on '${o.name}' class`);return{requestType:e,typeRef:o}}function Xg(o){const t=Reflect.getMetadataKeys(o).filter(n=>n.startsWith(qc));return Object.fromEntries(t.map(n=>{const i=Reflect.getMetadata(n,o);return[n.replace(qc,""),i]}))}function Qg(o){const t=Reflect.getMetadataKeys(o).filter(n=>n.startsWith(Xc));return Object.fromEntries(t.map(n=>{const i=Reflect.getMetadata(n,o);return[n.replace(Xc,""),i]}))}function ef(o){const t=Reflect.getMetadataKeys(o).filter(n=>n.startsWith(uh));return Object.fromEntries(t.map(n=>{const i=Reflect.getMetadata(n,o);return[n.replace(uh,""),i]}))}function tf(o){const t=Reflect.getOwnMetadataKeys(o).filter(n=>n.startsWith(crtInjectPrefix));return Object.fromEntries(t.map(n=>{const i=Number(n.replace(crtInjectPrefix,"")),r=Reflect.getMetadata(n,o);return[i,r]}))}function nf(o){const e=o.prototype?Object.getPrototypeOf(o.prototype):null;return e?e.constructor:null}function sf(o){const e=Reflect.getOwnMetadata("design:paramtypes",o);if(!e){if(o.length>0)throw new Error(`Dependency Injection error. Cannot read dependencies of class '${o.name}'. Please make sure class '${o.name}' has decorator and 'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.`);const n=nf(o);return n&&n!==Object?sf(n):[]}const t=tf(o);return Object.entries(t).forEach(([n,i])=>e[n]=i),e}function rf(o){console.error("Not supported: lazy modules should not be dependent on other lazy modules. Some functions may not work correctly",o)}function yh(o){if(!Array.isArray(o))return[];if(o.length===0)return[];const e=new Set,t=[...o];for(;t.length>0;){const n=t.pop();if(!n||e.has(n))continue;if(typeof n!="function"){rf(n);continue}e.add(n);const i=Wg(n)?.includes||[];t.push(...i)}return[...e]}function Ch(o,e){return o?.length?o.some(t=>e?.includes(t)):!0}const tl=window;tl.creatio??={},tl.creatio._bootstrappedCrtModules??=new Map;const bh=tl.creatio._bootstrappedCrtModules;function nl(o){bh.forEach((e,t)=>{e.root&&o(e,t)})}function UM(o){nl(e=>e.options?.onContextCreate?.(o))}function vh(o){nl(e=>e.options?.onContextUpdate?.(o))}function of(o){nl(e=>e.options?.onContextDestroy?.(o))}class af{constructor(){var e=this;this._handlers=[],this._requestListeners=new Map,this._handlersCache=new Map,this._handlersScopesByContextId=new Map,this.handlerChain$={process:function(){var t=(0,b.A)(function*(n){let i;if(e._hasCacheHandler(n))i=e._getCacheHandler(n);else{const r=e._getMatchedHandlers(n);ch.instance.lazyLoadingDisabled||(yield e._loadLazyHandlers(n,r)),i=e._buildHandlersChain(n,r)}return e._requestListeners.forEach(r=>r?.(n)),i?.handle(n)});return function(i){return t.apply(this,arguments)}}(),register:t=>(this._handlersCache.delete(t.requestType),this._handlers.push(t),()=>{const n=this._handlers.indexOf(t);n>-1?(this._handlers.splice(n,1),this._handlersCache.delete(t.requestType)):console.warn(`${t?.requestType} not found to unsubscribe`)}),update:t=>{const n=this._handlers.find(i=>i.type===t.type);n&&(n.createHandler=t.createHandler)},subscribe:(t,n)=>{if(!t)return()=>{};const i=L(),r=a=>{(!n||a.$context===n)&&t(a)};return this._requestListeners.set(i,r),()=>this._requestListeners.delete(i)}}}clearContextedHandlersCache(e){return(this._handlersScopesByContextId.get(e)??[]).every(({requestType:n,scope:i})=>this._handlersCache.get(n)?.delete(i))}clear(){this._handlers.splice(0),this._requestListeners.clear(),this._handlersCache.clear(),this._handlersScopesByContextId.clear()}_getCacheHandler(e){const t=this._handlersCache.get(e.type),n=this._getCacheScopesKey(e);return t.get(n)}_hasCacheHandler(e){const t=this._handlersCache.get(e.type),n=this._getCacheScopesKey(e);return t&&t.has(n)}_getCacheScopesKey(e){const t=this._getInjectionContext(e?.$context)?.id??"";return(e.scopes||[""]).join("_").concat(t)}_getInjectionContext(e){return e?._injectionContext||e?.parent&&this._getInjectionContext(e.parent)}_setContextedScopes(e,t){const n=this._getInjectionContext(e?.$context)?.id,i=this._handlersScopesByContextId.has(n)?this._handlersScopesByContextId.get(n):[];i.push({requestType:e.type,scope:t}),this._handlersScopesByContextId.set(n,i)}_setCacheHandler(e,t){const n=this._handlersCache.has(e.type)?this._handlersCache.get(e.type):new Map,i=this._getCacheScopesKey(e);n.set(i,t),this._getInjectionContext(e?.$context)?.id&&this._setContextedScopes(e,i),this._handlersCache.set(e.type,n)}_isRequestHandler(e){return typeof e.handle=="function"&&typeof e.setNext=="function"}_checkHandlerInstanceOf(e){if(!this._isRequestHandler(e))throw new Error('Handler should implement "BaseRequestHandler"')}_loadLazyHandlers(e,t){var n=this;return(0,b.A)(function*(){const i=new Set;t.forEach(c=>{c.lazy&&!c.createHandler&&i.add(c.lazyModuleRef)});const r=[...i];yield Promise.all(r.map(c=>c.loadAndBootstrap()));const a=n._getInjectionContext(e?.$context);if(a&&i.size){const c=yield yh(r.map(h=>h.typeRef));for(const h of c)a.addLazyModule(h);vh(a)}})()}_getMatchedHandlers(e){return this._handlers.filter(t=>t.requestType!==e.type?!1:Ch(t.scopes,e.scopes))}_buildHandlersChain(e,t){const n=new Gg(e);t.sort((c,h)=>n.compare(c,h));const i=this._getInjectionContext(e?.$context),r=t.map(c=>c.createHandler.call(c,i));r.forEach(c=>this._checkHandlerInstanceOf(c)),this._joinHandlersInChain(r);const a=r[0];return this._setCacheHandler(e,a),a}_joinHandlersInChain(e){for(let t=0;t<e.length-1;t++)try{e[t].setNext(e[t+1])}catch(n){throw n instanceof ah?new Error("Handler factory should return new instance of BaseRequestHandler class or its subclass (next handler should not be specified)"):n}}}const Sh=window;class Ct{get _chain(){return Sh.handlerChain}set _chain(e){Sh.handlerChain=e}static get instance(){return Ct._instance||(Ct._instance=new Ct)}constructor(){this._chain||this._createGlobalHandlerChain()}_createGlobalHandlerChain(){this._chain=new af}clearContextedHandlersCache(e){return this._chain.clearContextedHandlersCache(e)}register(e){return this._chain.handlerChain$.register(e)}update(e){return this._chain.handlerChain$.update(e)}process(e){return this._chain.handlerChain$.process(e)}subscribe(e,t){return this._chain.handlerChain$.subscribe(e,t)}clear(){this._chain.clear()}}function ot(o){return function(e,t,n){const i=function(...r){const a=Ct.instance.process({type:o?.requestType?o.requestType:this.requestType,method:o?.methodName?o.methodName:t,args:r});return o?.omitResult?Promise.resolve(void 0):a};n?n.value=i:e[t]=i}}class sa{}class Ge extends sa{constructor(){super(...arguments),this.requestType="crt.SysSettingsService"}}(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],Ge.prototype,"getByCodes",void 0),(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],Ge.prototype,"getByCode",void 0),(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],Ge.prototype,"update",void 0),(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],Ge.prototype,"updateMany",void 0);class xn extends sa{constructor(){super(...arguments),this.requestType="crt.FeatureService"}}(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],xn.prototype,"getFeatureState",void 0),(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],xn.prototype,"getFeaturesState",void 0);const cf="DataService/json/SyncReply",lf="DataService/ssp/json/SyncReply",Xs=new s.InjectionToken("DataServiceUri"),Mh={provide:Xs,useFactory:o=>o?.isSSP?lf:cf,deps:[[new s.Optional,_t]]},wh=new s.InjectionToken("TransactionFactory");function $M(o){return o=o||new Date,new Date(o.getFullYear(),o.getMonth(),o.getDate())}function GM(o){return o=o||new Date,new Date(o.getFullYear(),o.getMonth(),o.getDate(),23,59,59,999)}function xh(o){if(!o)return null;function e(){throw new Error(`String "${o}" is not a valid serialized date.`)}typeof o!="string"&&e();const[t,n]=o.split("T");if(n&&(n[n.length-1]==="Z"||n.indexOf("+")!==-1||n.indexOf("-")!==-1)){const r=Date.parse(o);return isNaN(r)&&e(),new Date(r)}try{const[r,a,c]=t.split("-"),[h,p,m]=n.split(":"),[f,C]=m.split(".");return new Date(parseInt(r),parseInt(a)-1,parseInt(c),parseInt(h),parseInt(p),parseInt(f),parseInt(C))}catch{e()}}function HM(o,e){e==null&&(e=0),o.setSeconds(o.getSeconds()+e*3600)}function WM(o,e,t){const n=t||{hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat(e.sysCultureName,n).format(o)}function ZM(o,e,t){const n=Math.abs(e.getTime()-o.getTime()),i=Math.floor(n/(1e3*60*60)),r=Math.floor(n%(1e3*60*60)/(1e3*60)),a=Math.floor(n%(1e3*60)/1e3),c={hours:i,minutes:r,seconds:a};return new Intl.DurationFormat(t.sysCultureName).format(c)}class gi{_getEntitySchemaColumnsDataValueTypesMap(e){return e.columns.reduce((t,n)=>(t[n.name]=n.dataValueType,t),{})}_getEntityColumnsDataValueTypesMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=e[n].dataValueType,t),{})}_parseRawColumnValue(e,t){switch(t){case _.Date:case _.Time:case _.DateTime:return xh(e);default:return e}}_parseRawEntityObject(e,t){const n={};return Object.keys(e).forEach(i=>{const r=e[i];n[i]=t[i]?this._parseRawColumnValue(r,t[i]):r}),n}deserializeEntity(e,t){B.checkArgumentEmpty("columnsConfig",e),B.checkArgumentEmpty("rawEntity",t);const n=this._getEntityColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,n)}deserializeEntities(e,t){B.checkArgumentEmpty("columnsConfig",e),B.checkArgumentEmpty("rawEntities",t);const n=this._getEntityColumnsDataValueTypesMap(e);return t.map(i=>this._parseRawEntityObject(i,n))}deserializeEntitySchemaRecord(e,t){B.checkArgumentEmpty("entitySchema",e),B.checkArgumentEmpty("rawEntities",t);const n=this._getEntitySchemaColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,n)}deserializeEntitySchemaRecords(e,t){B.checkArgumentEmpty("entitySchema",e),B.checkArgumentEmpty("rawEntities",t);const n=this._getEntitySchemaColumnsDataValueTypesMap(e);return t.map(i=>this._parseRawEntityObject(i,n))}static{this.\u0275fac=function(t){return new(t||gi)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:gi,factory:gi.\u0275fac,providedIn:"root"})}}class uf extends Cn{}class il extends Yo{constructor(e){super(li.Insert,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.InsertQuery"}get columnValues(){return{items:(0,oe.classToPlain)(this._columnValues)}}addColumn(e,t,n){B.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new ae({value:t,dataValueType:n}))}}(0,u.__decorate)([(0,oe.Expose)(),(0,u.__metadata)("design:type",Object),(0,u.__metadata)("design:paramtypes",[])],il.prototype,"columnValues",null);class sl extends Jo{constructor(e){super(li.Update,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.UpdateQuery",this.isForceUpdate=!1}get columnValues(){return{items:(0,oe.classToPlain)(this._columnValues)}}addColumn(e,t,n){B.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new ae({value:t,dataValueType:n}))}}(0,u.__decorate)([(0,oe.Expose)(),(0,u.__metadata)("design:type",Object),(0,u.__metadata)("design:paramtypes",[])],sl.prototype,"columnValues",null);class Eh extends Jo{constructor(e){super(li.Delete,e),this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.DeleteQuery"}}class ra extends Error{}var Qs;(function(o){o[o.General=0]="General",o[o.Limited=1]="Limited"})(Qs||(Qs={}));var rl;(function(o){o[o.Undefined=0]="Undefined",o[o.Filter=1]="Filter",o[o.FilterSummary=2]="FilterSummary"})(rl||(rl={}));var ol;(function(o){o[o.Session=0]="Session",o[o.Workspace=1]="Workspace",o[o.Application=2]="Application"})(ol||(ol={}));class df{constructor(e=ol.Session,t="",n=""){this._cacheLevel=e,this._cacheGroup=t,this._cacheItemName=n}getMetadata(){return{cacheLevel:this._cacheLevel,cacheGroup:this._cacheGroup,cacheItemName:this._cacheItemName}}}class er extends Error{constructor(e){const t=e?.error?.responseStatus?.Message||e?.responseStatus?.Message||e?.message;super(t),this.errorCode=e?.error?.responseStatus?.ErrorCode}}class Ih extends Error{constructor(e){super(`Query with config
${JSON.stringify(e.getMetadata())}
finished with error.`)}}let oa=class extends Oe{constructor(e,t,n,i){super(),this._sysSettingsService=e,this._httpClient=t,this._dataServiceUri=n,this._featureService=i,this._defaultDSQueryTimeoutMs=12e4,this._defaultDebounceTime=200,this._debounceTimeSysSettingName="QueryExecutorDebounceTime",this._requests=new l.Subject,B.checkArgumentEmpty("_httpClient",t),B.checkArgumentEmpty("_dataServiceUri",n),this._transactions=new Map,this._transactions$=new Map}_getDataServiceQueryTimeout8xFeature(){return this._featureService?(0,l.from)(this._featureService.getFeatureState("EnableDataServiceQueryTimeout8x")):(0,l.of)(!1)}_getDataServiceQueryTimeout(){var e=this;return(0,b.A)(function*(){return e._sysSettingsService&&(yield e._sysSettingsService.getByCode("DataServiceQueryTimeout"))?.value||e._defaultDSQueryTimeoutMs})()}_withTimeout(e){return this._getDataServiceQueryTimeout8xFeature().pipe((0,d.switchMap)(t=>t?(0,l.from)(this._getDataServiceQueryTimeout()).pipe((0,d.switchMap)(n=>e.pipe((0,d.timeout)(n),(0,d.catchError)(i=>{throw i instanceof l.TimeoutError?new ra(i.message):i})))):e))}_executeWritableQuery(e,t){const i={...e.getMetadata(),queryKind:Qs.General};return this._withTimeout(this._httpClient.post(t,i).pipe((0,d.catchError)(r=>{throw new er(r)}),(0,d.tap)(r=>{if(!(r&&r.success))throw new Ih(e)})))}_getQueryUri(e){if(e instanceof uf)return`${this._dataServiceUri}/SelectLocalizationQuery`;if(e instanceof Cn)return`${this._dataServiceUri}/SelectQuery`;if(e instanceof il)return`${this._dataServiceUri}/InsertQuery`;if(e instanceof sl)return`${this._dataServiceUri}/UpdateQuery`;if(e instanceof Eh)return`${this._dataServiceUri}/DeleteQuery`;throw new Error("Unsupported query type")}_getBundleSettings(){var e=this;return(0,b.A)(function*(){return e._sysSettingsService?{executionDebounceTime:(yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName])).values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime}:Promise.resolve({executionDebounceTime:e._defaultDebounceTime})})()}_prepareDebouncedResponsesStream(){if(this._responses)return;let e=0;const t=(0,d.buffer)(this._requests.pipe((0,d.switchMap)(()=>(0,l.from)(this._getBundleSettings())),(0,d.tap)(n=>e=n.executionDebounceTime),(0,d.debounceTime)(e)));this._responses=this._requests.pipe(t,(0,d.filter)(n=>!!n.length),(0,d.mergeMap)(n=>{const i=n.map(a=>a.id),r=n.map(a=>a.query);return this.executeBatchSelectQuery(r).pipe((0,d.map)(a=>i.reduce((c,h,p)=>c.set(h,a[p]),new Map)))}),(0,d.share)())}_executeThrottled(e){this._prepareDebouncedResponsesStream();const t={id:L(),query:e},n=this._responses.pipe((0,d.filter)(i=>i.has(t.id)),(0,d.map)(i=>i.get(t.id)),(0,d.take)(1));return n.subscribe(),this._requests.next(t),n}_executeImmediate(e){B.checkArgumentEmpty("query",e);const t=this._getQueryUri(e),n=this._getQueryRequest(e);return this._withTimeout(this._httpClient.post(t,n).pipe((0,d.catchError)(i=>{throw new er(i)}),(0,d.tap)(i=>{if(!i?.rows)throw new Ih(e)}),(0,d.map)(i=>this._toSelectQueryResponse(i))))}_toSelectQueryResponse(e){const t=this.getRowsFromResponse(e);return t.rowsAffected=e.rowsAffected,e.errorInfo&&(t.errorInfo=e.errorInfo),t}_getQueryRequest(e){const t=e.getMetadata();return e instanceof Cn?{...t,queryKind:Qs.General,serverESQCacheParameters:new df().getMetadata(),queryOptimize:!1,useMetrics:!1,querySource:rl.Undefined}:{...t,queryKind:Qs.General}}_getTransactionQueries(e){return this._transactions.has(e)||this._transactions.set(e,[]),this._transactions.get(e)}_executeInTransaction(e,t){B.checkArgumentEmpty("transactionId",t),this._getTransactionQueries(t).push(e);const i=new l.Subject;return this._transactions$.set(e.queryId,i),i.asObservable()}_executeBatchQuery(e){if(B.checkArgumentEmpty("config",e),B.checkArgumentEmpty("queries",e.queries),e.queries.length===0)return e.throwIfNoQueries===!0?(0,l.throwError)(()=>new Error("Queries array is empty")):(0,l.of)({hasErrors:!1,queryResults:[]});const t=`${this._dataServiceUri}/BatchQuery`,n={items:e.queries.map(i=>this._getQueryRequest(i))};return e.continueIfError!=null&&(n.continueIfError=e.continueIfError),this._withTimeout(this._httpClient.post(t,n).pipe((0,d.catchError)(i=>{throw new er(i)}),(0,d.tap)(i=>{if(!i||i.hasErrors)throw new er(i);for(const r of i.queryResults)if(!r?.success)throw new er(r)})))}getRowsFromResponse(e){return e.rows}executeSelectQuery(e,t={throttled:!1},n){return n?(0,l.throwError)(()=>new Error("Not implemented")):t.throttled?this._executeThrottled(e):this._executeImmediate(e)}executeInsertQuery(e,t){return this.execute(e,t)}executeUpdateQuery(e,t){return this.execute(e,t)}executeDeleteQuery(e,t){return this.execute(e,t)}execute(e,t){if(B.checkArgumentEmpty("query",e),t)return this._executeInTransaction(e,t);const n=this._getQueryUri(e);return this._executeWritableQuery(e,n)}executeBatchSelectQuery(e){return this._executeBatchQuery({queries:e}).pipe((0,d.map)(t=>t.queryResults.map(n=>this._toSelectQueryResponse(n))))}commitTransaction(e){const t=this._getTransactionQueries(e);return this._executeBatchQuery({queries:t,continueIfError:!1,throwIfNoQueries:!0}).pipe((0,d.catchError)(n=>(t.forEach(i=>{const r=i.queryId;this._transactions$.get(r).error(n),this._transactions$.delete(r)}),(0,l.throwError)(()=>n))),(0,d.map)(n=>{const i={};return n.queryResults.forEach(r=>{const a=r.queryId,c=this._transactions$.get(a);c.next(r),c.complete(),this._transactions$.delete(a),i[a]=r}),i}),(0,d.tap)(()=>{this._transactions.delete(e)}))}rollbackTransaction(e){const t=this._getTransactionQueries(e),n={};return t.forEach(i=>{const r=i.queryId,a=this._transactions$.get(r),c={success:!1,rowsAffected:0,errorInfo:{message:"Transaction rollback",errorCode:"TransactionRollback",stackTrace:null}};n[r]=c,a.error(c),this._transactions$.delete(r)}),this._transactions.delete(e),(0,l.of)(n)}};oa=(0,u.__decorate)([(0,u.__param)(0,(0,s.Optional)()),(0,u.__param)(2,(0,s.Inject)(Xs)),(0,u.__param)(3,(0,s.Optional)()),(0,u.__metadata)("design:paramtypes",[Ge,U.HttpClient,String,xn])],oa);let al=class Sc extends oa{constructor(e,t,n,i,r){super(e,t,i,r),this._entityDeserializer=n}getRowsFromResponse(e){return this._entityDeserializer.deserializeEntities(e.rowConfig,e.rows)}static{this.\u0275fac=function(t){return new(t||Sc)(s.\u0275\u0275inject(Ge,8),s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(gi),s.\u0275\u0275inject(Xs),s.\u0275\u0275inject(xn,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Sc,factory:Sc.\u0275fac})}};al=(0,u.__decorate)([Xe({requestType:"crt.DataServiceQueryExecutor"}),(0,u.__metadata)("design:paramtypes",[Ge,U.HttpClient,gi,String,xn])],al);class Ah{constructor(e,t){this._transaction=e,this._action=t,this._id=L(),this._payload={},this._ready=new Promise(n=>{this._readyResolve=n,this._asyncResult=this._action(this)})}get id(){return this._id}get transactionId(){return this._transaction.id}get asyncResult(){return this._asyncResult}get ready(){return this._ready}get payload(){return this._payload}markAsReady(){this._readyResolve()}}class hf{get id(){return this._id}constructor(e){this._queryExecutor=e,this._id=L(),this._transactionOperations=[]}createOperation(e){const t=new Ah(this,e);return this._transactionOperations.push(t),t}createFailureOperation(e){const t=new Ah(this,n=>(n.markAsReady(),Promise.reject(e)));return this._transactionOperations.push(t),t}commit(){var e=this;return(0,b.A)(function*(){yield Promise.all(e._transactionOperations.map(i=>i.ready));let t=null;try{yield(0,l.firstValueFrom)(e._queryExecutor.commitTransaction(e._id))}catch(i){t=i}const n={};for(const i of e._transactionOperations)n[i.id]=yield i.asyncResult;if(t)throw t;return n})()}rollback(){var e=this;return(0,b.A)(function*(){yield(0,l.firstValueFrom)(e._queryExecutor.rollbackTransaction(e._id))})()}}let aa=class Mc{constructor(e){this._queryExecutor=e}create(){return Promise.resolve(new hf(this._queryExecutor))}static{this.\u0275fac=function(t){return new(t||Mc)(s.\u0275\u0275inject(Oe))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Mc,factory:Mc.\u0275fac})}};aa=(0,u.__decorate)([Xe({requestType:"crt.TransactionFactoryService"}),(0,u.__metadata)("design:paramtypes",[Oe])],aa);class tr{static{this.\u0275fac=function(t){return new(t||tr)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:tr})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[Mh,{provide:Oe,useClass:al},{provide:wh,useClass:aa}]})}}class cl{static{this.\u0275fac=function(t){return new(t||cl)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:cl})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[Mh,{provide:Oe,useFactory:(e,t,n,i)=>new oa(e,t,n,i),deps:[[new s.Optional,Ge],U.HttpClient,Xs,[new s.Optional,xn]]},{provide:wh,useClass:aa}]})}}var Ie=y(32667),R=y(23681),ca=y(29957),fi;(function(o){o[o.Primary=0]="Primary",o[o.Secondary=1]="Secondary",o[o.Cancel=2]="Cancel",o[o.Delete=3]="Delete"})(fi||(fi={}));const nr={caption:"ConfirmationDialog.YES",result:fi.Secondary},ll={caption:"ConfirmationDialog.NO",result:fi.Primary},YM={caption:"ConfirmationDialog.CANCEL",result:fi.Cancel},KM={caption:"ConfirmationDialog.DELETE",result:fi.Delete};var te=y(10821);function pf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"button",6),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("mat-dialog-close",t.secondaryButton.result),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(2,2,t.secondaryButton.caption)," ")}}function mf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"button",6),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("mat-dialog-close",t.result),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(2,2,t.caption)," ")}}class En{constructor(e){this.data=e,this.buttons=[],e&&(this.primaryButton=e.primaryButton,this.secondaryButton=e.secondaryButton,this.message=e.message,this.buttons=e.buttons),this.buttons?.length||(this.primaryButton??=ll,this.secondaryButton??=nr)}static{this.\u0275fac=function(t){return new(t||En)(s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:En,selectors:[["ts-confirmation-dialog"]],decls:9,vars:7,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngIf"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngFor","ngForOf"],["mat-button","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",0)(1,"span",1),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(3,"div",2)(4,"button",3),s.\u0275\u0275text(5),s.\u0275\u0275pipe(6,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(7,pf,3,4,"button",4)(8,mf,3,4,"button",5),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),s.\u0275\u0275advance(2),s.\u0275\u0275property("mat-dialog-close",n.primaryButton.result),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(6,5,n.primaryButton.caption)," "),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",n.secondaryButton),s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",n.buttons))},dependencies:[M.NgForOf,M.NgIf,te.MatButton,R.MatDialogClose,R.MatDialogActions,R.MatDialogContent,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{margin:27px 0 0!important;justify-content:flex-end}"]})}}class _i{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||_i)(s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:_i,selectors:[["ts-error-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","warn","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",0)(1,"span",1),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(3,"div",2)(4,"button",3),s.\u0275\u0275text(5),s.\u0275\u0275pipe(6,"translate"),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[te.MatButton,R.MatDialogClose,R.MatDialogActions,R.MatDialogContent,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class yi{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||yi)(s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:yi,selectors:[["ts-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",0)(1,"span",1),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(3,"div",2)(4,"button",3),s.\u0275\u0275text(5),s.\u0275\u0275pipe(6,"translate"),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[te.MatButton,R.MatDialogClose,R.MatDialogActions,R.MatDialogContent,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class He{constructor(e,t,n,i){this.document=e,this._ngZone=t,this._translateService=n,this.dialog=i}_stopEventPropagation(e,t){e.afterOpened().pipe((0,d.takeUntil)(t)).subscribe(n=>{const r=this.document.getElementsByClassName("cdk-overlay-container")[0];r&&r.addEventListener("click",function(a){a.stopImmediatePropagation()})})}getMessageDialogConfig(e){const t={width:"450px",panelClass:["dialog-top-border"],data:{}};if(typeof e=="string")return t.data.message=e,t;e.panelClass?.length>0&&t.panelClass.push(...e.panelClass);const n=e;return n.primaryButton&&(t.data.primaryButton=n.primaryButton),n.secondaryButton&&(t.data.secondaryButton=n.secondaryButton),n.buttons&&(t.data.buttons=n.buttons),t.data.message=n.message,t}open(e,t){return this._ngZone.run(()=>{const n=this.dialog.open(e,t),i=n.afterClosed();return this._stopEventPropagation(n,i),i})}openInfoDialog(e){return this.open(yi,this.getMessageDialogConfig(e))}openErrorDialog(e){return this.open(_i,this.getMessageDialogConfig(e))}openConfirmationDialog(e){return this.open(En,this.getMessageDialogConfig(e))}openOperationPermissionsErrorDialog(e){const t=ca.String.format(this._translateService.instant("OperationPermissionsErrorDialog.ErrorTemplate"),e);return this.openInfoDialog(t)}closeById(e){this.dialog.getDialogById(e)?.close()}closeAll(){this.dialog.closeAll()}hasOpenDialogs(){return!!this.dialog.openDialogs?.length}getOpenDialogs(){return this.dialog.openDialogs}static{this.\u0275fac=function(t){return new(t||He)(s.\u0275\u0275inject(M.DOCUMENT),s.\u0275\u0275inject(s.NgZone),s.\u0275\u0275inject(T.TranslateService),s.\u0275\u0275inject(R.MatDialog))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:He,factory:He.\u0275fac})}}var ir=y(50825),Z=y(37851);function gf(o,e){if(o&1&&s.\u0275\u0275element(0,"mat-icon",5),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("svgIcon",t.icon)}}function ff(o,e){if(o&1&&s.\u0275\u0275element(0,"mat-icon",10),o&2){const t=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275property("svgIcon",t==null?null:t.icon)}}function _f(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",8),s.\u0275\u0275listener("click",function(i){const r=s.\u0275\u0275restoreView(t).$implicit,a=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(a.onActionClick(r==null?null:r.handler,i))}),s.\u0275\u0275template(1,ff,1,1,"mat-icon",9),s.\u0275\u0275elementStart(2,"span"),s.\u0275\u0275text(3),s.\u0275\u0275elementEnd()()}if(o&2){const t=e.$implicit;s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t==null?null:t.icon),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(t==null?null:t.caption)}}function yf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div",6),s.\u0275\u0275template(1,_f,4,2,"button",7),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",t.actions)}}function Cf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",11),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("click",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onClose(i))}),s.\u0275\u0275element(2,"mat-icon",12),s.\u0275\u0275elementEnd()}o&2&&s.\u0275\u0275attribute("aria-label",s.\u0275\u0275pipeBind1(1,1,"Dialog.Close"))}class Ci{constructor(e,t){this.snackBarRef=e,this.data=t,this.message=t.message,this.actions=t.actions,this.closeMode=t.closeMode,this.icon=t.icon}onClose(e){e?.stopPropagation(),this.snackBarRef.dismiss()}onActionClick(e,t){var n=this;return(0,b.A)(function*(){yield e?.call(n,t),n.snackBarRef.dismiss()})()}static{this.\u0275fac=function(t){return new(t||Ci)(s.\u0275\u0275directiveInject(ir.MatSnackBarRef),s.\u0275\u0275directiveInject(ir.MAT_SNACK_BAR_DATA))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ci,selectors:[["ts-notify"]],decls:7,vars:6,consts:[[1,"crt-notify-container"],["class","crt-notify-icon",3,"svgIcon",4,"ngIf"],["data-qa","notificationPopup",1,"crt-notify-message"],["class","crt-notify-actions",4,"ngIf"],["mat-flat-button","","class","crt-notify-close-button-icon","type","button",3,"click",4,"ngIf"],[1,"crt-notify-icon",3,"svgIcon"],[1,"crt-notify-actions"],["type","button","mat-flat-button","",3,"click",4,"ngFor","ngForOf"],["type","button","mat-flat-button","",3,"click"],["class","crt-notify-action-button-icon",3,"svgIcon",4,"ngIf"],[1,"crt-notify-action-button-icon",3,"svgIcon"],["mat-flat-button","","type","button",1,"crt-notify-close-button-icon",3,"click"],["svgIcon","icon_close_24"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",0),s.\u0275\u0275template(1,gf,1,1,"mat-icon",1),s.\u0275\u0275elementStart(2,"output",2),s.\u0275\u0275text(3),s.\u0275\u0275pipe(4,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(5,yf,2,1,"div",3)(6,Cf,3,3,"button",4),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.icon),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(4,4,n.message)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",n.actions==null?null:n.actions.length),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.closeMode!=="auto"))},dependencies:[M.NgForOf,M.NgIf,te.MatButton,Z.MatIcon,T.TranslatePipe],styles:[".crt-notify-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-message[_ngcontent-%COMP%]{flex:1}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-icon[_ngcontent-%COMP%]{width:16px;margin-inline-end:8px}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-close-button-icon[_ngcontent-%COMP%]{padding:0;min-width:initial;margin-inline-start:16px}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-inline-start:40px}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-actions[_ngcontent-%COMP%]   .crt-notify-action-button-icon[_ngcontent-%COMP%]{width:16px;margin-inline-end:4px}"]})}}class In{constructor(e,t,n){this._snackBar=e,this._zone=t,this._environment=n,this._defaultDuration=this._environment?.defaultNotifyPopupDuration||5e3}show(e){const{message:t,duration:n,panelClass:i,icon:r,closeMode:a="default",actions:c=[]}=e||{},h=i?Array.isArray(i)?i:[i]:[],p=this._zone.run(()=>this._snackBar.openFromComponent(Ci,{data:{message:t,actions:c,closeMode:a,icon:r},duration:a==="manual"?0:n??this._defaultDuration,verticalPosition:"bottom",panelClass:["crt-notify",...h]}));return Promise.resolve(p)}error({message:e,duration:t}){return this.show({message:e,duration:t,panelClass:"notify-service-error"})}warn({message:e,duration:t}){return this.show({message:e,duration:t,panelClass:"notify-service-warn"})}info({message:e,duration:t}){return this.show({message:e,duration:t,panelClass:"notify-service-info"})}static{this.\u0275fac=function(t){return new(t||In)(s.\u0275\u0275inject(ir.MatSnackBar),s.\u0275\u0275inject(s.NgZone),s.\u0275\u0275inject("environment",8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:In,factory:In.\u0275fac})}}const bf="system-settings-cache";let la=class wc extends di{constructor(e,t,n,i){super(),this.httpClient=e,this._cacheManager=n,this._measurePerformanceService=i,this._sysSettingsInfo=new Map,this._sysSettingsValuesCache=new Map,this._sysSettingsChanged$=new l.Subject,this.sysSettingsChanged$=this._sysSettingsChanged$.asObservable(),this._serviceGetSysSettingsEndpoint=`${t}/QuerySysSettings`,this._serviceSaveSysSettingsEndpoint=`${t}/PostSysSettingsValues`,this._servicePreloadSysSettingsEndpoint=`${t}/PreloadSysSettings`}_removeNotActualSettingsValues(e){e.forEach(([t,n])=>{this._getIsSysSettingCached(t)&&this._getCacheableSysSetting(t).dataValueType===_.Lookup&&this._sysSettingsValuesCache.delete(t)})}_getSysSettingsRequestAfterUpdate(e){const t=e.filter(n=>!this._sysSettingsInfo.has(n[0]));return t.length===0?(0,l.of)(null):this.getByCodes(t.map(n=>n[0]))}_updateCache(e,t){const n=Object.entries(e??{}).filter(i=>t.saveResult[i[0]]);return n.filter(([i,r])=>this._sysSettingsInfo.has(i)).filter(([i,r])=>this._getIsSysSettingCacheable(i)).forEach(([i,r])=>{this._sysSettingsValuesCache.set(i,{value:r})}),this._getSysSettingsRequestAfterUpdate(n).pipe((0,d.map)(()=>t),(0,d.tap)(()=>{this._removeNotActualSettingsValues(n)}),(0,d.tap)(()=>{if(n.length>0){const i=n.map(r=>r[0]);this._sysSettingsChanged$.next(i)}}))}_getIsSysSettingCacheable(e){return this._sysSettingsInfo.get(e)?.isCacheable??!1}_getIsSysSettingCached(e){return this._getIsSysSettingCacheable(e)&&this._sysSettingsValuesCache.has(e)}_getCacheableSysSetting(e){const t=this._sysSettingsInfo.get(e);if(t&&t.isCacheable){const n=this._sysSettingsValuesCache.get(e);return{code:t.code,dataValueType:t.dataValueType,id:t.id,isCacheable:t.isCacheable,name:t.name,value:n.value,displayValue:n.displayValue}}return null}_setSysSettingInfo(e){this._sysSettingsInfo.set(e.code,{code:e.code,dataValueType:e.dataValueType,id:e.id,isCacheable:e.isCacheable,name:e.name})}_setSysSettingDetails(e){this._setSysSettingInfo(e),e?.isCacheable&&this._sysSettingsValuesCache.set(e.code,{displayValue:e.displayValue,value:e.value,code:e.code,dataValueTypeName:e.dataValueType,isCacheable:e.isCacheable})}_requestSysSettings(e){return this.httpClient.post(this._serviceGetSysSettingsEndpoint,{sysSettingsNameCollection:e}).pipe((0,d.share)(),(0,d.tap)(t=>{e.forEach(n=>{const i=t.values[n];i&&this._setSysSettingDetails(i)})}))}_getResponseWithCachedSysSettings(e,t){return t.filter(i=>this._getIsSysSettingCached(i)).map(i=>this._getCacheableSysSetting(i)).forEach(i=>{e.values[i.code]=i}),e}_createEmptySysSettingDetailByCode(e){return{code:e,value:null,isCacheable:!0}}_updateNotFoundSettingDetails(e){return e.notFoundSettings?.forEach(t=>{const n=this._createEmptySysSettingDetailByCode(t);this._setSysSettingDetails(n),e.values[t]=n}),e}getByCodes(e){if(!e||e.length===0)return(0,l.of)({success:!0,values:{}});const t=e.filter(n=>!this._getIsSysSettingCached(n));return t.length===0?(0,l.of)(this._getResponseWithCachedSysSettings({success:!0,values:{}},e)):this._requestSysSettings(t).pipe((0,d.map)(n=>this._getResponseWithCachedSysSettings(n,e)),(0,d.map)(n=>this._updateNotFoundSettingDetails(n)))}getByCode(e){return this.getByCodes([e]).pipe((0,d.map)(t=>t.values[e]))}getValueByCode(e,t){return this.getByCode(e).pipe((0,d.map)(n=>{const i=n?.value;return!(i==null||i==="")||t===void 0?i:t}),(0,l.catchError)(()=>(0,l.of)(t)))}updateMany(e,t=!1){const n={};return e.forEach(i=>n[i.code]=i.value),this.httpClient.post(this._serviceSaveSysSettingsEndpoint,{sysSettingsValues:n,isPersonal:t}).pipe((0,d.mergeMap)(i=>this._updateCache(n,i)),(0,d.share)())}update(e,t=!1){return this.updateMany([e],t)}preload(){if(this._preloadedSysSettings$)return this._preloadedSysSettings$;const e=new U.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),t=this.httpClient.post(this._servicePreloadSysSettingsEndpoint,{},{headers:e}).pipe((0,d.map)(n=>Object.values(n.values).map(i=>({key:i.code,value:i}))));return this._preloadedSysSettings$=this._cacheManager.executeWithBulkCache(bf,t).pipe(this._measurePerformanceService.measure$("SysSettingsService: preload sys settings with cache bulk"),(0,d.tap)(n=>{n.forEach(({value:i})=>{i.isCacheable=!0,this._setSysSettingDetails(i)})}),(0,d.map)(()=>Object.fromEntries(this._sysSettingsValuesCache.entries())),(0,l.shareReplay)({bufferSize:1,refCount:!1})),this._preloadedSysSettings$}static{this.\u0275fac=function(t){return new(t||wc)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Xs),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:wc,factory:wc.\u0275fac,providedIn:"root"})}};la=(0,u.__decorate)([Xe({requestType:"crt.SysSettingsService"}),(0,u.__metadata)("design:paramtypes",[U.HttpClient,String,Ce,q])],la);class An extends di{constructor(e,t){super(),this.sysSettingsService=e,this.userInfo=t,this._enabled=!1,this._initialized=!1}_initializeDataLayer(){const e=window;e.dataLayer&&(this._dataLayer=e.dataLayer)}_initializeScripts(e){e&&(e=e.replace(/'/g,'"'),this._appendChildScriptTag(document.head,"script",this._getHtmlTagContent("script",e)),this._appendChildScriptTag(document.body,"noscript",this._getHtmlTagContent("noscript",e)))}_getHtmlTagContent(e,t){if(!t||!e)return"";const n=new RegExp("<"+e+"[\\s\\S]*?>[\\s\\S]*?<\\/"+e+">","gi"),i=t.match(n);if(i&&i.length===1){const r=i[0],a=new RegExp("<(\\/|)"+e+"(.*?|)>","gi");return r.replace(a,"").trim()}else return""}_appendChildScriptTag(e,t,n){if(!e||!t||!n)return;const i=document.createElement(t);i.appendChild(document.createTextNode(n)),e.appendChild(i)}_initializeDefaultVariables(e){const t=this.userInfo,n={productName:e.ProductName,productEdition:e.ProductEdition,primaryCulture:{displayValue:t.cultureInfo.sysCultureName,value:t.cultureInfo.sysCultureId},customerId:e.CustomerId,version:e.ConfigurationVersion,userId:t.id,userType:this._getUserType(),accessType:t.accessType};this._pushVariables(n)}_getUserType(){return this.userInfo.isSSP?"External":"Employee"}_pushVariables(e){try{this._dataLayer.push(e)}catch(t){console.log(t.message)}}_initializeGoogleTagManager(e){e.UseGoogleTagManager&&(this._initializeScripts(e.GoogleTagManagerScript),this._initializeDataLayer(),this._enabled=!!this._dataLayer,this._enabled&&this._initializeDefaultVariables(e))}_executeInitialization(){const e=["UseGoogleTagManager","GoogleTagManagerScript","ProductName","ProductEdition","ConfigurationVersion","CustomerId"],t=this.sysSettingsService.getByCodes(e);return t.pipe((0,d.take)(1)).subscribe(n=>{const i=n&&n.success&&n.values&&(0,v.mapValues)(n.values||{},r=>r.value);i&&this._initializeGoogleTagManager(i),this._initialized=!0}),t.pipe((0,d.map)(()=>{}))}_resetCustomData(e){const t={};for(const n of Object.keys(e))t[n]=void 0;this._pushVariables(t)}initialize(){return this._initialized?(0,l.of)(void 0):(this._initializationObservable$||(this._initializationObservable$=this._executeInitialization()),this._initializationObservable$)}track(e){this._enabled&&(this._pushVariables(Object.assign(e,{description:JSON.stringify(e.description),event:e?.event||"bpmonlineInfo",virtualUrl:location.href})),this._resetCustomData(e))}static{this.\u0275fac=function(t){return new(t||An)(s.\u0275\u0275inject(la),s.\u0275\u0275inject(_t))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:An,factory:An.\u0275fac,providedIn:"root"})}}var k;(function(o){o.relationshipItem="relationship-item",o.relationshipContainer="relationship-container",o.connection="connection",o.parentConnection="parent-connection",o.indirectConnection="indirect-connection"})(k||(k={}));class Ae{constructor(){this.error$=new l.Subject,this.updateElementCaption$=new l.Subject,this.updateConnectionCaption$=new l.Subject,this.updateCaption$=new l.Subject,this.changed$=new l.Subject,this.startLoading$=new l.Subject,this.endLoading$=new l.ReplaySubject(1)}init(){}bufferiseOps(e,t,n){}load(e,t){return(0,b.A)(function*(){return Promise.resolve(null)})()}getDiagramConfig(){return(0,b.A)(function*(){return Promise.resolve()})()}diagramInitialized(){}commit(e){return(0,b.A)(function*(){})()}undo(){}redo(){}clearCash(){}static{this.\u0275fac=function(t){return new(t||Ae)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ae,factory:Ae.\u0275fac})}}var je;(function(o){o.connection="connection",o.defaultConnection="defaultConnection",o.label="label",o.root="root",o.shape="shape"})(je||(je={}));const bi={root:{id:"root1",type:je.root}},ve={element:{deleteElementsExecuted:"commandStack.elements.delete.executed",paste:"elements.paste",updateLabel:"element.updateLabel",updateLabelExecuted:"commandStack.element.updateLabel.executed",mouseDown:"element.mousedown",doubleClick:"element.dblclick",update:"element.update",updated:"element.updated",typeUpdated:"element.typeUpdated",click:"element.click",updateExecuted:"commandStack.element.update.executed",validation:"element.validation",canUpdateType:"element.canUpdateType"},elements:{create:"elements.create",move:"elements.move",delete:"elements.delete",removing:"elements.removing",updatingTypeValidate:"elements.updatingTypeValidate",canCopy:"elements.canCopy",changed:"elements.changed"},directEditing:{activate:"directEditing.activate",complete:"directEditing.complete",cancel:"directEditing.cancel",resize:"directEditing.resize"},label:{createExecuted:"commandStack.label.create.executed",create:"label.create"},lane:{create:"lane.create",resize:"lane.resize",split:"lane.split"},diagram:{create:"diagram.create",changed:"diagram.changed",initialized:"diagram.initialized"},selection:{changed:"selection.changed"},shape:{createExecuted:"commandStack.shape.create.executed",moveExecuted:"commandStack.shape.move.executed",resizeExecuted:"commandStack.shape.resize.executed",deleteExecuted:"commandStack.shape.delete.executed",move:"shape.move.move",end:"shape.move.end",shapeMove:"shape.move",shapeCreate:"shape.create",shapeResize:"shape.resize",shapeDelete:"shape.delete"},import:{elementAdd:"import.element.add"},connection:{createExecuted:"commandStack.connection.create.executed",update:"connection.update",updateExecuted:"commandStack.connection.update.executed",moveExecuted:"commandStack.connection.move.executed",layoutExecuted:"commandStack.connection.layout.executed",reconnectEndExecuted:"commandStack.connection.reconnectEnd.executed",updateWaypointsExecuted:"commandStack.connection.updateWaypoints.executed",reconnectExecuted:"commandStack.connection.reconnect.executed",deleteExecuted:"commandStack.connection.delete.executed",changeDirection:"connection.changeDirection",changeDirectionExecuted:"commandStack.connection.changeDirection.executed",reconnect:"connection.reconnect",moveConnectionLabel:"connection.move.label",highlight:"commandStack.connection.highlight.executed"},connect:{move:"connect.move",hover:"connect.hover",end:"connect.end"},create:{move:"create.move",end:"create.end"}};var vf=y(15192);class vi{getFeatureValues(e){return(0,l.of)([]).subscribe(()=>e({}))}static{this.\u0275fac=function(t){return new(t||vi)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:vi,factory:vi.\u0275fac})}}const ua=new s.InjectionToken("DiagramFeaturesToken");class sr{get data(){return this.diagramData}set data(e){this.diagramData=e}get diagram(){return this.internalDiagram}set diagram(e){this.internalDiagram=e}getDiagramDataId(){return this.diagramData?this.diagramData.id:null}getDiagramDataCaption(){return this.diagramData?this.diagramData.caption:null}hasDiagramData(){return!!this.diagramData}static{this.\u0275fac=function(t){return new(t||sr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:sr,factory:sr.\u0275fac,providedIn:"root"})}}const Sf=["diagramContainer"],Mf=["resetZoomButton"];class Si{set _isReadOnly(e){this.isReadOnly=e==="true"}set _isStraightConnection(e){this.isStraightConnection=e==="true"}set _isRtl(e){this.isRtl=e==="rtl"}get diagramEventHandlerController(){return this.get("diagramEventHandlerController")}get _diagramLoader(){return this.get("diagramLoader")}get modeling(){return this.get("modeling")}constructor(e){this.injector=e,this._initScale=1,this._unloaded$=new l.Subject,this._defaultTool="arrow",this.isRtl=!1,this.destroyed$=new l.Subject,this.initScroll={x:0,y:0},this.loaded=new l.Subject,this.loading=!0,this.elementDblClick=new s.EventEmitter,this.elementSelected=new s.EventEmitter,this.diagramInitialized=new s.EventEmitter,this.afterViewInit=new s.EventEmitter,this.loadProgress$=new l.Subject,this.isReadOnly=!1,this.isStraightConnection=!1,this.injectDependencies()}_initDiagram(e){this.diagramContainer=new s.ElementRef(document.querySelector(".diagram-container")),this.diagram=new vf.A({canvas:{container:this.diagramContainer.nativeElement},keyboard:{bindTo:window},modules:[this.features,{loggerService:["value",this.loggerService]}],isReadOnly:this.isReadOnly,isStraightConnection:this.isStraightConnection,isRtl:this.isRtl,popupMenu:{scale:{min:1,max:1}},contextPad:{scale:{min:1,max:1}},initScroll:this.initScroll,initScale:this._initScale,...e}),this.diagramDataService.diagram=this.diagram,this.diagramEventHandlerController.service=this.service;const t=this.get("canvas"),n=this.get("editorActions"),i=this.get("elementFactory"),r=this.get("eventBus");r.fire("attach",{}),r.fire("editorActions.init",{editorActions:n});const a=i.createRoot({id:bi.root.id});t.setRootElement(a),this.tool=this._defaultTool,this._serviceSubscriptions=this._subscribeService(),this.get("featureProvider").featureService=this.featureService}_setSelectedElement(e){if(e){const t=this.get("eventBus"),i=this.get("elementRegistry").get(e);i&&t.fire("element.click",{element:i})}}_subscribeLoadingData(){var e=this;const t=this.service.startLoading$.subscribe(i=>{this.dataId!==i&&(this.loading=!0)}),n=this.service.endLoading$.pipe((0,d.filter)(i=>i&&this.dataId!==i.id)).subscribe(function(){var i=(0,b.A)(function*(r){e._unloaded$.next(),yield e.loadDiagramData(r)});return function(r){return i.apply(this,arguments)}}());this._serviceSubscriptions.push(t,n),this.diagramInitialized.emit(),this.get("eventBus").fire(ve.diagram.initialized)}_getCancellationToken(){const e=new l.Subject;return(0,l.merge)(this.destroyed$,this._unloaded$).subscribe(()=>{e.next(),e.complete()}),e}_subscribeService(){var e=this;const t=this.diagramEventHandlerController.subscribeServerChanges();return t.push(this.service.error$.pipe((0,d.takeUntil)(this.destroyed$),(0,d.debounceTime)(1e3)).subscribe(function(){var n=(0,b.A)(function*(i){yield e.notifyService.error({message:i});const r=e.diagramDataService.getDiagramDataId();e.loggerService.exception(i,{loggerName:"DiagramService"},{diagramDataId:r})});return function(i){return n.apply(this,arguments)}}()),this.service.updateCaption$.subscribe(n=>this._changeCaption(n))),t}_unsubscribeService(){this._serviceSubscriptions&&this._serviceSubscriptions.forEach(e=>e.unsubscribe())}unloadDiagramData(){this.diagram&&(this.get("directEditing").complete(),this._clearDiagram())}initDiagramData(e){var t=this;return(0,b.A)(function*(){t._initLocalStorage(),t._initZoomScroll(),t.diagramEventHandlerController.stopSync(),t.unloadDiagramData();const n=yield t._diagramLoader.load(t.diagramDataService.data,e,t.loadProgress$);if(e.isStopped)return;const i=n&&n[0];i&&(yield t.notifyService.show({message:i})),t.diagramEventHandlerController.startSync()})()}_changeCaption(e){this.caption=e.value}_initLocalStorage(){const e=this.get("localStorage");e.diagramId=this.diagramDataService.getDiagramDataId()}_initZoomScroll(){this.get("zoomScroll").initZoomScroll()}_subscribeDiagramChanges(){const e=this.get("eventBus");e.on(["create.end","connect.end","element.click","shape.move.end"],t=>{this._onSelectedElementChanged(t.element||t.context.shape||t.context.connection)}),e.on(["shape.replaced"],t=>v.defer(()=>this._onSelectedElementChanged(t))),e.on(["selection.changed"],t=>{const n=t.newSelection,i=n.length===1&&n[0];i&&!this.loading&&this._onSelectedElementChanged(i)}),e.on(["tool-manager.update"],t=>this._onToolChanged(t.tool)),e.on(["element.dblclick"],()=>this._elementDblClick())}_elementDblClick(){this.elementDblClick.emit()}_onSelectedElementChanged(e){let t=null;const n={source:this,id:t};e&&e.type!==bi.root.type&&(t=(e.labelTarget||e).id,n.id=t),this.elementSelected.emit(n),this.get("eventBus").fire("diagram.item.selected",{id:t})}_onToolChanged(e){this.tool=e||this._defaultTool}_getLocalizationObject(e){return{get:t=>{const n=t.split(".");let i=e;for(const r of n){if(!i||!i.hasOwnProperty(r))return t;i=i[r]}return i??t}}}_getDiagramLocalizableStrings(e){var t=this;return(0,b.A)(function*(){const n=t.translateService,i=n.getDefaultLang(),r=n.currentLang;let a,c;i===r?c=n.translations[r]?(0,l.of)({...n.translations[r],...n.translations[r]?.diagram}):n.getTranslation(r).pipe((0,d.map)(({diagram:p})=>p)):(a=n.translations?(0,l.zip)((0,l.of)(n.translations[i]),(0,l.of)(n.translations[r])):(0,l.zip)(n.getTranslation(i),n.getTranslation(r)),c=a.pipe((0,d.map)(([p,m])=>v.merge(p?.diagram,m?.diagram))));const h=yield(0,l.lastValueFrom)(c.pipe((0,d.first)()),{defaultValue:null});return t._getLocalizationObject({...h,...e})})()}_reloadDiagram(){var e=this;return(0,b.A)(function*(){const t=yield e._getDiagramConfig();e.diagramDataService.hasDiagramData()&&e._clearDiagram(),e._destroyDiagram(),e._unsubscribeService(),e._initDiagram(t),e._subscribeLoadingData(),e._subscribeDiagramChanges(),e.diagramDataService.hasDiagramData()&&(yield e.initDiagramData(e._getCancellationToken()))})()}_clearDiagram(){this.diagramEventHandlerController.stopSync(),this.diagram.clear()}_destroyDiagram(){this.diagram&&(this.get("eventBus").fire("detach",{}),this.diagram.destroy())}_getDiagramConfig(){var e=this;return(0,b.A)(function*(){const t=yield e.service.getDiagramConfig();return{localizableStrings:yield e._getDiagramLocalizableStrings(t&&t.customLocalizableStrings),...t}})()}injectDependencies(){this.diagramDataService=this.injector.get(sr),this.service=this.injector.get(Ae),this.translateService=this.injector.get(T.TranslateService),this.notifyService=this.injector.get(In),this.featureService=this.injector.get(vi),this.loggerService=this.injector.get(Rt),this.features=this.injector.get(ua)}loadDiagramData(e){var t=this;return(0,b.A)(function*(){const n=t._getCancellationToken();if(!(t.destroyed$.isStopped||t._unloaded$.isStopped))if(t.diagramDataService.data=e,t.diagramDataService.hasDiagramData()){if(yield t.initDiagramData(n),n.isStopped)return;t.caption=t.diagramDataService.getDiagramDataCaption(),t.loading=!1,t.loaded.next(e.id),t._setSelectedElement(t.elementSelect)}else{t.loading=!1;const i=`Error. Diagram with id = "${e.id}" does not exists`;t.loaded.error(i)}})()}ngOnInit(){this.translateService.onLangChange.pipe((0,d.takeUntil)(this.destroyed$)).subscribe(()=>{this.loading?this.service.endLoading$.pipe((0,d.first)()).subscribe(()=>this._reloadDiagram()):this._reloadDiagram()})}ngAfterViewInit(){var e=this;return(0,b.A)(function*(){const t=yield e._getDiagramConfig();e._initDiagram(t),e._subscribeLoadingData(),e._subscribeDiagramChanges(),e._initZoomScroll(),e.afterViewInit.emit()})()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this._unsubscribeService(),this.diagramDataService.hasDiagramData()&&this.unloadDiagramData(),this._destroyDiagram()}get(e){return this.diagram.get(e)}onHandClick(){this.get("toolManager").setActive(null),this.get("dragging").cancel()}onLassoClick(){this.get("lassoTool").toggle()}onSpaceClick(){this.get("spaceTool").toggle()}onUndoClick(){this.service.undo()}onRedoClick(){this.service.redo()}update(e){this.modeling.updateLabel(e.id,e.value)}static{this.\u0275fac=function(t){return new(t||Si)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Si,selectors:[["ts-app-diagram"]],viewQuery:function(t,n){if(t&1&&(s.\u0275\u0275viewQuery(Sf,7,s.ElementRef),s.\u0275\u0275viewQuery(Mf,7,s.ElementRef)),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.diagramContainer=i.first),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.resetZoomButton=i.first)}},hostVars:1,hostBindings:function(t,n){t&2&&s.\u0275\u0275attribute("data-qa",n.caption)},inputs:{_isReadOnly:[0,"readonly","_isReadOnly"],_isStraightConnection:[0,"straightconnection","_isStraightConnection"],_isRtl:[0,"dir","_isRtl"],elementSelect:"elementSelect"},outputs:{elementDblClick:"elementDblClick",elementSelected:"elementSelected",diagramInitialized:"diagramInitialized",afterViewInit:"afterViewInit"},decls:2,vars:0,consts:[["diagramContainer",""],[1,"diagram-container"]],template:function(t,n){t&1&&s.\u0275\u0275element(0,"div",1,0)},styles:[`.diagram-container{position:relative;height:100%;width:100%;margin:0}.diagram-container svg{display:block}.djs-container{direction:ltr}.djs-tooltip{border-radius:4px;padding:8px;width:150px;opacity:.9;backdrop-filter:blur(5px);z-index:1010}.djs-palette{left:10px;top:10px;border-radius:4px;overflow:hidden;padding-top:6px;padding-bottom:6px}.djs-palette.open,.djs-palette.two-column.open{width:46px}.djs-palette .group{padding:0!important;width:100%}.djs-palette .entry{width:32px;height:32px;line-height:32px;margin-left:6px;cursor:pointer}.djs-palette .entry.active{border-radius:7px}.djs-palette .entry.create-menu:after{content:"";position:absolute;width:0;height:0;border-top:3px solid transparent;border-bottom:3px solid transparent;border-left:3px solid #006ce0;margin-top:13px;margin-left:-4px}.djs-context-pad.open{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;border-radius:4px;pointer-events:auto}.djs-context-pad.open .group{display:grid;grid-template-columns:auto auto;padding:3px}.djs-context-pad.open .group:not(:first-child){padding-left:0}.djs-context-pad.open.one-column-grid .group{grid-template-columns:auto}.djs-context-pad.open .entry{height:32px;width:32px;background:transparent;margin:0;box-shadow:none;border-radius:3px}.djs-context-pad.open .entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}.djs-context-pad.open .entry.noop-entry:hover{background:inherit!important}.djs-context-pad.open .entry img{padding:4px}.entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}@supports (backdrop-filter: none){.djs-context-pad.open{backdrop-filter:blur(5px);background:#ffffffc7}.djs-context-pad.open .entry{background:transparent}}.djs-context-pad{max-width:72px}.djs-element.djs-connection.djs-updating path,.djs-element.djs-connection.selected path,.djs-element.djs-connection.animated path{stroke:#1186d8!important}.djs-element.djs-connection.djs-updating path.connection-end-marker,.djs-element.djs-connection.selected path.connection-end-marker,.djs-element.djs-connection.animated path.connection-end-marker{fill:#1186d8!important}.djs-element.djs-connection.animated path.connection{stroke-width:3!important;stroke-dasharray:20,3;animation:dash 5s linear infinite}@keyframes dash{0%{stroke-dashoffset:115}}.djs-bendpoint .djs-visual{fill:#fff;stroke-width:1px;stroke:#1186d8}.djs-bendpoint.floating .djs-visual{display:none}.djs-bendpoints.hover .djs-visual{stroke:#8095b3}.djs-element.hover .djs-outline{stroke:#a7c6ff}.laneSet.hover .djs-visual,.lane.hover .djs-visual{opacity:initial}.djs-element.selected .djs-outline{stroke:#3168cc}.djs-segment-dragger .djs-visual{fill:transparent;stroke:transparent}.djs-snap-line{stroke-width:1px}.djs-popup{overflow-y:auto;overflow-x:hidden;max-height:calc(100% - 20px);opacity:0;transition:opacity .2s ease-out}.djs-popup .entry{display:flex;flex-direction:row-reverse;justify-content:flex-end;align-items:stretch;padding:5px 7px}.djs-popup .entry img{height:24px;width:24px}.djs-popup .djs-popup-header{display:flex;margin:0 9px}.djs-popup .djs-popup-header .entry.active{border:none}.djs-popup .djs-popup-header .entry:first-child{margin-left:0}.djs-popup .djs-popup-header .entry{height:34px;width:34px;padding:4px;margin:2px 1px 2px 4px}.djs-dragger .djs-visual rect{fill:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border){display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;pointer-events:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border) .djs-direct-editing-content{margin:0 auto;pointer-events:auto;text-align:center}.djs-direct-editing-content{user-select:text!important;overflow:hidden;outline:none;resize:none}.djs-direct-editing-parent-no-border .djs-direct-editing-content{border:0}.djs-direct-editing-rotate-90{transform:rotate(-90deg);transition:transform .1s ease}.djs-direct-editing-rotate-90 .djs-direct-editing-content{border:none;transition:border .1s ease}.djs-direct-editing-rotate-0{transform:rotate(0)}.djs-text-hidden text{display:none}.djs-text-hidden foreignObject{display:none}.djs-direct-editing-resize-handle{display:none}.djs-shape.connect-ok.textAnnotation .djs-visual>:nth-child(1):not(path),.djs-shape.connect-not-ok.textAnnotation .djs-visual>:nth-child(1):not(path){fill:inherit!important}.djs-element.lane.hover:not(.selected) .djs-outline{stroke:none}.djs-element.laneSet.hover:not(.selected) .djs-outline{stroke:none}foreignObject.djs-label{overflow:visible}.foreign-text-container{display:flex;justify-content:center;height:100%}.laneSet .foreign-text-container,.lane .foreign-text-container{align-items:center}.eventSubProcessExpanded .foreign-text-container{height:initial;padding:5px}.foreign-text{text-align:center;box-sizing:border-box;outline:none;font-family:Open Sans,sans-serif;font-size:12px;font-weight:400;line-height:1.2;overflow-wrap:break-word;white-space:pre-line}.label .foreign-text{max-width:130px;user-select:text}.textAnnotation .foreign-text{padding:12px;max-width:none;text-align:left;line-height:1.41667;word-wrap:break-word}.textAnnotation foreignObject{height:100%}.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}@supports (-webkit-line-clamp: 2){.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{vertical-align:center;overflow:hidden;text-overflow:ellipsis;white-space:initial;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}.foreign-text-helper{max-width:128px;min-height:14.39px;width:fit-content;margin:0 auto;overflow-wrap:break-word}.diagram-create-popup-menu{border-top:none!important}.diagram-create-popup-menu .entry{cursor:move}.djs-minimap{position:absolute;right:8px;bottom:11px;width:248px;height:33px;border-radius:4px;opacity:1;overflow:hidden;box-sizing:border-box;user-select:none;transition:height .2s cubic-bezier(0,0,.2,1)}.djs-minimap .map-buttons{position:absolute;bottom:0;left:0;right:0;height:32px;display:flex;padding:0 5px;z-index:1}.djs-minimap .map-buttons .map-button{min-width:32px;height:32px;cursor:pointer;line-height:32px;font-size:16px;padding:0 8px;background-position:center;transition:background .8s}.djs-minimap .map-buttons .map-button:active{background-size:100%;transition:background 0s}.djs-minimap .map-buttons .map-button.preview-button{padding:0 12px 0 10px;margin:0 4px 0 0;min-width:40px}.djs-minimap .map-buttons .map-button.zoom-button{width:100%;height:100%;padding:0 16px 0 0;text-align:right}.djs-minimap .map-buttons .map-button.zoom-button:after{content:"";position:absolute;width:0;height:0;right:9px;top:16px}.djs-minimap .map{width:248px;height:148px;margin-bottom:32px;cursor:crosshair}.djs-minimap.open{transition:height .2s cubic-bezier(.18,.89,.32,1.28);height:180px}.djs-minimap.open .overlay{position:absolute;inset:0;pointer-events:none}.djs-minimap .viewport{fill:none;stroke:none}.djs-minimap .viewport-dom{position:absolute;border-radius:2px;box-sizing:border-box;cursor:move}.djs-minimap .cursor-crosshair{cursor:crosshair}.djs-minimap .cursor-move{cursor:move}.djs-popup.zoom{right:8px;bottom:47px;top:inherit!important;left:inherit!important}.djs-popup.zoom .entry{display:flex;flex-direction:row;justify-content:space-between;align-items:stretch}.djs-popup.zoom .entry.entry-separator{padding:0!important;margin:4px 10px!important}#canvas_svg_export{position:absolute;left:50px;top:50px;box-shadow:0 0 9px 2px #0000007a}#canvas_svg_export .close-button{position:absolute;right:8px;width:16px;height:16px;cursor:pointer}
`,`.djs-outline{fill:none;visibility:hidden}.djs-element.hover .djs-outline,.djs-element.selected .djs-outline{visibility:visible;shape-rendering:crispEdges;stroke-dasharray:3,3}.djs-element.selected .djs-outline{stroke:#88f;stroke-width:1px}.djs-element.hover .djs-outline{stroke:#f88;stroke-width:1px}svg.drop-not-ok{background:#f9dee5!important}.djs-connection.connect-ok .djs-visual>:nth-child(1),.djs-connection.drop-ok .djs-visual>:nth-child(1){stroke:#90dd5f!important}.djs-connection.connect-not-ok .djs-visual>:nth-child(1),.djs-connection.drop-not-ok .djs-visual>:nth-child(1){stroke:#e56283!important}.drop-not-ok,.connect-not-ok{cursor:not-allowed}.djs-element.attach-ok .djs-visual>:nth-child(1){stroke-width:5px!important;stroke:#ff7400b3!important}.djs-frame.connect-not-ok .djs-visual>:nth-child(1),.djs-frame.drop-not-ok .djs-visual>:nth-child(1){stroke-width:3px!important;stroke:#e56283!important;fill:none!important}.djs-lasso-overlay{fill:#ff7400;fill-opacity:.1;stroke-dasharray:5 1 3 1;stroke:#ff7400;shape-rendering:crispEdges;pointer-events:none}.djs-resize-overlay{fill:none;stroke-dasharray:5 1 3 1;stroke:#ff7400;pointer-events:none}.djs-resizer-hit{fill:none;pointer-events:all}.djs-resizer-visual{fill:#fff;stroke-width:1px;stroke:#000;shape-rendering:crispEdges;stroke-opacity:.2}.djs-cursor-resize-ns,.djs-resizer-n,.djs-resizer-s{cursor:ns-resize}.djs-cursor-resize-ew,.djs-resizer-e,.djs-resizer-w{cursor:ew-resize}.djs-cursor-resize-nwse,.djs-resizer-nw,.djs-resizer-se{cursor:nwse-resize}.djs-cursor-resize-nesw,.djs-resizer-ne,.djs-resizer-sw{cursor:nesw-resize}.djs-shape.djs-resizing>.djs-outline{visibility:hidden!important}.djs-shape.djs-resizing>.djs-resizer{visibility:hidden}.djs-dragger>.djs-resizer{visibility:hidden}marker.djs-dragger circle,marker.djs-dragger path,marker.djs-dragger polygon,marker.djs-dragger polyline,marker.djs-dragger rect{fill:#ff7400!important;stroke:none!important}marker.djs-dragger text,marker.djs-dragger tspan{fill:none!important;stroke:#ff7400!important}.djs-dragging{opacity:.3}.djs-dragging,.djs-dragging>*{pointer-events:none!important}.djs-dragging .djs-context-pad,.djs-dragging .djs-outline{display:none!important}.djs-visual,.djs-outline{pointer-events:none}.djs-element.attach-ok .djs-hit{stroke-width:60px!important}.djs-element>.djs-hit-all{pointer-events:all}.djs-element>.djs-hit-stroke,.djs-element>.djs-hit-click-stroke{pointer-events:stroke}.djs-drag-active .djs-element>.djs-hit-click-stroke{pointer-events:all}.djs-connection .djs-visual{stroke-width:2px;fill:none}.djs-cursor-grab{cursor:grab}.djs-cursor-grabbing{cursor:grabbing}.djs-cursor-crosshair{cursor:crosshair}.djs-cursor-move{cursor:move}.djs-cursor-resize-ns{cursor:ns-resize}.djs-cursor-resize-ew{cursor:ew-resize}.djs-snap-line{stroke:#ffc342;stroke:#ffc34280;stroke-linecap:round;stroke-width:2px;pointer-events:none}.djs-crosshair{stroke:#555;stroke-linecap:round;stroke-width:1px;pointer-events:none;shape-rendering:crispEdges;stroke-dasharray:5,5}.djs-palette{position:absolute;left:20px;top:20px;box-sizing:border-box;width:48px}.djs-palette .separator{margin:0 5px;padding-top:5px;border:none;border-bottom:solid 1px #DDD;clear:both}.djs-palette .entry:before{vertical-align:text-bottom}.djs-palette .djs-palette-toggle{cursor:pointer}.djs-palette .entry,.djs-palette .djs-palette-toggle{color:#333;font-size:30px;text-align:center}.djs-palette .entry{float:left}.djs-palette .entry img{max-width:100%}.djs-palette .djs-palette-entries:after{content:"";display:table;clear:both}.djs-palette .djs-palette-toggle:hover{background:#666}.djs-palette .entry:hover{color:#ff7400}.djs-palette .highlighted-entry{color:#ff7400!important}.djs-palette .entry,.djs-palette .djs-palette-toggle{width:46px;height:46px;line-height:46px;cursor:default}.djs-palette.two-column.open{width:94px}.djs-palette:not(.open) .djs-palette-entries{display:none}.djs-palette:not(.open){overflow:hidden}.djs-palette.open .djs-palette-toggle{display:none}.djs-overlay-context-pad{width:72px}.djs-context-pad{position:absolute;display:none;pointer-events:none}.djs-context-pad .entry{width:22px;height:22px;text-align:center;display:inline-block;font-size:22px;margin:0 2px 2px 0;border-radius:3px;cursor:default;background-color:#fefefe;box-shadow:0 0 2px 1px #fefefe;pointer-events:all}.djs-context-pad .entry:before{vertical-align:top}.djs-context-pad .entry:hover{background:#fffcb0}.djs-context-pad.open{display:block}.djs-popup .entry{line-height:20px;white-space:nowrap;cursor:default}.djs-popup .entry:before{vertical-align:middle;font-size:20px}.djs-popup .entry>span{vertical-align:middle;font-size:14px}.djs-popup .entry:hover,.djs-popup .entry.active:hover{background:#fffcb0}.djs-popup .entry.disabled{background:inherit}.djs-popup .djs-popup-header .entry{display:inline-block;padding:2px 3px;border:solid 1px transparent;border-radius:3px}.djs-popup .djs-popup-header .entry.active{color:#ff7400;border:solid 1px rgb(255,116,0);background-color:#f6f6f6}.djs-popup-body .entry{padding:4px 10px 4px 5px}.djs-popup-body .entry>span{margin-left:5px}.djs-popup-body{background-color:#fefefe}.djs-popup-header{border-bottom:1px solid #DDD}.djs-popup-header .entry{margin:1px 1px 1px 3px}.djs-popup-header .entry:last-child{margin-right:3px}.djs-popup,.djs-palette{background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-shape,.djs-connection{touch-action:none}.djs-segment-dragger,.djs-bendpoint{display:none}.djs-segment-dragger .djs-visual{fill:#ffff7933;stroke-width:1px;stroke-opacity:1;stroke:#ffff794d}.djs-bendpoint .djs-visual{fill:#ffff79cc;stroke-width:1px;stroke-opacity:.5;stroke:#000}.djs-segment-dragger:hover,.djs-bendpoints.hover .djs-segment-dragger,.djs-bendpoints.selected .djs-segment-dragger,.djs-bendpoint:hover,.djs-bendpoints.hover .djs-bendpoint,.djs-bendpoints.selected .djs-bendpoint{display:block}.djs-drag-active .djs-bendpoints *{display:none}.djs-bendpoints:not(.hover) .floating{display:none}.djs-segment-dragger:hover .djs-visual,.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint:hover .djs-visual,.djs-bendpoint.floating .djs-visual{fill:#ff0;stroke-opacity:.5;stroke:#000}.djs-bendpoint.floating .djs-hit{pointer-events:none}.djs-segment-dragger .djs-hit,.djs-bendpoint .djs-hit{pointer-events:all;fill:none}.djs-segment-dragger.horizontal .djs-hit{cursor:ns-resize}.djs-segment-dragger.vertical .djs-hit{cursor:ew-resize}.djs-segment-dragger.djs-dragging .djs-hit{pointer-events:none}.djs-updating,.djs-updating>*{pointer-events:none!important}.djs-updating .djs-context-pad,.djs-updating .djs-outline,.djs-updating .djs-bendpoint,.connect-ok .djs-bendpoint,.connect-not-ok .djs-bendpoint,.drop-ok .djs-bendpoint,.drop-not-ok .djs-bendpoint{display:none!important}.djs-segment-dragger.djs-dragging,.djs-bendpoint.djs-dragging{display:block;opacity:1}.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint.djs-dragging .djs-visual{fill:#ff0;stroke-opacity:.5}.djs-tooltip-error{font-size:11px;line-height:18px;text-align:left;padding:5px;opacity:.7}.djs-tooltip-error>*{width:160px;background:#fcecf0;color:#9e4c4c;padding:3px 7px;border-radius:5px;border-left:solid 5px rgb(174,73,73)}.djs-tooltip-error:hover{opacity:1}.djs-search-container{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;width:25%;min-width:300px;max-width:400px;z-index:10;font-size:1.05em;opacity:.9;background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-search-container:not(.open){display:none}.djs-search-input input{font-size:1.05em;width:100%;padding:6px 10px;border:1px solid #ccc}.djs-search-input input:focus{outline:none;border-color:#52b415}.djs-search-results{position:relative;overflow-y:auto;max-height:200px}.djs-search-results:hover{cursor:pointer}.djs-search-result{width:100%;padding:6px 10px;background:#fff;border-bottom:solid 1px #AAA;border-radius:1px}.djs-search-highlight{color:#000}.djs-search-result-primary{margin:0 0 10px}.djs-search-result-secondary{font-family:monospace;margin:0}.djs-search-result:hover{background:#fdffd6}.djs-search-result-selected{background:#fffcb0}.djs-search-result-selected:hover{background:#f7f388}.djs-search-overlay{background:#ff0;opacity:.3}.djs-element-hidden,.djs-element-hidden .djs-hit,.djs-element-hidden .djs-outline,.djs-label-hidden .djs-label{display:none!important}
`],encapsulation:2})}}(0,ws.marker)("diagram.connections.connection"),(0,ws.marker)("diagram.connections.defaultConnection");const wf={connection:{caption:"connections.connection",order:{containers:["laneSet","lane","subProcessExpanded","eventSubProcessExpanded"],level:3},propertiesImage:"assets/images/SequenceFlowProperties.svg",type:je.connection}},ke={label:{height:20,minHeight:20,type:je.label,width:130,editStyle:{fontFamily:'"Open Sans", sans-serif',fontSize:12,fontWeight:"normal",lineHeight:1.2},padding:{paddingTop:1,paddingBottom:2,paddingLeft:2,paddingRight:2},minWidth:65,order:{level:10}}};let ie=class{constructor(e={}){this.config=e,this.items=this.getItems()}getItems(){const e=this.config.customDiagramElements||{};return{...ke,...wf,...bi,...e}}getConfig(e){return this.items[e.userTaskType||e.type]}};ie=(0,u.__decorate)([(0,u.__param)(0,V("config")),(0,u.__metadata)("design:paramtypes",[Object])],ie);class Lt extends oi{constructor(){super({prefix:"bpmonline-designer.diagram",storageType:"localStorage"}),this.diagramId=""}set(e,t,n=!0){return n&&(e+="."+this.diagramId),super.set(e,t)}get(e,t=!0){return t&&(e+="."+this.diagramId),super.get(e)}remove(...e){return e&&(e=e.map(t=>t+"."+this.diagramId)),super.remove(...e)}static{this.\u0275fac=function(t){return new(t||Lt)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac})}}const g=V;var xf=y(54343);let rr=class extends xf.A{constructor(e){super(),this.injector=e}getAllElements(){const t=this.injector.get("canvas",!1).getRootElement();return super.filter(n=>n!==t)}getAll(){return this.getAllElements()}getGraphics(e,t){return super.getGraphics(e,t)}get(e){return super.get(e)}};rr=(0,u.__decorate)([(0,u.__param)(0,g("injector")),(0,u.__metadata)("design:paramtypes",[Object])],rr);var or=y(10018),Bt;(function(o){o.connection="connection",o.root="root",o.shape="shape",o.label="label"})(Bt||(Bt={}));class G{static centerViewboxOnElement(e,t){const n=t.viewbox(),i=(0,or.U7)(e),r={x:Math.round(i.x+i.width/2-n.outer.width/2),y:Math.round(i.y+i.height/2-n.outer.height/2),width:n.outer.width,height:n.outer.height};t.viewbox(r),t.zoom(n.scale)}static isLabel(e){return e.type===Bt.label}static isRoot(e){return e.type===Bt.root}static getCorrectSpaceToolDelta(e,t){const n=t.context,i=n.axis,r=n.minAllowedDelta;return r!==null&&(i==="x"&&e.x<r&&(e.x=r),i==="y"&&e.y<r&&(e.y=r)),e}static getOriginalWaypoint(e,t){return[t.y,t.y+t.height].includes(e.y)?{x:e.x,y:t.y+Math.round(t.height/2)}:{x:t.x+Math.round(t.width/2),y:e.y}}getContainersType(){return[]}setProcessRelativePosition(e,t){const n=(i,r)=>{r.id===bi.root.id?(!v.isNumber(i.rx)&&i.x&&(i.rx=i.x),!v.isNumber(i.ry)&&i.y&&(i.ry=i.y)):(!v.isNumber(i.rx)&&i.x&&r.x&&(i.rx=i.x-r.x),!v.isNumber(i.ry)&&i.y&&r.y&&(i.ry=i.y-r.y))};Object.keys(Pd(e.elements)).forEach(i=>{const r=e.elements[i],a=e.elements[r.parent];n(r,a||{id:"root1"})}),Object.keys(Pd(e.labels)).forEach(i=>{const r=e.labels[i],a=e.connections[r.parent]||e.elements[r.parent];let c=a;if(a)this.isConnection(a)&&(c=e.elements[a.source]);else{const h=`Element with id "${a}" - not found in process "${e.id}"`;t.error(h,{loggerName:"setProcessRelativePosition"}),console.error(h)}n(r,c||{id:"root1"})})}isConnection(e){return Bt.connection===e.type}isFlow(e){return Bt.connection===e.type}findRealElementParent(e,t,n){for(const i of t)if(e.x>i.x&&e.x<i.x+i.width&&e.y>i.y&&e.y<i.y+i.height)return i;return n}getAllContainers(e){const t=this.getContainersType(),n=[];return e.forEach(i=>{if(t.includes(i.type)){const r=i.children?i.children.filter(a=>t.includes(a.type)):[];n.push({container:i,count:r.length})}},this),n.sort((i,r)=>i.count-r.count).map(i=>i.container)}}class N extends G{static isFlowNode(e){return[k.relationshipContainer,k.relationshipItem].includes(e?.type)}static isRelationshipContainer(e){return e?.type===k.relationshipContainer}static isRootItem(e){return N.isRelationshipContainer(e)||e?.single===!0}static isRelationshipItem(e){return e?.type===k.relationshipItem}static isIndirectConnection(e){return e?.type===k.indirectConnection}static isHorizontalConnection(e){return e?.type===k.connection&&e.position===0}isFlow(e){const t=[k.connection,k.indirectConnection];return super.isFlow(e)||t.includes(e?.type)}isConnection(e){const t=[k.connection,k.indirectConnection];return super.isConnection(e)||t.includes(e?.type)}}let Pn=class extends rr{constructor(e,t){super(e),this.injector=e,this.utils=t}getChildren(e){return this.getAllElements().filter(t=>t.parent?.id===e.id)}getFlowNodes(){return this.getAllElements().filter(N.isFlowNode)}getContainers(){return this.getAllElements().filter(N.isRelationshipContainer)}getFlows(){return this.getAllElements().filter(e=>this.utils.isFlow(e))}getElementFlows(e){return this.getAllElements().filter(t=>this.utils.isFlow(t)).filter(t=>t.source.id===e.id||t.target.id===e.id)}};Pn=(0,u.__decorate)([(0,u.__param)(0,V("injector")),(0,u.__param)(1,V("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,N])],Pn);let Me=class{constructor(e,t,n){this.elements=e,this.registry=t,this.localStorage=n}static{this.canMove=!1}static getSpacing(e){switch(e){case k.relationshipItem:return{x:100,y:70};case k.relationshipContainer:return{x:70,y:100};case"scroll":return{x:50,y:50};default:return{x:10,y:8}}}setExpandedContainersIds(e){e.length>0?this.localStorage.set("expanded-containers",e.join(",")):this.localStorage.remove("expanded-containers")}getExpandedContainersIds(){return(this.localStorage.get("expanded-containers")||"").split(",")}getElementSize(e){const t=this.elements.getConfig(e);return e.collapsed===!1?{width:e.expandedWidth||t.width,height:e.expandedHeight||t.height*2}:{width:t.width,height:t.height}}saveContainersState(){const e=this.registry.getContainers().filter(t=>t.collapsed===!1).map(t=>t.id);this.setExpandedContainersIds(e)}loadContainersState(e){const t=this.getExpandedContainersIds().filter(n=>e.elements[n]?.hasChildren);t.map(n=>e.elements[n]).forEach(n=>n.collapsed=!1),this.setExpandedContainersIds(t)}};Me=(0,u.__decorate)([(0,u.__param)(0,V("elements")),(0,u.__param)(1,V("elementRegistry")),(0,u.__param)(2,V("localStorage")),(0,u.__metadata)("design:paramtypes",[ie,Pn,Lt])],Me);class Tn extends Si{constructor(e){super(e),this.initScroll=Me.getSpacing("scroll")}ngOnInit(){this.loaded.pipe((0,d.first)()).subscribe(()=>{const e=this.diagramDataService.data;if(!e.rootElementId)return;const t=Object.values(e.elements).find(i=>i.recordId===e.rootElementId);this.get("modeling").positionViewboxRelativeToElement(t)})}static{this.\u0275fac=function(t){return new(t||Tn)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Tn,selectors:[["crt-relationship-diagram"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["diagramContainer",""],[1,"diagram-container"]],template:function(t,n){t&1&&s.\u0275\u0275element(0,"div",1,0)},styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.diagram-container .relationship-container .djs-visual .foreign-text{margin-right:20px}.diagram-container .relationship-item .djs-visual .foreign-text{margin-right:10px}.diagram-container .relationship-item .djs-visual image,.diagram-container .relationship-container .djs-visual image{clip-path:inset(0% round 8px)}.diagram-container .relationship-item .djs-visual .foreign-text,.diagram-container .relationship-container .djs-visual .foreign-text{text-align:left;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.diagram-container .relationship-item .djs-visual .sub-caption .foreign-text,.diagram-container .relationship-container .djs-visual .sub-caption .foreign-text{color:#757575!important;font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased}.diagram-container .relationship-item .djs-visual .caption .foreign-text,.diagram-container .relationship-container .djs-visual .caption .foreign-text{color:#004fd6!important;font-family:var(--crt-body-2-font-family);font-size:var(--crt-body-2-font-size);line-height:var(--crt-body-2-line-height);font-weight:var(--crt-body-2-font-weight);letter-spacing:var(--crt-body-2-letter-spacing);text-transform:var(--crt-body-2-text-transform);-webkit-font-smoothing:antialiased}.diagram-container .relationship-item .djs-visual .info .foreign-text-container .foreign-text,.diagram-container .relationship-container .djs-visual .info .foreign-text-container .foreign-text{color:#757575!important;font-size:10px;margin-right:0}.diagram-container .relationship-item.no-access .caption .foreign-text,.diagram-container .relationship-container.no-access .caption .foreign-text{color:#181818!important}.diagram-container .relationship-item.hover:not(.selected) .djs-outline,.diagram-container .relationship-container.hover:not(.selected) .djs-outline{stroke-width:1px!important}.diagram-container .relationship-item .lock-image,.diagram-container .relationship-container .lock-image{display:none}.diagram-container .relationship-item.hover .lock-image,.diagram-container .relationship-item.selected .lock-image,.diagram-container .relationship-container.hover .lock-image,.diagram-container .relationship-container.selected .lock-image{display:block}.diagram-container .relationship-item .group-caption .foreign-text-container .foreign-text,.diagram-container .relationship-container .group-caption .foreign-text-container .foreign-text{color:#fff!important;text-align:center;font-size:10px;height:100%;padding-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.diagram-container .relationship-item.show-groups .group-container,.diagram-container .relationship-container.show-groups .group-container{visibility:visible}.diagram-container .relationship-item.show-groups .group-container .group-item.has-item-comment,.diagram-container .relationship-container.show-groups .group-container .group-item.has-item-comment{cursor:pointer}.diagram-container .relationship-item.fade-item .djs-hit,.diagram-container .relationship-container.fade-item .djs-hit{fill:#ffffffa6!important}.diagram-container .relationship-item .djs-outline,.diagram-container .relationship-container .djs-outline{stroke:#006ce0!important}.diagram-container .relationship-item .group-container,.diagram-container .relationship-container .group-container{visibility:hidden}.diagram-container .relationship-item .toggle-container,.diagram-container .relationship-container .toggle-container,.diagram-container .relationship-item .show-all-group-caption,.diagram-container .relationship-container .show-all-group-caption{cursor:pointer}.diagram-container .relationship-item .show-all-group-caption .foreign-text-container .foreign-text,.diagram-container .relationship-container .show-all-group-caption .foreign-text-container .foreign-text{text-align:center;font-size:9px;height:100%;line-height:18px}.diagram-container .djs-bendpoints .djs-segment-dragger.horizontal .djs-hit,.diagram-container .djs-bendpoints .djs-segment-dragger.vertical .djs-hit{cursor:default}.diagram-container .djs-bendpoints .djs-segment-dragger.horizontal .djs-visual,.diagram-container .djs-bendpoints .djs-segment-dragger.vertical .djs-visual{visibility:hidden}.diagram-container .djs-diagram-popup{position:absolute;visibility:hidden;background:#fff 0% 0% no-repeat padding-box;box-shadow:0 3px 6px #00000029;border-radius:4px;opacity:.92;max-height:230px;overflow-y:auto;padding:8px}.diagram-container .additional-group-container:first-of-type{padding-top:0}.diagram-container .additional-group-container{font-size:11px;letter-spacing:0px;opacity:1;text-align:left;padding:4.5px 0;line-height:15px}.diagram-container .additional-group-container .additional-group-container-header{display:flex;align-items:center}.diagram-container .additional-group-container .additional-group-container-header .additional-group-name{color:#757575;padding-left:5px;text-align:left}.diagram-container .additional-group-container .additional-group-container-header .additional-group-name.has-comment{color:#006ce0}.diagram-container .additional-group-container .additional-group-container-header .comment-icon-gray{margin-left:4px;width:14px;height:14px;background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAALZJREFUOE9jZKAQMFKon4HaBvxnDA1dzYTPVatXh/5jYGD8D1OD4oL48rkHGf4zWeMz4D/D/yOLupIcsBqQUD7//4LORLzeQleDoniYGPD1HjcLLIBQQxwSQ9xKX/8ghxNqLJTN38PAwIAIYUaGgwwMDLMXdCauiCubd4CRgdGGgYHhwMKuRBessYAt+uLL5i1jYGTgYGRgDMQWQ0SlxISy+QH/GRmzF3YmuKJbQpQB+BLWwBsAAB0qUBHT9fFYAAAAAElFTkSuQmCC) 0% 0% no-repeat padding-box;opacity:1}.diagram-container .additional-group-container .additional-group-comment{padding-top:4px;font-size:13px;color:#181818}.diagram-container .group-item-comment{width:262px}.diagram-container .group-item-comment .circle{margin-right:5px}.diagram-container .group-item-comment .caption{color:#757575;margin:0;font-size:11px;font-weight:400}.diagram-container .group-item-comment .item-comment{margin-top:4px;margin-bottom:0;font-size:13px;line-height:15px;padding-right:8px}.diagram-container .circle{box-sizing:border-box;display:inline-block;border-radius:50%;height:8px;width:8px}.diagram-container .djs-popup.add .djs-popup-header{flex-direction:column;width:auto;border-bottom:none}.diagram-container .djs-popup.add .djs-popup-header .entry{margin-left:0}.diagram-container .djs-popup.add .djs-popup-header .entry.add-item-button-tool{width:100%}.diagram-container .djs-element.djs-connection.hover path.connection{stroke-width:2!important}.diagram-container .djs-element.djs-connection.selected path.connection{stroke-width:3!important}.diagram-container .djs-element.label>.djs-hit-all{pointer-events:none}.diagram-container .djs-connection~.djs-children .label .foreign-text{color:#54657d!important}.diagram-container .djs-connection.selected~.djs-children .label .foreign-text{color:#1186d8!important}.diagram-container .djs-element.djs-connection.highlight path.connection{stroke-width:2!important}
`,`.djs-outline{fill:none;visibility:hidden}.djs-element.hover .djs-outline,.djs-element.selected .djs-outline{visibility:visible;shape-rendering:crispEdges;stroke-dasharray:3,3}.djs-element.selected .djs-outline{stroke:#88f;stroke-width:1px}.djs-element.hover .djs-outline{stroke:#f88;stroke-width:1px}svg.drop-not-ok{background:#f9dee5!important}.djs-connection.connect-ok .djs-visual>:nth-child(1),.djs-connection.drop-ok .djs-visual>:nth-child(1){stroke:#90dd5f!important}.djs-connection.connect-not-ok .djs-visual>:nth-child(1),.djs-connection.drop-not-ok .djs-visual>:nth-child(1){stroke:#e56283!important}.drop-not-ok,.connect-not-ok{cursor:not-allowed}.djs-element.attach-ok .djs-visual>:nth-child(1){stroke-width:5px!important;stroke:#ff7400b3!important}.djs-frame.connect-not-ok .djs-visual>:nth-child(1),.djs-frame.drop-not-ok .djs-visual>:nth-child(1){stroke-width:3px!important;stroke:#e56283!important;fill:none!important}.djs-lasso-overlay{fill:#ff7400;fill-opacity:.1;stroke-dasharray:5 1 3 1;stroke:#ff7400;shape-rendering:crispEdges;pointer-events:none}.djs-resize-overlay{fill:none;stroke-dasharray:5 1 3 1;stroke:#ff7400;pointer-events:none}.djs-resizer-hit{fill:none;pointer-events:all}.djs-resizer-visual{fill:#fff;stroke-width:1px;stroke:#000;shape-rendering:crispEdges;stroke-opacity:.2}.djs-cursor-resize-ns,.djs-resizer-n,.djs-resizer-s{cursor:ns-resize}.djs-cursor-resize-ew,.djs-resizer-e,.djs-resizer-w{cursor:ew-resize}.djs-cursor-resize-nwse,.djs-resizer-nw,.djs-resizer-se{cursor:nwse-resize}.djs-cursor-resize-nesw,.djs-resizer-ne,.djs-resizer-sw{cursor:nesw-resize}.djs-shape.djs-resizing>.djs-outline{visibility:hidden!important}.djs-shape.djs-resizing>.djs-resizer{visibility:hidden}.djs-dragger>.djs-resizer{visibility:hidden}marker.djs-dragger circle,marker.djs-dragger path,marker.djs-dragger polygon,marker.djs-dragger polyline,marker.djs-dragger rect{fill:#ff7400!important;stroke:none!important}marker.djs-dragger text,marker.djs-dragger tspan{fill:none!important;stroke:#ff7400!important}.djs-dragging{opacity:.3}.djs-dragging,.djs-dragging>*{pointer-events:none!important}.djs-dragging .djs-context-pad,.djs-dragging .djs-outline{display:none!important}.djs-visual,.djs-outline{pointer-events:none}.djs-element.attach-ok .djs-hit{stroke-width:60px!important}.djs-element>.djs-hit-all{pointer-events:all}.djs-element>.djs-hit-stroke,.djs-element>.djs-hit-click-stroke{pointer-events:stroke}.djs-drag-active .djs-element>.djs-hit-click-stroke{pointer-events:all}.djs-connection .djs-visual{stroke-width:2px;fill:none}.djs-cursor-grab{cursor:grab}.djs-cursor-grabbing{cursor:grabbing}.djs-cursor-crosshair{cursor:crosshair}.djs-cursor-move{cursor:move}.djs-cursor-resize-ns{cursor:ns-resize}.djs-cursor-resize-ew{cursor:ew-resize}.djs-snap-line{stroke:#ffc342;stroke:#ffc34280;stroke-linecap:round;stroke-width:2px;pointer-events:none}.djs-crosshair{stroke:#555;stroke-linecap:round;stroke-width:1px;pointer-events:none;shape-rendering:crispEdges;stroke-dasharray:5,5}.djs-palette{position:absolute;left:20px;top:20px;box-sizing:border-box;width:48px}.djs-palette .separator{margin:0 5px;padding-top:5px;border:none;border-bottom:solid 1px #DDD;clear:both}.djs-palette .entry:before{vertical-align:text-bottom}.djs-palette .djs-palette-toggle{cursor:pointer}.djs-palette .entry,.djs-palette .djs-palette-toggle{color:#333;font-size:30px;text-align:center}.djs-palette .entry{float:left}.djs-palette .entry img{max-width:100%}.djs-palette .djs-palette-entries:after{content:"";display:table;clear:both}.djs-palette .djs-palette-toggle:hover{background:#666}.djs-palette .entry:hover{color:#ff7400}.djs-palette .highlighted-entry{color:#ff7400!important}.djs-palette .entry,.djs-palette .djs-palette-toggle{width:46px;height:46px;line-height:46px;cursor:default}.djs-palette.two-column.open{width:94px}.djs-palette:not(.open) .djs-palette-entries{display:none}.djs-palette:not(.open){overflow:hidden}.djs-palette.open .djs-palette-toggle{display:none}.djs-overlay-context-pad{width:72px}.djs-context-pad{position:absolute;display:none;pointer-events:none}.djs-context-pad .entry{width:22px;height:22px;text-align:center;display:inline-block;font-size:22px;margin:0 2px 2px 0;border-radius:3px;cursor:default;background-color:#fefefe;box-shadow:0 0 2px 1px #fefefe;pointer-events:all}.djs-context-pad .entry:before{vertical-align:top}.djs-context-pad .entry:hover{background:#fffcb0}.djs-context-pad.open{display:block}.djs-popup .entry{line-height:20px;white-space:nowrap;cursor:default}.djs-popup .entry:before{vertical-align:middle;font-size:20px}.djs-popup .entry>span{vertical-align:middle;font-size:14px}.djs-popup .entry:hover,.djs-popup .entry.active:hover{background:#fffcb0}.djs-popup .entry.disabled{background:inherit}.djs-popup .djs-popup-header .entry{display:inline-block;padding:2px 3px;border:solid 1px transparent;border-radius:3px}.djs-popup .djs-popup-header .entry.active{color:#ff7400;border:solid 1px rgb(255,116,0);background-color:#f6f6f6}.djs-popup-body .entry{padding:4px 10px 4px 5px}.djs-popup-body .entry>span{margin-left:5px}.djs-popup-body{background-color:#fefefe}.djs-popup-header{border-bottom:1px solid #DDD}.djs-popup-header .entry{margin:1px 1px 1px 3px}.djs-popup-header .entry:last-child{margin-right:3px}.djs-popup,.djs-palette{background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-shape,.djs-connection{touch-action:none}.djs-segment-dragger,.djs-bendpoint{display:none}.djs-segment-dragger .djs-visual{fill:#ffff7933;stroke-width:1px;stroke-opacity:1;stroke:#ffff794d}.djs-bendpoint .djs-visual{fill:#ffff79cc;stroke-width:1px;stroke-opacity:.5;stroke:#000}.djs-segment-dragger:hover,.djs-bendpoints.hover .djs-segment-dragger,.djs-bendpoints.selected .djs-segment-dragger,.djs-bendpoint:hover,.djs-bendpoints.hover .djs-bendpoint,.djs-bendpoints.selected .djs-bendpoint{display:block}.djs-drag-active .djs-bendpoints *{display:none}.djs-bendpoints:not(.hover) .floating{display:none}.djs-segment-dragger:hover .djs-visual,.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint:hover .djs-visual,.djs-bendpoint.floating .djs-visual{fill:#ff0;stroke-opacity:.5;stroke:#000}.djs-bendpoint.floating .djs-hit{pointer-events:none}.djs-segment-dragger .djs-hit,.djs-bendpoint .djs-hit{pointer-events:all;fill:none}.djs-segment-dragger.horizontal .djs-hit{cursor:ns-resize}.djs-segment-dragger.vertical .djs-hit{cursor:ew-resize}.djs-segment-dragger.djs-dragging .djs-hit{pointer-events:none}.djs-updating,.djs-updating>*{pointer-events:none!important}.djs-updating .djs-context-pad,.djs-updating .djs-outline,.djs-updating .djs-bendpoint,.connect-ok .djs-bendpoint,.connect-not-ok .djs-bendpoint,.drop-ok .djs-bendpoint,.drop-not-ok .djs-bendpoint{display:none!important}.djs-segment-dragger.djs-dragging,.djs-bendpoint.djs-dragging{display:block;opacity:1}.djs-segment-dragger.djs-dragging .djs-visual,.djs-bendpoint.djs-dragging .djs-visual{fill:#ff0;stroke-opacity:.5}.djs-tooltip-error{font-size:11px;line-height:18px;text-align:left;padding:5px;opacity:.7}.djs-tooltip-error>*{width:160px;background:#fcecf0;color:#9e4c4c;padding:3px 7px;border-radius:5px;border-left:solid 5px rgb(174,73,73)}.djs-tooltip-error:hover{opacity:1}.djs-search-container{position:absolute;top:20px;left:0;right:0;margin-left:auto;margin-right:auto;width:25%;min-width:300px;max-width:400px;z-index:10;font-size:1.05em;opacity:.9;background:#fafafa;border:solid 1px #CCC;border-radius:2px}.djs-search-container:not(.open){display:none}.djs-search-input input{font-size:1.05em;width:100%;padding:6px 10px;border:1px solid #ccc}.djs-search-input input:focus{outline:none;border-color:#52b415}.djs-search-results{position:relative;overflow-y:auto;max-height:200px}.djs-search-results:hover{cursor:pointer}.djs-search-result{width:100%;padding:6px 10px;background:#fff;border-bottom:solid 1px #AAA;border-radius:1px}.djs-search-highlight{color:#000}.djs-search-result-primary{margin:0 0 10px}.djs-search-result-secondary{font-family:monospace;margin:0}.djs-search-result:hover{background:#fdffd6}.djs-search-result-selected{background:#fffcb0}.djs-search-result-selected:hover{background:#f7f388}.djs-search-overlay{background:#ff0;opacity:.3}.djs-element-hidden,.djs-element-hidden .djs-hit,.djs-element-hidden .djs-outline,.djs-label-hidden .djs-label{display:none!important}
`,`.diagram-container{position:relative;height:100%;width:100%;margin:0}.diagram-container svg{display:block}.djs-container{direction:ltr}.djs-tooltip{border-radius:4px;padding:8px;width:150px;opacity:.9;backdrop-filter:blur(5px);z-index:1010}.djs-palette{left:10px;top:10px;border-radius:4px;overflow:hidden;padding-top:6px;padding-bottom:6px}.djs-palette.open,.djs-palette.two-column.open{width:46px}.djs-palette .group{padding:0!important;width:100%}.djs-palette .entry{width:32px;height:32px;line-height:32px;margin-left:6px;cursor:pointer}.djs-palette .entry.active{border-radius:7px}.djs-palette .entry.create-menu:after{content:"";position:absolute;width:0;height:0;border-top:3px solid transparent;border-bottom:3px solid transparent;border-left:3px solid #006ce0;margin-top:13px;margin-left:-4px}.djs-context-pad.open{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;border-radius:4px;pointer-events:auto}.djs-context-pad.open .group{display:grid;grid-template-columns:auto auto;padding:3px}.djs-context-pad.open .group:not(:first-child){padding-left:0}.djs-context-pad.open.one-column-grid .group{grid-template-columns:auto}.djs-context-pad.open .entry{height:32px;width:32px;background:transparent;margin:0;box-shadow:none;border-radius:3px}.djs-context-pad.open .entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}.djs-context-pad.open .entry.noop-entry:hover{background:inherit!important}.djs-context-pad.open .entry img{padding:4px}.entry.entry-separator{height:0;margin-top:4px;margin-bottom:4px}@supports (backdrop-filter: none){.djs-context-pad.open{backdrop-filter:blur(5px);background:#ffffffc7}.djs-context-pad.open .entry{background:transparent}}.djs-context-pad{max-width:72px}.djs-element.djs-connection.djs-updating path,.djs-element.djs-connection.selected path,.djs-element.djs-connection.animated path{stroke:#1186d8!important}.djs-element.djs-connection.djs-updating path.connection-end-marker,.djs-element.djs-connection.selected path.connection-end-marker,.djs-element.djs-connection.animated path.connection-end-marker{fill:#1186d8!important}.djs-element.djs-connection.animated path.connection{stroke-width:3!important;stroke-dasharray:20,3;animation:dash 5s linear infinite}@keyframes dash{0%{stroke-dashoffset:115}}.djs-bendpoint .djs-visual{fill:#fff;stroke-width:1px;stroke:#1186d8}.djs-bendpoint.floating .djs-visual{display:none}.djs-bendpoints.hover .djs-visual{stroke:#8095b3}.djs-element.hover .djs-outline{stroke:#a7c6ff}.laneSet.hover .djs-visual,.lane.hover .djs-visual{opacity:initial}.djs-element.selected .djs-outline{stroke:#3168cc}.djs-segment-dragger .djs-visual{fill:transparent;stroke:transparent}.djs-snap-line{stroke-width:1px}.djs-popup{overflow-y:auto;overflow-x:hidden;max-height:calc(100% - 20px);opacity:0;transition:opacity .2s ease-out}.djs-popup .entry{display:flex;flex-direction:row-reverse;justify-content:flex-end;align-items:stretch;padding:5px 7px}.djs-popup .entry img{height:24px;width:24px}.djs-popup .djs-popup-header{display:flex;margin:0 9px}.djs-popup .djs-popup-header .entry.active{border:none}.djs-popup .djs-popup-header .entry:first-child{margin-left:0}.djs-popup .djs-popup-header .entry{height:34px;width:34px;padding:4px;margin:2px 1px 2px 4px}.djs-dragger .djs-visual rect{fill:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border){display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;pointer-events:none}.djs-direct-editing-parent:not(.djs-direct-editing-parent-no-border) .djs-direct-editing-content{margin:0 auto;pointer-events:auto;text-align:center}.djs-direct-editing-content{user-select:text!important;overflow:hidden;outline:none;resize:none}.djs-direct-editing-parent-no-border .djs-direct-editing-content{border:0}.djs-direct-editing-rotate-90{transform:rotate(-90deg);transition:transform .1s ease}.djs-direct-editing-rotate-90 .djs-direct-editing-content{border:none;transition:border .1s ease}.djs-direct-editing-rotate-0{transform:rotate(0)}.djs-text-hidden text{display:none}.djs-text-hidden foreignObject{display:none}.djs-direct-editing-resize-handle{display:none}.djs-shape.connect-ok.textAnnotation .djs-visual>:nth-child(1):not(path),.djs-shape.connect-not-ok.textAnnotation .djs-visual>:nth-child(1):not(path){fill:inherit!important}.djs-element.lane.hover:not(.selected) .djs-outline{stroke:none}.djs-element.laneSet.hover:not(.selected) .djs-outline{stroke:none}foreignObject.djs-label{overflow:visible}.foreign-text-container{display:flex;justify-content:center;height:100%}.laneSet .foreign-text-container,.lane .foreign-text-container{align-items:center}.eventSubProcessExpanded .foreign-text-container{height:initial;padding:5px}.foreign-text{text-align:center;box-sizing:border-box;outline:none;font-family:Open Sans,sans-serif;font-size:12px;font-weight:400;line-height:1.2;overflow-wrap:break-word;white-space:pre-line}.label .foreign-text{max-width:130px;user-select:text}.textAnnotation .foreign-text{padding:12px;max-width:none;text-align:left;line-height:1.41667;word-wrap:break-word}.textAnnotation foreignObject{height:100%}.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}@supports (-webkit-line-clamp: 2){.eventSubProcessExpanded .foreign-text,.laneSet .foreign-text,.lane .foreign-text{vertical-align:center;overflow:hidden;text-overflow:ellipsis;white-space:initial;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}}.foreign-text-helper{max-width:128px;min-height:14.39px;width:fit-content;margin:0 auto;overflow-wrap:break-word}.diagram-create-popup-menu{border-top:none!important}.diagram-create-popup-menu .entry{cursor:move}.djs-minimap{position:absolute;right:8px;bottom:11px;width:248px;height:33px;border-radius:4px;opacity:1;overflow:hidden;box-sizing:border-box;user-select:none;transition:height .2s cubic-bezier(0,0,.2,1)}.djs-minimap .map-buttons{position:absolute;bottom:0;left:0;right:0;height:32px;display:flex;padding:0 5px;z-index:1}.djs-minimap .map-buttons .map-button{min-width:32px;height:32px;cursor:pointer;line-height:32px;font-size:16px;padding:0 8px;background-position:center;transition:background .8s}.djs-minimap .map-buttons .map-button:active{background-size:100%;transition:background 0s}.djs-minimap .map-buttons .map-button.preview-button{padding:0 12px 0 10px;margin:0 4px 0 0;min-width:40px}.djs-minimap .map-buttons .map-button.zoom-button{width:100%;height:100%;padding:0 16px 0 0;text-align:right}.djs-minimap .map-buttons .map-button.zoom-button:after{content:"";position:absolute;width:0;height:0;right:9px;top:16px}.djs-minimap .map{width:248px;height:148px;margin-bottom:32px;cursor:crosshair}.djs-minimap.open{transition:height .2s cubic-bezier(.18,.89,.32,1.28);height:180px}.djs-minimap.open .overlay{position:absolute;inset:0;pointer-events:none}.djs-minimap .viewport{fill:none;stroke:none}.djs-minimap .viewport-dom{position:absolute;border-radius:2px;box-sizing:border-box;cursor:move}.djs-minimap .cursor-crosshair{cursor:crosshair}.djs-minimap .cursor-move{cursor:move}.djs-popup.zoom{right:8px;bottom:47px;top:inherit!important;left:inherit!important}.djs-popup.zoom .entry{display:flex;flex-direction:row;justify-content:space-between;align-items:stretch}.djs-popup.zoom .entry.entry-separator{padding:0!important;margin:4px 10px!important}#canvas_svg_export{position:absolute;left:50px;top:50px;box-shadow:0 0 9px 2px #0000007a}#canvas_svg_export .close-button{position:absolute;right:8px;width:16px;height:16px;cursor:pointer}
`],encapsulation:2})}}function Ef(o){return typeof o=="string"}function If(o){const e=o.substring(1,o.length-1);return parseInt(e,10)}function JM(o,e){return o.replace(/{[0-9]}/g,t=>{const n=If(t);return e[n]?e[n].toString():""})}function qM(o){return o.charAt(0).toUpperCase()+o.slice(1)}function Af(o){return o.charAt(0).toLowerCase()+o.slice(1)}function Pf(o){let e=0;if(!Ef(o)||o.length===0)return e;for(let t=0;t<o.length;t++)e=o.charCodeAt(t)+(e<<5)-e,e|=0;return e}function Tf(o){return Pf(JSON.stringify(o))}function XM(o){return Tf(o).toString(16)}function QM(o,e=null){try{return JSON.parse(o)}catch{return e}}class Mi{static{this.AddElement="AddElement"}static{this.EditConnection="EditConnection"}static{this.DeleteElement="DeleteElement"}static{this.AddGroup="AddGroup"}static{this.AddEntityInGroup="AddEntityInGroup"}}class Ft{static{this.formal={id:"56d730bf-27f5-42d9-83df-183df2ec06a1",name:"Formal"}}static{this.notFormal={id:"6d1d2243-d4de-4d64-aab4-23eed4021a60",name:"Not formal"}}}class bt{constructor(e){this.httpClient=e,this.serviceEndpoint="rest/RelationshipDesignerService/"}_prepareCollection(e,t){const n={};return e?.forEach(function(i){const r=i[t];n[r]=i},this),n}getDiagram(e,t){const n=this.serviceEndpoint+"GetDiagram";return this.httpClient.post(n,{recordId:e,schemaName:t}).pipe((0,d.map)(i=>{if(i&&i.success){const r=i.data;r.elements=this._prepareCollection(r.elements,"id"),r.connections=this._prepareCollection(r.connections,"id"),r.labels=this._prepareCollection(r.labels,"parent"),r.groups&&(r.groups=this._prepareCollection(r.groups,"id")),i.data=r;const a=i.config;a.customDiagramElements=this._prepareCollection(a.customDiagramElements,"type"),i.config=a}return i}))}deleteEntity(e){const t=this.serviceEndpoint+"DeleteEntity";return this.httpClient.post(t,{entityId:e})}createConnection(e){const t=this.serviceEndpoint+"CreateConnection";return this.httpClient.post(t,{entityConnection:e})}updateConnection(e){const t=this.serviceEndpoint+"UpdateConnection";return this.httpClient.post(t,{entityConnection:e})}deleteConnection(e){const t=this.serviceEndpoint+"DeleteConnection";return this.httpClient.post(t,{connectionId:e})}getGroupsData(){const e=this.serviceEndpoint+"GetGroupsData";return this.httpClient.post(e,null)}getGroupsDataForEntity(e){const t=this.serviceEndpoint+"GetGroupsDataForEntity";return this.httpClient.post(t,{entityId:e})}createGroup(e){const t=this.serviceEndpoint+"CreateGroup";return this.httpClient.post(t,{group:e})}updateGroup(e){const t=this.serviceEndpoint+"UpdateGroup";return this.httpClient.post(t,{group:e})}deleteGroup(e){const t=this.serviceEndpoint+"DeleteGroup";return this.httpClient.post(t,{groupId:e})}createEntityInGroup(e){const t=this.serviceEndpoint+"CreateEntityInGroup";return this.httpClient.post(t,{entityInGroup:e})}updateEntityInGroup(e){const t=this.serviceEndpoint+"UpdateEntityInGroup";return this.httpClient.post(t,{entityInGroup:e})}deleteEntityInGroup(e,t){const n=this.serviceEndpoint+"DeleteEntityInGroup";return this.httpClient.post(n,{entityId:e,groupId:t})}getRecordEntityInfo(e){const t=this.serviceEndpoint+"GetRecordEntityInfo";return this.httpClient.post(t,{entityId:e}).pipe((0,d.map)(n=>{const i=n?.recordEntityInfo;if(i){const r={};(0,v.forOwn)(i,a=>{const c=a.Key.toLowerCase();r[c]=a.Value}),n.recordEntityInfo=r}return n}))}static{this.\u0275fac=function(t){return new(t||bt)(s.\u0275\u0275inject(U.HttpClient))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:bt,factory:bt.\u0275fac})}}class Dn{constructor(){this.designerConfig$=new l.ReplaySubject(1),this.doSave$=new l.Subject,this.saveCard$=new l.Subject,this.doCloseCard$=new l.Subject}setDesignerConfig(e){this.designerConfig$.next(e)}getDesignerConfig(){return this.designerConfig$}doSave(){return this.doSave$}cardSaved(e){this.saveCard$.next(e)}saveCard(){return this.doSave$.next(),this.saveCard$}closeCard(e){this.doCloseCard$.next(e)}doCloseCard(){return this.doCloseCard$}static{this.\u0275fac=function(t){return new(t||Dn)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Dn,factory:Dn.\u0275fac})}}class vt{constructor(e,t){this._dialogService=e,this._translateService=t}_getRemovingConfirmationDialogConfig(e){return{width:"450px",panelClass:["dialog-top-border","relationship-remove-item"],data:{message:this._translateService.instant(e),primaryButton:{result:nr.result,caption:this._translateService.instant(nr.caption).toLowerCase()},secondaryButton:{result:ll.result,caption:this._translateService.instant(ll.caption).toLowerCase()}}}}confirmRemoving(e){const t=this._getRemovingConfirmationDialogConfig(e);return this._dialogService.open(En,t).pipe((0,l.map)(n=>n===nr.result))}static{this.\u0275fac=function(t){return new(t||vt)(s.\u0275\u0275inject(He),s.\u0275\u0275inject(T.TranslateService))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:vt,factory:vt.\u0275fac})}}class wi{static hasParent(e){return!!e?.parent}static getDefaultConnectionType(e,t){switch(!0){case(this.isContainer(e)&&this.isContainer(t)):case(this.isContainer(e)&&this.isItem(t)&&!this.hasParent(t)):case(this.isContainer(e)&&this.isItem(t)&&e.id===t.parent):case(this.isItem(e)&&!this.hasParent(e)&&this.isContainer(t)):case(this.isItem(e)&&this.hasParent(e)&&this.isItem(t)&&!this.hasParent(t)):case(this.isItem(e)&&!this.hasParent(e)&&this.isItem(t)&&this.hasParent(t)):case(this.isItem(e)&&this.hasParent(e)&&this.isItem(t)&&this.hasParent(t)&&e.parent===t.parent):return Ft.formal;default:return Ft.notFormal}}static getUnsupportedConnectionTypesIds(e,t){return wi.getDefaultConnectionType(e,t).id!==Ft.formal.id?[Ft.formal.id]:[]}static isItem(e){return e&&e.type==="relationship-item"}static isContainer(e){return e&&e.type==="relationship-container"}}class zt{constructor(e){this.queryExecutor=e}_getDisplayValueFilterGroup(e,t){const n=new Ee;n.logicalOperation=Ps.Or;for(const i of e)n.addSchemaColumnFilterWithParameter(K.Contain,i,t);return n}getFilteredLookupItems(e){const t=new Cn(e.schemaName);t.rowCount=20;const n=e.additionalColumns||[],i=e.excludedRecords||[],r=e.additionalFilters||[];n.includes("Id")||t.addSchemaColumn("Id"),n.includes("Name")||t.addSchemaColumn("Name");for(const a of n)t.addSchemaColumn(a);if(e.value!==""){const a=e.displayValueFilters||["Name"];t.filters.add(this._getDisplayValueFilterGroup(a,e.value))}i.length>0&&t.filters.addSchemaColumnInFilterWithParameters(K.Not_equal,"Id",i);for(const a of r)t.filters.add(a);return this.queryExecutor.executeSelectQuery(t).pipe((0,d.map)(a=>a.map(c=>({value:c.Id,displayValue:e.displayValueGetter?e.displayValueGetter(c):c.Name,row:c}))),(0,d.share)())}static{this.\u0275fac=function(t){return new(t||zt)(s.\u0275\u0275inject(Oe))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:zt,factory:zt.\u0275fac})}}class Ut{_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}_initializeGTM(){this.subscription.add(this.googleTagManagerService.initialize().subscribe())}constructor(e){this.injector=e,this.subscription=new l.Subscription,this.isNew=!1,this.isLoading=!1,this.elementData=null,this.elementConfig=null,this.id$=new l.Subject,this.isRtl=!1,this.injectDependencies(),this.subscribeEvents(),this._initializeDirectionality(),this._initializeGTM()}injectDependencies(){this.designerService=this.injector.get(bt),this.propertiesPageEventService=this.injector.get(Dn),this.dialogService=this.injector.get(He),this.translateService=this.injector.get(T.TranslateService),this.diagramEventService=this.injector.get(Ae),this.directionality=this.injector.get(Ie.Directionality),this.googleTagManagerService=this.injector.get(An)}subscribeEvents(){this.subscription.add(this.id$.subscribe(e=>this.onIdChange(e))),this.subscription.add(this.propertiesPageEventService.doSave().subscribe(()=>this.saveCard()))}showMask(){this.isLoading=!0}hideMask(){this.isLoading=!1}getElement(e){return this.data.elements[e]||this.data.connections[e]}getElementConfig(e){return e&&this.config?.customDiagramElements[e]}getElementByRecordId(e){let t=null;return(0,v.forOwn)(this.data.elements,n=>{if(n.recordId===e)return t=n,!1}),t}onIdChange(e){this.subscription.add(this.propertiesPageEventService.getDesignerConfig().pipe((0,d.take)(1)).subscribe(t=>{this.fillData(t,e),this.onDataInitialized()}))}fillData(e,t){this.data=e.data,this.config=e.config;const n=this.elementData||this.getElement(t);this.elementConfig=this.getElementConfig(n?.type),this.elementData=n}onDataInitialized(){}saveCard(){const e=this.validate();if(!e){setTimeout(()=>{this.propertiesPageEventService.cardSaved({validated:e,success:!1,isChanged:!1})});return}this.showMask(),this.subscription.add(this.onSavedCard().subscribe(t=>{this.hideMask();const n=this.isNeedActualizeDiagram();this.propertiesPageEventService.cardSaved({validated:e,success:t,isChanged:n})}))}isNeedActualizeDiagram(){return this.isNew||this.isChanged()}onSavedCard(){return(0,l.of)(!0).pipe((0,d.delay)(1))}validate(){return!0}isChanged(){return!1}showErrorDialog(e){if(e?.success)return;const t=e?.errorInfo?.message||"An unknown error occurred during the operation.";this.subscription.add(this.dialogService.openInfoDialog(t).subscribe())}sendGtmAction(e){const t={moduleName:"RelationshipDesignerModule",schemaName:this.getGtmSchemaName()};e&&t&&this.googleTagManagerService.track((0,v.merge)(t,e))}getGtmSchemaName(){throw new Error("Need return gtm schema name")}ngOnDestroy(){this.subscription.unsubscribe(),this.hideMask()}static{this.\u0275fac=function(t){return new(t||Ut)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ut,selectors:[["crt-base-properties-page"]],hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275classProp("rtl",n.isRtl)},decls:0,vars:0,template:function(t,n){},encapsulation:2})}}var ul=y(65339);function Df(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",1),s.\u0275\u0275listener("click",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onClick(i))}),s.\u0275\u0275element(1,"mat-spinner",2),s.\u0275\u0275elementEnd()}if(o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275styleProp("opacity",t.opacity),s.\u0275\u0275classProp("containerized-mask",t.containerized)}}class at{constructor(e){this._cdr=e,this._isVisible=!0,this._opacity=.6,this.containerized=!1}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this._cdr.detectChanges())}set opacity(e){this._opacity=e,this._cdr.detectChanges()}get opacity(){return this._opacity}_assertIsBodyMask(){if(this.containerized)throw new Error("Is not body mask")}onClick(e){e.stopImmediatePropagation()}hideBodyMask(){this._assertIsBodyMask(),this.isVisible=!1}showBodyMask(){this._assertIsBodyMask(),this.isVisible=!0}static{this.\u0275fac=function(t){return new(t||at)(s.\u0275\u0275directiveInject(s.ChangeDetectorRef))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:at,selectors:[["ts-mask"]],inputs:{isVisible:"isVisible",opacity:"opacity"},decls:1,vars:1,consts:[["class","mask-wrap",3,"containerized-mask","opacity","click",4,"ngIf"],[1,"mask-wrap",3,"click"],["mode","indeterminate","diameter","32","aria-hidden","true",1,"mask-element"]],template:function(t,n){t&1&&s.\u0275\u0275template(0,Df,2,4,"div",0),t&2&&s.\u0275\u0275property("ngIf",n.isVisible)},dependencies:[M.NgIf,ul.MatProgressSpinner],styles:[".component-mask[_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%], .component-mask   [_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%]{position:absolute}.component-mask[_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%], .component-mask   [_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%]{position:absolute}.mask-wrap[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:2011;width:100%;height:100%;background-color:#fff}.mask-wrap[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;margin-top:-16px;margin-left:-16px;z-index:999}.mask-wrap.containerized-mask[_ngcontent-%COMP%], .mask-wrap.containerized-mask[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%]{position:absolute}"],changeDetection:0})}}var xi=y(59237),Ph=y(4615),Ne=y(16441),Ve=y(66459),On=y(49281);function Of(o,e){o&1&&s.\u0275\u0275element(0,"ts-mask",27)}function Rf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-hint"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function jf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-option",28),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("value",t),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function kf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-hint"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function Nf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-option",28),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("value",t),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Vf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-hint"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function Lf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-option",28),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("value",t),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Bf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-hint"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.getControlErrorMessage())}}function Ff(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-option",28),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("value",t),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}class Rn extends Ut{constructor(e){super(e),this.injector=e,this.relationshipTypeSchemaName="RelationType",this.connectionTypeSchemaName="RelationConnectionType",this.comment="",this.elementData=null,this._relationshipDeleteDialogService=this.injector.get(vt)}injectDependencies(){super.injectDependencies(),this.lookupDataService=this.injector.get(zt)}onDataInitialized(){this.showMask(),super.onDataInitialized(),this.initializeIsNew(),this.initializeSourceElementData(),this.initializeTargetElementData(),this.initializeConnectionType(),this.initializeExcludedConnectionTypes(),this.initializeRelationshipType(),this.initializeEntityA(),this.initializeEntityB(),this.initializeComment(),this.hideMask()}initializeIsNew(){this.isNew=this.elementData?.isNew}initializeSourceElementData(){this.elementData?.source&&(this.sourceElement=this.getElement(this.elementData.source),this.sourceConfig=this.getElementConfig(this.sourceElement.type))}initializeTargetElementData(){this.elementData?.target&&(this.targetElement=this.getElement(this.elementData.target),this.targetConfig=this.getElementConfig(this.targetElement.type))}initializeEntityA(){this.sourceElement&&(this.selectedEntityA={value:this.sourceElement.recordId,displayValue:this.sourceElement.caption})}initializeEntityB(){if(!this.elementData?.target)return;const e=this.getElement(this.elementData.target);this.selectedEntityB={value:e.recordId,displayValue:e.caption}}initializeConnectionType(){if(!this.elementData?.relationshipType?.connectionType)return;const e=this.elementData.relationshipType.connectionType;let t=e.id;this.isNew?(t=this.isFormalConnectionAddingDisabled()?Ft.notFormal.id:t,this.initializeConnectionTypeById(t)):this.selectedConnectionType={value:t,displayValue:e.name}}initializeConnectionTypeById(e){this.getConnectionTypeControlLookupValues().pipe((0,d.take)(1)).subscribe(t=>{this.selectedConnectionType=t.find(n=>n.value===e)})}initializeExcludedConnectionTypes(){!this.sourceElement||!this.targetElement||(this.excludedConnectionTypes=wi.getUnsupportedConnectionTypesIds(this.sourceElement,this.targetElement))}initializeRelationshipType(){this.elementData?.relationshipType?.id&&(this.selectedRelationshipType={value:this.elementData?.relationshipType.id,displayValue:this.elementData?.relationshipType.name})}initializeComment(){this.comment=this.elementData?.comment||""}onSavedCard(){if(!this.isNeedActualizeDiagram())return(0,l.of)(!0).pipe((0,d.delay)(1));const e=this.buildServerElement(),t=this.isNew?this.designerService.createConnection(e):this.designerService.updateConnection(e);return this.sendGtmAction({action:this.isNew?Mi.AddElement:Mi.EditConnection}),t.pipe((0,d.switchMap)(n=>{const i=n?.success;return i||this.showErrorDialog(n),(0,l.of)(i).pipe((0,d.delay)(1))}))}validate(){let e=super.validate();return e=e&&!!this.selectedConnectionType&&!!this.selectedRelationshipType&&!!this.selectedEntityA&&!!this.selectedEntityB,e}isChanged(){let e=super.isChanged();const t=this.elementData,n=this.getElementByRecordId(this.selectedEntityB.value);return e=e||!n||n.id!==t.target,e=e||this.selectedConnectionType?.value!==t.relationshipType.connectionType.id,e=e||this.selectedRelationshipType?.value!==t.relationshipType.id,e=e||this.comment!==t.comment,e}buildServerElement(){return{id:this.elementData.originalId||this.elementData.id,diagramId:this.data.id,relationshipRecordA:{id:this.selectedEntityA.value,schemaName:this.sourceConfig.caption},relationshipRecordB:{id:this.selectedEntityB.value,schemaName:this.targetConfig.caption},relationshipType:this.selectedRelationshipType.value,comment:this.comment}}doDeleteConnection(){if(this.isNew){this.forceCloseCard(!0);return}this.showMask(),this.subscription.add(this.designerService.deleteConnection(this.elementData.originalId).subscribe(e=>{if(!e?.success){this.hideMask(),this.showErrorDialog(e);return}this.forceCloseCard(!0),this.hideMask(),this.sendGtmAction({action:Mi.DeleteElement})}))}forceCloseCard(e=!1){this.propertiesPageEventService.closeCard({isForced:!0,isNeedDiagramReload:e})}getControlLookupValues(e){return this.lookupDataService.getFilteredLookupItems({value:e.value,schemaName:e.schemaName,excludedRecords:e.excludedRecords,additionalColumns:e.additionalColumns,additionalFilters:e.additionalFilters,displayValueFilters:e.displayValueFilters,displayValueGetter:e.displayValueGetter})}isFormalConnectionAddingDisabled(){const e=wi.hasParent(this.sourceElement),t=wi.hasParent(this.targetElement),n=this.targetConfig.caption==="Account";return e&&t&&this.sourceElement.parent!==this.targetElement.parent||e&&n}getExcludedConnectionTypes(){return this.isFormalConnectionAddingDisabled()?[Ft.formal.id]:[]}getConnectionTypeControlLookupValues(e=""){const t=this.excludedConnectionTypes?.length?this.excludedConnectionTypes:this.getExcludedConnectionTypes();return this.getControlLookupValues({value:e,schemaName:this.connectionTypeSchemaName,excludedRecords:t})}getRelationTypeAdditionalFilterGroup(){const e="For"+this.sourceConfig.caption+this.targetConfig.caption,t=new Ee;t.addSchemaColumnFilterWithParameter(K.Equal,e,!0);let n=this.selectedConnectionType?.value;return!n&&this.isFormalConnectionAddingDisabled()&&(n=Ft.notFormal.id),n&&t.addSchemaColumnFilterWithParameter(K.Equal,"RelationConnectionType.Id",n),t}getRelationshipTypeControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:this.relationshipTypeSchemaName,additionalColumns:["ReverseRelationType.Name","RelationConnectionType.Id","RelationConnectionType.Name"],additionalFilters:[this.getRelationTypeAdditionalFilterGroup()],displayValueFilters:["Name","ReverseRelationType.Name"],displayValueGetter:t=>t.Name+" - "+t["ReverseRelationType.Name"]})}getEntityAControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:this.sourceConfig.caption})}getEntityBControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:this.targetConfig.caption,excludedRecords:this.getExcludedEntityBControlValuesFilter()})}getExcludedEntityBControlValuesFilter(){const e=[];return this.addSelfExcludeFilterIfNeed(e),e}addSelfExcludeFilterIfNeed(e){this.targetConfig.caption===this.sourceConfig.caption&&e.push(this.sourceElement.recordId)}getGtmSchemaName(){return"ConnectionPropertiesPageComponent"}onConnectionTypeChange(e){this.selectedConnectionType=null,this.connectionTypes=this.getConnectionTypeControlLookupValues(e)}onConnectionTypeSelected(e){this.selectedConnectionType=e,this.connectionTypes=null,this.selectedRelationshipType=null}onRelationshipTypeChange(e){this.selectedRelationshipType=null,this.relationshipTypes=this.getRelationshipTypeControlLookupValues(e)}onRelationshipTypeSelected(e){this.selectedRelationshipType=e,this.selectedRelationshipType?.row&&(this.selectedConnectionType={value:this.selectedRelationshipType?.row["RelationConnectionType.Id"],displayValue:this.selectedRelationshipType?.row["RelationConnectionType.Name"]}),this.relationshipTypes=null}onEntityAChange(e){this.selectedEntityA=null,this.entitiesA=this.getEntityAControlLookupValues(e)}onEntityASelected(e){this.selectedEntityA=e,this.entitiesA=null}onEntityBChange(e){this.selectedEntityB=null,this.entitiesB=this.getEntityBControlLookupValues(e)}onEntityBSelected(e){this.selectedEntityB=e,this.entitiesB=null}getControlDisplayValue(e){return e?e.displayValue||e.value:""}getControlErrorMessage(){return this.translateService.instant("RelationshipDesigner.RequiredControlErrorMessage")}onCommentChange(e){this.comment=e}deleteConnection(){this._relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(e=>{e&&this.doDeleteConnection()})}onConnectionTypeFocus(e){this.connectionTypes=this.getConnectionTypeControlLookupValues()}onRelationshipTypeFocus(e){this.relationshipTypes=this.getRelationshipTypeControlLookupValues()}onEntityAFocus(e){this.entitiesA=this.getEntityAControlLookupValues()}onEntityBFocus(e){this.entitiesB=this.getEntityBControlLookupValues()}onAutocompleteFocusOut(e,t){!e.relatedTarget?.className?.includes("mdc-list-item")&&t?.panelOpen&&t.closePanel()}static{this.\u0275fac=function(t){return new(t||Rn)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Rn,selectors:[["crt-connection-properties-page"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:59,vars:44,consts:[["connectionTypeTrigger","matAutocompleteTrigger"],["connectionTypeAuto","matAutocomplete"],["relationshipTypeTrigger","matAutocompleteTrigger"],["relationshipTypeAuto","matAutocomplete"],["entityATrigger","matAutocompleteTrigger"],["entityAAuto","matAutocomplete"],["entityBTrigger","matAutocompleteTrigger"],["entityBAuto","matAutocomplete"],["class","component-mask",4,"ngIf"],[1,"header"],[1,"title-wrap"],[1,"logo-wrap"],[1,"logo"],[1,"title"],[1,"title-control-group"],["floatLabel","always"],["type","text","matInput","","required","",3,"keyup","focus","focusout","matAutocomplete","value"],[4,"ngIf"],[3,"optionSelected","displayWith"],["tabindex","0",3,"value",4,"ngFor","ngForOf"],["mat-icon-button","",1,"delete-icon",3,"click"],[1,"content"],[1,"group-label"],["type","text","matInput","","disabled","",3,"keyup","focus","focusout","matAutocomplete","value"],[1,"divider"],["floatLabel","always",1,"text-area"],["matInput","","name","message",3,"change","value"],[1,"component-mask"],["tabindex","0",3,"value"]],template:function(t,n){if(t&1){const i=s.\u0275\u0275getCurrentView();s.\u0275\u0275template(0,Of,1,0,"ts-mask",8),s.\u0275\u0275elementStart(1,"div",9)(2,"div",10)(3,"div",11),s.\u0275\u0275element(4,"div",12),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"div",13),s.\u0275\u0275text(6),s.\u0275\u0275pipe(7,"translate"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(8,"div",14)(9,"mat-form-field",15)(10,"input",16,0),s.\u0275\u0275listener("keyup",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onConnectionTypeChange(a.target.value))})("focus",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onConnectionTypeFocus(a.target.value))})("focusout",function(a){s.\u0275\u0275restoreView(i);const c=s.\u0275\u0275reference(11);return s.\u0275\u0275resetView(n.onAutocompleteFocusOut(a,c))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(12,Rf,2,1,"mat-hint",17),s.\u0275\u0275elementStart(13,"mat-autocomplete",18,1),s.\u0275\u0275listener("optionSelected",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onConnectionTypeSelected(a.option.value))}),s.\u0275\u0275template(15,jf,2,2,"mat-option",19),s.\u0275\u0275pipe(16,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(17,"button",20),s.\u0275\u0275listener("click",function(){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.deleteConnection())}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(18,"div",21)(19,"mat-form-field",15)(20,"mat-label"),s.\u0275\u0275text(21),s.\u0275\u0275pipe(22,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(23,"input",16,2),s.\u0275\u0275listener("keyup",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onRelationshipTypeChange(a.target.value))})("focus",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onRelationshipTypeFocus(a.target.value))})("focusout",function(a){s.\u0275\u0275restoreView(i);const c=s.\u0275\u0275reference(24);return s.\u0275\u0275resetView(n.onAutocompleteFocusOut(a,c))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(25,kf,2,1,"mat-hint",17),s.\u0275\u0275elementStart(26,"mat-autocomplete",18,3),s.\u0275\u0275listener("optionSelected",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onRelationshipTypeSelected(a.option.value))}),s.\u0275\u0275template(28,Nf,2,2,"mat-option",19),s.\u0275\u0275pipe(29,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(30,"span",22),s.\u0275\u0275text(31),s.\u0275\u0275pipe(32,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(33,"mat-form-field",15)(34,"mat-label"),s.\u0275\u0275text(35),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(36,"input",23,4),s.\u0275\u0275listener("keyup",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onEntityAChange(a.target.value))})("focus",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onEntityAFocus(a.target.value))})("focusout",function(a){s.\u0275\u0275restoreView(i);const c=s.\u0275\u0275reference(37);return s.\u0275\u0275resetView(n.onAutocompleteFocusOut(a,c))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(38,Vf,2,1,"mat-hint",17),s.\u0275\u0275elementStart(39,"mat-autocomplete",18,5),s.\u0275\u0275listener("optionSelected",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onEntityASelected(a.option.value))}),s.\u0275\u0275template(41,Lf,2,2,"mat-option",19),s.\u0275\u0275pipe(42,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(43,"mat-form-field",15)(44,"mat-label"),s.\u0275\u0275text(45),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(46,"input",16,6),s.\u0275\u0275listener("keyup",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onEntityBChange(a.target.value))})("focus",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onEntityBFocus(a.target.value))})("focusout",function(a){s.\u0275\u0275restoreView(i);const c=s.\u0275\u0275reference(47);return s.\u0275\u0275resetView(n.onAutocompleteFocusOut(a,c))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(48,Bf,2,1,"mat-hint",17),s.\u0275\u0275elementStart(49,"mat-autocomplete",18,7),s.\u0275\u0275listener("optionSelected",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onEntityBSelected(a.option.value))}),s.\u0275\u0275template(51,Ff,2,2,"mat-option",19),s.\u0275\u0275pipe(52,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275element(53,"mat-divider",24),s.\u0275\u0275elementStart(54,"mat-form-field",25)(55,"mat-label"),s.\u0275\u0275text(56),s.\u0275\u0275pipe(57,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(58,"textarea",26),s.\u0275\u0275listener("change",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.onCommentChange(a.target.value))}),s.\u0275\u0275elementEnd()()()}if(t&2){const i=s.\u0275\u0275reference(14),r=s.\u0275\u0275reference(27),a=s.\u0275\u0275reference(40),c=s.\u0275\u0275reference(50);s.\u0275\u0275property("ngIf",n.isLoading),s.\u0275\u0275advance(6),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(7,28,"ConnectionPropertiesPage.Title")),s.\u0275\u0275advance(4),s.\u0275\u0275property("matAutocomplete",i)("value",n.selectedConnectionType==null?null:n.selectedConnectionType.displayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!n.selectedConnectionType),s.\u0275\u0275advance(),s.\u0275\u0275property("displayWith",n.getControlDisplayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",s.\u0275\u0275pipeBind1(16,30,n.connectionTypes)),s.\u0275\u0275advance(6),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(22,32,"ConnectionPropertiesPage.RelationshipType")),s.\u0275\u0275advance(2),s.\u0275\u0275property("matAutocomplete",r)("value",n.selectedRelationshipType==null?null:n.selectedRelationshipType.displayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!n.selectedRelationshipType),s.\u0275\u0275advance(),s.\u0275\u0275property("displayWith",n.getControlDisplayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",s.\u0275\u0275pipeBind1(29,34,n.relationshipTypes)),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(32,36,"ConnectionPropertiesPage.Relations")),s.\u0275\u0275advance(4),s.\u0275\u0275textInterpolate(n.sourceConfig==null||n.sourceConfig.entitySchemaData==null?null:n.sourceConfig.entitySchemaData.caption),s.\u0275\u0275advance(),s.\u0275\u0275property("matAutocomplete",a)("value",n.selectedEntityA==null?null:n.selectedEntityA.displayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!n.selectedEntityA),s.\u0275\u0275advance(),s.\u0275\u0275property("displayWith",n.getControlDisplayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",s.\u0275\u0275pipeBind1(42,38,n.entitiesA)),s.\u0275\u0275advance(4),s.\u0275\u0275textInterpolate(n.targetConfig==null||n.targetConfig.entitySchemaData==null?null:n.targetConfig.entitySchemaData.caption),s.\u0275\u0275advance(),s.\u0275\u0275property("matAutocomplete",c)("value",n.selectedEntityB==null?null:n.selectedEntityB.displayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!n.selectedEntityB),s.\u0275\u0275advance(),s.\u0275\u0275property("displayWith",n.getControlDisplayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",s.\u0275\u0275pipeBind1(52,40,n.entitiesB)),s.\u0275\u0275advance(5),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(57,42,"ConnectionPropertiesPage.Comment")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",n.comment)}},dependencies:[M.NgForOf,M.NgIf,at,xi.MatAutocomplete,Ph.MatOption,xi.MatAutocompleteTrigger,te.MatIconButton,Ne.MatDivider,Ve.MatFormField,Ve.MatLabel,Ve.MatHint,On.MatInput,M.AsyncPipe,T.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;position:relative;height:100%}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-right:0}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-right:10px;text-align:right}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{transform:rotate(-90deg)}.rtl[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:right}.header[_ngcontent-%COMP%]{max-width:343px;padding:12px 20px 0;min-height:97px;max-height:135px;border-top-left-radius:8px;border-top-right-radius:8px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{height:56px;margin-top:5px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-top:7px;flex:0 0 69px;width:72px;height:56px;display:inline-flex;justify-content:center;align-items:center;margin-right:16px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:inline-block;letter-spacing:0px;text-align:left;margin-top:3px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;margin-top:7px;margin-right:10px;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;font-size:16px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;width:100%;position:absolute;overflow-x:hidden;overflow-y:auto;height:auto;bottom:0;top:135px}.content[_ngcontent-%COMP%]:last-child{padding-bottom:0}.content[_ngcontent-%COMP%]   .text-area[_ngcontent-%COMP%]{min-width:150px;width:100%}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:left;letter-spacing:0px}",'.rtl[_nghost-%COMP%]   .title-control-group[_ngcontent-%COMP%]{width:300px}.rtl[_nghost-%COMP%]   .title-control-group[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]{padding:revert;margin-left:0}.rtl[_nghost-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{margin-left:-50px}.logo[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMC45MDgiIGhlaWdodD0iMTEuMDI5IiB2aWV3Qm94PSIwIDAgMTAuOTA4IDExLjAyOSI+PGRlZnM+PHN0eWxlPi5he2ZpbGw6bm9uZTtzdHJva2U6IzU0NjU3ZDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4zNTYgMC40NDcpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTQuMTMxLDEwLjIzLDE0LjIzNiwwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNC4xMzEpIi8+PGxpbmUgY2xhc3M9ImEiIHkxPSIyLjEyNSIgeDI9IjQuMjUxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1Ljg1NSkiLz48bGluZSBjbGFzcz0iYSIgeTE9IjQuMjUxIiB4Mj0iMi4xMjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcuOTgpIi8+PC9nPjwvc3ZnPg==);width:24px;height:24px}.title-control-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:324px}.title-control-group[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.title-control-group[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]{font-family:bpmonline designer icons;line-height:1px;line-height:.6px;font-size:24px;height:24px;width:24px;opacity:.8;margin:19px 19px 10px 5px}.title-control-group[_ngcontent-%COMP%]   .delete-icon[_ngcontent-%COMP%]:before{content:"\\e92c"!important;display:inline;position:relative}.content[_ngcontent-%COMP%]{padding:20px}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{padding-bottom:20px}.content[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{margin:8px -20px 0}']})}}class $t{constructor(){this.createGroup$=new l.Subject,this.addEntityToGroup$=new l.Subject,this.initializeGroups$=new l.Subject,this.isLoading$=new l.ReplaySubject(1)}createGroup(){this.createGroup$.next()}addEntityToGroup(e){this.addEntityToGroup$.next(e)}isLoading(e){this.isLoading$.next(e)}initializeGroups(){this.initializeGroups$.next()}static{this.\u0275fac=function(t){return new(t||$t)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:$t,factory:$t.\u0275fac})}}var jn=y(29833);function zf(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-option",14),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("value",t),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Uf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-form-field",6)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(4,"input",11),s.\u0275\u0275listener("keyup",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onGroupChange(i.target.value))})("focus",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onGroupFocus(i.target.value))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"mat-autocomplete",12,0),s.\u0275\u0275listener("optionSelected",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onGroupSelected(i.option.value))}),s.\u0275\u0275template(7,zf,2,2,"mat-option",13),s.\u0275\u0275pipe(8,"async"),s.\u0275\u0275elementEnd()()}if(o&2){const t=s.\u0275\u0275reference(6),n=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(3,5,"EntityInGroupPropertiesDialog.Group")),s.\u0275\u0275advance(2),s.\u0275\u0275property("matAutocomplete",t)("value",n.selectedGroup==null?null:n.selectedGroup.displayValue),s.\u0275\u0275advance(),s.\u0275\u0275property("displayWith",n.getControlDisplayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",s.\u0275\u0275pipeBind1(8,7,n.groups))}}function $f(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-option",14),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275property("value",t),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.displayValue," ")}}function Gf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-form-field",6)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"input",11),s.\u0275\u0275listener("keyup",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onEntityChange(i.target.value))})("focus",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onEntityFocus(i.target.value))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(4,"mat-autocomplete",12,1),s.\u0275\u0275listener("optionSelected",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onEntitySelected(i.option.value))}),s.\u0275\u0275template(6,$f,2,2,"mat-option",13),s.\u0275\u0275pipe(7,"async"),s.\u0275\u0275elementEnd()()}if(o&2){const t=s.\u0275\u0275reference(5),n=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.itemTypeSchemaCaption),s.\u0275\u0275advance(),s.\u0275\u0275property("matAutocomplete",t)("value",n.selectedEntity==null?null:n.selectedEntity.displayValue),s.\u0275\u0275advance(),s.\u0275\u0275property("displayWith",n.getControlDisplayValue),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",s.\u0275\u0275pipeBind1(7,5,n.entities))}}class Ei{constructor(e,t){this.injector=t,this.itemTypeSchemaCaption="",this.isGroupVisible=!0,this.isEntityVisible=!0,this.isRtl=!1,this.injectDependencies(),this.initializeItemTypeSchemaCaption(),this.initializeEntityInGroup(e?.entityInGroup),this.initializeExludedGroups(e?.excludedGroups),this.initializeExludedEntityRecords(e?.exludedEntityRecords),this._initializeDirectionality()}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}initializeExludedGroups(e){this.excludedGroups=e||[]}initializeExludedEntityRecords(e){this.excludedEntityRecords=e||[]}injectDependencies(){this.lookupDataService=this.injector.get(zt),this.translateService=this.injector.get(T.TranslateService),this.diagramEventService=this.injector.get(Ae),this.directionality=this.injector.get(Ie.Directionality)}initializeItemTypeSchemaCaption(){var e=this;return(0,b.A)(function*(){const n=(yield e.diagramEventService.getDiagramConfig())?.customDiagramElements[k.relationshipItem]||{};e.itemTypeSchemaCaption=n.entitySchemaData?.caption||""})()}initializeEntityInGroup(e){e&&(this.entityInGroup=e,this.initializeComment(),this.initializeInputVisibility())}initializeComment(){this.entityInGroup?.comment||(this.entityInGroup.comment="")}initializeInputVisibility(){this.entityInGroup.groupId&&(this.isGroupVisible=!1),this.entityInGroup.entityId&&(this.isEntityVisible=!1)}getControlLookupValues(e){return this.lookupDataService.getFilteredLookupItems({value:e.value,schemaName:e.schemaName,excludedRecords:e.excludedRecords})}getGroupControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:"RelationshipGroup",excludedRecords:this.excludedGroups})}getContactControlLookupValues(e=""){return this.getControlLookupValues({value:e,schemaName:"Contact",excludedRecords:this.excludedEntityRecords})}isCardValid(){const e=!this.isEntityVisible||!!this.selectedEntity,t=!this.isGroupVisible||!!this.selectedGroup;return e&&t}getControlDisplayValue(e){return e?e.displayValue||e.value:""}onGroupChange(e){this.selectedGroup=null,this.groups=this.getGroupControlLookupValues(e)}onGroupSelected(e){this.selectedGroup=e,this.entityInGroup.groupId=e.value,this.groups=null}onGroupFocus(e){this.groups=this.getGroupControlLookupValues()}onEntityChange(e){this.selectedEntity=null,this.entities=this.getContactControlLookupValues(e)}onEntitySelected(e){this.selectedEntity=e;let t=this.entityInGroup.entityRecordData||{};t=Object.assign(t,{id:e.value,name:e.displayValue}),this.entityInGroup.entityRecordData=t,this.entities=null}onEntityFocus(e){this.entities=this.getContactControlLookupValues()}getDialogCaption(){const e=this.isGroupVisible||this.isEntityVisible?"AddToGroup":"Edit";return this.translateService.instant("EntityInGroupPropertiesDialog."+e)}static{this.\u0275fac=function(t){return new(t||Ei)(s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA),s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ei,selectors:[["crt-entity-in-group-properties-dialog"]],hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275classProp("rtl",n.isRtl)},decls:19,vars:15,consts:[["groupAutocomplete","matAutocomplete"],["contactAutocomplete","matAutocomplete"],[1,"add-entity-to-group-dialog"],["mat-dialog-title",""],["mat-dialog-content","",1,"relationship-dialog-content"],["floatLabel","always",4,"ngIf"],["floatLabel","always"],["type","text","matInput","",3,"input","value"],["mat-dialog-actions",""],["mat-button","",1,"crt-button",3,"mat-dialog-close"],["mat-flat-button","","color","accent",1,"action-button","crt-button",3,"mat-dialog-close","disabled"],["type","text","matInput","","required","",3,"keyup","focus","matAutocomplete","value"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"span"),s.\u0275\u0275text(3),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(4,"div",4),s.\u0275\u0275template(5,Uf,9,9,"mat-form-field",5)(6,Gf,8,7,"mat-form-field",5),s.\u0275\u0275elementStart(7,"mat-form-field",6)(8,"mat-label"),s.\u0275\u0275text(9),s.\u0275\u0275pipe(10,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(11,"input",7),s.\u0275\u0275listener("input",function(r){return n.entityInGroup.comment=r.target.value}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(12,"div",8)(13,"button",9),s.\u0275\u0275text(14),s.\u0275\u0275pipe(15,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(16,"button",10),s.\u0275\u0275text(17),s.\u0275\u0275pipe(18,"translate"),s.\u0275\u0275elementEnd()()()),t&2&&(s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(n.getDialogCaption()),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",n.isGroupVisible),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.isEntityVisible),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(10,9,"EntityInGroupPropertiesDialog.Comment")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",n.entityInGroup==null?null:n.entityInGroup.comment),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(15,11,"EntityInGroupPropertiesDialog.Cancel")," "),s.\u0275\u0275advance(2),s.\u0275\u0275property("mat-dialog-close",n.entityInGroup)("disabled",!n.isCardValid()),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(18,13,"EntityInGroupPropertiesDialog.Save")," "))},dependencies:[M.NgForOf,M.NgIf,xi.MatAutocomplete,Ph.MatOption,xi.MatAutocompleteTrigger,te.MatButton,R.MatDialogClose,R.MatDialogTitle,R.MatDialogActions,R.MatDialogContent,Ve.MatFormField,Ve.MatLabel,On.MatInput,M.AsyncPipe,T.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{min-width:240px}[_nghost-%COMP%]   .mat-mdc-dialog-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-top:4px;font-family:var(--crt-headline-2-font-family);font-size:var(--crt-headline-2-font-size);line-height:var(--crt-headline-2-line-height);font-weight:var(--crt-headline-2-font-weight);letter-spacing:var(--crt-headline-2-letter-spacing);text-transform:var(--crt-headline-2-text-transform);-webkit-font-smoothing:antialiased;color:var(--crt-palette-primary-500, var(--palette-primary-500))}.rtl[_nghost-%COMP%]   .mat-mdc-dialog-title[_ngcontent-%COMP%]{text-align:right}.rtl[_nghost-%COMP%]   .mat-mdc-autocomplete.mat-autocomplete[_ngcontent-%COMP%]:after{right:auto}.mat-mdc-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]   .mdc-floating-label[_ngcontent-%COMP%]   .mat-mdc-form-field-required-marker[_ngcontent-%COMP%]{color:#f44336}.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:flex-end}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%], .mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]{font-family:var(--crt-button-font-family, var(--button-font-family));font-size:var(--crt-button-font-size, var(--button-font-size));font-weight:var(--crt-button-font-weight, var(--button-font-weight));text-transform:var(--crt-button-text-transform, uppercase);border-radius:var(--button-border-radius, var(--button-rounded-border-radius))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[disabled][_ngcontent-%COMP%]{color:var(--crt-palette-disabled-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-disabled-50, rgba(var(--disabled-button-background), 1))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]){color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]):focus{color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]):hover, .mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]).cdk-keyboard-focused{background-color:var(--crt-palette-primary-800, var(--palette-primary-800))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:var(--crt-palette-primary-900, var(--palette-primary-800))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-500, var(--palette-primary-500))!important}"]})}}var dl=y(79017);const Hf=["colorBox"];function Wf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"color-github",15),s.\u0275\u0275listener("onChangeComplete",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onChangeColor(i))}),s.\u0275\u0275elementEnd()}if(o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275styleProp("left",t.colorPickerPosition.x,"px")("top",t.colorPickerPosition.y,"px"),s.\u0275\u0275property("triangle","top-right")("color",t.group.color)("colors",t.colors)("width",187)}}class Ii{constructor(e,t,n){this.translateService=t,this.isNew=!0,this.colors=["#FF2031","#C40069","#C400A9","#8400C4","#5200C4","#2B00C4","#005BC4","#0076C4","#009FC4","#29A5A1","#00C4A8","#00C46D","#00C407","#A3C400"],this.isColorTabVisible=!1,this.colorPickerPosition={x:0,y:0},this.group={id:L(),name:"",color:"#000000",comment:""},this.isRtl=!1,e?.group?(this.group=e.group,this.isNew=!1):this.initializeColor(),this._initializeDirectionality(n)}_initializeDirectionality(e){this.isRtl=e?.value==="rtl"}initializeColor(){const e=Math.floor(Math.random()*Math.floor(this.colors.length-1));this.group.color=this.colors[e]}initializeColorPickerPostion(){const e=this.colorBox?.nativeElement;if(!e)return;let t=e.offsetLeft,n=e.offsetTop;n+=30,t-=145,this.colorPickerPosition={x:t,y:n}}showColorTab(){this.initializeColorPickerPostion(),this.isColorTabVisible=!0}onChangeColor(e){this.group.color=e.color.hex}onGlobalClick(e){this.colorBox.nativeElement.contains(e.target)||(this.isColorTabVisible=!1)}getDialogCaption(){const e=this.isNew?"NewGroup":"EditGroup";return this.translateService.instant("GroupPropertiesDialog."+e)}static{this.\u0275fac=function(t){return new(t||Ii)(s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA),s.\u0275\u0275directiveInject(T.TranslateService),s.\u0275\u0275directiveInject(Ie.Directionality))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ii,selectors:[["crt-group-properties-dialog"]],viewQuery:function(t,n){if(t&1&&s.\u0275\u0275viewQuery(Hf,5,s.ElementRef),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.colorBox=i.first)}},hostVars:2,hostBindings:function(t,n){t&1&&s.\u0275\u0275listener("mousedown",function(r){return n.onGlobalClick(r)},!1,s.\u0275\u0275resolveDocument),t&2&&s.\u0275\u0275classProp("rtl",n.isRtl)},decls:27,vars:20,consts:[["colorBox",""],["mat-dialog-title",""],["mat-dialog-content","",1,"relationship-dialog-content"],[1,"flex-row-control-group"],["floatLabel","always",1,"name-control"],["matInput","","type","text","required","",3,"input","value"],["floatLabel","always"],["matInput","","type","text",3,"input","value"],[1,"color-box-wrap"],[1,"color-box"],[1,"choose-button",3,"click"],["class","color-picker",3,"left","top","triangle","color","colors","width","onChangeComplete",4,"ngIf"],["mat-dialog-actions",""],["mat-button","","cdkFocusInitial","",1,"crt-button",3,"mat-dialog-close"],["mat-flat-button","","color","accent",1,"crt-button",3,"mat-dialog-close","disabled"],[1,"color-picker",3,"onChangeComplete","triangle","color","colors","width"]],template:function(t,n){if(t&1){const i=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",1)(1,"span"),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(3,"div",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),s.\u0275\u0275text(7),s.\u0275\u0275pipe(8,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(9,"input",5),s.\u0275\u0275listener("input",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.group.name=a.target.value)}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(10,"mat-form-field",6)(11,"mat-label"),s.\u0275\u0275text(12),s.\u0275\u0275pipe(13,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(14,"input",7),s.\u0275\u0275listener("input",function(a){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.group.comment=a.target.value)}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(15,"div",8,0),s.\u0275\u0275element(17,"div",9),s.\u0275\u0275elementStart(18,"div",10),s.\u0275\u0275listener("click",function(){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.showColorTab())}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(19,Wf,1,8,"color-github",11),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(20,"div",12)(21,"button",13),s.\u0275\u0275text(22),s.\u0275\u0275pipe(23,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(24,"button",14),s.\u0275\u0275text(25),s.\u0275\u0275pipe(26,"translate"),s.\u0275\u0275elementEnd()()}t&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.getDialogCaption()),s.\u0275\u0275advance(5),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(8,12,"GroupPropertiesDialog.Name")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",n.group.name),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(13,14,"GroupPropertiesDialog.Comment")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",n.group.comment),s.\u0275\u0275advance(3),s.\u0275\u0275styleProp("background",n.group.color),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",n.isColorTabVisible),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(23,16,"GroupPropertiesDialog.Cancel")," "),s.\u0275\u0275advance(2),s.\u0275\u0275property("mat-dialog-close",n.group)("disabled",!(n.group!=null&&n.group.name)),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(26,18,"GroupPropertiesDialog.Save")," "))},dependencies:[M.NgIf,dl.GithubComponent,te.MatButton,R.MatDialogClose,R.MatDialogTitle,R.MatDialogActions,R.MatDialogContent,Ve.MatFormField,Ve.MatLabel,On.MatInput,T.TranslatePipe],styles:["[_nghost-%COMP%]{min-width:240px}[_nghost-%COMP%]   .mat-mdc-dialog-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-top:4px;font-family:var(--crt-headline-2-font-family, var(--dialog-title-font-family));font-size:var(--crt-headline-2-font-size, var(--dialog-title-font-size));line-height:var(--crt-headline-2-line-height, var(--dialog-title-line-height));font-weight:var(--crt-headline-2-font-weight, var(--dialog-title-font-weight));color:var(--crt-palette-primary-500, var(--palette-primary-500))}.rtl[_nghost-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]{margin-right:30px}.rtl[_nghost-%COMP%]   .mat-mdc-dialog-title[_ngcontent-%COMP%]{text-align:right}.mat-mdc-dialog-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .flex-row-control-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .flex-row-control-group[_ngcontent-%COMP%]   .name-control[_ngcontent-%COMP%]{width:100%}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]{height:16px;width:32px;display:flex;margin-left:10px;flex-direction:row;margin-top:20px}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{height:16px;width:16px;border:1px solid #cccccc}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .choose-button[_ngcontent-%COMP%]{height:16px;width:16px;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNTQ2NTdkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNzgzLjc3OSA3NC40NTUpIj48cGF0aCBjbGFzcz0iYSIgZD0iTTE3ODcuNzc5LTY3LjQ1NWw0LDQsNC00WiIvPjwvZz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+);background-position:center;background-repeat:no-repeat}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .choose-button[_ngcontent-%COMP%]:hover{cursor:pointer}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .color-box-wrap[_ngcontent-%COMP%]   .color-picker[_ngcontent-%COMP%]{position:absolute;z-index:2600}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]   .mdc-floating-label[_ngcontent-%COMP%]   mat-label[_ngcontent-%COMP%]{font-family:var(--crt-font-family, var(--font-family))}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]   .mdc-floating-label[_ngcontent-%COMP%]   .mat-mdc-form-field-required-marker[_ngcontent-%COMP%]{color:#f44336}.mat-mdc-dialog-content[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]   .mdc-floating-label[_ngcontent-%COMP%]   .mat-mdc-form-field-flex[_ngcontent-%COMP%]{font-size:var(--crt-body-2-font-size)}.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:flex-end}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%], .mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]{font-family:var(--crt-button-font-family, var(--button-font-family));font-size:var(--crt-button-font-size, var(--button-font-size));font-weight:var(--crt-button-font-weight, var(--button-font-weight));text-transform:var(--crt-button-text-transform, uppercase);border-radius:var(--button-border-radius, var(--button-rounded-border-radius))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[disabled][_ngcontent-%COMP%]{color:var(--crt-palette-disabled-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-disabled-50, rgba(var(--disabled-button-background), 1))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]){color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]):focus{color:var(--crt-palette-primary-contrast-500, var(--palette-primary-contrast-500));background-color:var(--crt-palette-primary-500, var(--palette-primary-500))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]):hover, .mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]).cdk-keyboard-focused{background-color:var(--crt-palette-primary-800, var(--palette-primary-800))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-unelevated-button[_ngcontent-%COMP%]:not([disabled]):active{background-color:var(--crt-palette-primary-900, var(--palette-primary-800))}.mat-mdc-dialog-actions[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-500, var(--palette-primary-500))!important}"]})}}var Ai=y(50725),le=y(44635);const Zf=o=>({"background-image":o});function Yf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",22),s.\u0275\u0275listener("click",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext().$implicit,a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.addEntityToGroup(i,r.id))}),s.\u0275\u0275elementEnd()}}function Kf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-list-item",23)(1,"div",24)(2,"div",25),s.\u0275\u0275element(3,"div",26),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(4,"div",27)(5,"div",28),s.\u0275\u0275text(6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(7,"div",29)(8,"div"),s.\u0275\u0275text(9),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(10,"div",30),s.\u0275\u0275element(11,"button",31),s.\u0275\u0275elementStart(12,"mat-menu",16,1)(14,"button",18),s.\u0275\u0275listener("click",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(r.editEntityInGroup(i))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(15,"button",19),s.\u0275\u0275listener("click",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(r.deleteEntityFromGroup(i.entityId,i.groupId))}),s.\u0275\u0275elementEnd()()()(),s.\u0275\u0275elementStart(16,"div",32),s.\u0275\u0275text(17),s.\u0275\u0275elementEnd()()()()}if(o&2){const t=e.$implicit,n=s.\u0275\u0275reference(13);s.\u0275\u0275advance(3),s.\u0275\u0275property("ngStyle",s.\u0275\u0275pureFunction1(5,Zf,"url("+(t.entityRecordData==null?null:t.entityRecordData.image)+")")),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(t.entityRecordData.type),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(t.entityRecordData.name),s.\u0275\u0275advance(2),s.\u0275\u0275property("matMenuTriggerFor",n),s.\u0275\u0275advance(6),s.\u0275\u0275textInterpolate(t.comment)}}function Jf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-list-item",4)(1,"mat-expansion-panel",5)(2,"mat-expansion-panel-header",6)(3,"div",7)(4,"div",8),s.\u0275\u0275element(5,"mat-icon",9),s.\u0275\u0275elementStart(6,"div",10)(7,"div",11),s.\u0275\u0275text(8),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(9,"div",12),s.\u0275\u0275text(10),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(11,"div",13),s.\u0275\u0275template(12,Yf,1,0,"button",14),s.\u0275\u0275elementStart(13,"button",15),s.\u0275\u0275listener("click",function(i){return s.\u0275\u0275restoreView(t),s.\u0275\u0275resetView(i==null?null:i.stopPropagation())}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(14,"mat-menu",16,0)(16,"button",17),s.\u0275\u0275listener("click",function(i){const r=s.\u0275\u0275restoreView(t).$implicit,a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.toggleHighlightGroup(i,r.id))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(17,"button",18),s.\u0275\u0275listener("click",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.editGroup(i))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(18,"button",19),s.\u0275\u0275listener("click",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.deleteGroup(i.id))}),s.\u0275\u0275elementEnd()()()()(),s.\u0275\u0275elementStart(19,"mat-list",20),s.\u0275\u0275template(20,Kf,18,7,"mat-list-item",21),s.\u0275\u0275elementEnd()()()}if(o&2){const t=e.$implicit,n=s.\u0275\u0275reference(15),i=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("expanded",!0),s.\u0275\u0275advance(),s.\u0275\u0275property("collapsedHeight","33px")("expandedHeight","33px"),s.\u0275\u0275advance(3),s.\u0275\u0275styleProp("background",t.color),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(t.name),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("(",i.getGroupEntitiesCount(t),")"),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",i.isAddEntityToGroupButtonVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("matMenuTriggerFor",n),s.\u0275\u0275advance(3),s.\u0275\u0275classProp("selectedGroup",i.highlightedGroupId===t.id),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngForOf",t.entities)}}class Pi{set isLoading(e){this.groupContentListEventService.isLoading(e)}set filteredEntityId(e){e!==this._filteredEntityId&&(this._filteredEntityId=e)}set searchFilter(e){e!==this._searchFilter&&(this._searchFilter=e,this.renderGroup())}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}_initializeGTM(){this._subscription.add(this.googleTagManagerService.initialize().subscribe())}constructor(e){this.injector=e,this._subscription=new l.Subscription,this._searchFilter="",this.groups=[],this.renderedGroups=[],this.searchFilterChange=new s.EventEmitter,this.changed=new s.EventEmitter,this.isRtl=!1,this.injectDependencies(),this.subscribePageEvent(),this._initializeDirectionality(),this._initializeGTM()}injectDependencies(){this.diagramEventService=this.injector.get(Ae),this.directionality=this.injector.get(Ie.Directionality),this.googleTagManagerService=this.injector.get(An),this.relationshipDesignerService=this.injector.get(bt),this.groupContentListEventService=this.injector.get($t),this.dialogService=this.injector.get(He),this.translateService=this.injector.get(T.TranslateService),this.relationshipDeleteDialogService=this.injector.get(vt)}initializeGroups(){this.isLoading=!0;const e=this.relationshipDesignerService,t=this._filteredEntityId;(t?e.getGroupsDataForEntity(t):e.getGroupsData()).subscribe(i=>{if(!i?.success){this.isLoading=!1,this.showErrorDialog(i);return}this.groups=i.groups,this.renderGroup(),this.isLoading=!1})}renderGroup(){const e=(0,v.cloneDeep)(this.groups);this.renderedGroups=this.filteredGroupByFilter(e)}filteredGroupByFilter(e){const t=this._searchFilter?.toLocaleLowerCase();return t?e.filter(n=>{let i=n.entities||[];return i=i.filter(r=>{const a=r.entityRecordData?.name||"";return this.isStringContain(a,t)}),n.entities=i,i.length===0?this.isStringContain(n.name,t)?n:!1:n}):e}isStringContain(e,t){return e.toLowerCase().indexOf(t)>=0}clearSearchFilter(){this._searchFilter="",this.searchFilterChange.emit(this._searchFilter),this.renderGroup()}showErrorDialog(e){if(e?.success)return;const t=e?.errorInfo?.message||"An unknown error occurred during the operation.";this._subscription.add(this.dialogService.openInfoDialog(t).subscribe())}handleBaseDialogAction(e,t,n){e&&(this.isLoading=!0,t.call(this.relationshipDesignerService,e).subscribe(i=>this.handleBaseResponseAction(i,n)))}handleBaseResponseAction(e,t){if(!e?.success){this.isLoading=!1,this.showErrorDialog(e);return}t(),this.clearSearchFilter(),this.isLoading=!1,this.changed.emit(this.groups)}subscribePageEvent(){const e=this.groupContentListEventService;this._subscription.add(e.createGroup$.subscribe(()=>this.createGroup())),this._subscription.add(e.addEntityToGroup$.subscribe(t=>this.doAddEntityToGroup(t))),this._subscription.add(e.initializeGroups$.subscribe(()=>this.initializeGroups()))}addGroupToList(e){this.groups.push(e)}updateGroupInList(e){const t=this.groups.findIndex(n=>n.id===e.id);this.groups[t]=e}deleteGroupFromList(e){const t=this.groups.findIndex(n=>n.id===e);this.groups.splice(t,1),this.diagramEventService.entityInGroupRemoving()}doAddEntityToGroup(e){const t={panelClass:["relationship-dialog-edit"],data:{entityInGroup:e,excludedGroups:this.getExcludedGroupsList(),exludedEntityRecords:this.getExcludedEntityRecords(e)},autoFocus:!1},n=this.dialogService.open(Ei,t).subscribe(i=>{this.handleBaseDialogAction(i,this.relationshipDesignerService.createEntityInGroup,()=>{this.addEntityInGroupToList(i),this.diagramEventService.entityInGroupAdded(),this.sendGtmAction({action:Mi.AddEntityInGroup})})});this._subscription.add(n)}addEntityInGroupToList(e){this.initializeGroups()}updateEntityInGroupInList(e){const t=this.groups.find(i=>i.id===e.groupId),n=t.entities.findIndex(i=>i.id===e.id);t.entities[n]=e}deleteEntityInGroupFromList(e,t){const n=this.groups.find(r=>r.id===t),i=n.entities.findIndex(r=>r.entityId===e);n.entities.splice(i,1)}getExcludedGroupsList(){return this._filteredEntityId?this.groups.map(e=>e.id):[]}getExcludedEntityRecords(e){if(this._filteredEntityId||!e.groupId)return[];const t=[];return this.groups.find(i=>i.id===e.groupId).entities?.forEach(i=>t.push(i.entityRecordData.id)),t}sendGtmAction(e){const t={moduleName:"RelationshipDesignerModule",schemaName:"GroupContentListComponent"};e&&t&&this.googleTagManagerService.track((0,v.merge)(t,e))}getGroupEntitiesCount(e){return e.entities?.length||0}ngOnInit(){this.initializeGroups()}ngOnDestroy(){this._subscription.unsubscribe()}createGroup(){const e={panelClass:["relationship-dialog-edit"],data:{}},t=this.dialogService.open(Ii,e).subscribe(n=>{this.handleBaseDialogAction(n,this.relationshipDesignerService.createGroup,()=>{this.addGroupToList(n),this.sendGtmAction({action:Mi.AddGroup})})});this._subscription.add(t)}editGroup(e){const t=Object.assign({},e),n={panelClass:["relationship-dialog-edit"],data:{group:t}},i=this.dialogService.open(Ii,n).subscribe(r=>{this.handleBaseDialogAction(r,this.relationshipDesignerService.updateGroup,()=>this.updateGroupInList(r))});this._subscription.add(i)}deleteGroup(e){const t=this.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(n=>{n&&(this.isLoading=!0,this.relationshipDesignerService.deleteGroup(e).subscribe(i=>{this.handleBaseResponseAction(i,()=>this.deleteGroupFromList(e))}))});this._subscription.add(t)}toggleHighlightGroup(e,t){e?.stopPropagation(),this.highlightedGroupId=t!==this.highlightedGroupId?t:null,this.diagramEventService.highlightGroup(this.highlightedGroupId)}addEntityToGroup(e,t){e?.stopPropagation(),this.doAddEntityToGroup({groupId:t})}editEntityInGroup(e){const t={panelClass:["relationship-dialog-edit"],data:{entityInGroup:Object.assign({},e)}},n=this.dialogService.open(Ei,t).subscribe(i=>{this.handleBaseDialogAction(i,this.relationshipDesignerService.updateEntityInGroup,()=>this.updateEntityInGroupInList(i))});this._subscription.add(n)}deleteEntityFromGroup(e,t){const n=this.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(i=>{i&&this.relationshipDesignerService.deleteEntityInGroup(e,t).subscribe(r=>{this.handleBaseResponseAction(r,()=>this.deleteEntityInGroupFromList(e,t))})});this._subscription.add(n)}isAddEntityToGroupButtonVisible(){return!this._filteredEntityId}static{this.\u0275fac=function(t){return new(t||Pi)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Pi,selectors:[["crt-group-content-list"]],hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275classProp("rtl",n.isRtl)},inputs:{filteredEntityId:"filteredEntityId",searchFilter:"searchFilter"},outputs:{searchFilterChange:"searchFilterChange",changed:"changed"},decls:2,vars:1,consts:[["matGroupItemMenu","matMenu"],["matGroupEntityItemMenu","matMenu"],[1,"group-list"],["class","group-list-item",4,"ngFor","ngForOf"],[1,"group-list-item"],[3,"expanded"],[3,"collapsedHeight","expandedHeight"],[1,"group-list-item-content"],[1,"group-list-item-info"],["matListIcon","",1,"group-icon"],[1,"group-caption-block"],[1,"group-caption"],[1,"group-caption-count"],[1,"group-list-item-actions"],["disableRipple","","mat-icon-button","","class","group-add-icon",3,"click",4,"ngIf"],["disableRipple","","mat-icon-button","",1,"group-menu-button",3,"click","matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"relationship-group-menu"],["mat-menu-item","",1,"highlight",3,"click"],["mat-menu-item","",1,"edit",3,"click"],["mat-menu-item","",1,"delete",3,"click"],[1,"group-entity-list"],["class","group-entity-list-item",4,"ngFor","ngForOf"],["disableRipple","","mat-icon-button","",1,"group-add-icon",3,"click"],[1,"group-entity-list-item"],[1,"group-entity-list-item-info"],[1,"entity-logo"],[1,"logo",3,"ngStyle"],[1,"entity-info"],[1,"entity-type"],[1,"entity-name"],[1,"group-entity-list-item-actions"],["disableRipple","","mat-icon-button","",1,"group-menu-button",3,"matMenuTriggerFor"],[1,"entity-comment"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"mat-list",2),s.\u0275\u0275template(1,Jf,21,12,"mat-list-item",3),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",n.renderedGroups))},dependencies:[M.NgForOf,M.NgIf,M.NgStyle,te.MatIconButton,jn.MatExpansionPanel,jn.MatExpansionPanelHeader,Z.MatIcon,Ai.MatList,Ai.MatListItem,le.MatMenu,le.MatMenuItem,le.MatMenuTrigger],styles:[".rtl[_nghost-%COMP%]   .group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-icon[_ngcontent-%COMP%]{margin-left:7px;margin-right:0}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]{display:flex}.group-list-item-content[_ngcontent-%COMP%]{display:flex;width:100%;height:33px}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-icon[_ngcontent-%COMP%]{height:12px;width:12px;padding:0;margin-right:7px}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-caption-block[_ngcontent-%COMP%]{width:212px;display:flex;flex-direction:row}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-caption-block[_ngcontent-%COMP%]   .group-caption[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-info[_ngcontent-%COMP%]   .group-caption-block[_ngcontent-%COMP%]   .group-caption-count[_ngcontent-%COMP%]{white-space:pre}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-actions[_ngcontent-%COMP%]{display:flex;align-items:center;opacity:0}.group-list-item-content[_ngcontent-%COMP%]   .group-list-item-actions[_ngcontent-%COMP%]   .group-add-icon[_ngcontent-%COMP%]{margin:0}.mat-expansion-panel-header[_ngcontent-%COMP%]:hover   .group-list-item-content[_ngcontent-%COMP%]   .group-list-item-actions[_ngcontent-%COMP%]{opacity:unset}.entity-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}.entity-logo[_ngcontent-%COMP%]{min-height:100%;width:42px;display:flex;flex-direction:column;justify-content:center}.entity-logo[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:32px;width:32px;border-radius:16px;background-position:center;background-repeat:no-repeat}"]})}}const qf=o=>({"background-image":o});function Xf(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-list-item",3)(1,"div",4)(2,"div",5),s.\u0275\u0275element(3,"div",6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(4,"div",7)(5,"div",8),s.\u0275\u0275text(6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(7,"div",9)(8,"div"),s.\u0275\u0275text(9),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(10,"div",10),s.\u0275\u0275element(11,"button",11),s.\u0275\u0275elementStart(12,"mat-menu",12,0)(14,"button",13),s.\u0275\u0275listener("click",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.edit(i))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(15,"button",14),s.\u0275\u0275listener("click",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.delete(i))}),s.\u0275\u0275elementEnd()()()(),s.\u0275\u0275elementStart(16,"div",15),s.\u0275\u0275text(17),s.\u0275\u0275elementEnd()()()()}if(o&2){const t=e.$implicit,n=s.\u0275\u0275reference(13);s.\u0275\u0275advance(3),s.\u0275\u0275property("ngStyle",s.\u0275\u0275pureFunction1(5,qf,"url("+t.image+")")),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(t.typeCaption),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(t.entityCaption),s.\u0275\u0275advance(2),s.\u0275\u0275property("matMenuTriggerFor",n),s.\u0275\u0275advance(6),s.\u0275\u0275textInterpolate(t.comment)}}class ar{constructor(e){this.injector=e,this.subscription=new l.Subscription,this.isRtl=!1,this.injectDependencies(),this._initializeDirectionality()}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}injectDependencies(){this.designerService=this.injector.get(bt),this.diagramEventService=this.injector.get(Ae),this.dialogService=this.injector.get(He),this.translateService=this.injector.get(T.TranslateService),this.directionality=this.injector.get(Ie.Directionality),this.relationshipDeleteDialogService=this.injector.get(vt)}showErrorDialog(e){if(e?.success)return;const t=e?.errorInfo?.message||"An unknown error occurred during the operation.";this.subscription.add(this.dialogService.openInfoDialog(t).subscribe())}ngOnDestroy(){this.subscription.unsubscribe()}edit(e){this.diagramEventService.elementDoubleClick$.next(e.id)}delete(e){this.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage").subscribe(t=>{t&&this.designerService.deleteConnection(e.originalId).subscribe(n=>{if(!n?.success){this.showErrorDialog(n);return}this.diagramEventService.diagramChanged$.next()})})}static{this.\u0275fac=function(t){return new(t||ar)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:ar,selectors:[["crt-related-list"]],hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275classProp("rtl",n.isRtl)},inputs:{relatedItems:"relatedItems"},decls:2,vars:1,consts:[["matRelatedItemMenu","matMenu"],[1,"related-list"],["class","related-list-item",4,"ngFor","ngForOf"],[1,"related-list-item"],[1,"related-list-item-info"],[1,"related-entity-logo"],[1,"logo",3,"ngStyle"],[1,"related-info"],[1,"related-type-caption"],[1,"related-entity-name"],[1,"related-list-item-actions"],["mat-icon-button","",1,"related-item-menu-button",3,"matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"relationship-group-menu"],["mat-menu-item","",1,"edit",3,"click"],["mat-menu-item","",1,"delete",3,"click"],[1,"related-comment"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"mat-list",1),s.\u0275\u0275template(1,Xf,18,7,"mat-list-item",2),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",n.relatedItems))},dependencies:[M.NgForOf,M.NgStyle,te.MatIconButton,Ai.MatList,Ai.MatListItem,le.MatMenu,le.MatMenuItem,le.MatMenuTrigger],styles:[".rtl[_nghost-%COMP%]   .related-list-item-info[_ngcontent-%COMP%]   .related-info[_ngcontent-%COMP%]   .related-type-caption[_ngcontent-%COMP%]{padding-right:0;padding-left:20px}.rtl[_nghost-%COMP%]   .related-list-item-info[_ngcontent-%COMP%]   .related-info[_ngcontent-%COMP%]   .related-comment[_ngcontent-%COMP%]{padding-right:0;padding-left:20px}"]})}}const Qf=o=>({"background-image":o});function e_(o,e){o&1&&s.\u0275\u0275element(0,"ts-mask",13)}function t_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"input",18),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Type")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.type)}}function n_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"input",18),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Address")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.address)}}function i_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"input",19),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Phone")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.phone)}}function s_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"input",20),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Email")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.email)}}function r_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-form-field",17)(1,"mat-label"),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"input",20),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(3,2,"ContainerPropertiesPage.Web")),s.\u0275\u0275advance(2),s.\u0275\u0275property("value",t.elementData==null||t.elementData.recordInfo==null?null:t.elementData.recordInfo.web)}}function o_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),s.\u0275\u0275text(3),s.\u0275\u0275pipe(4,"translate"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275template(5,t_,5,4,"mat-form-field",16)(6,n_,5,4,"mat-form-field",16)(7,i_,5,4,"mat-form-field",16)(8,s_,5,4,"mat-form-field",16)(9,r_,5,4,"mat-form-field",16),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("expanded",!0),s.\u0275\u0275advance(),s.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(4,9,"ContainerPropertiesPage.GeneralInformation")),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.type)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.address)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.phone)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.email)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!!(!(t.elementData==null||t.elementData.recordInfo==null)&&t.elementData.recordInfo.web))}}function a_(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),s.\u0275\u0275text(3),s.\u0275\u0275pipe(4,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"button",21),s.\u0275\u0275listener("click",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.addToGroup(i))}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(6,"crt-group-content-list",22),s.\u0275\u0275listener("changed",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(i.onGroupsChanged())}),s.\u0275\u0275elementEnd()()}if(o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("expanded",t.isGroupsChanged),s.\u0275\u0275advance(),s.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(4,5,"ContainerPropertiesPage.Groups")),s.\u0275\u0275advance(3),s.\u0275\u0275property("filteredEntityId",t.elementData==null?null:t.elementData.originalId)}}function c_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),s.\u0275\u0275text(3),s.\u0275\u0275elementEnd()(),s.\u0275\u0275element(4,"crt-related-list",23),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("expanded",!0),s.\u0275\u0275advance(),s.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(t.getRelatedContactsCaption()),s.\u0275\u0275advance(),s.\u0275\u0275property("relatedItems",t.relatedContacts)}}function l_(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"mat-expansion-panel",14)(1,"mat-expansion-panel-header",15)(2,"mat-panel-title"),s.\u0275\u0275text(3),s.\u0275\u0275elementEnd()(),s.\u0275\u0275element(4,"crt-related-list",23),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("expanded",!0),s.\u0275\u0275advance(),s.\u0275\u0275property("collapsedHeight","48px")("expandedHeight","48px"),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(t.getRelatedAccountsCaption()),s.\u0275\u0275advance(),s.\u0275\u0275property("relatedItems",t.relatedAccounts)}}class cr extends Ut{constructor(e){super(e),this.isGroupsChanged=!1,this.pageLink="",this.relatedAccounts=[],this.relatedContacts=[]}injectDependencies(){super.injectDependencies(),this.groupContentListEventService=this.injector.get($t),this.linkGenerator=this.injector.get(Mn)}subscribeEvents(){super.subscribeEvents(),this.subscription.add(this.groupContentListEventService.isLoading$.subscribe(e=>this.isLoading=e))}onDataInitialized(){super.onDataInitialized(),this.initializePageLinkTool(),this.showMask();const e=this.elementData.originalId||this.elementData.id;this.designerService.getRecordEntityInfo(e).subscribe(t=>{if(!t?.success){this.hideMask(),this.showErrorDialog(t);return}this.initializeRecordEntityInfo(t.recordEntityInfo),this.fillRelatedAccounts(),this.fillRelatedContacts(),this.hideMask()})}initializePageLinkTool(){const e=this.elementConfig.entitySchemaData.name,t=this.elementData.recordId;this.subscription.add(this.linkGenerator.buildPageUrl(e,t).subscribe(n=>this.pageLink=n))}initializeRecordEntityInfo(e){this.elementData.recordInfo=e}isChanged(){return super.isChanged()||this.isGroupsChanged}getRelatedElementCaption(e,t=""){const n=this.translateService.instant("ContainerPropertiesPage.RelationshipsWith"),r=this.getElementConfig(e)?.entitySchemaData?.caption||t;return ca.String.Format(n,r)}getRelatedItems(e){const t=this.elementData.id,n=[],i=k,r=[i.connection,i.indirectConnection],a=e===i.relationshipContainer?"Contact":"Account";return this.elementConfig?.caption===a&&r.push(i.parentConnection),Object.values(this.data.connections).filter(c=>r.includes(c.type)).forEach(c=>{let h;if(c.source===t)h=c.target;else if(c.target===t)h=c.source;else return;const p=this.data.elements[h];if(p?.type===e&&p?.canRead){const m=p,f=m.largeImage||this.getElementConfig(m.type).largeImage,C={id:c.id,originalId:c.originalId,image:f,typeCaption:c.relationshipType.name,entityCaption:m.caption,comment:c.comment};n.push(C)}}),n}isDescriptionVisible(){const e=this.elementData?.recordInfo||{};return!!e.type||!!e.address||!!e.phone||!!e.email||!!e.web}onGroupsChanged(){this.isGroupsChanged=!0}isGroupVisible(){return this.elementConfig?.caption==="Contact"}isRelatedAccountsVisible(){return!0}isRelatedContactsVisible(){return!0}addToGroup(e){e.stopPropagation();const t={entityId:this.elementData.originalId};this.groupContentListEventService.addEntityToGroup(t)}fillRelatedAccounts(){this.relatedAccounts=this.getRelatedItems(k.relationshipContainer)}fillRelatedContacts(){this.relatedContacts=this.getRelatedItems(k.relationshipItem)}getRelatedContactsCaption(){return this.getRelatedElementCaption(k.relationshipItem)}getRelatedAccountsCaption(){return this.getRelatedElementCaption(k.relationshipContainer)}static{this.\u0275fac=function(t){return new(t||cr)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:cr,selectors:[["crt-container-properties-page"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:19,vars:11,consts:[["class","component-mask",4,"ngIf"],[1,"header"],[1,"title-wrap"],[1,"logo-wrap"],[1,"logo",3,"ngStyle"],[1,"title"],[1,"sub-title"],[1,"tools-group-wrap"],[1,"entity-info"],[1,"tools"],["target","_blank",1,"tool","open-card",3,"href"],[1,"content"],[3,"expanded",4,"ngIf"],[1,"component-mask"],[3,"expanded"],[3,"collapsedHeight","expandedHeight"],["floatLabel","always",4,"ngIf"],["floatLabel","always"],["type","text","matInput","","disabled","",3,"value"],["type","tel","matInput","","disabled","",3,"value"],["type","email","matInput","","disabled","",3,"value"],["mat-icon-button","",1,"group-add-icon",3,"click"],[3,"changed","filteredEntityId"],[3,"relatedItems"]],template:function(t,n){t&1&&(s.\u0275\u0275template(0,e_,1,0,"ts-mask",0),s.\u0275\u0275elementStart(1,"div",1)(2,"div",2)(3,"div",3),s.\u0275\u0275element(4,"div",4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"div",5)(6,"div",6),s.\u0275\u0275text(7),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"div"),s.\u0275\u0275text(9),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(10,"div",7),s.\u0275\u0275element(11,"div",8),s.\u0275\u0275elementStart(12,"div",9),s.\u0275\u0275element(13,"a",10),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(14,"div",11),s.\u0275\u0275template(15,o_,10,11,"mat-expansion-panel",12)(16,a_,7,7,"mat-expansion-panel",12)(17,c_,5,5,"mat-expansion-panel",12)(18,l_,5,5,"mat-expansion-panel",12),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275property("ngIf",n.isLoading),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngStyle",s.\u0275\u0275pureFunction1(9,Qf,"url("+(n.elementData==null?null:n.elementData.largeImage)+")")),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(n.elementData==null?null:n.elementData.subCaption),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.elementData==null?null:n.elementData.caption),s.\u0275\u0275advance(4),s.\u0275\u0275property("href",n.pageLink,s.\u0275\u0275sanitizeUrl),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",n.isDescriptionVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.isGroupVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.isRelatedContactsVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.isRelatedAccountsVisible()))},dependencies:[M.NgIf,M.NgStyle,at,te.MatIconButton,jn.MatExpansionPanel,jn.MatExpansionPanelHeader,jn.MatExpansionPanelTitle,Ve.MatFormField,Ve.MatLabel,On.MatInput,Pi,ar,T.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;position:relative;height:100%}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-right:0}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-right:10px;text-align:right}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{transform:rotate(-90deg)}.rtl[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:right}.header[_ngcontent-%COMP%]{max-width:343px;padding:12px 20px 0;min-height:97px;max-height:135px;border-top-left-radius:8px;border-top-right-radius:8px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{height:56px;margin-top:5px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-top:7px;flex:0 0 69px;width:72px;height:56px;display:inline-flex;justify-content:center;align-items:center;margin-right:16px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:inline-block;letter-spacing:0px;text-align:left;margin-top:3px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;margin-top:7px;margin-right:10px;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;font-size:16px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;width:100%;position:absolute;overflow-x:hidden;overflow-y:auto;height:auto;bottom:0;top:135px}.content[_ngcontent-%COMP%]:last-child{padding-bottom:0}.content[_ngcontent-%COMP%]   .text-area[_ngcontent-%COMP%]{min-width:150px;width:100%}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:left;letter-spacing:0px}",".rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{margin-right:-10px}.header[_ngcontent-%COMP%]{display:flex;min-height:97px;justify-content:space-between}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:100%;width:100%;max-width:290px;min-width:290px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-size:contain;width:100%;height:100%}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:0;height:49px;margin-bottom:2px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:29px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{min-width:24px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .entity-info[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;align-items:center;width:50%}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{width:50%;align-items:flex-start}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEiIGhlaWdodD0iMTEiIHZpZXdCb3g9IjAgMCAxMSAxMSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik02LjE3NTUzIDAuODAxODE3QzYuMTc1NTMgMC4zNTg5ODYgNi41MzQ1MiAwIDYuOTc3MzUgMEgxMC4xMDE3QzEwLjU5NzUgMCAxMC45OTk1IDAuNDAxOTggMTAuOTk5NSAwLjg5Nzg0M1Y0LjAyMjE3QzEwLjk5OTUgNC40NjUgMTAuNjQwNSA0LjgyMzk4IDEwLjE5NzcgNC44MjM5OEM5Ljc1NDg3IDQuODIzOTggOS4zOTU4OCA0LjQ2NSA5LjM5NTg4IDQuMDIyMTdWMi43Mzk5M0w1LjExMTA0IDcuMDM0MDhDNC43OTgyNSA3LjM0NzU1IDQuMjkwNTcgNy4zNDgxIDMuOTc3MSA3LjAzNTMxQzMuNjYzNjMgNi43MjI1MiAzLjY2MzA4IDYuMjE0ODQgMy45NzU4NyA1LjkwMTM3TDguMjY0MyAxLjYwMzYzSDYuOTc3MzVDNi41MzQ1MiAxLjYwMzYzIDYuMTc1NTMgMS4yNDQ2NSA2LjE3NTUzIDAuODAxODE3Wk0yLjcyMjM0IDEuNjAzNjNDMi4xMDQ0OSAxLjYwMzYzIDEuNjAzNjMgMi4xMDQ0OSAxLjYwMzYzIDIuNzIyMzRWOC4yNzc1OUMxLjYwMzYzIDguODk1NDMgMi4xMDQ0OSA5LjM5NjI5IDIuNzIyMzQgOS4zOTYyOUg4LjI3NzU5QzguODk1NDMgOS4zOTYyOSA5LjM5NjI5IDguODk1NDMgOS4zOTYyOSA4LjI3NzU5VjcuMjgxMzlDOS4zOTYyOSA2LjgzODU2IDkuNzU1MjcgNi40Nzk1OCAxMC4xOTgxIDYuNDc5NThDMTAuNjQwOSA2LjQ3OTU4IDEwLjk5OTkgNi44Mzg1NiAxMC45OTk5IDcuMjgxMzlWOC4yNzc1OUMxMC45OTk5IDkuNzgxMDkgOS43ODEwOSAxMC45OTk5IDguMjc3NTkgMTAuOTk5OUgyLjcyMjM0QzEuMjE4ODMgMTAuOTk5OSAwIDkuNzgxMDkgMCA4LjI3NzU5VjIuNzIyMzRDMCAxLjIxODgzIDEuMjE4ODMgMCAyLjcyMjM0IDBIMy42ODc0NkM0LjEzMDI5IDAgNC40ODkyOCAwLjM1ODk4NiA0LjQ4OTI4IDAuODAxODE3QzQuNDg5MjggMS4yNDQ2NSA0LjEzMDI5IDEuNjAzNjMgMy42ODc0NiAxLjYwMzYzSDIuNzIyMzRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K);background-position:center;background-repeat:no-repeat}.content[_ngcontent-%COMP%]{top:99px;border-bottom-left-radius:8px;border-bottom-right-radius:8px}.content[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{padding-bottom:0;margin-top:0}.content[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]   .group-add-icon[_ngcontent-%COMP%]{margin:0;opacity:0}.content[_ngcontent-%COMP%]   .mat-expansion-panel-header[_ngcontent-%COMP%]:hover   .group-add-icon[_ngcontent-%COMP%]{opacity:unset}"]})}}function u_(o,e){o&1&&s.\u0275\u0275element(0,"ts-mask",15)}class lr extends Ut{constructor(e){super(e),this.isGroupsChanged=!1,this.searchFilter=""}injectDependencies(){super.injectDependencies(),this.groupContentListEventService=this.injector.get($t)}subscribeEvents(){super.subscribeEvents(),this.subscription.add(this.groupContentListEventService.isLoading$.subscribe(e=>this.isLoading=e))}isChanged(){return super.isChanged()||this.isGroupsChanged}onGroupsChanged(){this.isGroupsChanged=!0}createGroup(){this.groupContentListEventService.createGroup()}onSearchFilterValueChanged(e){this.searchFilter=e}static{this.\u0275fac=function(t){return new(t||lr)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:lr,selectors:[["crt-groups-properties-page"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:18,vars:9,consts:[["class","component-mask",4,"ngIf"],[1,"header"],[1,"title-wrap"],[1,"logo-wrap"],[1,"logo"],[1,"title"],[1,"tools-group-wrap"],[1,"search-tool"],["floatLabel","never",1,"search-input"],["matInput","","type","text","spellcheck","false","autocomplete","off",1,"search-input-field",3,"keyup","placeholder","value"],["matSuffix","",1,"search-icon"],[1,"tools"],["mat-icon-button","",1,"tool","add-icon",3,"click"],[1,"content"],[3,"searchFilterChange","changed","searchFilter"],[1,"component-mask"]],template:function(t,n){t&1&&(s.\u0275\u0275template(0,u_,1,0,"ts-mask",0),s.\u0275\u0275elementStart(1,"div",1)(2,"div",2)(3,"div",3),s.\u0275\u0275element(4,"div",4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"div",5),s.\u0275\u0275text(6),s.\u0275\u0275pipe(7,"translate"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(8,"div",6)(9,"div",7)(10,"mat-form-field",8)(11,"input",9),s.\u0275\u0275pipe(12,"translate"),s.\u0275\u0275listener("keyup",function(r){return n.onSearchFilterValueChanged(r.target.value)}),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(13,"mat-icon",10),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(14,"div",11)(15,"button",12),s.\u0275\u0275listener("click",function(){return n.createGroup()}),s.\u0275\u0275elementEnd()()()(),s.\u0275\u0275elementStart(16,"div",13)(17,"crt-group-content-list",14),s.\u0275\u0275twoWayListener("searchFilterChange",function(r){return s.\u0275\u0275twoWayBindingSet(n.searchFilter,r)||(n.searchFilter=r),r}),s.\u0275\u0275listener("changed",function(){return n.onGroupsChanged()}),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275property("ngIf",n.isLoading),s.\u0275\u0275advance(6),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(7,5,"GroupsPropertiesPage.Title")),s.\u0275\u0275advance(5),s.\u0275\u0275property("placeholder",s.\u0275\u0275pipeBind1(12,7,"GroupsPropertiesPage.Search"))("value",n.searchFilter),s.\u0275\u0275advance(6),s.\u0275\u0275twoWayProperty("searchFilter",n.searchFilter))},dependencies:[M.NgIf,at,te.MatIconButton,Z.MatIcon,Ve.MatFormField,Ve.MatSuffix,On.MatInput,Pi,T.TranslatePipe],styles:["[_nghost-%COMP%]{display:block;position:relative;height:100%}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-right:0}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-right:10px;text-align:right}.rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.open-card[_ngcontent-%COMP%]{transform:rotate(-90deg)}.rtl[_nghost-%COMP%]   .content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:right}.header[_ngcontent-%COMP%]{max-width:343px;padding:12px 20px 0;min-height:97px;max-height:135px;border-top-left-radius:8px;border-top-right-radius:8px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]{height:56px;margin-top:5px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]{margin-top:7px;flex:0 0 69px;width:72px;height:56px;display:inline-flex;justify-content:center;align-items:center;margin-right:16px}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background-position:center;background-repeat:no-repeat}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:inline-block;letter-spacing:0px;text-align:left;margin-top:3px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;margin-top:7px;margin-right:10px;justify-content:flex-end;align-items:center}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;font-size:16px}.content[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;width:100%;position:absolute;overflow-x:hidden;overflow-y:auto;height:auto;bottom:0;top:135px}.content[_ngcontent-%COMP%]:last-child{padding-bottom:0}.content[_ngcontent-%COMP%]   .text-area[_ngcontent-%COMP%]{min-width:150px;width:100%}.content[_ngcontent-%COMP%]   .group-label[_ngcontent-%COMP%]{text-align:left;letter-spacing:0px}",".rtl[_nghost-%COMP%]   .header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{display:flex}.header[_ngcontent-%COMP%]   .title-wrap[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzOS4xOTEiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzOS4xOTEgMzIiPjxkZWZzPjxzdHlsZT4uYSwuYntmaWxsOm5vbmU7fS5he3N0cm9rZTojMDA2Y2UwO3N0cm9rZS1taXRlcmxpbWl0OjEwO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzLjM5NCAtMC40MDMpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjEwNiA1LjUzMikiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwMi42MTYsNDc5LjQ2N2E1LjUyOSw1LjUyOSwwLDAsMC01LjUyNy01LjUzMiw1LjUzNSw1LjUzNSwwLDAsMC01LjUzNiw1LjUzMkE1LjUzNyw1LjUzNywwLDAsMC0zMDguMTQ0LDQ4NSw1LjUzMSw1LjUzMSwwLDAsMC0zMDIuNjE2LDQ3OS40NjdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMjMuMjQ0IC00NzIuOTM1KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwNS41MzIsNDg3LjU3M2g3Ljk4MWMwLTQtMy4wMjctNi42MzgtNy41NzItNi42MzhhOS41LDkuNSwwLDAsMC0zLjQ5Mi42MTciIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMzMS43NDIgLTQ2OC40NDYpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMjk5Ljc2NCw0NzkuODZhNC40MjcsNC40MjcsMCwwLDAtNC40MjUtNC40MjUsNC40MjYsNC40MjYsMCwwLDAtNC40MjUsNC40MjUsNC40MjcsNC40MjcsMCwwLDAsNC40MjUsNC40MzJBNC40MjksNC40MjksMCwwLDAtMjk5Ljc2NCw0NzkuODZaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMzAuNzQ1IC00NzIuMTE2KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMxMC43NTEsNDg3LjU3M2gtNy45NzljMC00LDMuMDI4LTYuNjM4LDcuNTctNi42MzhhOS41MjcsOS41MjcsMCwwLDEsMy40OTMuNjE3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTQuNzMgLTQ2OC40NDYpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMzE3LjYxNSw0NzkuODZhNC40MjQsNC40MjQsMCwwLDEsNC40MjMtNC40MjUsNC40Myw0LjQzLDAsMCwxLDQuNDI4LDQuNDI1LDQuNDMyLDQuNDMyLDAsMCwxLTQuNDI4LDQuNDMyQTQuNDI1LDQuNDI1LDAsMCwxLTMxNy42MTUsNDc5Ljg2WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzE2LjgzIC00NzIuMTE2KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTI5OC43NjQsNDg5Ljc4NmMwLTUuMzMtMy4zODMtOC44NTEtOC40NTctOC44NTFzLTguNDU3LDMuNTIxLTguNDU3LDguODUxWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzIyLjMxNiAtNDY4LjQ0NikiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAwLjQwMykiLz48L2c+PC9zdmc+);width:40px;height:32px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]{width:100%;padding-right:10px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-input[_ngcontent-%COMP%]{width:100%}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{font-size:16px;line-height:16px}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .search-tool[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]:before{margin-top:2px;position:absolute}.header[_ngcontent-%COMP%]   .tools-group-wrap[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{margin-bottom:6px;font-size:18px;height:24px;width:24px}"]})}}const d_=["card"],h_=[[["","caption",""]],[["","tools",""]]],p_=["[caption]","[tools]"],m_=o=>({pressed:o});function g_(o,e){o&1&&s.\u0275\u0275element(0,"ts-mask",12)}function f_(o,e){}class kn{get diagramData(){return this._config?.data}get diagramConfig(){return this._config?.config}set data(e){e!==this._inputData&&(this._inputData=e,this.clearDiagramData(),this.loadDiagram())}_showResponseErorrs(e){if(e.length){const n=(0,v.uniq)(e).join(`
	`);this.showErrorDialog(n)}}_getDeleteItem(e){return new Promise(t=>{this._getDeleteItemObservable(e.id,e.originalId).subscribe(i=>{i?.success?t():t(this.getErrorResponseMessage(i))})})}_getDeleteItemObservable(e,t){return this.diagramData.connections[e]?this.designerService.deleteConnection(t):this.designerService.deleteEntity(t)}_getItem(e){return this.diagramData.elements[e]||this.diagramData.connections[e]}_getElementConfig(e){return e&&this.diagramConfig?.customDiagramElements[e]}_getCardTypeByElementId(e){const t=this._getItem(e);if(!t)throw new Error(`Not found element with id: ${e}`);return this._getCardTypeElementType(t.type)}_getCardTypeElementType(e){switch(e){case k.relationshipContainer:case k.relationshipItem:return cr;case k.connection:case k.indirectConnection:case k.parentConnection:return Rn;default:throw new Error(`Not implemented properties page for type: ${e}`)}}_confirmRemoving(){var e=this;return(0,b.A)(function*(){return yield(0,l.firstValueFrom)(e.relationshipDeleteDialogService.confirmRemoving("RelationshipDesigner.DeleteItemMessage"))})()}_getExistDiagramItems(e){const t=[];return e.forEach(n=>{const i=this._getItem(n);i&&t.push(i)}),t}_deleteEntities(e){var t=this;return(0,b.A)(function*(){t.showMask();const i=t._getExistDiagramItems(e).map(a=>t._getDeleteItem(a));let r=!1;return yield Promise.all(i).then(a=>{a=a.filter(c=>c&&c!==""),t._showResponseErorrs(a),r=a.length<e.length}),t.sendGtmAction({action:Mi.DeleteElement}),t.hideMask(),r})()}_initializeDirectionality(){this.isRtl=this.directionality?.value==="rtl"}_initializeGTM(){this._subscription.add(this.googleTagManagerService.initialize().subscribe())}constructor(e){this.injector=e,this._subscription=new l.Subscription,this.allowFullScreenMode=!0,this.isCardShowed=!1,this.isLoading=!1,this.isLoadingPending=!1,this.showMaskDelay=100,this.isGroupsCardOpen=!1,this.isFullscreenMode=!1,this.isRtl=!1,this.injectDependencies(),this.subscribeEvents(),this._initializeDirectionality(),this._initializeGTM()}showMask(){this.isLoadingPending=!0,setTimeout(()=>{this.isLoadingPending&&(this.isLoading=!0)},this.showMaskDelay)}hideMask(){this.isLoadingPending=!1,this.isLoading=!1,this.changeDetector.detectChanges()}injectDependencies(){this.changeDetector=this.injector.get(s.ChangeDetectorRef),this.designerService=this.injector.get(bt),this.diagramEventService=this.injector.get(Ae),this.propertiesPageEventService=this.injector.get(Dn),this.dialogService=this.injector.get(He),this.translateService=this.injector.get(T.TranslateService),this.notifyService=this.injector.get(In),this.directionality=this.injector.get(Ie.Directionality),this.googleTagManagerService=this.injector.get(An),this.relationshipDeleteDialogService=this.injector.get(vt)}subscribeEvents(){this.subscribeDiagramEvents()}subscribeDiagramEvents(){var e=this;const t=this.diagramEventService;[t.itemSelected$.subscribe(i=>{this.onItemSelected(i)}),t.highlightedGroup$.subscribe(i=>{this.onGroupHighlighted(i)}),t.elementDoubleClick$.subscribe(i=>{this.onElementDoubleClick(i)}),t.elementRemoving$.subscribe(function(){var i=(0,b.A)(function*(r){yield e.onElementRemoving(r)});return function(r){return i.apply(this,arguments)}}()),t.connectionAdding$.subscribe(i=>{this.onConnectionAdding(i)}),t.showMessage$.subscribe(i=>{this.notifyService.show({message:i,panelClass:"relationship-notify"}).then()}),t.connectionReconnect$.subscribe(function(){var i=(0,b.A)(function*(r){yield e.onConnectionReconnect(r)});return function(r){return i.apply(this,arguments)}}()),t.entityInGroupAdded$.subscribe((0,b.A)(function*(){e.loadDiagram()})),t.entityInGroupRemoving$.subscribe((0,b.A)(function*(){e.loadDiagram()})),t.diagramChanged$.subscribe((0,b.A)(function*(){e.loadDiagram()})),this.propertiesPageEventService.doCloseCard().subscribe(function(){var i=(0,b.A)(function*(r){return yield e.closeCard(r)});return function(r){return i.apply(this,arguments)}}())].forEach(i=>{this._subscription.add(i)})}loadDiagram(){this.showMask();const e=this._inputData;if(!e?.selectedRecordId||!e?.schemaName){this.clearDiagramData(),this.hideMask();return}this.designerService.getDiagram(e.selectedRecordId,e.schemaName).subscribe(t=>{if(t?.success)this.initializeDesignerConfig({data:t.data,config:t.config});else{const n=this.getErrorResponseMessage(t);this.showErrorDialog(n)}this.hideMask()})}initializeDesignerConfig(e){this._config=e,this.propertiesPageEventService.setDesignerConfig(e),this.initializeDiagram(e.config),this.loadDataToDiagram(e.data)}initializeDiagram(e){this.initializeDiagramLocalizableStrings(e),this.diagramEventService.setDiagramConfig({dialogService:this.dialogService,translateService:this.translateService,...e})}initializeDiagramLocalizableStrings(e){this.initializeDiagramToolsLocalizableStrings(e)}initializeDiagramToolsLocalizableStrings(e){const t=e.customLocalizableStrings||{},n={};["FitToView","ResetView","ZoomIn","ZoomOut","MiniMapClose","MiniMapOpen"].forEach(r=>{const a=this.translateService.instant("RelationshipDiagram.Tools."+r);r=Af(r),n[r]=a}),e.customLocalizableStrings=Object.assign(n,t)}loadDataToDiagram(e){this.diagramEventService.endLoading$.next(e)}openCardByElementId(e){var t=this;return(0,b.A)(function*(){let n=null;if(e){const i=t._getCardTypeByElementId(e);if(n=yield t.openCard(i),!n)return;n.id$.next(e)}return n})()}openCard(e){var t=this;return(0,b.A)(function*(){if(!(yield t.closeCard()))return;const i=t.card.createComponent(e);return t.isCardShowed=!0,i.instance})()}closeCard(e){return(0,l.lastValueFrom)(new l.Observable(t=>{e?.isForced?(this.forceCloseCard(e),t.next(!0),t.complete()):this.isCardShowed?this.saveAndCloseCard(t):(this.clearCardContainer(),t.next(!0),t.complete())}),{defaultValue:null})}forceCloseCard(e){this.clearCardContainer(),e.isNeedDiagramReload&&this.loadDiagram()}saveAndCloseCard(e){const t=this.propertiesPageEventService.saveCard().pipe((0,d.first)()).subscribe(n=>{const i=n?.success;i&&(this.clearCardContainer(),n.isChanged&&this.loadDiagram()),e.next(i),e.complete()});this._subscription.add(t)}clearCardContainer(){this.card.clear(),this.isCardShowed=!1,this.isGroupsCardOpen=!1}getErrorResponseMessage(e){return e?.errorInfo?.message||"An unknown error occurred during the operation."}showErrorDialog(e){this.hideMask(),this._subscription.add(this.dialogService.openInfoDialog(e).subscribe())}getDefaultRelationshipType(e,t){return{connectionType:this.getDefaultConnectionType(e,t)}}getDefaultConnectionType(e,t){const n=this._getItem(e),i=this._getItem(t);return n&&i?wi.getDefaultConnectionType(n,i):Ft.formal}clearDiagramData(){this.loadDataToDiagram({})}sendGtmAction(e){const t={moduleName:"RelationshipDesignerModule",schemaName:"RelationshipDesignerComponent"};e&&t&&this.googleTagManagerService.track((0,v.merge)(t,e))}ngOnDestroy(){this._subscription.unsubscribe()}onItemSelected(e){var t=this;return(0,b.A)(function*(){e||(yield t.closeCard())})()}onGroupHighlighted(e){this.diagramComponent.get("eventBus").fire("relationshipGroup.highlight.changed",{id:e})}onElementDoubleClick(e){var t=this;return(0,b.A)(function*(){e?yield t.openCardByElementId(e):yield t.closeCard()})()}onElementRemoving(e){var t=this;return(0,b.A)(function*(){(yield t._confirmRemoving())&&(yield t.closeCard({isForced:!0,isNeedDiagramReload:!1}),(yield t._deleteEntities(e))&&t.loadDiagram())})()}onConnectionAdding(e){var t=this;return(0,b.A)(function*(){const n=yield t.openCard(Rn);n&&(n.elementData={id:e.id,source:e.source,target:e.target,relationshipType:t.getDefaultRelationshipType(e.source,e.target),isNew:!0},n.targetConfig=t._getElementConfig(e.targetType),n.id$.next(e.id||L()))})()}onConnectionReconnect(e){var t=this;return(0,b.A)(function*(){yield t._deleteEntities([e.id]);const n=yield t.openCard(Rn);n&&(n.elementData={source:e.source,target:e.target,relationshipType:t.getDefaultRelationshipType(e.source,e.target),isNew:!0},n.id$.next(L()))})()}showGroupsCard(){var e=this;return(0,b.A)(function*(){if(e.isGroupsCardOpen)yield e.closeCard(),e.isGroupsCardOpen=!1;else{const t=yield e.openCard(lr);t&&(t.id$.next(L()),e.isGroupsCardOpen=!0)}})()}toggleFullscreenMode(){this.isFullscreenMode=!this.isFullscreenMode}static{this.\u0275fac=function(t){return new(t||kn)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:kn,selectors:[["crt-relationship-designer"]],viewQuery:function(t,n){if(t&1&&(s.\u0275\u0275viewQuery(d_,7,s.ViewContainerRef),s.\u0275\u0275viewQuery(Tn,7)),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.card=i.first),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.diagramComponent=i.first)}},hostVars:4,hostBindings:function(t,n){t&2&&s.\u0275\u0275classProp("fullscreen",n.isFullscreenMode)("rtl",n.isRtl)},inputs:{data:"data",allowFullScreenMode:"allowFullScreenMode"},ngContentSelectors:p_,decls:15,vars:8,consts:[["card",""],["class","component-mask",4,"ngIf"],[1,"designer-tools-panel"],[1,"caption-content-container"],[1,"modes"],[1,"tools"],["mat-icon-button","",1,"tool","group",3,"click","ngClass"],["mat-icon-button","",1,"tool","fullscreen",3,"click"],[1,"additional-tools-container"],[1,"designer-content"],[1,"diagram-wrap"],[1,"card-wrap"],[1,"component-mask"]],template:function(t,n){if(t&1){const i=s.\u0275\u0275getCurrentView();s.\u0275\u0275projectionDef(h_),s.\u0275\u0275template(0,g_,1,0,"ts-mask",1),s.\u0275\u0275elementStart(1,"div",2)(2,"div",3),s.\u0275\u0275projection(3),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"div",4),s.\u0275\u0275elementStart(5,"div",5)(6,"button",6),s.\u0275\u0275listener("click",function(){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.showGroupsCard())}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(7,"button",7),s.\u0275\u0275listener("click",function(){return s.\u0275\u0275restoreView(i),s.\u0275\u0275resetView(n.toggleFullscreenMode())}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"div",8),s.\u0275\u0275projection(9,1),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(10,"div",9),s.\u0275\u0275element(11,"crt-relationship-diagram",10),s.\u0275\u0275elementStart(12,"div",11),s.\u0275\u0275template(13,f_,0,0,"ng-template",null,0,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementEnd()()}t&2&&(s.\u0275\u0275property("ngIf",n.isLoading),s.\u0275\u0275advance(6),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(6,m_,n.isGroupsCardOpen)),s.\u0275\u0275advance(),s.\u0275\u0275classProp("hidden",!n.allowFullScreenMode),s.\u0275\u0275advance(5),s.\u0275\u0275classProp("card-hidden",!n.isCardShowed))},dependencies:[M.NgClass,M.NgIf,at,te.MatIconButton,Tn],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column;justify-content:flex-start;align-items:stretch;position:relative}.fullscreen[_nghost-%COMP%]{position:fixed;z-index:1999;top:0;left:0;width:100%;height:100%;background:#fff}.fullscreen[_nghost-%COMP%]   .designer-content[_ngcontent-%COMP%]{height:calc(100vh - 50px)}.fullscreen[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiI+CiAgPGRlZnM+CiAgICA8c3R5bGU+CiAgICAgIC5he2ZpbGw6IzU0NjU3ZH0uYntmaWxsOm5vbmU7c3Ryb2tlOiM1NDY1N2Q7c3Ryb2tlLW1pdGVybGltaXQ6MTB9CiAgICA8L3N0eWxlPgogIDwvZGVmcz4KICA8cGF0aCBjbGFzcz0iYSIgZD0iTTE0LjAwMyA4aC01VjN6TTguMDAzIDE0VjloLTV6Ii8+CiAgPHBhdGggY2xhc3M9ImIiIGQ9Ik0zIDE0bDQtNE0xMCA3bDQtNCIvPgogIDxwYXRoIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMTZ2MTZIMHoiLz4KPC9zdmc+Cg==) no-repeat center}.fullscreen[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]:hover{background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzY3OF8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA2Nzgg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8cGF0aCBpZD0iUGF0aF82MDU3IiBkYXRhLW5hbWU9IlBhdGggNjA1NyIgZD0iTTE4MjIuNi02MGgtNXYtNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xODA4LjU5NyA2OCkiIGZpbGw9IiMwMDZjZTAiLz4NCiAgPHBhdGggaWQ9IlBhdGhfNjA1OCIgZGF0YS1uYW1lPSJQYXRoIDYwNTgiIGQ9Ik0xODI5LjYtNjd2LTVoLTVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgyMS41OTcgODEpIiBmaWxsPSIjMDA2Y2UwIi8+DQogIDxsaW5lIGlkPSJMaW5lXzU3OSIgZGF0YS1uYW1lPSJMaW5lIDU3OSIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzIDEwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA2Y2UwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIvPg0KICA8bGluZSBpZD0iTGluZV81ODAiIGRhdGEtbmFtZT0iTGluZSA1ODAiIHkxPSI0IiB4Mj0iNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAgMykiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwNmNlMCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82Mjc2IiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2Mjc2IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K) no-repeat center}.rtl[_nghost-%COMP%]   .designer-content[_ngcontent-%COMP%]{direction:rtl;text-align:right}.rtl[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{margin-right:10px;margin-left:10px}.rtl[_nghost-%COMP%]   .designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]{transform:rotate(90deg)}.fullscreen-overlay[_ngcontent-%COMP%]{position:fixed;width:100%;height:100%;top:0;left:0;opacity:.4;background-color:#fff;z-index:1998}.designer-tools-panel[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;height:48px;border:1px solid #dbdbdb;border-radius:8px}.designer-tools-panel[_ngcontent-%COMP%]   .modes[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.designer-tools-panel[_ngcontent-%COMP%]   .caption-content-container[_ngcontent-%COMP%]{width:100%}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch;justify-content:flex-end;align-items:center;min-width:345px}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool[_ngcontent-%COMP%]{width:16px;height:16px;margin-right:22px}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.group[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzU0NjU3ZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzE5LjExNiAtNDcxLjQzNSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwOC42OCw0NzYuNDM1YTIuNSwyLjUsMCwwLDAtMi41LTIuNSwyLjUsMi41LDAsMCwwLTIuNSwyLjUsMi41LDIuNSwwLDAsMCwyLjUsMi41QTIuNSwyLjUsMCwwLDAtMzA4LjY4LDQ3Ni40MzVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA2NCkiLz48cGF0aCBjbGFzcz0iYSIgZD0iTS0zMDcuMjIyLDQ4My45MzVoMy42MDdjMC0xLjgwNi0xLjM2OC0zLTMuNDIyLTNhNC4yOTQsNC4yOTQsMCwwLDAtMS41NzguMjc5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMC4wMDEpIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMzA0LjYxNSw0NzcuNDM1YTIsMiwwLDAsMC0yLTIsMiwyLDAsMCwwLTIsMiwyLDIsMCwwLDAsMiwyQTIsMiwwLDAsMC0zMDQuNjE1LDQ3Ny40MzVaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tMzE1LjEyNCw0ODMuOTM1aC0zLjYwNmMwLTEuODA2LDEuMzY5LTMsMy40MjEtM2E0LjMwNiw0LjMwNiwwLDAsMSwxLjU3OS4yNzkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTE0KSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMxNy42MTUsNDc3LjQzNWEyLDIsMCwwLDEsMi0yLDIsMiwwLDAsMSwyLDIsMiwyLDAsMCwxLTIsMkEyLDIsMCwwLDEtMzE3LjYxNSw0NzcuNDM1WiIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTMwNi42NzgsNDg0LjkzNWMwLTIuNDA5LTEuOC00LTQuNS00cy00LjUsMS41OTEtNC41LDRaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjA2MikiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjwvc3ZnPg==) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.group[_ngcontent-%COMP%]:hover{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojMDA2Y2UwO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNOCw5Yy0yLjk5MSwwLTUsMS44MDktNSw0LjVWMTRIMTN2LS41QzEzLDEwLjgwOSwxMC45OSw5LDgsOVoiLz48Y2lyY2xlIGNsYXNzPSJhIiBjeD0iMyIgY3k9IjMiIHI9IjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUgMikiLz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMiw5aC0uMzc5YTUuMTU1LDUuMTU1LDAsMCwxLDIuMzU1LDRIMTZ2LS41QzE2LDEwLjQ0LDE0LjM1NSw5LDEyLDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik00LDloLjM3OWE1LjE1NSw1LjE1NSwwLDAsMC0yLjM1NSw0SDB2LS41QzAsMTAuNDQsMS42NDUsOSw0LDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMi41LDMuNWEyLjQ3NiwyLjQ3NiwwLDAsMC0uNzU4LjEzLDMuOTI2LDMuOTI2LDAsMCwxLS45MjYsNC4yMDZBMi41LDIuNSwwLDEsMCwxMi41LDMuNVoiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTMuNSwzLjVhMi40NzYsMi40NzYsMCwwLDEsLjc1OC4xMywzLjkyNiwzLjkyNiwwLDAsMCwuOTI2LDQuMjA2QTIuNSwyLjUsMCwxLDEsMy41LDMuNVoiLz48L3N2Zz4=) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.group.pressed[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojMDA2Y2UwO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNOCw5Yy0yLjk5MSwwLTUsMS44MDktNSw0LjVWMTRIMTN2LS41QzEzLDEwLjgwOSwxMC45OSw5LDgsOVoiLz48Y2lyY2xlIGNsYXNzPSJhIiBjeD0iMyIgY3k9IjMiIHI9IjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUgMikiLz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMiw5aC0uMzc5YTUuMTU1LDUuMTU1LDAsMCwxLDIuMzU1LDRIMTZ2LS41QzE2LDEwLjQ0LDE0LjM1NSw5LDEyLDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik00LDloLjM3OWE1LjE1NSw1LjE1NSwwLDAsMC0yLjM1NSw0SDB2LS41QzAsMTAuNDQsMS42NDUsOSw0LDlaIi8+PHBhdGggY2xhc3M9ImEiIGQ9Ik0xMi41LDMuNWEyLjQ3NiwyLjQ3NiwwLDAsMC0uNzU4LjEzLDMuOTI2LDMuOTI2LDAsMCwxLS45MjYsNC4yMDZBMi41LDIuNSwwLDEsMCwxMi41LDMuNVoiLz48cGF0aCBjbGFzcz0iYSIgZD0iTTMuNSwzLjVhMi40NzYsMi40NzYsMCwwLDEsLjc1OC4xMywzLjkyNiwzLjkyNiwwLDAsMCwuOTI2LDQuMjA2QTIuNSwyLjUsMCwxLDEsMy41LDMuNVoiLz48L3N2Zz4=) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]{background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzUwN18zIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA1MDcg4oCTIDMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNTgxMSIgZGF0YS1uYW1lPSJHcm91cCA1ODExIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgxNS41OTcgNzQpIj4NCiAgICA8cGF0aCBpZD0iUGF0aF82MDU3IiBkYXRhLW5hbWU9IlBhdGggNjA1NyIgZD0iTTE4MjIuNi02MGgtNXYtNVoiIGZpbGw9IiM1NDY1N2QiLz4NCiAgICA8cGF0aCBpZD0iUGF0aF82MDU4IiBkYXRhLW5hbWU9IlBhdGggNjA1OCIgZD0iTTE4MjkuNi02N3YtNWgtNVoiIGZpbGw9IiM1NDY1N2QiLz4NCiAgICA8bGluZSBpZD0iTGluZV81NzkiIGRhdGEtbmFtZT0iTGluZSA1NzkiIHkxPSI0IiB4Mj0iNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTgyNC41OTcgLTcxKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIvPg0KICAgIDxsaW5lIGlkPSJMaW5lXzU4MCIgZGF0YS1uYW1lPSJMaW5lIDU4MCIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODE4LjU5NyAtNjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82Mjc2IiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2Mjc2IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4MTUuNTk3IC03NCkiIGZpbGw9Im5vbmUiLz4NCiAgPC9nPg0KPC9zdmc+DQo=) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen[_ngcontent-%COMP%]:hover{background:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzY3OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA2Nzkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8cGF0aCBpZD0iUGF0aF82MDU3IiBkYXRhLW5hbWU9IlBhdGggNjA1NyIgZD0iTTE4MjIuNi02MGgtNXYtNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xODE1LjU5NyA3NCkiIGZpbGw9IiMwMDZjZTAiLz4NCiAgPHBhdGggaWQ9IlBhdGhfNjA1OCIgZGF0YS1uYW1lPSJQYXRoIDYwNTgiIGQ9Ik0xODI5LjYtNjd2LTVoLTVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgxNS41OTcgNzQpIiBmaWxsPSIjMDA2Y2UwIi8+DQogIDxsaW5lIGlkPSJMaW5lXzU3OSIgZGF0YS1uYW1lPSJMaW5lIDU3OSIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5IDMpIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDZjZTAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzU4MCIgZGF0YS1uYW1lPSJMaW5lIDU4MCIgeTE9IjQiIHgyPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzIDkpIiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDZjZTAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxyZWN0IGlkPSJSZWN0YW5nbGVfNjI3NiIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNjI3NiIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJub25lIi8+DQo8L3N2Zz4NCg==) no-repeat center}.designer-tools-panel[_ngcontent-%COMP%]   .tools[_ngcontent-%COMP%]   .tool.fullscreen.hidden[_ngcontent-%COMP%]{display:none}.designer-content[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:flex-start;align-items:stretch}.designer-content[_ngcontent-%COMP%]   .diagram-wrap[_ngcontent-%COMP%]{width:100%;border-radius:8px}.designer-content[_ngcontent-%COMP%]   .card-wrap[_ngcontent-%COMP%]{min-width:345px;max-width:345px;border:1px solid #dcdcdc;border-radius:8px}.designer-content[_ngcontent-%COMP%]   .card-wrap.card-hidden[_ngcontent-%COMP%]{display:none}"]})}}var ur=y(20637);function da(o){return e=>Hg(o,e)}var __=y(57229);class St{static{this._visibleMasks=new Set}get maskComponent(){return this.maskComponentRef?.instance}get isVisible(){return!!this.maskComponent?.isVisible}set isVisible(e){e?(this.maskComponent||this.createMaskComponent(),this.maskComponent.isVisible=!0):this.maskComponent&&(this.maskComponent.isVisible=!1)}constructor(e,t){this.document=e,this.ngZone=t,this._defaultMaskDelayMilliseconds=300,this._defaultMinimumMaskDuration=500,this._immediateDisplayAfterHideMaxDelay=50,this._maskShouldBeShown=!1,this._maskShownTimestamp=0,this._maskHiddenTimestamp=0,this.updateMaskStateAttribute()}updateMaskStateAttribute(){const e=this.document?.body;e&&(St._visibleMasks.size>0?e.getAttribute("maskstate")!=="visible"&&e.setAttribute("maskstate","visible"):e.getAttribute("maskstate")!=="none"&&e.setAttribute("maskstate","none"))}_internalShow(){this.isVisible||(this.isVisible=!0,St._visibleMasks.add(this),this.updateMaskStateAttribute(),this._maskShownTimestamp=Date.now())}_internalHide(){this.isVisible&&(this.isVisible=!1,St._visibleMasks.delete(this),this.updateMaskStateAttribute(),this._maskHiddenTimestamp=Date.now())}show(e){this._maskShouldBeShown=!0;const t=Date.now()-this._maskHiddenTimestamp;e?.delay===0||t<this._immediateDisplayAfterHideMaxDelay?this._internalShow():this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._maskShouldBeShown&&this.ngZone.run(()=>this._internalShow())},e?.delay||this._defaultMaskDelayMilliseconds)})}hide(){this._maskShouldBeShown=!1;const e=Date.now()-this._maskShownTimestamp;e>=this._defaultMinimumMaskDuration?this._internalHide():this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._maskShouldBeShown||this.ngZone.run(()=>this._internalHide())},this._defaultMinimumMaskDuration-e)})}ngOnDestroy(){this.maskComponentRef?.destroy(),this.maskComponentRef=null,St._visibleMasks.delete(this)}static{this.\u0275fac=function(t){return new(t||St)(s.\u0275\u0275inject(Document),s.\u0275\u0275inject(s.NgZone))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:St,factory:St.\u0275fac})}}const y_=new s.InjectionToken("CRT_MASK_COMPONENT");class dr extends St{constructor(e,t,n,i){super(n,i),this._viewContainerRef=e,this._maskComponentType=t,this._tasks=new Set}_setMaskStateAttribute(){const e=this._viewContainerRef?.element.nativeElement.parentElement;if(!e)return;const t=e.getAttribute("maskstate"),n=this.isVisible?"visible":"none";e.setAttribute("aria-busy",this.isVisible?"true":"false"),this.isVisible?e.setAttribute("inert","true"):e.removeAttribute("inert"),t!==n&&e.setAttribute("maskstate",n)}createMaskComponent(){this.maskComponentRef=this._viewContainerRef.createComponent(this._maskComponentType??at),this.maskComponentRef.instance.containerized=!0,this.maskComponentRef.instance.isVisible=!1}updateMaskStateAttribute(){super.updateMaskStateAttribute(),this._setMaskStateAttribute()}addTask(e,t){return this.shouldShow!==!1&&(this._tasks.add(e),this.show(t??this.settings)),e}removeTask(e){this.shouldShow!==!1&&(this._tasks.delete(e),this._tasks.size===0&&this.hide())}clearTasks(){this.shouldShow!==!1&&this._tasks.size>0&&(this._tasks.clear(),this.hide())}static{this.\u0275fac=function(t){return new(t||dr)(s.\u0275\u0275directiveInject(s.ViewContainerRef),s.\u0275\u0275directiveInject(y_,8),s.\u0275\u0275directiveInject(M.DOCUMENT),s.\u0275\u0275directiveInject(s.NgZone))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:dr,selectors:[["","crtMask",""]],inputs:{shouldShow:[0,"crtMask","shouldShow"],settings:[0,"crtMaskSettings","settings"]},features:[s.\u0275\u0275InheritDefinitionFeature]})}}class Ti{static{this.\u0275fac=function(t){return new(t||Ti)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Ti})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[M.CommonModule,ul.MatProgressSpinnerModule,T.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Ti,{declarations:[at,dr],imports:[M.CommonModule,ul.MatProgressSpinnerModule,T.TranslateModule],exports:[at,dr]})})();class hr{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||hr)(s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:hr,selectors:[["ts-info-with-header-dialog"]],decls:9,vars:10,consts:[[1,"header-message"],[1,"message"],[1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",0),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"div",1),s.\u0275\u0275text(4),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(6,"button",2),s.\u0275\u0275text(7),s.\u0275\u0275pipe(8,"translate"),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(2,4,n.data==null?null:n.data.headerMessage)),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(5,6,n.data==null?null:n.data.message)),s.\u0275\u0275advance(2),s.\u0275\u0275property("mat-dialog-close",n.data==null||n.data.button==null?null:n.data.button.result),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(8,8,n.data==null||n.data.button==null?null:n.data.button.caption),`
`))},dependencies:[R.MatDialogClose,T.TranslatePipe],styles:[".header-message[_ngcontent-%COMP%]{margin-bottom:24px}.message[_ngcontent-%COMP%]{margin-bottom:40px;white-space:pre-wrap}.action-button[_ngcontent-%COMP%]{float:right;text-transform:none;border-radius:16px;padding:0 16px}"]})}}class ct{static{this.\u0275fac=function(t){return new(t||ct)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:ct})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[He,{provide:ai.FocusTrapFactory,useClass:ai.ConfigurableFocusTrapFactory}],imports:[M.CommonModule,te.MatButtonModule,R.MatDialogModule,T.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(ct,{declarations:[En,_i,yi,hr],imports:[M.CommonModule,te.MatButtonModule,R.MatDialogModule,T.TranslateModule],exports:[En,yi,hr,_i]})})();var hl=y(78927);class Gt{constructor(){this._directionality=(0,s.inject)(Ie.Directionality),this.loadingText="SkeletonLoader.Loading",this.documentDirection=this._directionality?.value,this.animation="progress",this.appearance="line",this.count=1,this.styles={}}set ariaLabel(e){this.loadingText=e??this.loadingText}ngOnInit(){this.documentDirection=this._directionality?.value==="rtl"?"rtl":null}static{this.\u0275fac=function(t){return new(t||Gt)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Gt,selectors:[["crt-skeleton-loader"]],inputs:{animation:"animation",appearance:"appearance",count:"count",styles:"styles",ariaLabel:"ariaLabel"},decls:3,vars:14,consts:[[1,"crt-skeleton-loader",3,"theme","appearance","count","ariaLabel","loadingText","animation"]],template:function(t,n){t&1&&(s.\u0275\u0275element(0,"ngx-skeleton-loader",0),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275pipe(2,"translate")),t&2&&(s.\u0275\u0275styleProp("width",n.styles==null?null:n.styles.width),s.\u0275\u0275property("theme",n.styles)("appearance",n.appearance)("count",n.count)("ariaLabel",s.\u0275\u0275pipeBind1(1,10,n.loadingText))("loadingText",s.\u0275\u0275pipeBind1(2,12,n.loadingText))("animation",n.animation),s.\u0275\u0275attribute("appearance",n.appearance)("dir",n.documentDirection))},dependencies:[hl.NgxSkeletonLoaderComponent,T.TranslatePipe],styles:["[_nghost-%COMP%]{overflow:hidden;display:flex;width:100%}[_nghost-%COMP%]   .crt-skeleton-loader[_ngcontent-%COMP%]{display:block;min-width:0;flex:auto;width:200px}[_nghost-%COMP%]   .crt-skeleton-loader[appearance=circle][_ngcontent-%COMP%]{width:50px}"]})}}const C_="crt-web-element-skeleton-loader";class b_{static init(e){const{injector:t,tag:n,component:i}=e;if(customElements.get(n))return;const r=(0,Nd.createCustomElement)(i,{injector:t});customElements.define(n,r)}}class Ht{constructor(e){this.injector=e;const t={injector:this.injector,tag:C_,component:Gt};b_.init(t)}static{this.\u0275fac=function(t){return new(t||Ht)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Ht})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[hl.NgxSkeletonLoaderModule,T.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Ht,{declarations:[Gt],imports:[hl.NgxSkeletonLoaderModule,T.TranslateModule],exports:[Gt]})})();var ha=y(49489);function v_(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"ng-lottie",1),s.\u0275\u0275listener("animationCreated",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onAnimationCreated(i))})("click",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(i.onClick())}),s.\u0275\u0275elementEnd()}if(o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("options",t.options)("width",t.width)("height",t.height)}}class Di{set config(e){this._setConfig(e).then()}constructor(e,t){this._changeDetectorRef=e,this._ngZone=t,this.options=null,this.width="100px",this.height="100px"}_setConfig(e){var t=this;return(0,b.A)(function*(){const n=yield e.animationData();t.options={animationData:n,loop:e.loop,autoplay:e.autoplay},t._changeDetectorRef.markForCheck()})()}onAnimationCreated(e){this._animationItem=e}onClick(){this._ngZone.runOutsideAngular(()=>{this._animationItem.stop(),this._animationItem.play()})}static{this.\u0275fac=function(t){return new(t||Di)(s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(s.NgZone))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Di,selectors:[["crt-lottie"]],inputs:{width:"width",height:"height",config:"config"},decls:1,vars:1,consts:[["class","lottie-animation",3,"options","width","height","animationCreated","click",4,"ngIf"],[1,"lottie-animation",3,"animationCreated","click","options","width","height"]],template:function(t,n){t&1&&s.\u0275\u0275template(0,v_,1,3,"ng-lottie",0),t&2&&s.\u0275\u0275property("ngIf",n.options)},dependencies:[M.NgIf,ha.LottieComponent],styles:[".lottie-animation[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})}}class Oi{static{this.\u0275fac=function(t){return new(t||Oi)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Oi})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[(0,ha.provideLottieOptions)({player:()=>y.e(9730).then(y.t.bind(y,89730,23))})],imports:[M.CommonModule,ha.LottieComponent]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Oi,{declarations:[Di],imports:[M.CommonModule,ha.LottieComponent],exports:[Di]})})();class Wt{constructor(e,t){this._domSanitizer=e,this._matIconRegistry=t}_register(e,t,n){const i=this._domSanitizer.bypassSecurityTrustHtml(t);n?this._matIconRegistry.addSvgIconLiteralInNamespace(n,e,i):this._matIconRegistry.addSvgIconLiteral(e,i)}addIcons(e,t){if(e){if(Array.isArray(e)){e.forEach(({name:n,icon:i})=>this._register(n,i,t));return}Object.entries(e).forEach(([n,i])=>this._register(n,i,t))}}static{this.\u0275fac=function(t){return new(t||Wt)(s.\u0275\u0275inject(Fe.DomSanitizer),s.\u0275\u0275inject(Z.MatIconRegistry))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Wt,factory:Wt.\u0275fac,providedIn:"root"})}}var S_=y(26828),M_=y.n(S_);const w_="crt-resize",x_=new s.InjectionToken("Represents the resize observer",{factory:()=>new(M_())(o=>{window.requestAnimationFrame(()=>{o.forEach(e=>{const t={width:e.target?.clientWidth||e.contentRect.width,height:e.target?.clientHeight||e.contentRect.height};e.target.dispatchEvent(new CustomEvent(w_,{detail:t}))})})}),providedIn:"root"});class pa{set crtResizableDisabled(e){this._resizeDisabled$.next(e)}get resized(){const e=this._resized.asObservable().pipe((0,d.filter)(r=>this._isElementSizeValid(r))),t=new l.BehaviorSubject(null),n=t.pipe((0,d.switchMap)(()=>e.pipe((0,d.take)(1)))),i=e.pipe((0,d.debounce)(()=>(0,l.timer)(this.delay)),(0,d.tap)(()=>t.next()));return(0,l.merge)(n,i).pipe((0,d.distinctUntilChanged)((r,a)=>this._isElementSizesEqual(r,a)))}constructor(e,t){this.elementRef=e,this._resizeObserver=t,this._resized=new s.EventEmitter,this._destroyed$=new l.Subject,this._resizeDisabled$=new l.BehaviorSubject(!1),this.delay=200}_isElementSizeValid(e){return e&&e.width>0&&e.height>0}_isElementSizesEqual(e,t){return e.width===t.width&&e.height===t.height}ngOnInit(){this._nativeElement=this.elementRef?.nativeElement,this._nativeElement&&this._resizeDisabled$.pipe((0,d.distinctUntilChanged)(),(0,d.takeUntil)(this._destroyed$)).subscribe(e=>{e?this._resizeObserver.unobserve(this._nativeElement):this._resizeObserver.observe(this._nativeElement)})}onResized(e){this._resizeDisabled$.value||this._resized.emit(e?.detail)}ngOnDestroy(){this._nativeElement&&this._resizeObserver.unobserve(this._nativeElement),this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||pa)(s.\u0275\u0275directiveInject(s.ElementRef),s.\u0275\u0275directiveInject(x_))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:pa,selectors:[["","crtResizable",""]],hostBindings:function(t,n){t&1&&s.\u0275\u0275listener("crt-resize",function(r){return n.onResized(r)})},inputs:{delay:"delay",crtResizableDisabled:"crtResizableDisabled"},outputs:{resized:"resized"},standalone:!0})}}const E_={macrosName:"ResourceString",macrosHandler:function(o,e){if(!o)throw new Error("Context is not defined");if(!o.Resources?.Strings)throw new Error("Context does not contain property Resources.Strings");const t=o.Resources.Strings[e[0]];return t instanceof Promise?(0,l.from)(t):(0,l.of)(t)}};function I_(o){return{macrosName:"ResourceString",macrosHandler:function(e,t){if(e?.strings){for(const n of t){const i=e.strings[n];if(i)return(0,l.of)(o.findLocalizableValue(i))}throw new Error(`Localized resource string not found. ${t}`)}if(e?.Strings){for(const n of t){const i=e.Strings[n];if(i)return(0,l.from)(i)}throw new Error(`Localized string in ViewModel metadata not found. ${t}`)}return E_.macrosHandler(e,t)}}}function A_(o=!1){return{macrosName:"DataSourceEntityName",macrosHandler:(e,t)=>{if(!e)throw new Error("Context is not defined");let n=t[0],i;if(o)e.constructor.name==="BaseViewModel"?i=e.dataSchemas?.[n]?.dataSourceConfig?.config?.entitySchemaName:i=e.modelConfig?.dataSources?.[n]?.config?.entitySchemaName;else{n||(n=e.modelConfig.primaryDataSourceName);const r=e.modelConfig.dataSources?.[n];if(!r)throw new Error(`DataSource '${n}' is not defined`);i=r.config.entitySchemaName}return(0,l.of)(i)}}}function P_(o,e=!1){return{macrosName:"MacrosTemplateString",macrosHandler:(t,n)=>{const i=n.join(", "),r=/\[#([^\]]*)#\]/.test(i);return e||!r?(0,l.of)(i):o.getTemplate(i)}}}const ma=new s.InjectionToken("MACROS_HANDLER");function Th(o){return o===null||typeof o!="object"?[]:Object.keys(o).filter(e=>o[e]instanceof Object).map(e=>Th(o[e]).map(t=>[e,...t])).reduce((e,t)=>[...e,...t],Object.keys(o).map(e=>[e]))}function Dh(o,e){return Object.keys(o).every(t=>Object.prototype.hasOwnProperty.call(e,t)?typeof o[t]=="object"?T_(o[t],e[t]):!0:!1)}function T_(o,e){return Dh(o,e)&&Dh(e,o)}function D_(o,e){const t=Array.isArray(e)?e:e.split(".");let n=o;for(const i of t)if(n instanceof Map)n=n.get(i);else if(n&&typeof n=="object")n=n[i];else return;return n}function ew(o){const e=JSON.stringify(o);let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);return t.toString(16)}class Ri{constructor(e,t,n){this.handlers=e,this._featureValues=t,this._applicationInfo=n}get _includeProcessedHandlers(){return!!this._featureValues?.IncludeProcessedMacrosHandlers}_findClosingBracket(e,t){let n=t,i=1;for(;i>0&&n<e.length;){const r=e[++n];r==="("?i++:r===")"&&i--}return n}_getMacroses(e){const t=new Array;let n=e.indexOf("#");for(;n>=0;){const i=e.indexOf("(",n);if(i<0)return t;const r=this._findClosingBracket(e,i),a=e.indexOf("#",r);if(a<0)return t;t.push({macrosName:e.substring(n+1,i),macrosArgs:e.substring(i+1,r),macrosBody:e.substring(n,a+1)}),n=e.indexOf("#",a+1)}return t}_processMacroses({macroses:e,macrosNameFilter:t,context:n,options:i,value:r}){let a={...r};const c=h=>!!(t&&t!==h&&t.split(",").indexOf(h)===-1);return(0,l.forkJoin)({...e.map(({macrosName:h,macrosArgs:p,macrosBody:m})=>{if(c(h))return(0,l.of)(null);const f=this.getHandler(h);return f?this.internalHandle(p,n,t,i).pipe((0,d.switchMap)(C=>{const S=f(n,`${C.value}`.split(",").map(w=>w.trim()));return(S instanceof l.Observable?S:(0,l.of)(S)).pipe((0,d.catchError)(w=>(this._applicationInfo.isDebugEnabled&&console.warn(w),(0,l.of)(m))),(0,d.tap)(w=>{const E=typeof w=="number"?w:w||"";a={isChanged:!0,value:a.value.replace(m,E)}}))}),(0,d.catchError)(C=>(i&&i.errorHandler?i.errorHandler(C):this._applicationInfo.isDebugEnabled&&console.warn(C),(0,l.of)(m)))):(0,l.of)(null)}),default:(0,l.of)(null)}).pipe((0,d.map)(()=>a))}_forEachStringInObject(e,t,n=[],i=[]){if(!(e instanceof Object))return;const r=c=>!n.includes(c),a=(c,h)=>{typeof c=="string"?t(i.concat(h),c):typeof c=="object"&&c!==null&&(i.push(h),this._forEachStringInObject(c,t,n,i),i.pop())};if(e instanceof Map)for(const c of Array.from(e.keys()).filter(r))a(e.get(c),c);else Object.keys(e).filter(r).forEach(c=>{a(e[c],c)})}_set(e,t,n){const i=t.slice(),r=i.pop(),a=i.length===0?e:D_(e,i);a&&(a[r]=n)}getHandler(e){return this.handlers.filter(t=>t.macrosName===e).pop()?.macrosHandler}internalHandle(e,t,n,i){const r={value:e,isChanged:!1};return(0,l.of)(r).pipe((0,d.switchMap)(c=>{if(typeof e!="string")return(0,l.of)(c);const h=this._getMacroses(e);return h.length?this._processMacroses({macroses:h,macrosNameFilter:n,context:t,options:i,value:r}):(0,l.of)(c)}))}handle(e,t){const n=(0,v.cloneDeep)(e);return(0,l.forkJoin)([...Th(n).map(i=>{const r=(0,v.get)(n,i);return this.internalHandle(r,t).pipe((0,d.tap)(({value:a})=>{(0,v.set)(n,i,a)}))}),(0,l.of)(null)]).pipe((0,d.map)(()=>n))}handleMarcos(...e){return this.handleMacros.call(this,...e)}handleResourceMacros(e,t,n){return this.handleMacros("MacrosTemplateString,ResourceString",(0,v.cloneDeep)(e),t,n)}handleMacros(e,t,n,i){const r=[(0,l.of)(null)];return this._forEachStringInObject(t,(a,c)=>{const h=this._getMacroses(c);if(!h.length)return;const p=this._processMacroses({macroses:h,context:n,options:i,macrosNameFilter:e,value:{isChanged:!1,value:c}}).pipe((0,d.tap)(m=>{m.isChanged!==!1&&(i?.setPropertyFn?i.setPropertyFn({source:t,keys:a,value:m.value}):this._set(t,a,m.value))}));r.push(p)},this._includeProcessedHandlers?[]:["__preprocessed"]),(0,l.forkJoin)(r).pipe((0,d.map)(()=>t))}static{this.\u0275fac=function(t){return new(t||Ri)(s.\u0275\u0275inject(ma),s.\u0275\u0275inject(Q,8),s.\u0275\u0275inject(ze))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ri,factory:Ri.\u0275fac})}}var ji;(function(o){o.string="Strings",o.image="Images"})(ji||(ji={}));const pr="Resources";class ki extends Array{constructor(e){super(),Object.setPrototypeOf(this,Object.create(ki.prototype)),Array.isArray(e)&&this._fillFromSource(e)}_fillFromSource(e){e.filter(t=>t?.cultureName!=null).forEach(t=>{this.setValueLocalizableString(t.cultureName,t.value)})}getValue(e){const t=this.getLocalizableString(e);return t?t.value:""}hasCultureValue(e,t=!1){const n=this.getLocalizableString(e);return t?(n?.value||null)!=null:n?.value!=null}getLocalizableString(e){return this.find(t=>t.cultureName===e)||null}setValueLocalizableString(e,t){const n=this.getLocalizableString(e);return n?n.value=t:this.push({cultureName:e,value:t}),this}setValues(e,t=!1){return e.forEach(n=>{this.hasCultureValue(n.cultureName)&&t||this.setValueLocalizableString(n.cultureName,n.value)}),this}clone(){return new ki(this)}}class Ni{constructor(e){this.userInfo=e,this._resourceMacrosRegExpPattern="(?<macrosBody>#ResourceString\\((?<macrosArgs>[^)]*)\\)#)",this._viewModelAttributeRegExpPattern=`\\$${pr}.${ji.string}.(?<macrosArgs>[\\S\\s]*)`,this._sysCultureName=this.userInfo.cultureInfo.sysCultureName,this._defCultureName=this.userInfo.defCultureInfo.sysCultureName}_getLczResource(e){const t={};return e.forEach(n=>t[n.cultureName]=n.value),t}_getResourceValueMatches(e){const t=new RegExp(this._resourceMacrosRegExpPattern,"g"),n=new RegExp(this._viewModelAttributeRegExpPattern,"g");let i=[...(e??"").matchAll(n)];return i.length||(i=[...(e??"").matchAll(t)]),i}_findStringPropertyResource(e,t){const{resourceName:n,useMacrosTemplate:i}=this.findResourcesName(e);if(n)return{path:t,resourceName:n,useMacrosTemplate:i}}_findArrayPropertyResources(e,t=""){return e.flatMap((n,i)=>this.findPropertyResources(n,t?`${t}.${i}`:`${i}`))}_findObjectPropertyResources(e,t=""){return Object.entries(e).flatMap(([n,i])=>this.findPropertyResources(i,t?`${t}.${n}`:n))}findLocalizableValue(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return null;let t;return Array.isArray(e)?t=e?.filter(n=>n.value).reduce((n,i)=>Object.assign(n,{[i.cultureName]:i.value}),{}):t=e,(t[this._sysCultureName]??t[this._defCultureName])?.toString()??null}findResourcesName(e){const n=this._getResourceValueMatches(e)[0]?.groups.macrosArgs,i=e?.startsWith("#MacrosTemplateString");return{resourceName:n,useMacrosTemplate:i}}findLocalizationFromResourceString(e,t,n=""){const{resourceName:i}=this.findResourcesName(e),r=i!==void 0&&t.strings[i];if(r){const h=Object.entries(r).map(([p,m])=>({cultureName:p,value:m}));return new ki(h)}const a=i===void 0&&e||n,c=this._sysCultureName||this._defCultureName;return new ki([{cultureName:c,value:a}])}findValueFromResource(e,t){const n=this.findLocalizationFromResourceString(e,t),i=this._getLczResource(n);return this.findLocalizableValue(i)}findViewModelResourceValue(e,t,n){var i=this;return(0,b.A)(function*(){const{resourceName:r}=i.findResourcesName(e);let a;return r&&(a=yield t.Strings[r]),a||n||e})()}findPropertyResources(e,t=""){return e?Array.isArray(e)?this._findArrayPropertyResources(e,t):typeof e=="object"?this._findObjectPropertyResources(e,t):typeof e=="string"?[this._findStringPropertyResource(e,t)].filter(Boolean):[]:[]}static{this.\u0275fac=function(t){return new(t||Ni)(s.\u0275\u0275inject(_t))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ni,factory:Ni.\u0275fac,providedIn:"root"})}}class mr{constructor(e){this._httpClient=e,this._serviceEndpoint="rest/MacrosHelperService"}static isMacros(e){return typeof e!="string"?!1:e?.startsWith("#")??!1}getTemplate(e,t){return this.getTemplateByEntity({textTemplate:e},t)}getTemplateByEntity(e,t){const n=`${this._serviceEndpoint}/GetTemplate`;return this._httpClient.post(n,{request:e}).pipe((0,d.map)(i=>{const r=i?.GetTemplateResult;return r?.success?t?r.textTemplate:r.textTemplate.replace(/\s?<.+?>(.+?)<(.+?)\/?(.+?)>/g,""):e.textTemplate}))}getMultiLanguageTemplate(e,t,n){const i=`${this._serviceEndpoint}/GetMultiLanguageTextTemplate`;return this._httpClient.post(i,{request:{entityId:e,entityName:t,templateId:n}}).pipe((0,d.map)(r=>r?.GetMultiLanguageTextTemplateResult))}static{this.\u0275fac=function(t){return new(t||mr)(s.\u0275\u0275inject(U.HttpClient))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:mr,factory:mr.\u0275fac,providedIn:"root"})}}const Zt=new s.InjectionToken("IS_DESIGN_TIME");class Vi{static{this.\u0275fac=function(t){return new(t||Vi)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Vi})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[Ri,{provide:ma,useFactory:I_,deps:[Ni],multi:!0},{provide:ma,useFactory:A_,deps:[[new s.Optional,Zt]],multi:!0},{provide:ma,useFactory:P_,deps:[mr,[new s.Optional,Zt]],multi:!0}],imports:[M.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Vi,{imports:[M.CommonModule]})})();class Li{constructor(e,t){this.caption="",e.addSvgIconLiteral("placeholder",t.bypassSecurityTrustHtml(y(49967)))}static{this.\u0275fac=function(t){return new(t||Li)(s.\u0275\u0275directiveInject(Z.MatIconRegistry),s.\u0275\u0275directiveInject(Fe.DomSanitizer))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Li,selectors:[["crt-view-element-placeholder"]],inputs:{caption:"caption"},decls:4,vars:1,consts:[[1,"placeholder-container"],["svgIcon","placeholder",1,"icon"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div",0),s.\u0275\u0275element(1,"mat-icon",1),s.\u0275\u0275elementStart(2,"span"),s.\u0275\u0275text(3),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(n.caption))},dependencies:[Z.MatIcon],styles:[".placeholder-container[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;align-content:center;justify-content:center;border-radius:8px;position:relative;overflow:hidden}.placeholder-container[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:100%;max-height:64px;width:72px;align-self:center}.placeholder-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;top:50%;left:8px;right:8px;transform:translateY(-50%);overflow:hidden;width:calc(100% - 16px);text-overflow:ellipsis}@supports (background: -webkit-named-image(i)){.placeholder-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:initial;height:initial}}"]})}}class Yt{static{this.\u0275fac=function(t){return new(t||Yt)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Yt})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[M.CommonModule,Z.MatIconModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Yt,{declarations:[Li],imports:[M.CommonModule,Z.MatIconModule],exports:[Li]})})();const O_=new s.InjectionToken("A factory of expression interpreter");var ue;(function(o){o.ChangeAttributeValue="change-attribute-value",o.ModelDataLoaded="model-data-loaded-event",o.BeforeModelLoad="before-model-load",o.LoadDefaultValues="load-default-values",o.StartLoadModelAttributes="start-load-model-attributes",o.FinishLoadModelAttributes="finish-load-model-attributes",o.ViewEvent="view-event"})(ue||(ue={}));function gr(o,e){return pl.apply(this,arguments)}function pl(){return pl=(0,b.A)(function*(o,e){const t=typeof e=="string"?e.split("."):e;let n=t.shift(),i=o;for(;n;)i=yield i[n],n=t.shift();return i}),pl.apply(this,arguments)}const Mt=Symbol("InternalViewModelInjector");var wt=y(59247),Y;(function(o){o.Add="add",o.Remove="remove",o.Move="move",o.Reload="reload"})(Y||(Y={}));var P;(function(o){o.Init="init",o.Create="create",o.Update="update",o.Copy="copy",o.Delete="delete",o.Unknown="unknown"})(P||(P={}));const ga=new s.InjectionToken("SCOPE_NAME"),R_=new s.InjectionToken("VIEW_EVENT_ZONE_NAME"),j_=new s.InjectionToken("INJECTION_CONTEXT");class We extends Array{constructor(...e){return super(),this._changed=new l.Subject,this._createdItems=[],this._deletedItems=[],this._itemsChanged=new l.Subject,this._itemAttributeChanged=new l.Subject,this._destroyed$=new l.Subject,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[],this._trackChanges=!0,this._isDestroyed=!1,typeof e[0]=="number"?new Array(e[0]):([this._viewModelGenerator,this._viewModelConfig={},this._model,this._host,this._hostAttributeName]=e,this._measurePerformanceService=this._host?.[Mt]?.get(q,null,{optional:!0}),this._featureValues=this._host?.[Mt]?.get(Q,{},{optional:!0})??{},this._ngZone=this._host?.[Mt]?.get(s.NgZone,null,{optional:!0}),Object.setPrototypeOf(this,Object.create(We.prototype)),this._subscribeItemsModelModesChanges(),this._subscribeItemsAttributesChanges(),new Proxy(this,{set:(t,n,i,r)=>{const a=t[n];if(t[n]=i,this._trackChanges){const c=n==="length"&&i!==a,h=!isNaN(parseInt(n));(c||h)&&this._onItemsChanged()}return!0}}))}get changed(){return this._changed.asObservable().pipe(Hm(this._ngZone),(0,d.takeUntil)(this._destroyed$))}get itemAttributeChanged(){return this._itemAttributeChanged.asObservable().pipe((0,d.takeUntil)(this._destroyed$))}get isChanged(){return this.getChangedItems().length>0}get formApiModel(){return this._formApiModel||this._updateFormApiModelValues({emitEvent:!1}),this._formApiModel}_isItemPrimaryAttributeEqual(e,t){return(0,b.A)(function*(){if(!e)return!1;const n=yield e[e.primaryAttributeName];return t.includes(n)})()}_getNewCallbacksMap(){return new Map([[Y.Add,[]],[Y.Remove,[]],[Y.Move,[]],[Y.Reload,[]]])}_insertItem(e,t){typeof t!="number"&&(t=this.length),t=Math.max(t,0),t=Math.min(t,this.length),this._triggerChangesAfter(()=>super.splice(t,0,e))}_generateItem(e){const t=()=>{const n=this._model?.createCollectionItemModel(P.Create),i=this._host?.[Mt]?s.Injector.create({providers:[{provide:ga,useValue:null}],parent:this._host?.[Mt]}):null,r={viewModelConfig:this._viewModelConfig,modelConfig:n?{primaryDataSourceName:n.name}:void 0,models:n?[n]:void 0,parentViewModel:this._host,businessRulesActive:e.businessRulesActive??!1},a=m=>{n?.name&&(m.dataSchemas[n.name]=this._host.dataSchemas[n.name])},c=m=>n?.name?m.create(n.name,e.initialModelValues).pipe((0,d.map)(()=>m)):(0,l.of)(m),h=m=>{Object.entries(e.initialAttributeValues??{}).forEach(([f,C])=>m[f]=C),m._markAsPristine(e.initialAttributeValues??{}),this._model?.childrenChange()},p=this._viewModelGenerator.generate(r,i).pipe((0,d.tap)(a),(0,d.switchMap)(c),(0,d.tap)(h));return(0,l.lastValueFrom)(p)};return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.generateItem",()=>t()):t()}_mergeItems(e,t){const n=()=>{const i=(e[0]||t[0])?.primaryAttributeName;for(const r of t){const a=e.findIndex(c=>{const h=c.attributes?.[i],p=r.attributes?.[i];return h&&h===p});a===-1?e.push(r):e.splice(a,1,r)}return e};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.mergeItems",()=>n()):n()}_triggerChangesAfter(e,t){this._trackChanges=!1;const n=e.call(this);return this._trackChanges=!0,this._isDestroyed||(this._onItemsChanged(),t&&this._executeChangesCallbacksWhenReady(t)),n}_executeChangesCallbacks(e){this._onCollectionChangeCallbacksMap.get(e.action).forEach(n=>{this._safeExecuteCallback(n,{...e,collection:[...this]},e.action)})}_executeChangesCallbacksWhenReady(e){Promise.resolve().then(()=>this._executeChangesCallbacks(e))}_onItemsChanged(){const e=this.map(t=>({item:t,itemModelMode:t?.getPrimaryModelMode?.()}));this._updateCollectionState(e,!0)}_subscribeItemsModelModesChanges(){this._itemsChanged.pipe((0,d.switchMap)(()=>this._getItemsModelModesChanges()),(0,d.tap)(e=>this._updateCollectionState([e],!1)),(0,d.takeUntil)(this._destroyed$)).subscribe()}_subscribeItemsAttributesChanges(){const e=t=>{this._onItemAttributesChangesCallbacks.forEach(n=>{try{n(t)}catch(i){console.error("An error occurred during execution of item attributes change callback:",i)}})};this._itemsChanged.pipe((0,d.switchMap)(()=>this._getItemsWithAttributesChanges()),(0,d.tap)(t=>e(t)),(0,d.tap)(()=>this._itemAttributeChanged.next()),(0,d.takeUntil)(this._destroyed$)).subscribe()}_getItemsWithAttributesChanges(){const e=t=>{const n=t.events$?.pipe((0,d.map)(i=>i.type===ue.ChangeAttributeValue&&!i.payload.silent));return t?.events$?n.pipe((0,d.map)(i=>i?t:null)):(0,l.of)(null)};return(0,l.merge)(...this.map(e)).pipe((0,d.filter)(Boolean))}_getItemsModelModesChanges(){const e=[...this,...this._deletedItems].map(t=>t?._getPrimaryModelModeChanges?.()?.pipe((0,d.map)(n=>({item:t,itemModelMode:n})))).filter(Boolean);return e.length?(0,l.merge)(...e):l.EMPTY}_updateCollectionState(e,t){this._trackChanges=!1;const n=e.map(i=>this._onItemModelModeChanged(i)).some(i=>!!i);this._trackChanges=!0,!(!t&&!n)&&(this._updateFormApiModelValues(),this._updateFormApiModelPristineState(),this._changed.next(),this._itemsChanged.next())}_onItemModelModeChanged(e){const{item:t,itemModelMode:n}=e;if(!t||n==null)return!1;switch(n){case P.Create:return this._onCreateItem(t);case P.Update:return this._onUpdateItem(t);case P.Delete:return this._onDeleteItem(t);default:return!1}}_onCreateItem(e){const t=this._deletedItems.indexOf(e);return t!==-1?(this._deletedItems.splice(t,1),!0):(this._createdItems.indexOf(e)===-1&&this._createdItems.push(e),!1)}_onUpdateItem(e){const t=this._createdItems.indexOf(e);if(t!==-1)return this._createdItems.splice(t,1),!1;const n=this._deletedItems.indexOf(e);if(n!==-1){const i=this._deletedItems.splice(n,1);super.push(...i)}return!0}_onDeleteItem(e){const t=this._createdItems.indexOf(e),n=this._deletedItems.indexOf(e);t!==-1?this._createdItems.splice(t,1):n===-1&&this._deletedItems.push(e);const i=this.indexOf(e);return i===-1?!1:(super.splice(i,1),this._executeChangesCallbacks({collection:[],affectedElements:[e],action:Y.Remove,index:i}),!0)}_updateFormApiModelValues(e){if(this._featureValues.DisableBaseViewModelCollectionOptimization){this._formApiModel??=new wt.FormArray([]),this._formApiModel.clear({emitEvent:!1}),this.filter(n=>n?.formApiModel).forEach(n=>{this._formApiModel.push(n.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity();return}if(!this._formApiModel||!this._formApiModel.length){const n=new wt.FormArray(this.filter(i=>i?.formApiModel)?.map(i=>i.formApiModel));this._formApiModel||(this._formApiModel=n),this._formApiModel.length||this._host?.formApiModel?.setControl(this._hostAttributeName,n)}else this._formApiModel.clear({emitEvent:!1}),this.filter(n=>n?.formApiModel).forEach(n=>{this._formApiModel.push(n.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity()}_updateFormApiModelPristineState(){const e=this.formApiModel.pristine,t=this.some(n=>n?.formApiModel?.dirty);if(t&&e){this.formApiModel.markAsDirty();return}!t&&!e&&this.formApiModel.markAsPristine()}_reload(e){const t=()=>{for(const r of[...this._deletedItems,...this])this.removeChildModel(r,{triggerNotification:!1});this._model?.childrenChange();const n=[],i=r=>n.push(r.destroy());return this._createdItems.forEach(i),this._createdItems.splice(0,this._createdItems.length),this._deletedItems.forEach(i),this._deletedItems.splice(0,this._deletedItems.length),this.forEach(i),this.splice(0,this.length,...e),(0,l.forkJoin)(n).pipe((0,d.defaultIfEmpty)(void 0),(0,d.map)(()=>{}))};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.reload",()=>t()):t()}_unregisterCallbackByAction(e,t){if(!this._onCollectionChangeCallbacksMap.get(e).find(r=>r===t))return!1;const i=this._onCollectionChangeCallbacksMap.get(e).filter(r=>r!==t);return this._onCollectionChangeCallbacksMap.set(e,i),!0}_safeExecuteCallback(e,t,n){const i=()=>{try{e(t)}catch(r){console.error(`An error occurred during execution of collection ${n} callback:`,r)}};if(this._ngZone){this._ngZone.run(i);return}i()}registerOnCollectionChangeCallback(e,t){const n=this._onCollectionChangeCallbacksMap.get(t);if(t&&!n)throw new Error(`Action type ${t} is not supported. Please use one of: ${Object.values(Y).join(", ")} or empty value for all actions`);if(t){const i=[...n,e];this._onCollectionChangeCallbacksMap.set(t,i);return}this._onCollectionChangeCallbacksMap.forEach((i,r)=>{const a=[...i,e];this._onCollectionChangeCallbacksMap.set(r,a)})}unregisterOnCollectionChangeCallback(e,t){if(t){if(!this._unregisterCallbackByAction(t,e))throw new Error("The provided callback is not registered.");return}if(![...this._onCollectionChangeCallbacksMap.keys()].map(i=>this._unregisterCallbackByAction(i,e)).some(i=>i))throw new Error("The provided callback is not registered.")}registerOnItemAttributesChangesCallback(e){this._onItemAttributesChangesCallbacks.push(e)}unregisterOnItemAttributesChangesCallback(e){if(!this._onItemAttributesChangesCallbacks.includes(e))throw new Error("The provided callback is not registered.");this._onItemAttributesChangesCallbacks=this._onItemAttributesChangesCallbacks.filter(t=>t!==e)}removeChildModel(e,t){const n=t?.triggerNotification??!0,i=this._model?.name,r=e.getModelByName(i);this._model?.removeChild(r),n&&this._model?.childrenChange()}copyWithin(e,t,n){const i={collection:[],affectedElements:this.slice(t,n),action:Y.Move,index:e};return this._triggerChangesAfter(()=>super.copyWithin(e,t,n),i)}fill(e,t,n){const i=n??this.length-1-(t??0),r={collection:[],affectedElements:new Array(i).fill(e),action:Y.Add,index:t};return this._triggerChangesAfter(()=>super.fill(e,t,n),r)}push(...e){const t={collection:[],affectedElements:[...e],action:Y.Add,index:this.length};return this._triggerChangesAfter(()=>super.push(...e),t)}reverse(){const e={collection:[],affectedElements:this.slice(),action:Y.Add,index:0};return this._triggerChangesAfter(()=>super.reverse(),e)}shift(){const e={collection:[],affectedElements:this.length?[this[0]]:[],action:Y.Remove,index:0};return this._triggerChangesAfter(()=>super.shift(),e)}sort(e){const t={collection:[],affectedElements:this.slice(),action:Y.Move};return this._triggerChangesAfter(()=>super.sort(e),t)}splice(e,t,...n){const i=typeof t=="number"?t:this.length-e,r=i>0?this.slice(e,e+i):[],a=r.length>0,c={collection:[],affectedElements:a?r:[...n],action:a?Y.Remove:Y.Add,index:e};return this._triggerChangesAfter(()=>super.splice(e,t,...n),c)}pop(){const e=this.length?this.length-1:void 0,t={collection:[],affectedElements:e!==void 0?[this[e]]:[],action:Y.Remove,index:e};return this._triggerChangesAfter(()=>super.pop(),t)}unshift(...e){const t={collection:[],affectedElements:[...e],action:Y.Add,index:0};return this._triggerChangesAfter(()=>super.unshift(...e),t)}getChangedItems(){const e=[...this._deletedItems];return this.filter(n=>{if(n.attributes.IsChanged)return!0;const i=n.getPrimaryModelMode();return i&&i!==P.Update}).concat(e)}createItem(e){var t=this;const n=function(){var i=(0,b.A)(function*(){const r=yield t._generateItem(e||{});t._insertItem(r,e?.index);const a={collection:[...t],affectedElements:[r],action:Y.Add,index:t.indexOf(r)};return t._executeChangesCallbacksWhenReady(a),r});return function(){return i.apply(this,arguments)}}();return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.createItem",()=>n()):n()}getPrimaryAttributeValues(){return Promise.all(this.map(e=>e?.[e?.primaryAttributeName]))}findByPrimaryAttribute(e){var t=this;return(0,b.A)(function*(){for(const n of t)if(yield t._isItemPrimaryAttributeEqual(n,[e]))return n})()}filterByPrimaryAttributes(e){var t=this;return(0,b.A)(function*(){const n=[];for(const i of t)(yield t._isItemPrimaryAttributeEqual(i,e))&&n.push(i);return n})()}merge(e){const t=()=>{this._triggerChangesAfter(()=>{const n=this._mergeItems([...this],e),i=n.length>this.length;super.splice(0,this.length,...n),this._createdItems.splice(0,this._createdItems.length),e instanceof We&&this._mergeItems(this._deletedItems,e._deletedItems);const r={collection:[...this],affectedElements:e,action:i?Y.Add:Y.Reload};this._executeChangesCallbacksWhenReady(r)})};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.merge",()=>t()):t()}reload(e,t=Y.Reload){const n=[...this],i={collection:[],affectedElements:t===Y.Reload?[...e]:n,action:t};return(0,l.lastValueFrom)(this._reload(e).pipe((0,d.finalize)(()=>this._executeChangesCallbacksWhenReady(i))))}remove(e){const[t,n]=typeof e=="number"?[e,this[e]]:[this.indexOf(e),e];if(t>=0&&t<this.length){this.splice(t,1);const i={collection:[],affectedElements:[n],action:Y.Remove,index:t};return this._executeChangesCallbacksWhenReady(i),(0,l.lastValueFrom)(n.destroy())}return Promise.resolve()}clear(){return this.reload([],Y.Remove)}moveTo(e,t){if(t>=this.length)throw new Zo("Target index cannot be greater than collection length");const n=this.indexOf(e);if(n===t||t<0)return;const i={collection:[],affectedElements:[e],action:Y.Move,index:t};this._triggerChangesAfter(()=>super.splice(t,0,super.splice(n,1)[0]),i)}destroy(){this._isDestroyed=!0,this._host=null,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[];const e=this._reload([]);return this._formApiModel.clear({emitEvent:!1}),this._itemAttributeChanged.complete(),this._itemsChanged.complete(),this._destroyed$.next(),this._destroyed$.complete(),(0,l.lastValueFrom)(e)}}function k_(o,e){return!o?.length||!e?.length?null:o[e.length-1]??null}function fr(o){for(;o.parent;)o=o.parent;return o}function ml(o,e){const t=o.split(".").slice(0,-1),n=Oh(e),i=n.map(r=>r.viewModel$.pipe((0,d.take)(1)));return(0,l.forkJoin)(i).pipe((0,d.map)(r=>({viewModels:r,rootViewModel:k_(r,n)})),(0,d.filter)(({rootViewModel:r})=>!r?._destroyed),(0,d.map)(({viewModels:r,rootViewModel:a})=>{const c=[],p=!a?.[Mt].get(Q,null)?.["ViewModel.DisableFixedNestedCollectionPathCheck"],m=p?N_:V_;let f=n.length-1,C=[];for(const S of t){c.push(S);const w=p?a:r[f];if(w&&m(w,c)&&(C=[...c],f--,f<0))return null}return{context:n[f],contextPath:C.join(".")}}))}function Oh(o){const e=[o];return o.parent&&e.push(...Oh(o.parent)),e}function N_(o,e){let t=o._attributeConfigs,n=null;for(const i of e){if(n=t?.[i],!n)return!1;t=n.viewModelConfig?.attributes}return n.isCollection}function V_(o,e){let t=o;for(const n of e)t=t?.attributes?t.attributes[n]:t?.[n];return t instanceof We}function L_(o){return(o?.parameters??[]).map(e=>Rh(e)).flat()}function Rh(o){const e=[];if(o.attributePath&&e.push(o.attributePath),o.attributeProperty){const n=o.attributeProperty.split(":").shift();e.push(n)}const t=(o.converters??[]).map(n=>L_(n)).flat();return e.push(...t),e.filter(n=>!isEmpty(n))}function Ze(o){return typeof o=="string"&&o.startsWith("$")&&o.length>1}function fa(o){return Ze(o)&&/^\$(\w+\.)*\w+$/.test(o)}function jh(o){return typeof o=="string"&&o.startsWith(`$${pr}.${ji.string}.`)}function kh(o){return/^\$(?<AttributeName>.+):(?<PropertyName>.+?)(?=(?==(?<defValue>.*))|(?=$))/.test(o)}function gl(o){return typeof o=="string"&&/@event\b/.test(o)}function B_(o){return typeof o=="string"&&/^([^\d.][\w.]+)(\s*:\s*[\w'".$]+)+.*$/.test(o)}function Nh(o){return!!o.match(/^'.*'$/)}function Vh(o){return!isNaN(Number(o))&&!isNaN(parseFloat(o))}function Lh(o){return o==="true"||o==="false"}function F_(o){return Nh(o)||Vh(o)||Lh(o)}function fl(o){const e={expression:o},t=o.split("|").map(n=>n.trim());if(Ze(o)){const n=t.shift();e.binding=n,jh(n)&&(e.resourcePath=n.substring(1)),kh(n)&&(e.attributeProperty=n.substring(1)),fa(n)&&(e.attributePath=n.substring(1))}else if(gl(o)){const n=t.shift();e.event=n.substring(7)}else if(!B_(o))return e.value=o,e;return e.converters=t.map(n=>{const[i,...r]=n.split(":").map(a=>a.trim());return{type:i,parameters:r.map(a=>fl(a))}}),e}function tw(o){if(!isString(o)||isEmpty(o))return[];const e=fl(o);return Rh(e)}function nw(o){return Ze(o)?o.slice(1):o}function _l(o,e){if(!o)return e;if(!e.startsWith(o))throw new Error(`Attribute path '${e}' should start with '${o}'`);return e.substring(o.length+1)}function z_(o){if(!Ze(o))throw new Error(`'${o}' is not binding expression`);const e=o.indexOf("|");return e>-1&&(o=o.substring(0,e).trimEnd()),o.substring(1)}function Bh(o,e){return yl.apply(this,arguments)}function yl(){return yl=(0,b.A)(function*(o,e){const t=e.match(/^(?:(?<attributeHostPath>.+)\.)?(?<attributeName>[^.]+)$/),{attributeHostPath:n,attributeName:i}=t.groups,r=n?yield gr(o,n):o;return{attributeName:i,attributeHost:r}}),yl.apply(this,arguments)}class Fh{getAttributeValuesStream(e,t){return e?e.events$.pipe((0,d.filter)(n=>n.type===ue.ChangeAttributeValue),(0,d.filter)(n=>n?.payload?.attributeName===t),(0,d.switchMap)(n=>t in e?Promise.resolve(e[t]):Promise.resolve(n.payload.value)),(0,d.share)()):(0,l.of)(null)}getAttributeInitialValueStream(e,t,n){return e?(0,l.from)(gr(e,t)).pipe((0,d.takeUntil)(n)):(0,l.of)(null)}getAttributeLocationChanges(e,t){return ml(e,t).pipe((0,d.tap)(n=>{if(!n)throw new Error(`Target binding context for attribute "${e} was not found"`)}),(0,d.switchMap)(({context:n,contextPath:i})=>(0,l.combineLatest)([n.viewModel$,(0,l.of)(_l(i,e))])),(0,d.switchMap)(([n,i])=>n?Bh(n,i):(0,l.of)({attributeName:void 0,attributeHost:void 0})))}evaluate(e,t){const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,d.switchMap)(i=>this.getAttributeValueChanges(i)))}}class lt extends Fh{getAttributeValueChanges({attributeHost:e,attributeName:t}){const n=this.getAttributeValuesStream(e,t),i=this.getAttributeInitialValueStream(e,t,n);return(0,l.merge)(i,n)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(lt)))(n||lt)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac})}}class Nn extends lt{removeConvertersFromExpression(e){const t=e.indexOf("|");return t===-1?e:(console.warn(`Cannot use converters in control binding expression: ${e}`),e.substring(0,t).trimEnd())}evaluate(e,t){e=this.removeConvertersFromExpression(e);const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,d.map)(({attributeHost:i,attributeName:r})=>i?i.getAttributeControl(r):new wt.FormControl(null)))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Nn)))(n||Nn)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Nn,factory:Nn.\u0275fac})}}const U_="DisableAttributeDeactivationUntilBRulesExecution";class Bi extends Fh{constructor(e){super(),this._featureService=e,this._readonlyProperties=["readonly","disabled"]}getAttributeValueChangesInHybridMode(e,t,n,i){const r=e.getControl(t),a=i.slice(1);return this._getValuesStream(e,t,n,()=>{const c=this.getAttributeValuesStream(e,a).pipe((0,d.tap)(m=>r.setPropertyValue(n,m))),h=this.getAttributeValuesStream(e,`${t}:${n}`).pipe((0,d.filter)(()=>{const m=Object.getOwnPropertyDescriptor(e,a),f=!!m?.get,C=!!m?.set;return!(f&&!C)}),(0,d.tap)(m=>e[a]=m)),p=(0,l.from)(gr(e,a)).pipe((0,d.tap)(m=>r.setPropertyValue(n,m,!0)),(0,d.takeUntil)(c));return(0,l.merge)(p,c,h)})}_getDefaultValue(e){if(!e)return null;try{return JSON.parse(e)}catch{return e}}_getValuesStream(e,t,n,i){return this._readonlyProperties.includes(n)?(0,l.forkJoin)({disableAttributeDeactivation:this._featureService.getFeatureState(U_),hasBRulesAffectingAttribute:e._getIsAffectedByBusinessRules({name:t})}).pipe((0,d.switchMap)(({disableAttributeDeactivation:r,hasBRulesAffectingAttribute:a})=>r||a!==!0?i():e._businessRulesActivated$.pipe((0,d.switchMap)(c=>c?i():(0,l.of)(!0))))):i()}getAttributeValueChanges(e){const{attributeHost:t}=e;if(!t)return(0,l.of)(null);const[n,i]=e.attributeName.split(":"),[r,a]=i.split("="),c=t.getControl(n),h=this._getDefaultValue(a);if(typeof h=="string"&&h?.startsWith("$"))return this.getAttributeValueChangesInHybridMode(t,n,r,h);if(h!=null){const p=c.getPropertyByName(r,!0);p.hasInitialValue||p.setInitialValue(h)}return this._getValuesStream(t,n,r,()=>{const p=this.getAttributeValuesStream(t,`${n}:${r}`),m=(0,l.of)(c.getPropertyValue(r)).pipe((0,d.filter)(f=>f!=null),(0,d.takeUntil)(p));return(0,l.merge)(m,p)})}static{this.\u0275fac=function(t){return new(t||Bi)(s.\u0275\u0275inject(ia))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Bi,factory:Bi.\u0275fac})}}class Fi{evaluate(e,t){const n=e.slice(1);return fr(t).viewModel$.pipe((0,d.switchMap)(i=>i?gr(i,n):(0,l.of)(null)))}static{this.\u0275fac=function(t){return new(t||Fi)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Fi,factory:Fi.\u0275fac})}}class _r{static{this.\u0275fac=function(t){return new(t||_r)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:_r,factory:_r.\u0275fac})}}function zi(o,e){if(o.split(".").length<2)throw new Error(`Error when register ${o}. Type property should have format "VendorPrefix.${e}"`)}function iw(o,e){return zi(o,e)}function $_(o){const[e,t]=o.split("."),n=zh(t);if(!e||n!==t)throw new Error(`Error when register ${o}. Type property should have Pascal case, e.g. ${e+"."+n}. The first letter of each word in a compound word should be capitalized`)}function Cl(o){const[e,t]=o.split("."),n=zh(t);if(e.toLowerCase()==="crt"&&n!==t)throw new Error(`Error when register ${o}. Type property should have Pascal case, e.g. ${e+"."+n}. The first letter of each word in a compound word should be capitalized`)}function zh(o){return(0,v.upperFirst)((0,v.camelCase)(o))}function sw(o,e){if(!e)throw new Error(`Error when resolve ${o}. Type was not registered.`)}function Uh(o,e,t){if(t.has(o)&&!(0,v.isEqual)(t.get(o),e))throw new Error(`Error when register ${o}. Element with this type has already exist`)}class $h extends qs{static{this.registryKey="ConverterRegistry"}static has(e){return this.store.typeInfos.has(e)}static find(e){return this.store.typeInfos.get(e)}static get(e){const t=this.find(e);if(!t)throw new Error(`'${e}' converter doesn't exist`);return t}static register(e){zi(e.type,"ConverterTypeName"),Cl(e.type);const t=this.find(e.type);this.store.typeInfos.set(e.type,{...t??{},...e})}static clear(){this.store.typeInfos.clear()}}class yr{constructor(){this._converterRegistry=$h,this._injector=(0,s.inject)(s.Injector)}get(e,t){return this._converterRegistry.get(e).instantiate(t)}register(e,t){throw new Error("NotImplemented")}clear(){this._converterRegistry.clear()}static{this.\u0275fac=function(t){return new(t||yr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:yr,factory:yr.\u0275fac,providedIn:"root"})}}var de;(function(o){o.LoadNext="loadNext",o.Load="load",o.Reload="reload"})(de||(de={}));var j;(function(o){o.PrimaryColumnValue="primaryColumnValue",o.ColumnValue="columnValue",o.Filter="filter",o.PrimaryDisplayValueFilter="primaryDisplayValueFilter",o.Empty="empty",o.Never="never"})(j||(j={}));var ut;(function(o){o.ViewElement="viewElement",o.Page="page"})(ut||(ut={}));var xt;(function(o){o.Model="Model",o.ViewModel="ViewModel"})(xt||(xt={}));var Kt;(function(o){o.Unknown="Unknown",o.Init="Init",o.Create="Create",o.Copy="Copy",o.Update="Update"})(Kt||(Kt={}));function G_(o,e){return!!e?.find(n=>!n.scopeId&&n.triggers.find(i=>i.name===o.name))}function H_(o,e){return!!e?.find(n=>n.scopeName===o.scopeName&&n.triggers?.find(i=>i.name===o.name))}function W_(o,e,t){if(e.scopeName===o){if(G_(e,t))return!1}else if(H_(e,t))return!1;return!0}function _a(o,e){return o===e||Gh(o)&&Gh(e)}function Gh(o){return!o||o==="null"}class Hh{constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.enabled=!0,this.uId=e?.uId||L(),e&&(this.enabled=e.enabled)}toMetadata(){return{typeName:this.typeName,uId:this.uId,enabled:this.enabled}}getTypeName(){return this.typeName}getApplicability(){return[]}isValid(){return!0}onDataSourceAttributeNameChanged(e,t,n){}isAttributeUsed(e,t){return!1}getAffectedItems(){return[]}getRequiredItems(){return[]}hasScopeAttributes(e){return!1}}const Z_="businessRuleActionDesignerType";function Ue(o){return function(e){Reflect.defineMetadata(Z_,o,e)}}var Vn;(function(o){o.Const="Const",o.SysValue="SysValue",o.SysSetting="SysSetting",o.AttributeValue="AttributeValue",o.AttributeProperty="AttributeProperty",o.Formula="Formula"})(Vn||(Vn={}));class Ln{get dataValueTypeName(){return this._dataValueTypeName}set dataValueTypeName(e){this._dataValueTypeName=e}get isLookup(){return this.dataValueTypeName===Gc[_.Lookup].name}get referenceSchemaName(){return this._referenceSchemaName}set referenceSchemaName(e){this._referenceSchemaName!==e&&(this._referenceSchemaName=e)}constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleExpression",this._dataValueTypeName="",this._referenceSchemaName="",this.type=Vn.Const,this.uId=e?.uId||L(),e&&(this._dataValueTypeName=e.dataValueTypeName??"",this.type=e.type||this.type,this._referenceSchemaName=e.referenceSchemaName??"")}toMetadata(){return{typeName:this.typeName,uId:this.uId,type:this.type,dataValueTypeName:this.dataValueTypeName,referenceSchemaName:this.referenceSchemaName}}copy(){return new Ln({...this.toMetadata(),uId:L()})}isValid(){return!!this.uId}onDataSourceAttributeNameChanged(e,t,n){}getAffectedItem(){return null}clear(){throw new Error(`clear not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}setValue(e){throw new Error(`setValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}getValue(){throw new Error(`getValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isEmpty(){throw new Error(`isEmpty not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isAttributeUsed(e,t){return!1}hasScopeAttributes(e){return!1}}class ya{static{this._expressionsTypes=new Map}static register(e,t){this._expressionsTypes.set(e,t)}static _getExpressionType(e){return this._expressionsTypes.get(e)??null}get(e){if(!e)return new Ln;const t=ya._getExpressionType(e.typeName);return t?new t(e):new Ln(e)}}function bl(o){return function(e){ya.register(o.typeName,e)}}var vl;let Sl=vl=class extends Ln{get displayValue(){return this._displayValue}set displayValue(e){this._displayValue=e}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression",this._displayValue="",this.path="",this.scopeId="",this.type=Vn.AttributeValue,e&&(this.path=e.path,this.scopeId=e.scopeId==="null"?"":e.scopeId)}toMetadata(){return{...super.toMetadata(),path:this.path,scopeId:this.scopeId}}copy(){return new vl({...this.toMetadata(),uId:L()})}isValid(){return super.isValid()&&!!this.path}onDataSourceAttributeNameChanged(e,t,n){this.scopeId===e&&this.path===t&&(this.path=n)}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t&&_a(this.scopeId,e)}hasScopeAttributes(e){return _a(this.scopeId,e)}isEmpty(){return!this.path}getValue(){return{value:this.path,displayValue:this.displayValue}}};Sl=vl=(0,u.__decorate)([bl({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression"}),(0,u.__metadata)("design:paramtypes",[Object])],Sl);var Ca;let Jt=Ca=class extends Hh{constructor(e){super(e),this._expressionFactory=new ya,this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.executorName="",e&&(this.executorName=e.executorName,this.expression=new Sl(e.expression),e.value&&(this.value=this._expressionFactory.get(e.value)))}getExpressionAffectedItems(){const e=this.expression?.getAffectedItem()??null;return e?[e]:[]}toMetadata(){return{...super.toMetadata(),executorName:this.executorName,expression:this.expression?.toMetadata(),value:this.value?.toMetadata()}}clone(){return new Ca(this.toMetadata())}copy(){const e=new Ca({...this.toMetadata(),uId:L()});return e.expression=this.expression?.copy(),e.value=this.value?.copy(),e}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();return t?[{path:t}]:[]}isValid(){return super.isValid()&&!!this.expression?.isValid()&&!!this.value?.isValid()}getAffectedItems(){const e=this.getExpressionAffectedItems();return[...super.getAffectedItems(),...e]}};Jt=Ca=(0,u.__decorate)([Ue("BusinessRuleDesignAction"),(0,u.__metadata)("design:paramtypes",[Object])],Jt);class Y_ extends Hh{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetProperty"}}class Ui extends Y_{constructor(e){super(e),this.items=[],e&&(Array.isArray(e.items)?this.items=e.items:this.items=e.items?.length>0?e.items.split(","):[])}_getAffectedItems(){return(this.items??[]).map(t=>({name:t}))}toMetadata(){return{...super.toMetadata(),items:this.items?.length>0?this.items.join(","):""}}getApplicability(){return this.isValid()?this.items.map(e=>({path:e})):[]}isValid(){return super.isValid()&&this.items?.length>0}getAffectedItems(){return[...super.getAffectedItems(),...this._getAffectedItems()]}isAttributeUsed(e,t){return this.items.includes(t)}}var ba;const K_="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement";let Ml=ba=class extends Ui{constructor(){super(...arguments),this.typeName=K_}clone(){return new ba(this.toMetadata())}copy(){return new ba({...this.toMetadata(),uId:L()})}};Ml=ba=(0,u.__decorate)([Ue("BusinessRuleEditableElementDesignAction")],Ml);var wl;let va=wl=class extends Ln{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression",this.path="",this.filterExpression="",e&&(this.path=e.path,this.filterExpression=e.filterExpression==="null"?"":e.filterExpression)}toMetadata(){return{...super.toMetadata(),path:this.path,filterExpression:this.filterExpression}}copy(){return new wl({...this.toMetadata(),uId:L()})}isValid(){return super.isValid()&&!!this.path&&!!this.filterExpression}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t}hasScopeAttributes(e){return!1}};va=wl=(0,u.__decorate)([bl({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression"}),(0,u.__metadata)("design:paramtypes",[Object])],va);var Sa;let xl=Sa=class extends Jt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup",this.clearValue=!1,this.populateValue=!1,e?(this.clearValue=e.clearValue??!1,this.populateValue=e.populateValue??!1):(this.clearValue=!0,this.populateValue=!0),this._processMetadata(e)}_isOldMetadataFormat(e){const t=!!e.expression?.path&&e.expression.path!=="null",n=e.value,i=!!n?.value&&n.value!=="null";return t&&i}_convertOldMetadata(e){const t={...e},n=e.expression?.path||"",r=e.value?.value,a={path:r,filterExpression:""},c={path:n,filterExpression:""};if(r.includes(".")){const[h,...p]=r.split(".");a.path=h,a.filterExpression=p.join(".")}return{...t,leftExpression:a,rightExpression:c}}_processMetadata(e){e&&(this._isOldMetadataFormat(e)&&(e=this._convertOldMetadata(e)),delete this.expression,delete this.value,this.leftExpression=new va(e?.leftExpression),this.rightExpression=new va(e?.rightExpression))}toMetadata(){return{...super.toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue}}clone(){return new Sa({...this.toMetadata()})}copy(){return new Sa({...super.copy().toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue})}getApplicability(){return this.leftExpression?.path?[{path:this.leftExpression.path}]:[]}isValid(){return!!this.leftExpression?.isValid()&&!!this.rightExpression?.path}getAffectedItems(){const e=this.leftExpression?.getAffectedItem()??null,t=[...super.getAffectedItems()];return e&&t.push(e),t}getRequiredItems(){return[this.rightExpression?.getAffectedItem()].filter(e=>e)}isAttributeUsed(e,t){return this.leftExpression.isAttributeUsed(e,t)||this.rightExpression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.leftExpression.hasScopeAttributes(e)||this.rightExpression.hasScopeAttributes(e)}};xl=Sa=(0,u.__decorate)([Ue("BusinessRuleFilterLookupAction"),(0,u.__metadata)("design:paramtypes",[Object])],xl);var Ma;let El=Ma=class extends Ui{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"}clone(){return new Ma(this.toMetadata())}copy(){return new Ma({...this.toMetadata(),uId:L()})}};El=Ma=(0,u.__decorate)([Ue("BusinessRuleHideElementDesignAction")],El);var wa;const Wh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionOptionalElement";let Il=wa=class extends Ui{constructor(){super(...arguments),this.typeName=Wh}clone(){return new wa(this.toMetadata())}copy(){return new wa({...this.toMetadata(),uId:L()})}};Il=wa=(0,u.__decorate)([Ue("BusinessRuleOptionalElementDesignAction")],Il);var xa;const J_="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement";let Al=xa=class extends Ui{constructor(){super(...arguments),this.typeName=J_}clone(){return new xa(this.toMetadata())}copy(){return new xa({...this.toMetadata(),uId:L()})}};Al=xa=(0,u.__decorate)([Ue("BusinessRuleReadOnlyElementDesignAction")],Al);var Ea;const Zh="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionRequiredElement";let Pl=Ea=class extends Ui{constructor(){super(...arguments),this.typeName=Zh}clone(){return new Ea(this.toMetadata())}copy(){return new Ea({...this.toMetadata(),uId:L()})}};Pl=Ea=(0,u.__decorate)([Ue("BusinessRuleRequiredElementDesignAction")],Pl);const q_=Symbol("CreateModelFrom");class qt extends sa{constructor(e){super(),this.requestType="crt.ModelGenerator",this._crtModel=e}static get instance(){return this._instance||(this._instance=new qt),this._instance}get name(){return this._crtModel?.name}static[q_](e){return new qt(e)}static create(e){var t=this;return(0,b.A)(function*(){const n=yield t.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},"");return new qt(n)})()}getSchema(){return this._crtModel._getAsyncResult(this._crtModel.getSchema())}load(e){return e?.loadOptions&&!e?.options&&(e.options=e.loadOptions),this._crtModel._getAsyncResult(this._crtModel.load(e))}insert(e){return this._crtModel._getAsyncResult(this._crtModel.insert(e))}update(e,t){var n=this;return(0,b.A)(function*(){const i=Object.keys(e);if(i.length){const a=(yield n.getSchema()).primaryAttributeName;i.filter(c=>c!==a).forEach(c=>n._crtModel.attributeChanged(c))}return n._crtModel._getAsyncResult(n._crtModel.update(e,t))})()}copy(e,t={}){return this._crtModel._getAsyncResult(this._crtModel.copy(e,t))}create(e={}){return this._crtModel._getAsyncResult(this._crtModel.create(e))}delete(e){return this._crtModel._getAsyncResult(this._crtModel.delete(e))}canSave(e){return this._crtModel._getAsyncResult(this._crtModel.canSave(e))}canDelete(e){return this._crtModel._getAsyncResult(this._crtModel.canDelete(e))}insertInTransaction(e,t){return this._crtModel.insertInTransaction(e,t)}updateInTransaction(e,t,n){return this._crtModel.updateInTransaction(e,t,n)}deleteInTransaction(e,t){return this._crtModel.deleteInTransaction(e,t)}}(0,u.__decorate)([ot({methodName:"generateOne"}),(0,u.__metadata)("design:type",Function)],qt.prototype,"_create",void 0);class X_{static _getPrimaryDisplayAttributeName(e){return(0,b.A)(function*(){return(yield e.getSchema()).primaryDisplayAttributeName})()}static getLookupValue(e,t){var n=this;return(0,b.A)(function*(){const i=yield qt.create(e),r=yield i.getSchema(),a=[r.primaryAttributeName,r.primaryDisplayAttributeName];r.primaryColorAttributeName&&a.push(r.primaryColorAttributeName);const c=yield i.load({parameters:[{type:j.PrimaryColumnValue,value:t}],attributes:a});if(!c||c.length===0)throw new Error(`Can't find value for '${t}'`);if(c.length>1)throw new Error(`Load more than 1 data row for '${t}'`);const h=c[0],p=yield n._getPrimaryDisplayAttributeName(i),m={value:t,displayValue:h[p]};return r.primaryColorAttributeName&&(m.primaryColorValue=h[r.primaryColorAttributeName]),m})()}}var Tl;let Dl=Tl=class extends Ln{get value(){return this._value}set value(e){this._value!==e&&(this._displayValueInitialized=!1,this._value=e)}get referenceSchemaName(){return super.referenceSchemaName}set referenceSchemaName(e){this.referenceSchemaName!==e&&(super.referenceSchemaName=e,this._displayValueInitialized=!1)}get displayValue(){return this.isLookup&&this.referenceSchemaName?this._displayValueInitialized?this._displayValue:null:(this._displayValue=this.value,this._displayValueInitialized=!0,this._displayValue)}set displayValue(e){this._displayValue=e??"",this._displayValueInitialized=e!=null}get dataValueTypeName(){return super.dataValueTypeName}set dataValueTypeName(e){this.dataValueTypeName!==e&&(super.dataValueTypeName=e,this._displayValueInitialized=!1)}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression",this._value="",this._displayValue="",this._displayValueInitialized=!1,e&&(this._value=e.value)}initDisplayValue(){var e=this;return(0,b.A)(function*(){if(e._displayValueInitialized)return Promise.resolve(e._displayValue);if(e.isLookup&&e.referenceSchemaName&&e._value){const t=yield X_.getLookupValue(e.referenceSchemaName,e._value);e._displayValue=t.displayValue}else e._displayValue=e.value;return e._displayValueInitialized=!0,Promise.resolve(e._displayValue)})()}toMetadata(){return{...super.toMetadata(),value:this.value}}copy(){return new Tl({...this.toMetadata(),uId:L()})}isValid(){return super.isValid()?this.isLookup?Rd(this.value):this.value!=null&&this.value!=="":!1}clear(){this._value="",this._displayValue="",this._displayValueInitialized=!1}setValue(e){e?(this.value=e.value,this.displayValue=e.displayValue):this.clear()}getValue(){return{value:this.value,displayValue:this.displayValue}}isEmpty(){return!this.value}};Dl=Tl=(0,u.__decorate)([bl({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression"}),(0,u.__metadata)("design:paramtypes",[Object])],Dl);var Ia;let Ol=Ia=class extends Jt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter",e&&(this.value=new Dl(e.value))}clone(){return new Ia(this.toMetadata())}copy(){return new Ia(super.copy().toMetadata())}getApplicability(){return this.expression?.path?[{path:this.expression.path}]:[]}isAttributeUsed(e,t){return this.expression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.expression.hasScopeAttributes(e)}};Ol=Ia=(0,u.__decorate)([Ue("BusinessRuleSetFilterAction"),(0,u.__metadata)("design:paramtypes",[Object])],Ol);var Aa;let Rl=Aa=class extends Jt{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"}clone(){return new Aa(this.toMetadata())}copy(){return new Aa(super.copy().toMetadata())}};Rl=Aa=(0,u.__decorate)([Ue("BusinessRuleSetValueDesignAction")],Rl);var jl;(function(o){o.DataSource="DataSource",o.Page="Page"})(jl||(jl={}));var Pa;let kl=Pa=class extends Jt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleSetValueItem",this.scope=e?.scopeId??"",this.scope==="null"&&(this.scope="")}clone(){return new Pa(this.toMetadata())}copy(){return new Pa({...super.copy().toMetadata(),scopeId:this.scope})}toMetadata(){return{...super.toMetadata(),scopeId:this.scope}}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();if(!t)return[];const n={path:t};return this.scope!==""&&(n.applicability=jl.DataSource,n.scope=this.scope),[n]}isAttributeUsed(e,t){return this.expression.path===t&&_a(this.scope,e)}hasScopeAttributes(e){return _a(this.scope,e)}};kl=Pa=(0,u.__decorate)([Ue("BusinessRuleSetValueItem"),(0,u.__metadata)("design:paramtypes",[Object])],kl);var Ta;let Nl=Ta=class extends Jt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues",this.items=[],e&&(this.items=e.items?.map(t=>new kl(t)))}getExpressionAffectedItems(){return[]}clone(){return new Ta(this.toMetadata())}copy(){return new Ta({...super.copy().toMetadata(),items:this.items.map(e=>e.toMetadata())})}toMetadata(){const e={...super.toMetadata(),items:this.items?.length>0?this.items.map(t=>t.toMetadata()):[]};return this.items?.length>0&&(delete e.expression,delete e.value),e}getApplicability(){return this.items?.length?this.items.flatMap(e=>e.getApplicability()):[]}isValid(){return this.items?.length>0&&this.items.every(e=>e.isValid())}getAffectedItems(){const t=(this.items??[]).map(n=>n.getAffectedItems()).flat();return[...super.getAffectedItems(),...t]}getRequiredItems(){return this.getAffectedItems()}isAttributeUsed(e,t){return this.items.some(n=>n.isAttributeUsed(e,t))}hasScopeAttributes(e){return this.items.some(t=>t.hasScopeAttributes(e))}};Nl=Ta=(0,u.__decorate)([Ue("BusinessRuleSetValuesDesignAction"),(0,u.__metadata)("design:paramtypes",[Object])],Nl);var Da;let Vl=Da=class extends Ui{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"}clone(){return new Da(this.toMetadata())}copy(){return new Da({...this.toMetadata(),uId:L()})}};Vl=Da=(0,u.__decorate)([Ue("BusinessRuleShowElementDesignAction")],Vl);class $i{get(e){return e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"?new Vl(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"?new El(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement"?new Al(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement"?new Ml(e):e.typeName===Wh?new Il(e):e.typeName===Zh?new Pl(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup"?new xl(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter"?new Ol(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"?new Rl(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues"?new Nl(e):new Jt(e)}static{this.\u0275fac=function(t){return new(t||$i)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:$i,factory:$i.\u0275fac,providedIn:"root"})}}var Oa;(function(o){o[o.Condition=0]="Condition",o[o.Action=1]="Action",o[o.Trigger=2]="Trigger",o[o.Context=3]="Context",o[o.Unknown=4]="Unknown"})(Oa||(Oa={}));const Q_="crt-business-rules-cache";class ey{}class Gi extends ey{constructor(e,t,n){super(),this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._cachedLoadScopesRequests=new Map,this.serviceEndpoint="/ServiceModel/BusinessRulesManagerService.svc/",this.getBusinessRulesConfigMethodName="GetBusinessRules"}_getBusinessRulesCache(){return this._cache?(0,l.of)(this._cache):(0,l.from)(this._cacheManager.get(Q_)).pipe((0,l.tap)(e=>this._cache=e))}_getCachedBusinessRulesScopes(e){return e.length?this._getBusinessRulesCache().pipe((0,l.switchMap)(t=>{const n=e.map(i=>{const r=this._getContextCacheKey(i.scopeType,i.scopeName);return(0,l.from)(t.get(r)).pipe((0,l.map)(a=>a?{rules:a,scopeName:i.scopeName,scopeType:i.scopeType}:null))});return(0,l.forkJoin)(n)}),this._measurePerformanceService.measure$("BusinessRulesManager: get business rules from cache")):(0,l.of)([])}_getScopeType(e){return e==="Model"?xt.Model:xt.ViewModel}_mapResponseToBusinessRules(e){return!e?.businessRules||e.businessRules.length===0?[]:e.businessRules.map(t=>{const n=JSON.parse(t.businessRulesConfig);return{scopeName:t.schemaName,scopeType:this._getScopeType(t.type),rules:n}})}_getContextsScopeNames(e){return e.map(t=>t.scopeName)}_getContextCacheKey(e,t){return`Type:#${e}#-Name:#${t}#`}_getContextsScopeNamesRequestKey(e){return e.map(n=>this._getContextCacheKey(n.scopeType,n.scopeName)).join("_")}_getCachedLoadScopesRequest(e){const t=e.map(i=>this._getContextCacheKey(i.scopeType,i.scopeName)),n=[...this._cachedLoadScopesRequests.keys()].find(i=>t.every(r=>i.includes(r)));return this._cachedLoadScopesRequests.get(n)}_getNotLoadedBusinessRulesScopes(e){if(e.length===0)return(0,l.of)([]);const t=this._getContextsScopeNames(e),n=this._getCachedLoadScopesRequest(e);if(n)return n.request$.pipe((0,l.map)(c=>c.filter(h=>t.includes(h.scopeName))));const i=`${this.serviceEndpoint}${this.getBusinessRulesConfigMethodName}`,r={scopes:Array.from(new Map(e.map(c=>[this._getContextCacheKey(c.scopeType,c.scopeName),{name:c.scopeName,type:c.scopeType,modelType:c.modelType}])).values())},a=this._httpClient.post(i,r).pipe((0,l.map)(c=>this._mapResponseToBusinessRules(c)),(0,l.switchMap)(c=>c.length?this._getBusinessRulesCache().pipe((0,l.switchMap)(h=>{const p=c.map(m=>{const f=this._getContextCacheKey(m.scopeType,m.scopeName);return(0,l.from)(h.set(f,m.rules))});return(0,l.forkJoin)(p).pipe((0,l.map)(()=>c))}),this._measurePerformanceService.measure$("BusinessRulesManager: set loaded business rules to cache")):(0,l.of)(c)),(0,l.tap)(()=>{const c=this._getContextsScopeNamesRequestKey(e);this._cachedLoadScopesRequests.delete(c)}),(0,l.share)());return this._cachedLoadScopesRequests.set(this._getContextsScopeNamesRequestKey(e),{request$:a,scopeNames:t}),a}getBusinessRulesByContexts(e){const t=e.filter(n=>n.scopeName&&n.modelType!=="crt.PageParametersDataSource");return this._getCachedBusinessRulesScopes(t).pipe((0,l.switchMap)(n=>{const i=t.filter(a=>!n?.some(c=>c?.scopeName===a.scopeName&&c.scopeType===a.scopeType));return this._getNotLoadedBusinessRulesScopes(i).pipe((0,l.map)(a=>[...n,...a].filter(Boolean)),(0,l.catchError)(a=>{const c=t?.map(h=>h.scopeName).join(", ");return console.warn(`An error occurred during getting business rules execution for scopes: ${c}.`,a),(0,l.of)([])}))}))}clearCachedBusinessRules(){return this._getBusinessRulesCache().pipe((0,l.switchMap)(e=>(0,l.from)(e.clear())),(0,l.map)(()=>!0),this._measurePerformanceService.measure$("BusinessRulesManager: clear business rules from cache"))}static{this.\u0275fac=function(t){return new(t||Gi)(s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Gi,factory:Gi.\u0275fac,providedIn:"root"})}}var ne;(function(o){o.ChangeAttributeValue="ChangeAttributeValue",o.ChangeAttributeProperty="ChangeAttributeProperty",o.DataLoaded="DataLoaded",o.ContextReady="ContextReady"})(ne||(ne={}));const Yh=new Map([[0,ne.ChangeAttributeValue],[1,ne.ChangeAttributeProperty],[2,ne.DataLoaded]]);function Ra(o){return Yh.has(o)?Yh.get(o):ne.DataLoaded}class Cr{canExecute(e,t,n){const i=n.map(a=>a.triggers).flat();return i.length===0?!1:(e?.triggers??[]).some(a=>a.type===ne.ContextReady)?n.some(a=>a.triggers.some(c=>Ra(c.type)===ne.DataLoaded&&!c.name)):i.some(a=>{const c=Ra(a.type);if(c===ne.DataLoaded&&e.scopeType===xt.Model)return e.triggers.some(p=>p.type===ne.DataLoaded);if(!a.scopeId)return e.triggers.some(p=>p.name===a.name&&p.type===c);const h=t.find(p=>p.scopeId===a.scopeId);return h==null?!1:h.triggers.some(p=>p.name===a.name&&p.type===c)})}static{this.\u0275fac=function(t){return new(t||Cr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Cr,factory:Cr.\u0275fac})}}const ty="Terrasoft.Core.BusinessRules.Models.Conditions.BusinessRuleGroupCondition";function Kh(o){return o&&"path"in o?o.path:""}function ny(o){const e=[];return o.conditions&&o.conditions.forEach(t=>{const n=Jh(t);e.push(...n)}),e}function Jh(o){if(qh(o))return ny(o);const e=o;return[Kh(e.leftExpression),Kh(e.rightExpression)].filter(t=>t)}function iy(o,e){return o.flatMap(t=>e.get(t).getRequiredItems()).map(t=>t.name)}function qh(o){return o.typeName===ty}function Xh(o){return o.map(e=>Jh(e)).flat().filter(e=>e!=null)}function sy(o,e){return o.flatMap(t=>t.cases.flatMap(n=>iy(n.actions,e)))}function ry(o){return!o.cases||o.cases.length===0?[]:o.cases.map(e=>e.condition).filter(e=>e!=null)}function Qh(o){return o.map(e=>ry(e)).flat()}const oy=[Vn.Const,Vn.SysValue,Vn.SysSetting],ay=new Set(oy);function ep(o){return o?!!o.type&&ay.has(o.type):!0}function cy(o){return o.conditions?o.conditions.every(e=>tp(e)):!1}function tp(o){if(!o)return!1;if(qh(o))return cy(o);const e=o;return(0,v.isNil)(e.leftExpression)&&(0,v.isNil)(e.rightExpression)?!1:ep(e.leftExpression)&&ep(e.rightExpression)}function np(o){return o.some(e=>e.type===ne.ContextReady)}function ly(o,e){return np(o)?e.some(t=>tp(t)):!1}function uy(o,e){return np(o)?e.some(t=>t.cases?.some(n=>!n.condition)):!1}class br{_canExecuteByConditionsAttributePaths(e,t){const n=e.filter(r=>r.type!==ne.DataLoaded).map(r=>r.name);if(!n||n.length===0)return!1;const i=new Set(Xh(t));return n.some(r=>i.has(r))}canExecute(e,t){if(!t||t.length===0)return!1;const n=Qh(t),i=ly(e.triggers,n),r=uy(e.triggers,t);return i||r?!0:this._canExecuteByConditionsAttributePaths(e.triggers,n)}static{this.\u0275fac=function(t){return new(t||br)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:br,factory:br.\u0275fac})}}class vr{constructor(e,t){this._businessRulesManager=e,this._businessRuleDesignActionFactory=t,this._scopeAttributes=[]}_filterTriggers(e,t){const n=t.filter(a=>a.scopeName===e.parentScopeId),r=t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules.map(a=>a.triggers).flat();return e.triggers.filter(a=>{if(a.type===ne.ContextReady||a.type===ne.DataLoaded)return!0;const c=r?.some(m=>m&&m.name===a.name&&Ra(m.type)===a.type),p=n.flatMap(m=>m.rules.flatMap(f=>f.triggers)).some(m=>m.name===a.name&&Ra(m.type)===a.type);return c||p})}_filterAttributes(e){const n=this._scopeAttributes.filter(a=>a.scopeName===e.scopeName).map(a=>a.attributes).flat(),i=this._scopeAttributes.filter(a=>a.scopeName!==e.scopeName).flatMap(a=>[...a.attributes]);return e.attributes.filter(a=>n.includes(a.attributeName)||i.includes(a.attributeName)||a.isSignificant)}_cacheUsedAttributes(e){e.forEach(t=>{if(!this._scopeAttributes.find(n=>n.scopeName===t.scopeName&&n.scopeType===t.scopeType)){const n=Qh(t.rules),i=Xh(n),r=sy(t.rules,this._businessRuleDesignActionFactory),a=t.rules.flatMap(c=>c.triggers?.map(h=>h.name)).filter(Boolean);this._scopeAttributes.push({scopeName:t.scopeName,scopeType:t.scopeType,attributes:[...i,...r,...a]})}})}_hasActiveRules(e,t){return(t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules??[]).filter(a=>a.enabled===!0).length>0}clearCachedScopeAttributes(){this._scopeAttributes=[]}filter(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,l.tap)(t=>this._cacheUsedAttributes(t)),(0,l.map)(t=>e.map(i=>({...i,attributes:this._filterAttributes(i),triggers:this._filterTriggers(i,t)})).filter(i=>this._hasActiveRules(i,t)?!0:i.attributes.length>0)))}static{this.\u0275fac=function(t){return new(t||vr)(s.\u0275\u0275inject(Gi),s.\u0275\u0275inject($i))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:vr,factory:vr.\u0275fac,providedIn:"root"})}}class Sr{constructor(e,t,n,i,r,a,c){this._businessRulesManager=e,this._businessRulesTriggerExecutor=t,this._businessRulesConditionExecutor=n,this._httpClient=i,this._messageChannelService=r,this._featureService=a,this._contextFilter=c,this._businessRulesResponseEventName="BusinessRuleExecutionResponse",this._serviceUrl="ServiceModel/BusinessRulesEngineService.svc/Execute",this._businessRulesRequestEventName="BusinessRuleExecutionRequest",this._businessRuleDesignActionFactory=new $i,this._configurationStructureChangedSubscribe()}_configurationStructureChangedSubscribe(){this._messageChannelService.getMessages("ConfigurationStructureChanged").pipe((0,d.switchMap)(()=>(this._contextFilter.clearCachedScopeAttributes(),this._businessRulesManager.clearCachedBusinessRules()))).subscribe()}_featureStates(){return(0,l.from)(this._featureService.getFeaturesState(["BRules-UseWebSocketChannel","BRules-DisableContextOptimization"])).pipe((0,d.map)(([e,t])=>({useHttpChannel:!e,disableContextOptimization:t})))}_sendWebSocketMessage(e){const t=L();return e.businessRulesSessionId=t,new l.Observable(n=>{const i=this._messageChannelService.messageEvent$.pipe((0,d.map)(r=>r.body),(0,d.filter)(r=>r!=null),(0,d.filter)(r=>r.eventName===this._businessRulesResponseEventName),(0,d.filter)(r=>r.businessRulesSessionId===t),(0,d.map)(r=>r.payload)).subscribe({next:r=>{i.unsubscribe(),r.success?n.next(r.businessRulesResponse):(console.error("An error occurred during business rules execution. "+r.errorInfo.errorCode+": "+r.errorInfo.message),n.next([])),n.complete()},error:r=>{i.unsubscribe(),console.error("An error occurred during business rules execution. "+r.errorCode+": "+r.message),n.next([]),n.complete()},complete:()=>{i.unsubscribe(),n.error("WebSocket channel closed")}});this._messageChannelService.sendMessage(e,Bs.PTP).pipe((0,l.take)(1)).subscribe()})}_createWebSocketRequest(e){return{eventName:this._businessRulesRequestEventName,contexts:e}}_executeUsingWebSocket(e){const t=this._createWebSocketRequest(e);return this._sendWebSocketMessage(t)}_logErrorMessageAndReturnDefBusinessRuleResponse(e){return console.error("An error occurred during business rules execution. "+e.errorCode+": "+e.message),(0,l.of)([])}_executeUsingHttp(e){return this._httpClient.post(this._serviceUrl,{contexts:e},{headers:new U.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,d.mergeMap)(t=>t.success?(0,l.of)(t.businessRulesResponse):this._logErrorMessageAndReturnDefBusinessRuleResponse(t.errorInfo)),(0,d.catchError)(t=>this._logErrorMessageAndReturnDefBusinessRuleResponse(t)))}_canExecuteBusinessRulesByContexts(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,d.map)(t=>{const n=t.filter(i=>i.rules&&i.rules.length>0);return n.length===0?!1:n.some(i=>{const r=e.find(p=>p.scopeName===i.scopeName&&p.scopeType===i.scopeType),a=e.filter(p=>p.parentScopeId===r.scopeId),c=this._businessRulesTriggerExecutor.canExecute(r,a,i.rules),h=this._businessRulesConditionExecutor.canExecute(r,i.rules);return c||h})}))}_getContextsWithScope(e){return e.filter(t=>t.scopeName&&t.scopeId)}_getBusinessRuleActions(e){return e.cases.map(t=>t.actions).flat().filter(t=>t.enabled).map(t=>this._businessRuleDesignActionFactory.get(t))}_getBusinessRuleAffectedAttributes(e){return this._getBusinessRuleActions(e).map(n=>n.getAffectedItems()).flat()}_getAffectedAttributes(e){let t=e.rules.filter(n=>n.enabled).map(n=>this._getBusinessRuleAffectedAttributes(n)).flat();return t=this._getUniqueAffectedAttributes(t),t.forEach(n=>{n.scopeName=e.scopeName}),t}_getUniqueAffectedAttributes(e){const t=e.map(i=>[i.name,i]);return[...new Map(t).values()]}_execute(e){return this._featureStates().pipe((0,d.switchMap)(({useHttpChannel:t,disableContextOptimization:n})=>(0,l.forkJoin)({useHttpChannel:(0,l.of)(t),executionContexts:n?(0,l.of)(e):this._contextFilter.filter(e)})),(0,d.switchMap)(({useHttpChannel:t,executionContexts:n})=>(t?this._executeUsingHttp(n):this._executeUsingWebSocket(n)).pipe((0,d.map)(i=>({executionResults:i,executionContexts:n})))),(0,d.switchMap)(({executionResults:t,executionContexts:n})=>this._logUnsuccessfulBusinessRulesExecution(t,n).pipe((0,d.map)(()=>t))))}_logUnsuccessfulBusinessRulesExecution(e,t){const n=e?.filter(i=>i?.errors?.length>0).map(i=>i.errors).flat();return n?.length===0?(0,l.of)(void 0):(0,l.from)(this._featureService.getFeatureState("BRules-ShowChildRules")).pipe((0,d.switchMap)(i=>this._businessRulesManager.getBusinessRulesByContexts(t).pipe((0,d.map)(r=>r.map(a=>a.rules).flat()),(0,d.tap)(r=>{n.map(a=>this._getUnsuccessfulBusinessRuleExecutionMessage(a,r,i)).forEach(a=>{console.error(a)})}),(0,d.map)(()=>{}))))}_getUnsuccessfulBusinessRuleExecutionMessage(e,t,n){const i="Business rule execution error: ",r=`Error message: "${e.message}"`,a=e.type===Oa.Unknown?"":`The error occurred in the business rule ${Oa[e.type]?.toLocaleLowerCase()}s.`;let c=t.find(C=>C.uId===e.businessRuleId);if(!c)return`${i}Rule id - "${e.businessRuleId}". ${r}. ${a}`;!Ym(c.parentUId)&&!n&&(c=t.find(C=>C.uId===c.parentUId));const h=c.caption||"",p=c.name,m=`Rule Title - "${h}"`,f=`Rule Code - "${p}"`;return`${i}${m}, ${f}. ${r}. ${a}`}execute(e){const t=this._getContextsWithScope(e);return t.length===0?(0,l.of)([]):this._canExecuteBusinessRulesByContexts(e).pipe((0,d.switchMap)(n=>n?this._execute(t):(0,l.of)([])),(0,d.catchError)(n=>(console.warn(`An error occurred during business rules execution for scopes: ${e?.map(i=>i.scopeName).join(", ")}.`,n),(0,l.of)([]))))}getAffectedAttributes(e){var t=this;return(0,b.A)(function*(){if(e.length===0)return[];const n=e.filter(a=>a.scopeName!=null),r=(yield(0,l.firstValueFrom)(t._businessRulesManager.getBusinessRulesByContexts(n))).filter(a=>a.rules&&a.rules.length>0);return r.length===0?[]:r.map(a=>t._getAffectedAttributes(a)).flat()})()}static{this.\u0275fac=function(t){return new(t||Sr)(s.\u0275\u0275inject(Gi),s.\u0275\u0275inject(Cr),s.\u0275\u0275inject(br),s.\u0275\u0275inject(U.HttpClient),s.\u0275\u0275inject(Qo),s.\u0275\u0275inject(xn),s.\u0275\u0275inject(vr))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Sr,factory:Sr.\u0275fac})}}class Bn{static{this._actionAppliers=new Map}static register(e,t){Bn._actionAppliers.set(e,t)}get(e){const t=Bn._actionAppliers.get(e.typeName);if(!t)throw new Error(`Business rule applier for change type ${e.typeName} not found.`);return new t(e)}static{this.\u0275fac=function(t){return new(t||Bn)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Bn,factory:Bn.\u0275fac})}}class Mr{constructor(e){this._actionApplierFactory=e}_applyBusinessRuleAction(e,t,n){const i=this._actionApplierFactory.get(n);return(0,l.firstValueFrom)(i.apply(e,t))}_applyBusinessRule(e,t){var n=this;return(0,b.A)(function*(){const i={id:t.scopeId,name:t.scopeName,type:t.scopeType,triggers:t.triggers};if(t.actions.length===0)return Promise.resolve(null);const r=[];for(const a of t.actions){const c=yield n._applyBusinessRuleAction(e,i,a);r.push(c)}return r})()}_applyBusinessRules(e,t){var n=this;return(0,b.A)(function*(){const i=[];for(const r of t){const a=yield n._applyBusinessRule(e,r);i.push(a)}return i})()}applyRules(e,t){return t&&t.length>0?(0,l.from)(this._applyBusinessRules(e,t)):(0,l.of)(null)}static{this.\u0275fac=function(t){return new(t||Mr)(s.\u0275\u0275inject(Bn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Mr,factory:Mr.\u0275fac})}}class dy{constructor(e={preventAttributeChangeRequest:!1,preventRunBusinessRules:!1,preventStateChange:!1,isMaskedValue:!1}){this._preventAttributeChangeRequest=!1,this._preventStateChange=!1,this._preventRunBusinessRules=!1,this._isMaskedValue=!1,this._setOptions(e)}_setUsingSilent(e){this._preventStateChange=e,this._preventRunBusinessRules=e,this._preventAttributeChangeRequest=!1}_setOptions(e){this._preventAttributeChangeRequest=e?.preventAttributeChangeRequest??this._preventAttributeChangeRequest,this._preventStateChange=e?.preventStateChange??this._preventStateChange,this._preventRunBusinessRules=e?.preventRunBusinessRules??this._preventRunBusinessRules,this._isMaskedValue=e?.isMaskedValue??this._isMaskedValue}getAsSilent(){return this._preventRunBusinessRules&&this._preventStateChange}getIsMaskedValue(){return this._isMaskedValue}setOptions(e){if((0,v.isUndefined)(e?.silent)){const t=(0,v.pick)(e,"preventAttributeChangeRequest","preventStateChange","preventRunBusinessRules","isMaskedValue");this._setOptions(t)}else this._setUsingSilent(e?.silent)}getOptions(){return{preventAttributeChangeRequest:this._preventAttributeChangeRequest,preventRunBusinessRules:this._preventRunBusinessRules,preventStateChange:this._preventStateChange,isMaskedValue:this._isMaskedValue}}reset(){this._preventAttributeChangeRequest=!1,this._preventRunBusinessRules=!1,this._preventStateChange=!1,this._isMaskedValue=!1}}var ja;(function(o){o.EntityDataSource="crt.EntityDataSource",o.WebServiceDataSource="crt.WebServiceDataSource",o.PageParametersDataSource="crt.PageParametersDataSource"})(ja||(ja={}));var Hi;(function(o){o.Reload="reload",o.Merge="merge"})(Hi||(Hi={}));function rw(o){const e=Object.keys(DataValueTypeGroup).find(t=>DataValueTypeGroup[t].includes(o));return DataValueTypeGroup[e]}function ow(o){return o===DataValueType.Lookup||o===DataValueType.Guid}function aw(o){return DataValueTypeItems[o]?.icon||null}function Ll(o){return Object.values(Gc).find(e=>e.name===o)?.type}function hy(o){return!(o&&!o?.value)}function py(o){let e=!1;const t=[];return Object.keys(o).forEach(n=>{ip(n,o)&&(e=!0,t.push(n))}),{hasCycles:e,cycledModelsNames:t}}function ip(o,e,t=[]){if(!e[o])return!1;const n=Object.values(e[o]);return n.some(r=>t.includes(sp(r)))?!0:(t.push(o),!n.every(r=>!ip(sp(r),e,t)))}function sp(o){return o.relationPath.split(".")[0]}class my{}var ka;(function(o){o.AddTask="addTask",o.RemoveTask="removeTask"})(ka||(ka={}));class rp extends my{constructor(e,t,n){super(),this.action=e,this.taskName=t,this.$context=n,this.type="crt.SchemaViewMaskRequest"}}class Bl extends sa{constructor(){super(...arguments),this.requestType="crt.MaskService"}showMask(e,t){return(0,b.A)(function*(){const n=new rp(ka.AddTask,e,t);yield Ct.instance.process(n)})()}hideMask(e,t){return(0,b.A)(function*(){const n=new rp(ka.RemoveTask,e,t);yield Ct.instance.process(n)})()}}(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],Bl.prototype,"showBodyMask",void 0),(0,u.__decorate)([ot(),(0,u.__metadata)("design:type",Function)],Bl.prototype,"hideBodyMask",void 0);const gy=new s.InjectionToken("DEVKIT_MASK_SERVICE",{providedIn:"root",factory:()=>new Bl});class op{constructor(e){this.ngZone=e}run(e,t,n){return this.ngZone.runOutsideAngular(e)}}class fy extends op{constructor(e){super(e)}run(e,t,n){return this.ngZone.run(e,t,n)}}var Fl;(function(o){o.Root="root",o.Angular="angular",o.ExecutionTracking="executionTracking"})(Fl||(Fl={}));var wr;(function(o){o[o.Busy=0]="Busy",o[o.Idle=1]="Idle"})(wr||(wr={}));var Na;(function(o){o.ReadyStateChange="readystatechange"})(Na||(Na={}));class _y{constructor(e){this._trackedTasks=[],this._trackedEventTasks=[],this._enableDebugTracking=!1,this._disableWaits=!1,this._pendingFunctions=new Map,this.onStateChange$=new s.EventEmitter(!1),this._parentZone=Zone.current,this._rootZone=Zone.root,this._isBusy=!1,this._ignoredTaskSources=["setInterval","requestAnimationFrame"],this._eventTaskFilters=[t=>t.source.startsWith("XMLHttpRequest")&&t.source.endsWith(Na.ReadyStateChange)],this._zone=this._parentZone.fork({name:e,properties:{currentExecutionZone:this},onInvokeTask:this._onInvokeTask.bind(this),onCancelTask:this._onCancelTask.bind(this),onScheduleTask:this._onScheduleTask.bind(this),onHasTask:this._onHasTask.bind(this)})}wait(e){if(this._disableWaits)return e();this._isBusy||(this._isBusy=!0,this.onStateChange$.next(wr.Busy));const t=L();return this._pendingFunctions.set(t,this._enableDebugTracking?e:null),e().finally(()=>{this._pendingFunctions.delete(t),!this._pendingFunctions.size&&this._zone.run(()=>new Promise(n=>setTimeout(n)))}).catch(n=>{throw n})}_cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(e,t){if(e.type==="eventTask"&&(e.state==="running"||e.state==="scheduled")){const n=e;n.eventName===Na.ReadyStateChange&&n.target.readyState===XMLHttpRequest.DONE&&t.cancelTask(n)}}_onInvokeTask(e,t,n,i,r,a){this._unTrackTask(i);let c;try{c=e.invokeTask(n,i,r,a),this._cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(i,t)}catch(h){console.error(h),t.cancelTask(i)}return c}_onCancelTask(e,t,n,i){return this._unTrackTask(i),e.zone.runGuarded(()=>e.cancelTask(n,i))}_onScheduleTask(e,t,n,i){return this._getCanScheduleTask(i)?(this._trackTask(i),e.scheduleTask(n,i)):(i.cancelScheduleRequest(),this._parentZone.scheduleTask(i))}_onHasTask(e,t,n,i){e.hasTask(n,i);const r=i.eventTask||i.macroTask||i.microTask||this._pendingFunctions.size>0;this._isBusy!==r&&(this._rootZone.run(()=>this.onStateChange$.next(r?wr.Busy:wr.Idle)),this._isBusy=r)}_trackTask(e){this._enableDebugTracking&&(e.type==="eventTask"&&this._trackedEventTasks.push(e),this._trackedTasks.push(e))}_unTrackTask(e){if(!this._enableDebugTracking)return;const t=this._trackedTasks.indexOf(e);t>-1&&this._trackedTasks.splice(t,1)}_getCanScheduleTask(e){return e.type==="eventTask"?this._eventTaskFilters.some(t=>t(e)):this._ignoredTaskSources.indexOf(e.source)===-1}run(e,t,n){return this._zone.run(e,t,n)}}class Wi{constructor(e){this._ngZone=e}createDefaultZones(){return{root:new op(this._ngZone),angular:new fy(this._ngZone)}}createZone(e,t){if(t===Fl.ExecutionTracking)return new _y(e);throw new Error(`Zone ${e} with type ${t} is not supported`)}static{this.\u0275fac=function(t){return new(t||Wi)(s.\u0275\u0275inject(s.NgZone))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Wi,factory:Wi.\u0275fac,providedIn:"root"})}}var Fn;(function(o){o.Root="root",o.Angular="angular"})(Fn||(Fn={}));let zl=class xc{constructor(e){this._zoneProvider=e,this._zones=e.createDefaultZones()}init(e){var t=this;return(0,b.A)(function*(){t._disableExecutionTrackingZone=yield(0,l.lastValueFrom)(e("DisableExecutionTrackingZone"))})()}runInZone(e,t,n,i){return this._disableExecutionTrackingZone&&e!==Fn.Angular&&(e=Fn.Root),(this._zones[e]??this._zones[Fn.Root]).run(t,n,i)}register(e,t){if(this._zones[e])throw new Error(`Zone ${e} already registered`);const n=this._zoneProvider.createZone(e,t);return this._zones[e]=n,n}get(e){return this._zones[e]}runOutside(e){return this.runInZone(Fn.Root,e)}static{this.\u0275fac=function(t){return new(t||xc)(s.\u0275\u0275inject(Wi))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:xc,factory:xc.\u0275fac,providedIn:"root"})}};zl=(0,u.__decorate)([Xe({requestType:"crt.ZoneService"}),(0,u.__metadata)("design:paramtypes",[Wi])],zl);const ap=new s.InjectionToken("CRT_METADATA_PREPROCESSOR");class yy{constructor(e,t){this.id=e,this._baseHostInjector=t,this._hostModuleTypes=[],this._hostModuleRefs=[],this._lazyModulesBySource=new Map,this._hostInjector=this._baseHostInjector}_createDynamicNgModule(e){const n=this._hostInjector.get(ap,[]).map(a=>({provide:ap,useValue:a,multi:!0})),i=(0,s.NgModule)({providers:n})(class{}),r=(0,s.NgModule)({imports:[i,...e]})(class{});return(0,s.createNgModule)(r,this._hostInjector)}inject(e){return this._hostInjector.get(e)}addLazyModule(e){const t=bh.get(e);if(!t)throw new Error("Module was not bootstrapped");const{source:n}=t;this._lazyModulesBySource.has(n)||this._lazyModulesBySource.set(n,new Set),this._lazyModulesBySource.get(n).add(e)}getLazyModules(e){return[...this._lazyModulesBySource.get(e)??[]]}connectHostLazyModules(){const e=this.getLazyModules("host");if((0,v.isEqual)(e,this._hostModuleTypes))return;const t=this._createDynamicNgModule(e);this._hostModuleTypes=e,this._hostModuleRefs.push(t),this._hostInjector=t.injector}destroy(){for(const e of this._hostModuleRefs)e.destroy();this._hostModuleRefs=[]}}class Zi extends di{constructor(){super(...arguments),this._injectionContextsMap=new Map}createContext(e,t){const n=new yy(e,t);return this._injectionContextsMap.set(e,n),n}injectFromContext(e,t){return this._injectionContextsMap.get(e)?.inject(t)}removeContext(e){return this._injectionContextsMap.get(e)?.destroy(),this._injectionContextsMap.delete(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Zi)))(n||Zi)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Zi,factory:Zi.\u0275fac,providedIn:"root"})}}const Cy=new s.InjectionToken("Terrasoft global object",{providedIn:"root",factory:()=>(0,v.get)((0,s.inject)(Qe),["Terrasoft"])||{}}),by=new s.InjectionToken("Flag indicating that this is an angular host",{providedIn:"root",factory:()=>(0,v.get)((0,s.inject)(Cy),["isAngularHost"])}),cp=100;class Yi extends di{constructor(){super(...arguments),this._window=(0,s.inject)(Qe),this._requestBuffer=[],this._requestIter=0,this._cachedRequestIter=0,this._compressedRequestIter=0}_onRequest(e){const t=e.getEntries();for(const n of t){if(!n.name.startsWith(this._window.location.origin))return;this._requestIter++,n.transferSize||this._cachedRequestIter++,n.encodedBodySize!==n.decodedBodySize&&this._compressedRequestIter++,n.fetchStart&&n.responseStart&&n.responseEnd&&this._requestBuffer.push({name:n.name,initiatorType:n.initiatorType,transferSize:n.transferSize,responseStart:n.responseStart,responseEnd:n.responseEnd,fetchStart:n.fetchStart})}}_calculateLatency(e,t){return e/(t/1e3)/1e3/1e3||0}_normalizeUrl(e,t){try{return(e+new URL(t)?.pathname.replace("/0/","/")).slice(0,cp)}catch{return t?.slice(0,cp)}}_reset(){this._resourcePerformanceObserver?.disconnect(),this._markPerformanceObserver?.disconnect(),this._requestBuffer=[],this._compressedRequestIter=0,this._cachedRequestIter=0,this._requestIter=0}_downlink(){let e=0,t=0;return this._requestBuffer.forEach(i=>{i.initiatorType==="xmlhttprequest"&&(e+=i.transferSize,t+=i.responseEnd-i.responseStart)}),+this._calculateLatency(e,t).toFixed(1)}_withCache(){return Math.round(this._cachedRequestIter/this._requestIter*100)||0}_withCompression(){return Math.round(this._compressedRequestIter/this._requestIter*100)||0}_topRequests(e){const t=[];for(let n=this._requestBuffer.length-1;n>=0;n--){const i=this._requestBuffer[n],r=Math.round(i.responseEnd-i.fetchStart);if(r>=e.topRequestThreshold&&t.length<e.topRequestCount){const a=this._normalizeUrl(r,i.name);if(t.push(a),t.length===e.topRequestThreshold)return t}}return t}start(){this._reset(),this._resourcePerformanceObserver=this._resourcePerformanceObserver??new PerformanceObserver(this._onRequest.bind(this)),this._resourcePerformanceObserver.observe({type:"resource",buffered:!this._firstStart}),this._firstStart=!0}measure(e={topRequestThreshold:400,topRequestCount:5}){const t={transferred:0};return this._requestBuffer.sort((n,i)=>n.fetchStart-i.fetchStart),t.duration=this._calculateDuration(),t.transferred=this._calculateTransferred(),t.downlink=this._downlink(),t.cache=this._withCache(),t.compression=this._withCompression(),t.topRequests=this._topRequests(e),this._reset(),t}_calculateDuration(){let e=this._requestBuffer[0]?.responseEnd,t=this._requestBuffer[0]?.responseEnd-this._requestBuffer[0]?.fetchStart;return this._requestBuffer.forEach(n=>{e<n.fetchStart?t+=n.responseEnd-n.fetchStart:e<n.responseEnd&&(t+=n.responseEnd-e),e=Math.max(e,n.responseEnd)}),Math.round(t)||0}_calculateTransferred(){let e=this._requestBuffer.reduce((t,n)=>t+n.transferSize,0);return e=Math.round(e/1e3)||0,e}ngOnDestroy(){this._reset()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Yi)))(n||Yi)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Yi,factory:Yi.\u0275fac,providedIn:"root"})}}var dt;(function(o){o.PageStartLoading="PageStartLoading",o.PageFinishLoading="PageFinishLoading"})(dt||(dt={}));class xr extends di{constructor(){super(),this._ngZone=(0,s.inject)(s.NgZone),this._window=(0,s.inject)(Qe),this._featureValues=(0,s.inject)(Q,{optional:!0}),this._isAngularHost=(0,s.inject)(by,{optional:!0}),this._performanceNetworkObserver=(0,s.inject)(Yi),this._measureName="PageLoadDuration",this._debounceTime=100,this._subscriptions=new l.Subscription,this._measurements=[],this._tasks=new Set,this._loadingStarted=!1,this._loadingStartedCount=new Set,this._loadingFinishedCount=new Set,this._tasksQueueSubject=new l.Subject,this._pageLoadLifeCycleSubject=new l.Subject,this._iterationCounter=0,this.pageLoadDuration$=new l.Subject,this._enableMeasurement=!!this._isAngularHost&&!this._featureValues?.DisablePerformancePageLoadMeasurement,this._initSubscriptions(),(0,v.set)(this._window,"creatio.performance.measurePerformancePageLoadService",this)}_initSubscriptions(){this._enableMeasurement&&(this._subscriptions.add(this._tasksQueueSubject.pipe((0,l.debounceTime)(this._debounceTime),(0,d.filter)(e=>this._loadingStartedCount.size===this._loadingFinishedCount.size&&this._loadingStarted&&e.size===1&&e.has(dt.PageStartLoading))).subscribe({next:()=>this._pageLoadLifeCycleSubject.next(dt.PageFinishLoading)})),this._subscriptions.add(this._pageLoadLifeCycleSubject.subscribe({next:e=>{this._ngZone.runOutsideAngular(()=>{e===dt.PageStartLoading&&this._onStartPageLoadMeasure(),e===dt.PageFinishLoading&&this._onEndPageLoadMeasure()})}})))}_onStartPageLoadMeasure(){this.addTask(dt.PageStartLoading)}_getLocationInfo(){const e=this._window.location.hash,[t,n]=e.slice(1).split("/");return{moduleName:t,schemaName:n,hash:e}}_getMeasurementDetail(){const t=((0,v.get)(this._window,"creatio.performance")??{}).focusLossDuringLoad,n={iteration:this._iterationCounter++,location:this._getLocationInfo(),isReuse:!!this._isReuseMode,focusLossDuringLoad:!!t};return this._featureValues.DisablePerformancePageNetworkMeasurement||(n.network=this._performanceNetworkObserver.measure()),n}_onEndPageLoadMeasure(){this.removeTask(dt.PageFinishLoading),this.removeTask(dt.PageStartLoading);const e={start:this._startTime,detail:this._getMeasurementDetail(),end:this._window.performance.now()};this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this.pageLoadDuration$.next(e),this._reset()}_reset(){const e=(0,v.get)(this._window,"creatio.performance");e.initialLoad?e.initialLoad=!1:e.focusLossDuringLoad=null,this._startTime=null,this._tasks.clear(),this._loadingStarted=!1,this._loadingStartedCount.clear(),this._loadingFinishedCount.clear(),this._isReuseMode=null}setReuseMode(e){this._enableMeasurement&&this._isReuseMode===null&&(this._isReuseMode=e)}startPageLoadMeasure(e=performance.now()){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{this._reset(),this._startTime=e,this._pageLoadLifeCycleSubject.next(dt.PageStartLoading),this._featureValues.DisablePerformancePageNetworkMeasurement||this._performanceNetworkObserver.start()})}addTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&(this._loadingStartedCount.add(e),this._loadingStarted=!0),this._tasks.add(e),this._tasksQueueSubject.next(this._tasks)})}removeTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&this._loadingFinishedCount.add(e),this._tasks.delete(e),this._tasksQueueSubject.next(this._tasks)})}getMeasurements(){const e=this._measurements.map(t=>t());return this._measurements=[],e}getMeasureDataOnTimeout$(){const e={start:this._startTime,end:this._window.performance.now(),detail:this._getMeasurementDetail(),timeout:!0};return this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this._reset(),(0,l.of)(e)}ngOnDestroy(){this._reset(),this._subscriptions.unsubscribe(),this._tasksQueueSubject.complete(),this._pageLoadLifeCycleSubject.complete(),this.pageLoadDuration$.complete()}static{this.\u0275fac=function(t){return new(t||xr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:xr,factory:xr.\u0275fac,providedIn:"root"})}}var Ki;(function(o){o.Readonly="READONLY_PROPERTY",o.Disabled="DISABLED_PROPERTY"})(Ki||(Ki={}));class lp{constructor(e,t,n=!1){this.name=e,this._value=t,this._locked=n,this._isValueInitialized=!1,this._pendingValue=void 0,this._onChanged=new s.EventEmitter,this._hasInitialValue=!1,t!=null&&(this._isValueInitialized=!0,this._hasInitialValue=!0,this._initialValue=t,this._value=(0,v.cloneDeep)(t),this._oldValue=(0,v.cloneDeep)(t))}get onChanged(){return this._onChanged}get value(){return this.getValue()}set value(e){this.setValue(e)}get initialValue(){return this._initialValue}set initialValue(e){this.setInitialValue(e)}get hasInitialValue(){return this._hasInitialValue}get isLocked(){return this._locked}emitValueChanged(e){this.onChanged.emit(e)}areValuesEqual(e,t){return(0,v.isEqual)(e,t)}getValue(){return this._value}setValue(e,t=!1){if(this._locked)return;this._isValueInitialized=!0,this._pendingValue=e;const n=this._oldValue;this.areValuesEqual(this._oldValue,e)||(this._oldValue=(0,v.cloneDeep)(e),this._value=(0,v.cloneDeep)(e),!t&&this.emitValueChanged({name:this.name,value:e,oldValue:n}))}resetValue(){this.hasInitialValue&&(this._oldValue=null,this.setValue(this.initialValue))}setInitialValue(e){this._hasInitialValue=!0,this._initialValue=e,this._isValueInitialized||this.setValue(e,!0)}setPending(e){const t=typeof this._pendingValue>"u"?this.value:this._pendingValue;this.value=e,this._pendingValue=t}resetPending(){this._oldValue=null,this.value=this._pendingValue,this._pendingValue=void 0}}class up extends lp{constructor(e,t,n,i,r=!1){super(e,t,r),this._validatorTypeResolver=n,this._injectionContext=i,this._onValidatorChanged=new s.EventEmitter}get onValidatorChanged(){return this._onValidatorChanged}_createValidatorInfo(){return{name:this.validatorTypeName,instance:this._validatorTypeResolver.getValidator(this.validatorTypeName,{injectionContext:this._injectionContext}),disabled:!0}}emitValueChanged(e){super.emitValueChanged(e),this.hasValidator&&this.updateValidator(e)&&this._onValidatorChanged.emit()}get hasValidator(){return!1}updateValidator(e){return!1}setValidatorInfo(e,t=!1){this.validatorInfo=e}initializeValidator(e,t=!1){if(!this.hasValidator||this._validatorTypeResolver==null)return e;let n=e.find(r=>r.name===this.validatorTypeName),i=!1;return n==null&&(n=this._createValidatorInfo(),i=!0),this.setValidatorInfo(n,t),i?[...e,n]:e}}class vy{static{this._properties=new Map}static _get(e){if(!e)return up;if(this._properties.has(e))return this._properties.get(e);throw new Error(`CrtControlProperty with type ${e} doesn't registered`)}static register(e,t){this._properties.set(e,t)}static create(e){const t=this._get(e.typeName);return new t(e.name,e.value,e.validatorTypeResolver,e.injectionContext,e.locked===!0)}}const Sy="DataValueType";class Va extends lp{get propertiesConfig(){return[{name:"visible",defaultValue:!0},{name:"displayColor"},{name:"required",typeName:"crt.Required",defaultValue:!1}]}get formControl(){return this._formControl||(this._formControl=new wt.FormControl(this.value),this._subscribeOnFormControl(this._formControl)),this._formControl}set formControl(e){this._formControl=e,this._subscribeOnFormControl(this._formControl)}get properties(){return this._properties}get onPropertyChanged(){return this._onPropertyChanged}get visible(){return this.getPropertyByName("visible").getValue()}set visible(e){const t=this.getPropertyByName("visible");t.value=e}get required(){return this.getPropertyByName("required").getValue()}set required(e){const t=this.getPropertyByName("required");t.value=e}get displayColor(){return this.getPropertyByName("displayColor").getValue()}set displayColor(e){const t=this.getPropertyByName("displayColor");t.value=e}get isDirty(){return this.formControl.dirty}constructor(e=null,t,n=null,i=!1,r="",a=[],c,h,p,m){super(r,e),this._featureValues=t,this.validationState=n,this.disabled=i,this._subscription=new l.Subscription,this._appliedValidatorsCache=new Map,this._onPropertyChanged=new s.EventEmitter,this._crtControlStateAdapter=c,this._validatorTypeResolver=h,this._injectionContext=m,this._initProperties(a),this._subscribeOnPropertiesEvents(),this._initializeValidators(p??[],!0)}_subscribeOnFormControl(e){this._formControlSubscription?.unsubscribe(),this._formControlSubscription=e.valueChanges.pipe((0,d.startWith)(e.value),(0,d.distinctUntilChanged)((t,n)=>this.areValuesEqual(t,n))).subscribe(t=>{this.setValue(t)})}_initProperties(e){const t=[...this.propertiesConfig,...e];this._properties=new Map,t.forEach(n=>{const i=vy.create({typeName:n.typeName,name:n.name,value:n.defaultValue,locked:n.locked===!0,validatorTypeResolver:this._validatorTypeResolver,injectionContext:this._injectionContext});this._properties.set(n.name,i)})}_subscribeOnPropertyEvents(e){this._subscription.add(e.onChanged.subscribe(({name:t,value:n,oldValue:i})=>{this.onPropertyChanged.emit({name:t,value:n,oldValue:i})})),this._subscription.add(e.onValidatorChanged.subscribe(()=>{this._refreshValidators()}))}_subscribeOnPropertiesEvents(){this.properties.forEach(e=>{this._subscribeOnPropertyEvents(e)})}_initializeValidators(e,t=!1){this._validatorInfo=e,this._properties.forEach(n=>{this._validatorInfo=n.initializeValidator(this._validatorInfo,t)}),this._refreshValidators()}_useValidatorsMerging(){return!this._featureValues.DisableControlValidatorsMerging}_getEnabledValidatorFns(e=!1){return this._validatorInfo.filter(t=>!t.disabled&&t.instance.isAsync===e).map(t=>{if(this._useValidatorsMerging()){const i=this._appliedValidatorsCache.get(t.name);if(i)return i.validatorFn}const n=this._crtControlStateAdapter.transform(t);return this._useValidatorsMerging()&&this._appliedValidatorsCache.set(t.name,{validatorInfo:t,validatorFn:n}),n})??[]}_mergeValidators(e,t){for(const n of this._appliedValidatorsCache.values())if(n.validatorInfo.instance.isAsync){const r=n.validatorFn;t.includes(r)?this.formControl.hasAsyncValidator(r)||this.formControl.addAsyncValidators(r):this.formControl.removeAsyncValidators(r)}else{const r=n.validatorFn;e.includes(r)?this.formControl.hasValidator(r)||this.formControl.addValidators(r):this.formControl.removeValidators(r)}}_refreshValidators(){const e=this._getEnabledValidatorFns(),t=this._getEnabledValidatorFns(!0);this._useValidatorsMerging()?this._mergeValidators(e,t):(this.formControl.setValidators(e),this.formControl.setAsyncValidators(t)),this.formControl.updateValueAndValidity()}_updateValidator(e,t=!1){const n=this._validatorInfo.find(i=>i.name===e);if(!n)throw new Error(`Validator ${e} does not exist on ${this.name} attribute.`);n.disabled!==t&&(n.disabled=t,this._refreshValidators())}findPropertyByName(e){return this.properties.has(e)?this.properties.get(e):null}static create(e){return new Va(e.value,e.featureValues,null,!1,e.name,e.propertiesConfig??[],e.crtControlStateAdapter,e.validatorTypeResolver,e.validatorsInfo,e.injectionContext)}setValue(e,t){const n=this.formControl;this.areValuesEqual(e,n.value)||(n.dirty||n.markAsDirty(),n.setValue(e,{onlySelf:!!t})),super.setValue(e,t)}enableValidator(e){this._updateValidator(e,!1)}disableValidator(e){this._updateValidator(e,!0)}change(e){this.setValue(e)}getPropertyByName(e,t=!1){let n=this.findPropertyByName(e);return!n&&t&&(n=new up(e,null,this._validatorTypeResolver,this._injectionContext),this._properties.set(e,n),this._subscribeOnPropertyEvents(n)),n}hasPropertyValue(e){return!!this.getPropertyByName(e)}getPropertyValue(e){const t=this.getPropertyByName(e);return t?t.getValue():null}setPropertyValue(e,t,n=!1){this.getPropertyByName(e,!0).setValue(t,n)}setPropertyInitialValue(e,t){this.getPropertyByName(e,!0).setInitialValue(t)}getPropertyInitialValue(e){return this.getPropertyByName(e)?.initialValue}getValue(){return this._formControl?this._formControl.value:super.getValue()}destroy(){this._formControlSubscription?.unsubscribe(),this._subscription.unsubscribe()}getInvariabilityPropertyName(){const e=this.getPropertyValue(Ki.Readonly),t=this.getPropertyValue(Ki.Disabled);return e??t}toggle(e){const t=this.getInvariabilityPropertyName(),n=this.getPropertyByName(t);n&&(e?n.resetPending():n.setPending(!0))}}const La="maskState",Ul="maskedValue",$l="unMaskedValue";var Gl;(function(o){o.Unmasked="unmasked",o.Masked="masked"})(Gl||(Gl={}));const dp=Symbol("isAttributeValueMasked"),My=Symbol("getMaskedValue"),wy=Symbol("getUnmaskedValue"),xy=Symbol("setMaskedState"),Ey=Symbol("getMaskedState"),Iy="calculated",Ay=new s.InjectionToken("View model attribute creator factory");function hp(o){const e=o;return e?!!e?.modelConfig||!!e?.embeddedModel||!!e?.value:!1}function pp(o){const e=o;return e?!!e.from||!!e.triggers||!!e.converter:!1}function mp(o,e){const{dots:t}=e??{};return o?.replace(/\.+/g,t??"").replace(/\[+/g,"").replace(/\]+/g,"").replace(/:+/g,"")??""}const Py="DS",Ty="DYN";function Er(o){for(;o?.parent;)o=o.parent;return o}function zn(o){return o?.getDataSource()?.scope===ut.Page}function cw(o){const e=[];return o?._modelsMap.forEach((t,n)=>{zn(t)&&e.push(n)}),e}class Ir{static{this._dataCache=new WeakMap}static _getDataSourceColumns(e){const t={};let n=!1;for(const[i,r]of Object.entries(e.dataSourceConfig.config.attributes)){const a=r.path;t[mp(i)]=a,a==="Id"&&(n=!0)}return!n&&e.includePrimaryAttributes!==!1&&(t.Id="Id"),t}static _createAttributesConfigMap(e,t,n,i,r){const a={},c=this.getAttributeDataSourceOldName(e,i);for(const[h]of Object.entries(t)){const p=r.config?.useOriginalAttributesName?`${h}`:`${c}_${h}`,m=r.config.attributes[h],f={path:`${n}.${h}`,type:m?.type,functionConfig:m?.functionConfig,aggregationConfig:m?.aggregationConfig};a[p]={modelConfig:f}}return a}static _createAttributePagingConfig(e){return e.pagingConfig||{rowCount:30}}static _createAttributeSortingConfig(e){return e.sortingConfig||{attributeName:e.attributeName+"Sorting"}}static _createAttributeFiltersConfig(e){return e.filtersConfig?.map(t=>{const n={...t};return delete n.value,n})||[]}static _getDataSourceNameForDynamicModel(e,t){return e.getBoundDataSourceNameByAttributePath(t)||this._getAttributeDataSourceDefaultName(t)}static _getDynamicDataSourceNamePrefix(){return`${Ty}_`}static _isDynamicDataSourceName(e){return e.startsWith(this._getDynamicDataSourceNamePrefix())}static _getAttributeDataSourceDefaultName(e){return`${e}${Py}`}static _getLoadData(e,t,n,i){let r;return this._dataCache.has(e)?r=this._dataCache.get(e):(r=t.load(n,[]).pipe((0,d.share)(),(0,d.tap)(()=>this._dataCache.delete(e))),this._dataCache.set(e,r)),(0,l.lastValueFrom)(r.pipe((0,l.map)(()=>i())),{defaultValue:null})}static createAttributeConfig(e,t,n){const i=n.attributeName,r=n.dataSourceConfig,a=this._getDataSourceColumns(n),c=this._createAttributesConfigMap(e,a,t,i,r),h=this._createAttributePagingConfig(n),p=this._createAttributeSortingConfig(n),m=this._createAttributeFiltersConfig(n);return{isCollection:!0,modelConfig:{path:t,pagingConfig:h,sortingConfig:p,filterAttributes:m,hierarchyConfig:n.hierarchyConfig},viewModelConfig:{attributes:c}}}static getAttributeDataSourceOldName(e,t){let n=this._getDataSourceNameForDynamicModel(e,t);return(!n||this._isDynamicDataSourceName(n))&&(n=this._getAttributeDataSourceDefaultName(t)),n}static createDynamicDataSourceNameFromAttributeName(e,t){const n=this._getDynamicDataSourceNamePrefix(),i=this._getDataSourceNameForDynamicModel(e,t);return this._isDynamicDataSourceName(i)?i:`${n}${i}`}static defineAsyncAttribute(e,t,n,i,r){const a=n.modelConfig?.path?.split(".")[0],c=e.getModelByName(a),h="isLookup"in n&&n.isLookup,p="isCollection"in n&&n.isCollection;Object.defineProperty(e,t,{get:()=>c&&p&&!h&&!c?.isLoaded?this._getLoadData(c,e,a,i):Promise.resolve(i()),set:r,configurable:!0})}static deferUpdatingValueAndValidity(e,t,n){if(n?.["ViewModel.DontDeferUpdatingValueAndValidity"])return t();const i=e.formApiModel.updateValueAndValidity;if(i.callbackCount)i.callbackCount++;else{const c=km();c.callbackCount=1,c.originalFn=i.bind(e.formApiModel),e.formApiModel.updateValueAndValidity=c}const r=t(),a=()=>{const c=e.formApiModel.updateValueAndValidity;c.callbackCount===1?(e.formApiModel.updateValueAndValidity=c.originalFn,e.formApiModel.updateValueAndValidity()):c.callbackCount--};return r instanceof Promise?r.finally(a):r.pipe((0,d.finalize)(a))}}class Ji{transform(e){return function(t){const{instance:n,params:i}=e,r={value:t.value};return n.validate(r,i)}}static{this.\u0275fac=function(t){return new(t||Ji)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ji,factory:Ji.\u0275fac,providedIn:"root"})}}class gp{constructor(e){this.injector=e}}class qi{resolveModelConfig(e){return null}static{this.\u0275fac=function(t){return new(t||qi)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:qi,factory:qi.\u0275fac,providedIn:"root"})}}class Ba{constructor(){this.account={attributes:{Name:{},Ships:{isCollection:!0,viewModelConfig:"ship"},Employee:{viewModelConfig:"employee"}}},this.ship={attributes:{Id:{}}},this.employee={attributes:{Name:{},Age:{}}}}resolveModelConfig(e){return(0,l.of)(this[e]).pipe((0,d.delay)(50))}static{this.\u0275fac=function(t){return new(t||Ba)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ba,factory:Ba.\u0275fac,providedIn:"root"})}}class Ar{constructor(e){this.injector=e,this.initDependencies()}initDependencies(){this.repository=this.injector.get(qi),this.ngZone=this.injector.get(s.NgZone)}static{this.\u0275fac=function(t){return new(t||Ar)(s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ar,factory:Ar.\u0275fac})}}const Dy=y(85088);class Pr{sort(e,t){const n=[];let i=[];Object.entries(e||{}).forEach(([a,c])=>{if(pp(c)){let h=c.from;h=Array.isArray(h)?h:[h];const p=h.map(m=>[a,m]);i=i.concat(p)}else n.push(a)});const r=Dy(i).reverse();return[...n,...r].filter(Boolean).filter((a,c,h)=>h.indexOf(a)===c).map(a=>{const c=r.includes(a)?e[a]??t[a]:e[a];return[a,c]})}static{this.\u0275fac=function(t){return new(t||Pr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Pr,factory:Pr.\u0275fac,providedIn:"root"})}}class Tr{constructor(e,t,n,i,r,a,c){this._crtControlStateAdapter=e,this._validatorTypeResolver=t,this._viewModelGenerator=n,this._attributeCreator=i,this._viewModelRepository=r,this._attributesTopologicalSorting=a,this._injector=c,this._featureValues=this._injector.get(Q,null,{optional:!0}),this._measurePerformanceService=this._injector.get(q)}_generateAttributes(e,t,n){const i=this._attributesTopologicalSorting.sort(t,e._attributeConfigs);return Promise.all(i.map(([r,a])=>e._systemAttributes.includes(r)?(console.warn(`Overriding of system attributes is denied. Attribute name:"${r}"`),Promise.resolve()):(n.disableDefaultConfig||(a??={}),e._attributeConfigs[r]=a,a?"viewModelConfig"in a||"viewModelName"in a?a.isCollection?this._generateNestedModelCollectionAttribute(e,r,a,n):this._generateNestedModelAttribute(e,r,a,n):pp(a)?this._generateCalculatedAttribute(e,r,a,n):this._generateModelAttribute(e,r,a,n):this._removeViewModelAttribute(e,r))))}_generateNestedModelCollectionAttribute(e,t,n,i){var r=this;return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedCollectionAttribute.${t}`,(0,b.A)(function*(){const a=e.getBoundDataSourceNameByAttributePath(t),c=e.getModelByName(a),h="viewModelConfig"in n?n.viewModelConfig:yield(0,l.lastValueFrom)(r._viewModelRepository.resolveModelConfig(n.viewModelName)),p=new We(r._viewModelGenerator,h,c,e,t);r._registerOrSetFormControl(e.formApiModel,t,p.formApiModel);const m=e.attributes[t];e.attributes[t]=p,r._defineNestedModelAttribute(e,t,n,i),r._subscribeOnCollectionChanged(e,t,p,i),m!==void 0&&i.onChangeAttributeValue(t,p,m)}))}_defineNestedModelAttribute(e,t,n,i){const r=c=>{const h=e.attributes[t];e.attributes[t]=c,h instanceof We&&c instanceof We&&this._subscribeOnCollectionChanged(e,t,c,i),i.onChangeAttributeValue(t,c,h)},a=()=>e.attributes[t];Ir.defineAsyncAttribute(e,t,n,a,r)}_generateNestedModelAttribute(e,t,n,i){return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedModelAttribute.${t}`,()=>{const r="viewModelConfig"in n?n.viewModelConfig:n.viewModelName,a=e?.[Mt];return(0,l.lastValueFrom)(this._viewModelGenerator.generate({viewModelConfig:r,parentViewModel:e},a?s.Injector.create({providers:[{provide:ga,useValue:null}],parent:a}):null).pipe((0,l.map)(c=>{this._registerOrSetFormControl(e.formApiModel,t,c.formApiModel);const h=e.attributes[t];e.attributes[t]=c,this._defineNestedModelAttribute(e,t,n,i),h!==void 0&&i.onChangeAttributeValue(t,c,h)})))})}_subscribeOnCollectionChanged(e,t,n,i){if(e._collectionSubscription.has(t)){const a=e._collectionSubscription.get(t);a.unsubscribe(),e._subscriptions.remove(a)}const r=new l.Subscription;r.add(n.changed.subscribe(()=>{i.onChangeAttributeValue(t,n,null)})),r.add(n.itemAttributeChanged.subscribe(()=>{i.onChangeAttributeValue(t,n,null)})),e._collectionSubscription.set(t,r),e._subscriptions.add(r)}_generateCalculatedAttribute(e,t,n,i){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateCalculatedAttribute.${t}`,()=>{this._attributeCreator.create(Iy,e?.[Mt])?.defineAttribute({viewModel:e,attribute:t,attributeConfig:n,generateOptions:i})})}_getCrtControlPropertiesConfig(e,t,n){const i=Object.entries(n.properties??[]).map(([r,a])=>({name:r,defaultValue:a.defaultValue,locked:a.locked===!0}));return this._addDataValueTypePropertyConfig(i,n),this._addMaskedPropertyConfig(e,t,i,n),this._disableSystemAttributes(e,t,i),i}_addDataValueTypePropertyConfig(e,t){t.dataValueTypeName&&e.push({name:Sy,defaultValue:_[t.dataValueTypeName]})}_addMaskedPropertyConfig(e,t,n,i){this._isNotAllowMaskedPropertyConfig(e,t,i)||(i.isValueMasked=!0,this._getOrCreatePropertyConfig(n,La),this._getOrCreatePropertyConfig(n,Ul),this._getOrCreatePropertyConfig(n,$l))}_isNotAllowMaskedPropertyConfig(e,t,n){const r=e.getBoundDataSchemaAttributeByAttributePath(t)?.isValueMasked,a=n.isValueMasked;return r&&a===!1||!r&&!a}_disableSystemAttributes(e,t,n){if(this._featureValues?.DisableBlockingSystemColumns===!0)return;if(e.getBoundDataSchemaAttributeByAttributePath(t)?.isSystem){const r=this._getOrCreatePropertyConfig(n,"readonly");r.locked=!0,r.defaultValue=!0}}_getOrCreatePropertyConfig(e,t){let n=this._findPropertyConfigByName(e,t);return n||(n={name:t},e.push(n)),n}_findPropertyConfigByName(e,t){return e.find(n=>n.name===t)}_generateModelAttribute(e,t,n,i){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateModelAttribute.${t}`,()=>{const r=e.attributes[t],a=n?.value,c=this._getCrtControlPropertiesConfig(e,t,n),h=Va.create({name:t,value:a,crtControlStateAdapter:this._crtControlStateAdapter,validatorTypeResolver:this._validatorTypeResolver,validatorsInfo:e._validators[t],propertiesConfig:c,injectionContext:e._injectionContext??Er(e)?._injectionContext,featureValues:this._featureValues});e._subscriptions.add(h.onChanged.subscribe(f=>{e.attributes[t]=f.value,i.onChangeAttributeValue(f.name,f.value,f.oldValue)})),e._subscriptions.add(h.onPropertyChanged.subscribe(({name:f,value:C,oldValue:S})=>{i.onChangeAttributeValue(`${t}:${f}`,C,S)})),e._crtControls.set(t,h),this._registerOrSetFormControl(e.formApiModel,t,h.formControl),e.attributes[t]=a??null;const p=e._getDataSourceAttributeDataValueType(t);this._attributeCreator.create(p).defineAttribute({viewModel:e,attribute:t,attributeConfig:n,control:h}),r!==void 0&&i.onChangeAttributeValue(t,a,r)})}_registerOrSetFormControl(e,t,n){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.registerOrSetFormControl.${t}`,()=>{if(this._featureValues?.DisableAttributeOnlyRegisteringControl){e.setControl(t,n);return}e.contains(t)?e.setControl(t,n):e.registerControl(t,n)})}_removeViewModelAttribute(e,t){return delete e._attributeConfigs[t],delete e.attributes[t],delete e[t],Promise.resolve()}generate(e,t,n){var i=this;return this._measurePerformanceService.measureCallback("BaseViewModelAttributeGenerator.generateAttributes",()=>Ir.deferUpdatingValueAndValidity(e,(0,b.A)(function*(){yield i._generateAttributes(e,t,n),!i._featureValues?.DisableAttributeOnlyRegisteringControl&&e.formApiModel.updateValueAndValidity()}),this._featureValues))}static{this.\u0275fac=function(t){return new(t||Tr)(s.\u0275\u0275inject(Ji),s.\u0275\u0275inject(gp),s.\u0275\u0275inject(Ar),s.\u0275\u0275inject(Ay),s.\u0275\u0275inject(qi),s.\u0275\u0275inject(Pr),s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Tr,factory:Tr.\u0275fac,providedIn:"root"})}}class Dr{_defineResourceAttribute(e,t,n,i,r){return new l.Observable(a=>{const c=e._getDataSourceAttributeCaption(i,r);if(this._defineResourceProperty(t,n,c),i.includes(".")){const h=i.split(".")[1];this._defineResourceProperty(t,h,c)}a.next(),a.complete()})}_defineResourceProperty(e,t,n){e[t]||Object.defineProperty(e,t,{get:()=>Promise.resolve(n??""),configurable:!0})}_getResourceNameByPath(e){const t=e.split(".");return t.length>1?t.join("_"):e}generate(e,t){return Object.entries(t||{}).map(([n,i])=>{const r=e[pr][ji.string],a=this._getResourceNameByPath(n);return this._defineResourceAttribute(e,r,a,n,i)})}static{this.\u0275fac=function(t){return new(t||Dr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Dr,factory:Dr.\u0275fac,providedIn:"root"})}}const Fa="HasUnsavedData",Or="IsChanged",Hl="PrimaryModelMode",Wl="BusinessRulesActivated",za="State";var Xt;(function(o){o.DebouncingBusinessRules="DebouncingBusinessRules",o.RunningBusinessRules="RunningBusinessRules",o.ProcessingAttributeChangeRequest="ProcessingAttributeChangeRequest",o.AttributeLoading="AttributeLoading"})(Xt||(Xt={}));var Zl;(function(o){o.Paused="Paused",o.Active="Active"})(Zl||(Zl={}));var W;(function(o){o.OwnAttribute="Own",o.ForwardReferenceAttribute="ForwardReference",o.BackReferenceAttribute="BackReference",o.AggregationAttribute="Aggregation",o.FunctionAttribute="Function"})(W||(W={}));var fp;(function(o){o[o.General=0]="General",o[o.Advanced=1]="Advanced",o[o.None=2]="None"})(fp||(fp={}));class Oy{}class Qt{get attributes(){return this._parent?[...this._parent.attributes,...this._attributes]:[...this._attributes]}get parent(){return this._parent}constructor(e){if(e!=null){this.name=e.name,this.type=e.type,e.caption&&(this.caption=typeof e.caption=="string"?e.caption:{...e.caption}),this.primaryAttributeName=e.primaryAttributeName,this.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this.primaryColorAttributeName=e.primaryColorAttributeName,this.hierarchyAttributeName=e.hierarchyAttributeName,this.createdByAttributeName=e.createdByAttributeName,this.createdOnAttributeName=e.createdOnAttributeName,this.modifiedByAttributeName=e.modifiedByAttributeName,this.modifiedOnAttributeName=e.modifiedOnAttributeName,e.dataSourceConfig&&(this.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig.config}}),this._parent=e.parent;const t=e.attributes??[];this._attributes=[],t.forEach(n=>{if(this._parent){this._parent.findAttributeByName(n.name)||this._attributes.push(n.clone());return}this._attributes.push(n.clone())})}else this._attributes=[]}clearAttributes(){this._attributes=[]}addAttribute(e){if(this._parent){this._parent.findAttributeByName(e.name)||this._attributes.push(e);return}this._attributes.push(e)}findAttributeByName(e){return this.attributes.find(t=>t.name===e)??null}getPrimaryAttributesNames(){return[this.primaryAttributeName]}getPrimaryLoadAttributes(){const e=[];return this.primaryAttributeName&&e.push(this.primaryAttributeName),this.primaryDisplayAttributeName&&e.push(this.primaryDisplayAttributeName),e}clone(){return new Qt(this)}createChild(){const e=new Qt;return e.name=this.name,e.type=this.type,this.caption&&(e.caption=typeof this.caption=="string"?this.caption:{...this.caption}),e.primaryAttributeName=this.primaryAttributeName,e.primaryDisplayAttributeName=this.primaryDisplayAttributeName,e.primaryColorAttributeName=this.primaryColorAttributeName,e.hierarchyAttributeName=this.hierarchyAttributeName,e.createdByAttributeName=this.createdByAttributeName,e.createdOnAttributeName=this.createdOnAttributeName,e.modifiedByAttributeName=this.modifiedByAttributeName,e.modifiedOnAttributeName=this.modifiedOnAttributeName,this.dataSourceConfig&&(e.dataSourceConfig={...this.dataSourceConfig,config:{...this.dataSourceConfig.config}}),e._attributes=[],e._parent=this,e}}class _p extends Error{get isCritical(){return!0}constructor(e,t){super(t),this.dataSource=e}}class Yl extends _p{constructor(e,t){super(e,t)}}class Ry extends _p{get isCritical(){return!1}constructor(e,t){super(e,t)}}class Kl{constructor(e,t){this.dataSourceName=e,this.injector=t,this._errors=[],this.supportTransactions=!1}get scope(){return this._scope}get hasErrors(){return this._errors.length!==0}get hasCriticalErrors(){return this._errors.some(e=>e.isCritical)}get affectedAttributes(){return[]}get isForceUpdateUnchangedData(){return!1}getLastError(){return this.hasErrors?this._errors[this._errors.length-1]:null}get isAggregate(){return!1}getEmptySchema(){return new Qt}init(e,t){return this.initialConfig=e,this._scope=t,(0,l.of)(this)}load(e,t,n){return this.innerLoad(e,t,n)}save(e,t){return this.innerSave(e,t)}insert(e){return this.innerInsert(e)}delete(e){return this.innerDelete(e)}getSchema(){return this.dataSchema?(0,l.of)(this.dataSchema):this.innerGetSchema().pipe((0,d.tap)(e=>{this.dataSchema=e}))}getLookupDataSchema(e){return this.innerGetLookupDataSchema(e)}getDefaultValues(){return this.innerGetDefaultValues()}canEdit(e){return this.innerCanEdit(e)}canDelete(e){return this.innerCanDelete(e)}canCreate(e){return this.innerCanCreate(e)}getOwnLoadParameters(){return null}getAllowCopyingRecords(){return!1}}const yp="crt.EntityDataSource",Cp="crt.PageParametersDataSource",lw="PageParameters",jy=new s.InjectionToken("COPILOT_INTENT_REPOSITORY_TOKEN");class bp{static{this._codeCharactersRegex=new RegExp("^[A-Za-z0-9\\s_]*$")}static{this._wordsMatchRegex=new RegExp(/\w+/g)}static generateCode(e,t=-1){const i=(e.match(this._wordsMatchRegex)||[]).filter(r=>r.length!==0).map(r=>r[0].toUpperCase()+r.substring(1)).join("");return t>=0?i.slice(0,t):i}static isTextUsableForCodeGeneration(e){return this._codeCharactersRegex.test(e)}}class Rr{constructor(){this._sysSettingsService=(0,s.inject)(Ge),this._defaultCodeMaxLength=41}_checkCodeIsUnique(e,t){return e?!e.includes(t):!0}_generateCode(e){const{prefix:t,options:n,generateFromName:i,name:r}=e,{codeMaxLength:a,defaultNewCode:c}=n;if(i){if(!bp.isTextUsableForCodeGeneration(r))return null;const h=t+c,p=(a??this._defaultCodeMaxLength)-h.length,m=bp.generateCode(r,p);return h+m}return Od.generateUnique(c,t)}generate(e,t,n){const i={generateFromName:!!t,name:t,prefix:null,options:n};return(0,l.from)(this._sysSettingsService.getByCode("SchemaNamePrefix")).pipe((0,l.map)(r=>r.value),(0,l.tap)(r=>i.prefix=r),(0,l.repeat)(i.generateFromName?1:void 0),(0,l.map)(()=>this._generateCode(i)),(0,l.filter)(r=>this._checkCodeIsUnique(e,r)),(0,l.take)(1),(0,l.defaultIfEmpty)(null))}static{this.\u0275fac=function(t){return new(t||Rr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Rr,factory:Rr.\u0275fac})}}class jr{constructor(){this._designItems=new Map}getDesignItem(e){return this._designItems.get(e)}getDesignItems(){return Array.from(this._designItems.values())}setDesignItem(e){this._designItems.set(e.UId,e)}static{this.\u0275fac=function(t){return new(t||jr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:jr,factory:jr.\u0275fac})}}class Un{constructor(){this._repository=(0,s.inject)(jy),this._copilotCodeGenerator=(0,s.inject)(Rr),this._designRepository=(0,s.inject)(jr)}_loadIntentUIdByActionUId(e){return(0,l.from)(qt.create("CopilotAction")).pipe((0,l.switchMap)(t=>t.load({attributes:["Intent"],parameters:[{type:j.Filter,value:new tt(K.Equal,new X({columnPath:"Id"}),new ae({value:e}))}]})),(0,l.map)(t=>{const n=t[0]||{};return(0,v.isEmpty)(n)?null:n.Intent?.value}))}_applyActionToIntent(e,t){const i=(e.Actions||[]).findIndex(a=>a.Id===t.Id);if(i===-1)return!1;const r=e.Actions[i];return e.Actions.splice(i,1,{...r,...t}),!0}_applyParameterToIntent(e,t){const n=t.SourceCollection==="InputParameters"?e.InputParameters:e.OutputParameters,i=n.findIndex(r=>r.UId===t.UId);return i!==-1?(n.splice(i,1,{...n[i],...t}),!0):!1}_getSuccessResponse(){return{success:!0}}_getSuccessResponseObservable(){return(0,l.of)(this._getSuccessResponse())}_getDesignIntent(e){return(0,l.of)(this._designRepository.getDesignItem(e))}_getDesignIntents(){return Array.from(this._designRepository.getDesignItems())}_setDesignIntent(e){this._designRepository.setDesignItem(e)}_getIntentByParameterUId(e){for(const t of this._getDesignIntents()){if(t.InputParameters.find(r=>r.UId===e))return(0,l.of)({intent:t,sourceCollection:"InputParameters"});if(t.OutputParameters.find(r=>r.UId===e))return(0,l.of)({intent:t,sourceCollection:"OutputParameters"})}return(0,l.of)({})}getIntent(e){return this._repository.get(e).pipe((0,l.tap)(t=>{this._setDesignIntent(t)}))}getAllSkills(){return this._repository.getAllCodes("CopilotIntent")}getAllAgents(){return this._repository.getAllCodes("CopilotAgent")}getIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,l.map)(({intent:t,sourceCollection:n})=>n==="InputParameters"?t.InputParameters:t.OutputParameters),(0,l.map)(t=>t.find(n=>n.UId===e)))}getIntentParameters(e,t){return this._getDesignIntent(e).pipe((0,l.map)(n=>t==="InputParameters"?n.InputParameters:n.OutputParameters))}updateIntentParameter(e){return this._getIntentByParameterUId(e.UId).pipe((0,l.switchMap)(({intent:t,sourceCollection:n})=>(e.SourceCollection=n,this._applyParameterToIntent(t,e)?this._getSuccessResponseObservable():this._getSuccessResponseObservable())))}createIntentParameter(e){return this._getDesignIntent(e.Intent.value).pipe((0,l.map)(t=>((e.SourceCollection==="InputParameters"?t.InputParameters:t.OutputParameters).push(e),this._getSuccessResponse())))}deleteIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,l.map)(({intent:t,sourceCollection:n})=>{const i=n==="InputParameters"?t?.InputParameters:t?.OutputParameters,r=(i??[]).findIndex(a=>a.UId===e);return r!==-1&&i.splice(r,1),t}),(0,l.switchMap)(t=>this._repository.update(t)))}createIntent(e){return this._repository.create(e.UId).pipe((0,l.map)(t=>(Object.assign(t,e),t)),(0,l.switchMap)(t=>this._repository.update(t)))}updateIntent(e){return(0,l.forkJoin)([this._getDesignIntent(e.UId),this._repository.get(e.UId)]).pipe((0,l.map)(([t,n])=>{const i={...n,...t,...e};return this._setDesignIntent(i),i}),(0,l.switchMap)(t=>this._repository.update(t)))}createAction(e){return this._repository.get(e.Intent.value).pipe((0,l.map)(t=>(t.Actions.push(e),t)),(0,l.switchMap)(t=>this._repository.update(t)))}createSubIntent(e,t){return this._repository.createSubIntent(e,t)}deleteSubIntent(e,t){return this._repository.deleteSubIntent(e,t)}getActionByUId(e){return this._loadIntentUIdByActionUId(e).pipe((0,l.switchMap)(t=>t?this._repository.get(t).pipe((0,l.map)(n=>n.Actions.filter(i=>i.Id===e)),(0,l.map)(n=>n[0])):(0,l.of)({})))}getIntentByActionUId(e){return this.getActionByUId(e).pipe((0,l.switchMap)(t=>t?.Intent?this.getIntent(t.Intent.value):(0,l.of)({})))}updateAction(e){return this._loadIntentUIdByActionUId(e.Id).pipe((0,l.switchMap)(t=>this._repository.get(t).pipe((0,l.switchMap)(n=>this._applyActionToIntent(n,e)?this._repository.update(n):(0,l.of)({})))))}generateActionCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Action"})}generateSkillCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Skill"})}generateAgentCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Agent"})}deleteAction(e,t){return this._repository.get(e).pipe((0,l.map)(n=>(n.Actions=n.Actions.filter(i=>i.Id!==t),n)),(0,l.switchMap)(n=>this._repository.update(n)))}static{this.\u0275fac=function(t){return new(t||Un)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Un,factory:Un.\u0275fac})}}var Jl;(function(o){o[o.None=0]="None",o[o.Self=1]="Self",o[o.ExplicitEntry=2]="ExplicitEntry",o[o.Delegated=4]="Delegated",o[o.FuncRoleFromOrgRole=8]="FuncRoleFromOrgRole",o[o.UpHierarchy=16]="UpHierarchy",o[o.AsManager=32]="AsManager",o[o.All=63]="All"})(Jl||(Jl={}));var ql;(function(o){o.None="",o.Count="Count",o.Sum="Sum",o.Avg="Avg",o.Min="Min",o.Max="Max",o.TopOne="TopOne"})(ql||(ql={}));const Xl="rights-cache",uw={provide:Vs,useValue:{name:Xl,type:ce.PersistentAndMemory,options:{tableName:$e.Rights}},multi:!0};class ky{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class Ny extends ky{constructor(){super(...arguments),this.httpClient=(0,s.inject)(U.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const n=this.getFromCache(t);if((0,v.isUndefined)(n)){const i=e().pipe((0,l.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,i),i}return n}getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const n=this.getMethodEndpoint(e),i=this._createCacheKey(e,t),r=()=>this.httpClient.post(n,t);return this._cacheRequest(r,i)}executeGetRequestWithCache(e){const t=this.getMethodEndpoint(e),n=this._createCacheKey(e),i=()=>this.httpClient.get(t);return this._cacheRequest(i,n)}resetCache(e,t={}){const n=this._createCacheKey(e,t);this.deleteFromCache(n)}}let Ql=class Vo extends Ny{constructor(){super(...arguments),this._persistentCache=null,this._cacheManager=(0,s.inject)(Ce),this._measurePerformanceService=(0,s.inject)(q),this._useSystemClientCache=(0,s.inject)(Bc,{optional:!0})??!1,this.serviceEndpoint="rest/RightsService"}_getPersistentCacheInstance(){return this._persistentCache?(0,l.of)(this._persistentCache):(0,l.from)(this._cacheManager.getOrCreate({name:Xl,type:ce.Memory})).pipe((0,d.tap)(e=>this._persistentCache=e))}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,d.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,d.map)(n=>({result:n&&n.GetCanDeleteResult?.length===0,message:n?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(i=>this.getFromCache(`GetCanAdd_${i}`)).filter(i=>!!i),n=e.filter(i=>!t.find(r=>r.schemaName===i));return{cachedResult:t,requestSchemaNames:n}}_internalGetExecuteOperation(e){return this._cacheManager.executeWithCache(Xl,e,this.httpClient.post(this.getMethodEndpoint("GetCanExecuteOperation"),{operation:e}).pipe((0,d.map)(t=>t?.GetCanExecuteOperationResult))).pipe(this._measurePerformanceService.measure$("RightsService: get execute operation with cache"))}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,d.mergeMap)(t=>(0,l.of)((t||[])[0])))}getCanExecuteOperations(e){return this._useSystemClientCache?this._getPersistentCacheInstance().pipe((0,d.switchMap)(t=>t.getAll()),(0,d.switchMap)(t=>{const n=e.map(i=>{const r=t.find(a=>a.key===i);return r?(0,l.of)(r.value):this._internalGetExecuteOperation(i)});return(0,l.combineLatest)(n)})):(0,l.combineLatest)(e.map(t=>this._internalGetExecuteOperation(t)))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,d.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:n,requestSchemaNames:i}=this._getCanAddData(e);if(!i.length)return(0,l.of)(n);const r=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(r,i).pipe((0,d.map)(a=>a.map(c=>({schemaName:c.Key,result:(0,v.isEmpty)(c.Value),errorMessage:c.Value}))),(0,d.tap)(a=>a.forEach(c=>this.setToCache(`${t}_${c.schemaName}`,c))),(0,d.map)(a=>a.concat(n)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,d.map)(n=>({result:n&&n.GetCanEditResult?.length===0,message:n?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,d.map)(t=>{const n=t?.GetCanEditColumnsResult??[],i={};return n.forEach(r=>i[r.Key]=r.Value),i}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,d.map)(t=>{const n=t?.GetCanReadColumnsResult??[],i={};return n.forEach(r=>i[r.Key]=r.Value),i}))}getCanExecuteEntityOperation(e,t){const n=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,i={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(n,i).pipe((0,d.mergeMap)(r=>(0,l.of)(r?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,l.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}applyChanges(e){const t=`${this.serviceEndpoint}/ApplyChanges`;return(0,l.firstValueFrom)(this.httpClient.post(t,e)).then(()=>!0,n=>{throw console.error(`Error while making request to ApplyChanges: ${n}`),n})}getRecordRights(e){return(0,l.firstValueFrom)(this.executePostRequestWithCache("GetRecordRights",e)).then(t=>t,t=>{throw console.error(`Error while making request to GetRecordRights: ${t}`),t})}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Vo)))(n||Vo)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Vo,factory:Vo.\u0275fac,providedIn:"root"})}};Ql=(0,u.__decorate)([Xe({requestType:"crt.RightsService"})],Ql);function vp(o,e){switch(B.checkArgumentEmpty("dataValueType",e),e){case _.Date:case _.Time:case _.DateTime:return xh(o);default:return o}}function Vy(o,e){if(ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),!o)return o;const t={};return Object.keys(o).forEach(n=>{const i=o[n];t[n]=e[n]?vp(i,e[n]):i}),t}function dw(o,e){return ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),o&&o.map(t=>t&&Vy(t,e))}var Xi;(function(o){o.Entity="Entity",o.ClientUnit="ClientUnit",o.Intent="Intent"})(Xi||(Xi={}));class $n{constructor(){this._phoneUtil=null,this._phoneNumberType=null,this._phoneMaskOverrides=new Map([["id",["+{62} 000 000 000 000","+{62} 000 000 00"]]])}getAllPhoneMasks(e){let t=[];for(const i in this._phoneNumberType)if(isNaN(Number(i))){const r=this._phoneUtil.getExampleNumberForType(e,this._phoneNumberType[i]);if(!r)continue;const a=r.getCountryCode().toString(),c=this._phoneUtil.format(r,null),h=`+{${a.replace("0","\\0")}} ${c.replace(/-/g," ").replace(/\d/g,"0")}`;t.find(p=>p===h)||t.push(h)}const n=this._phoneMaskOverrides.get(e);return n&&(t.push(...n),t=Array.from(new Set(t))),t}initialize(){var e=this;return(0,b.A)(function*(){if(!(e._phoneUtil&&e._phoneNumberType))try{const t=yield y.e(1588).then(y.t.bind(y,1588,23));e._phoneUtil=t.PhoneNumberUtil.getInstance(),e._phoneNumberType=t.PhoneNumberType}catch(t){throw console.error("Error loading google-libphonenumber:",t),t}})()}isValidPhoneNumber(e){if(!this._phoneUtil)return!0;try{const t=this._phoneUtil.parse(e);return this._phoneUtil.isValidNumber(t)}catch{return!1}}static{this.\u0275fac=function(t){return new(t||$n)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:$n,factory:$n.\u0275fac,providedIn:"root"})}}const eu={ShortTextCaption:50,MediumTextCaption:250,LongTextCaption:500},Ua={Integer:{max:2147483647,min:-2147483647},Float:{max:6999999999999999e-2,min:-6999999999999999e-2}};function Ly(o){let e;switch(o){case _.SHORT_TEXT:e=eu.ShortTextCaption;break;case _.PHONE_TEXT:case _.MEDIUM_TEXT:e=eu.MediumTextCaption;break;case _.LONG_TEXT:case _.EMAIL_TEXT:e=eu.LongTextCaption;break;default:return}return{maxLength:e}}function By(o){if([_.Float,_.FLOAT0,_.FLOAT1,_.FLOAT2,_.FLOAT3,_.FLOAT4,_.FLOAT8,_.MONEY0,_.MONEY1,_.Money,_.MONEY3].includes(o))return{minValue:Ua.Float.min,maxValue:Ua.Float.max};if(o===_.Integer)return{minValue:Ua.Integer.min,maxValue:Ua.Integer.max}}class kr{get isDate(){return this.dataValueType===_.Date||this.dataValueType===_.DateTime||this.dataValueType===_.Time}get isImage(){return this.dataValueType===_.IMAGELOOKUP||this.dataValueType===_.Image}get isLookup(){return this.dataValueType===_.Lookup}set isSystem(e){this._isSystem=e}get isSystem(){return this._isSystem}get isAggregate(){return this.attributeType===W.AggregationAttribute?!0:this.attributeType===W.FunctionAttribute&&this.functionConfig?.type==="aggregation"}constructor(e){if(this._isSystem=!1,e!=null){this.name=e.name,this.caption=e.caption,this.path=e.path,this.dataValueType=e.dataValueType,e.validators&&(this.validators={...e.validators||{}});const t=e.defaultValue;t&&(t instanceof l.Observable?this.defaultValue=t.pipe((0,d.map)(n=>this._getConvertDefaultValue(n))):this.defaultValue=(0,l.of)(this._getConvertDefaultValue(t))),this.defaultValueSchema=e.defaultValueSchema,this.isValueCloneable=e.isValueCloneable,this.attributeType=e.attributeType,this.referenceSchemaName=e.referenceSchemaName,this.functionConfig=e.functionConfig,this.aggregationConfig=e.aggregationConfig,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.usageType=e.usageType,this.isRequired=e.isRequired,this.lookupMode=e.lookupMode,this.isSystem=!!e.isSystem,this.useSeconds=e.useSeconds}}_getConvertDefaultValue(e){if(this.isDate)if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}else return e;else return typeof e=="object"?{...e}:e}clone(){return new kr(this)}addDefaultValidators(){const e=this.validators??{};this.isRequired&&(e["crt.Required"]={type:"crt.Required"}),!this.validators&&Object.keys(e).length>0&&(this.validators=e)}}class Sp{constructor(e=null,t,n){e==null?this._dataSchema=new Qt:this._dataSchema=t?.useClone?e.clone():e.createChild(),this._phoneValidationService=n||s.Injector.create({providers:[{provide:$n,useClass:$n}]}).get($n)}_createDataSchemaAttributeByConfig(e){const t=new kr;return t.name=e.name,t.caption=e.caption,t.path=e.path,t.dataValueType=e.dataValueType,t.validators={...e.validators||{}},t.defaultValue=(0,l.of)(typeof e.defaultValue=="object"?{...e.defaultValue}:e.defaultValue),t.defaultValueSchema=e.defaultValueSchema,t.isValueCloneable=e.isValueCloneable,t.attributeType=e.attributeType,t.referenceSchemaName=e.referenceSchemaName,t.functionConfig=e.functionConfig,t.aggregationConfig=e.aggregationConfig,t.usageType=e.usageType,t.isMasked=e.isMasked,t.isFormatValidated=e.isFormatValidated,t.isSensitiveData=e.isSensitiveData,t.isValueMasked=e.isValueMasked,t.valueMaskingSettings=e.valueMaskingSettings,t.isRequired=e.isRequired,t.lookupMode=e.lookupMode,t.isSystem=e.isSystem??!1,t.useSeconds=e.useSeconds??!1,t}setEntitySchemaColumnValidators(e,t){return e.isRequired&&this.setAttributeRequiredValidator(t),this.setAttributeTextDataValueTypeValidator(t,e.dataValueType).setAttributeNumberDataValueTypeValidator(t,e.dataValueType).setAttributePhoneDataValueTypeValidator(t,e)}setAttributeValidator(e,t,n){const i=this._dataSchema.attributes.find(a=>a.name===e),r=i.validators||{};return r[t]=n,i.validators=r,this}setAttributeRequiredValidator(e){return this.setAttributeValidator(e,"crt.Required",{type:"crt.Required"})}setAttributeMaxLengthValidator(e,t){return this.setAttributeValidator(e,"crt.MaxLength",{type:"crt.MaxLength",params:{maxLength:t}})}setAttributeTextDataValueTypeValidator(e,t){const n=Ly(t);return n?this.setAttributeMaxLengthValidator(e,n.maxLength):this}setAttributeMinValueValidator(e,t){return this.setAttributeValidator(e,"crt.Min",{type:"crt.Min",params:{min:t}})}setAttributeMaxValueValidator(e,t){return this.setAttributeValidator(e,"crt.Max",{type:"crt.Max",params:{max:t}})}setAttributeMinMaxValidator(e,t,n){return this.setAttributeMinValueValidator(e,t).setAttributeMaxValueValidator(e,n)}setAttributeNumberDataValueTypeValidator(e,t){const n=By(t);return n&&this.setAttributeMinMaxValidator(e,n.minValue,n.maxValue),this}setAttributePhoneDataValueTypeValidator(e,t){return[_.PHONE_TEXT].includes(t.dataValueType)&&t.isMasked&&(this._phoneValidationService.initialize().then(),this.setAttributeValidator(e,"crt.PhoneNumber",{type:"crt.PhoneNumber"})),this}setAttributesDefaultValue(e){return this._dataSchema.attributes.forEach(t=>{t.defaultValue=e.pipe((0,d.map)(n=>n[t.name]))}),this}addAttribute(e,t){const{name:n,caption:i,dataValueType:r,isValueCloneable:a,referenceSchemaName:c,isMasked:h,isFormatValidated:p,usageType:m,isRequired:f,isSensitiveData:C,isValueMasked:S,valueMaskingSettings:w}=e,E=new kr;return E.name=t.attributeName||n,E.path=t.attributePath||n,E.caption=i,E.dataValueType=r,E.isValueCloneable=!!a,E.attributeType=t.attributeType||W.OwnAttribute,E.referenceSchemaName=c,E.validators={},E.isMasked=h,E.isFormatValidated=p,E.isSensitiveData=C,E.isValueMasked=S,E.valueMaskingSettings=w,E.usageType=m,E.isRequired=f,E.defaultValueSchema=e.defaultValueSchema,E.lookupMode=e.lookupMode,E.useSeconds=e.useSeconds,E.isSystem=(0,v.compact)([this._dataSchema.createdByAttributeName,this._dataSchema.createdOnAttributeName,this._dataSchema.modifiedByAttributeName,this._dataSchema.modifiedOnAttributeName,this._dataSchema.primaryAttributeName,"ProcessListeners"]).includes(E.name),this._dataSchema.addAttribute(E),t.attributeType===W.OwnAttribute&&this.setEntitySchemaColumnValidators(e,E.name),t.attributeType===W.AggregationAttribute&&(E.aggregationConfig=t.aggregationConfig),t.attributeType===W.FunctionAttribute&&(E.functionConfig=t.functionConfig),this}addOwnAttribute(e){return this.addAttribute(e,{attributeType:W.OwnAttribute})}setEntitySchema(e){return this._dataSchema.dataSourceConfig={type:"crt.EntityDataSource",config:{entitySchemaName:e.name}},this._dataSchema.name=e.name,this._dataSchema.type=Xi.Entity,this._dataSchema.primaryAttributeName=e.getPrimaryColumn()?.name,this._dataSchema.primaryDisplayAttributeName=e.getPrimaryDisplayColumn()?.name,this._dataSchema.primaryColorAttributeName=e.getPrimaryColorColumn()?.name,this._dataSchema.hierarchyAttributeName=e.getHierarchyColumn()?.name,this._dataSchema.caption=e.caption,this._dataSchema.createdByAttributeName=e.columns.find(t=>t.uId===e.createdByColumnUId)?.name,this._dataSchema.createdOnAttributeName=e.columns.find(t=>t.uId===e.createdOnColumnUId)?.name,this._dataSchema.modifiedByAttributeName=e.columns.find(t=>t.uId===e.modifiedByColumnUId)?.name,this._dataSchema.modifiedOnAttributeName=e.columns.find(t=>t.uId===e.modifiedOnColumnUId)?.name,this._dataSchema.clearAttributes(),e.columns.forEach(t=>{this.addOwnAttribute(t)}),this}setDataSchemaConfig(e){return this._dataSchema.name=e.name,this._dataSchema.type=e.type,this._dataSchema.caption=typeof e.caption=="string"?e.caption:{...e.caption},this._dataSchema.primaryAttributeName=e.primaryAttributeName,this._dataSchema.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this._dataSchema.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig?.config}},(e.attributes||[]).forEach(n=>{const i=this._createDataSchemaAttributeByConfig(n);this._dataSchema.addAttribute(i)}),this}build(){return this._dataSchema.clone()}}class Fy extends Yl{get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,`Entity schema with name '${t}' not found.`),this._entitySchemaName=t}}class zy extends Yl{constructor(e){super(e,`Entity schema name for data source ${e.dataSourceName} is not provided`)}}function Uy(o){switch(o){case"asc":return ui.Asc;case"desc":return ui.Desc;default:return ui.None}}const $y=new s.InjectionToken("A factory of entity schema column appender"),Gy=new s.InjectionToken("A factory of data schema to data source attribute converter");class Hy{_getExpressionColumnPath(e,t){const n="[{referenceSchemaName}:{referenceAttributeName}:{attributeName}]",i=e.relationData.map(p=>ca.String.format(n,p)).join("."),r=e.attributePath.split("."),a=r.length>1?"{ownColumnPath}.{relationString}.{columnPath}":"{relationString}.{columnPath}";r.pop();const h={ownColumnPath:r.join("."),relationString:i,columnPath:t};return ca.String.format(a,h)}_updateFilterLeftExpression(e,t){switch(e.expressionType){case Se.SchemaColumn:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case Se.SubQuery:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case Se.Function:e.functionType!==xe.Macros&&this._updateFilterLeftExpression(e.functionArgument,t);break}}_updateRelatedFilterGroup(e,t){e instanceof Ee?this._updateRelatedFilterGroupInstance(e,t):this._updateRelatedFilterGroupObject(e,t)}_updateRelatedFilterGroupObject(e,t){Object.values(e.items).forEach(n=>{this._updateRelatedFilter(n,t)})}_updateRelatedFilterGroupInstance(e,t){e.filters.forEach(n=>this._updateRelatedFilter(n,t))}_updateRelatedFilter(e,t){if(e.filterType!==ee.FilterGroup){const n=e.leftExpression;n&&this._updateFilterLeftExpression(n,t)}else this._updateRelatedFilterGroup(e,t)}convertToRelatedFilter(e,t=[]){if(!e)return e;let n;if(e instanceof Is)n=e.clone();else{const i=JSON.stringify(e);n=JSON.parse(i)}return[...t].reverse().forEach(i=>{i.relationData&&i.relationData.length!==0&&this._updateRelatedFilter(n,i)}),n}}const Wy="invalidate-data-schema-cache";class en{constructor(e,t){this._entitySchemaRepository=e,this._broadcastChannelFactory=t,this._dataSchemas=new Map,this._subscribeOnChangesInDesigner()}_subscribeOnChangesInDesigner(){this._broadcastChannelFactory.createInstance(Wy).messages$.subscribe(({schemaName:e})=>{this._removeCachedSchema(e)})}_createEntityDataSchema(e){const t=new Sp;return t.setEntitySchema(e),(0,l.of)(t.build())}_getEntityDataSchema(e){return this._entitySchemaRepository.getSchemaByName(e).pipe((0,d.switchMap)(t=>this._createEntityDataSchema(t)))}_removeCachedSchema(e){this._dataSchemas.has(e)&&(this._dataSchemas.delete(e),this._entitySchemaRepository.clearSchemaCacheByName(e))}get(e){return this._dataSchemas.has(e)?(0,l.of)(this._dataSchemas.get(e)):this._getEntityDataSchema(e).pipe((0,d.tap)(t=>this._dataSchemas.set(e,t)))}getByEntitySchema(e){const t=e.name;return this._dataSchemas.has(t)?(0,l.of)(this._dataSchemas.get(t)):this._createEntityDataSchema(e).pipe((0,d.tap)(n=>this._dataSchemas.set(t,n)))}static{this.\u0275fac=function(t){return new(t||en)(s.\u0275\u0275inject(rt),s.\u0275\u0275inject(ri))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:en,factory:en.\u0275fac,providedIn:"platform"})}}class Nr{constructor(e,t){this._dataSchemaRepository=e,this._featureValues=t}_getDataSchema(e){var t=this;return(0,b.A)(function*(){const n=yield(0,l.firstValueFrom)(t._dataSchemaRepository.get(e));if(!n)throw new Error(`Can not find DataSchema with name '${e}'`);return n})()}_getDataSchemaAttribute(e,t){var n=this;return(0,b.A)(function*(){const i=e instanceof Qt?e:yield n._getDataSchema(e),r=i.findAttributeByName(t);if(!r)throw new Error(`Can not find column '${t}' in Schema '${i.name}'`);return r})()}_getDataSchemaPrimaryAttribute(e){var t=this;return(0,b.A)(function*(){const n=yield t._getDataSchema(e);return t._getDataSchemaAttribute(n,n.primaryAttributeName)})()}_createRelationPathItemFromForwardPathItem(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._getDataSchemaAttribute(e,t);let r=null,a=null;const c=i.dataValueType===_.Lookup;return c&&(r=i.referenceSchemaName,a=(yield n._getDataSchema(r)).primaryAttributeName),{isJoin:c,referenceSchemaName:r,referenceAttributeName:a,ownSchemaAttributeName:t,ownSchemaName:e}})()}_createRelationPathItemFromJoinPathItem(e,t,n,i){var r=this;return(0,b.A)(function*(){const a=n?yield r._getDataSchemaAttribute(t,n):yield r._getDataSchemaPrimaryAttribute(t);return{isJoin:!0,referenceSchemaName:t,referenceAttributeName:a.name,ownSchemaAttributeName:i,ownSchemaName:e}})()}_createRelationPathItem(e,t){const i=/(?<joinType>.*)\[(?<refSchema>.*?):(?<ownColumn>.*?)(?::(?<refColumn>.*))?]/.exec(t);if(i){const r=i.groups;return this._createRelationPathItemFromJoinPathItem(e,r.refSchema,r.refColumn,r.ownColumn)}return this._createRelationPathItemFromForwardPathItem(e,t)}_getReverseRelationPath(e){const t=[...e],n=[];let i;for(;(i=t.pop())!=null;)n.push({isJoin:!0,ownSchemaName:i.referenceSchemaName,ownSchemaAttributeName:i.referenceAttributeName,referenceSchemaName:i.ownSchemaName,referenceAttributeName:i.ownSchemaAttributeName});return n}_buildRelationPath(e,t){var n=this;return(0,b.A)(function*(){const i=t.split("."),r=[];let a=e;for(const c of i){const h=yield n._createRelationPathItem(a,c);a=h.referenceSchemaName,r.push(h)}return r})()}_getRelationPathToSourceSchema(e,t,n){var i=this;return(0,b.A)(function*(){const r=[...t],a=r.pop(),c=n.split("."),p=(yield i._buildRelationPath(e,n)).pop(),m={isJoin:!0,ownSchemaName:a.isJoin?a.referenceSchemaName:a.ownSchemaName,ownSchemaAttributeName:a.isJoin?a.referenceAttributeName:a.ownSchemaAttributeName,referenceSchemaName:p.ownSchemaName,referenceAttributeName:c.pop()},f=[...r,...a.isJoin?[a]:[],m];return i._featureValues.DisableDsDepsJoinOptimization||f.length===1?f:f.filter(C=>{if(!C.isJoin)return!0;const S=C.ownSchemaName===C.referenceSchemaName,w=C.ownSchemaAttributeName===C.referenceAttributeName;return!(S&&w)})})()}_buildRelationDataFromPath(e){return e.map(t=>({attributeName:t.ownSchemaAttributeName,referenceAttributeName:t.referenceAttributeName,referenceSchemaName:t.referenceSchemaName}))}_getDataSourceParameterRelationData(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._buildRelationPath(t.dataSchemaName,t.relationPath),r=yield n._getRelationPathToSourceSchema(e,i,t.attributePath),a=n._getReverseRelationPath(r);return n._buildRelationDataFromPath(a)})()}_getIsSelfSchemaRelation(e,t){return!this._featureValues.DisableSkipDSEqualRelations&&t.dataSchemaName===e&&t.attributePath===t.relationPath&&t.attributePath.split(".").length===1}_convertEntityDataSourceParameter(e,t){var n=this;return(0,b.A)(function*(){if(!t.relationsConfigs||t.relationsConfigs.length===0)return t;let i=e.name;const r=[];for(const a of t.relationsConfigs){if(n._getIsSelfSchemaRelation(i,a)){a.attributePath===e.primaryAttributeName||r.push({...a,relationData:[{referenceSchemaName:a.dataSchemaName,attributeName:a.attributePath,referenceAttributeName:a.relationPath}]});continue}const h=yield n._getDataSourceParameterRelationData(i,a);i=h[h.length-1].referenceSchemaName,r.push({...a,relationData:h})}return{...t,relationsConfigs:r}})()}convert(e,t,n=!1){return t.length===0?Promise.resolve([]):n?Promise.resolve(t):Promise.all(t.map(i=>this._convertEntityDataSourceParameter(e,i)))}static{this.\u0275fac=function(t){return new(t||Nr)(s.\u0275\u0275inject(en),s.\u0275\u0275inject(Q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Nr,factory:Nr.\u0275fac,providedIn:"root"})}}class Qi{constructor(e,t){this._dataSchemaRepository=e,this._parametersConverter=t}_createPrimaryColumnValueFilter(e,t){const r=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(r).pipe((0,l.map)(a=>{const c=new X({columnPath:a.primaryAttributeName}),h=new ae({value:t.value});return new tt(K.Equal,c,h)}))}_createColumnValueFilter(e){const t=e.value.attributePath,n=e.value.attributeValue,i=new X({columnPath:t}),r=new ae({value:n}),a=new tt(K.Equal,i,r);return(0,l.of)(a)}_createPrimaryDisplayValueFilter(e,t){const r=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(r).pipe((0,l.map)(a=>{const c=new X({columnPath:a.primaryDisplayAttributeName}),h=new ae({value:t.value});return new tt(t.comparisonType,c,h)}))}_createCustomFilter(e){let t={};return e.value&&(t=typeof e.value=="string"?JSON.parse(e.value):e.value),(0,l.of)(t)}_createEmptyParameterFiler(e){const t=e.relationsConfigs||[];if(t.length===0)return(0,l.of)({});const n=t[0];return this._dataSchemaRepository.get(n.dataSchemaName).pipe((0,l.map)(i=>i.primaryAttributeName),(0,l.map)(i=>{const r=new X({columnPath:i});return new gn(r,null)}))}_createEsqFilter(e,t){switch(t.type){case j.PrimaryColumnValue:return this._createPrimaryColumnValueFilter(e,t);case j.ColumnValue:return this._createColumnValueFilter(t);case j.PrimaryDisplayValueFilter:return this._createPrimaryDisplayValueFilter(e,t);case j.Filter:return this._createCustomFilter(t);case j.Empty:return this._createEmptyParameterFiler(t)}}applyParameters(e,t){if(e.length===0)return(0,l.of)(t);const n=e.map(i=>this._createEsqFilter(t.rootSchemaName,i).pipe((0,l.map)(r=>new Hy().convertToRelatedFilter(r,i.relationsConfigs))));return(0,l.forkJoin)(n).pipe((0,l.tap)(i=>{i.forEach(r=>{(0,v.isEmpty)(r)||t.filters.add(r)})}),(0,l.map)(()=>t))}convertToEntityDataSourceParameters(e,t,n=!1){return(0,l.from)(this._parametersConverter.convert(e,t,n))}static{this.\u0275fac=function(t){return new(t||Qi)(s.\u0275\u0275inject(en),s.\u0275\u0275inject(Nr))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Qi,factory:Qi.\u0275fac,providedIn:"root"})}}class Vr{constructor(e,t,n){this.entitySchemaQueryUtils=e,this._entitySchemaColumnAppenderFactory=t,this._dataSchemaToDataSourceAttributeConverter=n}_addPagingToEsq(e,t){t&&(e.rowsOffset=t.rowsOffset,e.rowCount=t.rowCount)}_addSortingToEsq(e,t){t&&t.columns.forEach((n,i)=>{const r=e.findColumn(n.columnName),a=Uy(n.direction);r?r.withOrdering(a,i):e.addSchemaColumn(n.columnName).withOrdering(a,i)})}_addIsDistinctToEsq(e,t){t&&(e.isDistinct=!0)}_excludeHierarchyFiltersFromFiltersCollection(e,t){return t.map(n=>n?.type!==j.Filter||!n?.value||e.hierarchicalColumnFiltersValue!==n.value?n:null).filter(n=>!!n)}_addHierarchyOptionsToEsq(e,t){t&&(t.hierarchicalFullDataLoad&&(e.hierarchicalFullDataLoad=t.hierarchicalFullDataLoad),t.hierarchicalColumnName&&(e.hierarchicalColumnName=t.hierarchicalColumnName,e.isHierarchical=!0),t.hierarchicalColumnValue&&(e.hierarchicalColumnValue=t.hierarchicalColumnValue),t.hierarchicalMaxDepth&&(e.hierarchicalMaxDepth=t.hierarchicalMaxDepth),t.hierarchicalColumnFiltersValue&&(e.hierarchicalColumnFiltersValue=t.hierarchicalColumnFiltersValue))}_addColumnToEsq(e,t){t.filter(Boolean).forEach(n=>{this._entitySchemaColumnAppenderFactory.create(n).addColumn(e,n)})}_prepareAttributePairsForLoad(e,t){return t.map(n=>{if(typeof n=="string"){const i=n,r=e.attributes.find(a=>a.name===i);return r?this._dataSchemaToDataSourceAttributeConverter.create(r.attributeType).convert(r):{name:i,path:i}}else return n})}_applyESQParameters(e,t){return e.hierarchicalColumnFiltersValue&&(t=this._excludeHierarchyFiltersFromFiltersCollection(e,t)),this.entitySchemaQueryUtils.applyParameters(t,e)}build(e,t,n,i){if(n.some(r=>r.type===j.Never))throw new Error('Failed to build entity schema query: parameters contains "Never" model parameter.');return(0,l.forkJoin)([this.entitySchemaQueryUtils.convertToEntityDataSourceParameters(e,n),(0,l.of)(this._prepareAttributePairsForLoad(e,t))]).pipe((0,l.map)(([r,a])=>({esq:new Cn(e.name),esqParameters:r,dataSourceAttributes:a})),(0,l.tap)(({esq:r,dataSourceAttributes:a})=>this._addColumnToEsq(r,a)),(0,l.tap)(({esq:r})=>this._addSortingToEsq(r,i?.sortingConfig)),(0,l.tap)(({esq:r})=>this._addPagingToEsq(r,i?.pagingConfig)),(0,l.tap)(({esq:r})=>this._addIsDistinctToEsq(r,i?.isDistinct)),(0,l.tap)(({esq:r})=>this._addHierarchyOptionsToEsq(r,i?.hierarchyConfig)),(0,l.switchMap)(({esq:r,esqParameters:a})=>this._applyESQParameters(r,a)))}static{this.\u0275fac=function(t){return new(t||Vr)(s.\u0275\u0275inject(Qi),s.\u0275\u0275inject($y),s.\u0275\u0275inject(Gy))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Vr,factory:Vr.\u0275fac,providedIn:"root"})}}const tu=o=>{switch(o){case _.Guid:return _.Guid;case _.Text:case _.SHORT_TEXT:case _.PHONE_TEXT:case _.WEB_TEXT:case _.EMAIL_TEXT:case _.MEDIUM_TEXT:case _.MAXSIZE_TEXT:case _.LONG_TEXT:case _.HASH_TEXT:case _.SECURE_TEXT:case _.RICH_TEXT:return _.Text;case _.Integer:case _.Enum:return _.Integer;case _.Float:case _.FLOAT0:case _.FLOAT1:case _.FLOAT2:case _.FLOAT3:case _.FLOAT4:case _.FLOAT8:case _.MONEY0:case _.MONEY1:case _.Money:case _.MONEY3:return _.Float;case _.DateTime:case _.Date:case _.Time:return _.DateTime;case _.Lookup:case _.IMAGELOOKUP:return _.Lookup;case _.Boolean:return _.Boolean;case _.Blob:return _.Blob;case _.Image:return _.Image;case _.Color:return _.Color;default:throw new Error(`Type ${o} not implemented`)}};function hw(o,e=null,t=DataValueType.Float){if(!o||o.length===0)return e;if(o.length===1)return o[0];let n=o.map(i=>tu(i)).map(i=>DataValueTypeGroup.Number.includes(i)?t:i);return n=[...new Set(n)],n.length===1?n[0]:e}class Zy extends Kl{constructor(){super(...arguments),this.supportTransactions=!0}}class Lr extends Zy{get isForceUpdateUnchangedData(){return!!this.initialConfig?.isForceUpdateUnchangedData}get affectedAttributes(){return[...this._affectedAttributes]}get isAggregate(){return this.dataSchema?this.dataSchema.attributes.some(t=>t.isAggregate):!1}get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._affectedAttributes=[],this._errorReferenceAttributes=[],this.type=yp,this._featureValues=t.get(Q),this._queryExecutor=t.get(Oe),this._entitySchemaService=t.get(Sn),this._httpClient=this.injector.get(U.HttpClient),this._rightsService=this.injector.get(Ql),this.dataSchemaRepository=this.injector.get(en),this._entitySchemaRepository=this.injector.get(rt),this._entitySchemaQueryBuilder=this.injector.get(Vr),this._entitySchemaQueryUtils=this.injector.get(Qi),this._window=this.injector.get(Qe),this._measurePerformanceService=this.injector.get(q);const n=this.injector.get(_t);this._entityDefaultValuesUrl=n.isSSP?"/ssp/rest/EntitySchemaService/GetEntityDefaultValues":"/rest/EntitySchemaService/GetEntityDefaultValues",this.translateService=this.injector.get(T.TranslateService)}_buildSelectEsq(e,t,n){return this.getSchema().pipe((0,d.switchMap)(i=>this._entitySchemaQueryBuilder.build(i,e,t,n)),(0,d.map)(i=>(this._featureValues["DataSource-DisableRecordDeactivation"]!==!0&&(i.useRecordDeactivation=this.initialConfig.useRecordDeactivation),i.adminUnitRoleSources=this._getEsqAdminUnitRoleSources(),i)))}_getEsqAdminUnitRoleSources(){let e;const t=this.initialConfig.adminUnitRoleSources;return(0,v.isNumber)(t)?t:((0,v.isArray)(t)&&t.forEach(n=>{const i=Jl[n];(0,v.isNumber)(i)&&(e=e|i)}),e)}_normalizeValue(e,t){switch(t){case _.Lookup:return e||null;case _.Date:case _.Time:case _.DateTime:return e instanceof Date?Fd(e):typeof e=="string"&&Date.parse(e)>0?`"${e}"`:e;default:return e}}_buildUpdateEsq(e,t){return this.getSchema().pipe((0,d.switchMap)(n=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(n,e,!0)),(0,d.map)(n=>({updateQuery:new sl(this._entitySchemaName),esqParameters:n})),(0,d.tap)(({updateQuery:n})=>{n.isForceUpdate=!!this.initialConfig.isForceUpdate,Object.keys(t).forEach(i=>{const r=this._findEntitySchemaColumn(i);if(!r)throw new Error(`Column ${i} not found`);const a=t[i];this._isEntityColumnValue(a)&&n.addColumn(r.name,this._normalizeValue(a,r.dataValueType),tu(r.dataValueType))})}),(0,d.switchMap)(({updateQuery:n,esqParameters:i})=>this._entitySchemaQueryUtils.applyParameters(i,n)),(0,d.catchError)(n=>(0,l.throwError)(()=>n)))}_buildInsertEsq(e){const t=new il(this._entitySchemaName);return Object.keys(e).forEach(n=>{const i=this._findEntitySchemaColumn(n);if(!i)throw new Error(`Column ${n} not found`);const r=e[n];this._isEntityColumnValue(r)&&t.addColumn(i.name,this._normalizeValue(r,i.dataValueType),tu(i.dataValueType))}),t}_buildDeleteEsq(e){return this.getSchema().pipe((0,d.switchMap)(t=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(t,e,!0)),(0,d.switchMap)(t=>{const n=new Eh(this._entitySchemaName);return this._entitySchemaQueryUtils.applyParameters(t,n)}))}_checkOwnAttributes(e){return this.getSchema().pipe((0,d.switchMap)(t=>{const n=t.attributes.filter(i=>i.attributeType!==W.OwnAttribute).filter(i=>!(0,v.isUndefined)(e[i.name]));return n.length!==0?(0,l.throwError)(()=>new Error(`Not valid attributes for this data source: ${n.map(i=>i.name).join(",")}`)):(0,l.of)(null)}))}_findEntitySchemaColumn(e){return this._entitySchema.columns.find(t=>t.name===e)}_isEntityColumnValue(e){const t=n=>typeof n=="object"&&(n===null||"value"in n);return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||e instanceof Date||t(e)}_parseDefaultValues(e,t){const n=new Map(e.attributes.map(i=>[i.name,i.dataValueType]));return t.reduce((i,r)=>{const{defaultValue:a,name:c}=r;if((0,v.isNil)(a.value))return i;if(a.displayValue)return{...i,[c]:a};const h=vp(a.value,n.get(c));return{...i,[c]:h}},{})}_getDefaultValues(e){const t=`${this._entityDefaultValuesUrl}?entityName=${e}`;return this._httpClient.get(t).pipe((0,d.catchError)(n=>this._catchErrorResponse(n)),(0,d.map)(n=>n.GetEntityDefaultValuesResult),(0,d.mergeMap)(n=>this.getSchema().pipe((0,d.tap)(i=>{let r=this._window.defaultValueStorage;const a=n?.find(c=>c.name===i.primaryAttributeName)?.defaultValue?.value;if(r=r||{},a){const c=`${e}_${a}`;r[c]=n,this._window.defaultValueStorage=r}}),(0,d.map)(i=>this._parseDefaultValues(i,n)))))}_catchErrorResponse(e){return console.log(e),(0,l.of)({GetEntityDefaultValuesResult:[]})}_requestEntitySchemaColumnsInfo(e){const t=e.map(n=>n.attributePath);return this._entitySchemaService.getEntitySchemaColumnsInformationByPathsArray(this._entitySchema.uId,t).pipe((0,d.map)(n=>e.map(i=>({column:n[i.attributePath],config:i}))))}_getEntitySchemaForwardReferenceColumnsInfo(e){const t={name:this._entitySchemaName,loadLookupColumns:!1,forwardReferencePaths:e.map(n=>n.attributePath)};return this._entitySchemaRepository.getSchemes([t]).pipe((0,d.map)(()=>e.map(n=>{const i=n.attributePath.split("."),r=this._entitySchemaRepository.findEntitySchemaColumnByPath(this._entitySchemaName,i);return{column:new $c(r),config:n}})))}_createReferenceAttributes(e,t){return t.length===0?(0,l.of)(e):(0,l.of)(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"]).pipe((0,d.switchMap)(n=>n?this._requestEntitySchemaColumnsInfo(t):this._getEntitySchemaForwardReferenceColumnsInfo(t))).pipe((0,d.tap)(n=>{n.forEach(({column:i,config:r})=>{r.attributeType===W.AggregationAttribute&&r.aggregationConfig?.aggregationFunction===ql.Count&&(i.dataValueType=_.Integer),e.addAttribute(i,r)})}),(0,d.map)(()=>e))}_createAttributesFromInitialConfig(e,t={}){const n=[];return Object.entries(t).forEach(([i,r])=>{const a=r;a.type===W.ForwardReferenceAttribute&&n.push({attributeName:i,attributeType:W.ForwardReferenceAttribute,attributePath:a.path}),a.type===W.AggregationAttribute&&n.push({attributeName:i,attributeType:W.AggregationAttribute,attributePath:a.path,aggregationConfig:a.aggregationConfig}),a.type===W.FunctionAttribute&&n.push({attributeName:i,attributeType:W.FunctionAttribute,attributePath:a.path,functionConfig:a.functionConfig})}),this._createReferenceAttributes(e,n).pipe((0,d.catchError)(i=>{const r=i.message&&i.toString(),a=new Ry(this,r);return this._errors.push(a),n.forEach(c=>{this._errorReferenceAttributes.push(c)}),(0,l.of)(e)}))}_shouldSkipLoad(e){return e.some(t=>t.type===j.Never)}_setValidValuesForLookupAttributes(e,t){return Object.keys(t).forEach(n=>{const i=e.attributes.find(r=>r.name===n);i&&(i.dataValueType===_.Lookup||i.dataValueType===_.IMAGELOOKUP)&&t[n]===""&&(t[n]=null)}),t}_throwErrorResponse(e){const t=typeof e=="string"?e:e?.message;return(0,l.throwError)(()=>({success:!1,rowsAffected:0,errorInfo:t}))}_mapOperationResult(e){return{success:e.success,rowsAffected:e.rowsAffected}}_getIsAffectedAttributeStored(e){return this._affectedAttributes.some(t=>t.path===e.path&&t.schemaName===e.schemaName)}_collectUsedAttributes(e){let t=e._getUsedColumns();t=t.filter(n=>!this._getIsAffectedAttributeStored(n)),this._affectedAttributes.push(...t)}_findErrorReferenceAttribute(e){const t=typeof e=="string"?e:e.name;return this._errorReferenceAttributes.find(n=>n.attributeName===t)}_load(e,t,n,i){if(this.hasErrors){if(this.hasCriticalErrors)return(0,l.throwError)(()=>this.getLastError());if(e.length!==0&&e.every(a=>this._findErrorReferenceAttribute(a)!=null))return(0,l.throwError)(()=>this.getLastError())}return this._shouldSkipLoad(t)?(0,l.of)([]):this._buildSelectEsq(e,t,n||{}).pipe((0,d.tap)(r=>this._collectUsedAttributes(r)),(0,d.switchMap)(r=>{let a;const c={throttled:n?.throttled};return i?(r.queryId=i.id,a=this._queryExecutor.executeSelectQuery(r,c,i.transactionId),i.markAsReady()):a=this._queryExecutor.executeSelectQuery(r,c),a.pipe(this._measurePerformanceService.measure$(`EntityDataSource.load.executeSelectQuery.${this.dataSourceName}`),(0,d.catchError)(h=>h instanceof ra?(0,l.throwError)(()=>h):(0,l.throwError)(()=>new Error(this.translateService.instant("BaseViewModel.LoadingModelErrorMessage")))))}),(0,d.map)(r=>r),(0,d.mergeMap)(r=>this.getSchema().pipe((0,d.map)(a=>(a.attributes&&r.forEach(c=>{this._setValidValuesForLookupAttributes(a,c)}),r)))))}_save(e,t,n){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._checkOwnAttributes(t).pipe((0,d.switchMap)(()=>this._buildUpdateEsq(e,t)),(0,d.switchMap)(i=>{if(n){i.queryId=n.id;const r=this._queryExecutor.executeUpdateQuery(i,n.transactionId);return n.markAsReady(),r}return this._queryExecutor.executeUpdateQuery(i)}),(0,d.map)(i=>this._mapOperationResult(i)),(0,d.catchError)(i=>this._throwErrorResponse(i)))}_insert(e,t){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._checkOwnAttributes(e).pipe((0,d.map)(()=>this._buildInsertEsq(e)),(0,d.switchMap)(n=>{let i;return t?(n.queryId=t.id,i=this._queryExecutor.executeInsertQuery(n,t.transactionId),t.markAsReady()):i=this._queryExecutor.executeInsertQuery(n),(0,l.forkJoin)({response:i,dataSchema:this.getSchema()})}),(0,d.map)(({response:n,dataSchema:i})=>({...this._mapOperationResult(n),primaryAttributes:[{[i.primaryAttributeName]:n.id}]})),(0,d.catchError)(n=>this._throwErrorResponse(n)))}_delete(e,t){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._buildDeleteEsq(e).pipe((0,d.tap)(n=>{n.queryId=t?.id}),(0,d.switchMap)(n=>{if(t){n.queryId=t.id;const i=this._queryExecutor.executeDeleteQuery(n,t.transactionId);return t.markAsReady(),i}return this._queryExecutor.executeDeleteQuery(n)}),(0,d.map)(n=>this._mapOperationResult(n)),(0,d.catchError)(n=>this._throwErrorResponse(n)))}innerLoad(e,t,n){return this._load(e,t,n)}innerSave(e,t){return this._save(e,t)}innerInsert(e){return this._insert(e)}innerDelete(e){return this._delete(e)}innerGetSchema(){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this.dataSchemaRepository.get(this._entitySchemaName).pipe((0,d.map)(e=>new Sp(e)),(0,d.switchMap)(e=>this._createAttributesFromInitialConfig(e,this.initialConfig.attributes)),(0,d.tap)(e=>{const t=this._getDefaultValues(this._entitySchemaName).pipe((0,d.shareReplay)({bufferSize:1,refCount:!0}));e.setAttributesDefaultValue(t)}),(0,d.map)(e=>e.build()))}innerGetLookupDataSchema(e){if(this.hasCriticalErrors)return(0,l.throwError)(()=>this.getLastError());const n=e.split(".")[0],i=this._findEntitySchemaColumn(n);return i?i.dataValueType!==_.Lookup?(0,l.throwError)(()=>new Error(`DataValueType for column '${n}' isn't lookup`)):i.referenceSchemaName?this.dataSchemaRepository.get(i.referenceSchemaName):(0,l.throwError)(()=>new Error(`referenceSchemaName for column '${n}' is absent`)):(0,l.throwError)(()=>new Error(`Can't find column with name '${n}'`))}innerGetDefaultValues(){return this.hasCriticalErrors?(0,l.throwError)(()=>this.getLastError()):this._getDefaultValues(this._entitySchemaName)}innerCanDelete(e){return this.hasCriticalErrors?(0,l.of)({result:!1}):this._rightsService.getCanDelete({schemaName:this.initialConfig.entitySchemaName,primaryColumnValue:e.primaryColumnValue})}innerCanCreate(e){if(this.hasCriticalErrors)return(0,l.of)({result:!1});const t={isNew:!0,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}innerCanEdit(e){if(this.hasCriticalErrors)return(0,l.of)({result:!1});const t={primaryColumnValue:e.primaryColumnValue,isNew:!1,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}getEmptySchema(){return this._entitySchemaName?new Qt({name:this._entitySchemaName}):super.getEmptySchema()}init(e,t){return super.init(e,t).pipe((0,d.mergeMap)(n=>{if(!this.initialConfig.entitySchemaName){const i=new zy(this);return this._errors.push(i),(0,l.throwError)(()=>i)}return(0,l.of)(n)}),(0,d.tap)(()=>this._entitySchemaName=this.initialConfig.entitySchemaName),(0,d.mergeMap)(n=>this._entitySchemaRepository.getSchemaByName(this.initialConfig.entitySchemaName).pipe((0,d.tap)(i=>this._entitySchema=i),(0,d.catchError)(()=>{this._entitySchema=new th,this._entitySchema.name=this._entitySchemaName,this._entitySchema.columns=[];const i=new Fy(this,this._entitySchemaName);return this._errors.push(i),(0,l.throwError)(()=>i)}),(0,d.map)(()=>n))))}getOwnLoadParameters(){return this.initialConfig?.loadParameters}getAllowCopyingRecords(){return this.initialConfig?.allowCopyingRecords}loadInTransaction(e,t,n,i){return this._load(t,n,i,e)}saveInTransaction(e,t,n){return this._save(t,n,e)}insertInTransaction(e,t){return this._insert(t,e)}deleteInTransaction(e,t){return this._delete(t,e)}}class Yy extends Lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotActionDataSource",this._intentManager=this.injector.get(Un)}_getActionUId(e){return e.filter(n=>n.type===j.PrimaryColumnValue)[0]?.value}innerDelete(e){return(0,l.of)(void 0)}innerInsert(e){const t=e;return(0,l.forkJoin)([this._intentManager.createAction(t),this.getSchema()]).pipe((0,l.map)(([n,i])=>({success:n.success,rowsAffected:1,errorInfo:n.errorInfo?.message,primaryAttributes:n.success?[{[i.primaryAttributeName]:t.Id}]:null})))}innerLoad(e,t,n){const i=this._getActionUId(t);return i?this._intentManager.getActionByUId(i).pipe((0,l.map)(r=>[r])):(0,l.of)([])}innerSave(e,t){const n=this._getActionUId(e),i=t;return i.Id=n,this._intentManager.updateAction(i).pipe((0,l.map)(r=>({success:r.success,rowsAffected:1,errorInfo:r.errorInfo?.message})))}}class Mp{}const Ky="CopilotIntentStatus",Jy=new Map([["InDevelopment","4670b068-ad03-4364-9350-6cc61efd1b7f"],["Active","1d73b111-07a9-49e2-aa15-c9415cce7470"],["Deactivated","2c547e71-7a05-42e1-8b65-2bf63f200156"]]),qy="CopilotIntentMode",Xy={Chat:"Chat",Api:"API"},Qy=new Map([["Chat","326bba59-302a-4a5e-857c-2576e1a38ab0"],["API","5f2dc095-4543-4972-b6bc-6599bf6bc3fd"]]),wp={System:{value:"35f3b644-4fa3-4d1e-8e62-5c3fdc4d3e52",displayValue:"System",primaryColorValue:"#22AC14"},Skill:{value:"6d940b75-21c8-4a90-89ab-9867e6e4a045",displayValue:"Skill",primaryColorValue:"#7848EE"},Agent:{value:"a8fbe253-be1b-4ec4-bc58-65b8047013da",displayValue:"Agent",primaryColorValue:"#E67E22"}};function eC(){return(0,l.of)(Object.values(wp))}class Br{constructor(e){this._entitySchemaService=e}_loadPrimaryColumns(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,d.map)(t=>{const n=t.entitySchema.getPrimaryColumn(),i=t.entitySchema.getPrimaryDisplayColumn();if((0,v.isEmpty)(i))throw new Error(`Entity ${e} should have primary display column`);return{primaryColumnName:n.name,primaryDisplayColumnName:i?.name}}))}getColumnLookupValues(e){if((0,v.isEmpty)(e))return(0,l.of)(null);const t=this._loadPrimaryColumns(e),n=(0,l.from)(qt.create(e));return(0,l.forkJoin)([t,n]).pipe((0,d.switchMap)(([i,r])=>(0,l.from)(r.load({attributes:[i.primaryColumnName,i.primaryDisplayColumnName]})).pipe((0,d.map)(c=>c.map(h=>({value:h[i.primaryColumnName],displayValue:h[i.primaryDisplayColumnName]}))))))}static{this.\u0275fac=function(t){return new(t||Br)(s.\u0275\u0275inject(Sn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Br,factory:Br.\u0275fac,providedIn:"root"})}}class Fr{constructor(e,t){this._columnLookupValuesService=e,this._injector=t,this._intentStatuses=Jy,this._intentModes=Qy}convertToDataSourceModel(e){const t=this._injector.get(Mp);return(0,l.combineLatest)([this._columnLookupValuesService.getColumnLookupValues(Ky),this._columnLookupValuesService.getColumnLookupValues(qy),eC(),t.getAllLlmModels()]).pipe((0,l.map)(([n,i,r])=>{const a=this._intentStatuses.get(e.Status),c=n.find(w=>w.value===a),h=this._intentModes.get(e.Mode)??this._intentModes.get(Xy.Chat),p=i.find(w=>w.value===h),m=r.find(w=>w.displayValue===e.Type),f=t.getModelByCodeSync(e.LlmModel),C={Id:e.UId,Code:e.Code,Description:e.Description,Prompt:e.Prompt,Type:m,Name:e.Title,Status:c,PackageUId:e.PackageUId,LlmModel:f?{value:f.Id,displayValue:f.Name}:null,ResponseFormatJsonSchema:e.ResponseFormatJsonSchema};return e.Type==="Agent"?{...C,Restrictions:e.Restrictions,RoleDescription:e.RoleDescription}:{...C,Mode:p}}))}convertToModel(e){const t={};for(const[n,i]of Object.entries(e)){let r=n,a=i;n==="Name"&&(r="Title"),n==="Id"&&(r="UId"),n==="Status"&&(a=[...this._intentStatuses].filter(([,c])=>c===e.Status.value).map(([c])=>c).shift()),n==="Mode"&&(a=[...this._intentModes].filter(([,c])=>c===e.Mode.value).map(([c])=>c).shift()),n==="Type"&&(a=Object.values(wp).filter(c=>c.value===e.Type.value).map(c=>c.displayValue).shift()),n==="LlmModel"&&(a=this._injector.get(Mp).getModelByNameSync(e.LlmModel?.displayValue)?.Code),t[r]=a}return t}static{this.\u0275fac=function(t){return new(t||Fr)(s.\u0275\u0275inject(Br),s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Fr,factory:Fr.\u0275fac,providedIn:"root"})}}class tC extends Lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._defaultValuesMap=new Map,this.type="crt.CopilotIntentDataSource",this._intentManager=this.injector.get(Un),this._copilotIntentDataSourceModelConvertor=this.injector.get(Fr),this._initDefaultValuesMap()}_initDefaultValuesMap(){this._defaultValuesMap.set("CopilotIntent",{UId:L(),Status:"Active",Mode:"Chat",Type:"Skill",Prompt:this.translateService.instant("CopilotIntentDataSource.DefaultValues.Prompt")}),this._defaultValuesMap.set("CopilotAgent",{UId:L(),Status:"Active",Type:"Agent"})}innerGetDefaultValues(){const e=this.initialConfig.entitySchemaName,t=this._defaultValuesMap.get(e);return this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(t)}innerInsert(e){const t=this._copilotIntentDataSourceModelConvertor.convertToModel({...e});return(0,l.forkJoin)([this._intentManager.createIntent(t),this.getSchema()]).pipe((0,l.map)(([n,i])=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message,primaryAttributes:[{[i.primaryAttributeName]:n.schemaUid}]})),(0,d.switchMap)(n=>n.success?(0,l.of)(n):(0,l.throwError)(()=>n)))}innerLoad(e,t,n){const i=t.filter(r=>r.type===j.PrimaryColumnValue);if(i.length)return this._intentManager.getIntent(i[0].value).pipe((0,d.switchMap)(r=>this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(r).pipe((0,l.map)(a=>[a]))))}innerSave(e,t){const i=e.filter(a=>a.type===j.PrimaryColumnValue)[0].value,r=this._copilotIntentDataSourceModelConvertor.convertToModel({...t});return r.UId=i,this._intentManager.updateIntent(r).pipe((0,l.map)(a=>({success:a.success,rowsAffected:a.success?1:0,errorInfo:a.errorInfo?.message})),(0,d.switchMap)(a=>a.success?(0,l.of)(a):(0,l.throwError)(()=>a)))}}class nC{static fromJson(e){throw new Error("not implemented")}}class iC{static resolve(e){return{[ee.Compare]:tt,[ee.FilterGroup]:Ee,[ee.In]:fn,[ee.IsNull]:gt,[ee.Exists]:gn,[ee.Between]:As}[e]}}class sC{static fromJson(e,t){throw new Error("not implemented")}}class rC{static resolve(e){return{[xe.Macros]:_n,[xe.Length]:ks,[xe.Window]:Ns,[xe.DatePart]:yn,[xe.DateAdd]:yn,[xe.DateDiff]:yn}[e.functionType]}}class oC{static resolve(e,t){return{[Se.SchemaColumn]:X,[Se.Parameter]:ae,[Se.SubQuery]:Os,[Se.ArithmeticOperation]:Rs,[Se.Function]:rC.resolve(t)}[e]}}class nu extends sC{static fromJson(e,t){const n=e.expressionType;return oC.resolve(n,e).fromJson(e,t,nu)}}class zr extends nC{static fromJson(e){const t=e.filterType,n=e.isEnabled,i=e.trimDateTimeParameterToDate,r=iC.resolve(t).fromJson(e,zr,nu);return r.isEnabled=n!==!1,r.trimDateTimeParameterToDate=i===!0,r}}class Ur{convertToDataSourceModel(e){return(0,l.of)({Id:e.UId,Intent:e.Intent,Code:e.Code,Name:e.Name,Description:e.Description,SourceCollection:e.SourceCollection,DataValueTypeUId:e.DataValueTypeUId})}convertToModel(e){const t={};return Object.entries(e).forEach(([n,i])=>{n==="Id"&&(n="UId"),t[n]=i}),t}static{this.\u0275fac=function(t){return new(t||Ur)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ur,factory:Ur.\u0275fac,providedIn:"root"})}}class aC extends Lr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotIntentParameterDataSource",this._intentManager=this.injector.get(Un),this._modelConvertor=this.injector.get(Ur)}_getPrimaryColumnParameter(e){return e.find(t=>t.type===j.PrimaryColumnValue&&Rd(t.value))}_getIsIntentUIdParameter(e){return(e.relationsConfigs??[]).some(t=>t.dataSchemaName==="CopilotIntent"&&t.attributePath==="Intent")}_getSourceCollectionFilterValue(e){const t=e.find(r=>r.type===j.Filter);if(!t?.value)return null;const n=zr.fromJson(t.value);let i;return n.filters.forEach(r=>{r instanceof tt&&r.leftExpression instanceof X&&r.leftExpression.columnPath==="SourceCollection"&&r.rightExpression instanceof ae&&(i=r.rightExpression.value)}),i}innerGetDefaultValues(){return this._modelConvertor.convertToDataSourceModel({UId:L()})}innerInsert(e){const t=this._modelConvertor.convertToModel({...e});return this._intentManager.createIntentParameter(t).pipe((0,l.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message,primaryAttributes:[{Id:t.UId}]})),(0,l.switchMap)(n=>n.success?(0,l.of)(n):(0,l.throwError)(()=>n)))}innerLoad(e,t,n){const i=this._getPrimaryColumnParameter(t),r=this._getSourceCollectionFilterValue(t)??"InputParameters";return i?(this._getIsIntentUIdParameter(i)?this._intentManager.getIntentParameters(i.value,r):this._intentManager.getIntentParameter(i.value).pipe((0,l.map)(c=>[c]))).pipe((0,l.mergeMap)(c=>(0,l.from)(c).pipe((0,l.mergeMap)(h=>this._modelConvertor.convertToDataSourceModel(h)),(0,l.toArray)())),(0,l.catchError)(()=>(0,l.of)([]))):(0,l.of)([])}innerSave(e,t){const n=this._getPrimaryColumnParameter(e)?.value,i=this._modelConvertor.convertToModel({...t});return i.UId=n,this._intentManager.updateIntentParameter(i).pipe((0,l.map)(r=>({success:r.success,rowsAffected:r.success?1:0,errorInfo:r.errorInfo?.message})),(0,l.switchMap)(r=>r.success?(0,l.of)(r):(0,l.throwError)(()=>r)))}innerDelete(e){const t=this._getPrimaryColumnParameter(e)?.value;return this._intentManager.deleteIntentParameter(t).pipe((0,l.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message})),(0,l.switchMap)(n=>n.success?(0,l.of)(n):(0,l.throwError)(()=>n)))}}class cC extends Lr{innerDelete(e){return(0,l.of)(null)}innerInsert(e){return(0,l.of)(null)}innerLoad(e,t){return(0,l.of)([])}innerSave(e,t){return(0,l.of)(null)}innerGetLookupDataSchema(e){return(0,l.of)(null)}innerGetDefaultValues(){return(0,l.of)(null)}innerCanDelete(e){return(0,l.of)(null)}innerCanEdit(e){return(0,l.of)(null)}innerCanCreate(e){return(0,l.of)(null)}}var Ye;(function(o){o.Create="create",o.Update="update",o.Delete="delete"})(Ye||(Ye={}));const iu=window;class $r{constructor(){this._event$=new l.Subject}static get instance(){return iu.__modelEventNotificationService||(iu.__modelEventNotificationService=new $r),iu.__modelEventNotificationService}get event$(){return this._event$.asObservable()}notify(e){this._event$.next(e)}}class Gr{constructor(){this.changedValues$=new l.Subject,this._valuesStore={}}setValues(e){if(e){const t={};Object.entries(e).forEach(([n,i])=>{const r=this._valuesStore[n]!==i;this._valuesStore[n]=(0,v.cloneDeep)(i),r&&(t[n]=this._valuesStore[n])}),(0,v.isEmpty)(t)||this.changedValues$.next(t)}}get values(){return this._valuesStore}static{this.\u0275fac=function(t){return new(t||Gr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Gr,factory:Gr.\u0275fac})}}const xp="PrimaryValue",Ep="DisplayValue",su="PrimaryColorValue";class Hr{constructor(e,t){this._queryExecutor=e,this._entitySchemaRepository=t}_getInFilter(e){const t=new _n({macrosType:ci.PrimaryColumn});return new fn(K.Equal,t,e.map(n=>new ae({value:n})))}_getEsq(e,t){const n=new Cn(e);return this._entitySchemaRepository.getSchemaByName(e).pipe((0,d.map)(i=>{n.addMacrosFunctionColumn(ci.PrimaryColumn,xp),n.addMacrosFunctionColumn(ci.PrimaryDisplayColumn,Ep);const r=i.getPrimaryColorColumn();r&&n.addSchemaColumn(r.name,su);const a=this._getInFilter(t);return n.filters.add(a),n}))}_getSchemaLookupData(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i],[a,c]=e[i];n[a]={};for(const h of c){const p=r.find(m=>m[xp]===h);if(p){const m=[p[Ep]];p[su]&&m.push(p[su]),n[a][h]=p?m:null}}}return n}load(e){const t=Object.entries(e);return(0,l.forkJoin)(t.map(([n,i])=>this._getEsq(n,i))).pipe((0,l.switchMap)(n=>this._queryExecutor.executeBatchSelectQuery(n).pipe((0,d.map)(i=>this._getSchemaLookupData(t,i)))))}static{this.\u0275fac=function(t){return new(t||Hr)(s.\u0275\u0275inject(Oe),s.\u0275\u0275inject(rt))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Hr,factory:Hr.\u0275fac,providedIn:"root"})}}class lC extends Kl{constructor(e,t){super(e,t),this.dataSourceName=e,this._injector=t,this.type=Cp,this._schemaParametersStore=this._injector.get(Gr),this._lookupDataLoadService=this._injector.get(Hr),this._featureValues=this._injector.get(Q),this._featureValues.DisableCommunicationBetweenSchemas||this._subscribeParametersChanged()}_subscribeParametersChanged(){this._schemaParametersStore.changedValues$.subscribe(e=>{$r.instance.notify({modelId:L(),dataSchemaName:this.dataSchema.name,type:Ye.Update,payload:{primaryAttributesValues:null,changedAttributes:Object.keys(e)}})})}_getCanSuccessfullyExecuteOperationResult(){return(0,l.of)({result:!0})}_fillLookupValues(e,t,n){Object.entries(n).forEach(([i,[r,a]])=>{(t[i]||[]).forEach(h=>{e[h]=a?{value:i,displayValue:r,primaryColorValue:a}:{value:i,displayValue:r}})})}_fillSchemaParameterValueNameMap(e,t,n,i){const r=i;let a=e[t];a||(a={},e[t]=a);let c=a[r];c||(c=[],a[r]=c),c.push(n)}_fillSchemaNamePrimaryValuesMap(e,t,n){const i=n;let r=e[t];r||(r=[],e[t]=r),r.push(i)}_isLookupValue(e){return!!e?.value}_shouldFillSchemaLookupValueMaps(e,t){return e&&t&&t.referenceSchemaName&&!this._isLookupValue(e)}_load(e,t){const n={},i=this._schemaParametersStore.values,r=t.attributes,a={},c={};for(const p of e){const m=i[p],f=r.find(C=>C.name===p);if(this._shouldFillSchemaLookupValueMaps(m,f)){this._fillSchemaNamePrimaryValuesMap(c,f.referenceSchemaName,m),this._fillSchemaParameterValueNameMap(a,f.referenceSchemaName,p,m);continue}n[p]=m??null}return Object.keys(c).length===0?(0,l.of)([n]):this._lookupDataLoadService.load(c).pipe((0,l.map)(p=>{for(const[m,f]of Object.entries(p)){const C=a[m];this._fillLookupValues(n,C,f)}return[n]}))}_getValuesForStore(e){const t={};return Object.entries(e).forEach(([n,i])=>{const r=this.initialConfig.parameters[n];if(!r)return;Ll(r.dataValueTypeName)===_.Lookup?t[n]=i?.value:t[n]=i}),t}innerLoad(e,t,n){return this.getSchema().pipe((0,l.switchMap)(i=>this._load(e,i)))}innerSave(e,t){const n=this._getValuesForStore(t);return this._schemaParametersStore.setValues(n),(0,l.of)({success:!0,rowsAffected:1})}innerInsert(e){const t=this._getValuesForStore(e);return this._schemaParametersStore.setValues(t),(0,l.of)({success:!0,rowsAffected:1,primaryAttributes:[]})}innerDelete(e){return(0,l.of)({success:!0,rowsAffected:1})}innerGetSchema(){const e=[],t=this.initialConfig.parameters;return t&&Object.entries(t).forEach(([n,i])=>{const r=new kr({name:n,caption:i.caption,dataValueType:Ll(i.dataValueTypeName),attributeType:W.OwnAttribute,path:n,isRequired:!!i.isRequired,referenceSchemaName:i.referenceSchemaName,isMasked:!1,isFormatValidated:!0});r.addDefaultValidators(),e.push(r)}),(0,l.of)(new Qt({name:this.initialConfig.schemaName,type:Xi.ClientUnit,attributes:e}))}innerGetLookupDataSchema(e){return(0,l.of)(null)}innerGetDefaultValues(){return(0,l.of)({})}innerCanEdit(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanDelete(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanCreate(e){return this._getCanSuccessfullyExecuteOperationResult()}}class uC extends Kl{constructor(){super(...arguments),this.type="crt.WebServiceDataSource"}innerLoad(e,t,n){throw new Error("Method not implemented.")}innerSave(e,t){throw new Error("Method not implemented.")}innerInsert(e){throw new Error("Method not implemented.")}innerDelete(e){throw new Error("Method not implemented.")}innerGetSchema(){throw new Error("Method not implemented.")}innerGetLookupDataSchema(e){throw new Error("Method not implemented.")}innerGetDefaultValues(){throw new Error("Method not implemented.")}innerCanDelete(e){throw new Error("Method not implemented.")}innerCanEdit(e){throw new Error("Method not implemented.")}innerCanCreate(e){throw new Error("Method not implemented.")}}class Wr{resolve(e){let t=null;switch(e){case yp:t=Lr;break;case Cp:t=lC;break;case"crt.WebServiceDataSource":t=uC;break;case"crt.CopilotIntentDataSource":t=tC;break;case"crt.CopilotIntentParameterDataSource":t=aC;break;case"crt.CopilotActionDataSource":t=Yy;break;case"crt.DashboardDataSource":t=cC;break}return(0,l.of)(t)}static{this.\u0275fac=function(t){return new(t||Wr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Wr,factory:Wr.\u0275fac})}}class Gn{constructor(e,t){this.injector=e,this.resolver=t}create(e,t,n){const{type:i,scope:r,config:a}=t;return this.resolver.resolve(i).pipe((0,d.switchMap)(h=>h?new h(e,n||this.injector).init(a,r):(0,l.throwError)(()=>new Error(`Data source type '${i}' not supported.`))),(0,d.catchError)(h=>h instanceof Yl?(0,l.of)(h.dataSource):(0,l.throwError)(()=>h)))}static{this.\u0275fac=function(t){return new(t||Gn)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(Wr))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Gn,factory:Gn.\u0275fac})}}class dC{}function Ip(o,e,t){return!o||!e||!t}function Ap(o,e){return`/img/entity/hash/${o}/${e}/`}function ru(o,e="SysImage",t="Data"){if(Ip(o,e,t))return"";const n=Ap(e,t);return`${na()}${n}${o}`}function pw(o,e="SysImage",t="Data"){return Ip(o,e,t)?"":`${Ap(e,t)}${o}`}function hC(o){let e="";if(typeof o=="string"){const n=new TextEncoder().encode(o);e=String.fromCharCode(...n)}else if(o instanceof ArrayBuffer){const t=new Uint8Array(o);for(let n=0;n<t?.byteLength;n++)e+=String.fromCharCode(t[n])}return window.btoa(e)}function mw(o){const e=new DOMParser().parseFromString(o,"text/html"),t=e?.querySelectorAll("svg");return t.length>0&&t.forEach(n=>{const i=e.createElement("img"),r=hC(n.outerHTML);i.src=`data:image/svg+xml;base64,${r}`,n?.parentNode.replaceChild(i,n)}),e?.body.innerHTML||o}class he{static _setImageLookupTypeUrl(e,t){const n=e[t],i=n?.value;i&&(n.url=ru(i))}static _setBlobTypeUrl(e,t,n){const i=t[n];if(i){const r=t.Id;t[n]={value:i,url:ru(r,e,n)}}}static _addImageUrl(e,t,n){t.forEach(i=>{switch(i.dataValueType){case _.IMAGELOOKUP:{this._setImageLookupTypeUrl(n,i.name);break}case _.Image:{this._setBlobTypeUrl(e,n,i.name);break}default:break}})}static serializeRecordPrimaryAttributesValues(e){return e.map(t=>`${t.name}:${t.value}`).join(";")}static getModelPrimaryAttributeValues(e,t){const n=e.getPrimaryAttributesNames();return t.map(i=>n.map(r=>({name:r,value:i[r]})))}static getOwnColumnsValues(e,t){const n=t??{};if(e.attributes.length){const i=e.attributes.filter(r=>r.attributeType===W.OwnAttribute).map(r=>r.name).filter(r=>!(0,v.isUndefined)(n[r])).map(r=>[r,n[r]]);return Object.fromEntries(i)}else return n}static getPrimaryAttributeValuesFromParameters(e,t){const n=t.filter(i=>i.type===j.PrimaryColumnValue);return n.length?n.map(i=>({[e.primaryAttributeName]:i.value})):[]}static getPrimaryAttributeValuesFromData(e,t){const n=e.getPrimaryAttributesNames();return n.length?n.filter(i=>t[i]).map(i=>({[i]:t[i]})):[]}static getPrimaryAttributeValues(e,t,n){const i=this.getPrimaryAttributeValuesFromData(e,t);return i.length?i:this.getPrimaryAttributeValuesFromParameters(e,n)}static getDataSourceLoadOptions(e){const t={loadType:e?.loadType||de.Load};return e?.pagingConfig&&(t.pagingConfig=e.pagingConfig),e?.sortingConfig&&(t.sortingConfig=e.sortingConfig),e?.hierarchyConfig&&(t.hierarchyConfig=e.hierarchyConfig),e?.isDistinct&&(t.isDistinct=e.isDistinct),t}static getImageAttributes(e,t){const n=[];return(t||[]).forEach(i=>{const r=e.findAttributeByName(i);r?.isImage&&n.push(r)}),n}static processImageData(e,t,n){const i=he.getImageAttributes(e,n);return i.length>0&&t.forEach(r=>this._addImageUrl(e.name,i,r)),t}static removeNotRequestedData(e,t){return Object.keys(t).forEach(n=>{e.includes(n)||delete t[n]}),t}static getLoadRequestSignature(e,t,n,i){return JSON.stringify(e)+JSON.stringify(t)+JSON.stringify(n)+JSON.stringify(i)}}const pC={[P.Init]:[P.Create,P.Copy,P.Update,P.Delete],[P.Copy]:[P.Delete,P.Update],[P.Create]:[P.Copy,P.Delete,P.Update],[P.Delete]:[P.Copy,P.Create,P.Update,P.Init],[P.Update]:[P.Delete],[P.Unknown]:[]};function ou(o){const e={success:!1,rowsAffected:0,errorInfo:""};return typeof o=="string"?Object.assign(e,{errorInfo:o}):o instanceof Error?Object.assign(e,{errorInfo:o.message}):Object.assign(e,typeof o=="object"?o:{errorInfo:o})}class es{get _children(){return this._children$.value}static get instance(){return this._instance||(this._instance=new es(null,null)),this._instance}constructor(e,t){this.injector=e,this.dataSource=t,this._lookupDataSourceName="lookupDataSource",this._id=L(),this._modeChanges=new l.Subject,this._destroyed$=new l.Subject,this._children$=new l.BehaviorSubject([]),this._childrenDirty$=new l.BehaviorSubject(!1),this._childrenModes$=new l.BehaviorSubject([]),this._isCollectionModel=!1,this._isCollectionItemModel=!1,this._mode=P.Init,this._isInitialized=!1,this._isLoaded=!1,this._dirtyAttributes=new Set,this._newLoadingRequestArrived=new l.Subject,this._attributesMap=[],this._selfDirty$=new l.BehaviorSubject(!1),this._isLoading=!1,this._destroyed=!1,this._doNotAllowCancelRequest=!1,this._dirty$=(0,l.combineLatest)([this._selfDirty$,this._childrenDirty$,this._childrenModes$]).pipe((0,d.map)(([n,i,r])=>n||i||r.includes(P.Copy)||r.includes(P.Create)),(0,d.distinctUntilChanged)()),this._loadedData=new Set,this.injector&&(this._dataSourceFactory=this.injector.get(Gn),this._lifecycleHookNotificationService=this.injector.get(dC,null,{optional:!0}),this._measurePerformanceService=this.injector.get(q,null,{optional:!0}),this._doNotAllowCancelRequest=this.injector.get(Q,null,{optional:!0})?.DoNotAllowCancelRequest)}get name(){return this.dataSource?this.dataSource.dataSourceName:""}get mode(){return this._isCollectionModel?P.Unknown:this._mode}get _modeChanges$(){return this._modeChanges.asObservable()}get _isChanged(){return!!this._dirtyAttributes?.size}set _isCollection(e){this._isCollectionModel=e,this._isCollectionModel&&(this._mode=P.Unknown)}get isLoaded(){return this._isLoaded}get event$(){return $r.instance.event$.pipe((0,d.filter)(()=>this._isInitialized),(0,d.filter)(()=>!this._isCollectionItemModel),(0,d.filter)(({dataSchemaName:e})=>e===this._dataSchemaName),(0,d.tap)(({type:e,modelId:t,payload:n})=>this._updateLoadedData(e,t,n)),(0,d.filter)(({modelId:e})=>e!==this._id&&!this._isChild(e)),(0,d.map)(e=>({event:e,ownPrimaryAttributesValues:e.payload?.primaryAttributesValues?.filter(t=>{const n=he.serializeRecordPrimaryAttributesValues(t);return this._loadedData.has(n)})})),(0,d.filter)(({event:e,ownPrimaryAttributesValues:t})=>e.type===Ye.Update||e.type===Ye.Delete?!t||t.length!==0:!0),(0,d.map)(({event:e,ownPrimaryAttributesValues:t})=>({event:e,primaryAttributesValues:e.type===Ye.Create?e.payload.primaryAttributesValues:t})),(0,d.map)(({event:e,primaryAttributesValues:t})=>({modelId:e.modelId,dataSchemaName:e.dataSchemaName,type:e.type,payload:{...e.payload,primaryAttributesValues:t}})),(0,d.takeUntil)(this._destroyed$))}get dataSchemaName(){return this._dataSchemaName}get allowSync(){return!this._disableSync}get disableSync(){return this._disableSync}set disableSync(e){this._disableSync=e}get isLoading(){return this._isLoading}get hasErrors(){return this.dataSource?this.dataSource.hasErrors:!0}get hasCriticalErrors(){return this.dataSource?this.dataSource.hasCriticalErrors:!0}get affectedAttributes(){return this.dataSource?this.dataSource.affectedAttributes:[]}get isAggregate(){return this.dataSource?this.dataSource.isAggregate:!1}get supportsTransactions(){return!1}get isCollectionItemModel(){return this._isCollectionItemModel}get isInitialized(){return this._isInitialized}_isChild(e){return this._children.some(t=>t?._id===e)}_subscribeChildrenModeChanges(){this._children$.pipe((0,d.map)(e=>e.map(t=>(0,l.merge)((0,l.of)(t.mode),t._modeChanges$))),(0,d.switchMap)(e=>e?.length?(0,l.combineLatest)(e):(0,l.of)([])),(0,d.tap)(e=>this._childrenModes$.next(e)),(0,d.takeUntil)(this._destroyed$)).subscribe()}_subscribeChildrenDirtyChanges(){this._children$.pipe((0,d.map)(e=>e.map(t=>t._dirty$)),(0,d.switchMap)(e=>e?.length?(0,l.combineLatest)(e):(0,l.of)([])),(0,d.map)(e=>e.some(t=>t)),(0,d.tap)(e=>this._childrenDirty$.next(e)),(0,d.takeUntil)(this._destroyed$)).subscribe()}_updateLoadedData(e,t,n){this._isCollectionModel&&e===Ye.Create&&this._isChild(t)&&n.primaryAttributesValues.forEach(i=>{const r=he.serializeRecordPrimaryAttributesValues(i);this._loadedData.add(r)})}_setMode(e){if(this._mode===e)return;if(!pC[this._mode]?.includes(e))throw Error(`Unable to mark model with '${this._mode}' mode for '${e}'.`);const n=this._mode;this._mode=e,e===P.Delete&&this._selfDirty$.next(n!==P.Create)}_markForNotCollection(e){this._isCollectionModel||this.markFor(e)}_registerPrimaryAttributeValues(e){e.forEach(t=>{this._loadedData.add(he.serializeRecordPrimaryAttributesValues(t))})}_getDependentAttributesNames(e){return this._attributesMap.filter(t=>e.includes(t.name)).filter(t=>t.dependentAttributes.length!==0).map(t=>t.dependentAttributes).flat()}_getDefaultLoadAttributes(){return this.getSchema().pipe((0,d.map)(e=>e.getPrimaryLoadAttributes()))}_checkAttributesInDataSchema(e){return this.getSchema().pipe((0,d.tap)(t=>{const n=e.filter(i=>t.findAttributeByName(i)==null);if(n.length>0)throw new Error(`data has unknown attributes names: ${n.join(", ")}`)}))}_createDataSource(e,t,n=null){const i=n??t.dataSourceConfig;return this._dataSourceFactory.create(e,i)}_notifyEventByParameters(e,t){return this.getSchema().pipe((0,d.map)(n=>he.getPrimaryAttributeValuesFromParameters(n,e)),(0,d.mergeMap)(n=>this._notifyDataChange(n,t)))}_notifyDataChange(e,t){return this.getSchema().pipe((0,d.map)(n=>he.getModelPrimaryAttributeValues(n,e)),(0,d.tap)(n=>{$r.instance.notify({modelId:this._id,dataSchemaName:this._dataSchemaName,type:t,payload:{primaryAttributesValues:n}})}),(0,d.map)(()=>null))}_mapSaveResult(e,t,n){return this.getSchema().pipe((0,d.map)(i=>({result:e,actionType:Ye.Update,data:he.getPrimaryAttributeValues(i,t,n)})))}_mapInsertResult(e){return{data:e.primaryAttributes??[],result:e,actionType:Ye.Create}}_getLoadAttributes(e){if(e&&e.length!==0){let t=null;if(e.every(i=>(0,v.isString)(i)))return t=this._getDependentAttributesNames(e),(0,l.of)([...e,...t]);{const i=e.map(r=>r.name);return t=this._getDependentAttributesNames(i),this.getSchema().pipe((0,d.map)(r=>(t=t.map(a=>r.findAttributeByName(a)).map(a=>({name:a.name,path:a.path,caption:a.caption,dataValueType:a.dataValueType,aggregationConfig:a.aggregationConfig})),[...e,...t])))}}return this._getDefaultLoadAttributes()}_getChangedAttributesValues(e){return this._persistedState?Object.entries({...this._persistedState,...e}).filter(([t])=>this._dirtyAttributes.has(t)).reduce((t,[n,i])=>Object.assign(t,{[n]:i}),{}):e}_load(e,t,n,i,r=P.Update){const a={attributes:t,parameters:n,options:i,mode:r},c=(0,v.cloneDeep)(this._lastRequestPayload),h=(0,v.isEqual)((0,v.omit)(a,"options.loadType"),(0,v.omit)(c,"options.loadType"));return this._loadingRequest&&h?this._loadingRequest:(this._lastRequestPayload&&!h&&(this._newLoadingRequestArrived.next(null),this._newLoadingRequestArrived=new l.Subject),this._lastRequestPayload=a,this._loadingRequest=this._getLoadAttributes(t).pipe(jt(()=>this._onBeforeLoad(a,c)),(0,d.switchMap)(p=>e(p,n,i)),(0,d.raceWith)(this._newLoadingRequestArrived.pipe((0,d.switchMap)(()=>(0,l.throwError)(()=>new ra)))),(0,d.tap)(()=>this._markForNotCollection(r)),Td(()=>this.getSchema()),(0,d.tap)(([p,m])=>{this._registerPrimaryAttributeValues(he.getModelPrimaryAttributeValues(m,p))}),(0,d.tap)(()=>this._persistedState={}),(0,d.map)(([p,m])=>he.processImageData(m,p,t)),(0,d.tap)(()=>this._isLoaded=!0),jt(()=>this._onAfterLoad(a,c)),(0,d.catchError)(p=>(this._isLoaded=!1,(0,l.throwError)(()=>p))),(0,d.tap)(()=>{this._dirtyAttributes.size===0&&this._markAsPristine(),this._loadingRequest=null}),(0,d.share)()),(0,l.iif)(()=>!this._doNotAllowCancelRequest,this._loadingRequest.pipe((0,d.takeUntil)(this._destroyed$)),this._loadingRequest))}_updateAttributesDependencies(){this._attributesMap.forEach(t=>t.dependentAttributes=[]),this._attributesMap.filter(t=>t.attributeType!==W.OwnAttribute).forEach(t=>{const n=t.path.split(".");if(n.length===1)return;const i=n.shift(),r=this._attributesMap.find(a=>a.path===i);r?.dependentAttributes.push(t.name)})}_buildAttributesMap(e){const t=e.attributes??[];this._attributesMap=t.map(n=>({name:n.name,path:n.path,attributeType:n.attributeType,dependentAttributes:[],isSchemaAttribute:!0})),this._updateAttributesDependencies()}_loadDependentDataForCreate(e){return this.getSchema().pipe((0,d.map)(t=>t.attributes.filter(n=>n.dataValueType===_.Lookup).filter(n=>n.name in e).map(n=>n.name)),(0,d.switchMap)(t=>{if(t.length===0)return(0,l.of)([]);const n=t.map(i=>this.reloadDependentData(i,e[i]));return(0,l.forkJoin)(n)}),(0,d.map)(t=>{let n={};return t.forEach(i=>{n={...n,...i[0]||{}}}),{...n,...e}}))}_getDependentAttributesInfo(e){return this.getSchema().pipe((0,d.map)(t=>e.map(n=>{const i=t.findAttributeByName(n),r=i?.path??n,a=i?.name??n,c=i?.aggregationConfig??null,h=i?.dataValueType??null,p=i?.attributeType??null,m=r.split(".");m.shift();const f=m.length===1?m[0]:a;let C;return p===W.AggregationAttribute?C=W.AggregationAttribute:C=m.length===1?W.OwnAttribute:W.ForwardReferenceAttribute,{alias:f,attributeName:a,config:{path:m.join("."),aggregationConfig:c,dataValueType:h,type:C},type:C}})))}_markAsPristine(){this._selfDirty$.next(!1)}_onBeforeLoad(e,t){return this._lifecycleHookNotificationService?.onBeforeLoad?(0,l.from)(this._lifecycleHookNotificationService.onBeforeLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})).pipe((0,d.map)(n=>{if(n===!1)throw Error('Loading is disallowed by a "OnBeforeLoad" model lifecycle event')})):(0,l.of)(void 0)}_onAfterLoad(e,t){return this._lifecycleHookNotificationService?.onAfterLoad?(0,l.from)(this._lifecycleHookNotificationService.onAfterLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})):(0,l.of)(void 0)}_onBeforeInsert(e){return this._lifecycleHookNotificationService?.onBeforeInsert?this.getSchema().pipe((0,d.map)(t=>he.getModelPrimaryAttributeValues(t,[e])),(0,d.map)(t=>t.pop()),(0,d.switchMap)(t=>this._lifecycleHookNotificationService.onBeforeInsert({model:this,payload:{data:e,primaryAttributesValues:t}})),(0,d.map)(t=>{if(t===!1)throw Error('Inserting is disallowed by a "OnBeforeInsert" model lifecycle event')})):(0,l.of)(void 0)}_insert(e,t){return t(e).pipe((0,d.map)(n=>this._mapInsertResult(n)),(0,d.tap)(()=>this._persistedState={}),(0,d.tap)(()=>this._markAsPristine()),(0,d.tap)(()=>this._markForNotCollection(P.Update)),Td(()=>this.getSchema()),(0,d.tap)(([,n])=>{this._registerPrimaryAttributeValues(he.getModelPrimaryAttributeValues(n,[e]))}),(0,d.map)(([n])=>n),Rc(({data:n,actionType:i})=>this._notifyDataChange(n,i)),(0,d.map)(({result:n})=>n))}_onAfterInsert(e){return this._lifecycleHookNotificationService?.onAfterInsert?(0,l.from)(this._lifecycleHookNotificationService.onAfterInsert({model:this,payload:{data:e}})):(0,l.of)(void 0)}_onBeforeUpdate(e,t){return this._lifecycleHookNotificationService?.onBeforeUpdate?(0,l.from)(this._lifecycleHookNotificationService.onBeforeUpdate({model:this,payload:{data:e,parameters:t}})).pipe((0,d.map)(n=>{if(n===!1)throw Error('Updating is disallowed by a "OnBeforeUpdate" model lifecycle event')})):(0,l.of)(void 0)}_update(e,t,n){return n(t,e).pipe((0,d.mergeMap)(i=>this._mapSaveResult(i,e,t)),Rc(()=>this._notifyEventByParameters(t,Ye.Update)),(0,d.map)(({result:i})=>i),(0,d.tap)(()=>this.setLoadedState()))}_onAfterUpdate(e,t){return this._lifecycleHookNotificationService?.onAfterUpdate?(0,l.from)(this._lifecycleHookNotificationService.onAfterUpdate({model:this,payload:{data:e,parameters:t}})):(0,l.of)(void 0)}_onBeforeDelete(e){return this._lifecycleHookNotificationService?.onBeforeDelete?(0,l.from)(this._lifecycleHookNotificationService.onBeforeDelete({model:this,payload:{parameters:e}})).pipe((0,d.map)(t=>{if(t===!1)throw Error('Deleting is disallowed by a "OnBeforeDelete" model lifecycle event')})):(0,l.of)(void 0)}_delete(e,t){return t(e).pipe((0,d.tap)(()=>this._markAsPristine()),(0,d.tap)(()=>this._markForNotCollection(P.Init)),Rc(()=>this._notifyEventByParameters(e,Ye.Delete)))}_onAfterDelete(e){return this._lifecycleHookNotificationService?.onAfterDelete?(0,l.from)(this._lifecycleHookNotificationService.onAfterDelete({model:this,payload:{parameters:e}})):(0,l.of)(void 0)}innerInsert(e,t){const i=this.getSchema().pipe((0,d.map)(r=>({dataSchema:r,data:{...this._persistedState??{},...t}})),(0,d.map)(({data:r,dataSchema:a})=>he.getOwnColumnsValues(a,r))).pipe(jt(r=>this._onBeforeInsert(r)),Dd(r=>this._insert(r,e)),jt(([r])=>this._onAfterInsert(r)),(0,d.map)(([,r])=>r),(0,d.tap)(()=>{this._isLoaded=!0}),(0,d.catchError)(r=>(0,l.of)(ou(r))));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,i.pipe((0,d.takeUntil)(this._destroyed$)),i)}innerUpdate(e,t,n){const r=this.getSchema().pipe((0,d.map)(a=>he.getOwnColumnsValues(a,t)),(0,d.map)(a=>this._getChangedAttributesValues(a))).pipe(jt(a=>this._onBeforeUpdate(a,n)),Dd(a=>this._update(a,n,e)),jt(([a])=>this._onAfterUpdate(a,n)),(0,d.map)(([,a])=>a),(0,d.catchError)(a=>(0,l.of)(ou(a))));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,d.takeUntil)(this._destroyed$)),r)}innerDelete(e,t){return this._onBeforeDelete(t).pipe((0,d.switchMap)(()=>this._delete(t,e)),jt(()=>this._onAfterDelete(t)),(0,d.catchError)(n=>(0,l.of)(ou(n))))}innerLoad(e,t){if(this._destroyed)return(0,l.of)([]);this._isLoading=!0;const n=t?.attributes,i=t?.parameters||[],r=he.getDataSourceLoadOptions(t?.options),a=this._load(e,n,i,r).pipe((0,d.tap)(()=>this._isLoading=!1),(0,d.catchError)(c=>(this._isLoading=!1,(0,l.throwError)(()=>c))));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,a.pipe((0,d.takeUntil)(this._destroyed$)),a)}createChildModel(){return new es(this.injector,this.dataSource)}static create(e){return(0,l.from)(this.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},""))}init(){return this.getSchema().pipe((0,d.tap)(e=>this._dataSchemaName=e.name),(0,d.tap)(e=>this._buildAttributesMap(e)),(0,d.map)(()=>this),(0,d.tap)(()=>this._isInitialized=!this.hasCriticalErrors),(0,d.tap)(()=>{this._subscribeChildrenModeChanges(),this._subscribeChildrenDirtyChanges()}),(0,d.take)(1))}getSchema(){if(!this.dataSource)return(0,l.of)(null);if(this.hasCriticalErrors)return(0,l.of)(this.dataSource.getEmptySchema());const e=this.dataSource.getSchema();return this._measurePerformanceService?e.pipe(this._measurePerformanceService.measure$(`model.getSchema.${this.name}`)):e}getDataSource(){return this.dataSource}load(e){return this.innerLoad((t,n,i)=>this.dataSource.load(t,n,i),e)}updateDependentAttributes(e){this._attributesMap=this._attributesMap.filter(i=>i.isSchemaAttribute);const t=this._attributesMap.map(i=>i.name),n=e.filter(i=>!t.includes(i.path)).map(i=>({name:i.path,path:i.path,attributeType:i.type??W.ForwardReferenceAttribute,dependentAttributes:[],isSchemaAttribute:!1}));this._attributesMap.push(...n),this._updateAttributesDependencies()}canReloadDependentData(e){return this._getDependentAttributesNames([e]).length!==0}getDependentAttributesNames(e){return this._getDependentAttributesNames([e])}reloadDependentData(e,t){const n=this._getDependentAttributesNames([e]);if(n.length===0)return(0,l.of)([]);if(t==null)return(0,l.of)([Object.fromEntries(n.map(a=>[a,null]))]);const i=[{type:j.PrimaryColumnValue,value:t}],r=[];return(0,l.forkJoin)([this._getDependentAttributesInfo(n),this.dataSource.getLookupDataSchema(e)]).pipe((0,d.switchMap)(([a,c])=>{const h=a.filter(m=>m.type!==W.OwnAttribute).map(m=>[m.alias,m.config]),p={type:c.dataSourceConfig.type,config:{...c.dataSourceConfig.config,attributes:Object.fromEntries(h)}};return a.forEach(m=>{r.push({ownAttributeName:m.attributeName,alias:m.alias})}),this._createDataSource(`${this.name}_reloadData`,c,p)}),(0,d.switchMap)(a=>a.load([...new Set(r.map(c=>c.alias))],i,{throttled:!0})),(0,d.map)(a=>a.map(c=>{const h={};return r.forEach(p=>{h[p.ownAttributeName]=c[p.alias]}),h})))}create(e={}){return this._isLoading=!0,this.getSchema().pipe((0,d.map)(t=>he.getOwnColumnsValues(t,e)),(0,d.switchMap)(t=>(0,l.forkJoin)([(0,l.of)(t),this.dataSource.getDefaultValues()])),(0,d.tap)(()=>this._markForNotCollection(P.Create)),(0,d.map)(([t,n])=>(this._persistedState={...n,...t},this._persistedState)),(0,d.switchMap)(t=>this._loadDependentDataForCreate(t)),(0,d.tap)(()=>this._isLoading=!1))}copy(e,t={}){return this._isLoading=!0,this.getSchema().pipe((0,d.map)(n=>({schema:n,attributes:n.attributes.filter(i=>i.attributeType===W.OwnAttribute&&i.isValueCloneable).map(i=>i.name),parameters:typeof e=="string"?[{type:j.PrimaryColumnValue,value:e}]:n.getPrimaryAttributesNames().filter(i=>e[i]).map(i=>({type:j.PrimaryColumnValue,value:{[i]:e[i]}}))})),(0,d.mergeMap)(({schema:n,attributes:i,parameters:r})=>this._load((a,c,h)=>this.dataSource.load(a,c,h),i,r,{},P.Copy).pipe((0,d.tap)(()=>{this._isLoaded=!1}),(0,d.tap)(a=>{if(a.length>1)throw new Error("More than one record loaded for copy");if(a.length===0)throw new Error("No records loaded for copy")}),(0,d.map)(a=>he.removeNotRequestedData(i,{...a[0]})),(0,d.map)(a=>{n.getPrimaryAttributesNames().forEach(h=>delete a[h]);const c=he.getOwnColumnsValues(n,t);return{...a,...c}}),(0,d.switchMap)(a=>this.dataSource.getDefaultValues().pipe((0,d.map)(c=>({...c,...a})))),(0,d.tap)(a=>{this._persistedState={...a}}),(0,d.switchMap)(a=>this._loadDependentDataForCreate(a)),(0,d.tap)(()=>{this._isLoaded=!0,this._isLoading=!1}),(0,d.catchError)(a=>(this._isLoading=!1,this._markForNotCollection(P.Update),(0,l.throwError)(()=>new Error(a)))))))}insert(e){return this.innerInsert(t=>this.dataSource.insert(t),e)}update(e,t){return this.innerUpdate((n,i)=>this.dataSource.save(n,i),e,t)}insertOrUpdate(e,t){return this._mode===P.Update?this.update(e,t):this.insert(e)}delete(e){return this.innerDelete(t=>this.dataSource.delete(t),e)}setValue(e){const t=Object.keys(e);return this._checkAttributesInDataSchema(t).pipe((0,d.tap)(()=>{t.length>0&&(this._dirtyAttributes=new Set([...this._dirtyAttributes,...t]),this._persistedState={...this._persistedState??{},...e})}),(0,d.map)(()=>null))}_getPersistedState(){return{...this._persistedState??{}}}markFor(e){this.mode!==e&&(this._setMode(e),this._modeChanges.next(e))}resetMode(){this._mode!==P.Init&&(this._mode=P.Init,this._modeChanges.next(this._mode))}loadLookupList(e,t,n={}){if(!this.dataSource)throw Error("DataSource is null");const i=this.dataSource.getLookupDataSchema(e).pipe((0,d.switchMap)(r=>{const a=r.getPrimaryLoadAttributes();return this._createDataSource(this._lookupDataSourceName,r).pipe((0,d.switchMap)(c=>c.load(a,t,n)),(0,d.map)(c=>({primaryAttributeName:r.primaryAttributeName,primaryDisplayAttributeName:r.primaryDisplayAttributeName,data:c})))}));return(0,l.iif)(()=>!this._doNotAllowCancelRequest,i.pipe((0,d.takeUntil)(this._destroyed$)),i)}canDelete(e){return(0,l.lastValueFrom)(this.dataSource.canDelete(e),{defaultValue:null})}canSave(e){switch(this._mode){case P.Init:return Promise.resolve({result:!1});case P.Create:case P.Copy:return(0,l.lastValueFrom)(this.dataSource.canCreate(e),{defaultValue:null});case P.Update:return(0,l.lastValueFrom)(this.dataSource.canEdit(e),{defaultValue:null});case P.Delete:return this.canDelete(e);default:throw Error(`Unable to verify the possibility of operation executing: the '${this._mode}' is not supported.`)}}attributeChanged(e,t){t||this._selfDirty$.next(!0),this._dirtyAttributes.add(e)}setLoadedState(e=null){if(this._isCollectionModel||!e){this._dirtyAttributes.clear(),this._markAsPristine();return}e.forEach(t=>this._dirtyAttributes.delete(t)),this._dirtyAttributes.size||this._markAsPristine()}createCollectionItemModel(e){const t=this.createChildModel();return t._isCollectionItemModel=!0,t._isLoaded=!0,t._isInitialized=!0,t._persistedState={},t._dataSchemaName=this._dataSchemaName,t._attributesMap=this._attributesMap,e!=null&&(t._setMode(e),t._selfDirty$.next(!1)),this._children.push(t),t}childrenChange(){this._children$.next(this._children)}removeChild(e){const t=e?._id,n=this._children.findIndex(i=>i?._id===t);n!==-1&&this._children.splice(n,1)}_getAsyncResult(e){return(0,l.firstValueFrom)(e)}getLastError(){return this.dataSource?this.dataSource.getLastError():new Error("DataSource is null")}destroy(){this._isInitialized=!1,this._destroyed$.next(),this._destroyed$.complete(),this._selfDirty$.complete(),this._children$.complete(),this._childrenDirty$.complete(),this._childrenModes$.complete(),this._destroyed=!0}getOwnLoadParameters(){return this.dataSource.getOwnLoadParameters()}getAllowCopyingRecords(){return this.dataSource.getAllowCopyingRecords()}}(0,u.__decorate)([ot({requestType:"crt.ModelGenerator",methodName:"generateOne"}),(0,u.__metadata)("design:type",Function)],es.prototype,"_create",void 0);class au extends es{get supportsTransactions(){return this.dataSource?this.dataSource.supportTransactions:!1}createChildModel(){return new au(this.injector,this.dataSource)}loadInTransaction(e,t){return e.createOperation(n=>(0,l.firstValueFrom)(this.innerLoad((i,r,a)=>this.dataSource.loadInTransaction(n,i,r,a),t)))}insertInTransaction(e,t){return e.createOperation(n=>(0,l.firstValueFrom)(this.innerInsert(i=>this.dataSource.insertInTransaction(n,i),t)))}updateInTransaction(e,t,n){return e.createOperation(i=>(0,l.firstValueFrom)(this.innerUpdate((r,a)=>this.dataSource.saveInTransaction(i,r,a),t,n)))}insertOrUpdateInTransaction(e,t,n){return this.mode===P.Update?this.updateInTransaction(e,t,n):this.insertInTransaction(e,t)}deleteInTransaction(e,t){return e.createOperation(n=>(0,l.firstValueFrom)(this.innerDelete(i=>this.dataSource.deleteInTransaction(n,i),t)))}}let cu=class Ec{constructor(e,t,n,i){this.dataSourceFactory=e,this.entitySchemaRepository=t,this._featureValues=n,this._injector=i}get _transactionsEnabled(){return this._featureValues["DataSource-DisableTransactions"]!==!0}_createModel(e=null,t=!1,n){const i=e.supportTransactions&&this._transactionsEnabled?new au(n||this._injector,e):new es(n||this._injector,e);return i.disableSync=t,i.init()}_validateModelConfig(e){if(e.primaryDataSourceName&&!e.dataSources[e.primaryDataSourceName])throw new Error(`Data source "${e.primaryDataSourceName}" cannot be primary data source. Data source "${e.primaryDataSourceName}" not found in model config.`);if(e.primaryDataSourceName&&e.dataSources[e.primaryDataSourceName]?.scope===ut.ViewElement)throw new Error(`Data source "${e.primaryDataSourceName}" with scope "viewElement" cannot be primary. Only data sources with scope "page" can be primary`)}_getEntitySchemesRequest(e){return e.map(([,t])=>t).filter(t=>t.type==="crt.EntityDataSource").map(t=>t.config).filter(t=>!!t.entitySchemaName).map(t=>{let n=[];return t.attributes&&(n=Object.entries(t.attributes).filter(([,i])=>i.type===W.ForwardReferenceAttribute).map(([,i])=>i.path)),{name:t.entitySchemaName,loadLookupColumns:!0,forwardReferencePaths:n}})}_generateFromConfig(e,t){let n,i;const r=t?.get(q,null,{optional:!0});return r?(n=Object.entries(e?.dataSources||{}).filter(([a,c])=>c.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),n.length===0?(0,l.of)([]):(this._validateModelConfig(e),i=n.map(([a,c])=>this.generateOne(c,a,t)),this.preInitializeDataSources(n).pipe(r.measure$("modelGenerator.generateFromConfig"),(0,l.switchMap)(()=>(0,l.forkJoin)(i))))):(n=Object.entries(e?.dataSources||{}).filter(([a,c])=>c.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),n.length===0?(0,l.of)([]):(this._validateModelConfig(e),i=n.map(([a,c])=>this.generateOne(c,a,t)),this.preInitializeDataSources(n).pipe((0,l.switchMap)(()=>(0,l.forkJoin)(i)))))}preInitializeDataSources(e){if(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"])return(0,l.of)(null);const t=this._getEntitySchemesRequest(e);return this.entitySchemaRepository.getSchemes(t).pipe((0,d.catchError)(n=>(0,l.of)([])),(0,d.map)(n=>null))}generate(e,t){return this._generateFromConfig(e,t)}generateOne(e,t,n){const i=n?.get(q,null,{optional:!0});return i?this.dataSourceFactory.create(t,e,n).pipe(i.measure$(`modelGenerator.generateOne.${t}`),(0,d.mergeMap)(r=>this._createModel(r,e.disableSync,n))):this.dataSourceFactory.create(t,e,n).pipe((0,d.mergeMap)(r=>this._createModel(r,e.disableSync,n)))}static{this.\u0275fac=function(t){return new(t||Ec)(s.\u0275\u0275inject(Gn),s.\u0275\u0275inject(rt),s.\u0275\u0275inject(Q),s.\u0275\u0275inject(s.Injector))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Ec,factory:Ec.\u0275fac})}};cu=(0,u.__decorate)([Xe({requestType:"crt.ModelGenerator"}),(0,u.__metadata)("design:paramtypes",[Gn,rt,Oy,s.Injector])],cu);class Zr{constructor(e,t,n){this._sysSettingsService=e,this._dataSchemaRepository=t,this._featureValues=n,this._searchComparisonTypeSysSettingCode="StringColumnSearchComparisonType"}_getParameterValue(e,t,n){if(typeof t=="string"){if(t.startsWith("@requestPayload")){const i=t.replace("@requestPayload.","");return(0,v.get)(n,i)}if(t.startsWith("$"))return e.attributes[t.substring(1)];if(e.attributes[t])return e.attributes[t]}return t}_applyFilterMacros(e,t){let n=null;switch(typeof t){case"object":n=JSON.stringify((0,oe.classToPlain)(t));break;case"string":n=t;break;default:return t}const i=/##ViewModelMacro\.\$([^#]+)##/g;let r=!1;return[...n.matchAll(i)].forEach(a=>{const c=a[1],h=(0,v.get)(e.attributes,c);let p=h?.toString();typeof h=="object"&&(r=!0,p=JSON.stringify(h)),n=n.replace(a[0],p)}),typeof t=="object"||r?JSON.parse(n):n}_createPrimaryDisplayColumnValueFilter(e){var t=this;return(0,b.A)(function*(){const n=t._searchComparisonTypeSysSettingCode,r=(yield t._sysSettingsService.getByCode(n))?.value===1?K.Contain:K.Start_with;return{type:j.PrimaryDisplayValueFilter,value:e,comparisonType:r}})()}_createColumnValueFilter(e,t,n){const i=t;return Promise.resolve({type:j.ColumnValue,value:{attributePath:i.attributePath,attributeValue:this._getParameterValue(e,i.attributeValue,n)}})}_getOwnLoadParameters(e,t){return e.getModelByName(t)?.getOwnLoadParameters()}_getDataSourceFilteringParameters(e,t){return(0,b.A)(function*(){const i=e._dataSourcesInfos.get(t).getFilteringConfig();return e._checkFilteringAttributes(t,i),i.length?(yield Promise.all(i.map(a=>e[a.name]))).map(a=>({type:j.Filter,value:a})):Promise.resolve([])})()}_getDataSourceOwnFilteringParameters(e,t){return this._getOwnLoadParameters(e,t)?.parameters??[]}_getPrimaryAttributeName(e,t){var n=this;return(0,b.A)(function*(){if(!t)return null;let i=Object.values(e.dataSchemas).find(r=>r.name===t);return i||(i=yield(0,l.lastValueFrom)(n._dataSchemaRepository.get(t))),i?.primaryAttributeName})()}_getParameterRelationsConfigs(e){return e.relationsConfigs||[]}_createRelationParameter(e,t){const n={...e},i=this._getParameterRelationsConfigs(n);return n.relationsConfigs=[{dataSchemaName:t.dataSchemaName,attributePath:t.attributePath,relationPath:t.relationPath},...i],n}_validateAllowedRelations(e,t,n){const r=n?.relationPath?.split(".")?.shift(),a=e.dataSchemas[t],c=a?.findAttributeByName(r);if(a&&c&&a.primaryAttributeName!==r&&c.dataValueType!==_.Lookup&&!this._featureValues.DataSourceAllowRelationsByNonLookupColumn){const h="Filtration of data sources by page data is currently supported by lookup and primaryAttribute fields only",p=new Error(`${h}, please see the console for more details`);throw p.stack=`${h} , data source name: ${t}, relation config: ${JSON.stringify(n)}`,p}}_createRelationParameterWithAttributeValue(e,t,n,i){var r=this;return(0,b.A)(function*(){const a={...n},c=r._getParameterRelationsConfigs(a),h=e.dataSchemas[t],p=i.relationPath.split("."),m=p.shift(),f=h.findAttributeByName(m);if(f.dataValueType!==_.Lookup&&(r._featureValues.DataSourceAllowRelationsByNonLookupColumn||h.primaryAttributeName===m))return a.type=j.ColumnValue,a.value={attributePath:i.attributePath,attributeValue:i.value},a.relationsConfigs=c,a;const C={dataSchemaName:i.dataSchemaName,attributePath:i.attributePath,relationPath:i.relationPath};a.value=i.value,a.type=j.PrimaryColumnValue,h.primaryAttributeName!==m&&(C.dataSchemaName=f.referenceSchemaName);const S=h.type!==Xi.Entity?C.dataSchemaName:i.dataSchemaName;return C.relationPath=p.length===0?yield r._getPrimaryAttributeName(e,S):p.join("."),a.relationsConfigs=[C,...c],a})()}_convertToRelationParameters(e,t,n,i){var r=this;return(0,b.A)(function*(){const a=[];r._validateAllowedRelations(e,t,i);for(const c of n){const h=i.useAttributeValue?yield r._createRelationParameterWithAttributeValue(e,t,c,i):r._createRelationParameter(c,i);a.push(h)}return a})()}_getRelationParameters(e,t,n){var i=this;return(0,b.A)(function*(){const r=e._modelDependencies[t]||[];if(r.length===0)return Promise.resolve([]);const a=r.map(p=>i.getLoadParametersByRelation(e,p,t,n)),h=(yield Promise.all(a)).flat();return i._featureValues.DisableDsDepsJoinOptimization?h:i._selectOptimizedParametersForJoin(h)})()}_getPagingConfigRowCount(e,t,n,i){return typeof t=="string"&&(t=(0,v.isNil)(e.attributes[t])?0:e.attributes[t]),i&&(!t||t+n>i)&&(t=i-n),t}_getPagingConfigRowsOffset(e,t,n,i){const r=e._dataSourcesInfos.get(i).collectionViewModelAttributeName,a=e.attributes[r]?.length??0;if(typeof t=="number")throw new Error("Rows offset parameter cannot be set to number");return!t&&n===de.LoadNext?a:!t&&n===de.Reload?0:(e.attributes[t]=(0,v.isNil)(e.attributes[t])?0:e.attributes[t],n===de.Reload?e.attributes[t]:e.attributes[t]+a)}_getModelPagingConfig(e,t,n,i){if(!t){const c=this._getOwnLoadParameters(e,i);return Promise.resolve(c?.options?.pagingConfig??null)}const r=this._getPagingConfigRowsOffset(e,t.rowsOffset,n,i),a=this._getPagingConfigRowCount(e,t.rowCount,r,t.rowsLimit);return Promise.resolve({rowCount:a,rowsOffset:r})}_mergeSorting(e,t){return(0,v.unionBy)(e??[],t??[],"columnName")??null}_getModelSortingConfig(e,t,n){var i=this;return(0,b.A)(function*(){const a=i._getOwnLoadParameters(e,n)?.options?.sortingConfig,c=t?.attributeName;if(!c||!e.attributes[c])return a?Promise.resolve(a):Promise.resolve(null);const h=yield Promise.all(e.attributes[c].map(function(){var p=(0,b.A)(function*(m){return{columnName:yield m.columnName,direction:yield m.direction}});return function(m){return p.apply(this,arguments)}}()));return{columns:i._mergeSorting(h,a?.columns)}})()}_getHierarchyFilterAttributeValues(e,t){return(0,b.A)(function*(){if(!t?.length)return Promise.resolve(null);let n;for(const i of t){const r=yield e[i.name];if(!r)continue;const a=typeof r=="string"?Ee.fromJson(JSON.parse(r),zr):"filters"in r?r:Ee.fromJson(r,zr);a&&(n?a.filters.forEach(c=>{n.add(c)}):n=a)}return n?.filters?.size>0?n:null})()}_getHierarchyColumnValue(e,t){return(0,b.A)(function*(){if(!t)return Promise.resolve(null);const n=yield e[t];return(typeof n=="string"?n:n?.value)??null})()}_getModelHierarchyConfig(e,t,n,i){var r=this;return(0,b.A)(function*(){const a={},h=r._getOwnLoadParameters(e,n)?.options?.hierarchyConfig;if(!h||!h.hierarchicalFullDataLoad)return Promise.resolve(null);const p=yield r._getHierarchyFilterAttributeValues(i,t?.hierarchicalFilterAttributes),m=yield r._getHierarchyColumnValue(i,t?.hierarchicalColumnValueAttributeName);return a.hierarchicalFullDataLoad=h.hierarchicalFullDataLoad,a.hierarchicalColumnName=h.hierarchicalColumnName,a.hierarchicalMaxDepth=h.hierarchicalMaxDepth,a.hierarchicalColumnValue=m??null,a.hierarchicalColumnFiltersValue=p??null,Promise.resolve(a)})()}_updateLastEventLoadParameters(e,t,n,i){n&&n.length!==0?e._lastEventLoadParameters.set(t,n):i!==!0&&e._lastEventLoadParameters.set(t,[{type:j.Empty,value:""}])}_getModelLoadParameters(e,t,n,i,r,a,c){var h=this;return(0,b.A)(function*(){const p=yield h.getModelParameters(e,n,i);a!==!0&&h._updateLastEventLoadParameters(e,t,p,r);const m=r!==!0?p:e._lastEventLoadParameters.get(t)||[{type:j.Never,value:""}],[f,C,S]=yield Promise.all([h._getDataSourceFilteringParameters(e,t),h._getDataSourceOwnFilteringParameters(e,t),h._getRelationParameters(e,t,c)]);return[...m,...C,...f,...S]})()}_selectOptimizedParametersForJoin(e){if(e.every(({type:a})=>a===j.Empty))return e;const n=e.filter(({type:a,value:c})=>a!==j.Empty&&(a!==j.Filter||!!c)),i=e.filter(({type:a,relationsConfigs:c})=>a===j.Empty&&c?.length);if(!i.length)return n;const[r]=[...i].sort((a,c)=>c.relationsConfigs.length-a.relationsConfigs.length);return[...n,r]}getLoadParametersByRelation(e,t,n,i){var r=this;return(0,b.A)(function*(){const a=t.relationPath.split("."),c=a.shift(),h=e.dataSchemas[c],p={dataSchemaName:h.name,attributePath:t.attributePath,relationPath:a.join(".")},m=a.shift(),C=e._dataSourcesInfos.get(c).getMappedAttributeNames(m)?.[0]??null,S=e.getModelMode(c),w=i?.[c]?.[p.relationPath];if(e.getModelByName(n)?.getAllowCopyingRecords()&&w)p.value=w,p.useAttributeValue=!0;else{const se=e.getIsDirty(C)||S===P.Create||S===P.Copy||h.type!==Xi.Entity;if(C&&se){p.useAttributeValue=!0;const J=e.attributes[C];if(p.value=J?.value?J.value:J,p.value)return r._validateAllowedRelations(e,c,p),Promise.resolve([{type:j.ColumnValue,value:{attributePath:p.attributePath,attributeValue:p.value},relationsConfigs:[]}])}}const H=yield r._getModelLoadParameters(e,c,null,null,!0,!1);return r._convertToRelationParameters(e,c,H,p)})()}getModelParameters(e,t,n){if(n?.parameters&&(t=[...t,...n.parameters]),!t||t.length===0)return Promise.resolve([]);const i=t.map(r=>{switch(r.type){case j.PrimaryColumnValue:return Promise.resolve({type:r.type,value:this._getParameterValue(e,r.value,n)});case j.Filter:return Promise.resolve({type:r.type,value:this._applyFilterMacros(e,r.value)});case j.PrimaryDisplayValueFilter:return this._createPrimaryDisplayColumnValueFilter(this._getParameterValue(e,r.value,n));case j.ColumnValue:return this._createColumnValueFilter(e,r.value,n)}});return Promise.all(i)}getModelLoadParameters(e,t,n,i=de.Load,{payload:r,useLastLoadParameters:a,doNotUpdateLastLoadParameters:c,modelLoadConfiguration:h}={}){const p=t.name,m=i??de.Load,f=m===de.Load?null:t.getPagingConfig(),C=t.getSortingConfig(),S=t.getHierarchyConfig();return Promise.all([this._getModelLoadParameters(e,p,n,r,a,c,h),this._getModelPagingConfig(e,f,m,p),this._getModelSortingConfig(e,C,p),this._getModelHierarchyConfig(e,S,p,e)])}static{this.\u0275fac=function(t){return new(t||Zr)(s.\u0275\u0275inject(Ge),s.\u0275\u0275inject(en),s.\u0275\u0275inject(Q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Zr,factory:Zr.\u0275fac,providedIn:"root"})}}class Et{get attributesMap(){return this._attributesMap}get mappedViewModelAttributes(){return this._mappedViewModelAttributes}get isCollection(){return this._isCollection}get collectionViewModelAttributeName(){return this._collectionViewModelAttributeName}constructor(e){this._attributesMap=new Map,this._mappedViewModelAttributes=new Set,this.attributes=[],this.includePrimaryAttributes=!0,this.name=e}static _getDataSourceInfo(e,t){if(!e.has(t)){const n=new Et(t);return e.set(t,n),n}return e.get(t)}static _extractViewModelAttributeMapInfo(e){const t=e.split(".");return{dataSourceName:t.shift(),dataSourceAttributePath:t.join(".")}}static _getByDefaultAttribute(e,t,n,i=""){const r=t.modelConfig;if(!r||!r.path)return;const a=this._extractViewModelAttributeMapInfo(r.path);if(!a.dataSourceAttributePath){this._getByViewModelCollectionAttribute(e,t,n);return}if(i&&i!==a.dataSourceName)throw new Error(`Attribute '${e}' mapped on a few DataSources`);const c=this._getDataSourceInfo(n,a.dataSourceName),h=r.aggregationConfig?.aggregationFunction?mp(a.dataSourceAttributePath):a.dataSourceAttributePath;c.attributes.push({path:h,type:r.type,functionConfig:r.functionConfig,aggregationConfig:r.aggregationConfig}),c._mappedViewModelAttributes.add(e),c._attributesMap.set(e,a.dataSourceAttributePath)}static _getByInlineViewModelAttribute(e,t,n,i=""){const r=t.viewModelConfig||{};Object.entries(r.attributes||{}).forEach(([a,c])=>{const h=`${e}.${a}`;this._processViewModelAttribute(h,c,n,i)})}static _getByViewModelCollectionAttribute(e,t,n){const i=t.modelConfig;if(!i||!i.path)return;const a=this._extractViewModelAttributeMapInfo(i.path).dataSourceName,c=this._getDataSourceInfo(n,a);c._isCollection=!0,c._collectionViewModelAttributeName=e,c._pagingConfig=i.pagingConfig,c._sortingConfig=i.sortingConfig,c._hierarchyConfig=i.hierarchyConfig,c._filteringConfig=i.filterAttributes,c.includePrimaryAttributes=i.includePrimaryAttributes===void 0?!0:i.includePrimaryAttributes;const h=t?.viewModelConfig;Object.entries(h?.attributes||{}).forEach(([p,m])=>{this._processViewModelAttribute(`${e}.${p}`,m,n,a)})}static _processViewModelAttribute(e,t,n,i=""){"viewModelConfig"in t||"viewModelName"in t?t.isCollection?this._getByViewModelCollectionAttribute(e,t,n):this._getByInlineViewModelAttribute(e,t,n,i):"from"in t||this._getByDefaultAttribute(e,t,n,i)}static getFromViewModelConfig(e,t=[]){const n=new Map;return Object.entries(e?.attributes||{}).forEach(([i,r])=>{this._processViewModelAttribute(i,r,n)}),t.filter(i=>!n.has(i.name)).forEach(({name:i})=>{const r=new Et(i);n.set(i,r)}),n}static getLookupListDataSourceInfo(e,t){const n=new Et("");return n._isCollection=!0,n._collectionViewModelAttributeName=e,Object.entries(t).forEach(([i,r])=>{n.attributes.push({path:r}),n._mappedViewModelAttributes.add(i),n._attributesMap.set(i,r)}),n}_getRowModelDto(e){const t=e.length>0?e[0]:{},n={};return Object.entries(t).forEach(([i,r])=>{this.getMappedAttributeNames(i).forEach(c=>{const h=c.split(".");this.isCollection&&h.length>1&&h.shift(),(0,v.set)(n,h.join("."),r)})}),n}_getCollectionModelDto(e){const t=this._collectionViewModelAttributeName,n=e.map(i=>this._getRowModelDto([i]));return{[t]:n}}getMappedAttributes(){return Array.from(this._mappedViewModelAttributes.values())}getMappedAttributeNames(e){return Array.from(this._attributesMap.entries()).filter(([,t])=>t===e).map(([t])=>t)}getDataSourceAttributePath(e){return this._attributesMap.has(e)?this._attributesMap.get(e):""}getIsMapOnCollection(e){return this._isCollection&&this._collectionViewModelAttributeName===e}getPagingConfig(){return this._pagingConfig}getSortingConfig(){return this._sortingConfig}getHierarchyConfig(){return this._hierarchyConfig}getFilteringConfig(){return this._filteringConfig||[]}getModelDto(e){return this._isCollection?this._getCollectionModelDto(e):this._getRowModelDto(e)}addNewAttribute(e,t,n){const i=new Map;i.set(this.name,this),Et._getByDefaultAttribute(e,t,i,n)}getIsDataSourceAttributePathExists(e){return this.attributes.find(t=>t.path===e)!==void 0}}class mC{}var Hn;(function(o){o.None="None",o.OneToMany="OneToMany",o.ManyToOne="ManyToOne",o.ManyToMany="ManyToMany",o.CircularDependency="CircularDependency"})(Hn||(Hn={}));function gw(o,e){return!!o?.some(t=>t.relationPath.split(".").shift()===e)}function Pp(o){return o.dataValueType===_.Guid}function Tp(o,e){return Pp(e)&&o.primaryAttributeName===e.name}function gC(o,e,t,n){const i=t.findAttributeByName(n),r=o.findAttributeByName(e);return(r.isLookup||Pp(r))&&Tp(t,i)?Hn.OneToMany:Tp(o,r)&&i.isLookup?Hn.ManyToOne:Hn.ManyToMany}function lu(o){const e=o.split("."),t=e.shift(),n=e.shift();return{dependOnModelName:t,dependOnAttributeName:n}}function Dp(o){Object.values(o.controls||{}).forEach(e=>{e instanceof wt.FormGroup||e instanceof wt.FormArray?Dp(e):e.updateValueAndValidity({onlySelf:!0})})}function fw(o){o?.markAsPristine(),o?.markAsUntouched(),o?.updateValueAndValidity()}function _w(o){return Object.values(o?.errors||{}).map(e=>e?.message).filter(Boolean)}function Op(o){return o.statusChanges.pipe((0,d.startWith)(o.status),(0,d.first)(()=>o.status.toLowerCase()!=="pending"),(0,d.map)(()=>{}))}const fC=500;class ht{static{this._skippedProperties=["schedule","then"]}constructor(e,t,n,i,r,a,c,h){this.viewModelGenerator=e,this.injector=t,this.viewModelConfig=n,this.resources=i,this._eventScopes=a,this._modelsInitConfig=c,this._defaultPrimaryAttributeName="Id",this._models$=new l.BehaviorSubject([]),this._businessRulesActive=!0,this._dropdownPageSizeSettingsCode="DropdownPageSize",this._dataSourcesInfos=new Map,this._attributesToDataSourceNameMap=new Map,this._dropdownPageSize=null,this._replayEvents$=new l.ReplaySubject,this._loadedDataSources=new Set,this._conflictedModels=[],this.__destroyed=!1,this._disableViewModelWaitingForAsyncTasks=!1,this._disableViewModelLoadUnblockingThread=!1,this._blockFieldsAffectedByBusinessRules=!1,this._asyncTasksExecutingSubject=new l.BehaviorSubject(new Set),this._modelsRequestedToLoad=new Set,this._attributesAffectedByBusinessRules=[],this._businessRulesAreActivated=!1,this._destroySubject=new l.Subject,this._modelSourceRecordId={},this._modelLoadParametersSetted$=new l.Subject,this._modelsNamesWithParameters=new Set,this.saveModelTaskName="MODEL_SAVING",this._modelLoaded$=new l.Subject,this._viewModelAttributeChangeEventOptions=new dy({preventAttributeChangeRequest:!1,preventStateChange:!0,preventRunBusinessRules:!0}),this._dynamicModelNames=new Set,this._attributeConfigs={},this._eventsSubject$=new l.Subject,this._collectionSubscription=new Map,this._crtControls=new Map,this._subscriptions=new l.Subscription,this._destroy$=this._destroySubject.asObservable(),this._businessRulesActivated$=new l.BehaviorSubject(!1),this.attributes={},this.dataSchemas={},this.events$=(0,l.merge)(this._eventsSubject$,this._replayEvents$),this._systemAttributes=[],this.initDependencies(),this._subscribeModelsChanges(),this.handlerChain=Ct.instance,r?this.formApiModel=r:this.formApiModel=this.formBuilder.group({}),this.parent=h;const p=this._appInfo?.isDebugEnabled?this._createProxy(this):this;return this._viewModelDataDelayerService&&!this.parent&&this._viewModelDataDelayerService.setViewModel(p),p}get models(){return this._models$.value}get IsChanged(){return Promise.resolve(this.attributes[Or])}set IsChanged(e){}get HasUnsavedData(){return Promise.resolve(this.attributes[Fa])}set HasUnsavedData(e){}set BusinessRulesActivated(e){}get BusinessRulesActivated(){return Promise.resolve(this._businessRulesAreActivated)}get _isChanged(){return console.warn("Warning: The `_isChanged` property of the view-model is deprecated. It will be removed in future versions. Use `IsChanged` or `HasUnsavedData` attribute instead."),Object.keys(this._attributeConfigs).filter(e=>!(0,v.isEmpty)(this._attributeConfigs[e].modelConfig)).some(e=>this.formApiModel.controls[e]?.dirty)}get _scopes(){return[...this._eventScopes??[]]}get _injectionContext(){return this._context}get[Mt](){return this.injector}get primaryAttributeName(){if(!this._primaryModelName)return this._defaultPrimaryAttributeName in this._attributeConfigs?this._defaultPrimaryAttributeName:null;const t=this.dataSchemas[this._primaryModelName].primaryAttributeName,n=this._dataSourcesInfos.get(this._primaryModelName);return this._getMappedAttributeName(n,t)}get PrimaryModelMode(){return this.getPrimaryModelMode()}get State(){return Er(this).attributes[za]}get _destroyed(){return this.__destroyed}get modelInitConfigs(){return this._modelsInitConfig}_createProxy(e){return new Proxy(e,{get(t,n){return!(typeof n=="string")||n in t||ht._skippedProperties.includes(n)||console.debug(`Attribute ${n} not found.`),t[n]}})}_executeWithOptions(e,t){let n;try{return n=this._viewModelAttributeChangeEventOptions.getOptions(),this._viewModelAttributeChangeEventOptions.setOptions(t),e()}finally{this._viewModelAttributeChangeEventOptions.setOptions(n)}}_setSystemAttributeValue(e,t){const n=this.attributes[e];this.attributes[e]=t,this._executeWithOptions(()=>{this._fireChangeAttributeEvent({type:ue.ChangeAttributeValue,payload:{attributeName:e,oldValue:n,value:t}})},{preventStateChange:!0,preventRunBusinessRules:!0})}_fireChangeAttributeEvent(e){e.payload.silent??=this._viewModelAttributeChangeEventOptions.getAsSilent(),Object.assign(e.payload,this._viewModelAttributeChangeEventOptions.getOptions()),this._eventsSubject$.next(e)}_getViewModelValidators(e){const t=this.viewModelConfig.attributes[e]??{};return("validators"in t&&t.validators)??{}}_initDataSourceValidators(){return this._measurePerformanceService?.measure(`ViewModel.initDataSourceValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._validators={},this._dataSourcesInfos.forEach(e=>{e.attributesMap.forEach((t,n)=>{const i=this.viewModelConfig.attributes[n]??{};if("modelConfig"in i&&i.modelConfig?.ignoreValidators)return;this._validators[n]=this._validators[n]||[];const r=this._getDataSourceAttributeSchema(e,t);if(r?.validators){for(const[a,c]of Object.entries(r.validators))if(c?.type){const h=this._injectionContext??Er(this)?._injectionContext,p=this.validatorTypeResolver.getValidator(c.type,{validationParameters:c?.params,injectionContext:h}),m=this._getViewModelValidators(n),f=Object.values(m).find(C=>C.type===c.type);this._validators[n].push({name:a,instance:p,disabled:!!f?.disabled,params:c?.params})}}})}),(0,l.of)(null)))}_initSchemaValidators(e){this._measurePerformanceService.measure(`ViewModel.initSchemaValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{Object.entries(e||{}).forEach(([t])=>{const n=this._getViewModelValidators(t);this._validators[t]=this._validators[t]||[];for(const[i,r]of Object.entries(n))if(r?.type){const a=this._injectionContext??Er(this)?._injectionContext,c=this.validatorTypeResolver.getValidator(r.type,{validationParameters:r.params,injectionContext:a});this._validators[t].push({name:i,instance:c,disabled:r.disabled,params:r?.params})}})})}_waitAsyncValidation(){return(0,l.from)(this.waitAsyncTasksFinish()).pipe((0,d.switchMap)(()=>this.formApiModel.statusChanges.pipe((0,d.startWith)(this.formApiModel.status),(0,d.filter)(e=>e.toLowerCase()!=="pending"),(0,d.first)(),(0,d.map)(()=>null))))}_getResourcesStrings(){const e=this.resources?.strings??{};return{...e,...this._getResourceStringsByAttributes(e)}}_getChangedResourcesStrings(e){const t=Object.entries(e).reduce((i,[r,a])=>{const c=this.resources?.strings[r]||{},h=a&&{...c,...a};return{...i,[r]:h}},{}),n={...this.resources?.strings,...t};return JSON.parse(JSON.stringify(n))}_generateResourceAttribute(){this[pr]={},this[pr][ji.string]={};const e=this._getResourcesStrings();return this._attributeResourceGenerator.generate(this,e)}_getBoundAttributeNames(){const e=new Set;return this._dataSourcesInfos.forEach(t=>{for(const n of t.mappedViewModelAttributes)e.add(n)}),Array.from(e.values())}_getDataSourceInfoByViewModelAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e);return this._dataSourcesInfos.has(t)?this._dataSourcesInfos.get(t):null}_getResourceStringsByAttributes(e){const t=Object.keys(e);return this._getBoundAttributeNames().filter(i=>!t.includes(i)).reduce((i,r)=>(i[r]={},i),{})}_getDataSourceAttributeSchema(e,t){return this.dataSchemas[e.name]?.attributes?.find(n=>n.name===t)}_generatePrimaryAttributes(){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{const e=Array.from(this._dataSourcesInfos.values()).map(t=>{const n=t.name,i=this.dataSchemas[n],a=(t.includePrimaryAttributes?[i?.primaryAttributeName,i?.primaryDisplayAttributeName]:[]).filter(c=>c&&!t.getIsDataSourceAttributePathExists(c)).map(c=>{const h=L(),p=`${n}_${c}_${h}`,m=i.findAttributeByName(c),f={modelConfig:{path:`${n}.${c}`},dataValueTypeName:_[m.dataValueType]};return this._attributeConfigs[p]=f,t.addNewAttribute(p,f),this._attributeGenerate({[p]:f})});return a.length===0?(0,l.of)(null):(0,l.forkJoin)(a)});return e.length===0?(0,l.of)(null):(0,l.forkJoin)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.forkJoin.${this._injectionContext?.id}.parent.${!!this.parent}`))})}_getDataSourceDto(e){const t={},n=this._dataSourcesInfos.get(e);return n.attributesMap.forEach((i,r)=>{if(!n.getIsMapOnCollection(r)){const a=this.attributes[r],c=this._getDataSourceAttributeSchema(n,i);!a&&c?.dataValueType===_.Lookup?t[i]=null:t[i]=a}}),(0,l.of)(t)}_checkFilteringAttributes(e,t){if(t.some(i=>(0,v.isNil)(i.name)))throw new Error(`Filtering attributes for ${e} are not valid!`)}_attributeGenerate(e,t){return this._attributeGenerator.generate(this,e,{...t,onChangeAttributeValue:(n,i,r)=>{this._fireChangeAttributeEvent({type:ue.ChangeAttributeValue,payload:{attributeName:n,value:i,oldValue:r,silent:this._viewModelAttributeChangeEventOptions.getAsSilent()}})}})}_getDataSourceNamesAffectedByFilteringAttribute(e,t){return[...this._dataSourcesInfos.entries()].filter(([,n])=>n.isCollection).filter(([n])=>{const i=this.getModelByName(n);return t.has(i?.name)||i?.isLoaded||i?.isLoading}).filter(([n,i])=>this._getIsAnyFilterAttributesChanged(i,e,n)?!0:this._getIsAnyHierarchyFilterAttributesChanged(i,e,n)).map(([n])=>n)}_getIsAnyFilterAttributesChanged(e,t,n){const i=e.getFilteringConfig(),r=i.some(a=>a?.name===t&&a?.loadOnChange);return r&&this._checkFilteringAttributes(n,i),r}_getIsAnyHierarchyFilterAttributesChanged(e,t,n){const i=e.getHierarchyConfig();if(!i?.hierarchicalFilterAttributes&&!i?.hierarchicalColumnValueAttributeName)return!1;if(t===i?.hierarchicalColumnValueAttributeName)return!0;const r=i.hierarchicalFilterAttributes;if(r?.some(c=>c?.name===t&&c?.loadOnChange))return this._checkFilteringAttributes(n,r),!0}_createRequestsForReloadingDataSources(e){return e.map(t=>({type:"crt.LoadDataRequest",$context:this,dataSourceName:t,config:{loadType:de.Reload}}))}_dispatchStartLoadModelAttributes(e){const t=`${Xt.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.addTask(t,{targetTask:!0}),this._replayEvents$.next({type:ue.StartLoadModelAttributes,payload:e})}_dispatchFinishLoadModelAttributes(e){const t=`${Xt.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.removeTask(t,{targetTask:!0}),this._replayEvents$.next({type:ue.FinishLoadModelAttributes,payload:e})}_processEmptyLoadDataForCollection(e,t){var n=this;return(0,b.A)(function*(){if(!e.isCollection||!e.collectionViewModelAttributeName)return;const i=t.find(h=>h.type===j.PrimaryColumnValue);if(!i)return;const r=i.value?.value,a=n.attributes[e.collectionViewModelAttributeName];if(!r||!a)return;const c=yield a.findByPrimaryAttribute(r);c&&a.remove(c)})()}_loadDynamicModel(e){const t=e.attributeName,n=e.dataSourceConfig,i=e.dataSourceName||Ir.createDynamicDataSourceNameFromAttributeName(this,t),r=Ir.createAttributeConfig(this,i,e),a=this._createAndSetDataSourceInfo(i,t,r);return this._defineOrUpdateAttribute(t,r),this._setupSortingAttribute(e.sortingConfig),this._setupFiltersAttributes(e.filtersConfig),this._modelGenerator.generateOne(n,i).pipe((0,d.tap)(c=>this._markModelAsCollection(c,a)),(0,d.tap)(c=>this._dynamicModelNames.add(c.name)),(0,d.tap)(c=>this._upsertModel(i,c)),(0,d.tap)(c=>this._addModelDependencies(c,e.dependencies)),(0,d.switchMap)(c=>(0,l.forkJoin)([(0,l.of)(c),this._addDataSchemaToDataSchemas(c)])),(0,d.switchMap)(([c])=>(0,l.forkJoin)([(0,l.of)(c),(0,l.of)(this._replaceAttributesToDataSourceNameMap(a))])),(0,d.switchMap)(([c])=>(0,l.forkJoin)([(0,l.of)(c),this._reGenerateResourcesAttributes()])),(0,d.switchMap)(([c])=>this._loadModelData({model:c,dataSourceInfo:a,parametersConfig:[],loadType:de.Reload,useLastLoadParameters:e.useLastLoadParameters}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${e.dataSourceName}`))))}_defineOrUpdateAttribute(e,t){this.attributes[e]?this._attributeConfigs[e]=t:this._attributeGenerate({[e]:t})}_createAndSetDataSourceInfo(e,t,n){const r=Et.getFromViewModelConfig({attributes:{[t]:n}}).get(e);return this._dataSourcesInfos.set(e,r),r}_setupSortingAttribute(e){if(!e?.default)return;const t=e.attributeName;this.attributes[t]=e.default}_setupFiltersAttributes(e){e?.forEach(t=>{if(!t.value)return;const n=t.name,i=t.value;this[n]=i.value||i})}_addModelDependencies(e,t){this._modelDependencies[e.name]=t||[]}_addDataSchemaToDataSchemas(e){return e.getSchema().pipe((0,d.tap)(t=>this.dataSchemas[e.name]=t))}_reGenerateResourcesAttributes(){return(0,l.forkJoin)([...this._generateResourceAttribute(),(0,l.of)(null)])}_replaceAttributesToDataSourceNameMap(e){const t=this._getDataSourceAttributesMap(e),n=[...Array.from(this._attributesToDataSourceNameMap.entries()),...t];this._initializeAttributesToDataSourceNameMap(n)}_getMappedAttributeName(e,t){if(!e)return"";const n=e.getMappedAttributeNames(t);return!n||n.length===0?"":n[0]}_getMappedAttributeNames(e,t){return e?e.getMappedAttributeNames(t):[]}_getModelAttributesToLoad(e,t){const n=this._dataSourcesInfos.get(e.name);if(t?.attributes){const i=t.attributes.filter(r=>{const a=this._getMappedAttributeName(n,r);return!this.getIsDirty(a)});return this._getModelDependentAttributes(e,i)}return n?.attributes.map(i=>i.path)}_loadStaticModel(e,t,n,i,r,a){const c=this.getModelByName(e),h=this._dataSourcesInfos.get(c.name);return this._loadModelData({model:c,dataSourceInfo:h,parametersConfig:t,loadType:n,payload:i,useLastLoadParameters:r,doNotUpdateLastLoadParameters:a})}_waitDataDelay(e){return this._viewModelDataDelayerService?.shouldBeDelayed()?(0,l.of)(e).pipe((0,d.delayWhen)(()=>this._viewModelDataDelayerService.loadTrigger$)):(0,l.of)(e)}_updateTrackedAttributes(e){const t=this._modelDependencies[e.name];if(!t||!e.isAggregate)return;const n=/^.{0,2}\[\w+:\w+(:\w+)?]/;t.forEach(i=>{const r=i.relationPath.split(".")[0],a=this.getModelByName(r),c=e.affectedAttributes.filter(p=>p.schemaName===a.dataSchemaName).map(p=>p.path.split(".")[0]).filter(p=>!n.test(p)),h=new Set([...i.trackByAttributes??[],...c]);i.trackByAttributes=[...h.values()]})}_waitForModelLoad(e){var t=this;return(0,b.A)(function*(){const n=t.getModelByName(e);!n||n?.isLoaded||n.mode===P.Create||n.mode===P.Copy||(yield(0,l.firstValueFrom)(t._modelLoaded$.pipe((0,d.filter)(i=>i===e),(0,d.take)(1))))})()}_waitForModelsLoad(e){var t=this;return(0,b.A)(function*(){if(e.length===0||t._isDesignTime)return;const n=e.map(i=>t._waitForModelLoad(i));yield Promise.all(n)})()}_waitForModelsLoadParameters(e,t){var n=this;return(0,b.A)(function*(){if(e.length===0||n._isDesignTime||!t||t.mode===P.Create||t.mode===P.Copy)return;const i=e.map(r=>n._waitForModelLoadParameters(r));yield Promise.all(i)})()}_waitForModelLoadParameters(e){var t=this;return(0,b.A)(function*(){t._lastEventLoadParameters.has(e)||t._modelsNamesWithParameters.has(e)||(yield(0,l.firstValueFrom)(t._modelLoadParametersSetted$.pipe((0,d.filter)(()=>t._modelsNamesWithParameters.has(e)),(0,d.take)(1))))})()}_getAffectedAttributes(e,t,n){const r=this.dataSchemas[e].primaryAttributeName,a=[...t];return r&&!t.includes(r)&&n?.length>0&&n?.[0][r]&&a.push(r),a}_getModelLoadParameters(e,t,n,i,r,a){return this._modelParametersBuilder.getModelLoadParameters(this,e,t,n,{payload:i,useLastLoadParameters:r,doNotUpdateLastLoadParameters:a}).catch(c=>(console.error(c),this._showNotification({message:c.message}),[[{type:j.Never}],{},{},{}]))}_getRelationTypeForRootModel(e){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return null;const t=this._modelDependencies[e],n=zn(this.getModelByName(e));if(t?.length!==1||!this._primaryModelName||!n)return null;const i=this.dataSchemas[this._primaryModelName],r=t[0],{dependOnModelName:a,dependOnAttributeName:c}=lu(r.relationPath);return a!==this._primaryModelName?null:gC(this.dataSchemas[e],r.attributePath,i,c)}_isManyToOneRootModelRelation(e){return this._getRelationTypeForRootModel(e)===Hn.ManyToOne}_isOneToManyRootModelRelation(e){return this._getRelationTypeForRootModel(e)===Hn.OneToMany}_getOneToManyRelationDefaultValues(e){const t=this._modelDependencies[e]?.[0];if(!t)return{};const n=this.dataSchemas[this._primaryModelName],i=this.getViewModelAttributePaths(this._primaryModelName,n.primaryAttributeName)?.[0],r=this.getViewModelAttributePaths(this._primaryModelName,n.primaryDisplayAttributeName)?.[0];return{[t.attributePath]:{value:this.attributes[i],displayValue:this.attributes[r]}}}_getDependOnModelLoadConfiguration(e){const t=this._getDependOnModelsNames(e),n={};return t.forEach(i=>{this._modelSourceRecordId[i]&&(n[i]={[this.dataSchemas[i].primaryAttributeName??"Id"]:this._modelSourceRecordId[i]})}),n}_isPrimaryModel(e){return this._primaryModelName===e}_isIndependentRootModel(e){return zn(e)?this._getDependOnModelsNames(e.name).length===0:!1}_checkAndProcessPageDataSourceData(e,t){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return(0,l.of)(t);if(this._isManyToOneRootModelRelation(e.name)&&t.length===0)return this._clearModelValues(e.name),e.setLoadedState(),(0,l.of)(t);const i=this._isOneToManyRootModelRelation(e.name),r=this._isIndependentRootModel(e);if(!(i&&t.length===0||r&&t.length===0&&!this._isPrimaryModel(e.name)))return(0,l.of)(t);e.resetMode();const c=this._getOneToManyRelationDefaultValues(e.name);if(this.PrimaryModelMode===P.Copy){const h=this.dataSchemas[e.name].primaryAttributeName??"Id",p=this._getDependOnModelLoadConfiguration(e.name);return(0,l.from)(this.getDataSourceLoadParameters(e.name,p)).pipe((0,d.switchMap)(({parameters:m,options:f})=>e.load({attributes:[h],parameters:m,options:{loadType:de.Reload,pagingConfig:f.pagingConfig,sortingConfig:f.sortingConfig,hierarchyConfig:f.hierarchyConfig}})),(0,d.switchMap)(m=>{e.resetMode();const f=m?.length?m[0][h]:null;return f?this.copy(e.name,f,c):this.create(e.name,c)}),(0,d.map)(()=>t))}return this.create(e.name,c).pipe((0,d.map)(()=>t))}_isRowsLimitReached(e){var t=this;return(0,b.A)(function*(){const n=e.collectionViewModelAttributeName,i=e.getPagingConfig()?.rowsLimit;return!i||!n?!1:(yield t[n])?.length>=i})()}_setDataSourceLoaded(e,t,n,i){var r=this;return(0,b.A)(function*(){n.length<i?.rowCount||(yield r._isRowsLimitReached(t))?r._loadedDataSources.add(e):r._loadedDataSources.delete(e)})()}_getModelDependedOnEntityDataSource(e){return e.filter(t=>this.models.find(r=>r.name===t).getDataSource().type===ja.EntityDataSource)}_loadModelData({model:e,dataSourceInfo:t,parametersConfig:n,loadType:i,payload:r,useLastLoadParameters:a,doNotUpdateLastLoadParameters:c}){const h=e.name;this._modelsRequestedToLoad.add(h);const p=this._getModelAttributesToLoad(e,r),m=r?.attributes;if(!t)return(0,l.of)([]);if(m&&p.length===0)return(0,l.of)([]);if(this._conflictedModels.includes(h))return(0,l.of)([]);const f=this._getDataSourceMappingAttributes(t,p),C=this._getLoadTypeForDataSource(t,i);if(C===de.LoadNext&&this._loadedDataSources.has(h))return(0,l.of)([]);this._dispatchStartLoadModelAttributes(f);const S=!this._isSyncForModelAllowed(e)||m===null||e.mode===P.Init,w=this._getDependOnModelsNames(h);this._checkAndLoadUnloadedDependOnModels(w);const E=this._getModelDependedOnEntityDataSource(w),H=w.filter(J=>!E.includes(J)),se=Promise.all([this._waitForModelsLoad(H),this._waitForModelsLoadParameters(E,e)]);return(0,l.from)(this._featureValues.DisableSequentialLoadDependentDS?this._waitForModelsLoad(w):se).pipe((0,d.switchMap)(J=>(0,l.from)(this._getModelLoadParameters(t,n,C,r,a,c)).pipe((0,d.tap)(()=>{!this._featureValues.DisableSequentialLoadDependentDS&&!t.isCollection&&(this._modelDependencies[h]?.map(Ot=>Ot.relationPath)||[]).forEach(Ot=>{const{dependOnModelName:re,dependOnAttributeName:mn}=lu(Ot),[_d]=this.getViewModelAttributePaths(re,mn);this.getAttributeControl(_d).markAsPristine()})}),(0,d.tap)(()=>{if(!this._featureValues.DisableSequentialLoadDependentDS){this._setModalLoadParameters(h);const z=this._getAffectedAttributes(h,p,[]);this._reloadDependentModels(e,z,ut.Page)}}))),(0,d.mergeMap)(J=>this._waitDataDelay(J)),(0,d.switchMap)(([J,z,Ss,Ot])=>e.load({attributes:p,parameters:J,options:{loadType:i,pagingConfig:z,sortingConfig:Ss,hierarchyConfig:Ot}}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.model.load.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${h}`),(0,d.catchError)(re=>this._handleLoadErrorResponse(re,[])),(0,d.tap)(()=>this._updateTrackedAttributes(e)),(0,d.tap)(re=>{re.length===0&&this._dispatchFinishLoadModelAttributes(f)}),(0,d.mergeMap)(re=>re.length===0?(0,l.from)(this._processEmptyLoadDataForCollection(t,J)).pipe((0,d.map)(()=>re)):(0,l.of)(re)),(0,d.switchMap)(re=>this._checkAndProcessPageDataSourceData(e,re)),(0,d.map)(re=>({data:re,viewModelAttributes:t.getModelDto(re)})),(0,d.switchMap)(({data:re,viewModelAttributes:mn})=>this.setValue(mn,{collectionLoadType:C===de.Reload?Hi.Reload:Hi.Merge,silent:!0,isMaskedValue:!0}).pipe(jt(()=>!t.isCollection||!mn?(0,l.of)(void 0):(Object.keys(mn).forEach(_d=>{this.attributes[_d]?.forEach(US=>{US.formApiModel.updateValueAndValidity()})}),(0,l.from)(this._setDataSourceLoaded(h,t,re,z)))),(0,d.tap)(()=>this._markAsPristine(mn)),(0,d.map)(()=>re))))),(0,d.tap)(()=>this._modelLoaded$.next(h)),(0,d.switchMap)(J=>this._runBusinessRulesForModel(e,J)),(0,d.tap)(J=>{const z=this._getAffectedAttributes(h,p,J);this._featureValues.DisableSequentialLoadDependentDS&&this._reloadDependentModels(e,z,ut.Page),S||this._reloadDependentModels(e,z,ut.ViewElement)}),(0,d.tap)(J=>{const z=J[0]??{};e.setLoadedState(Object.keys(z)),this._dispatchFinishLoadModelAttributes(f)}),(0,d.takeUntil)(this._destroy$))}_checkAndLoadUnloadedDependOnModels(e){const t=e.filter(n=>{const i=!this._modelsRequestedToLoad.has(n),r=!zn(this.getModelByName(n));return i&&r});this._requestReloadModels(t)}_createChangeAttributeTriggers(e){return e.map(t=>({type:ne.ChangeAttributeValue,name:t,scopeId:""}))}_runBusinessRulesForModel(e,t,n=!1,i=[]){const r=this._dataSourcesInfos.get(e.name);if(r.isCollection||!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,l.of)(t);const a=t[0]??{},c=n?[...r.mappedViewModelAttributes]:Object.keys(a).flatMap(f=>this._getMappedAttributeNames(r,f)).filter(f=>f!=null),h=this._createChangeAttributeTriggers(c),p={type:ne.DataLoaded,name:e.name,scopeId:""},m=this.models.filter(f=>f!==e).filter(f=>f.mode!==P.Init).filter(f=>f.getDataSource().scope===ut.Page).map(f=>this._getModelBusinessRuleContext(f.name,[]));return(0,l.forkJoin)([this._getModelBusinessRuleContext(r.name,[p,...i]),...m,(0,l.of)(this._getViewModelBusinessRuleContext([...h,...i,p]))]).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRulesForModel.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,d.switchMap)(f=>this._runBusinessRulesForContexts(f)),(0,d.map)(()=>t))}_runInitialBusinessRules(){if(!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,l.of)(null);const e={type:ne.ContextReady,name:null,scopeId:""};return this._prepareBusinessRulesContexts([e]).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitialBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,d.mergeMap)(t=>t.length===0?(0,l.of)(null):this._runBusinessRulesForContexts(t)))}_createViewModelAttributesValues(e,t){const n=Object.entries(this.dataSchemas),[,i]=n.find(([a])=>a===e),r={};for(const a of i.attributes){const c=t[a.name],h=this.getViewModelAttributePath(e,a.name);h&&(r[h]=c??null)}return r}_createModelData(e,t){const n=this._dataSourcesInfos.get(e),i=this._getDataSourceMappingAttributes(n);this._dispatchStartLoadModelAttributes(i);const r=this.getModelByName(e),a=r.disableSync,c=this._getModelAttributesToLoad(r,null);return r.disableSync=!0,r.create(t).pipe((0,d.switchMap)(h=>{const p=this._createViewModelAttributesValues(e,h),m=this._isOneToManyRootModelRelation(e)?{silent:!0}:null;return this.setValue(p,m).pipe((0,d.tap)(()=>this._forEachControl(p,f=>{f.markAsPristine(),f.markAsUntouched()})))}),(0,d.tap)(()=>{r.disableSync=a,this._modelLoaded$.next(e),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e)}),(0,d.switchMap)(()=>this._runBusinessRulesForModel(r,[],!0)),(0,d.tap)(()=>{this._isSyncForModelAllowed(r)&&this._reloadDependentModels(r,c)}),(0,d.tap)(()=>{this._dispatchFinishLoadModelAttributes(i),r.setLoadedState()}),(0,d.map)(()=>null))}_copyModelData(e,t,n){const i=this._dataSourcesInfos.get(e),r=this._getDataSourceMappingAttributes(i);this._dispatchStartLoadModelAttributes(r);let a;const c=this.getModelByName(e),h=this._getModelAttributesToLoad(c,null),p=c.disableSync;return c.disableSync=!0,this._modelSourceRecordId[e]=t,c.copy(t,n).pipe((0,d.catchError)(m=>this._handleLoadErrorResponse(m,{})),(0,d.map)(m=>({data:[m],viewModelAttributes:i.getModelDto([m])})),(0,d.switchMap)(({data:m,viewModelAttributes:f})=>this.setValue(f).pipe((0,d.tap)(()=>this._markAsPristine(f)),(0,d.map)(()=>m))),(0,d.tap)(()=>{c.disableSync=p,this._modelLoaded$.next(e)}),(0,d.switchMap)(m=>this._runBusinessRulesForModel(c,m,!0)),(0,d.tap)(()=>{this._isSyncForModelAllowed(c)&&(this._reloadDependentModels(c,h),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e))}),(0,d.tap)(()=>{this._dispatchFinishLoadModelAttributes(r),c.setLoadedState()}),(0,d.mergeMap)(()=>(0,l.of)(a)))}_getDataSourceMappingAttributes(e,t=null){const n=t??e?.attributes.map(r=>r.path);if(!n)return{};const i=Object.fromEntries(n.map(r=>[this._getMappedAttributeName(e,r),!0]));return e.collectionViewModelAttributeName&&(i[e.collectionViewModelAttributeName]=!0),i}_handleLoadErrorResponse(e,t){if(e instanceof ra)return(0,l.of)(t);const n=1e4;return console.error(e),this._showNotification({message:e.message,duration:n}),(0,l.of)(t)}_canExecuteBusinessRulesByModelAttributeValue(e,t,n){return t&&e?this._isModelAttributeValueValid(e,t,n):!0}_canExecuteBusinessRulesByViewModelAttributeValue(e,t){const n=this._getDataSourceInfoByViewModelAttributePath(e);if(n){const i=n.getDataSourceAttributePath(e);return this._canExecuteBusinessRulesByModelAttributeValue(n,i,t)}return!0}_getContextAttributeValue(e){return e instanceof Date?Bd(e):e}_getNormalizedContextAttributeValue(e,t,n){const i=e;return _[t]===_.Lookup||i?.displayValue?i?.value??e:n===!0||!t?e:[_.RICH_TEXT,_.Image].includes(_[t])?null:_[t]===_.MAXSIZE_TEXT&&e?e.slice(0,500):e}_getHasValueContextAttributeValue(e,t){return!!(t&&_[t]===_.Boolean||e!=null&&e!=="")}_getViewModelAttributeInfos(e,t,n){return Object.keys(t).filter(i=>!(t[i]instanceof We)).map(i=>{if(t[i]instanceof ht)return this._getViewModelAttributeInfos(e?`${e}.${i}`:i,t[i]?.attributes??{},n);const r=this._attributeConfigs[i]?.dataValueTypeName,a=this._getContextAttributeValue(t[i]),c=this._getNormalizedContextAttributeValue(a,r,n);return{name:e?`${e}.${i}`:i,value:c??null,displayValue:t[i]?.displayValue,dataValueTypeName:r,hasValue:this._getHasValueContextAttributeValue(a,r)}}).flat()}_runBusinessRulesForContexts(e){const t=`${Xt.RunningBusinessRules}-${L()}`;return this._onAsyncTaskStarted(t),(0,l.of)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,d.map)(n=>n?.filter(i=>!(0,v.isNil)(i))??[]),(0,d.mergeMap)(n=>{if(n.length===0)return(0,l.of)(null);const i=n.map(r=>({scopeName:r.scopeName,scopeId:r.scopeId,scopeType:r.scopeType,triggers:r.triggers}));return this._toggleControlsAffectedByBusinessRules(!1,i),this._businessRulesEngine.execute(n).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.execute.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,d.tap)(r=>{r.forEach(a=>{const c=i.find(h=>h.scopeId===a.scopeId&&h.scopeName===a.scopeName&&h.scopeType===a.scopeType);a.triggers=c?.triggers??[]})}),(0,d.switchMap)(r=>r?this._businessRulesApplier.applyRules(this,r):(0,l.of)(null)),(0,d.tap)(()=>{this._toggleControlsAffectedByBusinessRules(!0,i)}))}),(0,d.tap)(()=>this._onAsyncTaskFinished(t)))}_createViewModelContext(e,t){return{scopeType:xt.ViewModel,scopeName:this._scopeName,scopeId:this._scopeName,scopeState:Kt.Unknown,parentScopeId:null,attributes:t,triggers:e}}_getViewModelBusinessRuleContext(e){const t=this._featureValues["BRules-EnableCompareLargeAttributeValues"],n=this._getViewModelAttributeInfos(null,this.attributes,t);return this._createViewModelContext(e,[...n].map(i=>({attributeName:i.name,value:i.value,displayValue:i.displayValue,dataValueTypeName:i.dataValueTypeName,hasValue:i.hasValue})))}_prepareModelBusinessRuleTrigger(e,t){return t.map(n=>{if(n.type===ne.DataLoaded||n.type===ne.ContextReady)return n;const i=this._getDataSourceInfoByViewModelAttributePath(n.name);return!i||i.name!==e?null:{type:ne.ChangeAttributeValue,name:i.getDataSourceAttributePath(n.name),scopeId:""}}).filter(n=>n!=null)}_getModelContextScopeStateType(e){switch(e.mode){case P.Init:return Kt.Init;case P.Create:return Kt.Create;case P.Copy:return Kt.Copy;case P.Update:return Kt.Update;default:return Kt.Unknown}}_getModelBusinessRuleContext(e,t){const n=this._dataSourcesInfos.get(e),i=this.getModelByName(e),r=this.dataSchemas[e],a=this._prepareModelBusinessRuleTrigger(e,t),c=this._getModelContextScopeStateType(i);return this._getDataSourceDto(e).pipe((0,d.map)(h=>({...i._getPersistedState(),...h})),(0,d.map)(h=>({enableCompareLargeAttributeValues:this._featureValues["BRules-EnableCompareLargeAttributeValues"],modelDto:h})),(0,d.map)(({enableCompareLargeAttributeValues:h,modelDto:p})=>Object.entries(p).map(([m,f])=>{let C;const S=this._getMappedAttributeName(n,m);if(S)C=this._attributeConfigs[S]?.dataValueTypeName;else{const H=r.findAttributeByName(m);C=_[H.dataValueType]}const w=this._getContextAttributeValue(f),E=this._getNormalizedContextAttributeValue(w,C,h);return{attributeName:m,value:E,displayValue:f?.displayValue,dataValueTypeName:C,hasValue:this._getHasValueContextAttributeValue(w,C),isSignificant:m===r.primaryAttributeName}})),(0,d.map)(h=>({scopeType:xt.Model,scopeName:i.dataSchemaName,scopeId:e,scopeState:c,parentScopeId:this._scopeName,attributes:h,triggers:a,modelType:i.getDataSource()?.type})))}_prepareDataSourceNamesForBusinessRules(){return this._modelsMap.size===0?[]:[...this._modelsMap.values()].filter(e=>!this._dataSourcesInfos.get(e.name).isCollection).map(e=>e.name)}_getModelsBusinessRuleContexts(e){return this._prepareDataSourceNamesForBusinessRules().map(n=>n?this._getModelBusinessRuleContext(n,e):(0,l.of)(null))}_prepareBusinessRulesContexts(e){const t=this._getModelsBusinessRuleContexts(e);if(!this._scopeName)return t.length===0?(0,l.of)([]):(0,l.forkJoin)([...t]);const i=[(0,l.of)(this._getViewModelBusinessRuleContext(e)),...t];return i.length===0?(0,l.of)([]):(0,l.forkJoin)(i)}_isAttributeChange(e){return!e.attributeName?.includes(":")}_businessRulesSubscribeOnChangeAttributes(){if(!this._businessRulesProcessingEnabled||this._isDesignTime)return;const e=this.events$.pipe((0,d.filter)(()=>this._businessRulesActive),(0,d.filter)(n=>n.type===ue.ChangeAttributeValue),(0,d.filter)(n=>this._isAttributeChange(n.payload)),(0,d.filter)(n=>!n.payload.silent),(0,d.filter)(n=>!n.payload?.preventRunBusinessRules),(0,d.filter)(n=>{const i=n.payload;return this._canExecuteBusinessRulesByViewModelAttributeValue(i.attributeName,i.value)}),(0,d.filter)(n=>{const i=n.payload,r=this._getAttributeDataValueTypeName(i.attributeName);return r&&Ll(r)===_.Lookup?i.value?.value!==i.oldValue?.value:!0}),(0,d.map)(n=>n.payload.attributeName)),t=e.pipe((0,d.tap)(()=>this._onAsyncTaskStarted(Xt.DebouncingBusinessRules)),(0,d.buffer)(e.pipe((0,d.debounceTime)(fC))),(0,d.map)(n=>Array.from(new Set(n))),(0,d.map)(n=>this._createChangeAttributeTriggers(n)),(0,d.mergeMap)(n=>this._prepareBusinessRulesContexts(n)),(0,d.tap)(()=>this._onAsyncTaskFinished(Xt.DebouncingBusinessRules)),(0,d.filter)(n=>n.length>0),(0,d.mergeMap)(n=>this._runBusinessRulesForContexts(n)));this._subscriptions.add(t.subscribe())}_subscribeOnChangeAttributes(){const e=this.events$.pipe((0,d.filter)(t=>t.type===ue.ChangeAttributeValue),(0,d.map)(t=>t),(0,d.map)(t=>{const n=this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),i=this._dataSourcesInfos.get(n)?.attributesMap.get(t.payload.attributeName),r=this.getBoundDataSchemaAttributeByAttributePath(t.payload.attributeName);return{changeEvent:t,model:this.getModelByName(n),modelAttributeInfo:{name:r?.name??i,isLookup:!!r?.isLookup}}}),(0,d.filter)(({model:t,modelAttributeInfo:n})=>!!(t&&n.name)),(0,d.tap)(({changeEvent:t,model:n,modelAttributeInfo:i})=>{const r=t.payload,a=i.isLookup,c=a?r.oldValue?.value:r.oldValue,h=a?r.value?.value:r.value;c!==h&&n?.attributeChanged(i.name,r?.preventStateChange??r?.silent)}));this._subscriptions.add(e.subscribe())}_getHasRelation(e=[],t,n){return e.map(r=>{const a=r.trackByAttributes??[],{dependOnModelName:c,dependOnAttributeName:h}=lu(r.relationPath);return a.push(h),{rootModelName:c,trackedAttributes:h}}).filter(({rootModelName:r})=>r===t).filter(({trackedAttributes:r})=>this._dataSourcesInfos.get(t).isCollection?!0:n.some(a=>r.includes(a))).length!==0}_getDependentModelsNames(e,t=[]){return e?Object.entries(this._modelDependencies).filter(([n])=>n!==e).filter(([,n])=>this._getHasRelation(n,e,t)).map(([n])=>n).map(n=>[n,...this._getDependentModelsNames(n)]).flat():[]}_getIsModelDataChanged(e){if(!this.getModelByName(e)?.isLoaded)return!1;const n=this._dataSourcesInfos.get(e);if(n.isCollection){const r=n.collectionViewModelAttributeName,a=this.attributes[r];return a?a.isChanged:!1}return n.getMappedAttributes().some(r=>this.getIsDirty(r))}_requestReloadModels(e){this._createRequestsForReloadingDataSources(e).forEach(n=>{this._ngZone.runOutsideAngular(()=>this.processRequest(n))})}_isModelAttributeValueValid(e,t,n){return this._getDataSourceAttributeSchema(e,t)?.dataValueType===_.Lookup?hy(n):!0}_canReloadModelDependentData(e,t){return e.canReloadDependentData(t)?!0:this._conflictedModels.includes(e.name)?!1:this._getDependentModelsNames(e.name,[t]).length>0}_getModelDependentAttributes(e,t){return[...t,...t.map(n=>e.getDependentAttributesNames(n)).flat()]}_getChangedModelsNames(e){return e.filter(t=>this._getIsModelDataChanged(t))}_showNotification(e){this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.NotificationRequest",$context:this,...e}))}_isSyncForModelAllowed(e){return e.allowSync}_subscribeOnReloadDataEvents(){if(this._isDesignTime)return;const e=this.events$.pipe((0,d.filter)(()=>this._modelSynchronizationEnabled),(0,d.filter)(t=>t.type===ue.ChangeAttributeValue),(0,d.filter)(t=>t.payload.silent!==!0),(0,d.map)(t=>({modelName:this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),attributeName:t.payload.attributeName,attributeValue:t.payload.value})),(0,d.filter)(({modelName:t})=>t!=null),(0,d.map)(({modelName:t,attributeName:n,attributeValue:i})=>{const r=this._dataSourcesInfos.get(t),a=r?.attributesMap.get(n);return{model:this.getModelByName(t),dataSourceInfo:r,modelAttribute:a,attributeValue:i}})).pipe((0,d.filter)(({model:t})=>t!=null),(0,d.filter)(({dataSourceInfo:t})=>!t.isCollection),(0,d.filter)(({model:t})=>this._isSyncForModelAllowed(t)),(0,d.filter)(({dataSourceInfo:t,modelAttribute:n,attributeValue:i})=>this._isModelAttributeValueValid(t,n,i)),(0,d.filter)(({model:t,modelAttribute:n})=>this._canReloadModelDependentData(t,n))).pipe((0,d.tap)(({model:t,dataSourceInfo:n,modelAttribute:i,attributeValue:r})=>{const a=this._getModelDependentAttributes(t,[i]),c=Object.fromEntries(a.map(h=>[this._getMappedAttributeName(n,h),!0]));this._dispatchStartLoadModelAttributes(c),t.reloadDependentData(i,r).pipe((0,d.switchMap)(h=>{if(h.length===0)return(0,l.of)(h);const p=n.getModelDto(h);return this.setValue(p,{silent:!0,isMaskedValue:!0}).pipe((0,d.switchMap)(()=>this._runBusinessRulesForModel(t,h)))}),(0,d.tap)(()=>this._reloadDependentModels(t,[i])),(0,d.tap)(()=>this._dispatchFinishLoadModelAttributes(c))).subscribe()}));this._subscriptions.add(e.subscribe())}_subscribeOnChangeRequests(){const e=this.events$.pipe((0,d.filter)(t=>t.type===ue.ChangeAttributeValue),(0,d.mergeMap)(t=>{const n=t.payload.attributeName,i=this._attributeConfigs[n];return Array.isArray(i?.change)?i.change:[i?.change]}),(0,d.filter)(t=>t!=null),(0,d.map)(t=>({type:t.request,$context:this,scopes:this._scopeName?[this._scopeName]:[],...t.params})),(0,d.tap)(t=>this._ngZone.runOutsideAngular(()=>this.handlerChain.process(t))));this._subscriptions.add(e.subscribe())}_subscribeOnFilteringEvents(){const e=new Set;this._subscriptions.add(this._modelLoaded$.pipe((0,d.tap)(n=>{e.add(n)})).subscribe());const t=this.events$.pipe((0,d.filter)(n=>n.type===ue.ChangeAttributeValue),(0,d.map)(n=>{const i=n.payload.attributeName;return this._getDataSourceNamesAffectedByFilteringAttribute(i,e)}),(0,d.map)(n=>this._createRequestsForReloadingDataSources(n)),(0,d.tap)(n=>{n.forEach(i=>{this._ngZone.runOutsideAngular(()=>this.processRequest(i))})}));this._subscriptions.add(t.subscribe())}_saveModel(e,t,n){const i=this.getModelByName(e),r=i.mode,a=this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(c,h)=>i.insertOrUpdate(c,h),onSavedAction:(c,h)=>this._updateLastLoadParameters(e,r,c,h),getInvalidAction:c=>(0,l.of)(c)});return this.handleSaveModelStream(a,n)}_initSubscriptions(){return this._measurePerformanceService.measure(`ViewModel.initSubscriptions.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._subscribeOnFilteringEvents(),this._subscribeModelsEvents(),this._subscribeOnChangeAttributes(),this._subscribeOnChangeRequests(),this._subscribeOnReloadDataEvents(),this._businessRulesSubscribeOnChangeAttributes(),this._subscribeOnChangeAttributesToHandleModelDependenciesConstrains(),this._subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(),(0,l.of)(null)))}_subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(){if(this._featureValues.DisableMultipleDataSources)return;const e=this.events$.pipe((0,d.filter)(t=>this._primaryModelName!=null),(0,d.filter)(t=>t.type===ue.ChangeAttributeValue),(0,d.map)(t=>t),(0,d.map)(({payload:t})=>{const n=t.attributeName,i=t.value;return{modelName:this.getBoundDataSourceNameByAttributePath(n),attributeName:n,attributeValue:i}}),(0,d.filter)(({modelName:t})=>this._isPrimaryModel(t)),(0,d.filter)(({attributeName:t})=>{const n=this.getBoundDataSchemaByAttributePath(t),i=this.getBoundDataSchemaAttributeByAttributePath(t);return!n||!i?!1:n.primaryDisplayAttributeName===i.name}),(0,d.map)(({modelName:t,attributeValue:n})=>{const i=this.dataSchemas[this._primaryModelName],a=this._getDependentModelsNames(t,[i.primaryAttributeName]).filter(c=>this._isOneToManyRootModelRelation(c));return{primaryDisplayValue:n,dependentModelsNames:a}}),(0,d.filter)(({dependentModelsNames:t})=>t.length>0),(0,d.tap)(({dependentModelsNames:t,primaryDisplayValue:n})=>{const i=this.dataSchemas[this._primaryModelName],r=this.getViewModelAttributePaths(this._primaryModelName,i.primaryAttributeName)[0],a=this.attributes[r],c={};t.map(h=>{const m=this._modelDependencies[h][0].attributePath;return this.getViewModelAttributePaths(h,m)}).flat().forEach(h=>{c[h]={value:a,displayValue:n}}),this.setValue(c,{silent:!0,preventAttributeChangeRequest:!0,preventRunBusinessRules:!1,preventStateChange:!0})}));this._subscriptions.add(e.subscribe())}_getDataSchemas(){if(this.models&&this.models.length!==0){const e=this.models.map(t=>t.getSchema().pipe((0,d.map)(n=>[t.name,n])));return(0,l.combineLatest)(e).pipe((0,d.take)(1),(0,d.map)(t=>Object.fromEntries(t)))}return(0,l.of)({})}_setAttributesDefaultValues(e){var t=this;return(0,l.from)((0,b.A)(function*(){let n=Object.entries(t.dataSchemas);e&&(n=n.filter(([i])=>i===e));for(const[i,r]of n){const a={};for(const c of r.attributes){const h=yield(0,l.lastValueFrom)(c.defaultValue,{defaultValue:null});if(!(0,v.isNil)(h)){const p=t.getViewModelAttributePath(i,c.name);p&&(a[p]=h)}}t.setValue(a).subscribe()}})())}_generateDataSourcesInfo(){return this._dataSourcesInfos=Et.getFromViewModelConfig(this.viewModelConfig,this.models),(0,l.of)(this._dataSourcesInfos)}_generateAttributesToDataSourceNameMap(e){const t=Array.from(e.values()).map(n=>this._getDataSourceAttributesMap(n)).flat();return this._initializeAttributesToDataSourceNameMap(t),(0,l.of)(this._attributesToDataSourceNameMap)}_initializeAttributesToDataSourceNameMap(e){this._attributesToDataSourceNameMap=new Map(e)}_getDataSourceAttributesMap(e){const n=e.getMappedAttributes().map(i=>[i,e.name]);return e.isCollection&&n.push([e.collectionViewModelAttributeName,e.name]),n}_getDataSourceLoadType(e){return e?e||de.Reload:null}_getLoadTypeForDataSource(e,t){if(t===de.Load)return t;const n=e.getPagingConfig();return!t&&n?de.LoadNext:t}_loadDefaultSorting(e){this._measurePerformanceService.measure(`ViewModel._loadDefaultSorting.${this._injectionContext?.id}.parent.${!!this.parent}.dsNames.${e?.toString()}`,()=>{const t=Array.from(this._dataSourcesInfos.entries()).filter(([n])=>!e?.length||e.includes(n)).map(([,n])=>n.getSortingConfig()).filter(n=>!!n?.default).reduce((n,i)=>(n[i.attributeName]=i.default,n),{});this.setValue(t,{silent:!0}).subscribe()})}_getDropdownPageSize(){var e=this;return(0,b.A)(function*(){if(!(0,v.isEmpty)(e._dropdownPageSize))return e._dropdownPageSize;const t=yield e.sysSettingsService.getByCode(e._dropdownPageSizeSettingsCode);return e._dropdownPageSize={pagingConfig:{rowCount:t?.value,rowsOffset:0}},e._dropdownPageSize})()}_mergeCollectionModels(e,t){this._measurePerformanceService.measure(`ViewModel.mergeCollectionModels.${this._injectionContext?.id}.parent.${!!this.parent}.collection.${e}`,()=>{const n=this.attributes[e];this._featureValues.DisableBaseViewModelCollectionOptimization||n.length?n.merge(t):n.push(...t)})}_getEmbeddedModels(){const e=Object.entries(this.viewModelConfig?.attributes??{}).filter(([,i])=>i&&"embeddedModel"in i&&i.embeddedModel).map(([i,r])=>({attributeName:i,embeddedModel:r.embeddedModel}));if(e.length===0)return(0,l.of)([]);const t={},n=[];if(e.forEach(({attributeName:i,embeddedModel:{name:r,config:a}})=>{r?t[r]&&n.push(`Duplicated embedded model : ${r}.`):n.push(`Embedded model name is not provided for ${i}.`),t[r]=a}),n.length>0)throw new Error(n.join(" "));return this._modelGenerator.generate({dataSources:t},this.injector)}_concatModelsWithEmbedded(e=null){return this._getEmbeddedModels().pipe((0,d.map)(t=>{const n=[...e??[],...t??[]],i=n.map(r=>r.name).filter((r,a,c)=>c.indexOf(r)!==a);if(i.length>0)throw new Error(`Duplicated model names found : ${i.join(",")}.`);return n}))}_updateModelsMap(){const e=this.models.map(t=>[t.name,t]);this._modelsMap=new Map(e)}_subscribeModelsChanges(){this._subscriptions.add(this._models$.subscribe(()=>this._updateModelsMap()))}_subscribeModelsEvents(){this._isDesignTime||this.models.forEach(e=>this._subscribeModelEvents(e))}_subscribeModelEvents(e){this._subscriptions.add(e.event$.pipe((0,d.mergeMap)(t=>this._waitDataDelay(t)),(0,d.mergeMap)(t=>this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.HandleModelEventRequest",$context:this,scopes:this._eventScopes,modelName:e.name,modelEvent:t})),1)).subscribe())}_upsertModel(e,t){const n=[...this.models],i=n.findIndex(({name:r})=>r===e);i===-1?n.push(t):n.splice(i,1,t).forEach(r=>r.destroy()),this._subscribeModelEvents(t),this._models$.next(n)}_replaceDataSourceInfo(e,t){!e||!t||(this._loadedDataSources.has(e)&&this._loadedDataSources.delete(e),this._dataSourcesInfos.set(e,t),this._replaceAttributesToDataSourceNameMap(t))}_updateModels(e){e.forEach((t,n)=>{const i=this.getModelByName(n);i&&(this._markModelAsCollection(i,t),this._updateModelDependentAttributes(i,t))})}_markModelAsCollection(e,t){t.isCollection&&(e._isCollection=!0)}_setModalLoadParameters(e){this._modelsNamesWithParameters.add(e),this._modelLoadParametersSetted$.next()}_updateModelDependentAttributes(e,t){const n=t.attributes.map(i=>({path:i.path,type:i.type}));e.updateDependentAttributes(n)}_initIsChangedAttribute(){this._systemAttributes.push(Or),this.attributes[Or]=!1;const e=this._models$.pipe((0,d.switchMap)(t=>t?.length?(0,l.combineLatest)(t.map(n=>n._dirty$)):(0,l.of)([])),(0,d.map)(t=>t.some(n=>n)),(0,d.filter)(()=>!this._viewModelAttributeChangeEventOptions.getOptions().preventStateChange),(0,d.distinctUntilChanged)()).subscribe(t=>{this._setSystemAttributeValue(Or,t)});this._subscriptions.add(e)}_initHasUnsavedDataAttribute(){this._systemAttributes.push(Fa),this.attributes[Fa]=!1;const e=this.events$.pipe((0,d.filter)(a=>a?.type===ue.ChangeAttributeValue&&a.payload?.attributeName===Or),(0,d.map)(a=>a.payload.value)),t=(0,l.merge)(this.IsChanged,e),i=this._models$.pipe((0,d.map)(a=>a.map(c=>c._modeChanges$.pipe((0,d.map)(h=>({mode:h,name:c.name})),(0,d.startWith)({mode:c.mode,name:c.name})))),(0,d.switchMap)(a=>a?.length?(0,l.combineLatest)(a):(0,l.of)([]))).pipe((0,d.map)(a=>a.some(({mode:c,name:h})=>{const p=!this._isDesignTime&&!this._featureValues.DisableMultipleDataSources&&!this._isPrimaryModel(h)&&this._isIndependentRootModel(this.getModelByName(h)),m=this._isOneToManyRootModelRelation(h);return(c===P.Create||c===P.Copy)&&!m&&!p}))),r=(0,l.combineLatest)([t,i]).pipe((0,d.map)(([a,c])=>!!(a||c)),(0,d.distinctUntilChanged)()).subscribe(a=>{this._setSystemAttributeValue(Fa,a)});this._subscriptions.add(r)}_initPrimaryModelModeAttribute(){const e=this._getPrimaryModelModeChanges();if(!e)return;this._systemAttributes.push(Hl),this.attributes[Hl]=this.getPrimaryModelMode();const t=e.pipe((0,d.startWith)(this.getPrimaryModelMode())).subscribe(n=>this._setSystemAttributeValue(Hl,n));this._subscriptions.add(t)}_initStateAttribute(){this._systemAttributes.push(za),this.attributes[za]=Zl.Active}_initBusinessRulesActivatedAttribute(){if(this._systemAttributes.push(Wl),this.attributes[Wl]=this._businessRulesAreActivated,this._businessRulesAreActivated)return;const e=this._businessRulesActivated$.pipe((0,d.filter)(t=>t===!0)).subscribe(t=>{this._setSystemAttributeValue(Wl,t)});this._subscriptions.add(e)}_initSystemAttributes(){var e=this;return(0,b.A)(function*(){yield e._measurePerformanceService.measureCallback(`ViewModel.initSystemAttributes.${e._injectionContext?.id}.parent.${!!e.parent}`,()=>(e._initIsChangedAttribute(),e._initPrimaryModelModeAttribute(),e._initHasUnsavedDataAttribute(),e._featureValues.DisableDelayingModelEvents||e._initStateAttribute(),e._initBusinessRulesActivatedAttribute(),Promise.resolve()))})()}_handleCircularDependencies(){const e=py(this._modelDependencies);if(e.hasCycles){const t=this._translateService.instant("BaseViewModel.WarningModelsWithCircularDependencies");this._showNotification({message:t,duration:1e4}),console.warn(t,e.cycledModelsNames)}this._conflictedModels=e?.cycledModelsNames}_forEachControl(e,t){Object.keys(e).forEach(i=>{if(this.attributes[i]instanceof We){const r=this.attributes[i],a=e[i];r.forEach(c=>{const h=c.primaryAttributeName,p=c.attributes[h],m=a.find(f=>f[h]===p);m&&c._forEachControl(m,t)})}else if(this.attributes[i]instanceof ht)this.attributes[i]._forEachControl(e[i],t);else{const r=this.getControl(i);t(r.formControl)}})}_getModelsErrors(e){return(e??[]).filter(t=>!t.isCollectionItemModel&&t.hasErrors).map(t=>t.getLastError())}_notifyAboutModelsErrors(e){const t=this._getModelsErrors(e);if(t.length>0){const n=t.map(i=>i.message).join(" ");this._showNotification({message:n})}}_initFeaturesStates(){this._disableViewModelWaitingForAsyncTasks=this._featureValues.DisableViewModelWaitingForAsyncTasks,this._disableViewModelLoadUnblockingThread=this._featureValues.DisableViewModelLoadUnblockingThread,this._blockFieldsAffectedByBusinessRules=this._featureValues.BlockFieldsWhileRunBusinessRules,this._modelSynchronizationEnabled=!this._featureValues.ModelSynchronizationDisabled}_handleAsyncTasksCycle(e){let t=null;const n=100,i=Array.from(e).filter(r=>r.startsWith(Xt.ProcessingAttributeChangeRequest));if(!(!e.size||!i.length))return i.length&&(t=setTimeout(()=>{console.warn("[ViewModel]: Clearing executing tasks by exceeded timeout",i),i.forEach(r=>e.delete(r)),this._asyncTasksExecutingSubject.next(e)},n)),t}_getAffectedViewModelAttributes(e,t){return this.models.filter(i=>i.dataSchemaName===e).map(i=>i.name).flatMap(i=>this.getViewModelAttributePaths(i,t))}_toggleControlsAffectedByBusinessRules(e,t){if(!this._blockFieldsAffectedByBusinessRules)return;this._attributesAffectedByBusinessRules?.filter(i=>W_(this._scopeName,i,t))?.forEach(i=>{i.scopeName===this._scopeName?this.getControl(i.name).toggle(e):this._getAffectedViewModelAttributes(i.scopeName,i.name).forEach(a=>{this.getControl(a).toggle(e)})})}_initAttributesAffectedByBusinessRules(){var e=this;return(0,b.A)(function*(){const n=e._prepareDataSourceNamesForBusinessRules().filter(r=>!!r).map(r=>e.getModelByName(r)).map(r=>({scopeId:r.name,scopeName:r.dataSchemaName,scopeType:xt.Model,modelType:r.getDataSource()?.type})),i={scopeName:e._scopeName,scopeType:xt.ViewModel,scopeId:e._scopeName};e._attributesAffectedByBusinessRules=yield e._businessRulesEngine.getAffectedAttributes([i,...n])})()}_initBusinessRules(){var e=this;return this._measurePerformanceService.measureCallback(`ViewModel.initBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`,(0,b.A)(function*(){e._businessRulesProcessingEnabled=!e._featureValues.BusinessRulesProcessingDisabled&&e.viewModelConfig.supportBusinessRules!==!1,e._businessRulesProcessingEnabled&&(yield e._initAttributesAffectedByBusinessRules()),e._businessRulesAreActivated=e._businessRulesProcessingEnabled&&e._businessRulesActive!==!1,e._businessRulesActivated$.next(e._businessRulesAreActivated)}))}_attributeGenerate$(e,t){return(0,l.of)(this._featureValues.UseDesignerHotSwapViewModel).pipe((0,d.switchMap)(n=>n&&this._isDesignTime?this._initDataSourceValidators().pipe((0,d.tap)(()=>{this._initSchemaValidators(e)}),(0,d.switchMap)(()=>this._attributeGenerate(e,t))):this._attributeGenerate(e,t)))}_validateByDataSourceName(e){var t=this;return(0,b.A)(function*(){const n={},i=t._getBoundDataSourceAttributeControls(e);return yield Promise.all(Object.entries(i).map(([r,a])=>(a.markAsTouched(),a.updateValueAndValidity(),(0,l.lastValueFrom)(Op(a).pipe((0,d.tap)(()=>{a.errors&&(n[r]=a.errors)})))))),n})()}_validateAll(){var e=this;return(0,b.A)(function*(){const t={};return e.formApiModel.markAllAsTouched(),e.formApiModel.updateValueAndValidity(),Dp(e.formApiModel),yield(0,l.lastValueFrom)(Op(e.formApiModel).pipe((0,d.tap)(()=>{Object.entries(e.formApiModel.controls).forEach(([i,r])=>{r.errors&&(t[i]=r.errors)})}))),t})()}_getDependentModelsNamesOnRelationAttributeName(e){const t=this.getBoundDataSourceNameByAttributePath(e),i=this._dataSourcesInfos.get(t)?.attributesMap.get(e);return this._getDependentModelsNames(t,[i])}_setAttributeValue(e,t,n){this._executeWithOptions(()=>this[e]=t,n)}_subscribeOnChangeAttributesToHandleModelDependenciesConstrains(){if(this._isDesignTime)return;const e=this.events$.pipe((0,d.filter)(t=>t.type===ue.ChangeAttributeValue),(0,d.filter)(t=>this._isAttributeChange(t.payload)),(0,d.tap)(t=>{const n=t;!n?.payload?.value&&n.payload?.attributeName&&this._clearValuesForManyToOne(n.payload.attributeName)}));this._subscriptions.add(e.subscribe())}_clearValuesForManyToOne(e){this._getDependentModelsNamesOnRelationAttributeName(e).forEach(n=>{this._isManyToOneRootModelRelation(n)&&this._clearModelValues(n)})}_clearModelValues(e){const t=this._dataSourcesInfos.get(e),n=t?.isCollection?[]:t.getMappedAttributes();if(n.length){const i=n.reduce((r,a)=>({...r,[a]:null}),{});this.setValue(i).subscribe(()=>{this._markAsPristine(i),this._markAsUntouched(i)})}}_markAsUntouched(e){this._forEachControl(e,t=>{t.markAsUntouched()})}_setSingleSubmodelValue(e,t,n){return this.attributes[e].setValue(t[e],{silent:n?.silent,isMaskedValue:n?.isMaskedValue,preventAttributeChangeRequest:n?.preventAttributeChangeRequest,preventStateChange:n?.preventStateChange,preventRunBusinessRules:n?.preventRunBusinessRules})}_setCollectionSubmodelValue(e,t,n){const i=this._attributeConfigs[e],r=i.viewModelConfig||i.viewModelName,a=!this._featureValues.DisableDataGridEditingMode,c=(t[e]||[]).map(h=>{const p=this.getBoundDataSourceName(e),f=this._getDataSourceInfoByViewModelAttributePath(e)?.isCollection&&this.getModelByName(p)?.createCollectionItemModel(P.Update);return this.viewModelGenerator.generate({viewModelConfig:r,modelConfig:a&&f?{primaryDataSourceName:f.name}:void 0,models:a&&f?[f]:void 0,parentViewModel:this,businessRulesActive:!1},s.Injector.create({providers:[{provide:ga,useValue:null}],parent:this.injector})).pipe(this._measurePerformanceService.measure$(`ViewModel.setValue.generateViewModel.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${f?.name}`),(0,d.tap)(C=>{p&&(C.dataSchemas[p]=this.dataSchemas[p])}),(0,d.tap)(C=>{C.deactivateBusinessRules()}),(0,d.switchMap)(C=>C.setValue(h,{silent:n?.silent,isMaskedValue:n?.isMaskedValue,preventAttributeChangeRequest:n?.preventAttributeChangeRequest,preventStateChange:n?.preventStateChange,preventRunBusinessRules:n?.preventRunBusinessRules}).pipe((0,d.tap)(()=>f&&f.setLoadedState()),(0,d.map)(()=>C))))});return!c.length&&n?.collectionLoadType===Hi.Reload&&this.attributes[e].clear(),c.length===0?(0,l.of)(null):(0,l.forkJoin)([...c]).pipe((0,d.tap)(h=>{const p=this.getBoundDataSourceName(e);this.getModelByName(p)?.childrenChange(),this._executeWithOptions(()=>{n?.collectionLoadType===Hi.Reload||!n?.collectionLoadType?this.attributes[e].reload(h):this.getBoundDataSchema(e)?this._mergeCollectionModels(e,h):this.attributes[e].push(...h)},n)}))}_setSubmodelValues(e,t,n){return(0,l.forkJoin)([...e.filter(i=>t?.[i]).map(i=>this.attributes[i]instanceof ht?this._setSingleSubmodelValue(i,t,n):this._setCollectionSubmodelValue(i,t,n)),(0,l.of)(this)])}_findAttributePathInDataSourceNameMap(e){for(const t of this._attributesToDataSourceNameMap.keys()){const n=t.indexOf(".");if(n<0)continue;const i=n+1,r=e.length;if(t.startsWith(e,i)&&(t.length===i+r||t.charAt(i+r)==="."))return t}}_getBoundDataSourceAttributeControls(e){return Object.fromEntries(Array.from(this._attributesToDataSourceNameMap.entries()).filter(([t,n])=>n===e).map(([t])=>[t,this.getAttributeControl(t)]))}_resetMaskDataForAttribute(e){this[dp](e)&&(this.setAttributePropertyValue(e,La,null),this.setAttributePropertyValue(e,Ul,null),this.setAttributePropertyValue(e,$l,null))}_staticLoader(e){const t=e[0],n=e[1],i=e[2];this._checkDataSourceName(t);const r=this._getDataSourceLoadType(i?.loadType);return this._loadStaticModel(t,n,r,i?.payload,i?.useLastLoadParameters,i?.doNotUpdateLastLoadParameters).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${t}`))}_dynamicLoader(e){const t=e[0];return this._loadDynamicModel(t).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.model.${t.dataSourceName}`))}showLoadMaskAndValidateFields(e){this.maskService.showMask(this.saveModelTaskName,this);const t=this._getBoundDataSourceAttributeControls(e);Object.keys(t).forEach(n=>this.formApiModel.controls[n].updateValueAndValidity())}deleteModel(e,t,n,i){return(0,l.from)(this._modelParametersBuilder.getModelParameters(this,t,i?.payload)).pipe((0,d.switchMap)(r=>n(e,r)))}handleSaveModelStream(e,t){return e.pipe((0,d.finalize)(()=>this.maskService.hideMask(this.saveModelTaskName,this)),(0,d.catchError)(n=>{const i=typeof n=="string"?n:n?.message||n?.errorInfo;return t?.silent===!0?(0,l.of)({success:!1,rowsAffected:0,errorInfo:i}):(0,l.throwError)(()=>new Error(i))}))}_updateLastLoadParameters(e,t,n,i){const r=t===P.Create||t===P.Copy,a=this.dataSchemas[e],c=a.dataSourceConfig?.type===ja.EntityDataSource;if(i.success&&r&&c){const h=a.primaryAttributeName,p=n[h];this._loadedDataSources.add(e),this._lastEventLoadParameters.set(e,[{type:j.PrimaryColumnValue,value:p}])}}getSaveParameters(e,t){return(0,l.forkJoin)({parameters:this._modelParametersBuilder.getModelParameters(this,t),dto:this._getDataSourceDto(e)})}getSaveModelStream$(e){return this.showLoadMaskAndValidateFields(e.dataSourceName),(0,l.from)(this.isValid(e.dataSourceName)).pipe((0,d.switchMap)(t=>{if(!t){const n=this.injector.get(T.TranslateService);return e.getInvalidAction({success:!1,rowsAffected:0,errorInfo:n.instant("HomePage.DialogMessages.RequiredFieldsAreNotFilled")})}return this.getSaveParameters(e.dataSourceName,e.parametersConfig).pipe((0,d.mergeMap)(({parameters:n,dto:i})=>(0,l.forkJoin)({result:e.saveAction(i,n),dto:(0,l.of)(i)})),(0,d.tap)(({result:n,dto:i})=>e.onSavedAction(i,n)),(0,d.map)(({result:n})=>n))}))}_checkDataSourceName(e){if(!e)throw new Error("Data source name is not provided")}innerSave(e,t,n){return(0,l.from)(this.waitAsyncTasksFinish()).pipe((0,d.switchMap)(()=>(this._checkDataSourceName(n),this.getModelMode(n)===P.Delete?t():e())))}initDependencies(){this.formBuilder=this.injector.get(wt.FormBuilder),this.resourceFinderService=this.injector.get(Ni),this.validatorTypeResolver=this.injector.get(gp),this.maskService=this.injector.get(gy),this.sysSettingsService=this.injector.get(Ge),this.crtControlStateAdapter=this.injector.get(Ji),this._businessRulesEngine=this.injector.get(Sr),this._businessRulesApplier=this.injector.get(Mr),this._featureValues=this.injector.get(Q),this._modelGenerator=this.injector.get(cu),this._ngZone=this.injector.get(s.NgZone),this._translateService=this.injector.get(T.TranslateService),this._scopeName=this.injector.get(ga,null),this._attributeGenerator=this.injector.get(Tr),this._attributeResourceGenerator=this.injector.get(Dr),this._crtZoneService=this.injector.get(zl),this._viewEventZoneName=this.injector.get(R_,Fn.Root),this._modelParametersBuilder=this.injector.get(Zr),this._context=this.injector.get(j_,null),this._crtInjectionContextService=this.injector.get(Zi),this._viewModelDataDelayerService=this.injector.get(mC,null),this._isDesignTime=this.injector.get(Zt,null),this._measurePerformanceService=this.injector.get(q,null),this._measurePerformancePageLoadService=this.injector.get(xr),this._appInfo=this.injector.get(ze,null)}processRequest(e){return this.handlerChain.process(e)}runInitFlow(e=null){return this._concatModelsWithEmbedded(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitFlow.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,d.tap)(t=>this._notifyAboutModelsErrors(t)),(0,d.tap)(t=>this._models$.next(t)),(0,d.tap)(()=>this._initFeaturesStates()),(0,d.mergeMap)(()=>this._generateDataSourcesInfo()),(0,d.tap)(t=>this._updateModels(t)),(0,d.mergeMap)(t=>this._generateAttributesToDataSourceNameMap(t)),(0,d.mergeMap)(t=>this._getDataSchemas()),(0,d.tap)(t=>this.dataSchemas=t),(0,d.mergeMap)(()=>this._initDataSourceValidators()),(0,d.switchMap)(()=>this._initBusinessRules()),(0,d.tap)(()=>{this._initSchemaValidators(this.viewModelConfig.attributes)}),(0,d.mergeMap)(()=>(0,l.forkJoin)([...this._generateResourceAttribute(),this._initSystemAttributes(),this._attributeGenerate(this.viewModelConfig.attributes),(0,l.of)(this),this._initSubscriptions()])),(0,d.mergeMap)(()=>this._generatePrimaryAttributes()),(0,d.tap)(()=>this._loadDefaultSorting()),(0,d.mergeMap)(()=>this._runInitialBusinessRules()),(0,d.tap)(()=>this._viewModelAttributeChangeEventOptions.reset())).pipe((0,d.switchMap)(()=>(0,l.of)(this)))}[dp](e){return this._attributeConfigs[e]?.isValueMasked??!1}[My](e){return this.getAttributePropertyValue(e,Ul)}[wy](e){return this.getAttributePropertyValue(e,$l)}[xy](e,t){this.setAttributePropertyValue(e,La,t)}[Ey](e){return this.getAttributePropertyValue(e,La)||Gl.Unmasked}init(e,t){return this._primaryModelName=t?.primaryModelName,this._modelDependencies=t?.modelDependencies||{},this._modelsLoadingConfig=t?.modelsLoadingConfig||{},this._lastEventLoadParameters=new Map,t?.businessRulesActive||this.deactivateBusinessRules(),this._modelDependencies&&this._handleCircularDependencies(),this._ngZone.runOutsideAngular(()=>this.runInitFlow(e))}setValue(e,t){const n=[],i=[];for(const r of Object.keys(this._attributeConfigs))"viewModelConfig"in this._attributeConfigs[r]||"viewModelName"in this._attributeConfigs[r]?i.push(r):n.push(r);return this._executeWithOptions(()=>{this._measurePerformanceService.measure(`ViewModel.setValue.updateViewModelModelAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.data.${Object.keys(e).toString()}`,()=>{for(const r in e)n.includes(r)&&(this._resetMaskDataForAttribute(r),this.set(r,e[r],{isMaskedValue:t?.isMaskedValue}))})},t),Ir.deferUpdatingValueAndValidity(this,()=>this._setSubmodelValues(i,e,t),this._featureValues)}deactivateBusinessRules(){this._businessRulesActive=!1}activateBusinessRules(){const e=this._businessRulesActive;if(this._businessRulesActive=!0,e)return(0,l.of)(null);const t=this.models.filter(n=>n.isLoaded);if(t.length>0){const n={type:ne.ContextReady,name:null,scopeId:""};return(0,l.forkJoin)(t.map(i=>this._runBusinessRulesForModel(i,[],!0,[n]))).pipe((0,d.tap)(()=>this._businessRulesAreActivated=this._businessRulesProcessingEnabled),(0,d.tap)(()=>this._businessRulesActivated$.next(this._businessRulesAreActivated)))}}_getDependOnModelsNames(e){const t=this._modelDependencies[e];if(!t)return[];const n=t.map(i=>i.relationPath.split(".")[0]);return[...new Set(n)]}_getModelDependencies(e){return this._modelDependencies[e]??[]}_getIsAffectedByBusinessRules(e){if(!this._businessRulesProcessingEnabled)return Promise.resolve(!1);const t=e.name,n=this._attributesAffectedByBusinessRules;if(n.length===0||!t)return Promise.resolve(!1);const i=n.some(h=>h.name===t),r=this.getBoundDataSchemaByAttributePath(t),a=this.getBoundDataSchemaAttributeByAttributePath(t);if(!a)return Promise.resolve(i);const c=n.filter(h=>h.scopeName===r.name).some(h=>h.name===a.name);return Promise.resolve(c||i)}executeRequest(e){return e.scopes=e.scopes||this._eventScopes,this._crtZoneService.runInZone(this._viewEventZoneName,()=>this.processRequest(e))}getAttributeControl(e){let t=this.formApiModel;gr(this,e).then(v.noop);for(const n of e.split("."))t=t.get(n);return t??new wt.FormControl}loadLookupList(e,t=[],n){const i=e.control,r=e.items,a=this._getDataSourceInfoByViewModelAttributePath(r);if(a){const c=this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.LoadDataRequest",$context:this,dataSourceName:a.name,parameters:t,config:{payload:n}}));Promise.resolve(c)}else{const c=this._getDataSourceInfoByViewModelAttributePath(i);if(c){const h=c.getDataSourceAttributePath(i);(0,l.forkJoin)([this._getDropdownPageSize(),this._modelParametersBuilder.getModelParameters(this,t,n)]).pipe((0,d.mergeMap)(([p,m])=>this.getModelByName(c.name).loadLookupList(h,m,p)),(0,d.map)(p=>Et.getLookupListDataSourceInfo(r,{value:p.primaryAttributeName,displayValue:p.primaryDisplayAttributeName}).getModelDto(p.data)),(0,d.mergeMap)(p=>this.setValue(p,{silent:!0}))).subscribe()}}}load(...e){const t=this._disableViewModelLoadUnblockingThread?(0,l.of)(null):(0,l.timer)(0,l.asyncScheduler),n=typeof e[0]=="string"?this._staticLoader(e):this._dynamicLoader(e);return t.pipe((0,d.switchMap)(()=>this.__destroyed?(0,l.of)([]):n))}setSorting(e,t){const i=this._dataSourcesInfos.get(e).getSortingConfig(),r=i&&i.attributeName;return r&&(this[r]=t),(0,l.of)(null)}create(e,t){return this._checkDataSourceName(e),this._createModelData(e,t)}copy(e,t,n){return this._checkDataSourceName(e),this._copyModelData(e,t,n)}loadDefaultValues(e){return this._setAttributesDefaultValues(e)}save(e,t,n){return this.innerSave(()=>this._saveModel(e,t,n),()=>this.delete(e,t,n),e)}delete(e,t,n){return this._checkDataSourceName(e),this.deleteModel(e,t,(i,r)=>this.getModelByName(i).delete(r),n)}resume(){return(0,l.of)(void 0)}pause(){return(0,l.of)(void 0)}destroy(){this._subscriptions.unsubscribe(),Array.from(this._collectionSubscription.values()).forEach(t=>t.unsubscribe()),this._collectionSubscription.clear(),this._crtControls.forEach(t=>{t.destroy()}),this.models?.forEach(t=>t.destroy()),this._crtControls.clear(),this._eventsSubject$.complete(),this._replayEvents$.complete(),this._modelLoaded$.complete();const e=[];for(const t of Object.values(this.attributes))t instanceof ht&&e.push(t.destroy()),t instanceof We&&e.push((0,l.from)(t.destroy()));return(0,l.forkJoin)(e).pipe((0,d.defaultIfEmpty)(void 0),(0,d.map)(()=>{}),(0,d.finalize)(()=>{this.parent||(this._crtInjectionContextService.removeContext(this._injectionContext?.id),of(this._injectionContext),this._context=null,this._viewModelDataDelayerService?.destroy(),this._viewModelDataDelayerService=null),this._asyncTasksExecutingSubject.complete(),this._dataSourcesInfos.clear(),this.__destroyed=!0,this._destroySubject.next(),this._destroySubject.complete()}))}getBoundDataSourceName(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(t!==null)return t;if(!e)return null;const n=this._findAttributePathInDataSourceNameMap(e);return this.getBoundDataSourceNameByAttributePath(n)}getBoundDataSourceAttributeControls(e){return Object.values(this._getBoundDataSourceAttributeControls(e))}getBoundDataSourceNameByAttributePath(e){return this._attributesToDataSourceNameMap.get(e)??null}getBoundDataSchema(e){return this.dataSchemas[this.getBoundDataSourceName(e)]}getBoundDataSchemaByAttributePath(e){return this.dataSchemas[this.getBoundDataSourceNameByAttributePath(e)]??null}getBoundDataSchemaAttributeByAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e),n=this.getBoundDataSchemaByAttributePath(e),i=this._getDataSourceInfoByViewModelAttributePath(e);if(!t||!n||!i)return null;const r=i.getDataSourceAttributePath(e);return n.findAttributeByName(r)}getPrimaryModelName(){return Promise.resolve(this._primaryModelName)}getPrimaryDataSchema(){return this.getPrimaryModelName().then(e=>this.dataSchemas[e])}isValid(e){const t=this._waitAsyncValidation().pipe((0,d.map)(()=>e?this.getBoundDataSourceAttributeControls(e).every(n=>!n.invalid):this.formApiModel.valid));return(0,l.lastValueFrom)(t)}validate(e){return this._ngZone.run(()=>e?this._validateByDataSourceName(e):this._validateAll())}getViewModelAttributePath(e,t){const n=this._dataSourcesInfos.get(e);return this._getMappedAttributeName(n,t)}getViewModelAttributePaths(e,t){return this._dataSourcesInfos.get(e)?.getMappedAttributeNames(t)}getCollectionViewModelAttributePath(e){return this._dataSourcesInfos.get(e)?.collectionViewModelAttributeName}canDelete(e,t){var n=this;return(0,b.A)(function*(){return n.getModelByName(e).canDelete(t)})()}canSave(e,t){var n=this;return(0,b.A)(function*(){return n.getModelByName(e).canSave(t)})()}enableAttributeValidator(e,t){this.getControl(e).enableValidator(t)}disableAttributeValidator(e,t){this.getControl(e).disableValidator(t)}_hotSwap(e){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap`,()=>{const t=e?.attributes?.changed||[],n=(0,v.isEmpty)(e.resources?.strings);if((0,v.isEmpty)(t)&&n)return(0,l.of)(!1);n||(this.resources={strings:this._getChangedResourcesStrings(e.resources.strings)}),this.viewModelConfig=e.actualViewModelConfig;const i=Et.getFromViewModelConfig(this.viewModelConfig),r=Object.fromEntries(t.map(f=>[f,this.viewModelConfig.attributes[f]])),a=e?.models?.changed??[],c=a.map(f=>f.name),h=this.models.filter(f=>f.isLoaded||f.isLoading).filter(f=>c.includes(f.name)).map(f=>f.name),p=a.map(f=>{const C=i.get(f.name);return this._upsertModel(f.name,f),this._replaceDataSourceInfo(f.name,C),this._addDataSchemaToDataSchemas(f)}),m=this._attributeGenerate$(r,{disableDefaultConfig:!0});return(0,l.forkJoin)([...p,m]).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap.forkJoin`),(0,d.switchMap)(()=>this._reGenerateResourcesAttributes()),(0,d.tap)(()=>this._loadDefaultSorting(c)),(0,d.tap)(()=>this._requestReloadModels(h)),(0,d.map)(()=>!0))})}set(e,t,n){return this._setAttributeValue(e,t,n),Promise.resolve()}_markAsPristine(e){this._forEachControl(e,t=>{t.markAsPristine()})}getAttributeNameByViewItemName(e){return Object.keys(this._attributeConfigs).find(t=>this._attributeConfigs[t].viewItemName===e)}getControl(e){return this._crtControls.has(e)?this._crtControls.get(e):Va.create({name:e,value:null,propertiesConfig:[],featureValues:this._featureValues})}getAttributePropertyValue(...e){let t,n;if(e.length===2)t=e[0],n=e[1];else if(e.length===1){const r=e[0].split(":");t=r[0],n=r[1]}else throw new Error("ArgumentException");return this.getControl(t).getPropertyValue(n)}setAttributePropertyValue(...e){let t,n,i;if(e.length===3)t=e[0],n=e[1],i=e[2];else if(e.length===2){const a=e[0].split(":");t=a[0],n=a[1],i=e[1]}else throw new Error("ArgumentException");return this.getControl(t).setPropertyValue(n,i)}resetAttributePropertyValue(...e){let t,n;if(e.length===1)[t,n]=e[0].split(":");else if(e.length===2)t=e[0],n=e[1];else throw new Error("ArgumentException");this.getControl(t).getPropertyByName(n)?.resetValue()}getInvariabilityPropertyName(e){return this.getControl(e).getInvariabilityPropertyName()}setModelValues(e,t){return this.getModelByName(e).setValue(t)}_getBoundAttributesNames(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(!t)return null;const n=this._dataSourcesInfos.get(t),i=n.attributesMap.get(e);return Array.from(n.attributesMap.entries()).filter(([r,a])=>a===i&&r!==e).map(([r])=>r)}_getAttributeDataValueTypeName(e){return this._attributeConfigs[e].dataValueTypeName}getDataSourceLoadParameters(e,t){const n=this._dataSourcesInfos.get(e);return n?this._modelParametersBuilder.getModelLoadParameters(this,n,[],de.Load,{modelLoadConfiguration:t}).then(([i,r,a,c])=>({parameters:i,options:{pagingConfig:r,sortingConfig:a,hierarchyConfig:c}})):null}getAttributeViewModelConfig(e){return this._attributeConfigs[e]?.viewModelConfig?.attributes}isDataSourceForCollection(e){return!!this._dataSourcesInfos.get(e)?.isCollection}_getDataSourceAttributeDataValueType(e){const t=this._getDataSourceInfoByViewModelAttributePath(e);let n=null;if(t){const i=t.getDataSourceAttributePath(e);i&&(n=this._getDataSourceAttributeSchema(t,i)?.dataValueType)}return n}_getModelNamesByLoadType(e){return Object.entries(this._modelsLoadingConfig).filter(([t,n])=>n.type===e).map(([t,n])=>t)}_reloadDependentModels(e,t=[],n=null){const i=this._getDependentModelsForLoad(e,t);this._requestReloadModels(i.filter(r=>{const a=zn(this.getModelByName(r));return!n||a&&n===ut.Page||!a&&n===ut.ViewElement}))}_getDependentModelsForLoad(e,t=[]){const n=this._getDependentModelsNames(e.name,t),i=this._getChangedModelsNames(n).filter(r=>!zn(this.getModelByName(r)));return i.length!==0&&this._showNotification({message:"BaseViewModel.RefreshModelDataConflict"}),n.filter(r=>!i.includes(r)).filter(r=>this._modelsRequestedToLoad.has(r)||zn(this.getModelByName(r)))}_getDataSourceAttributeCaption(e,t){let n=this.resourceFinderService.findLocalizableValue(t);const i=this._getDataSourceInfoByViewModelAttributePath(e);if(n==null&&i){const r=i.getDataSourceAttributePath(e),a=r?this._getDataSourceAttributeSchema(i,r):"";n=a?a.caption:this._translateService.instant("BaseViewModel.DataSourceAttributeRemoved")}return n}getIsDirty(e){return this.getControl(e).isDirty}getModelByName(e){return this._modelsMap.get(e)}getModelMode(e){return this.getModelByName(e)?.mode}getPrimaryModelMode(){return this.getModelMode(this._primaryModelName)}_getModelModeChanges(e){return this.getModelByName(e)?._modeChanges$}_getPrimaryModelModeChanges(){return this._getModelModeChanges(this._primaryModelName)}markModelFor(e,t){this.getModelByName(e)?.markFor(t)}markPrimaryModelFor(e){this.markModelFor(this._primaryModelName,e)}_setStateAttribute(e){this._setSystemAttributeValue(za,e)}_onAsyncTaskStarted(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.add(e),this._asyncTasksExecutingSubject.next(t)}_onAsyncTaskFinished(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.delete(e),this._asyncTasksExecutingSubject.next(t)}waitAsyncTasksFinish(){let e;return(0,l.firstValueFrom)(this._asyncTasksExecutingSubject.pipe((0,d.tap)(t=>{clearTimeout(e),e=this._handleAsyncTasksCycle(t)}),(0,d.filter)(t=>t.size===0),(0,d.take)(1),(0,d.map)(()=>{})))}destroyModel(e){const t=this.getModelByName(e);t&&t.destroy();const n=this.models.filter(i=>i.name!==e);this._models$.next(n),this._dataSourcesInfos.delete(e),[...this._attributesToDataSourceNameMap.entries()].filter(([i,r])=>e===r).forEach(([i])=>this._attributesToDataSourceNameMap.delete(i))}}class tn extends lt{_getViewModelCollectionValue(e,t){if(!t.length)return Promise.resolve(e);const n=Array.from(e).map(i=>this._getObjectProp(i,t));return Promise.all(n)}_getObjectProp(e,t){var n=this;return(0,b.A)(function*(){const i=t.shift();return i?(e=yield e[i],e instanceof ht?n._getObjectProp(e,t):e instanceof We?n._getViewModelCollectionValue(e,t):n._getObjectProp(e,t)):e})()}evaluate(e,t){const n=e.slice(1);return ml(n,t).pipe((0,d.map)(i=>i??{context:fr(t),contextPath:""}),(0,d.switchMap)(i=>(0,l.combineLatest)([i.context.viewModel$,(0,l.of)(_l(i.contextPath,n))])),(0,d.switchMap)(([i,r])=>i?this._getObjectProp(i,r.split(".")):(0,l.of)(null)),(0,d.take)(1))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(tn)))(n||tn)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:tn,factory:tn.\u0275fac})}}class ts{_getStringValue(e){return e.match(/^'(.*)'$/)[1]}_getBooleanValue(e){if(e==="true")return!0;if(e==="false")return!1;throw new Error(`${e} is not Boolean value`)}evaluate(e){if(Nh(e))return(0,l.of)(this._getStringValue(e));if(Vh(e))return(0,l.of)(parseFloat(e));if(Lh(e))return(0,l.of)(this._getBooleanValue(e));throw new Error(`Failed to parse primitive value binding expression: ${e}`)}static{this.\u0275fac=function(t){return new(t||ts)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ts,factory:ts.\u0275fac})}}class nn extends _r{constructor(e,t,n,i=!1){super(),this._convertersRegistry=e,this._objectPropBindingExpressionInterpreter=t,this._fixedValueBindingExpressionInterpreter=n,this._isDesignTime=i}_evaluateParam(e,t){if(F_(e))return this._fixedValueBindingExpressionInterpreter.evaluate(e);if(Ze(e))return this._objectPropBindingExpressionInterpreter.evaluate(e,t);throw new Error(`Cannot parse parameter expression: ${e}`)}_evaluateParams(e,t){const n=e.map(i=>this._evaluateParam(i,t).pipe((0,d.first)()));return(0,l.forkJoin)(n).pipe((0,d.defaultIfEmpty)([]))}_getConverters(e,t){return e.split("|").map(i=>i.trim()).map(i=>{const[r,...a]=i.split(":").map(p=>p.trim()),c=this._evaluateParams(a,t),h=t.viewModel$.pipe((0,d.first)());return(0,l.forkJoin)([h,c]).pipe((0,d.map)(([p,m])=>f=>{if(!p)return null;const C=p._injectionContext;return this._convertersRegistry.get(r,C).convert(f,p,...m)}))})}_applyConverters(e,t){for(const[n,i]of Object.entries(t))if(e=i(e),e instanceof Promise){const r=parseInt(n,10)+1;return this._applyAsyncConverters(e,[...t].slice(r))}return e}_applyAsyncConverters(e,t){return(0,b.A)(function*(){let n=yield e;for(const i of t)n=i(n),n instanceof Promise&&(n=yield n);return n})()}evaluate(e,t){if(this._isDesignTime||(0,v.isEmpty)(e))return(0,l.of)(i=>i);const n=this._getConverters(e,t);return(0,l.forkJoin)(n).pipe((0,d.map)(i=>r=>this._applyConverters(r,i)))}static{this.\u0275fac=function(t){return new(t||nn)(s.\u0275\u0275inject(yr),s.\u0275\u0275inject(tn),s.\u0275\u0275inject(ts),s.\u0275\u0275inject(Zt,8))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:nn,factory:nn.\u0275fac})}}class Wn{constructor(e,t,n,i){this._attributeBindingExpressionInterpreter=e,this._attributePropertyBindingExpressionInterpreter=t,this._resourceBindingExpressionInterpreter=n,this._converterExpressionInterpreter=i}_applyConverter(e,t){return(0,b.A)(function*(){return e=t(e),e instanceof Promise&&(e=yield e),e})()}evaluateInputValueExpression(e,t){return jh(e)?this._resourceBindingExpressionInterpreter.evaluate(e,t):kh(e)?this._attributePropertyBindingExpressionInterpreter.evaluate(e,t):this._attributeBindingExpressionInterpreter.evaluate(e,t)}evaluate(e,t){const n=/\|(.*)/,[i,r]=e.split(n).map(h=>h.trim()),a=this.evaluateInputValueExpression(i,t),c=this._converterExpressionInterpreter.evaluate(r,t);return a.pipe((0,d.switchMap)(h=>c.pipe((0,d.switchMap)(p=>this._applyConverter(h,p)))))}static{this.\u0275fac=function(t){return new(t||Wn)(s.\u0275\u0275inject(lt),s.\u0275\u0275inject(Bi),s.\u0275\u0275inject(Fi),s.\u0275\u0275inject(nn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Wn,factory:Wn.\u0275fac})}}class ns extends Wn{constructor(e,t){super(null,null,null,t),this._objectPropBindingExpressionInterpreter=e}_evaluateEventBindingExpression(e,t){const n=t.initialEvent,i=e.replace(/@event\.?/,"");return(0,l.of)(i?(0,v.get)(n,i):n)}evaluateInputValueExpression(e,t){return gl(e)?this._evaluateEventBindingExpression(e,t):this._objectPropBindingExpressionInterpreter.evaluate(e,t)}static{this.\u0275fac=function(t){return new(t||ns)(s.\u0275\u0275inject(tn),s.\u0275\u0275inject(nn))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ns,factory:ns.\u0275fac})}}class is{constructor(e){this._requestParamBindingExpressionInterceptor=e}_evaluate(e,t){var n=this;return(0,b.A)(function*(){const i={};for(const[r,a]of Object.entries(e))i[r]=yield n._evaluateConfigValue(a,t);return i})()}_evaluateConfigValue(e,t){return Array.isArray(e)?Promise.all(e.map(n=>this._evaluateConfigValue(n,t))):Ze(e)||gl(e)?(0,l.lastValueFrom)(this._requestParamBindingExpressionInterceptor.evaluate(e,t),{defaultValue:null}):e&&typeof e=="object"?this._evaluate(e,t):Promise.resolve(e)}evaluate(e,t){return(0,l.from)(this._evaluate(e,t))}static{this.\u0275fac=function(t){return new(t||is)(s.\u0275\u0275inject(ns))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:is,factory:is.\u0275fac})}}class ss{constructor(e){this._requestParamsBindingConfigInterpreter=e}_evaluateParams(e,t){return e?this._requestParamsBindingConfigInterpreter.evaluate(e,t):(0,l.of)({})}_getRequestBindingContext(e,t){return e.useRelativeContext?t:fr(t)}evaluate(e,t){return this._evaluateParams(e.params,t).pipe((0,d.withLatestFrom)(this._getRequestBindingContext(e,t).viewModel$),(0,d.map)(([n,i])=>({type:e.request,$context:i,...n})),(0,d.first)())}static{this.\u0275fac=function(t){return new(t||ss)(s.\u0275\u0275inject(is))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ss,factory:ss.\u0275fac})}}class Zn extends lt{_getValidationStateChanges(e,t){const n=t.attributeHost.getAttributeControl(t.attributeName);return(0,l.merge)(e,n.statusChanges).pipe((0,d.map)(()=>({value:n.value,validationInfo:(0,v.pick)(n,"valid","errors","dirty","touched")})),(0,d.distinctUntilChanged)(v.isEqual))}evaluate(e,t){const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,d.switchMap)(i=>i.attributeHost?this._getValidationStateChanges(super.evaluate(e,t),i):(0,l.of)({value:null,validationInfo:{valid:!0,errors:null,dirty:!1,touched:!1}})))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Zn)))(n||Zn)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Zn,factory:Zn.\u0275fac})}}const Rp=[lt,Bi,Nn,Wn,nn,tn,ts,ss,ns,is,Fi,Zn,Um.create({token:O_,mappings:[{predicate:"converter",injectable:nn}]})],$a=new s.InjectionToken("CRT_BINDING_CONTEXT"),jp=new s.InjectionToken("CRT_BINDING_CONTEXT_DESIGN_TIME"),_C=o=>({viewModel$:o.viewModel$,parent:o.parent}),yC=(o,e)=>{const t=new l.ReplaySubject(1);return t.next(null),(o.viewModel$??e?.viewModel$)?.subscribe(t),{viewModel$:t.asObservable(),parent:o.viewModel$?e:e?.parent,viewModelSubject:t}};class Yn{set viewModel(e){(e instanceof ht||e===void 0||e===null)&&(this.viewModel$?this.viewModel$.next(e):(this.viewModel$=new l.ReplaySubject(1),this.viewModel$.next(e)))}ngOnDestroy(){this.viewModel=null,this.viewModel$?.complete()}static{this.\u0275fac=function(t){return new(t||Yn)}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:Yn,selectors:[["","crtViewModel",""]],inputs:{viewModel:[0,"crtViewModel","viewModel"]},features:[s.\u0275\u0275ProvidersFeature([{provide:$a,useFactory:_C,deps:[[new s.Inject(jp),new s.Self]],multi:!1},{provide:jp,useFactory:yC,deps:[(0,s.forwardRef)(()=>Yn),[new s.Inject($a),new s.SkipSelf,new s.Optional]],multi:!1}])]})}}var Yr=y(94123);class CC{static{this._addItemListeners=[]}static{this._removeItemListeners=[]}static{this._requestHandlersMap=new Map}static{this._handlersByRequestMap=new Map}static get requestHandlersMap(){return this._requestHandlersMap}static get handlersByRequestMap(){return this._handlersByRequestMap}static onAddRequestHandler(e){return this._addItemListeners.push(e),()=>{this._addItemListeners.splice(this._addItemListeners.indexOf(e),1)}}static onRemoveRequestHandler(e){return this._removeItemListeners.push(e),()=>{this._removeItemListeners.splice(this._removeItemListeners.indexOf(e),1)}}static addRequestHandler(e,t){const n=this._requestHandlersMap.get(e);if(n&&(!n.instanceConfig?.lazy||n.instanceType))return;const i={instanceType:t.instanceType,instanceConfig:{...n?.instanceConfig??{},...t.instanceConfig}};this._requestHandlersMap.set(e,i);for(const c of this._addItemListeners)c(e,i);const r=t.instanceConfig.requestType;let a=this._handlersByRequestMap.get(r);a||(a=new Map,this._handlersByRequestMap.set(r,a)),a.set(e,i)}static removeRequestHandler(e){const t=this._requestHandlersMap.get(e);if(!t)return;this._requestHandlersMap.delete(e);for(const r of this._removeItemListeners)r(e,t);const n=t.instanceConfig.requestType,i=this._handlersByRequestMap.get(n);i&&i.delete(e)}static clear(){for(const e of this._requestHandlersMap.keys())this.removeRequestHandler(e)}}const Kr=window;Kr.creatio??={},Kr.creatio.requestHandlerRegistry||Object.defineProperty(Kr.creatio,"requestHandlerRegistry",{get:()=>CC,configurable:!1});const bC=Kr.creatio.requestHandlerRegistry;class uu{static{this._internalRegistry=Kr.creatio.requestHandlerRegistry}static find(e){return uu._internalRegistry.requestHandlersMap.get(e)}static register(e,t){const n=e.requestType,i=e.type;if(!n)throw new Error(`Error when register ${i}. Request type not specified.`);const r={instanceType:t,instanceConfig:e};uu._internalRegistry.addRequestHandler(i,r)}}class yw{}const vC="ValidatorRegistry";class Ga extends qs{static{this.registryKey=vC}static _hasWithAnotherTypeRef(e,t){const n=Ga.items.get(e);return!n||n.lazy&&!n.typeRef?!1:n.typeRef!==t}static validate(e){if(zi(e.type,"ValidatorTypeName"),e.typeRef&&Ga._hasWithAnotherTypeRef(e.type,e.typeRef))throw new Error(`Error when register ${e.type}. Element with this type has already exist`)}static get items(){return this.store.typeInfos}static register(e){const t=this.items.get(e.type);this.items.set(e.type,{...t??{},...e})}}const SC="InterfaceDesignerItemRegistry";class MC extends qs{static get _interfaceDesignerItemRegistrationInfos(){return this.store.typeInfos}static validate(e){zi(e.type,"InterfaceDesignerItemTypeName"),Cl(e.type),Uh(e.type,e,this._interfaceDesignerItemRegistrationInfos)}static register(e,t){if(typeof e=="string"&&t)this._interfaceDesignerItemRegistrationInfos.set(e,t);else if(typeof e!="string")this._interfaceDesignerItemRegistrationInfos.set(e.type,e);else throw new Error("Invalid arguments provided to register method.")}static get(e){return this._interfaceDesignerItemRegistrationInfos.get(e)}static has(e){return this._interfaceDesignerItemRegistrationInfos.has(e)}static getAll(){return this._interfaceDesignerItemRegistrationInfos}static values(){return[...this._interfaceDesignerItemRegistrationInfos.values()]}static clear(){this._interfaceDesignerItemRegistrationInfos.clear()}}class wC extends MC{static{this.registryKey=SC}}class Jr{constructor(){this.registry=wC}get(e){return this.registry.get(e)}getInternal(e){return this.registry.get(e)}register(e,t){this.registry.register(e,t)}getAll(){return this.registry.getAll()}has(e){return this.registry.has(e)}values(){return this.registry.values()}clear(){this.registry.clear()}static{this.\u0275fac=function(t){return new(t||Jr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Jr,factory:Jr.\u0275fac})}}class xC extends qs{static validate(e){zi(e.type,"ViewElementTypeName");const t=this.viewElements.get(e.type);t?.lazy&&!("selector"in t)&&!t.typeRef||Uh(e.type,e,this.viewElements)}static get viewElements(){return this.store.typeInfos}static register(e){const t=this.viewElements.get(e.type);this.viewElements.set(e.type,{...t??{},...e})}static getFormControlRelatesAttribute(e){const t=this.store.typeInfos.get(e);return t&&"formControlConfig"in t&&t.formControlConfig?.relatesTo||null}static getValuePropertyName(e){const t=this.store.typeInfos.get(e);return t&&"valuePropertyName"in t&&t.valuePropertyName||null}static getViewElementInputs(e){return this.store.typeInfos.get(e)?.inputs??{}}static getViewElementOutputs(e){return this.store.typeInfos.get(e)?.outputs??{}}static getViewElementPropertiesDefaultValues(e){const t=this.store.typeInfos.get(e);return[...Object.entries(t?.inputs??{}).filter(([i,r])=>Object.prototype.hasOwnProperty.call(r,"defaultValue")).map(([i,r])=>({name:i,defaultValue:r.defaultValue})),{name:"visible",defaultValue:!0}]}static getViewElementCompatiblePlatformAPIsOptions(e,t){return this.store.typeInfos.get(e)?.compatibleAPIs?.[t]??{}}static isViewElementAvailableByCompatibleAPIs(e,...t){const n=this.store.typeInfos.get(e);return Object.entries(n?.compatibleAPIs??{}).filter(([i,r])=>t.includes(i)).some(([i,r])=>typeof r=="boolean"?r:(r||{}).enable)}}const EC="ViewElementRegistry";class Ha extends xC{static{this.registryKey=EC}}class IC{canResolve(e){return this.registry.viewElements.has(e)}getViewElementRegistryItem(e){return this.registry.viewElements.get(e)}isViewElementAvailableByCompatibleAPIs(e,...t){return this.registry.isViewElementAvailableByCompatibleAPIs(e,...t)}getViewElementCompatiblePlatformAPIsOptions(e,t){return this.registry.getViewElementCompatiblePlatformAPIsOptions(e,t)}getFormControlRelatesAttribute(e){return this.registry.getFormControlRelatesAttribute(e)}getValuePropertyName(e){return this.registry.getValuePropertyName(e)||this.getFormControlRelatesAttribute(e)}getViewElementInputs(e){return this.registry.getViewElementInputs(e)}getViewElementOutputs(e){return this.registry.getViewElementOutputs(e)}getViewElementPropertiesDefaultValues(e){return this.registry.getViewElementPropertiesDefaultValues(e)}getViewElementType(e){const t=this.getViewElementRegistryItem(e.type);return this.getViewElementTypeByRegistryItem(t)}getCrtInputs(e){return this.getViewElementRegistryItem(e)?.inputs}getSelector(e){const t=this.getViewElementRegistryItem(e);return this.getSelectorByRegistryItem(t)}getSelectorByRegistryItem(e){return e&&"selector"in e?e.selector:null}getViewElementTypeByRegistryItem(e){return e&&"typeRef"in e?e.typeRef:null}}class ye extends IC{constructor(){super(...arguments),this.registry=Ha}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(ye)))(n||ye)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ye,factory:ye.\u0275fac})}}function AC(o,e){if(typeof o=="string"){const t=o.startsWith("$"),n=o.slice(1).split(".").pop()||"",i=e?.[n]!=null;return t&&i}return!1}class qr{constructor(){this._designerResolver=(0,s.inject)(Jr),this._viewResolver=(0,s.inject)(ye),this._viewElementContentSlotsCache=new Map}_getViewConfigInfo(e,t,n,i,r){const a=[];if(Array.isArray(n))for(let c=0;c<n.length;c++){const h=n[c];t.includes(h[e])&&a.push({viewConfig:h,parentName:i,index:c,parentPropertyName:r}),this.getViewElementContentSlots(h.type)?.forEach(m=>{const f=h[m];if(f){const C=this._getViewConfigInfo(e,t,f,h.name,m);a.push(...C)}})}return a}_getViewConfigInfoByFilter(e,t,n,i){const r=[];if(Array.isArray(t))for(let a=0;a<t.length;a++){const c=t[a];e(c)&&r.push({viewConfig:c,parentName:n,index:a,parentPropertyName:i}),this.getViewElementContentSlots(c.type)?.forEach(p=>{const m=c[p];if(m){const f=this._getViewConfigInfoByFilter(e,m,c.name,p);r.push(...f)}})}return r}_getViewConfigsBindingMap(e,t,n){const i=new Map;if(Array.isArray(e))for(let r=0;r<e.length;r++){const a=e[r],c=this._viewResolver.getValuePropertyName(a.type),h=a[c]??"";if(h.startsWith("$")){const m=h.substring(1),f={viewConfig:a,parentName:t,index:r,parentPropertyName:n};i.has(m)?i.get(m).push(f):i.set(m,[f])}this.getViewElementContentSlots(a.type)?.forEach(m=>{const f=a[m];f&&this._getViewConfigsBindingMap(f,a.name,m).forEach((S,w)=>{i.has(w)?i.get(w).push(...S):i.set(w,S)})})}return i}_isViewModelAttributeBound(e,t){if(!t)return!1;const n=e.viewConfig,i=`\\W\\$${t}\\W`;return this._isAttributeUseInConfig(n,i)}_isViewModelAttributeBoundInViewModel(e,t){if(!t)return!1;const n=(0,v.cloneDeep)(this.getViewModelConfig(e));n.attributes=n.attributes||{},delete n?.attributes[t];const i=`\\W${t}\\W`;return this._isAttributeUseInConfig(n,i)}_isAttributeUseInConfig(e,t){const n=JSON.stringify(e);return new RegExp(t).test(n)}_findViewConfigItem(e,t,n){if(n(t))return e.push(t),!0;const i=this.getViewElementContentSlots(t.type);for(const r of i){const a=t[r];if(a){for(const c of a)if(this._findViewConfigItem(e,c,n))return e.push(t),!0}}}_getViewConfigArray(e){return e?Array.isArray(e)?e:[e]:[]}_getCollectionPropertyNames(e){return this._designerResolver.get(e)?.collectionPropertyNames||["items"]}_getContentSlots(e){const t=[];return this._viewResolver.getViewElementRegistryItem(e)?.contentSlots?.forEach(i=>{if(typeof i=="string")t.push(i);else{const r=i?.name;t.push(r)}}),t}_getPossibleResourceValues(e){return[`#ResourceString(${e})#`]}getViewElementContentSlots(e){if(this._viewElementContentSlotsCache.has(e))return this._viewElementContentSlotsCache.get(e);const t=this._getContentSlots(e),n=this._getCollectionPropertyNames(e),i=[...new Set([...t,...n])];return this._viewElementContentSlotsCache.set(e,i),i}getViewConfigPathByPropertyValue(e,t,n){const i=[],r=this._getViewConfigArray(n);for(const a of r)if(this._findViewConfigItem(i,a,c=>c[e]===t))break;return i}getViewConfigInfoByPropertyForValues(e,t,n){const i=[],r=this._getViewConfigArray(n);for(let a=0;a<r.length;a++){const c=r[a];t.includes(c[e])&&i.push({viewConfig:c,index:a}),this.getViewElementContentSlots(c.type)?.forEach(p=>{const m=c[p];if(m){const f=this._getViewConfigInfo(e,t,m,c.name,p);i.push(...f)}})}return i}getViewConfigInfoByProperty(e,t,n){return this.getViewConfigInfoByPropertyForValues(e,[t],n)}getViewConfigInfoByType(e,t){return this.getViewConfigInfoByProperty("type",t,e).map(n=>n?.viewConfig).filter(Boolean)}getViewConfigInfoByFilter(e,t){const n=[],i=t??[];for(let r=0;r<i.length;r++){const a=i[r];e(a)&&n.push({viewConfig:a,index:r}),this.getViewElementContentSlots(a.type)?.forEach(h=>{const p=a[h];if(p){const m=this._getViewConfigInfoByFilter(e,p,a.name,h);n.push(...m)}})}return n}getViewConfigsBindingMap(e){return this._getViewConfigsBindingMap(e??[],"","")}getViewModelAttribute(e,t){return this.getViewModelConfig(e)?.attributes?.[t]}getViewConfigInfoByName(e,t){return this.getViewConfigInfoByProperty("name",t,e?.viewConfig)[0]||{}}getViewModelConfig(e,t=!1){return!e.viewModelConfig&&t&&(e.viewModelConfig={}),e.viewModelConfig||{}}isViewModelAttributeBound(e,t){return t?this._isViewModelAttributeBound(e,t)||this._isViewModelAttributeBoundInViewModel(e,t):!1}addViewModelAttributeChangeRequest(e,t){const{attributeName:n,requests:i,options:r}=t??{};if(!n||!i?.length)return;const a=!!r?.createAttributeIfEmpty,c=this.getViewModelConfig(e,a);if(!c?.attributes&&!a)return;const h=c.attributes??={};if(!h[n]&&!a)return;const p=h[n]??={};p.change??=[],Array.isArray(p.change)||(p.change=[p.change]),p.change.push(...i)}findResourceDependencies(e,t){const n=this._getPossibleResourceValues(e),i={viewElements:[],attributes:[]},r=(a,c)=>{a&&(typeof a=="string"?n.forEach(h=>{a.includes(h)&&i.viewElements.push(c)}):Array.isArray(a)?a.forEach(h=>r(h,c)):typeof a=="object"&&Object.values(a).forEach(h=>r(h,c)))};return Object.entries(t).forEach(([a,c])=>r(c,a)),i}getDependentModelsNames(e,t,n){return Object.entries(e||{}).filter(([,r])=>{let a=t;return n&&(a=`${t}.${n}`),r.some(c=>c.relationPath.startsWith(a))}).map(([r])=>r)}getDataSourceModelName(e,t){return e?.dataSources?.[t]?.config?.entitySchemaName}findAllAttributesByDataSourceAttributePath(e,t){const n=this.getViewModelConfig(e,!0).attributes??{},i=Object.keys(n).filter(a=>{const c=n[a]??{};return hp(c)&&c.modelConfig?.path===t});if(i.length>0)return i;const r=t.split(".");if(r.length>2){const a=r[0],h=e?.modelConfig?.dataSources?.[a]?.config?.attributes;if(h){const p=r.slice(1).join("."),m=Object.keys(h).find(f=>h[f].path===p);if(m)return this.findAllAttributesByDataSourceAttributePath(e,`${a}.${m}`)}}return[]}getLoadParametersByDataSourceName(e,t){return t.modelConfig?.dataSources?.[e]?.config?.loadParameters}getSortingConfigByDataSourceName(e,t){return this.getLoadParametersByDataSourceName(e,t)?.options?.sortingConfig}getCollectionViewConfigs(e,t){return t?.length?this.getViewConfigInfoByPropertyForValues("type",t,e.viewConfig).filter(n=>!!n).map(({viewConfig:n})=>n).filter(({name:n})=>n)||[]:[]}getCollectionViewConfigsWithItemsBinding(e,t){return this.getCollectionViewConfigs(e,t).filter(({items:n})=>AC(n,e.viewModelConfig?.attributes))}getRequestBindingConfigs(e,t,n){const i=[];return t===void 0||this.getViewConfigInfoByFilter(r=>{const a=Object.values(r).filter(c=>{const h=c;return h?.request===t&&(n?n(h):!0)});return i.push(...a),!1},e),i}findAllAttributesByDataSource(e,t){const n=this.getViewModelConfig(e,!0).attributes;return typeof n=="object"?Object.keys(n).filter(i=>{const r=n[i];return hp(r)&&r.modelConfig?.path?.startsWith(t)}):[]}static{this.\u0275fac=function(t){return new(t||qr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:qr,factory:qr.\u0275fac})}}class kp{constructor(){this.viewElements=new Set,this.requests=new Set,this.converters=new Set,this.validators=new Set}}class Xr{constructor(){this._metadataSchemaUtils=(0,s.inject)(qr),this._viewElementTypeResolver=(0,s.inject)(ye)}_forEachStringInObject(e,t,n=[]){for(const i in e){const r=e[i];typeof r=="string"?t(n.concat(i),r):typeof r=="object"&&r!==null&&(n.push(i),this._forEachStringInObject(r,t,n),n.pop())}}_searchInContentSlots(e,t,n){const i=this._metadataSchemaUtils.getViewElementContentSlots(e.type)??[];for(const r of i){const a=e[r];Array.isArray(a)&&this._searchInViewConfig(e[r]??[],n)}}_searchInBindingExpression(e,t){fl(e).converters?.forEach(n=>t.converters.add(n.type))}_searchInRequestConfig(e,t){const n=Array.isArray(e)?e:[e];for(const i of n)t.requests.add(i.request),i.params&&this._forEachStringInObject(i.params,(r,a)=>{Ze(a)&&this._searchInBindingExpression(a,t)})}_searchInViewConfig(e,t){for(const n of e){t.viewElements.add(n.type);const i=this._viewElementTypeResolver.getViewElementRegistryItem(n.type);if(i)for(const[r,a]of Object.entries(n))i.inputs&&r in i.inputs&&Ze(a)&&this._searchInBindingExpression(a,t),a&&i.outputs&&r in i.outputs&&this._searchInRequestConfig(a,t);this._searchInContentSlots(n,i,t)}}_searchInValidatorsConfig(e,t){for(const n of Object.values(e))t.validators.add(n.type)}_searchInViewModelConfig(e,t){if("attributes"in e)for(const n of Object.values(e.attributes))"change"in n&&this._searchInRequestConfig(n.change,t),"validators"in n&&this._searchInValidatorsConfig(n.validators,t),"viewModelConfig"in n&&this._searchInViewModelConfig(n.viewModelConfig,t),"converter"in n&&this._searchInBindingExpression("$value | "+n.converter,t)}*_getRequestHandlersMetadata(e){for(const t of e){const n=bC.handlersByRequestMap.get(t);if(n)for(const i of n.values())yield i}}_addModuleRefIfLazy(e,t,n){t?.lazy&&(!n||n(t))&&e.add(t.lazyModuleRef)}getUsedItemsInSchema(e){const t=new kp;return this._searchInViewConfig(e.viewConfig??[],t),this._searchInViewModelConfig(e.viewModelConfig??{},t),t}getUsedItemsInViewConfig(...e){const t=new kp;return this._searchInViewConfig(e,t),t}getUsedViewElements(e){return this.getUsedItemsInViewConfig(...e).viewElements}getLazyModuleRefs(e,t){const n=new Set,{viewElements:i,requests:r,converters:a,validators:c}=e;for(const m of i)this._addModuleRefIfLazy(n,this._viewElementTypeResolver.getViewElementRegistryItem(m));for(const m of a)this._addModuleRefIfLazy(n,$h.find(m));for(const m of c)this._addModuleRefIfLazy(n,Ga.items.get(m));const h=this._getRequestHandlersMetadata(r),p=t?.requestScopes?m=>Ch(m.scopes,t.requestScopes):void 0;for(const m of h)this._addModuleRefIfLazy(n,m.instanceConfig,p);return n}static{this.\u0275fac=function(t){return new(t||Xr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Xr,factory:Xr.\u0275fac})}}function PC(o){const e=new l.Subscription;for(const t of o)e.add(t);return e}class pe{constructor(e=new l.Subscription,t=Promise.resolve()){this._subscription=e,this.ready=t}static all(e){const t=PC(e.map(i=>i._subscription)),n=Promise.all(e.map(i=>i.ready)).then(()=>{});return new pe(t,n)}static subscribe(e,t,n=!1){e=e.pipe((0,d.share)());const i=e.subscribe({next:t}),r=n?(0,l.lastValueFrom)(e.pipe((0,d.first)(),(0,d.map)(()=>{})),{defaultValue:null}):Promise.resolve();return new pe(i,r)}unsubscribe(){this._subscription.unsubscribe()}}const du="Change",Wa="ValidationInfo";function hu(o,e){return!!Ha.viewElements.get(o)?.inputs?.[e]}function pu(o,e){return!!Ha.viewElements.get(o)?.outputs?.[e]}function Cw(o,e){return!!ViewElementRegistry.viewElements.get(o)?.validationInputs?.[e]}function mu(o){return o+du}function bw(o,e){const t=mu(e);return pu(o,t)}function TC(o){return o+Wa}function Np(o,e){const t=e+Wa;return!!Ha.viewElements.get(o)?.validationInputs?.[t]}function DC(o){let e=null;if(o.endsWith(du))e=o.replace(new RegExp(du+"$"),"");else if(o.endsWith(Wa))e=o.replace(new RegExp(Wa+"$"),"");else return null;return e}function vw(o,e){const t=DC(e);return!!t&&hu(o,t)}function Vp(o,e){return gu.apply(this,arguments)}function gu(){return gu=(0,b.A)(function*(o,e){const t=ml(o,e),n=yield(0,l.firstValueFrom)(t,{defaultValue:null});if(!n)return null;const i=yield(0,l.firstValueFrom)(n.context.viewModel$);if(!i)return null;const r=_l(n.contextPath,o);return yield Bh(i,r)}),gu.apply(this,arguments)}function OC(o,e,t){return fu.apply(this,arguments)}function fu(){return fu=(0,b.A)(function*(o,e,t){const n=yield Vp(o,t);if(!n)return;const{attributeHost:i,attributeName:r}=n;i.getAttributeControl(r).markAsDirty(),i[r]=e}),fu.apply(this,arguments)}function RC(o,e){return _u.apply(this,arguments)}function _u(){return _u=(0,b.A)(function*(o,e){const t=yield Vp(o,e);if(!t)return;const{attributeHost:n,attributeName:i}=t,r=n.getAttributeControl(i);r.touched||(r.markAsTouched(),r.updateValueAndValidity())}),_u.apply(this,arguments)}const Lp="bindTo";class Bp{constructor(e){this.injector=e,this._loadingAttributeName="loading",this.bindingExpressionInterpreter=e.get(Wn),this.attrCtrlExpInterpreter=e.get(Nn),this.requestBindingConfigInterpreter=e.get(ss),this.validationBindingInterpreter=e.get(Zn),this._bindingContext=e.get($a,null),this._macrosHandlerService=e.get(Ri),this._isDesignTime=e.get(Zt,!1);const t=e.get(Q);this._isSafeBinding=!t.DisableSafePropertiesBinding,this._viewElementTypeResolver=e.get(ye)}_useMacros(e,t){if(!this._bindingContext)return t(e);let n;const i=new l.Subject,r=this._bindingContext.viewModel$.pipe((0,d.switchMap)(a=>this._macrosHandlerService.handleResourceMacros(e,a)),(0,d.map)((a,c)=>{n?.unsubscribe(),n=t(a),c===0&&n.ready.then(()=>{i.next(),i.complete()})}),(0,d.finalize)(()=>n?.unsubscribe())).subscribe();return new pe(r,(0,l.lastValueFrom)(i,{defaultValue:null}))}_bindLoadingProperty(e,t){if(Object.keys(e).some(c=>c===this._loadingAttributeName))return new pe;const i=(0,v.chain)(e).entries().filter(([c,h])=>this.isInputBinding(c,h,t,e)&&Ze(h)).value();if(!i.length)return new pe;const r=i.map(([c,h])=>z_(h)),a=fr(this._bindingContext).viewModel$.pipe((0,d.switchMap)(c=>{if(!c)return(0,l.of)();let h=[];const p=c.events$.pipe((0,d.filter)(f=>f.type===ue.StartLoadModelAttributes),(0,d.filter)(f=>{const C=Object.keys(f.payload);return r.some(S=>C.includes(S))}),(0,d.tap)(f=>{h=Object.keys(f.payload)}),(0,d.tap)(()=>t.setPropertyValue("loading",!0))),m=c.events$.pipe((0,d.filter)(f=>f.type===ue.FinishLoadModelAttributes),(0,d.filter)(f=>{const C=Object.keys(f.payload);return h.every(S=>C.includes(S))}),(0,d.tap)(()=>t.setPropertyValue("loading",!1)),(0,d.tap)(()=>h=[]));return(0,l.merge)(p,m)})).subscribe();return new pe(a)}_isControlProperty(e,t){const n=this._viewElementTypeResolver.getFormControlRelatesAttribute(t.type);return e===n}_getViewElementInputProperties(e){const t=this._viewElementTypeResolver.getViewElementRegistryItem(e.type);return t?[...Object.keys(t.inputs??{}).filter(n=>t.inputs[n].propertyBindable)]:["visible"]}_getViewElementEntries(e,t){const n=this._viewElementTypeResolver.getFormControlRelatesAttribute(t.type),i=e.find(([a])=>a===Lp);let r=e.filter(([a])=>a!==Lp);if(i){const[,a]=i;if(!a)return r;this._getViewElementInputProperties(t).forEach(h=>{if(h!==n){let p=a;p=`${p}:${h}`;const m=t[h];m!=null&&(p+=`=${m}`),r=r.filter(([f])=>f!==h),r.push([h,p])}})}return r}_bindInputWithValidation(e,t,n){const i=this.validationBindingInterpreter.evaluate(t,this._bindingContext).pipe((0,d.startWith)(null),(0,l.pairwise)()),r=TC(e),a=([c,h])=>{c?.value!==h?.value&&n.setPropertyValue(e,h.value),n.setPropertyValue(r,h?.validationInfo)};return pe.subscribe(i,a)}_bindFocusout(e,t){const n=t.getEvent("focusout"),i=e.slice(1),r=()=>RC(i,this._bindingContext);return pe.subscribe(n,r)}_bindInputs(e,t){const[n,i]=(0,v.chain)(e).entries().filter(([h,p])=>this.isInputBinding(h,p,t,e)&&!this.isTwoWayBinding(h,p,t,e)).partition(([,h])=>Ze(h)).value();i.forEach(([h,p])=>{p=this._isControlProperty(h,e)?new wt.FormControl(p):p,t.setPropertyValue(h,p)});const a=this._getViewElementEntries(n,e).map(([h,p])=>{const C=(this._isControlProperty(h,e)?this.attrCtrlExpInterpreter:this.bindingExpressionInterpreter).evaluate(p,this._bindingContext);if(Np(e.type,h)&&fa(p))return this._bindInputWithValidation(h,p,t);{const S=w=>t.setPropertyValue(h,w);return pe.subscribe(C,S,!1)}}),c=this._bindLoadingProperty(e,t);return pe.all([...a,c])}_createRequest(e,t){const n={...this._bindingContext,initialEvent:t};return this.requestBindingConfigInterpreter.evaluate(e,n).pipe((0,d.map)(i=>({...i,$initialEvent:t})))}_bindOutputSafely(e,t,n){const i=e.getEvent(t),r=fr(this._bindingContext).viewModel$.pipe((0,d.switchMap)(c=>c._destroy$)),a=c=>(0,l.lastValueFrom)(this._createRequest(n,c).pipe((0,d.switchMap)(h=>h.$context.executeRequest(h)),(0,d.takeUntil)(r))).catch(()=>null);return pe.subscribe(i,a)}_bindOutputUnsafely(e,t,n){const i=e.getEvent(t).pipe((0,d.switchMap)(a=>this._createRequest(n,a))),r=a=>a.$context.executeRequest(a);return pe.subscribe(i,r)}_bindOutput(e,t,n){return this._isSafeBinding?this._bindOutputSafely(e,t,n):this._bindOutputUnsafely(e,t,n)}_bindOutputs(e,t){const i=Object.entries(e).filter(([r,a])=>this.isOutputBinding(r,a,t,e)).map(([r,a])=>this._bindOutput(t,r,a));return pe.all(i)}_bindTwoWays(e,t){const n=Object.entries(e).filter(([r,a])=>this.isTwoWayBinding(r,a,t,e)),i=[];return n.forEach(([r,a])=>{const c=this.bindingExpressionInterpreter.evaluate(a,this._bindingContext),h=E=>t.setPropertyValue(r,E);Np(e.type,r)&&fa(a)?i.push(this._bindInputWithValidation(r,a,t)):i.push(pe.subscribe(c,h));const p=a.slice(1),m=mu(r),f=this.getViewEventsStream(t,m),C=E=>OC(p,E,this._bindingContext),S=pe.subscribe(f,C);i.push(S);const w=this._bindFocusout(a,t);i.push(w)}),pe.all(i)}isInputBinding(e,t,n,i){return hu(i.type,e)}isOutputBinding(e,t,n,i){return pu(i.type,e)}isTwoWayBinding(e,t,n,i){const r=mu(e);return fa(t)&&hu(i.type,e)&&pu(i.type,r)&&!(r in i)}bind(e,t){const n=i=>pe.all([this._bindInputs(i,e),this._bindOutputs(i,e),this._bindTwoWays(i,e)]);return this._isDesignTime?this._useMacros(t,n):n(t)}}class Fp extends Bp{isInputBinding(e,t,n,i){return super.isInputBinding(e,t,n,i)||!this.isOutputBinding(e,t,n,i)}isOutputBinding(e,t,n,i){return super.isOutputBinding(e,t,n,i)||n.getPropertyValue(e)instanceof s.EventEmitter}getViewEventsStream(e,t){return e.getEvent(t)}}class zp{constructor(e,t,n,i,r,a,c){this._componentRef=e,this._inputs=t,this._ngZone=i,this._changeDetectorRef=r,this.nativeElement=a,this.hostView=c,this._propertyValues=new Map,this.instance=n;const h=this._componentRef.injector.get(Q,null);this._enableInstanceValueSetFeature=h?.["ComponentViewElementRef.EnableInstanceValueSet"]}setValue(e,t){if(this._inputs?.[e])this._componentRef.setInput(e,t);else if(this._enableInstanceValueSetFeature)(0,v.set)(this.instance,e,t);else{const n=["selected","layoutConfig","dragging","currentLayoutConfig"];if(e in this.instance&&!n.includes(e)){const i=this._componentRef.componentType.name;let r=`Can't set value of the '${e}' input on the '${i}' component. `;r+=`Make sure that the '${e}' property is annotated with @Input() or a mapped @Input('${e}') exists.`,console.error(r)}}this._changeDetectorRef.detectChanges()}getPropertyValue(e){return(0,v.get)(this.instance,e)}getEvent(e){const t=this.getPropertyValue(e);return!t&&this.nativeElement?(0,l.fromEvent)(this.nativeElement,e):t}on(e,t){const i=this.getEvent(e).subscribe(t);return()=>{i.unsubscribe()}}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this._ngZone.run(()=>this.setValue(e,t)))}destroy(){this.hostView?.destroy(),this._componentRef?.destroy(),this.nativeElement=null}}class jC{constructor(e,t){this._ngZone=t,this._propertyValues=new Map,this.instance=e}setValue(e,t){(0,v.set)(this.instance,e,t)}getPropertyValue(e){return(0,v.get)(this.instance,e)}getEvent(e){return this.getPropertyValue(e)}on(e,t){const i=this.getPropertyValue(e).subscribe(t);return()=>{i.unsubscribe()}}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this._ngZone.run(()=>this.setValue(e,t)))}destroy(){this.instance=null}}var It;(function(o){o.Default="default",o.OnViewport="on-viewport"})(It||(It={}));class kC extends Bp{getViewEventsStream(e,t){return e.getEvent(t).pipe((0,l.map)(n=>n.detail))}}class Up{constructor(e){this.injector=e}}const rs=new s.InjectionToken("CRT_VIEW_ELEMENT_CONFIG");class NC{constructor(e){this._propertyValues=new Map,this.instance=e}getPropertyValue(e){return this.instance[e]}getEvent(e){return(0,l.fromEvent)(this.instance,e)}on(e,t){return this.instance.addEventListener(e,t),()=>this.instance.removeEventListener(e,t)}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this.instance[e]=t)}destroy(){}}class VC extends Up{createComponent(e){const t=this.injector.get(ye),n=this.injector.get(s.Renderer2),i=this.injector.get(s.ViewContainerRef),r=this.injector.get(rs),a=t.getSelector(r.type),c=document.createElement(a);return e?.forEach(({name:h,value:p})=>{n.setAttribute(c,h,p)}),n.appendChild(i.element.nativeElement.parentElement,c),this._initDirectionality(c),new NC(c)}_initDirectionality(e){this.injector.get(Ie.Directionality)?.value==="rtl"&&e.setAttribute("dir","rtl")}}class $p extends Up{createComponent(e){const t=this.injector.get(ye),n=this.injector.get(rs),i=t.getViewElementType(n);if(!i)throw new Error(`Component for type ${n.type} not found`);const r=this.injector.get(s.ViewContainerRef),a=this.injector.get(s.Renderer2),c=t.getCrtInputs(n.type),h=r.createComponent(i,{index:0,injector:this.injector});e?.forEach(({name:C,value:S})=>{a.setAttribute(h.location.nativeElement,C,S)});const p=h.injector.get(s.ChangeDetectorRef),m=h.injector.get(s.ElementRef).nativeElement;h.changeDetectorRef.detectChanges();const f=this.injector.get(s.NgZone);return new zp(h,c,h.instance,f,p,m,h.hostView)}}class LC{}const Gp=new s.InjectionToken("VIEW_ELEMENT_COMPONENT_CREATOR");class Hp extends LC{constructor(e){super(),this.injector=e,this.viewElementConfig=this.injector.get(rs),this.featureValues=this.injector.get(Q,{optional:!0}),this.measurePerformanceService=this.injector.get(q),this._componentCreator=this.injector.get(Gp)}_getElementName(){return`${this.viewElementConfig.type.split(".")?.[1]} ${this.viewElementConfig.name}`}_getDOMAttributes(){const e=[];return this.featureValues?.UseViewElementDataItemMarker&&e.push({name:"data-item-marker",value:this.viewElementConfig.dataItemMarker||this.viewElementConfig.name}),e}createComponent(e){return this._componentCreator.createComponent(e)}getComponentRef(){const e=this._getElementName(),t=this._getDOMAttributes();return this.measurePerformanceService.measure(e,()=>this.createComponent(t))}show(){const e=this.getComponentRef();return(0,l.of)(e)}hide(){}}class BC extends Hp{constructor(e,t,n){super(e),this.injector=e,this._creator=t,this._destroyed=n,this._renderer=this.injector.get(s.Renderer2),this._container=this.injector.get(s.ViewContainerRef),this._resolver=this.injector.get(ye),this._initMinHeight(),this._subscribeDestroyed()}get _parentElement(){return this._container.element.nativeElement.parentElement}_handleIntersection(e,t){if(this._parentElement){if(e&&!this._componentRef?.hostView){this._initResizeObservable(),t.next(this.getComponentRef()),t.complete();return}this._componentRef?.hostView&&(e?this._showElement():this._hideElement())}}_initIntersectionObserver(e){let t=this.viewElementConfig.selected;this._intersectionObserver=new IntersectionObserver(n=>{n.forEach(i=>{t?t=!1:this._handleIntersection(i.isIntersecting,e)})}),this._intersectionObserver.observe(this._parentElement),t&&this._handleIntersection(!0,e)}_initResizeObservable(){this._resizeObserver||(this._resizeObserver=new ResizeObserver(e=>{const{height:t,width:n}=e[0].contentRect;this._minHeight=`${t}px`,this._minWidth=`${n}px`}),this._resizeObserver.observe(this._parentElement))}_showElement(){this._display?this._renderer.setStyle(this._componentRef.nativeElement,"display",this._display):this._renderer.removeStyle(this._componentRef.nativeElement,"display"),this._removeMinSize()}_hideElement(){this._applyMinSize(),this._display=this._componentRef.nativeElement?.style.display,this._renderer.setStyle(this._componentRef.nativeElement,"display","none")}_removeMinSize(){this._renderer.removeStyle(this._parentElement,"min-height"),this._minWidth&&this._renderer.removeStyle(this._parentElement,"min-width")}_applyMinSize(){this._renderer.setStyle(this._parentElement,"min-height",this._minHeight),this._minWidth&&this._renderer.setStyle(this._parentElement,"min-width",this._minWidth)}_initMinHeight(){const e=this._resolver.getViewElementRegistryItem(this.viewElementConfig.type);e?e.renderStrategy===It.OnViewport&&(this._minHeight=e.placeholderSize.height):console.warn(`View element with type "${this.viewElementConfig.type}" not found`)}_subscribeDestroyed(){this._destroyed?.subscribe(()=>{const e=this._componentRef?.hostView;e&&!e.destroyed&&(e.detach(),e.destroy()),this._componentRef&&(this._componentRef.instance=null),this._componentRef=null,this._container.detach(),this._container.clear(),this._container=null,this._resizeObserver?.disconnect(),this._intersectionObserver?.disconnect()})}createComponent(e){return this._componentRef=this._creator.createComponent(e),this._removeMinSize(),this._componentRef}show(){return this._applyMinSize(),new l.Observable(e=>{this._initIntersectionObserver(e)})}hide(){this._resizeObserver?.disconnect(),this._intersectionObserver?.disconnect()}}const Wp=new s.InjectionToken("COMPONENT_PROPERTIES_BINDER"),Zp=new s.InjectionToken("DIRECTIVE_PROPERTIES_BINDER"),Yp=new s.InjectionToken("VIEW_ELEMENT_RENDER_STRATEGY"),yu=new s.InjectionToken("VIEW_ELEMENT_RENDER_STRATEGY_VALUE"),FC=function(o){const e=o.get(rs);return o.get(ye).getSelector(e.type)},Cu=function(o){return!!FC(o)},zC=function(o){return o.get(Q,{optional:!0})},UC=function(o){return o.get(Zt,!1)},$C=function(o){return Cu(o)?new kC(o):new Fp(o)},GC=function(o){return Cu(o)?new VC(o):new $p(o)},HC=function(o,e){const t=o.get(yu)||It.Default,i={[It.Default]:Kp,[It.OnViewport]:KC}[t];if(!i)throw new Error(`Unsupported render strategy type: ${t}`);return i(o,e)},WC=function(o,e){return o||e},Kp=function(o){return new Hp(o)},ZC=function(o){return zC(o).UseLazyComponentCreationInDesignTime},YC=function(o){const e=o.get(rs);return o.get(ye).getViewElementRegistryItem(e.type)?.renderStrategy===It.Default},KC=function(o,e){const t=YC(o),n=ZC(o),i=Cu(o),r=!UC(o);return t||i||r||!n?Kp(o):new BC(o,new $p(o),e)},JC=new s.InjectionToken("Ignore view elements not found warning");class Pe{constructor(e,t,n,i,r,a){this._resolver=e,this.parentDirective=t,this.injector=n,this._container=i,this._isDesignTime=r,this._ngZone=a,this._ownProperties=[{property:"visible",defaultValue:!0,omitForViewModelBinding:!0},{property:"bindTo",defaultValue:null,omitForViewModelBinding:!1}],this._destroyed$=new l.Subject,this._showElementSubscription=new l.Subscription,this._bindingContext=null,this._isCreating=!1,this._visible=!1,this._schemaAnalysisUtils=(0,s.inject)(Xr),this._componentRefSubject=new l.ReplaySubject(1),this._visibilitySubject=new l.ReplaySubject(1),this.visibilityChanged=(0,Yr.outputFromObservable)(this._visibilitySubject.asObservable().pipe((0,d.distinctUntilChanged)(),(0,d.takeUntil)(this._destroyed$))),this.componentRef$=this._componentRefSubject.asObservable().pipe((0,d.distinctUntilChanged)(),(0,d.takeUntil)(this._destroyed$)),this.nested=[],this.total=0,this.viewElementShow=new s.EventEmitter,this._featureValues=(0,s.inject)(Q,{optional:!0}),this._shouldLoadLazyModules=!this._featureValues.DisableLoadingLazyModulesFromViewElementDirective,this._measurePerformanceService=(0,s.inject)(q),this._directiveRef=new jC(this,this._ngZone)}get visible(){return this._visible}set visible(e){this._visible=e,this._setViewElementVisibility(e||this._isDesignTime)}_bindSelfToViewModel(){const e=this._ownProperties.reduce((t,{property:n,defaultValue:i})=>({...t,[n]:this.viewElementConfig[n]??i}),{});this._ngZone.runOutsideAngular(()=>this.bindDirectiveProperties(e))}_bindComponentToViewModel(){const e=(0,v.omit)(this.viewElementConfig,...this._ownProperties.filter(({omitForViewModelBinding:t})=>t===!0).map(({property:t})=>t));this._ngZone.runOutsideAngular(()=>this.bindComponentProperties(e))}_setViewElementVisibility(e){e&&!this.componentRef?this._showViewElement():!e&&this.componentRef&&this._hideViewElement(),this._visibilitySubject.next(!!e)}_setComponentRef(e){this.componentRef=e,this._componentRefSubject.next(e)}_showViewElement(){const e=this.viewElementConfig.type;if(this._typeName=e,!!this._typeName)if(this._resolver.canResolve(e))this._showComponent();else{if(this.injector.get(JC,!1))return;const n=this._container.createComponent(Li);n.instance.caption=e;const i=n.injector.get(s.ElementRef).nativeElement,r=this._resolver.getCrtInputs(e);console.warn(`View element with type "${e}" not found`),this._setComponentRef(new zp(n,r,n.instance,this._ngZone,n.changeDetectorRef,i,n.hostView))}}_getLazyModuleRefs(e){return this._measurePerformanceService.measure("ViewElementDirective.SEARCHING_SCHEMA_LAZY_ITEMS",()=>{const t=this._schemaAnalysisUtils.getUsedItemsInViewConfig(this.viewElementConfig);return this._schemaAnalysisUtils.getLazyModuleRefs(t,{requestScopes:e?._scopes})})}_getInjectionContext(e){const t=e;return t._injectionContext||Er(t)._injectionContext}_addLazyModulesToContext(e,t){const n=this._getInjectionContext(e);for(const i of t)n.addLazyModule(i);vh(n)}_loadLazyModules(){return this._shouldLoadLazyModules?this._featureValues.DisableFreedomUiLazyLoading?(0,l.from)(ch.instance.loadAll()):(this._bindingContext?.viewModel$??(0,l.of)(null)).pipe((0,d.switchMap)(t=>{const n=this._getLazyModuleRefs(t);if(n.size===0||t?._destroyed)return(0,l.of)(void 0);const i=(0,l.from)(Promise.all(Array.from(n,r=>r.loadAndBootstrap())));return t?i.pipe((0,d.map)(r=>yh(r)),(0,d.tap)(r=>this._addLazyModulesToContext(t,r))):i}),(0,d.take)(1),this._measurePerformanceService.measure$("ViewElementDirective.LOADING_SCHEMA_LAZY_ITEMS")):(0,l.of)(void 0)}_showComponent(){this._isCreating||(this._isCreating=!0,this._renderStrategyInstance&&this._renderStrategyInstance.hide(),this._renderStrategyInstance=this.injector.get(Yp),this._showElementSubscription.add(this._loadLazyModules().pipe((0,d.switchMap)(()=>this._renderStrategyInstance.show()),(0,d.filter)(e=>!!e)).subscribe(e=>{this._setComponentRef(e),this._measurePerformanceService.measure(`binding ${this.viewElementConfig.name}`,()=>this._bindComponentToViewModel()),this.viewElementShow.emit(this),this._isCreating=!1,this._featureValues?.UseMeasurePerformanceTools&&this._measurePerformanceService.rendering$.next()})))}_hideViewElement(){this._componentBinding?.unsubscribe(),this._showElementSubscription.unsubscribe(),this._renderStrategyInstance.hide(),this._container.clear(),this.componentRef?.destroy(),this._setComponentRef(null)}bindDirectiveProperties(e){this._directiveBinding?.unsubscribe(),this._directiveBinding=this._directivePropertiesBinder.bind(this._directiveRef,e)}bindComponentProperties(e){this._componentBinding?.unsubscribe(),this.componentRef&&(this._componentBinding=this._componentPropertiesBinder.bind(this.componentRef,e))}updateViewElementConfig(e){this.viewElementConfig=e,this._bindSelfToViewModel(),this._bindComponentToViewModel()}ngOnInit(){this._shouldLoadLazyModules&&(this._bindingContext=this.injector.get($a,null)),this._directivePropertiesBinder=this.injector.get(Zp),this._componentPropertiesBinder=this.injector.get(Wp),this.parentDirective&&this.parentDirective.attachNested(this),this._bindSelfToViewModel()}attachNested(e){this.nested.push(e)}detachNested(e){this.nested.splice(this.nested.indexOf(e),1)}ngOnDestroy(){this.parentDirective&&this.parentDirective.detachNested(this),this.nested.forEach(e=>e.ngOnDestroy()),this.componentRef?.destroy(),this._setComponentRef(null),this.viewElementConfig=null,this._componentBinding?.unsubscribe(),this._directiveBinding?.unsubscribe(),this._showElementSubscription.unsubscribe(),this._container.clear(),this._directiveRef.destroy(),this._renderStrategyInstance=null,this._componentRefSubject.complete(),this._visibilitySubject.complete(),this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Pe)(s.\u0275\u0275directiveInject(ye),s.\u0275\u0275directiveInject(Pe,12),s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(s.ViewContainerRef),s.\u0275\u0275directiveInject(Zt,8),s.\u0275\u0275directiveInject(s.NgZone))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:Pe,selectors:[["","crtViewElement",""]],inputs:{viewElementConfig:[0,"crtViewElement","viewElementConfig"],renderStrategy:"renderStrategy",visible:"visible"},outputs:{visibilityChanged:"visibilityChanged",viewElementShow:"viewElementShow"},features:[s.\u0275\u0275ProvidersFeature([{provide:rs,useFactory:e=>e.viewElementConfig,deps:[(0,s.forwardRef)(()=>Pe)],multi:!1},{provide:Wp,useFactory:$C,deps:[s.Injector],multi:!1},{provide:Zp,useFactory:e=>new Fp(e),deps:[s.Injector],multi:!1},{provide:Gp,useFactory:GC,deps:[s.Injector],multi:!1},{provide:yu,useFactory:(e,t)=>WC(e.renderStrategy,t),deps:[(0,s.forwardRef)(()=>Pe),[new s.Inject(yu),new s.SkipSelf,new s.Optional]],multi:!1},{provide:Yp,useFactory:(e,t)=>HC(e,t._destroyed$),deps:[s.Injector,(0,s.forwardRef)(()=>Pe)],multi:!1},...Rp])]})}}class Qr{constructor(){this._viewElementTypeResolver=(0,s.inject)(ye)}_updateAttributeProperties(e,t,n,i){const r=e[t]||{},a={};i.forEach(p=>{let m=p.defaultValue;Object.prototype.hasOwnProperty.call(n,p.name)&&(m=n[p.name]??p.defaultValue),a[p.name]={defaultValue:m}});const c=this._viewElementTypeResolver.getViewElementInputs(n.type);Object.entries(c).filter(([,p])=>p.propertyName!=null).forEach(([p,m])=>{a[m.propertyName]={defaultValue:p,locked:!0}}),r.properties={...r.properties??{},...a}}updateAttributeProperties(e,t,n){const i=e.bindTo.replace("$",""),r=t?.viewModelConfig?.attributes||{};this._updateAttributeProperties(r,i,e,n)}updateCollectionAttributeProperties(e,t,n,i){const r=e.bindTo.replace(`${n}.`,""),a=n.replace("$",""),h=(t?.viewModelConfig?.attributes||{})[a];if(!h)return;const p=h?.viewModelConfig?.attributes;p&&this._updateAttributeProperties(p,r,e,i)}static{this.\u0275fac=function(t){return new(t||Qr)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Qr,factory:Qr.\u0275fac})}}const Jp="bindTo",qC="visible";class eo{constructor(){this._viewElementTypeResolver=(0,s.inject)(ye)}_getViewElementInputProperties(e){const t=this._viewElementTypeResolver.getViewElementRegistryItem(e.type);return[...Object.keys(t.inputs??{}).filter(n=>t.inputs[n].propertyBindable),qC]}createLayoutConfigComponentParts(e,t,n){for(const[i,r]of Object.entries(t))n.attributes["layout-config-"+(0,v.kebabCase)(i)]={value:r}}createVisibleComponentPartsWrapper(e,t,n,i){const r=Ze(t);let a=t;const c=[];r&&(a=t,c.push({name:"crtBinding",arguments:[{value:e,propertyKey:this.getContextPropertyName(e+"|propertyName",n)},{value:i,propertyKey:this.getContextPropertyName(e+"|viewElementConfig",n)}]}));const h=n.directives.find(p=>p.selector==="crtIf");if(h)h.values.unshift({propertyKey:this.getContextPropertyName(e,n),value:a,pipes:c});else{const p={values:[{propertyKey:this.getContextPropertyName(e,n),value:a,pipes:c}],selector:"crtIf",useAsterisk:!0};this.addCrtIfDirectiveAdditionalInputs(p,i),n.directives.push(p)}return n}getContextPropertyName(e,t){return t.name+":"+e}getViewElementEntries(e){const t=this._viewElementTypeResolver.getFormControlRelatesAttribute(e.type),n=Object.entries(e),i=n.find(([a])=>a===Jp);let r=n.filter(([a])=>a!==Jp);if(i){const a=this._getViewElementInputProperties(e),[,c]=i;a.forEach(h=>{if(h!==t){const p=e[h];if(p==null||typeof p!="string"||typeof p=="string"&&!p.includes("|")){let m=c;m=`${m}:${h}`,p!=null&&(m+=`=${JSON.stringify(p)}`),r=r.filter(([f])=>f!==h),r.push([h,m])}}})}return r}addCrtIfDirectiveAdditionalInputs(e,{visibilityStrategyMode:t}){if(!t)return;const n=e.additionalInputs||[];n.push({propertyKey:"visibilityStrategyMode",value:t}),e.additionalInputs=[...n]}static{this.\u0275fac=function(t){return new(t||eo)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:eo,factory:eo.\u0275fac})}}class sn{static{this.\u0275fac=function(t){return new(t||sn)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:sn})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[ye,Qr,eo,...Rp],imports:[M.CommonModule,Vi,Yt,Yt]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(sn,{declarations:[Yn,Pe],imports:[M.CommonModule,Vi,Yt],exports:[Yn,Pe,Yt]})})();const XC="39px";function qp(o){(0,v.isEmpty)(o.renderStrategy)&&"placeholderSize"in o&&(o.renderStrategy=It.OnViewport),o.renderStrategy===It.OnViewport&&!o.placeholderSize&&(o.placeholderSize={height:XC})}var At;(function(o){o[o.Reuse=0]="Reuse",o[o.Rerender=1]="Rerender"})(At||(At={}));function Xp(o,e){return function(t){$_(o.type);const n=Xg(t),i=Qg(t),r=ef(t),a={...o,inputs:n,outputs:i,validationInputs:r},c="selector"in o?{...a,selector:o.selector}:{...a,typeRef:t};c.reuseStrategy=o?.reuseStrategy??At.Rerender,qp(c),e==="web"?Zg(c,t):Yg(c,t)}}function os(o){return Xp(o,"web")}var as;(function(o){o.Charts="Charts",o.Components="Components",o.LayoutElements="LayoutElements",o.Inputs="Inputs",o.CustomElements="CustomElements"})(as||(as={}));function QC(o,e){function t(){if(!o.typeCaption&&o.toolbarConfig){const n=Array.isArray(o.toolbarConfig)?o.toolbarConfig[0]:o.toolbarConfig;o.typeCaption=n.caption}}return function(n){o.typeRef=n,o.viewElementGroupType??=as.CustomElements,t(),qp(o),e==="mobile"?Jg(o,n):Kg(o,n)}}function bu(o){return QC(o,"web")}function A(o){return function(e,t){o||(o={propertyBindable:!1}),Reflect.defineMetadata(qc+t.toString(),o,e.constructor)}}function Za(){return function(o,e){Reflect.defineMetadata(Xc+e.toString(),{},o.constructor)}}function eb(o){return()=>y(34645)(`./${o}.json`)}var me;(function(o){o.None="none",o.Default="default",o.ExtraSmall="extra-small",o.Small="small",o.Medium="medium",o.Large="large",o.ExtraLarge="extra-large",o.X2Large="xxl",o.X3Large="xxxl"})(me||(me={}));const tb=Object.values(me);function Sw(o){return!!o&&typeof o=="string"&&tb.includes(o.toLowerCase())}var Pt;(function(o){o.OnlyText="only-text",o.LeftIcon="left-icon",o.RightIcon="right-icon",o.OnlyIcon="only-icon"})(Pt||(Pt={}));class nb{constructor(e){this.injector=e}}const ib=new s.InjectionToken("Add delay before enabling skeleton loader");class Le extends nb{set shape(e){this._shape=e;const t=this._classes.indexOf("crt-component-rounded");this.shape==="rounded"?t===-1&&this._classes.push("crt-component-rounded"):t>=0&&this._classes.splice(t,1)}get shape(){return this._shape}get classes(){return this.getClasses()}set classes(e){this.setClasses(e)}get loading(){return this._loading$.value}set loading(e){this._loading$.next(!!e),typeof e=="boolean"&&(e?this.handleStartLoadViewModelAttributes():this.handleFinishLoadViewModelAttributes())}constructor(e){super(e),this.injector=e,this._loading$=new l.BehaviorSubject(!1),this._classes=[],this.destroyed$=new l.Subject,this.loaderVisible=!1,this.documentDirection=null,this.documentDirection=e.get(Ie.Directionality)?.value==="rtl"?"rtl":null,this.changeDetectorRef=this.injector.get(s.ChangeDetectorRef),this.directionality=this.injector.get(Ie.Directionality),this.elementRef=this.injector.get(s.ElementRef),this._subscribeLoadingChanges()}_subscribeLoadingChanges(){const e=this.injector.get(ib,0,{optional:!0});this._loading$.pipe((0,d.switchMap)(t=>t?(0,l.of)(t).pipe((0,l.delay)(e)):(0,l.of)(t)),(0,d.tap)(t=>{this.loaderVisible=t,this.changeDetectorRef.markForCheck()}),(0,d.takeUntil)(this.destroyed$)).subscribe()}handleStartLoadViewModelAttributes(){}handleFinishLoadViewModelAttributes(){}setClasses(e){this._classes=e||[]}getClasses(){return this._classes}toggleClass(e,t,n){const i=e.indexOf(n);t&&i===-1&&e.push(n),!t&&i>=0&&e.splice(i,1)}switchClass(e,t,n){n.forEach(([i,r])=>{this.toggleClass(e,i===t,r)})}setValuesFromConfig(e,t=[]){const n=(0,v.omit)(e,["id","name","type",...t]);Object.entries(n).forEach(([i,r])=>{this[i]=r})}detectChanges(){this.changeDetectorRef.detectChanges()}isRtl(){return this.directionality.value==="rtl"}focus(){this.elementRef?.nativeElement.focus()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Le)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:Le,hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275attribute("element-name",n.name)("dir",n.documentDirection)},inputs:{name:"name",id:"id",tabIndex:"tabIndex",styles:"styles",shape:"shape",classes:"classes",loading:"loading"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],Le.prototype,"name",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],Le.prototype,"id",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Number)],Le.prototype,"tabIndex",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],Le.prototype,"styles",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],Le.prototype,"shape",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Array),(0,u.__metadata)("design:paramtypes",[Array])],Le.prototype,"classes",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean),(0,u.__metadata)("design:paramtypes",[Boolean])],Le.prototype,"loading",null);const Mw=null,to={type:"animation",width:"32px",height:"32px",autoplay:!0,loop:!0},ww="Components.Button.DefaultActionNotificationMessageText",sb=["buttonElement"],rb=["menuViewElement"];class $ extends Le{get _buttonElement(){return this.buttonElementRef?.nativeElement}set icon(e){this._icon=e,this.isIconAnimated&&this._buildIconAnimationConfig()}get icon(){return this.getIcon()}set size(e){!e||e===me.Default?this._size=me.Large:this._size=e}get size(){return this._size}set iconSize(e){!e||e===me.Default?this._iconSize=me.Large:this._iconSize=e}get iconSize(){return this._iconSize}set attributes(e){this._attributes=e,this._setAttributes()}get attributes(){return this._attributes}set type(e){e&&e!=="button"&&e!=="reset"&&e!=="submit"||(this._type=e)}get type(){return this._type}set disableRipple(e){this._disableRipple=e===!0}get disableRipple(){return this._disableRipple||this._displayType==="text"}set clickMode(e){this._clickMode=e||"default"}get clickMode(){return this._clickMode}get menuItems(){return this._menuItems}set menuItems(e){this._menuItems=Array.isArray(e)?e:[],this._updateMenuViewConfig()}get showMenuItems(){return this.menuItems?.length>0}set useGlassmorphism(e){const t=e===!0;this._useGlassmorphism!==t&&(this._useGlassmorphism=t,this._updateMenuViewConfig())}get useGlassmorphism(){return this._useGlassmorphism}set menuPanelClass(e){this._menuPanelClass!==e&&(this._menuPanelClass=e,this._updateMenuViewConfig())}get menuPanelClass(){return this._menuPanelClass}set color(e){this.colorThemePalette=this._getColorTheme(e)}set displayType(e){this._displayType=e}get displayType(){return this._displayType||"contained"}set menuViewElementDirective(e){e&&(this._menuViewElementDirective=e,this._menuViewElementDirective.componentRef$.pipe((0,Yr.takeUntilDestroyed)(this._destroyRef)).subscribe(t=>{this._menuComponent=t?.instance,this._syncMenuComponentProperties()}))}constructor(e){super(e),this._isIconModeSizePx=40,this._renderer=(0,s.inject)(s.Renderer2),this._destroyRef=(0,s.inject)(s.DestroyRef),this._type="button",this._size=me.Large,this._iconSize=me.Large,this._displayType="contained",this._disableRipple=!1,this._menuItems=[],this._clickMode="default",this._menuViewElementName=`crt-base-button-menu-${L()}`,this._useGlassmorphism=!1,this.skeletonStyles={height:"36px",width:"120px"},this.isMenuOpened=!1,this.caption="",this.iconPosition=Pt.RightIcon,this.title="",this.isIconModeSizePx=this._isIconModeSizePx,this.contentAlign="center",this.displayMenuIcon=!1,this.clicked=new s.EventEmitter,this.focused=new s.EventEmitter,this.blurred=new s.EventEmitter,this._updateMenuViewConfig()}get isIconVisible(){return!!this.icon&&this.iconPosition!==Pt.OnlyText}get isTextVisible(){return!this.isIconMode&&this.iconPosition!==Pt.OnlyIcon}get isMenuIconVisible(){return this.displayMenuIcon||this.isTextVisible}get iconClasses(){return this._getIconClasses()}get contentAlignClasses(){return this._getContentAlignClasses()}get menuDisabled(){return this.allowMenuOnDisabled?!1:this.disabled}get isIconAnimated(){return typeof this._icon=="string"?!1:!!(this._icon?.name||this._icon?.animationData)}get menuViewConfig(){return this._menuViewConfig}get menuComponent(){return this._menuComponent??null}_buildIconAnimationConfig(){const{name:e,loop:t,autoplay:n,width:i,height:r,animationData:a}=this.icon;this.animationIconConfig={...to,autoplay:typeof n=="boolean"?n:to.autoplay,loop:typeof t=="boolean"?t:to.loop,width:i||to.width,height:r||to.height,animationData:a||eb(e)}}_updateMenuViewConfig(){this._menuViewConfig?(this._menuViewConfig.items=this._menuItems,this._menuViewConfig.panelClass=this.menuPanelClass,this._menuViewConfig.useGlassmorphism=this.useGlassmorphism):this._menuViewConfig={type:"crt.Menu",name:this._menuViewElementName,items:this._menuItems,panelClass:this.menuPanelClass,useGlassmorphism:this.useGlassmorphism},this._syncMenuComponentProperties()}_syncMenuComponentProperties(){this._menuComponent&&(this._menuComponent.items=this._menuItems,this._menuComponent.panelClass=this.menuPanelClass,this._menuComponent.useGlassmorphism=this.useGlassmorphism,this.detectChanges())}_getColorTheme(e){if(e!=="default")return e}_getIconClasses(){const e=[];return this.switchClass(e,this.iconSize,this.getIconSizeClassMap()),e}_getContentAlignClasses(){const e=[];return this.switchClass(e,this.contentAlign,[["start","button-content-align-start"],["center","button-content-align-center"],["end","button-content-align-end"]]),e}_setAttributes(){!this._attributes||!this._buttonElement||Object.entries(this._attributes).forEach(([e,t])=>{t==null?this._renderer.removeAttribute(this._buttonElement,e):this._renderer.setAttribute(this._buttonElement,e,t)})}getSizeClassMap(){return[[me.None,"button-size-none"],[me.Small,"button-size-small"],[me.Medium,"button-size-medium"],[me.Large,"button-size-large"],[me.ExtraLarge,"button-size-extra-large"]]}getIconSizeClassMap(){return[[me.Small,"button-icon-size-small"],[me.Medium,"button-icon-size-medium"],[me.Large,"button-icon-size-large"],[me.ExtraLarge,"button-icon-size-extra-large"]]}getClasses(){const e=super.getClasses();return this.switchClass(e,this.iconPosition,[[Pt.LeftIcon,"button-icon-position-left"],[Pt.RightIcon,"button-icon-position-right"],[Pt.OnlyIcon,"button-icon-position-only-icon"]]),this.switchClass(e,this._size,this.getSizeClassMap()),this.toggleClass(e,!!this.icon,"button-with-icon"),e}getIcon(){return this._icon}focus(){this._buttonElement?.focus()}getTitle(){return this.title?this.title:this.isIconMode||this.iconPosition===Pt.OnlyIcon?this.caption:null}isDividerShown(){return!!this.menuItems?.length&&this.clickMode==="default"&&this.isTextVisible}onMenuOpened(){this.isMenuOpened=!0}onMenuClosed(){this.isMenuOpened=!1}onClick(e){e?.stopPropagation(),e?.preventDefault(),!this.disabled&&this.clickMode==="default"&&this.clicked.next(e)}onFocus(e){this.focused.next(e)}onBlur(e){this.blurred.next(e)}ngAfterViewInit(){this.autofocus&&this.focus(),this._setAttributes()}static{this.\u0275fac=function(t){return new(t||$)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:$,viewQuery:function(t,n){if(t&1&&(s.\u0275\u0275viewQuery(sb,5,s.ElementRef),s.\u0275\u0275viewQuery(rb,5,Pe)),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.buttonElementRef=i.first),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.menuViewElementDirective=i.first)}},hostBindings:function(t,n){t&1&&s.\u0275\u0275listener("click",function(r){return n.onClick(r)})("focus",function(r){return n.onFocus(r)})("blur",function(r){return n.onBlur(r)})},inputs:{disabled:"disabled",autofocus:"autofocus",caption:"caption",icon:"icon",size:"size",iconSize:"iconSize",iconPosition:"iconPosition",ariaLabel:"ariaLabel",attributes:"attributes",title:"title",textTransform:"textTransform",type:"type",disableRipple:"disableRipple",isIconModeSizePx:"isIconModeSizePx",allowMenuOnDisabled:"allowMenuOnDisabled",clickMode:"clickMode",contentAlign:"contentAlign",menuItems:"menuItems",displayMenuIcon:"displayMenuIcon",useGlassmorphism:"useGlassmorphism",menuPanelClass:"menuPanelClass",pressed:"pressed",color:"color",displayType:"displayType"},outputs:{clicked:"clicked",focused:"focused",blurred:"blurred"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,u.__decorate)([A({propertyBindable:!0,defaultValue:!1,propertyName:Ki.Disabled}),(0,u.__metadata)("design:type",Boolean)],$.prototype,"disabled",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean)],$.prototype,"autofocus",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],$.prototype,"caption",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object),(0,u.__metadata)("design:paramtypes",[Object])],$.prototype,"icon",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"size",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"iconSize",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],$.prototype,"iconPosition",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],$.prototype,"ariaLabel",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object),(0,u.__metadata)("design:paramtypes",[Object])],$.prototype,"attributes",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],$.prototype,"title",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],$.prototype,"textTransform",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"type",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean),(0,u.__metadata)("design:paramtypes",[Boolean])],$.prototype,"disableRipple",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Number)],$.prototype,"isIconModeSizePx",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean)],$.prototype,"allowMenuOnDisabled",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"clickMode",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],$.prototype,"contentAlign",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Array),(0,u.__metadata)("design:paramtypes",[Array])],$.prototype,"menuItems",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],$.prototype,"displayMenuIcon",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean),(0,u.__metadata)("design:paramtypes",[Boolean])],$.prototype,"useGlassmorphism",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"menuPanelClass",null),(0,u.__decorate)([Za(),(0,u.__metadata)("design:type",Object)],$.prototype,"clicked",void 0),(0,u.__decorate)([Za(),(0,u.__metadata)("design:type",Object)],$.prototype,"focused",void 0),(0,u.__decorate)([Za(),(0,u.__metadata)("design:type",Object)],$.prototype,"blurred",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean)],$.prototype,"pressed",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"color",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],$.prototype,"displayType",null);var no=y(30421);class Kn extends le.MatMenuTrigger{set crtMenuTriggerFor(e){this._menuComponent=e,this.menu=e?.menu}set crtMenuTriggerData(e){this.menuData=e}set crtMenuTriggerRestoreFocus(e){this.restoreFocus=e}constructor(e,t,n,i,r,a,c,h){super(e,t,n,i,r,a,c,h),this._elementRef=t,this._internalFocusMonitor=h,this._isCrtButton=this._elementRef.nativeElement.localName==="crt-button",this._isCrtButton&&this._subscribeToMenuToggle()}_subscribeToMenuToggle(){(0,l.merge)(this.menuClosed,this.menuOpened).pipe((0,l.tap)(()=>this._setButtonAttribute("aria-expanded",this.menuOpen?"true":"false")),(0,Yr.takeUntilDestroyed)()).subscribe()}_setButtonAttribute(e,t){this._elementRef.nativeElement.getElementsByClassName("crt-button")[0]?.setAttribute(e,t)}onClick(e){this._triggeredTarget=e.currentTarget,super._handleClick(e)}focus(e,t){if(!this._triggeredTarget)return super.focus(e,t);this._internalFocusMonitor&&e&&this._internalFocusMonitor.focusVia(this._triggeredTarget,e,t),this._triggeredTarget=null}_handleClick(e){this._isCrtButton||super._handleClick(e)}openMenu(){if(this.crtMenuTriggerDisabled)return;this._menuComponent&&typeof this._menuComponent.setFocusOrigin=="function"&&this._menuComponent.setFocusOrigin(this._openedBy),super.openMenu()}ngAfterViewInit(){this._isCrtButton&&(this._setButtonAttribute("aria-expanded",this.menuOpen?"true":"false"),this._setButtonAttribute("aria-haspopup","menu"))}static{this.\u0275fac=function(t){return new(t||Kn)(s.\u0275\u0275directiveInject(no.Overlay),s.\u0275\u0275directiveInject(s.ElementRef),s.\u0275\u0275directiveInject(s.ViewContainerRef),s.\u0275\u0275directiveInject(le.MAT_MENU_SCROLL_STRATEGY),s.\u0275\u0275directiveInject(le.MAT_MENU_PANEL,8),s.\u0275\u0275directiveInject(le.MatMenuItem,10),s.\u0275\u0275directiveInject(Ie.Directionality,8),s.\u0275\u0275directiveInject(ai.FocusMonitor))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:Kn,selectors:[["","crtMenuTriggerFor",""]],hostBindings:function(t,n){t&1&&s.\u0275\u0275listener("clicked",function(r){return n.onClick(r)})},inputs:{crtMenuTriggerDisabled:"crtMenuTriggerDisabled",crtMenuTriggerFor:"crtMenuTriggerFor",crtMenuTriggerData:"crtMenuTriggerData",crtMenuTriggerRestoreFocus:"crtMenuTriggerRestoreFocus"},exportAs:["crtMenuTrigger"],features:[s.\u0275\u0275InheritDefinitionFeature]})}}const ob=["*"],Qp=o=>({$implicit:o});function ab(o,e){if(o&1&&s.\u0275\u0275element(0,"crt-skeleton-loader",8),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("styles",t.skeletonStyles)}}function cb(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function lb(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"button",10,3),s.\u0275\u0275listener("click",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(r.onClick(i))})("focus",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(r.onFocus(i))})("blur",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(r.onBlur(i))}),s.\u0275\u0275elementStart(3,"span",11),s.\u0275\u0275template(4,cb,1,0,"ng-container",12),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementContainerEnd()}if(o&2){let t;const n=s.\u0275\u0275nextContext(2),i=s.\u0275\u0275reference(4);s.\u0275\u0275advance(),s.\u0275\u0275styleProp("text-transform",n.textTransform),s.\u0275\u0275classProp("icon-mode",n.isIconMode)("crt-button--text",n.displayType==="text")("crt-button--contained",n.displayType==="contained"),s.\u0275\u0275property("color",n.colorThemePalette)("disabled",n.disabled)("disableRipple",n.disableRipple)("ngClass",n.classes),s.\u0275\u0275attribute("aria-label",n.ariaLabel||n.getTitle()||null)("aria-pressed",(t=n.pressed)!==null&&t!==void 0?t:null)("type",n.type)("tabIndex",n.tabIndex)("title",n.getTitle()),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngTemplateOutlet",i)}}function ub(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function db(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",14)(2,"button",15,3),s.\u0275\u0275listener("click",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(r.onClick(i))})("focus",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(r.onFocus(i))})("blur",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(r.onBlur(i))}),s.\u0275\u0275elementStart(4,"span",11),s.\u0275\u0275template(5,ub,1,0,"ng-container",12),s.\u0275\u0275element(6,"mat-divider",16),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(7,"button",17),s.\u0275\u0275listener("click",function(i){return s.\u0275\u0275restoreView(t),i.preventDefault(),s.\u0275\u0275resetView(i.stopPropagation())})("menuOpened",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(i.onMenuOpened())})("menuClosed",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(i.onMenuClosed())}),s.\u0275\u0275elementStart(8,"span",11),s.\u0275\u0275element(9,"mat-icon",18),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementContainer(10,13,5),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(o&2){const t=s.\u0275\u0275nextContext(3),n=s.\u0275\u0275reference(4);s.\u0275\u0275advance(2),s.\u0275\u0275styleProp("text-transform",t.textTransform),s.\u0275\u0275classProp("crt-button--text",t.displayType==="text")("crt-button--contained",t.displayType==="contained")("icon-mode",t.isIconMode),s.\u0275\u0275property("color",t.colorThemePalette)("disabled",t.disabled)("disableRipple",t.disableRipple)("ngClass",t.classes),s.\u0275\u0275attribute("aria-label",t.ariaLabel||t.getTitle()||null)("type",t.type)("tabIndex",t.tabIndex)("title",t.getTitle()),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngTemplateOutlet",n),s.\u0275\u0275advance(),s.\u0275\u0275property("vertical",!0),s.\u0275\u0275advance(),s.\u0275\u0275classProp("crt-button--text",t.displayType==="text")("crt-button--contained",t.displayType==="contained")("crt-button-menu-opened",t.isMenuOpened),s.\u0275\u0275property("ngClass",t.classes)("color",t.colorThemePalette)("disabled",t.menuDisabled)("disableRipple",t.disableRipple)("crtMenuTriggerFor",t.menuComponent)("crtMenuTriggerData",s.\u0275\u0275pureFunction1(32,Qp,t.menuItems)),s.\u0275\u0275attribute("aria-label",t.ariaLabel||t.caption||null),s.\u0275\u0275advance(3),s.\u0275\u0275property("crtViewElement",t.menuViewConfig)}}function hb(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function pb(o,e){o&1&&s.\u0275\u0275element(0,"mat-icon",18)}function mb(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",19,3),s.\u0275\u0275listener("menuOpened",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(i.onMenuOpened())})("menuClosed",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(3);return s.\u0275\u0275resetView(i.onMenuClosed())}),s.\u0275\u0275elementStart(2,"span",11),s.\u0275\u0275template(3,hb,1,0,"ng-container",12)(4,pb,1,0,"mat-icon",20),s.\u0275\u0275elementEnd()()}if(o&2){let t;const n=s.\u0275\u0275nextContext(3),i=s.\u0275\u0275reference(4);s.\u0275\u0275styleProp("text-transform",n.textTransform),s.\u0275\u0275classProp("crt-button--text",n.displayType==="text")("crt-button--contained",n.displayType==="contained")("crt-button-menu-opened",n.isMenuOpened)("icon-mode",n.isIconMode),s.\u0275\u0275property("color",n.colorThemePalette)("disabled",n.menuDisabled)("disableRipple",n.disableRipple)("ngClass",n.classes)("crtMenuTriggerFor",n.menuComponent)("crtMenuTriggerData",s.\u0275\u0275pureFunction1(23,Qp,n.menuItems)),s.\u0275\u0275attribute("aria-label",n.ariaLabel||n.getTitle()||null)("aria-pressed",(t=n.pressed)!==null&&t!==void 0?t:null)("type",n.type)("tabIndex",n.tabIndex)("title",n.getTitle()),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngTemplateOutlet",i),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.isMenuIconVisible)}}function gb(o,e){if(o&1&&(s.\u0275\u0275template(0,db,12,34,"ng-container",9)(1,mb,5,25,"ng-template",null,4,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementContainer(3,13,5)),o&2){const t=s.\u0275\u0275reference(2),n=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("ngIf",n.isDividerShown())("ngIfElse",t),s.\u0275\u0275advance(3),s.\u0275\u0275property("crtViewElement",n.menuViewConfig)}}function fb(o,e){if(o&1&&s.\u0275\u0275template(0,lb,5,18,"ng-container",9)(1,gb,5,3,"ng-template",null,2,s.\u0275\u0275templateRefExtractor),o&2){const t=s.\u0275\u0275reference(2),n=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngIf",!n.showMenuItems)("ngIfElse",t)}}function _b(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"span",25),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(3);s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1(" ",t.caption," ")}}function yb(o,e){o&1&&s.\u0275\u0275projection(0)}function Cb(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,_b,3,1,"ng-container",9)(2,yb,1,0,"ng-template",null,6,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275reference(3),n=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function bb(o,e){if(o&1&&s.\u0275\u0275element(0,"mat-icon",26),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("svgIcon",t.icon)("ngClass",t.iconClasses)}}function vb(o,e){if(o&1&&s.\u0275\u0275element(0,"crt-lottie",27),o&2){const t=s.\u0275\u0275nextContext(2);s.\u0275\u0275property("config",t.animationIconConfig)("width",t.animationIconConfig.width)("height",t.animationIconConfig.height)}}function Sb(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"span",21),s.\u0275\u0275template(1,Cb,4,2,"ng-container",22)(2,bb,1,2,"mat-icon",23)(3,vb,1,3,"crt-lottie",24),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngClass",t.contentAlignClasses),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t.isTextVisible),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t.isIconVisible&&!t.isIconAnimated),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t.isIconVisible&&t.isIconAnimated&&t.animationIconConfig)}}let rn=class Ic extends ${static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Ic)))(n||Ic)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ic,selectors:[["crt-button"]],features:[s.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:ob,decls:5,vars:2,consts:[["componentView",""],["defaultBtnContent",""],["btnWithMenu",""],["buttonElement",""],["btnWithMenuClickMode",""],["menuViewElement",""],["content",""],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],[4,"ngIf","ngIfElse"],["mat-flat-button","",1,"crt-button",3,"click","focus","blur","color","disabled","disableRipple","ngClass"],[1,"crt-button-inner-container"],[4,"ngTemplateOutlet"],[3,"crtViewElement"],[1,"crt-button-wrapper"],["mat-flat-button","",1,"crt-button","crt-button-with-menu","crt-menu-with-default-action",3,"click","focus","blur","color","disabled","disableRipple","ngClass"],[3,"vertical"],["mat-flat-button","",1,"crt-button","crt-button-menu-trigger-icon",3,"click","menuOpened","menuClosed","ngClass","color","disabled","disableRipple","crtMenuTriggerFor","crtMenuTriggerData"],["svgIcon","menu-arrow"],["mat-flat-button","",1,"crt-button","crt-button-with-menu",3,"menuOpened","menuClosed","color","disabled","disableRipple","ngClass","crtMenuTriggerFor","crtMenuTriggerData"],["svgIcon","menu-arrow",4,"ngIf"],[1,"btn-reversible-content",3,"ngClass"],[4,"ngIf"],["matSuffix","",3,"svgIcon","ngClass",4,"ngIf"],[3,"config","width","height",4,"ngIf"],[1,"crt-button-caption"],["matSuffix","",3,"svgIcon","ngClass"],[3,"config","width","height"]],template:function(t,n){if(t&1&&(s.\u0275\u0275projectionDef(),s.\u0275\u0275template(0,ab,1,1,"crt-skeleton-loader",7)(1,fb,3,2,"ng-template",null,0,s.\u0275\u0275templateRefExtractor)(3,Sb,4,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor)),t&2){const i=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",n.loading)("ngIfElse",i)}},dependencies:[te.MatButton,M.NgClass,M.NgIf,M.NgTemplateOutlet,Z.MatIcon,Gt,Ne.MatDivider,Kn,Di,Pe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{display:inline-block;height:fit-content;width:fit-content;max-width:100%}.crt-button[_ngcontent-%COMP%]{display:block;max-width:100%;min-width:0}.crt-button.button-size-none.mat-mdc-unelevated-button.mat-mdc-button-base[_ngcontent-%COMP%]{height:unset}.crt-button[_ngcontent-%COMP%]:focus-visible, .crt-button.cdk-keyboard-focused[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.crt-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:16px;width:16px;display:flex;min-width:8px;flex-shrink:0}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-small[_ngcontent-%COMP%]{height:8px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-medium[_ngcontent-%COMP%]{height:12px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-large[_ngcontent-%COMP%]{height:16px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-extra-large[_ngcontent-%COMP%]{height:24px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x2-large[_ngcontent-%COMP%]{height:32px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x3-large[_ngcontent-%COMP%]{height:40px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-small[_ngcontent-%COMP%]{width:8px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-medium[_ngcontent-%COMP%]{width:12px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-large[_ngcontent-%COMP%]{width:16px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-extra-large[_ngcontent-%COMP%]{width:24px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x2-large[_ngcontent-%COMP%]{width:32px}.crt-button[_ngcontent-%COMP%]   .mat-icon.button-icon-size-x3-large[_ngcontent-%COMP%]{width:40px}.crt-button.icon-mode[_ngcontent-%COMP%]{width:100%;padding:0 4px}.crt-button.crt-button-with-menu.crt-button--contained[_ngcontent-%COMP%]{padding-inline-end:8px}.crt-button.crt-button-with-menu.crt-button--contained.crt-menu-with-default-action[_ngcontent-%COMP%]{padding:0;margin-inline-end:-2px}.crt-button.crt-button-with-menu.crt-button--contained.crt-menu-with-default-action[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin-inline-end:2px}.crt-button.crt-button-with-menu.crt-button--contained.crt-menu-with-default-action[_ngcontent-%COMP%]   .btn-reversible-content[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0;padding-inline-start:16px;padding-inline-end:8px}.crt-button.crt-button-with-menu.crt-button--contained[_ngcontent-%COMP%]:not(.button-icon-position-only-icon)   .btn-reversible-content[_ngcontent-%COMP%]{padding-inline-end:8px}.crt-button.crt-button-with-menu.crt-button--text.crt-menu-with-default-action[_ngcontent-%COMP%]{padding:0;margin-inline-end:-2px}.crt-button.crt-button-with-menu.crt-button--text.crt-menu-with-default-action[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{margin-inline-end:2px}.crt-button.crt-button-with-menu.crt-button--text.crt-menu-with-default-action[_ngcontent-%COMP%]   .btn-reversible-content[_ngcontent-%COMP%]{padding-inline-end:4px}.crt-button.crt-button-with-menu.crt-button--text[_ngcontent-%COMP%]:not(.button-icon-position-only-icon)   .btn-reversible-content[_ngcontent-%COMP%]{padding-inline-end:8px}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content.button-content-align-start[_ngcontent-%COMP%]{justify-content:start}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content.button-content-align-center[_ngcontent-%COMP%]{justify-content:center}.crt-button[_ngcontent-%COMP%]   .btn-reversible-content.button-content-align-end[_ngcontent-%COMP%]{justify-content:end}.crt-button.crt-button--text[_ngcontent-%COMP%]{padding:0}.crt-button[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{border-color:currentColor;border-width:1px;height:16px}.crt-button.button-size-small[_ngcontent-%COMP%]{line-height:18px}.crt-button.button-size-medium[_ngcontent-%COMP%]{line-height:24px}.crt-button.button-size-large[_ngcontent-%COMP%]{line-height:32px}.crt-button.button-size-extra-large[_ngcontent-%COMP%]{line-height:40px}.crt-button.button-size-x2-large[_ngcontent-%COMP%]{line-height:48px}.crt-button.button-size-x3-large[_ngcontent-%COMP%]{line-height:56px}.crt-button.button-size-small[_ngcontent-%COMP%]{height:18px}.crt-button.button-size-medium[_ngcontent-%COMP%]{height:24px}.crt-button.button-size-large[_ngcontent-%COMP%]{height:32px}.crt-button.button-size-extra-large[_ngcontent-%COMP%]{height:40px}.crt-button.button-size-x2-large[_ngcontent-%COMP%]{height:48px}.crt-button.button-size-x3-large[_ngcontent-%COMP%]{height:56px}.crt-button.button-size-small[_ngcontent-%COMP%]{font-size:10px}.crt-button.button-size-medium[_ngcontent-%COMP%]{font-size:12px}.crt-button.button-size-large[_ngcontent-%COMP%], .crt-button.button-size-extra-large[_ngcontent-%COMP%]{font-size:14px}.crt-button.button-size-x2-large[_ngcontent-%COMP%]{font-size:48px}.crt-button.button-size-x3-large[_ngcontent-%COMP%]{font-size:56px}.crt-button.crt-button--contained.button-size-small[_ngcontent-%COMP%]{padding:0 4px}.crt-button.crt-button--contained.button-size-medium[_ngcontent-%COMP%]{padding:0 12px}.crt-button.crt-button--contained.button-size-large[_ngcontent-%COMP%], .crt-button.crt-button--contained.button-size-extra-large[_ngcontent-%COMP%]{padding:0 16px}.crt-button.crt-button--contained.button-size-x2-large[_ngcontent-%COMP%]{padding:48px}.crt-button.crt-button--contained.button-size-x3-large[_ngcontent-%COMP%]{padding:56px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-small[_ngcontent-%COMP%]{padding:0 5px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-medium[_ngcontent-%COMP%]{padding:0 6px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-large[_ngcontent-%COMP%], .crt-button.crt-button--contained.button-icon-position-only-icon.button-size-extra-large[_ngcontent-%COMP%]{padding:0 8px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-x2-large[_ngcontent-%COMP%]{padding:48px}.crt-button.crt-button--contained.button-icon-position-only-icon.button-size-x3-large[_ngcontent-%COMP%]{padding:56px}.crt-button[_ngcontent-%COMP%]   .crt-button-caption[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.crt-button-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.crt-button-wrapper[_ngcontent-%COMP%]   .crt-button.crt-button--contained.crt-button-menu-trigger-icon[_ngcontent-%COMP%]{width:32px;padding:0 8px}.crt-button-wrapper[_ngcontent-%COMP%]   .crt-button.crt-button--text.crt-button-menu-trigger-icon[_ngcontent-%COMP%]{padding-inline-start:4px}"],changeDetection:0})}};rn=(0,u.__decorate)([os({type:"crt.Button",reuseStrategy:At.Reuse}),bu({toolbarConfig:{position:10,icon:y(19127),defaultPropertyValues:{caption:"",color:"default",disabled:!1},defaultLocalizableStrings:{caption:"Components.Button.Caption"}},propertiesPanelComponentTypeName:"crt.ButtonPropertiesPanel",collectionPropertyNames:["menuItems"],typeCaption:"Components.Button.Caption",viewElementGroupType:as.Components})],rn);class io{constructor(e){this.viewContainerRef=e}static{this.\u0275fac=function(t){return new(t||io)(s.\u0275\u0275directiveInject(s.ViewContainerRef))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:io,selectors:[["","tsViewContainerRef",""]]})}}class cs{static{this.\u0275fac=function(t){return new(t||cs)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:cs})}static{this.\u0275inj=s.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(cs,{declarations:[io],exports:[io]})})();const Mb=["tooltipEl"],wb=o=>({rtl:o});class Tt{constructor(e,t){this._directionality=e,this._sanitizer=t,this._defaultCssClass="base-tooltip crt-base-tooltip"}setInnerHTML(){this.tooltipEl&&(this.tooltipEl.nativeElement.innerHTML=this._sanitizer.sanitize(s.SecurityContext.HTML,this._tooltipConfig?.value))}set tooltipConfig(e){this._tooltipConfig!==e&&(this._tooltipConfig=e)}get tooltipConfig(){return this._tooltipConfig}get cssClasses(){let e=this._tooltipConfig?.cssClasses||this._defaultCssClass;const t=typeof e=="string";return t&&(e=e.split(" ")),e.includes("base-tooltip")&&this._directionality.value==="rtl"&&!e.includes("base-tooltip_rtl")&&e.push("base-tooltip_rtl"),t?e.join(" "):e}isRtl(){return this._directionality.value==="rtl"}ngAfterViewInit(){this.setInnerHTML()}static{this.\u0275fac=function(t){return new(t||Tt)(s.\u0275\u0275directiveInject(Ie.Directionality),s.\u0275\u0275directiveInject(Fe.DomSanitizer))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Tt,selectors:[["crt-base-tooltip"]],viewQuery:function(t,n){if(t&1&&s.\u0275\u0275viewQuery(Mb,5,s.ElementRef),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.tooltipEl=i.first)}},inputs:{tooltipConfig:"tooltipConfig"},decls:3,vars:6,consts:[["tooltipEl",""],[1,"tooltip-value",3,"ngClass"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275element(1,"span",1,0),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275classMap(n.cssClasses),s.\u0275\u0275advance(),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(4,wb,n.isRtl())))},dependencies:[M.NgClass],styles:[".base-tooltip[_ngcontent-%COMP%]{max-width:320px;max-height:50vh;overflow-y:auto;overflow-x:auto;box-shadow:0 2px 4px #18181840;padding-left:8px;padding-right:8px;margin:10px;opacity:1;word-wrap:break-word}.base-tooltip_rtl[_ngcontent-%COMP%]{padding-left:0;padding-right:8px}.base-tooltip[_ngcontent-%COMP%]   .rtl[_ngcontent-%COMP%]{direction:rtl;text-align:right}  .base-tooltip img{max-width:100%;height:auto}"]})}}class so{constructor(e){this.showEvent="mouseenter",this.hideEvent="mouseleave",this.capture=!1,this.closeOnOutsideClick=!1,Nc.isMobile&&(e.closeOnOutsideClick=!0,e.showEvent="touchstart",e.hideEvent="touched"),Object.assign(this,e)}}var xb=y(36931),on=y(89422);const Eb=500;class Ke{constructor(e,t,n,i){this._overlay=e,this._overlayPositionBuilder=t,this._elementRef=n,this._ngZone=i,this._delayTime=Eb,this._allowedKeyboardEvent=[on.Key.Enter,on.Key.Escape,on.Key.Tab],this._class="crt-tooltip-trigger"}set tooltipConfig(e){if(!e)return;this._tooltipConfig=this._normalizeTooltipEvents(e);const t=Nc.isMobile?"touchstart":"click";if(this._tooltipConfig.showEvent.includes(t)||this._elementRef.nativeElement.addEventListener(t,this._handleScreenReaderEnterEvent.bind(this)),this._tooltipRef){if(this._tooltipRef.instance.tooltipConfig=this._tooltipConfig.tooltipConfig,!this._tooltipRef.instance.tooltipConfig)return;this._tooltipRef.instance.tooltipConfig.cssClasses=this._tooltipConfig?.panelClass}}get tooltipConfig(){return this._tooltipConfig}set crtTooltip(e){!e||Array.isArray(e)&&e.length===0||(this.tooltipConfig=new so({tooltipConfig:{value:Array.isArray(e)?e.join("<br>"):e},componentType:Tt}))}_createEventObservables(e,t){return e?e?.map(n=>(0,l.fromEvent)(t,n,{capture:this._tooltipConfig?.capture})):[]}_createShowEventStream(e){const t=this._createEventObservables(this._tooltipConfig?.showEvent,this._elementRef.nativeElement);return this._ngZone.runOutsideAngular(()=>(0,l.merge)(...t).pipe((0,d.auditTime)(this._delayTime),(0,d.takeUntil)(e)))}_createHideEventStream(e){const t=this._createEventObservables(this._tooltipConfig?.hideEvent,e);return this._ngZone.runOutsideAngular(()=>(0,l.merge)(...t))}_createEventsStream(e,t){this._subscription=t.subscribe(),this._subscription.add(e.subscribe());const n=(0,l.merge)(e,t);n.pipe((0,d.takeUntil)(t));const i=n.subscribe(r=>{if(this._tooltipConfig.showEvent?.includes(r.type)&&this.show(r),this._tooltipConfig.hideEvent?.includes(r.type)){let a=r.relatedTarget;this._overlayRef?.overlayElement.contains(a)||(a=this._elementRef.nativeElement,this.hide(),this._subscription.unsubscribe());const c=this._createHideEventStream(a),h=this._createShowEventStream(c);this._createEventsStream(h,c)}});this._subscription.add(i)}_createKeyboardEvent(){const e=this._ngZone.runOutsideAngular(()=>(0,l.fromEvent)(this._elementRef.nativeElement,"keydown",{capture:this._tooltipConfig?.capture}).pipe((0,d.filter)(n=>this._allowedKeyboardEvent.includes(n.key)))),t=this._ngZone.runOutsideAngular(()=>(0,l.fromEvent)(this._elementRef.nativeElement,"blur",{capture:this._tooltipConfig?.capture}));this._createKeyboardEventsStream(e,t)}_createKeyboardEventsStream(e,t){this._keypressSubscription=t.subscribe();const n=(0,l.merge)(e,t);n.pipe((0,d.takeUntil)(t));const i=n.subscribe(r=>{r instanceof KeyboardEvent?this._onHandleKeyboardEvent(r):r instanceof FocusEvent&&this._onHandleFocusEvent(r)});this._keypressSubscription.add(i)}_onHandleKeyboardEvent(e){switch(e.key){case on.Key.Enter:e.stopPropagation(),this._overlayRef?.hasAttached()?this.hide():this.show(e);break;case on.Key.Escape:this._overlayRef?.hasAttached()&&e.stopPropagation(),this.hide(),this._keypressSubscription.unsubscribe(),this._createKeyboardEvent();break;case on.Key.Tab:this._overlayRef?.hasAttached()&&(this.hide(),this._keypressSubscription.unsubscribe(),this._createKeyboardEvent());break}}_handleScreenReaderEnterEvent(e){e.stopPropagation();const t=document.activeElement===this._elementRef.nativeElement;if(e.isPrimary&&e.buttons===1&&t){const n=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,charCode:13,bubbles:!0,cancelable:!0});this._onHandleKeyboardEvent(n)}}_onHandleFocusEvent(e){if(e.type!=="blur")return;const t=e.relatedTarget;this._overlayRef?.overlayElement.contains(t)||(this.hide(),this._keypressSubscription.unsubscribe()),this._createKeyboardEvent()}_getPreferredPositions(){return[{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass},{originX:"end",originY:"bottom",overlayX:"center",overlayY:"top",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass},{originX:"center",originY:"center",overlayX:"end",overlayY:"top",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass}]}_prepareTooltipConfigFromOverlayConfig(e){const t=e.tooltipConfig;return this._tooltipConfig.tooltipConfig&&e.panelClass&&(t.cssClasses=e.panelClass),t}_createOverlay(){if(!this._tooltipConfig)return;const e=this._tooltipConfig?.preferredPositions??this._getPreferredPositions(),t=this._overlayPositionBuilder.flexibleConnectedTo(this._elementRef).withPositions(e),n={scrollStrategy:this._overlay.scrollStrategies.close(),positionStrategy:t};this._tooltipConfig?.width&&Object.assign(n,{width:this._tooltipConfig?.width}),this._tooltipConfig?.height&&Object.assign(n,{height:this._tooltipConfig?.height}),this._overlayRef=this._overlay.create(n),this._tooltipConfig.closeOnOutsideClick&&this._overlayRef.outsidePointerEvents().subscribe(()=>this.hide()),this._overlayRef.keydownEvents().pipe((0,d.filter)(i=>i.key===on.Key.Escape)).subscribe(()=>{this.hide()})}_subscribeOnClickToHide(){this._ngZone.runOutsideAngular(()=>(0,l.fromEvent)(this._elementRef.nativeElement,Nc.isMobile?"touchstart":"click").subscribe(e=>{e.ignoreHandle=this._overlayRef?.hasAttached(),this.hide()}))}_normalizeTooltipEvents(e){const t=Array.isArray(e.showEvent)?e.showEvent:[e.showEvent],n=Array.isArray(e.hideEvent)?e.hideEvent:[e.hideEvent];return{...e,showEvent:t,hideEvent:n}}hide(){this._overlayRef?.hasAttached()&&(this._overlayRef.detach(),this._overlayRef.dispose(),this._overlayRef=null)}show(e){if(e.ignoreHandle)return;const t=e.relatedTarget;!this._tooltipConfig||t&&!document.body.contains(t)||(e?.stopPropagation(),this._overlayRef||this._createOverlay(),this._overlayRef.hasAttached()||(this._tooltipRef=this._overlayRef.attach(new xb.ComponentPortal(this._tooltipConfig.componentType))),this._tooltipRef&&(this._tooltipRef.instance.tooltipConfig=this._prepareTooltipConfigFromOverlayConfig(this._tooltipConfig),this._tooltipRef.location.nativeElement.setAttribute("id",this.id)))}ngAfterViewInit(){const e=this._createHideEventStream(this._elementRef.nativeElement),t=this._createShowEventStream(e);this._createEventsStream(t,e),this._createKeyboardEvent(),this._subscribeOnClickToHide()}ngOnDestroy(){this.hide(),this._subscription?.unsubscribe(),this._keypressSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||Ke)(s.\u0275\u0275directiveInject(no.Overlay),s.\u0275\u0275directiveInject(no.OverlayPositionBuilder),s.\u0275\u0275directiveInject(s.ElementRef),s.\u0275\u0275directiveInject(s.NgZone))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:Ke,selectors:[["","crtTooltip",""]],hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275classMap(n._class)},inputs:{id:[0,"crtTooltipId","id"],tooltipConfig:"tooltipConfig",crtTooltip:"crtTooltip"},exportAs:["crtTooltip"]})}}(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],Ke.prototype,"id",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",so),(0,u.__metadata)("design:paramtypes",[so])],Ke.prototype,"tooltipConfig",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object),(0,u.__metadata)("design:paramtypes",[Object])],Ke.prototype,"crtTooltip",null);class ro{constructor(){this.tooltipId=L(),this.ariaLabel="",this.type="default",this.tabIndex=0,this.icon="info-icon"}set tooltip(e){e instanceof so?this._tooltipConfig=e:this._tooltipConfig=this._createTooltipConfig(e)}get tooltip(){return this._tooltipConfig}get tooltipMode(){return{error:"Tooltip.Mode.Error",default:"Tooltip.Mode.Default",none:""}[this.type]||""}get iconClass(){return{error:"invalid-icon",default:"tooltip-icon",none:""}[this.type]||""}_createTooltipConfig(e){return new so({showEvent:["focus","mouseenter"],hideEvent:["blur","mouseleave"],componentType:Tt,tooltipConfig:{value:e},preferredPositions:[{originX:"end",originY:"center",overlayX:"start",overlayY:"center"}]})}static{this.\u0275fac=function(t){return new(t||ro)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:ro,selectors:[["crt-icon-tooltip"]],inputs:{tooltip:"tooltip",ariaLabel:"ariaLabel",type:"type",tabIndex:"tabIndex",icon:"icon"},decls:2,vars:9,consts:[["matSuffix","","crtTooltip","","role","button","aria-hidden","false",3,"crtTooltipId","tooltipConfig","ngClass","svgIcon","tabindex"]],template:function(t,n){t&1&&(s.\u0275\u0275element(0,"mat-icon",0),s.\u0275\u0275pipe(1,"translate")),t&2&&(s.\u0275\u0275property("crtTooltipId",n.tooltipId)("tooltipConfig",n.tooltip)("ngClass",n.iconClass)("svgIcon",n.icon)("tabindex",n.tabIndex),s.\u0275\u0275attribute("aria-label",s.\u0275\u0275pipeBind1(1,7,n.tooltipMode)+" "+n.ariaLabel)("aria-describedby",n.tooltipId))},dependencies:[M.NgClass,Z.MatIcon,Ke,T.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{height:20px}.mat-icon[_ngcontent-%COMP%]{width:16px;height:16px;padding:2px}.mat-icon[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}"],changeDetection:0})}}class oo{constructor(){this.showDelay=100,this.hideDelay=100,this.infoTooltipClass="",this.icon="info-tooltip",this.tooltipPosition="above"}static{this.\u0275fac=function(t){return new(t||oo)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:oo,selectors:[["ts-info-tooltip-icon"]],inputs:{message:"message",showDelay:"showDelay",hideDelay:"hideDelay",infoTooltipClass:"infoTooltipClass",icon:"icon",tooltipPosition:"tooltipPosition"},decls:1,vars:6,consts:[[3,"svgIcon","matTooltip","matTooltipClass","matTooltipShowDelay","matTooltipHideDelay","matTooltipPosition"]],template:function(t,n){t&1&&s.\u0275\u0275element(0,"mat-icon",0),t&2&&s.\u0275\u0275property("svgIcon",n.icon)("matTooltip",n.message)("matTooltipClass",n.infoTooltipClass)("matTooltipShowDelay",n.showDelay)("matTooltipHideDelay",n.hideDelay)("matTooltipPosition",n.tooltipPosition)},dependencies:[Z.MatIcon,ur.MatTooltip],styles:["[_nghost-%COMP%]{height:22px;width:22px}mat-icon[_ngcontent-%COMP%]{color:#22ac14;width:22px;height:22px;cursor:pointer}"]})}}function Ib(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"span"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.translate("OperationsPoint"))}}function Ab(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"li"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t)}}function Pb(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"ol"),s.\u0275\u0275template(1,Ab,2,1,"li",3),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",t.data==null?null:t.data.byOperations)}}function Tb(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"span"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.translate("RecordsPoint"))}}function Db(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"li"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t)}}function Ob(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"ol"),s.\u0275\u0275template(1,Db,2,1,"li",3),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",t.data==null?null:t.data.byRecords)}}class Ya extends Tt{set tooltipConfig(e){this.data=e.value}constructor(e,t,n,i,r){super(e,t),this.directionality=e,this._translateService=n,this._dialogService=i,this._environment=r,this._translatePrefix="ObjectPermissions."}translate(e){return this._translateService.instant(this._translatePrefix+e)}getUrl(){return this._url||(this._url=this._environment.workspaceBaseUrl+"ClientApp/#/AdministratedObjects"),this._url}updateObjectPermissions(){this._dialogService.openConfirmationDialog(this.translate("UpdateObjectPermissionsMessage")).pipe((0,l.map)(e=>{e===nr.result&&this.data.setObjectPermissionsFn(this.data.targetId).subscribe()})).subscribe()}static{this.\u0275fac=function(t){return new(t||Ya)(s.\u0275\u0275directiveInject(Ie.Directionality),s.\u0275\u0275directiveInject(Fe.DomSanitizer),s.\u0275\u0275directiveInject(T.TranslateService),s.\u0275\u0275directiveInject(He),s.\u0275\u0275directiveInject("environment"))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ya,selectors:[["crt-object-permissions-warning"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:17,vars:14,consts:[[4,"ngIf"],["target","_blank",3,"href"],["target","_blank",1,"update-permissions-link",3,"click"],[4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div")(1,"span"),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(3,Ib,2,1,"span",0)(4,Pb,2,1,"ol",0)(5,Tb,2,1,"span",0)(6,Ob,2,1,"ol",0),s.\u0275\u0275elementStart(7,"span"),s.\u0275\u0275text(8),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(9,"a",1),s.\u0275\u0275text(10),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(11,"span"),s.\u0275\u0275text(12),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(13,"a",2),s.\u0275\u0275listener("click",function(){return n.updateObjectPermissions()}),s.\u0275\u0275text(14),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(15,"p"),s.\u0275\u0275text(16),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275classMapInterpolate1("component-container ",n.cssClasses,""),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.translate("Warning")),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",(n.data==null||n.data.byOperations==null?null:n.data.byOperations.length)>0),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",(n.data==null||n.data.byOperations==null?null:n.data.byOperations.length)>0),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",(n.data==null||n.data.byRecords==null?null:n.data.byRecords.length)>0),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",(n.data==null||n.data.byRecords==null?null:n.data.byRecords.length)>0),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.translate("SetProperPermissionsBegin")),s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate("href",n.getUrl(),s.\u0275\u0275sanitizeUrl),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(n.translate("ObjectPermissions")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.translate("SetProperPermissionsEnd")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.translate("Link")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(n.translate("End")))},dependencies:[M.NgForOf,M.NgIf],styles:[".component-container[_ngcontent-%COMP%]{min-width:450px;max-width:450px;border-bottom:0px!important}.component-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.component-container[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:4px;padding-inline-start:20px}.component-container[_ngcontent-%COMP%]   a.update-permissions-link[_ngcontent-%COMP%]{display:block;line-height:40px}"]})}}function Rb(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit,n=s.\u0275\u0275nextContext();s.\u0275\u0275classMapInterpolate1("rule ",n.getValidationClass(t.valid),""),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.caption," ")}}class ao extends Tt{set tooltipConfig(e){this.validationTooltipConfig=e.value}constructor(e,t){super(e,t),this.directionality=e}getValidationClass(e){return e?"valid":typeof e=="boolean"?"invalid":"not-validated"}setInnerHTML(){}static{this.\u0275fac=function(t){return new(t||ao)(s.\u0275\u0275directiveInject(Ie.Directionality),s.\u0275\u0275directiveInject(Fe.DomSanitizer))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:ao,selectors:[["crt-validation-result-tooltip"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:5,vars:5,consts:[[1,"header"],[1,"rules"],[3,"class",4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"div")(1,"div",0),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"div",1),s.\u0275\u0275template(4,Rb,2,4,"div",2),s.\u0275\u0275elementEnd()()),t&2&&(s.\u0275\u0275classMapInterpolate1("component-container ",n.cssClasses,""),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",n.validationTooltipConfig==null?null:n.validationTooltipConfig.header,":"),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",n.validationTooltipConfig==null?null:n.validationTooltipConfig.validations))},dependencies:[M.NgForOf],styles:[".component-container[_ngcontent-%COMP%]{max-width:400px;display:flex;flex-direction:column;padding:16px;border-width:1px;border-style:solid}.component-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{text-align:left;font-weight:700;padding-bottom:6px}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule[_ngcontent-%COMP%]{width:50%;position:relative;left:24px;text-indent:-24px;padding-right:30px;box-sizing:border-box;margin-bottom:9px}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule[_ngcontent-%COMP%]:before{padding-right:8px;top:3px;position:relative}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.valid[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTUiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2M4MjIzIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3OSIgZGF0YS1uYW1lPSJQYXRoIDExODc5IiBkPSJNMTcuMDkzLDI4LjE4bDIuNSwzLDQuNS01IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NzMuNDA3IDU1MS4zMikiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNjODIyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPC9nPgo8L3N2Zz4K)}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.invalid[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTQiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzIzZjIzIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3NyIgZGF0YS1uYW1lPSJQYXRoIDExODc3IiBkPSJNMTQyOCw0ODF2NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE3My41MDkgLTc3MS45ODgpIHJvdGF0ZSg0NSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2MyM2YyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3OCIgZGF0YS1uYW1lPSJQYXRoIDExODc4IiBkPSJNMTQyOCw0ODF2NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTg0NS45ODggLTg3LjUwOSkgcm90YXRlKDEzNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2MyM2YyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPC9nPgo8L3N2Zz4K)}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.not-validated[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTMiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNzU3NTc1IiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K)}"]})}}class an{constructor(e){this._materialIconsRegistrator=e,this._materialIconsRegistrator.addIcons([{name:"tooltip-icon",icon:y(92825)}])}static{this.\u0275fac=function(t){return new(t||an)(s.\u0275\u0275inject(Wt))}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:an})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[M.CommonModule,Z.MatIconModule,ur.MatTooltipModule,T.TranslateModule,ct]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(an,{declarations:[oo,Tt,Ke,ao,Ya,ro],imports:[M.CommonModule,Z.MatIconModule,ur.MatTooltipModule,T.TranslateModule,ct],exports:[oo,Tt,Ke,ao,ro]})})();class co{constructor(e,t){this.el=e,this.render=t}set dataItemMarker(e){this.render.setAttribute(this.el.nativeElement,"data-item-marker",e)}static{this.\u0275fac=function(t){return new(t||co)(s.\u0275\u0275directiveInject(s.ElementRef),s.\u0275\u0275directiveInject(s.Renderer2))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:co,selectors:[["","tsDataItemMarker",""]],inputs:{dataItemMarker:[0,"tsDataItemMarker","dataItemMarker"]}})}}class ls{static{this.\u0275fac=function(t){return new(t||ls)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:ls})}static{this.\u0275inj=s.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(ls,{declarations:[co],exports:[co]})})();class cn{constructor(e){this._elementRef=e,this._debounceTime=300}_setTitleAttribute(){const e="title",t=this._elementRef.nativeElement;if(this._isElementOverflowed(t)){const n=t.value||t.innerText||"";t.setAttribute(e,n)}else t.removeAttribute(e)}_isElementOverflowed(e){return e.offsetWidth<e.scrollWidth||e.offsetHeight<e.scrollHeight}onMouseEnter(){(0,v.debounce)(()=>this._setTitleAttribute(),this._debounceTime,{leading:!0,trailing:!1})()}static{this.\u0275fac=function(t){return new(t||cn)(s.\u0275\u0275directiveInject(s.ElementRef))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:cn,selectors:[["","crtTextOverflowTitle",""]],hostBindings:function(t,n){t&1&&s.\u0275\u0275listener("mouseenter",function(){return n.onMouseEnter()})}})}}class us{static{this.\u0275fac=function(t){return new(t||us)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:us})}static{this.\u0275inj=s.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(us,{declarations:[cn],exports:[cn]})})();function jb(o){return Xp(o,"mobile")}class lo{constructor(e){this.translateService=e}_getTranslations(e){const t=this.translateService.translations[e];return t?(0,l.of)({translation:t,cultureName:e}):this.translateService.currentLoader.getTranslation(e).pipe((0,d.map)(n=>({translation:n,cultureName:e})))}getAllCultureValues(e,t){return(0,l.forkJoin)(e.map(n=>this._getTranslations(n))).pipe((0,d.map)(n=>{const i=new ki;for(const{translation:r,cultureName:a}of n){const c=(0,v.get)(r,t);i.setValueLocalizableString(a,c)}return i}))}isTranslateKey(e){return/^\S+\.\S+$/.test(e)}static{this.\u0275fac=function(t){return new(t||lo)(s.\u0275\u0275inject(T.TranslateService))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:lo,factory:lo.\u0275fac})}}class Be extends Le{constructor(){super(...arguments),this._translateService=(0,s.inject)(T.TranslateService),this._translateUtilsService=(0,s.inject)(lo,{optional:!0}),this.clicked=new s.EventEmitter}get caption(){return this._caption}set caption(e){this._translateUtilsService?.isTranslateKey(e)?(this._caption=this._translateService.instant(e),console.warn(`You should pass already translated value to menu item. Please fix it for '${e}'.`)):this._caption=e}set iconColor(e){["primary","accent","warn","default"].includes(e)?(this.colorPalette=e,this.customColor=void 0):(this.colorPalette=void 0,this.customColor=e)}get ariaDisabled(){return this.disabled?"true":"false"}handleItemClick(e){this.disabled||this.clicked.next(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Be)))(n||Be)}})()}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:Be,hostVars:1,hostBindings:function(t,n){t&2&&s.\u0275\u0275attribute("aria-disabled",n.ariaDisabled)},inputs:{caption:"caption",icon:"icon",iconColor:"iconColor",visible:"visible",disabled:"disabled",items:"items",handleItemClick:"handleItemClick"},outputs:{clicked:"clicked"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],Be.prototype,"caption",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],Be.prototype,"icon",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],Be.prototype,"iconColor",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],Be.prototype,"visible",void 0),(0,u.__decorate)([A({propertyBindable:!0,defaultValue:!1,propertyName:Ki.Disabled}),(0,u.__metadata)("design:type",Boolean)],Be.prototype,"disabled",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Array)],Be.prototype,"items",void 0),(0,u.__decorate)([Za(),(0,u.__metadata)("design:type",Object)],Be.prototype,"clicked",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Event]),(0,u.__metadata)("design:returntype",void 0)],Be.prototype,"handleItemClick",null);function kb(o,e){if(o&1&&s.\u0275\u0275element(0,"mat-icon",3),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275styleProp("color",t.disabled?null:t.customColor),s.\u0275\u0275property("svgIcon",t.icon)("color",t.colorPalette)}}function Nb(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"span",4),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",t.caption," ")}}let Jn=class Ac extends Be{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Ac)))(n||Ac)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ac,selectors:[["crt-menu-item"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[["mat-flat-button","",1,"crt-menu-item",3,"click","disabled"],[3,"svgIcon","color",4,"ngIf"],["class","caption","crtTextOverflowTitle","",4,"ngIf"],[3,"svgIcon","color"],["crtTextOverflowTitle","",1,"caption"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"button",0),s.\u0275\u0275listener("click",function(r){return n.handleItemClick(r)}),s.\u0275\u0275template(1,kb,1,4,"mat-icon",1)(2,Nb,2,1,"span",2),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275property("disabled",n.disabled),s.\u0275\u0275attribute("data-item-marker",n.caption||n.icon),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.icon),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption))},dependencies:[M.NgIf,Z.MatIcon,cn],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center}.crt-menu-item[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;border:none;background:none;outline:none;cursor:pointer;padding:8px 16px 8px 40px;position:relative;height:40px}.crt-menu-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{min-width:16px;width:16px;min-height:16px;height:16px;margin-right:0;position:absolute;left:16px}.crt-menu-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}"]})}};Jn=(0,u.__decorate)([os({type:"crt.MenuItem",reuseStrategy:At.Reuse}),bu({propertiesPanelComponentTypeName:"crt.MenuItemPropertiesPanel",typeCaption:"TypeCaptions.MenuItem",viewElementGroupType:as.Components})],Jn);var vu;const Vb=["nestedMenuViewElement"],uo=o=>({$implicit:o});function Lb(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",18),s.\u0275\u0275listener("keydown",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(2).$implicit,a=s.\u0275\u0275nextContext().$implicit,c=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(c.onMenuActionItemKeydown(i,r,a))}),s.\u0275\u0275elementStart(2,"crt-menu-action-item",19),s.\u0275\u0275listener("itemSelected",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(2).$implicit,r=s.\u0275\u0275nextContext().$implicit,a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.onItemSelected({code:i.code,data:r}))}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementContainerEnd()}if(o&2){const t=s.\u0275\u0275nextContext(2).$implicit,n=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275advance(),s.\u0275\u0275property("crtMenuItem",t)("disableRipple",!0),s.\u0275\u0275advance(),s.\u0275\u0275property("item",t)("data",n)}}function Bb(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275element(1,"crt-menu-divider-item",20),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275advance(),s.\u0275\u0275property("crtMenuItem",t)}}function Fb(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275element(1,"crt-menu-label-item",21),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275advance(),s.\u0275\u0275property("crtMenuItem",t)("item",t)}}function zb(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",23,2),s.\u0275\u0275listener("keydown",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275reference(2),a=s.\u0275\u0275nextContext(3).$implicit,c=s.\u0275\u0275nextContext().$implicit,h=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(h.onMenuActionItemKeydown(i,a,c,r))}),s.\u0275\u0275elementStart(3,"crt-menu-action-item",19),s.\u0275\u0275listener("itemSelected",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext(3).$implicit,r=s.\u0275\u0275nextContext().$implicit,a=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(a.onItemSelected({code:i.code,data:r}))}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(4,"crt-menu",24,3),s.\u0275\u0275listener("itemSelected",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(5);return s.\u0275\u0275resetView(r.onItemSelected(i))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(o&2){const t=s.\u0275\u0275reference(5),n=s.\u0275\u0275nextContext(3).$implicit,i=s.\u0275\u0275nextContext().$implicit,r=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("disableRipple",!0)("crtMenuItem",n)("crtMenuTriggerFor",t)("crtMenuTriggerData",s.\u0275\u0275pureFunction1(9,uo,i))("crtMenuTriggerDisabled",n.disabled),s.\u0275\u0275advance(2),s.\u0275\u0275property("item",n)("data",i),s.\u0275\u0275advance(),s.\u0275\u0275property("menuItems",n.items)("panelClass",r.nestedMenuClasses)}}function Ub(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,zb,6,11,"ng-container",22),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",t.items&&t.items.length>0)}}function $b(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0,16),s.\u0275\u0275template(1,Lb,3,4,"ng-container",17)(2,Bb,2,1,"ng-container",17)(3,Fb,2,2,"ng-container",17)(4,Ub,2,1,"ng-container",17),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275property("ngSwitch",t.type),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","action"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","divider"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","label"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","menu")}}function Gb(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,$b,5,5,"ng-container",15),s.\u0275\u0275elementContainerEnd()),o&2){const t=e.$implicit,n=s.\u0275\u0275nextContext().$implicit,i=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",i.isItemVisible(t,n))}}function Hb(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function Wb(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",26),s.\u0275\u0275listener("keydown",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275nextContext(2).$implicit,a=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(a.onMenuItemKeydown(i,r))}),s.\u0275\u0275template(2,Hb,1,0,"ng-container",27),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(o&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275nextContext(2);const n=s.\u0275\u0275reference(5);s.\u0275\u0275advance(),s.\u0275\u0275property("disableRipple",!0)("crtMenuViewElementItem",t),s.\u0275\u0275attribute("aria-current",t.selected),s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(5,uo,t))}}function Zb(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function Yb(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",29,8),s.\u0275\u0275listener("keydown",function(i){s.\u0275\u0275restoreView(t);const r=s.\u0275\u0275reference(2),a=s.\u0275\u0275nextContext(4).$implicit,c=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(c.onMenuItemKeydown(i,a,r))}),s.\u0275\u0275template(4,Zb,1,0,"ng-container",27),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(o&2){const t=e.ngIf,n=s.\u0275\u0275reference(3),i=s.\u0275\u0275nextContext(4).$implicit;s.\u0275\u0275nextContext(2);const r=s.\u0275\u0275reference(5);s.\u0275\u0275advance(),s.\u0275\u0275property("disableRipple",!0)("crtMenuTriggerFor",t)("crtMenuViewElementItem",i)("crtMenuTriggerDisabled",n.getDisabledState()),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngTemplateOutlet",r)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(6,uo,i))}}function Kb(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function Jb(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div",30),s.\u0275\u0275template(1,Kb,1,0,"ng-container",27),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(4).$implicit;s.\u0275\u0275nextContext(2);const n=s.\u0275\u0275reference(5);s.\u0275\u0275property("disableRipple",!0)("crtMenuViewElementItem",t),s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(4,uo,t))}}function qb(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,Yb,5,8,"ng-container",25)(2,Jb,2,6,"ng-template",null,6,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementContainer(4,28,7),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275reference(3),n=s.\u0275\u0275nextContext(3).$implicit,i=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",i.getNestedMenuComponentByConfig(n))("ngIfElse",t),s.\u0275\u0275advance(3),s.\u0275\u0275property("crtViewElement",i.getNestedMenuConfig(n))}}function Xb(o,e){if(o&1&&s.\u0275\u0275template(0,qb,6,3,"ng-container",25),o&2){s.\u0275\u0275nextContext();const t=s.\u0275\u0275reference(5),n=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275property("ngIf",(n==null||n.items==null?null:n.items.length)>0)("ngIfElse",t)}}function Qb(o,e){o&1&&s.\u0275\u0275elementContainer(0)}function e0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div",31),s.\u0275\u0275template(1,Qb,1,0,"ng-container",27),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275nextContext(2);const n=s.\u0275\u0275reference(5);s.\u0275\u0275property("crtMenuViewElementItem",t),s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(3,uo,t))}}function t0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,Wb,3,7,"ng-container",25)(2,Xb,1,2,"ng-template",null,4,s.\u0275\u0275templateRefExtractor)(4,e0,2,5,"ng-template",null,5,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275reference(3),n=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.type==="crt.MenuItem"&&!(n.items!=null&&n.items.length))("ngIfElse",t)}}function n0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,t0,6,2,"ng-container",22),s.\u0275\u0275elementContainerEnd()),o&2){const t=e.$implicit,n=s.\u0275\u0275nextContext().$implicit,i=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",i.isItemVisible(t,n))}}function i0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,Gb,2,1,"ng-container",13)(2,n0,2,1,"ng-container",14),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",t.menuItems)("ngForTrackBy",t.trackByIndex),s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",t.items)}}function s0(o,e){if(o&1&&s.\u0275\u0275elementContainer(0,33),o&2){const t=s.\u0275\u0275nextContext().$implicit,n=s.\u0275\u0275nextContext();s.\u0275\u0275property("crtViewElement",t)("crtViewModel",n.context)}}function r0(o,e){if(o&1&&s.\u0275\u0275elementContainer(0,28),o&2){const t=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275property("crtViewElement",t)}}function o0(o,e){if(o&1&&s.\u0275\u0275template(0,s0,1,2,"ng-container",32)(1,r0,1,1,"ng-template",null,9,s.\u0275\u0275templateRefExtractor),o&2){const t=s.\u0275\u0275reference(2),n=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngIf",n.context)("ngIfElse",t)}}const em="nested-menu",a0="crt-menu-glassmorphism";let we=class yd{static{vu=this}set menuItems(e){const t=this._menuItems.length===0&&e?.length>0;this._menuItems=Array.isArray(e)?e:[],this._updateNestedMenuConfigs(),t&&this.menu.focusFirstItem(this._focusOrigin)}get menuItems(){return this._menuItems}set items(e){const t=this._adjustItems(e);if(this._items===t)return;const n=this._items.length===0&&t?.length>0;this._items=t,this._updateNestedMenuConfigs(),n&&this.menu.focusFirstItem(this._focusOrigin)}get items(){return this._items}set panelClass(e){this._panelClass!==e&&(this._panelClass=e,this._preparePanelClasses(),this._updateNestedMenuConfigs())}set useGlassmorphism(e){this._useGlassmorphism!==e&&(this._useGlassmorphism=e,this._preparePanelClasses(),this._updateNestedMenuConfigs())}set nestedMenuViewElements(e){this._nestedMenuViewElements=e,e?.length&&(this._teardownNestedMenuSubscriptions(),this._subscribeToNestedMenuComponents())}get wrapClasses(){return this._wrapClasses}get nestedMenuClasses(){return this.wrapClasses?`${this.wrapClasses} ${em}`:em}constructor(e,t){this._overlayContainer=e,this._renderer=t,this._destroyRef=(0,s.inject)(s.DestroyRef),this._useGlassmorphism=!1,this._menuItems=[],this._items=[],this._nestedMenuConfigs=[],this._nestedMenuConfigsMap=new Map,this._nestedMenuComponentsMap=new Map,this._nestedMenuSubscriptions=new Map,this.xPosition="after",this.yPosition="below",this.stopOverlayClickPropagation=!1,this.itemSelected=new s.EventEmitter}_preparePanelClasses(){const e=" ",t=this._panelClass?.split(e)||[];this._useGlassmorphism&&t.push(a0),this._wrapClasses=t.join(e)}_adjustItems(e){return(e??[]).map(t=>({...t,name:t?.name||L()}))}_updateNestedMenuConfigs(){const t=this._items.filter(n=>n.items?.length>0).map(n=>({id:this._getNestedMenuId(n),name:n.name,type:"crt.Menu",items:n.items,panelClass:this._panelClass,useGlassmorphism:this._useGlassmorphism,visible:!0}));(0,v.isEqual)(this._nestedMenuConfigs,t)||this._rebuildNestedMenuConfigs(t)}_rebuildNestedMenuConfigs(e){this._teardownNestedMenuSubscriptions(),this._nestedMenuConfigs=e,this._nestedMenuConfigsMap.clear(),e.forEach(t=>this._nestedMenuConfigsMap.set(t.id,t))}_getNestedMenuId(e){return`nested-menu-${e.name}`}_teardownNestedMenuSubscriptions(){this._nestedMenuComponentsMap.clear(),this._nestedMenuSubscriptions.forEach(e=>e.unsubscribe()),this._nestedMenuSubscriptions.clear()}_registerNestedMenuComponent(e,t){this._nestedMenuComponentsMap.set(e,t)}_handleItemClick(e,t){const n=this._getCrtMenuItemComponent(t);n instanceof Jn&&n.handleItemClick(e)}_isActionButtonPressed(e){return e.code===on.Key.Enter||e.code==="Space"}_getCrtMenuItemComponent(e){return this.crtMenuItemComponents?.find(n=>n?.componentRef?.getPropertyValue("name")===e?.name)?.componentRef?.instance}_subscribeToNestedMenuComponents(){this._nestedMenuViewElements.map(e=>{const t=e.viewElementConfig,n=this._getNestedMenuId(t);return{directive:e,id:n}}).filter(({directive:e,id:t})=>e&&t).map(({directive:e,id:t})=>{const n=e.componentRef$.pipe((0,l.filter)(i=>i?.instance instanceof vu),(0,Yr.takeUntilDestroyed)(this._destroyRef)).subscribe(i=>{this._setupNestedMenuComponent(t,i.instance)});return{id:t,subscription:n}}).forEach(({id:e,subscription:t})=>{this._nestedMenuSubscriptions.set(e,t)})}_setupNestedMenuComponent(e,t){this._registerNestedMenuComponent(e,t),t.panelClass=this.nestedMenuClasses,t.useGlassmorphism=this._useGlassmorphism,t.itemSelected.pipe((0,Yr.takeUntilDestroyed)(this._destroyRef)).subscribe(n=>{this.onItemSelected(n)})}ngOnInit(){this.stopOverlayClickPropagation&&this._overlayContainer&&(this._overlayClickUnlisten=this._renderer.listen(this._overlayContainer.getContainerElement(),"click",e=>{e.stopPropagation()}))}ngOnDestroy(){this._teardownNestedMenuSubscriptions(),this._overlayClickUnlisten?.()}getNestedMenuConfig(e){const t=this._getNestedMenuId(e);return this._nestedMenuConfigsMap.get(t)}getNestedMenuComponentByConfig(e){const t=this._getNestedMenuId(e);return this._nestedMenuComponentsMap.get(t)}isItemVisible(e,t){const{visible:n}=e;if(typeof n=="boolean")return n;if(typeof n=="function")return n(t);if(typeof n=="string"&&t instanceof ht){const i=n.split(".")[1];return t.attributes[i]}return!0}isItemDisabled(e){const t=this._getCrtMenuItemComponent(e);return t instanceof Jn&&t?.disabled||!1}onItemSelected(e){this.itemSelected.emit(e)}trackByIndex(e){return e}onMenuItemKeydown(e,t,n){!this._isActionButtonPressed(e)||this.isItemDisabled(t)||(n&&n?.openMenu(),(t?.clicked||t?.handleItemClick)&&(this._handleItemClick(e,t),this.menu.closed.emit("click")))}onMenuActionItemKeydown(e,t,n,i){!this._isActionButtonPressed(e)||t.disabled||(i&&i?.openMenu(),t?.handler&&(t.handler(n,e),this.menu.closed.emit("click")),this.onItemSelected({code:t.code,data:n}))}setFocusOrigin(e){this._focusOrigin=e}static{this.\u0275fac=function(t){return new(t||yd)(s.\u0275\u0275directiveInject(no.OverlayContainer,8),s.\u0275\u0275directiveInject(s.Renderer2))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:yd,selectors:[["crt-menu"]],viewQuery:function(t,n){if(t&1&&(s.\u0275\u0275viewQuery(le.MatMenu,7),s.\u0275\u0275viewQuery(Pe,5),s.\u0275\u0275viewQuery(Vb,5,Pe)),t&2){let i;s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.menu=i.first),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.crtMenuItemComponents=i),s.\u0275\u0275queryRefresh(i=s.\u0275\u0275loadQuery())&&(n.nestedMenuViewElements=i)}},inputs:{menuItems:"menuItems",items:"items",context:"context",xPosition:"xPosition",yPosition:"yPosition",stopOverlayClickPropagation:"stopOverlayClickPropagation",panelClass:"panelClass",useGlassmorphism:"useGlassmorphism"},outputs:{itemSelected:"itemSelected"},decls:6,vars:5,consts:[["menu","matMenu"],["menuItem",""],["crtMenuTrigger","crtMenuTrigger"],["nestedMenu",""],["menu",""],["other",""],["menuItemOnly",""],["nestedMenuViewElement",""],["crtMenuTrigger","crtMenuTrigger","menuViewElementItem","crtMenuViewElementItem"],["withoutContext",""],[3,"xPosition","yPosition","overlapTrigger"],[1,"menu-items-container"],[4,"matMenuContent"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngFor","ngForOf"],[3,"ngSwitch",4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","crtMenuItem","disableRipple"],[3,"itemSelected","item","data"],[3,"crtMenuItem"],[3,"crtMenuItem","item"],[4,"ngIf"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","disableRipple","crtMenuItem","crtMenuTriggerFor","crtMenuTriggerData","crtMenuTriggerDisabled"],[3,"itemSelected","menuItems","panelClass"],[4,"ngIf","ngIfElse"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","disableRipple","crtMenuViewElementItem"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"crtViewElement"],["mat-menu-item","",1,"crt-menu-item-container",3,"keydown","disableRipple","crtMenuTriggerFor","crtMenuViewElementItem","crtMenuTriggerDisabled"],["mat-menu-item","",1,"crt-menu-item-container",3,"disableRipple","crtMenuViewElementItem"],[3,"crtMenuViewElementItem"],[3,"crtViewElement","crtViewModel",4,"ngIf","ngIfElse"],[3,"crtViewElement","crtViewModel"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"mat-menu",10,0)(2,"div",11),s.\u0275\u0275template(3,i0,3,3,"ng-container",12),s.\u0275\u0275elementEnd()(),s.\u0275\u0275template(4,o0,3,2,"ng-template",null,1,s.\u0275\u0275templateRefExtractor)),t&2&&(s.\u0275\u0275classMap("crt-menu "+n.wrapClasses||0),s.\u0275\u0275property("xPosition",n.xPosition)("yPosition",n.yPosition)("overlapTrigger",!1))},styles:[".menu-items-container[_ngcontent-%COMP%]   .mat-mdc-menu-item[_ngcontent-%COMP%]{padding:0;min-height:40px}.menu-items-container[_ngcontent-%COMP%]   .crt-menu-item-container[aria-disabled=true][_ngcontent-%COMP%]{pointer-events:none}"]})}};(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Array),(0,u.__metadata)("design:paramtypes",[Array])],we.prototype,"menuItems",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Array),(0,u.__metadata)("design:paramtypes",[Array])],we.prototype,"items",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",ht)],we.prototype,"context",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],we.prototype,"xPosition",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],we.prototype,"yPosition",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],we.prototype,"stopOverlayClickPropagation",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],we.prototype,"panelClass",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean),(0,u.__metadata)("design:paramtypes",[Boolean])],we.prototype,"useGlassmorphism",null),we=vu=(0,u.__decorate)([jb({type:"crt.Menu"}),os({type:"crt.Menu",reuseStrategy:At.Reuse}),(0,u.__metadata)("design:paramtypes",[no.OverlayContainer,s.Renderer2])],we);let ho=class Cd{static{this.\u0275fac=function(t){return new(t||Cd)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Cd,selectors:[["crt-menu-divider"]],decls:1,vars:0,template:function(t,n){t&1&&s.\u0275\u0275element(0,"mat-divider")},dependencies:[Ne.MatDivider],styles:["mat-divider[_ngcontent-%COMP%]{margin:8px 0}"]})}};ho=(0,u.__decorate)([os({type:"crt.MenuDivider",reuseStrategy:At.Reuse})],ho);let qn=class bd{static{this.\u0275fac=function(t){return new(t||bd)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:bd,selectors:[["crt-menu-label"]],inputs:{caption:"caption"},decls:2,vars:2,consts:[["crtTextOverflowTitle","",1,"crt-menu-label",3,"title"]],template:function(t,n){if(t&1&&(s.\u0275\u0275elementStart(0,"div",0),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),t&2){let i;s.\u0275\u0275property("title",(i=n.caption)!==null&&i!==void 0?i:""),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate1(" ",n.caption,`
`)}},dependencies:[cn],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.crt-menu-label[_ngcontent-%COMP%]{font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased;color:var(--crt-palette-label-500);padding:8px 24px 4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}"]})}};(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],qn.prototype,"caption",void 0),qn=(0,u.__decorate)([os({type:"crt.MenuLabel",reuseStrategy:At.Reuse})],qn);function c0(o,e){if(o&1&&s.\u0275\u0275element(0,"mat-icon",3),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("svgIcon",t.item.icon)}}function l0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"span",4),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(2,1,t.item.caption))}}class po{static{this.\u0275fac=function(t){return new(t||po)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:po,selectors:[["crt-menu-clickable-item"]],inputs:{item:"item"},decls:3,vars:4,consts:[[1,"crt-menu-clickable-item",3,"disabled"],[3,"svgIcon",4,"ngIf"],["crtTextOverflowTitle","",4,"ngIf"],[3,"svgIcon"],["crtTextOverflowTitle",""]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"button",0),s.\u0275\u0275template(1,c0,1,1,"mat-icon",1)(2,l0,3,3,"span",2),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275property("disabled",n.item==null?null:n.item.disabled),s.\u0275\u0275attribute("data-item-marker",(n.item==null?null:n.item.caption)||(n.item==null?null:n.item.icon)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.item==null?null:n.item.icon),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.item==null?null:n.item.caption))},dependencies:[M.NgIf,Z.MatIcon,cn,T.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center}.crt-menu-clickable-item[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;align-items:center;border:none;background:none;outline:none;cursor:pointer;padding:8px 16px 8px 40px;position:relative;height:40px}.crt-menu-clickable-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{min-width:16px;width:16px;min-height:16px;height:16px;margin-right:0;position:absolute;left:16px}.crt-menu-clickable-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.crt-menu-clickable-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--crt-menu-item-icon-color)}"]})}}class mo{static{this.\u0275fac=function(t){return new(t||mo)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:mo,selectors:[["crt-menu-extra-button"]],inputs:{itemConfig:"itemConfig"},decls:2,vars:3,consts:[["crtTooltip","","type","button",1,"crt-menu-extra-button",3,"click","tooltipConfig"],[1,"crt-menu-extra-button-icon",3,"svgIcon"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"button",0),s.\u0275\u0275listener("click",function(){return n.itemConfig.handler()}),s.\u0275\u0275element(1,"mat-icon",1),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275property("tooltipConfig",n.itemConfig.tooltip),s.\u0275\u0275attribute("aria-label",n.itemConfig.tooltip.tooltipConfig.value),s.\u0275\u0275advance(),s.\u0275\u0275property("svgIcon",n.itemConfig.icon))},dependencies:[Z.MatIcon,Ke],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{width:auto;height:100%;display:flex;align-items:center;justify-content:end}.crt-menu-extra-button[_ngcontent-%COMP%]{height:24px;width:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;background-color:transparent;border:none;border-radius:4px;transition:background-color .2s ease,transform .1s ease}.crt-menu-extra-button[_ngcontent-%COMP%]:hover{background-color:var(--crt-menu-item-background-active-color)}.crt-menu-extra-button[_ngcontent-%COMP%]:active{transform:scale(.95);background-color:var(--crt-palette-primary-100)}.crt-menu-extra-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0;height:16px;width:16px}"]})}}function u0(o,e){if(o&1&&s.\u0275\u0275element(0,"crt-menu-extra-button",2),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("itemConfig",t.item.extraButtonConfig)}}class go{constructor(){this.itemSelected=new s.EventEmitter}onClick(e){this.item.handler&&this.item.handler(this.data,e),this.itemSelected.emit(this.item)}static{this.\u0275fac=function(t){return new(t||go)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:go,selectors:[["crt-menu-action-item"]],hostBindings:function(t,n){t&1&&s.\u0275\u0275listener("click",function(r){return n.onClick(r)})},inputs:{item:"item",data:"data"},outputs:{itemSelected:"itemSelected"},decls:2,vars:2,consts:[[3,"item"],[3,"itemConfig",4,"ngIf"],[3,"itemConfig"]],template:function(t,n){t&1&&(s.\u0275\u0275element(0,"crt-menu-clickable-item",0),s.\u0275\u0275template(1,u0,1,1,"crt-menu-extra-button",1)),t&2&&(s.\u0275\u0275property("item",n.item),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.item==null?null:n.item.extraButtonConfig))},dependencies:[M.NgIf,po,mo],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;align-items:center;justify-content:center}"]})}}class fo{static{this.\u0275fac=function(t){return new(t||fo)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:fo,selectors:[["crt-menu-divider-item"]],decls:1,vars:0,template:function(t,n){t&1&&s.\u0275\u0275element(0,"mat-divider")},dependencies:[Ne.MatDivider],styles:["mat-divider[_ngcontent-%COMP%]{margin:8px 0}"]})}}class _o{static{this.\u0275fac=function(t){return new(t||_o)}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:_o,selectors:[["crt-menu-label-item"]],inputs:{item:"item"},decls:1,vars:1,consts:[[3,"caption"]],template:function(t,n){t&1&&s.\u0275\u0275element(0,"crt-menu-label",0),t&2&&s.\u0275\u0275property("caption",n.item==null?null:n.item.caption)},dependencies:[qn],encapsulation:2,changeDetection:0})}}class ds{constructor(){this.crtMenuItem=""}get _ariaDisabled(){return this.item?.disabled===!0}get itemType(){return this.item?.type}static{this.\u0275fac=function(t){return new(t||ds)}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:ds,selectors:[["","crtMenuItem",""]],hostVars:3,hostBindings:function(t,n){t&2&&s.\u0275\u0275attribute("aria-disabled",n._ariaDisabled)("crt-menu-item",n.crtMenuItem)("crt-menu-item-type",n.itemType)},inputs:{item:[0,"crtMenuItem","item"]}})}}(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],ds.prototype,"item",void 0);class hs{constructor(e,t){this._elementRef=e,this._cdr=t}get itemName(){return this.item?.name||""}get ariaDisabled(){const e=this._elementRef.nativeElement.querySelector("crt-menu-item");return e?e.getAttribute("aria-disabled"):null}getDisabledState(){const e=this.ariaDisabled;return e===null?!1:e==="true"}ngAfterViewInit(){this._cdr.detectChanges()}static{this.\u0275fac=function(t){return new(t||hs)(s.\u0275\u0275directiveInject(s.ElementRef),s.\u0275\u0275directiveInject(s.ChangeDetectorRef))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:hs,selectors:[["","crtMenuViewElementItem",""]],hostVars:2,hostBindings:function(t,n){t&2&&s.\u0275\u0275attribute("crt-menu-view-element-item",n.itemName)("aria-disabled",n.ariaDisabled)},inputs:{item:[0,"crtMenuViewElementItem","item"]},exportAs:["crtMenuViewElementItem"]})}}(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],hs.prototype,"item",void 0);let yo=class vd{static{this.\u0275fac=function(t){return new(t||vd)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:vd})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[sn,M.CommonModule,Ne.MatDividerModule,Z.MatIconModule,le.MatMenuModule,cs,ls,us,T.TranslateModule,an]})}};yo=(0,u.__decorate)([da({viewElements:[we,ho,Jn,qn]})],yo),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(yo,{declarations:[go,po,we,fo,mo,_o,ds,hs,Kn,ho,Jn,qn],imports:[sn,M.CommonModule,Ne.MatDividerModule,Z.MatIconModule,le.MatMenuModule,cs,ls,us,T.TranslateModule,an],exports:[we,Kn,ho,Jn,qn]})}(),s.\u0275\u0275setComponentScope(we,[Yn,Pe,M.NgForOf,M.NgIf,M.NgTemplateOutlet,M.NgSwitch,M.NgSwitchCase,le.MatMenu,le.MatMenuItem,le.MatMenuContent,go,we,fo,_o,ds,hs,Kn],[]);let Xn=class Sd{constructor(e){this._materialIconsRegistrator=e,this._materialIconsRegistrator.addIcons([{name:"menu-arrow",icon:y(67566)}])}static{this.\u0275fac=function(t){return new(t||Sd)(s.\u0275\u0275inject(Wt))}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Sd})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[te.MatButtonModule,M.CommonModule,Z.MatIconModule,Ht,Ne.MatDividerModule,yo,Oi,sn]})}};Xn=(0,u.__decorate)([da({viewElements:[rn]}),(0,u.__metadata)("design:paramtypes",[Wt])],Xn),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Xn,{declarations:[rn],imports:[te.MatButtonModule,M.CommonModule,pa,Z.MatIconModule,Ht,Ne.MatDividerModule,yo,Oi,sn],exports:[rn]})}();var Su;(function(o){o.Auto="auto",o.Transparent="transparent",o.PrimaryContrast500="primary-contrast-500",o.Foreground500="foreground-500",o.Label500="label-500",o.BrandSecondary500="brand-secondary-500",o.Warning500="warn-500",o.Brand500="brand-500",o.NavigationPrimary500="navigation-primary-500",o.Primary500="primary-500"})(Su||(Su={}));class ge extends Le{set caption(e){this._caption=e||e==0?`${e}`:""}get caption(){return this._caption}set labelType(e){this._labelType=e,this._initLabelTypeClass()}get labelType(){return this._labelType}get labelTypeClass(){return this._labelTypeClass}constructor(e){super(e),this._labelType="body",this.skeletonStyles={height:"20px"},this.labelStyle={},this._initLabelTypeClass()}_initLabelTypeClass(){let e=`mat-${this.labelType}`;this.labelType==="button"&&(e="mat-label-button"),this._labelTypeClass=e}getTooltip(){}static{this.\u0275fac=function(t){return new(t||ge)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:ge,inputs:{caption:"caption",required:"required",labelType:"labelType",labelMargin:"labelMargin",labelFontSize:"labelFontSize",labelFontFamily:"labelFontFamily",labelHeight:"labelHeight",labelLineHeight:"labelLineHeight",labelLetterSpacing:"labelLetterSpacing",labelThickness:"labelThickness",labelEllipsis:"labelEllipsis",labelTextTransform:"labelTextTransform",labelColor:"labelColor",labelStyle:"labelStyle"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],ge.prototype,"caption",null),(0,u.__decorate)([A({defaultValue:!1}),(0,u.__metadata)("design:type",Boolean)],ge.prototype,"required",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],ge.prototype,"labelType",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelMargin",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelFontSize",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelFontFamily",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelHeight",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelLineHeight",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelLetterSpacing",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelThickness",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Boolean)],ge.prototype,"labelEllipsis",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelTextTransform",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],ge.prototype,"labelColor",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",Object)],ge.prototype,"labelStyle",void 0);const d0=["*"];function h0(o,e){if(o&1&&s.\u0275\u0275element(0,"crt-skeleton-loader",3),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275property("styles",t.skeletonStyles)}}function p0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275text(1),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(3);s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.caption)}}function m0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"h1",8),s.\u0275\u0275template(1,p0,2,1,"ng-container",9),s.\u0275\u0275elementEnd()),o&2){s.\u0275\u0275nextContext();const t=s.\u0275\u0275reference(8),n=s.\u0275\u0275nextContext();s.\u0275\u0275classMap(n.labelTypeClass),s.\u0275\u0275styleProp("font-size",n.labelFontSize)("font-family",n.labelFontFamily)("height",n.labelHeight)("line-height",n.labelLineHeight)("letter-spacing",n.labelLetterSpacing),s.\u0275\u0275classProp("ellipsis",n.labelEllipsis),s.\u0275\u0275property("ngStyle",n.labelStyle),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function g0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275text(1),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(3);s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.caption)}}function f0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"h2",8),s.\u0275\u0275template(1,g0,2,1,"ng-container",9),s.\u0275\u0275elementEnd()),o&2){s.\u0275\u0275nextContext();const t=s.\u0275\u0275reference(8),n=s.\u0275\u0275nextContext();s.\u0275\u0275classMap(n.labelTypeClass),s.\u0275\u0275styleProp("font-size",n.labelFontSize)("font-family",n.labelFontFamily)("height",n.labelHeight)("line-height",n.labelLineHeight)("letter-spacing",n.labelLetterSpacing),s.\u0275\u0275classProp("ellipsis",n.labelEllipsis),s.\u0275\u0275property("ngStyle",n.labelStyle),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function _0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275text(1),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(3);s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.caption)}}function y0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"h3",8),s.\u0275\u0275template(1,_0,2,1,"ng-container",9),s.\u0275\u0275elementEnd()),o&2){s.\u0275\u0275nextContext();const t=s.\u0275\u0275reference(8),n=s.\u0275\u0275nextContext();s.\u0275\u0275classMap(n.labelTypeClass),s.\u0275\u0275styleProp("font-size",n.labelFontSize)("font-family",n.labelFontFamily)("height",n.labelHeight)("line-height",n.labelLineHeight)("letter-spacing",n.labelLetterSpacing),s.\u0275\u0275classProp("ellipsis",n.labelEllipsis),s.\u0275\u0275property("ngStyle",n.labelStyle),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function C0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275text(1),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(3);s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.caption)}}function b0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"h4",8),s.\u0275\u0275template(1,C0,2,1,"ng-container",9),s.\u0275\u0275elementEnd()),o&2){s.\u0275\u0275nextContext();const t=s.\u0275\u0275reference(8),n=s.\u0275\u0275nextContext();s.\u0275\u0275classMap(n.labelTypeClass),s.\u0275\u0275styleProp("font-size",n.labelFontSize)("font-family",n.labelFontFamily)("height",n.labelHeight)("line-height",n.labelLineHeight)("letter-spacing",n.labelLetterSpacing),s.\u0275\u0275classProp("ellipsis",n.labelEllipsis),s.\u0275\u0275property("ngStyle",n.labelStyle),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function v0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275text(1),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext(3);s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(t.caption)}}function S0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"label",8),s.\u0275\u0275template(1,v0,2,1,"ng-container",9),s.\u0275\u0275elementEnd()),o&2){s.\u0275\u0275nextContext();const t=s.\u0275\u0275reference(8),n=s.\u0275\u0275nextContext();s.\u0275\u0275classMap(n.labelTypeClass),s.\u0275\u0275styleProp("font-size",n.labelFontSize)("font-family",n.labelFontFamily)("height",n.labelHeight)("line-height",n.labelLineHeight)("letter-spacing",n.labelLetterSpacing)("color",n.labelColor),s.\u0275\u0275classProp("ellipsis",n.labelEllipsis),s.\u0275\u0275property("ngStyle",n.labelStyle),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.caption)("ngIfElse",t)}}function M0(o,e){o&1&&s.\u0275\u0275projection(0)}function w0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div",4),s.\u0275\u0275elementContainerStart(1,5),s.\u0275\u0275template(2,m0,2,18,"h1",6)(3,f0,2,18,"h2",6)(4,y0,2,18,"h3",6)(5,b0,2,18,"h4",6)(6,S0,2,20,"label",7)(7,M0,1,0,"ng-template",null,1,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementContainerEnd(),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275classMap("crt-label "+t.labelThickness),s.\u0275\u0275styleProp("color",t.labelColor)("background-color",t.labelBackgroundColor)("text-align",t.labelTextAlign)("align-content",t.labelTextAlign)("justify-content",t.labelTextAlign)("margin",t.labelMargin)("text-transform",t.labelTextTransform),s.\u0275\u0275property("tooltipConfig",t.getTooltip()),s.\u0275\u0275attribute("required",t.required),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitch",t.headingLevel),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","h1"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","h2"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","h3"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase","h4")}}let pt=class Pc extends ge{constructor(){super(...arguments),this._headingLevel="label"}set headingLevel(e){this._headingLevel=e}get headingLevel(){return this._headingLevel}set labelElementType(e){this.headingLevel=e}get labelElementType(){return this.headingLevel}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(Pc)))(n||Pc)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Pc,selectors:[["crt-label"]],inputs:{labelBackgroundColor:"labelBackgroundColor",labelTextAlign:"labelTextAlign",headingLevel:"headingLevel",labelElementType:"labelElementType"},features:[s.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:d0,decls:3,vars:2,consts:[["label_template",""],["content",""],[3,"styles",4,"ngIf","ngIfElse"],[3,"styles"],["crtTooltip","",3,"tooltipConfig"],[3,"ngSwitch"],[3,"class","ellipsis","font-size","font-family","height","line-height","letter-spacing","ngStyle",4,"ngSwitchCase"],[3,"class","ellipsis","font-size","font-family","height","line-height","letter-spacing","ngStyle","color",4,"ngSwitchDefault"],[3,"ngStyle"],[4,"ngIf","ngIfElse"]],template:function(t,n){if(t&1&&(s.\u0275\u0275projectionDef(),s.\u0275\u0275template(0,h0,1,1,"crt-skeleton-loader",2)(1,w0,9,24,"ng-template",null,0,s.\u0275\u0275templateRefExtractor)),t&2){const i=s.\u0275\u0275reference(2);s.\u0275\u0275property("ngIf",n.loading)("ngIfElse",i)}},dependencies:[M.NgIf,M.NgStyle,M.NgSwitch,M.NgSwitchCase,M.NgSwitchDefault,Gt,Ke],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block}.crt-label.light[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-weight:300}.crt-label.normal[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-weight:400}.crt-label.semibold[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-weight:600}.crt-label.bold[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-weight:700}.crt-label.default[_ngcontent-%COMP%]{font-weight:unset}.crt-label[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .crt-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .crt-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .crt-label[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .crt-label[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin:0}.crt-label[_ngcontent-%COMP%]   .ellipsis[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;display:block}.crt-label[_ngcontent-%COMP%]:first-child[required]{display:flex}.crt-label[_ngcontent-%COMP%]:first-child[required]:after{content:"\\a0*"}'],changeDetection:0})}};(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],pt.prototype,"labelBackgroundColor",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String)],pt.prototype,"labelTextAlign",void 0),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],pt.prototype,"headingLevel",null),(0,u.__decorate)([A(),(0,u.__metadata)("design:type",String),(0,u.__metadata)("design:paramtypes",[String])],pt.prototype,"labelElementType",null),pt=(0,u.__decorate)([os({type:"crt.Label",reuseStrategy:At.Reuse}),bu({toolbarConfig:{position:40,icon:y(3099),defaultPropertyValues:{caption:"",labelType:"headline-1",labelThickness:"default",labelEllipsis:!1,labelColor:Su.Auto,labelBackgroundColor:"transparent",labelTextAlign:"start",headingLevel:"label"},defaultLocalizableStrings:{caption:"Components.Label.Caption"}},designViewItemCommands:{update:"crt.LabelChangeViewItemCommand"},propertiesPanelComponentTypeName:"crt.LabelPropertiesPanel",viewElementGroupType:as.Components,typeCaption:"Components.Label.Caption",placeholderSize:{height:"20px"}})],pt);let Co=class Md{static{this.\u0275fac=function(t){return new(t||Md)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Md})}static{this.\u0275inj=s.\u0275\u0275defineInjector({imports:[M.CommonModule,Ht,an]})}};Co=(0,u.__decorate)([da({viewElements:[pt]})],Co),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Co,{declarations:[pt],imports:[M.CommonModule,Ht,an],exports:[pt]})}();class x0{open(e,t){return(0,l.of)({})}}class E0{open(e){return(0,l.of)({})}}class bo{constructor(e,t){this.dialog=e,this.data=t}static{this.\u0275fac=function(t){return new(t||bo)(s.\u0275\u0275directiveInject(R.MatDialogRef),s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA,8))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:bo})}}const I0=[[["","content",""]],[["","actions",""]],[["","title",""]]],A0=["[content]","[actions]","[title]"];function P0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div",6),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd()),o&2){const t=s.\u0275\u0275nextContext();s.\u0275\u0275attribute("title",t.title),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(2,2,t.title))}}function T0(o,e){o&1&&s.\u0275\u0275projection(0,2)}function D0(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",7),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView(t);const i=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(i.onCloseButtonClick())}),s.\u0275\u0275elementEnd()}o&2&&s.\u0275\u0275property("title",s.\u0275\u0275pipeBind1(1,1,"Dialog.Close"))}class ln extends bo{constructor(){super(...arguments),this.displayCloseButton=!1}onCloseButtonClick(){var e=this;return(0,b.A)(function*(){(!e.canCloseFn||(yield e.canCloseFn()))&&e.dialog.close()})()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(ln)))(n||ln)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:ln,selectors:[["crt-dialog"]],inputs:{title:"title",displayCloseButton:"displayCloseButton",canCloseFn:"canCloseFn"},features:[s.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:A0,decls:9,vars:3,consts:[["content",""],["mat-dialog-title","",1,"crt-dialog-title"],["class","title",4,"ngIf","ngIfElse"],["size","medium","icon","close-button-icon","iconPosition","only-icon","class","crt-dialog-close-button",3,"title","clicked",4,"ngIf"],["mat-dialog-content","",1,"crt-dialog-content"],["mat-dialog-actions","",1,"crt-dialog-actions"],[1,"title"],["size","medium","icon","close-button-icon","iconPosition","only-icon",1,"crt-dialog-close-button",3,"clicked","title"]],template:function(t,n){if(t&1&&(s.\u0275\u0275projectionDef(I0),s.\u0275\u0275elementStart(0,"div",1),s.\u0275\u0275template(1,P0,3,4,"div",2)(2,T0,1,0,"ng-template",null,0,s.\u0275\u0275templateRefExtractor)(4,D0,2,3,"crt-button",3),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"div",4),s.\u0275\u0275projection(6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(7,"div",5),s.\u0275\u0275projection(8,1),s.\u0275\u0275elementEnd()),t&2){const i=s.\u0275\u0275reference(3);s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",n.title)("ngIfElse",i),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",n.displayCloseButton)}},dependencies:[M.NgIf,rn,R.MatDialogTitle,R.MatDialogActions,R.MatDialogContent,T.TranslatePipe],styles:["[_nghost-%COMP%]{flex:1;display:flex;flex-direction:column}.crt-dialog-title[_ngcontent-%COMP%]{display:flex}.crt-dialog-title[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin-bottom:16px}.crt-dialog-title[_ngcontent-%COMP%]   .crt-dialog-close-button[_ngcontent-%COMP%]{margin-inline-start:auto}.crt-dialog-content[_ngcontent-%COMP%]{flex:1}.crt-dialog-actions[_ngcontent-%COMP%]{justify-content:end}"],changeDetection:0})}}var Ka;(function(o){o.Block="block",o.PlainText="plain-text",o.Divider="divider"})(Ka||(Ka={}));const vo=o=>({item:o});function O0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementContainer(1,8),s.\u0275\u0275elementContainerEnd()),o&2){const t=e.$implicit;s.\u0275\u0275nextContext();const n=s.\u0275\u0275reference(13);s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(2,vo,t))}}function R0(o,e){if(o&1){const t=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"crt-button",9),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275listener("clicked",function(){const i=s.\u0275\u0275restoreView(t).$implicit,r=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(r.onActionSelected(i.key))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(o&2){const t=e.$implicit,n=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("size",t.config.size)("shape",t.config.shape||n.defaultActionShape)("color",t.config.color)("title",t.config.title)("caption",s.\u0275\u0275pipeBind1(2,15,t.config.caption))("displayType",t.config.displayType)("ariaLabel",t.config.ariaLabel)("textTransform",t.config.textTransform)("disabled",t.config.disabled)("disableRipple",t.config.disableRipple)("icon",t.config.icon)("iconPosition",t.config.iconPosition)("menuItems",t.config.menuItems)("loading",t.config.loading)("clickMode",t.config.clickMode||"default")}}function j0(o,e){if(o&1&&s.\u0275\u0275element(0,"mat-divider"),o&2){const t=e.item;s.\u0275\u0275classMap(t.classes)}}function k0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"span",10),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd()),o&2){const t=e.item;s.\u0275\u0275property("ngClass",t.classes),s.\u0275\u0275advance(),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(2,2,t.message))}}function N0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275elementContainer(1,8),s.\u0275\u0275elementEnd()),o&2){const t=e.$implicit;s.\u0275\u0275nextContext(3);const n=s.\u0275\u0275reference(13);s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(2,vo,t))}}function V0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",16),s.\u0275\u0275template(2,N0,2,4,"div",6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()),o&2){const t=s.\u0275\u0275nextContext().item;s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",t.content)}}function L0(o,e){if(o&1&&(s.\u0275\u0275elementStart(0,"div",11)(1,"div",12),s.\u0275\u0275element(2,"mat-icon",13),s.\u0275\u0275elementStart(3,"span",14),s.\u0275\u0275text(4),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275template(6,V0,3,1,"ng-container",15),s.\u0275\u0275elementEnd()),o&2){const t=e.item;s.\u0275\u0275property("ngClass",t.classes),s.\u0275\u0275advance(2),s.\u0275\u0275property("svgIcon",t.icon),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(5,4,t.title)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",(t.content==null?null:t.content.length)>0)}}function B0(o,e){if(o&1&&s.\u0275\u0275elementContainer(0,8),o&2){const t=s.\u0275\u0275nextContext().item;s.\u0275\u0275nextContext();const n=s.\u0275\u0275reference(9);s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(2,vo,t))}}function F0(o,e){if(o&1&&s.\u0275\u0275elementContainer(0,8),o&2){const t=s.\u0275\u0275nextContext().item;s.\u0275\u0275nextContext();const n=s.\u0275\u0275reference(7);s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(2,vo,t))}}function z0(o,e){if(o&1&&s.\u0275\u0275elementContainer(0,8),o&2){const t=s.\u0275\u0275nextContext().item;s.\u0275\u0275nextContext();const n=s.\u0275\u0275reference(11);s.\u0275\u0275property("ngTemplateOutlet",n)("ngTemplateOutletContext",s.\u0275\u0275pureFunction1(2,vo,t))}}function U0(o,e){if(o&1&&(s.\u0275\u0275elementContainerStart(0,17),s.\u0275\u0275template(1,B0,1,4,"ng-container",18)(2,F0,1,4,"ng-container",18)(3,z0,1,4,"ng-container",18),s.\u0275\u0275elementContainerEnd()),o&2){const t=e.item,n=s.\u0275\u0275nextContext();s.\u0275\u0275property("ngSwitch",t.type),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase",n.detailedDialogContentType.PlainText),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase",n.detailedDialogContentType.Divider),s.\u0275\u0275advance(),s.\u0275\u0275property("ngSwitchCase",n.detailedDialogContentType.Block)}}class Qn extends bo{constructor(e,t,n){super(e,t),this.detailedDialogContentType=Ka,this.messageContent=this._adjustContent(t),this.defaultActionShape=n?"rounded":"default"}_adjustContent(e){const t=e?.message;return typeof t=="string"?[{type:Ka.PlainText,message:t}]:t??[]}onActionSelected(e){this.dialog.close(e)}static{this.\u0275fac=function(t){return new(t||Qn)(s.\u0275\u0275directiveInject(R.MatDialogRef),s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA,8),s.\u0275\u0275directiveInject(Zt,8))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Qn,selectors:[["crt-message-dialog"]],features:[s.\u0275\u0275InheritDefinitionFeature],decls:14,vars:5,consts:[["divider",""],["plainText",""],["block",""],["content",""],[3,"title"],[1,"crt-dialog-message-content",3,"id"],[4,"ngFor","ngForOf"],["actions",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"clicked","size","shape","color","title","caption","displayType","ariaLabel","textTransform","disabled","disableRipple","icon","iconPosition","menuItems","loading","clickMode"],[3,"ngClass"],[1,"crt-dialog-message-content-block",3,"ngClass"],[1,"crt-dialog-message-content-block-title"],[1,"crt-dialog-message-content-block-title-icon",3,"svgIcon"],[1,"crt-dialog-message-content-block-title-label"],[4,"ngIf"],[1,"crt-dialog-message-content-block-content"],[3,"ngSwitch"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngSwitchCase"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"crt-dialog",4),s.\u0275\u0275elementContainerStart(1,3),s.\u0275\u0275elementStart(2,"div",5),s.\u0275\u0275template(3,O0,2,4,"ng-container",6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd(),s.\u0275\u0275elementContainerStart(4,7),s.\u0275\u0275template(5,R0,3,17,"ng-container",6),s.\u0275\u0275elementContainerEnd(),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(6,j0,1,2,"ng-template",null,0,s.\u0275\u0275templateRefExtractor)(8,k0,3,4,"ng-template",null,1,s.\u0275\u0275templateRefExtractor)(10,L0,7,6,"ng-template",null,2,s.\u0275\u0275templateRefExtractor)(12,U0,4,4,"ng-template",null,3,s.\u0275\u0275templateRefExtractor)),t&2&&(s.\u0275\u0275property("title",n.data==null?null:n.data.title),s.\u0275\u0275advance(2),s.\u0275\u0275property("id",n.data==null?null:n.data.messageContentId),s.\u0275\u0275attribute("data-item-marker","message"),s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",n.messageContent),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",n.data==null?null:n.data.actions))},dependencies:[M.NgClass,M.NgForOf,M.NgIf,M.NgTemplateOutlet,M.NgSwitch,M.NgSwitchCase,rn,Ne.MatDivider,Z.MatIcon,ln,T.TranslatePipe],styles:[".crt-dialog-message-content[_ngcontent-%COMP%]{display:flex;align-items:stretch;flex-flow:column;justify-content:flex-start;gap:16px;margin-bottom:20px;padding-bottom:4px;white-space:pre-line;max-height:70vh;overflow-y:auto;word-break:break-word}.crt-dialog-message-content-block[_ngcontent-%COMP%]{display:flex;align-items:stretch;flex-flow:column;justify-content:flex-start;padding:12px 16px 16px;border-radius:8px}.crt-dialog-message-content-block[_ngcontent-%COMP%]   .crt-dialog-message-content-block-title[_ngcontent-%COMP%]{display:flex;align-items:stretch;flex-flow:row;justify-content:flex-start;gap:8px}.crt-dialog-message-content-block[_ngcontent-%COMP%]   .crt-dialog-message-content-block-title-icon[_ngcontent-%COMP%]{height:16px;width:16px}"],changeDetection:0})}}const $0=new s.InjectionToken("Modal overlay background component ID");class G0{constructor(e){this._sysSettingsService=e}_getSysSettingValues(e){return Object.keys(e).reduce((t,n)=>(t[n]=e[n].value,t),{})}_getResultFromResponse(e){if(!e.success){const r=e.errorInfo?.message??"Unknown";throw new Error("Error while receiving system settings: "+r)}const t={...this._sysSettingsSnapshot,...e.values};this._sysSettingsSnapshot=t;const n=this._getSysSettingValues(t),i=this.mapSysSettingValues(n);return this._cachedResult=i,i}_buildResultObservable(){const e=this.getSysSettingCodes();return(0,l.merge)((0,l.of)(e),this._sysSettingsService.sysSettingsChanged$).pipe((0,l.mergeMap)(t=>{const n=e.filter(r=>t.includes(r));return this._sysSettingsSnapshot===void 0||this._cachedResult===void 0||n.length!==0?this._sysSettingsService.getByCodes(n).pipe((0,l.map)(r=>this._getResultFromResponse(r))):(0,l.of)(this._cachedResult)}),(0,l.shareReplay)({refCount:!1}))}getConfig(){return this._cache$||(this._cache$=this._buildResultObservable()),this._cache$}}var H0=y(19350);const W0="crt-images-cache";var un;(function(o){o.Color="Color",o.Image="Image",o.AccessibleColor="AccessibleColor"})(un||(un={}));const Z0="#FFFFFF",Y0="#0D2E4E";class ps extends G0{constructor(e,t,n,i,r,a){super(e),this._applicationRef=t,this._document=n,this._featureValues=i,this._cacheManager=r,this._measurePerformanceService=a,this._reducingBlurQuality=50,this._contentDisplayed$=new l.ReplaySubject(1),this.contentDisplayed=!1}_getDefaultImage(){return y(95339)}getSysSettingCodes(){return["CrtBackgroundConfig","UseAccessibleDesktopColor"]}mapSysSettingValues(e){const t=e.CrtBackgroundConfig,n=e.UseAccessibleDesktopColor,i=t?JSON.parse(t):{};return{imageUrl:i.imageId?ru(i.imageId):this._getDefaultImage(),color:i?.color,accessibleColor:i?.accessibleColor,mode:n?un.AccessibleColor:i?.mode}}static isImageMode(e,t=!0){const{mode:n,color:i}=e;return n?n===un.Image:i?!1:e.imageId||e.imageUrl?!0:t}static getBackgroundMode(e){switch(!0){case(ps.isImageMode(e,!1)&&!(0,v.isEmpty)(e?.imageUrl)):return un.Image;case e.mode===un.AccessibleColor:return un.AccessibleColor;default:return un.Color}}static getImageStyle(e){return e?.imageUrl?{"background-image":`url(${e.imageUrl})`}:{}}static getColorStyle(e){return{"background-color":e.color||Z0}}static getAccessibleColorStyle(e){return{"background-color":e.accessibleColor||Y0}}createBlurredVersion(e,t){var n=this;return(0,b.A)(function*(){const i=yield n._cacheManager.get(W0),r=!n._featureValues?.DisableBackgroundOptimization,a=r&&(yield n._measurePerformanceService.measureCallback("AppBackgroundService: get background image from cache",()=>i.get(e.src)));if(a)return Promise.resolve(a);r||(n._reducingBlurQuality=1);const c=n._document.createElement("canvas");c.width=e.naturalWidth/n._reducingBlurQuality,c.height=e.naturalHeight/n._reducingBlurQuality,c.getContext("2d").drawImage(e,0,0,c.width,c.height),H0.canvasRGBA(c,0,0,c.width,c.height,t/n._reducingBlurQuality);const p=c.toDataURL();return r&&(yield n._measurePerformanceService.measureCallback("AppBackgroundService: set background image to cache",()=>i.set(e.src,p))),p})()}setContentDisplayed(){this._contentDisplayed$.next(),this.contentDisplayed=!0}waitContentDisplayed$(){return this._contentDisplayed$.pipe((0,d.switchMap)(()=>this._applicationRef.isStable),(0,d.filter)(Boolean),(0,l.map)(()=>{}),(0,d.take)(1))}static{this.\u0275fac=function(t){return new(t||ps)(s.\u0275\u0275inject(la),s.\u0275\u0275inject(s.ApplicationRef),s.\u0275\u0275inject(M.DOCUMENT),s.\u0275\u0275inject(Q,8),s.\u0275\u0275inject(Ce),s.\u0275\u0275inject(q))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ps,factory:ps.\u0275fac,providedIn:"root"})}}class ei{constructor(e,t,n,i){this.dialog=e,this._document=t,this._modalOverlayBackgroundComponentId=n,this._appBackgroundService=i}_getOverlayBackground(){const e=this._modalOverlayBackgroundComponentId;return e&&this._document.getElementById(e)}_useBackgroundOverlay(e){return!e.backdropClass&&this._getOverlayBackground()!=null}_getOverlayBackdropElement(e){return e._ref.overlayRef.backdropElement}_waitContentDisplayed(){return this._appBackgroundService.waitContentDisplayed$().pipe((0,d.take)(1))}_addBackgroundOverlay(e){var t=this;return(0,b.A)(function*(){t._appBackgroundService.contentDisplayed||(yield(0,l.lastValueFrom)(t._waitContentDisplayed()));const i=t._getOverlayBackground().cloneNode(!0);t._getOverlayBackdropElement(e).appendChild(i)})()}hideModal(e){this._getOverlayBackdropElement(e)?.classList?.add("cdk-overlay-empty-backdrop-hidden"),e.addPanelClass("modal-container-hidden")}restoreModal(e){this._getOverlayBackdropElement(e)?.classList?.remove("cdk-overlay-empty-backdrop-hidden"),e.removePanelClass("modal-container-hidden")}open(e,t={}){const n=this._useBackgroundOverlay(t);n&&(t.backdropClass="cdk-overlay-empty-backdrop");const i=this.dialog.open(e,t);return n&&this._addBackgroundOverlay(i).then(),i}static{this.\u0275fac=function(t){return new(t||ei)(s.\u0275\u0275inject(R.MatDialog),s.\u0275\u0275inject(M.DOCUMENT),s.\u0275\u0275inject($0,8),s.\u0275\u0275inject(ps))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:ei,factory:ei.\u0275fac})}}let ms=class Tc{constructor(e,t,n){this.document=e,this._ngZone=t,this._modalProvider=n}_stopEventPropagation(e,t){e.afterOpened().pipe((0,d.takeUntil)(t)).subscribe(n=>{const r=this.document.getElementsByClassName("cdk-overlay-container")[0];r&&r.addEventListener("click",function(a){a.stopImmediatePropagation()})})}_createDialogConfig(e){const{panelClass:t}=e||{},n=Array.isArray(t)?t:[t];return{...e,panelClass:["crt-dialog",...n]}}open(e,t){return this._ngZone.run(()=>{const n=this._createDialogConfig(t),i=this._modalProvider.open(e,n),r=i.afterClosed();return this._stopEventPropagation(i,r),r})}openDialog(e){const t={panelClass:["crt-message-dialog"],data:{title:e.title,message:e.message,actions:e.actions}};return(0,l.lastValueFrom)(this.open(Qn,t))}static{this.\u0275fac=function(t){return new(t||Tc)(s.\u0275\u0275inject(M.DOCUMENT),s.\u0275\u0275inject(s.NgZone),s.\u0275\u0275inject(ei))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:Tc,factory:Tc.\u0275fac})}};ms=(0,u.__decorate)([Xe({requestType:"crt.DialogService"}),(0,u.__metadata)("design:paramtypes",[Document,s.NgZone,ei])],ms);const Mu={OK:{key:"OK",config:{color:"default",caption:"Dialog.Ok"}},YES:{key:"YES",config:{color:"primary",caption:"Dialog.Yes"}},NO:{key:"NO",config:{color:"default",caption:"Dialog.No"}},SAVE:{key:"SAVE",config:{color:"primary",caption:"Dialog.Save"}},DO_NOT_SAVE:{key:"DO_NOT_SAVE",config:{color:"default",caption:"Dialog.DoNotSave"}},CANCEL:{key:"CANCEL",config:{color:"default",caption:"Dialog.Cancel"}},CLEAR:{key:"CLEAR",config:{color:"primary",caption:"Dialog.Clear"}},DELETE:{key:"DELETE",config:{color:"primary",caption:"Dialog.Delete"}},RESTORE:{key:"RESTORE",config:{color:"primary",caption:"Dialog.Restore"}},OVERWRITE:{key:"OVERWRITE",config:{color:"primary",caption:"Dialog.Overwrite"}}},K0=new Map([["info","crt-dialog-info"],["error","crt-dialog-error"],["success","crt-dialog-success"],["none",""]]);class gs{constructor(e,t){this._dialogProvider=e,this._translateService=t,this._notificationMessage=this._translateService.instant("Dialog.Notification")}_normalizeConfig(e){return typeof e=="string"?{data:{message:e}}:e}_open(e,t){const n=this._normalizeConfig(t),{data:i,panelClass:r,ariaLabel:a,ariaDescribedBy:c}=n,h=Array.isArray(r)?r:[r],p=K0.get(e),m=L(),f={...n,data:{...i,actions:i?.actions??[Mu.OK],messageContentId:m},ariaLabel:a||i?.title||this._notificationMessage,ariaDescribedBy:c||m,panelClass:["crt-message-dialog",p,...h]};return this._dialogProvider.open(Qn,f)}open(e){return this._open(e?.type||"info",(0,v.omit)(e,"type"))}info(e){return this._open("info",e)}error(e){return this._open("error",e)}success(e){return this._open("success",e)}confirmation(e){const t=this._normalizeConfig(e),n=t.data?.approveAction||Mu.YES,i=t.data?.rejectAction||Mu.NO,r={...t,data:{...(0,v.omit)(t.data,["approveAction","rejectAction"]),actions:[i,n]}};return this.open(r).pipe((0,l.map)(a=>a===n.key))}static{this.\u0275fac=function(t){return new(t||gs)(s.\u0275\u0275inject(ms),s.\u0275\u0275inject(T.TranslateService))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:gs,factory:gs.\u0275fac})}}class fs{static{this.\u0275fac=function(t){return new(t||fs)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:fs})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[ms,gs,ei,{provide:x0,useClass:ms},{provide:E0,useClass:gs},{provide:ai.FocusTrapFactory,useClass:ai.ConfigurableFocusTrapFactory}],imports:[M.CommonModule,Xn,R.MatDialogModule,T.TranslateModule,Ne.MatDividerModule,Z.MatIconModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(fs,{declarations:[ln,Qn],imports:[M.CommonModule,Xn,R.MatDialogModule,T.TranslateModule,Ne.MatDividerModule,Z.MatIconModule],exports:[ln,Qn]})})();let Ja=class{constructor(e){this.config=e}getElements(){return{}}};Ja=(0,u.__decorate)([(0,u.__param)(0,V("config")),(0,u.__metadata)("design:paramtypes",[Object])],Ja);var J0=y(41666),q0=y(20418),X0=y(39255),Q0=y(54100),ev=y(95576),tv=y(85284),nv=y(26316),iv=y(78768),sv=y(54559),tm=y(46902),rv=y(50317),ov=y(50101),av=y(77648),cv=y(79691),lv=y(85868),uv=y(76357),dv=y(25342),hv=y(88729),pv=y(56773),mv=y(28400),gv=y(23550),fv=y(64916),_v=y(32959),yv=y(81284),Cv=y(43537);function Te(){return function(o,e,t){const n=t.value;t.value=function(){return this.isReadOnly?!1:n.apply(this,arguments)}}}let fe=class extends Cv.A{constructor(e,t){super(e),this.isReadOnly=!1,this.isReadOnly=t.isReadOnly}canConnect(e,t){return e.type!==je.root&&e.type!==je.connection&&t.type!==je.root&&t.type!==je.connection}addRule(e,t){super.addRule(e,t)}init(){super.addRule("connection.create",this.canConnectionCreate.bind(this)),super.addRule("connection.reconnect",this.canReconnect.bind(this)),super.addRule("elements.move",this.canElementMove.bind(this)),super.addRule("shape.create",this.canElementMove.bind(this)),super.addRule("elements.create",this.canElementMove.bind(this)),super.addRule("shape.resize",this.canElementResize.bind(this)),super.addRule("element.copy",this.canElementCopy.bind(this)),super.addRule("element.paste",this.canElementPaste.bind(this)),super.addRule("elements.delete",this.canElementsDelete.bind(this)),super.addRule("canOpenContextPad",this.canOpenContextPad.bind(this)),super.addRule("canShowConnectionOutline",this.canShowConnectionOutline.bind(this)),super.addRule("canConnectionSegmentMove",this.canConnectionSegmentMove.bind(this)),super.addRule("canLabelEdit",this.canLabelEdit.bind(this)),super.addRule("canShowPalette",this.canShowPalette.bind(this)),super.addRule("canShowLabelOutline",this.canShowLabelOutline.bind(this)),super.addRule("canElementMarkerUpdate",this.canElementMarkerUpdate.bind(this)),super.addRule("element.canUpdateType",this.canElementUpdateType.bind(this)),super.addRule("connection.updateWaypoints",this.canConnectionUpdateWaypoints.bind(this))}canElementMarkerUpdate(){return!0}canShowLabelOutline(){return!0}canConnectionSegmentMove(){return!0}canShowPalette(){return!0}canLabelEdit(){return!0}canShowConnectionOutline(){return!0}canOpenContextPad(){return!0}canConnectionCreate(e){return this.canConnect(e.target,e.source)}canReconnect(e){if(G.isRoot(e.target)||G.isRoot(e.source))return!1;switch(e.type){case"reconnectEnd":return this.canReconnectEnd(e);case"reconnectStart":return this.canReconnectStart(e);default:return this.canReconnectEnd(e)||this.canReconnectStart(e)}}canReconnectStart(e){return this.canConnect(e.target,e.source)}canReconnectEnd(e){return this.canConnect(e.target,e.source)}canElementMove(e){return!0}canElementResize(e){return!1}canElementCopy(e){return!0}canElementPaste(e){return!0}canElementsDelete(e){return!0}canElementUpdateType(e){return!0}canConnectionUpdateWaypoints(){return!1}};(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementMarkerUpdate",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canConnectionSegmentMove",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canShowPalette",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canLabelEdit",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canShowConnectionOutline",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canOpenContextPad",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canConnectionCreate",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",Boolean)],fe.prototype,"canReconnect",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementMove",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementResize",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementCopy",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementPaste",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementsDelete",null),(0,u.__decorate)([Te(),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object]),(0,u.__metadata)("design:returntype",void 0)],fe.prototype,"canElementUpdateType",null),fe=(0,u.__decorate)([(0,u.__param)(0,V("eventBus")),(0,u.__param)(1,V("config")),(0,u.__metadata)("design:paramtypes",[Object,Object])],fe);var bv=y(6513);const _e={MIN:100,LOW:500,MEDIUM:1e3,HIGH:1500,MAX:5e3};let qa=class extends bv.A{constructor(e,t,n,i,r,a){super(e,t,n,i,r),this.eventBus=e,this.canvas=t,this.interactionEvents=n,this.bendpointMove=i,this.connectionSegmentMove=r,this.rules=a,e.on("element.marker.update",_e.HIGH,this.onElementMarkerUpdate.bind(this))}onElementMarkerUpdate(e){this.rules.allowed("canElementMarkerUpdate")||(e.element={})}getConnectionBendpointsFilter(e,t,n){return t===0||t===n.length-1}};qa=(0,u.__decorate)([(0,u.__param)(0,V("eventBus")),(0,u.__param)(1,V("canvas")),(0,u.__param)(2,V("interactionEvents")),(0,u.__param)(3,V("bendpointMove")),(0,u.__param)(4,V("connectionSegmentMove")),(0,u.__param)(5,V("rules")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],qa);var wu=y(69034),x=y(87004);let xu=class extends wu.A{constructor(e,t,n,i){super(e,t,n,i),this._canvas=e,this._eventBus=t,this._graphicsFactory=n,this._elementRegistry=i,t.on(["canvas.init"],r=>this.onInit(r))}onInit(e){const t=(0,x.vt)("defs");(0,x.BC)(e.svg,t)}zoom(e,t){const n=super.zoom(e,t);return this._eventBus.fire("zoom.changed",n),n}bringToFrontElement(e){const n=this._elementRegistry.getGraphics(e).parentNode,i=n.parentNode;i.removeChild(n),i.appendChild(n)}};xu=(0,u.__decorate)([(0,u.__param)(0,g("config.canvas")),(0,u.__param)(1,g("eventBus")),(0,u.__param)(2,g("graphicsFactory")),(0,u.__param)(3,g("elementRegistry")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object])],xu);var vv=y(17389);let Eu=class extends vv.A{constructor(e,t){super(e,t),this.eventBus=e}undo(){this.eventBus.fire("undo")}redo(){this.eventBus.fire("redo")}};Eu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("injector")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Eu);let Xa=class{constructor(e,t,n,i,r){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.config=i,this.diagramUtils=r,this.highlightClassName="animated",this.subscribeEvents()}get supportHighlight(){return this.config.isReadOnly}onSelectionChanged(e){const{newSelection:t,oldSelection:n}=e;n.forEach(i=>this.changeConnectionSelection(i,!1)),t.forEach(i=>this.changeConnectionSelection(i,!0))}changeConnectionSelection(e,t){const n=this.elementRegistry.filter(i=>i.source===e||i.target===e);n.forEach(i=>{t?this.canvas.addMarker(i,this.highlightClassName):this.canvas.removeMarker(i,this.highlightClassName)}),this.bringToFront(n,e)}bringToFrontElement(e){this.canvas.bringToFrontElement(e)}subscribeEvents(){this.supportHighlight&&this.eventBus.on(["selection.changed"],_e.LOW,e=>this.onSelectionChanged(e))}bringToFront(e,t){e.forEach(i=>this.bringToFrontElement(i)),this.elementRegistry.filter(i=>!this.diagramUtils.isConnection(i)).forEach(i=>this.bringToFrontElement(i)),this.bringToFrontElement(t)}};Xa=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__param)(2,g("elementRegistry")),(0,u.__param)(3,g("config")),(0,u.__param)(4,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,G])],Xa);var Sv=y(28012);let Iu=class extends Sv.A{constructor(e,t,n,i){super(e,t,n,i),this._injector=e,this._canvas=t,this._graphicsFactory=n,this._elementFactory=i}createNoopConnection(e,t){const n=(0,x.vt)("polyline");return(0,x.CF)(n,{stroke:"#8095b3",strokeWidth:2}),(0,x.CF)(n,{points:[e.x,e.y,t.x,t.y]}),n}};Iu=(0,u.__decorate)([(0,u.__param)(0,g("injector")),(0,u.__param)(1,g("canvas")),(0,u.__param)(2,g("graphicsFactory")),(0,u.__param)(3,g("elementFactory")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object])],Iu);var Mv=y(45041),wv=y(84919),F=y(98218),I=y(52687),xv=y(44156);let dn=class extends xv.A{constructor(e,t,n){super({style:v.cloneDeep(ke.label.editStyle)}),this.config=e,this.elements=t,this.diagramUtils=n,this.style=v.cloneDeep(ke.label.editStyle)}getElementLabelPosition(e,t){return t.delta?{x:Math.round(e.x+t.delta.x+t.width/2),y:Math.round(e.y+t.delta.y+t.height/2)}:{x:Math.round(e.x+e.width/2),y:Math.round(e.y+e.height+ke.label.height/2)}}layoutToFirstLine(e,t){const i=e[0].textContent,r=super.layoutText(i,t);return r.element.children[0].textContent=i.substring(0,i.length-3)+"...",r}layoutRtlText(e,t){const n=e.element.children||[];n.length>1&&(e=this.layoutToFirstLine(n,t)),e.element.style.direction="rtl";const i=e.element.children||[];for(const r of i)r.style.direction="ltr";return e}getLabelPaddingTop(e,t){return 7}isIEOrEdge(){return/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)}applySvgHelperContent(e,t){const n=this.isEmptyText(t)?"dummy":t;e.textContent=n}createForeignText(e,t,n){const i=document.createElement("div"),r=`color: ${v.get(n,"style.fill","initial")}`;return i.setAttribute("class","foreign-text"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),i.setAttribute("style",`width: ${t}px; ${r}`),i.textContent=e,i}createForeignTextContainer(e,t,n){const i=document.createElement("div");i.setAttribute("class","foreign-text-container"),i.setAttribute("xmlns","http://www.w3.org/1999/xhtml");const r=this.createForeignText(e,t,n);return i.append(r),i}createForeignObject(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),i=e.height,r=e.width;n.setAttribute("height",i.toString()),n.setAttribute("width",r.toString());const a=this.createForeignTextContainer(e.text,e.width,t);return n.append(a),n}getTextLayout(e,t){const n=(0,F.assign)({},{},t.box);let i={height:n.height,width:n.width,text:e};if(t.needRecalcDimensions){const r=i.height===void 0?i.width:null,a=this.getHelperSvg(r);i={...this.getTextBBox(e,a),text:e},(0,I.remove)(a)}return i}getLabelOptions(e){return{box:{x:Math.round(e.width/2+e.x),y:Math.round(e.height/2+e.y),width:e.width||ke.label.width,height:e.height},style:{direction:"ltr",...this.style}}}getHelperSvg(e){let t=document.getElementById("helper-svg");return t||(t=document.createElement("div"),t.setAttribute("id","helper-svg"),t.setAttribute("class","foreign-text foreign-text-helper"),e&&t.setAttribute("style",`max-width: ${e}px`),document.body.appendChild(t)),t}getTextBBox(e,t){this.applySvgHelperContent(t,e);const n=t.getBoundingClientRect();return{width:this.isEmptyText(e)?0:n.width,height:n.height}}getDimensions(e,t){return t.needRecalcDimensions=!0,this.layoutText(e,t).dimensions}createText(e,t){return super.createText(e,t)}layoutText(e,t){if(this.isIEOrEdge()){const r=super.layoutText(e,t);return this.config.isRtl?this.layoutRtlText(r,t):r}const n=this.getTextLayout(e,t),i=this.createForeignObject(n,t);return{dimensions:{width:n.width,height:n.height},element:i}}getConnectionLabelPosition(e,t){const n=Math.floor(e.length/2-1),i=e[n],r=e[n+1],a={x:Math.round((r.x-i.x)/2),y:Math.round((r.y-i.y)/2)},c=i.x+a.x;let h=i.y+a.y;return i.y===r.y&&(h+=Math.round(t.height/2)+5),{x:c,y:h}}getLabelBounds(e,t){const n=this.getLabelOptions(e),i=this.getDimensions(t,n);return{height:i.height,width:i.width,x:Math.round(e.x+e.width/2-i.width/2),y:Math.round(e.y)}}isEmptyText(e){return!e||!e.trim()}resetLabelPosition(e){const{width:i,height:r}=this.getLabelBounds(e,e.labelTarget.caption);e.width=i,e.height=r;const a=e.parent;e.x=Math.round(a.x+a.width/2-e.width/2),e.y=Math.round(a.y+a.height+ke.label.height/2)-1*2-1}addLabel(e,t,n,i=t.caption){if(!this.isEmptyText(i)){const r=this.getLabelPosition(t,n);r.y+=this.getLabelPaddingTop(t,n.delta);const a={id:Yd.Guid.create().toString(),getDimensions:!0,...v.pick(n,["type","width","height"])};e.createLabel(t,r,a)}}getLabelPosition(e,t=ke.label){return this.diagramUtils.isConnection(e)?this.getConnectionLabelPosition(e.waypoints,t):this.getElementLabelPosition(e,t)}};dn=(0,u.__decorate)([(0,u.__param)(0,g("config")),(0,u.__param)(1,g("elements")),(0,u.__param)(2,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,ie,G])],dn);let Au=class{constructor(e,t){this.modeling=e,this.diagramText=t}setText(e,t){const n=e.label||e,i=e.labelTarget||e;return i.caption=t,[n,i]}preExecute(e){const t=e.element;t&&!t.label&&!G.isLabel(t)&&this.diagramText.addLabel(this.modeling,t,ke.label,e.text)}execute(e){e.oldText=e.element.caption||"";const t=(e.text||"").trim();return this.setText(e.element,t)}revert(e){return this.setText(e.element,e.oldText)}resizeShape(e,t){this.modeling.resizeShape(e,t,{height:0,width:0})}postExecute(e){const t=e.element.label;if(!t)return;const n=this.diagramText;if(n.isEmptyText(e.text))this.modeling.removeShape(t,{unsetLabel:!1});else{const i=t.labelTarget.caption;if(i){const r=e.newBounds||n.getLabelBounds(t,i);this.resizeShape(t,r)}}}};Au=(0,u.__decorate)([(0,u.__param)(0,g("modeling")),(0,u.__param)(1,g("diagramText")),(0,u.__metadata)("design:paramtypes",[Object,dn])],Au);var Ev=y(2050);class Qa{constructor(e){this.utils=e}_setAbsolutePosition(e,t,n){if(n.includes(e.id)||v.isUndefined(e.rx)||v.isUndefined(e.ry))return;const i=e.parent;let r=t.elements[i]||t.connections[i];r?(this.utils.isConnection(r)&&(r=t.elements[r.source]),this._setAbsolutePosition(r,t,n),e.x=r.x+e.rx,e.y=r.y+e.ry):(e.x=e.rx,e.y=e.ry),n.push(e.id)}setRelativePosition(e,t=null){let n=t||e.labelTarget||e.parent;n.id===bi.root.id?(e.rx=e.x,e.ry=e.y):(this.utils.isConnection(n)&&(n=n.source),e.rx=e.x-n.x,e.ry=e.y-n.y)}setShapeAbsolutePosition(e,t=null){let n=t||e.labelTarget||e.parent;n.id===bi.root.id?(v.isUndefined(e.rx)||(e.x=e.rx),v.isUndefined(e.ry)||(e.y=e.ry)):(this.utils.isConnection(n)&&(n=n.source),v.isUndefined(e.rx)||(e.x=n.x+e.rx),v.isUndefined(e.ry)||(e.y=n.y+e.ry))}setAbsolutePosition(e){if(!e)return;const t=[];v.forEach(e.elements,n=>{this._setAbsolutePosition(n,e,t)}),v.forEach(e.labels,n=>{this._setAbsolutePosition(n,e,t)})}}let Pu=class extends Ev.A{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new Qa(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t),t}};Pu=(0,u.__decorate)([(0,u.__param)(0,g("canvas")),(0,u.__param)(1,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Pu);var Iv=y(34635);let Tu=class extends Iv.A{constructor(e,t){super(e),this.canvas=e,this.diagramUtils=t,this.convertUtils=new Qa(t)}execute(e){const t=super.execute(e);return this.convertUtils.setRelativePosition(t,e.labelTarget),t}};Tu=(0,u.__decorate)([(0,u.__param)(0,g("canvas")),(0,u.__param)(1,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Tu);var Av=y(97970),ti=y(65911);let ec=class extends Av.A{constructor(e){super(e)}execute(e){super.execute(e)}postExecute(e){const{connection:t,hints:n}=e;n&&n.docking&&(e.dockingOrPoints=n.docking==="source"?(0,ti.pp)(t.source):(0,ti.pp)(t.target)),super.postExecute(e)}};ec=(0,u.__decorate)([(0,u.__param)(0,g("modeling")),(0,u.__metadata)("design:paramtypes",[Object])],ec);var Pv=y(90006);let Du=class extends Pv.A{constructor(e,t){super(e),this.modeling=e,this.canvas=t}getParent(e,t){const n=this.canvas.getRootElement();let i=super.getParent(e,t);return G.isLabel(i)&&(i=n),i}preExecute(e){super.preExecute(e)}};Du=(0,u.__decorate)([(0,u.__param)(0,g("modeling")),(0,u.__param)(1,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Du);var Tv=y(12301);let Ou=class extends Tv.A{constructor(e,t,n,i){super(e),this.modeling=e,this.elementRegistry=t,this.canvas=n,this.diagramUtils=i}setParent(e){const t=e.newParent;t&&(this.diagramUtils.isFlow(t)&&(e.targetConnection=t,e.newParent=this.getRealParent(e)),G.isLabel(t)&&(e.newParent=this.getRealParent(e)))}getRealParent(e){const t=this.diagramUtils.getAllContainers(this.elementRegistry.getAllElements()),n=this.canvas.getRootElement(),i=e.shapes[0];return this.diagramUtils.findRealElementParent({x:i.x,y:i.y},t,n)}postExecute(e){this.setParent(e),super.postExecute(e)}};Ou=(0,u.__decorate)([(0,u.__param)(0,g("modeling")),(0,u.__param)(1,g("elementRegistry")),(0,u.__param)(2,g("canvas")),(0,u.__param)(3,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,G])],Ou);var Dv=y(57261),Ov=y(45240);let Ru=class extends Dv.A{constructor(e){super(e),this.modeling=e,this.postExecute=function(t){const n=t.movingShapes,i=t.delta;this.modeling.moveElements(n,i,void 0,{autoResize:!1,attach:!1})},this.preExecute=function(t){const n=t.resizingShapes,i=t.delta,r=t.direction;n.forEach(a=>{const c=(0,Ov.Ih)(a,r,i);this.modeling.resizeShape(a,c)})}}};Ru=(0,u.__decorate)([(0,u.__param)(0,g("modeling")),(0,u.__metadata)("design:paramtypes",[Object])],Ru);const Rv={CENTER:"center",RIGHT:"right",LEFT:"left"},jv={TOP:"top",CENTER:"center",BOTTOM:"bottom"};let Je=class extends wv.A{constructor(e,t,n,i,r,a,c,h,p){super(e,t,n,i),this.eventBus=e,this.elementFactory=t,this.commandStack=n,this.canvas=i,this.registry=r,this.diagramText=a,this.elements=c,this.rules=h,this.diagramUtils=p,this.convertUtils=new Qa(p)}addShapeHandlers(e){e[ve.shape.shapeCreate]=Pu}addLabelHandlers(e){e[ve.label.create]=Tu}getLabelPositionByX(e,t){return e.horizontalAlignment===Rv.CENTER?e.x:e.x+t.width/2}getLabelPositionByY(e,t){return e.verticalAlignment===jv.CENTER?e.y:e.y+t.height/2}getLabelPosition(e,t,n){let i,r;if(this.needResetLabelPosition(e,t)){const a=this.diagramText.getLabelPosition(t,n),c=this.getFixedLabelPosition(a,n,t);i=!v.isUndefined(e.x)&&v.isUndefined(e.y)?this.getLabelPositionByX(e,n):c.x,r=!v.isUndefined(e.y)&&v.isUndefined(e.x)?this.getLabelPositionByY(e,n):c.y}else i=this.getLabelPositionByX(e,n),r=this.getLabelPositionByY(e,n);return{x:Math.round(i),y:Math.round(r)}}getLabelSize(e,t){let n;if(e.width&&e.height)n={width:e.width,height:e.height};else{const i=e.caption||t.caption,r=this.diagramText.getLabelBounds(e,i);n={width:r.width,height:r.height}}return n}addElementHandlers(e){e[ve.element.updateLabel]=Au}addConnectionHandlers(e){e[ve.connection.update]=ec,e[ve.connection.reconnect]=ec}getFixedLabelPosition(e,t,n){const a=e.x,c=this.diagramUtils.isConnection(n)?e.y:e.y+t.height/2-1*2-1;return{x:Math.round(a),y:Math.round(c)}}needResetLabelPosition(e,t){return v.isUndefined(e.x)||v.isUndefined(e.y)}getElement(e){return typeof e=="string"?this.registry.get(e):e}addElementsHandlers(e){e[ve.elements.create]=Du,e[ve.elements.move]=Ou}getLabelAttributes(e,t,n,i){return{id:t.id,type:e.type,width:n.width,height:n.height,caption:e.caption,backgroundStyle:e.backgroundStyle,style:e.style,hidden:i?.hidden,tooltip:e.tooltip,tooltipConfig:e.tooltipConfig}}getElementAttributes(e,t,n){const{caption:i,type:r}=t,a=t.width||n.width,c=t.height||n.height,h=t.largeImage||n.largeImage,p=t.name;return{id:e,type:r,width:a,height:c,largeImage:h,name:p,caption:i&&i.toString(),tooltip:t.tooltip,tooltipConfig:t.tooltipConfig}}centerViewbox(e){G.centerViewboxOnElement(e,this.canvas)}getElementPosition(e,t){const{x:n=0,y:i=0}=e,r=e.width||t.width,a=e.height||t.height;return{x:Math.round(n+r/2),y:Math.round(i+a/2)}}createDiagramLabel(e){const t=v.cloneDeep(e.value),n=this.registry.get(t.parent);if(n){this.convertUtils.setShapeAbsolutePosition(t,n);const i=this.getLabelSize(t,n);t.height=t.height||i.height;const r=this.getLabelPosition(t,n,i),a=this.getLabelAttributes(t,e,i,n);return this.createLabel(n,r,a,n)}}createDiagramElement(e,t){if(this.registry.get(e))return;const n=this.elements.items.root.id,i=v.cloneDeep(t[e]),r=i.parent||n;let a=this.registry.get(r);a||(this.createDiagramElement(r,t),a=this.registry.get(r)),this.convertUtils.setShapeAbsolutePosition(i,a);const c=this.elements.getConfig(i),h=this.getElementAttributes(e,i,c),p=this.getElementPosition(i,c);this.createShape(h,p,a,0,{generateUniqueCaption:!1})}getHandlers(){const e=super.getHandlers(this);return e.spaceTool=Ru,this.addLabelHandlers(e),this.addShapeHandlers(e),this.addElementHandlers(e),this.addElementsHandlers(e),this.addConnectionHandlers(e),e}moveConnection(e,t,n,i){super.moveConnection(e,t,e.parent,n,i)}createShape(e,t,n,i,r){return super.createShape(e,t,n,i,r)}pasteElements(e,t,n){super.pasteElements(e,t,n)}moveShape(e,t,n=null,i=null,r=null){super.moveShape(e,t,n,i,r)}updateWaypoints(e,t,n={}){const i=this.getElement(e);i&&(v.defaults(n,{doUpdateLabelPosition:!0}),super.updateWaypoints(i,t,n))}reconnect(e,t,n,i,r){r&&r.docking==="target"&&v.defaults(r,{isUpdateConnectionType:!0});const a=this.getElement(e),c=this.getElement(t),h=this.getElement(n);a&&(c||h)&&super.reconnect(a,c,h,i,r)}reconnectStart(e,t,n,i={}){if(!n){const r=this.getElement(e),a=r.waypoints[0];n=a.original||G.getOriginalWaypoint(a,r.source)}super.reconnectStart(e,t,n,i)}reconnectEnd(e,t,n,i={}){if(!n){const r=this.getElement(e),a=r.waypoints,c=a[a.length-1];n=c.original||G.getOriginalWaypoint(c,r.target)}super.reconnectEnd(e,t,n,i)}createLabel(e,t,n,i){if(this.registry.get(n.id))return;const r=super.createLabel(e,t,n,i);return r.parent=e,r}removeConnection(e){const t=this.getElement(e);t&&super.removeConnection(t)}connect(e,t,n,i){const r=this.canvas.getRootElement();return n=n||{},this.createConnection(e,t,n,r,i)}createConnection(e,t,n,i,r,a){if(typeof n=="object"&&(a=r,r=i,i=n,n=void 0),!this.registry.get(i.id))return r=r||this.canvas.getRootElement(),super.createConnection(e,t,n,i,r,a)}updateLabel(e,t,n=null){const i=this.getElement(e);i&&this.commandStack.execute(ve.element.updateLabel,{element:i,text:t,newBounds:n})}moveConnectionLabel(e,t){const n={connection:e,hints:t};this.eventBus.fire(ve.connection.moveConnectionLabel,{context:n})}removeElementChildren(e){const t=e.children;for(t.length&&this.eventBus.fire(ve.elements.removing,{elements:t});t.length>0;){const n=t[0];this.removeShape(n,{force:!0})}}resizeShape(e,t,n,i){super.resizeShape(e,t,n,i)}removeShape(e,t){super.removeShape(e,t)}removeElements(e,t=!1){(t||this.rules.allowed(ve.elements.delete,{elements:e}))&&super.removeElements(e)}clearDiagram(){const e=this.registry.getAllElements();super.removeElements(e)}layoutConnection(e,t){super.layoutConnection(e,t)}};Je=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("elementFactory")),(0,u.__param)(2,g("commandStack")),(0,u.__param)(3,g("canvas")),(0,u.__param)(4,g("elementRegistry")),(0,u.__param)(5,g("diagramText")),(0,u.__param)(6,g("elements")),(0,u.__param)(7,g("rules")),(0,u.__param)(8,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,ie,Object,G])],Je);let tc=class extends Mv.A{constructor(e,t,n,i,r,a,c){super(e,t,n,i,c,a),this.rules=r;const h=this.start;this.start=(p,m,f)=>{this.rules.allowed("canConnectionSegmentMove")&&h.call(this,p,m,f)}}};tc=(0,u.__decorate)([(0,u.__param)(0,g("injector")),(0,u.__param)(1,g("eventBus")),(0,u.__param)(2,g("canvas")),(0,u.__param)(3,g("dragging")),(0,u.__param)(4,g("rules")),(0,u.__param)(5,g("modeling")),(0,u.__param)(6,g("graphicsFactory")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Je,Object])],tc);const nm=".entry";let nc=class{constructor(e,t,n,i){this.eventBus=e,this.overlays=t,this.rules=n,this.canvas=i,this._providers=[],this.current=null,this.init()}init(){this.eventBus.on("selection.changed",e=>{const t=e.newSelection;t.length===1?this.open(t[0]):this.close()}),this.eventBus.on("elements.delete",e=>{const t=e.elements;(0,F.forEach)(t,n=>{this.isOpen(n)&&this.close()})}),this.eventBus.on("element.changed",e=>{const t=e.element,n=this.current;n&&n.element===t&&this.open(t,!0)}),this.eventBus.on("canvas.viewbox.changing",()=>{this.isOpen()&&(0,F.assign)(this.current.pad.html.style,{visibility:"hidden"})}),this.eventBus.on("canvas.viewbox.changed",()=>{const e=this.current&&this.current.element;e&&this.open(e,!0)}),this.eventBus.on("diagram.clear",()=>{this.close()})}canOpen(e){return this.rules.allowed("canOpenContextPad",{})}getSeparatorConfig(){return{className:"entry-separator"}}getNoopConfig(){return{noop:{className:"noop-entry"}}}sliceObj(e,t,n){return Object.keys(e).slice(t,n).reduce((i,r)=>(i[r]=e[r],i),{})}addNoopEntry(e){const t=Object.keys(e);return t.length<=2||t[1]==="setup"?e:{...this.sliceObj(e,0,1),...this.getNoopConfig(),...this.sliceObj(e,1,t.length)}}addSeparators(e){const t=Object.keys(e);return t.length<=1?e:t.length===2?t[1]==="setup"?e:(this.oneColumnMode=!0,{...this.sliceObj(e,0,1),separator1:this.getSeparatorConfig(),...this.sliceObj(e,1,t.length)}):{...this.sliceObj(e,0,2),separator1:this.getSeparatorConfig(),separator2:this.getSeparatorConfig(),...this.sliceObj(e,2,t.length)}}fixConnectToolPosition(e){const t=Object.keys(e);if(t.length<=2)return e;const n=t.indexOf("connect");if(n<0||n%2===0)return e;const i=t[n-1];return{...this.sliceObj(e,0,n-1),connect:e.connect,[i]:e[i],...this.sliceObj(e,n+1,t.length)}}fixEntries(e){return this.oneColumnMode=!1,e=this.addNoopEntry(e),e=this.addSeparators(e),e=this.fixConnectToolPosition(e),e}trigger(e,t,n=!1){const{entries:i,element:r}=this.current,a=t.delegateTarget||t.target;if(!a)return t.preventDefault();const c=(0,I.attr)(a,"data-action"),p=i[c].action,m=t.originalEvent||t;if((0,F.isFunction)(p)){if(e==="click")return p(m,r,n)}else if(p[e])return p[e](m,r,n);t.preventDefault()}getConnectionBBox(e){const t=(0,or.U7)(e);return{x:t.x,y:t.y,width:t.width,height:t.height}}getElementBBox(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}getPadPosition(e){const t={left:9,top:-6},n=this.canvas.viewbox(),i=e.waypoints?this.getConnectionBBox(e):this.getElementBBox(e),r=i.x+i.width+t.left-n.x,a=i.y+t.top-n.y,c=n.scale;return{x:Math.round(r*c),y:Math.round(a*c)}}getEntryControl(e,t){const{className:n,title:i,imageUrl:r}=t,a=(0,I.domify)(`<div class="entry" draggable="true" data-action="${e}"></div>`);if(n){const c=(0,I.classes)(a);((0,F.isArray)(n)?n:n.split(/\s+/g)).forEach(p=>{c.add(p)})}return i&&(0,I.attr)(a,"title",i),r&&a.appendChild((0,I.domify)('<img src="'+r+'">')),a}addEntriesContainer(e){const t=(0,I.domify)('<div class="group"></div>');return(0,F.forEach)(e,(n,i)=>{const r=this.getEntryControl(i,n);t.appendChild(r)}),t}getPad(e){if(this.isOpen())return this.current.pad;const t=(0,I.domify)('<div class="djs-context-pad"></div>');I.delegate.bind(t,nm,"click",r=>{this.trigger("click",r)}),I.delegate.bind(t,nm,"dragstart",r=>{this.trigger("dragstart",r)}),I.event.bind(t,"mousedown",r=>{r.stopPropagation()});const n=this.getPadPosition(e);(0,F.assign)(t.style,{position:"absolute",left:n.x+"px",top:n.y+"px",visibility:"visible"});const i={html:t};return this.eventBus.fire("contextPad.create",{element:e,pad:i}),i}getEntries(e){const t={};return(0,F.forEach)(this._providers,n=>{const i=n.getContextPadEntries(e);(0,F.forEach)(i,(r,a)=>{t[a]=r})}),this.fixEntries(t)}registerProvider(e){this._providers.push(e)}open(e,t=!1){if(!t&&this.isOpen(e)||(this.close(),!this.canOpen(e)))return;const n=this.getEntries(e);if(v.isEmpty(n))return;const i=this.addEntriesContainer(n),r=this.getPad(e),a=r.html;a.appendChild(i),(0,I.classes)(a).add("open"),(0,I.classes)(a).toggle("one-column-grid",this.oneColumnMode),this.canvas.getContainer().appendChild(a),this.current={element:e,pad:r,entries:n},this.eventBus.fire("contextPad.open",{current:this.current})}isOpen(e){return this.current&&(!e||this.current.element===e)}close(){this.isOpen()&&((0,I.remove)(this.current.pad.html),this.eventBus.fire("contextPad.close",{current:this.current}),this.current.pad.html=null,this.current=null)}};nc=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("overlays")),(0,u.__param)(2,g("rules")),(0,u.__param)(3,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object])],nc);var kv=y(7034);let ju=class extends kv.A{constructor(e,t,n,i,r,a,c,h,p,m){super(e,t,n,i,r,a,c,h),this.canvas=e,this.create=t,this.clipboard=n,this.elementFactory=i,this.eventBus=r,this.modeling=a,this.mouse=c,this.rules=h,this.diagramText=p,this.config=m,this.init()}_onPasteElement(e){Object.assign(e.hints,{generateUniqueCaption:!1,isElementCopyPaste:!0})}onCopyElement({element:e,descriptor:t}){this.copyProperties.forEach(n=>t[n]=(0,v.clone)(e[n]))}init(){this.copyProperties=["type","caption"],this.eventBus.on("copyPaste.pasteElements",e=>this._onPasteElement(e)),this.eventBus.on("copyPaste.copyElement",e=>this.onCopyElement(e))}resetLabelsPosition(e){const t=e.filter(n=>G.isLabel(n));t.length===1&&e.length===2&&this.diagramText.resetLabelPosition(t[0])}_createElements(e){const t=super._createElements(e);return this.resetLabelsPosition(t),t}createShape(e){const t=e.id,n=super.createShape(e);return n.sourceId=t,n}};ju=(0,u.__decorate)([(0,u.__param)(0,g("canvas")),(0,u.__param)(1,g("create")),(0,u.__param)(2,g("clipboard")),(0,u.__param)(3,g("elementFactory")),(0,u.__param)(4,g("eventBus")),(0,u.__param)(5,g("modeling")),(0,u.__param)(6,g("mouse")),(0,u.__param)(7,g("rules")),(0,u.__param)(8,g("diagramText")),(0,u.__param)(9,g("config")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,Object,Object,Object])],ju);let So=class{constructor(e,t){this.eventBus=e,this.canvas=t}getEntry(e,t){const n=(0,F.matchPattern)({id:t}),i=(0,F.find)(e,n);if(!i)throw new Error("entry not found");return i}createContainer(){const t=this.canvas.getContainer().getBoundingClientRect(),i=(0,I.query)(`[data-action="${this.paletteEntryId}"]`).getBoundingClientRect(),r={x:12,y:-5},a={x:i.left+i.width+r.x-t.left,y:i.top+r.y-t.top},c=(0,I.domify)('<div class="djs-popup diagram-create-popup-menu">');return(0,F.assign)(c.style,{position:"absolute",left:a.x+"px",top:a.y+"px",visibility:"hidden"}),c}alignPosition(e){const n=this.canvas.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),r=10,a=i.top+i.height-(n.top+n.height)+r;if(a>0){let c=i.top-n.top-a;c=c>r?c:r,(0,F.assign)(e.style,{top:c+"px"})}}entryAction(e,t,n){n.preventDefault();const i=n.delegateTarget||n.target,r=(0,I.attr)(i,"data-id"),a=this.getEntry(e,r),c=a.action[t];c&&c.call(null,n,a)}attachContainer(e,t){const n=this.canvas.getContainer();I.delegate.bind(t,".entry","dragstart",this.entryAction.bind(this,e,"dragstart")),I.delegate.bind(t,".entry","click",this.entryAction.bind(this,e,"click")),n.appendChild(t),this.alignPosition(t),(0,F.assign)(t.style,{visibility:"visible","z-index":1e3,opacity:1}),this.subscribeEvents(),t.onwheel=i=>this.onWheel(i)}createEntriesContainer(e){const t=(0,I.domify)('<div class="djs-popup-body">');return(0,F.forEach)(e,n=>{const i=this.createEntry(n);t.appendChild(i)}),t}createEntry(e){if(!e.id)throw new Error("every entry must have the id property set");const t=(0,I.domify)('<div class="entry" draggable="true"></div>');(0,I.classes)(t).add("entry"),(0,I.attr)(t,"data-id",e.id);const i=(0,I.domify)("<span>");return i.textContent=e.label,t.appendChild(i),t.appendChild((0,I.domify)('<img src="'+e.imageUrl+'" />')),t}subscribeEvents(){const e=this.eventBus;e.once("contextPad.close",this.close.bind(this)),e.once("popupMenu.open",this.close.bind(this)),e.once("canvas.viewbox.changing",this.close.bind(this)),e.once("commandStack.changed",this.close.bind(this)),e.once("element.mousedown",_e.HIGH,this.close.bind(this)),e.once("keyboard.keydown",_e.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this.eventBus;e.off("contextPad.close",this.close.bind(this)),e.off("popupMenu.open",this.close.bind(this)),e.off("canvas.viewbox.changed",this.close.bind(this)),e.off("commandStack.changed",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}open(e,t,n){if(this.isOpen()&&(this.close(),e.type===this.currentElement.type))return;this.currentElement=e,this.paletteEntryId=t,this.eventBus.fire("createPopupMenu.open",{paletteEntryId:t});const i=this.createContainer(),r=this.createEntriesContainer(n);i.appendChild(r),this.attachContainer(n,i),this.container=i}close(){if(!this.isOpen())return;const e=this.paletteEntryId;this.eventBus.fire("createPopupMenu.close",{paletteEntryId:e}),this.unsubscribeEvents(),(0,I.remove)(this.container),this.container=null}isOpen(){return!!this.container}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};So=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object])],So);var Nv=y(20990);let ku=class extends Nv.A{constructor(e,t){super(t,e),this.injector=e}_registerDefaultActions(){super._registerDefaultActions.call(this,this.injector);const e=this.injector.get("elementRegistry",!1),t=this.injector.get("selection",!1);e&&t&&super._registerAction("selectAll",()=>{const n=e.getAllElements();return t.select(n),n})}};ku=(0,u.__decorate)([(0,u.__param)(0,g("injector")),(0,u.__param)(1,g("eventBus")),(0,u.__metadata)("design:paramtypes",[Object,Object])],ku);var Vv=y(15176);class im extends Vv.A{constructor(){super(),jc().config({disableDefaultAlphabetLength:!0}),jc().characters("0123456789abcdefghijklmnopqrstuvwxyz")}generateId(e){return e+"_"+jc().generate()}create(e,t){return t=Object.assign({},t),t.type||(t.type=e),t.id||(t.id=this.generateId(t.type)),super.create(e,t)}}(0,ws.marker)("diagram.elementTools.connect.connect"),(0,ws.marker)("diagram.elementTools.remove"),(0,ws.marker)("diagram.elementTools.changeType");const Lv="assets/images/icon_tools_del.svg",Bv="assets/images/icon_tools_setup.svg",Fv="assets/images/icon_tools_arrow.svg";let ic=class{constructor(e,t){this.elements=e,this.config=t,this.addItems=this.getAddItems(),this.tools=this.getTools()}getAddItems(){return[]}getTools(){const e=this.config.localizableStrings;return{connect:{imageUrl:Fv,title:e.get("elementTools.connect.connect")},setup:{imageUrl:Bv,title:e.get("elementTools.changeType")},delete:{imageUrl:Lv,title:e.get("elementTools.remove")}}}};ic=(0,u.__decorate)([(0,u.__param)(0,g("elements")),(0,u.__param)(1,g("config")),(0,u.__metadata)("design:paramtypes",[ie,Object])],ic);var zv=y(77117),sm=y(34495);const De={Backspace:{code:"Backspace",keyCode:8},Tab:{code:"Tab",keyCode:9},Enter:{code:"Enter",keyCode:13},NumpadEnter:{code:"NumpadEnter",keyCode:13},Escape:{code:"Escape",keyCode:27},Space:{code:"Space",keyCode:32},PageUp:{code:"PageUp",keyCode:33},PageDown:{code:"PageDown",keyCode:34},End:{code:"End",keyCode:35},Home:{code:"Home",keyCode:36},ArrowLeft:{code:"ArrowLeft",keyCode:37},ArrowUp:{code:"ArrowUp",keyCode:38},ArrowRight:{code:"ArrowRight",keyCode:39},ArrowDown:{code:"ArrowDown",keyCode:40},Insert:{code:"Insert",keyCode:45},Delete:{code:"Delete",keyCode:46},ShiftLeft:{code:"ShiftLeft",keyCode:16},ShiftRight:{code:"ShiftRight",keyCode:16},ControlLeft:{code:"ControlLeft",keyCode:17},ControlRight:{code:"ControlRight",keyCode:17},AltLeft:{code:"AltLeft",keyCode:18},AltRight:{code:"AltRight",keyCode:18},CapsLock:{code:"CapsLock",keyCode:20},OSLeft:{code:"OSLeft",keyCode:91},OSRight:{code:"OSRight",keyCode:92},Digit0:{code:"Digit0",keyCode:48},Digit1:{code:"Digit1",keyCode:49},Digit2:{code:"Digit2",keyCode:50},Digit3:{code:"Digit3",keyCode:51},Digit4:{code:"Digit4",keyCode:52},Digit5:{code:"Digit5",keyCode:53},Digit6:{code:"Digit6",keyCode:54},Digit7:{code:"Digit7",keyCode:55},Digit8:{code:"Digit8",keyCode:56},Digit9:{code:"Digit9",keyCode:57},KeyA:{code:"KeyA",keyCode:65},KeyB:{code:"KeyB",keyCode:66},KeyC:{code:"KeyC",keyCode:67},KeyD:{code:"KeyD",keyCode:68},KeyE:{code:"KeyE",keyCode:69},KeyF:{code:"KeyF",keyCode:70},KeyG:{code:"KeyG",keyCode:71},KeyH:{code:"KeyH",keyCode:72},KeyI:{code:"KeyI",keyCode:73},KeyJ:{code:"KeyJ",keyCode:74},KeyK:{code:"KeyK",keyCode:75},KeyL:{code:"KeyL",keyCode:76},KeyM:{code:"KeyM",keyCode:77},KeyN:{code:"KeyN",keyCode:78},KeyO:{code:"KeyO",keyCode:79},KeyP:{code:"KeyP",keyCode:80},KeyQ:{code:"KeyQ",keyCode:81},KeyR:{code:"KeyR",keyCode:82},KeyS:{code:"KeyS",keyCode:83},KeyT:{code:"KeyT",keyCode:84},KeyU:{code:"KeyU",keyCode:85},KeyV:{code:"KeyV",keyCode:86},KeyW:{code:"KeyW",keyCode:87},KeyX:{code:"KeyX",keyCode:88},KeyY:{code:"KeyY",keyCode:89},KeyZ:{code:"KeyZ",keyCode:90},NumpadMultiply:{code:"NumpadMultiply",keyCode:106},NumpadAdd:{code:"NumpadAdd",keyCode:107},NumpadDecimal:{code:"NumpadDecimal",keyCode:108},NumpadSubtract:{code:"NumpadSubtract",keyCode:109},NumpadDivide:{code:"NumpadDivide",keyCode:111},F1:{code:"F1",keyCode:112},F2:{code:"F2",keyCode:113},F3:{code:"F3",keyCode:114},F4:{code:"F4",keyCode:115},F5:{code:"F5",keyCode:116},F6:{code:"F6",keyCode:117},F7:{code:"F7",keyCode:118},F8:{code:"F8",keyCode:119},F9:{code:"F9",keyCode:120},F10:{code:"F10",keyCode:121},F11:{code:"F11",keyCode:122},F12:{code:"F12",keyCode:123},F13:{code:"F13",keyCode:124},F14:{code:"F14",keyCode:125},F15:{code:"F15",keyCode:126},F16:{code:"F16",keyCode:127},F17:{code:"F17",keyCode:128},F18:{code:"F18",keyCode:129},F19:{code:"F19",keyCode:130},F20:{code:"F20",keyCode:131},F21:{code:"F21",keyCode:132},F22:{code:"F22",keyCode:133},F23:{code:"F23",keyCode:134},F24:{code:"F24",keyCode:135},NumLock:{code:"NumLock",keyCode:144},Semicolon:{code:"Semicolon",keyCode:186},Equal:{code:"Equal",keyCode:187},Comma:{code:"Comma",keyCode:188},Minus:{code:"Minus",keyCode:189},Period:{code:"Period",keyCode:190},Slash:{code:"Slash",keyCode:191},Backquote:{code:"Backquote",keyCode:192},IntlRo:{code:"IntlRo",keyCode:193},BracketLeft:{code:"BracketLeft",keyCode:219},Backslash:{code:"Backslash",keyCode:220},BracketRight:{code:"BracketRight",keyCode:221},Quote:{code:"Quote",keyCode:222},IntlYen:{code:"IntlYen",keyCode:255}};function Mo(o){const e=De[o.code];return e?e.keyCode:o.keyCode}function Uv(o){if(o.ctrlKey||o.metaKey||o.altKey)return!1;const e=o.which||o.keyCode;return e>47&&e<58||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}function Dt(o,e,t={}){return!v.isUndefined(t.ctrl)&&t.ctrl!==(0,sm.nM)(o)||!v.isUndefined(t.shift)&&t.shift!==(0,sm.Tu)(o)?!1:Mo(o)===e.keyCode}function $v(o){return Mo(o)===De.Enter.keyCode}function Gv(o,e){o.shiftKey||(o.stopPropagation(),o.preventDefault(),o.ctrlKey||o.altKey?document.execCommand("insertText",!1,`
`):e())}class Hv extends zv.A{registerBindings(e,t){const r=(a,c)=>{t.isRegistered(a)&&e.addListener(c)};r("stepZoom",a=>{const c=a.keyEvent;if(Dt(c,De.Equal,{ctrl:!0})||Dt(c,De.NumpadAdd,{ctrl:!0}))return t.trigger("stepZoom",{value:1}),!0}),r("undo",a=>{const c=a.keyEvent;if(Dt(c,De.KeyZ,{ctrl:!0,shift:!1}))return t.trigger("undo"),!0}),r("redo",a=>{const c=a.keyEvent;if(Dt(c,De.KeyY,{ctrl:!0})||Dt(c,De.KeyZ,{ctrl:!0,shift:!0}))return t.trigger("redo"),!0}),r("copy",a=>{const c=a.keyEvent;if(Dt(c,De.KeyC,{ctrl:!0}))return t.trigger("copy"),!0}),r("paste",a=>{const c=a.keyEvent;if(Dt(c,De.KeyV,{ctrl:!0}))return t.trigger("paste"),!0}),r("selectAll",a=>{const c=a.keyEvent;if(Dt(c,De.KeyA,{ctrl:!0}))return t.trigger("selectAll"),!0}),super.registerBindings(e,t)}}var Wv=y(40406);let Nu=class extends Wv.A{constructor(e,t,n,i,r,a){super(e,t,n,i,r,a),this.eventBus=e,this.canvas=t,this.dragging=n,this.elementRegistry=i,this.selection=r,this.toolManager=a}select(e,t){const n=(0,or.rx)(e,t),i=(0,F.values)(n),r=i.filter(a=>G.isLabel(a)&&i.includes(a.parent)||!G.isLabel(a));this.selection.select(r)}};Nu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__param)(2,g("dragging")),(0,u.__param)(3,g("elementRegistry")),(0,u.__param)(4,g("selection")),(0,u.__param)(5,g("toolManager")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object])],Nu);let sc=class{constructor(e,t,n,i,r){this.elementRegistry=e,this.diagramModeling=t,this.elements=n,this.eventBus=i,this.logger=r,this.errors=[],this.loadRenderInterval=500}createElement(e,t){this.diagramModeling.createDiagramElement(e,t)}createLabel(e,t){this.diagramModeling.createDiagramLabel({value:e,id:t})}createConnection(e,t){const n=v.cloneDeep(e),{source:i,target:r}=n,a=this.elementRegistry,c=a.get(i),h=a.get(r),p=this.getConnectionAttributes(t,n);this.diagramModeling.connect(c,h,p,e.hints||{})}addOriginalToWaypoint(e,t){if(!e.original){const n=this.elementRegistry.get(t);n&&(e.original=G.getOriginalWaypoint(e,n))}}addOriginalToConnection(e){const t=e.waypoints;if(t&&t.length>1){const n=t[0];this.addOriginalToWaypoint(n,e.source);const i=t[t.length-1];this.addOriginalToWaypoint(i,e.target)}}getConnectionAttributes(e,t){const{waypoints:n,name:i,type:r=je.connection}=t;this.addOriginalToConnection(t);let{caption:a,documentation:c}=t;return a=a&&a.toString(),c=c&&c.toString(),{id:e,waypoints:n,name:i,caption:a,documentation:c,type:r}}load(e,t,n){var i=this;return(0,b.A)(function*(){i.errors=[];const r=[...v.map(e.elements,(c,h)=>({handler:()=>i.createElement(h,e.elements),id:h})),...v.map(e.connections,(c,h)=>({handler:()=>i.createConnection(c,h),id:h})),...v.map(e.labels,(c,h)=>({handler:()=>i.createLabel(c,h),id:h}))];let a=Number(new Date);try{for(let c=0,h=r.length;c<h&&!t.isStopped;c++){try{r[c].handler()}catch(m){i.errors.push(r[c].id+" "+m.toString()),console.error(m)}if(Number(new Date)-a>i.loadRenderInterval){const m=Math.round(c/h*100);n.next(m),yield new Promise(f=>v.delay(f,0)),a=Number(new Date)}}return i.errors.length&&i.logger.exception(`Error when loading process with ID: ${e.id}`,{loggerName:"DiagramLoader"},i.errors),i.errors}finally{n.next(0),t.isStopped||i.eventBus.fire("diagram.loaded")}})()}};sc=(0,u.__decorate)([(0,u.__param)(0,g("elementRegistry")),(0,u.__param)(1,g("modeling")),(0,u.__param)(2,g("elements")),(0,u.__param)(3,g("eventBus")),(0,u.__param)(4,g("loggerService")),(0,u.__metadata)("design:paramtypes",[Object,Je,ie,Object,Rt])],sc);var Zv=y(25141),rm=y.n(Zv),Yv=y(12266);const rc=50,Kv={min:.2,max:4},Jv=10,qv=.1;let Vu=class{constructor(e,t,n,i,r,a,c,h){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.zoomScroll=i,this.localStorage=r,this.popupMenu=a,this.config=c,this.diagramUtils=h,this.openStateKey="minimap-state",this.loadMiniMapRenderInterval=50,this._onElementAdded=this.onElementAdded.bind(this),this._onElementRemoved=this.onElementRemoved.bind(this),this._onElementsChanged=this.onElementsChanged.bind(this),this._onElementUpdateId=this.onElementUpdateId.bind(this),this.init()}init(){const e=this.getOpenState();this._state={isOpen:e,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0,data:null},this.createComponent(),this.registerPopupMenu(),this.subscribeEvents()}getOpenState(){return this.localStorage.get(this.openStateKey,!1)}setOpenState(e){(0,F.assign)(this._state,{isOpen:e}),this.localStorage.set(this.openStateKey,e,!1),e?((0,I.classes)(this.parent).add("open"),(0,I.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapClose"))):((0,I.classes)(this.parent).remove("open"),(0,I.attr)(this.mapButtons.preview,"title",this.config.localizableStrings.get("miniMapOpen")))}createComponent(){this.parent=document.createElement("div"),(0,I.classes)(this.parent).add("djs-minimap"),I.event.bind(this.parent,"mousedown",t=>t.stopPropagation());const e=this.canvas.getContainer();this.isOpen()&&(0,I.classes)(this.parent).add("open"),e.appendChild(this.parent),this.initButtons(),this.map=document.createElement("div"),(0,I.classes)(this.map).add("map"),this.parent.appendChild(this.map),this.svg=(0,x.vt)("svg"),(0,x.CF)(this.svg,{width:"100%",height:"100%"}),(0,x.BC)(this.map,this.svg),this.elementsGroup=(0,x.vt)("g"),(0,x.BC)(this.svg,this.elementsGroup),this.viewportGroup=(0,x.vt)("g"),(0,x.BC)(this.svg,this.viewportGroup),this.viewport=(0,x.vt)("rect"),(0,x.Ly)(this.viewport).add("viewport"),(0,x.BC)(this.viewportGroup,this.viewport),this.viewportDom=document.createElement("div"),(0,I.classes)(this.viewportDom).add("viewport-dom"),this.parent.appendChild(this.viewportDom),this.overlay=document.createElement("div"),(0,I.classes)(this.overlay).add("overlay"),this.parent.appendChild(this.overlay)}initButtons(){const e=document.createElement("div");(0,I.classes)(e).add("map-buttons"),this.mapButtons={},this.getMapButtonsConfig().forEach(n=>{const i=document.createElement("div");if(["map-button",...n.classes].forEach(r=>(0,I.classes)(i).add(r)),n.title){let r=this.config.localizableStrings.get(n.title);n.shortcut&&(r+=` (${n.shortcut})`),(0,I.attr)(i,"title",r)}n.caption&&(i.textContent=n.caption),this.subscribeUserEvent(i,"click",n.click),this.mapButtons[n.id]=i,e.appendChild(i)}),this.parent.appendChild(e)}getMapButtonsConfig(){return[{id:"preview",classes:["material-icons","preview-button"],title:this.isOpen()?"miniMapClose":"miniMapOpen",caption:"icon_preview_16",click:()=>this.preview()},{id:"fitToView",classes:["material-icons","fit-to-view-button"],title:"fitToView",shortcut:"Ctrl+0",caption:"icon_fullscreen_16",click:()=>this.fitToView()},{id:"resetView",classes:["reset-view-button"],title:"resetView",caption:"1:1",click:()=>this.resetView()},{id:"zoomOut",classes:["material-icons","zoom-out-button"],title:"zoomOut",shortcut:"Ctrl+-",caption:"icon_zoom_out_16",click:()=>this.zoomScroll.zoomOut()},{id:"zoomIn",classes:["material-icons","zoom-in-button"],title:"zoomIn",shortcut:"Ctrl++",caption:"icon_zoom_in_16",click:()=>this.zoomScroll.zoomIn()},{id:"zoom",classes:["zoom-button"],caption:"100%",click:()=>this.togglePopupMenu()}]}subscribeEvents(){let e=!0;this.eventBus.on("diagram.loaded",()=>{e?(e=!1,this.isOpen()&&this.open().then(()=>{this.onDiagramLoaded().then()})):this.onDiagramLoaded().then()}),this.subscribeUserEvent(this.svg,"click",t=>this.onSvgClick(t)),I.event.bind(this.viewportDom,"mousedown",t=>this.onMousedown(!1,t)),I.event.bind(this.svg,"mousedown",t=>this.onMousedown(!0,t)),this.subscribeUserEvent(this.parent,"wheel",t=>this.onParentWheel(t)),this.eventBus.on("canvas.viewbox.changed",()=>this.onViewBoxChanged()),this.eventBus.on("canvas.resized",()=>this.onCanvasResized()),this.eventBus.on("zoom.changed",(t,n)=>this._onZoomChanged(n)),this.eventBus.on("keyboard.keydown",t=>this.onKeyDown(t)),this.eventBus.on("diagram.clear",()=>this.onClear())}onDiagramLoaded(){var e=this;return(0,b.A)(function*(){e.isOpen()&&(yield e.loadData(),e.subscribeElementEvents())})()}onSvgClick(e){this.setViewboxCenteredAroundClickEvent(e)}onViewBoxChanged(){this._state.isDragging||this.update()}onCanvasResized(){document.body.contains(this.parent)&&(this._state.isDragging||this.update(),this._state._svgClientRect=this.svg.getBoundingClientRect())}onKeyDown({keyEvent:e}){if(e.ctrlKey&&Mo(e)===De.Digit0.keyCode)return this.fitToView(),!1}onClear(){this.isOpen()&&this.unsubscribeElementEvents(),this.elementRegistry.getAllElements().forEach(e=>this.removeElement(e))}subscribeUserEvent(e,t,n){I.event.bind(e,t,i=>{i.preventDefault(),i.stopPropagation(),n.call(this,i)})}onParentWheel(e){if(!e.ctrlKey||(this.updateSvgClientRect(),!this.isPointInside(e,this._state._svgClientRect)))return;const{deltaMode:t,deltaX:n,deltaY:i}=e,r=t===0?.02:.32,a=Math.sqrt(Math.pow(i,2)+Math.pow(n,2))*Math.sign(i)*-r;if(this._state.zoomDelta+=a,Math.abs(this._state.zoomDelta)>qv){const c=a>0?1:-1,h=Math.log(this.canvas.zoom())/Math.log(10),p=this.getStepSize(Kv,Jv*2),m=Math.round(h/p)*p+p*c,f=Math.pow(10,m);this.zoomScroll.setZoom(f),this._state.zoomDelta=0;const C=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(C),this.update()}}update(){if(!this.isOpen())return;const e=this.canvas.viewbox(),t=e.inner,n=e.outer;if(!this.validViewbox(e))return;let i,r,a,c;const h=n.width-t.width,p=n.height-t.height;t.width<n.width?(i=t.x-h/2,a=n.width,t.x+t.width<n.width&&(i=Math.min(0,t.x))):(i=t.x,a=t.width),t.height<n.height?(r=t.y-p/2,c=n.height,t.y+t.height<n.height&&(r=Math.min(0,t.y))):(r=t.y,c=t.height),i=i-rc,r=r-rc,a=a+rc*2,c=c+rc*2,this.lastViewbox={x:i,y:r,width:a,height:c},(0,x.CF)(this.svg,{viewBox:i+", "+r+", "+a+", "+c}),(0,x.CF)(this.viewport,{x:e.x,y:e.y,width:e.width,height:e.height});const m=this.map.getBoundingClientRect();this._state._parentClientRect=m;const f=this.viewport.getBoundingClientRect(),C={top:f.top-m.top,left:f.left-m.left,width:f.width,height:f.height};(0,F.assign)(this.viewportDom.style,{top:C.top+"px",left:C.left+"px",width:C.width+"px",height:C.height+"px"});const S=this.getOverlayClipPath(m,C);(0,F.assign)(this.overlay.style,{clipPath:S})}setViewboxCenteredAroundClickEvent(e){this.updateSvgClientRect();const t=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint(t),this.update()}onMousedown(e,t){if(t.button!==0)return;this.updateSvgClientRect(),e&&this.setViewboxCenteredAroundClickEvent(t);const n=this.mapMousePositionToDiagramPoint(t),i=this.canvas.viewbox(),r=this.getOffsetViewport(n,i),a=this.viewportDom.getBoundingClientRect(),c={x:t.clientX-a.left+1,y:t.clientY-a.top+1};(0,F.assign)(this._state,{cachedViewbox:i,initialDragPosition:{x:t.clientX,y:t.clientY},isDragging:!0,offsetViewport:r,offsetViewportDom:c,viewportClientRect:this.viewport.getBoundingClientRect(),parentClientRect:this.map.getBoundingClientRect()}),I.event.bind(document,"mousemove",this.onMousemove.bind(this)),I.event.bind(document,"mouseup",this.onMouseup.bind(this))}updateSvgClientRect(){(!this._state._svgClientRect||this.isZeroDimensional(this._state._svgClientRect))&&(this._state._svgClientRect=this.svg.getBoundingClientRect())}onMousemove(e){if(this._state.isDragging){this.updateSvgClientRect();const t=this._state.offsetViewportDom,n=this._state.viewportClientRect,i=this._state.parentClientRect;(0,F.assign)(this.viewportDom.style,{top:e.clientY-t.y-i.top+"px",left:e.clientX-t.x-i.left+"px"});const r=this.getOverlayClipPath(i,{top:e.clientY-t.y-i.top,left:e.clientX-t.x-i.left,width:n.width,height:n.height});(0,F.assign)(this.overlay.style,{clipPath:r});const a=this.mapMousePositionToDiagramPoint(e);this.setViewboxCenteredAroundPoint({x:a.x-this._state.offsetViewport.x,y:a.y-this._state.offsetViewport.y})}}onMouseup(e){if(this._state.isDragging){const t=this._state.initialDragPosition;t.x===e.clientX&&t.y===e.clientY&&this.setViewboxCenteredAroundClickEvent(e),this.update(),(0,F.assign)(this._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),I.event.unbind(document,"mousemove",this.onMousemove.bind(this)),I.event.unbind(document,"mouseup",this.onMouseup.bind(this))}}_onZoomChanged(e){this.mapButtons.zoom.textContent=Math.round(e*100)+"%"}updateElement(e){try{e.parent!==void 0&&e.parent!==null&&(this.removeElement(e),this.addElement(e))}catch(t){console.warn(`Minimap#updateElement error: ${t}`)}}addElement(e){if(this.removeElement(e),e.hidden)return;let t,n,i;const r=this.createElement(e);if(r){const a=(0,I.query)("#"+rm()(e.parent.id),this.elementsGroup),c=this.elementRegistry.getGraphics(e),h=this.elementRegistry.getGraphics(e.parent),p=this.getIndexOfChildInParentChildren(c,h);return p!=="undefined"?a?a.childNodes.length>p?this.insertChildAtIndex(r,a,p):this.insertChildAtIndex(r,a,a.childNodes.length-1):this.elementsGroup.appendChild(r):this.elementsGroup.appendChild(r),this.diagramUtils.isConnection(e)?(t=e.parent,n=0,i=0,typeof t.x<"u"&&typeof t.y<"u"&&(n=-t.x,i=-t.y),(0,x.CF)(r,{transform:"translate("+n+" "+i+")",strokeWidth:"4"})):(n=e.x,i=e.y,a&&(t=e.parent,typeof t.x<"u"&&typeof t.y<"u"&&(n-=t.x,i-=t.y)),(0,x.CF)(r,{transform:"translate("+n+" "+i+")"})),e.children&&e.children.length&&e.children.forEach(m=>{this.addElement(m)}),r}}removeElement(e){const t=this.svg.getElementById(e.id);t&&(0,x.TF)(t)}createElement(e){const t=this.elementRegistry.getGraphics(e);if(t){const n=(0,Yv.P)(t);if(n){const i=(0,x.o8)(n);return(0,x.CF)(i,{id:e.id}),i}}}getOffsetViewport(e,t){return{x:e.x-(t.x+t.width/2),y:e.y-(t.y+t.height/2)}}mapMousePositionToDiagramPoint({clientX:e,clientY:t}){const n={x:e-this._state._svgClientRect.left,y:t-this._state._svgClientRect.top},i=this.svg.getBoundingClientRect(),r=this.fitAspectRatio(this.lastViewbox,i.width/i.height),a=this.mapPosition(n.x,0,i.width,r.x,r.x+r.width),c=this.mapPosition(n.y,0,i.height,r.y,r.y+r.height);return{x:a,y:c}}setViewboxCenteredAroundPoint(e){const t=this.canvas.viewbox(),n=t.width,i=t.height;this.canvas.viewbox({x:e.x-n/2,y:e.y-i/2,width:n,height:i})}fitAspectRatio(e,t){const n=e.width/e.height,i=(0,F.assign)({},{x:e.x,y:e.y,width:e.width,height:e.height});if(n>t){const r=i.width*(1/t),a=i.y-(r-i.height)/2;(0,F.assign)(i,{y:a,height:r})}else if(n<t){const r=i.height*t,a=i.x-(r-i.width)/2;(0,F.assign)(i,{x:a,width:r})}return i}mapPosition(e,t,n,i,r){const a=n-t,c=r-i;return(e-t)*c/a+i}getIndexOfChildInParentChildren(e,t){const n=(0,I.query)(".djs-children",t.parentNode);if(!n)return;const i=[].slice.call(n.childNodes);let r=-1;return i.forEach(function(a,c){(0,I.query)(".djs-element",a)===e&&(r=c)}),r}insertChildAtIndex(e,t,n){const r=[].slice.call(t.childNodes)[n];t.insertBefore(e,r.nextSibling)}isZeroDimensional(e){return e.width===0&&e.height===0}isPointInside(e,t){return e.x>t.left&&e.x<t.left+t.width&&e.y>t.top&&e.y<t.top+t.height}getStepSize(e,t){const n=Math.log(e.min)/Math.log(10),i=Math.log(e.max)/Math.log(10);return(Math.abs(n)+Math.abs(i))/t}getOverlayClipPath(e,t){return`polygon(${[[t.left,t.top],[t.left+t.width,t.top],[t.left+t.width,t.top+t.height],[t.left,t.top+t.height],[t.left,e.height],[e.width,e.height],[e.width,0],[0,0],[0,e.height],[t.left,e.height]].map(([i,r])=>`${i}px ${r}px`).join(", ")})`}validViewbox(e){return(0,F.every)(e,t=>(0,F.isObject)(t)?this.validViewbox(t):(0,F.isNumber)(t)&&isFinite(t))}subscribeElementEvents(){this.eventBus.on(["shape.added","connection.added"],_e.MIN,this._onElementAdded),this.eventBus.on(["shape.removed","connection.removed"],_e.MIN,this._onElementRemoved),this.eventBus.on(["elements.changed"],_e.MIN,this._onElementsChanged),this.eventBus.on(["element.updateId"],_e.MIN,this._onElementUpdateId)}unsubscribeElementEvents(){this.eventBus.off(["shape.added","connection.added"],this._onElementAdded),this.eventBus.off(["shape.removed","connection.removed"],this._onElementRemoved),this.eventBus.off(["elements.changed"],this._onElementsChanged),this.eventBus.off(["element.updateId"],this._onElementUpdateId)}onElementAdded({element:e}){this.addElement(e),this.update()}onElementRemoved({element:e}){this.removeElement(e),this.update()}onElementsChanged({elements:e}){e.forEach(t=>this.updateElement(t)),this.update()}onElementUpdateId({element:e,newId:t}){try{const n=(0,I.query)("#"+rm()(e.id),this.elementsGroup);n&&(n.id=t)}catch(n){console.warn(`Minimap#updateElementId error: ${n}`)}}registerPopupMenu(){this.popupMenu.registerProvider("zoom",this),this.eventBus.on("minimap.open",()=>this.popupMenu.close()),this.eventBus.on("minimap.close",()=>this.popupMenu.close())}delay(e=0){return new Promise(t=>v.delay(t,e))}loadData(){var e=this;return(0,b.A)(function*(){yield e.delay();let t=Number(new Date);const n=e.elementRegistry.getAllElements();for(let i=0,r=n.length;i<r;i++){try{e.addElement(n[i])}catch(c){console.error(c)}Number(new Date)-t>e.loadMiniMapRenderInterval&&(yield e.delay(),t=Number(new Date))}})()}open(){var e=this;return(0,b.A)(function*(){e.setOpenState(!0),yield e.loadData(),e.update(),e.subscribeElementEvents(),e.eventBus.fire("minimap.open")})()}close(){this.isOpen()&&(this.setOpenState(!1),this.unsubscribeElementEvents(),this.eventBus.fire("minimap.close"))}isOpen(){return this._state.isOpen}resetView(){var e=this;return(0,b.A)(function*(){yield e.zoomScroll.animateResetView()})()}fitToView(){this.zoomScroll.fitToView()}preview(){this.isOpen()?this.close():this.open()}togglePopupMenu(){if(this.popupMenu.isOpen()){this.popupMenu.close();return}this.popupMenu.open({},"zoom",{cursor:{}})}getEntries(){var e=this;return[...[25,50,75,100,200,300].map(n=>({id:`zoom-${n}`,label:`${n}%`,action:function(){var i=(0,b.A)(function*(){yield e.zoomScroll.animateZoom(n/100)});return function(){return i.apply(this,arguments)}}()})),{id:"separator-1",className:"entry-separator",disabled:!0},{id:"reset-view",label:this.config.localizableStrings.get("resetView"),action:()=>this.resetView()},{id:"fit-into-view",label:this.config.localizableStrings.get("fitToView"),action:()=>this.fitToView()}]}};Vu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__param)(2,g("elementRegistry")),(0,u.__param)(3,g("zoomScroll")),(0,u.__param)(4,g("localStorage")),(0,u.__param)(5,g("popupMenu")),(0,u.__param)(6,g("config")),(0,u.__param)(7,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object,G])],Vu);var Xv=y(18587);let Lu=class extends Xv.A{constructor(e,t){super(e,t),this.eventBus=e,this.canvas=t,e.on("diagram.init",_e.LOW,()=>{this.updateEntries()})}updateEntries(){const e=this.getEntries();(0,F.forEach)(e,function(t,n){const i=(0,I.query)(`[data-action="${n}"]`);t.hasOwnProperty("menu")&&(0,I.classes)(i).add("create-menu")})}getEntries(){return super.getEntries()}};Lu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Lu);let Bu=class{constructor(e,t,n,i,r,a,c,h,p,m,f){this.create=e,this.elementFactory=t,this.palette=n,this.featureProvider=i,this.canvas=r,this.elements=a,this.paletteElements=c,this.rules=h,this.eventBus=p,this.createPopupMenu=m,this.config=f,this.dataActionPrefix="create-",this.init()}init(){this.rules.allowed("canShowPalette")&&(this.palette.registerProvider(this),this.subscribeEvents())}subscribeEvents(){this.eventBus.on("createPopupMenu.open",e=>this.activateEntry(e)),this.eventBus.on("createPopupMenu.close",e=>this.deactivateEntry(e))}getCreateShapeConfig(e){const t=this.elements.getConfig(e),{type:n,width:i,height:r}=t;return{type:n,width:i,height:r}}createActionClick(e,t){const n=this.getCreateShapeConfig(e),i=this.elementFactory.createShape(n);this.create.start(t,i),this.createPopupMenu.close()}openCreateMenu(e,t,n){this.createPopupMenu.open(e,t,n)}getCreateMenuEntries(e){return e.menu.map(t=>this.elements.items[t]).filter(t=>t).map(t=>({action:{dragstart:this.createActionClick.bind(this,t)},id:t.userTaskType||t.type,imageUrl:t.smallImage,label:this.config.localizableStrings.get(t.caption)}))}activateEntry({paletteEntryId:e}){const t=(0,I.query)(`[data-action="${e}"]`);(0,I.classes)(t).add("active")}deactivateEntry({paletteEntryId:e}){const t=(0,I.query)(`[data-action="${e}"]`);(0,I.classes)(t).remove("active")}getPaletteEntries(){const e={};return Object.values(this.paletteElements.getElements()).forEach(t=>{const n=this.dataActionPrefix+t.type,i={group:"elements",action:{dragstart:this.createActionClick.bind(this,t)},...t};if(t.menu){const r=this.getCreateMenuEntries(t);r.length?i.action.click=this.openCreateMenu.bind(this,t,n,r):delete i.menu}e[n]=i}),e}};Bu=(0,u.__decorate)([(0,u.__param)(0,g("create")),(0,u.__param)(1,g("elementFactory")),(0,u.__param)(2,g("palette")),(0,u.__param)(3,g("featureProvider")),(0,u.__param)(4,g("canvas")),(0,u.__param)(5,g("elements")),(0,u.__param)(6,g("paletteElements")),(0,u.__param)(7,g("rules")),(0,u.__param)(8,g("eventBus")),(0,u.__param)(9,g("createPopupMenu")),(0,u.__param)(10,g("config")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,ie,Ja,Object,Object,So,Object])],Bu);let Fu=class{constructor(e,t,n,i,r){this.config=e,this.toolManager=t,this.dragging=n,this.lassoTool=i,this.spaceTool=r}getPaletteToolsConfig(){return{arrow:{icon:"icon_arrow_select_24",title:"arrow",click:()=>{this.toolManager.setActive(null),this.dragging.cancel()}},lasso:{icon:"icon_sellect_24",title:"lasso",click:()=>{this.lassoTool.toggle()}},space:{icon:"icon_move_24",title:"space",click:()=>{this.spaceTool.toggle()}}}}getPaletteTools(e=!0){const t={},n=this.getPaletteToolsConfig();return Object.keys(n).forEach(i=>{const{icon:r,title:a,click:c}=n[i];t[i]={group:"tools",html:`<div class="entry material-icons">${r}</div>`,title:this.config.localizableStrings.get(a),action:{click:c}}}),e?{...t,separator:{separator:!0}}:t}};Fu=(0,u.__decorate)([(0,u.__param)(0,g("config")),(0,u.__param)(1,g("toolManager")),(0,u.__param)(2,g("dragging")),(0,u.__param)(3,g("lassoTool")),(0,u.__param)(4,g("spaceTool")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object])],Fu);let zu=class{constructor(e,t){this.eventBus=e,this.canvas=t,this._isOpen=!1,this._init()}_init(){this._popupContainer=(0,I.domify)('<div class="djs-diagram-popup"></div>');const e=this.canvas.getContainer();this._popup=e.appendChild(this._popupContainer),this._subscribeEvents()}_subscribeEvents(){this._subscribeEventBusEvents(),this._subscribeDomEvents()}_subscribeDomEvents(){this._popup.onwheel=e=>this._onWheel(e)}_onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._popup.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}_onViewBoxChanged(){this._state&&this._state.parentContainer&&this.open({parentContainer:this._state.parentContainer,html:this._state.html,width:this._state.width,options:this._state.options})}_subscribeEventBusEvents(){this.eventBus.on(["canvas.resized","zoom.changed","selection.changed"],()=>this.close()),this.eventBus.on("popup.open",e=>this.open(e)),this.eventBus.on("canvas.viewbox.changing",()=>this.hide()),this.eventBus.on("canvas.viewbox.changed",()=>this._onViewBoxChanged())}getPopupPosition(e){const{parentContainer:t}=e,{e:n,f:i}=t.getCTM(),{height:r}=t.getBoundingClientRect(),a=5,c=i+r+a,{width:h}=t.getBoundingClientRect(),p=e.options?.direction||"right";let m=n;return p==="right"&&(m+=h-e.width),p==="left"&&(m-=h),{x:m,y:c}}open(e){if(!e.width)throw new Error("width must be > 0");this._state={parentContainer:e.parentContainer,html:e.html,width:e.width,options:e.options};const{x:t,y:n}=this.getPopupPosition(e);return(0,v.assign)(this._popupContainer.style,{left:`${t}px`,top:`${n}px`,visibility:"visible",width:`${e.width}px`}),this._isOpen=!0,this._popupContainer.innerHTML=e.html,this._popupContainer}close(){this._isOpen&&(this.hide(),this._state={})}hide(){(0,v.assign)(this._popupContainer.style,{visibility:"hidden"}),this._popupContainer.innerHTML=""}};zu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object])],zu);var Qv=y(6226);let Uu=class extends Qv.A{constructor(e,t,n){super(e,t,n),this.contextPadItemWidth=32,this.padding=10}subscribeEvents(){this.preventScrollParent(this.getContainer());const e=this._eventBus;e.once("createPopupMenu.open",this.close.bind(this)),e.once("element.mousedown",_e.HIGH,this.close.bind(this)),e.once("keyboard.keydown",_e.HIGH,this.close.bind(this))}unsubscribeEvents(){const e=this._eventBus;e.off("createPopupMenu.open",this.close.bind(this)),e.off("element.mousedown",this.close.bind(this)),e.off("keyboard.keydown",this.close.bind(this))}fixContainerPosition(e,t){const i=this._canvas.getContainer().getBoundingClientRect(),r=e.getBoundingClientRect(),a=i.y+this.padding;if(r.top<a){const c=this.padding,h=t.x-this.contextPadItemWidth-r.width-this.padding;(0,F.assign)(e.style,{top:`${c}px`,left:`${h}px`})}}getContainer(){return this._current.container}preventScrollParent(e){e.onwheel=t=>this.onWheel(t)}open(e,t,n){super.open(e,t,n);const i=this.getContainer();this.fixContainerPosition(i,n),this.subscribeEvents(),(0,F.assign)(i.style,{opacity:1})}close(){super.close(),this.unsubscribeEvents()}onWheel(e){const t=e.wheelDeltaY||-(e.deltaY*25);this._current.container.scrollTop-=t,e.stopPropagation(),e.returnValue=!1}};Uu=(0,u.__decorate)([(0,u.__param)(0,g("config.popupMenu")),(0,u.__param)(1,g("eventBus")),(0,u.__param)(2,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object])],Uu);var eS=y(38134);class tS extends eS.A{addDragger(e,t,n){const i=super.addDragger(e,t,n);return i.classList.add(e.type),i}}var oc=y(95820),nS=y(97975),hn=y(19187);const qe={Connection:{Fill:"none",MarkerShape:"M-10,3 L2,0 L-10,-3 Z",MarkerfillOpacity:1,StrokeLinejoin:"round",StrokeWidth:1,PathStrokeWidth:2}};var wo;(function(o){o.Connection="connection",o.ConnectionEndMarker="connection-end-marker"})(wo||(wo={}));const $u={arrowHoverStrokeColor:"#1186D8",arrowStrokeColor:"#8095b3",connectionMarkerFillColor:"#FFFF",connectionMarkerStrokeColor:"#60779F",connectionStrokeColor:"#8095B3"};class om{get endMarker(){const e=(0,x.vt)("path");return(0,x.CF)(e,{d:qe.Connection.MarkerShape,"fill-opacity":qe.Connection.MarkerfillOpacity,fill:$u.arrowStrokeColor,stroke:$u.arrowStrokeColor,strokeLinejoin:qe.Connection.StrokeLinejoin,strokeWidth:qe.Connection.StrokeWidth,class:wo.ConnectionEndMarker}),e}_getLastSegment(e){const t=e.length;return{a:e[t-2],b:e[t-1]}}_getFirstSegment(e){return{a:e[1],b:e[0]}}_angle(e){const t=e.b.y-e.a.y,n=e.b.x-e.a.x;return Math.atan2(t,n)}_renderMarker(e,t,n,i){e&&(this._transformMarker(e,i,n),(0,x.BC)(t,e))}_transformMarker(e,t,n){(0,x.pd)(e,(0,x.uK)(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),n.x,n.y))}renderMarkers(e,t){const n=t.waypoints,i=this._getLastSegment(n),r=this._angle(i),a=this._getFirstSegment(n),c=this._angle(a),h=this.startMarker(t);this._renderMarker(h,e,a.b,c),this._renderMarker(this.endMarker,e,i.b,r)}startMarker(e){return null}getConnectionAttributes(e){return{class:wo.Connection,fill:qe.Connection.Fill,stroke:$u.connectionStrokeColor,strokeLinejoin:qe.Connection.StrokeLinejoin,strokeWidth:qe.Connection.PathStrokeWidth}}drawConnection(e,t,n){n.itemName&&(0,x.CF)(t,{"data-item-marker":n.itemName});const i=(0,x.vt)("g"),r=this.getConnectionAttributes(n.type),a=n.waypoints,c=["m"+a[0].x+","+a[0].y];for(let p=1;p<a.length;p++)c.push("L"+a[p].x+","+a[p].y);const h=(0,x.vt)("path");return(0,x.CF)(h,{d:c.join(" ")}),(0,x.CF)(h,r),(0,x.BC)(i,h),this.renderMarkers(i,n),(0,x.BC)(t,i),i}}var pn;(function(o){o[o.before=0]="before",o[o.after=1]="after",o[o.instead=2]="instead"})(pn||(pn={}));function xo(o,e,t=pn.instead){return(n,i,r)=>{r===void 0&&(r=Object.getOwnPropertyDescriptor(n,i));const a=r.value;return e.__instance__ instanceof e||(e.__instance__=new e),r.value=function(){const c=[].slice.call(arguments),h=[...c];let p;if(this.createFeatureContext instanceof Function&&h.unshift(this.createFeatureContext.call(this)),o(...c)){const m=e.__instance__;switch(t){case pn.before:return p=m[i].apply(m,[...h]),a.apply(this,[...c,p]);case pn.after:return p=a.apply(this,c),m[i].apply(m,[...h,p]);default:return m[i].apply(m,[...h])}}return a.apply(this,[...c,p])},r}}class am{drawConnection(e,t,n){}}(0,u.__decorate)([xo(()=>!0,om),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object,Object,Object]),(0,u.__metadata)("design:returntype",Object)],am.prototype,"drawConnection",null);var cm;let ni=class{constructor(e,t,n,i){this.elements=e,this.styles=t,this.diagramText=n,this.eventBus=i}updateClass(e,t){const n=this.elements.getConfig(t),i=e.parentElement||e.parentNode,r=i.classList;(0,v.forEach)(this.elements.items,a=>{r.remove(a.type),r.remove(a.userTaskType)}),i.classList.add(n.userTaskType||n.type)}createText(e,t,n){const i=this.diagramText.createText(t,n);return(0,x.Ly)(i).add("djs-label"),n.className&&(0,x.Ly)(i).add(n.className),(0,x.BC)(e,i),i}drawRect(e,t,n,i,r,a){(0,v.isObject)(r)&&(a=r,r=0),r=r||0,a=this.styles.computeStyle(a,{fill:"none",stroke:"#EBEBEB",strokeWidth:1});const c=(0,x.vt)("rect");return(0,x.CF)(c,{height:n-r*2,rx:i,ry:i,width:t-r*2,x:r,y:r}),(0,x.CF)(c,a),(0,x.BC)(e,c),c}draw(e,t){return this.updateClass(e,t),null}};ni=(0,u.__decorate)([(0,u.__param)(0,g("elements")),(0,u.__param)(1,g("styles")),(0,u.__param)(2,g("diagramText")),(0,u.__param)(3,g("eventBus")),(0,u.__metadata)("design:paramtypes",[Object,typeof(cm=typeof hn.A<"u"&&hn.A)=="function"?cm:Object,dn,Object])],ni);const lm={ELLIPSE:"ellipse",RECTANGLE:"rect"};class iS{static{this.xmlns="http://www.w3.org/2000/svg"}static createFeFlood(e,t="#000",n=0){return this.createElement(e,{"flood-color":t,"flood-opacity":n||0,result:"colorResult"},"feFlood")}static createFeComposite(e){return this.createElement(e,{operator:"in",in:"colorResult",in2:"blurResult",result:"shadowResult"},"feComposite")}static createFeGaussianBlur(e,t=0){return this.createElement(e,{result:"blurResult",in:"offsetResult",stdDeviation:t},"feGaussianBlur")}static createFeBlend(e){return this.createElement(e,{in:"SourceGraphic",in2:"shadowResult",mode:"normal"},"feBlend")}static setAttribute(e,t){const n=Object.keys(t);for(const i of n)e.setAttribute(i.toString(),t[i])}static createElement(e,t,n){let i;return t&&t.id&&(i=e.getElementById(t.id)),i||(i=document.createElementNS(this.xmlns,n)),t&&this.setAttribute(i,t),i}static createFilter(e,t){return this.createElement(e,{id:t,width:"200%",height:"200%"},"filter")}static createFeOffset(e,t=0,n=0){return this.createElement(e,{result:"offsetResult",in:"SourceAlpha",dx:t,dy:n},"feOffset")}static addDefs(){const e=document.querySelector("svg"),t=e.getElementsByTagName("defs")[0];if(t==null){const n=document.createElementNS(this.xmlns,"defs");return e.appendChild(n)}return t}static createShadowFilter(e){const t=document.querySelector("svg"),n=e.name;if(!n)throw new Error("ArgumentNullOrEmptyException");const i=t.getElementById(n),r="url(#"+n+")";if(i)return r;const a=this.addDefs(),c=this.createFilter(t,n),h=this.createFeOffset(t,e.offsetX,e.offsetY);c.appendChild(h);const p=this.createFeGaussianBlur(t,e.blur);c.appendChild(p);const m=this.createFeFlood(t,e.color,e.opacity);c.appendChild(m);const f=this.createFeComposite(t);c.appendChild(f);const C=this.createFeBlend(t);return c.appendChild(C),a.appendChild(c),r}}class um extends ni{getEllipseBackgroundConfig(e){const n=e.backgroundStyle.padding||0,i=Math.round(Math.max(e.width,e.height)/2),r=Math.round(e.height/2);return{rx:i+n,ry:r+n,cx:Math.round(e.width/2),cy:Math.round(e.height/2-1)}}getLabelBackgroundConfig(e){const t=e.backgroundStyle,i=(t&&t.type)===lm.ELLIPSE?this.getEllipseBackgroundConfig(e):this.getDefaultBackgroundConfig(e),r=t&&t.fill;v.assign(i,r?{fill:r}:{style:"fill: transparent;"});const a=t&&t.filter;if(a){const c=iS.createShadowFilter(a);v.assign(i,{filter:c})}return i}setLabelBackground(e,t){const n=t.backgroundStyle,i=n&&n.type||lm.RECTANGLE,r=(0,x.vt)(i),a=this.getLabelBackgroundConfig(t);(0,x.CF)(r,a),(0,x.BC)(e,r)}getDefaultBackgroundConfig(e){return{height:e.height,width:e.width}}getLabelText(e){return e.caption||e.labelTarget&&e.labelTarget.caption||""}getDrawOptions(e){const t=e.caption?0:3,n={box:{height:e.height,width:e.width+t,x:e.x,y:e.y},fitBox:!1,style:{...this.diagramText.style,direction:"ltr"}};return v.assign(n.style,e.style),n}draw(e,t){super.draw(e,t),this.setLabelBackground(e,t);const n=this.getLabelText(t),i=this.getDrawOptions(t),r=this.diagramText.createText(n,i);return(0,x.Ly)(r).add("djs-label"),(0,x.BC)(e,r),r}}let Eo=class{constructor(e,t){this.renderingLabel=e,this.renderingShape=t}create(e){return e===je.label?this.renderingLabel:this.renderingShape}};Eo=(0,u.__decorate)([(0,u.__param)(0,g("renderingLabel")),(0,u.__param)(1,g("renderingShape")),(0,u.__metadata)("design:paramtypes",[um,ni])],Eo);function dm(o,e=pn.before){return xo(()=>!0,o,e)}var hm,pm;let Io=class extends nS.A{constructor(e,t,n,i,r){super(e),this.eventBus=e,this.styles=t,this.diagramText=n,this.renderingFactory=i,this.elementRegistry=r}setDataItemMarker(e,t){let n=t.itemName;if(t.type===je.label){const i=t.labelTarget.itemName;n=n||i&&i+"_label"}n&&e.setAttributeNS(null,"data-item-marker",n)}canRender(){return!0}drawShape(e,t){return this.setDataItemMarker(e,t),this.renderingFactory.create(t.type).draw(e,t)}drawConnection(e,t){return super.drawConnection(e,t)}createFeatureContext(){return{styles:this.styles,diagramText:this.diagramText,elementRegistry:this.elementRegistry}}};(0,u.__decorate)([dm(am,pn.instead),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object,Object]),(0,u.__metadata)("design:returntype",void 0)],Io.prototype,"drawConnection",null),Io=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("styles")),(0,u.__param)(2,g("diagramText")),(0,u.__param)(3,g("renderingShapeFactory")),(0,u.__param)(4,g("elementRegistry")),(0,u.__metadata)("design:paramtypes",[typeof(hm=typeof oc.A<"u"&&oc.A)=="function"?hm:Object,typeof(pm=typeof hn.A<"u"&&hn.A)=="function"?pm:Object,Object,Eo,Object])],Io);var sS=y(19506);let Gu=class extends sS.A{constructor(e,t,n,i,r,a,c,h){super(n,t,e,i,r,a),this.elements=c,this.diagramUtils=h,this.AXIS_TO_DIMENSION={x:"width",y:"height"}}_excludeLabelsWithoutTargets(e){return e.filter(t=>t.type===Bt.label?e.some(n=>n.id===t.labelTarget.id):!0)}calculateAdjustments(e,t,n,i){const r=[],a=[];return e.forEach(c=>{const h=c[t],p=h+c[this.AXIS_TO_DIMENSION[t]];if(c.parent&&!c.waypoints){if(!this.canResizeShape(c,i,t)&&(n>0&&h>i||n<0&&p<i))return r.push(c);if(this.canResizeShape(c,i,t)||h<i&&p>i&&this._rules.allowed("shape.resize",{shape:c}))return a.push(c)}}),{movingShapes:this._excludeLabelsWithoutTargets(r),resizingShapes:this._excludeLabelsWithoutTargets(a)}}init(e,t){const n=super.init(e,t);return n&&(t.minAllowedDelta=this.getMinAllowedDelta(t.resizingShapes,t.direction,t.movingShapes),t.spaceToolConstraints=null),n}getDelta(e){const t=super.getDelta(e);return G.getCorrectSpaceToolDelta(t,e)}canResizeShape(e,t,n){return!1}getMinAllowedDelta(e,t,n){return null}};Gu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("dragging")),(0,u.__param)(2,g("canvas")),(0,u.__param)(3,g("modeling")),(0,u.__param)(4,g("rules")),(0,u.__param)(5,g("toolManager")),(0,u.__param)(6,g("elements")),(0,u.__param)(7,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,ie,G])],Gu);var rS=y(7264);class oS extends rS.A{getDelta(e){const t=super.getDelta(e);return G.getCorrectSpaceToolDelta(t,e)}}let Hu=class{constructor(e,t,n){this.eventBus=e,this.Tooltips=t,this.canvas=n,this.tooltipTimeout=400,e.on("element.hover",this.onElementHover.bind(this)),this.Tooltips._updateRoot=()=>{}}onElementHover(e){clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(()=>{const{element:t,gfx:n}=e;this.elementId!==t.id&&this.tooltipId&&this.removeTooltip(),t.tooltip&&!this.tooltipId&&this.addTooltip(n,t)},this.tooltipTimeout)}removeTooltip(){this.Tooltips.remove(this.tooltipId),this.tooltipId=null}addTooltip(e,t){this.elementId=t.id;const n=t.tooltipConfig||{};this.tooltipId=this.Tooltips.add({position:{x:0,y:0},type:n.type,html:this.getTemplate(t.tooltip)}),this.setPosition(e,t)}getTemplate(e){return`<div class="tooltip">${e}</div>`}getDiagramSize(){const t=this.canvas.getContainer().getBoundingClientRect();return{width:t.width,height:t.height}}getHtmlContainer(){return this.Tooltips.get(this.tooltipId).htmlContainer}setPosition(e,t){const{a:n,e:i,f:r}=e.getCTM();let a=i+t.width*n,c=r+t.height*n;const h=this.getDiagramSize(),p=this.getHtmlContainer(),{width:m,height:f}=p.getBoundingClientRect();a+m>h.width&&(a=i-m),c+f>h.height&&(c=r-f),Object.assign(p.style,{left:a+"px",top:c+"px"})}};Hu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("tooltips")),(0,u.__param)(2,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object])],Hu);var mm=y(40127),aS=y(436),cS=y(56165),gm,fm,_m;const lS={min:.2,max:4};let Wu=class extends aS.A{constructor(e,t,n,i,r,a){super(e,t,n),this.config=e,this.eventBus=t,this.canvas=n,this.createPopupMenu=i,this.popupMenu=r,this.localStorage=a,this.cancelAnimation$=new l.Subject,this.eventBus.on(["canvas.viewbox.changed"],_e.MEDIUM,c=>{this.onCanvasViewBoxChanged(c)})}cancelAnimation(){this.cancelAnimation$.next(!0)}_handleWheel(e){if(this.cancelAnimation(),this.createPopupMenu.isOpen()){this.createPopupMenu.onWheel(e);return}if(this.popupMenu.isOpen()){this.popupMenu.onWheel(e);return}super._handleWheel(e)}onCanvasViewBoxChanged(e){const t=this.canvas.scroll();t.x=Math.round(t.x)||0,t.y=Math.round(t.y)||0;const n=this.getInitScroll();t.x!==n.x||t.y!==n.y?this.localStorage.set("scroll",t):this.localStorage.remove("scroll");const i=e.viewbox.scale;i&&i!==this.getInitScale()?this.localStorage.set("scale",i):this.localStorage.remove("scale")}getInitScale(){return this.config&&this.config.initScale||1}getInitScroll(){return this.config&&this.config.initScroll||{x:0,y:0}}getScale(){return this.canvas.viewbox().scale}getScroll(){return this.canvas.scroll()}setZoom(e){const t=this.canvas.viewbox().outer,n={x:t.width/2,y:t.height/2};this.canvas.zoom((0,cS.N)(lS,e),n)}setScroll(e){const t=this.getScroll();this.canvas.scroll({dx:-t.x+e.x,dy:-t.y+e.y})}animateZoomScroll(e){var t=this;return(0,b.A)(function*({toScale:n,toScroll:i,fromScale:r=null,fromScroll:a=null,stepCount:c=20,stepPeriod:h=1}){if(t.cancelAnimation(),r=r||t.getScale(),a=a||t.getScroll(),r===n&&a.x===i.x&&a.y===i.y)return;const p=(n-r)/c,m=(i.x-a.x)/c,f=(i.y-a.y)/c;return new Promise(C=>{(0,l.interval)(h).pipe((0,d.take)(c+1),(0,d.takeUntil)(t.cancelAnimation$),(0,d.finalize)(()=>{t.eventBus.fire("animateZoomScroll.done"),C()})).subscribe(S=>{t.setZoom(r+p*S),t.setScroll({x:a.x+m*S,y:a.y+f*S})})})}).apply(this,arguments)}animateZoom(e){var t=this;return(0,b.A)(function*(){const n=t.getScroll();yield t.animateZoomScroll({toScale:e,toScroll:n,stepCount:5,stepPeriod:1})})()}initZoomScroll(e=null,t=0){const n=e||this.localStorage.get("scroll")||this.getInitScroll(),i=t||this.localStorage.get("scale")||this.getInitScale();this.getScale()!==i&&this.setZoom(i);const a=this.getScroll();(a.x!==n.x||a.y!==n.y)&&this.setScroll(n)}animateResetView(){var e=this;return(0,b.A)(function*(){yield e.animateZoomScroll({toScale:e.getInitScale(),toScroll:e.getInitScroll()})})()}fitToView(){this.cancelAnimation(),this.canvas.zoom("fit-viewport",null);const e=this.getInitScroll();this.canvas.scroll({dx:e.x,dy:e.y})}zoomOut(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()-e)}zoomIn(e=.1){this.cancelAnimation(),this.setZoom(this.getScale()+e)}};Wu=(0,u.__decorate)([(0,u.__param)(0,g("config")),(0,u.__param)(1,g("eventBus")),(0,u.__param)(2,g("canvas")),(0,u.__param)(3,g("createPopupMenu")),(0,u.__param)(4,g("popupMenu")),(0,u.__param)(5,g("localStorage")),(0,u.__metadata)("design:paramtypes",[Object,typeof(gm=typeof oc.A<"u"&&oc.A)=="function"?gm:Object,typeof(fm=typeof wu.A<"u"&&wu.A)=="function"?fm:Object,So,typeof(_m=typeof mm.A<"u"&&mm.A)=="function"?_m:Object,Lt])],Wu);class Zu{constructor(e){this.context=e,this.modeling=e.modeling,this.localizableStrings=e.localizableStrings,this.canvas=e.canvas,this.contextPad=e.contextPad,this.popupMenu=e.popupMenu,this.connect=e.connect,this.create=e.create,this.elementFactory=e.elementFactory,this.elements=e.elements,this.elementToolsConfig=e.elementToolsConfig}getAddItemsConfig(e){const t=this.elementToolsConfig.addItems,n={};return t.forEach(i=>{const r=this.addElementDragStart.bind(this,i);n["add."+i.type]={action:{dragstart:r},imageUrl:i.image,title:i.title}}),n}getDragStartShapeConfig(e){const t=this.elements.getConfig(e);return{type:e.type,width:t.width,height:t.height,caption:""}}addElementDragStart(e,t,n){const i=this.getDragStartShapeConfig(e),r=this.elementFactory.createShape(i);this.create.start(t,r,{source:n})}getDeleteConfig(e){return{delete:{action:{click:()=>{this.modeling.removeElements([e])}},...this.elementToolsConfig.tools.delete}}}getSetupConfig(){return{setup:{action:{click:(e,t)=>{const n=this.getPopupMenuPosition(e,t);this.popupMenu.open(t,"setup",n)}},...this.elementToolsConfig.tools.setup}}}getPopupMenuPosition(e,t){const n=this.canvas.getContainer().getBoundingClientRect(),i=this.contextPad.getPad(t).html.getBoundingClientRect();return{cursor:{x:e.clientX,y:e.clientY},x:i.left+i.width+3-n.left,y:i.top-1-n.top}}getConnectConfig(){return{connect:{action:{dragstart:(e,t,n)=>{this.connect.start(e,t,n)}},...this.elementToolsConfig.tools.connect}}}hasSetupMenu(e){return!this.popupMenu.isEmpty(e,"setup")}hasConnectConfig(e){return e.type&&e.type!==je.connection}hasAddItemsMenu(e){return!0}hasDeleteAction(e){return!0}getContextPadEntries(e){const t={};return this.hasDeleteAction(e)&&Object.assign(t,this.getDeleteConfig(e)),this.hasSetupMenu(e)&&Object.assign(t,this.getSetupConfig()),this.hasAddItemsMenu(e)&&Object.assign(t,this.getAddItemsConfig(e)),this.hasConnectConfig(e)&&Object.assign(t,this.getConnectConfig()),t}}class ym extends Zu{getContextPadEntries(){return{}}}class Cm{constructor(e){this.context=e}getElementToolsFeature(e){return G.isLabel(e)?new ym(this.context):new Zu(this.context)}}let ac=class{constructor(e,t,n,i,r,a,c,h,p,m){this.elements=p,this.elementToolsConfig=m;const f=h.localizableStrings;t.registerProvider(this);const C={modeling:n,localizableStrings:f,contextPad:t,canvas:c,popupMenu:a,elementFactory:i,create:r,connect:e,elements:p,elementToolsConfig:m};this.initializeElementToolsFactory(C)}initializeElementToolsFactory(e){this.toolsFactory=new Cm(e)}getContextPadEntries(e){return this.toolsFactory.getElementToolsFeature(e).getContextPadEntries(e)}};ac=(0,u.__decorate)([(0,u.__param)(0,g("connect")),(0,u.__param)(1,g("contextPad")),(0,u.__param)(2,g("modeling")),(0,u.__param)(3,g("elementFactory")),(0,u.__param)(4,g("create")),(0,u.__param)(5,g("popupMenu")),(0,u.__param)(6,g("canvas")),(0,u.__param)(7,g("config")),(0,u.__param)(8,g("elements")),(0,u.__param)(9,g("elementToolsConfig")),(0,u.__metadata)("design:paramtypes",[Object,Object,Je,Object,Object,Object,Object,Object,ie,Object])],ac);class uS{constructor(){this._featureService=new l.ReplaySubject(1)}set featureService(e){this._featureService.next(e)}getFeatureServiceValues(e){return this._featureService.subscribe(t=>{t.getFeatureValues(n=>{e(n)})})}}var dS=y(17521);class hS{findIntersectSegment(e,t){const n={x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y+t.height};let i=-1,r;const a=e.waypoints;for(let c=0;c<a.length-1;c++){const h={x1:a[c].x,y1:a[c].y,x2:a[c+1].x,y2:a[c+1].y},p=n,m={x1:Math.min(h.x1,h.x2)-1,y1:Math.min(h.y1,h.y2)-1,x2:Math.max(h.x1,h.x2)+1,y2:Math.max(h.y1,h.y2)+1},f=Math.max(0,Math.min(m.x2,p.x2)-Math.max(m.x1,p.x1)),C=Math.max(0,Math.min(m.y2,p.y2)-Math.max(m.y1,p.y1)),S=f*C;(S>i||i<0)&&(i=S,r=h)}return r}getAlignDelta(e,t){let n=0,i=0;const r=(0,ti.pp)(t);return e.x1===e.x2?n=e.x1-r.x:i=e.y1-r.y,{x:n,y:i}}isForbiddenType(e){return G.isLabel(e)}canSplit(e){return e&&e.length===1&&!this.isForbiddenType(e[0])}splitConnection({connection:e,shapes:t,modeling:n}){if(e&&this.canSplit(t)){const i=t[0],r=e.target,a=this.findIntersectSegment(e,i),c=this.getAlignDelta(a,i);n.moveShape(i,c);const h=(0,dS.jz)(i);n.reconnectEnd(e,i,h,{isUpdateConnectionType:!1}),n.connect(i,r,{})}}}var pS=y(49096);const xw=4,Ew=4,Iw=5,bm=3.5,Aw=1,Pw=16.8699;let Yu=class{constructor(e,t,n,i,r,a,c){this.eventBus=e,this.directEditing=t,this.canvas=n,this.modeling=i,this.diagramText=r,this.selection=a,this.rules=c,this.directEditing.registerProvider(this),this.rules.allowed("canLabelEdit")?this.subscribeEvents():this.subscribeSelectionEvents()}clearLabelTargetsCaption(e){const t=v.compact(v.map(e.elements,n=>n.labelTarget));v.forEach(t,n=>this.clearElementCaption(n))}clearElementCaption(e){e.caption="",this.eventBus.fire(ve.element.updateLabelExecuted,{context:{element:e,text:""}})}onKeyDown({keyEvent:e}){const t=this.selection.get(),n=t.length===1&&t[0];if(n){if(Mo(e)===De.Enter.keyCode)return v.defer(()=>this.editElementLabel(n)),!1;if(Uv(e))return n.needClearCaption=!0,this.editElementLabel(n),!1}}_copySelectedLabelText(){const e=this.selection.get(),t=e.length===1&&e[0];if(!t)return;const n=t.labelTarget.caption,i=r=>{(r.clipboardData||window.clipboardData).setData("text",n),r.preventDefault()};document.addEventListener("copy",i,!1),document.execCommand("copy"),document.removeEventListener("copy",i,!1)}_selectLabelText(e){const t=document.createRange(),n=document.querySelector(`[data-element-id="${e.id}"] .foreign-text`);t.selectNodeContents(n);const i=window.getSelection();i.removeAllRanges(),i.addRange(t)}showElementLabel(e){const t=e.active&&e.active.element.label;t&&this.canvas.removeMarker(t,"djs-element-hidden")}subscribeSelectionEvents(){this.eventBus.on(["element.dblclick"],({element:e})=>{e.type===Bt.label&&this._selectLabelText(e)}),this.eventBus.on(["keyboard.keydown"],({keyEvent:e})=>{Dt(e,De.KeyC,{ctrl:!0})&&this._copySelectedLabelText()})}subscribeEvents(){this.eventBus.on(["element.dblclick"],e=>this.editElementLabel(e.element)),this.eventBus.on(["canvas.viewbox.changing","element.mousedown","popupMenu.open"],()=>{this.directEditing.isActive()&&this.directEditing.complete()}),this.eventBus.on(["drag.init"],e=>{if(this.directEditing.isActive()){this.directEditing.complete();const t=e.shape;t&&t.x&&t.y&&this.selection.select(t)}}),this.eventBus.on(["create.end"],_e.LOW,e=>this.onCreateEnd(e)),this.eventBus.on(["connect.end"],_e.LOW,e=>{const t=e.context.connection;this.editElementLabel(t)}),this.eventBus.on(["directEditing.activate"],e=>{const t=e.active.element.label;t&&this.canvas.addMarker(t,"djs-element-hidden")}),this.eventBus.on(["directEditing.complete","directEditing.cancel"],e=>this.showElementLabel(e)),this.eventBus.on([ve.element.deleteElementsExecuted],e=>this.clearLabelTargetsCaption(e.context)),this.eventBus.on(["keyboard.keydown"],e=>this.onKeyDown(e))}onCreateEnd(e){const t=e.shape;e.context.canExecute&&this.editElementLabel(t)}editElementLabel(e){e.constructor!==pS.bL&&this.directEditing.activate(e.labelTarget||e)}getPadding(e,t){return v.mapValues(e,n=>n*t)}getBoxBounds(e){let t;const n=this.canvas,i=n.zoom(),r=ke.label.width*i,a=this.getPadding(ke.label.padding,i),c=a.paddingTop,h=a.paddingBottom,p=e.label,m=1;if(p){const C=n.getAbsoluteBBox(p);t={height:C.height+c+h,width:r,minHeight:ke.label.minHeight,x:Math.round(C.x+C.width/2-r/2),y:Math.round(C.y-c)}}else{const C=this.diagramText.style,w=C.fontSize*C.lineHeight*i+c+h+m*2,E={height:w/i,width:r/i},H=this.diagramText.getLabelPosition(e,E),se=n.getAbsoluteBBox(H);t={height:w,width:r,x:Math.round(se.x-r/2),y:Math.round(se.y-c-m)}}const f=e.width?e.width+(bm+m)*2:ke.label.minWidth;return t.minWidth=f*i,t}getTextStyle(e,t,n){const i=t.fontSize*e;return{...t,fontSize:`${i}px`,padding:`${n.paddingTop}px ${n.paddingRight}px ${n.paddingBottom}px ${n.paddingLeft}px`}}getElementStyle(e){const t=this.canvas.zoom(),n=v.cloneDeep(this.diagramText.style),i=ke.label.padding;return this.getTextStyle(t,n,this.getPadding(i,t))}activate(e){const t=this.getBoxBounds(e),n=this.getElementStyle(e),i=["djs-direct-editing-parent"];let r;return e.needClearCaption?(r="",e.needClearCaption=!1):r=e.caption||"",{autoResize:!0,bounds:t,centerVertically:!0,options:{autoResize:!0,classList:i},style:n,text:r}}update(e,t,n){this.modeling.updateLabel(e,t)}};Yu=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("directEditing")),(0,u.__param)(2,g("canvas")),(0,u.__param)(3,g("modeling")),(0,u.__param)(4,g("diagramText")),(0,u.__param)(5,g("selection")),(0,u.__param)(6,g("rules")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Je,Object,Object,Object])],Yu);var mS=y(22170);let Ku=class extends mS.A{constructor(e,t,n,i){super(e,t,n),this.eventBus=t,this.modeling=n,this.diagramText=i,this.subscribeEvents()}onMoveConnectionLabel(e){const t=e.context,i=t.connection.label;if(i){const r=t.hints.delta;this.modeling.moveShape(i,r)}}onReconnectStart(e){const{connection:t,hints:n,newSource:i,oldSource:r}=e.context,a=t.label,c=n&&n.doUpdateLabelPosition;if(a&&c){const h={x:i.x-r.x,y:i.y-r.y};this.modeling.moveShape(a,h)}}subscribeEvents(){this.eventBus.on([ve.connection.moveConnectionLabel],this.onMoveConnectionLabel.bind(this)),super.postExecute(["connection.updateWaypoints"],this.onUpdateWaypoints.bind(this)),super.postExecute(["connection.layout"],this.onConnectionLayout.bind(this)),super.postExecute(["connection.reconnectStart"],this.onReconnectStart.bind(this)),super.postExecute(["shape.replace"],e=>{const t=e.context.newShape;this.modeling.updateLabel(t,t.caption)})}onConnectionLayout(e){const n=e.context.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const r=this.getLabelOffset(n.waypoints,i);this.modeling.moveShape(i,r)}getLabelOffset(e,t){const n=this.diagramText.getConnectionLabelPosition(e,t);return{x:n.x-t.x-Math.round(t.width/2),y:n.y-t.y-Math.round(t.height/2)}}canMoveLabel(e,t){const{connection:n,hints:i,oldWaypoints:r,newSource:a}=e.context,c=i&&i.doUpdateLabelPosition;return t&&(!v.isEqual(n.waypoints,r)||a)&&c!==!1}onUpdateWaypoints(e){const t=e.context,n=t.connection,i=n.label;if(!this.canMoveLabel(e,i))return;const r=this.getLabelOffset(n.waypoints,i),a=this.getLabelOffset(t.oldWaypoints,i),c={x:r.x-a.x,y:r.y-a.y};this.modeling.moveShape(i,c)}};Ku=(0,u.__decorate)([(0,u.__param)(0,g("injector")),(0,u.__param)(1,g("eventBus")),(0,u.__param)(2,g("modeling")),(0,u.__param)(3,g("diagramText")),(0,u.__metadata)("design:paramtypes",[Object,Object,Je,dn])],Ku);class gS{constructor(e){this._parent=e.useRtl?(0,I.domify)('<div><textarea rows="1" dir="rtl" style="direction: rtl;" class="djs-direct-editing-content"></textarea></div>'):(0,I.domify)('<div><textarea rows="1" class="djs-direct-editing-content"></textarea></div>'),this.container=e.container,this._textArea=(0,I.query)(".djs-direct-editing-content",this._parent),this.keyHandler=e.keyHandler||(()=>{}),this._mousedown=t=>{t.stopPropagation()},this.resizeHandler=e.resizeHandler||(()=>{}),this.autoResize=this.autoResize.bind(this)}create(e,t,n,i){const r=this._parent,a=this._textArea,c=this.container;i=this._options=i||{},t=this._style=t||{};const h=v.pick(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);v.assign(r.style,{boxSizing:"border-box",left:e.x+"px",outline:"none",overflow:"visible",position:"absolute",textAlign:"center",top:e.y+"px",wordWrap:"normal",width:e.width+"px"},h);const p=v.pick(t,["borderLeft","fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return v.assign(a.style,{boxSizing:"border-box",outline:"none",wordWrap:"break-word",width:e.minWidth+"px",maxHeight:e.maxHeight+"px",maxWidth:(e.maxWidth||e.width)+"px",minHeight:e.minHeight+"px",minWidth:e.minWidth+"px"},p),i.centerVertically&&v.assign(a.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},p),a.value=n,I.event.bind(a,"keydown",this.keyHandler),I.event.bind(a,"mousedown",this._mousedown),I.event.bind(a,"paste",this._handlePaste),I.event.bind(a,"keydown",this.autoResize),I.event.bind(a,"blur",this.blur),r.className="djs-direct-editing-parent",i.classList&&r.classList.add(...i.classList),c.appendChild(r),this._textArea.selectionStart=n.length,this._textArea.selectionEnd=n.length,this._textArea.focus(),n&&this.resizeWidth(),this.resizeHeight(),r}resizeHeight(){this._textArea.style.height="auto",this._textArea.style.height=this._textArea.scrollHeight+"px"}resizeWidth(){this._textArea.style.width="auto",this._textArea.style.width=this._textArea.scrollWidth+"px"}autoResize(){v.defer(()=>{if(this._textArea.scrollHeight>0){const e=this._textArea.getBoundingClientRect();this.resizeWidth(),this.resizeHeight(),this.resizeHandler({dx:0,dy:this._textArea.scrollHeight-e.height,height:e.height,width:e.width})}})}destroy(){const e=this._parent,t=this._textArea;t.value="",e.removeAttribute("style"),t.removeAttribute("style"),I.event.unbind(t,"keydown",this.keyHandler),I.event.unbind(t,"mousedown",this._mousedown),I.event.unbind(t,"keydown",this.autoResize),I.event.unbind(t,"blur",this.blur),(0,I.remove)(e)}getValue(){return this._textArea.value}}let Ju=class{constructor(e,t,n,i,r,a,c){this._eventBus=e,this._canvas=t,this._elementRegistry=n,this._graphicsFactory=i,this._diagramText=r,this.config=a,this._providers=[],this._textbox=c||new gS({useRtl:a.isRtl}),this._textbox.container=t.getContainer(),this._textbox.keyHandler=this._handleKey.bind(this),this._textbox.blur=this._blur.bind(this),this._textbox.resizeHandler=this.handleResize.bind(this),this._eventBus.on("diagram.destroy",1e3,this.deactivate,this)}_handleKey(e){if(Mo(e)===De.Escape.keyCode){e.stopPropagation(),e.preventDefault(),this.cancel();return}$v(e)&&Gv(e,()=>this.complete())}_blur(){this.complete()}_fire(e,t){t=t||{active:this.active},this._eventBus.fire("directEditing."+e,t)}handleResize(e){this._fire("resize",e)}getNewBounds(){const e=this.activeTextbox.getBoundingClientRect();return{x:e.top,y:e.left,width:e.width,height:e.height}}registerProvider(e){this._providers.push(e)}isActive(){return!!this.active}cancel(){this.active&&this.close("cancel")}animate(e){const t=this.activeTextbox.classList;if(!(t&&t.contains("djs-direct-editing-rotate-90")))return;const i="djs-direct-editing-rotate-0";e?t.add(i):t.remove(i)}deactivate(){this._textbox.destroy(),this._fire("deactivate",null),this.active=null}close(e){this.animate(!1),this._fire(e,null),this.deactivate()}complete(){const e=this.active;if(!e)return;const t=this.getValue();e.provider.update(e.element,t,this.getNewBounds()),this.close("complete")}getValue(){return this._textbox.getValue()}activate(e){this.isActive()&&this.cancel();let t=null;this.initialHeight=e.height,this.initialWidth=e.width;const n=this._providers.find(i=>(t=i.activate(e),t?i:null));return t&&(this.activeTextbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this.active={element:e,context:t,provider:n},this.animate(!0),this._fire("activate",null)),!!t}};Ju=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("canvas")),(0,u.__param)(2,g("elementRegistry")),(0,u.__param)(3,g("graphicsFactory")),(0,u.__param)(4,g("diagramText")),(0,u.__param)(5,g("config")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,Object])],Ju);var fS=y(10033),Ao=y(74419);let cc=class extends fS.A{constructor(e,t){super(),this.connectionDocking=e,this.config=t}isStraightConnection(e,t,n){return!0}isShapeCenter(e,t){const{height:n,width:i,x:r,y:a}=t,c=Math.floor(e.x-r-i/2),h=Math.floor(e.y-a-n/2);return c===0&&h===0}getPreferredDirectionWithPoint(e,t){const n=t.x+t.width/2,i=t.y+t.height/2,r=e.x-n,a=e.y-i;let c;return r<0?a<0?c=-r>-a?"l":"t":c=-r>a?"l":"b":a<0?c=r>-a?"r":"t":c=r>a?"r":"b",c}getBoundingRect(e){const n=e.y-10,i=e.x+e.width+10,r=e.y+e.height+10,a=e.x-10;return{top:n,right:i,bottom:r,left:a}}findSourceLayout(e,t,n,i){let r;const a=this.getBoundingRect(e),c=this.getBoundingRect(t);switch(n){case"t":r=c.top<=a.bottom?"t":"b";break;case"b":r=c.bottom<=a.top?"t":"b";break;case"l":r=a.right<=c.left?"r":"l";break;case"r":r=c.right<=a.left?"l":"r";break}return r===n&&(i==="h"&&["r","l"].includes(n)&&(a.top>c.bottom?r="t":a.bottom<c.top||a.bottom>=c.bottom?r="b":r="t"),i==="v"&&["t","b"].includes(n)&&(a.left>c.right?r="l":a.right>=c.right||a.right<c.left?r="r":r="l")),r}getPreferredLayouts(e,t,n,i={}){const r=(0,ti.pp)(e),a=(0,ti.pp)(t),c=Math.abs(r.x-a.x),h=Math.abs(r.y-a.y),p=c<h?"v":"h";let m;const f=i.connectionStart;if(f)this.isShapeCenter(f,e)||(m=this.getPreferredDirectionWithPoint(f,e));else{const w=n&&n[0],E=w&&(w.original||G.getOriginalWaypoint(w,e));w&&!this.isShapeCenter(E,e)&&(m=this.getPreferredDirectionWithPoint(w,e))}let C;const S=i.connectionEnd;if(S)this.isShapeCenter(S,t)||(C=this.getPreferredDirectionWithPoint(S,t));else{const w=n&&n.slice(-1)[0],E=w&&(w.original||G.getOriginalWaypoint(w,t));w&&!this.isShapeCenter(E,t)&&(C=this.getPreferredDirectionWithPoint(w,t))}return!m&&C&&(m=this.findSourceLayout(e,t,C,p)),m&&!C&&(C=this.findSourceLayout(t,e,m,p)),!m&&!C?[`${p}:${p}`]:[`${m}:${C}`]}layoutConnection(e,t={}){const n=t.source||e.source,i=t.target||e.target;t.startChanged&&!t.connectionStart&&(t.connectionStart=(0,ti.pp)(n)),t.endChanged&&!t.connectionEnd&&(t.connectionEnd=(0,ti.pp)(i));const r=e.waypoints,a=t.connectionStart||r&&r.length&&r[0].original,c=t.connectionEnd||r&&r.length&&r[r.length-1].original;let h;!t.shapeMoving&&!t.startChanged&&!t.endChanged?(t.preferredLayouts=this.getPreferredLayouts(n,i,r,t),h=Ao.Z9(n,i,a,c,t)):h=Ao.WI(n,i,a,c,r,t),this.isStraightConnection(n,i,e)&&h.length>2&&h.splice(1,h.length-2);const m=Object.assign(e);return m.waypoints=Ao.d7(h),this.connectionDocking.getCroppedWaypoints(m,n,i)}};cc=(0,u.__decorate)([(0,u.__param)(0,g("connectionDocking")),(0,u.__param)(1,g("config")),(0,u.__metadata)("design:paramtypes",[Object,Object])],cc);class _S{constructor(e,t){this.eventBus=e,this.outlineFactory=t,e.on("shape.added",_e.LOW,this.onShapeAdded.bind(this)),e.on("shape.changed",_e.LOW,this.onShapeChanged.bind(this)),e.on("connection.added",this.onConnectionAdded.bind(this)),e.on("connection.changed",this.onConnectionChanged.bind(this))}onShapeAdded(e){this.onUpdateOutline(e)}onShapeChanged(e){this.onUpdateOutline(e)}onConnectionAdded(e){this.onUpdateOutline(e)}onConnectionChanged(e){this.onUpdateOutline(e)}onUpdateOutline(e){const t=e.element;this.outlineFactory.getOutline(t).draw(t,e.gfx)}}class lc{constructor(e){this.config=e}findOutline(e){return(0,I.query)("."+this.config.outlineClassName,e)}getOutline(e){let t=this.findOutline(e);if(!t){const n=e;t=this.createOutline(n)}return t}createOutline(e){const t=this.getSvgName(),n=(0,x.vt)(t),i=this.getCreateOutlineConfig();return(0,x.CF)(n,i),(0,x.BC)(e,n),n}getSvgName(){return"rect"}getCreateOutlineConfig(){return{...this.config.outlineStyle,shapeRendering:"geometricPrecision"}}draw(e,t){const n=this.getOutline(t);this.updateOutline(n,e)}erase(e,t){const n=this.findOutline(t);n&&n.remove()}}class vm extends lc{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return v.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){const n=(0,or.U7)(t,!1),i=this.config.offset;(0,x.CF)(e,{height:n.height+i*2,width:n.width+i*2,x:n.x-i,y:n.y-i})}draw(e,t){this.config.rules.allowed("canShowConnectionOutline")&&super.draw(e,t)}}class yS extends lc{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return v.assign(e,{x:10,y:10,width:100,height:100,rx:5})}updateOutline(e,t){const n=this.config.offset;(0,x.CF)(e,{x:-n,y:-n,width:t.width+n*2,height:t.height+n*2})}}class CS extends lc{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return v.assign(e,{x:10,y:10,width:100,height:100})}updateOutline(e,t){this.config.rules.allowed("canShowLabelOutline")&&(0,x.CF)(e,{x:-2,y:-2,width:t.width+2*2,height:t.height+2})}draw(e,t){this.config.rules.allowed("canShowLabelOutline")&&super.draw(e,t)}}let Po=class{constructor(e,t,n,i){this.styles=e,this.rules=t,this.elements=n,this.diagramUtils=i,this.config=this.getConfig()}getConfig(){const e="djs-outline",t={...this.styles.cls(e,["no-fill"],null),strokeDasharray:"4,2",strokeWidth:"1px"};return{outlineClassName:e,outlineStyle:t,offset:bm,elements:this.elements,rules:this.rules}}getOutline(e){switch(!0){case G.isLabel(e):return new CS(this.config);case this.diagramUtils.isConnection(e):return new vm(this.config);default:return new yS(this.config)}}};Po=(0,u.__decorate)([(0,u.__param)(0,g("styles")),(0,u.__param)(1,g("rules")),(0,u.__param)(2,g("elements")),(0,u.__param)(3,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,ie,G])],Po);let uc=class extends _S{constructor(e,t){super(e,t),this.outlineFactory=t}};uc=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("outlineFactory")),(0,u.__metadata)("design:paramtypes",[Object,Po])],uc);class bS extends ni{getSizeConfig(e){const t=this.elements.getConfig(e);return this.styles.style({height:e.height||t.height,width:e.width||t.width})}getImageSource(e){const t=this.elements.getConfig(e);return e.largeImage||t.largeImage}draw(e,t){super.draw(e,t);const n=this.elements.getConfig(t);if(!n)throw new Error(`Element type ${t.type} not supported`);const i=(0,x.vt)("image"),r=this.getSizeConfig(t),a=this.getImageSource(t);return(0,x.CF)(i,r),i.setAttributeNS("http://www.w3.org/1999/xlink","href",a),i.setAttributeNS(null,"type",n.type),i.setAttributeNS(null,"preserveAspectRatio","none"),(0,x.BC)(e,i),i}}let qu=class{constructor(e){this.popupMenu=e,this.popupMenu.registerProvider("setup",this)}getPopupMenuEntries(e){return{}}getHeaderEntries(e){return[]}};qu=(0,u.__decorate)([(0,u.__param)(0,g("popupMenu")),(0,u.__metadata)("design:paramtypes",[Object])],qu);class Sm{stopSync(){}startSync(){}subscribeServerChanges(){return[]}}const dc={__depends__:[J0.A,q0.A,X0.A,Q0.A,ev.A,nv.A,iv.A,sv.A,rv.A,ov.A,av.A,fv.A,cv.A,tm.A,lv.A,pv.A,yv.A,qa,_v.A,tv.A,tc,mv.A],__init__:["canvas","commandStack","contextPad","contextPadProvider","copyPaste","labelSupport","diagramLoader","diagramRenderer","diagramRules","diagramEventHandlerController","diagramText","directEditing","editorActions","elementFactory","elementRegistry","keyboardBindings","labelEdit","layouter","localStorage","outline","resize","resizeHandles","resizePreview","setupMenuProvider","handTool","spaceToolPreview","bendpointMove","bendpoints","featureProvider","connectionPreview","connectionSegmentMove","paletteProvider","paletteElements","elementToolsConfig","createPopupMenu","palette","connectionHighlight","minimap","diagramPopup","lassoTool","diagramUtils","diagramPaletteTools","diagramTooltips"],canvas:["type",xu],commandStack:["type",Eu],connectionDocking:["type",gv.A],contextPad:["type",nc],contextPadProvider:["type",ac],copyPaste:["type",ju],labelSupport:["type",Ku],diagramLoader:["type",sc],diagramRenderer:["type",Io],diagramRules:["type",fe],diagramEventHandlerController:["type",Sm],directEditing:["type",Ju],editorActions:["type",ku],elementFactory:["type",im],elementRegistry:["type",rr],keyboardBindings:["type",Hv],localStorage:["type",Lt],modeling:["type",Je],outline:["type",uc],resize:["type",uv.A],resizeHandles:["type",dv.A],resizePreview:["type",hv.A],setupMenuProvider:["type",qu],handTool:["type",tm.A],spaceToolPreview:["type",oS],bendpoints:["type",qa],featureProvider:["type",uS],connectionPreview:["type",Iu],popupMenu:["type",Uu],connectionSegmentMove:["type",tc],labelEdit:["type",Yu],diagramText:["type",dn],outlineFactory:["type",Po],renderingShapeFactory:["type",Eo],renderingLabel:["type",um],renderingShape:["type",bS],layouter:["type",cc],elements:["type",ie],paletteProvider:["type",Bu],splitConnectionHelper:["type",hS],spaceTool:["type",Gu],paletteElements:["type",Ja],elementToolsConfig:["type",ic],createPopupMenu:["type",So],palette:["type",Lu],replaceMenuGroups:["type",function(){return{}}],zoomScroll:["type",Wu],connectionHighlight:["type",Xa],minimap:["type",Vu],diagramPopup:["type",zu],lassoTool:["type",Nu],previewSupport:["type",tS],diagramUtils:["type",G],diagramPaletteTools:["type",Fu],diagramTooltips:["type",Hu]};let Xu=class extends Zu{constructor(e,t){super(e),this.context=e,this.config=t}hasAddItemsMenu(e){return N.isFlowNode(e)}hasConnectConfig(e){return N.isFlowNode(e)}hasDeleteAction(e){return this.context.rules.canDelete(e)}getAddItemsConfig(e){return{add:{action:{click:(t,n)=>{const i=this.getPopupMenuPosition(t,n);this.popupMenu.open(n,"add",i)}},...this.elementToolsConfig.tools.add}}}};Xu=(0,u.__decorate)([(0,u.__param)(1,g("config")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Xu);let Qu=class extends Cm{constructor(e,t){super(e),this.context=e,this.config=t}getElementToolsFeature(e){return G.isLabel(e)?new ym(this.context):new Xu(this.context,this.config)}};Qu=(0,u.__decorate)([(0,u.__param)(1,g("config")),(0,u.__metadata)("design:paramtypes",[Object,Object])],Qu);let To=class extends fe{constructor(e,t,n,i){super(e,t),this.eventBus=e,this.utils=n,this.elementRegistry=i}getCountConnection(e,t,n){return this.elementRegistry.filter(r=>r!==n&&(r.source===e&&r.target===t||r.source===t&&r.target===e)).length}canRead(e){return e.canRead!==!1}canConnect(e,t){let n=super.canConnect(e,t);return n&&(n=(!e||this.canRead(e))&&(!t||this.canRead(t))),n}canConnectionCreate(e){const t=e.source,n=e.target,i=e.connection;return super.canConnectionCreate(e)&&t!==n&&t.parent!==n&&t!==n.parent&&!this.utils.isConnection(t)&&!this.utils.isConnection(n)&&this.getCountConnection(t,n,i)<2}canReconnectEnd(e){const t=super.canReconnectEnd(e),{hover:n,connection:i}=e,r=i.source,a=n||e.target;return t&&this.canConnectionCreate({source:r,target:a,connection:i})}canReconnectStart(e){const t=super.canReconnectStart(e),{hover:n,connection:i}=e,r=n||e.source,a=i.target;return t&&this.canConnectionCreate({source:r,target:a,connection:i})}canShowPalette(){return!1}canElementMove(e){return Me.canMove}canElementCopy(e){return!1}canElementPaste(e){return!1}canElementUpdateType(e){return!1}canLabelEdit(){return!1}canShowConnectionOutline(){return!1}canConnectionSegmentMove(){return!1}canElementsDelete(e){let t=super.canElementsDelete(e);const n=e.elements;return t=t&&n.every(i=>this.canDelete(i)),t?t=this.eventBus.fire("elements.removing",{elements:n}):this.eventBus.fire("elements.noAccessMessage",{elements:n}),t}canDelete(e){const t=this.canEdit(e);if(!t)return!1;if(this.utils.isFlow(e))return t;if(!this.elementRegistry.getElementFlows(e).every(r=>this.canEdit(r)))return!1;if(N.isRelationshipContainer(e))return this.elementRegistry.getChildren(e).every(c=>this.canEdit(c));if(N.isRelationshipItem(e)){const r=e;return r.single?!0:this.canRead(r.parent)}return!0}canEdit(e){if(N.isRoot(e))return!1;if(this.utils.isFlow(e)){const n=e;return this.canConnect(n.source,n.target)}return this.canRead(e)}};To=(0,u.__decorate)([(0,u.__param)(0,V("eventBus")),(0,u.__param)(1,V("config")),(0,u.__param)(2,V("diagramUtils")),(0,u.__param)(3,V("elementRegistry")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object])],To);let ed=class extends ac{constructor(e,t,n,i,r,a,c,h,p,m,f,C){super(e,t,n,i,r,a,c,h,p,m),this.elements=p,this.elementToolsConfig=m,this.registry=f,this.rules=C,this.config=h;const S=this.config.localizableStrings,w={modeling:n,localizableStrings:S,contextPad:t,canvas:c,popupMenu:a,elementFactory:i,create:r,connect:e,elements:p,elementToolsConfig:m,registry:f,rules:C};this.initializeElementToolsFactory(w)}initializeElementToolsFactory(e){this.toolsFactory=new Qu(e,this.config)}};ed=(0,u.__decorate)([(0,u.__param)(0,g("connect")),(0,u.__param)(1,g("contextPad")),(0,u.__param)(2,g("modeling")),(0,u.__param)(3,g("elementFactory")),(0,u.__param)(4,g("create")),(0,u.__param)(5,g("popupMenu")),(0,u.__param)(6,g("canvas")),(0,u.__param)(7,g("config")),(0,u.__param)(8,g("elements")),(0,u.__param)(9,g("elementToolsConfig")),(0,u.__param)(10,g("elementRegistry")),(0,u.__param)(11,g("diagramRules")),(0,u.__metadata)("design:paramtypes",[Object,Object,Je,Object,Object,Object,Object,Object,ie,Object,Object,To])],ed);class vS extends ic{getAddItems(){const e=this.config.customElementToolsConfig?this.config.customElementToolsConfig.addItems||[]:[];return[...super.getAddItems(),...e]}getTools(){const e=this.config.customElementToolsConfig?this.config.customElementToolsConfig.tools||[]:[];return{...super.getTools(),...e}}}let hc=class extends vS{constructor(e,t){super(e,t),this.elements=e,this.config=t,this.innerTools=this.getInnerTools()}getInnerTools(){return{...this.config?.customElementToolsConfig?.innerTools||{}}}};hc=(0,u.__decorate)([(0,u.__param)(0,g("elements")),(0,u.__param)(1,g("config")),(0,u.__metadata)("design:paramtypes",[ie,Object])],hc);class SS extends lc{getCreateOutlineConfig(){const e=super.getCreateOutlineConfig();return Object.assign(e,{x:10,y:10,width:100,height:100,rx:8,ry:8})}updateOutline(e,t){const n=this.config.offset;(0,x.CF)(e,{x:-n,y:-n,rx:8,ry:8,width:t.width+n*2,height:t.height+n*2})}}let pc=class extends Po{constructor(e,t,n,i){super(e,t,n,i),this.styles=e,this.rules=t,this.elements=n,this.diagramUtils=i,this.flowNodeConfig=this.getFlowNodeConfig(),this.flowConfig=this.getFlowConfig()}getFlowConfig(){const e=this.getConfig();return e.outlineStyle.stroke="#b033d3",e}getFlowNodeConfig(){const e=this.getConfig();return e.offset=1.5,e.outlineStyle.strokeDasharray="none",e.outlineStyle.strokeWidth="3px",e}getOutline(e){switch(!0){case N.isFlowNode(e):return new SS(this.flowNodeConfig);case this.diagramUtils.isFlow(e):return new vm(this.flowConfig);default:return super.getOutline(e)}}};pc=(0,u.__decorate)([(0,u.__param)(0,g("styles")),(0,u.__param)(1,g("rules")),(0,u.__param)(2,g("elements")),(0,u.__param)(3,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,ie,G])],pc);var mt=y(52965),Mm;let mc=class extends ni{constructor(e,t,n,i,r){super(e,t,n,i),this.elements=e,this.styles=t,this.diagramText=n,this.eventBus=i,this.canvas=r,this._groupsOverflowAmount=3,this._commentIconBase64="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgdmlld0JveD0iMCAwIDEwIDEwIj48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6I2ZmZjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMjkgMC4wMjkpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjQ3MSAwLjQ3MSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTQxMy4yNSwzODAuNzM1aC0ydjJsLTMtMmgtNHYtNmg5WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDIyLjI1IC0zNzQuNzM1KSIvPjwvZz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIvPjwvc3ZnPg=="}_createAdditionalGroupsIcon(e,t,n){const i=(0,x.vt)("rect",{stroke:"gray","stroke-width":1,fill:"#ffffff",height:18,width:18,x:e.x-20,y:e.y,rx:10,ry:10});(0,x.BC)(t,i);const r=`+${n.length-this._groupsOverflowAmount}`,a={box:{height:18,width:18},style:{fill:"#60779F !important"},className:"show-all-group-caption"},c=this.createText(t,r,a);return(0,mt.pd)(c,e.x-20,e.y,0),c}_getAdditionalGroupsHtml(e){let t='<div class="additional-groups">';for(const n of e){let i="",r="",a="";n.itemComment&&(i=" has-comment",r=`<div class="additional-group-comment">${n.itemComment}</div>`,a='<div class="comment-icon-gray"></div>'),t+=`
				<div class="additional-group-container">
					<div class="additional-group-container-header">
						<div class="circle" style="background-color:${n.color}"></div>
						<div class="additional-group-name${i}">${n.caption}</div>
						${a}
					</div>
					${r}
				</div>`}return t+="</div>"}_drawCommentIcon(e,t,n){const i=(0,x.vt)("rect",{fill:n.color,height:10,rx:5,ry:5,width:15,x:t.x,y:t.y});(0,x.BC)(e,i),(0,mt.pd)(i,-5,0,0);const r=this._commentIconBase64,a=this.styles.style({height:10,width:10}),c=(0,x.vt)("image",a);c.setAttributeNS("http://www.w3.org/1999/xlink","href",r),c.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),(0,x.BC)(e,c),(0,mt.pd)(c,t.x,t.y,0)}_addCommentListener(e,t,n){e.addEventListener("click",()=>{const i=`<div class="group-item-comment">
							 	<h4 class="caption">
									<span class="circle" style="background-color:${n.color}"></span>
									${n.caption}
								</h4>
							 	<p class="item-comment">${n.itemComment}</p>
							 </div>`;this.eventBus.fire("popup.open",{parentContainer:t,html:i,width:278,options:{direction:"right"}})})}draw(e,t){const n=(0,x.vt)("g",{class:"group-container"});(0,x.BC)(e,n);const i=t.groups||[];if(i.length===0)return;const r=5,a=100,c=16,h=c/2,p={x:t.width,y:t.height-c/2},m=i.length,f=m>this._groupsOverflowAmount,C=(f?this._groupsOverflowAmount:m)-1;if(f){const S=this._createAdditionalGroupsIcon(p,n,i),w=this._getAdditionalGroupsHtml(i);S.addEventListener("click",()=>{const E=this.canvas.viewbox();this.eventBus.fire("popup.open",{parentContainer:S,html:w,width:Math.round(t.width*E.scale)})}),p.x-=r+15}for(let S=0;S<=C;S++){const w=i[S],H=w.itemComment?"group-item has-item-comment":"group-item",se=(0,x.vt)("g",{class:H});(0,x.BC)(n,se),p.x-=a+r;const J=(0,x.vt)("rect",{fill:w.color,height:c,rx:h,ry:h,width:a,x:p.x,y:p.y});(0,x.BC)(se,J);const z=w.caption,Ss=w.itemComment?a-24:a-10,Ot={box:{height:c,width:Ss},className:"group-caption"},re=this.createText(se,z,Ot);if((0,mt.pd)(re,p.x+5,p.y,0),w.itemComment){const mn={x:p.x+a-17,y:p.y+4};this._drawCommentIcon(se,mn,w),this._addCommentListener(se,re,w)}}return n}};mc=(0,u.__decorate)([(0,u.__param)(0,g("elements")),(0,u.__param)(1,g("styles")),(0,u.__param)(2,g("diagramText")),(0,u.__param)(3,g("eventBus")),(0,u.__param)(4,g("canvas")),(0,u.__metadata)("design:paramtypes",[Object,typeof(Mm=typeof hn.A<"u"&&hn.A)=="function"?Mm:Object,dn,Object,Object])],mc);let gc=class{constructor(e,t,n){this.modeling=e,this.elements=t,this.elementToolsConfig=n,this.containerClassName="toggle-container",this.rectClassName="toggle-rect",this.imageClassName="toggle-image"}toggle(e){this.modeling.toggleCollapse(e)}onClick(e,t){t.stopPropagation(),this.toggle(e)}clear(e){const t=(0,I.query)("."+this.containerClassName,e);t&&(0,I.remove)(t)}draw(e,t){this.clear(e);const n=t.collapsed?8:24,i={height:30,width:30+n,class:this.containerClassName},r=(0,x.vt)("g",i);(0,x.BC)(e,r);const c=this.elements.getConfig(t).height-i.height;(0,mt.pd)(r,t.width-i.width,c,0);const h={height:i.height,width:i.width,fill:"transparent",class:this.rectClassName},p=(0,x.vt)("rect",h);(0,x.BC)(r,p),I.event.bind(r,"click",this.onClick.bind(this,t));const m={height:6,width:10,class:this.imageClassName},f=(0,x.vt)("image",m),C=this.elementToolsConfig.innerTools.toggle,S=t.collapsed?C?.expandImageUrl||y(65070):C?.collapseImageUrl||y(34035);f.setAttributeNS("http://www.w3.org/1999/xlink","href",S),(0,x.BC)(r,f);const w=i.width-m.width-n,E=i.height/2-m.height/2;(0,mt.pd)(f,w,E,0)}};gc=(0,u.__decorate)([(0,u.__param)(0,V("modeling")),(0,u.__param)(1,V("elements")),(0,u.__param)(2,V("elementToolsConfig")),(0,u.__metadata)("design:paramtypes",[Object,Object,hc])],gc);let td=class extends uc{constructor(e,t,n,i,r){super(e,t),this.outlineFactory=t,this.diagramText=n,this.relationshipRenderingGroup=i,this.relationshipToggleTools=r}drawGroups(e,t){N.isRelationshipItem(t)&&t.canRead!==!1&&this.relationshipRenderingGroup.draw(e,t)}drawToggleTools(e,t){t.hasChildren?this.relationshipToggleTools.draw(e,t):this.relationshipToggleTools.clear(e)}onShapeAdded(e){super.onShapeAdded(e),this.drawGroups(e.gfx,e.element),this.drawToggleTools(e.gfx,e.element)}onShapeChanged(e){super.onShapeChanged(e),this.drawToggleTools(e.gfx,e.element)}};td=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("outlineFactory")),(0,u.__param)(2,g("diagramText")),(0,u.__param)(3,g("relationshipRenderingGroup")),(0,u.__param)(4,g("relationshipToggleTools")),(0,u.__metadata)("design:paramtypes",[Object,pc,dn,mc,gc])],td);let nd=class{constructor(e,t,n){this.config=e,this.modeling=t,this.popupMenu=n,this.popupMenu.registerProvider("add",this)}createHeaderEntry(e,t){const n=e.entitySchemaData;return{id:n.name,className:"add-item-button-tool",label:n.caption,action:()=>{this.modeling.addNewConnection({source:t,targetType:e.type}),this.popupMenu.close()}}}getPopupMenuEntries(e){return{}}getHeaderEntries(e){const t=[],n=[k.relationshipContainer,k.relationshipItem];return(0,v.forOwn)(this.config.customDiagramElements,i=>{n.includes(i.type)&&t.push(this.createHeaderEntry(i,e))}),t}};nd=(0,u.__decorate)([(0,u.__param)(0,g("config")),(0,u.__param)(1,g("modeling")),(0,u.__param)(2,g("popupMenu")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object])],nd);let Do=class{constructor(e,t,n,i,r,a){this.sizeUtils=e,this.diagramUtils=t,this.modeling=n,this.registry=i,this.canvas=r,this.eventBus=a}elementTreeExists(e,t){return e.some(n=>n.some(i=>i.id===t.id))}fillTreeLevel(e,t,n,i){const a=this.getElementChildren(t,n).filter(c=>!this.elementTreeExists(i,c));a.forEach(c=>{this.addTreeElement(e,c,i)}),a.forEach(c=>{this.fillTreeLevel(e+1,c,n,i)})}addTreeElement(e,t,n){t.level=e;const i=Math.abs(e),r=n[i]=n[i]||[];r.map(c=>c.id).includes(t.id)||r.push(t)}getDirectConnections(e){let t=[];return e.connections&&(t=Object.values(e.connections).filter(n=>n.type===k.connection&&n.position!==0)),t}getHorizontalConnections(e){let t=[];return e.connections&&(t=Object.values(e.connections).filter(n=>n.type===k.connection&&n.position===0)),t}getLevelWidth(e){if(!e?.length)return 0;const t=e[e.length-1];return t.x+this.getElementWidth(t)}getElementWidth(e){return this.sizeUtils.getElementSize(e).width}getElementHeight(e){return this.sizeUtils.getElementSize(e).height}getElementChildren(e,t){const n=this.getDirectConnections(t).filter(i=>i.source===e.id).map(i=>t.elements[i.target]);return Array.from(new Set(n))}getTreeWidth(e){let t=0;return e.forEach(n=>{const i=this.getLevelWidth(n);t<i&&(t=i)}),t}getTreeBottomY(e){const n=e[e.length-1][0];return n.y+this.getElementHeight(n)}fixTreePositionX(e,t){const n=this.getTreeWidth(t);t.forEach(i=>{const r=this.getLevelWidth(i),a=(n-r)/2;i.forEach(c=>{c.x+=a,Object.values(e.elements).filter(p=>String(p.parent)===c.id).forEach(p=>p.x+=a)})})}getContainerChildren(e,t){return Object.values(t.elements).filter(n=>String(n.parent)===e.id)}fillContainerTreePosition(e,t){const n=this.getContainerChildren(e,t);if(e.hasChildren=n.length>0,e.hasChildren){const i=Me.getSpacing(k.relationshipContainer),r=i.x,a=i.y,c=this.buildTree(t,n);this.fillTreePosition(t,c,e.x+r,e.y+a);const h=this.getTreeWidth(c),p=this.getTreeBottomY(c);e.expandedWidth=h-e.x+r,e.expandedHeight=p-e.y+a,this.fixTreePositionX(t,c)}}fillTreePosition(e,t,n=0,i=0){const r=Me.getSpacing(k.relationshipItem);let a=i;for(const c of t){let h=n,p=0;for(const C of c){C.x=h,C.y=a,this.fillContainerTreePosition(C,e),h+=this.getElementWidth(C)+r.x;const S=this.getElementHeight(C);p=Math.max(p,S)}const m=Object.values(e.elements).filter(N.isRootItem),f=this.getHorizontalElements(e,m);this.fixOnlyChildByParents(e,c,f),a+=p+r.y}}fixOnlyChildByParents(e,t,n){let i=0,r=0,a=!1;const c=Object.values(e.elements),h=this.getDirectConnections(e);do{for(const p of t){const m=h.filter(C=>C.target===p.id);if(m.length===1){const C=m[0];if(!n.includes(C.target)){const S=C.source,w=c.find(H=>H.id===S);if(!this.hasLevelIntercept(w.x,p,t)){const H=w.x||0;H!==p.x&&(this.changeElementX(p,H,e),r++)}}}}a=i!==r,i=r}while(r<t.length&&a)}changeElementX(e,t,n){const i=t-e.x;e.x=t,N.isRelationshipContainer(e)&&this.getContainerChildren(e,n).forEach(a=>a.x+=i)}hasLevelIntercept(e,t,n){const i=n.map(m=>({id:m.id,x:m.id===t.id?e:m.x,type:m.type,width:this.getElementWidth(m)}));if(i.find(m=>m.id!==t.id&&m.x===t.x))return!0;i.sort((m,f)=>m.x-f.x);const a=i.findIndex(m=>m.id===t.id),c=i[a-1],h=Me.getSpacing(k.relationshipItem);if(c){const m=c.x+c.width+h.x;if(e<=m)return!0}const p=i[a+1];if(p){const m=i[a];if(m.x+m.width+h.x>=p.x)return!0}return!1}getHorizontalElements(e,t){const n=new Set;return this.getHorizontalConnections(e).forEach(r=>{n.add(r.source),n.add(r.target)}),Array.from(n).filter(r=>t.find(a=>a.id===r))}buildSubTree(e,t,n,i,r,a){this.addTreeElement(r,e.elements[t],i),n.push(t),this.getDirectConnections(e).filter(c=>(a<0?c.target:c.source)===t).map(c=>a<0?c.source:c.target).filter(c=>!n.includes(c)).forEach(c=>{this.buildSubTree(e,c,n,i,r+a,a)})}mergeTrees(e){const t=this.flat(e).map(c=>c.level),n=Math.min(...t),i=Math.max(...t),r=-n;e.forEach(c=>{c.forEach(h=>{h.forEach(p=>{p.levelFixed||(p.level+=r,p.levelFixed=!0)})})});const a=new Array(i-n+1).fill(0).map(()=>[]);return e.forEach(c=>{c.forEach(h=>{h.forEach(p=>{const m=p.level,f=a[m];f.every(C=>C.id!==p.id)&&f.push(p)})})}),a}flat(e){return e.flat(1/0)}addSingleItems(e,t,n){const i=this.flat(n).map(r=>r.id);t.filter(r=>!i.includes(r.id)).forEach(r=>{this.addTreeElement(0,r,n),this.fillTreeLevel(1,r,e,n)})}buildTree(e,t){let n=[];const i=this.getHorizontalElements(e,t);if(i.length>0){const r=[],a=[...i];i.forEach(c=>{let h=!1;const p=[];this.buildSubTree(e,c,a,p,0,-1);const m=this.flat(p);if(m.length>1){const S=Math.min(...m.map(w=>w.level));p.reverse(),p.forEach((w,E)=>{w.forEach(H=>H.level=S+E)}),r.push(p),h=!0}const f=[];this.buildSubTree(e,c,a,f,0,1),(this.flat(f).length>1||!h)&&r.push(f)}),n=this.mergeTrees(r),this.addSingleItems(e,t,n)}else{const r=this.getDirectConnections(e),a=t.filter(c=>r.every(h=>h.target!==c.id));for(const c of a)this.addTreeElement(0,c,n),this.fillTreeLevel(1,c,e,n)}return n}getElements(){const e={};return this.registry.getFlowNodes().forEach(n=>{const i=this.sizeUtils.getElementSize(n);e[n.id]={id:n.id,originalId:n.originalId,type:n.type,parent:n.parent?.id,collapsed:n.collapsed,single:n.single,canRead:n.canRead,...i}}),e}getConnections(){const e={};return this.registry.getFlows().forEach(n=>{const i=n.realTarget||n.target,r=n.realSource||n.source;e[n.id]={id:n.id,originalId:n.originalId,type:n.type,target:i.id,source:r.id,position:n.position}}),e}getDiagramData(){const e={};return e.elements=this.getElements(),e.connections=this.getConnections(),e}fixElementsPosition(e){this.registry.getFlowNodes().forEach(n=>{const i=e.elements[n.id],r={x:i.x-n.x,y:i.y-n.y};(r.x||r.y)&&this.modeling.moveShape(n,r)})}hideConnections(){this.registry.getFlows().forEach(t=>{t.hidden=!0})}updateAllConnections(e){const t=Object.values(e.connections),n=t.filter(r=>!N.isIndirectConnection(r));this.updateConnections(n);const i=t.filter(N.isIndirectConnection);this.updateConnections(i)}updateConnections(e){e.forEach(({id:t,source:n,target:i})=>{const r=this.registry.get(t);let a=this.registry.get(n),c=this.registry.get(i);[a,c]=this.modeling.updateConnectionInfo(r,r.parent,a,c),r.source=a,r.target=c,this.modeling.layoutConnection(r,{}),this.canvas.bringToFrontElement(r);const h=r.labels[0];if(h){const{id:p,caption:m}=h;this.modeling.removeShape(h),this.modeling.createDiagramLabel({id:p,value:{caption:m,parent:t}})}})}calculateElementsPosition(e){const t=Object.values(e.elements).filter(N.isRootItem),n=this.buildTree(e,t);this.fillTreePosition(e,n)}updateElements(){this.hideConnections();const e=this.getDiagramData();this.calculateElementsPosition(e),this.fixElementsPosition(e),this.updateAllConnections(e)}};Do=(0,u.__decorate)([(0,u.__param)(0,g("relationshipSizeUtils")),(0,u.__param)(1,g("diagramUtils")),(0,u.__param)(2,g("modeling")),(0,u.__param)(3,g("elementRegistry")),(0,u.__param)(4,g("canvas")),(0,u.__param)(5,g("eventBus")),(0,u.__metadata)("design:paramtypes",[Me,N,Object,Pn,Object,Object])],Do);class MS extends Xa{constructor(){super(...arguments),this.highlightClassName="highlight"}get supportHighlight(){return!0}bringToFront(){}}let id=class extends nc{constructor(e,t,n,i,r){super(e,t,n,i),this.eventBus=e,this.overlays=t,this.rules=n,this.canvas=i,this.utils=r,this.oneColumnMode=!0,this.elementDataActionAttributeName="data-action"}canOpen(e){return e.canRead===!1||this.utils.isFlow(e)&&(e.source.canRead===!1||e.target.canRead===!1)?!1:super.canOpen(e)}fixEntries(e){return e}addEntriesContainer(e){const t=super.addEntriesContainer(e);return this.sortContainersEntries(t)}sortContainersEntries(e){return this.getSortedContainersEntries(e).forEach(n=>{e.removeChild(n),e.appendChild(n)}),e}getSortedContainersEntries(e){const t=this.getEntriesOrder(),n=Array.from(e.children);return n.sort((i,r)=>{const a=i.getAttribute(this.elementDataActionAttributeName),c=r.getAttribute(this.elementDataActionAttributeName),h=t.get(a),p=t.get(c);return h>p?1:-1}),n}getEntriesOrder(){const e="add",t="connect",n="delete";return new Map([[e,0],[t,1],[n,2]])}};id=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("overlays")),(0,u.__param)(2,g("rules")),(0,u.__param)(3,g("canvas")),(0,u.__param)(4,g("diagramUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object])],id);let sd=class extends Je{constructor(e,t,n,i,r,a,c,h,p,m){super(e,t,n,i,r,a,c,h,p),this.eventBus=e,this.elementFactory=t,this.commandStack=n,this.canvas=i,this.registry=r,this.diagramText=a,this.elements=c,this.rules=h,this.diagramUtils=p,this.sizeUtils=m,this.convertUtils=new Qa(p)}getElementAttributes(e,t,n){const i=super.getElementAttributes(e,t,n),{subCaption:r,collapsed:a,groups:c,info:h,expandedWidth:p,expandedHeight:m,hidden:f,originalId:C,hasChildren:S,single:w,canRead:E,position:H}=t;return{...i,subCaption:r,collapsed:a,groups:c,info:h,expandedWidth:p,expandedHeight:m,hidden:f,originalId:C,hasChildren:S,single:w,canRead:E,position:H}}createDiagramElement(e,t){const n=t[e],i=t[n.parent];i&&i.collapsed&&(n.hidden=!0);const{width:r,height:a}=this.sizeUtils.getElementSize(n);n.width=r,n.height=a,super.createDiagramElement(e,t)}removeConnection(e,t={}){super.removeConnection(e);const n=this.getElement(e);this.eventBus.fire("diagram.connection.delete",{element:n},t)}createConnection(e,t,n,i,r,a){if(typeof n=="object"&&(a=r,r=i,i=n,n=void 0),i?.type!==k.parentConnection)return[e,t,r]=this.updateConnectionInfo(i,r,e,t),super.createConnection(e,t,n,i,r,a)}updateConnectionInfo(e,t,n,i){let r;switch(e.hidden=!1,e.type){case k.connection:[n,i].every(N.isRelationshipItem)&&(t=n.parent,t.collapsed&&(e.hidden=!0));break;case k.indirectConnection:if(e.realSource=n,e.realTarget=i,[n,i]=[n,i].map(a=>a.hidden?a.parent:a),r=e.hidden,n.id===i.id?(n=e.realSource,i=e.realTarget,e.hidden=!0):e.hidden=!1,e.hidden!==r&&e.label){const a=this.registry.getGraphics(e.label),c=e.hidden?"none":"block";(0,x.CF)(a,"display",c)}break;default:break}return[n,i,t]}addNewConnection(e){this.eventBus.fire("diagram.connection.adding",e)}getHandlers(){return super.getHandlers()}positionViewboxRelativeToElement(e){const t=this.canvas.viewbox(),n=(0,or.U7)(e),i={x:Math.round(n.x+n.width/2-t.outer.width/2),y:n.y-130,width:t.outer.width,height:t.outer.height};this.canvas.viewbox(i),this.canvas.zoom(t.scale)}};sd=(0,u.__decorate)([(0,u.__param)(0,g("eventBus")),(0,u.__param)(1,g("elementFactory")),(0,u.__param)(2,g("commandStack")),(0,u.__param)(3,g("canvas")),(0,u.__param)(4,g("elementRegistry")),(0,u.__param)(5,g("diagramText")),(0,u.__param)(6,g("elements")),(0,u.__param)(7,g("rules")),(0,u.__param)(8,g("diagramUtils")),(0,u.__param)(9,g("relationshipSizeUtils")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object,Object,Object,Object,ie,Object,N,Me])],sd);var wS=y(40969);let rd=class extends wS.A{constructor(e,t,n){super(e,t),this.eventBus=e,this.registry=t,this.selection=n}updateContainments(){}update(e,t,n){super.update(e,t,n),t?.hidden&&this.selection.deselect(t)}};rd=(0,u.__decorate)([(0,u.__param)(0,V("eventBus")),(0,u.__param)(1,V("elementRegistry")),(0,u.__param)(2,V("selection")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object])],rd);var xS=y(44394),fc=y(78626);let od=class extends xS.A{constructor(e,t,n,i){super(e,t,i),this.elementRegistry=e,this.eventBus=t,this.sizeUtils=n,this.config=i}snapValue(e,t,n=fc.E){let i=0;t&&t.offset&&(i=t.offset),e+=i,e=(0,fc.y)(e,n);let r,a;return t&&t.min&&(r=t.min,(0,F.isNumber)(r)&&(r=(0,fc.y)(r+i,n,"ceil"),e=Math.max(e,r))),t&&t.max&&(a=t.max,(0,F.isNumber)(a)&&(a=(0,fc.y)(a+i,n,"floor"),e=Math.min(e,a))),e-=i,e}};od=(0,u.__decorate)([(0,u.__param)(0,V("elementRegistry")),(0,u.__param)(1,V("eventBus")),(0,u.__param)(2,V("relationshipSizeUtils")),(0,u.__param)(3,V("config")),(0,u.__metadata)("design:paramtypes",[Object,Object,Me,Object])],od);let ad=class{constructor(e,t,n){this.eventBus=e,this.canvas=t,this.elementRegistry=n,this.SHOW_GROUPS_CLASS="show-groups",this.FADE_ITEM_CLASS="fade-item",this.subscribeEvents()}subscribeEvents(){this.eventBus.on("selection.changed",this.onSelectionChanged.bind(this)),this.eventBus.on("relationshipGroup.highlight.changed",this.onGroupHighlightChanged.bind(this))}onGroupHighlightChanged(e){const t=e.id;this.clearHighlights(),t&&this.highlightItemsByGroupId(t)}onSelectionChanged(e){this.clearHighlights();const t=e.newSelection;if(t.length===1){const n=t[0];N.isRelationshipItem(n)&&n.groups?.length&&this.showGroupsByItem(n)}}removeMarkers(e){this.canvas.removeMarker(e,this.SHOW_GROUPS_CLASS),this.canvas.removeMarker(e,this.FADE_ITEM_CLASS)}showGroupsByItem(e){const t=e.groups,n=this.getAllItems(),i=this.getGroupIds(t);n.forEach(r=>{this.getGroupIds(r.groups).some(h=>i.includes(h))?this.showItemGroups(r):this.fadeItem(r)})}getAllItems(){return this.elementRegistry.filter(e=>N.isRelationshipItem(e))}getGroupIds(e){return e.map(t=>t.id)}showItemGroups(e){this.addMarker(e,this.SHOW_GROUPS_CLASS)}addMarker(e,t){this.canvas.addMarker(e,t)}fadeItem(e){this.addMarker(e,this.FADE_ITEM_CLASS)}clearHighlights(){this.getAllItems().forEach(e=>{this.removeMarkers(e)})}highlightItemsByGroupId(e){this.getAllItems().forEach(n=>{n.groups.some(r=>e===r.id)?this.showItemGroups(n):this.fadeItem(n)})}};ad=(0,u.__decorate)([(0,u.__param)(0,V("eventBus")),(0,u.__param)(1,V("canvas")),(0,u.__param)(2,V("elementRegistry")),(0,u.__metadata)("design:paramtypes",[Object,Object,Object])],ad);let cd=class extends cc{constructor(e,t,n,i,r){super(e,r),this.connectionDocking=e,this.elements=t,this.registry=n,this.sizeUtils=i,this.config=r}getRelationItemConnectPoint(e,t){const n=this.elements.getConfig(e),i=N.isIndirectConnection(t)||e.collapsed===!1,r=i?e.width:n.imageWidth,a=i?e.height:n.imageHeight;return{x:e.x+r/2,y:e.y+a/2}}getLines(e){const t=[];for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1],a=i.x<=r.x&&i.y<=r.y?{first:{x:i.x,y:i.y},second:{x:r.x,y:r.y}}:{first:{x:r.x,y:r.y},second:{x:i.x,y:i.y}};t.push(a)}return t}intersect(e,t,n,i,r,a,c,h){const p=Math.max(e,r),m=Math.min(i,h),f=Math.min(n,c),C=Math.max(t,a),S=f-p,w=m-C;return S<=0||w<=0?0:S*w}intersectElements(e,t){const i=this.getLines(e);for(const r of i)for(const a of t){const{width:c,height:h}=this.elements.getConfig(a),p=r.first.x,m=r.first.y,f=r.second.x+.01,C=r.second.y+.01,S=a.x+2,w=a.y+2,E=a.x+c-2,H=a.y+h-2;if(this.intersect(p,m,f,C,S,w,E,H))return!0}return!1}samePoint(e,t){return e.x===t.x&&e.y===t.y}similarLines(e,t){const n=this.getLines(e);for(const i of t){const r=this.getLines(i.waypoints);if(JSON.stringify(n)===JSON.stringify(r)||(r.reverse(),JSON.stringify(n)===JSON.stringify(r)))return!0}return!1}intersectPoints(e,t){const n=this.getLines(e);for(const i of n)for(const r of t){const a=this.getLines(r.waypoints);for(const c of a)if(this.samePoint(i.first,c.first)||this.samePoint(i.first,c.second)||this.samePoint(i.second,c.first)||this.samePoint(i.second,c.second))return!0}return!1}buildWaypoints(e,t,n,i,r,a){const c=Ao.Z9(t,n,i,r,a),h=Object.assign(e);return h.waypoints=Ao.d7(c),this.connectionDocking.getCroppedWaypoints(h,t,n)}getLayouts(e=!1){return[...e?["v:v","h:h"]:["h:h","v:v"],"h:v","v:h","b:b","t:t","l:l","r:r","l:t","l:r","l:b","t:l","t:r","t:b","r:l","r:t","r:b","b:l","b:t","b:r"]}indirectConnectionLayouts(){return this.getLayouts()}horizontalConnectionLayouts(){return this.getLayouts()}directConnectionLayouts(){return this.getLayouts(!0)}buildSmartConnection(e,t,n,i,r,a,c,h){let p;const m=this.registry.getFlowNodes().filter(E=>E.hidden!==!0),f=this.registry.getFlows().filter(E=>E.hidden!==!0&&E.id!==e.id);let C=0;const S=[];a.preferredLayouts=[""],p=this.buildWaypoints(e,t,n,i,r,a),S.push({waypoints:p,weight:0});do{const E=c[C];a.preferredLayouts=[E],p=this.buildWaypoints(e,t,n,i,r,a);const H=this.intersectElements(p,m);let se=!1,J=!1;if(!H&&(se=this.similarLines(p,f),!se&&(!h||(J=this.intersectPoints(p,f),!J))))break;const z=+!H+ +!se+ +!J;S.push({waypoints:p,weight:z,layout:E}),C++}while(C<c.length);return C===c.length&&(S.length===1?p=S[0].waypoints:(S.sort((E,H)=>E.weight-H.weight),p=S.slice(-1)[0].waypoints)),p}buildConnection(e,t,n,i,r,a){return this.buildWaypoints(e,t,n,i,r,a)}layoutConnection(e,t={}){const n=t.source||e.source,i=t.target||e.target,r=n&&this.getRelationItemConnectPoint(n,e),a=i&&this.getRelationItemConnectPoint(i,e);let c,h=!0;switch(!0){case N.isIndirectConnection(e):c=this.indirectConnectionLayouts();break;case N.isHorizontalConnection(e):c=this.horizontalConnectionLayouts();break;default:h=!1,c=this.directConnectionLayouts();break}return this.buildSmartConnection(e,n,i,r,a,t,c,h)}};cd=(0,u.__decorate)([(0,u.__param)(0,g("connectionDocking")),(0,u.__param)(1,g("elements")),(0,u.__param)(2,g("elementRegistry")),(0,u.__param)(3,g("relationshipSizeUtils")),(0,u.__param)(4,g("config")),(0,u.__metadata)("design:paramtypes",[Object,ie,Pn,Me,Object])],cd);let ld=class extends sc{constructor(e,t,n,i,r,a,c,h,p,m){super(e,t,n,i,m),this.elementRegistry=e,this.diagramModeling=t,this.elements=n,this.eventBus=i,this.sizeUtils=r,this.canvas=a,this.localStorage=c,this.zoomScroll=h,this.builder=p}fixData(e){e.elements=e.elements||{},e.connections=e.connections||{},e.labels=e.labels||{},e.groups=e.groups||{}}fixIds(e){["elements","connections","labels","groups"].forEach(t=>{let n=e[t]||{};n instanceof Array&&(n=e[t]=zm().keyBy(n,"id")),Object.keys(n).forEach(i=>{n[i].id!==i&&(n[i].id=i)})})}fixConnectionsDefaults(e){Object.values(e.connections).forEach(t=>{t.type=t.type??k.connection,t.position=t.relationshipType?.position??-1})}formatUniqId(...e){return e.join("_")}fixParents(e){const{elements:t,connections:n,labels:i}=e,r=[],a=[],c=[],h=[];Object.values(n).forEach(z=>{const Ss=t[z.source],Ot=t[z.target];switch(z.originalId=z.id,z.type){case k.connection:N.isRelationshipContainer(Ss)||N.isRelationshipContainer(Ot)?r.push(z):a.push(z);break;case k.parentConnection:c.push(z);break;default:h.push(z)}});const p=this.fixItems(c,t),m=this.fixSingleItems(t,n),C=[...this.fixContainers(p,t),...p,...m],S=this.fixItemsConnections(a,p),w=this.fixItemsConnections(a,m),E=this.fixConnections(h,C),H=this.fixConnections(c,C),se=[...r,...S,...w,...H,...E];this.sortConnectionsOrder(se);const J=this.fixLabels(i,se);e.elements={},e.connections={},e.labels={},C.forEach(z=>e.elements[z.id]=z),se.forEach(z=>e.connections[z.id]=z),J.forEach(z=>e.labels[z.id]=z)}sortConnectionsOrder(e){e.sort((t,n)=>this.getConnectionOrder(t)-this.getConnectionOrder(n))}getConnectionOrder(e){let t;return N.isIndirectConnection(e)?t=3:N.isHorizontalConnection(e)?t=1:t=2,t}fixSingleItemIncludeIntoContainer(e,t){const n=Object.values(e).filter(N.isRelationshipItem),i=Object.values(t);return n.forEach(r=>{const c=i.filter(h=>r.id===h.target).every(h=>!(h.relationshipType?.includeIntoContainer??!0));r.single=c}),n.filter(r=>r.single)}fixContainers(e,t){const n=Object.values(t).filter(N.isRelationshipContainer);return n.forEach(i=>{i.originalId=i.id,i.hasChildren=e.some(r=>r.parent===i.id)}),n}fixItems(e,t){const n=[];return Array.from(new Set(e.map(r=>r.target))).forEach(r=>{e.filter(c=>c.target===r).forEach(({source:c})=>{const h=Object.assign({},t[r],{id:this.formatUniqId(r,c),originalId:r,parent:c});n.push(h)})}),n}fixSingleItems(e,t){return this.fixSingleItemIncludeIntoContainer(e,t),this.fixSingleItemOriginal(e)}fixSingleItemOriginal(e){const n=Object.values(e).filter(N.isRelationshipItem).filter(i=>i.single);return n.forEach(i=>{i.originalId=i.id}),n}fixItemsConnections(e,t){const n=[];return e.forEach(i=>{const{id:r,source:a,target:c,position:h}=i;t.filter(m=>m.originalId===a).forEach(m=>{const f=m.parent,C=t.find(S=>S.originalId===c&&S.parent===f);if(C){const S=Object.assign({},i,{id:this.formatUniqId(r,f),originalId:r,source:m.id,target:C.id,position:h});n.push(S)}})}),n}fixConnections(e,t){const n=[];return e.forEach(i=>{const{id:r,source:a,target:c,position:h}=i;t.filter(m=>m.originalId===a).forEach(m=>{t.filter(C=>C.originalId===c).forEach(C=>{const S=Object.assign({},i,{id:this.formatUniqId(r,m.id,C.id),originalId:r,source:m.id,target:C.id,position:h});n.push(S)})})}),n}fixLabels(e,t){const n=[];return Object.values(e).forEach(i=>{t.filter(a=>a.originalId===i.parent).forEach(a=>{const c=Object.assign({},i,{id:this.formatUniqId(i.id,a.id),originalId:i.id,parent:a.id});n.push(c)})}),n}mapGroupInfo(e){Object.values(e.elements).filter(t=>N.isRelationshipItem(t)).forEach(t=>{const i=(t.groups||[]).map(r=>{const a=typeof r=="object",c=a?r.id:r,h=a?r.comment:null;return{id:c,itemComment:h}});t.groups=i.map(r=>Object.assign({itemComment:r.itemComment},e.groups[r.id]))})}setContainersCollapsed(e){const t=Object.values(e.elements);t.filter(n=>N.isRelationshipContainer(n)).forEach(n=>{const i=t.filter(r=>r.parent===n.id);e.rootElementId&&i.some(r=>r.recordId===e.rootElementId)?n.collapsed=!1:n.collapsed=n.collapsed??!0})}getConnectionAttributes(e,t){return{...super.getConnectionAttributes(e,t),realSource:t.realSource,realTarget:t.realTarget,position:t.position}}load(e,t,n){var i=()=>super.load,r=this;return(0,b.A)(function*(){return r.fixData(e),r.fixIds(e),r.fixConnectionsDefaults(e),r.fixParents(e),r.mapGroupInfo(e),r.setContainersCollapsed(e),r.sizeUtils.loadContainersState(e),r.builder.calculateElementsPosition(e),i().call(r,e,t,n)})()}};ld=(0,u.__decorate)([(0,u.__param)(0,g("elementRegistry")),(0,u.__param)(1,g("modeling")),(0,u.__param)(2,g("elements")),(0,u.__param)(3,g("eventBus")),(0,u.__param)(4,g("relationshipSizeUtils")),(0,u.__param)(5,g("canvas")),(0,u.__param)(6,g("localStorage")),(0,u.__param)(7,g("zoomScroll")),(0,u.__param)(8,g("builder")),(0,u.__metadata)("design:paramtypes",[Object,Je,ie,Object,Me,Object,Lt,Object,Do,Rt])],ld);var ES=y(6587);class IS extends ES.A{}const _c={Connection:{PathStrokeWidth:1,MarkerFillColor:"#4E7BD8",MarkerStrokeColor:"#4E7BD8",StrokeColor:"#4E7BD8"}}.Connection;class ud extends om{updateDataItemMarker(e,t,n){const i=n.source,r=n.target;if(i&&r){const a=i.id+"_"+r.id,c=e.elementRegistry.getGraphics(n);(0,x.CF)(c,"data-item-marker",a)}}get endMarker(){const e=(0,x.vt)("path");return(0,x.CF)(e,{d:qe.Connection.MarkerShape,"fill-opacity":qe.Connection.MarkerfillOpacity,fill:_c.MarkerFillColor,stroke:_c.MarkerStrokeColor,strokeLinejoin:qe.Connection.StrokeLinejoin,strokeWidth:qe.Connection.StrokeWidth,class:wo.ConnectionEndMarker}),e}getConnectionAttributes(e){const t=super.getConnectionAttributes(e);return Object.assign(t,{stroke:_c.StrokeColor,strokeWidth:_c.PathStrokeWidth})}drawConnection(e,t,n){const i=super.drawConnection(e,t,n);return this.updateDataItemMarker(e,t,n),i}}class AS extends ud{startMarker(){return this.endMarker}}class PS extends ud{getConnectionAttributes(e){const t=super.getConnectionAttributes(e);return Object.assign(t,{strokeDasharray:"8 8"})}}class wm{drawConnection(e,t,n){}}(0,u.__decorate)([xo(DS,ud),xo(TS,PS),xo(OS,AS),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object,Object,Object]),(0,u.__metadata)("design:returntype",Object)],wm.prototype,"drawConnection",null);function TS(o,e,t){return N.isIndirectConnection(t)}function DS(o,e,t){return xm(t)&&t.position!==0}function OS(o,e,t){return xm(t)&&t.position===0}function xm(o){return o.type===k.connection}class Em extends Io{drawConnection(e,t){return super.drawConnection(e,t)}}(0,u.__decorate)([dm(wm,pn.instead),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[Object,Object]),(0,u.__metadata)("design:returntype",void 0)],Em.prototype,"drawConnection",null);var Im;let yc=class extends ni{constructor(e,t,n,i,r,a){super(e,t,n,a),this.elements=e,this.styles=t,this.diagramText=n,this.sizeUtils=i,this.elementRegistry=r,this.eventBus=a,this._borderRadius=8}drawItemBackground(e,t){const n=this.elements.getConfig(t),i=N.isRoot(t.parent)?n.fill:n.fillInParent,{width:r,height:a}=this.sizeUtils.getElementSize(t);this.drawRect(e,r,a,this._borderRadius,0,{fill:i,stroke:"none"})}drawImage(e,t){const n=this.elements.getConfig(t),i=this.styles.style({height:n.imageHeight,width:n.imageWidth,rx:this._borderRadius,ry:this._borderRadius}),r=(0,x.vt)("image",i),a=t.canRead===!1?n.largeImageNoAccess:t.largeImage||n.largeImage;return r.setAttributeNS("http://www.w3.org/1999/xlink","href",a),r.setAttributeNS(null,"type",n.type),r.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),(0,x.BC)(e,r),r}drawImageBorder(e,t){const n=this.elements.getConfig(t),i=n.height,{imageWidth:r=i,imageHeight:a=i}=n;this.drawRect(e,r,a,this._borderRadius,0,{fill:"none",stroke:n.stroke})}drawText(e,t){const n=this.elements.getConfig(t),i=10,r=10,a=10,c=20,h=90,p=t.subCaption;if(p){const C={box:{height:c,width:n.width-n.imageWidth-r},className:"sub-caption"},S=this.createText(e,p,C);(0,mt.pd)(S,n.imageWidth+i,a,0)}const m=t.canRead===!1?n.captionNoAccess:t.caption||"#"+t.id;if(m){const C={box:{height:c,width:n.width-n.imageWidth-r},className:"caption"},S=this.createText(e,m,C);(0,mt.pd)(S,n.imageWidth+i,30,0)}const f=t.canRead===!1?"":t.info;if(f){const S=(t.collapsed&&t.expandedWidth?t.expandedWidth:t.width)-n.width+h,w=t.collapsed?h:S,E={box:{height:c,width:w},className:"info"},H=this.createText(e,f,E);(0,mt.pd)(H,n.width-h-r,a,0)}}drawItemBorder(e,t){const n=this.elements.getConfig(t),{width:i,height:r}=this.sizeUtils.getElementSize(t);this.drawRect(e,i,r,this._borderRadius,0,{fill:"none",stroke:n.stroke})}updateDataItemMarker(e){const t=e.caption;if(t){const n=this.elementRegistry.getGraphics(e);(0,x.CF)(n,"data-item-marker",t)}}getLockImage(){return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYntzdHJva2U6IzU0NjU3ZDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmN7c3Ryb2tlOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48cmVjdCBjbGFzcz0iYiIgd2lkdGg9IjExIiBoZWlnaHQ9IjkiIHJ4PSIyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgNS41KSIvPjxnIGNsYXNzPSJiIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3IDkpIj48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjIiIGhlaWdodD0iMiIvPjxyZWN0IGNsYXNzPSJhIiB4PSIwLjUiIHk9IjAuNSIgd2lkdGg9IjEiIGhlaWdodD0iMSIvPjwvZz48cGF0aCBjbGFzcz0iYiIgZD0iTS0yNzguNTgxLDM3OC4yNjR2LTIuNWExLjUsMS41LDAsMCwxLDEuNS0xLjVoMmExLjUsMS41LDAsMCwxLDEuNSwxLjV2Mi41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyODQuMDgxIC0zNzIuNzY0KSIvPjwvc3ZnPg=="}drawLockImage(e,t){const a=this.elements.getConfig(t),c=this.styles.style({height:16,width:16,class:"lock-image"}),h=(0,x.vt)("image",c);h.setAttributeNS("http://www.w3.org/1999/xlink","href",this.getLockImage()),h.setAttributeNS(null,"type",a.type),h.setAttributeNS(null,"preserveAspectRatio","none"),(0,x.BC)(e,h);const p=a.width-16-26,m=a.height-16-13;(0,mt.pd)(h,p,m,0)}draw(e,t){super.draw(e,t),this.drawItemBackground(e,t);const n=this.drawImage(e,t);return this.drawImageBorder(e,t),this.drawText(e,t),this.drawItemBorder(e,t),this.updateDataItemMarker(t),t.canRead===!1&&((e.parentElement||e.parentNode).classList.add("no-access"),this.drawLockImage(e,t)),n}};yc=(0,u.__decorate)([(0,u.__param)(0,g("elements")),(0,u.__param)(1,g("styles")),(0,u.__param)(2,g("diagramText")),(0,u.__param)(3,g("relationshipSizeUtils")),(0,u.__param)(4,g("elementRegistry")),(0,u.__param)(5,g("eventBus")),(0,u.__metadata)("design:paramtypes",[ie,typeof(Im=typeof hn.A<"u"&&hn.A)=="function"?Im:Object,Object,Me,rr,Object])],yc);let dd=class extends Eo{constructor(e,t,n){super(e,t),this.renderingLabel=e,this.renderingShape=t,this.relationshipRenderingItem=n}create(e){return N.isFlowNode({type:e})?this.relationshipRenderingItem:super.create(e)}};dd=(0,u.__decorate)([(0,u.__param)(0,g("renderingLabel")),(0,u.__param)(1,g("renderingShape")),(0,u.__param)(2,g("relationshipRenderingItem")),(0,u.__metadata)("design:paramtypes",[Object,Object,yc])],dd);var RS=y(6705);let hd=class extends RS.A{constructor(e,t,n,i,r){super(e),this.eventBus=e,this.modeling=t,this.sizeUtils=n,this.builder=i,this.registry=r,this.subscribeEvents()}subscribeEvents(){this.postExecuted(["shape.toggleCollapse"],_e.LOW,e=>{this.sizeUtils.saveContainersState();const t=e.context.shape;this.resizeContainer(t)})}resizeContainer(e){const{width:t,height:n}=this.sizeUtils.getElementSize(e),{x:i,y:r}=e,a={x:i,y:r,width:t,height:n};if(this.modeling.resizeShape(e,a,null,{autoResize:!0}),this.builder.updateElements(),e.collapsed){const c=this.registry.getGraphics(e);this.eventBus.fire("element.out",{gfx:c,element:e})}}};hd=(0,u.__decorate)([(0,u.__param)(0,V("eventBus")),(0,u.__param)(1,V("modeling")),(0,u.__param)(2,V("relationshipSizeUtils")),(0,u.__param)(3,V("builder")),(0,u.__param)(4,V("elementRegistry")),(0,u.__metadata)("design:paramtypes",[Object,Object,Me,Do,Pn])],hd);const pd={...dc,diagramRules:["type",To],renderingShapeFactory:["type",dd],relationshipRenderingItem:["type",yc],relationshipRenderingGroup:["type",mc],outlineFactory:["type",pc],layouter:["type",cd],outline:["type",td],selection:["type",IS],diagramRenderer:["type",Em],diagramUtils:["type",N],modeling:["type",sd],diagramLoader:["type",ld],contextPadProvider:["type",ed],relationshipGroupHighlight:["type",ad],relationshipToggleTools:["type",gc],relationshipToggleHandler:["type",hd],relationshipSizeUtils:["type",Me],elementToolsConfig:["type",hc],builder:["type",Do],addMenuProvider:["type",nd],connectionHighlight:["type",MS],contextPad:["type",id],graphicsFactory:["type",rd],elementRegistry:["type",Pn],gridSnapping:["type",od]};pd.__depends__=[...dc.__depends__],pd.__init__=[...dc.__init__,"relationshipGroupHighlight","relationshipToggleHandler","relationshipSizeUtils","builder","addMenuProvider","gridSnapping"];const Am=pd;class jS extends im{generateId(e){return Vm.generateUUID()}}class _s{constructor(e){this._materialIconsRegistrar=e,this._materialIconsRegistrar.addIcons([{name:"icon_close_24",icon:y(26242)}])}static{this.\u0275fac=function(t){return new(t||_s)(s.\u0275\u0275inject(Wt))}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:_s})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[In],imports:[M.CommonModule,te.MatButtonModule,Z.MatIconModule,ir.MatSnackBarModule,T.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(_s,{declarations:[Ci],imports:[M.CommonModule,te.MatButtonModule,Z.MatIconModule,ir.MatSnackBarModule,T.TranslateModule],exports:[Ci]})})();class ys{static{this.\u0275fac=function(t){return new(t||ys)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:ys})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[Ae,vi,{provide:ua,useValue:dc},Rt],imports:[M.CommonModule,T.TranslateModule.forChild(),_s]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(ys,{declarations:[Si],imports:[M.CommonModule,T.TranslateModule,_s],exports:[Si]})})();class Cs{static{this.\u0275fac=function(t){return new(t||Cs)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:Cs})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[Ae,{provide:ua,useValue:Am}],imports:[M.CommonModule,ys,T.TranslateModule.forChild(),ct,Bo.RouterModule.forChild([])]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Cs,{declarations:[Tn],imports:[M.CommonModule,ys,T.TranslateModule,ct,Bo.RouterModule],exports:[Tn]})})();const kS=o=>({schemaName:o});class Oo{constructor(e,t){this.dialogRef=e,this.data=t}static{this.\u0275fac=function(t){return new(t||Oo)(s.\u0275\u0275directiveInject(R.MatDialogRef),s.\u0275\u0275directiveInject(R.MAT_DIALOG_DATA))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Oo,selectors:[["crt-relationship-dialog"]],decls:10,vars:11,consts:[["content",""],[3,"data","allowFullScreenMode"],["caption",""],[1,"dialog-caption",3,"caption"],["tools",""],["mat-flat-button","","color","default",3,"clicked"]],template:function(t,n){t&1&&(s.\u0275\u0275elementStart(0,"crt-dialog"),s.\u0275\u0275elementContainerStart(1,0),s.\u0275\u0275elementStart(2,"crt-relationship-designer",1),s.\u0275\u0275elementContainerStart(3,2),s.\u0275\u0275element(4,"crt-label",3),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275elementContainerEnd(),s.\u0275\u0275elementContainerStart(6,4),s.\u0275\u0275elementStart(7,"crt-button",5),s.\u0275\u0275listener("clicked",function(){return n.dialogRef.close()}),s.\u0275\u0275text(8),s.\u0275\u0275pipe(9,"translate"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd(),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd(),s.\u0275\u0275elementEnd()),t&2&&(s.\u0275\u0275advance(2),s.\u0275\u0275property("data",n.data)("allowFullScreenMode",!1),s.\u0275\u0275advance(2),s.\u0275\u0275property("caption",s.\u0275\u0275pipeBind2(5,4,"RelationshipDesignerModal.Caption",s.\u0275\u0275pureFunction1(9,kS,n.data.schemaName))),s.\u0275\u0275advance(4),s.\u0275\u0275textInterpolate1(" ",s.\u0275\u0275pipeBind1(9,7,"BasePageComponent.Close"),""))},dependencies:[rn,pt,ln,kn,T.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.crt-relationship-dialog{max-width:94vw!important}.crt-relationship-dialog mat-dialog-container{height:90vh;width:94vw}.crt-relationship-dialog crt-relationship-dialog .designer-tools-panel{border:none}.crt-relationship-dialog crt-relationship-dialog .designer-tools-panel .dialog-caption label{font-family:var(--crt-headline-2-font-family);font-size:var(--crt-headline-2-font-size);line-height:var(--crt-headline-2-line-height);font-weight:var(--crt-headline-2-font-weight);letter-spacing:var(--crt-headline-2-letter-spacing);text-transform:var(--crt-headline-2-text-transform);-webkit-font-smoothing:antialiased;color:var(--crt-palette-primary-500, var(--palette-primary-500))}.crt-relationship-dialog crt-relationship-dialog .designer-content .diagram-wrap{border:1px solid #dcdcdc}.crt-relationship-dialog crt-relationship-dialog .designer-content .card-wrap{margin-left:10px}
`],encapsulation:2})}}let md=class extends Sm{constructor(e,t,n,i){super(),this.config=e,this.eventBus=t,this.rules=n,this.elements=i,this.translateService=e?.translateService}noAccessMessage(){const e=this.service,t=this.translateService.instant("RelationshipDiagram.NoAccess");e.showMessage(t)}subscribeServerDiagramChanges(){const e=this.service;this.eventBus.on(["element.dblclick"],t=>{const n=t.element;n&&!N.isRoot(n)&&(this.rules.canEdit(n)?e.elementDoubleClick(n.id):this.noAccessMessage())}),this.eventBus.on(["elements.noAccessMessage"],()=>{this.noAccessMessage()}),this.eventBus.on(["elements.removing"],t=>{const n=t.elements.map(i=>i.id);return e.elementRemoving(n)}),this.eventBus.on(["diagram.connection.adding"],t=>e.connectionAdding({source:t.source.id,target:t.target?.id,targetType:t.targetType})),this.eventBus.on([ve.connection.reconnectExecuted],t=>{const n=t.context;if(n.newSource!==n.oldSource||n.newTarget!==n.oldTarget)return e.connectionReconnect({id:n.connection.id,source:n.newSource.id,target:n.newTarget.id})}),this.eventBus.on(["diagram.item.selected"],t=>e.itemSelected(t.id)),this.eventBus.on("diagram.loaded",()=>e.diagramLoaded()),this.eventBus.on("connect.end",_e.LOW,function({context:t}){if(t.canExecute&&t.connection)return e.connectionAdding({id:t.connection.id,source:t.connection.source.id,target:t.connection.target.id})})}subscribeServerChanges(){return this.subscribeServerDiagramChanges(),[]}};md=(0,u.__decorate)([(0,u.__param)(0,g("config")),(0,u.__param)(1,g("eventBus")),(0,u.__param)(2,g("diagramRules")),(0,u.__param)(3,g("elements")),(0,u.__metadata)("design:paramtypes",[Object,Object,To,ie])],md);class gd{constructor(){this.handlerChain=Ct.instance}static{this._instanceOfKey="devkit_BaseRequestHandler"}get next(){return this._next}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===gd._instanceOfKey}setNext(e){if(this._next)throw new ah;this._next=e}}function NS(o){return o?function(e){zi(o.type,"RequestHandlerTypeName"),Cl(o.type),qg(o,e)}:e=>{}}let fd=class extends gd{constructor(e){super(),this._dialogProvider=e}handle(e){const t=e.recordId?.value??e.recordId;return(0,l.firstValueFrom)(this._dialogProvider.open(Oo,{data:{schemaName:e.entityName,selectedRecordId:t},panelClass:"crt-relationship-dialog"}))}};fd=(0,u.__decorate)([NS({requestType:"crt.ShowRelationshipsRequest",type:"crt.ShowRelationshipsHandler"}),(0,u.__metadata)("design:paramtypes",[ms])],fd);class bs extends Ae{constructor(){super(),this.getDiagramInfo$=new l.ReplaySubject(1),this.itemSelected$=new l.Subject,this.highlightedGroup$=new l.Subject,this.diagramLoaded$=new l.Subject,this.elementDoubleClick$=new l.Subject,this.elementRemoving$=new l.Subject,this.connectionAdding$=new l.Subject,this.connectionAdded$=new l.Subject,this.connectionChanged$=new l.Subject,this.showMessage$=new l.Subject,this.connectionReconnect$=new l.Subject,this.entityInGroupAdded$=new l.Subject,this.entityInGroupRemoving$=new l.Subject,this.diagramChanged$=new l.Subject,this.init()}getDiagramConfig(){var e=this;return(0,b.A)(function*(){return(0,l.lastValueFrom)(e.getDiagramInfo$.asObservable(),{defaultValue:null})})()}setDiagramConfig(e){this.getDiagramInfo$.next(e),this.getDiagramInfo$.complete()}diagramLoaded(){this.diagramLoaded$.next()}itemSelected(e){this.itemSelected$.next(e)}highlightGroup(e){this.highlightedGroup$.next(e)}elementDoubleClick(e){this.elementDoubleClick$.next(e)}connectionAdding(e){this.connectionAdding$.next(e)}connectionReconnect(e){this.connectionReconnect$.next(e)}elementRemoving(e){return this.elementRemoving$.next(e),!1}showMessage(e){this.showMessage$.next(e)}entityInGroupAdded(){this.entityInGroupAdded$.next()}entityInGroupRemoving(){this.entityInGroupRemoving$.next()}static{this.\u0275fac=function(t){return new(t||bs)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:bs,factory:bs.\u0275fac})}}function VS(o,e){return()=>(0,l.lastValueFrom)(o.loadCurrentUserInfo().pipe((0,d.tap)(t=>{e.use(t?.userInfo?.cultureInfo?.sysCultureName)})),{defaultValue:null})}let Ro=class wd{static{this.\u0275fac=function(t){return new(t||wd)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:wd})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[$t,zt,Dn,bt,bs,vt,zt,{provide:Ae,useClass:bs},{provide:ua,useFactory:()=>({...Am,diagramEventHandlerController:["type",md],elementFactory:["type",jS]})},Mn,{provide:s.ENVIRONMENT_INITIALIZER,useFactory:VS,deps:[pi,T.TranslateService],multi:!0}],imports:[M.CommonModule,dl.ColorGithubModule,Ti,xi.MatAutocompleteModule,te.MatButtonModule,R.MatDialogModule,Ne.MatDividerModule,jn.MatExpansionModule,Z.MatIconModule,Ve.MatFormFieldModule,On.MatInputModule,Ai.MatListModule,le.MatMenuModule,ur.MatTooltipModule,ct,Cs,T.TranslateModule.forChild({defaultLanguage:"en-US",loader:{provide:T.TranslateLoader,useFactory:(e,t)=>new __.TranslateHttpLoader(e,t+"ClientApp/assets/i18n/"),deps:[U.HttpClient,M.APP_BASE_HREF]}}),Xn,Co,fs]})}};Ro=(0,u.__decorate)([da({includes:[],requestHandlers:[fd]})],Ro),function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(Ro,{declarations:[Ut,Rn,cr,Pi,Ii,lr,kn,Ei,ar,Oo],imports:[M.CommonModule,dl.ColorGithubModule,Ti,xi.MatAutocompleteModule,te.MatButtonModule,R.MatDialogModule,Ne.MatDividerModule,jn.MatExpansionModule,Z.MatIconModule,Ve.MatFormFieldModule,On.MatInputModule,Ai.MatListModule,le.MatMenuModule,ur.MatTooltipModule,ct,Cs,T.TranslateModule,Xn,Co,fs],exports:[Ut,kn]})}();class jo{_buildRequestUrl(e){return this._isAbsoluteUrl(e)?e:M.Location.joinWithSlash(this.getUrl(),e)}_isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}getUrl(){return na()}intercept(e,t){return e=e.clone({url:this._buildRequestUrl(e.url)}),t.handle(e).pipe((0,d.catchError)(n=>(console.log(n),(0,l.throwError)(n))))}static{this.\u0275fac=function(t){return new(t||jo)}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:jo,factory:jo.\u0275fac})}}class vs extends jo{getUrl(){return yt()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=s.\u0275\u0275getInheritedFactory(vs)))(n||vs)}})()}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:vs,factory:vs.\u0275fac})}}function LS(o){return()=>(0,l.lastValueFrom)(o.loadCurrentUserInfo(),{defaultValue:null})}class ko{static{this.\u0275fac=function(t){return new(t||ko)}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:ko})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[vg,{provide:Vs,useValue:{name:zd,type:ce.PersistentAndMemory,options:{tableName:$e.UserInfo}},multi:!0},{provide:s.APP_INITIALIZER,useFactory:LS,deps:[pi],multi:!0}]})}}const Pm={production:!0,workspaceBaseUrl:"",appPath:""},BS=y.p+"assets/i18n/libs/";Pm.workspaceBaseUrl=yt(),Pm.appPath=Zc();const FS=[{provide:M.APP_BASE_HREF,useValue:"/"},{provide:U.HTTP_INTERCEPTORS,useClass:vs,multi:!0},Mn,ii,{provide:oh,useValue:"getRelationshipDesignerTranslation"}];class No{constructor(e,t){this._customElementsBootstrapService=e,this._translateService=t,this._customElements=[{componentName:"crt-relationship-designer",componentType:kn}]}ngDoBootstrap(){this._translateService.use(this._translateService.defaultLang).subscribe(()=>{this._customElements.forEach(({componentName:e,componentType:t})=>{this._customElementsBootstrapService.defineComponent(e,t)})})}static{this.\u0275fac=function(t){return new(t||No)(s.\u0275\u0275inject(Es),s.\u0275\u0275inject(T.TranslateService))}}static{this.\u0275mod=s.\u0275\u0275defineNgModule({type:No})}static{this.\u0275inj=s.\u0275\u0275defineInjector({providers:[...FS,(0,U.provideHttpClient)((0,U.withInterceptorsFromDi)(),(0,U.withXsrfConfiguration)({cookieName:Ed,headerName:Ed}))],imports:[Fe.BrowserModule,Ms.BrowserAnimationsModule,Bo.RouterModule.forRoot([],{}),ko,tr,Ro,Js.forNested({defaultLanguage:"en-US",loader:{provide:T.TranslateLoader,useClass:Ks},resourceSources:[{prefix:BS,suffix:".json"}]})]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&s.\u0275\u0275setNgModuleScope(No,{imports:[Fe.BrowserModule,Ms.BrowserAnimationsModule,Bo.RouterModule,ko,tr,Ro,T.TranslateModule]})})(),Fe.platformBrowser().bootstrapModule(No).catch(o=>console.error(o))},95339:(D,xd,y)=>{D.exports=y.p+"99af558b05eb0620cb099d8c76e6fec7.png"},26242:D=>{D.exports=`<svg id="Group_7" data-name="Group 7" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
	<rect id="Rectangle_7" data-name="Rectangle 7" width="24" height="24" fill="none"/>
	<line id="Line_5" data-name="Line 5" y1="10" x2="10" transform="translate(7 7)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
	<line id="Line_6" data-name="Line 6" x2="10" y2="10" transform="translate(7 7)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
</svg>
`},92825:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1592 7.99998C13.1592 5.15064 10.8494 2.84079 8.00004 2.84079C5.1507 2.84079 2.84085 5.15064 2.84085 7.99998C2.84085 10.8493 5.1507 13.1592 8.00004 13.1592C10.8494 13.1592 13.1592 10.8493 13.1592 7.99998ZM8.00004 1.50079C11.5894 1.50079 14.4992 4.41058 14.4992 7.99998C14.4992 11.5894 11.5894 14.4992 8.00004 14.4992C4.41064 14.4992 1.50085 11.5894 1.50085 7.99998C1.50085 4.41058 4.41064 1.50079 8.00004 1.50079ZM7.16167 5.39671C7.16167 4.93555 7.53551 4.56171 7.99667 4.56171H8.00333C8.46449 4.56171 8.83833 4.93555 8.83833 5.39671C8.83833 5.85786 8.46449 6.23171 8.00333 6.23171H7.99667C7.53551 6.23171 7.16167 5.85786 7.16167 5.39671ZM7.99979 6.95437C8.46095 6.95477 8.83447 7.32893 8.83407 7.79009L8.83163 10.6063C8.83123 11.0674 8.45706 11.4409 7.9959 11.4405C7.53475 11.4401 7.16123 11.066 7.16163 10.6048L7.16407 7.78864C7.16447 7.32749 7.53864 6.95397 7.99979 6.95437Z" fill="currentColor"/>
</svg>
`},19127:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64">
  <g id="Group_12169" data-name="Group 12169" transform="translate(-464 -425)">
    <g id="Group_9771" data-name="Group 9771" transform="translate(399 129)">
      <rect id="Rectangle_21438" data-name="Rectangle 21438" width="56" height="24" rx="3" transform="translate(73 316)" fill="#006ce0"/>
      <text id="OK" transform="translate(101 332)" fill="#fff" font-size="10" font-family="OpenSans-SemiBold, Open Sans" font-weight="600" letter-spacing="0.02em"><tspan x="-7.231" y="0">OK</tspan></text>
    </g>
    <rect id="Rectangle_24800" data-name="Rectangle 24800" width="72" height="64" rx="6" transform="translate(464 425)" fill="none"/>
  </g>
</svg>
`},3099:D=>{D.exports='<svg xmlns="http://www.w3.org/2000/svg" width="72" height="64" viewBox="0 0 72 64" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(-464 -425)"><g transform="translate(399 129)"><rect width="30" height="5" rx="2.5" transform="translate(99 320)" fill="#c8c8c8"/><rect width="56" height="5" rx="2.5" transform="translate(73 328)" fill="#c8c8c8"/><rect width="56" height="5" rx="2.5" transform="translate(73 336)" fill="#c8c8c8"/><text transform="translate(84 325)" fill="#181818" style="font-size:10px;font-family:OpenSans-Semibold, Open Sans;font-weight:600;letter-spacing:0.02em;"><tspan x="-10.73" y="0">Text</tspan></text></g><rect width="72" height="64" rx="6" transform="translate(464 425)" fill="none"/></g></svg>'},67566:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
	<path fill="currentColor" d="m4 7 4 4 4-4Z"/>
	<path fill="none" d="M0 0h16v16H0z"/>
</svg>
`},34035:D=>{D.exports=`<svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M4.33435 0.278443C4.70198 -0.0928144 5.29802 -0.0928144 5.66565 0.278443L9.72428 4.37711C10.0919 4.74837 10.0919 5.3503 9.72428 5.72156C9.35665 6.09281 8.7606 6.09281 8.39297 5.72156L5 2.29511L1.60703 5.72156C1.2394 6.09281 0.643352 6.09281 0.275722 5.72156C-0.0919075 5.3503 -0.0919075 4.74837 0.275722 4.37711L4.33435 0.278443Z" fill="#0D2E4E"/>
</svg>
`},65070:D=>{D.exports=`<svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path fill-rule="evenodd" clip-rule="evenodd" d="M0.275722 0.278443C0.643352 -0.0928144 1.2394 -0.0928144 1.60703 0.278443L5 3.70489L8.39297 0.278443C8.7606 -0.0928144 9.35665 -0.0928144 9.72428 0.278443C10.0919 0.6497 10.0919 1.25163 9.72428 1.62289L5.66565 5.72156C5.29802 6.09281 4.70198 6.09281 4.33435 5.72156L0.275722 1.62289C-0.0919075 1.25163 -0.0919075 0.6497 0.275722 0.278443Z" fill="#0D2E4E"/>
</svg>
`},49967:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="65.898" height="50" viewBox="0 0 65.898 50">
  <g id="Group_10554" data-name="Group 10554" transform="translate(-630.824 -282)">
    <g id="Group_10553" data-name="Group 10553" transform="translate(-8 4)">
      <rect id="Rectangle_23319" data-name="Rectangle 23319" width="24" height="8" transform="translate(640 311) rotate(-90)" fill="#757575" opacity="0.15"/>
      <rect id="Rectangle_23320" data-name="Rectangle 23320" width="15" height="8" transform="translate(655 313) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23321" data-name="Rectangle 23321" width="50" height="8" transform="translate(671 328) rotate(-90)" fill="#757575" opacity="0.16"/>
      <rect id="Rectangle_23326" data-name="Rectangle 23326" width="20" height="8" transform="translate(671 298) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23322" data-name="Rectangle 23322" width="30" height="8" transform="translate(687 311) rotate(-90)" fill="#757575" opacity="0.12"/>
      <rect id="Rectangle_23327" data-name="Rectangle 23327" width="17" height="8" transform="translate(687 298) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23323" data-name="Rectangle 23323" width="11" height="8" transform="translate(640 298) rotate(-90)" fill="#757575" opacity="0.15"/>
      <rect id="Rectangle_23324" data-name="Rectangle 23324" width="25" height="8" transform="translate(655 313) rotate(-90)" fill="#757575" opacity="0.19"/>
      <path id="Path_9959" data-name="Path 9959" d="M223.923,2054c8.8,1.753,9.21,7.979,18.455,7.661s19.38-15.618,29.076-15.618,13.109-8.362,16.091-8.043" transform="translate(416.077 -1753.707)" fill="none" stroke="#757575" stroke-linecap="round" stroke-width="2" opacity="0.36"/>
    </g>
  </g>
</svg>
`},78683:D=>{D.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 1.49845H0.783829V4.00128H2.48383V0.000488281H0V1.49845Z" fill="#FF4013"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14 1.00089H5.08699V3.00089H14V1.00089ZM14 6.00052H5.08699V8.00052H14V6.00052ZM0 12.7274V13.9998H3.19044V9.99979H0V11.1761H1.5V11.5073H0.75V12.3962H1.5V12.7274H0ZM14 10.9998H5.08699V12.9998H14V10.9998Z" fill="#FF4013"/>
<path d="M2.14577e-05 7.56383V8.99972L3.15902 8.99977V7.56383L2.26167 7.56378L3.15902 6.86625L3.15902 5.00135L2.14577e-05 5.00128L0 6.43327H1.5L2.14577e-05 7.56383Z" fill="#FF4013"/>
</svg>
`},36659:D=>{D.exports=`<svg id="Boolean_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_12" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-width="2"><rect width="14" height="14" stroke="none"/><rect x="1" y="1" width="12" height="12" fill="none"/></g><path id="Path_30" d="M10.5,4.5,5.912,9,4,7.162" transform="translate(1 0.5)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-width="2"/></svg>
`},39078:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8.183.779c2.084.007 2.813.35 4.468 1.861l-1.875 2.424-2.95-1.229Z" fill="#ff1c06"/><path d="M7.643 14.846c-2.083-.006-2.813-.35-4.467-1.861l1.875-2.424L8 11.79Z" fill="#ffc6b8"/><path d="M15.024 8.156c-.064 2.22-.431 3.006-2 4.809l-2.4-1.931 1.322-3.175Z" fill="#ff4013"/><path d="M13.074 3.143c1.5 1.443 1.8 2.195 1.949 4.431l-3.03.46-1.286-2.925Z" fill="#ff320e"/><path d="M3.224 12.86c-1.5-1.443-1.795-2.195-1.948-4.43l3.029-.46 1.287 2.925Z" fill="#ffe8e3"/><path d="M12.999 12.98c-1.578 1.562-2.386 1.878-4.769 2.1l-.4-3.055 3.149-1.384Z" fill="#ff795a"/><g transform="translate(-798.326 92.909)" fill="none"><path d="M798.326-92.909h16v16h-16z"/><circle cx="7" cy="7" r="7" transform="translate(799.326 -91.909)" stroke="#ff4013" stroke-width="2"/><circle cx="3" cy="3" r="3" transform="translate(803.326 -87.909)" stroke="#ff4013" stroke-width="2"/><g stroke="#ff4013" stroke-width="2"><path d="M806.326-81.454v3.686"/><path d="M806.326-88.519v-3.386"/><path d="M803.211-84.909h-3.685"/><path d="M812.826-84.909h-3.387"/><path d="M804.126-87.162c-.8-.8-2.306-2.252-3.1-3.05"/><path d="M811.628-79.605c-.729-.73-2.31-2.2-3.04-2.926"/><path d="m804.02-82.6-3 3"/><path d="m811.629-90.213-3.088 2.978"/></g></g></svg>
`},26861:D=>{D.exports=`<svg id="Date_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_6448" transform="translate(1 3)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="14" height="12" stroke="none"/><rect x="1" y="1" width="12" height="10" fill="none"/></g><line id="Line_764" x2="12" transform="translate(2 7)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_11729" d="M176.171,1073.754v3" transform="translate(-171.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/><path id="Path_11730" d="M176.171,1073.754v3" transform="translate(-165.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/></svg>
`},55146:D=>{D.exports=`<svg id="Datetime_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Icon_left_panel_date_time_16x16_heavy" transform="translate(0)"><rect id="Rectangle_6448" width="16" height="16" fill="none"/><path id="Path_6271" d="M1895.033,260.278h-4.149v-9h12v2" transform="translate(-1889.884 -248.278)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7772" d="M0,0H4.5" transform="translate(1 6)" fill="none" stroke="#ff4013" stroke-width="2"/><line id="Line_771" y2="4" transform="translate(4)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_772" y2="4" transform="translate(10)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Path_6272" transform="translate(-1889.764 -248.582)" fill="none" stroke-miterlimit="10"><path d="M1905.764,258.584a5,5,0,1,1-5-5A5,5,0,0,1,1905.764,258.584Z" stroke="none"/><path d="M 1900.7626953125 261.5840454101562 C 1902.417602539062 261.5840454101562 1903.763916015625 260.23828125 1903.763916015625 258.5840759277344 C 1903.763916015625 256.9292602539062 1902.417602539062 255.5829772949219 1900.7626953125 255.5829772949219 C 1899.109130859375 255.5829772949219 1897.763916015625 256.9292602539062 1897.763916015625 258.5840759277344 C 1897.763916015625 260.23828125 1899.109130859375 261.5840454101562 1900.7626953125 261.5840454101562 M 1900.7626953125 263.5840454101562 C 1898.000244140625 263.5840454101562 1895.763916015625 261.3454284667969 1895.763916015625 258.5840759277344 C 1895.763916015625 255.8215942382812 1898.000244140625 253.5829772949219 1900.7626953125 253.5829772949219 C 1903.524169921875 253.5829772949219 1905.763916015625 255.8215942382812 1905.763916015625 258.5840759277344 C 1905.763916015625 261.3454284667969 1903.524169921875 263.5840454101562 1900.7626953125 263.5840454101562 Z" stroke="none" fill="#ff4013"/></g><path id="Path_6273" d="M1900.1,255.194v4h2.5" transform="translate(-1889.098 -249.194)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},71011:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2 3.5H14V12C14 12.1326 13.9473 12.2598 13.8536 12.3536C13.7598 12.4473 13.6326 12.5 13.5 12.5H2.5C2.36739 12.5 2.24021 12.4473 2.14645 12.3536C2.05268 12.2598 2 12.1326 2 12V3.5Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14 3.5L8 9L2 3.5" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},55039:D=>{D.exports=`<svg id="File_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Group_7055" transform="translate(-733.278 92.545)"><g id="Rectangle_6454" transform="translate(735.278 -91.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="12" height="14" stroke="none"/><rect x="1" y="1" width="10" height="12" fill="none"/></g><line id="Line_774" x2="6" transform="translate(738.278 -87.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_775" x2="6" transform="translate(738.278 -84.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_777" x2="4" transform="translate(738.278 -81.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},68877:D=>{D.exports=`<svg id="Float_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_14515" transform="translate(-144 -422)"><rect id="Rectangle_39433" width="16" height="16" transform="translate(144 422)" fill="none"/></g><path id="Path_11302" d="M6.957-4.64a6.469,6.469,0,0,1-.8,3.6A2.764,2.764,0,0,1,3.707.127,2.732,2.732,0,0,1,1.285-1.079,6.377,6.377,0,0,1,.47-4.64a6.53,6.53,0,0,1,.793-3.621A2.752,2.752,0,0,1,3.707-9.426,2.739,2.739,0,0,1,6.135-8.208,6.39,6.39,0,0,1,6.957-4.64Zm-4.539,0a7.22,7.22,0,0,0,.3,2.447,1.022,1.022,0,0,0,.993.74A1.033,1.033,0,0,0,4.7-2.2,7.02,7.02,0,0,0,5-4.64a7,7,0,0,0-.308-2.453,1.034,1.034,0,0,0-.987-.746,1.025,1.025,0,0,0-.99.746A7.208,7.208,0,0,0,2.418-4.64ZM7.759-.908a1.064,1.064,0,0,1,.286-.806,1.158,1.158,0,0,1,.832-.273,1.125,1.125,0,0,1,.816.279,1.061,1.061,0,0,1,.289.8,1.061,1.061,0,0,1-.292.79,1.105,1.105,0,0,1-.812.289,1.138,1.138,0,0,1-.825-.282A1.057,1.057,0,0,1,7.759-.908ZM13.69,0H11.728V-5.37l.019-.882.032-.965q-.489.489-.679.641l-1.066.857L9.088-6.9l2.99-2.38H13.69Z" transform="translate(0.53 12.426)" fill="#ff4013"/></svg>
`},92458:D=>{D.exports=`<svg id="Guid_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_42308" width="16" height="16" fill="none"/><path id="Path_11737" d="M1.162,0H3.43V-9.8H1.162Zm9.926-10.388v3.654a2.894,2.894,0,0,0-2.254-.91A3.661,3.661,0,0,0,5.068-3.766,3.661,3.661,0,0,0,8.834.112a2.9,2.9,0,0,0,2.352-.98V0h2.086V-10.388ZM9.212-1.68A1.911,1.911,0,0,1,7.28-3.766,1.911,1.911,0,0,1,9.212-5.852,1.908,1.908,0,0,1,11.13-3.766,1.908,1.908,0,0,1,9.212-1.68Z" transform="translate(0.838 13)" fill="#ff4013" stroke="rgba(0,0,0,0)" stroke-width="1"/></svg>
`},65689:D=>{D.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1742_819)">
<path d="M10.913 8.99277L7.40833 13.0074H13.0074V11.2395L10.913 8.99277ZM10.8641 6.00745L15.0074 10.4519V15.0074H3.00745L10.8641 6.00745Z" fill="#ff4013"/>
<path d="M3.43597 9.72806C2.87697 10.2871 2.20496 9.92807 1.64496 9.37007C1.08596 8.81107 0.726988 8.13807 1.28699 7.57907L3.07794 5.78806C3.63694 5.22906 4.30898 5.58806 4.86798 6.14606C5.42798 6.70506 5.78595 7.37706 5.22595 7.93706L3.43597 9.72806Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M7.93689 5.22705C7.37689 5.78605 6.70591 5.42704 6.14691 4.86804C5.58691 4.30904 5.22894 3.63704 5.78894 3.07804L7.57892 1.28704C8.13892 0.728043 8.80993 1.08704 9.36993 1.64604C9.92993 2.20504 10.2879 2.87704 9.72888 3.43704L7.93689 5.22705Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M4.70691 6.51907L6.51791 4.70807" stroke="#ff4013" stroke-width="2"/>
<path d="M11.301 2.00702H14.0079V14.007H2.00793V11.581" stroke="#ff4013" stroke-width="2"/>
</g>
<defs>
<clipPath id="clip0_1742_819">
<rect width="16.007" height="16.007" fill="#ff4013"/>
</clipPath>
</defs>
</svg>
`},60521:D=>{D.exports=`<svg id="Integer_icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99433 4.65198C9.48732 5.09802 9.74027 5.69781 9.74027 6.39946C9.74027 7.11039 9.46186 7.74386 8.95863 8.29085L8.95331 8.29664C8.68048 8.58037 8.17318 8.98047 7.44252 9.47417L7.44143 9.4749C7.00788 9.76552 6.67964 10.0338 6.4484 10.2773C6.39755 10.3308 6.35224 10.3822 6.31202 10.4316H9.03463C9.42976 10.4316 9.75009 10.7519 9.75009 11.1471C9.75009 11.5422 9.42976 11.8625 9.03463 11.8625H4.36201V11.5055C4.36201 10.774 4.62396 10.1113 5.14954 9.53003C5.45393 9.18287 5.98212 8.74216 6.73359 8.22779C7.28336 7.835 7.61754 7.57002 7.77738 7.40238C8.08169 7.07198 8.22096 6.73348 8.22096 6.38964C8.22096 6.03409 8.11952 5.81409 7.95289 5.66027C7.78277 5.50324 7.51683 5.40148 7.12478 5.40148C6.72877 5.40148 6.47218 5.52561 6.29884 5.75228L6.29169 5.76164L6.28392 5.77051C6.13055 5.94579 6.0142 6.20942 5.96505 6.5873C5.91679 6.95826 5.61042 7.29659 5.18377 7.29659C4.7751 7.29659 4.39395 6.95656 4.44447 6.49553C4.51728 5.83108 4.75991 5.26428 5.17392 4.82141C5.68203 4.26788 6.36125 4 7.15424 4C7.87626 4 8.49451 4.21025 8.99122 4.6492L8.99433 4.65198ZM14.8743 4.5961C15.3635 5.01371 15.6083 5.57814 15.6083 6.262C15.6083 6.71398 15.4974 7.12093 15.2526 7.45671C15.1531 7.59318 15.0352 7.71289 14.9008 7.81669C15.0605 7.92572 15.2015 8.0545 15.3211 8.20545C15.6165 8.55303 15.7556 8.98069 15.7556 9.46307C15.7556 10.1963 15.4914 10.8144 14.9713 11.2883C14.4419 11.7715 13.7612 12 12.9634 12C12.2299 12 11.6078 11.8045 11.1119 11.4124L11.1064 11.408C10.628 11.014 10.3332 10.4794 10.2052 9.83055C10.1107 9.35139 10.5042 8.97835 10.9288 8.97835C11.3492 8.97835 11.6378 9.30727 11.7079 9.64478C11.7693 9.94025 11.9002 10.158 12.0891 10.3154C12.3147 10.495 12.5969 10.5985 12.9634 10.5985C13.3872 10.5985 13.6961 10.4769 13.9229 10.2668C14.1282 10.0596 14.2363 9.80805 14.2363 9.49253C14.2363 9.15687 14.1319 8.93882 13.9486 8.7817C13.7609 8.62082 13.483 8.52399 13.0419 8.52399H12.7866C12.4159 8.52399 12.1154 8.22345 12.1154 7.85271C12.1154 7.48197 12.4159 7.18143 12.7866 7.18143H13.0125C13.4306 7.18143 13.6903 7.08609 13.85 6.9535C14.0037 6.81675 14.0989 6.61783 14.0989 6.31109C14.0989 6.00164 14.0017 5.79895 13.8513 5.66111L13.8504 5.66027C13.6842 5.50686 13.4217 5.4113 13.0223 5.4113C12.6106 5.4113 12.3484 5.51295 12.1702 5.68456L12.1656 5.68906C12.0215 5.82278 11.914 6.00455 11.8495 6.25293C11.766 6.57474 11.481 6.87436 11.0816 6.87436C10.6572 6.87436 10.2506 6.49494 10.3668 6.00508C10.4953 5.4634 10.7597 5.01133 11.1524 4.66211C11.6438 4.20736 12.2763 4 13.0125 4C13.739 4 14.3777 4.18225 14.8711 4.59337L14.8743 4.5961ZM3.41307 4.92822V11.1029C3.41307 11.5224 3.07297 11.8625 2.65342 11.8625C2.23388 11.8625 1.89377 11.5224 1.89377 11.1029V6.23307C1.68552 6.37174 1.46266 6.49124 1.22573 6.59268C0.723506 6.80771 0.244141 6.40276 0.244141 5.92406C0.244141 5.5872 0.467589 5.3135 0.755873 5.2089C0.963927 5.13341 1.17934 5.03405 1.39555 4.90741C1.64533 4.74519 1.85627 4.57307 2.04007 4.3863C2.18718 4.23681 2.39336 4.13748 2.62233 4.13748C3.05905 4.13748 3.41307 4.4915 3.41307 4.92822Z" fill="#ff4013"/>
</svg>
`},61631:D=>{D.exports=`<svg id="Lookup_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_6916" transform="translate(2.277 2)"><g id="Group_6915" transform="translate(-0.277)"><circle id="Ellipse_237" cx="4.5" cy="4.5" r="4.5" fill="none" stroke="#ff4013" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path id="Path_6243" d="M.344.344,4.123,4.123" transform="translate(7.877 7.876)" fill="none" stroke="#ff4013" stroke-width="2"/></g></g><rect id="Rectangle_24756" width="16" height="16" fill="none"/></svg>
`},32643:D=>{D.exports=`<svg id="Money_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><path id="Path_7070" d="M-318.645,863.293h-6v-8h14v4" transform="translate(325.645 -852.293)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7071" d="M-322.646,855.292a2,2,0,0,1-2,2" transform="translate(326.646 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7072" d="M-312.246,857.292a2,2,0,0,1-2-2" transform="translate(326.246 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7073" d="M-324.646,861.692a2,2,0,0,1,2,2" transform="translate(326.646 -853.692)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Ellipse_1363" transform="translate(6 5)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="2" cy="2" r="2" stroke="none"/><circle cx="2" cy="2" r="1" fill="none"/></g><path id="Path_7074" d="M-310.846,861.425c0,.737-1.12,1.333-2.5,1.333s-2.5-.6-2.5-1.333,1.12-1.333,2.5-1.333S-310.846,860.69-310.846,861.425Z" transform="translate(325.846 -851.092)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7075" d="M-310.846,863.292c0,.589-1.12,1.333-2.5,1.333s-2.5-.744-2.5-1.333" transform="translate(325.846 -850.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},59155:D=>{D.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.3353 1.83815L6.26378 1.46676L6.26378 1.46676L5.3353 1.83815ZM6.03813 3.59524L5.10965 3.96663L5.10965 3.96663L6.03813 3.59524ZM5.82454 4.94398L5.05632 4.3038L5.0563 4.30383L5.82454 4.94398ZM5.44629 5.39792L6.21451 6.03811L6.21453 6.03808L5.44629 5.39792ZM5.52758 7.19434L4.82047 7.90144L4.8205 7.90147L5.52758 7.19434ZM6.8057 8.47236L7.5128 7.76526L7.51278 7.76523L6.8057 8.47236ZM8.60205 8.55382L7.96198 7.7855L7.96187 7.78559L8.60205 8.55382ZM9.05613 8.17554L9.69619 8.94386L9.69631 8.94376L9.05613 8.17554ZM10.4048 7.96192L10.7762 7.03345L10.7761 7.03344L10.4048 7.96192ZM12.1617 8.66476L11.7903 9.59322L11.7903 9.59323L12.1617 8.66476ZM12.9999 9.90268H11.9999V9.90272L12.9999 9.90268ZM13 11.7369H14V11.7368L13 11.7369ZM4.09733 2C4.23363 2 4.3562 2.08298 4.40682 2.20954L6.26378 1.46676C5.90943 0.580885 5.05144 0 4.09733 0V2ZM4.40682 2.20953L5.10965 3.96663L6.96661 3.22386L6.26378 1.46676L4.40682 2.20953ZM5.10965 3.96663C5.15517 4.08044 5.13462 4.20985 5.05632 4.3038L6.59277 5.58417C7.14152 4.92566 7.28485 4.01947 6.96661 3.22385L5.10965 3.96663ZM5.0563 4.30383L4.67804 4.75777L6.21453 6.03808L6.59279 5.58414L5.0563 4.30383ZM4.67807 4.75774C3.90567 5.68462 3.96693 7.0479 4.82047 7.90144L6.23468 6.48723C6.11298 6.36552 6.10396 6.17076 6.21451 6.03811L4.67807 4.75774ZM4.8205 7.90147L6.09862 9.17949L7.51278 7.76523L6.23466 6.4872L4.8205 7.90147ZM6.09859 9.17947C6.95196 10.0328 8.31517 10.0946 9.24224 9.32204L7.96187 7.78559C7.82939 7.89599 7.63468 7.88713 7.5128 7.76526L6.09859 9.17947ZM9.24212 9.32213L9.69619 8.94386L8.41606 7.40722L7.96198 7.7855L9.24212 9.32213ZM9.69631 8.94376C9.79033 8.86541 9.91963 8.8449 10.0334 8.8904L10.7761 7.03344C9.98045 6.71516 9.07438 6.85861 8.41594 7.40732L9.69631 8.94376ZM10.0333 8.89039L11.7903 9.59322L12.5331 7.73629L10.7762 7.03345L10.0333 8.89039ZM11.7903 9.59323C11.917 9.64389 11.9999 9.76649 11.9999 9.90268H13.9999C13.9999 8.94847 13.4189 8.09059 12.5331 7.73628L11.7903 9.59323ZM11.9999 9.90272L12 11.7369L14 11.7368L13.9999 9.90264L11.9999 9.90272ZM12 11.7369C12 11.8823 11.8822 12 11.737 12V14C12.987 14 14 12.9867 14 11.7369H12ZM11.737 12C6.35945 12 2 7.64067 2 2.26318H0C0 8.74528 5.25492 14 11.737 14V12ZM2 2.26318C2 2.11782 2.11785 2 2.26316 2V0C1.01322 0 0 1.0133 0 2.26318H2ZM2.26316 2H4.09733V0H2.26316V2Z" fill="#FF4013"/>
</svg>
`},67021:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15H13C14.1046 15 15 14.1046 15 13V3C15 1.89543 14.1046 1 13 1Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M9 12H7V6H4V4H12V6H9V12Z" fill="#FF4013"/>
</svg>
`},28010:D=>{D.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.14 6.90901C5.13775 7.50618 5.25259 8.098 5.478 8.65101L1.5 12.629V15.229H4.1V13.669H5.66V12.109H7.22L8.078 11.251C8.631 11.4764 9.22282 11.5912 9.82 11.589C10.7456 11.589 11.6504 11.3145 12.4201 10.8003C13.1897 10.286 13.7895 9.55512 14.1438 8.69996C14.498 7.84481 14.5907 6.90381 14.4101 5.99598C14.2295 5.08815 13.7838 4.25426 13.1293 3.59975C12.4747 2.94524 11.6409 2.49951 10.733 2.31893C9.82519 2.13835 8.8842 2.23103 8.02904 2.58525C7.17388 2.93947 6.44297 3.53932 5.92872 4.30894C5.41448 5.07856 5.14 5.98339 5.14 6.90901ZM12.4832 5.95178C12.4832 6.84671 11.7577 7.57221 10.8628 7.57221C9.96785 7.57221 9.24236 6.84671 9.24236 5.95178C9.24236 5.05684 9.96785 4.33135 10.8628 4.33135C11.7577 4.33135 12.4832 5.05684 12.4832 5.95178Z" fill="#FF4013"/>
</svg>
`},97180:D=>{D.exports=`<svg id="Text_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_39432" width="16" height="16" fill="none"/><path id="Path_11304" d="M5.113,0H2.994V-8.23H.28V-9.994H7.827V-8.23H5.113Z" transform="translate(4 13)" fill="#ff4013"/></svg>
`},8510:D=>{D.exports=`<svg id="Time_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Ellipse_1346" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="7" cy="7" r="7" stroke="none"/><circle cx="7" cy="7" r="6" fill="none"/></g><path id="Path_6908" d="M1824.814,31.345v6h3" transform="translate(-1816.814 -29.345)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},64337:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 8H14" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 13.8375C9.38071 13.8375 10.5 11.2239 10.5 7.99998C10.5 4.77601 9.38071 2.16248 8 2.16248C6.61929 2.16248 5.5 4.77601 5.5 7.99998C5.5 11.2239 6.61929 13.8375 8 13.8375Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`}}]);
