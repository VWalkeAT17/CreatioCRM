(self.webpackChunkapp_studio_enterprise_omnichannel_messaging=self.webpackChunkapp_studio_enterprise_omnichannel_messaging||[]).push([[8441],{12014:(D,X,m)=>{var y={"./default-file-icon.svg":27107,"./file-excel.svg":76185,"./file-image.svg":87831,"./file-pdf.svg":96682,"./file-powerpoint.svg":30351,"./file-word.svg":23472};function g(i){var M=E(i);return m(M)}function E(i){if(!m.o(y,i)){var M=new Error("Cannot find module '"+i+"'");throw M.code="MODULE_NOT_FOUND",M}return y[i]}g.keys=function(){return Object.keys(y)},g.resolve=E,D.exports=g,g.id=12014},10722:(D,X,m)=>{var y={"./default-file-icon.svg":8035,"./file-excel.svg":25689,"./file-image.svg":21431,"./file-pdf.svg":94570,"./file-powerpoint.svg":17935,"./file-word.svg":94896,"./large/default-file-icon.svg":27107,"./large/file-excel.svg":76185,"./large/file-image.svg":87831,"./large/file-pdf.svg":96682,"./large/file-powerpoint.svg":30351,"./large/file-word.svg":23472};function g(i){var M=E(i);return m(M)}function E(i){if(!m.o(y,i)){var M=new Error("Cannot find module '"+i+"'");throw M.code="MODULE_NOT_FOUND",M}return y[i]}g.keys=function(){return Object.keys(y)},g.resolve=E,D.exports=g,g.id=10722},48104:(D,X,m)=>{var y={"./datetime-picker-toggle-date-icon.svg":67347,"./datetime-picker-toggle-time-icon.svg":63202};function g(i){var M=E(i);return m(M)}function E(i){if(!m.o(y,i)){var M=new Error("Cannot find module '"+i+"'");throw M.code="MODULE_NOT_FOUND",M}return y[i]}g.keys=function(){return Object.keys(y)},g.resolve=E,D.exports=g,g.id=48104},48422:(D,X,m)=>{var y={"./error-icon.svg":77017,"./warning-icon.svg":64207};function g(i){var M=E(i);return m(M)}function E(i){if(!m.o(y,i)){var M=new Error("Cannot find module '"+i+"'");throw M.code="MODULE_NOT_FOUND",M}return y[i]}g.keys=function(){return Object.keys(y)},g.resolve=E,D.exports=g,g.id=48422},48441:(D,X,m)=>{var y=m(76608),g=m(74369),E=m(5757),i=m(22307),M=m(40409),R=m(44635),P=m(84065),v=m(79772),L=m(23092);class ${constructor(e,t){this._translateService=e,this._userInfo=t,this._defaultCulture="en-US"}initialize(){const e=this._userInfo?.cultureInfo?.sysCultureName??this._defaultCulture;this._translateService.setDefaultLang(this._defaultCulture),this._translateService.currentLang=e,this._translateService.getTranslation(e)}static{this.\u0275fac=function(t){return new(t||$)(i.\u0275\u0275inject(v.TranslateService),i.\u0275\u0275inject(L.oq))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"})}}var T=m(28399),ge=m.n(T),u=m(62278),b=m(67057);const ie="/img/entity/hash/SysImage/Data/",We="/DataService/json/SyncReply";function it(a){return a.endsWith("/")||(a+="/"),a}function st(a){return a.replace(/(^([/\\])+)|(([/\\])+$)/,"")}function _e(a){return a=a.replace(location.hash,""),a.replace(location.search,"")}function ct(a){return`${_()}/Navigation/Navigation.aspx?schemaName=${a}`}function $e(){return"/"}function ae(){let a=location.pathname;const e=a.match(/.*?\/\d\/?/);return e&&e.length===1?a=it(e[0]):a="",N(location.origin,a)}function at(){let a=location.href.replace(ae(),"");return a=_e(a),a||"/"}function se(){const a=at(),e=ae(),t=a.split("/").filter(Boolean)[0];return t?`${e}${t}/`:e}function H(){let e=ae().replace(location.origin,"");return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function _(){return ae().replace(/\/0\/?$|\/+$/,"")}function N(...a){return a.map(e=>st(e)).join("/")}function k(a,e){return`${ct(a)}&recordId=${e}`}function G(a,e){function t(o,l){return o.toLowerCase().replace(l,"").split("/").filter(d=>d).join("/")}const n=ae().toLowerCase(),s=t(a,n),r=t(e,n);return s===r}function ue(a){return a?H()+ie+a:null}function Le(){return H()+esqServiceUrl}function qi(a){const{uId:e,name:t,packageUId:n,userLevelSchema:s}=a;if(!e&&!t)throw new Error("uId or name is required");const r=ae(),o=at(),l=`#/InterfaceDesigner/${e||t}`,d=new URLSearchParams;return n&&d.append("packageUId",n),s&&d.append("userLevelSchema","true"),`${r}${o}${l}?${d.toString()}`}const Nc="Translations/Custom/",Ki="CommonFeatures.UseCustomCoreLocalizations";var p=m(5960);const oe=new i.InjectionToken("FEATURE_VALUES",{factory:()=>({})});var Pn=m(41483),Ec=m(13875),mt=m(89720),Ie=m(90964),c=m(36486),$a=m(72051),Dc=m(30293);const Ga="features-cache",$g={provide:$a.P,useValue:{name:Ga,type:Pn.P.PersistentAndMemory,options:{tableName:Dc.w.Features}},multi:!0},hp=new Array("constructor","ngOnDestroy");let Qa=!1;const Ac=new Proxy({},{get(a,e){if(Qa||hp.includes(e))return a[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),mu={provide:oe,useFactory:()=>Ac},gu=new i.InjectionToken("FEATURE_SERVICE_GET_FEATURES_STATES_ENDPOINT",{factory:()=>"rest/FeatureService/GetFeatureStates",providedIn:"root"});let hn=class ql{constructor(e,t,n,s,r){this.httpClient=e,this._getFeatureStatesEndpoint=t,this._useSystemClientCache=n,this._cacheManager=s,this._measurePerformanceService=r,this._cachedCodes=new Map,this._featuresLoaded=!1,this._destroyed$=new u.Subject,this._isDevMode=(0,i.isDevMode)()}_getFeaturesFromURL(){const e=location.hash,t=e.indexOf("?");if(this._isDevMode&&t>=0){const n=e.substring(t+1);return[...new URLSearchParams(n.startsWith("?")?n.slice(1):n)].filter(([r])=>r.startsWith("feature:")).map(([r,o])=>({key:r.substring(8),value:o==="true"}))}return[]}_loadFeaturesValues(){const e=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,c.map)(t=>t.GetFeatureStatesResult.map(n=>({key:n.Key,value:n.Value===1}))));return this._useSystemClientCache?(0,u.from)(this._cacheManager.getOrCreate({name:Ga,type:Pn.P.Memory})).pipe((0,c.switchMap)(()=>this._cacheManager.executeWithBulkCache(Ga,e)),this._measurePerformanceService.measure$("FeatureService: load features with cache bulk")):e}_enrichFeaturesWithUrlValues(e){const t=this._getFeaturesFromURL();return[...e,...t]}updateCachedFeatureValues(e,t){Object.assign(e,t),Object.freeze(e)}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this._loadFeaturesValues().pipe((0,c.map)(e=>this._enrichFeaturesWithUrlValues(e)),(0,c.map)(e=>{e.forEach(n=>{this._cachedCodes.set(n.key,n.value)});const t=e.map(n=>[n.key,n.value]);return Object.fromEntries(t)}),(0,c.tap)(e=>{this.updateCachedFeatureValues(Ac,e),this._featuresLoaded=!0,Qa=!0}),(0,c.catchError)(()=>(Qa=!0,this._featuresLoaded=!0,(0,u.of)(null))),(0,u.shareReplay)({bufferSize:1,refCount:!1}),(0,c.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._featuresLoaded?(0,u.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,c.map)(()=>this._cachedCodes.get(e)||!1)):(0,u.of)(!1)}getFeaturesState(e){return(0,u.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const n=typeof t=="string"?this.getFeatureState(t):t;return new Promise(s=>n.pipe((0,c.first)()).subscribe({next:s}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||ql)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(gu),i.\u0275\u0275inject(Ec.X,8),i.\u0275\u0275inject(mt.G),i.\u0275\u0275inject(Ie.g))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ql,factory:ql.\u0275fac,providedIn:"root"})}};hn=(0,p.__decorate)([(0,P.op)({requestType:"crt.FeatureService"}),(0,p.__metadata)("design:paramtypes",[E.HttpClient,String,Boolean,mt.G,Ie.g])],hn);const fu=new i.InjectionToken("FETCH_MULTI_TRANSLATE_RESOURCES_SOURCES"),Xi=new i.InjectionToken("FETCH_MULTI_TRANSLATE_CUSTOM_RESOURCES_SOURCES");class Et{constructor(e,t,n){this._resourceSources=e,this._customResourceSources=t,this._featureService=n}_getCustomResourcesSource(){return this._customResourceSources?.length?this._customResourceSources:[{prefix:b.Location.joinWithSlash(ae(),Nc),suffix:".json"}]}getResourceOptions(){return(0,u.from)(this._featureService.getFeatureState(Ki)).pipe((0,u.map)(e=>e?this._getCustomResourcesSource():[]),(0,u.map)(e=>[...this._resourceSources??[],...e]))}static{this.\u0275fac=function(t){return new(t||Et)(i.\u0275\u0275inject(fu),i.\u0275\u0275inject(Xi,8),i.\u0275\u0275inject(hn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Et,factory:Et.\u0275fac})}}const pp=new i.InjectionToken("NestedTranslateLoader");class pn{constructor(e){this._optionsProvider=e}_fetchTranslation(e){return fetch(e,{cache:"no-cache"}).then(t=>{if(!t.ok&&t.status!==304)throw new Error(`Loading translations failed: ${e} (${t.status})`);return t.json()})}_handleFetchResults(e){for(const n of e.filter(s=>s.status==="rejected"))console.error(n.reason);const t=e.filter(n=>n.status==="fulfilled").map(n=>n.value||{});return(0,T.merge)({},...t)}getTranslation(e){return this._optionsProvider.getResourceOptions().pipe((0,u.switchMap)(t=>{const n=t.map(({prefix:s,suffix:r})=>this._fetchTranslation(`${s}${e}${r}`));return(0,u.from)(Promise.allSettled(n)).pipe((0,u.map)(s=>this._handleFetchResults(s)))}))}static{this.\u0275fac=function(t){return new(t||pn)(i.\u0275\u0275inject(Et))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:pn,factory:pn.\u0275fac})}}class kn{static _getResourceSourcesProviders(e){const{resourceSources:t,customResourceSources:n}=e??{},s=(n??[]).map(r=>({...r,provide:Xi,multi:!0}));return[{provide:fu,useValue:t},...s]}static forRoot(e){const t=v.TranslateModule.forRoot({...e,loader:{provide:v.TranslateLoader,useClass:pn}});return t.providers.push(Et,...this._getResourceSourcesProviders(e)),t}static forNested(e){const t=v.TranslateModule.forRoot(e);return t.providers.push({provide:pp,useClass:pn},Et,...this._getResourceSourcesProviders(e)),t}static with(e){return{ngModule:kn,providers:[pn,Et,...this._getResourceSourcesProviders(e)]}}static{this.\u0275fac=function(t){return new(t||kn)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:kn})}static{this.\u0275inj=i.\u0275\u0275defineInjector({})}}var mn=m(30421),Z=m(59247),W=m(10821),U=m(37851),Ge=m(55569),gt=m(50825),Dt=m(46465),ci=m(44951),Ut=m(65339);function mp(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",1),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onClick(s))}),i.\u0275\u0275element(1,"mat-spinner",2),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275styleProp("opacity",t.opacity),i.\u0275\u0275classProp("containerized-mask",t.containerized)}}class Ct{constructor(e){this._cdr=e,this._isVisible=!0,this._opacity=.6,this.containerized=!1}get isVisible(){return this._isVisible}set isVisible(e){this._isVisible!==e&&(this._isVisible=e,this._cdr.detectChanges())}set opacity(e){this._opacity=e,this._cdr.detectChanges()}get opacity(){return this._opacity}_assertIsBodyMask(){if(this.containerized)throw new Error("Is not body mask")}onClick(e){e.stopImmediatePropagation()}hideBodyMask(){this._assertIsBodyMask(),this.isVisible=!1}showBodyMask(){this._assertIsBodyMask(),this.isVisible=!0}static{this.\u0275fac=function(t){return new(t||Ct)(i.\u0275\u0275directiveInject(i.ChangeDetectorRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ct,selectors:[["ts-mask"]],inputs:{isVisible:"isVisible",opacity:"opacity"},decls:1,vars:1,consts:[["class","mask-wrap",3,"containerized-mask","opacity","click",4,"ngIf"],[1,"mask-wrap",3,"click"],["mode","indeterminate","diameter","32","aria-hidden","true",1,"mask-element"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,mp,2,4,"div",0),t&2&&i.\u0275\u0275property("ngIf",n.isVisible)},dependencies:[b.NgIf,Ut.MatProgressSpinner],styles:[".component-mask[_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%], .component-mask   [_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%]{position:absolute}.component-mask[_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%], .component-mask   [_nghost-%COMP%]   .mask-wrap[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%]{position:absolute}.mask-wrap[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:2011;width:100%;height:100%;background-color:#fff}.mask-wrap[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;margin-top:-16px;margin-left:-16px;z-index:999}.mask-wrap.containerized-mask[_ngcontent-%COMP%], .mask-wrap.containerized-mask[_ngcontent-%COMP%]   .mask-element[_ngcontent-%COMP%]{position:absolute}"],changeDetection:0})}}class rt{static{this._visibleMasks=new Set}get maskComponent(){return this.maskComponentRef?.instance}get isVisible(){return!!this.maskComponent?.isVisible}set isVisible(e){e?(this.maskComponent||this.createMaskComponent(),this.maskComponent.isVisible=!0):this.maskComponent&&(this.maskComponent.isVisible=!1)}constructor(e,t){this.document=e,this.ngZone=t,this._defaultMaskDelayMilliseconds=300,this._defaultMinimumMaskDuration=500,this._immediateDisplayAfterHideMaxDelay=50,this._maskShouldBeShown=!1,this._maskShownTimestamp=0,this._maskHiddenTimestamp=0,this.updateMaskStateAttribute()}updateMaskStateAttribute(){const e=this.document?.body;e&&(rt._visibleMasks.size>0?e.getAttribute("maskstate")!=="visible"&&e.setAttribute("maskstate","visible"):e.getAttribute("maskstate")!=="none"&&e.setAttribute("maskstate","none"))}_internalShow(){this.isVisible||(this.isVisible=!0,rt._visibleMasks.add(this),this.updateMaskStateAttribute(),this._maskShownTimestamp=Date.now())}_internalHide(){this.isVisible&&(this.isVisible=!1,rt._visibleMasks.delete(this),this.updateMaskStateAttribute(),this._maskHiddenTimestamp=Date.now())}show(e){this._maskShouldBeShown=!0;const t=Date.now()-this._maskHiddenTimestamp;e?.delay===0||t<this._immediateDisplayAfterHideMaxDelay?this._internalShow():this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._maskShouldBeShown&&this.ngZone.run(()=>this._internalShow())},e?.delay||this._defaultMaskDelayMilliseconds)})}hide(){this._maskShouldBeShown=!1;const e=Date.now()-this._maskShownTimestamp;e>=this._defaultMinimumMaskDuration?this._internalHide():this.ngZone.runOutsideAngular(()=>{setTimeout(()=>{this._maskShouldBeShown||this.ngZone.run(()=>this._internalHide())},this._defaultMinimumMaskDuration-e)})}ngOnDestroy(){this.maskComponentRef?.destroy(),this.maskComponentRef=null,rt._visibleMasks.delete(this)}static{this.\u0275fac=function(t){return new(t||rt)(i.\u0275\u0275inject(Document),i.\u0275\u0275inject(i.NgZone))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac})}}const es=new i.InjectionToken("CRT_MASK_COMPONENT");class At extends rt{constructor(e,t,n,s){super(n,s),this._viewContainerRef=e,this._maskComponentType=t,this._tasks=new Set}_setMaskStateAttribute(){const e=this._viewContainerRef?.element.nativeElement.parentElement;if(!e)return;const t=e.getAttribute("maskstate"),n=this.isVisible?"visible":"none";e.setAttribute("aria-busy",this.isVisible?"true":"false"),this.isVisible?e.setAttribute("inert","true"):e.removeAttribute("inert"),t!==n&&e.setAttribute("maskstate",n)}createMaskComponent(){this.maskComponentRef=this._viewContainerRef.createComponent(this._maskComponentType??Ct),this.maskComponentRef.instance.containerized=!0,this.maskComponentRef.instance.isVisible=!1}updateMaskStateAttribute(){super.updateMaskStateAttribute(),this._setMaskStateAttribute()}addTask(e,t){return this.shouldShow!==!1&&(this._tasks.add(e),this.show(t??this.settings)),e}removeTask(e){this.shouldShow!==!1&&(this._tasks.delete(e),this._tasks.size===0&&this.hide())}clearTasks(){this.shouldShow!==!1&&this._tasks.size>0&&(this._tasks.clear(),this.hide())}static{this.\u0275fac=function(t){return new(t||At)(i.\u0275\u0275directiveInject(i.ViewContainerRef),i.\u0275\u0275directiveInject(es,8),i.\u0275\u0275directiveInject(b.DOCUMENT),i.\u0275\u0275directiveInject(i.NgZone))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:At,selectors:[["","crtMask",""]],inputs:{shouldShow:[0,"crtMask","shouldShow"],settings:[0,"crtMaskSettings","settings"]},features:[i.\u0275\u0275InheritDefinitionFeature]})}}class lt{static{this.\u0275fac=function(t){return new(t||lt)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:lt})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,Ut.MatProgressSpinnerModule,v.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(lt,{declarations:[Ct,At],imports:[b.CommonModule,Ut.MatProgressSpinnerModule,v.TranslateModule],exports:[Ct,At]})})();var C=m(86464),Ot=m(74975);const jn=new i.InjectionToken("DataServiceUri"),_u="system-settings-cache";let Mt=class Kl extends Ot.S{constructor(e,t,n,s){super(),this.httpClient=e,this._cacheManager=n,this._measurePerformanceService=s,this._sysSettingsInfo=new Map,this._sysSettingsValuesCache=new Map,this._sysSettingsChanged$=new u.Subject,this.sysSettingsChanged$=this._sysSettingsChanged$.asObservable(),this._serviceGetSysSettingsEndpoint=`${t}/QuerySysSettings`,this._serviceSaveSysSettingsEndpoint=`${t}/PostSysSettingsValues`,this._servicePreloadSysSettingsEndpoint=`${t}/PreloadSysSettings`}_removeNotActualSettingsValues(e){e.forEach(([t,n])=>{this._getIsSysSettingCached(t)&&this._getCacheableSysSetting(t).dataValueType===C.r.Lookup&&this._sysSettingsValuesCache.delete(t)})}_getSysSettingsRequestAfterUpdate(e){const t=e.filter(n=>!this._sysSettingsInfo.has(n[0]));return t.length===0?(0,u.of)(null):this.getByCodes(t.map(n=>n[0]))}_updateCache(e,t){const n=Object.entries(e??{}).filter(s=>t.saveResult[s[0]]);return n.filter(([s,r])=>this._sysSettingsInfo.has(s)).filter(([s,r])=>this._getIsSysSettingCacheable(s)).forEach(([s,r])=>{this._sysSettingsValuesCache.set(s,{value:r})}),this._getSysSettingsRequestAfterUpdate(n).pipe((0,c.map)(()=>t),(0,c.tap)(()=>{this._removeNotActualSettingsValues(n)}),(0,c.tap)(()=>{if(n.length>0){const s=n.map(r=>r[0]);this._sysSettingsChanged$.next(s)}}))}_getIsSysSettingCacheable(e){return this._sysSettingsInfo.get(e)?.isCacheable??!1}_getIsSysSettingCached(e){return this._getIsSysSettingCacheable(e)&&this._sysSettingsValuesCache.has(e)}_getCacheableSysSetting(e){const t=this._sysSettingsInfo.get(e);if(t&&t.isCacheable){const n=this._sysSettingsValuesCache.get(e);return{code:t.code,dataValueType:t.dataValueType,id:t.id,isCacheable:t.isCacheable,name:t.name,value:n.value,displayValue:n.displayValue}}return null}_setSysSettingInfo(e){this._sysSettingsInfo.set(e.code,{code:e.code,dataValueType:e.dataValueType,id:e.id,isCacheable:e.isCacheable,name:e.name})}_setSysSettingDetails(e){this._setSysSettingInfo(e),e?.isCacheable&&this._sysSettingsValuesCache.set(e.code,{displayValue:e.displayValue,value:e.value,code:e.code,dataValueTypeName:e.dataValueType,isCacheable:e.isCacheable})}_requestSysSettings(e){return this.httpClient.post(this._serviceGetSysSettingsEndpoint,{sysSettingsNameCollection:e}).pipe((0,c.share)(),(0,c.tap)(t=>{e.forEach(n=>{const s=t.values[n];s&&this._setSysSettingDetails(s)})}))}_getResponseWithCachedSysSettings(e,t){return t.filter(s=>this._getIsSysSettingCached(s)).map(s=>this._getCacheableSysSetting(s)).forEach(s=>{e.values[s.code]=s}),e}_createEmptySysSettingDetailByCode(e){return{code:e,value:null,isCacheable:!0}}_updateNotFoundSettingDetails(e){return e.notFoundSettings?.forEach(t=>{const n=this._createEmptySysSettingDetailByCode(t);this._setSysSettingDetails(n),e.values[t]=n}),e}getByCodes(e){if(!e||e.length===0)return(0,u.of)({success:!0,values:{}});const t=e.filter(n=>!this._getIsSysSettingCached(n));return t.length===0?(0,u.of)(this._getResponseWithCachedSysSettings({success:!0,values:{}},e)):this._requestSysSettings(t).pipe((0,c.map)(n=>this._getResponseWithCachedSysSettings(n,e)),(0,c.map)(n=>this._updateNotFoundSettingDetails(n)))}getByCode(e){return this.getByCodes([e]).pipe((0,c.map)(t=>t.values[e]))}getValueByCode(e,t){return this.getByCode(e).pipe((0,c.map)(n=>{const s=n?.value;return!(s==null||s==="")||t===void 0?s:t}),(0,u.catchError)(()=>(0,u.of)(t)))}updateMany(e,t=!1){const n={};return e.forEach(s=>n[s.code]=s.value),this.httpClient.post(this._serviceSaveSysSettingsEndpoint,{sysSettingsValues:n,isPersonal:t}).pipe((0,c.mergeMap)(s=>this._updateCache(n,s)),(0,c.share)())}update(e,t=!1){return this.updateMany([e],t)}preload(){if(this._preloadedSysSettings$)return this._preloadedSysSettings$;const e=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),t=this.httpClient.post(this._servicePreloadSysSettingsEndpoint,{},{headers:e}).pipe((0,c.map)(n=>Object.values(n.values).map(s=>({key:s.code,value:s}))));return this._preloadedSysSettings$=this._cacheManager.executeWithBulkCache(_u,t).pipe(this._measurePerformanceService.measure$("SysSettingsService: preload sys settings with cache bulk"),(0,c.tap)(n=>{n.forEach(({value:s})=>{s.isCacheable=!0,this._setSysSettingDetails(s)})}),(0,c.map)(()=>Object.fromEntries(this._sysSettingsValuesCache.entries())),(0,u.shareReplay)({bufferSize:1,refCount:!1})),this._preloadedSysSettings$}static{this.\u0275fac=function(t){return new(t||Kl)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(jn),i.\u0275\u0275inject(mt.G),i.\u0275\u0275inject(Ie.g))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Kl,factory:Kl.\u0275fac,providedIn:"root"})}};Mt=(0,p.__decorate)([(0,P.op)({requestType:"crt.SysSettingsService"}),(0,p.__metadata)("design:paramtypes",[E.HttpClient,String,mt.G,Ie.g])],Mt);function yu(a){return()=>(0,u.lastValueFrom)(a.loadFeatureStates(),{defaultValue:null})}const Cu={provide:i.APP_INITIALIZER,useFactory:yu,deps:[hn],multi:!0};var S=m(73308),A=m(6530);class x extends Error{constructor(){super("Next handler already specified")}}class w{constructor(){this._refs=new Set,this.lazyLoadingDisabled=!1}static{this._globalInstancePath="creatio._lazyModulesManager"}static get instance(){if(!this._instance){let e=(0,T.get)(window,this._globalInstancePath);e||(e=new this,(0,T.set)(window,this._globalInstancePath,e)),this._instance=e}return this._instance}add(e){this._refs.add(e)}size(){return this._refs.size}loadAll(){return Promise.all(Array.from(this._refs).map(e=>e.loadAndBootstrap()))}clear(){this._refs.clear()}}var j;(function(a){a[a.Schema=0]="Schema",a[a.Remote=1]="Remote",a[a.Host=2]="Host"})(j||(j={}));const V=window;class ce{constructor(){this.store={typeInfos:new Map}}static{this._prefix="creatio.registry."}static get store(){if(!this._instance){let e=(0,T.get)(V,this._prefix+this.registryKey);e||(e=new this,(0,T.set)(V,this._prefix+this.registryKey,e)),this._instance=e}return this._instance.store}}class ye extends ce{static{this.registryKey="pkgTopology"}static get items(){return this.store.typeInfos}static get(e){const t=this.items.get(e);if(t===void 0)throw new Error(`Package with name ${e} not found in topology`);return t}}class Pt{constructor(e){this._request=e;const t=[...this._request.scopes??[]].reverse().map((n,s)=>[n,s]);this._scopesOrder=Object.fromEntries(t)}_getOrderByScopes(e){if(!e.scopes)return Number.MAX_VALUE;const t=e.scopes.filter(n=>n in this._scopesOrder).map(n=>this._scopesOrder[n]);return Math.min(...t)}_getOrderByPkgTopology(e){return e.source.type===j.Host?Number.MAX_VALUE:ye.get(e.source.packageName)}compare(e,t){const n=this._getOrderByScopes(e),s=this._getOrderByScopes(t);let r=n-s;if(r)return r;const o=this._getOrderByPkgTopology(e),l=this._getOrderByPkgTopology(t);return r=o-l,r||(r=e.source.type-t.source.type,r)}}var Ja=m(4930);const li="crtInput:",Oc="crtOutput:",gp="crtValidationInput:",Gg="crtInject:",fp="module",_p="viewElement",yp="mobileViewElement",Mu="interfaceDesignerItem",Iu="mobileInterfaceDesignerItem",Cp="requestHandler",Mp="designTimeViewElement",Ip="validator",bp="converter";function Qg(a,e){Reflect.defineMetadata(fp,a,e)}function Jg(a){const e=Reflect.getMetadata(fp,a);if(!e)throw new Error(`Module metadata was not found on '${a.name}' class`);return e}function qg(a,e){Reflect.defineMetadata(_p,a,e)}function Kg(a,e){Reflect.defineMetadata(yp,a,e)}function R1(a){return Reflect.getMetadata(_p,a)}function L1(a){return Reflect.getMetadata(yp,a)}function V1(a,e){Reflect.defineMetadata(Ip,a,e)}function z1(a){const e=Reflect.getOwnMetadata(Ip,a);if(!e)throw new Error(`Validator metadata was not found on '${a.name}' class`);return e}function Xg(a,e){Reflect.defineMetadata(bp,a,e)}function F1(a){const e=Reflect.getOwnMetadata(bp,a);if(!e)throw new Error(`Converter metadata was not found on '${a.name}' class`);return e}function B1(a,e){Reflect.defineMetadata(Mu,a,e)}function U1(a,e){Reflect.defineMetadata(Iu,a,e)}function H1(a){return Reflect.getOwnMetadata(Mu,a)}function Y1(a){return Reflect.getOwnMetadata(Iu,a)}function Z1(a,e){Reflect.defineMetadata(Mp,a,e)}function W1(a){const e=Reflect.getOwnMetadata(Mp,a);if(!e)throw new Error(`Design time view element metadata was not found on '${a.name}' class`);return e}function $1(a){return Reflect.hasOwnMetadata(Mu,a)}function G1(a){return Reflect.hasOwnMetadata(Iu,a)}function ef(a,e){Reflect.defineMetadata(Cp,a,e)}function Q1(a){const e=Reflect.getMetadata(Cp,a);if(!e)throw new Error(`Request handler metadata was not found on '${a.name}' class`);return e}function J1(a){const e=Reflect.getMetadata("requestType",a);if(!e)throw new Error(`requestType was not found on '${a.name}' class`);return{requestType:e,typeRef:a}}function tf(a){const t=Reflect.getMetadataKeys(a).filter(n=>n.startsWith(li));return Object.fromEntries(t.map(n=>{const s=Reflect.getMetadata(n,a);return[n.replace(li,""),s]}))}function nf(a){const t=Reflect.getMetadataKeys(a).filter(n=>n.startsWith(Oc));return Object.fromEntries(t.map(n=>{const s=Reflect.getMetadata(n,a);return[n.replace(Oc,""),s]}))}function sf(a){const t=Reflect.getMetadataKeys(a).filter(n=>n.startsWith(gp));return Object.fromEntries(t.map(n=>{const s=Reflect.getMetadata(n,a);return[n.replace(gp,""),s]}))}function af(a){const t=Reflect.getOwnMetadataKeys(a).filter(n=>n.startsWith(crtInjectPrefix));return Object.fromEntries(t.map(n=>{const s=Number(n.replace(crtInjectPrefix,"")),r=Reflect.getMetadata(n,a);return[s,r]}))}function rf(a){const e=a.prototype?Object.getPrototypeOf(a.prototype):null;return e?e.constructor:null}function of(a){const e=Reflect.getOwnMetadata("design:paramtypes",a);if(!e){if(a.length>0)throw new Error(`Dependency Injection error. Cannot read dependencies of class '${a.name}'. Please make sure class '${a.name}' has decorator and 'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.`);const n=rf(a);return n&&n!==Object?of(n):[]}const t=af(a);return Object.entries(t).forEach(([n,s])=>e[n]=s),e}function cf(a){console.error("Not supported: lazy modules should not be dependent on other lazy modules. Some functions may not work correctly",a)}function Sp(a){if(!Array.isArray(a))return[];if(a.length===0)return[];const e=new Set,t=[...a];for(;t.length>0;){const n=t.pop();if(!n||e.has(n))continue;if(typeof n!="function"){cf(n);continue}e.add(n);const s=Jg(n)?.includes||[];t.push(...s)}return[...e]}function vp(a,e){return a?.length?a.some(t=>e?.includes(t)):!0}const bu=window;bu.creatio??={},bu.creatio._bootstrappedCrtModules??=new Map;const Tp=bu.creatio._bootstrappedCrtModules;function Su(a){Tp.forEach((e,t)=>{e.root&&a(e,t)})}function q1(a){Su(e=>e.options?.onContextCreate?.(a))}function xp(a){Su(e=>e.options?.onContextUpdate?.(a))}function lf(a){Su(e=>e.options?.onContextDestroy?.(a))}class uf{constructor(){var e=this;this._handlers=[],this._requestListeners=new Map,this._handlersCache=new Map,this._handlersScopesByContextId=new Map,this.handlerChain$={process:function(){var t=(0,S.A)(function*(n){let s;if(e._hasCacheHandler(n))s=e._getCacheHandler(n);else{const r=e._getMatchedHandlers(n);w.instance.lazyLoadingDisabled||(yield e._loadLazyHandlers(n,r)),s=e._buildHandlersChain(n,r)}return e._requestListeners.forEach(r=>r?.(n)),s?.handle(n)});return function(s){return t.apply(this,arguments)}}(),register:t=>(this._handlersCache.delete(t.requestType),this._handlers.push(t),()=>{const n=this._handlers.indexOf(t);n>-1?(this._handlers.splice(n,1),this._handlersCache.delete(t.requestType)):console.warn(`${t?.requestType} not found to unsubscribe`)}),update:t=>{const n=this._handlers.find(s=>s.type===t.type);n&&(n.createHandler=t.createHandler)},subscribe:(t,n)=>{if(!t)return()=>{};const s=(0,A.qv)(),r=o=>{(!n||o.$context===n)&&t(o)};return this._requestListeners.set(s,r),()=>this._requestListeners.delete(s)}}}clearContextedHandlersCache(e){return(this._handlersScopesByContextId.get(e)??[]).every(({requestType:n,scope:s})=>this._handlersCache.get(n)?.delete(s))}clear(){this._handlers.splice(0),this._requestListeners.clear(),this._handlersCache.clear(),this._handlersScopesByContextId.clear()}_getCacheHandler(e){const t=this._handlersCache.get(e.type),n=this._getCacheScopesKey(e);return t.get(n)}_hasCacheHandler(e){const t=this._handlersCache.get(e.type),n=this._getCacheScopesKey(e);return t&&t.has(n)}_getCacheScopesKey(e){const t=this._getInjectionContext(e?.$context)?.id??"";return(e.scopes||[""]).join("_").concat(t)}_getInjectionContext(e){return e?._injectionContext||e?.parent&&this._getInjectionContext(e.parent)}_setContextedScopes(e,t){const n=this._getInjectionContext(e?.$context)?.id,s=this._handlersScopesByContextId.has(n)?this._handlersScopesByContextId.get(n):[];s.push({requestType:e.type,scope:t}),this._handlersScopesByContextId.set(n,s)}_setCacheHandler(e,t){const n=this._handlersCache.has(e.type)?this._handlersCache.get(e.type):new Map,s=this._getCacheScopesKey(e);n.set(s,t),this._getInjectionContext(e?.$context)?.id&&this._setContextedScopes(e,s),this._handlersCache.set(e.type,n)}_isRequestHandler(e){return typeof e.handle=="function"&&typeof e.setNext=="function"}_checkHandlerInstanceOf(e){if(!this._isRequestHandler(e))throw new Error('Handler should implement "BaseRequestHandler"')}_loadLazyHandlers(e,t){var n=this;return(0,S.A)(function*(){const s=new Set;t.forEach(l=>{l.lazy&&!l.createHandler&&s.add(l.lazyModuleRef)});const r=[...s];yield Promise.all(r.map(l=>l.loadAndBootstrap()));const o=n._getInjectionContext(e?.$context);if(o&&s.size){const l=yield Sp(r.map(d=>d.typeRef));for(const d of l)o.addLazyModule(d);xp(o)}})()}_getMatchedHandlers(e){return this._handlers.filter(t=>t.requestType!==e.type?!1:vp(t.scopes,e.scopes))}_buildHandlersChain(e,t){const n=new Pt(e);t.sort((l,d)=>n.compare(l,d));const s=this._getInjectionContext(e?.$context),r=t.map(l=>l.createHandler.call(l,s));r.forEach(l=>this._checkHandlerInstanceOf(l)),this._joinHandlersInChain(r);const o=r[0];return this._setCacheHandler(e,o),o}_joinHandlersInChain(e){for(let t=0;t<e.length-1;t++)try{e[t].setNext(e[t+1])}catch(n){throw n instanceof x?new Error("Handler factory should return new instance of BaseRequestHandler class or its subclass (next handler should not be specified)"):n}}}const wp=window;class Ae{get _chain(){return wp.handlerChain}set _chain(e){wp.handlerChain=e}static get instance(){return Ae._instance||(Ae._instance=new Ae)}constructor(){this._chain||this._createGlobalHandlerChain()}_createGlobalHandlerChain(){this._chain=new uf}clearContextedHandlersCache(e){return this._chain.clearContextedHandlersCache(e)}register(e){return this._chain.handlerChain$.register(e)}update(e){return this._chain.handlerChain$.update(e)}process(e){return this._chain.handlerChain$.process(e)}subscribe(e,t){return this._chain.handlerChain$.subscribe(e,t)}clear(){this._chain.clear()}}function It(a){return function(e,t,n){const s=function(...r){const o=Ae.instance.process({type:a?.requestType?a.requestType:this.requestType,method:a?.methodName?a.methodName:t,args:r});return a?.omitResult?Promise.resolve(void 0):o};n?n.value=s:e[t]=s}}class qa{}class kt extends qa{constructor(){super(...arguments),this.requestType="crt.SysSettingsService"}}(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],kt.prototype,"getByCodes",void 0),(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],kt.prototype,"getByCode",void 0),(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],kt.prototype,"update",void 0),(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],kt.prototype,"updateMany",void 0);class Rn extends qa{constructor(){super(...arguments),this.requestType="crt.FeatureService"}}(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],Rn.prototype,"getFeatureState",void 0),(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],Rn.prototype,"getFeaturesState",void 0);const df="DataService/json/SyncReply",hf="DataService/ssp/json/SyncReply",Np={provide:jn,useFactory:a=>a?.isSSP?hf:df,deps:[[new i.Optional,L.oq]]},Ep=new i.InjectionToken("TransactionFactory");class xe{static{this.\u0275fac=function(t){return new(t||xe)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:xe,factory:xe.\u0275fac})}}class Pc extends Error{constructor(e){super(`Argument with name '${e}' is empty.`)}}class Ka extends Error{constructor(e){super(`Argument with name '${e}' is out of range.`)}}class q{static checkArgumentEmpty(e,t){if(t==null)throw new Pc(e)}static checkArrayEmpty(e,t){if(q.checkArgumentEmpty(e,t),t.length===0)throw new Pc(e)}static checkStringIsNotEmpty(e,t){if(this.checkArgumentEmpty(e,t),t==="")throw new Pc(e);return t}static checkArgumentOutOfRange(e,t,n){if(n.begin&&t<n.begin)throw new Ka(e);if(n.end&&t>n.end)throw new Ka(e)}static checkEnumOutOfRange(e,t,n){if(!n||!Object.values(n).includes(t))throw new Ka(e)}}function pf(a){return a=a||new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate())}function Dp(a){return a=a||new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999)}function Ap(a){if(!a)return null;function e(){throw new Error(`String "${a}" is not a valid serialized date.`)}typeof a!="string"&&e();const[t,n]=a.split("T");if(n&&(n[n.length-1]==="Z"||n.indexOf("+")!==-1||n.indexOf("-")!==-1)){const r=Date.parse(a);return isNaN(r)&&e(),new Date(r)}try{const[r,o,l]=t.split("-"),[d,h,f]=n.split(":"),[I,O]=f.split(".");return new Date(parseInt(r),parseInt(o)-1,parseInt(l),parseInt(d),parseInt(h),parseInt(I),parseInt(O))}catch{e()}}function vu(a,e){e==null&&(e=0),a.setSeconds(a.getSeconds()+e*3600)}function Tu(a,e,t){const n=t||{hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat(e.sysCultureName,n).format(a)}function K1(a,e,t){const n=Math.abs(e.getTime()-a.getTime()),s=Math.floor(n/(1e3*60*60)),r=Math.floor(n%(1e3*60*60)/(1e3*60)),o=Math.floor(n%(1e3*60)/1e3),l={hours:s,minutes:r,seconds:o};return new Intl.DurationFormat(t.sysCultureName).format(l)}class ts{_getEntitySchemaColumnsDataValueTypesMap(e){return e.columns.reduce((t,n)=>(t[n.name]=n.dataValueType,t),{})}_getEntityColumnsDataValueTypesMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=e[n].dataValueType,t),{})}_parseRawColumnValue(e,t){switch(t){case C.r.Date:case C.r.Time:case C.r.DateTime:return Ap(e);default:return e}}_parseRawEntityObject(e,t){const n={};return Object.keys(e).forEach(s=>{const r=e[s];n[s]=t[s]?this._parseRawColumnValue(r,t[s]):r}),n}deserializeEntity(e,t){q.checkArgumentEmpty("columnsConfig",e),q.checkArgumentEmpty("rawEntity",t);const n=this._getEntityColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,n)}deserializeEntities(e,t){q.checkArgumentEmpty("columnsConfig",e),q.checkArgumentEmpty("rawEntities",t);const n=this._getEntityColumnsDataValueTypesMap(e);return t.map(s=>this._parseRawEntityObject(s,n))}deserializeEntitySchemaRecord(e,t){q.checkArgumentEmpty("entitySchema",e),q.checkArgumentEmpty("rawEntities",t);const n=this._getEntitySchemaColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,n)}deserializeEntitySchemaRecords(e,t){q.checkArgumentEmpty("entitySchema",e),q.checkArgumentEmpty("rawEntities",t);const n=this._getEntitySchemaColumnsDataValueTypesMap(e);return t.map(s=>this._parseRawEntityObject(s,n))}static{this.\u0275fac=function(t){return new(t||ts)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ts,factory:ts.\u0275fac,providedIn:"root"})}}var be=m(78240);class kc{get queryDtoType(){return this._queryDtoType}constructor(e,t){this.operationType=e,this.rootSchemaName=t,q.checkArgumentEmpty("_operationType",e),q.checkArgumentEmpty("_rootSchemaName",t)}getMetadata(){return(0,be.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}(0,p.__decorate)([(0,be.Exclude)(),(0,p.__metadata)("design:type",String)],kc.prototype,"_queryDtoType",void 0),(0,p.__decorate)([(0,be.Expose)({name:"__type"}),(0,p.__metadata)("design:type",String),(0,p.__metadata)("design:paramtypes",[])],kc.prototype,"queryDtoType",null);class Xa{static{this._instanceOfKey="devkit_BaseFilter"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isEnabled=!0,this.trimDateTimeParameterToDate=!1,this.filterType=e}static fromJson(e,t,n){throw new Error(`fromJson not supported on filter type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,be.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,be.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class Ht extends Xa{static{this._instanceOfKey="devkit_SingleFilter"}static get _instanceOfKeys(){return[...Xa._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(e),this.comparisonType=t,this.leftExpression=n?.clone()}toJson(){return{...super.toJson(),leftExpression:this.serializeItem(this.leftExpression)}}_getUsedColumns(){return this.leftExpression._getUsedColumns()}}var Ce;(function(a){a[a.None=0]="None",a[a.Compare=1]="Compare",a[a.IsNull=2]="IsNull",a[a.Between=3]="Between",a[a.In=4]="In",a[a.Exists=5]="Exists",a[a.FilterGroup=6]="FilterGroup"})(Ce||(Ce={}));var ee;(function(a){a[a.Between=0]="Between",a[a.Contain=11]="Contain",a[a.End_with=13]="End_with",a[a.Equal=3]="Equal",a[a.Exists=15]="Exists",a[a.Greater=7]="Greater",a[a.Greater_or_equal=8]="Greater_or_equal",a[a.Is_not_null=2]="Is_not_null",a[a.Is_null=1]="Is_null",a[a.Less=5]="Less",a[a.Less_or_equal=6]="Less_or_equal",a[a.Not_contain=12]="Not_contain",a[a.Not_end_with=14]="Not_end_with",a[a.Not_equal=4]="Not_equal",a[a.Not_exists=16]="Not_exists",a[a.Not_start_with=10]="Not_start_with",a[a.Start_with=9]="Start_with"})(ee||(ee={}));class er extends Ht{static{this._instanceOfKey="devkit_BetweenFilter"}static get _instanceOfKeys(){return[...Ht._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(Ce.Between,ee.Between,e),this.filterType=Ce.Between,this.rightLessExpression=t?.clone(),this.rightGreaterExpression=n?.clone()}static fromJson(e,t,n){return new er(n.fromJson(e.leftExpression,t),n.fromJson(e.rightLessExpression,t),n.fromJson(e.rightGreaterExpression,t))}clone(){const e=new er(this.leftExpression,this.rightLessExpression,this.rightGreaterExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightLessExpression:this.serializeItem(this.rightLessExpression),rightGreaterExpression:this.serializeItem(this.rightGreaterExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightLessExpression._getUsedColumns(),...this.rightGreaterExpression._getUsedColumns()]}}class bt extends Ht{static{this._instanceOfKey="devkit_CompareFilter"}static get _instanceOfKeys(){return[...Ht._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(Ce.Compare,e,t),this.filterType=Ce.Compare,this.rightExpression=n?.clone()}static fromJson(e,t,n){return new bt(e.comparisonType,n.fromJson(e.leftExpression,t),n.fromJson(e.rightExpression,t))}clone(){const e=new bt(this.comparisonType,this.leftExpression,this.rightExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpression:this.serializeItem(this.rightExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightExpression._getUsedColumns()]}}class ui extends Ht{static{this._instanceOfKey="devkit_ExistsFilter"}static get _instanceOfKeys(){return[...Ht._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n=ee.Exists,s=!0){super(Ce.Exists,n,e),this.filterType=Ce.Exists,this.subFilters=t?.clone(),this.isAggregative=s}static fromJson(e,t,n){const s=n.fromJson(e.leftExpression,t),r=e.subFilters;let o;return r&&(o=t.fromJson(e.subFilters)),new ui(s,o,e.comparisonType,e.isAggregative)}clone(){const e=new ui(this.leftExpression,this.subFilters,this.comparisonType,this.isAggregative);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[...super._getUsedColumns(),...this.subFilters?._getUsedColumns()??[]]}}class gn extends Ht{static{this._instanceOfKey="devkit_InFilter"}static get _instanceOfKeys(){return[...Ht._instanceOfKeys,this._instanceOfKey]}constructor(e,t,n){super(Ce.In,e,t),this.filterType=Ce.In,this.rightExpressions=n.map(s=>s?.clone())??[]}static fromJson(e,t,n){const s=e.rightExpressions??[];return new gn(e.comparisonType,n.fromJson(e.leftExpression,t),s.map(r=>n.fromJson(r,t)))}clone(){const e=new gn(this.comparisonType,this.leftExpression,this.rightExpressions);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpressions:this.rightExpressions.map(e=>this.serializeItem(e))}}_getUsedColumns(){const e=this.rightExpressions.map(t=>t._getUsedColumns()).flat();return[...super._getUsedColumns(),...e]}}class fn extends Ht{static{this._instanceOfKey="devkit_IsNullFilter"}static get _instanceOfKeys(){return[...Ht._instanceOfKeys,this._instanceOfKey]}constructor(e,t){[ee.Is_null,ee.Is_not_null].includes(e)||console.warn(`Invalid comparison type: ${ee[e]} in IsNullFilter.`),super(Ce.IsNull,fn._getComparisonType(e),t),this.filterType=Ce.IsNull,this.isNull=!0,this.isNull=this.comparisonType===ee.Is_null}static _getComparisonType(e){return e===ee.Is_not_null?e:ee.Is_null}static fromJson(e,t,n){return new fn(fn._getComparisonType(e.comparisonType),n.fromJson(e.leftExpression,t))}clone(){const e=new fn(fn._getComparisonType(this.comparisonType),this.leftExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}}var di;(function(a){a[a.And=0]="And",a[a.Or=1]="Or"})(di||(di={}));var ns;(function(a){a[a.None=0]="None",a[a.CurrentUser=1]="CurrentUser",a[a.CurrentUserContact=2]="CurrentUserContact",a[a.Yesterday=3]="Yesterday",a[a.Today=4]="Today",a[a.Tomorrow=5]="Tomorrow",a[a.PreviousWeek=6]="PreviousWeek",a[a.CurrentWeek=7]="CurrentWeek",a[a.NextWeek=8]="NextWeek",a[a.PreviousMonth=9]="PreviousMonth",a[a.CurrentMonth=10]="CurrentMonth",a[a.NextMonth=11]="NextMonth",a[a.PreviousQuarter=12]="PreviousQuarter",a[a.CurrentQuarter=13]="CurrentQuarter",a[a.NextQuarter=14]="NextQuarter",a[a.PreviousHalfYear=15]="PreviousHalfYear",a[a.CurrentHalfYear=16]="CurrentHalfYear",a[a.NextHalfYear=17]="NextHalfYear",a[a.PreviousYear=18]="PreviousYear",a[a.CurrentYear=19]="CurrentYear",a[a.PreviousHour=20]="PreviousHour",a[a.CurrentHour=21]="CurrentHour",a[a.NextHour=22]="NextHour",a[a.NextYear=23]="NextYear",a[a.NextNDays=24]="NextNDays",a[a.PreviousNDays=25]="PreviousNDays",a[a.NextNHours=26]="NextNHours",a[a.PreviousNHours=27]="PreviousNHours",a[a.PrimaryColumn=34]="PrimaryColumn",a[a.PrimaryDisplayColumn=35]="PrimaryDisplayColumn",a[a.PrimaryImageColumn=36]="PrimaryImageColumn",a[a.DayOfYearToday=37]="DayOfYearToday",a[a.DayOfYearTodayPlusDaysOffset=38]="DayOfYearTodayPlusDaysOffset",a[a.NextNDaysOfYear=39]="NextNDaysOfYear",a[a.PreviousNDaysOfYear=40]="PreviousNDaysOfYear",a[a.PrimaryColorColumn=41]="PrimaryColorColumn"})(ns||(ns={}));var ot;(function(a){a[a.SchemaColumn=0]="SchemaColumn",a[a.Function=1]="Function",a[a.Parameter=2]="Parameter",a[a.SubQuery=3]="SubQuery",a[a.ArithmeticOperation=4]="ArithmeticOperation"})(ot||(ot={}));class Yt{static{this._instanceOfKey="devkit_BaseExpression"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isBlock=!1,this.isBlock=e?.isBlock}static fromJson(e,t,n){throw new Error(`fromJson not supported on expression type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,be.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,be.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class pe extends Yt{static{this._instanceOfKey="devkit_ColumnExpression"}static get _instanceOfKeys(){return[...Yt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ot.SchemaColumn,this.columnPath=e?.columnPath}static fromJson(e){return new pe({columnPath:e.columnPath})}clone(){return new pe(this)}_getUsedColumns(){return[{path:this.columnPath}]}}class jc extends Yt{static{this._instanceOfKey="devkit_FunctionExpression"}static get _instanceOfKeys(){return[...Yt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ot.Function}}var ut;(function(a){a[a.None=0]="None",a[a.Macros=1]="Macros",a[a.Aggregation=2]="Aggregation",a[a.DatePart=3]="DatePart",a[a.Length=4]="Length",a[a.Window=5]="Window",a[a.DateAdd=6]="DateAdd",a[a.DateDiff=7]="DateDiff"})(ut||(ut={}));class hi extends jc{static{this._instanceOfKey="devkit_MacrosFunctionExpression"}static get _instanceOfKeys(){return[...jc._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=ut.Macros,this.macrosType=e?.macrosType,this.functionArgument=e?.functionArgument}static fromJson(e,t,n){const s=t&&n&&e.functionArgument?n.fromJson(e.functionArgument,t):void 0;return new hi({functionArgument:s,macrosType:e.macrosType})}clone(){return new hi(this)}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}function mf(a){return a.getFullYear()<1970}function gf(a){const e=a.getTimezoneOffset()*6e4;return new Date(a.getTime()-e).toISOString().slice(0,-1)}function ff(a){const e=a.getFullYear(),t=tr(a.getMonth()+1),n=tr(a.getDate()),s=tr(a.getHours()),r=tr(a.getMinutes()),o=tr(a.getSeconds()),l=_f(a.getMilliseconds());return`${e}-${t}-${n}T${s}:${r}:${o}.${l}`}function tr(a){return String(a).padStart(2,"0")}function _f(a){return String(a).padStart(3,"0")}function Op(a){if(!(a instanceof Date))throw new TypeError;return mf(a)?ff(a):gf(a)}function xu(a){return`"${Op(a)}"`}class fe extends Yt{static{this._instanceOfKey="devkit_ParameterExpression"}static get _instanceOfKeys(){return[...Yt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ot.Parameter;const t=e?.value;if(t instanceof Date){const n=new Date;n.setTime(t.getTime()),this.value=n}else t?this.value=typeof t=="object"?{...t}:t:this.value=t;this.dataValueType=e?.dataValueType??C.r.Text,this.parameter={dataValueType:this.dataValueType,...this._getParameterValueMetadata()}}static fromJson(e){return new fe(e.parameter)}_convertStringToBlobArray(e){const t=[];let n=0;for(let s=0;s<e.length;s++){const r=e.charCodeAt(s);r<128?t[n++]=String.fromCharCode(r):r<2048?(t[n++]=String.fromCharCode(r>>6|192),t[n++]=String.fromCharCode(r&63|128)):(t[n++]=String.fromCharCode(r>>12|224),t[n++]=String.fromCharCode(r>>6&63|128),t[n++]=String.fromCharCode(r&63|128))}return t}_getParameterValueMetadata(){return this.dataValueType===C.r.Blob?{arrayValue:this.value?this._convertStringToBlobArray(this.value):[]}:this.value instanceof Date?{value:xu(this.value)}:{value:this.value}}clone(){return new fe(this)}_getUsedColumns(){return[]}}(0,p.__decorate)([(0,be.Exclude)(),(0,p.__metadata)("design:type",Object)],fe.prototype,"value",void 0),(0,p.__decorate)([(0,be.Exclude)(),(0,p.__metadata)("design:type",Number)],fe.prototype,"dataValueType",void 0);class Ve extends Xa{static{this._instanceOfKey="devkit_FilterGroup"}static get _instanceOfKeys(){return[...Xa._instanceOfKeys,this._instanceOfKey]}get items(){const e={};return this.filters.forEach((t,n)=>{e[n]=this.serializeItem(t)}),e}constructor(e=di.And,t){super(Ce.FilterGroup),this.filterType=Ce.FilterGroup,this.filters=new Map,this.logicalOperation=e,this.rootSchemaName=t}static fromJson(e,t){const n=e.logicalOperation,s=new Ve(n||di.And,e.rootSchemaName);return Object.entries(e.items).forEach(([r,o])=>{s.add(t.fromJson(o),r)}),s}toJson(){const e={};return e.filterType=this.filterType,e.isEnabled=this.isEnabled,e.logicalOperation=this.logicalOperation,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e.items=this.items,this.rootSchemaName&&(e.rootSchemaName=this.rootSchemaName),e}_createParameterValueExpressions(e){return e.map(t=>new fe({value:t}))}getItemByIndex(e){return this.items[Object.keys(this.items)[e]]}addSchemaColumnFilterWithParameter(e,t,n,s){const r=new pe({columnPath:t}),o=new fe({value:n}),l=new bt(e,r,o);this.add(l,s)}addSchemaColumnInFilterWithParameters(e,t,n,s){const r=new pe({columnPath:t}),o=this._createParameterValueExpressions(n),l=new gn(e,r,o);this.add(l,s)}addPrimarySchemaColumnInFilter(e,t){const n=new hi({macrosType:ns.PrimaryColumn}),s=this._createParameterValueExpressions(e),r=new gn(ee.Equal,n,s);this.add(r,t)}addSchemaColumnIsNullFilter(e,t){const n=new pe({columnPath:e}),s=new fn(ee.Is_null,n);this.add(s,t)}addSchemaColumnIsNotNullFilter(e,t){const n=new pe({columnPath:e}),s=new fn(ee.Is_not_null,n);this.add(s,t)}addSchemaColumnBetweenFilterWithParameters(e,t,n,s){const r=new pe({columnPath:e}),o=new fe({value:t}),l=new fe({value:n}),d=new er(r,o,l);this.add(d,s)}addExistsFilter(e,t,n){const s=new pe({columnPath:e}),r=new ui(s,t);this.add(r,n)}addNotExistsFilter(e,t,n){const s=new pe({columnPath:e}),r=new ui(s,t,ee.Not_exists);this.add(r,n)}add(e,t){q.checkArgumentEmpty("filter",e);const n=t||(0,A.qv)();this.filters.set(n,e)}clone(){const e=new Ve(this.logicalOperation,this.rootSchemaName);return this.filters.forEach((t,n)=>{e.filters.set(n,t.clone())}),e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}_getUsedColumns(){const e=[];return this.filters.forEach(t=>{let n=t._getUsedColumns?t._getUsedColumns():[];n=n.map(s=>({path:s.path,schemaName:s.schemaName??this.rootSchemaName})),e.push(...n)}),e}}(0,p.__decorate)([(0,be.Exclude)(),(0,p.__metadata)("design:type",Object)],Ve.prototype,"filters",void 0),(0,p.__decorate)([(0,be.Expose)(),(0,p.__metadata)("design:type",Object),(0,p.__metadata)("design:paramtypes",[])],Ve.prototype,"items",null);class Rc extends kc{constructor(e,t){super(e,t),this.filters=new Ve}clearFilters(){this.filters.filters.clear()}getMetadata(){return{...super.getMetadata(),filters:this.filters.toJson()}}_getUsedColumns(){const e=this.filters._getUsedColumns();return e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),e}}(0,p.__decorate)([(0,be.Exclude)(),(0,p.__metadata)("design:type",Object)],Rc.prototype,"filters",void 0);var is;(function(a){a[a.Select=0]="Select",a[a.Insert=1]="Insert",a[a.Update=2]="Update",a[a.Delete=3]="Delete"})(is||(is={}));class yf extends Error{constructor(e){super(`Item with key '${e}' does not exist.`)}}var Qe;(function(a){a[a.None=0]="None",a[a.Asc=1]="Asc",a[a.Desc=2]="Desc"})(Qe||(Qe={}));class _n{constructor(e){this.orderDirection=Qe.None,this.orderPosition=-1,this.isVisible=!0,this.expression=e}withOrdering(e,t){return q.checkArgumentEmpty("orderDirection",e),q.checkArgumentEmpty("orderPosition",t),q.checkArgumentOutOfRange("orderPosition",t,{begin:-1}),this.orderDirection=e,this.orderPosition=t,this}withOptions(e){return q.checkArgumentEmpty("options",e),this.isVisible=e.isVisible??!0,this}withCaption(e){return q.checkArgumentEmpty("caption",e),this.caption=e,this}_getUsedColumns(){return this.expression._getUsedColumns()}toJson(){return(0,be.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class Cf extends _n{constructor(e){super(new pe({columnPath:e}))}}class nr extends Yt{static{this._instanceOfKey="devkit_SubQueryExpression"}static get _instanceOfKeys(){return[...Yt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ot.SubQuery,this.columnPath=e?.columnPath;const t=e?.subFilters;typeof t?.clone=="function"?this.subFilters=t.clone():t?(this.subFilters=new Ve(t.logicalOperation,t.rootSchemaName),this.subFilters.isEnabled=t.isEnabled,Object.entries(t.items).forEach(([n,s])=>{this.subFilters.add(s,n)})):this.subFilters=t,this.subOrderDirection=e.subOrderDirection,this.subOrderColumn=e.subOrderColumn}static fromJson(e,t){return new nr({columnPath:e.columnPath,subFilters:t.fromJson(e.subFilters),subOrderDirection:e.subOrderDirection,subOrderColumn:e.subOrderColumn})}clone(){return new nr(this)}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[{path:this.columnPath},...this.subFilters?._getUsedColumns()??[]]}}class ir extends nr{static{this._instanceOfKey="devkit_AggregationSubQueryExpression"}static get _instanceOfKeys(){return[...nr._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.aggregationType=e?.aggregationType,this.functionType=e?.functionType}static fromJson(e,t){const n=super.fromJson(e,t);return new ir({aggregationType:e.aggregationType,functionType:e.functionType,...n})}clone(){return new ir(this)}}class Mf extends _n{constructor(e,t,n,s,r){super(new ir({aggregationType:t,columnPath:e,subFilters:n,subOrderDirection:s,subOrderColumn:r}))}}class If extends _n{constructor(e,t){super(new fe({value:e,dataValueType:t}))}}class sr extends Yt{static{this._instanceOfKey="devkit_ArithmeticExpression"}static get _instanceOfKeys(){return[...Yt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=ot.ArithmeticOperation,this.arithmeticOperation=e?.arithmeticOperation,this.leftArithmeticOperand=e?.leftArithmeticOperand.clone(),this.rightArithmeticOperand=e?.rightArithmeticOperand.clone()}static fromJson(e,t,n){const s=n?.fromJson(e.leftArithmeticOperand,t),r=n?.fromJson(e.rightArithmeticOperand,t),o={leftArithmeticOperand:s,rightArithmeticOperand:r,arithmeticOperation:e.arithmeticOperation,isBlock:e.isBlock};return new sr(o)}clone(){return new sr(this)}_getUsedColumns(){return[...this.leftArithmeticOperand._getUsedColumns(),...this.rightArithmeticOperand._getUsedColumns()]}}class bf extends _n{constructor(e,t,n){super(new sr({arithmeticOperation:e,leftArithmeticOperand:t,rightArithmeticOperand:n}))}}class Sf extends _n{constructor(e){super(new hi({macrosType:e}))}}class Ln extends jc{static{this._instanceOfKey="devkit_ArgumentFunctionExpression"}static get _instanceOfKeys(){return[...jc._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionArgument=e?.functionArgument?.clone()}toJson(){const e=super.toJson();return this.functionArgument&&(e.functionArgument=this.serializeItem(this.functionArgument)),e}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class pi extends Ln{static{this._instanceOfKey="devkit_DatePartFunctionExpression"}static get _instanceOfKeys(){return[...Ln._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=ut.DatePart,this.datePartType=e?.datePartType}static fromJson(e,t,n){const s=n?.fromJson(e.functionArgument,t),r=e.datePartType;return new pi({functionArgument:s,datePartType:r,isBlock:e.isBlock})}clone(){return new pi(this)}}class vf extends _n{constructor(e,t){super(new pi({datePartType:e,functionArgument:t}))}get datePartType(){return this.expression?.datePartType}}class ar extends Ln{static{this._instanceOfKey="devkit_AggregationFunctionExpression"}static get _instanceOfKeys(){return[...Ln._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=ut.Aggregation,this.aggregationType=e?.aggregationType,this.aggregationEvalType=e?.aggregationEvalType}static fromJson(e,t,n){const s=n?.fromJson(e.functionArgument,t),r=e.aggregationType,o=e.aggregationEvalType;return new ar({functionArgument:s,aggregationType:r,aggregationEvalType:o,isBlock:e.isBlock})}clone(){return new ar(this)}}class Tf extends _n{constructor(e,t,n){super(new ar({aggregationType:e,aggregationEvalType:t,functionArgument:n}))}}class rr extends Ln{static{this._instanceOfKey="devkit_LengthFunctionExpression"}static get _instanceOfKeys(){return[...Ln._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=ut.Length}static fromJson(e,t,n){const s=n?.fromJson(e.functionArgument,t);return new rr({functionArgument:s,isBlock:e.isBlock})}clone(){return new rr(this)}}class xf extends _n{constructor(e){super(new rr({functionArgument:e}))}}class or extends Ln{static{this._instanceOfKey="devkit_WindowFunctionExpression"}static get _instanceOfKeys(){return[...Ln._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=ut.Window}static fromJson(e,t,n){const s=n?.fromJson(e.functionArgument,t);return new or({functionArgument:s,isBlock:e.isBlock})}clone(){return new or(this)}}class wf extends _n{constructor(e){super(new or({functionArgument:e}))}}var Lc;(function(a){a[a.None=0]="None",a[a.All=1]="All",a[a.Distinct=2]="Distinct"})(Lc||(Lc={}));class Se extends Rc{constructor(e){super(is.Select,e),this._columns=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.SelectQuery",this.isDistinct=!1,this.rowCount=-1,this.rowsOffset=-1,this.useLocalization=!0,this.useRecordDeactivation=!1,this.isHierarchical=!1,this.hierarchicalMaxDepth=0,this.hierarchicalFullDataLoad=!1,this.hierarchicalColumnFiltersValue=new Ve,this._getIsPageable=()=>this.rowCount>0&&this.rowsOffset>-1}_internalAddColumn(e,t){this._columns.has(e)||this._columns.set(e,t)}getColumn(e){if(!this._columns.has(e))throw new yf(e);return this.findColumn(e)}findColumn(e){return this._columns.get(e)}getMetadata(){return{...super.getMetadata(),columns:{items:(0,be.classToPlain)(this._columns,{exposeUnsetFields:!1,excludePrefixes:["_"]})},allColumns:!1,isDistinct:this.isDistinct,ignoreDisplayValues:!1,rowCount:this.rowCount,rowsOffset:this.rowsOffset,adminUnitRoleSources:this.adminUnitRoleSources,isPageable:this._getIsPageable(),conditionalValues:this.conditionalValues?this.conditionalValues:null,isHierarchical:this.isHierarchical,hierarchicalMaxDepth:this.hierarchicalMaxDepth,hierarchicalColumnName:this.hierarchicalColumnName,hierarchicalColumnValue:this.hierarchicalColumnValue,hierarchicalFullDataLoad:this.hierarchicalFullDataLoad,useLocalization:this.useLocalization,useRecordDeactivation:this.useRecordDeactivation}}addColumn(e,t){return this._internalAddColumn(t,e),e}addSchemaColumn(e,t){q.checkArgumentEmpty("columnPath",e);const n=new Cf(e);return this._internalAddColumn(t||e,n),n}addAggregationSubQueryColumn(e,t,n,s){const r=new Mf(e,t,n.filter,n.sortByDirection,n.sortByColumn);return this._internalAddColumn(s||e,r),r}addParameterColumn(e,t,n){const s=new If(e,t);return this._internalAddColumn(n,s),s}addArithmeticColumn(e,t,n,s){const r=new bf(e,t,n);return this._internalAddColumn(s,r),r}addMacrosFunctionColumn(e,t){const n=new Sf(e);return this._internalAddColumn(t,n),n}addDatePartFunctionColumn(e,t,n){const s=new pe({columnPath:e}),r=new vf(t,s);return this._internalAddColumn(n,r),r}addAggregationFunctionColumn(e,t,n,s=Lc.None){const r=new pe({columnPath:e}),o=new Tf(t,s,r);return this._internalAddColumn(n,o),o}addLengthFunctionColumn(e,t){const n=new pe({columnPath:e}),s=new xf(n);return this._internalAddColumn(t,s),s}addWindowFunctionColumn(e,t,n,s=Lc.None){const r=new ar({aggregationType:t,aggregationEvalType:s,functionArgument:new pe({columnPath:e})}),o=new wf(r);return this._internalAddColumn(n,o),o}_getUsedColumns(){const e=[];return this._columns.forEach(t=>{e.push(...t._getUsedColumns())}),e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),[...e,...super._getUsedColumns()]}}class Nf extends Se{}class cr extends kc{constructor(e){super(is.Insert,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.InsertQuery"}get columnValues(){return{items:(0,be.classToPlain)(this._columnValues)}}addColumn(e,t,n){q.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new fe({value:t,dataValueType:n}))}}(0,p.__decorate)([(0,be.Expose)(),(0,p.__metadata)("design:type",Object),(0,p.__metadata)("design:paramtypes",[])],cr.prototype,"columnValues",null);class Vc extends Rc{constructor(e){super(is.Update,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.UpdateQuery",this.isForceUpdate=!1}get columnValues(){return{items:(0,be.classToPlain)(this._columnValues)}}addColumn(e,t,n){q.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new fe({value:t,dataValueType:n}))}}(0,p.__decorate)([(0,be.Expose)(),(0,p.__metadata)("design:type",Object),(0,p.__metadata)("design:paramtypes",[])],Vc.prototype,"columnValues",null);class wu extends Rc{constructor(e){super(is.Delete,e),this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.DeleteQuery"}}class zc extends Error{}var lr;(function(a){a[a.General=0]="General",a[a.Limited=1]="Limited"})(lr||(lr={}));var Nu;(function(a){a[a.Undefined=0]="Undefined",a[a.Filter=1]="Filter",a[a.FilterSummary=2]="FilterSummary"})(Nu||(Nu={}));var Eu;(function(a){a[a.Session=0]="Session",a[a.Workspace=1]="Workspace",a[a.Application=2]="Application"})(Eu||(Eu={}));class Ef{constructor(e=Eu.Session,t="",n=""){this._cacheLevel=e,this._cacheGroup=t,this._cacheItemName=n}getMetadata(){return{cacheLevel:this._cacheLevel,cacheGroup:this._cacheGroup,cacheItemName:this._cacheItemName}}}class ur extends Error{constructor(e){const t=e?.error?.responseStatus?.Message||e?.responseStatus?.Message||e?.message;super(t),this.errorCode=e?.error?.responseStatus?.ErrorCode}}class Pp extends Error{constructor(e){super(`Query with config
${JSON.stringify(e.getMetadata())}
finished with error.`)}}let Fc=class extends xe{constructor(e,t,n,s){super(),this._sysSettingsService=e,this._httpClient=t,this._dataServiceUri=n,this._featureService=s,this._defaultDSQueryTimeoutMs=12e4,this._defaultDebounceTime=200,this._debounceTimeSysSettingName="QueryExecutorDebounceTime",this._requests=new u.Subject,q.checkArgumentEmpty("_httpClient",t),q.checkArgumentEmpty("_dataServiceUri",n),this._transactions=new Map,this._transactions$=new Map}_getDataServiceQueryTimeout8xFeature(){return this._featureService?(0,u.from)(this._featureService.getFeatureState("EnableDataServiceQueryTimeout8x")):(0,u.of)(!1)}_getDataServiceQueryTimeout(){var e=this;return(0,S.A)(function*(){return e._sysSettingsService&&(yield e._sysSettingsService.getByCode("DataServiceQueryTimeout"))?.value||e._defaultDSQueryTimeoutMs})()}_withTimeout(e){return this._getDataServiceQueryTimeout8xFeature().pipe((0,c.switchMap)(t=>t?(0,u.from)(this._getDataServiceQueryTimeout()).pipe((0,c.switchMap)(n=>e.pipe((0,c.timeout)(n),(0,c.catchError)(s=>{throw s instanceof u.TimeoutError?new zc(s.message):s})))):e))}_executeWritableQuery(e,t){const s={...e.getMetadata(),queryKind:lr.General};return this._withTimeout(this._httpClient.post(t,s).pipe((0,c.catchError)(r=>{throw new ur(r)}),(0,c.tap)(r=>{if(!(r&&r.success))throw new Pp(e)})))}_getQueryUri(e){if(e instanceof Nf)return`${this._dataServiceUri}/SelectLocalizationQuery`;if(e instanceof Se)return`${this._dataServiceUri}/SelectQuery`;if(e instanceof cr)return`${this._dataServiceUri}/InsertQuery`;if(e instanceof Vc)return`${this._dataServiceUri}/UpdateQuery`;if(e instanceof wu)return`${this._dataServiceUri}/DeleteQuery`;throw new Error("Unsupported query type")}_getBundleSettings(){var e=this;return(0,S.A)(function*(){return e._sysSettingsService?{executionDebounceTime:(yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName])).values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime}:Promise.resolve({executionDebounceTime:e._defaultDebounceTime})})()}_prepareDebouncedResponsesStream(){if(this._responses)return;let e=0;const t=(0,c.buffer)(this._requests.pipe((0,c.switchMap)(()=>(0,u.from)(this._getBundleSettings())),(0,c.tap)(n=>e=n.executionDebounceTime),(0,c.debounceTime)(e)));this._responses=this._requests.pipe(t,(0,c.filter)(n=>!!n.length),(0,c.mergeMap)(n=>{const s=n.map(o=>o.id),r=n.map(o=>o.query);return this.executeBatchSelectQuery(r).pipe((0,c.map)(o=>s.reduce((l,d,h)=>l.set(d,o[h]),new Map)))}),(0,c.share)())}_executeThrottled(e){this._prepareDebouncedResponsesStream();const t={id:(0,A.qv)(),query:e},n=this._responses.pipe((0,c.filter)(s=>s.has(t.id)),(0,c.map)(s=>s.get(t.id)),(0,c.take)(1));return n.subscribe(),this._requests.next(t),n}_executeImmediate(e){q.checkArgumentEmpty("query",e);const t=this._getQueryUri(e),n=this._getQueryRequest(e);return this._withTimeout(this._httpClient.post(t,n).pipe((0,c.catchError)(s=>{throw new ur(s)}),(0,c.tap)(s=>{if(!s?.rows)throw new Pp(e)}),(0,c.map)(s=>this._toSelectQueryResponse(s))))}_toSelectQueryResponse(e){const t=this.getRowsFromResponse(e);return t.rowsAffected=e.rowsAffected,e.errorInfo&&(t.errorInfo=e.errorInfo),t}_getQueryRequest(e){const t=e.getMetadata();return e instanceof Se?{...t,queryKind:lr.General,serverESQCacheParameters:new Ef().getMetadata(),queryOptimize:!1,useMetrics:!1,querySource:Nu.Undefined}:{...t,queryKind:lr.General}}_getTransactionQueries(e){return this._transactions.has(e)||this._transactions.set(e,[]),this._transactions.get(e)}_executeInTransaction(e,t){q.checkArgumentEmpty("transactionId",t),this._getTransactionQueries(t).push(e);const s=new u.Subject;return this._transactions$.set(e.queryId,s),s.asObservable()}_executeBatchQuery(e){if(q.checkArgumentEmpty("config",e),q.checkArgumentEmpty("queries",e.queries),e.queries.length===0)return e.throwIfNoQueries===!0?(0,u.throwError)(()=>new Error("Queries array is empty")):(0,u.of)({hasErrors:!1,queryResults:[]});const t=`${this._dataServiceUri}/BatchQuery`,n={items:e.queries.map(s=>this._getQueryRequest(s))};return e.continueIfError!=null&&(n.continueIfError=e.continueIfError),this._withTimeout(this._httpClient.post(t,n).pipe((0,c.catchError)(s=>{throw new ur(s)}),(0,c.tap)(s=>{if(!s||s.hasErrors)throw new ur(s);for(const r of s.queryResults)if(!r?.success)throw new ur(r)})))}getRowsFromResponse(e){return e.rows}executeSelectQuery(e,t={throttled:!1},n){return n?(0,u.throwError)(()=>new Error("Not implemented")):t.throttled?this._executeThrottled(e):this._executeImmediate(e)}executeInsertQuery(e,t){return this.execute(e,t)}executeUpdateQuery(e,t){return this.execute(e,t)}executeDeleteQuery(e,t){return this.execute(e,t)}execute(e,t){if(q.checkArgumentEmpty("query",e),t)return this._executeInTransaction(e,t);const n=this._getQueryUri(e);return this._executeWritableQuery(e,n)}executeBatchSelectQuery(e){return this._executeBatchQuery({queries:e}).pipe((0,c.map)(t=>t.queryResults.map(n=>this._toSelectQueryResponse(n))))}commitTransaction(e){const t=this._getTransactionQueries(e);return this._executeBatchQuery({queries:t,continueIfError:!1,throwIfNoQueries:!0}).pipe((0,c.catchError)(n=>(t.forEach(s=>{const r=s.queryId;this._transactions$.get(r).error(n),this._transactions$.delete(r)}),(0,u.throwError)(()=>n))),(0,c.map)(n=>{const s={};return n.queryResults.forEach(r=>{const o=r.queryId,l=this._transactions$.get(o);l.next(r),l.complete(),this._transactions$.delete(o),s[o]=r}),s}),(0,c.tap)(()=>{this._transactions.delete(e)}))}rollbackTransaction(e){const t=this._getTransactionQueries(e),n={};return t.forEach(s=>{const r=s.queryId,o=this._transactions$.get(r),l={success:!1,rowsAffected:0,errorInfo:{message:"Transaction rollback",errorCode:"TransactionRollback",stackTrace:null}};n[r]=l,o.error(l),this._transactions$.delete(r)}),this._transactions.delete(e),(0,u.of)(n)}};Fc=(0,p.__decorate)([(0,p.__param)(0,(0,i.Optional)()),(0,p.__param)(2,(0,i.Inject)(jn)),(0,p.__param)(3,(0,i.Optional)()),(0,p.__metadata)("design:paramtypes",[kt,E.HttpClient,String,Rn])],Fc);let Du=class Xl extends Fc{constructor(e,t,n,s,r){super(e,t,s,r),this._entityDeserializer=n}getRowsFromResponse(e){return this._entityDeserializer.deserializeEntities(e.rowConfig,e.rows)}static{this.\u0275fac=function(t){return new(t||Xl)(i.\u0275\u0275inject(kt,8),i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(ts),i.\u0275\u0275inject(jn),i.\u0275\u0275inject(Rn,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Xl,factory:Xl.\u0275fac})}};Du=(0,p.__decorate)([(0,P.op)({requestType:"crt.DataServiceQueryExecutor"}),(0,p.__metadata)("design:paramtypes",[kt,E.HttpClient,ts,String,Rn])],Du);class kp{constructor(e,t){this._transaction=e,this._action=t,this._id=(0,A.qv)(),this._payload={},this._ready=new Promise(n=>{this._readyResolve=n,this._asyncResult=this._action(this)})}get id(){return this._id}get transactionId(){return this._transaction.id}get asyncResult(){return this._asyncResult}get ready(){return this._ready}get payload(){return this._payload}markAsReady(){this._readyResolve()}}class Df{get id(){return this._id}constructor(e){this._queryExecutor=e,this._id=(0,A.qv)(),this._transactionOperations=[]}createOperation(e){const t=new kp(this,e);return this._transactionOperations.push(t),t}createFailureOperation(e){const t=new kp(this,n=>(n.markAsReady(),Promise.reject(e)));return this._transactionOperations.push(t),t}commit(){var e=this;return(0,S.A)(function*(){yield Promise.all(e._transactionOperations.map(s=>s.ready));let t=null;try{yield(0,u.firstValueFrom)(e._queryExecutor.commitTransaction(e._id))}catch(s){t=s}const n={};for(const s of e._transactionOperations)n[s.id]=yield s.asyncResult;if(t)throw t;return n})()}rollback(){var e=this;return(0,S.A)(function*(){yield(0,u.firstValueFrom)(e._queryExecutor.rollbackTransaction(e._id))})()}}let Bc=class eu{constructor(e){this._queryExecutor=e}create(){return Promise.resolve(new Df(this._queryExecutor))}static{this.\u0275fac=function(t){return new(t||eu)(i.\u0275\u0275inject(xe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:eu,factory:eu.\u0275fac})}};Bc=(0,p.__decorate)([(0,P.op)({requestType:"crt.TransactionFactoryService"}),(0,p.__metadata)("design:paramtypes",[xe])],Bc);class Au{static{this.\u0275fac=function(t){return new(t||Au)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Au})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Np,{provide:xe,useClass:Du},{provide:Ep,useClass:Bc}]})}}class dr{static{this.\u0275fac=function(t){return new(t||dr)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:dr})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Np,{provide:xe,useFactory:(e,t,n,s)=>new Fc(e,t,n,s),deps:[[new i.Optional,kt],E.HttpClient,jn,[new i.Optional,Rn]]},{provide:Ep,useClass:Bc}]})}}class Ou{processResponse(e,t){return e.skipUnsuccessfulResponse||(t=t.pipe((0,c.tap)(n=>this.processUnsuccessfulResponse(n)))),t}processUnsuccessfulResponse(e){const{success:t,errorInfo:n}=e||{};!t&&n&&this.processErrorMessage(n.message)}handleRequest(e,t={}){let n=e;return n=this.processResponse(t,n),n.pipe((0,c.catchError)(s=>{let r;return s instanceof Error?r=s.message:(typeof s.error?.errorInfo=="object"&&(r=s.error.errorInfo.message),typeof s.error=="string"&&(r=s.error)),r||(r=JSON.stringify(s.message)),this.processErrorMessage(r),(0,u.throwError)(()=>new Error(r))}))}}var Y=m(23681),we=m(29957),ss;(function(a){a[a.Primary=0]="Primary",a[a.Secondary=1]="Secondary",a[a.Cancel=2]="Cancel",a[a.Delete=3]="Delete"})(ss||(ss={}));const Pu={caption:"ConfirmationDialog.YES",result:ss.Secondary},Af={caption:"ConfirmationDialog.NO",result:ss.Primary},X1={caption:"ConfirmationDialog.CANCEL",result:ss.Cancel},ev={caption:"ConfirmationDialog.DELETE",result:ss.Delete};function Of(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"button",6),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("mat-dialog-close",t.secondaryButton.result),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,2,t.secondaryButton.caption)," ")}}function Pf(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"button",6),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("mat-dialog-close",t.result),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,2,t.caption)," ")}}class as{constructor(e){this.data=e,this.buttons=[],e&&(this.primaryButton=e.primaryButton,this.secondaryButton=e.secondaryButton,this.message=e.message,this.buttons=e.buttons),this.buttons?.length||(this.primaryButton??=Af,this.secondaryButton??=Pu)}static{this.\u0275fac=function(t){return new(t||as)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:as,selectors:[["ts-confirmation-dialog"]],decls:9,vars:7,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngIf"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngFor","ngForOf"],["mat-button","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0)(1,"span",1),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(3,"div",2)(4,"button",3),i.\u0275\u0275text(5),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(7,Of,3,4,"button",4)(8,Pf,3,4,"button",5),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),i.\u0275\u0275advance(2),i.\u0275\u0275property("mat-dialog-close",n.primaryButton.result),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(6,5,n.primaryButton.caption)," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.secondaryButton),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.buttons))},dependencies:[b.NgForOf,b.NgIf,W.MatButton,Y.MatDialogClose,Y.MatDialogActions,Y.MatDialogContent,v.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{margin:27px 0 0!important;justify-content:flex-end}"]})}}class rs{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||rs)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:rs,selectors:[["ts-error-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","warn","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0)(1,"span",1),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(3,"div",2)(4,"button",3),i.\u0275\u0275text(5),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[W.MatButton,Y.MatDialogClose,Y.MatDialogActions,Y.MatDialogContent,v.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class os{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||os)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:os,selectors:[["ts-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0)(1,"span",1),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(3,"div",2)(4,"button",3),i.\u0275\u0275text(5),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.data==null?null:n.data.message),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[W.MatButton,Y.MatDialogClose,Y.MatDialogActions,Y.MatDialogContent,v.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class Je{constructor(e,t,n,s){this.document=e,this._ngZone=t,this._translateService=n,this.dialog=s}_stopEventPropagation(e,t){e.afterOpened().pipe((0,c.takeUntil)(t)).subscribe(n=>{const r=this.document.getElementsByClassName("cdk-overlay-container")[0];r&&r.addEventListener("click",function(o){o.stopImmediatePropagation()})})}getMessageDialogConfig(e){const t={width:"450px",panelClass:["dialog-top-border"],data:{}};if(typeof e=="string")return t.data.message=e,t;e.panelClass?.length>0&&t.panelClass.push(...e.panelClass);const n=e;return n.primaryButton&&(t.data.primaryButton=n.primaryButton),n.secondaryButton&&(t.data.secondaryButton=n.secondaryButton),n.buttons&&(t.data.buttons=n.buttons),t.data.message=n.message,t}open(e,t){return this._ngZone.run(()=>{const n=this.dialog.open(e,t),s=n.afterClosed();return this._stopEventPropagation(n,s),s})}openInfoDialog(e){return this.open(os,this.getMessageDialogConfig(e))}openErrorDialog(e){return this.open(rs,this.getMessageDialogConfig(e))}openConfirmationDialog(e){return this.open(as,this.getMessageDialogConfig(e))}openOperationPermissionsErrorDialog(e){const t=we.String.format(this._translateService.instant("OperationPermissionsErrorDialog.ErrorTemplate"),e);return this.openInfoDialog(t)}closeById(e){this.dialog.getDialogById(e)?.close()}closeAll(){this.dialog.closeAll()}hasOpenDialogs(){return!!this.dialog.openDialogs?.length}getOpenDialogs(){return this.dialog.openDialogs}static{this.\u0275fac=function(t){return new(t||Je)(i.\u0275\u0275inject(b.DOCUMENT),i.\u0275\u0275inject(i.NgZone),i.\u0275\u0275inject(v.TranslateService),i.\u0275\u0275inject(Y.MatDialog))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Je,factory:Je.\u0275fac})}}class cs extends Ou{constructor(e){super(),this._dialogService=e}processErrorMessage(e){this._dialogService.openErrorDialog(e)}static{this.\u0275fac=function(t){return new(t||cs)(i.\u0275\u0275inject(Je))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:cs,factory:cs.\u0275fac})}}const kf={provide:Ou,useClass:cs};class Uc{}const jf=new i.InjectionToken("Flag indicating that mask has startup loading animation");var ku;let hr=class tu extends rt{static{ku=this}constructor(e,t,n,s,r,o,l){super(n,s),this._appRef=e,this._injector=t,this._window=r,this.loadingAnimationVisible=o,this._maskComponentType=l,this.createMaskComponent(),this.maskComponent.isVisible=!1}static _getHtmlElement(e){const t=e;if(!t||t.rootNodes.length===0)throw new Error("Not found HTMLElement Mask");return t.rootNodes[0]}_createMaskComponentRef(){this.maskComponentRef=(0,i.createComponent)(this._maskComponentType||Ct,{environmentInjector:this._appRef.injector})}_appendMaskComponentToBody(){const e=this.maskComponentRef.hostView;this._appRef.attachView(e);const t=ku._getHtmlElement(e);this.document.body.appendChild(t)}_hideLoadingAnimation(){this._window?.dispatchEvent(new CustomEvent("hide_loading_animation"))}createMaskComponent(){this._createMaskComponentRef(),this._appendMaskComponentToBody(),this.maskComponent.isVisible=!1}showBodyMask(e){this.loadingAnimationVisible||this.show(e)}hideBodyMask(){if(this.loadingAnimationVisible){this.loadingAnimationVisible=!1,this._hideLoadingAnimation();return}this.hide()}static{this.\u0275fac=function(t){return new(t||tu)(i.\u0275\u0275inject(i.ApplicationRef),i.\u0275\u0275inject(i.Injector),i.\u0275\u0275inject(b.DOCUMENT),i.\u0275\u0275inject(i.NgZone),i.\u0275\u0275inject(P.ZP,8),i.\u0275\u0275inject(jf,8),i.\u0275\u0275inject(es,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:tu,factory:tu.\u0275fac,providedIn:"root"})}};hr=ku=(0,p.__decorate)([(0,P.op)({requestType:"crt.MaskService"}),(0,p.__metadata)("design:paramtypes",[i.ApplicationRef,i.Injector,Document,i.NgZone,Window,Boolean,i.Type])],hr);class pr extends Uc{constructor(e,t,n){super(),this._snackBar=t,this._maskService=n,this._errorHandler=new cs(e)}_handleRequestSuccess(e,t){return e.pipe((0,c.tap)(n=>{const{success:s}=n||{};(s||s===void 0)&&t()}))}_handleRequestsSuccess(e,t){let n=0;const s=()=>n===e.length;return e.map(r=>this._handleRequestSuccess(r,()=>{n++,s()&&this.showSuccessMessage(t)}))}_handleRequestsFinished(e,t){const n=e.slice(),s=()=>n.length===0,r=o=>{const l=n.indexOf(o);l!==-1&&(n.splice(l,1),s()&&t())};return e.map(o=>o.pipe((0,c.tap)(()=>r(o)),(0,c.finalize)(()=>r(o))))}showSuccessMessage(e){this._snackBar.open(e,"",{duration:5e3})}handleError(e,t){return this._errorHandler.handleRequest(e,t)}handleSuccess(e,t){return this._handleRequestSuccess(e,()=>this.showSuccessMessage(t))}applyMask(e,t){this._maskService.showBodyMask({delay:t.maskDelay});let n=!1;return e.pipe((0,c.tap)(()=>{this._maskService.hideBodyMask(),n=!0}),(0,c.finalize)(()=>{n||this._maskService.hideBodyMask()}))}handleRequest(e,t={}){let n=this.handleError(e,t);return t.skipBodyMask||(n=this.applyMask(n,t)),t.successMessage&&(n=this.handleSuccess(n,t.successMessage)),n}handleRequests(e,t={}){let n=e.map(s=>this.handleError(s,t));return t.successMessage&&(n=this._handleRequestsSuccess(n,t.successMessage)),t.skipBodyMask||(this._maskService.showBodyMask({delay:t.maskDelay}),n=this._handleRequestsFinished(n,()=>this._maskService.hideBodyMask())),n}static{this.\u0275fac=function(t){return new(t||pr)(i.\u0275\u0275inject(Je),i.\u0275\u0275inject(gt.MatSnackBar),i.\u0275\u0275inject(hr))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:pr,factory:pr.\u0275fac})}}const Rf={provide:Uc,useClass:pr},Lf=["*"];function Vf(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275element(1,"img",3),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("src",t.contact==null?null:t.contact.photo,i.\u0275\u0275sanitizeUrl)}}function zf(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",4),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275styleProp("background",t.contactColor),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.getInitials())}}class St{constructor(){this.contactClick=new i.EventEmitter}getInitials(){return this.contact&&this.contact.name?this.contact.name.replace(/\s+/g," ").trim().split(" ",2).map(function(t){return t.substr(0,1).toUpperCase()}).join(""):""}contactClicked(){return this.contactClick.emit({contactId:this.contact.id}),!1}static{this.\u0275fac=function(t){return new(t||St)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:St,selectors:[["ts-contact-photo"]],inputs:{contact:"contact",contactColor:"contactColor"},outputs:{contactClick:"contactClick"},ngContentSelectors:Lf,decls:5,vars:2,consts:[["noPhoto",""],[3,"click"],[4,"ngIf","ngIfElse"],["alt","Contact photo",1,"contact-photo",3,"src"],[1,"contact-photo","no-photo"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275projectionDef(),i.\u0275\u0275elementStart(0,"div",1),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.contactClicked())}),i.\u0275\u0275template(1,Vf,2,1,"ng-container",2)(2,zf,2,3,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275projection(4),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(3);i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.contact.photo)("ngIfElse",s)}},dependencies:[b.NgIf],styles:[".contact-photo[_ngcontent-%COMP%]{border-radius:50%;width:32px;height:32px;cursor:pointer}.contact-photo.no-photo[_ngcontent-%COMP%]{text-align:center;line-height:2.2em;font-size:14px;display:inline-block;min-width:32px;min-height:32px;color:#fff}"]})}}class Hc{constructor(e){this.element=e}_getHash(e){let t=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);return t}_getColor(e){return e?"hsl("+this._getHash(e)%180*2+",50%,50%)":this.defaultColor||"orange"}ngOnInit(){this.element.nativeElement.style.backgroundColor=this._getColor(this.value)}static{this.\u0275fac=function(t){return new(t||Hc)(i.\u0275\u0275directiveInject(i.ElementRef))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Hc,selectors:[["","tsBackgroundColor",""]],inputs:{value:[0,"tsBackgroundColor","value"],defaultColor:"defaultColor"}})}}class Vn{static{this.\u0275fac=function(t){return new(t||Vn)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Vn})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Vn,{declarations:[St,Hc],imports:[b.CommonModule],exports:[St]})})();var Oe=m(59237),qe=m(4615),zn=m(4529),jt=m(16441),Yc=m(29833),K=m(66459),re=m(49281),Rt=m(92291),vt=m(20637),Zc=m(25694),ju=m(77901);function mr(a){return e=>Qg(a,e)}function Ff(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",5),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("svgIcon",t.icon)}}function Bf(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",10),a&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275property("svgIcon",t==null?null:t.icon)}}function Uf(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",8),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(o.onActionClick(r==null?null:r.handler,s))}),i.\u0275\u0275template(1,Bf,1,1,"mat-icon",9),i.\u0275\u0275elementStart(2,"span"),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit;i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t==null?null:t.icon),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t==null?null:t.caption)}}function Hf(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",6),i.\u0275\u0275template(1,Uf,4,2,"button",7),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.actions)}}function Yf(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",11),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onClose(s))}),i.\u0275\u0275element(2,"mat-icon",12),i.\u0275\u0275elementEnd()}a&2&&i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(1,1,"Dialog.Close"))}class ls{constructor(e,t){this.snackBarRef=e,this.data=t,this.message=t.message,this.actions=t.actions,this.closeMode=t.closeMode,this.icon=t.icon}onClose(e){e?.stopPropagation(),this.snackBarRef.dismiss()}onActionClick(e,t){var n=this;return(0,S.A)(function*(){yield e?.call(n,t),n.snackBarRef.dismiss()})()}static{this.\u0275fac=function(t){return new(t||ls)(i.\u0275\u0275directiveInject(gt.MatSnackBarRef),i.\u0275\u0275directiveInject(gt.MAT_SNACK_BAR_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ls,selectors:[["ts-notify"]],decls:7,vars:6,consts:[[1,"crt-notify-container"],["class","crt-notify-icon",3,"svgIcon",4,"ngIf"],["data-qa","notificationPopup",1,"crt-notify-message"],["class","crt-notify-actions",4,"ngIf"],["mat-flat-button","","class","crt-notify-close-button-icon","type","button",3,"click",4,"ngIf"],[1,"crt-notify-icon",3,"svgIcon"],[1,"crt-notify-actions"],["type","button","mat-flat-button","",3,"click",4,"ngFor","ngForOf"],["type","button","mat-flat-button","",3,"click"],["class","crt-notify-action-button-icon",3,"svgIcon",4,"ngIf"],[1,"crt-notify-action-button-icon",3,"svgIcon"],["mat-flat-button","","type","button",1,"crt-notify-close-button-icon",3,"click"],["svgIcon","icon_close_24"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,Ff,1,1,"mat-icon",1),i.\u0275\u0275elementStart(2,"output",2),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(5,Hf,2,1,"div",3)(6,Yf,3,3,"button",4),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.icon),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(4,4,n.message)),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.actions==null?null:n.actions.length),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.closeMode!=="auto"))},dependencies:[b.NgForOf,b.NgIf,W.MatButton,U.MatIcon,v.TranslatePipe],styles:[".crt-notify-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-message[_ngcontent-%COMP%]{flex:1}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-icon[_ngcontent-%COMP%]{width:16px;margin-inline-end:8px}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-close-button-icon[_ngcontent-%COMP%]{padding:0;min-width:initial;margin-inline-start:16px}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center;margin-inline-start:40px}.crt-notify-container[_ngcontent-%COMP%]   .crt-notify-actions[_ngcontent-%COMP%]   .crt-notify-action-button-icon[_ngcontent-%COMP%]{width:16px;margin-inline-end:4px}"]})}}class Fn{constructor(e,t,n){this._snackBar=e,this._zone=t,this._environment=n,this._defaultDuration=this._environment?.defaultNotifyPopupDuration||5e3}show(e){const{message:t,duration:n,panelClass:s,icon:r,closeMode:o="default",actions:l=[]}=e||{},d=s?Array.isArray(s)?s:[s]:[],h=this._zone.run(()=>this._snackBar.openFromComponent(ls,{data:{message:t,actions:l,closeMode:o,icon:r},duration:o==="manual"?0:n??this._defaultDuration,verticalPosition:"bottom",panelClass:["crt-notify",...d]}));return Promise.resolve(h)}error({message:e,duration:t}){return this.show({message:e,duration:t,panelClass:"notify-service-error"})}warn({message:e,duration:t}){return this.show({message:e,duration:t,panelClass:"notify-service-warn"})}info({message:e,duration:t}){return this.show({message:e,duration:t,panelClass:"notify-service-info"})}static{this.\u0275fac=function(t){return new(t||Fn)(i.\u0275\u0275inject(gt.MatSnackBar),i.\u0275\u0275inject(i.NgZone),i.\u0275\u0275inject("environment",8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Fn,factory:Fn.\u0275fac})}}class Zt{constructor(e,t){this._domSanitizer=e,this._matIconRegistry=t}_register(e,t,n){const s=this._domSanitizer.bypassSecurityTrustHtml(t);n?this._matIconRegistry.addSvgIconLiteralInNamespace(n,e,s):this._matIconRegistry.addSvgIconLiteral(e,s)}addIcons(e,t){if(e){if(Array.isArray(e)){e.forEach(({name:n,icon:s})=>this._register(n,s,t));return}Object.entries(e).forEach(([n,s])=>this._register(n,s,t))}}static{this.\u0275fac=function(t){return new(t||Zt)(i.\u0275\u0275inject(y.DomSanitizer),i.\u0275\u0275inject(U.MatIconRegistry))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Zt,factory:Zt.\u0275fac,providedIn:"root"})}}class us{constructor(e){this._materialIconsRegistrar=e,this._materialIconsRegistrar.addIcons([{name:"icon_close_24",icon:m(26242)}])}static{this.\u0275fac=function(t){return new(t||us)(i.\u0275\u0275inject(Zt))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:us})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Fn],imports:[b.CommonModule,W.MatButtonModule,U.MatIconModule,gt.MatSnackBarModule,v.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(us,{declarations:[ls],imports:[b.CommonModule,W.MatButtonModule,U.MatIconModule,gt.MatSnackBarModule,v.TranslateModule],exports:[ls]})})();var ds=m(14276);const Zf={macrosName:"ResourceString",macrosHandler:function(a,e){if(!a)throw new Error("Context is not defined");if(!a.Resources?.Strings)throw new Error("Context does not contain property Resources.Strings");const t=a.Resources.Strings[e[0]];return t instanceof Promise?(0,u.from)(t):(0,u.of)(t)}};function Wf(a){return{macrosName:"ResourceString",macrosHandler:function(e,t){if(e?.strings){for(const n of t){const s=e.strings[n];if(s)return(0,u.of)(a.findLocalizableValue(s))}throw new Error(`Localized resource string not found. ${t}`)}if(e?.Strings){for(const n of t){const s=e.Strings[n];if(s)return(0,u.from)(s)}throw new Error(`Localized string in ViewModel metadata not found. ${t}`)}return Zf.macrosHandler(e,t)}}}function $f(a=!1){return{macrosName:"DataSourceEntityName",macrosHandler:(e,t)=>{if(!e)throw new Error("Context is not defined");let n=t[0],s;if(a)e.constructor.name==="BaseViewModel"?s=e.dataSchemas?.[n]?.dataSourceConfig?.config?.entitySchemaName:s=e.modelConfig?.dataSources?.[n]?.config?.entitySchemaName;else{n||(n=e.modelConfig.primaryDataSourceName);const r=e.modelConfig.dataSources?.[n];if(!r)throw new Error(`DataSource '${n}' is not defined`);s=r.config.entitySchemaName}return(0,u.of)(s)}}}function Gf(a,e=!1){return{macrosName:"MacrosTemplateString",macrosHandler:(t,n)=>{const s=n.join(", "),r=/\[#([^\]]*)#\]/.test(s);return e||!r?(0,u.of)(s):a.getTemplate(s)}}}const Wc=new i.InjectionToken("MACROS_HANDLER");function jp(a){return a===null||typeof a!="object"?[]:Object.keys(a).filter(e=>a[e]instanceof Object).map(e=>jp(a[e]).map(t=>[e,...t])).reduce((e,t)=>[...e,...t],Object.keys(a).map(e=>[e]))}function Rp(a,e){return Object.keys(a).every(t=>Object.prototype.hasOwnProperty.call(e,t)?typeof a[t]=="object"?Qf(a[t],e[t]):!0:!1)}function Qf(a,e){return Rp(a,e)&&Rp(e,a)}function Jf(a,e){const t=Array.isArray(e)?e:e.split(".");let n=a;for(const s of t)if(n instanceof Map)n=n.get(s);else if(n&&typeof n=="object")n=n[s];else return;return n}function tv(a){const e=JSON.stringify(a);let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t+e.charCodeAt(n);return t.toString(16)}class dt{static create(e){const t=new dt;return Object.assign(t,e),t}get isDebugEnabled(){return!!window.Terrasoft?.isDebug}static{this.\u0275fac=function(t){return new(t||dt)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:dt,factory:dt.\u0275fac,providedIn:"root"})}}class hs{constructor(e,t,n){this.handlers=e,this._featureValues=t,this._applicationInfo=n}get _includeProcessedHandlers(){return!!this._featureValues?.IncludeProcessedMacrosHandlers}_findClosingBracket(e,t){let n=t,s=1;for(;s>0&&n<e.length;){const r=e[++n];r==="("?s++:r===")"&&s--}return n}_getMacroses(e){const t=new Array;let n=e.indexOf("#");for(;n>=0;){const s=e.indexOf("(",n);if(s<0)return t;const r=this._findClosingBracket(e,s),o=e.indexOf("#",r);if(o<0)return t;t.push({macrosName:e.substring(n+1,s),macrosArgs:e.substring(s+1,r),macrosBody:e.substring(n,o+1)}),n=e.indexOf("#",o+1)}return t}_processMacroses({macroses:e,macrosNameFilter:t,context:n,options:s,value:r}){let o={...r};const l=d=>!!(t&&t!==d&&t.split(",").indexOf(d)===-1);return(0,u.forkJoin)({...e.map(({macrosName:d,macrosArgs:h,macrosBody:f})=>{if(l(d))return(0,u.of)(null);const I=this.getHandler(d);return I?this.internalHandle(h,n,t,s).pipe((0,c.switchMap)(O=>{const B=I(n,`${O.value}`.split(",").map(J=>J.trim()));return(B instanceof u.Observable?B:(0,u.of)(B)).pipe((0,c.catchError)(J=>(this._applicationInfo.isDebugEnabled&&console.warn(J),(0,u.of)(f))),(0,c.tap)(J=>{const te=typeof J=="number"?J:J||"";o={isChanged:!0,value:o.value.replace(f,te)}}))}),(0,c.catchError)(O=>(s&&s.errorHandler?s.errorHandler(O):this._applicationInfo.isDebugEnabled&&console.warn(O),(0,u.of)(f)))):(0,u.of)(null)}),default:(0,u.of)(null)}).pipe((0,c.map)(()=>o))}_forEachStringInObject(e,t,n=[],s=[]){if(!(e instanceof Object))return;const r=l=>!n.includes(l),o=(l,d)=>{typeof l=="string"?t(s.concat(d),l):typeof l=="object"&&l!==null&&(s.push(d),this._forEachStringInObject(l,t,n,s),s.pop())};if(e instanceof Map)for(const l of Array.from(e.keys()).filter(r))o(e.get(l),l);else Object.keys(e).filter(r).forEach(l=>{o(e[l],l)})}_set(e,t,n){const s=t.slice(),r=s.pop(),o=s.length===0?e:Jf(e,s);o&&(o[r]=n)}getHandler(e){return this.handlers.filter(t=>t.macrosName===e).pop()?.macrosHandler}internalHandle(e,t,n,s){const r={value:e,isChanged:!1};return(0,u.of)(r).pipe((0,c.switchMap)(l=>{if(typeof e!="string")return(0,u.of)(l);const d=this._getMacroses(e);return d.length?this._processMacroses({macroses:d,macrosNameFilter:n,context:t,options:s,value:r}):(0,u.of)(l)}))}handle(e,t){const n=(0,T.cloneDeep)(e);return(0,u.forkJoin)([...jp(n).map(s=>{const r=(0,T.get)(n,s);return this.internalHandle(r,t).pipe((0,c.tap)(({value:o})=>{(0,T.set)(n,s,o)}))}),(0,u.of)(null)]).pipe((0,c.map)(()=>n))}handleMarcos(...e){return this.handleMacros.call(this,...e)}handleResourceMacros(e,t,n){return this.handleMacros("MacrosTemplateString,ResourceString",(0,T.cloneDeep)(e),t,n)}handleMacros(e,t,n,s){const r=[(0,u.of)(null)];return this._forEachStringInObject(t,(o,l)=>{const d=this._getMacroses(l);if(!d.length)return;const h=this._processMacroses({macroses:d,context:n,options:s,macrosNameFilter:e,value:{isChanged:!1,value:l}}).pipe((0,c.tap)(f=>{f.isChanged!==!1&&(s?.setPropertyFn?s.setPropertyFn({source:t,keys:o,value:f.value}):this._set(t,o,f.value))}));r.push(h)},this._includeProcessedHandlers?[]:["__preprocessed"]),(0,u.forkJoin)(r).pipe((0,c.map)(()=>t))}static{this.\u0275fac=function(t){return new(t||hs)(i.\u0275\u0275inject(Wc),i.\u0275\u0275inject(oe,8),i.\u0275\u0275inject(dt))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:hs,factory:hs.\u0275fac})}}var ps;(function(a){a.string="Strings",a.image="Images"})(ps||(ps={}));const gr="Resources";class ms extends Array{constructor(e){super(),Object.setPrototypeOf(this,Object.create(ms.prototype)),Array.isArray(e)&&this._fillFromSource(e)}_fillFromSource(e){e.filter(t=>t?.cultureName!=null).forEach(t=>{this.setValueLocalizableString(t.cultureName,t.value)})}getValue(e){const t=this.getLocalizableString(e);return t?t.value:""}hasCultureValue(e,t=!1){const n=this.getLocalizableString(e);return t?(n?.value||null)!=null:n?.value!=null}getLocalizableString(e){return this.find(t=>t.cultureName===e)||null}setValueLocalizableString(e,t){const n=this.getLocalizableString(e);return n?n.value=t:this.push({cultureName:e,value:t}),this}setValues(e,t=!1){return e.forEach(n=>{this.hasCultureValue(n.cultureName)&&t||this.setValueLocalizableString(n.cultureName,n.value)}),this}clone(){return new ms(this)}}class mi{constructor(e){this.userInfo=e,this._resourceMacrosRegExpPattern="(?<macrosBody>#ResourceString\\((?<macrosArgs>[^)]*)\\)#)",this._viewModelAttributeRegExpPattern=`\\$${gr}.${ps.string}.(?<macrosArgs>[\\S\\s]*)`,this._sysCultureName=this.userInfo.cultureInfo.sysCultureName,this._defCultureName=this.userInfo.defCultureInfo.sysCultureName}_getLczResource(e){const t={};return e.forEach(n=>t[n.cultureName]=n.value),t}_getResourceValueMatches(e){const t=new RegExp(this._resourceMacrosRegExpPattern,"g"),n=new RegExp(this._viewModelAttributeRegExpPattern,"g");let s=[...(e??"").matchAll(n)];return s.length||(s=[...(e??"").matchAll(t)]),s}_findStringPropertyResource(e,t){const{resourceName:n,useMacrosTemplate:s}=this.findResourcesName(e);if(n)return{path:t,resourceName:n,useMacrosTemplate:s}}_findArrayPropertyResources(e,t=""){return e.flatMap((n,s)=>this.findPropertyResources(n,t?`${t}.${s}`:`${s}`))}_findObjectPropertyResources(e,t=""){return Object.entries(e).flatMap(([n,s])=>this.findPropertyResources(s,t?`${t}.${n}`:n))}findLocalizableValue(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return null;let t;return Array.isArray(e)?t=e?.filter(n=>n.value).reduce((n,s)=>Object.assign(n,{[s.cultureName]:s.value}),{}):t=e,(t[this._sysCultureName]??t[this._defCultureName])?.toString()??null}findResourcesName(e){const n=this._getResourceValueMatches(e)[0]?.groups.macrosArgs,s=e?.startsWith("#MacrosTemplateString");return{resourceName:n,useMacrosTemplate:s}}findLocalizationFromResourceString(e,t,n=""){const{resourceName:s}=this.findResourcesName(e),r=s!==void 0&&t.strings[s];if(r){const d=Object.entries(r).map(([h,f])=>({cultureName:h,value:f}));return new ms(d)}const o=s===void 0&&e||n,l=this._sysCultureName||this._defCultureName;return new ms([{cultureName:l,value:o}])}findValueFromResource(e,t){const n=this.findLocalizationFromResourceString(e,t),s=this._getLczResource(n);return this.findLocalizableValue(s)}findViewModelResourceValue(e,t,n){var s=this;return(0,S.A)(function*(){const{resourceName:r}=s.findResourcesName(e);let o;return r&&(o=yield t.Strings[r]),o||n||e})()}findPropertyResources(e,t=""){return e?Array.isArray(e)?this._findArrayPropertyResources(e,t):typeof e=="object"?this._findObjectPropertyResources(e,t):typeof e=="string"?[this._findStringPropertyResource(e,t)].filter(Boolean):[]:[]}static{this.\u0275fac=function(t){return new(t||mi)(i.\u0275\u0275inject(L.oq))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:mi,factory:mi.\u0275fac,providedIn:"root"})}}class fr{constructor(e){this._httpClient=e,this._serviceEndpoint="rest/MacrosHelperService"}static isMacros(e){return typeof e!="string"?!1:e?.startsWith("#")??!1}getTemplate(e,t){return this.getTemplateByEntity({textTemplate:e},t)}getTemplateByEntity(e,t){const n=`${this._serviceEndpoint}/GetTemplate`;return this._httpClient.post(n,{request:e}).pipe((0,c.map)(s=>{const r=s?.GetTemplateResult;return r?.success?t?r.textTemplate:r.textTemplate.replace(/\s?<.+?>(.+?)<(.+?)\/?(.+?)>/g,""):e.textTemplate}))}getMultiLanguageTemplate(e,t,n){const s=`${this._serviceEndpoint}/GetMultiLanguageTextTemplate`;return this._httpClient.post(s,{request:{entityId:e,entityName:t,templateId:n}}).pipe((0,c.map)(r=>r?.GetMultiLanguageTextTemplateResult))}static{this.\u0275fac=function(t){return new(t||fr)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:fr,factory:fr.\u0275fac,providedIn:"root"})}}const gi=new i.InjectionToken("IS_DESIGN_TIME");class gs{static{this.\u0275fac=function(t){return new(t||gs)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:gs})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[hs,{provide:Wc,useFactory:Wf,deps:[mi],multi:!0},{provide:Wc,useFactory:$f,deps:[[new i.Optional,gi]],multi:!0},{provide:Wc,useFactory:Gf,deps:[fr,[new i.Optional,gi]],multi:!0}],imports:[b.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(gs,{imports:[b.CommonModule]})})();class fs{constructor(e,t){this.caption="",e.addSvgIconLiteral("placeholder",t.bypassSecurityTrustHtml(m(49967)))}static{this.\u0275fac=function(t){return new(t||fs)(i.\u0275\u0275directiveInject(U.MatIconRegistry),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:fs,selectors:[["crt-view-element-placeholder"]],inputs:{caption:"caption"},decls:4,vars:1,consts:[[1,"placeholder-container"],["svgIcon","placeholder",1,"icon"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275element(1,"mat-icon",1),i.\u0275\u0275elementStart(2,"span"),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(n.caption))},dependencies:[U.MatIcon],styles:[".placeholder-container[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;align-content:center;justify-content:center;border-radius:8px;position:relative;overflow:hidden}.placeholder-container[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{height:100%;max-height:64px;width:72px;align-self:center}.placeholder-container[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{position:absolute;top:50%;left:8px;right:8px;transform:translateY(-50%);overflow:hidden;width:calc(100% - 16px);text-overflow:ellipsis}@supports (background: -webkit-named-image(i)){.placeholder-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:initial;height:initial}}"]})}}class Bn{static{this.\u0275fac=function(t){return new(t||Bn)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Bn})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,U.MatIconModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Bn,{declarations:[fs],imports:[b.CommonModule,U.MatIconModule],exports:[fs]})})();const qf=new i.InjectionToken("A factory of expression interpreter");var Ne;(function(a){a.ChangeAttributeValue="change-attribute-value",a.ModelDataLoaded="model-data-loaded-event",a.BeforeModelLoad="before-model-load",a.LoadDefaultValues="load-default-values",a.StartLoadModelAttributes="start-load-model-attributes",a.FinishLoadModelAttributes="finish-load-model-attributes",a.ViewEvent="view-event"})(Ne||(Ne={}));function _r(a,e){return Ru.apply(this,arguments)}function Ru(){return Ru=(0,S.A)(function*(a,e){const t=typeof e=="string"?e.split("."):e;let n=t.shift(),s=a;for(;n;)s=yield s[n],n=t.shift();return s}),Ru.apply(this,arguments)}const yn=Symbol("InternalViewModelInjector");var me;(function(a){a.Add="add",a.Remove="remove",a.Move="move",a.Reload="reload"})(me||(me={}));var z;(function(a){a.Init="init",a.Create="create",a.Update="update",a.Copy="copy",a.Delete="delete",a.Unknown="unknown"})(z||(z={}));const $c=new i.InjectionToken("SCOPE_NAME"),Kf=new i.InjectionToken("VIEW_EVENT_ZONE_NAME"),Xf=new i.InjectionToken("INJECTION_CONTEXT");class ft extends Array{constructor(...e){return super(),this._changed=new u.Subject,this._createdItems=[],this._deletedItems=[],this._itemsChanged=new u.Subject,this._itemAttributeChanged=new u.Subject,this._destroyed$=new u.Subject,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[],this._trackChanges=!0,this._isDestroyed=!1,typeof e[0]=="number"?new Array(e[0]):([this._viewModelGenerator,this._viewModelConfig={},this._model,this._host,this._hostAttributeName]=e,this._measurePerformanceService=this._host?.[yn]?.get(Ie.g,null,{optional:!0}),this._featureValues=this._host?.[yn]?.get(oe,{},{optional:!0})??{},this._ngZone=this._host?.[yn]?.get(i.NgZone,null,{optional:!0}),Object.setPrototypeOf(this,Object.create(ft.prototype)),this._subscribeItemsModelModesChanges(),this._subscribeItemsAttributesChanges(),new Proxy(this,{set:(t,n,s,r)=>{const o=t[n];if(t[n]=s,this._trackChanges){const l=n==="length"&&s!==o,d=!isNaN(parseInt(n));(l||d)&&this._onItemsChanged()}return!0}}))}get changed(){return this._changed.asObservable().pipe((0,P.BV)(this._ngZone),(0,c.takeUntil)(this._destroyed$))}get itemAttributeChanged(){return this._itemAttributeChanged.asObservable().pipe((0,c.takeUntil)(this._destroyed$))}get isChanged(){return this.getChangedItems().length>0}get formApiModel(){return this._formApiModel||this._updateFormApiModelValues({emitEvent:!1}),this._formApiModel}_isItemPrimaryAttributeEqual(e,t){return(0,S.A)(function*(){if(!e)return!1;const n=yield e[e.primaryAttributeName];return t.includes(n)})()}_getNewCallbacksMap(){return new Map([[me.Add,[]],[me.Remove,[]],[me.Move,[]],[me.Reload,[]]])}_insertItem(e,t){typeof t!="number"&&(t=this.length),t=Math.max(t,0),t=Math.min(t,this.length),this._triggerChangesAfter(()=>super.splice(t,0,e))}_generateItem(e){const t=()=>{const n=this._model?.createCollectionItemModel(z.Create),s=this._host?.[yn]?i.Injector.create({providers:[{provide:$c,useValue:null}],parent:this._host?.[yn]}):null,r={viewModelConfig:this._viewModelConfig,modelConfig:n?{primaryDataSourceName:n.name}:void 0,models:n?[n]:void 0,parentViewModel:this._host,businessRulesActive:e.businessRulesActive??!1},o=f=>{n?.name&&(f.dataSchemas[n.name]=this._host.dataSchemas[n.name])},l=f=>n?.name?f.create(n.name,e.initialModelValues).pipe((0,c.map)(()=>f)):(0,u.of)(f),d=f=>{Object.entries(e.initialAttributeValues??{}).forEach(([I,O])=>f[I]=O),f._markAsPristine(e.initialAttributeValues??{}),this._model?.childrenChange()},h=this._viewModelGenerator.generate(r,s).pipe((0,c.tap)(o),(0,c.switchMap)(l),(0,c.tap)(d));return(0,u.lastValueFrom)(h)};return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.generateItem",()=>t()):t()}_mergeItems(e,t){const n=()=>{const s=(e[0]||t[0])?.primaryAttributeName;for(const r of t){const o=e.findIndex(l=>{const d=l.attributes?.[s],h=r.attributes?.[s];return d&&d===h});o===-1?e.push(r):e.splice(o,1,r)}return e};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.mergeItems",()=>n()):n()}_triggerChangesAfter(e,t){this._trackChanges=!1;const n=e.call(this);return this._trackChanges=!0,this._isDestroyed||(this._onItemsChanged(),t&&this._executeChangesCallbacksWhenReady(t)),n}_executeChangesCallbacks(e){this._onCollectionChangeCallbacksMap.get(e.action).forEach(n=>{this._safeExecuteCallback(n,{...e,collection:[...this]},e.action)})}_executeChangesCallbacksWhenReady(e){Promise.resolve().then(()=>this._executeChangesCallbacks(e))}_onItemsChanged(){const e=this.map(t=>({item:t,itemModelMode:t?.getPrimaryModelMode?.()}));this._updateCollectionState(e,!0)}_subscribeItemsModelModesChanges(){this._itemsChanged.pipe((0,c.switchMap)(()=>this._getItemsModelModesChanges()),(0,c.tap)(e=>this._updateCollectionState([e],!1)),(0,c.takeUntil)(this._destroyed$)).subscribe()}_subscribeItemsAttributesChanges(){const e=t=>{this._onItemAttributesChangesCallbacks.forEach(n=>{try{n(t)}catch(s){console.error("An error occurred during execution of item attributes change callback:",s)}})};this._itemsChanged.pipe((0,c.switchMap)(()=>this._getItemsWithAttributesChanges()),(0,c.tap)(t=>e(t)),(0,c.tap)(()=>this._itemAttributeChanged.next()),(0,c.takeUntil)(this._destroyed$)).subscribe()}_getItemsWithAttributesChanges(){const e=t=>{const n=t.events$?.pipe((0,c.map)(s=>s.type===Ne.ChangeAttributeValue&&!s.payload.silent));return t?.events$?n.pipe((0,c.map)(s=>s?t:null)):(0,u.of)(null)};return(0,u.merge)(...this.map(e)).pipe((0,c.filter)(Boolean))}_getItemsModelModesChanges(){const e=[...this,...this._deletedItems].map(t=>t?._getPrimaryModelModeChanges?.()?.pipe((0,c.map)(n=>({item:t,itemModelMode:n})))).filter(Boolean);return e.length?(0,u.merge)(...e):u.EMPTY}_updateCollectionState(e,t){this._trackChanges=!1;const n=e.map(s=>this._onItemModelModeChanged(s)).some(s=>!!s);this._trackChanges=!0,!(!t&&!n)&&(this._updateFormApiModelValues(),this._updateFormApiModelPristineState(),this._changed.next(),this._itemsChanged.next())}_onItemModelModeChanged(e){const{item:t,itemModelMode:n}=e;if(!t||n==null)return!1;switch(n){case z.Create:return this._onCreateItem(t);case z.Update:return this._onUpdateItem(t);case z.Delete:return this._onDeleteItem(t);default:return!1}}_onCreateItem(e){const t=this._deletedItems.indexOf(e);return t!==-1?(this._deletedItems.splice(t,1),!0):(this._createdItems.indexOf(e)===-1&&this._createdItems.push(e),!1)}_onUpdateItem(e){const t=this._createdItems.indexOf(e);if(t!==-1)return this._createdItems.splice(t,1),!1;const n=this._deletedItems.indexOf(e);if(n!==-1){const s=this._deletedItems.splice(n,1);super.push(...s)}return!0}_onDeleteItem(e){const t=this._createdItems.indexOf(e),n=this._deletedItems.indexOf(e);t!==-1?this._createdItems.splice(t,1):n===-1&&this._deletedItems.push(e);const s=this.indexOf(e);return s===-1?!1:(super.splice(s,1),this._executeChangesCallbacks({collection:[],affectedElements:[e],action:me.Remove,index:s}),!0)}_updateFormApiModelValues(e){if(this._featureValues.DisableBaseViewModelCollectionOptimization){this._formApiModel??=new Z.FormArray([]),this._formApiModel.clear({emitEvent:!1}),this.filter(n=>n?.formApiModel).forEach(n=>{this._formApiModel.push(n.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity();return}if(!this._formApiModel||!this._formApiModel.length){const n=new Z.FormArray(this.filter(s=>s?.formApiModel)?.map(s=>s.formApiModel));this._formApiModel||(this._formApiModel=n),this._formApiModel.length||this._host?.formApiModel?.setControl(this._hostAttributeName,n)}else this._formApiModel.clear({emitEvent:!1}),this.filter(n=>n?.formApiModel).forEach(n=>{this._formApiModel.push(n.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity()}_updateFormApiModelPristineState(){const e=this.formApiModel.pristine,t=this.some(n=>n?.formApiModel?.dirty);if(t&&e){this.formApiModel.markAsDirty();return}!t&&!e&&this.formApiModel.markAsPristine()}_reload(e){const t=()=>{for(const r of[...this._deletedItems,...this])this.removeChildModel(r,{triggerNotification:!1});this._model?.childrenChange();const n=[],s=r=>n.push(r.destroy());return this._createdItems.forEach(s),this._createdItems.splice(0,this._createdItems.length),this._deletedItems.forEach(s),this._deletedItems.splice(0,this._deletedItems.length),this.forEach(s),this.splice(0,this.length,...e),(0,u.forkJoin)(n).pipe((0,c.defaultIfEmpty)(void 0),(0,c.map)(()=>{}))};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.reload",()=>t()):t()}_unregisterCallbackByAction(e,t){if(!this._onCollectionChangeCallbacksMap.get(e).find(r=>r===t))return!1;const s=this._onCollectionChangeCallbacksMap.get(e).filter(r=>r!==t);return this._onCollectionChangeCallbacksMap.set(e,s),!0}_safeExecuteCallback(e,t,n){const s=()=>{try{e(t)}catch(r){console.error(`An error occurred during execution of collection ${n} callback:`,r)}};if(this._ngZone){this._ngZone.run(s);return}s()}registerOnCollectionChangeCallback(e,t){const n=this._onCollectionChangeCallbacksMap.get(t);if(t&&!n)throw new Error(`Action type ${t} is not supported. Please use one of: ${Object.values(me).join(", ")} or empty value for all actions`);if(t){const s=[...n,e];this._onCollectionChangeCallbacksMap.set(t,s);return}this._onCollectionChangeCallbacksMap.forEach((s,r)=>{const o=[...s,e];this._onCollectionChangeCallbacksMap.set(r,o)})}unregisterOnCollectionChangeCallback(e,t){if(t){if(!this._unregisterCallbackByAction(t,e))throw new Error("The provided callback is not registered.");return}if(![...this._onCollectionChangeCallbacksMap.keys()].map(s=>this._unregisterCallbackByAction(s,e)).some(s=>s))throw new Error("The provided callback is not registered.")}registerOnItemAttributesChangesCallback(e){this._onItemAttributesChangesCallbacks.push(e)}unregisterOnItemAttributesChangesCallback(e){if(!this._onItemAttributesChangesCallbacks.includes(e))throw new Error("The provided callback is not registered.");this._onItemAttributesChangesCallbacks=this._onItemAttributesChangesCallbacks.filter(t=>t!==e)}removeChildModel(e,t){const n=t?.triggerNotification??!0,s=this._model?.name,r=e.getModelByName(s);this._model?.removeChild(r),n&&this._model?.childrenChange()}copyWithin(e,t,n){const s={collection:[],affectedElements:this.slice(t,n),action:me.Move,index:e};return this._triggerChangesAfter(()=>super.copyWithin(e,t,n),s)}fill(e,t,n){const s=n??this.length-1-(t??0),r={collection:[],affectedElements:new Array(s).fill(e),action:me.Add,index:t};return this._triggerChangesAfter(()=>super.fill(e,t,n),r)}push(...e){const t={collection:[],affectedElements:[...e],action:me.Add,index:this.length};return this._triggerChangesAfter(()=>super.push(...e),t)}reverse(){const e={collection:[],affectedElements:this.slice(),action:me.Add,index:0};return this._triggerChangesAfter(()=>super.reverse(),e)}shift(){const e={collection:[],affectedElements:this.length?[this[0]]:[],action:me.Remove,index:0};return this._triggerChangesAfter(()=>super.shift(),e)}sort(e){const t={collection:[],affectedElements:this.slice(),action:me.Move};return this._triggerChangesAfter(()=>super.sort(e),t)}splice(e,t,...n){const s=typeof t=="number"?t:this.length-e,r=s>0?this.slice(e,e+s):[],o=r.length>0,l={collection:[],affectedElements:o?r:[...n],action:o?me.Remove:me.Add,index:e};return this._triggerChangesAfter(()=>super.splice(e,t,...n),l)}pop(){const e=this.length?this.length-1:void 0,t={collection:[],affectedElements:e!==void 0?[this[e]]:[],action:me.Remove,index:e};return this._triggerChangesAfter(()=>super.pop(),t)}unshift(...e){const t={collection:[],affectedElements:[...e],action:me.Add,index:0};return this._triggerChangesAfter(()=>super.unshift(...e),t)}getChangedItems(){const e=[...this._deletedItems];return this.filter(n=>{if(n.attributes.IsChanged)return!0;const s=n.getPrimaryModelMode();return s&&s!==z.Update}).concat(e)}createItem(e){var t=this;const n=function(){var s=(0,S.A)(function*(){const r=yield t._generateItem(e||{});t._insertItem(r,e?.index);const o={collection:[...t],affectedElements:[r],action:me.Add,index:t.indexOf(r)};return t._executeChangesCallbacksWhenReady(o),r});return function(){return s.apply(this,arguments)}}();return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.createItem",()=>n()):n()}getPrimaryAttributeValues(){return Promise.all(this.map(e=>e?.[e?.primaryAttributeName]))}findByPrimaryAttribute(e){var t=this;return(0,S.A)(function*(){for(const n of t)if(yield t._isItemPrimaryAttributeEqual(n,[e]))return n})()}filterByPrimaryAttributes(e){var t=this;return(0,S.A)(function*(){const n=[];for(const s of t)(yield t._isItemPrimaryAttributeEqual(s,e))&&n.push(s);return n})()}merge(e){const t=()=>{this._triggerChangesAfter(()=>{const n=this._mergeItems([...this],e),s=n.length>this.length;super.splice(0,this.length,...n),this._createdItems.splice(0,this._createdItems.length),e instanceof ft&&this._mergeItems(this._deletedItems,e._deletedItems);const r={collection:[...this],affectedElements:e,action:s?me.Add:me.Reload};this._executeChangesCallbacksWhenReady(r)})};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.merge",()=>t()):t()}reload(e,t=me.Reload){const n=[...this],s={collection:[],affectedElements:t===me.Reload?[...e]:n,action:t};return(0,u.lastValueFrom)(this._reload(e).pipe((0,c.finalize)(()=>this._executeChangesCallbacksWhenReady(s))))}remove(e){const[t,n]=typeof e=="number"?[e,this[e]]:[this.indexOf(e),e];if(t>=0&&t<this.length){this.splice(t,1);const s={collection:[],affectedElements:[n],action:me.Remove,index:t};return this._executeChangesCallbacksWhenReady(s),(0,u.lastValueFrom)(n.destroy())}return Promise.resolve()}clear(){return this.reload([],me.Remove)}moveTo(e,t){if(t>=this.length)throw new Ka("Target index cannot be greater than collection length");const n=this.indexOf(e);if(n===t||t<0)return;const s={collection:[],affectedElements:[e],action:me.Move,index:t};this._triggerChangesAfter(()=>super.splice(t,0,super.splice(n,1)[0]),s)}destroy(){this._isDestroyed=!0,this._host=null,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[];const e=this._reload([]);return this._formApiModel.clear({emitEvent:!1}),this._itemAttributeChanged.complete(),this._itemsChanged.complete(),this._destroyed$.next(),this._destroyed$.complete(),(0,u.lastValueFrom)(e)}}function e_(a,e){return!a?.length||!e?.length?null:a[e.length-1]??null}function yr(a){for(;a.parent;)a=a.parent;return a}function Lu(a,e){const t=a.split(".").slice(0,-1),n=Lp(e),s=n.map(r=>r.viewModel$.pipe((0,c.take)(1)));return(0,u.forkJoin)(s).pipe((0,c.map)(r=>({viewModels:r,rootViewModel:e_(r,n)})),(0,c.filter)(({rootViewModel:r})=>!r?._destroyed),(0,c.map)(({viewModels:r,rootViewModel:o})=>{const l=[],h=!o?.[yn].get(oe,null)?.["ViewModel.DisableFixedNestedCollectionPathCheck"],f=h?t_:n_;let I=n.length-1,O=[];for(const B of t){l.push(B);const J=h?o:r[I];if(J&&f(J,l)&&(O=[...l],I--,I<0))return null}return{context:n[I],contextPath:O.join(".")}}))}function Lp(a){const e=[a];return a.parent&&e.push(...Lp(a.parent)),e}function t_(a,e){let t=a._attributeConfigs,n=null;for(const s of e){if(n=t?.[s],!n)return!1;t=n.viewModelConfig?.attributes}return n.isCollection}function n_(a,e){let t=a;for(const n of e)t=t?.attributes?t.attributes[n]:t?.[n];return t instanceof ft}function i_(a){return(a?.parameters??[]).map(e=>Vp(e)).flat()}function Vp(a){const e=[];if(a.attributePath&&e.push(a.attributePath),a.attributeProperty){const n=a.attributeProperty.split(":").shift();e.push(n)}const t=(a.converters??[]).map(n=>i_(n)).flat();return e.push(...t),e.filter(n=>!isEmpty(n))}function Lt(a){return typeof a=="string"&&a.startsWith("$")&&a.length>1}function Gc(a){return Lt(a)&&/^\$(\w+\.)*\w+$/.test(a)}function zp(a){return typeof a=="string"&&a.startsWith(`$${gr}.${ps.string}.`)}function Fp(a){return/^\$(?<AttributeName>.+):(?<PropertyName>.+?)(?=(?==(?<defValue>.*))|(?=$))/.test(a)}function Vu(a){return typeof a=="string"&&/@event\b/.test(a)}function s_(a){return typeof a=="string"&&/^([^\d.][\w.]+)(\s*:\s*[\w'".$]+)+.*$/.test(a)}function Bp(a){return!!a.match(/^'.*'$/)}function Up(a){return!isNaN(Number(a))&&!isNaN(parseFloat(a))}function Hp(a){return a==="true"||a==="false"}function a_(a){return Bp(a)||Up(a)||Hp(a)}function zu(a){const e={expression:a},t=a.split("|").map(n=>n.trim());if(Lt(a)){const n=t.shift();e.binding=n,zp(n)&&(e.resourcePath=n.substring(1)),Fp(n)&&(e.attributeProperty=n.substring(1)),Gc(n)&&(e.attributePath=n.substring(1))}else if(Vu(a)){const n=t.shift();e.event=n.substring(7)}else if(!s_(a))return e.value=a,e;return e.converters=t.map(n=>{const[s,...r]=n.split(":").map(o=>o.trim());return{type:s,parameters:r.map(o=>zu(o))}}),e}function nv(a){if(!isString(a)||isEmpty(a))return[];const e=zu(a);return Vp(e)}function iv(a){return Lt(a)?a.slice(1):a}function Fu(a,e){if(!a)return e;if(!e.startsWith(a))throw new Error(`Attribute path '${e}' should start with '${a}'`);return e.substring(a.length+1)}function r_(a){if(!Lt(a))throw new Error(`'${a}' is not binding expression`);const e=a.indexOf("|");return e>-1&&(a=a.substring(0,e).trimEnd()),a.substring(1)}function Yp(a,e){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,S.A)(function*(a,e){const t=e.match(/^(?:(?<attributeHostPath>.+)\.)?(?<attributeName>[^.]+)$/),{attributeHostPath:n,attributeName:s}=t.groups,r=n?yield _r(a,n):a;return{attributeName:s,attributeHost:r}}),Bu.apply(this,arguments)}class Zp{getAttributeValuesStream(e,t){return e?e.events$.pipe((0,c.filter)(n=>n.type===Ne.ChangeAttributeValue),(0,c.filter)(n=>n?.payload?.attributeName===t),(0,c.switchMap)(n=>t in e?Promise.resolve(e[t]):Promise.resolve(n.payload.value)),(0,c.share)()):(0,u.of)(null)}getAttributeInitialValueStream(e,t,n){return e?(0,u.from)(_r(e,t)).pipe((0,c.takeUntil)(n)):(0,u.of)(null)}getAttributeLocationChanges(e,t){return Lu(e,t).pipe((0,c.tap)(n=>{if(!n)throw new Error(`Target binding context for attribute "${e} was not found"`)}),(0,c.switchMap)(({context:n,contextPath:s})=>(0,u.combineLatest)([n.viewModel$,(0,u.of)(Fu(s,e))])),(0,c.switchMap)(([n,s])=>n?Yp(n,s):(0,u.of)({attributeName:void 0,attributeHost:void 0})))}evaluate(e,t){const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,c.switchMap)(s=>this.getAttributeValueChanges(s)))}}class Wt extends Zp{getAttributeValueChanges({attributeHost:e,attributeName:t}){const n=this.getAttributeValuesStream(e,t),s=this.getAttributeInitialValueStream(e,t,n);return(0,u.merge)(s,n)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Wt)))(n||Wt)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Wt,factory:Wt.\u0275fac})}}class fi extends Wt{removeConvertersFromExpression(e){const t=e.indexOf("|");return t===-1?e:(console.warn(`Cannot use converters in control binding expression: ${e}`),e.substring(0,t).trimEnd())}evaluate(e,t){e=this.removeConvertersFromExpression(e);const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,c.map)(({attributeHost:s,attributeName:r})=>s?s.getAttributeControl(r):new Z.FormControl(null)))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(fi)))(n||fi)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:fi,factory:fi.\u0275fac})}}const o_="DisableAttributeDeactivationUntilBRulesExecution";class _s extends Zp{constructor(e){super(),this._featureService=e,this._readonlyProperties=["readonly","disabled"]}getAttributeValueChangesInHybridMode(e,t,n,s){const r=e.getControl(t),o=s.slice(1);return this._getValuesStream(e,t,n,()=>{const l=this.getAttributeValuesStream(e,o).pipe((0,c.tap)(f=>r.setPropertyValue(n,f))),d=this.getAttributeValuesStream(e,`${t}:${n}`).pipe((0,c.filter)(()=>{const f=Object.getOwnPropertyDescriptor(e,o),I=!!f?.get,O=!!f?.set;return!(I&&!O)}),(0,c.tap)(f=>e[o]=f)),h=(0,u.from)(_r(e,o)).pipe((0,c.tap)(f=>r.setPropertyValue(n,f,!0)),(0,c.takeUntil)(l));return(0,u.merge)(h,l,d)})}_getDefaultValue(e){if(!e)return null;try{return JSON.parse(e)}catch{return e}}_getValuesStream(e,t,n,s){return this._readonlyProperties.includes(n)?(0,u.forkJoin)({disableAttributeDeactivation:this._featureService.getFeatureState(o_),hasBRulesAffectingAttribute:e._getIsAffectedByBusinessRules({name:t})}).pipe((0,c.switchMap)(({disableAttributeDeactivation:r,hasBRulesAffectingAttribute:o})=>r||o!==!0?s():e._businessRulesActivated$.pipe((0,c.switchMap)(l=>l?s():(0,u.of)(!0))))):s()}getAttributeValueChanges(e){const{attributeHost:t}=e;if(!t)return(0,u.of)(null);const[n,s]=e.attributeName.split(":"),[r,o]=s.split("="),l=t.getControl(n),d=this._getDefaultValue(o);if(typeof d=="string"&&d?.startsWith("$"))return this.getAttributeValueChangesInHybridMode(t,n,r,d);if(d!=null){const h=l.getPropertyByName(r,!0);h.hasInitialValue||h.setInitialValue(d)}return this._getValuesStream(t,n,r,()=>{const h=this.getAttributeValuesStream(t,`${n}:${r}`),f=(0,u.of)(l.getPropertyValue(r)).pipe((0,c.filter)(I=>I!=null),(0,c.takeUntil)(h));return(0,u.merge)(f,h)})}static{this.\u0275fac=function(t){return new(t||_s)(i.\u0275\u0275inject(hn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:_s,factory:_s.\u0275fac})}}class ys{evaluate(e,t){const n=e.slice(1);return yr(t).viewModel$.pipe((0,c.switchMap)(s=>s?_r(s,n):(0,u.of)(null)))}static{this.\u0275fac=function(t){return new(t||ys)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ys,factory:ys.\u0275fac})}}class Cr{static{this.\u0275fac=function(t){return new(t||Cr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Cr,factory:Cr.\u0275fac})}}function Un(a,e){if(a.split(".").length<2)throw new Error(`Error when register ${a}. Type property should have format "VendorPrefix.${e}"`)}function sv(a,e){return Un(a,e)}function c_(a){const[e,t]=a.split("."),n=Wp(t);if(!e||n!==t)throw new Error(`Error when register ${a}. Type property should have Pascal case, e.g. ${e+"."+n}. The first letter of each word in a compound word should be capitalized`)}function Qc(a){const[e,t]=a.split("."),n=Wp(t);if(e.toLowerCase()==="crt"&&n!==t)throw new Error(`Error when register ${a}. Type property should have Pascal case, e.g. ${e+"."+n}. The first letter of each word in a compound word should be capitalized`)}function Wp(a){return(0,T.upperFirst)((0,T.camelCase)(a))}function l_(a,e){if(!e)throw new Error(`Error when resolve ${a}. Type was not registered.`)}function $p(a,e,t){if(t.has(a)&&!(0,T.isEqual)(t.get(a),e))throw new Error(`Error when register ${a}. Element with this type has already exist`)}class Gp extends ce{static{this.registryKey="ConverterRegistry"}static has(e){return this.store.typeInfos.has(e)}static find(e){return this.store.typeInfos.get(e)}static get(e){const t=this.find(e);if(!t)throw new Error(`'${e}' converter doesn't exist`);return t}static register(e){Un(e.type,"ConverterTypeName"),Qc(e.type);const t=this.find(e.type);this.store.typeInfos.set(e.type,{...t??{},...e})}static clear(){this.store.typeInfos.clear()}}class Mr{constructor(){this._converterRegistry=Gp,this._injector=(0,i.inject)(i.Injector)}get(e,t){return this._converterRegistry.get(e).instantiate(t)}register(e,t){throw new Error("NotImplemented")}clear(){this._converterRegistry.clear()}static{this.\u0275fac=function(t){return new(t||Mr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Mr,factory:Mr.\u0275fac,providedIn:"root"})}}var ve;(function(a){a.LoadNext="loadNext",a.Load="load",a.Reload="reload"})(ve||(ve={}));var ne;(function(a){a.PrimaryColumnValue="primaryColumnValue",a.ColumnValue="columnValue",a.Filter="filter",a.PrimaryDisplayValueFilter="primaryDisplayValueFilter",a.Empty="empty",a.Never="never"})(ne||(ne={}));var $t;(function(a){a.ViewElement="viewElement",a.Page="page"})($t||($t={}));var Cn;(function(a){a.Model="Model",a.ViewModel="ViewModel"})(Cn||(Cn={}));var Hn;(function(a){a.Unknown="Unknown",a.Init="Init",a.Create="Create",a.Copy="Copy",a.Update="Update"})(Hn||(Hn={}));function u_(a,e){return!!e?.find(n=>!n.scopeId&&n.triggers.find(s=>s.name===a.name))}function d_(a,e){return!!e?.find(n=>n.scopeName===a.scopeName&&n.triggers?.find(s=>s.name===a.name))}function h_(a,e,t){if(e.scopeName===a){if(u_(e,t))return!1}else if(d_(e,t))return!1;return!0}function Jc(a,e){return a===e||Qp(a)&&Qp(e)}function Qp(a){return!a||a==="null"}var Ir;(function(a){a.PTP="PTPMsg",a.BROADCAST="BroadcastMsg",a.SERVER="ServerMsg"})(Ir||(Ir={}));class Jp{constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.enabled=!0,this.uId=e?.uId||(0,A.qv)(),e&&(this.enabled=e.enabled)}toMetadata(){return{typeName:this.typeName,uId:this.uId,enabled:this.enabled}}getTypeName(){return this.typeName}getApplicability(){return[]}isValid(){return!0}onDataSourceAttributeNameChanged(e,t,n){}isAttributeUsed(e,t){return!1}getAffectedItems(){return[]}getRequiredItems(){return[]}hasScopeAttributes(e){return!1}}const p_="businessRuleActionDesignerType";function Tt(a){return function(e){Reflect.defineMetadata(p_,a,e)}}var Cs=m(47149),_i;(function(a){a.Const="Const",a.SysValue="SysValue",a.SysSetting="SysSetting",a.AttributeValue="AttributeValue",a.AttributeProperty="AttributeProperty",a.Formula="Formula"})(_i||(_i={}));class yi{get dataValueTypeName(){return this._dataValueTypeName}set dataValueTypeName(e){this._dataValueTypeName=e}get isLookup(){return this.dataValueTypeName===Cs.Q[C.r.Lookup].name}get referenceSchemaName(){return this._referenceSchemaName}set referenceSchemaName(e){this._referenceSchemaName!==e&&(this._referenceSchemaName=e)}constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleExpression",this._dataValueTypeName="",this._referenceSchemaName="",this.type=_i.Const,this.uId=e?.uId||(0,A.qv)(),e&&(this._dataValueTypeName=e.dataValueTypeName??"",this.type=e.type||this.type,this._referenceSchemaName=e.referenceSchemaName??"")}toMetadata(){return{typeName:this.typeName,uId:this.uId,type:this.type,dataValueTypeName:this.dataValueTypeName,referenceSchemaName:this.referenceSchemaName}}copy(){return new yi({...this.toMetadata(),uId:(0,A.qv)()})}isValid(){return!!this.uId}onDataSourceAttributeNameChanged(e,t,n){}getAffectedItem(){return null}clear(){throw new Error(`clear not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}setValue(e){throw new Error(`setValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}getValue(){throw new Error(`getValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isEmpty(){throw new Error(`isEmpty not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isAttributeUsed(e,t){return!1}hasScopeAttributes(e){return!1}}class qc{static{this._expressionsTypes=new Map}static register(e,t){this._expressionsTypes.set(e,t)}static _getExpressionType(e){return this._expressionsTypes.get(e)??null}get(e){if(!e)return new yi;const t=qc._getExpressionType(e.typeName);return t?new t(e):new yi(e)}}function Uu(a){return function(e){qc.register(a.typeName,e)}}var Hu;let Yu=Hu=class extends yi{get displayValue(){return this._displayValue}set displayValue(e){this._displayValue=e}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression",this._displayValue="",this.path="",this.scopeId="",this.type=_i.AttributeValue,e&&(this.path=e.path,this.scopeId=e.scopeId==="null"?"":e.scopeId)}toMetadata(){return{...super.toMetadata(),path:this.path,scopeId:this.scopeId}}copy(){return new Hu({...this.toMetadata(),uId:(0,A.qv)()})}isValid(){return super.isValid()&&!!this.path}onDataSourceAttributeNameChanged(e,t,n){this.scopeId===e&&this.path===t&&(this.path=n)}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t&&Jc(this.scopeId,e)}hasScopeAttributes(e){return Jc(this.scopeId,e)}isEmpty(){return!this.path}getValue(){return{value:this.path,displayValue:this.displayValue}}};Yu=Hu=(0,p.__decorate)([Uu({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression"}),(0,p.__metadata)("design:paramtypes",[Object])],Yu);var Kc;let Yn=Kc=class extends Jp{constructor(e){super(e),this._expressionFactory=new qc,this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.executorName="",e&&(this.executorName=e.executorName,this.expression=new Yu(e.expression),e.value&&(this.value=this._expressionFactory.get(e.value)))}getExpressionAffectedItems(){const e=this.expression?.getAffectedItem()??null;return e?[e]:[]}toMetadata(){return{...super.toMetadata(),executorName:this.executorName,expression:this.expression?.toMetadata(),value:this.value?.toMetadata()}}clone(){return new Kc(this.toMetadata())}copy(){const e=new Kc({...this.toMetadata(),uId:(0,A.qv)()});return e.expression=this.expression?.copy(),e.value=this.value?.copy(),e}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();return t?[{path:t}]:[]}isValid(){return super.isValid()&&!!this.expression?.isValid()&&!!this.value?.isValid()}getAffectedItems(){const e=this.getExpressionAffectedItems();return[...super.getAffectedItems(),...e]}};Yn=Kc=(0,p.__decorate)([Tt("BusinessRuleDesignAction"),(0,p.__metadata)("design:paramtypes",[Object])],Yn);class m_ extends Jp{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetProperty"}}class Ms extends m_{constructor(e){super(e),this.items=[],e&&(Array.isArray(e.items)?this.items=e.items:this.items=e.items?.length>0?e.items.split(","):[])}_getAffectedItems(){return(this.items??[]).map(t=>({name:t}))}toMetadata(){return{...super.toMetadata(),items:this.items?.length>0?this.items.join(","):""}}getApplicability(){return this.isValid()?this.items.map(e=>({path:e})):[]}isValid(){return super.isValid()&&this.items?.length>0}getAffectedItems(){return[...super.getAffectedItems(),...this._getAffectedItems()]}isAttributeUsed(e,t){return this.items.includes(t)}}var Xc;const g_="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement";let Zu=Xc=class extends Ms{constructor(){super(...arguments),this.typeName=g_}clone(){return new Xc(this.toMetadata())}copy(){return new Xc({...this.toMetadata(),uId:(0,A.qv)()})}};Zu=Xc=(0,p.__decorate)([Tt("BusinessRuleEditableElementDesignAction")],Zu);var Wu;let el=Wu=class extends yi{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression",this.path="",this.filterExpression="",e&&(this.path=e.path,this.filterExpression=e.filterExpression==="null"?"":e.filterExpression)}toMetadata(){return{...super.toMetadata(),path:this.path,filterExpression:this.filterExpression}}copy(){return new Wu({...this.toMetadata(),uId:(0,A.qv)()})}isValid(){return super.isValid()&&!!this.path&&!!this.filterExpression}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t}hasScopeAttributes(e){return!1}};el=Wu=(0,p.__decorate)([Uu({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression"}),(0,p.__metadata)("design:paramtypes",[Object])],el);var tl;let $u=tl=class extends Yn{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup",this.clearValue=!1,this.populateValue=!1,e?(this.clearValue=e.clearValue??!1,this.populateValue=e.populateValue??!1):(this.clearValue=!0,this.populateValue=!0),this._processMetadata(e)}_isOldMetadataFormat(e){const t=!!e.expression?.path&&e.expression.path!=="null",n=e.value,s=!!n?.value&&n.value!=="null";return t&&s}_convertOldMetadata(e){const t={...e},n=e.expression?.path||"",r=e.value?.value,o={path:r,filterExpression:""},l={path:n,filterExpression:""};if(r.includes(".")){const[d,...h]=r.split(".");o.path=d,o.filterExpression=h.join(".")}return{...t,leftExpression:o,rightExpression:l}}_processMetadata(e){e&&(this._isOldMetadataFormat(e)&&(e=this._convertOldMetadata(e)),delete this.expression,delete this.value,this.leftExpression=new el(e?.leftExpression),this.rightExpression=new el(e?.rightExpression))}toMetadata(){return{...super.toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue}}clone(){return new tl({...this.toMetadata()})}copy(){return new tl({...super.copy().toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue})}getApplicability(){return this.leftExpression?.path?[{path:this.leftExpression.path}]:[]}isValid(){return!!this.leftExpression?.isValid()&&!!this.rightExpression?.path}getAffectedItems(){const e=this.leftExpression?.getAffectedItem()??null,t=[...super.getAffectedItems()];return e&&t.push(e),t}getRequiredItems(){return[this.rightExpression?.getAffectedItem()].filter(e=>e)}isAttributeUsed(e,t){return this.leftExpression.isAttributeUsed(e,t)||this.rightExpression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.leftExpression.hasScopeAttributes(e)||this.rightExpression.hasScopeAttributes(e)}};$u=tl=(0,p.__decorate)([Tt("BusinessRuleFilterLookupAction"),(0,p.__metadata)("design:paramtypes",[Object])],$u);var nl;let Gu=nl=class extends Ms{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"}clone(){return new nl(this.toMetadata())}copy(){return new nl({...this.toMetadata(),uId:(0,A.qv)()})}};Gu=nl=(0,p.__decorate)([Tt("BusinessRuleHideElementDesignAction")],Gu);var il;const qp="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionOptionalElement";let Qu=il=class extends Ms{constructor(){super(...arguments),this.typeName=qp}clone(){return new il(this.toMetadata())}copy(){return new il({...this.toMetadata(),uId:(0,A.qv)()})}};Qu=il=(0,p.__decorate)([Tt("BusinessRuleOptionalElementDesignAction")],Qu);var sl;const f_="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement";let Ju=sl=class extends Ms{constructor(){super(...arguments),this.typeName=f_}clone(){return new sl(this.toMetadata())}copy(){return new sl({...this.toMetadata(),uId:(0,A.qv)()})}};Ju=sl=(0,p.__decorate)([Tt("BusinessRuleReadOnlyElementDesignAction")],Ju);var al;const Kp="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionRequiredElement";let qu=al=class extends Ms{constructor(){super(...arguments),this.typeName=Kp}clone(){return new al(this.toMetadata())}copy(){return new al({...this.toMetadata(),uId:(0,A.qv)()})}};qu=al=(0,p.__decorate)([Tt("BusinessRuleRequiredElementDesignAction")],qu);const __=Symbol("CreateModelFrom");class _t extends qa{constructor(e){super(),this.requestType="crt.ModelGenerator",this._crtModel=e}static get instance(){return this._instance||(this._instance=new _t),this._instance}get name(){return this._crtModel?.name}static[__](e){return new _t(e)}static create(e){var t=this;return(0,S.A)(function*(){const n=yield t.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},"");return new _t(n)})()}getSchema(){return this._crtModel._getAsyncResult(this._crtModel.getSchema())}load(e){return e?.loadOptions&&!e?.options&&(e.options=e.loadOptions),this._crtModel._getAsyncResult(this._crtModel.load(e))}insert(e){return this._crtModel._getAsyncResult(this._crtModel.insert(e))}update(e,t){var n=this;return(0,S.A)(function*(){const s=Object.keys(e);if(s.length){const o=(yield n.getSchema()).primaryAttributeName;s.filter(l=>l!==o).forEach(l=>n._crtModel.attributeChanged(l))}return n._crtModel._getAsyncResult(n._crtModel.update(e,t))})()}copy(e,t={}){return this._crtModel._getAsyncResult(this._crtModel.copy(e,t))}create(e={}){return this._crtModel._getAsyncResult(this._crtModel.create(e))}delete(e){return this._crtModel._getAsyncResult(this._crtModel.delete(e))}canSave(e){return this._crtModel._getAsyncResult(this._crtModel.canSave(e))}canDelete(e){return this._crtModel._getAsyncResult(this._crtModel.canDelete(e))}insertInTransaction(e,t){return this._crtModel.insertInTransaction(e,t)}updateInTransaction(e,t,n){return this._crtModel.updateInTransaction(e,t,n)}deleteInTransaction(e,t){return this._crtModel.deleteInTransaction(e,t)}}(0,p.__decorate)([It({methodName:"generateOne"}),(0,p.__metadata)("design:type",Function)],_t.prototype,"_create",void 0);class y_{static _getPrimaryDisplayAttributeName(e){return(0,S.A)(function*(){return(yield e.getSchema()).primaryDisplayAttributeName})()}static getLookupValue(e,t){var n=this;return(0,S.A)(function*(){const s=yield _t.create(e),r=yield s.getSchema(),o=[r.primaryAttributeName,r.primaryDisplayAttributeName];r.primaryColorAttributeName&&o.push(r.primaryColorAttributeName);const l=yield s.load({parameters:[{type:ne.PrimaryColumnValue,value:t}],attributes:o});if(!l||l.length===0)throw new Error(`Can't find value for '${t}'`);if(l.length>1)throw new Error(`Load more than 1 data row for '${t}'`);const d=l[0],h=yield n._getPrimaryDisplayAttributeName(s),f={value:t,displayValue:d[h]};return r.primaryColorAttributeName&&(f.primaryColorValue=d[r.primaryColorAttributeName]),f})()}}var Ku;let Xu=Ku=class extends yi{get value(){return this._value}set value(e){this._value!==e&&(this._displayValueInitialized=!1,this._value=e)}get referenceSchemaName(){return super.referenceSchemaName}set referenceSchemaName(e){this.referenceSchemaName!==e&&(super.referenceSchemaName=e,this._displayValueInitialized=!1)}get displayValue(){return this.isLookup&&this.referenceSchemaName?this._displayValueInitialized?this._displayValue:null:(this._displayValue=this.value,this._displayValueInitialized=!0,this._displayValue)}set displayValue(e){this._displayValue=e??"",this._displayValueInitialized=e!=null}get dataValueTypeName(){return super.dataValueTypeName}set dataValueTypeName(e){this.dataValueTypeName!==e&&(super.dataValueTypeName=e,this._displayValueInitialized=!1)}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression",this._value="",this._displayValue="",this._displayValueInitialized=!1,e&&(this._value=e.value)}initDisplayValue(){var e=this;return(0,S.A)(function*(){if(e._displayValueInitialized)return Promise.resolve(e._displayValue);if(e.isLookup&&e.referenceSchemaName&&e._value){const t=yield y_.getLookupValue(e.referenceSchemaName,e._value);e._displayValue=t.displayValue}else e._displayValue=e.value;return e._displayValueInitialized=!0,Promise.resolve(e._displayValue)})()}toMetadata(){return{...super.toMetadata(),value:this.value}}copy(){return new Ku({...this.toMetadata(),uId:(0,A.qv)()})}isValid(){return super.isValid()?this.isLookup?(0,A.n7)(this.value):this.value!=null&&this.value!=="":!1}clear(){this._value="",this._displayValue="",this._displayValueInitialized=!1}setValue(e){e?(this.value=e.value,this.displayValue=e.displayValue):this.clear()}getValue(){return{value:this.value,displayValue:this.displayValue}}isEmpty(){return!this.value}};Xu=Ku=(0,p.__decorate)([Uu({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression"}),(0,p.__metadata)("design:paramtypes",[Object])],Xu);var rl;let ed=rl=class extends Yn{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter",e&&(this.value=new Xu(e.value))}clone(){return new rl(this.toMetadata())}copy(){return new rl(super.copy().toMetadata())}getApplicability(){return this.expression?.path?[{path:this.expression.path}]:[]}isAttributeUsed(e,t){return this.expression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.expression.hasScopeAttributes(e)}};ed=rl=(0,p.__decorate)([Tt("BusinessRuleSetFilterAction"),(0,p.__metadata)("design:paramtypes",[Object])],ed);var ol;let td=ol=class extends Yn{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"}clone(){return new ol(this.toMetadata())}copy(){return new ol(super.copy().toMetadata())}};td=ol=(0,p.__decorate)([Tt("BusinessRuleSetValueDesignAction")],td);var nd;(function(a){a.DataSource="DataSource",a.Page="Page"})(nd||(nd={}));var cl;let id=cl=class extends Yn{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleSetValueItem",this.scope=e?.scopeId??"",this.scope==="null"&&(this.scope="")}clone(){return new cl(this.toMetadata())}copy(){return new cl({...super.copy().toMetadata(),scopeId:this.scope})}toMetadata(){return{...super.toMetadata(),scopeId:this.scope}}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();if(!t)return[];const n={path:t};return this.scope!==""&&(n.applicability=nd.DataSource,n.scope=this.scope),[n]}isAttributeUsed(e,t){return this.expression.path===t&&Jc(this.scope,e)}hasScopeAttributes(e){return Jc(this.scope,e)}};id=cl=(0,p.__decorate)([Tt("BusinessRuleSetValueItem"),(0,p.__metadata)("design:paramtypes",[Object])],id);var ll;let sd=ll=class extends Yn{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues",this.items=[],e&&(this.items=e.items?.map(t=>new id(t)))}getExpressionAffectedItems(){return[]}clone(){return new ll(this.toMetadata())}copy(){return new ll({...super.copy().toMetadata(),items:this.items.map(e=>e.toMetadata())})}toMetadata(){const e={...super.toMetadata(),items:this.items?.length>0?this.items.map(t=>t.toMetadata()):[]};return this.items?.length>0&&(delete e.expression,delete e.value),e}getApplicability(){return this.items?.length?this.items.flatMap(e=>e.getApplicability()):[]}isValid(){return this.items?.length>0&&this.items.every(e=>e.isValid())}getAffectedItems(){const t=(this.items??[]).map(n=>n.getAffectedItems()).flat();return[...super.getAffectedItems(),...t]}getRequiredItems(){return this.getAffectedItems()}isAttributeUsed(e,t){return this.items.some(n=>n.isAttributeUsed(e,t))}hasScopeAttributes(e){return this.items.some(t=>t.hasScopeAttributes(e))}};sd=ll=(0,p.__decorate)([Tt("BusinessRuleSetValuesDesignAction"),(0,p.__metadata)("design:paramtypes",[Object])],sd);var ul;let ad=ul=class extends Ms{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"}clone(){return new ul(this.toMetadata())}copy(){return new ul({...this.toMetadata(),uId:(0,A.qv)()})}};ad=ul=(0,p.__decorate)([Tt("BusinessRuleShowElementDesignAction")],ad);class Is{get(e){return e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"?new ad(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"?new Gu(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement"?new Ju(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement"?new Zu(e):e.typeName===qp?new Qu(e):e.typeName===Kp?new qu(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup"?new $u(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter"?new ed(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"?new td(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues"?new sd(e):new Yn(e)}static{this.\u0275fac=function(t){return new(t||Is)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Is,factory:Is.\u0275fac,providedIn:"root"})}}var dl;(function(a){a[a.Condition=0]="Condition",a[a.Action=1]="Action",a[a.Trigger=2]="Trigger",a[a.Context=3]="Context",a[a.Unknown=4]="Unknown"})(dl||(dl={}));const C_="crt-business-rules-cache";class M_{}class bs extends M_{constructor(e,t,n){super(),this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._cachedLoadScopesRequests=new Map,this.serviceEndpoint="/ServiceModel/BusinessRulesManagerService.svc/",this.getBusinessRulesConfigMethodName="GetBusinessRules"}_getBusinessRulesCache(){return this._cache?(0,u.of)(this._cache):(0,u.from)(this._cacheManager.get(C_)).pipe((0,u.tap)(e=>this._cache=e))}_getCachedBusinessRulesScopes(e){return e.length?this._getBusinessRulesCache().pipe((0,u.switchMap)(t=>{const n=e.map(s=>{const r=this._getContextCacheKey(s.scopeType,s.scopeName);return(0,u.from)(t.get(r)).pipe((0,u.map)(o=>o?{rules:o,scopeName:s.scopeName,scopeType:s.scopeType}:null))});return(0,u.forkJoin)(n)}),this._measurePerformanceService.measure$("BusinessRulesManager: get business rules from cache")):(0,u.of)([])}_getScopeType(e){return e==="Model"?Cn.Model:Cn.ViewModel}_mapResponseToBusinessRules(e){return!e?.businessRules||e.businessRules.length===0?[]:e.businessRules.map(t=>{const n=JSON.parse(t.businessRulesConfig);return{scopeName:t.schemaName,scopeType:this._getScopeType(t.type),rules:n}})}_getContextsScopeNames(e){return e.map(t=>t.scopeName)}_getContextCacheKey(e,t){return`Type:#${e}#-Name:#${t}#`}_getContextsScopeNamesRequestKey(e){return e.map(n=>this._getContextCacheKey(n.scopeType,n.scopeName)).join("_")}_getCachedLoadScopesRequest(e){const t=e.map(s=>this._getContextCacheKey(s.scopeType,s.scopeName)),n=[...this._cachedLoadScopesRequests.keys()].find(s=>t.every(r=>s.includes(r)));return this._cachedLoadScopesRequests.get(n)}_getNotLoadedBusinessRulesScopes(e){if(e.length===0)return(0,u.of)([]);const t=this._getContextsScopeNames(e),n=this._getCachedLoadScopesRequest(e);if(n)return n.request$.pipe((0,u.map)(l=>l.filter(d=>t.includes(d.scopeName))));const s=`${this.serviceEndpoint}${this.getBusinessRulesConfigMethodName}`,r={scopes:Array.from(new Map(e.map(l=>[this._getContextCacheKey(l.scopeType,l.scopeName),{name:l.scopeName,type:l.scopeType,modelType:l.modelType}])).values())},o=this._httpClient.post(s,r).pipe((0,u.map)(l=>this._mapResponseToBusinessRules(l)),(0,u.switchMap)(l=>l.length?this._getBusinessRulesCache().pipe((0,u.switchMap)(d=>{const h=l.map(f=>{const I=this._getContextCacheKey(f.scopeType,f.scopeName);return(0,u.from)(d.set(I,f.rules))});return(0,u.forkJoin)(h).pipe((0,u.map)(()=>l))}),this._measurePerformanceService.measure$("BusinessRulesManager: set loaded business rules to cache")):(0,u.of)(l)),(0,u.tap)(()=>{const l=this._getContextsScopeNamesRequestKey(e);this._cachedLoadScopesRequests.delete(l)}),(0,u.share)());return this._cachedLoadScopesRequests.set(this._getContextsScopeNamesRequestKey(e),{request$:o,scopeNames:t}),o}getBusinessRulesByContexts(e){const t=e.filter(n=>n.scopeName&&n.modelType!=="crt.PageParametersDataSource");return this._getCachedBusinessRulesScopes(t).pipe((0,u.switchMap)(n=>{const s=t.filter(o=>!n?.some(l=>l?.scopeName===o.scopeName&&l.scopeType===o.scopeType));return this._getNotLoadedBusinessRulesScopes(s).pipe((0,u.map)(o=>[...n,...o].filter(Boolean)),(0,u.catchError)(o=>{const l=t?.map(d=>d.scopeName).join(", ");return console.warn(`An error occurred during getting business rules execution for scopes: ${l}.`,o),(0,u.of)([])}))}))}clearCachedBusinessRules(){return this._getBusinessRulesCache().pipe((0,u.switchMap)(e=>(0,u.from)(e.clear())),(0,u.map)(()=>!0),this._measurePerformanceService.measure$("BusinessRulesManager: clear business rules from cache"))}static{this.\u0275fac=function(t){return new(t||bs)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(mt.G),i.\u0275\u0275inject(Ie.g))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:bs,factory:bs.\u0275fac,providedIn:"root"})}}var Me;(function(a){a.ChangeAttributeValue="ChangeAttributeValue",a.ChangeAttributeProperty="ChangeAttributeProperty",a.DataLoaded="DataLoaded",a.ContextReady="ContextReady"})(Me||(Me={}));const Xp=new Map([[0,Me.ChangeAttributeValue],[1,Me.ChangeAttributeProperty],[2,Me.DataLoaded]]);function hl(a){return Xp.has(a)?Xp.get(a):Me.DataLoaded}class br{canExecute(e,t,n){const s=n.map(o=>o.triggers).flat();return s.length===0?!1:(e?.triggers??[]).some(o=>o.type===Me.ContextReady)?n.some(o=>o.triggers.some(l=>hl(l.type)===Me.DataLoaded&&!l.name)):s.some(o=>{const l=hl(o.type);if(l===Me.DataLoaded&&e.scopeType===Cn.Model)return e.triggers.some(h=>h.type===Me.DataLoaded);if(!o.scopeId)return e.triggers.some(h=>h.name===o.name&&h.type===l);const d=t.find(h=>h.scopeId===o.scopeId);return d==null?!1:d.triggers.some(h=>h.name===o.name&&h.type===l)})}static{this.\u0275fac=function(t){return new(t||br)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:br,factory:br.\u0275fac})}}const I_="Terrasoft.Core.BusinessRules.Models.Conditions.BusinessRuleGroupCondition";function em(a){return a&&"path"in a?a.path:""}function b_(a){const e=[];return a.conditions&&a.conditions.forEach(t=>{const n=tm(t);e.push(...n)}),e}function tm(a){if(nm(a))return b_(a);const e=a;return[em(e.leftExpression),em(e.rightExpression)].filter(t=>t)}function S_(a,e){return a.flatMap(t=>e.get(t).getRequiredItems()).map(t=>t.name)}function nm(a){return a.typeName===I_}function im(a){return a.map(e=>tm(e)).flat().filter(e=>e!=null)}function v_(a,e){return a.flatMap(t=>t.cases.flatMap(n=>S_(n.actions,e)))}function T_(a){return!a.cases||a.cases.length===0?[]:a.cases.map(e=>e.condition).filter(e=>e!=null)}function sm(a){return a.map(e=>T_(e)).flat()}const x_=[_i.Const,_i.SysValue,_i.SysSetting],w_=new Set(x_);function am(a){return a?!!a.type&&w_.has(a.type):!0}function N_(a){return a.conditions?a.conditions.every(e=>rm(e)):!1}function rm(a){if(!a)return!1;if(nm(a))return N_(a);const e=a;return(0,T.isNil)(e.leftExpression)&&(0,T.isNil)(e.rightExpression)?!1:am(e.leftExpression)&&am(e.rightExpression)}function om(a){return a.some(e=>e.type===Me.ContextReady)}function E_(a,e){return om(a)?e.some(t=>rm(t)):!1}function D_(a,e){return om(a)?e.some(t=>t.cases?.some(n=>!n.condition)):!1}class Sr{_canExecuteByConditionsAttributePaths(e,t){const n=e.filter(r=>r.type!==Me.DataLoaded).map(r=>r.name);if(!n||n.length===0)return!1;const s=new Set(im(t));return n.some(r=>s.has(r))}canExecute(e,t){if(!t||t.length===0)return!1;const n=sm(t),s=E_(e.triggers,n),r=D_(e.triggers,t);return s||r?!0:this._canExecuteByConditionsAttributePaths(e.triggers,n)}static{this.\u0275fac=function(t){return new(t||Sr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Sr,factory:Sr.\u0275fac})}}class A_{get closed(){return this._closed}constructor(e){this._initialTeardown=e,this._closed=!1}unsubscribe(){this._closed||(this._closed=!0,(0,T.isFunction)(this._initialTeardown)&&this._initialTeardown())}}var O_=m(52874);const P_=new i.InjectionToken("MessageChannelAccessTokenFactory");var cm=m(66736);class vr{constructor(e){this._zone=e,this._message$=new u.Subject}init(e,t){return this._zone.runOutsideAngular(()=>{const n=t?{accessTokenFactory:t,withCredentials:!0}:void 0;return this._connection=new cm.HubConnectionBuilder().withUrl(e,n).withAutomaticReconnect().withHubProtocol(new cm.JsonHubProtocol).build(),this._connection.on("ServerMessage",s=>this._zone.run(()=>this._message$.next(s))),(0,u.from)(this._connection.start())})}sendMessage(e){return(0,u.from)(this._connection.send("SendMessage",e))}getMessages(){return this._message$}ngOnDestroy(){this._connection.off("ServerMessage"),this._message$.complete(),this._connection.stop().then()}static{this.\u0275fac=function(t){return new(t||vr)(i.\u0275\u0275inject(i.NgZone))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:vr,factory:vr.\u0275fac,providedIn:"root"})}}var k_=m(5766);const j_=1e3,lm=3e4,um=1e4,dm="ping",rd="pong";class Tr{constructor(e){this._ngZone=e}_createHeartbeatRequestMessage(){return{Id:(0,A.qv)(),Header:{Sender:"ConsoleCommand",BodyTypeName:"System.String"},Body:dm}}_isHeartbeatRequestMessage(e){const t=e.Header?.Sender==="ConsoleCommand",n=e.Body===dm;return t&&n}_isHeartbeatResponseMessage(e){const t=e.Header?.Sender==="CommandService",n=e.Body===rd;return t&&n}startHeartbeat(e){this.stopHeartbeat(),this._ngZone.runOutsideAngular(()=>{console.log(`WS-Heartbeat: connection ping scheduled for every [${lm/1e3}] sec`);const t=(0,u.timer)(j_,lm).pipe((0,u.tap)(()=>{e.next(this._createHeartbeatRequestMessage())}),(0,u.concatMap)(()=>(0,u.race)(e.pipe((0,u.filter)(n=>this._isHeartbeatResponseMessage(n)),(0,u.take)(1),(0,u.map)(n=>n.Body)),(0,u.of)("timeout").pipe((0,u.delay)(um)))));this._subscription=t.subscribe(n=>{switch(n){case rd:console.log(`WS-Heartbeat: Server responded with: ${rd}`);break;case"timeout":console.error(`WS-Heartbeat: Server failed to respond in ${um/1e3} seconds`);break}})})}stopHeartbeat(){this._subscription?.unsubscribe()}excludeHeartbeatResponses(){return(0,u.filter)(e=>!this._isHeartbeatRequestMessage(e)&&!this._isHeartbeatResponseMessage(e))}ngOnDestroy(){this.stopHeartbeat()}static{this.\u0275fac=function(t){return new(t||Tr)(i.\u0275\u0275inject(i.NgZone))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Tr,factory:Tr.\u0275fac,providedIn:"root"})}}const hm=[1,2e3,5e3,1e4,2e4,...Array(10).fill(3e4)],R_=hm.length;class xr{constructor(e){this._heartbeatService=e,this._reconnectAttempts=0,this._webSocketCreated$=new u.ReplaySubject(1),this._reconnected$=new u.Subject,this._isInitialConnection=!0}get reconnected$(){return this._reconnected$.asObservable()}_maxReconnectAttemptsReached(){return this._reconnectAttempts>=R_}_resetReconnectAttempts(){this._reconnectAttempts=0}_getWebSocketUrl(){var e=this;return(0,S.A)(function*(){const t=yield e._accessTokenFactory?.();return t?`${e._serverUrl}?access_token=${encodeURIComponent(t)}`:e._serverUrl})()}_scheduleReconnectionAttempt(e){if(this._maxReconnectAttemptsReached()){console.error("WebSocket: Max reconnect attempts reached",e);return}const t=hm[this._reconnectAttempts];setTimeout(()=>{this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!0}).catch(console.error),this._reconnectAttempts++},t)}_handleWebSocketClosed(e){this._heartbeatService.stopHeartbeat(),this._scheduleReconnectionAttempt(e)}_createAndConnectWebSocketAsync(e){var t=this;return(0,S.A)(function*(){let n;try{n=yield t._getWebSocketUrl()}catch(s){throw e.reconnectOnAccessTokenFactoryError&&t._scheduleReconnectionAttempt(s),s}return new Promise(s=>{t._webSocket$=(0,k_.webSocket)({url:n,openObserver:{next:()=>{console.log(`Websocket channel opened for url: ${t._serverUrl}`),t._heartbeatService.startHeartbeat(t._webSocket$),t._resetReconnectAttempts(),t._isInitialConnection||(console.log("WebSocket reconnected successfully"),t._reconnected$.next()),t._isInitialConnection=!1,s()}}}),t._webSocketSubscription?.unsubscribe(),t._webSocketSubscription=t._webSocket$.subscribe({error:r=>t._handleWebSocketClosed(r),complete:()=>t._handleWebSocketClosed()}),t._webSocketCreated$.next(t._webSocket$)})})()}_subscribeToSocketMessages(e,t){return e.pipe(this._heartbeatService.excludeHeartbeatResponses()).subscribe({next:n=>t.next(n),error:()=>{this._maxReconnectAttemptsReached()&&t.error(new Error("Max reconnect attempts reached"))}})}init(e,t){return this._serverUrl=e,this._accessTokenFactory=t,(0,u.from)(this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!1}))}sendMessage(e){return new u.Observable(t=>{this._webSocket$.next(e),t.next(),t.complete()})}getMessages(){return new u.Observable(e=>{let t;const n=this._webSocketCreated$.subscribe(s=>{t?.unsubscribe(),t=this._subscribeToSocketMessages(s,e)});return()=>{t.unsubscribe(),n.unsubscribe()}})}ngOnDestroy(){this._heartbeatService.stopHeartbeat(),this._webSocket$?.complete(),this._webSocketSubscription?.unsubscribe(),this._reconnected$.complete()}static{this.\u0275fac=function(t){return new(t||xr)(i.\u0275\u0275inject(Tr))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:xr,factory:xr.\u0275fac,providedIn:"root"})}}var pl=m(93248),od;(function(a){a.Production="production",a.PreProduction="pre-production",a.Development="development"})(od||(od={}));const pm=dt.create({serviceUrl:"",clientConnectionClassName:""}),av={provide:dt,useFactory:()=>pm};let wr=class nu{constructor(e,t,n){this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=n,this._serviceEndpoint="ServiceModel/ApplicationInfoService.svc/"}_initApplicationInfo(){const e=this._serviceEndpoint+"GetApplicationInfo";this._applicationInfoObservable$=this._cacheManager.executeWithCache(pl.HO,pl.oy,this._httpClient.post(e,null)).pipe(this._measurePerformanceService.measure$("ApplicationInfoService: load application info with cache"),(0,c.map)(t=>{const n=t?.applicationInfo,s=dt.create(n);return Object.assign(pm,s),t}),(0,c.shareReplay)({bufferSize:1,refCount:!1})),this._applicationInfoObservable$.subscribe()}loadApplicationInfo(){return this._applicationInfoObservable$||this._initApplicationInfo(),this._applicationInfoObservable$}loadApplicationResources(){const e=this._serviceEndpoint+"GetApplicationResources";return this._cacheManager.executeWithCache(pl.HO,"AppResources",this._httpClient.post(e,null))}loadSysValues(){return this.loadApplicationInfo().pipe((0,c.map)(e=>e?.applicationInfo?.sysValues))}getCoreVersion(){return this._coreVersion?(0,u.of)(this._coreVersion):this.loadSysValues().pipe((0,u.tap)(e=>this._coreVersion=e?.coreVersion),(0,c.map)(()=>this._coreVersion))}getIsProductionEnvironment(){return(this._environmentType?(0,u.of)(this._environmentType):this.loadSysValues().pipe((0,u.tap)(t=>this._environmentType=t?.environmentType),(0,c.map)(()=>this._environmentType))).pipe((0,c.map)(t=>t===od.Production))}static{this.\u0275fac=function(t){return new(t||nu)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(mt.G),i.\u0275\u0275inject(Ie.g))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:nu,factory:nu.\u0275fac,providedIn:"root"})}};wr=(0,p.__decorate)([(0,P.op)({requestType:"crt.SysValuesService"}),(0,p.__metadata)("design:paramtypes",[E.HttpClient,mt.G,Ie.g])],wr);const rv={provide:i.APP_INITIALIZER,useFactory:a=>()=>a.loadApplicationInfo(),deps:[wr],multi:!0};let ml=class iu{get reconnected$(){return this.msgChannel?.reconnected$||u.EMPTY}constructor(e,t,n,s){this.injector=s,this._destroyed$=new u.Subject,this.init$=new u.ReplaySubject(1),this.messageEvent$=new u.Subject,!e.clientConnectionClassName||e.clientConnectionClassName===""?t.loadApplicationInfo().subscribe(r=>{this._initialize(r.applicationInfo,n)}):this._initialize(e,n)}_initialize(e,t){this.msgChannel=this._getChannel(e.clientConnectionClassName),this._initChannel(e.serviceUrl,t)}_getChannel(e){switch(e){case"Terrasoft.WebSocketChannel":return this.injector.get(xr);case"Terrasoft.SignalRChannel":return this.injector.get(vr)}}_buildMessageEvent(e){let t;if(e.Body&&typeof e.Body=="string")try{t=JSON.parse(e.Body)}catch(n){return(0,i.isDevMode)()&&console.warn(`MessageChannelService. Parse error: ${n}`),null}else e.Body&&typeof e.Body=="object"&&(t=e.Body);return{header:{sender:e?.Header?.Sender,bodyTypeName:e?.Header?.BodyTypeName},body:t,id:e.Id}}_subscribeToMsgChannel(){this.msgChannel.getMessages().pipe((0,c.takeUntil)(this._destroyed$)).subscribe(e=>{const t=this._buildMessageEvent(e);t&&this.messageEvent$.next(t)})}_initChannel(e,t){this.msgChannel.init(e,t).subscribe({complete:()=>{this.init$.next(this.msgChannel),this._subscribeToMsgChannel()}})}_sendMessageInternal(e,t,n){const s={Id:O_.Guid.create().toString(),Header:{Sender:e,BodyTypeName:"System.String",ChannelType:t},Body:JSON.stringify(n)};return this.init$.pipe((0,u.take)(1),(0,c.switchMap)(()=>this.msgChannel.sendMessage(s)))}getMessages(e){return q.checkArgumentEmpty("sender",e),this.messageEvent$.pipe((0,c.filter)(t=>t.header.sender===e))}subscribe(e,t){q.checkArgumentEmpty("sender",e),q.checkArgumentEmpty("callback",t);const n=this.getMessages(e).subscribe(t);return Promise.resolve(new A_(()=>n.unsubscribe()))}sendMessage(e,t,n){let s,r;const o=!!n;o?(s=e,r=t,q.checkStringIsNotEmpty("sender",s),q.checkEnumOutOfRange("channelType",n,Ir)):(r=e,s=t,q.checkArgumentEmpty("channelType",s),q.checkEnumOutOfRange("channelType",s,Ir));const l=this._sendMessageInternal(s,n,r);return o?(0,u.firstValueFrom)(l):l}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.init$.complete(),this.messageEvent$.complete()}static{this.\u0275fac=function(t){return new(t||iu)(i.\u0275\u0275inject(dt),i.\u0275\u0275inject(wr),i.\u0275\u0275inject(P_,8),i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:iu,factory:iu.\u0275fac,providedIn:"root"})}};ml=(0,p.__decorate)([(0,P.op)({requestType:"crt.MessageChannelService"}),(0,p.__metadata)("design:paramtypes",[dt,wr,Function,i.Injector])],ml);class Nr{constructor(e,t){this._businessRulesManager=e,this._businessRuleDesignActionFactory=t,this._scopeAttributes=[]}_filterTriggers(e,t){const n=t.filter(o=>o.scopeName===e.parentScopeId),r=t.find(o=>o.scopeName===e.scopeName&&o.scopeType===e.scopeType)?.rules.map(o=>o.triggers).flat();return e.triggers.filter(o=>{if(o.type===Me.ContextReady||o.type===Me.DataLoaded)return!0;const l=r?.some(f=>f&&f.name===o.name&&hl(f.type)===o.type),h=n.flatMap(f=>f.rules.flatMap(I=>I.triggers)).some(f=>f.name===o.name&&hl(f.type)===o.type);return l||h})}_filterAttributes(e){const n=this._scopeAttributes.filter(o=>o.scopeName===e.scopeName).map(o=>o.attributes).flat(),s=this._scopeAttributes.filter(o=>o.scopeName!==e.scopeName).flatMap(o=>[...o.attributes]);return e.attributes.filter(o=>n.includes(o.attributeName)||s.includes(o.attributeName)||o.isSignificant)}_cacheUsedAttributes(e){e.forEach(t=>{if(!this._scopeAttributes.find(n=>n.scopeName===t.scopeName&&n.scopeType===t.scopeType)){const n=sm(t.rules),s=im(n),r=v_(t.rules,this._businessRuleDesignActionFactory),o=t.rules.flatMap(l=>l.triggers?.map(d=>d.name)).filter(Boolean);this._scopeAttributes.push({scopeName:t.scopeName,scopeType:t.scopeType,attributes:[...s,...r,...o]})}})}_hasActiveRules(e,t){return(t.find(o=>o.scopeName===e.scopeName&&o.scopeType===e.scopeType)?.rules??[]).filter(o=>o.enabled===!0).length>0}clearCachedScopeAttributes(){this._scopeAttributes=[]}filter(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,u.tap)(t=>this._cacheUsedAttributes(t)),(0,u.map)(t=>e.map(s=>({...s,attributes:this._filterAttributes(s),triggers:this._filterTriggers(s,t)})).filter(s=>this._hasActiveRules(s,t)?!0:s.attributes.length>0)))}static{this.\u0275fac=function(t){return new(t||Nr)(i.\u0275\u0275inject(bs),i.\u0275\u0275inject(Is))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Nr,factory:Nr.\u0275fac,providedIn:"root"})}}class Er{constructor(e,t,n,s,r,o,l){this._businessRulesManager=e,this._businessRulesTriggerExecutor=t,this._businessRulesConditionExecutor=n,this._httpClient=s,this._messageChannelService=r,this._featureService=o,this._contextFilter=l,this._businessRulesResponseEventName="BusinessRuleExecutionResponse",this._serviceUrl="ServiceModel/BusinessRulesEngineService.svc/Execute",this._businessRulesRequestEventName="BusinessRuleExecutionRequest",this._businessRuleDesignActionFactory=new Is,this._configurationStructureChangedSubscribe()}_configurationStructureChangedSubscribe(){this._messageChannelService.getMessages("ConfigurationStructureChanged").pipe((0,c.switchMap)(()=>(this._contextFilter.clearCachedScopeAttributes(),this._businessRulesManager.clearCachedBusinessRules()))).subscribe()}_featureStates(){return(0,u.from)(this._featureService.getFeaturesState(["BRules-UseWebSocketChannel","BRules-DisableContextOptimization"])).pipe((0,c.map)(([e,t])=>({useHttpChannel:!e,disableContextOptimization:t})))}_sendWebSocketMessage(e){const t=(0,A.qv)();return e.businessRulesSessionId=t,new u.Observable(n=>{const s=this._messageChannelService.messageEvent$.pipe((0,c.map)(r=>r.body),(0,c.filter)(r=>r!=null),(0,c.filter)(r=>r.eventName===this._businessRulesResponseEventName),(0,c.filter)(r=>r.businessRulesSessionId===t),(0,c.map)(r=>r.payload)).subscribe({next:r=>{s.unsubscribe(),r.success?n.next(r.businessRulesResponse):(console.error("An error occurred during business rules execution. "+r.errorInfo.errorCode+": "+r.errorInfo.message),n.next([])),n.complete()},error:r=>{s.unsubscribe(),console.error("An error occurred during business rules execution. "+r.errorCode+": "+r.message),n.next([]),n.complete()},complete:()=>{s.unsubscribe(),n.error("WebSocket channel closed")}});this._messageChannelService.sendMessage(e,Ir.PTP).pipe((0,u.take)(1)).subscribe()})}_createWebSocketRequest(e){return{eventName:this._businessRulesRequestEventName,contexts:e}}_executeUsingWebSocket(e){const t=this._createWebSocketRequest(e);return this._sendWebSocketMessage(t)}_logErrorMessageAndReturnDefBusinessRuleResponse(e){return console.error("An error occurred during business rules execution. "+e.errorCode+": "+e.message),(0,u.of)([])}_executeUsingHttp(e){return this._httpClient.post(this._serviceUrl,{contexts:e},{headers:new E.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,c.mergeMap)(t=>t.success?(0,u.of)(t.businessRulesResponse):this._logErrorMessageAndReturnDefBusinessRuleResponse(t.errorInfo)),(0,c.catchError)(t=>this._logErrorMessageAndReturnDefBusinessRuleResponse(t)))}_canExecuteBusinessRulesByContexts(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,c.map)(t=>{const n=t.filter(s=>s.rules&&s.rules.length>0);return n.length===0?!1:n.some(s=>{const r=e.find(h=>h.scopeName===s.scopeName&&h.scopeType===s.scopeType),o=e.filter(h=>h.parentScopeId===r.scopeId),l=this._businessRulesTriggerExecutor.canExecute(r,o,s.rules),d=this._businessRulesConditionExecutor.canExecute(r,s.rules);return l||d})}))}_getContextsWithScope(e){return e.filter(t=>t.scopeName&&t.scopeId)}_getBusinessRuleActions(e){return e.cases.map(t=>t.actions).flat().filter(t=>t.enabled).map(t=>this._businessRuleDesignActionFactory.get(t))}_getBusinessRuleAffectedAttributes(e){return this._getBusinessRuleActions(e).map(n=>n.getAffectedItems()).flat()}_getAffectedAttributes(e){let t=e.rules.filter(n=>n.enabled).map(n=>this._getBusinessRuleAffectedAttributes(n)).flat();return t=this._getUniqueAffectedAttributes(t),t.forEach(n=>{n.scopeName=e.scopeName}),t}_getUniqueAffectedAttributes(e){const t=e.map(s=>[s.name,s]);return[...new Map(t).values()]}_execute(e){return this._featureStates().pipe((0,c.switchMap)(({useHttpChannel:t,disableContextOptimization:n})=>(0,u.forkJoin)({useHttpChannel:(0,u.of)(t),executionContexts:n?(0,u.of)(e):this._contextFilter.filter(e)})),(0,c.switchMap)(({useHttpChannel:t,executionContexts:n})=>(t?this._executeUsingHttp(n):this._executeUsingWebSocket(n)).pipe((0,c.map)(s=>({executionResults:s,executionContexts:n})))),(0,c.switchMap)(({executionResults:t,executionContexts:n})=>this._logUnsuccessfulBusinessRulesExecution(t,n).pipe((0,c.map)(()=>t))))}_logUnsuccessfulBusinessRulesExecution(e,t){const n=e?.filter(s=>s?.errors?.length>0).map(s=>s.errors).flat();return n?.length===0?(0,u.of)(void 0):(0,u.from)(this._featureService.getFeatureState("BRules-ShowChildRules")).pipe((0,c.switchMap)(s=>this._businessRulesManager.getBusinessRulesByContexts(t).pipe((0,c.map)(r=>r.map(o=>o.rules).flat()),(0,c.tap)(r=>{n.map(o=>this._getUnsuccessfulBusinessRuleExecutionMessage(o,r,s)).forEach(o=>{console.error(o)})}),(0,c.map)(()=>{}))))}_getUnsuccessfulBusinessRuleExecutionMessage(e,t,n){const s="Business rule execution error: ",r=`Error message: "${e.message}"`,o=e.type===dl.Unknown?"":`The error occurred in the business rule ${dl[e.type]?.toLocaleLowerCase()}s.`;let l=t.find(O=>O.uId===e.businessRuleId);if(!l)return`${s}Rule id - "${e.businessRuleId}". ${r}. ${o}`;!(0,A.gZ)(l.parentUId)&&!n&&(l=t.find(O=>O.uId===l.parentUId));const d=l.caption||"",h=l.name,f=`Rule Title - "${d}"`,I=`Rule Code - "${h}"`;return`${s}${f}, ${I}. ${r}. ${o}`}execute(e){const t=this._getContextsWithScope(e);return t.length===0?(0,u.of)([]):this._canExecuteBusinessRulesByContexts(e).pipe((0,c.switchMap)(n=>n?this._execute(t):(0,u.of)([])),(0,c.catchError)(n=>(console.warn(`An error occurred during business rules execution for scopes: ${e?.map(s=>s.scopeName).join(", ")}.`,n),(0,u.of)([]))))}getAffectedAttributes(e){var t=this;return(0,S.A)(function*(){if(e.length===0)return[];const n=e.filter(o=>o.scopeName!=null),r=(yield(0,u.firstValueFrom)(t._businessRulesManager.getBusinessRulesByContexts(n))).filter(o=>o.rules&&o.rules.length>0);return r.length===0?[]:r.map(o=>t._getAffectedAttributes(o)).flat()})()}static{this.\u0275fac=function(t){return new(t||Er)(i.\u0275\u0275inject(bs),i.\u0275\u0275inject(br),i.\u0275\u0275inject(Sr),i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(ml),i.\u0275\u0275inject(Rn),i.\u0275\u0275inject(Nr))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Er,factory:Er.\u0275fac})}}class Ci{static{this._actionAppliers=new Map}static register(e,t){Ci._actionAppliers.set(e,t)}get(e){const t=Ci._actionAppliers.get(e.typeName);if(!t)throw new Error(`Business rule applier for change type ${e.typeName} not found.`);return new t(e)}static{this.\u0275fac=function(t){return new(t||Ci)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ci,factory:Ci.\u0275fac})}}class Dr{constructor(e){this._actionApplierFactory=e}_applyBusinessRuleAction(e,t,n){const s=this._actionApplierFactory.get(n);return(0,u.firstValueFrom)(s.apply(e,t))}_applyBusinessRule(e,t){var n=this;return(0,S.A)(function*(){const s={id:t.scopeId,name:t.scopeName,type:t.scopeType,triggers:t.triggers};if(t.actions.length===0)return Promise.resolve(null);const r=[];for(const o of t.actions){const l=yield n._applyBusinessRuleAction(e,s,o);r.push(l)}return r})()}_applyBusinessRules(e,t){var n=this;return(0,S.A)(function*(){const s=[];for(const r of t){const o=yield n._applyBusinessRule(e,r);s.push(o)}return s})()}applyRules(e,t){return t&&t.length>0?(0,u.from)(this._applyBusinessRules(e,t)):(0,u.of)(null)}static{this.\u0275fac=function(t){return new(t||Dr)(i.\u0275\u0275inject(Ci))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Dr,factory:Dr.\u0275fac})}}class L_{constructor(e={preventAttributeChangeRequest:!1,preventRunBusinessRules:!1,preventStateChange:!1,isMaskedValue:!1}){this._preventAttributeChangeRequest=!1,this._preventStateChange=!1,this._preventRunBusinessRules=!1,this._isMaskedValue=!1,this._setOptions(e)}_setUsingSilent(e){this._preventStateChange=e,this._preventRunBusinessRules=e,this._preventAttributeChangeRequest=!1}_setOptions(e){this._preventAttributeChangeRequest=e?.preventAttributeChangeRequest??this._preventAttributeChangeRequest,this._preventStateChange=e?.preventStateChange??this._preventStateChange,this._preventRunBusinessRules=e?.preventRunBusinessRules??this._preventRunBusinessRules,this._isMaskedValue=e?.isMaskedValue??this._isMaskedValue}getAsSilent(){return this._preventRunBusinessRules&&this._preventStateChange}getIsMaskedValue(){return this._isMaskedValue}setOptions(e){if((0,T.isUndefined)(e?.silent)){const t=(0,T.pick)(e,"preventAttributeChangeRequest","preventStateChange","preventRunBusinessRules","isMaskedValue");this._setOptions(t)}else this._setUsingSilent(e?.silent)}getOptions(){return{preventAttributeChangeRequest:this._preventAttributeChangeRequest,preventRunBusinessRules:this._preventRunBusinessRules,preventStateChange:this._preventStateChange,isMaskedValue:this._isMaskedValue}}reset(){this._preventAttributeChangeRequest=!1,this._preventRunBusinessRules=!1,this._preventStateChange=!1,this._isMaskedValue=!1}}var gl;(function(a){a.EntityDataSource="crt.EntityDataSource",a.WebServiceDataSource="crt.WebServiceDataSource",a.PageParametersDataSource="crt.PageParametersDataSource"})(gl||(gl={}));var Ss;(function(a){a.Reload="reload",a.Merge="merge"})(Ss||(Ss={}));function ov(a){const e=Object.keys(DataValueTypeGroup).find(t=>DataValueTypeGroup[t].includes(a));return DataValueTypeGroup[e]}function cv(a){return a===DataValueType.Lookup||a===DataValueType.Guid}function lv(a){return DataValueTypeItems[a]?.icon||null}function cd(a){return Object.values(Cs.Q).find(e=>e.name===a)?.type}function mm(a){return!(a&&!a?.value)}function V_(a){let e=!1;const t=[];return Object.keys(a).forEach(n=>{gm(n,a)&&(e=!0,t.push(n))}),{hasCycles:e,cycledModelsNames:t}}function gm(a,e,t=[]){if(!e[a])return!1;const n=Object.values(e[a]);return n.some(r=>t.includes(fm(r)))?!0:(t.push(a),!n.every(r=>!gm(fm(r),e,t)))}function fm(a){return a.relationPath.split(".")[0]}class _m{}var fl;(function(a){a.AddTask="addTask",a.RemoveTask="removeTask"})(fl||(fl={}));class ym extends _m{constructor(e,t,n){super(),this.action=e,this.taskName=t,this.$context=n,this.type="crt.SchemaViewMaskRequest"}}class Zn extends qa{constructor(){super(...arguments),this.requestType="crt.MaskService"}showMask(e,t){return(0,S.A)(function*(){const n=new ym(fl.AddTask,e,t);yield Ae.instance.process(n)})()}hideMask(e,t){return(0,S.A)(function*(){const n=new ym(fl.RemoveTask,e,t);yield Ae.instance.process(n)})()}}(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],Zn.prototype,"showBodyMask",void 0),(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],Zn.prototype,"hideBodyMask",void 0);const z_=new i.InjectionToken("DEVKIT_MASK_SERVICE",{providedIn:"root",factory:()=>new Zn});class Cm{constructor(e){this.ngZone=e}run(e,t,n){return this.ngZone.runOutsideAngular(e)}}class F_ extends Cm{constructor(e){super(e)}run(e,t,n){return this.ngZone.run(e,t,n)}}var _l;(function(a){a.Root="root",a.Angular="angular",a.ExecutionTracking="executionTracking"})(_l||(_l={}));var Wn;(function(a){a[a.Busy=0]="Busy",a[a.Idle=1]="Idle"})(Wn||(Wn={}));var yl;(function(a){a.ReadyStateChange="readystatechange"})(yl||(yl={}));class B_{constructor(e){this._trackedTasks=[],this._trackedEventTasks=[],this._enableDebugTracking=!1,this._disableWaits=!1,this._pendingFunctions=new Map,this.onStateChange$=new i.EventEmitter(!1),this._parentZone=Zone.current,this._rootZone=Zone.root,this._isBusy=!1,this._ignoredTaskSources=["setInterval","requestAnimationFrame"],this._eventTaskFilters=[t=>t.source.startsWith("XMLHttpRequest")&&t.source.endsWith(yl.ReadyStateChange)],this._zone=this._parentZone.fork({name:e,properties:{currentExecutionZone:this},onInvokeTask:this._onInvokeTask.bind(this),onCancelTask:this._onCancelTask.bind(this),onScheduleTask:this._onScheduleTask.bind(this),onHasTask:this._onHasTask.bind(this)})}wait(e){if(this._disableWaits)return e();this._isBusy||(this._isBusy=!0,this.onStateChange$.next(Wn.Busy));const t=(0,A.qv)();return this._pendingFunctions.set(t,this._enableDebugTracking?e:null),e().finally(()=>{this._pendingFunctions.delete(t),!this._pendingFunctions.size&&this._zone.run(()=>new Promise(n=>setTimeout(n)))}).catch(n=>{throw n})}_cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(e,t){if(e.type==="eventTask"&&(e.state==="running"||e.state==="scheduled")){const n=e;n.eventName===yl.ReadyStateChange&&n.target.readyState===XMLHttpRequest.DONE&&t.cancelTask(n)}}_onInvokeTask(e,t,n,s,r,o){this._unTrackTask(s);let l;try{l=e.invokeTask(n,s,r,o),this._cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(s,t)}catch(d){console.error(d),t.cancelTask(s)}return l}_onCancelTask(e,t,n,s){return this._unTrackTask(s),e.zone.runGuarded(()=>e.cancelTask(n,s))}_onScheduleTask(e,t,n,s){return this._getCanScheduleTask(s)?(this._trackTask(s),e.scheduleTask(n,s)):(s.cancelScheduleRequest(),this._parentZone.scheduleTask(s))}_onHasTask(e,t,n,s){e.hasTask(n,s);const r=s.eventTask||s.macroTask||s.microTask||this._pendingFunctions.size>0;this._isBusy!==r&&(this._rootZone.run(()=>this.onStateChange$.next(r?Wn.Busy:Wn.Idle)),this._isBusy=r)}_trackTask(e){this._enableDebugTracking&&(e.type==="eventTask"&&this._trackedEventTasks.push(e),this._trackedTasks.push(e))}_unTrackTask(e){if(!this._enableDebugTracking)return;const t=this._trackedTasks.indexOf(e);t>-1&&this._trackedTasks.splice(t,1)}_getCanScheduleTask(e){return e.type==="eventTask"?this._eventTaskFilters.some(t=>t(e)):this._ignoredTaskSources.indexOf(e.source)===-1}run(e,t,n){return this._zone.run(e,t,n)}}class vs{constructor(e){this._ngZone=e}createDefaultZones(){return{root:new Cm(this._ngZone),angular:new F_(this._ngZone)}}createZone(e,t){if(t===_l.ExecutionTracking)return new B_(e);throw new Error(`Zone ${e} with type ${t} is not supported`)}static{this.\u0275fac=function(t){return new(t||vs)(i.\u0275\u0275inject(i.NgZone))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:vs,factory:vs.\u0275fac,providedIn:"root"})}}var Mi;(function(a){a.Root="root",a.Angular="angular"})(Mi||(Mi={}));let Cl=class su{constructor(e){this._zoneProvider=e,this._zones=e.createDefaultZones()}init(e){var t=this;return(0,S.A)(function*(){t._disableExecutionTrackingZone=yield(0,u.lastValueFrom)(e("DisableExecutionTrackingZone"))})()}runInZone(e,t,n,s){return this._disableExecutionTrackingZone&&e!==Mi.Angular&&(e=Mi.Root),(this._zones[e]??this._zones[Mi.Root]).run(t,n,s)}register(e,t){if(this._zones[e])throw new Error(`Zone ${e} already registered`);const n=this._zoneProvider.createZone(e,t);return this._zones[e]=n,n}get(e){return this._zones[e]}runOutside(e){return this.runInZone(Mi.Root,e)}static{this.\u0275fac=function(t){return new(t||su)(i.\u0275\u0275inject(vs))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:su,factory:su.\u0275fac,providedIn:"root"})}};Cl=(0,p.__decorate)([(0,P.op)({requestType:"crt.ZoneService"}),(0,p.__metadata)("design:paramtypes",[vs])],Cl);const Mm=new i.InjectionToken("CRT_METADATA_PREPROCESSOR");class U_{constructor(e,t){this.id=e,this._baseHostInjector=t,this._hostModuleTypes=[],this._hostModuleRefs=[],this._lazyModulesBySource=new Map,this._hostInjector=this._baseHostInjector}_createDynamicNgModule(e){const n=this._hostInjector.get(Mm,[]).map(o=>({provide:Mm,useValue:o,multi:!0})),s=(0,i.NgModule)({providers:n})(class{}),r=(0,i.NgModule)({imports:[s,...e]})(class{});return(0,i.createNgModule)(r,this._hostInjector)}inject(e){return this._hostInjector.get(e)}addLazyModule(e){const t=Tp.get(e);if(!t)throw new Error("Module was not bootstrapped");const{source:n}=t;this._lazyModulesBySource.has(n)||this._lazyModulesBySource.set(n,new Set),this._lazyModulesBySource.get(n).add(e)}getLazyModules(e){return[...this._lazyModulesBySource.get(e)??[]]}connectHostLazyModules(){const e=this.getLazyModules("host");if((0,T.isEqual)(e,this._hostModuleTypes))return;const t=this._createDynamicNgModule(e);this._hostModuleTypes=e,this._hostModuleRefs.push(t),this._hostInjector=t.injector}destroy(){for(const e of this._hostModuleRefs)e.destroy();this._hostModuleRefs=[]}}class Ts extends Ot.S{constructor(){super(...arguments),this._injectionContextsMap=new Map}createContext(e,t){const n=new U_(e,t);return this._injectionContextsMap.set(e,n),n}injectFromContext(e,t){return this._injectionContextsMap.get(e)?.inject(t)}removeContext(e){return this._injectionContextsMap.get(e)?.destroy(),this._injectionContextsMap.delete(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Ts)))(n||Ts)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ts,factory:Ts.\u0275fac,providedIn:"root"})}}const H_=new i.InjectionToken("Terrasoft global object",{providedIn:"root",factory:()=>(0,T.get)((0,i.inject)(P.ZP),["Terrasoft"])||{}}),Y_=new i.InjectionToken("Flag indicating that this is an angular host",{providedIn:"root",factory:()=>(0,T.get)((0,i.inject)(H_),["isAngularHost"])}),Im=100;class xs extends Ot.S{constructor(){super(...arguments),this._window=(0,i.inject)(P.ZP),this._requestBuffer=[],this._requestIter=0,this._cachedRequestIter=0,this._compressedRequestIter=0}_onRequest(e){const t=e.getEntries();for(const n of t){if(!n.name.startsWith(this._window.location.origin))return;this._requestIter++,n.transferSize||this._cachedRequestIter++,n.encodedBodySize!==n.decodedBodySize&&this._compressedRequestIter++,n.fetchStart&&n.responseStart&&n.responseEnd&&this._requestBuffer.push({name:n.name,initiatorType:n.initiatorType,transferSize:n.transferSize,responseStart:n.responseStart,responseEnd:n.responseEnd,fetchStart:n.fetchStart})}}_calculateLatency(e,t){return e/(t/1e3)/1e3/1e3||0}_normalizeUrl(e,t){try{return(e+new URL(t)?.pathname.replace("/0/","/")).slice(0,Im)}catch{return t?.slice(0,Im)}}_reset(){this._resourcePerformanceObserver?.disconnect(),this._markPerformanceObserver?.disconnect(),this._requestBuffer=[],this._compressedRequestIter=0,this._cachedRequestIter=0,this._requestIter=0}_downlink(){let e=0,t=0;return this._requestBuffer.forEach(s=>{s.initiatorType==="xmlhttprequest"&&(e+=s.transferSize,t+=s.responseEnd-s.responseStart)}),+this._calculateLatency(e,t).toFixed(1)}_withCache(){return Math.round(this._cachedRequestIter/this._requestIter*100)||0}_withCompression(){return Math.round(this._compressedRequestIter/this._requestIter*100)||0}_topRequests(e){const t=[];for(let n=this._requestBuffer.length-1;n>=0;n--){const s=this._requestBuffer[n],r=Math.round(s.responseEnd-s.fetchStart);if(r>=e.topRequestThreshold&&t.length<e.topRequestCount){const o=this._normalizeUrl(r,s.name);if(t.push(o),t.length===e.topRequestThreshold)return t}}return t}start(){this._reset(),this._resourcePerformanceObserver=this._resourcePerformanceObserver??new PerformanceObserver(this._onRequest.bind(this)),this._resourcePerformanceObserver.observe({type:"resource",buffered:!this._firstStart}),this._firstStart=!0}measure(e={topRequestThreshold:400,topRequestCount:5}){const t={transferred:0};return this._requestBuffer.sort((n,s)=>n.fetchStart-s.fetchStart),t.duration=this._calculateDuration(),t.transferred=this._calculateTransferred(),t.downlink=this._downlink(),t.cache=this._withCache(),t.compression=this._withCompression(),t.topRequests=this._topRequests(e),this._reset(),t}_calculateDuration(){let e=this._requestBuffer[0]?.responseEnd,t=this._requestBuffer[0]?.responseEnd-this._requestBuffer[0]?.fetchStart;return this._requestBuffer.forEach(n=>{e<n.fetchStart?t+=n.responseEnd-n.fetchStart:e<n.responseEnd&&(t+=n.responseEnd-e),e=Math.max(e,n.responseEnd)}),Math.round(t)||0}_calculateTransferred(){let e=this._requestBuffer.reduce((t,n)=>t+n.transferSize,0);return e=Math.round(e/1e3)||0,e}ngOnDestroy(){this._reset()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(xs)))(n||xs)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:xs,factory:xs.\u0275fac,providedIn:"root"})}}var Gt;(function(a){a.PageStartLoading="PageStartLoading",a.PageFinishLoading="PageFinishLoading"})(Gt||(Gt={}));class Ar extends Ot.S{constructor(){super(),this._ngZone=(0,i.inject)(i.NgZone),this._window=(0,i.inject)(P.ZP),this._featureValues=(0,i.inject)(oe,{optional:!0}),this._isAngularHost=(0,i.inject)(Y_,{optional:!0}),this._performanceNetworkObserver=(0,i.inject)(xs),this._measureName="PageLoadDuration",this._debounceTime=100,this._subscriptions=new u.Subscription,this._measurements=[],this._tasks=new Set,this._loadingStarted=!1,this._loadingStartedCount=new Set,this._loadingFinishedCount=new Set,this._tasksQueueSubject=new u.Subject,this._pageLoadLifeCycleSubject=new u.Subject,this._iterationCounter=0,this.pageLoadDuration$=new u.Subject,this._enableMeasurement=!!this._isAngularHost&&!this._featureValues?.DisablePerformancePageLoadMeasurement,this._initSubscriptions(),(0,T.set)(this._window,"creatio.performance.measurePerformancePageLoadService",this)}_initSubscriptions(){this._enableMeasurement&&(this._subscriptions.add(this._tasksQueueSubject.pipe((0,u.debounceTime)(this._debounceTime),(0,c.filter)(e=>this._loadingStartedCount.size===this._loadingFinishedCount.size&&this._loadingStarted&&e.size===1&&e.has(Gt.PageStartLoading))).subscribe({next:()=>this._pageLoadLifeCycleSubject.next(Gt.PageFinishLoading)})),this._subscriptions.add(this._pageLoadLifeCycleSubject.subscribe({next:e=>{this._ngZone.runOutsideAngular(()=>{e===Gt.PageStartLoading&&this._onStartPageLoadMeasure(),e===Gt.PageFinishLoading&&this._onEndPageLoadMeasure()})}})))}_onStartPageLoadMeasure(){this.addTask(Gt.PageStartLoading)}_getLocationInfo(){const e=this._window.location.hash,[t,n]=e.slice(1).split("/");return{moduleName:t,schemaName:n,hash:e}}_getMeasurementDetail(){const t=((0,T.get)(this._window,"creatio.performance")??{}).focusLossDuringLoad,n={iteration:this._iterationCounter++,location:this._getLocationInfo(),isReuse:!!this._isReuseMode,focusLossDuringLoad:!!t};return this._featureValues.DisablePerformancePageNetworkMeasurement||(n.network=this._performanceNetworkObserver.measure()),n}_onEndPageLoadMeasure(){this.removeTask(Gt.PageFinishLoading),this.removeTask(Gt.PageStartLoading);const e={start:this._startTime,detail:this._getMeasurementDetail(),end:this._window.performance.now()};this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this.pageLoadDuration$.next(e),this._reset()}_reset(){const e=(0,T.get)(this._window,"creatio.performance");e.initialLoad?e.initialLoad=!1:e.focusLossDuringLoad=null,this._startTime=null,this._tasks.clear(),this._loadingStarted=!1,this._loadingStartedCount.clear(),this._loadingFinishedCount.clear(),this._isReuseMode=null}setReuseMode(e){this._enableMeasurement&&this._isReuseMode===null&&(this._isReuseMode=e)}startPageLoadMeasure(e=performance.now()){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{this._reset(),this._startTime=e,this._pageLoadLifeCycleSubject.next(Gt.PageStartLoading),this._featureValues.DisablePerformancePageNetworkMeasurement||this._performanceNetworkObserver.start()})}addTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&(this._loadingStartedCount.add(e),this._loadingStarted=!0),this._tasks.add(e),this._tasksQueueSubject.next(this._tasks)})}removeTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&this._loadingFinishedCount.add(e),this._tasks.delete(e),this._tasksQueueSubject.next(this._tasks)})}getMeasurements(){const e=this._measurements.map(t=>t());return this._measurements=[],e}getMeasureDataOnTimeout$(){const e={start:this._startTime,end:this._window.performance.now(),detail:this._getMeasurementDetail(),timeout:!0};return this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this._reset(),(0,u.of)(e)}ngOnDestroy(){this._reset(),this._subscriptions.unsubscribe(),this._tasksQueueSubject.complete(),this._pageLoadLifeCycleSubject.complete(),this.pageLoadDuration$.complete()}static{this.\u0275fac=function(t){return new(t||Ar)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ar,factory:Ar.\u0275fac,providedIn:"root"})}}var Ml;(function(a){a.Readonly="READONLY_PROPERTY",a.Disabled="DISABLED_PROPERTY"})(Ml||(Ml={}));class bm{constructor(e,t,n=!1){this.name=e,this._value=t,this._locked=n,this._isValueInitialized=!1,this._pendingValue=void 0,this._onChanged=new i.EventEmitter,this._hasInitialValue=!1,t!=null&&(this._isValueInitialized=!0,this._hasInitialValue=!0,this._initialValue=t,this._value=(0,T.cloneDeep)(t),this._oldValue=(0,T.cloneDeep)(t))}get onChanged(){return this._onChanged}get value(){return this.getValue()}set value(e){this.setValue(e)}get initialValue(){return this._initialValue}set initialValue(e){this.setInitialValue(e)}get hasInitialValue(){return this._hasInitialValue}get isLocked(){return this._locked}emitValueChanged(e){this.onChanged.emit(e)}areValuesEqual(e,t){return(0,T.isEqual)(e,t)}getValue(){return this._value}setValue(e,t=!1){if(this._locked)return;this._isValueInitialized=!0,this._pendingValue=e;const n=this._oldValue;this.areValuesEqual(this._oldValue,e)||(this._oldValue=(0,T.cloneDeep)(e),this._value=(0,T.cloneDeep)(e),!t&&this.emitValueChanged({name:this.name,value:e,oldValue:n}))}resetValue(){this.hasInitialValue&&(this._oldValue=null,this.setValue(this.initialValue))}setInitialValue(e){this._hasInitialValue=!0,this._initialValue=e,this._isValueInitialized||this.setValue(e,!0)}setPending(e){const t=typeof this._pendingValue>"u"?this.value:this._pendingValue;this.value=e,this._pendingValue=t}resetPending(){this._oldValue=null,this.value=this._pendingValue,this._pendingValue=void 0}}class Sm extends bm{constructor(e,t,n,s,r=!1){super(e,t,r),this._validatorTypeResolver=n,this._injectionContext=s,this._onValidatorChanged=new i.EventEmitter}get onValidatorChanged(){return this._onValidatorChanged}_createValidatorInfo(){return{name:this.validatorTypeName,instance:this._validatorTypeResolver.getValidator(this.validatorTypeName,{injectionContext:this._injectionContext}),disabled:!0}}emitValueChanged(e){super.emitValueChanged(e),this.hasValidator&&this.updateValidator(e)&&this._onValidatorChanged.emit()}get hasValidator(){return!1}updateValidator(e){return!1}setValidatorInfo(e,t=!1){this.validatorInfo=e}initializeValidator(e,t=!1){if(!this.hasValidator||this._validatorTypeResolver==null)return e;let n=e.find(r=>r.name===this.validatorTypeName),s=!1;return n==null&&(n=this._createValidatorInfo(),s=!0),this.setValidatorInfo(n,t),s?[...e,n]:e}}class Z_{static{this._properties=new Map}static _get(e){if(!e)return Sm;if(this._properties.has(e))return this._properties.get(e);throw new Error(`CrtControlProperty with type ${e} doesn't registered`)}static register(e,t){this._properties.set(e,t)}static create(e){const t=this._get(e.typeName);return new t(e.name,e.value,e.validatorTypeResolver,e.injectionContext,e.locked===!0)}}const W_="DataValueType";class Il extends bm{get propertiesConfig(){return[{name:"visible",defaultValue:!0},{name:"displayColor"},{name:"required",typeName:"crt.Required",defaultValue:!1}]}get formControl(){return this._formControl||(this._formControl=new Z.FormControl(this.value),this._subscribeOnFormControl(this._formControl)),this._formControl}set formControl(e){this._formControl=e,this._subscribeOnFormControl(this._formControl)}get properties(){return this._properties}get onPropertyChanged(){return this._onPropertyChanged}get visible(){return this.getPropertyByName("visible").getValue()}set visible(e){const t=this.getPropertyByName("visible");t.value=e}get required(){return this.getPropertyByName("required").getValue()}set required(e){const t=this.getPropertyByName("required");t.value=e}get displayColor(){return this.getPropertyByName("displayColor").getValue()}set displayColor(e){const t=this.getPropertyByName("displayColor");t.value=e}get isDirty(){return this.formControl.dirty}constructor(e=null,t,n=null,s=!1,r="",o=[],l,d,h,f){super(r,e),this._featureValues=t,this.validationState=n,this.disabled=s,this._subscription=new u.Subscription,this._appliedValidatorsCache=new Map,this._onPropertyChanged=new i.EventEmitter,this._crtControlStateAdapter=l,this._validatorTypeResolver=d,this._injectionContext=f,this._initProperties(o),this._subscribeOnPropertiesEvents(),this._initializeValidators(h??[],!0)}_subscribeOnFormControl(e){this._formControlSubscription?.unsubscribe(),this._formControlSubscription=e.valueChanges.pipe((0,c.startWith)(e.value),(0,c.distinctUntilChanged)((t,n)=>this.areValuesEqual(t,n))).subscribe(t=>{this.setValue(t)})}_initProperties(e){const t=[...this.propertiesConfig,...e];this._properties=new Map,t.forEach(n=>{const s=Z_.create({typeName:n.typeName,name:n.name,value:n.defaultValue,locked:n.locked===!0,validatorTypeResolver:this._validatorTypeResolver,injectionContext:this._injectionContext});this._properties.set(n.name,s)})}_subscribeOnPropertyEvents(e){this._subscription.add(e.onChanged.subscribe(({name:t,value:n,oldValue:s})=>{this.onPropertyChanged.emit({name:t,value:n,oldValue:s})})),this._subscription.add(e.onValidatorChanged.subscribe(()=>{this._refreshValidators()}))}_subscribeOnPropertiesEvents(){this.properties.forEach(e=>{this._subscribeOnPropertyEvents(e)})}_initializeValidators(e,t=!1){this._validatorInfo=e,this._properties.forEach(n=>{this._validatorInfo=n.initializeValidator(this._validatorInfo,t)}),this._refreshValidators()}_useValidatorsMerging(){return!this._featureValues.DisableControlValidatorsMerging}_getEnabledValidatorFns(e=!1){return this._validatorInfo.filter(t=>!t.disabled&&t.instance.isAsync===e).map(t=>{if(this._useValidatorsMerging()){const s=this._appliedValidatorsCache.get(t.name);if(s)return s.validatorFn}const n=this._crtControlStateAdapter.transform(t);return this._useValidatorsMerging()&&this._appliedValidatorsCache.set(t.name,{validatorInfo:t,validatorFn:n}),n})??[]}_mergeValidators(e,t){for(const n of this._appliedValidatorsCache.values())if(n.validatorInfo.instance.isAsync){const r=n.validatorFn;t.includes(r)?this.formControl.hasAsyncValidator(r)||this.formControl.addAsyncValidators(r):this.formControl.removeAsyncValidators(r)}else{const r=n.validatorFn;e.includes(r)?this.formControl.hasValidator(r)||this.formControl.addValidators(r):this.formControl.removeValidators(r)}}_refreshValidators(){const e=this._getEnabledValidatorFns(),t=this._getEnabledValidatorFns(!0);this._useValidatorsMerging()?this._mergeValidators(e,t):(this.formControl.setValidators(e),this.formControl.setAsyncValidators(t)),this.formControl.updateValueAndValidity()}_updateValidator(e,t=!1){const n=this._validatorInfo.find(s=>s.name===e);if(!n)throw new Error(`Validator ${e} does not exist on ${this.name} attribute.`);n.disabled!==t&&(n.disabled=t,this._refreshValidators())}findPropertyByName(e){return this.properties.has(e)?this.properties.get(e):null}static create(e){return new Il(e.value,e.featureValues,null,!1,e.name,e.propertiesConfig??[],e.crtControlStateAdapter,e.validatorTypeResolver,e.validatorsInfo,e.injectionContext)}setValue(e,t){const n=this.formControl;this.areValuesEqual(e,n.value)||(n.dirty||n.markAsDirty(),n.setValue(e,{onlySelf:!!t})),super.setValue(e,t)}enableValidator(e){this._updateValidator(e,!1)}disableValidator(e){this._updateValidator(e,!0)}change(e){this.setValue(e)}getPropertyByName(e,t=!1){let n=this.findPropertyByName(e);return!n&&t&&(n=new Sm(e,null,this._validatorTypeResolver,this._injectionContext),this._properties.set(e,n),this._subscribeOnPropertyEvents(n)),n}hasPropertyValue(e){return!!this.getPropertyByName(e)}getPropertyValue(e){const t=this.getPropertyByName(e);return t?t.getValue():null}setPropertyValue(e,t,n=!1){this.getPropertyByName(e,!0).setValue(t,n)}setPropertyInitialValue(e,t){this.getPropertyByName(e,!0).setInitialValue(t)}getPropertyInitialValue(e){return this.getPropertyByName(e)?.initialValue}getValue(){return this._formControl?this._formControl.value:super.getValue()}destroy(){this._formControlSubscription?.unsubscribe(),this._subscription.unsubscribe()}getInvariabilityPropertyName(){const e=this.getPropertyValue(Ml.Readonly),t=this.getPropertyValue(Ml.Disabled);return e??t}toggle(e){const t=this.getInvariabilityPropertyName(),n=this.getPropertyByName(t);n&&(e?n.resetPending():n.setPending(!0))}}const bl="maskState",ld="maskedValue",ud="unMaskedValue";var dd;(function(a){a.Unmasked="unmasked",a.Masked="masked"})(dd||(dd={}));const vm=Symbol("isAttributeValueMasked"),$_=Symbol("getMaskedValue"),G_=Symbol("getUnmaskedValue"),Q_=Symbol("setMaskedState"),J_=Symbol("getMaskedState"),q_="calculated",K_=new i.InjectionToken("View model attribute creator factory");function Tm(a){const e=a;return e?!!e?.modelConfig||!!e?.embeddedModel||!!e?.value:!1}function xm(a){const e=a;return e?!!e.from||!!e.triggers||!!e.converter:!1}function wm(a,e){const{dots:t}=e??{};return a?.replace(/\.+/g,t??"").replace(/\[+/g,"").replace(/\]+/g,"").replace(/:+/g,"")??""}const X_="DS",ey="DYN";function Or(a){for(;a?.parent;)a=a.parent;return a}function Ii(a){return a?.getDataSource()?.scope===$t.Page}function uv(a){const e=[];return a?._modelsMap.forEach((t,n)=>{Ii(t)&&e.push(n)}),e}class Pr{static{this._dataCache=new WeakMap}static _getDataSourceColumns(e){const t={};let n=!1;for(const[s,r]of Object.entries(e.dataSourceConfig.config.attributes)){const o=r.path;t[wm(s)]=o,o==="Id"&&(n=!0)}return!n&&e.includePrimaryAttributes!==!1&&(t.Id="Id"),t}static _createAttributesConfigMap(e,t,n,s,r){const o={},l=this.getAttributeDataSourceOldName(e,s);for(const[d]of Object.entries(t)){const h=r.config?.useOriginalAttributesName?`${d}`:`${l}_${d}`,f=r.config.attributes[d],I={path:`${n}.${d}`,type:f?.type,functionConfig:f?.functionConfig,aggregationConfig:f?.aggregationConfig};o[h]={modelConfig:I}}return o}static _createAttributePagingConfig(e){return e.pagingConfig||{rowCount:30}}static _createAttributeSortingConfig(e){return e.sortingConfig||{attributeName:e.attributeName+"Sorting"}}static _createAttributeFiltersConfig(e){return e.filtersConfig?.map(t=>{const n={...t};return delete n.value,n})||[]}static _getDataSourceNameForDynamicModel(e,t){return e.getBoundDataSourceNameByAttributePath(t)||this._getAttributeDataSourceDefaultName(t)}static _getDynamicDataSourceNamePrefix(){return`${ey}_`}static _isDynamicDataSourceName(e){return e.startsWith(this._getDynamicDataSourceNamePrefix())}static _getAttributeDataSourceDefaultName(e){return`${e}${X_}`}static _getLoadData(e,t,n,s){let r;return this._dataCache.has(e)?r=this._dataCache.get(e):(r=t.load(n,[]).pipe((0,c.share)(),(0,c.tap)(()=>this._dataCache.delete(e))),this._dataCache.set(e,r)),(0,u.lastValueFrom)(r.pipe((0,u.map)(()=>s())),{defaultValue:null})}static createAttributeConfig(e,t,n){const s=n.attributeName,r=n.dataSourceConfig,o=this._getDataSourceColumns(n),l=this._createAttributesConfigMap(e,o,t,s,r),d=this._createAttributePagingConfig(n),h=this._createAttributeSortingConfig(n),f=this._createAttributeFiltersConfig(n);return{isCollection:!0,modelConfig:{path:t,pagingConfig:d,sortingConfig:h,filterAttributes:f,hierarchyConfig:n.hierarchyConfig},viewModelConfig:{attributes:l}}}static getAttributeDataSourceOldName(e,t){let n=this._getDataSourceNameForDynamicModel(e,t);return(!n||this._isDynamicDataSourceName(n))&&(n=this._getAttributeDataSourceDefaultName(t)),n}static createDynamicDataSourceNameFromAttributeName(e,t){const n=this._getDynamicDataSourceNamePrefix(),s=this._getDataSourceNameForDynamicModel(e,t);return this._isDynamicDataSourceName(s)?s:`${n}${s}`}static defineAsyncAttribute(e,t,n,s,r){const o=n.modelConfig?.path?.split(".")[0],l=e.getModelByName(o),d="isLookup"in n&&n.isLookup,h="isCollection"in n&&n.isCollection;Object.defineProperty(e,t,{get:()=>l&&h&&!d&&!l?.isLoaded?this._getLoadData(l,e,o,s):Promise.resolve(s()),set:r,configurable:!0})}static deferUpdatingValueAndValidity(e,t,n){if(n?.["ViewModel.DontDeferUpdatingValueAndValidity"])return t();const s=e.formApiModel.updateValueAndValidity;if(s.callbackCount)s.callbackCount++;else{const l=(0,P.S)();l.callbackCount=1,l.originalFn=s.bind(e.formApiModel),e.formApiModel.updateValueAndValidity=l}const r=t(),o=()=>{const l=e.formApiModel.updateValueAndValidity;l.callbackCount===1?(e.formApiModel.updateValueAndValidity=l.originalFn,e.formApiModel.updateValueAndValidity()):l.callbackCount--};return r instanceof Promise?r.finally(o):r.pipe((0,c.finalize)(o))}}class ws{transform(e){return function(t){const{instance:n,params:s}=e,r={value:t.value};return n.validate(r,s)}}static{this.\u0275fac=function(t){return new(t||ws)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ws,factory:ws.\u0275fac,providedIn:"root"})}}class Nm{constructor(e){this.injector=e}}class Ns{resolveModelConfig(e){return null}static{this.\u0275fac=function(t){return new(t||Ns)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ns,factory:Ns.\u0275fac,providedIn:"root"})}}class Sl{constructor(){this.account={attributes:{Name:{},Ships:{isCollection:!0,viewModelConfig:"ship"},Employee:{viewModelConfig:"employee"}}},this.ship={attributes:{Id:{}}},this.employee={attributes:{Name:{},Age:{}}}}resolveModelConfig(e){return(0,u.of)(this[e]).pipe((0,c.delay)(50))}static{this.\u0275fac=function(t){return new(t||Sl)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Sl,factory:Sl.\u0275fac,providedIn:"root"})}}class kr{constructor(e){this.injector=e,this.initDependencies()}initDependencies(){this.repository=this.injector.get(Ns),this.ngZone=this.injector.get(i.NgZone)}static{this.\u0275fac=function(t){return new(t||kr)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:kr,factory:kr.\u0275fac})}}const ty=m(85088);class jr{sort(e,t){const n=[];let s=[];Object.entries(e||{}).forEach(([o,l])=>{if(xm(l)){let d=l.from;d=Array.isArray(d)?d:[d];const h=d.map(f=>[o,f]);s=s.concat(h)}else n.push(o)});const r=ty(s).reverse();return[...n,...r].filter(Boolean).filter((o,l,d)=>d.indexOf(o)===l).map(o=>{const l=r.includes(o)?e[o]??t[o]:e[o];return[o,l]})}static{this.\u0275fac=function(t){return new(t||jr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:jr,factory:jr.\u0275fac,providedIn:"root"})}}class Rr{constructor(e,t,n,s,r,o,l){this._crtControlStateAdapter=e,this._validatorTypeResolver=t,this._viewModelGenerator=n,this._attributeCreator=s,this._viewModelRepository=r,this._attributesTopologicalSorting=o,this._injector=l,this._featureValues=this._injector.get(oe,null,{optional:!0}),this._measurePerformanceService=this._injector.get(Ie.g)}_generateAttributes(e,t,n){const s=this._attributesTopologicalSorting.sort(t,e._attributeConfigs);return Promise.all(s.map(([r,o])=>e._systemAttributes.includes(r)?(console.warn(`Overriding of system attributes is denied. Attribute name:"${r}"`),Promise.resolve()):(n.disableDefaultConfig||(o??={}),e._attributeConfigs[r]=o,o?"viewModelConfig"in o||"viewModelName"in o?o.isCollection?this._generateNestedModelCollectionAttribute(e,r,o,n):this._generateNestedModelAttribute(e,r,o,n):xm(o)?this._generateCalculatedAttribute(e,r,o,n):this._generateModelAttribute(e,r,o,n):this._removeViewModelAttribute(e,r))))}_generateNestedModelCollectionAttribute(e,t,n,s){var r=this;return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedCollectionAttribute.${t}`,(0,S.A)(function*(){const o=e.getBoundDataSourceNameByAttributePath(t),l=e.getModelByName(o),d="viewModelConfig"in n?n.viewModelConfig:yield(0,u.lastValueFrom)(r._viewModelRepository.resolveModelConfig(n.viewModelName)),h=new ft(r._viewModelGenerator,d,l,e,t);r._registerOrSetFormControl(e.formApiModel,t,h.formApiModel);const f=e.attributes[t];e.attributes[t]=h,r._defineNestedModelAttribute(e,t,n,s),r._subscribeOnCollectionChanged(e,t,h,s),f!==void 0&&s.onChangeAttributeValue(t,h,f)}))}_defineNestedModelAttribute(e,t,n,s){const r=l=>{const d=e.attributes[t];e.attributes[t]=l,d instanceof ft&&l instanceof ft&&this._subscribeOnCollectionChanged(e,t,l,s),s.onChangeAttributeValue(t,l,d)},o=()=>e.attributes[t];Pr.defineAsyncAttribute(e,t,n,o,r)}_generateNestedModelAttribute(e,t,n,s){return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedModelAttribute.${t}`,()=>{const r="viewModelConfig"in n?n.viewModelConfig:n.viewModelName,o=e?.[yn];return(0,u.lastValueFrom)(this._viewModelGenerator.generate({viewModelConfig:r,parentViewModel:e},o?i.Injector.create({providers:[{provide:$c,useValue:null}],parent:o}):null).pipe((0,u.map)(l=>{this._registerOrSetFormControl(e.formApiModel,t,l.formApiModel);const d=e.attributes[t];e.attributes[t]=l,this._defineNestedModelAttribute(e,t,n,s),d!==void 0&&s.onChangeAttributeValue(t,l,d)})))})}_subscribeOnCollectionChanged(e,t,n,s){if(e._collectionSubscription.has(t)){const o=e._collectionSubscription.get(t);o.unsubscribe(),e._subscriptions.remove(o)}const r=new u.Subscription;r.add(n.changed.subscribe(()=>{s.onChangeAttributeValue(t,n,null)})),r.add(n.itemAttributeChanged.subscribe(()=>{s.onChangeAttributeValue(t,n,null)})),e._collectionSubscription.set(t,r),e._subscriptions.add(r)}_generateCalculatedAttribute(e,t,n,s){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateCalculatedAttribute.${t}`,()=>{this._attributeCreator.create(q_,e?.[yn])?.defineAttribute({viewModel:e,attribute:t,attributeConfig:n,generateOptions:s})})}_getCrtControlPropertiesConfig(e,t,n){const s=Object.entries(n.properties??[]).map(([r,o])=>({name:r,defaultValue:o.defaultValue,locked:o.locked===!0}));return this._addDataValueTypePropertyConfig(s,n),this._addMaskedPropertyConfig(e,t,s,n),this._disableSystemAttributes(e,t,s),s}_addDataValueTypePropertyConfig(e,t){t.dataValueTypeName&&e.push({name:W_,defaultValue:C.r[t.dataValueTypeName]})}_addMaskedPropertyConfig(e,t,n,s){this._isNotAllowMaskedPropertyConfig(e,t,s)||(s.isValueMasked=!0,this._getOrCreatePropertyConfig(n,bl),this._getOrCreatePropertyConfig(n,ld),this._getOrCreatePropertyConfig(n,ud))}_isNotAllowMaskedPropertyConfig(e,t,n){const r=e.getBoundDataSchemaAttributeByAttributePath(t)?.isValueMasked,o=n.isValueMasked;return r&&o===!1||!r&&!o}_disableSystemAttributes(e,t,n){if(this._featureValues?.DisableBlockingSystemColumns===!0)return;if(e.getBoundDataSchemaAttributeByAttributePath(t)?.isSystem){const r=this._getOrCreatePropertyConfig(n,"readonly");r.locked=!0,r.defaultValue=!0}}_getOrCreatePropertyConfig(e,t){let n=this._findPropertyConfigByName(e,t);return n||(n={name:t},e.push(n)),n}_findPropertyConfigByName(e,t){return e.find(n=>n.name===t)}_generateModelAttribute(e,t,n,s){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateModelAttribute.${t}`,()=>{const r=e.attributes[t],o=n?.value,l=this._getCrtControlPropertiesConfig(e,t,n),d=Il.create({name:t,value:o,crtControlStateAdapter:this._crtControlStateAdapter,validatorTypeResolver:this._validatorTypeResolver,validatorsInfo:e._validators[t],propertiesConfig:l,injectionContext:e._injectionContext??Or(e)?._injectionContext,featureValues:this._featureValues});e._subscriptions.add(d.onChanged.subscribe(I=>{e.attributes[t]=I.value,s.onChangeAttributeValue(I.name,I.value,I.oldValue)})),e._subscriptions.add(d.onPropertyChanged.subscribe(({name:I,value:O,oldValue:B})=>{s.onChangeAttributeValue(`${t}:${I}`,O,B)})),e._crtControls.set(t,d),this._registerOrSetFormControl(e.formApiModel,t,d.formControl),e.attributes[t]=o??null;const h=e._getDataSourceAttributeDataValueType(t);this._attributeCreator.create(h).defineAttribute({viewModel:e,attribute:t,attributeConfig:n,control:d}),r!==void 0&&s.onChangeAttributeValue(t,o,r)})}_registerOrSetFormControl(e,t,n){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.registerOrSetFormControl.${t}`,()=>{if(this._featureValues?.DisableAttributeOnlyRegisteringControl){e.setControl(t,n);return}e.contains(t)?e.setControl(t,n):e.registerControl(t,n)})}_removeViewModelAttribute(e,t){return delete e._attributeConfigs[t],delete e.attributes[t],delete e[t],Promise.resolve()}generate(e,t,n){var s=this;return this._measurePerformanceService.measureCallback("BaseViewModelAttributeGenerator.generateAttributes",()=>Pr.deferUpdatingValueAndValidity(e,(0,S.A)(function*(){yield s._generateAttributes(e,t,n),!s._featureValues?.DisableAttributeOnlyRegisteringControl&&e.formApiModel.updateValueAndValidity()}),this._featureValues))}static{this.\u0275fac=function(t){return new(t||Rr)(i.\u0275\u0275inject(ws),i.\u0275\u0275inject(Nm),i.\u0275\u0275inject(kr),i.\u0275\u0275inject(K_),i.\u0275\u0275inject(Ns),i.\u0275\u0275inject(jr),i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Rr,factory:Rr.\u0275fac,providedIn:"root"})}}class Lr{_defineResourceAttribute(e,t,n,s,r){return new u.Observable(o=>{const l=e._getDataSourceAttributeCaption(s,r);if(this._defineResourceProperty(t,n,l),s.includes(".")){const d=s.split(".")[1];this._defineResourceProperty(t,d,l)}o.next(),o.complete()})}_defineResourceProperty(e,t,n){e[t]||Object.defineProperty(e,t,{get:()=>Promise.resolve(n??""),configurable:!0})}_getResourceNameByPath(e){const t=e.split(".");return t.length>1?t.join("_"):e}generate(e,t){return Object.entries(t||{}).map(([n,s])=>{const r=e[gr][ps.string],o=this._getResourceNameByPath(n);return this._defineResourceAttribute(e,r,o,n,s)})}static{this.\u0275fac=function(t){return new(t||Lr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Lr,factory:Lr.\u0275fac,providedIn:"root"})}}const vl="HasUnsavedData",Vr="IsChanged",hd="PrimaryModelMode",pd="BusinessRulesActivated",Tl="State";var $n;(function(a){a.DebouncingBusinessRules="DebouncingBusinessRules",a.RunningBusinessRules="RunningBusinessRules",a.ProcessingAttributeChangeRequest="ProcessingAttributeChangeRequest",a.AttributeLoading="AttributeLoading"})($n||($n={}));var md;(function(a){a.Paused="Paused",a.Active="Active"})(md||(md={}));var de;(function(a){a.OwnAttribute="Own",a.ForwardReferenceAttribute="ForwardReference",a.BackReferenceAttribute="BackReference",a.AggregationAttribute="Aggregation",a.FunctionAttribute="Function"})(de||(de={}));var Em;(function(a){a[a.General=0]="General",a[a.Advanced=1]="Advanced",a[a.None=2]="None"})(Em||(Em={}));var Es;(function(a){a[a.EntitySchema=3]="EntitySchema",a[a.ClientUnitSchema=4]="ClientUnitSchema"})(Es||(Es={}));const Dm=new i.InjectionToken("Represents a list of schema change message predicates"),Am=new i.InjectionToken("Represents a list of schema remove message predicates"),gd=new i.InjectionToken("Represents a list of schema rights message predicates");class bi{constructor(e,t,n,s,r){this._messageChannelService=e,this._broadcastChannelFactory=t,this._changePredicates=n,this._removePredicates=s,this._rightsPredicates=r,this._destroyed$=new u.Subject,this.schemaChanged$=new u.Subject,this.schemaRemoved$=new u.Subject,this.rightsChanged$=new u.Subject,this.requireJsChanged$=new u.Subject,this._subscribeMessageChannelEvent()}_getSchemaType(e){let t;switch(e){case"ClientUnitSchemaManager":t=Es.ClientUnitSchema;break;case"EntitySchemaManager":t=Es.EntitySchema;break}return t}_processMessage(e,t){const n=e.body,s=this._getSchemaType(n.ManagerName);s&&t.next({name:n.Name,uId:n.UId,schemaType:s,userId:n.UserId,isNew:n.IsNew,extendParent:n.ExtendParent})}_subscribeMessageChannelEvent(){this._messageChannelService.messageEvent$.pipe((0,c.filter)(e=>this._changePredicates?.some(t=>t(e))),(0,c.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaChanged$)),this._messageChannelService.messageEvent$.pipe((0,c.filter)(e=>this._removePredicates?.some(t=>t(e))),(0,c.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaRemoved$)),this._messageChannelService.messageEvent$.pipe((0,c.filter)(e=>this._rightsPredicates?.some(t=>t(e))),(0,c.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.rightsChanged$)),this._broadcastChannelFactory.createInstance("schema-requirejs-path-changed").messages$.subscribe(e=>this._processMessage({body:e},this.requireJsChanged$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.schemaChanged$.complete()}static{this.\u0275fac=function(t){return new(t||bi)(i.\u0275\u0275inject(ml),i.\u0275\u0275inject(P.Vx),i.\u0275\u0275inject(Dm,8),i.\u0275\u0275inject(Am,8),i.\u0275\u0275inject(gd,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:bi,factory:bi.\u0275fac,providedIn:"root"})}}class zr{constructor(e){this.schemaChangeListener=e,this._repository=new Map,this._uIdMap=new Map,this._destroyed$=new u.Subject,this.schemaChangeListener.schemaChanged$.pipe((0,c.filter)(t=>t.schemaType===this.provider.schemaType),(0,c.takeUntil)(this._destroyed$)).subscribe(t=>this.clearSchemaCacheByUId(t.uId))}add(e){this._repository.set(e.name,e),this._uIdMap.set(e.uId,e.name)}getCachedSchema(e){return this._repository.get(e)}getIsSchemaCached(e){return this._repository.has(e)}getCachedSchemesNames(){return[...this._repository.keys()]}getSchemaByName(e){const t=this.getCachedSchema(e);return t?(0,u.of)(t):this.provider.getSchemaByName(e).pipe((0,c.tap)(n=>this.add(n)))}getSchemaByUId(e){const t=this._uIdMap.get(e),n=t&&this.getCachedSchema(t);return n?(0,u.of)(n):this.provider.getSchemaByUId(e).pipe((0,c.tap)(s=>this.add(s)))}clearSchemaCacheByName(e){const t=this.getCachedSchema(e);t&&this._uIdMap.delete(t.uId),this._repository.delete(e)}clearSchemaCacheByUId(e){const t=this._uIdMap.get(e);t&&this._repository.delete(t),this._uIdMap.delete(e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||zr)(i.\u0275\u0275inject(bi))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:zr,factory:zr.\u0275fac})}}class xl{static getPathItemInfo(e){const n=/\[([\w-]+):([\w-]+):?([\w-]*)]$/g.exec(e);if(n){const s=n[1],r=n[2],o=n[3];return{isBackReference:!0,referenceSchemaName:s,referenceSchemaColumnName:r,columnName:o}}return{isBackReference:!1,columnName:e}}static getLastBackwardSchemaNameByColumnPath(e){let t="";return e?.split(".").reverse()?.forEach(s=>{t||s.includes("[")&&(t=this.getPathItemInfo(s).referenceSchemaName)}),t}static getLastForwardColumnPath(e){const t=e?.split(".")||[],n=t.map(s=>s.includes("[")).lastIndexOf(!0);return n===-1?e:t.slice(n+1).join(".")}}var wl;(function(a){a.List="List",a.SelectionWindow="SelectionWindow"})(wl||(wl={}));class fd{get isLookupType(){return this.dataValueType?this.dataValueType===C.r.Lookup:!1}constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.columnCaptionPath=e.columnCaptionPath,this.dataValueType=e.dataValueType,this.usageType=e.usageType,this.referenceSchemaUId=e.referenceSchemaUId,this.referenceSchemaName=e.referenceSchemaName,this.isRequired=e.isRequired,this.isValueCloneable=e.isValueCloneable,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.defaultValueSchema=e.defaultValueSchema,this.lookupMode=e.lookupMode,this.useSeconds=e.useSeconds)}}class ny{constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.extendParent=e.extendParent,this.packageUId=e.packageUId)}}class Om extends ny{getPrimaryColumn(){return this.primaryColumnUId&&this.columns?.find(e=>e.uId===this.primaryColumnUId)}getPrimaryDisplayColumn(){return this.primaryDisplayColumnUId&&this.columns?.find(e=>e.uId===this.primaryDisplayColumnUId)}getPrimaryColorColumn(){return this.primaryColorColumnUId&&this.columns?.find(e=>e.uId===this.primaryColorColumnUId)}getHierarchyColumn(){return this.hierarchyColumnUId&&this.columns?.find(e=>e.uId===this.hierarchyColumnUId)}getCreatedOnColumn(){return this.createdOnColumnUId&&this.columns?.find(e=>e.uId===this.createdOnColumnUId)}getCreatedByColumn(){return this.createdByColumnUId&&this.columns?.find(e=>e.uId===this.createdByColumnUId)}getModifiedOnColumn(){return this.modifiedOnColumnUId&&this.columns?.find(e=>e.uId===this.modifiedOnColumnUId)}getModifiedByColumn(){return this.modifiedByColumnUId&&this.columns?.find(e=>e.uId===this.modifiedByColumnUId)}}var iy=m(61843),Qt;(function(a){a[a.None=0]="None",a[a.Const=1]="Const",a[a.Settings=2]="Settings",a[a.SystemValue=3]="SystemValue",a[a.Sequence=4]="Sequence"})(Qt||(Qt={}));class sy{static _getDefaultValue(e){if(!e)return null;if(e.source===Qt.Sequence)return{valueSourceType:Qt.Sequence,value:"Sequence",sequencePrefix:e.sequencePrefix,sequenceNumberOfChars:e.sequenceNumberOfChars};if(e.source===Qt.Const){const t=e.value,n=typeof t=="string"?t:t.value;return{valueSourceType:Qt.Const,value:n,valueSource:n,sequenceNumberOfChars:0}}return e.source===Qt.Settings?{valueSourceType:Qt.Settings,value:e.calculatedValue,valueSource:e.value,sequenceNumberOfChars:0}:e.source===Qt.SystemValue?{valueSourceType:Qt.SystemValue,value:e.calculatedValue,valueSource:e.sourceValue,sequenceNumberOfChars:0}:{valueSourceType:e.source,value:null,sequenceNumberOfChars:0}}static _getPrimaryDisplayColorColumnUId(e){if(!e.primaryColorColumnName)return null;const t=Object.values(e.columns).find(n=>n.name===e.primaryColorColumnName);if(!t)throw new Error(`Primary color column set in object ${e.name} but column ${e.primaryColorColumnName} does not exist`);return t?.uId}static map(e,t){const n={};return Object.entries(e.columns).forEach(([,s])=>{const r=s,o=r.dataValueTypeName==="Binary"?"Blob":r.dataValueTypeName,l=Object.entries(Cs.Q).find(([,f])=>f.name===o),d=l?Number(l[0]):r.dataValueType,h=this._getDefaultValue(r.defaultValue);n[r.uId]={uId:r.uId,name:r.name,caption:{[t]:r.caption},dataValueType:d,isInherited:!!r.isInherited,isRequired:!!r.isRequired,isValueCloneable:!!r.isValueCloneable,usageType:r.usageType,referenceSchemaName:r.referenceSchemaName,isMasked:!!r.isMasked,isFormatValidated:!!r.isFormatValidated,isSimpleLookup:!!r.isSimpleLookup,isSensitiveData:!!r.isSensitiveData,isValueMasked:!!r.isValueMasked,valueMaskingSettings:r.valueMaskingSettings,useSeconds:!!r.useSeconds,defValue:h}}),{administratedByOperations:e.administratedByOperations,administratedByRecords:e.administratedByRecords,useMasterRecordRights:e.useMasterRecordRights,masterRecordSchemaName:e.masterRecordSchemaName,primaryColumnUId:e.primaryColumn?.uId,primaryDisplayColumnUId:e.primaryDisplayColumn?.uId,primaryColorColumnUId:this._getPrimaryDisplayColorColumnUId(e),hierarchyColumnUId:e.hierarchyColumnUId,createdOnColumnUId:e.createdOnColumnUId,createdByColumnUId:e.createdByColumnUId,modifiedOnColumnUId:e.modifiedOnColumnUId,modifiedByColumnUId:e.modifiedByColumnUId,uId:e.uId,name:e.name,caption:{[t]:e.caption},columns:{Items:n},isVirtual:!!e.isVirtual,isDBView:!!e.isDBView,administratedByColumns:!!e.administratedByColumns,description:{[t]:e.description},parentUId:e.parentUId,isTrackChangesInDB:!!e.isTrackChangesInDB,extendParent:!!e.extendParent}}}const ay="runtime-entity-schema";let _d=class{constructor(e){this._window=e}_getItems(e,t=[]){var n=this;let s=[];const r=[...t];return new Promise(o=>{this._window.require(e,(0,S.A)(function*(...l){s=yield Promise.all(l.map(d=>n.map(d))),o({schemes:s,notFoundSchemes:r})}),l=>{const d=l.requireModules??[];r.push(...d),e=e.filter(h=>!d.includes(h)),e.length===0&&o({schemes:s,notFoundSchemes:r}),o(this._getItems(e,r))})})}map(e){return Promise.resolve(e)}get(e){var t=this;return new Promise(n=>{this._window.require([e],function(){var s=(0,S.A)(function*(r){const o=yield t.map(r);n(o)});return function(r){return s.apply(this,arguments)}}(),()=>{n(null)})})}getItems(e){return this._getItems(e,[])}};_d=(0,p.__decorate)([(0,p.__param)(0,(0,i.Inject)(P.ZP)),(0,p.__metadata)("design:paramtypes",[Object])],_d);class Si{constructor(e,t){this._userInfo=e,this._httpClient=t}_getServiceUrlSspPart(){return this._userInfo.isSSP?"ssp/":""}_getDataServiceUrlWithSspPart(){return`DataService/${this._getServiceUrlSspPart()}`}getSchemaDesignerServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/SchemaDesignerRequest"}getRuntimeEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemaRequest"}getEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/EntitySchemaRequest"}getRuntimeEntitySchemeServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemesRequest"}getEntity(e){return(0,u.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemaServiceEndpoint(),{name:e}))}getEntities(e){return(0,u.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemeServiceEndpoint(),e))}static{this.\u0275fac=function(t){return new(t||Si)(i.\u0275\u0275inject(L.oq),i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Si,factory:Si.\u0275fac,providedIn:"root"})}}const yd=["SysSettings"];class Fr extends _d{constructor(e,t,n,s,r,o,l){super(e),this._featureValues=t,this._userInfo=n,this._entityHttpService=s,this._cacheManager=r,this._schemaChangeListener=o,this._measurePerformanceService=l,this._destroyed$=new u.Subject,this._schemaChangeListener.schemaChanged$.pipe((0,c.filter)(d=>d.schemaType===Es.EntitySchema),(0,c.switchMap)(d=>(0,u.from)(this._clearSchemaCacheByName(d.name))),(0,c.takeUntil)(this._destroyed$)).subscribe()}get _entitySchemaCache(){return this._cacheManager.getOrCreate({name:ay,type:Pn.P.Memory})}_clearSchemaCacheByName(e){var t=this;return(0,S.A)(function*(){t._featureValues.DisableRuntimeEntitySchemaCaching||(yield t._measurePerformanceService.measureCallback("EntityRequireService: clear schema cache",(0,S.A)(function*(){yield(yield t._entitySchemaCache).delete(e)})))})()}_getLookupEntities(e){const t=e.flatMap(s=>Object.values(s.columns.Items).filter(r=>r.dataValueType===C.r.Lookup&&r.referenceSchemaName&&!e.find(o=>o.name===r.referenceSchemaName)).map(r=>r.referenceSchemaName)),n=[...new Set(t)];return this.getItems(n)}_getReferenceEntityNameFromBackReferencePath(e){return xl.getPathItemInfo(e).referenceSchemaName}_getReferenceSchemaName(e,t){const n=this._getReferenceEntityNameFromBackReferencePath(e);let s;if(n)s=n;else{const r=Object.entries(t.columns.Items).find(([,l])=>l.name===e);if(!r)throw new Error(`Can't find column '${e}' in EntitySchema '${t.name}'`);const[,o]=r;s=o.referenceSchemaName}return s}_loadSchemasByPath(e,t,n){var s=this;return(0,S.A)(function*(){const r=n.find(I=>I.name===e);if(!r)return{schemas:[],notFoundSchemas:[e]};const o=[...t],l=o.shift(),d=s._getReferenceSchemaName(l,r);if(!d)return{schemas:[],notFoundSchemas:[]};let h=n.find(I=>I.name===d);if(!h)try{if(h=yield s.get(d),h)n.push(h);else return{schemas:[],notFoundSchemas:[d]}}catch{return{schemas:[],notFoundSchemas:[d]}}const f=o.length?yield s._loadSchemasByPath(h.name,o,n):{schemas:[],notFoundSchemas:[]};return{schemas:[h,...f.schemas],notFoundSchemas:f.notFoundSchemas}})()}_getForwardReferenceSchemas(e,t){var n=this;return(0,S.A)(function*(){const s=yield Promise.all(e.filter(r=>r.forwardReferencePaths).flatMap(r=>r.forwardReferencePaths.flatMap(o=>n._loadSchemasByPath(r.name,o.split("."),t))));return{schemes:s.flatMap(r=>r.schemas),notFoundSchemes:s.flatMap(r=>r.notFoundSchemas)}})()}_getEntitiesToLoadLookups(e,t){return t.schemes.filter(n=>e.requests.find(s=>s.loadLookupColumns===!0&&s.name===n.name))}map(e){return Promise.resolve(sy.map(e,this._userInfo.cultureInfo.sysCultureName))}get(e){var t=()=>super.get,n=this;return(0,S.A)(function*(){let s;return n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schema from cache",(0,S.A)(function*(){const o=yield(yield n._entitySchemaCache).get(e);if(o)return o}))),yd.includes(e)?s=(yield n._entityHttpService.getEntity(e)).schema:s=yield t().call(n,e),n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: set schema to cache",(0,S.A)(function*(){yield(yield n._entitySchemaCache).set(e,s)}))),s})()}getItems(e){var t=()=>super.getItems,n=this;return(0,S.A)(function*(){const s=[...new Set(e)];let r=s,o=[];n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",(0,S.A)(function*(){const O=yield n._entitySchemaCache;o=(yield n._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",()=>Promise.all(s.map(te=>O.get(te))))).filter(te=>!!te);const J=o.map(te=>te.name);if(r=s.filter(te=>!J.includes(te)),r.length===0)return{schemes:[...o],notFoundSchemes:[]}})));const l=r.filter(O=>yd.includes(O)),d=r.filter(O=>!yd.includes(O));let h={success:!0,schemes:[],notFoundSchemes:[]};if(l.length!==0){const O={requests:l.map(B=>({name:B,loadLookupColumns:!1}))};h=yield n._entityHttpService.getEntities(O)}const f=yield t().call(n,d),I=[...f.schemes,...h.schemes];return n._featureValues.DisableRuntimeEntitySchemaCaching||(yield n._measurePerformanceService.measureCallback("EntityRequireService: set schemas to cache",(0,S.A)(function*(){yield(yield n._entitySchemaCache).bulkSet((0,T.uniqBy)(I,"name").map(B=>({key:B.name,value:B})))}))),{schemes:[...I,...o],notFoundSchemes:[...f.notFoundSchemes,...h.notFoundSchemes]}})()}getEntity(e){var t=this;return(0,S.A)(function*(){const n=yield t.get(e);return{success:!!n,schema:n}})()}getEntities(e){var t=this;return(0,S.A)(function*(){const n=e.requests.map(d=>d.name),s=yield t.getItems(n),r=t._getEntitiesToLoadLookups(e,s),o=yield t._getLookupEntities(r),l=yield t._getForwardReferenceSchemas(e.requests,[...s.schemes,...o.schemes]);return{success:!0,schemes:[...s.schemes,...o.schemes,...l.schemes],notFoundSchemes:[...s.notFoundSchemes,...o.notFoundSchemes,...l.notFoundSchemes]}})()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Fr)(i.\u0275\u0275inject(P.ZP),i.\u0275\u0275inject(oe),i.\u0275\u0275inject(L.oq),i.\u0275\u0275inject(Si),i.\u0275\u0275inject(mt.G),i.\u0275\u0275inject(bi),i.\u0275\u0275inject(Ie.g))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Fr,factory:Fr.\u0275fac,providedIn:"root"})}}class Br{constructor(e,t,n,s){this.httpClient=e,this._entityRequire=t,this._entityHttp=n,this._featureValues=s}_useRequire(){return this._featureValues?.UseRequireEntitySchema8x??!1}getEntity(e){var t=this;return(0,S.A)(function*(){return t._useRequire()?t._entityRequire.getEntity(e):t._entityHttp.getEntity(e)})()}getEntities(e){var t=this;return(0,S.A)(function*(){return t._useRequire()?t._entityRequire.getEntities(e):t._entityHttp.getEntities(e)})()}static{this.\u0275fac=function(t){return new(t||Br)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(Fr),i.\u0275\u0275inject(Si),i.\u0275\u0275inject(oe,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Br,factory:Br.\u0275fac,providedIn:"root"})}}class ht{constructor(e,t,n,s){this.httpClient=e,this._userInfo=t,this._schemaLoader=n,this._entityHttp=s,this._entitySchemaServiceRequests=new Map,this._destroyed$=new u.Subject}_convertToEntitySchema(e){const t=new Om;return t.uId=e.uId,t.name=e.name,t.caption=this._getCaptionElement(e),t.extendParent=e.extendParent,t.packageUId=e.packageUId,t.administratedByColumns=e.administratedByColumns,t.administratedByOperations=e.administratedByOperations,t.administratedByRecords=e.administratedByRecords,t.description=e.description,t.isDBView=e.isDBView,t.isTrackChangesInDB=e.isTrackChangesInDB,t.isVirtual=e.isVirtual,t.masterRecordSchemaName=e.masterRecordSchemaName,t.primaryColumnUId=e.primaryColumnUId,t.primaryDisplayColumnUId=e.primaryDisplayColumnUId,t.primaryColorColumnUId=e.primaryColorColumnUId,t.hierarchyColumnUId=e.hierarchyColumnUId,t.createdOnColumnUId=e.createdOnColumnUId,t.createdByColumnUId=e.createdByColumnUId,t.modifiedOnColumnUId=e.modifiedOnColumnUId,t.modifiedByColumnUId=e.modifiedByColumnUId,t.useMasterRecordRights=e.useMasterRecordRights,t.parentUId=e.parentUId,t.columns=Object.values(e.columns.Items).map(n=>{const s=new fd;return s.uId=n.uId,s.name=n.name,s.caption=this._getCaptionElement(n),s.dataValueType=n.dataValueType,s.usageType=n.usageType,s.referenceSchemaUId=n.referenceSchemaUId,s.referenceSchemaName=n.referenceSchemaName,s.isRequired=n.isRequired,s.isValueCloneable=n.isValueCloneable,s.isMasked=n.isMasked,s.isFormatValidated=n.isFormatValidated,s.isSensitiveData=n.isSensitiveData,s.isValueMasked=n.isValueMasked,s.valueMaskingSettings=n.valueMaskingSettings,s.defaultValueSchema=n.defValue,s.lookupMode=n.isSimpleLookup?wl.List:wl.SelectionWindow,s.useSeconds=n.useSeconds,s}),t}_getCaptionElement(e){return e.caption[this._userInfo.cultureInfo.sysCultureName]||e.caption[iy.dJ]}_createEntitySchemaColumnFromInformationObject(e){const t=new fd;return t.uId=e.columnUId,t.name=e.columnName,t.caption=e.columnCaption,t.dataValueType=e.columnDataValueType,t.usageType=e.columnUsageType,t.referenceSchemaUId=e.referenceSchemaUId,t.referenceSchemaName=e.referenceSchemaName,t.columnCaptionPath=e.columnCaptionPath,t}_getEntitySchemaFromEndpoint(e,t){return this.httpClient.post(e,t).pipe((0,c.mergeMap)(n=>n.schema?(0,u.of)({success:!0,entitySchema:this._convertToEntitySchema(n.schema)}):(0,u.throwError)({success:!1,entitySchema:null,errorInfo:n.errorInfo})))}_getEntitySchemaColumnByPath(e,t,n="."){const s=`${e}_${n}_${t}`;if(this._entitySchemaServiceRequests.has(s))return this._entitySchemaServiceRequests.get(s);const r=this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),{getSchemaColumnInformation:{entitySchemaUId:e,schemaColumnPath:t,schemaColumnCaptionPathDelimiter:n}}).pipe((0,c.tap)(({success:o})=>{if(!o)throw new Error("SchemaDesignerService request has failed")}),(0,c.map)(({getSchemaColumnInformationResponse:o})=>this._createEntitySchemaColumnFromInformationObject(o)),(0,c.tap)(()=>this._entitySchemaServiceRequests.delete(s)),(0,c.share)());return this._entitySchemaServiceRequests.set(s,r),r}_combineEntitySchemaColumnInformationRequestsWithPaths(e,t){return t.reduce((n,s)=>({...n,[s]:this._getEntitySchemaColumnByPath(e,s)}),{})}getEntitySchemaByUId(e,t){const n=`${e}_${t}`;if(this._entitySchemaServiceRequests.has(n))return this._entitySchemaServiceRequests.get(n);const s=t?this._entityHttp.getEntitySchemaServiceEndpoint():this._entityHttp.getRuntimeEntitySchemaServiceEndpoint(),r={uId:e};t&&(r.packageUId=t);const o=this._getEntitySchemaFromEndpoint(s,r).pipe((0,c.tap)(()=>this._entitySchemaServiceRequests.delete(n)),(0,c.share)());return this._entitySchemaServiceRequests.set(n,o),o}getEntitySchemaByName(e){if(this._entitySchemaServiceRequests.has(e))return this._entitySchemaServiceRequests.get(e);const t=(0,u.from)(this._schemaLoader.getEntity(e)).pipe((0,c.map)(n=>({success:n.success,entitySchema:n.schema?this._convertToEntitySchema(n.schema):null,errorInfo:n.errorInfo})),(0,c.tap)(()=>this._entitySchemaServiceRequests.delete(e)),(0,c.share)(),(0,c.catchError)(n=>(this._entitySchemaServiceRequests.delete(e),(0,u.throwError)(()=>n))));return this._entitySchemaServiceRequests.set(e,t),t}getEntitySchemes(e){const t=JSON.stringify(e);if(this._entitySchemaServiceRequests.has(t))return this._entitySchemaServiceRequests.get(t);const n=(0,u.from)(this._schemaLoader.getEntities(e)).pipe((0,c.map)(s=>({success:s.success,schemes:s.schemes.map(r=>this._convertToEntitySchema(r)),notFoundSchemes:s.notFoundSchemes})),(0,c.tap)(()=>this._entitySchemaServiceRequests.delete(t)),(0,c.share)(),(0,c.catchError)(s=>(0,u.throwError)(()=>s)));return this._entitySchemaServiceRequests.set(t,n),n}getEntitySchemaColumnsInformationByMetaPath(e,t){const n={getSchemaColumnsInformation:{entitySchemaUId:e,schemaColumnMetaPaths:t}};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),n).pipe((0,c.tap)(({success:s})=>{if(!s)throw new Error("SchemaDesignerService request is failed")}),(0,c.map)(({getSchemaColumnsInformationResponse:s})=>s.map(r=>({column:this._createEntitySchemaColumnFromInformationObject(r),columnMetaPath:r.columnMetaPath,columnPath:r.columnPath,columnCaptionPath:r.columnCaptionPath}))))}getEntitySchemaColumnsInformationByPath(e,t,n){return this._getEntitySchemaColumnByPath(e,t,n)}getEntitySchemaColumnsInformationByPathsArray(e,t){return(0,u.forkJoin)(this._combineEntitySchemaColumnInformationRequestsWithPaths(e,t))}getColumnCaptionPathByMetaPath(e){const t={getColumnCaptionPathByMetaPath:e};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),t).pipe((0,c.tap)(({success:n})=>{if(!n)throw new Error("SchemaDesignerService request is failed")}),(0,c.map)(({columnCaptionPath:n})=>n))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||ht)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(L.oq),i.\u0275\u0275inject(Br),i.\u0275\u0275inject(Si))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ht,factory:ht.\u0275fac,providedIn:"root"})}}class Ur{constructor(e){this._entitySchemaService=e,this.schemaType=Es.EntitySchema}_getSchema(e){return e.pipe((0,c.switchMap)(t=>t.success===!0?(0,u.of)(t):(0,u.throwError)(()=>new Error(t.errorInfo?.message))),(0,c.map)(t=>t.entitySchema))}_getScheme(e){return e.pipe((0,c.switchMap)(t=>t.success===!0?(0,u.of)(t):(0,u.throwError)(()=>new Error(t.errorInfo?.message))),(0,c.map)(t=>t.schemes))}getSchemaByUId(e){const t=this._entitySchemaService.getEntitySchemaByUId(e);return this._getSchema(t).pipe((0,c.catchError)(n=>{const s=n.message||`Entity schema with UId '${e}' not found`;return console.error(s),(0,u.throwError)(()=>new Error(s))}))}getSchemaByName(e){const t=this._entitySchemaService.getEntitySchemaByName(e);return this._getSchema(t).pipe((0,c.catchError)(n=>{const s=n.message||`Entity schema with name '${e}' not found`;return console.error(s),(0,u.throwError)(()=>new Error(s))}))}getSchemes(e){const t=this._entitySchemaService.getEntitySchemes(e);return this._getScheme(t).pipe((0,c.catchError)(n=>{const s=n.message||"Entity schemas not found: "+JSON.stringify(e);return console.error(s),(0,u.throwError)(()=>new Error(s))}))}static{this.\u0275fac=function(t){return new(t||Ur)(i.\u0275\u0275inject(ht))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ur,factory:Ur.\u0275fac,providedIn:"root"})}}class Mn extends zr{constructor(e,t){super(t),this.provider=e,this.schemaChangeListener=t}_checkPath(e){if(!e||e.length===0)throw new Error("Path is null or empty")}_getEntitySchemaColumn(e,t){const n=e.columns.find(s=>s.name===t);return n||null}_findEntitySchemesByPath(e,t){this._checkPath(t);const n=[...t],s=this.getCachedSchema(e);if(!s)return null;const r=n.shift(),o=xl.getPathItemInfo(r);let l=[];if(o.isBackReference)l=this._findEntitySchemesByPath(o.referenceSchemaName,n);else{const h=this._getEntitySchemaColumn(s,o.columnName);if(n.length===0)return[s];if(!h?.isLookupType)return null;l=this._findEntitySchemesByPath(h.referenceSchemaName,n)}if(!l)return null;const d=l.filter(h=>h.name!==s.name);return[s,...d]}_getAreSchemesCached(e){for(const t of e){const n=this.getCachedSchema(t.name);if(!n)return!1;const s=n.columns.filter(o=>o.isLookupType).every(o=>this.getIsSchemaCached(o.referenceSchemaName));if(t.loadLookupColumns&&!s)return!1;const r=t.forwardReferencePaths??[];for(const o of r){const l=o.split(".");if(!this.findEntitySchemaColumnByPath(t.name,l))return!1}}return!0}_addSchemaIfNotExists(e,t){e.has(t.name)||e.set(t.name,t)}_addSchemesIfNotExists(e,t){t.forEach(n=>{this._addSchemaIfNotExists(e,n)})}_getCachedSchemes(e){const t=new Map;return e.forEach(n=>{const s=this.getCachedSchema(n.name);if(!s)return;if(this._addSchemaIfNotExists(t,s),n.loadLookupColumns){const o=s.columns.filter(l=>l.isLookupType).map(l=>this.getCachedSchema(l.referenceSchemaName)).filter(l=>l!=null);this._addSchemesIfNotExists(t,o)}(n.forwardReferencePaths??[]).forEach(o=>{const l=o.split("."),d=this._findEntitySchemesByPath(n.name,l);d&&this._addSchemesIfNotExists(t,d)})}),[...t.values()]}getSchemes(e){if(this._getAreSchemesCached(e))return(0,u.of)(this._getCachedSchemes(e));const t={requests:e,cachedSchemesNames:this.getCachedSchemesNames()};return this.provider.getSchemes(t).pipe((0,c.tap)(n=>n.forEach(s=>this.add(s))),(0,c.map)(()=>this._getCachedSchemes(e)))}findEntitySchemaByPath(e,t){this._checkPath(t);const n=this.getCachedSchema(e);if(!n)return null;const s=[...t],r=s.shift(),o=xl.getPathItemInfo(r);if(o.isBackReference)return this.findEntitySchemaByPath(o.referenceSchemaName,s);const l=this._getEntitySchemaColumn(n,o.columnName);return l?s.length===0?n:l?.isLookupType?this.findEntitySchemaByPath(l.referenceSchemaName,s):null:null}findEntitySchemaColumnByPath(e,t){const n=this.findEntitySchemaByPath(e,t);if(!n)return null;const s=[...t].pop(),r=xl.getPathItemInfo(s);return this._getEntitySchemaColumn(n,r.columnName)}static{this.\u0275fac=function(t){return new(t||Mn)(i.\u0275\u0275inject(Ur),i.\u0275\u0275inject(bi))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Mn,factory:Mn.\u0275fac,providedIn:"root"})}}class ry{}class Gn{get attributes(){return this._parent?[...this._parent.attributes,...this._attributes]:[...this._attributes]}get parent(){return this._parent}constructor(e){if(e!=null){this.name=e.name,this.type=e.type,e.caption&&(this.caption=typeof e.caption=="string"?e.caption:{...e.caption}),this.primaryAttributeName=e.primaryAttributeName,this.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this.primaryColorAttributeName=e.primaryColorAttributeName,this.hierarchyAttributeName=e.hierarchyAttributeName,this.createdByAttributeName=e.createdByAttributeName,this.createdOnAttributeName=e.createdOnAttributeName,this.modifiedByAttributeName=e.modifiedByAttributeName,this.modifiedOnAttributeName=e.modifiedOnAttributeName,e.dataSourceConfig&&(this.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig.config}}),this._parent=e.parent;const t=e.attributes??[];this._attributes=[],t.forEach(n=>{if(this._parent){this._parent.findAttributeByName(n.name)||this._attributes.push(n.clone());return}this._attributes.push(n.clone())})}else this._attributes=[]}clearAttributes(){this._attributes=[]}addAttribute(e){if(this._parent){this._parent.findAttributeByName(e.name)||this._attributes.push(e);return}this._attributes.push(e)}findAttributeByName(e){return this.attributes.find(t=>t.name===e)??null}getPrimaryAttributesNames(){return[this.primaryAttributeName]}getPrimaryLoadAttributes(){const e=[];return this.primaryAttributeName&&e.push(this.primaryAttributeName),this.primaryDisplayAttributeName&&e.push(this.primaryDisplayAttributeName),e}clone(){return new Gn(this)}createChild(){const e=new Gn;return e.name=this.name,e.type=this.type,this.caption&&(e.caption=typeof this.caption=="string"?this.caption:{...this.caption}),e.primaryAttributeName=this.primaryAttributeName,e.primaryDisplayAttributeName=this.primaryDisplayAttributeName,e.primaryColorAttributeName=this.primaryColorAttributeName,e.hierarchyAttributeName=this.hierarchyAttributeName,e.createdByAttributeName=this.createdByAttributeName,e.createdOnAttributeName=this.createdOnAttributeName,e.modifiedByAttributeName=this.modifiedByAttributeName,e.modifiedOnAttributeName=this.modifiedOnAttributeName,this.dataSourceConfig&&(e.dataSourceConfig={...this.dataSourceConfig,config:{...this.dataSourceConfig.config}}),e._attributes=[],e._parent=this,e}}class Pm extends Error{get isCritical(){return!0}constructor(e,t){super(t),this.dataSource=e}}class Cd extends Pm{constructor(e,t){super(e,t)}}class oy extends Pm{get isCritical(){return!1}constructor(e,t){super(e,t)}}class Md{constructor(e,t){this.dataSourceName=e,this.injector=t,this._errors=[],this.supportTransactions=!1}get scope(){return this._scope}get hasErrors(){return this._errors.length!==0}get hasCriticalErrors(){return this._errors.some(e=>e.isCritical)}get affectedAttributes(){return[]}get isForceUpdateUnchangedData(){return!1}getLastError(){return this.hasErrors?this._errors[this._errors.length-1]:null}get isAggregate(){return!1}getEmptySchema(){return new Gn}init(e,t){return this.initialConfig=e,this._scope=t,(0,u.of)(this)}load(e,t,n){return this.innerLoad(e,t,n)}save(e,t){return this.innerSave(e,t)}insert(e){return this.innerInsert(e)}delete(e){return this.innerDelete(e)}getSchema(){return this.dataSchema?(0,u.of)(this.dataSchema):this.innerGetSchema().pipe((0,c.tap)(e=>{this.dataSchema=e}))}getLookupDataSchema(e){return this.innerGetLookupDataSchema(e)}getDefaultValues(){return this.innerGetDefaultValues()}canEdit(e){return this.innerCanEdit(e)}canDelete(e){return this.innerCanDelete(e)}canCreate(e){return this.innerCanCreate(e)}getOwnLoadParameters(){return null}getAllowCopyingRecords(){return!1}}const km="crt.EntityDataSource",jm="crt.PageParametersDataSource",dv="PageParameters",cy=new i.InjectionToken("COPILOT_INTENT_REPOSITORY_TOKEN");class Rm{static{this._codeCharactersRegex=new RegExp("^[A-Za-z0-9\\s_]*$")}static{this._wordsMatchRegex=new RegExp(/\w+/g)}static generateCode(e,t=-1){const s=(e.match(this._wordsMatchRegex)||[]).filter(r=>r.length!==0).map(r=>r[0].toUpperCase()+r.substring(1)).join("");return t>=0?s.slice(0,t):s}static isTextUsableForCodeGeneration(e){return this._codeCharactersRegex.test(e)}}class Hr{constructor(){this._sysSettingsService=(0,i.inject)(kt),this._defaultCodeMaxLength=41}_checkCodeIsUnique(e,t){return e?!e.includes(t):!0}_generateCode(e){const{prefix:t,options:n,generateFromName:s,name:r}=e,{codeMaxLength:o,defaultNewCode:l}=n;if(s){if(!Rm.isTextUsableForCodeGeneration(r))return null;const d=t+l,h=(o??this._defaultCodeMaxLength)-d.length,f=Rm.generateCode(r,h);return d+f}return P.$A.generateUnique(l,t)}generate(e,t,n){const s={generateFromName:!!t,name:t,prefix:null,options:n};return(0,u.from)(this._sysSettingsService.getByCode("SchemaNamePrefix")).pipe((0,u.map)(r=>r.value),(0,u.tap)(r=>s.prefix=r),(0,u.repeat)(s.generateFromName?1:void 0),(0,u.map)(()=>this._generateCode(s)),(0,u.filter)(r=>this._checkCodeIsUnique(e,r)),(0,u.take)(1),(0,u.defaultIfEmpty)(null))}static{this.\u0275fac=function(t){return new(t||Hr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Hr,factory:Hr.\u0275fac})}}class Yr{constructor(){this._designItems=new Map}getDesignItem(e){return this._designItems.get(e)}getDesignItems(){return Array.from(this._designItems.values())}setDesignItem(e){this._designItems.set(e.UId,e)}static{this.\u0275fac=function(t){return new(t||Yr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Yr,factory:Yr.\u0275fac})}}class vi{constructor(){this._repository=(0,i.inject)(cy),this._copilotCodeGenerator=(0,i.inject)(Hr),this._designRepository=(0,i.inject)(Yr)}_loadIntentUIdByActionUId(e){return(0,u.from)(_t.create("CopilotAction")).pipe((0,u.switchMap)(t=>t.load({attributes:["Intent"],parameters:[{type:ne.Filter,value:new bt(ee.Equal,new pe({columnPath:"Id"}),new fe({value:e}))}]})),(0,u.map)(t=>{const n=t[0]||{};return(0,T.isEmpty)(n)?null:n.Intent?.value}))}_applyActionToIntent(e,t){const s=(e.Actions||[]).findIndex(o=>o.Id===t.Id);if(s===-1)return!1;const r=e.Actions[s];return e.Actions.splice(s,1,{...r,...t}),!0}_applyParameterToIntent(e,t){const n=t.SourceCollection==="InputParameters"?e.InputParameters:e.OutputParameters,s=n.findIndex(r=>r.UId===t.UId);return s!==-1?(n.splice(s,1,{...n[s],...t}),!0):!1}_getSuccessResponse(){return{success:!0}}_getSuccessResponseObservable(){return(0,u.of)(this._getSuccessResponse())}_getDesignIntent(e){return(0,u.of)(this._designRepository.getDesignItem(e))}_getDesignIntents(){return Array.from(this._designRepository.getDesignItems())}_setDesignIntent(e){this._designRepository.setDesignItem(e)}_getIntentByParameterUId(e){for(const t of this._getDesignIntents()){if(t.InputParameters.find(r=>r.UId===e))return(0,u.of)({intent:t,sourceCollection:"InputParameters"});if(t.OutputParameters.find(r=>r.UId===e))return(0,u.of)({intent:t,sourceCollection:"OutputParameters"})}return(0,u.of)({})}getIntent(e){return this._repository.get(e).pipe((0,u.tap)(t=>{this._setDesignIntent(t)}))}getAllSkills(){return this._repository.getAllCodes("CopilotIntent")}getAllAgents(){return this._repository.getAllCodes("CopilotAgent")}getIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,u.map)(({intent:t,sourceCollection:n})=>n==="InputParameters"?t.InputParameters:t.OutputParameters),(0,u.map)(t=>t.find(n=>n.UId===e)))}getIntentParameters(e,t){return this._getDesignIntent(e).pipe((0,u.map)(n=>t==="InputParameters"?n.InputParameters:n.OutputParameters))}updateIntentParameter(e){return this._getIntentByParameterUId(e.UId).pipe((0,u.switchMap)(({intent:t,sourceCollection:n})=>(e.SourceCollection=n,this._applyParameterToIntent(t,e)?this._getSuccessResponseObservable():this._getSuccessResponseObservable())))}createIntentParameter(e){return this._getDesignIntent(e.Intent.value).pipe((0,u.map)(t=>((e.SourceCollection==="InputParameters"?t.InputParameters:t.OutputParameters).push(e),this._getSuccessResponse())))}deleteIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,u.map)(({intent:t,sourceCollection:n})=>{const s=n==="InputParameters"?t?.InputParameters:t?.OutputParameters,r=(s??[]).findIndex(o=>o.UId===e);return r!==-1&&s.splice(r,1),t}),(0,u.switchMap)(t=>this._repository.update(t)))}createIntent(e){return this._repository.create(e.UId).pipe((0,u.map)(t=>(Object.assign(t,e),t)),(0,u.switchMap)(t=>this._repository.update(t)))}updateIntent(e){return(0,u.forkJoin)([this._getDesignIntent(e.UId),this._repository.get(e.UId)]).pipe((0,u.map)(([t,n])=>{const s={...n,...t,...e};return this._setDesignIntent(s),s}),(0,u.switchMap)(t=>this._repository.update(t)))}createAction(e){return this._repository.get(e.Intent.value).pipe((0,u.map)(t=>(t.Actions.push(e),t)),(0,u.switchMap)(t=>this._repository.update(t)))}createSubIntent(e,t){return this._repository.createSubIntent(e,t)}deleteSubIntent(e,t){return this._repository.deleteSubIntent(e,t)}getActionByUId(e){return this._loadIntentUIdByActionUId(e).pipe((0,u.switchMap)(t=>t?this._repository.get(t).pipe((0,u.map)(n=>n.Actions.filter(s=>s.Id===e)),(0,u.map)(n=>n[0])):(0,u.of)({})))}getIntentByActionUId(e){return this.getActionByUId(e).pipe((0,u.switchMap)(t=>t?.Intent?this.getIntent(t.Intent.value):(0,u.of)({})))}updateAction(e){return this._loadIntentUIdByActionUId(e.Id).pipe((0,u.switchMap)(t=>this._repository.get(t).pipe((0,u.switchMap)(n=>this._applyActionToIntent(n,e)?this._repository.update(n):(0,u.of)({})))))}generateActionCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Action"})}generateSkillCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Skill"})}generateAgentCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Agent"})}deleteAction(e,t){return this._repository.get(e).pipe((0,u.map)(n=>(n.Actions=n.Actions.filter(s=>s.Id!==t),n)),(0,u.switchMap)(n=>this._repository.update(n)))}static{this.\u0275fac=function(t){return new(t||vi)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:vi,factory:vi.\u0275fac})}}var Id;(function(a){a[a.None=0]="None",a[a.Self=1]="Self",a[a.ExplicitEntry=2]="ExplicitEntry",a[a.Delegated=4]="Delegated",a[a.FuncRoleFromOrgRole=8]="FuncRoleFromOrgRole",a[a.UpHierarchy=16]="UpHierarchy",a[a.AsManager=32]="AsManager",a[a.All=63]="All"})(Id||(Id={}));var bd;(function(a){a.None="",a.Count="Count",a.Sum="Sum",a.Avg="Avg",a.Min="Min",a.Max="Max",a.TopOne="TopOne"})(bd||(bd={}));const Sd="rights-cache",hv={provide:$a.P,useValue:{name:Sd,type:Pn.P.PersistentAndMemory,options:{tableName:Dc.w.Rights}},multi:!0};class ly{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class uy extends ly{constructor(){super(...arguments),this.httpClient=(0,i.inject)(E.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const n=this.getFromCache(t);if((0,T.isUndefined)(n)){const s=e().pipe((0,u.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,s),s}return n}getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const n=this.getMethodEndpoint(e),s=this._createCacheKey(e,t),r=()=>this.httpClient.post(n,t);return this._cacheRequest(r,s)}executeGetRequestWithCache(e){const t=this.getMethodEndpoint(e),n=this._createCacheKey(e),s=()=>this.httpClient.get(t);return this._cacheRequest(s,n)}resetCache(e,t={}){const n=this._createCacheKey(e,t);this.deleteFromCache(n)}}let Zr=class wc extends uy{constructor(){super(...arguments),this._persistentCache=null,this._cacheManager=(0,i.inject)(mt.G),this._measurePerformanceService=(0,i.inject)(Ie.g),this._useSystemClientCache=(0,i.inject)(Ec.X,{optional:!0})??!1,this.serviceEndpoint="rest/RightsService"}_getPersistentCacheInstance(){return this._persistentCache?(0,u.of)(this._persistentCache):(0,u.from)(this._cacheManager.getOrCreate({name:Sd,type:Pn.P.Memory})).pipe((0,c.tap)(e=>this._persistentCache=e))}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,c.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,c.map)(n=>({result:n&&n.GetCanDeleteResult?.length===0,message:n?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(s=>this.getFromCache(`GetCanAdd_${s}`)).filter(s=>!!s),n=e.filter(s=>!t.find(r=>r.schemaName===s));return{cachedResult:t,requestSchemaNames:n}}_internalGetExecuteOperation(e){return this._cacheManager.executeWithCache(Sd,e,this.httpClient.post(this.getMethodEndpoint("GetCanExecuteOperation"),{operation:e}).pipe((0,c.map)(t=>t?.GetCanExecuteOperationResult))).pipe(this._measurePerformanceService.measure$("RightsService: get execute operation with cache"))}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,c.mergeMap)(t=>(0,u.of)((t||[])[0])))}getCanExecuteOperations(e){return this._useSystemClientCache?this._getPersistentCacheInstance().pipe((0,c.switchMap)(t=>t.getAll()),(0,c.switchMap)(t=>{const n=e.map(s=>{const r=t.find(o=>o.key===s);return r?(0,u.of)(r.value):this._internalGetExecuteOperation(s)});return(0,u.combineLatest)(n)})):(0,u.combineLatest)(e.map(t=>this._internalGetExecuteOperation(t)))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,c.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:n,requestSchemaNames:s}=this._getCanAddData(e);if(!s.length)return(0,u.of)(n);const r=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(r,s).pipe((0,c.map)(o=>o.map(l=>({schemaName:l.Key,result:(0,T.isEmpty)(l.Value),errorMessage:l.Value}))),(0,c.tap)(o=>o.forEach(l=>this.setToCache(`${t}_${l.schemaName}`,l))),(0,c.map)(o=>o.concat(n)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,c.map)(n=>({result:n&&n.GetCanEditResult?.length===0,message:n?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,c.map)(t=>{const n=t?.GetCanEditColumnsResult??[],s={};return n.forEach(r=>s[r.Key]=r.Value),s}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,c.map)(t=>{const n=t?.GetCanReadColumnsResult??[],s={};return n.forEach(r=>s[r.Key]=r.Value),s}))}getCanExecuteEntityOperation(e,t){const n=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,s={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(n,s).pipe((0,c.mergeMap)(r=>(0,u.of)(r?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,u.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}applyChanges(e){const t=`${this.serviceEndpoint}/ApplyChanges`;return(0,u.firstValueFrom)(this.httpClient.post(t,e)).then(()=>!0,n=>{throw console.error(`Error while making request to ApplyChanges: ${n}`),n})}getRecordRights(e){return(0,u.firstValueFrom)(this.executePostRequestWithCache("GetRecordRights",e)).then(t=>t,t=>{throw console.error(`Error while making request to GetRecordRights: ${t}`),t})}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(wc)))(n||wc)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:wc,factory:wc.\u0275fac,providedIn:"root"})}};Zr=(0,p.__decorate)([(0,P.op)({requestType:"crt.RightsService"})],Zr);function Lm(a,e){switch(q.checkArgumentEmpty("dataValueType",e),e){case C.r.Date:case C.r.Time:case C.r.DateTime:return Ap(a);default:return a}}function dy(a,e){if(ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),!a)return a;const t={};return Object.keys(a).forEach(n=>{const s=a[n];t[n]=e[n]?Lm(s,e[n]):s}),t}function pv(a,e){return ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),a&&a.map(t=>t&&dy(t,e))}var Ds;(function(a){a.Entity="Entity",a.ClientUnit="ClientUnit",a.Intent="Intent"})(Ds||(Ds={}));class Ti{constructor(){this._phoneUtil=null,this._phoneNumberType=null,this._phoneMaskOverrides=new Map([["id",["+{62} 000 000 000 000","+{62} 000 000 00"]]])}getAllPhoneMasks(e){let t=[];for(const s in this._phoneNumberType)if(isNaN(Number(s))){const r=this._phoneUtil.getExampleNumberForType(e,this._phoneNumberType[s]);if(!r)continue;const o=r.getCountryCode().toString(),l=this._phoneUtil.format(r,null),d=`+{${o.replace("0","\\0")}} ${l.replace(/-/g," ").replace(/\d/g,"0")}`;t.find(h=>h===d)||t.push(d)}const n=this._phoneMaskOverrides.get(e);return n&&(t.push(...n),t=Array.from(new Set(t))),t}initialize(){var e=this;return(0,S.A)(function*(){if(!(e._phoneUtil&&e._phoneNumberType))try{const t=yield m.e(1588).then(m.t.bind(m,1588,23));e._phoneUtil=t.PhoneNumberUtil.getInstance(),e._phoneNumberType=t.PhoneNumberType}catch(t){throw console.error("Error loading google-libphonenumber:",t),t}})()}isValidPhoneNumber(e){if(!this._phoneUtil)return!0;try{const t=this._phoneUtil.parse(e);return this._phoneUtil.isValidNumber(t)}catch{return!1}}static{this.\u0275fac=function(t){return new(t||Ti)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ti,factory:Ti.\u0275fac,providedIn:"root"})}}const vd={ShortTextCaption:50,MediumTextCaption:250,LongTextCaption:500},Nl={Integer:{max:2147483647,min:-2147483647},Float:{max:6999999999999999e-2,min:-6999999999999999e-2}};function hy(a){let e;switch(a){case C.r.SHORT_TEXT:e=vd.ShortTextCaption;break;case C.r.PHONE_TEXT:case C.r.MEDIUM_TEXT:e=vd.MediumTextCaption;break;case C.r.LONG_TEXT:case C.r.EMAIL_TEXT:e=vd.LongTextCaption;break;default:return}return{maxLength:e}}function py(a){if([C.r.Float,C.r.FLOAT0,C.r.FLOAT1,C.r.FLOAT2,C.r.FLOAT3,C.r.FLOAT4,C.r.FLOAT8,C.r.MONEY0,C.r.MONEY1,C.r.Money,C.r.MONEY3].includes(a))return{minValue:Nl.Float.min,maxValue:Nl.Float.max};if(a===C.r.Integer)return{minValue:Nl.Integer.min,maxValue:Nl.Integer.max}}class Wr{get isDate(){return this.dataValueType===C.r.Date||this.dataValueType===C.r.DateTime||this.dataValueType===C.r.Time}get isImage(){return this.dataValueType===C.r.IMAGELOOKUP||this.dataValueType===C.r.Image}get isLookup(){return this.dataValueType===C.r.Lookup}set isSystem(e){this._isSystem=e}get isSystem(){return this._isSystem}get isAggregate(){return this.attributeType===de.AggregationAttribute?!0:this.attributeType===de.FunctionAttribute&&this.functionConfig?.type==="aggregation"}constructor(e){if(this._isSystem=!1,e!=null){this.name=e.name,this.caption=e.caption,this.path=e.path,this.dataValueType=e.dataValueType,e.validators&&(this.validators={...e.validators||{}});const t=e.defaultValue;t&&(t instanceof u.Observable?this.defaultValue=t.pipe((0,c.map)(n=>this._getConvertDefaultValue(n))):this.defaultValue=(0,u.of)(this._getConvertDefaultValue(t))),this.defaultValueSchema=e.defaultValueSchema,this.isValueCloneable=e.isValueCloneable,this.attributeType=e.attributeType,this.referenceSchemaName=e.referenceSchemaName,this.functionConfig=e.functionConfig,this.aggregationConfig=e.aggregationConfig,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.usageType=e.usageType,this.isRequired=e.isRequired,this.lookupMode=e.lookupMode,this.isSystem=!!e.isSystem,this.useSeconds=e.useSeconds}}_getConvertDefaultValue(e){if(this.isDate)if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}else return e;else return typeof e=="object"?{...e}:e}clone(){return new Wr(this)}addDefaultValidators(){const e=this.validators??{};this.isRequired&&(e["crt.Required"]={type:"crt.Required"}),!this.validators&&Object.keys(e).length>0&&(this.validators=e)}}class Vm{constructor(e=null,t,n){e==null?this._dataSchema=new Gn:this._dataSchema=t?.useClone?e.clone():e.createChild(),this._phoneValidationService=n||i.Injector.create({providers:[{provide:Ti,useClass:Ti}]}).get(Ti)}_createDataSchemaAttributeByConfig(e){const t=new Wr;return t.name=e.name,t.caption=e.caption,t.path=e.path,t.dataValueType=e.dataValueType,t.validators={...e.validators||{}},t.defaultValue=(0,u.of)(typeof e.defaultValue=="object"?{...e.defaultValue}:e.defaultValue),t.defaultValueSchema=e.defaultValueSchema,t.isValueCloneable=e.isValueCloneable,t.attributeType=e.attributeType,t.referenceSchemaName=e.referenceSchemaName,t.functionConfig=e.functionConfig,t.aggregationConfig=e.aggregationConfig,t.usageType=e.usageType,t.isMasked=e.isMasked,t.isFormatValidated=e.isFormatValidated,t.isSensitiveData=e.isSensitiveData,t.isValueMasked=e.isValueMasked,t.valueMaskingSettings=e.valueMaskingSettings,t.isRequired=e.isRequired,t.lookupMode=e.lookupMode,t.isSystem=e.isSystem??!1,t.useSeconds=e.useSeconds??!1,t}setEntitySchemaColumnValidators(e,t){return e.isRequired&&this.setAttributeRequiredValidator(t),this.setAttributeTextDataValueTypeValidator(t,e.dataValueType).setAttributeNumberDataValueTypeValidator(t,e.dataValueType).setAttributePhoneDataValueTypeValidator(t,e)}setAttributeValidator(e,t,n){const s=this._dataSchema.attributes.find(o=>o.name===e),r=s.validators||{};return r[t]=n,s.validators=r,this}setAttributeRequiredValidator(e){return this.setAttributeValidator(e,"crt.Required",{type:"crt.Required"})}setAttributeMaxLengthValidator(e,t){return this.setAttributeValidator(e,"crt.MaxLength",{type:"crt.MaxLength",params:{maxLength:t}})}setAttributeTextDataValueTypeValidator(e,t){const n=hy(t);return n?this.setAttributeMaxLengthValidator(e,n.maxLength):this}setAttributeMinValueValidator(e,t){return this.setAttributeValidator(e,"crt.Min",{type:"crt.Min",params:{min:t}})}setAttributeMaxValueValidator(e,t){return this.setAttributeValidator(e,"crt.Max",{type:"crt.Max",params:{max:t}})}setAttributeMinMaxValidator(e,t,n){return this.setAttributeMinValueValidator(e,t).setAttributeMaxValueValidator(e,n)}setAttributeNumberDataValueTypeValidator(e,t){const n=py(t);return n&&this.setAttributeMinMaxValidator(e,n.minValue,n.maxValue),this}setAttributePhoneDataValueTypeValidator(e,t){return[C.r.PHONE_TEXT].includes(t.dataValueType)&&t.isMasked&&(this._phoneValidationService.initialize().then(),this.setAttributeValidator(e,"crt.PhoneNumber",{type:"crt.PhoneNumber"})),this}setAttributesDefaultValue(e){return this._dataSchema.attributes.forEach(t=>{t.defaultValue=e.pipe((0,c.map)(n=>n[t.name]))}),this}addAttribute(e,t){const{name:n,caption:s,dataValueType:r,isValueCloneable:o,referenceSchemaName:l,isMasked:d,isFormatValidated:h,usageType:f,isRequired:I,isSensitiveData:O,isValueMasked:B,valueMaskingSettings:J}=e,te=new Wr;return te.name=t.attributeName||n,te.path=t.attributePath||n,te.caption=s,te.dataValueType=r,te.isValueCloneable=!!o,te.attributeType=t.attributeType||de.OwnAttribute,te.referenceSchemaName=l,te.validators={},te.isMasked=d,te.isFormatValidated=h,te.isSensitiveData=O,te.isValueMasked=B,te.valueMaskingSettings=J,te.usageType=f,te.isRequired=I,te.defaultValueSchema=e.defaultValueSchema,te.lookupMode=e.lookupMode,te.useSeconds=e.useSeconds,te.isSystem=(0,T.compact)([this._dataSchema.createdByAttributeName,this._dataSchema.createdOnAttributeName,this._dataSchema.modifiedByAttributeName,this._dataSchema.modifiedOnAttributeName,this._dataSchema.primaryAttributeName,"ProcessListeners"]).includes(te.name),this._dataSchema.addAttribute(te),t.attributeType===de.OwnAttribute&&this.setEntitySchemaColumnValidators(e,te.name),t.attributeType===de.AggregationAttribute&&(te.aggregationConfig=t.aggregationConfig),t.attributeType===de.FunctionAttribute&&(te.functionConfig=t.functionConfig),this}addOwnAttribute(e){return this.addAttribute(e,{attributeType:de.OwnAttribute})}setEntitySchema(e){return this._dataSchema.dataSourceConfig={type:"crt.EntityDataSource",config:{entitySchemaName:e.name}},this._dataSchema.name=e.name,this._dataSchema.type=Ds.Entity,this._dataSchema.primaryAttributeName=e.getPrimaryColumn()?.name,this._dataSchema.primaryDisplayAttributeName=e.getPrimaryDisplayColumn()?.name,this._dataSchema.primaryColorAttributeName=e.getPrimaryColorColumn()?.name,this._dataSchema.hierarchyAttributeName=e.getHierarchyColumn()?.name,this._dataSchema.caption=e.caption,this._dataSchema.createdByAttributeName=e.columns.find(t=>t.uId===e.createdByColumnUId)?.name,this._dataSchema.createdOnAttributeName=e.columns.find(t=>t.uId===e.createdOnColumnUId)?.name,this._dataSchema.modifiedByAttributeName=e.columns.find(t=>t.uId===e.modifiedByColumnUId)?.name,this._dataSchema.modifiedOnAttributeName=e.columns.find(t=>t.uId===e.modifiedOnColumnUId)?.name,this._dataSchema.clearAttributes(),e.columns.forEach(t=>{this.addOwnAttribute(t)}),this}setDataSchemaConfig(e){return this._dataSchema.name=e.name,this._dataSchema.type=e.type,this._dataSchema.caption=typeof e.caption=="string"?e.caption:{...e.caption},this._dataSchema.primaryAttributeName=e.primaryAttributeName,this._dataSchema.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this._dataSchema.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig?.config}},(e.attributes||[]).forEach(n=>{const s=this._createDataSchemaAttributeByConfig(n);this._dataSchema.addAttribute(s)}),this}build(){return this._dataSchema.clone()}}class my extends Cd{get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,`Entity schema with name '${t}' not found.`),this._entitySchemaName=t}}class gy extends Cd{constructor(e){super(e,`Entity schema name for data source ${e.dataSourceName} is not provided`)}}function fy(a){switch(a){case"asc":return Qe.Asc;case"desc":return Qe.Desc;default:return Qe.None}}const _y=new i.InjectionToken("A factory of entity schema column appender"),yy=new i.InjectionToken("A factory of data schema to data source attribute converter");class Cy{_getExpressionColumnPath(e,t){const n="[{referenceSchemaName}:{referenceAttributeName}:{attributeName}]",s=e.relationData.map(h=>we.String.format(n,h)).join("."),r=e.attributePath.split("."),o=r.length>1?"{ownColumnPath}.{relationString}.{columnPath}":"{relationString}.{columnPath}";r.pop();const d={ownColumnPath:r.join("."),relationString:s,columnPath:t};return we.String.format(o,d)}_updateFilterLeftExpression(e,t){switch(e.expressionType){case ot.SchemaColumn:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case ot.SubQuery:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case ot.Function:e.functionType!==ut.Macros&&this._updateFilterLeftExpression(e.functionArgument,t);break}}_updateRelatedFilterGroup(e,t){e instanceof Ve?this._updateRelatedFilterGroupInstance(e,t):this._updateRelatedFilterGroupObject(e,t)}_updateRelatedFilterGroupObject(e,t){Object.values(e.items).forEach(n=>{this._updateRelatedFilter(n,t)})}_updateRelatedFilterGroupInstance(e,t){e.filters.forEach(n=>this._updateRelatedFilter(n,t))}_updateRelatedFilter(e,t){if(e.filterType!==Ce.FilterGroup){const n=e.leftExpression;n&&this._updateFilterLeftExpression(n,t)}else this._updateRelatedFilterGroup(e,t)}convertToRelatedFilter(e,t=[]){if(!e)return e;let n;if(e instanceof Xa)n=e.clone();else{const s=JSON.stringify(e);n=JSON.parse(s)}return[...t].reverse().forEach(s=>{s.relationData&&s.relationData.length!==0&&this._updateRelatedFilter(n,s)}),n}}const My="invalidate-data-schema-cache";class Qn{constructor(e,t){this._entitySchemaRepository=e,this._broadcastChannelFactory=t,this._dataSchemas=new Map,this._subscribeOnChangesInDesigner()}_subscribeOnChangesInDesigner(){this._broadcastChannelFactory.createInstance(My).messages$.subscribe(({schemaName:e})=>{this._removeCachedSchema(e)})}_createEntityDataSchema(e){const t=new Vm;return t.setEntitySchema(e),(0,u.of)(t.build())}_getEntityDataSchema(e){return this._entitySchemaRepository.getSchemaByName(e).pipe((0,c.switchMap)(t=>this._createEntityDataSchema(t)))}_removeCachedSchema(e){this._dataSchemas.has(e)&&(this._dataSchemas.delete(e),this._entitySchemaRepository.clearSchemaCacheByName(e))}get(e){return this._dataSchemas.has(e)?(0,u.of)(this._dataSchemas.get(e)):this._getEntityDataSchema(e).pipe((0,c.tap)(t=>this._dataSchemas.set(e,t)))}getByEntitySchema(e){const t=e.name;return this._dataSchemas.has(t)?(0,u.of)(this._dataSchemas.get(t)):this._createEntityDataSchema(e).pipe((0,c.tap)(n=>this._dataSchemas.set(t,n)))}static{this.\u0275fac=function(t){return new(t||Qn)(i.\u0275\u0275inject(Mn),i.\u0275\u0275inject(P.Vx))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Qn,factory:Qn.\u0275fac,providedIn:"platform"})}}class $r{constructor(e,t){this._dataSchemaRepository=e,this._featureValues=t}_getDataSchema(e){var t=this;return(0,S.A)(function*(){const n=yield(0,u.firstValueFrom)(t._dataSchemaRepository.get(e));if(!n)throw new Error(`Can not find DataSchema with name '${e}'`);return n})()}_getDataSchemaAttribute(e,t){var n=this;return(0,S.A)(function*(){const s=e instanceof Gn?e:yield n._getDataSchema(e),r=s.findAttributeByName(t);if(!r)throw new Error(`Can not find column '${t}' in Schema '${s.name}'`);return r})()}_getDataSchemaPrimaryAttribute(e){var t=this;return(0,S.A)(function*(){const n=yield t._getDataSchema(e);return t._getDataSchemaAttribute(n,n.primaryAttributeName)})()}_createRelationPathItemFromForwardPathItem(e,t){var n=this;return(0,S.A)(function*(){const s=yield n._getDataSchemaAttribute(e,t);let r=null,o=null;const l=s.dataValueType===C.r.Lookup;return l&&(r=s.referenceSchemaName,o=(yield n._getDataSchema(r)).primaryAttributeName),{isJoin:l,referenceSchemaName:r,referenceAttributeName:o,ownSchemaAttributeName:t,ownSchemaName:e}})()}_createRelationPathItemFromJoinPathItem(e,t,n,s){var r=this;return(0,S.A)(function*(){const o=n?yield r._getDataSchemaAttribute(t,n):yield r._getDataSchemaPrimaryAttribute(t);return{isJoin:!0,referenceSchemaName:t,referenceAttributeName:o.name,ownSchemaAttributeName:s,ownSchemaName:e}})()}_createRelationPathItem(e,t){const s=/(?<joinType>.*)\[(?<refSchema>.*?):(?<ownColumn>.*?)(?::(?<refColumn>.*))?]/.exec(t);if(s){const r=s.groups;return this._createRelationPathItemFromJoinPathItem(e,r.refSchema,r.refColumn,r.ownColumn)}return this._createRelationPathItemFromForwardPathItem(e,t)}_getReverseRelationPath(e){const t=[...e],n=[];let s;for(;(s=t.pop())!=null;)n.push({isJoin:!0,ownSchemaName:s.referenceSchemaName,ownSchemaAttributeName:s.referenceAttributeName,referenceSchemaName:s.ownSchemaName,referenceAttributeName:s.ownSchemaAttributeName});return n}_buildRelationPath(e,t){var n=this;return(0,S.A)(function*(){const s=t.split("."),r=[];let o=e;for(const l of s){const d=yield n._createRelationPathItem(o,l);o=d.referenceSchemaName,r.push(d)}return r})()}_getRelationPathToSourceSchema(e,t,n){var s=this;return(0,S.A)(function*(){const r=[...t],o=r.pop(),l=n.split("."),h=(yield s._buildRelationPath(e,n)).pop(),f={isJoin:!0,ownSchemaName:o.isJoin?o.referenceSchemaName:o.ownSchemaName,ownSchemaAttributeName:o.isJoin?o.referenceAttributeName:o.ownSchemaAttributeName,referenceSchemaName:h.ownSchemaName,referenceAttributeName:l.pop()},I=[...r,...o.isJoin?[o]:[],f];return s._featureValues.DisableDsDepsJoinOptimization||I.length===1?I:I.filter(O=>{if(!O.isJoin)return!0;const B=O.ownSchemaName===O.referenceSchemaName,J=O.ownSchemaAttributeName===O.referenceAttributeName;return!(B&&J)})})()}_buildRelationDataFromPath(e){return e.map(t=>({attributeName:t.ownSchemaAttributeName,referenceAttributeName:t.referenceAttributeName,referenceSchemaName:t.referenceSchemaName}))}_getDataSourceParameterRelationData(e,t){var n=this;return(0,S.A)(function*(){const s=yield n._buildRelationPath(t.dataSchemaName,t.relationPath),r=yield n._getRelationPathToSourceSchema(e,s,t.attributePath),o=n._getReverseRelationPath(r);return n._buildRelationDataFromPath(o)})()}_getIsSelfSchemaRelation(e,t){return!this._featureValues.DisableSkipDSEqualRelations&&t.dataSchemaName===e&&t.attributePath===t.relationPath&&t.attributePath.split(".").length===1}_convertEntityDataSourceParameter(e,t){var n=this;return(0,S.A)(function*(){if(!t.relationsConfigs||t.relationsConfigs.length===0)return t;let s=e.name;const r=[];for(const o of t.relationsConfigs){if(n._getIsSelfSchemaRelation(s,o)){o.attributePath===e.primaryAttributeName||r.push({...o,relationData:[{referenceSchemaName:o.dataSchemaName,attributeName:o.attributePath,referenceAttributeName:o.relationPath}]});continue}const d=yield n._getDataSourceParameterRelationData(s,o);s=d[d.length-1].referenceSchemaName,r.push({...o,relationData:d})}return{...t,relationsConfigs:r}})()}convert(e,t,n=!1){return t.length===0?Promise.resolve([]):n?Promise.resolve(t):Promise.all(t.map(s=>this._convertEntityDataSourceParameter(e,s)))}static{this.\u0275fac=function(t){return new(t||$r)(i.\u0275\u0275inject(Qn),i.\u0275\u0275inject(oe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:$r,factory:$r.\u0275fac,providedIn:"root"})}}class As{constructor(e,t){this._dataSchemaRepository=e,this._parametersConverter=t}_createPrimaryColumnValueFilter(e,t){const r=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(r).pipe((0,u.map)(o=>{const l=new pe({columnPath:o.primaryAttributeName}),d=new fe({value:t.value});return new bt(ee.Equal,l,d)}))}_createColumnValueFilter(e){const t=e.value.attributePath,n=e.value.attributeValue,s=new pe({columnPath:t}),r=new fe({value:n}),o=new bt(ee.Equal,s,r);return(0,u.of)(o)}_createPrimaryDisplayValueFilter(e,t){const r=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(r).pipe((0,u.map)(o=>{const l=new pe({columnPath:o.primaryDisplayAttributeName}),d=new fe({value:t.value});return new bt(t.comparisonType,l,d)}))}_createCustomFilter(e){let t={};return e.value&&(t=typeof e.value=="string"?JSON.parse(e.value):e.value),(0,u.of)(t)}_createEmptyParameterFiler(e){const t=e.relationsConfigs||[];if(t.length===0)return(0,u.of)({});const n=t[0];return this._dataSchemaRepository.get(n.dataSchemaName).pipe((0,u.map)(s=>s.primaryAttributeName),(0,u.map)(s=>{const r=new pe({columnPath:s});return new ui(r,null)}))}_createEsqFilter(e,t){switch(t.type){case ne.PrimaryColumnValue:return this._createPrimaryColumnValueFilter(e,t);case ne.ColumnValue:return this._createColumnValueFilter(t);case ne.PrimaryDisplayValueFilter:return this._createPrimaryDisplayValueFilter(e,t);case ne.Filter:return this._createCustomFilter(t);case ne.Empty:return this._createEmptyParameterFiler(t)}}applyParameters(e,t){if(e.length===0)return(0,u.of)(t);const n=e.map(s=>this._createEsqFilter(t.rootSchemaName,s).pipe((0,u.map)(r=>new Cy().convertToRelatedFilter(r,s.relationsConfigs))));return(0,u.forkJoin)(n).pipe((0,u.tap)(s=>{s.forEach(r=>{(0,T.isEmpty)(r)||t.filters.add(r)})}),(0,u.map)(()=>t))}convertToEntityDataSourceParameters(e,t,n=!1){return(0,u.from)(this._parametersConverter.convert(e,t,n))}static{this.\u0275fac=function(t){return new(t||As)(i.\u0275\u0275inject(Qn),i.\u0275\u0275inject($r))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:As,factory:As.\u0275fac,providedIn:"root"})}}class Gr{constructor(e,t,n){this.entitySchemaQueryUtils=e,this._entitySchemaColumnAppenderFactory=t,this._dataSchemaToDataSourceAttributeConverter=n}_addPagingToEsq(e,t){t&&(e.rowsOffset=t.rowsOffset,e.rowCount=t.rowCount)}_addSortingToEsq(e,t){t&&t.columns.forEach((n,s)=>{const r=e.findColumn(n.columnName),o=fy(n.direction);r?r.withOrdering(o,s):e.addSchemaColumn(n.columnName).withOrdering(o,s)})}_addIsDistinctToEsq(e,t){t&&(e.isDistinct=!0)}_excludeHierarchyFiltersFromFiltersCollection(e,t){return t.map(n=>n?.type!==ne.Filter||!n?.value||e.hierarchicalColumnFiltersValue!==n.value?n:null).filter(n=>!!n)}_addHierarchyOptionsToEsq(e,t){t&&(t.hierarchicalFullDataLoad&&(e.hierarchicalFullDataLoad=t.hierarchicalFullDataLoad),t.hierarchicalColumnName&&(e.hierarchicalColumnName=t.hierarchicalColumnName,e.isHierarchical=!0),t.hierarchicalColumnValue&&(e.hierarchicalColumnValue=t.hierarchicalColumnValue),t.hierarchicalMaxDepth&&(e.hierarchicalMaxDepth=t.hierarchicalMaxDepth),t.hierarchicalColumnFiltersValue&&(e.hierarchicalColumnFiltersValue=t.hierarchicalColumnFiltersValue))}_addColumnToEsq(e,t){t.filter(Boolean).forEach(n=>{this._entitySchemaColumnAppenderFactory.create(n).addColumn(e,n)})}_prepareAttributePairsForLoad(e,t){return t.map(n=>{if(typeof n=="string"){const s=n,r=e.attributes.find(o=>o.name===s);return r?this._dataSchemaToDataSourceAttributeConverter.create(r.attributeType).convert(r):{name:s,path:s}}else return n})}_applyESQParameters(e,t){return e.hierarchicalColumnFiltersValue&&(t=this._excludeHierarchyFiltersFromFiltersCollection(e,t)),this.entitySchemaQueryUtils.applyParameters(t,e)}build(e,t,n,s){if(n.some(r=>r.type===ne.Never))throw new Error('Failed to build entity schema query: parameters contains "Never" model parameter.');return(0,u.forkJoin)([this.entitySchemaQueryUtils.convertToEntityDataSourceParameters(e,n),(0,u.of)(this._prepareAttributePairsForLoad(e,t))]).pipe((0,u.map)(([r,o])=>({esq:new Se(e.name),esqParameters:r,dataSourceAttributes:o})),(0,u.tap)(({esq:r,dataSourceAttributes:o})=>this._addColumnToEsq(r,o)),(0,u.tap)(({esq:r})=>this._addSortingToEsq(r,s?.sortingConfig)),(0,u.tap)(({esq:r})=>this._addPagingToEsq(r,s?.pagingConfig)),(0,u.tap)(({esq:r})=>this._addIsDistinctToEsq(r,s?.isDistinct)),(0,u.tap)(({esq:r})=>this._addHierarchyOptionsToEsq(r,s?.hierarchyConfig)),(0,u.switchMap)(({esq:r,esqParameters:o})=>this._applyESQParameters(r,o)))}static{this.\u0275fac=function(t){return new(t||Gr)(i.\u0275\u0275inject(As),i.\u0275\u0275inject(_y),i.\u0275\u0275inject(yy))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Gr,factory:Gr.\u0275fac,providedIn:"root"})}}const Td=a=>{switch(a){case C.r.Guid:return C.r.Guid;case C.r.Text:case C.r.SHORT_TEXT:case C.r.PHONE_TEXT:case C.r.WEB_TEXT:case C.r.EMAIL_TEXT:case C.r.MEDIUM_TEXT:case C.r.MAXSIZE_TEXT:case C.r.LONG_TEXT:case C.r.HASH_TEXT:case C.r.SECURE_TEXT:case C.r.RICH_TEXT:return C.r.Text;case C.r.Integer:case C.r.Enum:return C.r.Integer;case C.r.Float:case C.r.FLOAT0:case C.r.FLOAT1:case C.r.FLOAT2:case C.r.FLOAT3:case C.r.FLOAT4:case C.r.FLOAT8:case C.r.MONEY0:case C.r.MONEY1:case C.r.Money:case C.r.MONEY3:return C.r.Float;case C.r.DateTime:case C.r.Date:case C.r.Time:return C.r.DateTime;case C.r.Lookup:case C.r.IMAGELOOKUP:return C.r.Lookup;case C.r.Boolean:return C.r.Boolean;case C.r.Blob:return C.r.Blob;case C.r.Image:return C.r.Image;case C.r.Color:return C.r.Color;default:throw new Error(`Type ${a} not implemented`)}};function mv(a,e=null,t=DataValueType.Float){if(!a||a.length===0)return e;if(a.length===1)return a[0];let n=a.map(s=>Td(s)).map(s=>DataValueTypeGroup.Number.includes(s)?t:s);return n=[...new Set(n)],n.length===1?n[0]:e}class Iy extends Md{constructor(){super(...arguments),this.supportTransactions=!0}}class Qr extends Iy{get isForceUpdateUnchangedData(){return!!this.initialConfig?.isForceUpdateUnchangedData}get affectedAttributes(){return[...this._affectedAttributes]}get isAggregate(){return this.dataSchema?this.dataSchema.attributes.some(t=>t.isAggregate):!1}get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._affectedAttributes=[],this._errorReferenceAttributes=[],this.type=km,this._featureValues=t.get(oe),this._queryExecutor=t.get(xe),this._entitySchemaService=t.get(ht),this._httpClient=this.injector.get(E.HttpClient),this._rightsService=this.injector.get(Zr),this.dataSchemaRepository=this.injector.get(Qn),this._entitySchemaRepository=this.injector.get(Mn),this._entitySchemaQueryBuilder=this.injector.get(Gr),this._entitySchemaQueryUtils=this.injector.get(As),this._window=this.injector.get(P.ZP),this._measurePerformanceService=this.injector.get(Ie.g);const n=this.injector.get(L.oq);this._entityDefaultValuesUrl=n.isSSP?"/ssp/rest/EntitySchemaService/GetEntityDefaultValues":"/rest/EntitySchemaService/GetEntityDefaultValues",this.translateService=this.injector.get(v.TranslateService)}_buildSelectEsq(e,t,n){return this.getSchema().pipe((0,c.switchMap)(s=>this._entitySchemaQueryBuilder.build(s,e,t,n)),(0,c.map)(s=>(this._featureValues["DataSource-DisableRecordDeactivation"]!==!0&&(s.useRecordDeactivation=this.initialConfig.useRecordDeactivation),s.adminUnitRoleSources=this._getEsqAdminUnitRoleSources(),s)))}_getEsqAdminUnitRoleSources(){let e;const t=this.initialConfig.adminUnitRoleSources;return(0,T.isNumber)(t)?t:((0,T.isArray)(t)&&t.forEach(n=>{const s=Id[n];(0,T.isNumber)(s)&&(e=e|s)}),e)}_normalizeValue(e,t){switch(t){case C.r.Lookup:return e||null;case C.r.Date:case C.r.Time:case C.r.DateTime:return e instanceof Date?xu(e):typeof e=="string"&&Date.parse(e)>0?`"${e}"`:e;default:return e}}_buildUpdateEsq(e,t){return this.getSchema().pipe((0,c.switchMap)(n=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(n,e,!0)),(0,c.map)(n=>({updateQuery:new Vc(this._entitySchemaName),esqParameters:n})),(0,c.tap)(({updateQuery:n})=>{n.isForceUpdate=!!this.initialConfig.isForceUpdate,Object.keys(t).forEach(s=>{const r=this._findEntitySchemaColumn(s);if(!r)throw new Error(`Column ${s} not found`);const o=t[s];this._isEntityColumnValue(o)&&n.addColumn(r.name,this._normalizeValue(o,r.dataValueType),Td(r.dataValueType))})}),(0,c.switchMap)(({updateQuery:n,esqParameters:s})=>this._entitySchemaQueryUtils.applyParameters(s,n)),(0,c.catchError)(n=>(0,u.throwError)(()=>n)))}_buildInsertEsq(e){const t=new cr(this._entitySchemaName);return Object.keys(e).forEach(n=>{const s=this._findEntitySchemaColumn(n);if(!s)throw new Error(`Column ${n} not found`);const r=e[n];this._isEntityColumnValue(r)&&t.addColumn(s.name,this._normalizeValue(r,s.dataValueType),Td(s.dataValueType))}),t}_buildDeleteEsq(e){return this.getSchema().pipe((0,c.switchMap)(t=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(t,e,!0)),(0,c.switchMap)(t=>{const n=new wu(this._entitySchemaName);return this._entitySchemaQueryUtils.applyParameters(t,n)}))}_checkOwnAttributes(e){return this.getSchema().pipe((0,c.switchMap)(t=>{const n=t.attributes.filter(s=>s.attributeType!==de.OwnAttribute).filter(s=>!(0,T.isUndefined)(e[s.name]));return n.length!==0?(0,u.throwError)(()=>new Error(`Not valid attributes for this data source: ${n.map(s=>s.name).join(",")}`)):(0,u.of)(null)}))}_findEntitySchemaColumn(e){return this._entitySchema.columns.find(t=>t.name===e)}_isEntityColumnValue(e){const t=n=>typeof n=="object"&&(n===null||"value"in n);return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||e instanceof Date||t(e)}_parseDefaultValues(e,t){const n=new Map(e.attributes.map(s=>[s.name,s.dataValueType]));return t.reduce((s,r)=>{const{defaultValue:o,name:l}=r;if((0,T.isNil)(o.value))return s;if(o.displayValue)return{...s,[l]:o};const d=Lm(o.value,n.get(l));return{...s,[l]:d}},{})}_getDefaultValues(e){const t=`${this._entityDefaultValuesUrl}?entityName=${e}`;return this._httpClient.get(t).pipe((0,c.catchError)(n=>this._catchErrorResponse(n)),(0,c.map)(n=>n.GetEntityDefaultValuesResult),(0,c.mergeMap)(n=>this.getSchema().pipe((0,c.tap)(s=>{let r=this._window.defaultValueStorage;const o=n?.find(l=>l.name===s.primaryAttributeName)?.defaultValue?.value;if(r=r||{},o){const l=`${e}_${o}`;r[l]=n,this._window.defaultValueStorage=r}}),(0,c.map)(s=>this._parseDefaultValues(s,n)))))}_catchErrorResponse(e){return console.log(e),(0,u.of)({GetEntityDefaultValuesResult:[]})}_requestEntitySchemaColumnsInfo(e){const t=e.map(n=>n.attributePath);return this._entitySchemaService.getEntitySchemaColumnsInformationByPathsArray(this._entitySchema.uId,t).pipe((0,c.map)(n=>e.map(s=>({column:n[s.attributePath],config:s}))))}_getEntitySchemaForwardReferenceColumnsInfo(e){const t={name:this._entitySchemaName,loadLookupColumns:!1,forwardReferencePaths:e.map(n=>n.attributePath)};return this._entitySchemaRepository.getSchemes([t]).pipe((0,c.map)(()=>e.map(n=>{const s=n.attributePath.split("."),r=this._entitySchemaRepository.findEntitySchemaColumnByPath(this._entitySchemaName,s);return{column:new fd(r),config:n}})))}_createReferenceAttributes(e,t){return t.length===0?(0,u.of)(e):(0,u.of)(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"]).pipe((0,c.switchMap)(n=>n?this._requestEntitySchemaColumnsInfo(t):this._getEntitySchemaForwardReferenceColumnsInfo(t))).pipe((0,c.tap)(n=>{n.forEach(({column:s,config:r})=>{r.attributeType===de.AggregationAttribute&&r.aggregationConfig?.aggregationFunction===bd.Count&&(s.dataValueType=C.r.Integer),e.addAttribute(s,r)})}),(0,c.map)(()=>e))}_createAttributesFromInitialConfig(e,t={}){const n=[];return Object.entries(t).forEach(([s,r])=>{const o=r;o.type===de.ForwardReferenceAttribute&&n.push({attributeName:s,attributeType:de.ForwardReferenceAttribute,attributePath:o.path}),o.type===de.AggregationAttribute&&n.push({attributeName:s,attributeType:de.AggregationAttribute,attributePath:o.path,aggregationConfig:o.aggregationConfig}),o.type===de.FunctionAttribute&&n.push({attributeName:s,attributeType:de.FunctionAttribute,attributePath:o.path,functionConfig:o.functionConfig})}),this._createReferenceAttributes(e,n).pipe((0,c.catchError)(s=>{const r=s.message&&s.toString(),o=new oy(this,r);return this._errors.push(o),n.forEach(l=>{this._errorReferenceAttributes.push(l)}),(0,u.of)(e)}))}_shouldSkipLoad(e){return e.some(t=>t.type===ne.Never)}_setValidValuesForLookupAttributes(e,t){return Object.keys(t).forEach(n=>{const s=e.attributes.find(r=>r.name===n);s&&(s.dataValueType===C.r.Lookup||s.dataValueType===C.r.IMAGELOOKUP)&&t[n]===""&&(t[n]=null)}),t}_throwErrorResponse(e){const t=typeof e=="string"?e:e?.message;return(0,u.throwError)(()=>({success:!1,rowsAffected:0,errorInfo:t}))}_mapOperationResult(e){return{success:e.success,rowsAffected:e.rowsAffected}}_getIsAffectedAttributeStored(e){return this._affectedAttributes.some(t=>t.path===e.path&&t.schemaName===e.schemaName)}_collectUsedAttributes(e){let t=e._getUsedColumns();t=t.filter(n=>!this._getIsAffectedAttributeStored(n)),this._affectedAttributes.push(...t)}_findErrorReferenceAttribute(e){const t=typeof e=="string"?e:e.name;return this._errorReferenceAttributes.find(n=>n.attributeName===t)}_load(e,t,n,s){if(this.hasErrors){if(this.hasCriticalErrors)return(0,u.throwError)(()=>this.getLastError());if(e.length!==0&&e.every(o=>this._findErrorReferenceAttribute(o)!=null))return(0,u.throwError)(()=>this.getLastError())}return this._shouldSkipLoad(t)?(0,u.of)([]):this._buildSelectEsq(e,t,n||{}).pipe((0,c.tap)(r=>this._collectUsedAttributes(r)),(0,c.switchMap)(r=>{let o;const l={throttled:n?.throttled};return s?(r.queryId=s.id,o=this._queryExecutor.executeSelectQuery(r,l,s.transactionId),s.markAsReady()):o=this._queryExecutor.executeSelectQuery(r,l),o.pipe(this._measurePerformanceService.measure$(`EntityDataSource.load.executeSelectQuery.${this.dataSourceName}`),(0,c.catchError)(d=>d instanceof zc?(0,u.throwError)(()=>d):(0,u.throwError)(()=>new Error(this.translateService.instant("BaseViewModel.LoadingModelErrorMessage")))))}),(0,c.map)(r=>r),(0,c.mergeMap)(r=>this.getSchema().pipe((0,c.map)(o=>(o.attributes&&r.forEach(l=>{this._setValidValuesForLookupAttributes(o,l)}),r)))))}_save(e,t,n){return this.hasCriticalErrors?(0,u.throwError)(()=>this.getLastError()):this._checkOwnAttributes(t).pipe((0,c.switchMap)(()=>this._buildUpdateEsq(e,t)),(0,c.switchMap)(s=>{if(n){s.queryId=n.id;const r=this._queryExecutor.executeUpdateQuery(s,n.transactionId);return n.markAsReady(),r}return this._queryExecutor.executeUpdateQuery(s)}),(0,c.map)(s=>this._mapOperationResult(s)),(0,c.catchError)(s=>this._throwErrorResponse(s)))}_insert(e,t){return this.hasCriticalErrors?(0,u.throwError)(()=>this.getLastError()):this._checkOwnAttributes(e).pipe((0,c.map)(()=>this._buildInsertEsq(e)),(0,c.switchMap)(n=>{let s;return t?(n.queryId=t.id,s=this._queryExecutor.executeInsertQuery(n,t.transactionId),t.markAsReady()):s=this._queryExecutor.executeInsertQuery(n),(0,u.forkJoin)({response:s,dataSchema:this.getSchema()})}),(0,c.map)(({response:n,dataSchema:s})=>({...this._mapOperationResult(n),primaryAttributes:[{[s.primaryAttributeName]:n.id}]})),(0,c.catchError)(n=>this._throwErrorResponse(n)))}_delete(e,t){return this.hasCriticalErrors?(0,u.throwError)(()=>this.getLastError()):this._buildDeleteEsq(e).pipe((0,c.tap)(n=>{n.queryId=t?.id}),(0,c.switchMap)(n=>{if(t){n.queryId=t.id;const s=this._queryExecutor.executeDeleteQuery(n,t.transactionId);return t.markAsReady(),s}return this._queryExecutor.executeDeleteQuery(n)}),(0,c.map)(n=>this._mapOperationResult(n)),(0,c.catchError)(n=>this._throwErrorResponse(n)))}innerLoad(e,t,n){return this._load(e,t,n)}innerSave(e,t){return this._save(e,t)}innerInsert(e){return this._insert(e)}innerDelete(e){return this._delete(e)}innerGetSchema(){return this.hasCriticalErrors?(0,u.throwError)(()=>this.getLastError()):this.dataSchemaRepository.get(this._entitySchemaName).pipe((0,c.map)(e=>new Vm(e)),(0,c.switchMap)(e=>this._createAttributesFromInitialConfig(e,this.initialConfig.attributes)),(0,c.tap)(e=>{const t=this._getDefaultValues(this._entitySchemaName).pipe((0,c.shareReplay)({bufferSize:1,refCount:!0}));e.setAttributesDefaultValue(t)}),(0,c.map)(e=>e.build()))}innerGetLookupDataSchema(e){if(this.hasCriticalErrors)return(0,u.throwError)(()=>this.getLastError());const n=e.split(".")[0],s=this._findEntitySchemaColumn(n);return s?s.dataValueType!==C.r.Lookup?(0,u.throwError)(()=>new Error(`DataValueType for column '${n}' isn't lookup`)):s.referenceSchemaName?this.dataSchemaRepository.get(s.referenceSchemaName):(0,u.throwError)(()=>new Error(`referenceSchemaName for column '${n}' is absent`)):(0,u.throwError)(()=>new Error(`Can't find column with name '${n}'`))}innerGetDefaultValues(){return this.hasCriticalErrors?(0,u.throwError)(()=>this.getLastError()):this._getDefaultValues(this._entitySchemaName)}innerCanDelete(e){return this.hasCriticalErrors?(0,u.of)({result:!1}):this._rightsService.getCanDelete({schemaName:this.initialConfig.entitySchemaName,primaryColumnValue:e.primaryColumnValue})}innerCanCreate(e){if(this.hasCriticalErrors)return(0,u.of)({result:!1});const t={isNew:!0,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}innerCanEdit(e){if(this.hasCriticalErrors)return(0,u.of)({result:!1});const t={primaryColumnValue:e.primaryColumnValue,isNew:!1,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}getEmptySchema(){return this._entitySchemaName?new Gn({name:this._entitySchemaName}):super.getEmptySchema()}init(e,t){return super.init(e,t).pipe((0,c.mergeMap)(n=>{if(!this.initialConfig.entitySchemaName){const s=new gy(this);return this._errors.push(s),(0,u.throwError)(()=>s)}return(0,u.of)(n)}),(0,c.tap)(()=>this._entitySchemaName=this.initialConfig.entitySchemaName),(0,c.mergeMap)(n=>this._entitySchemaRepository.getSchemaByName(this.initialConfig.entitySchemaName).pipe((0,c.tap)(s=>this._entitySchema=s),(0,c.catchError)(()=>{this._entitySchema=new Om,this._entitySchema.name=this._entitySchemaName,this._entitySchema.columns=[];const s=new my(this,this._entitySchemaName);return this._errors.push(s),(0,u.throwError)(()=>s)}),(0,c.map)(()=>n))))}getOwnLoadParameters(){return this.initialConfig?.loadParameters}getAllowCopyingRecords(){return this.initialConfig?.allowCopyingRecords}loadInTransaction(e,t,n,s){return this._load(t,n,s,e)}saveInTransaction(e,t,n){return this._save(t,n,e)}insertInTransaction(e,t){return this._insert(t,e)}deleteInTransaction(e,t){return this._delete(t,e)}}class by extends Qr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotActionDataSource",this._intentManager=this.injector.get(vi)}_getActionUId(e){return e.filter(n=>n.type===ne.PrimaryColumnValue)[0]?.value}innerDelete(e){return(0,u.of)(void 0)}innerInsert(e){const t=e;return(0,u.forkJoin)([this._intentManager.createAction(t),this.getSchema()]).pipe((0,u.map)(([n,s])=>({success:n.success,rowsAffected:1,errorInfo:n.errorInfo?.message,primaryAttributes:n.success?[{[s.primaryAttributeName]:t.Id}]:null})))}innerLoad(e,t,n){const s=this._getActionUId(t);return s?this._intentManager.getActionByUId(s).pipe((0,u.map)(r=>[r])):(0,u.of)([])}innerSave(e,t){const n=this._getActionUId(e),s=t;return s.Id=n,this._intentManager.updateAction(s).pipe((0,u.map)(r=>({success:r.success,rowsAffected:1,errorInfo:r.errorInfo?.message})))}}class zm{}const Sy="CopilotIntentStatus",vy=new Map([["InDevelopment","4670b068-ad03-4364-9350-6cc61efd1b7f"],["Active","1d73b111-07a9-49e2-aa15-c9415cce7470"],["Deactivated","2c547e71-7a05-42e1-8b65-2bf63f200156"]]),Ty="CopilotIntentMode",xy={Chat:"Chat",Api:"API"},wy=new Map([["Chat","326bba59-302a-4a5e-857c-2576e1a38ab0"],["API","5f2dc095-4543-4972-b6bc-6599bf6bc3fd"]]),Fm={System:{value:"35f3b644-4fa3-4d1e-8e62-5c3fdc4d3e52",displayValue:"System",primaryColorValue:"#22AC14"},Skill:{value:"6d940b75-21c8-4a90-89ab-9867e6e4a045",displayValue:"Skill",primaryColorValue:"#7848EE"},Agent:{value:"a8fbe253-be1b-4ec4-bc58-65b8047013da",displayValue:"Agent",primaryColorValue:"#E67E22"}};function Ny(){return(0,u.of)(Object.values(Fm))}class Jr{constructor(e){this._entitySchemaService=e}_loadPrimaryColumns(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,c.map)(t=>{const n=t.entitySchema.getPrimaryColumn(),s=t.entitySchema.getPrimaryDisplayColumn();if((0,T.isEmpty)(s))throw new Error(`Entity ${e} should have primary display column`);return{primaryColumnName:n.name,primaryDisplayColumnName:s?.name}}))}getColumnLookupValues(e){if((0,T.isEmpty)(e))return(0,u.of)(null);const t=this._loadPrimaryColumns(e),n=(0,u.from)(_t.create(e));return(0,u.forkJoin)([t,n]).pipe((0,c.switchMap)(([s,r])=>(0,u.from)(r.load({attributes:[s.primaryColumnName,s.primaryDisplayColumnName]})).pipe((0,c.map)(l=>l.map(d=>({value:d[s.primaryColumnName],displayValue:d[s.primaryDisplayColumnName]}))))))}static{this.\u0275fac=function(t){return new(t||Jr)(i.\u0275\u0275inject(ht))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Jr,factory:Jr.\u0275fac,providedIn:"root"})}}class qr{constructor(e,t){this._columnLookupValuesService=e,this._injector=t,this._intentStatuses=vy,this._intentModes=wy}convertToDataSourceModel(e){const t=this._injector.get(zm);return(0,u.combineLatest)([this._columnLookupValuesService.getColumnLookupValues(Sy),this._columnLookupValuesService.getColumnLookupValues(Ty),Ny(),t.getAllLlmModels()]).pipe((0,u.map)(([n,s,r])=>{const o=this._intentStatuses.get(e.Status),l=n.find(J=>J.value===o),d=this._intentModes.get(e.Mode)??this._intentModes.get(xy.Chat),h=s.find(J=>J.value===d),f=r.find(J=>J.displayValue===e.Type),I=t.getModelByCodeSync(e.LlmModel),O={Id:e.UId,Code:e.Code,Description:e.Description,Prompt:e.Prompt,Type:f,Name:e.Title,Status:l,PackageUId:e.PackageUId,LlmModel:I?{value:I.Id,displayValue:I.Name}:null,ResponseFormatJsonSchema:e.ResponseFormatJsonSchema};return e.Type==="Agent"?{...O,Restrictions:e.Restrictions,RoleDescription:e.RoleDescription}:{...O,Mode:h}}))}convertToModel(e){const t={};for(const[n,s]of Object.entries(e)){let r=n,o=s;n==="Name"&&(r="Title"),n==="Id"&&(r="UId"),n==="Status"&&(o=[...this._intentStatuses].filter(([,l])=>l===e.Status.value).map(([l])=>l).shift()),n==="Mode"&&(o=[...this._intentModes].filter(([,l])=>l===e.Mode.value).map(([l])=>l).shift()),n==="Type"&&(o=Object.values(Fm).filter(l=>l.value===e.Type.value).map(l=>l.displayValue).shift()),n==="LlmModel"&&(o=this._injector.get(zm).getModelByNameSync(e.LlmModel?.displayValue)?.Code),t[r]=o}return t}static{this.\u0275fac=function(t){return new(t||qr)(i.\u0275\u0275inject(Jr),i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:qr,factory:qr.\u0275fac,providedIn:"root"})}}class Ey extends Qr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._defaultValuesMap=new Map,this.type="crt.CopilotIntentDataSource",this._intentManager=this.injector.get(vi),this._copilotIntentDataSourceModelConvertor=this.injector.get(qr),this._initDefaultValuesMap()}_initDefaultValuesMap(){this._defaultValuesMap.set("CopilotIntent",{UId:(0,A.qv)(),Status:"Active",Mode:"Chat",Type:"Skill",Prompt:this.translateService.instant("CopilotIntentDataSource.DefaultValues.Prompt")}),this._defaultValuesMap.set("CopilotAgent",{UId:(0,A.qv)(),Status:"Active",Type:"Agent"})}innerGetDefaultValues(){const e=this.initialConfig.entitySchemaName,t=this._defaultValuesMap.get(e);return this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(t)}innerInsert(e){const t=this._copilotIntentDataSourceModelConvertor.convertToModel({...e});return(0,u.forkJoin)([this._intentManager.createIntent(t),this.getSchema()]).pipe((0,u.map)(([n,s])=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message,primaryAttributes:[{[s.primaryAttributeName]:n.schemaUid}]})),(0,c.switchMap)(n=>n.success?(0,u.of)(n):(0,u.throwError)(()=>n)))}innerLoad(e,t,n){const s=t.filter(r=>r.type===ne.PrimaryColumnValue);if(s.length)return this._intentManager.getIntent(s[0].value).pipe((0,c.switchMap)(r=>this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(r).pipe((0,u.map)(o=>[o]))))}innerSave(e,t){const s=e.filter(o=>o.type===ne.PrimaryColumnValue)[0].value,r=this._copilotIntentDataSourceModelConvertor.convertToModel({...t});return r.UId=s,this._intentManager.updateIntent(r).pipe((0,u.map)(o=>({success:o.success,rowsAffected:o.success?1:0,errorInfo:o.errorInfo?.message})),(0,c.switchMap)(o=>o.success?(0,u.of)(o):(0,u.throwError)(()=>o)))}}class Dy{static fromJson(e){throw new Error("not implemented")}}class Ay{static resolve(e){return{[Ce.Compare]:bt,[Ce.FilterGroup]:Ve,[Ce.In]:gn,[Ce.IsNull]:fn,[Ce.Exists]:ui,[Ce.Between]:er}[e]}}class Oy{static fromJson(e,t){throw new Error("not implemented")}}class Py{static resolve(e){return{[ut.Macros]:hi,[ut.Length]:rr,[ut.Window]:or,[ut.DatePart]:pi,[ut.DateAdd]:pi,[ut.DateDiff]:pi}[e.functionType]}}class ky{static resolve(e,t){return{[ot.SchemaColumn]:pe,[ot.Parameter]:fe,[ot.SubQuery]:ir,[ot.ArithmeticOperation]:sr,[ot.Function]:Py.resolve(t)}[e]}}class xd extends Oy{static fromJson(e,t){const n=e.expressionType;return ky.resolve(n,e).fromJson(e,t,xd)}}class Kr extends Dy{static fromJson(e){const t=e.filterType,n=e.isEnabled,s=e.trimDateTimeParameterToDate,r=Ay.resolve(t).fromJson(e,Kr,xd);return r.isEnabled=n!==!1,r.trimDateTimeParameterToDate=s===!0,r}}class Xr{convertToDataSourceModel(e){return(0,u.of)({Id:e.UId,Intent:e.Intent,Code:e.Code,Name:e.Name,Description:e.Description,SourceCollection:e.SourceCollection,DataValueTypeUId:e.DataValueTypeUId})}convertToModel(e){const t={};return Object.entries(e).forEach(([n,s])=>{n==="Id"&&(n="UId"),t[n]=s}),t}static{this.\u0275fac=function(t){return new(t||Xr)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Xr,factory:Xr.\u0275fac,providedIn:"root"})}}class jy extends Qr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotIntentParameterDataSource",this._intentManager=this.injector.get(vi),this._modelConvertor=this.injector.get(Xr)}_getPrimaryColumnParameter(e){return e.find(t=>t.type===ne.PrimaryColumnValue&&(0,A.n7)(t.value))}_getIsIntentUIdParameter(e){return(e.relationsConfigs??[]).some(t=>t.dataSchemaName==="CopilotIntent"&&t.attributePath==="Intent")}_getSourceCollectionFilterValue(e){const t=e.find(r=>r.type===ne.Filter);if(!t?.value)return null;const n=Kr.fromJson(t.value);let s;return n.filters.forEach(r=>{r instanceof bt&&r.leftExpression instanceof pe&&r.leftExpression.columnPath==="SourceCollection"&&r.rightExpression instanceof fe&&(s=r.rightExpression.value)}),s}innerGetDefaultValues(){return this._modelConvertor.convertToDataSourceModel({UId:(0,A.qv)()})}innerInsert(e){const t=this._modelConvertor.convertToModel({...e});return this._intentManager.createIntentParameter(t).pipe((0,u.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message,primaryAttributes:[{Id:t.UId}]})),(0,u.switchMap)(n=>n.success?(0,u.of)(n):(0,u.throwError)(()=>n)))}innerLoad(e,t,n){const s=this._getPrimaryColumnParameter(t),r=this._getSourceCollectionFilterValue(t)??"InputParameters";return s?(this._getIsIntentUIdParameter(s)?this._intentManager.getIntentParameters(s.value,r):this._intentManager.getIntentParameter(s.value).pipe((0,u.map)(l=>[l]))).pipe((0,u.mergeMap)(l=>(0,u.from)(l).pipe((0,u.mergeMap)(d=>this._modelConvertor.convertToDataSourceModel(d)),(0,u.toArray)())),(0,u.catchError)(()=>(0,u.of)([]))):(0,u.of)([])}innerSave(e,t){const n=this._getPrimaryColumnParameter(e)?.value,s=this._modelConvertor.convertToModel({...t});return s.UId=n,this._intentManager.updateIntentParameter(s).pipe((0,u.map)(r=>({success:r.success,rowsAffected:r.success?1:0,errorInfo:r.errorInfo?.message})),(0,u.switchMap)(r=>r.success?(0,u.of)(r):(0,u.throwError)(()=>r)))}innerDelete(e){const t=this._getPrimaryColumnParameter(e)?.value;return this._intentManager.deleteIntentParameter(t).pipe((0,u.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message})),(0,u.switchMap)(n=>n.success?(0,u.of)(n):(0,u.throwError)(()=>n)))}}class Ry extends Qr{innerDelete(e){return(0,u.of)(null)}innerInsert(e){return(0,u.of)(null)}innerLoad(e,t){return(0,u.of)([])}innerSave(e,t){return(0,u.of)(null)}innerGetLookupDataSchema(e){return(0,u.of)(null)}innerGetDefaultValues(){return(0,u.of)(null)}innerCanDelete(e){return(0,u.of)(null)}innerCanEdit(e){return(0,u.of)(null)}innerCanCreate(e){return(0,u.of)(null)}}var Vt;(function(a){a.Create="create",a.Update="update",a.Delete="delete"})(Vt||(Vt={}));const wd=window;class eo{constructor(){this._event$=new u.Subject}static get instance(){return wd.__modelEventNotificationService||(wd.__modelEventNotificationService=new eo),wd.__modelEventNotificationService}get event$(){return this._event$.asObservable()}notify(e){this._event$.next(e)}}class to{constructor(){this.changedValues$=new u.Subject,this._valuesStore={}}setValues(e){if(e){const t={};Object.entries(e).forEach(([n,s])=>{const r=this._valuesStore[n]!==s;this._valuesStore[n]=(0,T.cloneDeep)(s),r&&(t[n]=this._valuesStore[n])}),(0,T.isEmpty)(t)||this.changedValues$.next(t)}}get values(){return this._valuesStore}static{this.\u0275fac=function(t){return new(t||to)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:to,factory:to.\u0275fac})}}const Bm="PrimaryValue",Um="DisplayValue",Nd="PrimaryColorValue";class no{constructor(e,t){this._queryExecutor=e,this._entitySchemaRepository=t}_getInFilter(e){const t=new hi({macrosType:ns.PrimaryColumn});return new gn(ee.Equal,t,e.map(n=>new fe({value:n})))}_getEsq(e,t){const n=new Se(e);return this._entitySchemaRepository.getSchemaByName(e).pipe((0,c.map)(s=>{n.addMacrosFunctionColumn(ns.PrimaryColumn,Bm),n.addMacrosFunctionColumn(ns.PrimaryDisplayColumn,Um);const r=s.getPrimaryColorColumn();r&&n.addSchemaColumn(r.name,Nd);const o=this._getInFilter(t);return n.filters.add(o),n}))}_getSchemaLookupData(e,t){const n={};for(let s=0;s<t.length;s++){const r=t[s],[o,l]=e[s];n[o]={};for(const d of l){const h=r.find(f=>f[Bm]===d);if(h){const f=[h[Um]];h[Nd]&&f.push(h[Nd]),n[o][d]=h?f:null}}}return n}load(e){const t=Object.entries(e);return(0,u.forkJoin)(t.map(([n,s])=>this._getEsq(n,s))).pipe((0,u.switchMap)(n=>this._queryExecutor.executeBatchSelectQuery(n).pipe((0,c.map)(s=>this._getSchemaLookupData(t,s)))))}static{this.\u0275fac=function(t){return new(t||no)(i.\u0275\u0275inject(xe),i.\u0275\u0275inject(Mn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:no,factory:no.\u0275fac,providedIn:"root"})}}class Ly extends Md{constructor(e,t){super(e,t),this.dataSourceName=e,this._injector=t,this.type=jm,this._schemaParametersStore=this._injector.get(to),this._lookupDataLoadService=this._injector.get(no),this._featureValues=this._injector.get(oe),this._featureValues.DisableCommunicationBetweenSchemas||this._subscribeParametersChanged()}_subscribeParametersChanged(){this._schemaParametersStore.changedValues$.subscribe(e=>{eo.instance.notify({modelId:(0,A.qv)(),dataSchemaName:this.dataSchema.name,type:Vt.Update,payload:{primaryAttributesValues:null,changedAttributes:Object.keys(e)}})})}_getCanSuccessfullyExecuteOperationResult(){return(0,u.of)({result:!0})}_fillLookupValues(e,t,n){Object.entries(n).forEach(([s,[r,o]])=>{(t[s]||[]).forEach(d=>{e[d]=o?{value:s,displayValue:r,primaryColorValue:o}:{value:s,displayValue:r}})})}_fillSchemaParameterValueNameMap(e,t,n,s){const r=s;let o=e[t];o||(o={},e[t]=o);let l=o[r];l||(l=[],o[r]=l),l.push(n)}_fillSchemaNamePrimaryValuesMap(e,t,n){const s=n;let r=e[t];r||(r=[],e[t]=r),r.push(s)}_isLookupValue(e){return!!e?.value}_shouldFillSchemaLookupValueMaps(e,t){return e&&t&&t.referenceSchemaName&&!this._isLookupValue(e)}_load(e,t){const n={},s=this._schemaParametersStore.values,r=t.attributes,o={},l={};for(const h of e){const f=s[h],I=r.find(O=>O.name===h);if(this._shouldFillSchemaLookupValueMaps(f,I)){this._fillSchemaNamePrimaryValuesMap(l,I.referenceSchemaName,f),this._fillSchemaParameterValueNameMap(o,I.referenceSchemaName,h,f);continue}n[h]=f??null}return Object.keys(l).length===0?(0,u.of)([n]):this._lookupDataLoadService.load(l).pipe((0,u.map)(h=>{for(const[f,I]of Object.entries(h)){const O=o[f];this._fillLookupValues(n,O,I)}return[n]}))}_getValuesForStore(e){const t={};return Object.entries(e).forEach(([n,s])=>{const r=this.initialConfig.parameters[n];if(!r)return;cd(r.dataValueTypeName)===C.r.Lookup?t[n]=s?.value:t[n]=s}),t}innerLoad(e,t,n){return this.getSchema().pipe((0,u.switchMap)(s=>this._load(e,s)))}innerSave(e,t){const n=this._getValuesForStore(t);return this._schemaParametersStore.setValues(n),(0,u.of)({success:!0,rowsAffected:1})}innerInsert(e){const t=this._getValuesForStore(e);return this._schemaParametersStore.setValues(t),(0,u.of)({success:!0,rowsAffected:1,primaryAttributes:[]})}innerDelete(e){return(0,u.of)({success:!0,rowsAffected:1})}innerGetSchema(){const e=[],t=this.initialConfig.parameters;return t&&Object.entries(t).forEach(([n,s])=>{const r=new Wr({name:n,caption:s.caption,dataValueType:cd(s.dataValueTypeName),attributeType:de.OwnAttribute,path:n,isRequired:!!s.isRequired,referenceSchemaName:s.referenceSchemaName,isMasked:!1,isFormatValidated:!0});r.addDefaultValidators(),e.push(r)}),(0,u.of)(new Gn({name:this.initialConfig.schemaName,type:Ds.ClientUnit,attributes:e}))}innerGetLookupDataSchema(e){return(0,u.of)(null)}innerGetDefaultValues(){return(0,u.of)({})}innerCanEdit(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanDelete(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanCreate(e){return this._getCanSuccessfullyExecuteOperationResult()}}class Vy extends Md{constructor(){super(...arguments),this.type="crt.WebServiceDataSource"}innerLoad(e,t,n){throw new Error("Method not implemented.")}innerSave(e,t){throw new Error("Method not implemented.")}innerInsert(e){throw new Error("Method not implemented.")}innerDelete(e){throw new Error("Method not implemented.")}innerGetSchema(){throw new Error("Method not implemented.")}innerGetLookupDataSchema(e){throw new Error("Method not implemented.")}innerGetDefaultValues(){throw new Error("Method not implemented.")}innerCanDelete(e){throw new Error("Method not implemented.")}innerCanEdit(e){throw new Error("Method not implemented.")}innerCanCreate(e){throw new Error("Method not implemented.")}}class io{resolve(e){let t=null;switch(e){case km:t=Qr;break;case jm:t=Ly;break;case"crt.WebServiceDataSource":t=Vy;break;case"crt.CopilotIntentDataSource":t=Ey;break;case"crt.CopilotIntentParameterDataSource":t=jy;break;case"crt.CopilotActionDataSource":t=by;break;case"crt.DashboardDataSource":t=Ry;break}return(0,u.of)(t)}static{this.\u0275fac=function(t){return new(t||io)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:io,factory:io.\u0275fac})}}class xi{constructor(e,t){this.injector=e,this.resolver=t}create(e,t,n){const{type:s,scope:r,config:o}=t;return this.resolver.resolve(s).pipe((0,c.switchMap)(d=>d?new d(e,n||this.injector).init(o,r):(0,u.throwError)(()=>new Error(`Data source type '${s}' not supported.`))),(0,c.catchError)(d=>d instanceof Cd?(0,u.of)(d.dataSource):(0,u.throwError)(()=>d)))}static{this.\u0275fac=function(t){return new(t||xi)(i.\u0275\u0275inject(i.Injector),i.\u0275\u0275inject(io))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:xi,factory:xi.\u0275fac})}}class zy{}function Hm(a,e,t){return!a||!e||!t}function Ym(a,e){return`/img/entity/hash/${a}/${e}/`}function El(a,e="SysImage",t="Data"){if(Hm(a,e,t))return"";const n=Ym(e,t);return`${H()}${n}${a}`}function gv(a,e="SysImage",t="Data"){return Hm(a,e,t)?"":`${Ym(e,t)}${a}`}function Fy(a){let e="";if(typeof a=="string"){const n=new TextEncoder().encode(a);e=String.fromCharCode(...n)}else if(a instanceof ArrayBuffer){const t=new Uint8Array(a);for(let n=0;n<t?.byteLength;n++)e+=String.fromCharCode(t[n])}return window.btoa(e)}function fv(a){const e=new DOMParser().parseFromString(a,"text/html"),t=e?.querySelectorAll("svg");return t.length>0&&t.forEach(n=>{const s=e.createElement("img"),r=Fy(n.outerHTML);s.src=`data:image/svg+xml;base64,${r}`,n?.parentNode.replaceChild(s,n)}),e?.body.innerHTML||a}class Pe{static _setImageLookupTypeUrl(e,t){const n=e[t],s=n?.value;s&&(n.url=El(s))}static _setBlobTypeUrl(e,t,n){const s=t[n];if(s){const r=t.Id;t[n]={value:s,url:El(r,e,n)}}}static _addImageUrl(e,t,n){t.forEach(s=>{switch(s.dataValueType){case C.r.IMAGELOOKUP:{this._setImageLookupTypeUrl(n,s.name);break}case C.r.Image:{this._setBlobTypeUrl(e,n,s.name);break}default:break}})}static serializeRecordPrimaryAttributesValues(e){return e.map(t=>`${t.name}:${t.value}`).join(";")}static getModelPrimaryAttributeValues(e,t){const n=e.getPrimaryAttributesNames();return t.map(s=>n.map(r=>({name:r,value:s[r]})))}static getOwnColumnsValues(e,t){const n=t??{};if(e.attributes.length){const s=e.attributes.filter(r=>r.attributeType===de.OwnAttribute).map(r=>r.name).filter(r=>!(0,T.isUndefined)(n[r])).map(r=>[r,n[r]]);return Object.fromEntries(s)}else return n}static getPrimaryAttributeValuesFromParameters(e,t){const n=t.filter(s=>s.type===ne.PrimaryColumnValue);return n.length?n.map(s=>({[e.primaryAttributeName]:s.value})):[]}static getPrimaryAttributeValuesFromData(e,t){const n=e.getPrimaryAttributesNames();return n.length?n.filter(s=>t[s]).map(s=>({[s]:t[s]})):[]}static getPrimaryAttributeValues(e,t,n){const s=this.getPrimaryAttributeValuesFromData(e,t);return s.length?s:this.getPrimaryAttributeValuesFromParameters(e,n)}static getDataSourceLoadOptions(e){const t={loadType:e?.loadType||ve.Load};return e?.pagingConfig&&(t.pagingConfig=e.pagingConfig),e?.sortingConfig&&(t.sortingConfig=e.sortingConfig),e?.hierarchyConfig&&(t.hierarchyConfig=e.hierarchyConfig),e?.isDistinct&&(t.isDistinct=e.isDistinct),t}static getImageAttributes(e,t){const n=[];return(t||[]).forEach(s=>{const r=e.findAttributeByName(s);r?.isImage&&n.push(r)}),n}static processImageData(e,t,n){const s=Pe.getImageAttributes(e,n);return s.length>0&&t.forEach(r=>this._addImageUrl(e.name,s,r)),t}static removeNotRequestedData(e,t){return Object.keys(t).forEach(n=>{e.includes(n)||delete t[n]}),t}static getLoadRequestSignature(e,t,n,s){return JSON.stringify(e)+JSON.stringify(t)+JSON.stringify(n)+JSON.stringify(s)}}const By={[z.Init]:[z.Create,z.Copy,z.Update,z.Delete],[z.Copy]:[z.Delete,z.Update],[z.Create]:[z.Copy,z.Delete,z.Update],[z.Delete]:[z.Copy,z.Create,z.Update,z.Init],[z.Update]:[z.Delete],[z.Unknown]:[]};function Ed(a){const e={success:!1,rowsAffected:0,errorInfo:""};return typeof a=="string"?Object.assign(e,{errorInfo:a}):a instanceof Error?Object.assign(e,{errorInfo:a.message}):Object.assign(e,typeof a=="object"?a:{errorInfo:a})}class Os{get _children(){return this._children$.value}static get instance(){return this._instance||(this._instance=new Os(null,null)),this._instance}constructor(e,t){this.injector=e,this.dataSource=t,this._lookupDataSourceName="lookupDataSource",this._id=(0,A.qv)(),this._modeChanges=new u.Subject,this._destroyed$=new u.Subject,this._children$=new u.BehaviorSubject([]),this._childrenDirty$=new u.BehaviorSubject(!1),this._childrenModes$=new u.BehaviorSubject([]),this._isCollectionModel=!1,this._isCollectionItemModel=!1,this._mode=z.Init,this._isInitialized=!1,this._isLoaded=!1,this._dirtyAttributes=new Set,this._newLoadingRequestArrived=new u.Subject,this._attributesMap=[],this._selfDirty$=new u.BehaviorSubject(!1),this._isLoading=!1,this._destroyed=!1,this._doNotAllowCancelRequest=!1,this._dirty$=(0,u.combineLatest)([this._selfDirty$,this._childrenDirty$,this._childrenModes$]).pipe((0,c.map)(([n,s,r])=>n||s||r.includes(z.Copy)||r.includes(z.Create)),(0,c.distinctUntilChanged)()),this._loadedData=new Set,this.injector&&(this._dataSourceFactory=this.injector.get(xi),this._lifecycleHookNotificationService=this.injector.get(zy,null,{optional:!0}),this._measurePerformanceService=this.injector.get(Ie.g,null,{optional:!0}),this._doNotAllowCancelRequest=this.injector.get(oe,null,{optional:!0})?.DoNotAllowCancelRequest)}get name(){return this.dataSource?this.dataSource.dataSourceName:""}get mode(){return this._isCollectionModel?z.Unknown:this._mode}get _modeChanges$(){return this._modeChanges.asObservable()}get _isChanged(){return!!this._dirtyAttributes?.size}set _isCollection(e){this._isCollectionModel=e,this._isCollectionModel&&(this._mode=z.Unknown)}get isLoaded(){return this._isLoaded}get event$(){return eo.instance.event$.pipe((0,c.filter)(()=>this._isInitialized),(0,c.filter)(()=>!this._isCollectionItemModel),(0,c.filter)(({dataSchemaName:e})=>e===this._dataSchemaName),(0,c.tap)(({type:e,modelId:t,payload:n})=>this._updateLoadedData(e,t,n)),(0,c.filter)(({modelId:e})=>e!==this._id&&!this._isChild(e)),(0,c.map)(e=>({event:e,ownPrimaryAttributesValues:e.payload?.primaryAttributesValues?.filter(t=>{const n=Pe.serializeRecordPrimaryAttributesValues(t);return this._loadedData.has(n)})})),(0,c.filter)(({event:e,ownPrimaryAttributesValues:t})=>e.type===Vt.Update||e.type===Vt.Delete?!t||t.length!==0:!0),(0,c.map)(({event:e,ownPrimaryAttributesValues:t})=>({event:e,primaryAttributesValues:e.type===Vt.Create?e.payload.primaryAttributesValues:t})),(0,c.map)(({event:e,primaryAttributesValues:t})=>({modelId:e.modelId,dataSchemaName:e.dataSchemaName,type:e.type,payload:{...e.payload,primaryAttributesValues:t}})),(0,c.takeUntil)(this._destroyed$))}get dataSchemaName(){return this._dataSchemaName}get allowSync(){return!this._disableSync}get disableSync(){return this._disableSync}set disableSync(e){this._disableSync=e}get isLoading(){return this._isLoading}get hasErrors(){return this.dataSource?this.dataSource.hasErrors:!0}get hasCriticalErrors(){return this.dataSource?this.dataSource.hasCriticalErrors:!0}get affectedAttributes(){return this.dataSource?this.dataSource.affectedAttributes:[]}get isAggregate(){return this.dataSource?this.dataSource.isAggregate:!1}get supportsTransactions(){return!1}get isCollectionItemModel(){return this._isCollectionItemModel}get isInitialized(){return this._isInitialized}_isChild(e){return this._children.some(t=>t?._id===e)}_subscribeChildrenModeChanges(){this._children$.pipe((0,c.map)(e=>e.map(t=>(0,u.merge)((0,u.of)(t.mode),t._modeChanges$))),(0,c.switchMap)(e=>e?.length?(0,u.combineLatest)(e):(0,u.of)([])),(0,c.tap)(e=>this._childrenModes$.next(e)),(0,c.takeUntil)(this._destroyed$)).subscribe()}_subscribeChildrenDirtyChanges(){this._children$.pipe((0,c.map)(e=>e.map(t=>t._dirty$)),(0,c.switchMap)(e=>e?.length?(0,u.combineLatest)(e):(0,u.of)([])),(0,c.map)(e=>e.some(t=>t)),(0,c.tap)(e=>this._childrenDirty$.next(e)),(0,c.takeUntil)(this._destroyed$)).subscribe()}_updateLoadedData(e,t,n){this._isCollectionModel&&e===Vt.Create&&this._isChild(t)&&n.primaryAttributesValues.forEach(s=>{const r=Pe.serializeRecordPrimaryAttributesValues(s);this._loadedData.add(r)})}_setMode(e){if(this._mode===e)return;if(!By[this._mode]?.includes(e))throw Error(`Unable to mark model with '${this._mode}' mode for '${e}'.`);const n=this._mode;this._mode=e,e===z.Delete&&this._selfDirty$.next(n!==z.Create)}_markForNotCollection(e){this._isCollectionModel||this.markFor(e)}_registerPrimaryAttributeValues(e){e.forEach(t=>{this._loadedData.add(Pe.serializeRecordPrimaryAttributesValues(t))})}_getDependentAttributesNames(e){return this._attributesMap.filter(t=>e.includes(t.name)).filter(t=>t.dependentAttributes.length!==0).map(t=>t.dependentAttributes).flat()}_getDefaultLoadAttributes(){return this.getSchema().pipe((0,c.map)(e=>e.getPrimaryLoadAttributes()))}_checkAttributesInDataSchema(e){return this.getSchema().pipe((0,c.tap)(t=>{const n=e.filter(s=>t.findAttributeByName(s)==null);if(n.length>0)throw new Error(`data has unknown attributes names: ${n.join(", ")}`)}))}_createDataSource(e,t,n=null){const s=n??t.dataSourceConfig;return this._dataSourceFactory.create(e,s)}_notifyEventByParameters(e,t){return this.getSchema().pipe((0,c.map)(n=>Pe.getPrimaryAttributeValuesFromParameters(n,e)),(0,c.mergeMap)(n=>this._notifyDataChange(n,t)))}_notifyDataChange(e,t){return this.getSchema().pipe((0,c.map)(n=>Pe.getModelPrimaryAttributeValues(n,e)),(0,c.tap)(n=>{eo.instance.notify({modelId:this._id,dataSchemaName:this._dataSchemaName,type:t,payload:{primaryAttributesValues:n}})}),(0,c.map)(()=>null))}_mapSaveResult(e,t,n){return this.getSchema().pipe((0,c.map)(s=>({result:e,actionType:Vt.Update,data:Pe.getPrimaryAttributeValues(s,t,n)})))}_mapInsertResult(e){return{data:e.primaryAttributes??[],result:e,actionType:Vt.Create}}_getLoadAttributes(e){if(e&&e.length!==0){let t=null;if(e.every(s=>(0,T.isString)(s)))return t=this._getDependentAttributesNames(e),(0,u.of)([...e,...t]);{const s=e.map(r=>r.name);return t=this._getDependentAttributesNames(s),this.getSchema().pipe((0,c.map)(r=>(t=t.map(o=>r.findAttributeByName(o)).map(o=>({name:o.name,path:o.path,caption:o.caption,dataValueType:o.dataValueType,aggregationConfig:o.aggregationConfig})),[...e,...t])))}}return this._getDefaultLoadAttributes()}_getChangedAttributesValues(e){return this._persistedState?Object.entries({...this._persistedState,...e}).filter(([t])=>this._dirtyAttributes.has(t)).reduce((t,[n,s])=>Object.assign(t,{[n]:s}),{}):e}_load(e,t,n,s,r=z.Update){const o={attributes:t,parameters:n,options:s,mode:r},l=(0,T.cloneDeep)(this._lastRequestPayload),d=(0,T.isEqual)((0,T.omit)(o,"options.loadType"),(0,T.omit)(l,"options.loadType"));return this._loadingRequest&&d?this._loadingRequest:(this._lastRequestPayload&&!d&&(this._newLoadingRequestArrived.next(null),this._newLoadingRequestArrived=new u.Subject),this._lastRequestPayload=o,this._loadingRequest=this._getLoadAttributes(t).pipe((0,P.pR)(()=>this._onBeforeLoad(o,l)),(0,c.switchMap)(h=>e(h,n,s)),(0,c.raceWith)(this._newLoadingRequestArrived.pipe((0,c.switchMap)(()=>(0,u.throwError)(()=>new zc)))),(0,c.tap)(()=>this._markForNotCollection(r)),(0,P.BB)(()=>this.getSchema()),(0,c.tap)(([h,f])=>{this._registerPrimaryAttributeValues(Pe.getModelPrimaryAttributeValues(f,h))}),(0,c.tap)(()=>this._persistedState={}),(0,c.map)(([h,f])=>Pe.processImageData(f,h,t)),(0,c.tap)(()=>this._isLoaded=!0),(0,P.pR)(()=>this._onAfterLoad(o,l)),(0,c.catchError)(h=>(this._isLoaded=!1,(0,u.throwError)(()=>h))),(0,c.tap)(()=>{this._dirtyAttributes.size===0&&this._markAsPristine(),this._loadingRequest=null}),(0,c.share)()),(0,u.iif)(()=>!this._doNotAllowCancelRequest,this._loadingRequest.pipe((0,c.takeUntil)(this._destroyed$)),this._loadingRequest))}_updateAttributesDependencies(){this._attributesMap.forEach(t=>t.dependentAttributes=[]),this._attributesMap.filter(t=>t.attributeType!==de.OwnAttribute).forEach(t=>{const n=t.path.split(".");if(n.length===1)return;const s=n.shift(),r=this._attributesMap.find(o=>o.path===s);r?.dependentAttributes.push(t.name)})}_buildAttributesMap(e){const t=e.attributes??[];this._attributesMap=t.map(n=>({name:n.name,path:n.path,attributeType:n.attributeType,dependentAttributes:[],isSchemaAttribute:!0})),this._updateAttributesDependencies()}_loadDependentDataForCreate(e){return this.getSchema().pipe((0,c.map)(t=>t.attributes.filter(n=>n.dataValueType===C.r.Lookup).filter(n=>n.name in e).map(n=>n.name)),(0,c.switchMap)(t=>{if(t.length===0)return(0,u.of)([]);const n=t.map(s=>this.reloadDependentData(s,e[s]));return(0,u.forkJoin)(n)}),(0,c.map)(t=>{let n={};return t.forEach(s=>{n={...n,...s[0]||{}}}),{...n,...e}}))}_getDependentAttributesInfo(e){return this.getSchema().pipe((0,c.map)(t=>e.map(n=>{const s=t.findAttributeByName(n),r=s?.path??n,o=s?.name??n,l=s?.aggregationConfig??null,d=s?.dataValueType??null,h=s?.attributeType??null,f=r.split(".");f.shift();const I=f.length===1?f[0]:o;let O;return h===de.AggregationAttribute?O=de.AggregationAttribute:O=f.length===1?de.OwnAttribute:de.ForwardReferenceAttribute,{alias:I,attributeName:o,config:{path:f.join("."),aggregationConfig:l,dataValueType:d,type:O},type:O}})))}_markAsPristine(){this._selfDirty$.next(!1)}_onBeforeLoad(e,t){return this._lifecycleHookNotificationService?.onBeforeLoad?(0,u.from)(this._lifecycleHookNotificationService.onBeforeLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})).pipe((0,c.map)(n=>{if(n===!1)throw Error('Loading is disallowed by a "OnBeforeLoad" model lifecycle event')})):(0,u.of)(void 0)}_onAfterLoad(e,t){return this._lifecycleHookNotificationService?.onAfterLoad?(0,u.from)(this._lifecycleHookNotificationService.onAfterLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})):(0,u.of)(void 0)}_onBeforeInsert(e){return this._lifecycleHookNotificationService?.onBeforeInsert?this.getSchema().pipe((0,c.map)(t=>Pe.getModelPrimaryAttributeValues(t,[e])),(0,c.map)(t=>t.pop()),(0,c.switchMap)(t=>this._lifecycleHookNotificationService.onBeforeInsert({model:this,payload:{data:e,primaryAttributesValues:t}})),(0,c.map)(t=>{if(t===!1)throw Error('Inserting is disallowed by a "OnBeforeInsert" model lifecycle event')})):(0,u.of)(void 0)}_insert(e,t){return t(e).pipe((0,c.map)(n=>this._mapInsertResult(n)),(0,c.tap)(()=>this._persistedState={}),(0,c.tap)(()=>this._markAsPristine()),(0,c.tap)(()=>this._markForNotCollection(z.Update)),(0,P.BB)(()=>this.getSchema()),(0,c.tap)(([,n])=>{this._registerPrimaryAttributeValues(Pe.getModelPrimaryAttributeValues(n,[e]))}),(0,c.map)(([n])=>n),(0,P.hk)(({data:n,actionType:s})=>this._notifyDataChange(n,s)),(0,c.map)(({result:n})=>n))}_onAfterInsert(e){return this._lifecycleHookNotificationService?.onAfterInsert?(0,u.from)(this._lifecycleHookNotificationService.onAfterInsert({model:this,payload:{data:e}})):(0,u.of)(void 0)}_onBeforeUpdate(e,t){return this._lifecycleHookNotificationService?.onBeforeUpdate?(0,u.from)(this._lifecycleHookNotificationService.onBeforeUpdate({model:this,payload:{data:e,parameters:t}})).pipe((0,c.map)(n=>{if(n===!1)throw Error('Updating is disallowed by a "OnBeforeUpdate" model lifecycle event')})):(0,u.of)(void 0)}_update(e,t,n){return n(t,e).pipe((0,c.mergeMap)(s=>this._mapSaveResult(s,e,t)),(0,P.hk)(()=>this._notifyEventByParameters(t,Vt.Update)),(0,c.map)(({result:s})=>s),(0,c.tap)(()=>this.setLoadedState()))}_onAfterUpdate(e,t){return this._lifecycleHookNotificationService?.onAfterUpdate?(0,u.from)(this._lifecycleHookNotificationService.onAfterUpdate({model:this,payload:{data:e,parameters:t}})):(0,u.of)(void 0)}_onBeforeDelete(e){return this._lifecycleHookNotificationService?.onBeforeDelete?(0,u.from)(this._lifecycleHookNotificationService.onBeforeDelete({model:this,payload:{parameters:e}})).pipe((0,c.map)(t=>{if(t===!1)throw Error('Deleting is disallowed by a "OnBeforeDelete" model lifecycle event')})):(0,u.of)(void 0)}_delete(e,t){return t(e).pipe((0,c.tap)(()=>this._markAsPristine()),(0,c.tap)(()=>this._markForNotCollection(z.Init)),(0,P.hk)(()=>this._notifyEventByParameters(e,Vt.Delete)))}_onAfterDelete(e){return this._lifecycleHookNotificationService?.onAfterDelete?(0,u.from)(this._lifecycleHookNotificationService.onAfterDelete({model:this,payload:{parameters:e}})):(0,u.of)(void 0)}innerInsert(e,t){const s=this.getSchema().pipe((0,c.map)(r=>({dataSchema:r,data:{...this._persistedState??{},...t}})),(0,c.map)(({data:r,dataSchema:o})=>Pe.getOwnColumnsValues(o,r))).pipe((0,P.pR)(r=>this._onBeforeInsert(r)),(0,P.DH)(r=>this._insert(r,e)),(0,P.pR)(([r])=>this._onAfterInsert(r)),(0,c.map)(([,r])=>r),(0,c.tap)(()=>{this._isLoaded=!0}),(0,c.catchError)(r=>(0,u.of)(Ed(r))));return(0,u.iif)(()=>!this._doNotAllowCancelRequest,s.pipe((0,c.takeUntil)(this._destroyed$)),s)}innerUpdate(e,t,n){const r=this.getSchema().pipe((0,c.map)(o=>Pe.getOwnColumnsValues(o,t)),(0,c.map)(o=>this._getChangedAttributesValues(o))).pipe((0,P.pR)(o=>this._onBeforeUpdate(o,n)),(0,P.DH)(o=>this._update(o,n,e)),(0,P.pR)(([o])=>this._onAfterUpdate(o,n)),(0,c.map)(([,o])=>o),(0,c.catchError)(o=>(0,u.of)(Ed(o))));return(0,u.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,c.takeUntil)(this._destroyed$)),r)}innerDelete(e,t){return this._onBeforeDelete(t).pipe((0,c.switchMap)(()=>this._delete(t,e)),(0,P.pR)(()=>this._onAfterDelete(t)),(0,c.catchError)(n=>(0,u.of)(Ed(n))))}innerLoad(e,t){if(this._destroyed)return(0,u.of)([]);this._isLoading=!0;const n=t?.attributes,s=t?.parameters||[],r=Pe.getDataSourceLoadOptions(t?.options),o=this._load(e,n,s,r).pipe((0,c.tap)(()=>this._isLoading=!1),(0,c.catchError)(l=>(this._isLoading=!1,(0,u.throwError)(()=>l))));return(0,u.iif)(()=>!this._doNotAllowCancelRequest,o.pipe((0,c.takeUntil)(this._destroyed$)),o)}createChildModel(){return new Os(this.injector,this.dataSource)}static create(e){return(0,u.from)(this.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},""))}init(){return this.getSchema().pipe((0,c.tap)(e=>this._dataSchemaName=e.name),(0,c.tap)(e=>this._buildAttributesMap(e)),(0,c.map)(()=>this),(0,c.tap)(()=>this._isInitialized=!this.hasCriticalErrors),(0,c.tap)(()=>{this._subscribeChildrenModeChanges(),this._subscribeChildrenDirtyChanges()}),(0,c.take)(1))}getSchema(){if(!this.dataSource)return(0,u.of)(null);if(this.hasCriticalErrors)return(0,u.of)(this.dataSource.getEmptySchema());const e=this.dataSource.getSchema();return this._measurePerformanceService?e.pipe(this._measurePerformanceService.measure$(`model.getSchema.${this.name}`)):e}getDataSource(){return this.dataSource}load(e){return this.innerLoad((t,n,s)=>this.dataSource.load(t,n,s),e)}updateDependentAttributes(e){this._attributesMap=this._attributesMap.filter(s=>s.isSchemaAttribute);const t=this._attributesMap.map(s=>s.name),n=e.filter(s=>!t.includes(s.path)).map(s=>({name:s.path,path:s.path,attributeType:s.type??de.ForwardReferenceAttribute,dependentAttributes:[],isSchemaAttribute:!1}));this._attributesMap.push(...n),this._updateAttributesDependencies()}canReloadDependentData(e){return this._getDependentAttributesNames([e]).length!==0}getDependentAttributesNames(e){return this._getDependentAttributesNames([e])}reloadDependentData(e,t){const n=this._getDependentAttributesNames([e]);if(n.length===0)return(0,u.of)([]);if(t==null)return(0,u.of)([Object.fromEntries(n.map(o=>[o,null]))]);const s=[{type:ne.PrimaryColumnValue,value:t}],r=[];return(0,u.forkJoin)([this._getDependentAttributesInfo(n),this.dataSource.getLookupDataSchema(e)]).pipe((0,c.switchMap)(([o,l])=>{const d=o.filter(f=>f.type!==de.OwnAttribute).map(f=>[f.alias,f.config]),h={type:l.dataSourceConfig.type,config:{...l.dataSourceConfig.config,attributes:Object.fromEntries(d)}};return o.forEach(f=>{r.push({ownAttributeName:f.attributeName,alias:f.alias})}),this._createDataSource(`${this.name}_reloadData`,l,h)}),(0,c.switchMap)(o=>o.load([...new Set(r.map(l=>l.alias))],s,{throttled:!0})),(0,c.map)(o=>o.map(l=>{const d={};return r.forEach(h=>{d[h.ownAttributeName]=l[h.alias]}),d})))}create(e={}){return this._isLoading=!0,this.getSchema().pipe((0,c.map)(t=>Pe.getOwnColumnsValues(t,e)),(0,c.switchMap)(t=>(0,u.forkJoin)([(0,u.of)(t),this.dataSource.getDefaultValues()])),(0,c.tap)(()=>this._markForNotCollection(z.Create)),(0,c.map)(([t,n])=>(this._persistedState={...n,...t},this._persistedState)),(0,c.switchMap)(t=>this._loadDependentDataForCreate(t)),(0,c.tap)(()=>this._isLoading=!1))}copy(e,t={}){return this._isLoading=!0,this.getSchema().pipe((0,c.map)(n=>({schema:n,attributes:n.attributes.filter(s=>s.attributeType===de.OwnAttribute&&s.isValueCloneable).map(s=>s.name),parameters:typeof e=="string"?[{type:ne.PrimaryColumnValue,value:e}]:n.getPrimaryAttributesNames().filter(s=>e[s]).map(s=>({type:ne.PrimaryColumnValue,value:{[s]:e[s]}}))})),(0,c.mergeMap)(({schema:n,attributes:s,parameters:r})=>this._load((o,l,d)=>this.dataSource.load(o,l,d),s,r,{},z.Copy).pipe((0,c.tap)(()=>{this._isLoaded=!1}),(0,c.tap)(o=>{if(o.length>1)throw new Error("More than one record loaded for copy");if(o.length===0)throw new Error("No records loaded for copy")}),(0,c.map)(o=>Pe.removeNotRequestedData(s,{...o[0]})),(0,c.map)(o=>{n.getPrimaryAttributesNames().forEach(d=>delete o[d]);const l=Pe.getOwnColumnsValues(n,t);return{...o,...l}}),(0,c.switchMap)(o=>this.dataSource.getDefaultValues().pipe((0,c.map)(l=>({...l,...o})))),(0,c.tap)(o=>{this._persistedState={...o}}),(0,c.switchMap)(o=>this._loadDependentDataForCreate(o)),(0,c.tap)(()=>{this._isLoaded=!0,this._isLoading=!1}),(0,c.catchError)(o=>(this._isLoading=!1,this._markForNotCollection(z.Update),(0,u.throwError)(()=>new Error(o)))))))}insert(e){return this.innerInsert(t=>this.dataSource.insert(t),e)}update(e,t){return this.innerUpdate((n,s)=>this.dataSource.save(n,s),e,t)}insertOrUpdate(e,t){return this._mode===z.Update?this.update(e,t):this.insert(e)}delete(e){return this.innerDelete(t=>this.dataSource.delete(t),e)}setValue(e){const t=Object.keys(e);return this._checkAttributesInDataSchema(t).pipe((0,c.tap)(()=>{t.length>0&&(this._dirtyAttributes=new Set([...this._dirtyAttributes,...t]),this._persistedState={...this._persistedState??{},...e})}),(0,c.map)(()=>null))}_getPersistedState(){return{...this._persistedState??{}}}markFor(e){this.mode!==e&&(this._setMode(e),this._modeChanges.next(e))}resetMode(){this._mode!==z.Init&&(this._mode=z.Init,this._modeChanges.next(this._mode))}loadLookupList(e,t,n={}){if(!this.dataSource)throw Error("DataSource is null");const s=this.dataSource.getLookupDataSchema(e).pipe((0,c.switchMap)(r=>{const o=r.getPrimaryLoadAttributes();return this._createDataSource(this._lookupDataSourceName,r).pipe((0,c.switchMap)(l=>l.load(o,t,n)),(0,c.map)(l=>({primaryAttributeName:r.primaryAttributeName,primaryDisplayAttributeName:r.primaryDisplayAttributeName,data:l})))}));return(0,u.iif)(()=>!this._doNotAllowCancelRequest,s.pipe((0,c.takeUntil)(this._destroyed$)),s)}canDelete(e){return(0,u.lastValueFrom)(this.dataSource.canDelete(e),{defaultValue:null})}canSave(e){switch(this._mode){case z.Init:return Promise.resolve({result:!1});case z.Create:case z.Copy:return(0,u.lastValueFrom)(this.dataSource.canCreate(e),{defaultValue:null});case z.Update:return(0,u.lastValueFrom)(this.dataSource.canEdit(e),{defaultValue:null});case z.Delete:return this.canDelete(e);default:throw Error(`Unable to verify the possibility of operation executing: the '${this._mode}' is not supported.`)}}attributeChanged(e,t){t||this._selfDirty$.next(!0),this._dirtyAttributes.add(e)}setLoadedState(e=null){if(this._isCollectionModel||!e){this._dirtyAttributes.clear(),this._markAsPristine();return}e.forEach(t=>this._dirtyAttributes.delete(t)),this._dirtyAttributes.size||this._markAsPristine()}createCollectionItemModel(e){const t=this.createChildModel();return t._isCollectionItemModel=!0,t._isLoaded=!0,t._isInitialized=!0,t._persistedState={},t._dataSchemaName=this._dataSchemaName,t._attributesMap=this._attributesMap,e!=null&&(t._setMode(e),t._selfDirty$.next(!1)),this._children.push(t),t}childrenChange(){this._children$.next(this._children)}removeChild(e){const t=e?._id,n=this._children.findIndex(s=>s?._id===t);n!==-1&&this._children.splice(n,1)}_getAsyncResult(e){return(0,u.firstValueFrom)(e)}getLastError(){return this.dataSource?this.dataSource.getLastError():new Error("DataSource is null")}destroy(){this._isInitialized=!1,this._destroyed$.next(),this._destroyed$.complete(),this._selfDirty$.complete(),this._children$.complete(),this._childrenDirty$.complete(),this._childrenModes$.complete(),this._destroyed=!0}getOwnLoadParameters(){return this.dataSource.getOwnLoadParameters()}getAllowCopyingRecords(){return this.dataSource.getAllowCopyingRecords()}}(0,p.__decorate)([It({requestType:"crt.ModelGenerator",methodName:"generateOne"}),(0,p.__metadata)("design:type",Function)],Os.prototype,"_create",void 0);class Dd extends Os{get supportsTransactions(){return this.dataSource?this.dataSource.supportTransactions:!1}createChildModel(){return new Dd(this.injector,this.dataSource)}loadInTransaction(e,t){return e.createOperation(n=>(0,u.firstValueFrom)(this.innerLoad((s,r,o)=>this.dataSource.loadInTransaction(n,s,r,o),t)))}insertInTransaction(e,t){return e.createOperation(n=>(0,u.firstValueFrom)(this.innerInsert(s=>this.dataSource.insertInTransaction(n,s),t)))}updateInTransaction(e,t,n){return e.createOperation(s=>(0,u.firstValueFrom)(this.innerUpdate((r,o)=>this.dataSource.saveInTransaction(s,r,o),t,n)))}insertOrUpdateInTransaction(e,t,n){return this.mode===z.Update?this.updateInTransaction(e,t,n):this.insertInTransaction(e,t)}deleteInTransaction(e,t){return e.createOperation(n=>(0,u.firstValueFrom)(this.innerDelete(s=>this.dataSource.deleteInTransaction(n,s),t)))}}let Dl=class au{constructor(e,t,n,s){this.dataSourceFactory=e,this.entitySchemaRepository=t,this._featureValues=n,this._injector=s}get _transactionsEnabled(){return this._featureValues["DataSource-DisableTransactions"]!==!0}_createModel(e=null,t=!1,n){const s=e.supportTransactions&&this._transactionsEnabled?new Dd(n||this._injector,e):new Os(n||this._injector,e);return s.disableSync=t,s.init()}_validateModelConfig(e){if(e.primaryDataSourceName&&!e.dataSources[e.primaryDataSourceName])throw new Error(`Data source "${e.primaryDataSourceName}" cannot be primary data source. Data source "${e.primaryDataSourceName}" not found in model config.`);if(e.primaryDataSourceName&&e.dataSources[e.primaryDataSourceName]?.scope===$t.ViewElement)throw new Error(`Data source "${e.primaryDataSourceName}" with scope "viewElement" cannot be primary. Only data sources with scope "page" can be primary`)}_getEntitySchemesRequest(e){return e.map(([,t])=>t).filter(t=>t.type==="crt.EntityDataSource").map(t=>t.config).filter(t=>!!t.entitySchemaName).map(t=>{let n=[];return t.attributes&&(n=Object.entries(t.attributes).filter(([,s])=>s.type===de.ForwardReferenceAttribute).map(([,s])=>s.path)),{name:t.entitySchemaName,loadLookupColumns:!0,forwardReferencePaths:n}})}_generateFromConfig(e,t){let n,s;const r=t?.get(Ie.g,null,{optional:!0});return r?(n=Object.entries(e?.dataSources||{}).filter(([o,l])=>l.type?!0:(console.warn(`Data source ${o} without type not supported.`),!1)),n.length===0?(0,u.of)([]):(this._validateModelConfig(e),s=n.map(([o,l])=>this.generateOne(l,o,t)),this.preInitializeDataSources(n).pipe(r.measure$("modelGenerator.generateFromConfig"),(0,u.switchMap)(()=>(0,u.forkJoin)(s))))):(n=Object.entries(e?.dataSources||{}).filter(([o,l])=>l.type?!0:(console.warn(`Data source ${o} without type not supported.`),!1)),n.length===0?(0,u.of)([]):(this._validateModelConfig(e),s=n.map(([o,l])=>this.generateOne(l,o,t)),this.preInitializeDataSources(n).pipe((0,u.switchMap)(()=>(0,u.forkJoin)(s)))))}preInitializeDataSources(e){if(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"])return(0,u.of)(null);const t=this._getEntitySchemesRequest(e);return this.entitySchemaRepository.getSchemes(t).pipe((0,c.catchError)(n=>(0,u.of)([])),(0,c.map)(n=>null))}generate(e,t){return this._generateFromConfig(e,t)}generateOne(e,t,n){const s=n?.get(Ie.g,null,{optional:!0});return s?this.dataSourceFactory.create(t,e,n).pipe(s.measure$(`modelGenerator.generateOne.${t}`),(0,c.mergeMap)(r=>this._createModel(r,e.disableSync,n))):this.dataSourceFactory.create(t,e,n).pipe((0,c.mergeMap)(r=>this._createModel(r,e.disableSync,n)))}static{this.\u0275fac=function(t){return new(t||au)(i.\u0275\u0275inject(xi),i.\u0275\u0275inject(Mn),i.\u0275\u0275inject(oe),i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:au,factory:au.\u0275fac})}};Dl=(0,p.__decorate)([(0,P.op)({requestType:"crt.ModelGenerator"}),(0,p.__metadata)("design:paramtypes",[xi,Mn,ry,i.Injector])],Dl);class so{constructor(e,t,n){this._sysSettingsService=e,this._dataSchemaRepository=t,this._featureValues=n,this._searchComparisonTypeSysSettingCode="StringColumnSearchComparisonType"}_getParameterValue(e,t,n){if(typeof t=="string"){if(t.startsWith("@requestPayload")){const s=t.replace("@requestPayload.","");return(0,T.get)(n,s)}if(t.startsWith("$"))return e.attributes[t.substring(1)];if(e.attributes[t])return e.attributes[t]}return t}_applyFilterMacros(e,t){let n=null;switch(typeof t){case"object":n=JSON.stringify((0,be.classToPlain)(t));break;case"string":n=t;break;default:return t}const s=/##ViewModelMacro\.\$([^#]+)##/g;let r=!1;return[...n.matchAll(s)].forEach(o=>{const l=o[1],d=(0,T.get)(e.attributes,l);let h=d?.toString();typeof d=="object"&&(r=!0,h=JSON.stringify(d)),n=n.replace(o[0],h)}),typeof t=="object"||r?JSON.parse(n):n}_createPrimaryDisplayColumnValueFilter(e){var t=this;return(0,S.A)(function*(){const n=t._searchComparisonTypeSysSettingCode,r=(yield t._sysSettingsService.getByCode(n))?.value===1?ee.Contain:ee.Start_with;return{type:ne.PrimaryDisplayValueFilter,value:e,comparisonType:r}})()}_createColumnValueFilter(e,t,n){const s=t;return Promise.resolve({type:ne.ColumnValue,value:{attributePath:s.attributePath,attributeValue:this._getParameterValue(e,s.attributeValue,n)}})}_getOwnLoadParameters(e,t){return e.getModelByName(t)?.getOwnLoadParameters()}_getDataSourceFilteringParameters(e,t){return(0,S.A)(function*(){const s=e._dataSourcesInfos.get(t).getFilteringConfig();return e._checkFilteringAttributes(t,s),s.length?(yield Promise.all(s.map(o=>e[o.name]))).map(o=>({type:ne.Filter,value:o})):Promise.resolve([])})()}_getDataSourceOwnFilteringParameters(e,t){return this._getOwnLoadParameters(e,t)?.parameters??[]}_getPrimaryAttributeName(e,t){var n=this;return(0,S.A)(function*(){if(!t)return null;let s=Object.values(e.dataSchemas).find(r=>r.name===t);return s||(s=yield(0,u.lastValueFrom)(n._dataSchemaRepository.get(t))),s?.primaryAttributeName})()}_getParameterRelationsConfigs(e){return e.relationsConfigs||[]}_createRelationParameter(e,t){const n={...e},s=this._getParameterRelationsConfigs(n);return n.relationsConfigs=[{dataSchemaName:t.dataSchemaName,attributePath:t.attributePath,relationPath:t.relationPath},...s],n}_validateAllowedRelations(e,t,n){const r=n?.relationPath?.split(".")?.shift(),o=e.dataSchemas[t],l=o?.findAttributeByName(r);if(o&&l&&o.primaryAttributeName!==r&&l.dataValueType!==C.r.Lookup&&!this._featureValues.DataSourceAllowRelationsByNonLookupColumn){const d="Filtration of data sources by page data is currently supported by lookup and primaryAttribute fields only",h=new Error(`${d}, please see the console for more details`);throw h.stack=`${d} , data source name: ${t}, relation config: ${JSON.stringify(n)}`,h}}_createRelationParameterWithAttributeValue(e,t,n,s){var r=this;return(0,S.A)(function*(){const o={...n},l=r._getParameterRelationsConfigs(o),d=e.dataSchemas[t],h=s.relationPath.split("."),f=h.shift(),I=d.findAttributeByName(f);if(I.dataValueType!==C.r.Lookup&&(r._featureValues.DataSourceAllowRelationsByNonLookupColumn||d.primaryAttributeName===f))return o.type=ne.ColumnValue,o.value={attributePath:s.attributePath,attributeValue:s.value},o.relationsConfigs=l,o;const O={dataSchemaName:s.dataSchemaName,attributePath:s.attributePath,relationPath:s.relationPath};o.value=s.value,o.type=ne.PrimaryColumnValue,d.primaryAttributeName!==f&&(O.dataSchemaName=I.referenceSchemaName);const B=d.type!==Ds.Entity?O.dataSchemaName:s.dataSchemaName;return O.relationPath=h.length===0?yield r._getPrimaryAttributeName(e,B):h.join("."),o.relationsConfigs=[O,...l],o})()}_convertToRelationParameters(e,t,n,s){var r=this;return(0,S.A)(function*(){const o=[];r._validateAllowedRelations(e,t,s);for(const l of n){const d=s.useAttributeValue?yield r._createRelationParameterWithAttributeValue(e,t,l,s):r._createRelationParameter(l,s);o.push(d)}return o})()}_getRelationParameters(e,t,n){var s=this;return(0,S.A)(function*(){const r=e._modelDependencies[t]||[];if(r.length===0)return Promise.resolve([]);const o=r.map(h=>s.getLoadParametersByRelation(e,h,t,n)),d=(yield Promise.all(o)).flat();return s._featureValues.DisableDsDepsJoinOptimization?d:s._selectOptimizedParametersForJoin(d)})()}_getPagingConfigRowCount(e,t,n,s){return typeof t=="string"&&(t=(0,T.isNil)(e.attributes[t])?0:e.attributes[t]),s&&(!t||t+n>s)&&(t=s-n),t}_getPagingConfigRowsOffset(e,t,n,s){const r=e._dataSourcesInfos.get(s).collectionViewModelAttributeName,o=e.attributes[r]?.length??0;if(typeof t=="number")throw new Error("Rows offset parameter cannot be set to number");return!t&&n===ve.LoadNext?o:!t&&n===ve.Reload?0:(e.attributes[t]=(0,T.isNil)(e.attributes[t])?0:e.attributes[t],n===ve.Reload?e.attributes[t]:e.attributes[t]+o)}_getModelPagingConfig(e,t,n,s){if(!t){const l=this._getOwnLoadParameters(e,s);return Promise.resolve(l?.options?.pagingConfig??null)}const r=this._getPagingConfigRowsOffset(e,t.rowsOffset,n,s),o=this._getPagingConfigRowCount(e,t.rowCount,r,t.rowsLimit);return Promise.resolve({rowCount:o,rowsOffset:r})}_mergeSorting(e,t){return(0,T.unionBy)(e??[],t??[],"columnName")??null}_getModelSortingConfig(e,t,n){var s=this;return(0,S.A)(function*(){const o=s._getOwnLoadParameters(e,n)?.options?.sortingConfig,l=t?.attributeName;if(!l||!e.attributes[l])return o?Promise.resolve(o):Promise.resolve(null);const d=yield Promise.all(e.attributes[l].map(function(){var h=(0,S.A)(function*(f){return{columnName:yield f.columnName,direction:yield f.direction}});return function(f){return h.apply(this,arguments)}}()));return{columns:s._mergeSorting(d,o?.columns)}})()}_getHierarchyFilterAttributeValues(e,t){return(0,S.A)(function*(){if(!t?.length)return Promise.resolve(null);let n;for(const s of t){const r=yield e[s.name];if(!r)continue;const o=typeof r=="string"?Ve.fromJson(JSON.parse(r),Kr):"filters"in r?r:Ve.fromJson(r,Kr);o&&(n?o.filters.forEach(l=>{n.add(l)}):n=o)}return n?.filters?.size>0?n:null})()}_getHierarchyColumnValue(e,t){return(0,S.A)(function*(){if(!t)return Promise.resolve(null);const n=yield e[t];return(typeof n=="string"?n:n?.value)??null})()}_getModelHierarchyConfig(e,t,n,s){var r=this;return(0,S.A)(function*(){const o={},d=r._getOwnLoadParameters(e,n)?.options?.hierarchyConfig;if(!d||!d.hierarchicalFullDataLoad)return Promise.resolve(null);const h=yield r._getHierarchyFilterAttributeValues(s,t?.hierarchicalFilterAttributes),f=yield r._getHierarchyColumnValue(s,t?.hierarchicalColumnValueAttributeName);return o.hierarchicalFullDataLoad=d.hierarchicalFullDataLoad,o.hierarchicalColumnName=d.hierarchicalColumnName,o.hierarchicalMaxDepth=d.hierarchicalMaxDepth,o.hierarchicalColumnValue=f??null,o.hierarchicalColumnFiltersValue=h??null,Promise.resolve(o)})()}_updateLastEventLoadParameters(e,t,n,s){n&&n.length!==0?e._lastEventLoadParameters.set(t,n):s!==!0&&e._lastEventLoadParameters.set(t,[{type:ne.Empty,value:""}])}_getModelLoadParameters(e,t,n,s,r,o,l){var d=this;return(0,S.A)(function*(){const h=yield d.getModelParameters(e,n,s);o!==!0&&d._updateLastEventLoadParameters(e,t,h,r);const f=r!==!0?h:e._lastEventLoadParameters.get(t)||[{type:ne.Never,value:""}],[I,O,B]=yield Promise.all([d._getDataSourceFilteringParameters(e,t),d._getDataSourceOwnFilteringParameters(e,t),d._getRelationParameters(e,t,l)]);return[...f,...O,...I,...B]})()}_selectOptimizedParametersForJoin(e){if(e.every(({type:o})=>o===ne.Empty))return e;const n=e.filter(({type:o,value:l})=>o!==ne.Empty&&(o!==ne.Filter||!!l)),s=e.filter(({type:o,relationsConfigs:l})=>o===ne.Empty&&l?.length);if(!s.length)return n;const[r]=[...s].sort((o,l)=>l.relationsConfigs.length-o.relationsConfigs.length);return[...n,r]}getLoadParametersByRelation(e,t,n,s){var r=this;return(0,S.A)(function*(){const o=t.relationPath.split("."),l=o.shift(),d=e.dataSchemas[l],h={dataSchemaName:d.name,attributePath:t.attributePath,relationPath:o.join(".")},f=o.shift(),O=e._dataSourcesInfos.get(l).getMappedAttributeNames(f)?.[0]??null,B=e.getModelMode(l),J=s?.[l]?.[h.relationPath];if(e.getModelByName(n)?.getAllowCopyingRecords()&&J)h.value=J,h.useAttributeValue=!0;else{const tp=e.getIsDirty(O)||B===z.Create||B===z.Copy||d.type!==Ds.Entity;if(O&&tp){h.useAttributeValue=!0;const Ye=e.attributes[O];if(h.value=Ye?.value?Ye.value:Ye,h.value)return r._validateAllowedRelations(e,l,h),Promise.resolve([{type:ne.ColumnValue,value:{attributePath:h.attributePath,attributeValue:h.value},relationsConfigs:[]}])}}const Tc=yield r._getModelLoadParameters(e,l,null,null,!0,!1);return r._convertToRelationParameters(e,l,Tc,h)})()}getModelParameters(e,t,n){if(n?.parameters&&(t=[...t,...n.parameters]),!t||t.length===0)return Promise.resolve([]);const s=t.map(r=>{switch(r.type){case ne.PrimaryColumnValue:return Promise.resolve({type:r.type,value:this._getParameterValue(e,r.value,n)});case ne.Filter:return Promise.resolve({type:r.type,value:this._applyFilterMacros(e,r.value)});case ne.PrimaryDisplayValueFilter:return this._createPrimaryDisplayColumnValueFilter(this._getParameterValue(e,r.value,n));case ne.ColumnValue:return this._createColumnValueFilter(e,r.value,n)}});return Promise.all(s)}getModelLoadParameters(e,t,n,s=ve.Load,{payload:r,useLastLoadParameters:o,doNotUpdateLastLoadParameters:l,modelLoadConfiguration:d}={}){const h=t.name,f=s??ve.Load,I=f===ve.Load?null:t.getPagingConfig(),O=t.getSortingConfig(),B=t.getHierarchyConfig();return Promise.all([this._getModelLoadParameters(e,h,n,r,o,l,d),this._getModelPagingConfig(e,I,f,h),this._getModelSortingConfig(e,O,h),this._getModelHierarchyConfig(e,B,h,e)])}static{this.\u0275fac=function(t){return new(t||so)(i.\u0275\u0275inject(kt),i.\u0275\u0275inject(Qn),i.\u0275\u0275inject(oe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:so,factory:so.\u0275fac,providedIn:"root"})}}class In{get attributesMap(){return this._attributesMap}get mappedViewModelAttributes(){return this._mappedViewModelAttributes}get isCollection(){return this._isCollection}get collectionViewModelAttributeName(){return this._collectionViewModelAttributeName}constructor(e){this._attributesMap=new Map,this._mappedViewModelAttributes=new Set,this.attributes=[],this.includePrimaryAttributes=!0,this.name=e}static _getDataSourceInfo(e,t){if(!e.has(t)){const n=new In(t);return e.set(t,n),n}return e.get(t)}static _extractViewModelAttributeMapInfo(e){const t=e.split(".");return{dataSourceName:t.shift(),dataSourceAttributePath:t.join(".")}}static _getByDefaultAttribute(e,t,n,s=""){const r=t.modelConfig;if(!r||!r.path)return;const o=this._extractViewModelAttributeMapInfo(r.path);if(!o.dataSourceAttributePath){this._getByViewModelCollectionAttribute(e,t,n);return}if(s&&s!==o.dataSourceName)throw new Error(`Attribute '${e}' mapped on a few DataSources`);const l=this._getDataSourceInfo(n,o.dataSourceName),d=r.aggregationConfig?.aggregationFunction?wm(o.dataSourceAttributePath):o.dataSourceAttributePath;l.attributes.push({path:d,type:r.type,functionConfig:r.functionConfig,aggregationConfig:r.aggregationConfig}),l._mappedViewModelAttributes.add(e),l._attributesMap.set(e,o.dataSourceAttributePath)}static _getByInlineViewModelAttribute(e,t,n,s=""){const r=t.viewModelConfig||{};Object.entries(r.attributes||{}).forEach(([o,l])=>{const d=`${e}.${o}`;this._processViewModelAttribute(d,l,n,s)})}static _getByViewModelCollectionAttribute(e,t,n){const s=t.modelConfig;if(!s||!s.path)return;const o=this._extractViewModelAttributeMapInfo(s.path).dataSourceName,l=this._getDataSourceInfo(n,o);l._isCollection=!0,l._collectionViewModelAttributeName=e,l._pagingConfig=s.pagingConfig,l._sortingConfig=s.sortingConfig,l._hierarchyConfig=s.hierarchyConfig,l._filteringConfig=s.filterAttributes,l.includePrimaryAttributes=s.includePrimaryAttributes===void 0?!0:s.includePrimaryAttributes;const d=t?.viewModelConfig;Object.entries(d?.attributes||{}).forEach(([h,f])=>{this._processViewModelAttribute(`${e}.${h}`,f,n,o)})}static _processViewModelAttribute(e,t,n,s=""){"viewModelConfig"in t||"viewModelName"in t?t.isCollection?this._getByViewModelCollectionAttribute(e,t,n):this._getByInlineViewModelAttribute(e,t,n,s):"from"in t||this._getByDefaultAttribute(e,t,n,s)}static getFromViewModelConfig(e,t=[]){const n=new Map;return Object.entries(e?.attributes||{}).forEach(([s,r])=>{this._processViewModelAttribute(s,r,n)}),t.filter(s=>!n.has(s.name)).forEach(({name:s})=>{const r=new In(s);n.set(s,r)}),n}static getLookupListDataSourceInfo(e,t){const n=new In("");return n._isCollection=!0,n._collectionViewModelAttributeName=e,Object.entries(t).forEach(([s,r])=>{n.attributes.push({path:r}),n._mappedViewModelAttributes.add(s),n._attributesMap.set(s,r)}),n}_getRowModelDto(e){const t=e.length>0?e[0]:{},n={};return Object.entries(t).forEach(([s,r])=>{this.getMappedAttributeNames(s).forEach(l=>{const d=l.split(".");this.isCollection&&d.length>1&&d.shift(),(0,T.set)(n,d.join("."),r)})}),n}_getCollectionModelDto(e){const t=this._collectionViewModelAttributeName,n=e.map(s=>this._getRowModelDto([s]));return{[t]:n}}getMappedAttributes(){return Array.from(this._mappedViewModelAttributes.values())}getMappedAttributeNames(e){return Array.from(this._attributesMap.entries()).filter(([,t])=>t===e).map(([t])=>t)}getDataSourceAttributePath(e){return this._attributesMap.has(e)?this._attributesMap.get(e):""}getIsMapOnCollection(e){return this._isCollection&&this._collectionViewModelAttributeName===e}getPagingConfig(){return this._pagingConfig}getSortingConfig(){return this._sortingConfig}getHierarchyConfig(){return this._hierarchyConfig}getFilteringConfig(){return this._filteringConfig||[]}getModelDto(e){return this._isCollection?this._getCollectionModelDto(e):this._getRowModelDto(e)}addNewAttribute(e,t,n){const s=new Map;s.set(this.name,this),In._getByDefaultAttribute(e,t,s,n)}getIsDataSourceAttributePathExists(e){return this.attributes.find(t=>t.path===e)!==void 0}}class Uy{}var wi;(function(a){a.None="None",a.OneToMany="OneToMany",a.ManyToOne="ManyToOne",a.ManyToMany="ManyToMany",a.CircularDependency="CircularDependency"})(wi||(wi={}));function _v(a,e){return!!a?.some(t=>t.relationPath.split(".").shift()===e)}function Zm(a){return a.dataValueType===C.r.Guid}function Wm(a,e){return Zm(e)&&a.primaryAttributeName===e.name}function Hy(a,e,t,n){const s=t.findAttributeByName(n),r=a.findAttributeByName(e);return(r.isLookup||Zm(r))&&Wm(t,s)?wi.OneToMany:Wm(a,r)&&s.isLookup?wi.ManyToOne:wi.ManyToMany}function Ad(a){const e=a.split("."),t=e.shift(),n=e.shift();return{dependOnModelName:t,dependOnAttributeName:n}}function $m(a){Object.values(a.controls||{}).forEach(e=>{e instanceof Z.FormGroup||e instanceof Z.FormArray?$m(e):e.updateValueAndValidity({onlySelf:!0})})}function yv(a){a?.markAsPristine(),a?.markAsUntouched(),a?.updateValueAndValidity()}function Cv(a){return Object.values(a?.errors||{}).map(e=>e?.message).filter(Boolean)}function Gm(a){return a.statusChanges.pipe((0,c.startWith)(a.status),(0,c.first)(()=>a.status.toLowerCase()!=="pending"),(0,c.map)(()=>{}))}const Yy=500;class bn{static{this._skippedProperties=["schedule","then"]}constructor(e,t,n,s,r,o,l,d){this.viewModelGenerator=e,this.injector=t,this.viewModelConfig=n,this.resources=s,this._eventScopes=o,this._modelsInitConfig=l,this._defaultPrimaryAttributeName="Id",this._models$=new u.BehaviorSubject([]),this._businessRulesActive=!0,this._dropdownPageSizeSettingsCode="DropdownPageSize",this._dataSourcesInfos=new Map,this._attributesToDataSourceNameMap=new Map,this._dropdownPageSize=null,this._replayEvents$=new u.ReplaySubject,this._loadedDataSources=new Set,this._conflictedModels=[],this.__destroyed=!1,this._disableViewModelWaitingForAsyncTasks=!1,this._disableViewModelLoadUnblockingThread=!1,this._blockFieldsAffectedByBusinessRules=!1,this._asyncTasksExecutingSubject=new u.BehaviorSubject(new Set),this._modelsRequestedToLoad=new Set,this._attributesAffectedByBusinessRules=[],this._businessRulesAreActivated=!1,this._destroySubject=new u.Subject,this._modelSourceRecordId={},this._modelLoadParametersSetted$=new u.Subject,this._modelsNamesWithParameters=new Set,this.saveModelTaskName="MODEL_SAVING",this._modelLoaded$=new u.Subject,this._viewModelAttributeChangeEventOptions=new L_({preventAttributeChangeRequest:!1,preventStateChange:!0,preventRunBusinessRules:!0}),this._dynamicModelNames=new Set,this._attributeConfigs={},this._eventsSubject$=new u.Subject,this._collectionSubscription=new Map,this._crtControls=new Map,this._subscriptions=new u.Subscription,this._destroy$=this._destroySubject.asObservable(),this._businessRulesActivated$=new u.BehaviorSubject(!1),this.attributes={},this.dataSchemas={},this.events$=(0,u.merge)(this._eventsSubject$,this._replayEvents$),this._systemAttributes=[],this.initDependencies(),this._subscribeModelsChanges(),this.handlerChain=Ae.instance,r?this.formApiModel=r:this.formApiModel=this.formBuilder.group({}),this.parent=d;const h=this._appInfo?.isDebugEnabled?this._createProxy(this):this;return this._viewModelDataDelayerService&&!this.parent&&this._viewModelDataDelayerService.setViewModel(h),h}get models(){return this._models$.value}get IsChanged(){return Promise.resolve(this.attributes[Vr])}set IsChanged(e){}get HasUnsavedData(){return Promise.resolve(this.attributes[vl])}set HasUnsavedData(e){}set BusinessRulesActivated(e){}get BusinessRulesActivated(){return Promise.resolve(this._businessRulesAreActivated)}get _isChanged(){return console.warn("Warning: The `_isChanged` property of the view-model is deprecated. It will be removed in future versions. Use `IsChanged` or `HasUnsavedData` attribute instead."),Object.keys(this._attributeConfigs).filter(e=>!(0,T.isEmpty)(this._attributeConfigs[e].modelConfig)).some(e=>this.formApiModel.controls[e]?.dirty)}get _scopes(){return[...this._eventScopes??[]]}get _injectionContext(){return this._context}get[yn](){return this.injector}get primaryAttributeName(){if(!this._primaryModelName)return this._defaultPrimaryAttributeName in this._attributeConfigs?this._defaultPrimaryAttributeName:null;const t=this.dataSchemas[this._primaryModelName].primaryAttributeName,n=this._dataSourcesInfos.get(this._primaryModelName);return this._getMappedAttributeName(n,t)}get PrimaryModelMode(){return this.getPrimaryModelMode()}get State(){return Or(this).attributes[Tl]}get _destroyed(){return this.__destroyed}get modelInitConfigs(){return this._modelsInitConfig}_createProxy(e){return new Proxy(e,{get(t,n){return!(typeof n=="string")||n in t||bn._skippedProperties.includes(n)||console.debug(`Attribute ${n} not found.`),t[n]}})}_executeWithOptions(e,t){let n;try{return n=this._viewModelAttributeChangeEventOptions.getOptions(),this._viewModelAttributeChangeEventOptions.setOptions(t),e()}finally{this._viewModelAttributeChangeEventOptions.setOptions(n)}}_setSystemAttributeValue(e,t){const n=this.attributes[e];this.attributes[e]=t,this._executeWithOptions(()=>{this._fireChangeAttributeEvent({type:Ne.ChangeAttributeValue,payload:{attributeName:e,oldValue:n,value:t}})},{preventStateChange:!0,preventRunBusinessRules:!0})}_fireChangeAttributeEvent(e){e.payload.silent??=this._viewModelAttributeChangeEventOptions.getAsSilent(),Object.assign(e.payload,this._viewModelAttributeChangeEventOptions.getOptions()),this._eventsSubject$.next(e)}_getViewModelValidators(e){const t=this.viewModelConfig.attributes[e]??{};return("validators"in t&&t.validators)??{}}_initDataSourceValidators(){return this._measurePerformanceService?.measure(`ViewModel.initDataSourceValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._validators={},this._dataSourcesInfos.forEach(e=>{e.attributesMap.forEach((t,n)=>{const s=this.viewModelConfig.attributes[n]??{};if("modelConfig"in s&&s.modelConfig?.ignoreValidators)return;this._validators[n]=this._validators[n]||[];const r=this._getDataSourceAttributeSchema(e,t);if(r?.validators){for(const[o,l]of Object.entries(r.validators))if(l?.type){const d=this._injectionContext??Or(this)?._injectionContext,h=this.validatorTypeResolver.getValidator(l.type,{validationParameters:l?.params,injectionContext:d}),f=this._getViewModelValidators(n),I=Object.values(f).find(O=>O.type===l.type);this._validators[n].push({name:o,instance:h,disabled:!!I?.disabled,params:l?.params})}}})}),(0,u.of)(null)))}_initSchemaValidators(e){this._measurePerformanceService.measure(`ViewModel.initSchemaValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{Object.entries(e||{}).forEach(([t])=>{const n=this._getViewModelValidators(t);this._validators[t]=this._validators[t]||[];for(const[s,r]of Object.entries(n))if(r?.type){const o=this._injectionContext??Or(this)?._injectionContext,l=this.validatorTypeResolver.getValidator(r.type,{validationParameters:r.params,injectionContext:o});this._validators[t].push({name:s,instance:l,disabled:r.disabled,params:r?.params})}})})}_waitAsyncValidation(){return(0,u.from)(this.waitAsyncTasksFinish()).pipe((0,c.switchMap)(()=>this.formApiModel.statusChanges.pipe((0,c.startWith)(this.formApiModel.status),(0,c.filter)(e=>e.toLowerCase()!=="pending"),(0,c.first)(),(0,c.map)(()=>null))))}_getResourcesStrings(){const e=this.resources?.strings??{};return{...e,...this._getResourceStringsByAttributes(e)}}_getChangedResourcesStrings(e){const t=Object.entries(e).reduce((s,[r,o])=>{const l=this.resources?.strings[r]||{},d=o&&{...l,...o};return{...s,[r]:d}},{}),n={...this.resources?.strings,...t};return JSON.parse(JSON.stringify(n))}_generateResourceAttribute(){this[gr]={},this[gr][ps.string]={};const e=this._getResourcesStrings();return this._attributeResourceGenerator.generate(this,e)}_getBoundAttributeNames(){const e=new Set;return this._dataSourcesInfos.forEach(t=>{for(const n of t.mappedViewModelAttributes)e.add(n)}),Array.from(e.values())}_getDataSourceInfoByViewModelAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e);return this._dataSourcesInfos.has(t)?this._dataSourcesInfos.get(t):null}_getResourceStringsByAttributes(e){const t=Object.keys(e);return this._getBoundAttributeNames().filter(s=>!t.includes(s)).reduce((s,r)=>(s[r]={},s),{})}_getDataSourceAttributeSchema(e,t){return this.dataSchemas[e.name]?.attributes?.find(n=>n.name===t)}_generatePrimaryAttributes(){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{const e=Array.from(this._dataSourcesInfos.values()).map(t=>{const n=t.name,s=this.dataSchemas[n],o=(t.includePrimaryAttributes?[s?.primaryAttributeName,s?.primaryDisplayAttributeName]:[]).filter(l=>l&&!t.getIsDataSourceAttributePathExists(l)).map(l=>{const d=(0,A.qv)(),h=`${n}_${l}_${d}`,f=s.findAttributeByName(l),I={modelConfig:{path:`${n}.${l}`},dataValueTypeName:C.r[f.dataValueType]};return this._attributeConfigs[h]=I,t.addNewAttribute(h,I),this._attributeGenerate({[h]:I})});return o.length===0?(0,u.of)(null):(0,u.forkJoin)(o)});return e.length===0?(0,u.of)(null):(0,u.forkJoin)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.forkJoin.${this._injectionContext?.id}.parent.${!!this.parent}`))})}_getDataSourceDto(e){const t={},n=this._dataSourcesInfos.get(e);return n.attributesMap.forEach((s,r)=>{if(!n.getIsMapOnCollection(r)){const o=this.attributes[r],l=this._getDataSourceAttributeSchema(n,s);!o&&l?.dataValueType===C.r.Lookup?t[s]=null:t[s]=o}}),(0,u.of)(t)}_checkFilteringAttributes(e,t){if(t.some(s=>(0,T.isNil)(s.name)))throw new Error(`Filtering attributes for ${e} are not valid!`)}_attributeGenerate(e,t){return this._attributeGenerator.generate(this,e,{...t,onChangeAttributeValue:(n,s,r)=>{this._fireChangeAttributeEvent({type:Ne.ChangeAttributeValue,payload:{attributeName:n,value:s,oldValue:r,silent:this._viewModelAttributeChangeEventOptions.getAsSilent()}})}})}_getDataSourceNamesAffectedByFilteringAttribute(e,t){return[...this._dataSourcesInfos.entries()].filter(([,n])=>n.isCollection).filter(([n])=>{const s=this.getModelByName(n);return t.has(s?.name)||s?.isLoaded||s?.isLoading}).filter(([n,s])=>this._getIsAnyFilterAttributesChanged(s,e,n)?!0:this._getIsAnyHierarchyFilterAttributesChanged(s,e,n)).map(([n])=>n)}_getIsAnyFilterAttributesChanged(e,t,n){const s=e.getFilteringConfig(),r=s.some(o=>o?.name===t&&o?.loadOnChange);return r&&this._checkFilteringAttributes(n,s),r}_getIsAnyHierarchyFilterAttributesChanged(e,t,n){const s=e.getHierarchyConfig();if(!s?.hierarchicalFilterAttributes&&!s?.hierarchicalColumnValueAttributeName)return!1;if(t===s?.hierarchicalColumnValueAttributeName)return!0;const r=s.hierarchicalFilterAttributes;if(r?.some(l=>l?.name===t&&l?.loadOnChange))return this._checkFilteringAttributes(n,r),!0}_createRequestsForReloadingDataSources(e){return e.map(t=>({type:"crt.LoadDataRequest",$context:this,dataSourceName:t,config:{loadType:ve.Reload}}))}_dispatchStartLoadModelAttributes(e){const t=`${$n.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.addTask(t,{targetTask:!0}),this._replayEvents$.next({type:Ne.StartLoadModelAttributes,payload:e})}_dispatchFinishLoadModelAttributes(e){const t=`${$n.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.removeTask(t,{targetTask:!0}),this._replayEvents$.next({type:Ne.FinishLoadModelAttributes,payload:e})}_processEmptyLoadDataForCollection(e,t){var n=this;return(0,S.A)(function*(){if(!e.isCollection||!e.collectionViewModelAttributeName)return;const s=t.find(d=>d.type===ne.PrimaryColumnValue);if(!s)return;const r=s.value?.value,o=n.attributes[e.collectionViewModelAttributeName];if(!r||!o)return;const l=yield o.findByPrimaryAttribute(r);l&&o.remove(l)})()}_loadDynamicModel(e){const t=e.attributeName,n=e.dataSourceConfig,s=e.dataSourceName||Pr.createDynamicDataSourceNameFromAttributeName(this,t),r=Pr.createAttributeConfig(this,s,e),o=this._createAndSetDataSourceInfo(s,t,r);return this._defineOrUpdateAttribute(t,r),this._setupSortingAttribute(e.sortingConfig),this._setupFiltersAttributes(e.filtersConfig),this._modelGenerator.generateOne(n,s).pipe((0,c.tap)(l=>this._markModelAsCollection(l,o)),(0,c.tap)(l=>this._dynamicModelNames.add(l.name)),(0,c.tap)(l=>this._upsertModel(s,l)),(0,c.tap)(l=>this._addModelDependencies(l,e.dependencies)),(0,c.switchMap)(l=>(0,u.forkJoin)([(0,u.of)(l),this._addDataSchemaToDataSchemas(l)])),(0,c.switchMap)(([l])=>(0,u.forkJoin)([(0,u.of)(l),(0,u.of)(this._replaceAttributesToDataSourceNameMap(o))])),(0,c.switchMap)(([l])=>(0,u.forkJoin)([(0,u.of)(l),this._reGenerateResourcesAttributes()])),(0,c.switchMap)(([l])=>this._loadModelData({model:l,dataSourceInfo:o,parametersConfig:[],loadType:ve.Reload,useLastLoadParameters:e.useLastLoadParameters}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${e.dataSourceName}`))))}_defineOrUpdateAttribute(e,t){this.attributes[e]?this._attributeConfigs[e]=t:this._attributeGenerate({[e]:t})}_createAndSetDataSourceInfo(e,t,n){const r=In.getFromViewModelConfig({attributes:{[t]:n}}).get(e);return this._dataSourcesInfos.set(e,r),r}_setupSortingAttribute(e){if(!e?.default)return;const t=e.attributeName;this.attributes[t]=e.default}_setupFiltersAttributes(e){e?.forEach(t=>{if(!t.value)return;const n=t.name,s=t.value;this[n]=s.value||s})}_addModelDependencies(e,t){this._modelDependencies[e.name]=t||[]}_addDataSchemaToDataSchemas(e){return e.getSchema().pipe((0,c.tap)(t=>this.dataSchemas[e.name]=t))}_reGenerateResourcesAttributes(){return(0,u.forkJoin)([...this._generateResourceAttribute(),(0,u.of)(null)])}_replaceAttributesToDataSourceNameMap(e){const t=this._getDataSourceAttributesMap(e),n=[...Array.from(this._attributesToDataSourceNameMap.entries()),...t];this._initializeAttributesToDataSourceNameMap(n)}_getMappedAttributeName(e,t){if(!e)return"";const n=e.getMappedAttributeNames(t);return!n||n.length===0?"":n[0]}_getMappedAttributeNames(e,t){return e?e.getMappedAttributeNames(t):[]}_getModelAttributesToLoad(e,t){const n=this._dataSourcesInfos.get(e.name);if(t?.attributes){const s=t.attributes.filter(r=>{const o=this._getMappedAttributeName(n,r);return!this.getIsDirty(o)});return this._getModelDependentAttributes(e,s)}return n?.attributes.map(s=>s.path)}_loadStaticModel(e,t,n,s,r,o){const l=this.getModelByName(e),d=this._dataSourcesInfos.get(l.name);return this._loadModelData({model:l,dataSourceInfo:d,parametersConfig:t,loadType:n,payload:s,useLastLoadParameters:r,doNotUpdateLastLoadParameters:o})}_waitDataDelay(e){return this._viewModelDataDelayerService?.shouldBeDelayed()?(0,u.of)(e).pipe((0,c.delayWhen)(()=>this._viewModelDataDelayerService.loadTrigger$)):(0,u.of)(e)}_updateTrackedAttributes(e){const t=this._modelDependencies[e.name];if(!t||!e.isAggregate)return;const n=/^.{0,2}\[\w+:\w+(:\w+)?]/;t.forEach(s=>{const r=s.relationPath.split(".")[0],o=this.getModelByName(r),l=e.affectedAttributes.filter(h=>h.schemaName===o.dataSchemaName).map(h=>h.path.split(".")[0]).filter(h=>!n.test(h)),d=new Set([...s.trackByAttributes??[],...l]);s.trackByAttributes=[...d.values()]})}_waitForModelLoad(e){var t=this;return(0,S.A)(function*(){const n=t.getModelByName(e);!n||n?.isLoaded||n.mode===z.Create||n.mode===z.Copy||(yield(0,u.firstValueFrom)(t._modelLoaded$.pipe((0,c.filter)(s=>s===e),(0,c.take)(1))))})()}_waitForModelsLoad(e){var t=this;return(0,S.A)(function*(){if(e.length===0||t._isDesignTime)return;const n=e.map(s=>t._waitForModelLoad(s));yield Promise.all(n)})()}_waitForModelsLoadParameters(e,t){var n=this;return(0,S.A)(function*(){if(e.length===0||n._isDesignTime||!t||t.mode===z.Create||t.mode===z.Copy)return;const s=e.map(r=>n._waitForModelLoadParameters(r));yield Promise.all(s)})()}_waitForModelLoadParameters(e){var t=this;return(0,S.A)(function*(){t._lastEventLoadParameters.has(e)||t._modelsNamesWithParameters.has(e)||(yield(0,u.firstValueFrom)(t._modelLoadParametersSetted$.pipe((0,c.filter)(()=>t._modelsNamesWithParameters.has(e)),(0,c.take)(1))))})()}_getAffectedAttributes(e,t,n){const r=this.dataSchemas[e].primaryAttributeName,o=[...t];return r&&!t.includes(r)&&n?.length>0&&n?.[0][r]&&o.push(r),o}_getModelLoadParameters(e,t,n,s,r,o){return this._modelParametersBuilder.getModelLoadParameters(this,e,t,n,{payload:s,useLastLoadParameters:r,doNotUpdateLastLoadParameters:o}).catch(l=>(console.error(l),this._showNotification({message:l.message}),[[{type:ne.Never}],{},{},{}]))}_getRelationTypeForRootModel(e){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return null;const t=this._modelDependencies[e],n=Ii(this.getModelByName(e));if(t?.length!==1||!this._primaryModelName||!n)return null;const s=this.dataSchemas[this._primaryModelName],r=t[0],{dependOnModelName:o,dependOnAttributeName:l}=Ad(r.relationPath);return o!==this._primaryModelName?null:Hy(this.dataSchemas[e],r.attributePath,s,l)}_isManyToOneRootModelRelation(e){return this._getRelationTypeForRootModel(e)===wi.ManyToOne}_isOneToManyRootModelRelation(e){return this._getRelationTypeForRootModel(e)===wi.OneToMany}_getOneToManyRelationDefaultValues(e){const t=this._modelDependencies[e]?.[0];if(!t)return{};const n=this.dataSchemas[this._primaryModelName],s=this.getViewModelAttributePaths(this._primaryModelName,n.primaryAttributeName)?.[0],r=this.getViewModelAttributePaths(this._primaryModelName,n.primaryDisplayAttributeName)?.[0];return{[t.attributePath]:{value:this.attributes[s],displayValue:this.attributes[r]}}}_getDependOnModelLoadConfiguration(e){const t=this._getDependOnModelsNames(e),n={};return t.forEach(s=>{this._modelSourceRecordId[s]&&(n[s]={[this.dataSchemas[s].primaryAttributeName??"Id"]:this._modelSourceRecordId[s]})}),n}_isPrimaryModel(e){return this._primaryModelName===e}_isIndependentRootModel(e){return Ii(e)?this._getDependOnModelsNames(e.name).length===0:!1}_checkAndProcessPageDataSourceData(e,t){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return(0,u.of)(t);if(this._isManyToOneRootModelRelation(e.name)&&t.length===0)return this._clearModelValues(e.name),e.setLoadedState(),(0,u.of)(t);const s=this._isOneToManyRootModelRelation(e.name),r=this._isIndependentRootModel(e);if(!(s&&t.length===0||r&&t.length===0&&!this._isPrimaryModel(e.name)))return(0,u.of)(t);e.resetMode();const l=this._getOneToManyRelationDefaultValues(e.name);if(this.PrimaryModelMode===z.Copy){const d=this.dataSchemas[e.name].primaryAttributeName??"Id",h=this._getDependOnModelLoadConfiguration(e.name);return(0,u.from)(this.getDataSourceLoadParameters(e.name,h)).pipe((0,c.switchMap)(({parameters:f,options:I})=>e.load({attributes:[d],parameters:f,options:{loadType:ve.Reload,pagingConfig:I.pagingConfig,sortingConfig:I.sortingConfig,hierarchyConfig:I.hierarchyConfig}})),(0,c.switchMap)(f=>{e.resetMode();const I=f?.length?f[0][d]:null;return I?this.copy(e.name,I,l):this.create(e.name,l)}),(0,c.map)(()=>t))}return this.create(e.name,l).pipe((0,c.map)(()=>t))}_isRowsLimitReached(e){var t=this;return(0,S.A)(function*(){const n=e.collectionViewModelAttributeName,s=e.getPagingConfig()?.rowsLimit;return!s||!n?!1:(yield t[n])?.length>=s})()}_setDataSourceLoaded(e,t,n,s){var r=this;return(0,S.A)(function*(){n.length<s?.rowCount||(yield r._isRowsLimitReached(t))?r._loadedDataSources.add(e):r._loadedDataSources.delete(e)})()}_getModelDependedOnEntityDataSource(e){return e.filter(t=>this.models.find(r=>r.name===t).getDataSource().type===gl.EntityDataSource)}_loadModelData({model:e,dataSourceInfo:t,parametersConfig:n,loadType:s,payload:r,useLastLoadParameters:o,doNotUpdateLastLoadParameters:l}){const d=e.name;this._modelsRequestedToLoad.add(d);const h=this._getModelAttributesToLoad(e,r),f=r?.attributes;if(!t)return(0,u.of)([]);if(f&&h.length===0)return(0,u.of)([]);if(this._conflictedModels.includes(d))return(0,u.of)([]);const I=this._getDataSourceMappingAttributes(t,h),O=this._getLoadTypeForDataSource(t,s);if(O===ve.LoadNext&&this._loadedDataSources.has(d))return(0,u.of)([]);this._dispatchStartLoadModelAttributes(I);const B=!this._isSyncForModelAllowed(e)||f===null||e.mode===z.Init,J=this._getDependOnModelsNames(d);this._checkAndLoadUnloadedDependOnModels(J);const te=this._getModelDependedOnEntityDataSource(J),Tc=J.filter(Ye=>!te.includes(Ye)),tp=Promise.all([this._waitForModelsLoad(Tc),this._waitForModelsLoadParameters(te,e)]);return(0,u.from)(this._featureValues.DisableSequentialLoadDependentDS?this._waitForModelsLoad(J):tp).pipe((0,c.switchMap)(Ye=>(0,u.from)(this._getModelLoadParameters(t,n,O,r,o,l)).pipe((0,c.tap)(()=>{!this._featureValues.DisableSequentialLoadDependentDS&&!t.isCollection&&(this._modelDependencies[d]?.map(xc=>xc.relationPath)||[]).forEach(xc=>{const{dependOnModelName:Ze,dependOnAttributeName:Wa}=Ad(xc),[np]=this.getViewModelAttributePaths(Ze,Wa);this.getAttributeControl(np).markAsPristine()})}),(0,c.tap)(()=>{if(!this._featureValues.DisableSequentialLoadDependentDS){this._setModalLoadParameters(d);const dn=this._getAffectedAttributes(d,h,[]);this._reloadDependentModels(e,dn,$t.Page)}}))),(0,c.mergeMap)(Ye=>this._waitDataDelay(Ye)),(0,c.switchMap)(([Ye,dn,Wg,xc])=>e.load({attributes:h,parameters:Ye,options:{loadType:s,pagingConfig:dn,sortingConfig:Wg,hierarchyConfig:xc}}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.model.load.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${d}`),(0,c.catchError)(Ze=>this._handleLoadErrorResponse(Ze,[])),(0,c.tap)(()=>this._updateTrackedAttributes(e)),(0,c.tap)(Ze=>{Ze.length===0&&this._dispatchFinishLoadModelAttributes(I)}),(0,c.mergeMap)(Ze=>Ze.length===0?(0,u.from)(this._processEmptyLoadDataForCollection(t,Ye)).pipe((0,c.map)(()=>Ze)):(0,u.of)(Ze)),(0,c.switchMap)(Ze=>this._checkAndProcessPageDataSourceData(e,Ze)),(0,c.map)(Ze=>({data:Ze,viewModelAttributes:t.getModelDto(Ze)})),(0,c.switchMap)(({data:Ze,viewModelAttributes:Wa})=>this.setValue(Wa,{collectionLoadType:O===ve.Reload?Ss.Reload:Ss.Merge,silent:!0,isMaskedValue:!0}).pipe((0,P.pR)(()=>!t.isCollection||!Wa?(0,u.of)(void 0):(Object.keys(Wa).forEach(np=>{this.attributes[np]?.forEach(j1=>{j1.formApiModel.updateValueAndValidity()})}),(0,u.from)(this._setDataSourceLoaded(d,t,Ze,dn)))),(0,c.tap)(()=>this._markAsPristine(Wa)),(0,c.map)(()=>Ze))))),(0,c.tap)(()=>this._modelLoaded$.next(d)),(0,c.switchMap)(Ye=>this._runBusinessRulesForModel(e,Ye)),(0,c.tap)(Ye=>{const dn=this._getAffectedAttributes(d,h,Ye);this._featureValues.DisableSequentialLoadDependentDS&&this._reloadDependentModels(e,dn,$t.Page),B||this._reloadDependentModels(e,dn,$t.ViewElement)}),(0,c.tap)(Ye=>{const dn=Ye[0]??{};e.setLoadedState(Object.keys(dn)),this._dispatchFinishLoadModelAttributes(I)}),(0,c.takeUntil)(this._destroy$))}_checkAndLoadUnloadedDependOnModels(e){const t=e.filter(n=>{const s=!this._modelsRequestedToLoad.has(n),r=!Ii(this.getModelByName(n));return s&&r});this._requestReloadModels(t)}_createChangeAttributeTriggers(e){return e.map(t=>({type:Me.ChangeAttributeValue,name:t,scopeId:""}))}_runBusinessRulesForModel(e,t,n=!1,s=[]){const r=this._dataSourcesInfos.get(e.name);if(r.isCollection||!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,u.of)(t);const o=t[0]??{},l=n?[...r.mappedViewModelAttributes]:Object.keys(o).flatMap(I=>this._getMappedAttributeNames(r,I)).filter(I=>I!=null),d=this._createChangeAttributeTriggers(l),h={type:Me.DataLoaded,name:e.name,scopeId:""},f=this.models.filter(I=>I!==e).filter(I=>I.mode!==z.Init).filter(I=>I.getDataSource().scope===$t.Page).map(I=>this._getModelBusinessRuleContext(I.name,[]));return(0,u.forkJoin)([this._getModelBusinessRuleContext(r.name,[h,...s]),...f,(0,u.of)(this._getViewModelBusinessRuleContext([...d,...s,h]))]).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRulesForModel.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,c.switchMap)(I=>this._runBusinessRulesForContexts(I)),(0,c.map)(()=>t))}_runInitialBusinessRules(){if(!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,u.of)(null);const e={type:Me.ContextReady,name:null,scopeId:""};return this._prepareBusinessRulesContexts([e]).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitialBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,c.mergeMap)(t=>t.length===0?(0,u.of)(null):this._runBusinessRulesForContexts(t)))}_createViewModelAttributesValues(e,t){const n=Object.entries(this.dataSchemas),[,s]=n.find(([o])=>o===e),r={};for(const o of s.attributes){const l=t[o.name],d=this.getViewModelAttributePath(e,o.name);d&&(r[d]=l??null)}return r}_createModelData(e,t){const n=this._dataSourcesInfos.get(e),s=this._getDataSourceMappingAttributes(n);this._dispatchStartLoadModelAttributes(s);const r=this.getModelByName(e),o=r.disableSync,l=this._getModelAttributesToLoad(r,null);return r.disableSync=!0,r.create(t).pipe((0,c.switchMap)(d=>{const h=this._createViewModelAttributesValues(e,d),f=this._isOneToManyRootModelRelation(e)?{silent:!0}:null;return this.setValue(h,f).pipe((0,c.tap)(()=>this._forEachControl(h,I=>{I.markAsPristine(),I.markAsUntouched()})))}),(0,c.tap)(()=>{r.disableSync=o,this._modelLoaded$.next(e),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e)}),(0,c.switchMap)(()=>this._runBusinessRulesForModel(r,[],!0)),(0,c.tap)(()=>{this._isSyncForModelAllowed(r)&&this._reloadDependentModels(r,l)}),(0,c.tap)(()=>{this._dispatchFinishLoadModelAttributes(s),r.setLoadedState()}),(0,c.map)(()=>null))}_copyModelData(e,t,n){const s=this._dataSourcesInfos.get(e),r=this._getDataSourceMappingAttributes(s);this._dispatchStartLoadModelAttributes(r);let o;const l=this.getModelByName(e),d=this._getModelAttributesToLoad(l,null),h=l.disableSync;return l.disableSync=!0,this._modelSourceRecordId[e]=t,l.copy(t,n).pipe((0,c.catchError)(f=>this._handleLoadErrorResponse(f,{})),(0,c.map)(f=>({data:[f],viewModelAttributes:s.getModelDto([f])})),(0,c.switchMap)(({data:f,viewModelAttributes:I})=>this.setValue(I).pipe((0,c.tap)(()=>this._markAsPristine(I)),(0,c.map)(()=>f))),(0,c.tap)(()=>{l.disableSync=h,this._modelLoaded$.next(e)}),(0,c.switchMap)(f=>this._runBusinessRulesForModel(l,f,!0)),(0,c.tap)(()=>{this._isSyncForModelAllowed(l)&&(this._reloadDependentModels(l,d),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e))}),(0,c.tap)(()=>{this._dispatchFinishLoadModelAttributes(r),l.setLoadedState()}),(0,c.mergeMap)(()=>(0,u.of)(o)))}_getDataSourceMappingAttributes(e,t=null){const n=t??e?.attributes.map(r=>r.path);if(!n)return{};const s=Object.fromEntries(n.map(r=>[this._getMappedAttributeName(e,r),!0]));return e.collectionViewModelAttributeName&&(s[e.collectionViewModelAttributeName]=!0),s}_handleLoadErrorResponse(e,t){if(e instanceof zc)return(0,u.of)(t);const n=1e4;return console.error(e),this._showNotification({message:e.message,duration:n}),(0,u.of)(t)}_canExecuteBusinessRulesByModelAttributeValue(e,t,n){return t&&e?this._isModelAttributeValueValid(e,t,n):!0}_canExecuteBusinessRulesByViewModelAttributeValue(e,t){const n=this._getDataSourceInfoByViewModelAttributePath(e);if(n){const s=n.getDataSourceAttributePath(e);return this._canExecuteBusinessRulesByModelAttributeValue(n,s,t)}return!0}_getContextAttributeValue(e){return e instanceof Date?Op(e):e}_getNormalizedContextAttributeValue(e,t,n){const s=e;return C.r[t]===C.r.Lookup||s?.displayValue?s?.value??e:n===!0||!t?e:[C.r.RICH_TEXT,C.r.Image].includes(C.r[t])?null:C.r[t]===C.r.MAXSIZE_TEXT&&e?e.slice(0,500):e}_getHasValueContextAttributeValue(e,t){return!!(t&&C.r[t]===C.r.Boolean||e!=null&&e!=="")}_getViewModelAttributeInfos(e,t,n){return Object.keys(t).filter(s=>!(t[s]instanceof ft)).map(s=>{if(t[s]instanceof bn)return this._getViewModelAttributeInfos(e?`${e}.${s}`:s,t[s]?.attributes??{},n);const r=this._attributeConfigs[s]?.dataValueTypeName,o=this._getContextAttributeValue(t[s]),l=this._getNormalizedContextAttributeValue(o,r,n);return{name:e?`${e}.${s}`:s,value:l??null,displayValue:t[s]?.displayValue,dataValueTypeName:r,hasValue:this._getHasValueContextAttributeValue(o,r)}}).flat()}_runBusinessRulesForContexts(e){const t=`${$n.RunningBusinessRules}-${(0,A.qv)()}`;return this._onAsyncTaskStarted(t),(0,u.of)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,c.map)(n=>n?.filter(s=>!(0,T.isNil)(s))??[]),(0,c.mergeMap)(n=>{if(n.length===0)return(0,u.of)(null);const s=n.map(r=>({scopeName:r.scopeName,scopeId:r.scopeId,scopeType:r.scopeType,triggers:r.triggers}));return this._toggleControlsAffectedByBusinessRules(!1,s),this._businessRulesEngine.execute(n).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.execute.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,c.tap)(r=>{r.forEach(o=>{const l=s.find(d=>d.scopeId===o.scopeId&&d.scopeName===o.scopeName&&d.scopeType===o.scopeType);o.triggers=l?.triggers??[]})}),(0,c.switchMap)(r=>r?this._businessRulesApplier.applyRules(this,r):(0,u.of)(null)),(0,c.tap)(()=>{this._toggleControlsAffectedByBusinessRules(!0,s)}))}),(0,c.tap)(()=>this._onAsyncTaskFinished(t)))}_createViewModelContext(e,t){return{scopeType:Cn.ViewModel,scopeName:this._scopeName,scopeId:this._scopeName,scopeState:Hn.Unknown,parentScopeId:null,attributes:t,triggers:e}}_getViewModelBusinessRuleContext(e){const t=this._featureValues["BRules-EnableCompareLargeAttributeValues"],n=this._getViewModelAttributeInfos(null,this.attributes,t);return this._createViewModelContext(e,[...n].map(s=>({attributeName:s.name,value:s.value,displayValue:s.displayValue,dataValueTypeName:s.dataValueTypeName,hasValue:s.hasValue})))}_prepareModelBusinessRuleTrigger(e,t){return t.map(n=>{if(n.type===Me.DataLoaded||n.type===Me.ContextReady)return n;const s=this._getDataSourceInfoByViewModelAttributePath(n.name);return!s||s.name!==e?null:{type:Me.ChangeAttributeValue,name:s.getDataSourceAttributePath(n.name),scopeId:""}}).filter(n=>n!=null)}_getModelContextScopeStateType(e){switch(e.mode){case z.Init:return Hn.Init;case z.Create:return Hn.Create;case z.Copy:return Hn.Copy;case z.Update:return Hn.Update;default:return Hn.Unknown}}_getModelBusinessRuleContext(e,t){const n=this._dataSourcesInfos.get(e),s=this.getModelByName(e),r=this.dataSchemas[e],o=this._prepareModelBusinessRuleTrigger(e,t),l=this._getModelContextScopeStateType(s);return this._getDataSourceDto(e).pipe((0,c.map)(d=>({...s._getPersistedState(),...d})),(0,c.map)(d=>({enableCompareLargeAttributeValues:this._featureValues["BRules-EnableCompareLargeAttributeValues"],modelDto:d})),(0,c.map)(({enableCompareLargeAttributeValues:d,modelDto:h})=>Object.entries(h).map(([f,I])=>{let O;const B=this._getMappedAttributeName(n,f);if(B)O=this._attributeConfigs[B]?.dataValueTypeName;else{const Tc=r.findAttributeByName(f);O=C.r[Tc.dataValueType]}const J=this._getContextAttributeValue(I),te=this._getNormalizedContextAttributeValue(J,O,d);return{attributeName:f,value:te,displayValue:I?.displayValue,dataValueTypeName:O,hasValue:this._getHasValueContextAttributeValue(J,O),isSignificant:f===r.primaryAttributeName}})),(0,c.map)(d=>({scopeType:Cn.Model,scopeName:s.dataSchemaName,scopeId:e,scopeState:l,parentScopeId:this._scopeName,attributes:d,triggers:o,modelType:s.getDataSource()?.type})))}_prepareDataSourceNamesForBusinessRules(){return this._modelsMap.size===0?[]:[...this._modelsMap.values()].filter(e=>!this._dataSourcesInfos.get(e.name).isCollection).map(e=>e.name)}_getModelsBusinessRuleContexts(e){return this._prepareDataSourceNamesForBusinessRules().map(n=>n?this._getModelBusinessRuleContext(n,e):(0,u.of)(null))}_prepareBusinessRulesContexts(e){const t=this._getModelsBusinessRuleContexts(e);if(!this._scopeName)return t.length===0?(0,u.of)([]):(0,u.forkJoin)([...t]);const s=[(0,u.of)(this._getViewModelBusinessRuleContext(e)),...t];return s.length===0?(0,u.of)([]):(0,u.forkJoin)(s)}_isAttributeChange(e){return!e.attributeName?.includes(":")}_businessRulesSubscribeOnChangeAttributes(){if(!this._businessRulesProcessingEnabled||this._isDesignTime)return;const e=this.events$.pipe((0,c.filter)(()=>this._businessRulesActive),(0,c.filter)(n=>n.type===Ne.ChangeAttributeValue),(0,c.filter)(n=>this._isAttributeChange(n.payload)),(0,c.filter)(n=>!n.payload.silent),(0,c.filter)(n=>!n.payload?.preventRunBusinessRules),(0,c.filter)(n=>{const s=n.payload;return this._canExecuteBusinessRulesByViewModelAttributeValue(s.attributeName,s.value)}),(0,c.filter)(n=>{const s=n.payload,r=this._getAttributeDataValueTypeName(s.attributeName);return r&&cd(r)===C.r.Lookup?s.value?.value!==s.oldValue?.value:!0}),(0,c.map)(n=>n.payload.attributeName)),t=e.pipe((0,c.tap)(()=>this._onAsyncTaskStarted($n.DebouncingBusinessRules)),(0,c.buffer)(e.pipe((0,c.debounceTime)(Yy))),(0,c.map)(n=>Array.from(new Set(n))),(0,c.map)(n=>this._createChangeAttributeTriggers(n)),(0,c.mergeMap)(n=>this._prepareBusinessRulesContexts(n)),(0,c.tap)(()=>this._onAsyncTaskFinished($n.DebouncingBusinessRules)),(0,c.filter)(n=>n.length>0),(0,c.mergeMap)(n=>this._runBusinessRulesForContexts(n)));this._subscriptions.add(t.subscribe())}_subscribeOnChangeAttributes(){const e=this.events$.pipe((0,c.filter)(t=>t.type===Ne.ChangeAttributeValue),(0,c.map)(t=>t),(0,c.map)(t=>{const n=this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),s=this._dataSourcesInfos.get(n)?.attributesMap.get(t.payload.attributeName),r=this.getBoundDataSchemaAttributeByAttributePath(t.payload.attributeName);return{changeEvent:t,model:this.getModelByName(n),modelAttributeInfo:{name:r?.name??s,isLookup:!!r?.isLookup}}}),(0,c.filter)(({model:t,modelAttributeInfo:n})=>!!(t&&n.name)),(0,c.tap)(({changeEvent:t,model:n,modelAttributeInfo:s})=>{const r=t.payload,o=s.isLookup,l=o?r.oldValue?.value:r.oldValue,d=o?r.value?.value:r.value;l!==d&&n?.attributeChanged(s.name,r?.preventStateChange??r?.silent)}));this._subscriptions.add(e.subscribe())}_getHasRelation(e=[],t,n){return e.map(r=>{const o=r.trackByAttributes??[],{dependOnModelName:l,dependOnAttributeName:d}=Ad(r.relationPath);return o.push(d),{rootModelName:l,trackedAttributes:d}}).filter(({rootModelName:r})=>r===t).filter(({trackedAttributes:r})=>this._dataSourcesInfos.get(t).isCollection?!0:n.some(o=>r.includes(o))).length!==0}_getDependentModelsNames(e,t=[]){return e?Object.entries(this._modelDependencies).filter(([n])=>n!==e).filter(([,n])=>this._getHasRelation(n,e,t)).map(([n])=>n).map(n=>[n,...this._getDependentModelsNames(n)]).flat():[]}_getIsModelDataChanged(e){if(!this.getModelByName(e)?.isLoaded)return!1;const n=this._dataSourcesInfos.get(e);if(n.isCollection){const r=n.collectionViewModelAttributeName,o=this.attributes[r];return o?o.isChanged:!1}return n.getMappedAttributes().some(r=>this.getIsDirty(r))}_requestReloadModels(e){this._createRequestsForReloadingDataSources(e).forEach(n=>{this._ngZone.runOutsideAngular(()=>this.processRequest(n))})}_isModelAttributeValueValid(e,t,n){return this._getDataSourceAttributeSchema(e,t)?.dataValueType===C.r.Lookup?mm(n):!0}_canReloadModelDependentData(e,t){return e.canReloadDependentData(t)?!0:this._conflictedModels.includes(e.name)?!1:this._getDependentModelsNames(e.name,[t]).length>0}_getModelDependentAttributes(e,t){return[...t,...t.map(n=>e.getDependentAttributesNames(n)).flat()]}_getChangedModelsNames(e){return e.filter(t=>this._getIsModelDataChanged(t))}_showNotification(e){this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.NotificationRequest",$context:this,...e}))}_isSyncForModelAllowed(e){return e.allowSync}_subscribeOnReloadDataEvents(){if(this._isDesignTime)return;const e=this.events$.pipe((0,c.filter)(()=>this._modelSynchronizationEnabled),(0,c.filter)(t=>t.type===Ne.ChangeAttributeValue),(0,c.filter)(t=>t.payload.silent!==!0),(0,c.map)(t=>({modelName:this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),attributeName:t.payload.attributeName,attributeValue:t.payload.value})),(0,c.filter)(({modelName:t})=>t!=null),(0,c.map)(({modelName:t,attributeName:n,attributeValue:s})=>{const r=this._dataSourcesInfos.get(t),o=r?.attributesMap.get(n);return{model:this.getModelByName(t),dataSourceInfo:r,modelAttribute:o,attributeValue:s}})).pipe((0,c.filter)(({model:t})=>t!=null),(0,c.filter)(({dataSourceInfo:t})=>!t.isCollection),(0,c.filter)(({model:t})=>this._isSyncForModelAllowed(t)),(0,c.filter)(({dataSourceInfo:t,modelAttribute:n,attributeValue:s})=>this._isModelAttributeValueValid(t,n,s)),(0,c.filter)(({model:t,modelAttribute:n})=>this._canReloadModelDependentData(t,n))).pipe((0,c.tap)(({model:t,dataSourceInfo:n,modelAttribute:s,attributeValue:r})=>{const o=this._getModelDependentAttributes(t,[s]),l=Object.fromEntries(o.map(d=>[this._getMappedAttributeName(n,d),!0]));this._dispatchStartLoadModelAttributes(l),t.reloadDependentData(s,r).pipe((0,c.switchMap)(d=>{if(d.length===0)return(0,u.of)(d);const h=n.getModelDto(d);return this.setValue(h,{silent:!0,isMaskedValue:!0}).pipe((0,c.switchMap)(()=>this._runBusinessRulesForModel(t,d)))}),(0,c.tap)(()=>this._reloadDependentModels(t,[s])),(0,c.tap)(()=>this._dispatchFinishLoadModelAttributes(l))).subscribe()}));this._subscriptions.add(e.subscribe())}_subscribeOnChangeRequests(){const e=this.events$.pipe((0,c.filter)(t=>t.type===Ne.ChangeAttributeValue),(0,c.mergeMap)(t=>{const n=t.payload.attributeName,s=this._attributeConfigs[n];return Array.isArray(s?.change)?s.change:[s?.change]}),(0,c.filter)(t=>t!=null),(0,c.map)(t=>({type:t.request,$context:this,scopes:this._scopeName?[this._scopeName]:[],...t.params})),(0,c.tap)(t=>this._ngZone.runOutsideAngular(()=>this.handlerChain.process(t))));this._subscriptions.add(e.subscribe())}_subscribeOnFilteringEvents(){const e=new Set;this._subscriptions.add(this._modelLoaded$.pipe((0,c.tap)(n=>{e.add(n)})).subscribe());const t=this.events$.pipe((0,c.filter)(n=>n.type===Ne.ChangeAttributeValue),(0,c.map)(n=>{const s=n.payload.attributeName;return this._getDataSourceNamesAffectedByFilteringAttribute(s,e)}),(0,c.map)(n=>this._createRequestsForReloadingDataSources(n)),(0,c.tap)(n=>{n.forEach(s=>{this._ngZone.runOutsideAngular(()=>this.processRequest(s))})}));this._subscriptions.add(t.subscribe())}_saveModel(e,t,n){const s=this.getModelByName(e),r=s.mode,o=this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(l,d)=>s.insertOrUpdate(l,d),onSavedAction:(l,d)=>this._updateLastLoadParameters(e,r,l,d),getInvalidAction:l=>(0,u.of)(l)});return this.handleSaveModelStream(o,n)}_initSubscriptions(){return this._measurePerformanceService.measure(`ViewModel.initSubscriptions.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._subscribeOnFilteringEvents(),this._subscribeModelsEvents(),this._subscribeOnChangeAttributes(),this._subscribeOnChangeRequests(),this._subscribeOnReloadDataEvents(),this._businessRulesSubscribeOnChangeAttributes(),this._subscribeOnChangeAttributesToHandleModelDependenciesConstrains(),this._subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(),(0,u.of)(null)))}_subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(){if(this._featureValues.DisableMultipleDataSources)return;const e=this.events$.pipe((0,c.filter)(t=>this._primaryModelName!=null),(0,c.filter)(t=>t.type===Ne.ChangeAttributeValue),(0,c.map)(t=>t),(0,c.map)(({payload:t})=>{const n=t.attributeName,s=t.value;return{modelName:this.getBoundDataSourceNameByAttributePath(n),attributeName:n,attributeValue:s}}),(0,c.filter)(({modelName:t})=>this._isPrimaryModel(t)),(0,c.filter)(({attributeName:t})=>{const n=this.getBoundDataSchemaByAttributePath(t),s=this.getBoundDataSchemaAttributeByAttributePath(t);return!n||!s?!1:n.primaryDisplayAttributeName===s.name}),(0,c.map)(({modelName:t,attributeValue:n})=>{const s=this.dataSchemas[this._primaryModelName],o=this._getDependentModelsNames(t,[s.primaryAttributeName]).filter(l=>this._isOneToManyRootModelRelation(l));return{primaryDisplayValue:n,dependentModelsNames:o}}),(0,c.filter)(({dependentModelsNames:t})=>t.length>0),(0,c.tap)(({dependentModelsNames:t,primaryDisplayValue:n})=>{const s=this.dataSchemas[this._primaryModelName],r=this.getViewModelAttributePaths(this._primaryModelName,s.primaryAttributeName)[0],o=this.attributes[r],l={};t.map(d=>{const f=this._modelDependencies[d][0].attributePath;return this.getViewModelAttributePaths(d,f)}).flat().forEach(d=>{l[d]={value:o,displayValue:n}}),this.setValue(l,{silent:!0,preventAttributeChangeRequest:!0,preventRunBusinessRules:!1,preventStateChange:!0})}));this._subscriptions.add(e.subscribe())}_getDataSchemas(){if(this.models&&this.models.length!==0){const e=this.models.map(t=>t.getSchema().pipe((0,c.map)(n=>[t.name,n])));return(0,u.combineLatest)(e).pipe((0,c.take)(1),(0,c.map)(t=>Object.fromEntries(t)))}return(0,u.of)({})}_setAttributesDefaultValues(e){var t=this;return(0,u.from)((0,S.A)(function*(){let n=Object.entries(t.dataSchemas);e&&(n=n.filter(([s])=>s===e));for(const[s,r]of n){const o={};for(const l of r.attributes){const d=yield(0,u.lastValueFrom)(l.defaultValue,{defaultValue:null});if(!(0,T.isNil)(d)){const h=t.getViewModelAttributePath(s,l.name);h&&(o[h]=d)}}t.setValue(o).subscribe()}})())}_generateDataSourcesInfo(){return this._dataSourcesInfos=In.getFromViewModelConfig(this.viewModelConfig,this.models),(0,u.of)(this._dataSourcesInfos)}_generateAttributesToDataSourceNameMap(e){const t=Array.from(e.values()).map(n=>this._getDataSourceAttributesMap(n)).flat();return this._initializeAttributesToDataSourceNameMap(t),(0,u.of)(this._attributesToDataSourceNameMap)}_initializeAttributesToDataSourceNameMap(e){this._attributesToDataSourceNameMap=new Map(e)}_getDataSourceAttributesMap(e){const n=e.getMappedAttributes().map(s=>[s,e.name]);return e.isCollection&&n.push([e.collectionViewModelAttributeName,e.name]),n}_getDataSourceLoadType(e){return e?e||ve.Reload:null}_getLoadTypeForDataSource(e,t){if(t===ve.Load)return t;const n=e.getPagingConfig();return!t&&n?ve.LoadNext:t}_loadDefaultSorting(e){this._measurePerformanceService.measure(`ViewModel._loadDefaultSorting.${this._injectionContext?.id}.parent.${!!this.parent}.dsNames.${e?.toString()}`,()=>{const t=Array.from(this._dataSourcesInfos.entries()).filter(([n])=>!e?.length||e.includes(n)).map(([,n])=>n.getSortingConfig()).filter(n=>!!n?.default).reduce((n,s)=>(n[s.attributeName]=s.default,n),{});this.setValue(t,{silent:!0}).subscribe()})}_getDropdownPageSize(){var e=this;return(0,S.A)(function*(){if(!(0,T.isEmpty)(e._dropdownPageSize))return e._dropdownPageSize;const t=yield e.sysSettingsService.getByCode(e._dropdownPageSizeSettingsCode);return e._dropdownPageSize={pagingConfig:{rowCount:t?.value,rowsOffset:0}},e._dropdownPageSize})()}_mergeCollectionModels(e,t){this._measurePerformanceService.measure(`ViewModel.mergeCollectionModels.${this._injectionContext?.id}.parent.${!!this.parent}.collection.${e}`,()=>{const n=this.attributes[e];this._featureValues.DisableBaseViewModelCollectionOptimization||n.length?n.merge(t):n.push(...t)})}_getEmbeddedModels(){const e=Object.entries(this.viewModelConfig?.attributes??{}).filter(([,s])=>s&&"embeddedModel"in s&&s.embeddedModel).map(([s,r])=>({attributeName:s,embeddedModel:r.embeddedModel}));if(e.length===0)return(0,u.of)([]);const t={},n=[];if(e.forEach(({attributeName:s,embeddedModel:{name:r,config:o}})=>{r?t[r]&&n.push(`Duplicated embedded model : ${r}.`):n.push(`Embedded model name is not provided for ${s}.`),t[r]=o}),n.length>0)throw new Error(n.join(" "));return this._modelGenerator.generate({dataSources:t},this.injector)}_concatModelsWithEmbedded(e=null){return this._getEmbeddedModels().pipe((0,c.map)(t=>{const n=[...e??[],...t??[]],s=n.map(r=>r.name).filter((r,o,l)=>l.indexOf(r)!==o);if(s.length>0)throw new Error(`Duplicated model names found : ${s.join(",")}.`);return n}))}_updateModelsMap(){const e=this.models.map(t=>[t.name,t]);this._modelsMap=new Map(e)}_subscribeModelsChanges(){this._subscriptions.add(this._models$.subscribe(()=>this._updateModelsMap()))}_subscribeModelsEvents(){this._isDesignTime||this.models.forEach(e=>this._subscribeModelEvents(e))}_subscribeModelEvents(e){this._subscriptions.add(e.event$.pipe((0,c.mergeMap)(t=>this._waitDataDelay(t)),(0,c.mergeMap)(t=>this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.HandleModelEventRequest",$context:this,scopes:this._eventScopes,modelName:e.name,modelEvent:t})),1)).subscribe())}_upsertModel(e,t){const n=[...this.models],s=n.findIndex(({name:r})=>r===e);s===-1?n.push(t):n.splice(s,1,t).forEach(r=>r.destroy()),this._subscribeModelEvents(t),this._models$.next(n)}_replaceDataSourceInfo(e,t){!e||!t||(this._loadedDataSources.has(e)&&this._loadedDataSources.delete(e),this._dataSourcesInfos.set(e,t),this._replaceAttributesToDataSourceNameMap(t))}_updateModels(e){e.forEach((t,n)=>{const s=this.getModelByName(n);s&&(this._markModelAsCollection(s,t),this._updateModelDependentAttributes(s,t))})}_markModelAsCollection(e,t){t.isCollection&&(e._isCollection=!0)}_setModalLoadParameters(e){this._modelsNamesWithParameters.add(e),this._modelLoadParametersSetted$.next()}_updateModelDependentAttributes(e,t){const n=t.attributes.map(s=>({path:s.path,type:s.type}));e.updateDependentAttributes(n)}_initIsChangedAttribute(){this._systemAttributes.push(Vr),this.attributes[Vr]=!1;const e=this._models$.pipe((0,c.switchMap)(t=>t?.length?(0,u.combineLatest)(t.map(n=>n._dirty$)):(0,u.of)([])),(0,c.map)(t=>t.some(n=>n)),(0,c.filter)(()=>!this._viewModelAttributeChangeEventOptions.getOptions().preventStateChange),(0,c.distinctUntilChanged)()).subscribe(t=>{this._setSystemAttributeValue(Vr,t)});this._subscriptions.add(e)}_initHasUnsavedDataAttribute(){this._systemAttributes.push(vl),this.attributes[vl]=!1;const e=this.events$.pipe((0,c.filter)(o=>o?.type===Ne.ChangeAttributeValue&&o.payload?.attributeName===Vr),(0,c.map)(o=>o.payload.value)),t=(0,u.merge)(this.IsChanged,e),s=this._models$.pipe((0,c.map)(o=>o.map(l=>l._modeChanges$.pipe((0,c.map)(d=>({mode:d,name:l.name})),(0,c.startWith)({mode:l.mode,name:l.name})))),(0,c.switchMap)(o=>o?.length?(0,u.combineLatest)(o):(0,u.of)([]))).pipe((0,c.map)(o=>o.some(({mode:l,name:d})=>{const h=!this._isDesignTime&&!this._featureValues.DisableMultipleDataSources&&!this._isPrimaryModel(d)&&this._isIndependentRootModel(this.getModelByName(d)),f=this._isOneToManyRootModelRelation(d);return(l===z.Create||l===z.Copy)&&!f&&!h}))),r=(0,u.combineLatest)([t,s]).pipe((0,c.map)(([o,l])=>!!(o||l)),(0,c.distinctUntilChanged)()).subscribe(o=>{this._setSystemAttributeValue(vl,o)});this._subscriptions.add(r)}_initPrimaryModelModeAttribute(){const e=this._getPrimaryModelModeChanges();if(!e)return;this._systemAttributes.push(hd),this.attributes[hd]=this.getPrimaryModelMode();const t=e.pipe((0,c.startWith)(this.getPrimaryModelMode())).subscribe(n=>this._setSystemAttributeValue(hd,n));this._subscriptions.add(t)}_initStateAttribute(){this._systemAttributes.push(Tl),this.attributes[Tl]=md.Active}_initBusinessRulesActivatedAttribute(){if(this._systemAttributes.push(pd),this.attributes[pd]=this._businessRulesAreActivated,this._businessRulesAreActivated)return;const e=this._businessRulesActivated$.pipe((0,c.filter)(t=>t===!0)).subscribe(t=>{this._setSystemAttributeValue(pd,t)});this._subscriptions.add(e)}_initSystemAttributes(){var e=this;return(0,S.A)(function*(){yield e._measurePerformanceService.measureCallback(`ViewModel.initSystemAttributes.${e._injectionContext?.id}.parent.${!!e.parent}`,()=>(e._initIsChangedAttribute(),e._initPrimaryModelModeAttribute(),e._initHasUnsavedDataAttribute(),e._featureValues.DisableDelayingModelEvents||e._initStateAttribute(),e._initBusinessRulesActivatedAttribute(),Promise.resolve()))})()}_handleCircularDependencies(){const e=V_(this._modelDependencies);if(e.hasCycles){const t=this._translateService.instant("BaseViewModel.WarningModelsWithCircularDependencies");this._showNotification({message:t,duration:1e4}),console.warn(t,e.cycledModelsNames)}this._conflictedModels=e?.cycledModelsNames}_forEachControl(e,t){Object.keys(e).forEach(s=>{if(this.attributes[s]instanceof ft){const r=this.attributes[s],o=e[s];r.forEach(l=>{const d=l.primaryAttributeName,h=l.attributes[d],f=o.find(I=>I[d]===h);f&&l._forEachControl(f,t)})}else if(this.attributes[s]instanceof bn)this.attributes[s]._forEachControl(e[s],t);else{const r=this.getControl(s);t(r.formControl)}})}_getModelsErrors(e){return(e??[]).filter(t=>!t.isCollectionItemModel&&t.hasErrors).map(t=>t.getLastError())}_notifyAboutModelsErrors(e){const t=this._getModelsErrors(e);if(t.length>0){const n=t.map(s=>s.message).join(" ");this._showNotification({message:n})}}_initFeaturesStates(){this._disableViewModelWaitingForAsyncTasks=this._featureValues.DisableViewModelWaitingForAsyncTasks,this._disableViewModelLoadUnblockingThread=this._featureValues.DisableViewModelLoadUnblockingThread,this._blockFieldsAffectedByBusinessRules=this._featureValues.BlockFieldsWhileRunBusinessRules,this._modelSynchronizationEnabled=!this._featureValues.ModelSynchronizationDisabled}_handleAsyncTasksCycle(e){let t=null;const n=100,s=Array.from(e).filter(r=>r.startsWith($n.ProcessingAttributeChangeRequest));if(!(!e.size||!s.length))return s.length&&(t=setTimeout(()=>{console.warn("[ViewModel]: Clearing executing tasks by exceeded timeout",s),s.forEach(r=>e.delete(r)),this._asyncTasksExecutingSubject.next(e)},n)),t}_getAffectedViewModelAttributes(e,t){return this.models.filter(s=>s.dataSchemaName===e).map(s=>s.name).flatMap(s=>this.getViewModelAttributePaths(s,t))}_toggleControlsAffectedByBusinessRules(e,t){if(!this._blockFieldsAffectedByBusinessRules)return;this._attributesAffectedByBusinessRules?.filter(s=>h_(this._scopeName,s,t))?.forEach(s=>{s.scopeName===this._scopeName?this.getControl(s.name).toggle(e):this._getAffectedViewModelAttributes(s.scopeName,s.name).forEach(o=>{this.getControl(o).toggle(e)})})}_initAttributesAffectedByBusinessRules(){var e=this;return(0,S.A)(function*(){const n=e._prepareDataSourceNamesForBusinessRules().filter(r=>!!r).map(r=>e.getModelByName(r)).map(r=>({scopeId:r.name,scopeName:r.dataSchemaName,scopeType:Cn.Model,modelType:r.getDataSource()?.type})),s={scopeName:e._scopeName,scopeType:Cn.ViewModel,scopeId:e._scopeName};e._attributesAffectedByBusinessRules=yield e._businessRulesEngine.getAffectedAttributes([s,...n])})()}_initBusinessRules(){var e=this;return this._measurePerformanceService.measureCallback(`ViewModel.initBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`,(0,S.A)(function*(){e._businessRulesProcessingEnabled=!e._featureValues.BusinessRulesProcessingDisabled&&e.viewModelConfig.supportBusinessRules!==!1,e._businessRulesProcessingEnabled&&(yield e._initAttributesAffectedByBusinessRules()),e._businessRulesAreActivated=e._businessRulesProcessingEnabled&&e._businessRulesActive!==!1,e._businessRulesActivated$.next(e._businessRulesAreActivated)}))}_attributeGenerate$(e,t){return(0,u.of)(this._featureValues.UseDesignerHotSwapViewModel).pipe((0,c.switchMap)(n=>n&&this._isDesignTime?this._initDataSourceValidators().pipe((0,c.tap)(()=>{this._initSchemaValidators(e)}),(0,c.switchMap)(()=>this._attributeGenerate(e,t))):this._attributeGenerate(e,t)))}_validateByDataSourceName(e){var t=this;return(0,S.A)(function*(){const n={},s=t._getBoundDataSourceAttributeControls(e);return yield Promise.all(Object.entries(s).map(([r,o])=>(o.markAsTouched(),o.updateValueAndValidity(),(0,u.lastValueFrom)(Gm(o).pipe((0,c.tap)(()=>{o.errors&&(n[r]=o.errors)})))))),n})()}_validateAll(){var e=this;return(0,S.A)(function*(){const t={};return e.formApiModel.markAllAsTouched(),e.formApiModel.updateValueAndValidity(),$m(e.formApiModel),yield(0,u.lastValueFrom)(Gm(e.formApiModel).pipe((0,c.tap)(()=>{Object.entries(e.formApiModel.controls).forEach(([s,r])=>{r.errors&&(t[s]=r.errors)})}))),t})()}_getDependentModelsNamesOnRelationAttributeName(e){const t=this.getBoundDataSourceNameByAttributePath(e),s=this._dataSourcesInfos.get(t)?.attributesMap.get(e);return this._getDependentModelsNames(t,[s])}_setAttributeValue(e,t,n){this._executeWithOptions(()=>this[e]=t,n)}_subscribeOnChangeAttributesToHandleModelDependenciesConstrains(){if(this._isDesignTime)return;const e=this.events$.pipe((0,c.filter)(t=>t.type===Ne.ChangeAttributeValue),(0,c.filter)(t=>this._isAttributeChange(t.payload)),(0,c.tap)(t=>{const n=t;!n?.payload?.value&&n.payload?.attributeName&&this._clearValuesForManyToOne(n.payload.attributeName)}));this._subscriptions.add(e.subscribe())}_clearValuesForManyToOne(e){this._getDependentModelsNamesOnRelationAttributeName(e).forEach(n=>{this._isManyToOneRootModelRelation(n)&&this._clearModelValues(n)})}_clearModelValues(e){const t=this._dataSourcesInfos.get(e),n=t?.isCollection?[]:t.getMappedAttributes();if(n.length){const s=n.reduce((r,o)=>({...r,[o]:null}),{});this.setValue(s).subscribe(()=>{this._markAsPristine(s),this._markAsUntouched(s)})}}_markAsUntouched(e){this._forEachControl(e,t=>{t.markAsUntouched()})}_setSingleSubmodelValue(e,t,n){return this.attributes[e].setValue(t[e],{silent:n?.silent,isMaskedValue:n?.isMaskedValue,preventAttributeChangeRequest:n?.preventAttributeChangeRequest,preventStateChange:n?.preventStateChange,preventRunBusinessRules:n?.preventRunBusinessRules})}_setCollectionSubmodelValue(e,t,n){const s=this._attributeConfigs[e],r=s.viewModelConfig||s.viewModelName,o=!this._featureValues.DisableDataGridEditingMode,l=(t[e]||[]).map(d=>{const h=this.getBoundDataSourceName(e),I=this._getDataSourceInfoByViewModelAttributePath(e)?.isCollection&&this.getModelByName(h)?.createCollectionItemModel(z.Update);return this.viewModelGenerator.generate({viewModelConfig:r,modelConfig:o&&I?{primaryDataSourceName:I.name}:void 0,models:o&&I?[I]:void 0,parentViewModel:this,businessRulesActive:!1},i.Injector.create({providers:[{provide:$c,useValue:null}],parent:this.injector})).pipe(this._measurePerformanceService.measure$(`ViewModel.setValue.generateViewModel.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${I?.name}`),(0,c.tap)(O=>{h&&(O.dataSchemas[h]=this.dataSchemas[h])}),(0,c.tap)(O=>{O.deactivateBusinessRules()}),(0,c.switchMap)(O=>O.setValue(d,{silent:n?.silent,isMaskedValue:n?.isMaskedValue,preventAttributeChangeRequest:n?.preventAttributeChangeRequest,preventStateChange:n?.preventStateChange,preventRunBusinessRules:n?.preventRunBusinessRules}).pipe((0,c.tap)(()=>I&&I.setLoadedState()),(0,c.map)(()=>O))))});return!l.length&&n?.collectionLoadType===Ss.Reload&&this.attributes[e].clear(),l.length===0?(0,u.of)(null):(0,u.forkJoin)([...l]).pipe((0,c.tap)(d=>{const h=this.getBoundDataSourceName(e);this.getModelByName(h)?.childrenChange(),this._executeWithOptions(()=>{n?.collectionLoadType===Ss.Reload||!n?.collectionLoadType?this.attributes[e].reload(d):this.getBoundDataSchema(e)?this._mergeCollectionModels(e,d):this.attributes[e].push(...d)},n)}))}_setSubmodelValues(e,t,n){return(0,u.forkJoin)([...e.filter(s=>t?.[s]).map(s=>this.attributes[s]instanceof bn?this._setSingleSubmodelValue(s,t,n):this._setCollectionSubmodelValue(s,t,n)),(0,u.of)(this)])}_findAttributePathInDataSourceNameMap(e){for(const t of this._attributesToDataSourceNameMap.keys()){const n=t.indexOf(".");if(n<0)continue;const s=n+1,r=e.length;if(t.startsWith(e,s)&&(t.length===s+r||t.charAt(s+r)==="."))return t}}_getBoundDataSourceAttributeControls(e){return Object.fromEntries(Array.from(this._attributesToDataSourceNameMap.entries()).filter(([t,n])=>n===e).map(([t])=>[t,this.getAttributeControl(t)]))}_resetMaskDataForAttribute(e){this[vm](e)&&(this.setAttributePropertyValue(e,bl,null),this.setAttributePropertyValue(e,ld,null),this.setAttributePropertyValue(e,ud,null))}_staticLoader(e){const t=e[0],n=e[1],s=e[2];this._checkDataSourceName(t);const r=this._getDataSourceLoadType(s?.loadType);return this._loadStaticModel(t,n,r,s?.payload,s?.useLastLoadParameters,s?.doNotUpdateLastLoadParameters).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${t}`))}_dynamicLoader(e){const t=e[0];return this._loadDynamicModel(t).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.model.${t.dataSourceName}`))}showLoadMaskAndValidateFields(e){this.maskService.showMask(this.saveModelTaskName,this);const t=this._getBoundDataSourceAttributeControls(e);Object.keys(t).forEach(n=>this.formApiModel.controls[n].updateValueAndValidity())}deleteModel(e,t,n,s){return(0,u.from)(this._modelParametersBuilder.getModelParameters(this,t,s?.payload)).pipe((0,c.switchMap)(r=>n(e,r)))}handleSaveModelStream(e,t){return e.pipe((0,c.finalize)(()=>this.maskService.hideMask(this.saveModelTaskName,this)),(0,c.catchError)(n=>{const s=typeof n=="string"?n:n?.message||n?.errorInfo;return t?.silent===!0?(0,u.of)({success:!1,rowsAffected:0,errorInfo:s}):(0,u.throwError)(()=>new Error(s))}))}_updateLastLoadParameters(e,t,n,s){const r=t===z.Create||t===z.Copy,o=this.dataSchemas[e],l=o.dataSourceConfig?.type===gl.EntityDataSource;if(s.success&&r&&l){const d=o.primaryAttributeName,h=n[d];this._loadedDataSources.add(e),this._lastEventLoadParameters.set(e,[{type:ne.PrimaryColumnValue,value:h}])}}getSaveParameters(e,t){return(0,u.forkJoin)({parameters:this._modelParametersBuilder.getModelParameters(this,t),dto:this._getDataSourceDto(e)})}getSaveModelStream$(e){return this.showLoadMaskAndValidateFields(e.dataSourceName),(0,u.from)(this.isValid(e.dataSourceName)).pipe((0,c.switchMap)(t=>{if(!t){const n=this.injector.get(v.TranslateService);return e.getInvalidAction({success:!1,rowsAffected:0,errorInfo:n.instant("HomePage.DialogMessages.RequiredFieldsAreNotFilled")})}return this.getSaveParameters(e.dataSourceName,e.parametersConfig).pipe((0,c.mergeMap)(({parameters:n,dto:s})=>(0,u.forkJoin)({result:e.saveAction(s,n),dto:(0,u.of)(s)})),(0,c.tap)(({result:n,dto:s})=>e.onSavedAction(s,n)),(0,c.map)(({result:n})=>n))}))}_checkDataSourceName(e){if(!e)throw new Error("Data source name is not provided")}innerSave(e,t,n){return(0,u.from)(this.waitAsyncTasksFinish()).pipe((0,c.switchMap)(()=>(this._checkDataSourceName(n),this.getModelMode(n)===z.Delete?t():e())))}initDependencies(){this.formBuilder=this.injector.get(Z.FormBuilder),this.resourceFinderService=this.injector.get(mi),this.validatorTypeResolver=this.injector.get(Nm),this.maskService=this.injector.get(z_),this.sysSettingsService=this.injector.get(kt),this.crtControlStateAdapter=this.injector.get(ws),this._businessRulesEngine=this.injector.get(Er),this._businessRulesApplier=this.injector.get(Dr),this._featureValues=this.injector.get(oe),this._modelGenerator=this.injector.get(Dl),this._ngZone=this.injector.get(i.NgZone),this._translateService=this.injector.get(v.TranslateService),this._scopeName=this.injector.get($c,null),this._attributeGenerator=this.injector.get(Rr),this._attributeResourceGenerator=this.injector.get(Lr),this._crtZoneService=this.injector.get(Cl),this._viewEventZoneName=this.injector.get(Kf,Mi.Root),this._modelParametersBuilder=this.injector.get(so),this._context=this.injector.get(Xf,null),this._crtInjectionContextService=this.injector.get(Ts),this._viewModelDataDelayerService=this.injector.get(Uy,null),this._isDesignTime=this.injector.get(gi,null),this._measurePerformanceService=this.injector.get(Ie.g,null),this._measurePerformancePageLoadService=this.injector.get(Ar),this._appInfo=this.injector.get(dt,null)}processRequest(e){return this.handlerChain.process(e)}runInitFlow(e=null){return this._concatModelsWithEmbedded(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitFlow.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,c.tap)(t=>this._notifyAboutModelsErrors(t)),(0,c.tap)(t=>this._models$.next(t)),(0,c.tap)(()=>this._initFeaturesStates()),(0,c.mergeMap)(()=>this._generateDataSourcesInfo()),(0,c.tap)(t=>this._updateModels(t)),(0,c.mergeMap)(t=>this._generateAttributesToDataSourceNameMap(t)),(0,c.mergeMap)(t=>this._getDataSchemas()),(0,c.tap)(t=>this.dataSchemas=t),(0,c.mergeMap)(()=>this._initDataSourceValidators()),(0,c.switchMap)(()=>this._initBusinessRules()),(0,c.tap)(()=>{this._initSchemaValidators(this.viewModelConfig.attributes)}),(0,c.mergeMap)(()=>(0,u.forkJoin)([...this._generateResourceAttribute(),this._initSystemAttributes(),this._attributeGenerate(this.viewModelConfig.attributes),(0,u.of)(this),this._initSubscriptions()])),(0,c.mergeMap)(()=>this._generatePrimaryAttributes()),(0,c.tap)(()=>this._loadDefaultSorting()),(0,c.mergeMap)(()=>this._runInitialBusinessRules()),(0,c.tap)(()=>this._viewModelAttributeChangeEventOptions.reset())).pipe((0,c.switchMap)(()=>(0,u.of)(this)))}[vm](e){return this._attributeConfigs[e]?.isValueMasked??!1}[$_](e){return this.getAttributePropertyValue(e,ld)}[G_](e){return this.getAttributePropertyValue(e,ud)}[Q_](e,t){this.setAttributePropertyValue(e,bl,t)}[J_](e){return this.getAttributePropertyValue(e,bl)||dd.Unmasked}init(e,t){return this._primaryModelName=t?.primaryModelName,this._modelDependencies=t?.modelDependencies||{},this._modelsLoadingConfig=t?.modelsLoadingConfig||{},this._lastEventLoadParameters=new Map,t?.businessRulesActive||this.deactivateBusinessRules(),this._modelDependencies&&this._handleCircularDependencies(),this._ngZone.runOutsideAngular(()=>this.runInitFlow(e))}setValue(e,t){const n=[],s=[];for(const r of Object.keys(this._attributeConfigs))"viewModelConfig"in this._attributeConfigs[r]||"viewModelName"in this._attributeConfigs[r]?s.push(r):n.push(r);return this._executeWithOptions(()=>{this._measurePerformanceService.measure(`ViewModel.setValue.updateViewModelModelAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.data.${Object.keys(e).toString()}`,()=>{for(const r in e)n.includes(r)&&(this._resetMaskDataForAttribute(r),this.set(r,e[r],{isMaskedValue:t?.isMaskedValue}))})},t),Pr.deferUpdatingValueAndValidity(this,()=>this._setSubmodelValues(s,e,t),this._featureValues)}deactivateBusinessRules(){this._businessRulesActive=!1}activateBusinessRules(){const e=this._businessRulesActive;if(this._businessRulesActive=!0,e)return(0,u.of)(null);const t=this.models.filter(n=>n.isLoaded);if(t.length>0){const n={type:Me.ContextReady,name:null,scopeId:""};return(0,u.forkJoin)(t.map(s=>this._runBusinessRulesForModel(s,[],!0,[n]))).pipe((0,c.tap)(()=>this._businessRulesAreActivated=this._businessRulesProcessingEnabled),(0,c.tap)(()=>this._businessRulesActivated$.next(this._businessRulesAreActivated)))}}_getDependOnModelsNames(e){const t=this._modelDependencies[e];if(!t)return[];const n=t.map(s=>s.relationPath.split(".")[0]);return[...new Set(n)]}_getModelDependencies(e){return this._modelDependencies[e]??[]}_getIsAffectedByBusinessRules(e){if(!this._businessRulesProcessingEnabled)return Promise.resolve(!1);const t=e.name,n=this._attributesAffectedByBusinessRules;if(n.length===0||!t)return Promise.resolve(!1);const s=n.some(d=>d.name===t),r=this.getBoundDataSchemaByAttributePath(t),o=this.getBoundDataSchemaAttributeByAttributePath(t);if(!o)return Promise.resolve(s);const l=n.filter(d=>d.scopeName===r.name).some(d=>d.name===o.name);return Promise.resolve(l||s)}executeRequest(e){return e.scopes=e.scopes||this._eventScopes,this._crtZoneService.runInZone(this._viewEventZoneName,()=>this.processRequest(e))}getAttributeControl(e){let t=this.formApiModel;_r(this,e).then(T.noop);for(const n of e.split("."))t=t.get(n);return t??new Z.FormControl}loadLookupList(e,t=[],n){const s=e.control,r=e.items,o=this._getDataSourceInfoByViewModelAttributePath(r);if(o){const l=this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.LoadDataRequest",$context:this,dataSourceName:o.name,parameters:t,config:{payload:n}}));Promise.resolve(l)}else{const l=this._getDataSourceInfoByViewModelAttributePath(s);if(l){const d=l.getDataSourceAttributePath(s);(0,u.forkJoin)([this._getDropdownPageSize(),this._modelParametersBuilder.getModelParameters(this,t,n)]).pipe((0,c.mergeMap)(([h,f])=>this.getModelByName(l.name).loadLookupList(d,f,h)),(0,c.map)(h=>In.getLookupListDataSourceInfo(r,{value:h.primaryAttributeName,displayValue:h.primaryDisplayAttributeName}).getModelDto(h.data)),(0,c.mergeMap)(h=>this.setValue(h,{silent:!0}))).subscribe()}}}load(...e){const t=this._disableViewModelLoadUnblockingThread?(0,u.of)(null):(0,u.timer)(0,u.asyncScheduler),n=typeof e[0]=="string"?this._staticLoader(e):this._dynamicLoader(e);return t.pipe((0,c.switchMap)(()=>this.__destroyed?(0,u.of)([]):n))}setSorting(e,t){const s=this._dataSourcesInfos.get(e).getSortingConfig(),r=s&&s.attributeName;return r&&(this[r]=t),(0,u.of)(null)}create(e,t){return this._checkDataSourceName(e),this._createModelData(e,t)}copy(e,t,n){return this._checkDataSourceName(e),this._copyModelData(e,t,n)}loadDefaultValues(e){return this._setAttributesDefaultValues(e)}save(e,t,n){return this.innerSave(()=>this._saveModel(e,t,n),()=>this.delete(e,t,n),e)}delete(e,t,n){return this._checkDataSourceName(e),this.deleteModel(e,t,(s,r)=>this.getModelByName(s).delete(r),n)}resume(){return(0,u.of)(void 0)}pause(){return(0,u.of)(void 0)}destroy(){this._subscriptions.unsubscribe(),Array.from(this._collectionSubscription.values()).forEach(t=>t.unsubscribe()),this._collectionSubscription.clear(),this._crtControls.forEach(t=>{t.destroy()}),this.models?.forEach(t=>t.destroy()),this._crtControls.clear(),this._eventsSubject$.complete(),this._replayEvents$.complete(),this._modelLoaded$.complete();const e=[];for(const t of Object.values(this.attributes))t instanceof bn&&e.push(t.destroy()),t instanceof ft&&e.push((0,u.from)(t.destroy()));return(0,u.forkJoin)(e).pipe((0,c.defaultIfEmpty)(void 0),(0,c.map)(()=>{}),(0,c.finalize)(()=>{this.parent||(this._crtInjectionContextService.removeContext(this._injectionContext?.id),lf(this._injectionContext),this._context=null,this._viewModelDataDelayerService?.destroy(),this._viewModelDataDelayerService=null),this._asyncTasksExecutingSubject.complete(),this._dataSourcesInfos.clear(),this.__destroyed=!0,this._destroySubject.next(),this._destroySubject.complete()}))}getBoundDataSourceName(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(t!==null)return t;if(!e)return null;const n=this._findAttributePathInDataSourceNameMap(e);return this.getBoundDataSourceNameByAttributePath(n)}getBoundDataSourceAttributeControls(e){return Object.values(this._getBoundDataSourceAttributeControls(e))}getBoundDataSourceNameByAttributePath(e){return this._attributesToDataSourceNameMap.get(e)??null}getBoundDataSchema(e){return this.dataSchemas[this.getBoundDataSourceName(e)]}getBoundDataSchemaByAttributePath(e){return this.dataSchemas[this.getBoundDataSourceNameByAttributePath(e)]??null}getBoundDataSchemaAttributeByAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e),n=this.getBoundDataSchemaByAttributePath(e),s=this._getDataSourceInfoByViewModelAttributePath(e);if(!t||!n||!s)return null;const r=s.getDataSourceAttributePath(e);return n.findAttributeByName(r)}getPrimaryModelName(){return Promise.resolve(this._primaryModelName)}getPrimaryDataSchema(){return this.getPrimaryModelName().then(e=>this.dataSchemas[e])}isValid(e){const t=this._waitAsyncValidation().pipe((0,c.map)(()=>e?this.getBoundDataSourceAttributeControls(e).every(n=>!n.invalid):this.formApiModel.valid));return(0,u.lastValueFrom)(t)}validate(e){return this._ngZone.run(()=>e?this._validateByDataSourceName(e):this._validateAll())}getViewModelAttributePath(e,t){const n=this._dataSourcesInfos.get(e);return this._getMappedAttributeName(n,t)}getViewModelAttributePaths(e,t){return this._dataSourcesInfos.get(e)?.getMappedAttributeNames(t)}getCollectionViewModelAttributePath(e){return this._dataSourcesInfos.get(e)?.collectionViewModelAttributeName}canDelete(e,t){var n=this;return(0,S.A)(function*(){return n.getModelByName(e).canDelete(t)})()}canSave(e,t){var n=this;return(0,S.A)(function*(){return n.getModelByName(e).canSave(t)})()}enableAttributeValidator(e,t){this.getControl(e).enableValidator(t)}disableAttributeValidator(e,t){this.getControl(e).disableValidator(t)}_hotSwap(e){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap`,()=>{const t=e?.attributes?.changed||[],n=(0,T.isEmpty)(e.resources?.strings);if((0,T.isEmpty)(t)&&n)return(0,u.of)(!1);n||(this.resources={strings:this._getChangedResourcesStrings(e.resources.strings)}),this.viewModelConfig=e.actualViewModelConfig;const s=In.getFromViewModelConfig(this.viewModelConfig),r=Object.fromEntries(t.map(I=>[I,this.viewModelConfig.attributes[I]])),o=e?.models?.changed??[],l=o.map(I=>I.name),d=this.models.filter(I=>I.isLoaded||I.isLoading).filter(I=>l.includes(I.name)).map(I=>I.name),h=o.map(I=>{const O=s.get(I.name);return this._upsertModel(I.name,I),this._replaceDataSourceInfo(I.name,O),this._addDataSchemaToDataSchemas(I)}),f=this._attributeGenerate$(r,{disableDefaultConfig:!0});return(0,u.forkJoin)([...h,f]).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap.forkJoin`),(0,c.switchMap)(()=>this._reGenerateResourcesAttributes()),(0,c.tap)(()=>this._loadDefaultSorting(l)),(0,c.tap)(()=>this._requestReloadModels(d)),(0,c.map)(()=>!0))})}set(e,t,n){return this._setAttributeValue(e,t,n),Promise.resolve()}_markAsPristine(e){this._forEachControl(e,t=>{t.markAsPristine()})}getAttributeNameByViewItemName(e){return Object.keys(this._attributeConfigs).find(t=>this._attributeConfigs[t].viewItemName===e)}getControl(e){return this._crtControls.has(e)?this._crtControls.get(e):Il.create({name:e,value:null,propertiesConfig:[],featureValues:this._featureValues})}getAttributePropertyValue(...e){let t,n;if(e.length===2)t=e[0],n=e[1];else if(e.length===1){const r=e[0].split(":");t=r[0],n=r[1]}else throw new Error("ArgumentException");return this.getControl(t).getPropertyValue(n)}setAttributePropertyValue(...e){let t,n,s;if(e.length===3)t=e[0],n=e[1],s=e[2];else if(e.length===2){const o=e[0].split(":");t=o[0],n=o[1],s=e[1]}else throw new Error("ArgumentException");return this.getControl(t).setPropertyValue(n,s)}resetAttributePropertyValue(...e){let t,n;if(e.length===1)[t,n]=e[0].split(":");else if(e.length===2)t=e[0],n=e[1];else throw new Error("ArgumentException");this.getControl(t).getPropertyByName(n)?.resetValue()}getInvariabilityPropertyName(e){return this.getControl(e).getInvariabilityPropertyName()}setModelValues(e,t){return this.getModelByName(e).setValue(t)}_getBoundAttributesNames(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(!t)return null;const n=this._dataSourcesInfos.get(t),s=n.attributesMap.get(e);return Array.from(n.attributesMap.entries()).filter(([r,o])=>o===s&&r!==e).map(([r])=>r)}_getAttributeDataValueTypeName(e){return this._attributeConfigs[e].dataValueTypeName}getDataSourceLoadParameters(e,t){const n=this._dataSourcesInfos.get(e);return n?this._modelParametersBuilder.getModelLoadParameters(this,n,[],ve.Load,{modelLoadConfiguration:t}).then(([s,r,o,l])=>({parameters:s,options:{pagingConfig:r,sortingConfig:o,hierarchyConfig:l}})):null}getAttributeViewModelConfig(e){return this._attributeConfigs[e]?.viewModelConfig?.attributes}isDataSourceForCollection(e){return!!this._dataSourcesInfos.get(e)?.isCollection}_getDataSourceAttributeDataValueType(e){const t=this._getDataSourceInfoByViewModelAttributePath(e);let n=null;if(t){const s=t.getDataSourceAttributePath(e);s&&(n=this._getDataSourceAttributeSchema(t,s)?.dataValueType)}return n}_getModelNamesByLoadType(e){return Object.entries(this._modelsLoadingConfig).filter(([t,n])=>n.type===e).map(([t,n])=>t)}_reloadDependentModels(e,t=[],n=null){const s=this._getDependentModelsForLoad(e,t);this._requestReloadModels(s.filter(r=>{const o=Ii(this.getModelByName(r));return!n||o&&n===$t.Page||!o&&n===$t.ViewElement}))}_getDependentModelsForLoad(e,t=[]){const n=this._getDependentModelsNames(e.name,t),s=this._getChangedModelsNames(n).filter(r=>!Ii(this.getModelByName(r)));return s.length!==0&&this._showNotification({message:"BaseViewModel.RefreshModelDataConflict"}),n.filter(r=>!s.includes(r)).filter(r=>this._modelsRequestedToLoad.has(r)||Ii(this.getModelByName(r)))}_getDataSourceAttributeCaption(e,t){let n=this.resourceFinderService.findLocalizableValue(t);const s=this._getDataSourceInfoByViewModelAttributePath(e);if(n==null&&s){const r=s.getDataSourceAttributePath(e),o=r?this._getDataSourceAttributeSchema(s,r):"";n=o?o.caption:this._translateService.instant("BaseViewModel.DataSourceAttributeRemoved")}return n}getIsDirty(e){return this.getControl(e).isDirty}getModelByName(e){return this._modelsMap.get(e)}getModelMode(e){return this.getModelByName(e)?.mode}getPrimaryModelMode(){return this.getModelMode(this._primaryModelName)}_getModelModeChanges(e){return this.getModelByName(e)?._modeChanges$}_getPrimaryModelModeChanges(){return this._getModelModeChanges(this._primaryModelName)}markModelFor(e,t){this.getModelByName(e)?.markFor(t)}markPrimaryModelFor(e){this.markModelFor(this._primaryModelName,e)}_setStateAttribute(e){this._setSystemAttributeValue(Tl,e)}_onAsyncTaskStarted(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.add(e),this._asyncTasksExecutingSubject.next(t)}_onAsyncTaskFinished(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.delete(e),this._asyncTasksExecutingSubject.next(t)}waitAsyncTasksFinish(){let e;return(0,u.firstValueFrom)(this._asyncTasksExecutingSubject.pipe((0,c.tap)(t=>{clearTimeout(e),e=this._handleAsyncTasksCycle(t)}),(0,c.filter)(t=>t.size===0),(0,c.take)(1),(0,c.map)(()=>{})))}destroyModel(e){const t=this.getModelByName(e);t&&t.destroy();const n=this.models.filter(s=>s.name!==e);this._models$.next(n),this._dataSourcesInfos.delete(e),[...this._attributesToDataSourceNameMap.entries()].filter(([s,r])=>e===r).forEach(([s])=>this._attributesToDataSourceNameMap.delete(s))}}class Jn extends Wt{_getViewModelCollectionValue(e,t){if(!t.length)return Promise.resolve(e);const n=Array.from(e).map(s=>this._getObjectProp(s,t));return Promise.all(n)}_getObjectProp(e,t){var n=this;return(0,S.A)(function*(){const s=t.shift();return s?(e=yield e[s],e instanceof bn?n._getObjectProp(e,t):e instanceof ft?n._getViewModelCollectionValue(e,t):n._getObjectProp(e,t)):e})()}evaluate(e,t){const n=e.slice(1);return Lu(n,t).pipe((0,c.map)(s=>s??{context:yr(t),contextPath:""}),(0,c.switchMap)(s=>(0,u.combineLatest)([s.context.viewModel$,(0,u.of)(Fu(s.contextPath,n))])),(0,c.switchMap)(([s,r])=>s?this._getObjectProp(s,r.split(".")):(0,u.of)(null)),(0,c.take)(1))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Jn)))(n||Jn)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Jn,factory:Jn.\u0275fac})}}class Ps{_getStringValue(e){return e.match(/^'(.*)'$/)[1]}_getBooleanValue(e){if(e==="true")return!0;if(e==="false")return!1;throw new Error(`${e} is not Boolean value`)}evaluate(e){if(Bp(e))return(0,u.of)(this._getStringValue(e));if(Up(e))return(0,u.of)(parseFloat(e));if(Hp(e))return(0,u.of)(this._getBooleanValue(e));throw new Error(`Failed to parse primitive value binding expression: ${e}`)}static{this.\u0275fac=function(t){return new(t||Ps)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ps,factory:Ps.\u0275fac})}}class qn extends Cr{constructor(e,t,n,s=!1){super(),this._convertersRegistry=e,this._objectPropBindingExpressionInterpreter=t,this._fixedValueBindingExpressionInterpreter=n,this._isDesignTime=s}_evaluateParam(e,t){if(a_(e))return this._fixedValueBindingExpressionInterpreter.evaluate(e);if(Lt(e))return this._objectPropBindingExpressionInterpreter.evaluate(e,t);throw new Error(`Cannot parse parameter expression: ${e}`)}_evaluateParams(e,t){const n=e.map(s=>this._evaluateParam(s,t).pipe((0,c.first)()));return(0,u.forkJoin)(n).pipe((0,c.defaultIfEmpty)([]))}_getConverters(e,t){return e.split("|").map(s=>s.trim()).map(s=>{const[r,...o]=s.split(":").map(h=>h.trim()),l=this._evaluateParams(o,t),d=t.viewModel$.pipe((0,c.first)());return(0,u.forkJoin)([d,l]).pipe((0,c.map)(([h,f])=>I=>{if(!h)return null;const O=h._injectionContext;return this._convertersRegistry.get(r,O).convert(I,h,...f)}))})}_applyConverters(e,t){for(const[n,s]of Object.entries(t))if(e=s(e),e instanceof Promise){const r=parseInt(n,10)+1;return this._applyAsyncConverters(e,[...t].slice(r))}return e}_applyAsyncConverters(e,t){return(0,S.A)(function*(){let n=yield e;for(const s of t)n=s(n),n instanceof Promise&&(n=yield n);return n})()}evaluate(e,t){if(this._isDesignTime||(0,T.isEmpty)(e))return(0,u.of)(s=>s);const n=this._getConverters(e,t);return(0,u.forkJoin)(n).pipe((0,c.map)(s=>r=>this._applyConverters(r,s)))}static{this.\u0275fac=function(t){return new(t||qn)(i.\u0275\u0275inject(Mr),i.\u0275\u0275inject(Jn),i.\u0275\u0275inject(Ps),i.\u0275\u0275inject(gi,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:qn,factory:qn.\u0275fac})}}class Ni{constructor(e,t,n,s){this._attributeBindingExpressionInterpreter=e,this._attributePropertyBindingExpressionInterpreter=t,this._resourceBindingExpressionInterpreter=n,this._converterExpressionInterpreter=s}_applyConverter(e,t){return(0,S.A)(function*(){return e=t(e),e instanceof Promise&&(e=yield e),e})()}evaluateInputValueExpression(e,t){return zp(e)?this._resourceBindingExpressionInterpreter.evaluate(e,t):Fp(e)?this._attributePropertyBindingExpressionInterpreter.evaluate(e,t):this._attributeBindingExpressionInterpreter.evaluate(e,t)}evaluate(e,t){const n=/\|(.*)/,[s,r]=e.split(n).map(d=>d.trim()),o=this.evaluateInputValueExpression(s,t),l=this._converterExpressionInterpreter.evaluate(r,t);return o.pipe((0,c.switchMap)(d=>l.pipe((0,c.switchMap)(h=>this._applyConverter(d,h)))))}static{this.\u0275fac=function(t){return new(t||Ni)(i.\u0275\u0275inject(Wt),i.\u0275\u0275inject(_s),i.\u0275\u0275inject(ys),i.\u0275\u0275inject(qn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ni,factory:Ni.\u0275fac})}}class ks extends Ni{constructor(e,t){super(null,null,null,t),this._objectPropBindingExpressionInterpreter=e}_evaluateEventBindingExpression(e,t){const n=t.initialEvent,s=e.replace(/@event\.?/,"");return(0,u.of)(s?(0,T.get)(n,s):n)}evaluateInputValueExpression(e,t){return Vu(e)?this._evaluateEventBindingExpression(e,t):this._objectPropBindingExpressionInterpreter.evaluate(e,t)}static{this.\u0275fac=function(t){return new(t||ks)(i.\u0275\u0275inject(Jn),i.\u0275\u0275inject(qn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ks,factory:ks.\u0275fac})}}class js{constructor(e){this._requestParamBindingExpressionInterceptor=e}_evaluate(e,t){var n=this;return(0,S.A)(function*(){const s={};for(const[r,o]of Object.entries(e))s[r]=yield n._evaluateConfigValue(o,t);return s})()}_evaluateConfigValue(e,t){return Array.isArray(e)?Promise.all(e.map(n=>this._evaluateConfigValue(n,t))):Lt(e)||Vu(e)?(0,u.lastValueFrom)(this._requestParamBindingExpressionInterceptor.evaluate(e,t),{defaultValue:null}):e&&typeof e=="object"?this._evaluate(e,t):Promise.resolve(e)}evaluate(e,t){return(0,u.from)(this._evaluate(e,t))}static{this.\u0275fac=function(t){return new(t||js)(i.\u0275\u0275inject(ks))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:js,factory:js.\u0275fac})}}class Rs{constructor(e){this._requestParamsBindingConfigInterpreter=e}_evaluateParams(e,t){return e?this._requestParamsBindingConfigInterpreter.evaluate(e,t):(0,u.of)({})}_getRequestBindingContext(e,t){return e.useRelativeContext?t:yr(t)}evaluate(e,t){return this._evaluateParams(e.params,t).pipe((0,c.withLatestFrom)(this._getRequestBindingContext(e,t).viewModel$),(0,c.map)(([n,s])=>({type:e.request,$context:s,...n})),(0,c.first)())}static{this.\u0275fac=function(t){return new(t||Rs)(i.\u0275\u0275inject(js))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Rs,factory:Rs.\u0275fac})}}class Ei extends Wt{_getValidationStateChanges(e,t){const n=t.attributeHost.getAttributeControl(t.attributeName);return(0,u.merge)(e,n.statusChanges).pipe((0,c.map)(()=>({value:n.value,validationInfo:(0,T.pick)(n,"valid","errors","dirty","touched")})),(0,c.distinctUntilChanged)(T.isEqual))}evaluate(e,t){const n=e.slice(1);return this.getAttributeLocationChanges(n,t).pipe((0,c.switchMap)(s=>s.attributeHost?this._getValidationStateChanges(super.evaluate(e,t),s):(0,u.of)({value:null,validationInfo:{valid:!0,errors:null,dirty:!1,touched:!1}})))}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Ei)))(n||Ei)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ei,factory:Ei.\u0275fac})}}const Qm=[Wt,_s,fi,Ni,qn,Jn,Ps,Rs,ks,js,ys,Ei,P.gX.create({token:qf,mappings:[{predicate:"converter",injectable:qn}]})],Al=new i.InjectionToken("CRT_BINDING_CONTEXT"),Jm=new i.InjectionToken("CRT_BINDING_CONTEXT_DESIGN_TIME"),Zy=a=>({viewModel$:a.viewModel$,parent:a.parent}),Wy=(a,e)=>{const t=new u.ReplaySubject(1);return t.next(null),(a.viewModel$??e?.viewModel$)?.subscribe(t),{viewModel$:t.asObservable(),parent:a.viewModel$?e:e?.parent,viewModelSubject:t}};class Di{set viewModel(e){(e instanceof bn||e===void 0||e===null)&&(this.viewModel$?this.viewModel$.next(e):(this.viewModel$=new u.ReplaySubject(1),this.viewModel$.next(e)))}ngOnDestroy(){this.viewModel=null,this.viewModel$?.complete()}static{this.\u0275fac=function(t){return new(t||Di)}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Di,selectors:[["","crtViewModel",""]],inputs:{viewModel:[0,"crtViewModel","viewModel"]},features:[i.\u0275\u0275ProvidersFeature([{provide:Al,useFactory:Zy,deps:[[new i.Inject(Jm),new i.Self]],multi:!1},{provide:Jm,useFactory:Wy,deps:[(0,i.forwardRef)(()=>Di),[new i.Inject(Al),new i.SkipSelf,new i.Optional]],multi:!1}])]})}}var $y=m(94123);class Gy{static{this._addItemListeners=[]}static{this._removeItemListeners=[]}static{this._requestHandlersMap=new Map}static{this._handlersByRequestMap=new Map}static get requestHandlersMap(){return this._requestHandlersMap}static get handlersByRequestMap(){return this._handlersByRequestMap}static onAddRequestHandler(e){return this._addItemListeners.push(e),()=>{this._addItemListeners.splice(this._addItemListeners.indexOf(e),1)}}static onRemoveRequestHandler(e){return this._removeItemListeners.push(e),()=>{this._removeItemListeners.splice(this._removeItemListeners.indexOf(e),1)}}static addRequestHandler(e,t){const n=this._requestHandlersMap.get(e);if(n&&(!n.instanceConfig?.lazy||n.instanceType))return;const s={instanceType:t.instanceType,instanceConfig:{...n?.instanceConfig??{},...t.instanceConfig}};this._requestHandlersMap.set(e,s);for(const l of this._addItemListeners)l(e,s);const r=t.instanceConfig.requestType;let o=this._handlersByRequestMap.get(r);o||(o=new Map,this._handlersByRequestMap.set(r,o)),o.set(e,s)}static removeRequestHandler(e){const t=this._requestHandlersMap.get(e);if(!t)return;this._requestHandlersMap.delete(e);for(const r of this._removeItemListeners)r(e,t);const n=t.instanceConfig.requestType,s=this._handlersByRequestMap.get(n);s&&s.delete(e)}static clear(){for(const e of this._requestHandlersMap.keys())this.removeRequestHandler(e)}}const ao=window;ao.creatio??={},ao.creatio.requestHandlerRegistry||Object.defineProperty(ao.creatio,"requestHandlerRegistry",{get:()=>Gy,configurable:!1});const Qy=ao.creatio.requestHandlerRegistry;class Od{static{this._internalRegistry=ao.creatio.requestHandlerRegistry}static find(e){return Od._internalRegistry.requestHandlersMap.get(e)}static register(e,t){const n=e.requestType,s=e.type;if(!n)throw new Error(`Error when register ${s}. Request type not specified.`);const r={instanceType:t,instanceConfig:e};Od._internalRegistry.addRequestHandler(s,r)}}class Mv{}const Jy="ValidatorRegistry";class Ol extends ce{static{this.registryKey=Jy}static _hasWithAnotherTypeRef(e,t){const n=Ol.items.get(e);return!n||n.lazy&&!n.typeRef?!1:n.typeRef!==t}static validate(e){if(Un(e.type,"ValidatorTypeName"),e.typeRef&&Ol._hasWithAnotherTypeRef(e.type,e.typeRef))throw new Error(`Error when register ${e.type}. Element with this type has already exist`)}static get items(){return this.store.typeInfos}static register(e){const t=this.items.get(e.type);this.items.set(e.type,{...t??{},...e})}}const qy="InterfaceDesignerItemRegistry";class Ky extends ce{static get _interfaceDesignerItemRegistrationInfos(){return this.store.typeInfos}static validate(e){Un(e.type,"InterfaceDesignerItemTypeName"),Qc(e.type),$p(e.type,e,this._interfaceDesignerItemRegistrationInfos)}static register(e,t){if(typeof e=="string"&&t)this._interfaceDesignerItemRegistrationInfos.set(e,t);else if(typeof e!="string")this._interfaceDesignerItemRegistrationInfos.set(e.type,e);else throw new Error("Invalid arguments provided to register method.")}static get(e){return this._interfaceDesignerItemRegistrationInfos.get(e)}static has(e){return this._interfaceDesignerItemRegistrationInfos.has(e)}static getAll(){return this._interfaceDesignerItemRegistrationInfos}static values(){return[...this._interfaceDesignerItemRegistrationInfos.values()]}static clear(){this._interfaceDesignerItemRegistrationInfos.clear()}}class Xy extends Ky{static{this.registryKey=qy}}class ro{constructor(){this.registry=Xy}get(e){return this.registry.get(e)}getInternal(e){return this.registry.get(e)}register(e,t){this.registry.register(e,t)}getAll(){return this.registry.getAll()}has(e){return this.registry.has(e)}values(){return this.registry.values()}clear(){this.registry.clear()}static{this.\u0275fac=function(t){return new(t||ro)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ro,factory:ro.\u0275fac})}}class eC extends ce{static validate(e){Un(e.type,"ViewElementTypeName");const t=this.viewElements.get(e.type);t?.lazy&&!("selector"in t)&&!t.typeRef||$p(e.type,e,this.viewElements)}static get viewElements(){return this.store.typeInfos}static register(e){const t=this.viewElements.get(e.type);this.viewElements.set(e.type,{...t??{},...e})}static getFormControlRelatesAttribute(e){const t=this.store.typeInfos.get(e);return t&&"formControlConfig"in t&&t.formControlConfig?.relatesTo||null}static getValuePropertyName(e){const t=this.store.typeInfos.get(e);return t&&"valuePropertyName"in t&&t.valuePropertyName||null}static getViewElementInputs(e){return this.store.typeInfos.get(e)?.inputs??{}}static getViewElementOutputs(e){return this.store.typeInfos.get(e)?.outputs??{}}static getViewElementPropertiesDefaultValues(e){const t=this.store.typeInfos.get(e);return[...Object.entries(t?.inputs??{}).filter(([s,r])=>Object.prototype.hasOwnProperty.call(r,"defaultValue")).map(([s,r])=>({name:s,defaultValue:r.defaultValue})),{name:"visible",defaultValue:!0}]}static getViewElementCompatiblePlatformAPIsOptions(e,t){return this.store.typeInfos.get(e)?.compatibleAPIs?.[t]??{}}static isViewElementAvailableByCompatibleAPIs(e,...t){const n=this.store.typeInfos.get(e);return Object.entries(n?.compatibleAPIs??{}).filter(([s,r])=>t.includes(s)).some(([s,r])=>typeof r=="boolean"?r:(r||{}).enable)}}const tC="ViewElementRegistry";class Pl extends eC{static{this.registryKey=tC}}class nC{canResolve(e){return this.registry.viewElements.has(e)}getViewElementRegistryItem(e){return this.registry.viewElements.get(e)}isViewElementAvailableByCompatibleAPIs(e,...t){return this.registry.isViewElementAvailableByCompatibleAPIs(e,...t)}getViewElementCompatiblePlatformAPIsOptions(e,t){return this.registry.getViewElementCompatiblePlatformAPIsOptions(e,t)}getFormControlRelatesAttribute(e){return this.registry.getFormControlRelatesAttribute(e)}getValuePropertyName(e){return this.registry.getValuePropertyName(e)||this.getFormControlRelatesAttribute(e)}getViewElementInputs(e){return this.registry.getViewElementInputs(e)}getViewElementOutputs(e){return this.registry.getViewElementOutputs(e)}getViewElementPropertiesDefaultValues(e){return this.registry.getViewElementPropertiesDefaultValues(e)}getViewElementType(e){const t=this.getViewElementRegistryItem(e.type);return this.getViewElementTypeByRegistryItem(t)}getCrtInputs(e){return this.getViewElementRegistryItem(e)?.inputs}getSelector(e){const t=this.getViewElementRegistryItem(e);return this.getSelectorByRegistryItem(t)}getSelectorByRegistryItem(e){return e&&"selector"in e?e.selector:null}getViewElementTypeByRegistryItem(e){return e&&"typeRef"in e?e.typeRef:null}}class ze extends nC{constructor(){super(...arguments),this.registry=Pl}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ze)))(n||ze)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ze,factory:ze.\u0275fac})}}function iC(a,e){if(typeof a=="string"){const t=a.startsWith("$"),n=a.slice(1).split(".").pop()||"",s=e?.[n]!=null;return t&&s}return!1}class oo{constructor(){this._designerResolver=(0,i.inject)(ro),this._viewResolver=(0,i.inject)(ze),this._viewElementContentSlotsCache=new Map}_getViewConfigInfo(e,t,n,s,r){const o=[];if(Array.isArray(n))for(let l=0;l<n.length;l++){const d=n[l];t.includes(d[e])&&o.push({viewConfig:d,parentName:s,index:l,parentPropertyName:r}),this.getViewElementContentSlots(d.type)?.forEach(f=>{const I=d[f];if(I){const O=this._getViewConfigInfo(e,t,I,d.name,f);o.push(...O)}})}return o}_getViewConfigInfoByFilter(e,t,n,s){const r=[];if(Array.isArray(t))for(let o=0;o<t.length;o++){const l=t[o];e(l)&&r.push({viewConfig:l,parentName:n,index:o,parentPropertyName:s}),this.getViewElementContentSlots(l.type)?.forEach(h=>{const f=l[h];if(f){const I=this._getViewConfigInfoByFilter(e,f,l.name,h);r.push(...I)}})}return r}_getViewConfigsBindingMap(e,t,n){const s=new Map;if(Array.isArray(e))for(let r=0;r<e.length;r++){const o=e[r],l=this._viewResolver.getValuePropertyName(o.type),d=o[l]??"";if(d.startsWith("$")){const f=d.substring(1),I={viewConfig:o,parentName:t,index:r,parentPropertyName:n};s.has(f)?s.get(f).push(I):s.set(f,[I])}this.getViewElementContentSlots(o.type)?.forEach(f=>{const I=o[f];I&&this._getViewConfigsBindingMap(I,o.name,f).forEach((B,J)=>{s.has(J)?s.get(J).push(...B):s.set(J,B)})})}return s}_isViewModelAttributeBound(e,t){if(!t)return!1;const n=e.viewConfig,s=`\\W\\$${t}\\W`;return this._isAttributeUseInConfig(n,s)}_isViewModelAttributeBoundInViewModel(e,t){if(!t)return!1;const n=(0,T.cloneDeep)(this.getViewModelConfig(e));n.attributes=n.attributes||{},delete n?.attributes[t];const s=`\\W${t}\\W`;return this._isAttributeUseInConfig(n,s)}_isAttributeUseInConfig(e,t){const n=JSON.stringify(e);return new RegExp(t).test(n)}_findViewConfigItem(e,t,n){if(n(t))return e.push(t),!0;const s=this.getViewElementContentSlots(t.type);for(const r of s){const o=t[r];if(o){for(const l of o)if(this._findViewConfigItem(e,l,n))return e.push(t),!0}}}_getViewConfigArray(e){return e?Array.isArray(e)?e:[e]:[]}_getCollectionPropertyNames(e){return this._designerResolver.get(e)?.collectionPropertyNames||["items"]}_getContentSlots(e){const t=[];return this._viewResolver.getViewElementRegistryItem(e)?.contentSlots?.forEach(s=>{if(typeof s=="string")t.push(s);else{const r=s?.name;t.push(r)}}),t}_getPossibleResourceValues(e){return[`#ResourceString(${e})#`]}getViewElementContentSlots(e){if(this._viewElementContentSlotsCache.has(e))return this._viewElementContentSlotsCache.get(e);const t=this._getContentSlots(e),n=this._getCollectionPropertyNames(e),s=[...new Set([...t,...n])];return this._viewElementContentSlotsCache.set(e,s),s}getViewConfigPathByPropertyValue(e,t,n){const s=[],r=this._getViewConfigArray(n);for(const o of r)if(this._findViewConfigItem(s,o,l=>l[e]===t))break;return s}getViewConfigInfoByPropertyForValues(e,t,n){const s=[],r=this._getViewConfigArray(n);for(let o=0;o<r.length;o++){const l=r[o];t.includes(l[e])&&s.push({viewConfig:l,index:o}),this.getViewElementContentSlots(l.type)?.forEach(h=>{const f=l[h];if(f){const I=this._getViewConfigInfo(e,t,f,l.name,h);s.push(...I)}})}return s}getViewConfigInfoByProperty(e,t,n){return this.getViewConfigInfoByPropertyForValues(e,[t],n)}getViewConfigInfoByType(e,t){return this.getViewConfigInfoByProperty("type",t,e).map(n=>n?.viewConfig).filter(Boolean)}getViewConfigInfoByFilter(e,t){const n=[],s=t??[];for(let r=0;r<s.length;r++){const o=s[r];e(o)&&n.push({viewConfig:o,index:r}),this.getViewElementContentSlots(o.type)?.forEach(d=>{const h=o[d];if(h){const f=this._getViewConfigInfoByFilter(e,h,o.name,d);n.push(...f)}})}return n}getViewConfigsBindingMap(e){return this._getViewConfigsBindingMap(e??[],"","")}getViewModelAttribute(e,t){return this.getViewModelConfig(e)?.attributes?.[t]}getViewConfigInfoByName(e,t){return this.getViewConfigInfoByProperty("name",t,e?.viewConfig)[0]||{}}getViewModelConfig(e,t=!1){return!e.viewModelConfig&&t&&(e.viewModelConfig={}),e.viewModelConfig||{}}isViewModelAttributeBound(e,t){return t?this._isViewModelAttributeBound(e,t)||this._isViewModelAttributeBoundInViewModel(e,t):!1}addViewModelAttributeChangeRequest(e,t){const{attributeName:n,requests:s,options:r}=t??{};if(!n||!s?.length)return;const o=!!r?.createAttributeIfEmpty,l=this.getViewModelConfig(e,o);if(!l?.attributes&&!o)return;const d=l.attributes??={};if(!d[n]&&!o)return;const h=d[n]??={};h.change??=[],Array.isArray(h.change)||(h.change=[h.change]),h.change.push(...s)}findResourceDependencies(e,t){const n=this._getPossibleResourceValues(e),s={viewElements:[],attributes:[]},r=(o,l)=>{o&&(typeof o=="string"?n.forEach(d=>{o.includes(d)&&s.viewElements.push(l)}):Array.isArray(o)?o.forEach(d=>r(d,l)):typeof o=="object"&&Object.values(o).forEach(d=>r(d,l)))};return Object.entries(t).forEach(([o,l])=>r(l,o)),s}getDependentModelsNames(e,t,n){return Object.entries(e||{}).filter(([,r])=>{let o=t;return n&&(o=`${t}.${n}`),r.some(l=>l.relationPath.startsWith(o))}).map(([r])=>r)}getDataSourceModelName(e,t){return e?.dataSources?.[t]?.config?.entitySchemaName}findAllAttributesByDataSourceAttributePath(e,t){const n=this.getViewModelConfig(e,!0).attributes??{},s=Object.keys(n).filter(o=>{const l=n[o]??{};return Tm(l)&&l.modelConfig?.path===t});if(s.length>0)return s;const r=t.split(".");if(r.length>2){const o=r[0],d=e?.modelConfig?.dataSources?.[o]?.config?.attributes;if(d){const h=r.slice(1).join("."),f=Object.keys(d).find(I=>d[I].path===h);if(f)return this.findAllAttributesByDataSourceAttributePath(e,`${o}.${f}`)}}return[]}getLoadParametersByDataSourceName(e,t){return t.modelConfig?.dataSources?.[e]?.config?.loadParameters}getSortingConfigByDataSourceName(e,t){return this.getLoadParametersByDataSourceName(e,t)?.options?.sortingConfig}getCollectionViewConfigs(e,t){return t?.length?this.getViewConfigInfoByPropertyForValues("type",t,e.viewConfig).filter(n=>!!n).map(({viewConfig:n})=>n).filter(({name:n})=>n)||[]:[]}getCollectionViewConfigsWithItemsBinding(e,t){return this.getCollectionViewConfigs(e,t).filter(({items:n})=>iC(n,e.viewModelConfig?.attributes))}getRequestBindingConfigs(e,t,n){const s=[];return t===void 0||this.getViewConfigInfoByFilter(r=>{const o=Object.values(r).filter(l=>{const d=l;return d?.request===t&&(n?n(d):!0)});return s.push(...o),!1},e),s}findAllAttributesByDataSource(e,t){const n=this.getViewModelConfig(e,!0).attributes;return typeof n=="object"?Object.keys(n).filter(s=>{const r=n[s];return Tm(r)&&r.modelConfig?.path?.startsWith(t)}):[]}static{this.\u0275fac=function(t){return new(t||oo)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:oo,factory:oo.\u0275fac})}}class qm{constructor(){this.viewElements=new Set,this.requests=new Set,this.converters=new Set,this.validators=new Set}}class co{constructor(){this._metadataSchemaUtils=(0,i.inject)(oo),this._viewElementTypeResolver=(0,i.inject)(ze)}_forEachStringInObject(e,t,n=[]){for(const s in e){const r=e[s];typeof r=="string"?t(n.concat(s),r):typeof r=="object"&&r!==null&&(n.push(s),this._forEachStringInObject(r,t,n),n.pop())}}_searchInContentSlots(e,t,n){const s=this._metadataSchemaUtils.getViewElementContentSlots(e.type)??[];for(const r of s){const o=e[r];Array.isArray(o)&&this._searchInViewConfig(e[r]??[],n)}}_searchInBindingExpression(e,t){zu(e).converters?.forEach(n=>t.converters.add(n.type))}_searchInRequestConfig(e,t){const n=Array.isArray(e)?e:[e];for(const s of n)t.requests.add(s.request),s.params&&this._forEachStringInObject(s.params,(r,o)=>{Lt(o)&&this._searchInBindingExpression(o,t)})}_searchInViewConfig(e,t){for(const n of e){t.viewElements.add(n.type);const s=this._viewElementTypeResolver.getViewElementRegistryItem(n.type);if(s)for(const[r,o]of Object.entries(n))s.inputs&&r in s.inputs&&Lt(o)&&this._searchInBindingExpression(o,t),o&&s.outputs&&r in s.outputs&&this._searchInRequestConfig(o,t);this._searchInContentSlots(n,s,t)}}_searchInValidatorsConfig(e,t){for(const n of Object.values(e))t.validators.add(n.type)}_searchInViewModelConfig(e,t){if("attributes"in e)for(const n of Object.values(e.attributes))"change"in n&&this._searchInRequestConfig(n.change,t),"validators"in n&&this._searchInValidatorsConfig(n.validators,t),"viewModelConfig"in n&&this._searchInViewModelConfig(n.viewModelConfig,t),"converter"in n&&this._searchInBindingExpression("$value | "+n.converter,t)}*_getRequestHandlersMetadata(e){for(const t of e){const n=Qy.handlersByRequestMap.get(t);if(n)for(const s of n.values())yield s}}_addModuleRefIfLazy(e,t,n){t?.lazy&&(!n||n(t))&&e.add(t.lazyModuleRef)}getUsedItemsInSchema(e){const t=new qm;return this._searchInViewConfig(e.viewConfig??[],t),this._searchInViewModelConfig(e.viewModelConfig??{},t),t}getUsedItemsInViewConfig(...e){const t=new qm;return this._searchInViewConfig(e,t),t}getUsedViewElements(e){return this.getUsedItemsInViewConfig(...e).viewElements}getLazyModuleRefs(e,t){const n=new Set,{viewElements:s,requests:r,converters:o,validators:l}=e;for(const f of s)this._addModuleRefIfLazy(n,this._viewElementTypeResolver.getViewElementRegistryItem(f));for(const f of o)this._addModuleRefIfLazy(n,Gp.find(f));for(const f of l)this._addModuleRefIfLazy(n,Ol.items.get(f));const d=this._getRequestHandlersMetadata(r),h=t?.requestScopes?f=>vp(f.scopes,t.requestScopes):void 0;for(const f of d)this._addModuleRefIfLazy(n,f.instanceConfig,h);return n}static{this.\u0275fac=function(t){return new(t||co)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:co,factory:co.\u0275fac})}}function sC(a){const e=new u.Subscription;for(const t of a)e.add(t);return e}class ke{constructor(e=new u.Subscription,t=Promise.resolve()){this._subscription=e,this.ready=t}static all(e){const t=sC(e.map(s=>s._subscription)),n=Promise.all(e.map(s=>s.ready)).then(()=>{});return new ke(t,n)}static subscribe(e,t,n=!1){e=e.pipe((0,c.share)());const s=e.subscribe({next:t}),r=n?(0,u.lastValueFrom)(e.pipe((0,c.first)(),(0,c.map)(()=>{})),{defaultValue:null}):Promise.resolve();return new ke(s,r)}unsubscribe(){this._subscription.unsubscribe()}}const Pd="Change",kl="ValidationInfo";function kd(a,e){return!!Pl.viewElements.get(a)?.inputs?.[e]}function jd(a,e){return!!Pl.viewElements.get(a)?.outputs?.[e]}function Iv(a,e){return!!ViewElementRegistry.viewElements.get(a)?.validationInputs?.[e]}function Rd(a){return a+Pd}function bv(a,e){const t=Rd(e);return jd(a,t)}function aC(a){return a+kl}function Km(a,e){const t=e+kl;return!!Pl.viewElements.get(a)?.validationInputs?.[t]}function rC(a){let e=null;if(a.endsWith(Pd))e=a.replace(new RegExp(Pd+"$"),"");else if(a.endsWith(kl))e=a.replace(new RegExp(kl+"$"),"");else return null;return e}function Sv(a,e){const t=rC(e);return!!t&&kd(a,t)}function Xm(a,e){return Ld.apply(this,arguments)}function Ld(){return Ld=(0,S.A)(function*(a,e){const t=Lu(a,e),n=yield(0,u.firstValueFrom)(t,{defaultValue:null});if(!n)return null;const s=yield(0,u.firstValueFrom)(n.context.viewModel$);if(!s)return null;const r=Fu(n.contextPath,a);return yield Yp(s,r)}),Ld.apply(this,arguments)}function oC(a,e,t){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,S.A)(function*(a,e,t){const n=yield Xm(a,t);if(!n)return;const{attributeHost:s,attributeName:r}=n;s.getAttributeControl(r).markAsDirty(),s[r]=e}),Vd.apply(this,arguments)}function cC(a,e){return zd.apply(this,arguments)}function zd(){return zd=(0,S.A)(function*(a,e){const t=yield Xm(a,e);if(!t)return;const{attributeHost:n,attributeName:s}=t,r=n.getAttributeControl(s);r.touched||(r.markAsTouched(),r.updateValueAndValidity())}),zd.apply(this,arguments)}const eg="bindTo";class tg{constructor(e){this.injector=e,this._loadingAttributeName="loading",this.bindingExpressionInterpreter=e.get(Ni),this.attrCtrlExpInterpreter=e.get(fi),this.requestBindingConfigInterpreter=e.get(Rs),this.validationBindingInterpreter=e.get(Ei),this._bindingContext=e.get(Al,null),this._macrosHandlerService=e.get(hs),this._isDesignTime=e.get(gi,!1);const t=e.get(oe);this._isSafeBinding=!t.DisableSafePropertiesBinding,this._viewElementTypeResolver=e.get(ze)}_useMacros(e,t){if(!this._bindingContext)return t(e);let n;const s=new u.Subject,r=this._bindingContext.viewModel$.pipe((0,c.switchMap)(o=>this._macrosHandlerService.handleResourceMacros(e,o)),(0,c.map)((o,l)=>{n?.unsubscribe(),n=t(o),l===0&&n.ready.then(()=>{s.next(),s.complete()})}),(0,c.finalize)(()=>n?.unsubscribe())).subscribe();return new ke(r,(0,u.lastValueFrom)(s,{defaultValue:null}))}_bindLoadingProperty(e,t){if(Object.keys(e).some(l=>l===this._loadingAttributeName))return new ke;const s=(0,T.chain)(e).entries().filter(([l,d])=>this.isInputBinding(l,d,t,e)&&Lt(d)).value();if(!s.length)return new ke;const r=s.map(([l,d])=>r_(d)),o=yr(this._bindingContext).viewModel$.pipe((0,c.switchMap)(l=>{if(!l)return(0,u.of)();let d=[];const h=l.events$.pipe((0,c.filter)(I=>I.type===Ne.StartLoadModelAttributes),(0,c.filter)(I=>{const O=Object.keys(I.payload);return r.some(B=>O.includes(B))}),(0,c.tap)(I=>{d=Object.keys(I.payload)}),(0,c.tap)(()=>t.setPropertyValue("loading",!0))),f=l.events$.pipe((0,c.filter)(I=>I.type===Ne.FinishLoadModelAttributes),(0,c.filter)(I=>{const O=Object.keys(I.payload);return d.every(B=>O.includes(B))}),(0,c.tap)(()=>t.setPropertyValue("loading",!1)),(0,c.tap)(()=>d=[]));return(0,u.merge)(h,f)})).subscribe();return new ke(o)}_isControlProperty(e,t){const n=this._viewElementTypeResolver.getFormControlRelatesAttribute(t.type);return e===n}_getViewElementInputProperties(e){const t=this._viewElementTypeResolver.getViewElementRegistryItem(e.type);return t?[...Object.keys(t.inputs??{}).filter(n=>t.inputs[n].propertyBindable)]:["visible"]}_getViewElementEntries(e,t){const n=this._viewElementTypeResolver.getFormControlRelatesAttribute(t.type),s=e.find(([o])=>o===eg);let r=e.filter(([o])=>o!==eg);if(s){const[,o]=s;if(!o)return r;this._getViewElementInputProperties(t).forEach(d=>{if(d!==n){let h=o;h=`${h}:${d}`;const f=t[d];f!=null&&(h+=`=${f}`),r=r.filter(([I])=>I!==d),r.push([d,h])}})}return r}_bindInputWithValidation(e,t,n){const s=this.validationBindingInterpreter.evaluate(t,this._bindingContext).pipe((0,c.startWith)(null),(0,u.pairwise)()),r=aC(e),o=([l,d])=>{l?.value!==d?.value&&n.setPropertyValue(e,d.value),n.setPropertyValue(r,d?.validationInfo)};return ke.subscribe(s,o)}_bindFocusout(e,t){const n=t.getEvent("focusout"),s=e.slice(1),r=()=>cC(s,this._bindingContext);return ke.subscribe(n,r)}_bindInputs(e,t){const[n,s]=(0,T.chain)(e).entries().filter(([d,h])=>this.isInputBinding(d,h,t,e)&&!this.isTwoWayBinding(d,h,t,e)).partition(([,d])=>Lt(d)).value();s.forEach(([d,h])=>{h=this._isControlProperty(d,e)?new Z.FormControl(h):h,t.setPropertyValue(d,h)});const o=this._getViewElementEntries(n,e).map(([d,h])=>{const O=(this._isControlProperty(d,e)?this.attrCtrlExpInterpreter:this.bindingExpressionInterpreter).evaluate(h,this._bindingContext);if(Km(e.type,d)&&Gc(h))return this._bindInputWithValidation(d,h,t);{const B=J=>t.setPropertyValue(d,J);return ke.subscribe(O,B,!1)}}),l=this._bindLoadingProperty(e,t);return ke.all([...o,l])}_createRequest(e,t){const n={...this._bindingContext,initialEvent:t};return this.requestBindingConfigInterpreter.evaluate(e,n).pipe((0,c.map)(s=>({...s,$initialEvent:t})))}_bindOutputSafely(e,t,n){const s=e.getEvent(t),r=yr(this._bindingContext).viewModel$.pipe((0,c.switchMap)(l=>l._destroy$)),o=l=>(0,u.lastValueFrom)(this._createRequest(n,l).pipe((0,c.switchMap)(d=>d.$context.executeRequest(d)),(0,c.takeUntil)(r))).catch(()=>null);return ke.subscribe(s,o)}_bindOutputUnsafely(e,t,n){const s=e.getEvent(t).pipe((0,c.switchMap)(o=>this._createRequest(n,o))),r=o=>o.$context.executeRequest(o);return ke.subscribe(s,r)}_bindOutput(e,t,n){return this._isSafeBinding?this._bindOutputSafely(e,t,n):this._bindOutputUnsafely(e,t,n)}_bindOutputs(e,t){const s=Object.entries(e).filter(([r,o])=>this.isOutputBinding(r,o,t,e)).map(([r,o])=>this._bindOutput(t,r,o));return ke.all(s)}_bindTwoWays(e,t){const n=Object.entries(e).filter(([r,o])=>this.isTwoWayBinding(r,o,t,e)),s=[];return n.forEach(([r,o])=>{const l=this.bindingExpressionInterpreter.evaluate(o,this._bindingContext),d=te=>t.setPropertyValue(r,te);Km(e.type,r)&&Gc(o)?s.push(this._bindInputWithValidation(r,o,t)):s.push(ke.subscribe(l,d));const h=o.slice(1),f=Rd(r),I=this.getViewEventsStream(t,f),O=te=>oC(h,te,this._bindingContext),B=ke.subscribe(I,O);s.push(B);const J=this._bindFocusout(o,t);s.push(J)}),ke.all(s)}isInputBinding(e,t,n,s){return kd(s.type,e)}isOutputBinding(e,t,n,s){return jd(s.type,e)}isTwoWayBinding(e,t,n,s){const r=Rd(e);return Gc(t)&&kd(s.type,e)&&jd(s.type,r)&&!(r in s)}bind(e,t){const n=s=>ke.all([this._bindInputs(s,e),this._bindOutputs(s,e),this._bindTwoWays(s,e)]);return this._isDesignTime?this._useMacros(t,n):n(t)}}class ng extends tg{isInputBinding(e,t,n,s){return super.isInputBinding(e,t,n,s)||!this.isOutputBinding(e,t,n,s)}isOutputBinding(e,t,n,s){return super.isOutputBinding(e,t,n,s)||n.getPropertyValue(e)instanceof i.EventEmitter}getViewEventsStream(e,t){return e.getEvent(t)}}class ig{constructor(e,t,n,s,r,o,l){this._componentRef=e,this._inputs=t,this._ngZone=s,this._changeDetectorRef=r,this.nativeElement=o,this.hostView=l,this._propertyValues=new Map,this.instance=n;const d=this._componentRef.injector.get(oe,null);this._enableInstanceValueSetFeature=d?.["ComponentViewElementRef.EnableInstanceValueSet"]}setValue(e,t){if(this._inputs?.[e])this._componentRef.setInput(e,t);else if(this._enableInstanceValueSetFeature)(0,T.set)(this.instance,e,t);else{const n=["selected","layoutConfig","dragging","currentLayoutConfig"];if(e in this.instance&&!n.includes(e)){const s=this._componentRef.componentType.name;let r=`Can't set value of the '${e}' input on the '${s}' component. `;r+=`Make sure that the '${e}' property is annotated with @Input() or a mapped @Input('${e}') exists.`,console.error(r)}}this._changeDetectorRef.detectChanges()}getPropertyValue(e){return(0,T.get)(this.instance,e)}getEvent(e){const t=this.getPropertyValue(e);return!t&&this.nativeElement?(0,u.fromEvent)(this.nativeElement,e):t}on(e,t){const s=this.getEvent(e).subscribe(t);return()=>{s.unsubscribe()}}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this._ngZone.run(()=>this.setValue(e,t)))}destroy(){this.hostView?.destroy(),this._componentRef?.destroy(),this.nativeElement=null}}class lC{constructor(e,t){this._ngZone=t,this._propertyValues=new Map,this.instance=e}setValue(e,t){(0,T.set)(this.instance,e,t)}getPropertyValue(e){return(0,T.get)(this.instance,e)}getEvent(e){return this.getPropertyValue(e)}on(e,t){const s=this.getPropertyValue(e).subscribe(t);return()=>{s.unsubscribe()}}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this._ngZone.run(()=>this.setValue(e,t)))}destroy(){this.instance=null}}var Sn;(function(a){a.Default="default",a.OnViewport="on-viewport"})(Sn||(Sn={}));class uC extends tg{getViewEventsStream(e,t){return e.getEvent(t).pipe((0,u.map)(n=>n.detail))}}var vn=m(32667);class sg{constructor(e){this.injector=e}}const Ls=new i.InjectionToken("CRT_VIEW_ELEMENT_CONFIG");class dC{constructor(e){this._propertyValues=new Map,this.instance=e}getPropertyValue(e){return this.instance[e]}getEvent(e){return(0,u.fromEvent)(this.instance,e)}on(e,t){return this.instance.addEventListener(e,t),()=>this.instance.removeEventListener(e,t)}setPropertyValue(e,t){(!this._propertyValues.has(e)||t!==this._propertyValues.get(e))&&(this._propertyValues.set(e,t),this.instance[e]=t)}destroy(){}}class hC extends sg{createComponent(e){const t=this.injector.get(ze),n=this.injector.get(i.Renderer2),s=this.injector.get(i.ViewContainerRef),r=this.injector.get(Ls),o=t.getSelector(r.type),l=document.createElement(o);return e?.forEach(({name:d,value:h})=>{n.setAttribute(l,d,h)}),n.appendChild(s.element.nativeElement.parentElement,l),this._initDirectionality(l),new dC(l)}_initDirectionality(e){this.injector.get(vn.Directionality)?.value==="rtl"&&e.setAttribute("dir","rtl")}}class ag extends sg{createComponent(e){const t=this.injector.get(ze),n=this.injector.get(Ls),s=t.getViewElementType(n);if(!s)throw new Error(`Component for type ${n.type} not found`);const r=this.injector.get(i.ViewContainerRef),o=this.injector.get(i.Renderer2),l=t.getCrtInputs(n.type),d=r.createComponent(s,{index:0,injector:this.injector});e?.forEach(({name:O,value:B})=>{o.setAttribute(d.location.nativeElement,O,B)});const h=d.injector.get(i.ChangeDetectorRef),f=d.injector.get(i.ElementRef).nativeElement;d.changeDetectorRef.detectChanges();const I=this.injector.get(i.NgZone);return new ig(d,l,d.instance,I,h,f,d.hostView)}}class pC{}const rg=new i.InjectionToken("VIEW_ELEMENT_COMPONENT_CREATOR");class og extends pC{constructor(e){super(),this.injector=e,this.viewElementConfig=this.injector.get(Ls),this.featureValues=this.injector.get(oe,{optional:!0}),this.measurePerformanceService=this.injector.get(Ie.g),this._componentCreator=this.injector.get(rg)}_getElementName(){return`${this.viewElementConfig.type.split(".")?.[1]} ${this.viewElementConfig.name}`}_getDOMAttributes(){const e=[];return this.featureValues?.UseViewElementDataItemMarker&&e.push({name:"data-item-marker",value:this.viewElementConfig.dataItemMarker||this.viewElementConfig.name}),e}createComponent(e){return this._componentCreator.createComponent(e)}getComponentRef(){const e=this._getElementName(),t=this._getDOMAttributes();return this.measurePerformanceService.measure(e,()=>this.createComponent(t))}show(){const e=this.getComponentRef();return(0,u.of)(e)}hide(){}}class mC extends og{constructor(e,t,n){super(e),this.injector=e,this._creator=t,this._destroyed=n,this._renderer=this.injector.get(i.Renderer2),this._container=this.injector.get(i.ViewContainerRef),this._resolver=this.injector.get(ze),this._initMinHeight(),this._subscribeDestroyed()}get _parentElement(){return this._container.element.nativeElement.parentElement}_handleIntersection(e,t){if(this._parentElement){if(e&&!this._componentRef?.hostView){this._initResizeObservable(),t.next(this.getComponentRef()),t.complete();return}this._componentRef?.hostView&&(e?this._showElement():this._hideElement())}}_initIntersectionObserver(e){let t=this.viewElementConfig.selected;this._intersectionObserver=new IntersectionObserver(n=>{n.forEach(s=>{t?t=!1:this._handleIntersection(s.isIntersecting,e)})}),this._intersectionObserver.observe(this._parentElement),t&&this._handleIntersection(!0,e)}_initResizeObservable(){this._resizeObserver||(this._resizeObserver=new ResizeObserver(e=>{const{height:t,width:n}=e[0].contentRect;this._minHeight=`${t}px`,this._minWidth=`${n}px`}),this._resizeObserver.observe(this._parentElement))}_showElement(){this._display?this._renderer.setStyle(this._componentRef.nativeElement,"display",this._display):this._renderer.removeStyle(this._componentRef.nativeElement,"display"),this._removeMinSize()}_hideElement(){this._applyMinSize(),this._display=this._componentRef.nativeElement?.style.display,this._renderer.setStyle(this._componentRef.nativeElement,"display","none")}_removeMinSize(){this._renderer.removeStyle(this._parentElement,"min-height"),this._minWidth&&this._renderer.removeStyle(this._parentElement,"min-width")}_applyMinSize(){this._renderer.setStyle(this._parentElement,"min-height",this._minHeight),this._minWidth&&this._renderer.setStyle(this._parentElement,"min-width",this._minWidth)}_initMinHeight(){const e=this._resolver.getViewElementRegistryItem(this.viewElementConfig.type);e?e.renderStrategy===Sn.OnViewport&&(this._minHeight=e.placeholderSize.height):console.warn(`View element with type "${this.viewElementConfig.type}" not found`)}_subscribeDestroyed(){this._destroyed?.subscribe(()=>{const e=this._componentRef?.hostView;e&&!e.destroyed&&(e.detach(),e.destroy()),this._componentRef&&(this._componentRef.instance=null),this._componentRef=null,this._container.detach(),this._container.clear(),this._container=null,this._resizeObserver?.disconnect(),this._intersectionObserver?.disconnect()})}createComponent(e){return this._componentRef=this._creator.createComponent(e),this._removeMinSize(),this._componentRef}show(){return this._applyMinSize(),new u.Observable(e=>{this._initIntersectionObserver(e)})}hide(){this._resizeObserver?.disconnect(),this._intersectionObserver?.disconnect()}}const cg=new i.InjectionToken("COMPONENT_PROPERTIES_BINDER"),lg=new i.InjectionToken("DIRECTIVE_PROPERTIES_BINDER"),ug=new i.InjectionToken("VIEW_ELEMENT_RENDER_STRATEGY"),Fd=new i.InjectionToken("VIEW_ELEMENT_RENDER_STRATEGY_VALUE"),gC=function(a){const e=a.get(Ls);return a.get(ze).getSelector(e.type)},Bd=function(a){return!!gC(a)},fC=function(a){return a.get(oe,{optional:!0})},_C=function(a){return a.get(gi,!1)},yC=function(a){return Bd(a)?new uC(a):new ng(a)},CC=function(a){return Bd(a)?new hC(a):new ag(a)},MC=function(a,e){const t=a.get(Fd)||Sn.Default,s={[Sn.Default]:dg,[Sn.OnViewport]:vC}[t];if(!s)throw new Error(`Unsupported render strategy type: ${t}`);return s(a,e)},IC=function(a,e){return a||e},dg=function(a){return new og(a)},bC=function(a){return fC(a).UseLazyComponentCreationInDesignTime},SC=function(a){const e=a.get(Ls);return a.get(ze).getViewElementRegistryItem(e.type)?.renderStrategy===Sn.Default},vC=function(a,e){const t=SC(a),n=bC(a),s=Bd(a),r=!_C(a);return t||s||r||!n?dg(a):new mC(a,new ag(a),e)},TC=new i.InjectionToken("Ignore view elements not found warning");class xt{constructor(e,t,n,s,r,o){this._resolver=e,this.parentDirective=t,this.injector=n,this._container=s,this._isDesignTime=r,this._ngZone=o,this._ownProperties=[{property:"visible",defaultValue:!0,omitForViewModelBinding:!0},{property:"bindTo",defaultValue:null,omitForViewModelBinding:!1}],this._destroyed$=new u.Subject,this._showElementSubscription=new u.Subscription,this._bindingContext=null,this._isCreating=!1,this._visible=!1,this._schemaAnalysisUtils=(0,i.inject)(co),this._componentRefSubject=new u.ReplaySubject(1),this._visibilitySubject=new u.ReplaySubject(1),this.visibilityChanged=(0,$y.outputFromObservable)(this._visibilitySubject.asObservable().pipe((0,c.distinctUntilChanged)(),(0,c.takeUntil)(this._destroyed$))),this.componentRef$=this._componentRefSubject.asObservable().pipe((0,c.distinctUntilChanged)(),(0,c.takeUntil)(this._destroyed$)),this.nested=[],this.total=0,this.viewElementShow=new i.EventEmitter,this._featureValues=(0,i.inject)(oe,{optional:!0}),this._shouldLoadLazyModules=!this._featureValues.DisableLoadingLazyModulesFromViewElementDirective,this._measurePerformanceService=(0,i.inject)(Ie.g),this._directiveRef=new lC(this,this._ngZone)}get visible(){return this._visible}set visible(e){this._visible=e,this._setViewElementVisibility(e||this._isDesignTime)}_bindSelfToViewModel(){const e=this._ownProperties.reduce((t,{property:n,defaultValue:s})=>({...t,[n]:this.viewElementConfig[n]??s}),{});this._ngZone.runOutsideAngular(()=>this.bindDirectiveProperties(e))}_bindComponentToViewModel(){const e=(0,T.omit)(this.viewElementConfig,...this._ownProperties.filter(({omitForViewModelBinding:t})=>t===!0).map(({property:t})=>t));this._ngZone.runOutsideAngular(()=>this.bindComponentProperties(e))}_setViewElementVisibility(e){e&&!this.componentRef?this._showViewElement():!e&&this.componentRef&&this._hideViewElement(),this._visibilitySubject.next(!!e)}_setComponentRef(e){this.componentRef=e,this._componentRefSubject.next(e)}_showViewElement(){const e=this.viewElementConfig.type;if(this._typeName=e,!!this._typeName)if(this._resolver.canResolve(e))this._showComponent();else{if(this.injector.get(TC,!1))return;const n=this._container.createComponent(fs);n.instance.caption=e;const s=n.injector.get(i.ElementRef).nativeElement,r=this._resolver.getCrtInputs(e);console.warn(`View element with type "${e}" not found`),this._setComponentRef(new ig(n,r,n.instance,this._ngZone,n.changeDetectorRef,s,n.hostView))}}_getLazyModuleRefs(e){return this._measurePerformanceService.measure("ViewElementDirective.SEARCHING_SCHEMA_LAZY_ITEMS",()=>{const t=this._schemaAnalysisUtils.getUsedItemsInViewConfig(this.viewElementConfig);return this._schemaAnalysisUtils.getLazyModuleRefs(t,{requestScopes:e?._scopes})})}_getInjectionContext(e){const t=e;return t._injectionContext||Or(t)._injectionContext}_addLazyModulesToContext(e,t){const n=this._getInjectionContext(e);for(const s of t)n.addLazyModule(s);xp(n)}_loadLazyModules(){return this._shouldLoadLazyModules?this._featureValues.DisableFreedomUiLazyLoading?(0,u.from)(w.instance.loadAll()):(this._bindingContext?.viewModel$??(0,u.of)(null)).pipe((0,c.switchMap)(t=>{const n=this._getLazyModuleRefs(t);if(n.size===0||t?._destroyed)return(0,u.of)(void 0);const s=(0,u.from)(Promise.all(Array.from(n,r=>r.loadAndBootstrap())));return t?s.pipe((0,c.map)(r=>Sp(r)),(0,c.tap)(r=>this._addLazyModulesToContext(t,r))):s}),(0,c.take)(1),this._measurePerformanceService.measure$("ViewElementDirective.LOADING_SCHEMA_LAZY_ITEMS")):(0,u.of)(void 0)}_showComponent(){this._isCreating||(this._isCreating=!0,this._renderStrategyInstance&&this._renderStrategyInstance.hide(),this._renderStrategyInstance=this.injector.get(ug),this._showElementSubscription.add(this._loadLazyModules().pipe((0,c.switchMap)(()=>this._renderStrategyInstance.show()),(0,c.filter)(e=>!!e)).subscribe(e=>{this._setComponentRef(e),this._measurePerformanceService.measure(`binding ${this.viewElementConfig.name}`,()=>this._bindComponentToViewModel()),this.viewElementShow.emit(this),this._isCreating=!1,this._featureValues?.UseMeasurePerformanceTools&&this._measurePerformanceService.rendering$.next()})))}_hideViewElement(){this._componentBinding?.unsubscribe(),this._showElementSubscription.unsubscribe(),this._renderStrategyInstance.hide(),this._container.clear(),this.componentRef?.destroy(),this._setComponentRef(null)}bindDirectiveProperties(e){this._directiveBinding?.unsubscribe(),this._directiveBinding=this._directivePropertiesBinder.bind(this._directiveRef,e)}bindComponentProperties(e){this._componentBinding?.unsubscribe(),this.componentRef&&(this._componentBinding=this._componentPropertiesBinder.bind(this.componentRef,e))}updateViewElementConfig(e){this.viewElementConfig=e,this._bindSelfToViewModel(),this._bindComponentToViewModel()}ngOnInit(){this._shouldLoadLazyModules&&(this._bindingContext=this.injector.get(Al,null)),this._directivePropertiesBinder=this.injector.get(lg),this._componentPropertiesBinder=this.injector.get(cg),this.parentDirective&&this.parentDirective.attachNested(this),this._bindSelfToViewModel()}attachNested(e){this.nested.push(e)}detachNested(e){this.nested.splice(this.nested.indexOf(e),1)}ngOnDestroy(){this.parentDirective&&this.parentDirective.detachNested(this),this.nested.forEach(e=>e.ngOnDestroy()),this.componentRef?.destroy(),this._setComponentRef(null),this.viewElementConfig=null,this._componentBinding?.unsubscribe(),this._directiveBinding?.unsubscribe(),this._showElementSubscription.unsubscribe(),this._container.clear(),this._directiveRef.destroy(),this._renderStrategyInstance=null,this._componentRefSubject.complete(),this._visibilitySubject.complete(),this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||xt)(i.\u0275\u0275directiveInject(ze),i.\u0275\u0275directiveInject(xt,12),i.\u0275\u0275directiveInject(i.Injector),i.\u0275\u0275directiveInject(i.ViewContainerRef),i.\u0275\u0275directiveInject(gi,8),i.\u0275\u0275directiveInject(i.NgZone))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:xt,selectors:[["","crtViewElement",""]],inputs:{viewElementConfig:[0,"crtViewElement","viewElementConfig"],renderStrategy:"renderStrategy",visible:"visible"},outputs:{visibilityChanged:"visibilityChanged",viewElementShow:"viewElementShow"},features:[i.\u0275\u0275ProvidersFeature([{provide:Ls,useFactory:e=>e.viewElementConfig,deps:[(0,i.forwardRef)(()=>xt)],multi:!1},{provide:cg,useFactory:yC,deps:[i.Injector],multi:!1},{provide:lg,useFactory:e=>new ng(e),deps:[i.Injector],multi:!1},{provide:rg,useFactory:CC,deps:[i.Injector],multi:!1},{provide:Fd,useFactory:(e,t)=>IC(e.renderStrategy,t),deps:[(0,i.forwardRef)(()=>xt),[new i.Inject(Fd),new i.SkipSelf,new i.Optional]],multi:!1},{provide:ug,useFactory:(e,t)=>MC(e,t._destroyed$),deps:[i.Injector,(0,i.forwardRef)(()=>xt)],multi:!1},...Qm])]})}}class lo{constructor(){this._viewElementTypeResolver=(0,i.inject)(ze)}_updateAttributeProperties(e,t,n,s){const r=e[t]||{},o={};s.forEach(h=>{let f=h.defaultValue;Object.prototype.hasOwnProperty.call(n,h.name)&&(f=n[h.name]??h.defaultValue),o[h.name]={defaultValue:f}});const l=this._viewElementTypeResolver.getViewElementInputs(n.type);Object.entries(l).filter(([,h])=>h.propertyName!=null).forEach(([h,f])=>{o[f.propertyName]={defaultValue:h,locked:!0}}),r.properties={...r.properties??{},...o}}updateAttributeProperties(e,t,n){const s=e.bindTo.replace("$",""),r=t?.viewModelConfig?.attributes||{};this._updateAttributeProperties(r,s,e,n)}updateCollectionAttributeProperties(e,t,n,s){const r=e.bindTo.replace(`${n}.`,""),o=n.replace("$",""),d=(t?.viewModelConfig?.attributes||{})[o];if(!d)return;const h=d?.viewModelConfig?.attributes;h&&this._updateAttributeProperties(h,r,e,s)}static{this.\u0275fac=function(t){return new(t||lo)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:lo,factory:lo.\u0275fac})}}const hg="bindTo",xC="visible";class uo{constructor(){this._viewElementTypeResolver=(0,i.inject)(ze)}_getViewElementInputProperties(e){const t=this._viewElementTypeResolver.getViewElementRegistryItem(e.type);return[...Object.keys(t.inputs??{}).filter(n=>t.inputs[n].propertyBindable),xC]}createLayoutConfigComponentParts(e,t,n){for(const[s,r]of Object.entries(t))n.attributes["layout-config-"+(0,T.kebabCase)(s)]={value:r}}createVisibleComponentPartsWrapper(e,t,n,s){const r=Lt(t);let o=t;const l=[];r&&(o=t,l.push({name:"crtBinding",arguments:[{value:e,propertyKey:this.getContextPropertyName(e+"|propertyName",n)},{value:s,propertyKey:this.getContextPropertyName(e+"|viewElementConfig",n)}]}));const d=n.directives.find(h=>h.selector==="crtIf");if(d)d.values.unshift({propertyKey:this.getContextPropertyName(e,n),value:o,pipes:l});else{const h={values:[{propertyKey:this.getContextPropertyName(e,n),value:o,pipes:l}],selector:"crtIf",useAsterisk:!0};this.addCrtIfDirectiveAdditionalInputs(h,s),n.directives.push(h)}return n}getContextPropertyName(e,t){return t.name+":"+e}getViewElementEntries(e){const t=this._viewElementTypeResolver.getFormControlRelatesAttribute(e.type),n=Object.entries(e),s=n.find(([o])=>o===hg);let r=n.filter(([o])=>o!==hg);if(s){const o=this._getViewElementInputProperties(e),[,l]=s;o.forEach(d=>{if(d!==t){const h=e[d];if(h==null||typeof h!="string"||typeof h=="string"&&!h.includes("|")){let f=l;f=`${f}:${d}`,h!=null&&(f+=`=${JSON.stringify(h)}`),r=r.filter(([I])=>I!==d),r.push([d,f])}}})}return r}addCrtIfDirectiveAdditionalInputs(e,{visibilityStrategyMode:t}){if(!t)return;const n=e.additionalInputs||[];n.push({propertyKey:"visibilityStrategyMode",value:t}),e.additionalInputs=[...n]}static{this.\u0275fac=function(t){return new(t||uo)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:uo,factory:uo.\u0275fac})}}class Vs{static{this.\u0275fac=function(t){return new(t||Vs)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Vs})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[ze,lo,uo,...Qm],imports:[b.CommonModule,gs,Bn,Bn]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Vs,{declarations:[Di,xt],imports:[b.CommonModule,gs,Bn],exports:[Di,xt,Bn]})})();class zs{constructor(e,t){this._document=e,this.http=t}_getDownloadFileUrl(e){const t=new Blob([e],{type:"octet/stream"});return window.URL.createObjectURL(t)}_getDownloadFileName(e){const t=e.headers.get("Content-Disposition");return t?t.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/)[1]:null}download(e,t){const n=this._getDownloadFileUrl(e);this.downloadFromUrl(n,t)}downloadFromResponse(e,t){t=t||this._getDownloadFileName(e),this.download(e.body,t)}downloadFromUrl(e,t){const n=this._document,s=n.createElement("a");s.href=e,s.download=t,n.body.appendChild(s),s.click(),s.remove()}downloadFromUrlViaHttp(e,t){return e?new Promise((n,s)=>{this.http.get(e,{responseType:"blob",observe:"response",withCredentials:!0}).subscribe({next:r=>{this.downloadFromResponse(r,t),n()},error:r=>s(r)})}):Promise.reject(new Error("url is required"))}static{this.\u0275fac=function(t){return new(t||zs)(i.\u0275\u0275inject(b.DOCUMENT),i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:zs,factory:zs.\u0275fac})}}class jl{encodeKey(e){return encodeURIComponent(e)}encodeValue(e){return encodeURIComponent(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}class ho{constructor(e,t,n){this.http=e,this._fileDownloadService=t,this._userInfo=n,this._baseEndpoint="rest/FileApiService/",this._uploadFileMethodName="UploadFile",this._uploadAndAttachMethodName="UploadAndAttachFile",this._getFileSchemasMethodName="GetAllFileSchemas",this._chunkSize=5e5}_getEndpoint(e){return(this._userInfo.isSSP?"ssp/":"")+`${this._baseEndpoint}${e}`}_prepareError(e,t){const n={...e,file:t.file};return(0,u.throwError)(()=>n)}_sendWithChunks(e,t,n,s=this._chunkSize){const r=new Uint8Array(e.content),o=new Array;for(let d=0;d<r.length;d+=s){const h=Math.min(d+s,r.length),f=new Blob([r.subarray(d,h)]),I={start:d,end:h,content:f};o.push(I)}let l=0;return(0,u.from)(o).pipe((0,c.concatMap)(d=>(l++,e.progress=Math.floor(l/o.length*100),this.http.post(n,d.content,{headers:new E.HttpHeaders({"Content-Range":`bytes ${d.start}-${d.end-1}/${e.file.size}`,"Content-Type":e.file.type,"Content-Disposition":`attachment; filename=${encodeURIComponent(e.file.name)}`}),params:t}).pipe((0,c.retry)(2),(0,c.switchMap)(h=>!h||!h.success?(0,u.throwError)(()=>h.errorInfo):(0,u.of)(h)),(0,c.catchError)(h=>this._prepareError(h,e))))),(0,c.toArray)())}upload(e){let t=new E.HttpParams({encoder:new jl}).set("fileId",e.id).set("totalFileLength",e.file.size).set("mimeType",e.file.type).set("fileName",e.file.name).set("columnName","Data").set("entitySchemaName",e.fileEntitySchemaName).set("parentColumnName",e.recordColumnName).set("parentColumnValue",e.recordId);const n={...e.fileGroup&&{FileGroupId:e.fileGroup},...e.tag&&{Tag:e.tag},...e.recordEntitySchemaName&&{RecordSchemaName:e.recordEntitySchemaName}};Object.keys(n).length&&(t=t.append("AdditionalParams",JSON.stringify(n)));const s=this._getEndpoint(this._uploadFileMethodName);return this._sendWithChunks(e,t,s)}uploadAsColumn(e){const t=new E.HttpParams({encoder:new jl}).set("fileId",e.id).set("totalFileLength",e.file.size).set("mimeType",e.file.type).set("columnName","Data").set("fileName",e.file.name).set("entitySchemaName",e.fileEntitySchemaName),n=this._getEndpoint(this._uploadFileMethodName);return this._sendWithChunks(e,t,n)}uploadAndAttach(e){const t=new E.HttpParams({encoder:new jl}).set("fileId",e.id).set("totalFileLength",e.file.size).set("mimeType",e.file.type).set("columnName","Data").set("fileName",e.file.name).set("parentEntitySchemaName",e.recordEntitySchemaName).set("entitySchemaName",e.fileEntitySchemaName).set("parentColumnValue",e.recordId),n=this._getEndpoint(this._uploadAndAttachMethodName);return this._sendWithChunks(e,t,n)}uploadToCustomEndpoint(e,t,n){const s=new E.HttpParams({encoder:new jl}).set("totalFileLength",e.file.size).set("mimeType",e.file.type).set("fileName",e.file.name);return this._sendWithChunks(e,s,t,n)}download(e,t){this._fileDownloadService.downloadFromUrl(e,t)}getAllFileSchemas(){const e=this._getEndpoint(this._getFileSchemasMethodName);return this.http.get(e)}static{this.\u0275fac=function(t){return new(t||ho)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(zs),i.\u0275\u0275inject(L.oq))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ho,factory:ho.\u0275fac})}}class po{constructor(e){this.translateService=e}_getTranslations(e){const t=this.translateService.translations[e];return t?(0,u.of)({translation:t,cultureName:e}):this.translateService.currentLoader.getTranslation(e).pipe((0,c.map)(n=>({translation:n,cultureName:e})))}getAllCultureValues(e,t){return(0,u.forkJoin)(e.map(n=>this._getTranslations(n))).pipe((0,c.map)(n=>{const s=new ms;for(const{translation:r,cultureName:o}of n){const l=(0,T.get)(r,t);s.setValueLocalizableString(o,l)}return s}))}isTranslateKey(e){return/^\S+\.\S+$/.test(e)}static{this.\u0275fac=function(t){return new(t||po)(i.\u0275\u0275inject(v.TranslateService))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:po,factory:po.\u0275fac})}}const Ud=new i.InjectionToken("CRT_REQUIRE_JS");class Hd{}class mo extends Hd{constructor(e,t){super(),this._requireJs=e,this._httpClient=t,this._serviceEndpoint="ServiceModel/ClientUnitSchemaPathService.svc/",this.paths=new Map}_loadPartOfSchema(e){const t=this._serviceEndpoint+"GetPathsBySchemaName/"+e;return this._httpClient.post(t,null).pipe((0,c.map)(n=>n?.paths??[]))}register(e){return this.paths.has(e)?(0,u.of)(void 0):this._loadPartOfSchema(e).pipe((0,c.map)(t=>{const n=Object.fromEntries(t.map(s=>[s.name,b.Location.joinWithSlash(ae(),s.path)]));this._requireJs.config({paths:n});for(const{name:s,path:r}of t)this.paths.set(s,r)}))}registerDescriptors(e){const t=Object.fromEntries(e.map(n=>[n.schemaName,b.Location.joinWithSlash(b.Location.joinWithSlash(ae(),n.path),n.schemaName)]));this._requireJs.config({paths:t})}static{this.\u0275fac=function(t){return new(t||mo)(i.\u0275\u0275inject(Ud),i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:mo,factory:mo.\u0275fac})}}class Fs extends Hd{register(){return(0,u.of)(void 0)}registerDescriptors(e){}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Fs)))(n||Fs)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Fs,factory:Fs.\u0275fac})}}class go extends Hd{constructor(e,t){super(),this._requireJs=e,this._appInfo=t,this._hashParamName="hash",this._workspaceBaseUrl=ae(),this._emptyResourcesModulePath="Terrasoft/configuration/resources/empty-resources.js"}_getSchemaRuntimePath(e){return b.Location.joinWithSlash(this._workspaceBaseUrl,e.staticFileContent.schemasRuntimePath)}_getResourceRuntimePath(e){return b.Location.joinWithSlash(this._workspaceBaseUrl,e.staticFileContent.resourcesRuntimePath)}_getEmptyResourcesPath(e){const t=b.Location.joinWithSlash(this._workspaceBaseUrl,e.coreModulesPath),n=new URL(b.Location.joinWithSlash(t,this._emptyResourcesModulePath));return n.searchParams.set(this._hashParamName,e.configurationContentHash),n.toString()}_getSchemaPath(e,t){const n=new URL(b.Location.joinWithSlash(this._getSchemaRuntimePath(t),`${e}.js`));return n.searchParams.set(this._hashParamName,t.configurationContentHash),n.toString()}_getResourcePath(e,t){const n=new URL(b.Location.joinWithSlash(this._getResourceRuntimePath(t),`${e}Resources.js`));return n.searchParams.set(this._hashParamName,t.configurationContentHash),n.toString()}register(e){return this._requireJs.config({paths:{[e]:this._getSchemaPath(e,this._appInfo),[`${e}Resources`]:[this._getResourcePath(e,this._appInfo),this._getEmptyResourcesPath(this._appInfo)]}}),(0,u.of)(void 0)}registerDescriptors(e,t){e.forEach(n=>{const s=n.schemaName;this._requireJs.config({paths:{[s]:this._getSchemaPath(s,t),[`${s}Resources`]:[this._getResourcePath(s,t),this._getEmptyResourcesPath(t)]}})})}static{this.\u0275fac=function(t){return new(t||go)(i.\u0275\u0275inject(Ud),i.\u0275\u0275inject(dt))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:go,factory:go.\u0275fac})}}class fo{constructor(e){this._window=e}get(){return this._window.requirejs}static{this.\u0275fac=function(t){return new(t||fo)(i.\u0275\u0275inject(P.ZP))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:fo,factory:fo.\u0275fac})}}var Bs=m(71260);class je{constructor(){this.handlerChain=Ae.instance}static{this._instanceOfKey="devkit_BaseRequestHandler"}get next(){return this._next}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===je._instanceOfKey}setNext(e){if(this._next)throw new x;this._next=e}}function Ke(a){return a?function(e){Un(a.type,"RequestHandlerTypeName"),Qc(a.type),ef(a,e)}:e=>{}}class wC{constructor(){}copyTextToBuffer(e){var t=this;return(0,S.A)(function*(){const s=(Array.isArray(e)?e:[e]).map(r=>({data:r,mimeType:"text/plain"}));try{return yield t.copyToBuffer(s)}catch{return console.log("Copy to clipboard is not allowed")}})()}}let Yd=class extends je{constructor(e,t){super(),this._copyClipboardService=e,this._notifyService=t}handle(e){var t=this;return(0,S.A)(function*(){yield t._copyClipboardService.copyTextToBuffer(e.value),yield t._notifyService.show({message:"CopyClipboard.Copied"}),yield t.next?.handle(e)})()}};Yd=(0,p.__decorate)([Ke({type:"crt.CopyClipboardRequestHandler",requestType:"crt.CopyClipboardRequest"}),(0,p.__metadata)("design:paramtypes",[wC,Fn])],Yd);function NC(a){return function(e,t,n){Reflect.defineMetadata(Gg+n,a,e)}}let Zd=class extends je{constructor(e){super(),this.notificationSender=e}handle(e){var t=this;return(0,S.A)(function*(){yield t.notificationSender.notify(e.config),yield t.next?.handle(e)})()}};Zd=(0,p.__decorate)([Ke({type:"crt.ShowDesktopNotificationHandler",requestType:"crt.ShowDesktopNotificationRequest"}),(0,p.__param)(0,NC(P.X4)),(0,p.__metadata)("design:paramtypes",[Object])],Zd);let Wd=class extends je{constructor(e){super(),this._soundPlayerService=e}handle(e){var t=this;return(0,S.A)(function*(){yield t._soundPlayerService.playFromSource(e.source,e.throwErrors),yield t.next?.handle(e)})()}};Wd=(0,p.__decorate)([Ke({type:"crt.SoundNotificationHandler",requestType:"crt.SoundNotificationRequest"}),(0,p.__metadata)("design:paramtypes",[P.wZ])],Wd);let _o=class ip{static{this.\u0275fac=function(t){return new(t||ip)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:ip})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[ht,ho,zs,Bs.B4,po,mi,{provide:Ud,useFactory:e=>e.requirejs,deps:[P.ZP]},mo,Fs,go,fo,{provide:Dm,useValue:e=>e?.header?.sender==="SchemaManagerItemEventNotifier"&&e?.header?.bodyTypeName==="ChangedSchema",multi:!0},{provide:Am,useValue:e=>e?.header?.sender==="SchemaManagerItemEventNotifier"&&e?.header?.bodyTypeName==="RemovedSchema",multi:!0},{provide:gd,useValue:e=>e?.header?.sender==="SchemaManagerItemEventNotifier"&&e?.header?.bodyTypeName==="SchemaRightsChanged",multi:!0},{provide:gd,useValue:e=>e?.header?.sender==="SchemaManagerItemRightsChangedNotifier",multi:!0},{provide:$a.P,useValue:{name:pl.HO,type:Pn.P.PersistentAndMemory,options:{tableName:Dc.w.ApplicationInfo}},multi:!0}],imports:[v.TranslateModule]})}};_o=(0,p.__decorate)([mr({requestHandlers:[Yd,Zd,Wd]})],_o),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(_o,{imports:[v.TranslateModule]})}();function he(a){return a?function(e){const t=typeof a=="string"?a:a.type;Un(t,"converterTypeName"),Xg({type:t,typeRef:e},e)}:e=>{}}const pg=[C.r.Float,C.r.FLOAT0,C.r.FLOAT1,C.r.FLOAT2,C.r.FLOAT3,C.r.FLOAT4,C.r.FLOAT8,C.r.Integer,C.r.MONEY0,C.r.MONEY1,C.r.Money,C.r.MONEY3],EC=[C.r.DateTime,C.r.Date,C.r.Time];var mg=m(87210);class Us{transform(e){return typeof e=="number"?e:(0,mg.decode)(e)}static{this.\u0275fac=function(t){return new(t||Us)}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"decodeHtml",type:Us,pure:!0,standalone:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Us,factory:Us.\u0275fac,providedIn:"root"})}}var DC=m(30046),Rl=m.n(DC);class Hs extends P.NS{handle(e){return e.dateTimeFormat?.date?.format==="week"?"W":super.handle(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Hs)))(n||Hs)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Hs,factory:Hs.\u0275fac,providedIn:"root"})}}class Ys extends P.NS{handle(e){return e?.dateTimeFormat?.time?.format==="hour"?"H":super.handle(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Ys)))(n||Ys)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ys,factory:Ys.\u0275fac,providedIn:"root"})}}class yo{constructor(){this._defaultShortDatePattern="M/D/YYYY"}convert(e){if(e)return{...e,shortDatePattern:e?.shortDatePattern?.toUpperCase()??this._defaultShortDatePattern,shortTimePattern:e?.shortTimePattern?.replace("tt","A")}}static{this.\u0275fac=function(t){return new(t||yo)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:yo,factory:yo.\u0275fac,providedIn:"root"})}}const AC=new i.InjectionToken("DateTimeFormatInfo",{providedIn:"root",factory:()=>{const a=(0,i.inject)(yo),e=(0,i.inject)(L.oq);return a.convert(e?.cultureInfo?.dateTimeFormat)}}),OC="M/D/YYYY";class Ai extends P.NS{constructor(e){super(),this._dateTimeFormat=e}_castToDateTimeFormat(e){const t=e.format;if(!t)return e;const n=t.split(" ").length>=2;return{type:e.type,date:{display:!0},time:{display:n}}}_getDateTimeFormatMoment(e){let t="";const{shortDatePattern:n,shortTimePattern:s}=this._dateTimeFormat??{};if(!n&&!s)return OC;const{date:r,time:o}=e??{},{display:l=!1}=r??{},{display:d=!1}=o??{};return l&&(t+=n),d&&(t+=` ${s}`),t.trim()}handle(e){const{dateTimeFormat:t,handledMomentFormat:n}=e,s=this._castToDateTimeFormat(t),r=this._getDateTimeFormatMoment(s);this.format=s?.date?.format;let o=this.internalHandler(n??r);if(o!==r){const l=new RegExp(`^\\${this._dateTimeFormat.dateSeparator}+`),d=new RegExp(`\\${this._dateTimeFormat.dateSeparator}+$`),h=new RegExp(`\\${this._dateTimeFormat.dateSeparator}{2,}`,"g");o=o.replace(l,"").replace(d,"").replace(h,this._dateTimeFormat.dateSeparator)}return e.handledMomentFormat=o,super.handle(e)??o}static{this.\u0275fac=function(t){return new(t||Ai)(i.\u0275\u0275inject(AC))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ai,factory:Ai.\u0275fac,providedIn:"root"})}}class Zs extends Ai{internalHandler(e){return this.format&&!this.format.has("days")?e.replace(/D/g,""):e}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Zs)))(n||Zs)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Zs,factory:Zs.\u0275fac,providedIn:"root"})}}class Ws extends Ai{internalHandler(e){return this.format&&!this.format?.has("months")?e.replace(/M/g,""):e}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Ws)))(n||Ws)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ws,factory:Ws.\u0275fac,providedIn:"root"})}}class $s extends Ai{internalHandler(e){return this.format&&!this.format?.has("years")?e.replace(/Y/g,""):e}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory($s)))(n||$s)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:$s,factory:$s.\u0275fac,providedIn:"root"})}}const gg=new i.InjectionToken("Represents the moment date time format",{factory:()=>{const a=(0,i.inject)(Hs),e=(0,i.inject)(Ys),t=(0,i.inject)(Zs),n=(0,i.inject)(Ws),s=(0,i.inject)($s);return{getFormat:r=>(a.setNext(e).setNext(t).setNext(n).setNext(s),a.handle({dateTimeFormat:r}))}},providedIn:"root"});class $d{}class Co extends $d{constructor(e){super(),this._momentDateTimeFormatter=e}format(e,t){if(!e)return"";const n=new Date(e);if(isNaN(n))return"";const s=this._momentDateTimeFormatter.getFormat(t);return Rl()(n).format(s)}static{this.\u0275fac=function(t){return new(t||Co)(i.\u0275\u0275inject(gg))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Co,factory:Co.\u0275fac,providedIn:"root"})}}const PC=new i.InjectionToken("Represents a datetime data formatter",{factory:()=>new Co((0,i.inject)(gg)),providedIn:"root"});class Gd{constructor(e){this._formatter=e}getValue(e){return e.toString()}getFormat(e){if(!e)return this.defaultFormat;const t=this.getFormatByDataType(e.dataType);return t?(0,T.merge)({},t,e):{type:this.defaultFormat?.type,...(0,T.omit)(e,"dataType")}}getFormatByDataType(e){return e&&this.formatsByDataTypeMap.get(e)}isSupportedValue(e){return typeof e=="string"}transform(e,t){if(!this.isSupportedValue(e))return"";const n=this.getValue(e),s=this.getFormat(t);return this._formatter.format(n,s)}}const kC=new Map([[C.r.Date,{type:"datetime",date:{display:!0}}],[C.r.DateTime,{type:"datetime",date:{display:!0},time:{display:!0}}],[C.r.Time,{type:"datetime",date:{display:!1},time:{display:!0}}]]);class Gs extends Gd{constructor(e){super(e),this.defaultFormat={type:"datetime",date:{display:!0}},this.formatsByDataTypeMap=kC}getValue(e){return typeof e=="number"&&(e=new Date(e)),e.toString()}isSupportedValue(e){return super.isSupportedValue(e)||typeof e=="number"||e instanceof Date}transform(e,t){return e===""?"":super.transform(e,t)}static{this.\u0275fac=function(t){return new(t||Gs)(i.\u0275\u0275directiveInject(PC,16))}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"dateTimeFormat",type:Gs,pure:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Gs,factory:Gs.\u0275fac,providedIn:"root"})}}class Oi{constructor(e){this._translate=e}transform(e){if(!e?.value)return null;const t=e?.displayValue||null;return e&&we.String.isNullOrWhiteSpace(t)?this._translate.instant("LookupFormat.EmptyDisplayValue"):t}static{this.\u0275fac=function(t){return new(t||Oi)(i.\u0275\u0275directiveInject(v.TranslateService,16))}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"lookupFormat",type:Oi,pure:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Oi,factory:Oi.\u0275fac,providedIn:"root"})}}const jC=new Map([[C.r.Integer,0],[C.r.Float,2],[C.r.MONEY0,0],[C.r.MONEY1,1],[C.r.Money,2],[C.r.MONEY3,3],[C.r.FLOAT0,0],[C.r.FLOAT1,1],[C.r.FLOAT2,2],[C.r.FLOAT3,3],[C.r.FLOAT4,4],[C.r.FLOAT8,8]]);var RC=m(67462),Qd=m.n(RC);const LC=0,VC=20,Mo=".",fg="",vv=1024;class Io{constructor(e){this._userInfo=e}_adjustDecimalPrecision(e){return e==null||(e=parseInt(`${e}`,10),isNaN(e))?null:(e=Math.min(e,VC),e=Math.max(e,LC),e)}_adjustDecimalSeparator(e){const t=this._userInfo?.cultureInfo?.decimalSeparator;return typeof t=="string"?t:e||Mo}_adjustThousandSeparator(e){const t=this._userInfo?.cultureInfo?.thousandSeparator;return typeof t=="string"?t:e||fg}adjust(e){const{decimalPrecision:t,decimalSeparator:n,thousandSeparator:s,thousandAbbreviation:r,trimTrailingZeros:o}=e||{};return{type:"number",decimalPrecision:this._adjustDecimalPrecision(t),decimalSeparator:this._adjustDecimalSeparator(n),trimTrailingZeros:o??!1,thousandSeparator:this._adjustThousandSeparator(s),thousandAbbreviation:{enabled:r?.enabled===!0}}}static{this.\u0275fac=function(t){return new(t||Io)(i.\u0275\u0275inject(L.oq,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Io,factory:Io.\u0275fac,providedIn:"root"})}}const zC=",",_g="#DECIMAL_SEPARATOR#",yg="#THOUSAND_SEPARATOR#";class bo extends $d{constructor(e){super(),this._formatAdjuster=e}_isNaN(e){const t=parseFloat(e);return isNaN(t)}_isExponentialValue(e){return/^[-+]?\d*\.?\d+[eE][-+]?\d+$/.test(e)}_getPrecisionFromExponential(e){const[,t,n]=e.match(/^[-+]?(\d*\.?\d+)[eE]([-+]?\d+)$/),[s,r=""]=t.split(Mo),o=parseInt(n,10),l=s+r,d=s.length+o,h=l.length-d;return h>0?h:0}_convertExponentialToDecimal(e,t){const n=t?.decimalPrecision??this._getPrecisionFromExponential(e);try{return Qd()(e).format({mantissa:n})}catch{return e.toString()}}_createNumbroFormat(e,t){const{decimalPrecision:n,trimTrailingZeros:s,thousandSeparator:r,thousandAbbreviation:o}=t;this._isExponentialValue(e)&&(e=this._convertExponentialToDecimal(e,t));const[l,d]=e.split(Mo),h=Math.abs(parseInt(l,10))>=1e3;return!!o?.enabled&&h?{average:!0,thousandSeparated:!!r,mantissa:1,optionalMantissa:!0}:{mantissa:n??d?.length??0,thousandSeparated:!!r,trimMantissa:!!s}}_replaceSeparators(e,t){const{decimalSeparator:n,thousandSeparator:s}=t,r=[{searchValue:Mo,replaceMacros:_g,replaceValue:n},{searchValue:zC,replaceMacros:yg,replaceValue:s}];return(0,P.mh)(e,r)}_undoReplaceSeparators(e,t){const{decimalSeparator:n,thousandSeparator:s}=t,r=[{searchValue:n,replaceMacros:_g,replaceValue:Mo},{searchValue:s,replaceMacros:yg,replaceValue:fg}];return(0,P.mh)(e,r)}format(e,t){if(this._isNaN(e))return"";t||(t={type:"number"});const n=this._formatAdjuster.adjust(t),s=this._createNumbroFormat(e,n);let r;try{r=Qd()(e).format(s)}catch{r=Qd()(0).format(s)}return this._replaceSeparators(r,n)}undoFormat(e,t){if(this._isNaN(e))return"";t||(t={type:"number"});const n=this._formatAdjuster.adjust(t);return this._undoReplaceSeparators(e,n)}static{this.\u0275fac=function(t){return new(t||bo)(i.\u0275\u0275inject(Io))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:bo,factory:bo.\u0275fac,providedIn:"root"})}}const FC=new i.InjectionToken("Represents a number data formatter",{factory:()=>(0,i.inject)(bo),providedIn:"root"}),BC=new Map(pg.map(a=>[a,UC(a)]));function UC(a){return{type:"number",decimalPrecision:jC.get(a)}}class Qs extends Gd{constructor(e){super(e),this.defaultFormat={type:"number"},this.formatsByDataTypeMap=BC}isSupportedValue(e){return super.isSupportedValue(e)||typeof e=="number"}static{this.\u0275fac=function(t){return new(t||Qs)(i.\u0275\u0275directiveInject(FC,16))}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"numberFormat",type:Qs,pure:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Qs,factory:Qs.\u0275fac,providedIn:"root"})}}const HC=new Map([["default",{ADD_TAGS:["#comment","signature"],FORCE_BODY:!0}],["textOnly",{ALLOWED_TAGS:["#text"],FORBID_CONTENTS:P.G8}]]);class So extends $d{constructor(e){super(),this._domPurifier=e,this._defaultFormat={type:"sanitizeHtml",mode:"default"},this._sanitizationConfigsByMode=HC}_sanitizeHtml(e,t){const n=t.mode??"default",s=this._sanitizationConfigsByMode.get(n);return this._domPurifier.sanitize(e,s).toString()}format(e,t){return e?this._sanitizeHtml(e,t??this._defaultFormat):""}static{this.\u0275fac=function(t){return new(t||So)(i.\u0275\u0275inject(P.MV))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:So,factory:So.\u0275fac,providedIn:"root"})}}const YC=new i.InjectionToken("Represents a sanitize html formatter",{factory:()=>new So((0,i.inject)(P.MV)),providedIn:"root"});class Js extends Gd{constructor(e){super(e),this.defaultFormat={type:"sanitizeHtml"},this.formatsByDataTypeMap=new Map([])}isSupportedValue(e){return super.isSupportedValue(e)||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||typeof e=="symbol"||e instanceof Date}static{this.\u0275fac=function(t){return new(t||Js)(i.\u0275\u0275directiveInject(YC,16))}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"sanitizeHtml",type:Js,pure:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Js,factory:Js.\u0275fac,providedIn:"root"})}}class qs{constructor(e){this._injector=e}_sanitizeText(e,t){const n=this._injector.get(Us),s=this._injector.get(Js);return e=n.transform(e),e=s.transform(e,{mode:"textOnly",dataType:t}),e=n.transform(e),e}transform(e,t){const{dataType:n}=t??{};return pg.includes(n)?this._injector.get(Qs).transform(e,t):n===C.r.Lookup?this._injector.get(Oi).transform(e):EC.includes(n)?this._injector.get(Gs).transform(e,t):n===C.r.IMAGELOOKUP?"":typeof e=="string"?this._sanitizeText(e,n):e?.toString()}static{this.\u0275fac=function(t){return new(t||qs)(i.\u0275\u0275directiveInject(i.Injector,16))}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"valueFormat",type:qs,pure:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:qs,factory:qs.\u0275fac,providedIn:"root"})}}let Jd=class{constructor(e){this._formatValuePipe=e}convert(e,t,n){return this._formatValuePipe.transform(e,n)}};Jd=(0,p.__decorate)([he({type:"crt.FormatValue"}),(0,p.__metadata)("design:paramtypes",[qs])],Jd);let qd=class{convert(e){return!e}};qd=(0,p.__decorate)([he({type:"crt.InvertBooleanValue"})],qd);let Ll=class{convert(e,t,n){return(0,T.isEqual)(e,n)}};Ll=(0,p.__decorate)([he({type:"crt.IsEqual"})],Ll);let Kd=class{convert(e){return!!e}};Kd=(0,p.__decorate)([he({type:"crt.ToBoolean"})],Kd);let Xd=class{convert(e){return e?`mailTo: ${e}`:""}};Xd=(0,p.__decorate)([he({type:"crt.ToEmailLink"})],Xd);const ZC=new i.InjectionToken("A factory of empty placeholder creators");class Ks{constructor(e){this._emptyPlaceholderCreatorFactory=e}transform(e,t){return e==null||e===""?this._emptyPlaceholderCreatorFactory?.create(t)?.create(t)??"":e}static{this.\u0275fac=function(t){return new(t||Ks)(i.\u0275\u0275directiveInject(ZC,16))}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"toEmptyPlaceholder",type:Ks,pure:!0})}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ks,factory:Ks.\u0275fac})}}let eh=class{constructor(e){this._toEmptyPlaceholder=e}convert(e,t,n){return this._toEmptyPlaceholder.transform(e,n)}};eh=(0,p.__decorate)([he({type:"crt.ToEmptyPlaceholder"}),(0,p.__metadata)("design:paramtypes",[Ks])],eh);let th=class{convert(e){return e?.displayValue||e?.value||e}};th=(0,p.__decorate)([he({type:"crt.ToDisplayValue"})],th);let nh=class{constructor(e){this._userInfo=e}convert(e){const t=this._userInfo?.cultureInfo,n=(0,T.isEmpty)(t?.dateTimeFormat?.code)?(0,T.isEmpty)(t?.sysCultureName)?"en-US":t.sysCultureName:t.dateTimeFormat.code,s=!(0,T.isEmpty)(t?.dateTimeFormat?.amDesignator);return new Intl.DateTimeFormat(n,{hour:"2-digit",minute:"2-digit",hour12:s}).format(e)}};nh=(0,p.__decorate)([he({type:"crt.ToLocalTimeValue"}),(0,p.__metadata)("design:paramtypes",[L.oq])],nh);let ih=class{convert(e,t){return e?typeof e=="string"?e:El(e.value):""}};ih=(0,p.__decorate)([he({type:"crt.ToImageLink"})],ih);let sh=class{convert(e,t,n,s=null){const r=e&&e[n];return r==null||r===""?s:r}};sh=(0,p.__decorate)([he({type:"crt.ToObjectProp"})],sh);let ah=class{convert(e){return e?`tel: ${e}`:""}};ah=(0,p.__decorate)([he({type:"crt.ToPhoneLink"})],ah);let rh=class{constructor(){this._fileServicePath="rest/FileService/"}_getFilePath(e){const t=this._fileServicePath+b.Location.joinWithSlash("Download",e);return ae()+t}convert(e,t,n){return n?b.Location.joinWithSlash(this._getFilePath(n),e):""}};rh=(0,p.__decorate)([he({type:"crt.ToFileLink"})],rh);let oh=class{_tryGetLookupValueFromCollection(e,t,{primaryAttributeName:n,primaryDisplayAttributeName:s,primaryColorAttributeName:r}){const o=t.find(h=>h.attributes[n]===e);if(!o)return null;const l=o.attributes[s];if(s&&!l)return null;const d=o.attributes[r];return r&&!d?null:{value:e,displayValue:l,primaryColorValue:d}}_getAttributeValue(e,t){let n=e;for(const s of t)if(n?.attributes&&s in n.attributes)n=n.attributes[s];else return;return n}_getCollectionForSearch(e,t){const n=e.dataSchemas[t],s=e.getViewModelAttributePath(t,n.primaryAttributeName).split(".").slice(0,-1);let r;const o=this._getAttributeValue(e,s);if(o instanceof bn)r=[o];else if(o instanceof ft&&o.length)r=o;else return null;const l=r[0].getViewModelAttributePath(t,n.primaryAttributeName),d=r[0].getViewModelAttributePath(t,n.primaryDisplayAttributeName);if(n.primaryDisplayAttributeName&&!d)return null;const h=r[0].getViewModelAttributePath(t,n.primaryColorAttributeName);return n.primaryColorAttributeName&&!h?null:{collection:r,keys:{primaryAttributeName:l,primaryDisplayAttributeName:d,primaryColorAttributeName:h}}}_getModelsBoundToEntity(e,t){const n=e.dataSchemas;return Object.entries(n).filter(([,s])=>s.name===t).map(([s])=>s)}_getFilterByPrimaryValues(e,t){const n=new Se("tempTable"),s=new pe({columnPath:e}),r=t.map(d=>new fe({value:d})),o=new gn(ee.Equal,s,r);return n.filters.add(o),n.getMetadata().filters}_getLookupValuesFromDataSource(e,t){var n=this;return(0,S.A)(function*(){if(!e.length)return[];const s=yield _t.create(t),r=yield s.getSchema(),{primaryAttributeName:o,primaryDisplayAttributeName:l,primaryColorAttributeName:d}=r,h=n._getFilterByPrimaryValues(o,e),f=[o,l,d].filter(Boolean),I=yield s.load({attributes:f,parameters:[{type:ne.Filter,value:h}]});return e.map(O=>{const B=I.find(J=>J[o]===O);return B?{value:B[o],displayValue:B[l],primaryColorValue:B[d]}:{value:O}})})()}getLookupValuesFromContext(e,t,n){const s=()=>({lookupValues:[],notFound:e.slice()});if(!e.length)return s();const r=this._getModelsBoundToEntity(t,n);if(!r.length)return s();const o=r.map(d=>this._getCollectionForSearch(t,d)).filter(Boolean);if(!o.length)return s();const l={lookupValues:[],notFound:[]};return e.forEach(d=>{let h;for(let f=0;!h&&f<o.length;f++){const{collection:I,keys:O}=o[f];h=this._tryGetLookupValueFromCollection(d,I,O)}h?l.lookupValues.push(h):l.notFound.push(d)}),l}convert(e,t,n){var s=this;return(0,S.A)(function*(){const r=Array.isArray(e),o=r?e:[e],l=o.filter(A.n7),d=s.getLookupValuesFromContext(l,t,n),{lookupValues:h,notFound:f}=d,I=yield s._getLookupValuesFromDataSource(f,n),O=o.map(B=>h.find(J=>J.value===B)??I.find(J=>J.value===B)??B);return r?O:O[0]})()}};oh=(0,p.__decorate)([he({type:"crt.ToLookup"})],oh);let ch=class{_isEncodedUri(e){return/%[0-9A-Fa-f]{2}/g.test(e)}_getEncodedUri(e){return this._isEncodedUri(e)?e:encodeURI(e)}convert(e){return(0,T.isEmpty)(e)?"":(e=e.trim(),this._getEncodedUri(e.startsWith("http://")||e.startsWith("https://")?e:`//${e}`))}};ch=(0,p.__decorate)([he({type:"crt.LinkPrefix"})],ch);let lh=class{_normalizePrimaryAttributeValues(e){return e?Array.isArray(e)?e:[e]:[]}_getFilteredPrimaryAttributeValues(e,t,n){return(0,S.A)(function*(){const{filterByPrimaryAttributeValues:s}=n??{},r=yield e.getPrimaryAttributeValues();return s===!1?r:t.filter(o=>r.includes(o))})()}_getViewModelAttributeName(e,t,n){const r=e.getBoundDataSchemaByAttributePath(t)?.attributes?.find(({path:h})=>h===n);if(!r)return null;const l=e.getBoundDataSourceNameByAttributePath(t);return e.getViewModelAttributePath(l,r.name).split(".").pop()}_getValuesFromCollection(e,t){var n=this;return(0,S.A)(function*(){const{context:s,collectionAttributeName:r,primaryAttributeValues:o,dataSourceAttributePath:l}=t,d=n._getViewModelAttributeName(s,r,l);if(!d)return null;const h=yield e.filterByPrimaryAttributes(o),f=`${r}.${d}`;return(yield Promise.all(h.map(O=>O[d]))).filter(O=>n._isAttributeValueValid(s,f,O))})()}_isAttributeValueValid(e,t,n){return e._getDataSourceAttributeDataValueType(t)===C.r.Lookup?mm(n):!0}_loadValuesByCollection(e){return(0,S.A)(function*(){const{context:t,collectionAttributeName:n,primaryAttributeValues:s,dataSourceAttributePath:r}=e,o=t.getBoundDataSchemaByAttributePath(n),l=yield _t.create(o.name),d=new gn(ee.Equal,new pe({columnPath:o.primaryAttributeName}),s.map(f=>new fe({value:f}))),h=yield l.load({attributes:[r],parameters:[{type:ne.Filter,value:(0,be.classToPlain)(d)}]});return h?h.map(f=>f[r]):[]})()}convert(e,t,n,s,r){var o=this;return(0,S.A)(function*(){const[l,d]=e??[];if(!l||!n||!s||!t)return[];const h=o._normalizePrimaryAttributeValues(d),f=r?.filterByPrimaryAttributeValues!==!1;if(!h?.length&&f)return[];const I=yield o._getFilteredPrimaryAttributeValues(l,h,r);if(!I?.length)return[];const O={context:t,primaryAttributeValues:I,collectionAttributeName:n,dataSourceAttributePath:s};return(yield o._getValuesFromCollection(l,O))||o._loadValuesByCollection(O)})()}};lh=(0,p.__decorate)([he({type:"crt.ToValuesFromCollection"})],lh);var uh;(function(a){a.Sum="sum"})(uh||(uh={}));let dh=class{_summarize(e){let t=0;return!Array.isArray(e)&&!Number.isNaN(e)?e:(e.map(n=>t+=Number(n)),t)}convert(e,t,n){return e&&n===uh.Sum?this._summarize(e):0}};dh=(0,p.__decorate)([he({type:"crt.ToAggregatedValue"})],dh);let hh=class{constructor(e){this._injector=e,this._httpClient=this._injector.get(E.HttpClient)}_getDcmStagesList(e){return this._httpClient.post("/rest/PlaybookStageService/"+"GetDcmStages",{dcmId:e}).pipe((0,u.map)(n=>n.stageValues))}convert(e){return e?(0,u.lastValueFrom)(this._getDcmStagesList(e.value)):Promise.resolve([])}};hh=(0,p.__decorate)([he({type:"crt.ToDcmStageValue"}),(0,p.__metadata)("design:paramtypes",[i.Injector])],hh);let ph=class{convert(e,t,n,...s){return we.String.format(n,e,...s)}};ph=(0,p.__decorate)([he({type:"crt.InterpolateString"})],ph);let mh=class extends Ll{convert(e,t,n){const s=Array.isArray(e)?e:[e];return s.length?s.every(r=>super.convert(r,t,n)):!0}};mh=(0,p.__decorate)([he({type:"crt.IsEveryEqualTo"})],mh);let gh=class{constructor(e){this._lookupFormatPipe=e}convert(e){return this._lookupFormatPipe.transform(e)}};gh=(0,p.__decorate)([he({type:"crt.ToLookupDisplayValue"}),(0,p.__metadata)("design:paramtypes",[Oi])],gh);let fh=class{constructor(e){this._translateService=e}_getEmptyDisplayValue(){return this._translateService.instant("LookupFormat.EmptyDisplayValue")}convert(e){if(!e)return this._getEmptyDisplayValue();const t=Object.values(Cs.Q).find(n=>n.id===e)?.translateKey;return t?this._translateService.instant(t):this._getEmptyDisplayValue()}};fh=(0,p.__decorate)([he({type:"crt.ToDataValueTypeDisplayValue"}),(0,p.__metadata)("design:paramtypes",[v.TranslateService])],fh);let _h=class{constructor(e){this._translateService=e}convert(e){if(!e)return null;const t=Object.values(Cs.Q).find(n=>n.id===e);return t?{value:t.id,displayValue:this._translateService.instant(t.translateKey)}:null}};_h=(0,p.__decorate)([he({type:"crt.ToDataValueTypeLookupValue"}),(0,p.__metadata)("design:paramtypes",[v.TranslateService])],_h);let yh=class{convert(e,t,n,s){return e?n:s}};yh=(0,p.__decorate)([he({type:"crt.IfElse"})],yh);let Ch=class{convert(e,t,n){Array.isArray(e)||(e=[e,n]);const s=e[0],r=e[1];return s||r}};Ch=(0,p.__decorate)([he({type:"crt.OrBooleanValue"})],Ch);let Mh=class{convert(e,t,n){return(0,S.A)(function*(){return(e?.shift()||t.attributes[n])?.length?{}:{display:"none"}})()}};Mh=(0,p.__decorate)([he({type:"crt.HideComponentWithNoItems"})],Mh);let Ih=class ru{convert(e,t,n,s){return(0,S.A)(function*(){const r=yield t[n];if(!r||!Array.isArray(r))return null;for(const o of r)if(typeof o=="object"&&o!==null&&s){if((yield o[s])===e)return o}else if(o===e)return o;return null})()}static{this.\u0275fac=function(t){return new(t||ru)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ru,factory:ru.\u0275fac})}};Ih=(0,p.__decorate)([he({type:"crt.FindInCollection"})],Ih);let bh=class ou{convert(e,t,n){return t.getModelByName(n).isLoaded}static{this.\u0275fac=function(t){return new(t||ou)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ou,factory:ou.\u0275fac})}};bh=(0,p.__decorate)([he({type:"crt.IsModelLoaded"})],bh);let Sh=class{getElementName(e){return`ViewElement_${e.replace(/-/g,"_")}`}convertToFullElementConfig(e,t){return(0,S.A)(function*(){return e})()}generateViewConfigDiff(e,t){var n=this;return(0,S.A)(function*(){const s=n.getElementName(t),r=yield n.convertToFullElementConfig(e,t);return[{operation:"insert",name:s,values:r}]})()}generateViewModelConfigDiff(e,t){return(0,S.A)(function*(){return[{operation:"merge",path:[],values:{supportBusinessRules:!1}}]})()}generateModelConfigDiff(e,t){return(0,S.A)(function*(){return[]})()}getSchemaName(e){return`ViewElementSchema_${e.replace(/-/g,"_")}`}convert(e,t,n){var s=this;return(0,S.A)(function*(){const r=yield s.generateViewConfigDiff(e,n),o=yield s.generateViewModelConfigDiff(e,n),l=yield s.generateModelConfigDiff(e,n);return{viewConfigDiff:r,viewModelConfigDiff:o,modelConfigDiff:l}})()}};Sh=(0,p.__decorate)([he({type:"crt.BaseLlmViewElementConfigToSchema"})],Sh);class vo{static{this._requestsMap=new Map}static{this._requestsRegistrationInfos=new Map}static get requestsRegistrationInfos(){return this._requestsRegistrationInfos}static register(e,t){const n=e.type;vo._requestsMap.set(n,t),vo._requestsRegistrationInfos.set(n,e)}static get(e){const t=vo._requestsMap.get(e);return l_(e,t),t&&new t}}function WC(a){return function(e){Un(a.type,"RequestTypeName"),Qc(a.type),vo.register(a,e)}}let Cg=class extends _m{constructor(){super(...arguments),this.type="crt.ChangeViewModelAttributeValueRequest"}};Cg=(0,p.__decorate)([WC({type:"crt.ChangeViewModelAttributeValueRequest"})],Cg);let vh=class extends je{handle(e){return(0,S.A)(function*(){const{$context:t,attributeName:n,attributeValue:s}=e||{};if(!t||!n)return;const r=t;return yield(0,u.lastValueFrom)(r.setValue({[n]:s}),{defaultValue:null}),s})()}};vh=(0,p.__decorate)([Ke({type:"crt.ChangeViewModelAttributeValueHandler",requestType:"crt.ChangeViewModelAttributeValueRequest"})],vh);class Xs{constructor(){this._maxGridLayoutRow=1,this._maxColumnsCount=12,this._defaultItemLayout={colSpan:1,row:1,column:1,rowSpan:1},this._defaultRowSpan=1,this._defaultColSpan=6}_applyExplicitPositions(e,t){if(e.every(n=>!n?.layoutConfig)){let n=1,s=1;e.forEach(r=>{const o=r.layoutConfig||{};o.column===void 0&&(o.column=s,s++),o.colSpan===void 0&&(o.colSpan=1),o.row===void 0&&(o.row=n),o.rowSpan===void 0&&(o.rowSpan=1),o.column===1&&o.colSpan===-1&&n++,s>t&&(s=1,n++),r.layoutConfig=o})}return e}_checkBitmapIntersection(e,t){let n,s;for(n=0,s=e.length;n<s;n++)if((e[n]&t[n])>0)return!0;return!1}_calculateBitMask(e,t,n){const s=n-e;return Math.pow(2,s)-Math.pow(2,s-t)}_isEmpty(e){return e==null||e===""||(0,T.isArray)(e)&&e.length===0}_getItemBitmap(e,t){const n=[];if(this._isEmpty(e))return n;const s=e.column,r=e.row,o=e.colSpan||this._defaultColSpan,l=e.rowSpan||this._defaultRowSpan;let d,h;for(d=r,h=r+l;d<h;d++)n[d]=this._calculateBitMask(s,o,t);return n}_setDefaultValue(e,t,n,s){e[n]||(e[n]=s),t[n]||(t[n]=s)}_fixItemIntersect(e,t){const n=e.layoutConfig,s=t.layoutConfig,r=this._tryFixColumns(n,s);let o=!0;return r||(o=this._tryFixRows(n,s)),!r&&!o&&n.row>this._maxGridLayoutRow&&(this._maxGridLayoutRow+=1),!r&&!o&&this._moveDownItem(e),e}_moveDownItem(e){this._maxGridLayoutRow++;const t=e.layoutConfig;t.row=this._maxGridLayoutRow,t.column=1;const n=this._originalItems.find(s=>s.name===e.name);n&&(t.colSpan=n.layoutConfig.colSpan||1)}_tryFixColumns(e,t){return this._setDefaultValue(e,t,"colSpan",this._defaultColSpan),this._calculateNewParameters(e,t,"column","colSpan")}_tryFixRows(e,t){return this._setDefaultValue(e,t,"rowSpan",this._defaultRowSpan),this._calculateNewParameters(e,t,"row","rowSpan")}_calculateNewParameters(e,t,n,s){const r=e[s],o=t[s],l=t[n],d=l+o,h=e[n],f=h+r,I=l<=h,O=I?d-h:f-l;return r<=O?!1:(I&&(e[n]=d),e[s]=r-O,!0)}_compareItemsPositions(e,t){const n=e.layoutConfig||(0,T.cloneDeep)(this._defaultItemLayout),s=t.layoutConfig||(0,T.cloneDeep)(this._defaultItemLayout),r=Math.max(n.colSpan||this._defaultColSpan,n.rowSpan||this._defaultRowSpan),o=Math.max(s.colSpan||this._defaultColSpan,s.rowSpan||this._defaultRowSpan);return n.row!==s.row?n.row<s.row?-1:1:r<o||n.column<s.column&&r<=o?-1:1}_getMaxGridLayoutRow(e){const t=e.map(n=>{const s=n.layoutConfig||{},r=s.row||1,o=s.rowSpan||1;return r+o-1});return Math.max(...t)||1}_getMaxColumnsCount(e,t){const n=e.map(s=>{const r=s.layoutConfig||{},o=r.column||1,l=r.colSpan||1;return o+l-1});return Math.max(...n,t,this._maxColumnsCount)}fixItemsOverlap(e,t){this._originalItems=(0,T.cloneDeep)(e);const n=[],s=[];return this._maxGridLayoutRow=this._getMaxGridLayoutRow(e),this._maxColumnsCount=this._getMaxColumnsCount(e,t),[...e].sort((o,l)=>this._compareItemsPositions(o,l)).forEach(o=>{let l=this._getItemBitmap(o.layoutConfig,this._maxColumnsCount);s.forEach(d=>{const h=this._getItemBitmap(d.layoutConfig,this._maxColumnsCount);this._checkBitmapIntersection(h,l)&&(o=this._fixItemIntersect(o,d),l=this._getItemBitmap(o.layoutConfig,this._maxColumnsCount),n.push(o.name))}),s.push(o)}),this._applyExplicitPositions(e,t),{items:e,affectedItems:n}}static{this.\u0275fac=function(t){return new(t||Xs)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Xs,factory:Xs.\u0275fac})}}var To=m(81762),Mg=m(57703),ea=m(27075),Vl=m(64511),Ig=m(68695);function Q(a){return function(e,t){a||(a={propertyBindable:!1}),Reflect.defineMetadata(li+t.toString(),a,e.constructor)}}const $C=["input"];class Jt{constructor(e,t,n){this.ngControl=e,this.autofillMonitor=t,this.focusMonitor=n,this._disabled=!1,this._placeholder="",this._required=!1,this._focused=!1,this.destroy=new u.Subject,this.autofilled=!1,this.stateChanges=new u.Subject,this.onTouched=()=>{},e&&(this.ngControl.valueAccessor=this)}set elementRef(e){e&&(this._elementRef=e)}get elementRef(){return this._elementRef}get disabled(){return this._disabled}set disabled(e){this.setDisabledState((0,Ig.coerceBooleanProperty)(e)),this.stateChanges.next()}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){return this._required}set required(e){this._required=(0,Ig.coerceBooleanProperty)(e),this.stateChanges.next()}get value(){return this.innerValue}set value(e){this.writeValue(e)}get innerValue(){return this._innerValue}set innerValue(e){this.setInnerValueSilent(e),this.callChangeHandler()}get empty(){return!this.autofilled&&!this.value}get focused(){return this._focused}set focused(e){this._focused=e,this.stateChanges.next()}get shouldLabelFloat(){return this.focused||!this.empty}setInnerValueSilent(e){this._innerValue=e}callChangeHandler(){this.onChange?this.onChange(this._innerValue):this.stateChanges.next()}focusElementViaMouse(){this.focusMonitor.focusVia(this.elementRef.nativeElement,"mouse")}initMonitors(){this.focusMonitor.monitor(this.elementRef.nativeElement,!0).pipe((0,c.takeUntil)(this.destroy)).subscribe(e=>{this.focused=!!e}),this.autofillMonitor.monitor(this.elementRef).pipe((0,c.map)(e=>e.isAutofilled),(0,c.filter)(e=>e),(0,c.startWith)(!1),(0,c.takeUntil)(this.destroy)).subscribe(e=>this.autofilled=e)}onContainerClick(e){e.target.tagName.toLowerCase()!=="input"&&this.focusElementViaMouse()}setDescribedByIds(){}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}writeValue(e){this._innerValue=e,this.stateChanges.next()}setDisabledState(e){if(this._disabled===e)return;this._disabled=e;const t=this.ngControl?.control;t&&t.disabled!==e&&(e?t.disable():t.enable())}ngDoCheck(){this.ngControl&&(this.errorState=this.ngControl.invalid&&this.ngControl.touched,this.stateChanges.next())}ngAfterViewInit(){this.initMonitors()}ngOnDestroy(){this.focusMonitor.stopMonitoring(this.elementRef?.nativeElement),this.autofillMonitor.stopMonitoring(this.elementRef),this._elementRef=null,this.stateChanges.next(),this.stateChanges.complete(),this.destroy.next(),this.destroy.complete()}static{this.\u0275fac=function(t){return new(t||Jt)(i.\u0275\u0275directiveInject(Z.NgControl),i.\u0275\u0275directiveInject(Vl.AutofillMonitor),i.\u0275\u0275directiveInject(ea.FocusMonitor))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Jt,viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery($C,5,i.ElementRef),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.elementRef=s.first)}},hostVars:2,hostBindings:function(t,n){t&1&&i.\u0275\u0275listener("focusout",function(){return n.onTouched()}),t&2&&i.\u0275\u0275classProp("floating",n.shouldLabelFloat)},inputs:{disabled:"disabled",placeholder:"placeholder",required:"required",value:"value"}})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Boolean),(0,p.__metadata)("design:paramtypes",[Boolean])],Jt.prototype,"disabled",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String),(0,p.__metadata)("design:paramtypes",[String])],Jt.prototype,"placeholder",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Boolean),(0,p.__metadata)("design:paramtypes",[Boolean])],Jt.prototype,"required",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object),(0,p.__metadata)("design:paramtypes",[Object])],Jt.prototype,"value",null);const GC=["originalPickerToggle"];function QC(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",11)}function JC(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",12)}function qC(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",9),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onPickerIconClick())}),i.\u0275\u0275template(1,QC,1,0,"mat-icon",10)(2,JC,1,0,"ng-template",null,3,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275reference(3),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.type==="time")("ngIfElse",t)}}class Pi extends Jt{get convertedValue(){return this._convertedValue}set convertedValue(e){this._convertedValue=e,this.innerValue=e.toDate()}constructor(e,t,n,s,r){super(e,t,n),this._matIconRegistry=s,this._domSanitizer=r,this.controlType="ts-datetime-picker",this.type="datetime",this._registerIcons()}_registerIcons(){["datetime-picker-toggle-date","datetime-picker-toggle-time"].forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(m(48104)("./"+e+"-icon.svg")))}),this._matIconRegistry.addSvgIconLiteral("read-only",this._domSanitizer.bypassSecurityTrustHtml(m(75670)))}writeValue(e){this._convertedValue=Rl()(e),super.writeValue(e)}onPickerIconClick(){this.originalPickerToggle.nativeElement.dispatchEvent(new MouseEvent("click"))}static{this.\u0275fac=function(t){return new(t||Pi)(i.\u0275\u0275directiveInject(Z.NgControl,10),i.\u0275\u0275directiveInject(Vl.AutofillMonitor),i.\u0275\u0275directiveInject(ea.FocusMonitor),i.\u0275\u0275directiveInject(U.MatIconRegistry),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Pi,selectors:[["ts-datetime-picker"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(GC,5,i.ElementRef),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.originalPickerToggle=s.first)}},inputs:{label:"label",minDate:"minDate",maxDate:"maxDate",type:"type"},features:[i.\u0275\u0275ProvidersFeature([{provide:K.MatFormFieldControl,useExisting:Pi}]),i.\u0275\u0275InheritDefinitionFeature],decls:8,vars:11,consts:[["input",""],["originalPickerToggle",""],["datetimePicker",""],["dateIcon",""],[1,"datetime-picker-input-wrapper"],["matInput","","type","text","autocomplete","false","spellcheck","false",3,"ngModelChange","ngModel","matDatetimepicker","required","min","max","disabled","placeholder"],[3,"for"],["mat-icon-button","",3,"click",4,"ngIf"],["openOnFocus","true","mode","portrait",3,"type","disabled"],["mat-icon-button","",3,"click"],["svgIcon","datetime-picker-toggle-time",4,"ngIf","ngIfElse"],["svgIcon","datetime-picker-toggle-time"],["svgIcon","datetime-picker-toggle-date"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",4)(1,"input",5,0),i.\u0275\u0275twoWayListener("ngModelChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.convertedValue,o)||(n.convertedValue=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(3,"mat-datetimepicker-toggle",6,1),i.\u0275\u0275template(5,qC,4,2,"button",7),i.\u0275\u0275element(6,"mat-datetimepicker",8,2),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(7);i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("ngModel",n.convertedValue),i.\u0275\u0275property("matDatetimepicker",s)("required",n.required)("min",n.minDate)("max",n.maxDate)("disabled",n.disabled)("placeholder",n.placeholder),i.\u0275\u0275advance(2),i.\u0275\u0275property("for",s),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",!n.disabled),i.\u0275\u0275advance(),i.\u0275\u0275property("type",n.type)("disabled",n.disabled)}},dependencies:[b.NgIf,Z.DefaultValueAccessor,Z.NgControlStatus,Z.RequiredValidator,Z.NgModel,W.MatIconButton,To.MatDatetimepickerComponent,To.MatDatetimepickerToggleComponent,To.MatDatetimepickerInputDirective,U.MatIcon,re.MatInput],styles:[`ts-datetime-picker{width:100%}ts-datetime-picker .datetime-picker-input-wrapper{display:flex;align-items:center;position:relative;min-width:calc(18ch + 26px)}ts-datetime-picker .datetime-picker-input-wrapper mat-datetimepicker-toggle{display:none}ts-datetime-picker .datetime-picker-input-wrapper button[mat-icon-button]{height:26px;width:26px;line-height:26px;position:absolute;right:0}ts-datetime-picker .datetime-picker-input-wrapper button[mat-icon-button] mat-icon{height:16px!important;width:16px!important;line-height:16px;position:relative;bottom:2px}
`],encapsulation:2})}}class qt{static{this.\u0275fac=function(t){return new(t||qt)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:qt})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,Z.FormsModule,W.MatButtonModule,zn.MatDatepickerModule,To.MatDatetimepickerModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,Mg.MatMomentDatetimeModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(qt,{declarations:[Pi],imports:[b.CommonModule,Z.FormsModule,W.MatButtonModule,zn.MatDatepickerModule,To.MatDatetimepickerModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,Mg.MatMomentDatetimeModule],exports:[Pi]})})();var Th;(function(a){a[a.None=0]="None",a[a.Count=1]="Count",a[a.Sum=2]="Sum",a[a.Avg=3]="Avg",a[a.Min=4]="Min",a[a.Max=5]="Max",a[a.TopOne=6]="TopOne"})(Th||(Th={}));var Xe=m(56911);class Kn{createObserver(e,t,n){return new KC(e,t,n)}static{this.\u0275fac=function(t){return new(t||Kn)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Kn,factory:Kn.\u0275fac,providedIn:"root"})}}class KC{constructor(e,t,n){if(this._bottomBuffer=100,this._lastScrollMaxPosition=0,this._emitter=new i.EventEmitter,q.checkArgumentEmpty("element",e),this._element=e,this._subscribeOnScroll(),n){if(n<=0)throw new Error(`Value of 'bottomBuffer' paramter must be positive, but actual value is ${n}.`);this._bottomBuffer=n}t&&this.subscribe(t)}_isWindowObserved(e){return!(this._element instanceof HTMLElement)}_scrolledToBottom(){const e=this._element,t=this._isWindowObserved(e)?e.document.documentElement.scrollTop:e.scrollTop,n=this._isWindowObserved(e)?e.document.body.scrollHeight:e.scrollHeight,s=this._isWindowObserved(e)?e.innerHeight:e.offsetHeight;if(!n||!s)return!1;const r=n-s-this._bottomBuffer;return this._lastScrollMaxPosition=t>this._lastScrollMaxPosition?t:this._lastScrollMaxPosition,this._lastScrollMaxPosition===t&&t>=r}_processScroll(){this._scrolledToBottom()&&this._emitter.emit()}_subscribeOnScroll(){this._eventListener=this._processScroll.bind(this),this._element.addEventListener("scroll",this._eventListener)}subscribe(e){this._emitter.subscribe(e)}resetScrollMaxPosition(){this._lastScrollMaxPosition=0}destroy(){this._element.removeEventListener("scroll",this._eventListener),this._element=null,this._emitter.unsubscribe()}}class xo{constructor(e){this._queryExecutor=e}_getColumnPath(e){return typeof e=="string"?e:e.columnPath}_addSchemaColumn(e,t){e.addSchemaColumn(this._getColumnPath(t))}_addPrimaryColumnIfNeeded(e,t,n){const s=e.getPrimaryColumn().name;t.some(r=>this._getColumnPath(r)===s)||n.addSchemaColumn(s)}_getEsqOrderDirection(e){return e?e==="asc"?Qe.Asc:Qe.Desc:Qe.None}_applySort(e,t){if(!t?.sort)return;const n=this._getEsqOrderDirection(t.sort.direction);e.getColumn(t.sort.columnName).withOrdering(n,0)}_buildEsq(e,t){const n=new Se(e.name);return t.columns.forEach(s=>this._addSchemaColumn(n,s)),this._addPrimaryColumnIfNeeded(e,t.columns,n),this._applySort(n,t),t.filter&&n.filters.add(t.filter),n.rowCount=t.rowCount,n.rowsOffset=t.rowsOffset,n}loadEntityData(e,t){q.checkArgumentEmpty("entitySchema",e),q.checkArgumentEmpty("config",t);const n=this._buildEsq(e,t);return this._queryExecutor.executeSelectQuery(n)}static{this.\u0275fac=function(t){return new(t||xo)(i.\u0275\u0275inject(xe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:xo,factory:xo.\u0275fac,providedIn:"root"})}}class wo{_mapEntityColumnDataSchema(e){return{name:e.name,caption:e.caption,valueType:e.dataValueType}}_getColumnPath(e){return typeof e=="string"?e:e.columnPath}buildTableDataSchema(e,t){q.checkArgumentEmpty("entitySchema",e),q.checkArgumentEmpty("columns",t);const n=t.map(r=>e.columns.find(o=>this._getColumnPath(r)===o.name)),s=e.getPrimaryColumn().name;return{columns:n.map(this._mapEntityColumnDataSchema.bind(this)),trackBy:r=>r[s]}}static{this.\u0275fac=function(t){return new(t||wo)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:wo,factory:wo.\u0275fac,providedIn:"root"})}}const XC=["tableNgContainer"],eM=["dataViewWrapper"];class ta{set config(e){this._validateConfig(e);const t=this._config;this._config=e,(0,T.isEqual)(e,t)||this._applyConfig(e,t)}get sort(){return this._sort}get selectedRecords(){if(!this._entitySchema)return[];const e=this._entitySchema.getPrimaryColumn().name;return this.selectedIds?this._data.filter(t=>this.selectedIds.includes(t[e])):[]}set selectedRecords(e){const t=this._entitySchema.getPrimaryColumn().name,n=this.selectedIds.filter(o=>!this.data.some(l=>l[t]===o)),s=new Set(this.selectedIds),r=new Set(e.map(o=>o[t]).concat(n));this.selectedIds=[...r],(0,T.isEqual)(s,r)||this.selectedIdsChange.emit(this.selectedIds)}get tableDataSchema(){return this._tableDataSchema}get data(){return this._data}get tableConfig(){return this._config?.tableConfig}constructor(e,t,n,s,r){this._restHandler=e,this._entitySchemaService=t,this._loaderService=n,this._tableDataSchemaBuilder=s,this._scrollToBottomObserverFactory=r,this._destroyed$=new u.Subject,this._defaultPageSize=20,this._data=[],this._tableDataSchema={columns:[]},this._allPagesWasLoaded=!1,this._isDataLoading=!1,this.selectedIds=[],this.selectedIdsChange=new i.EventEmitter,this.dataChange=new i.EventEmitter,this.rowDoubleClick=new i.EventEmitter}_setTableDataChange(){this._table.dataSchema=this.tableDataSchema,this._table.config=this.tableConfig,this._table.data=this.data}_renderTableComponent(e){var t=this;return(0,S.A)(function*(){yield Promise.all([m.e(5783),m.e(2411),m.e(4576)]).then(m.bind(m,24576)).then(n=>{const s=n.TableComponent;t._tableRef=e.createComponent(s),t._table=t._tableRef.instance,t.dataChange.subscribe(()=>t._setTableDataChange()),t._table.selectedChange.subscribe(r=>t.selectedRecords=r),t._table.sortChange.subscribe(r=>t.onSortChange(r)),t._table.rowDoubleClick.subscribe(r=>t.rowDoubleClick.emit(r))})})()}_getPageSize(e){return e.pageSize??this._defaultPageSize}_afterLoaded(e,t){const n=t.length<this._getPageSize(e);this._allPagesWasLoaded=n,this.dataChange.emit({data:this._data.slice(),isLastPage:n})}_executeLoading(e,t){const n=this._restHandler.handleRequest(t()).pipe((0,c.share)());return n.subscribe(s=>this._afterLoaded(e,s)),n}_validateConfig(e){if(q.checkArgumentEmpty("config",e),q.checkArgumentEmpty("entitySchema",e.entitySchema),typeof e.entitySchema=="string"&&q.checkStringIsNotEmpty("entitySchema",e.entitySchema),q.checkArgumentEmpty("columns",e.columns),e.columns.length===0)throw new Error("Entity data view config should contain at least one column.")}_initScrollToBottomObserver(){this._scrollToBottomObserver=this._scrollToBottomObserverFactory.createObserver(this.dataViewWrapper.nativeElement,this._onScrollToBottom.bind(this))}_initDefaultSort(e,t){const n=e.getPrimaryDisplayColumn()?.name,r=n&&t.columns.some(o=>this._getColumnPath(o)===n)?n:this._getColumnPath(t.columns[0]);this._sort={columnName:r,direction:"asc"}}_getEntitySchema(e){if(typeof e=="object")return this._entitySchema=e,(0,u.of)(e);const t=this._restHandler.handleRequest(this._entitySchemaService.getEntitySchemaByUId(e),{skipBodyMask:!0}).pipe((0,c.takeUntil)(this._destroyed$),(0,c.map)(n=>n.entitySchema),(0,c.share)());return t.subscribe(n=>this._entitySchema=n),t}_prepareLoaderFilters(e){let t=null;if(e.excludedIds?.length>0){let n;n=new Ve,n.addSchemaColumnInFilterWithParameters(ee.Not_equal,this._entitySchema.getPrimaryColumn().name,e.excludedIds),e.filter&&n.add(e.filter),t=n}else t=e.filter;return t}_createDefaultLoaderConfig(e){return{rowCount:this._getPageSize(e),rowsOffset:-1,sort:this._sort,columns:e.columns,filter:this._prepareLoaderFilters(e)}}_loadRows(e,t){return this._isDataLoading=!0,this._loaderService.loadEntityData(e,t).pipe((0,c.take)(1),(0,c.tap)(()=>this._isDataLoading=!1),(0,c.takeUntil)(this._destroyed$),(0,c.share)())}_loadNextData(e,t){const n=this._createDefaultLoaderConfig(t);n.rowsOffset=this._data.length;const s=this._loadRows(e,n);return s.subscribe(r=>this._data=this._data.concat(r)),s}_getColumnPath(e){return typeof e=="string"?e:e.columnPath}_resetScroll(){this.dataViewWrapper?.nativeElement&&(this.dataViewWrapper.nativeElement.scrollTop=0),this._scrollToBottomObserver?.resetScrollMaxPosition()}_loadFirstData(e,t){this._resetScroll();const n=this._createDefaultLoaderConfig(t),s=this._loadRows(e,n);return this._data=[],s.subscribe(r=>{this._data=r,this._tableDataSchema=this._tableDataSchemaBuilder.buildTableDataSchema(e,t.columns)}),s}_applyConfig(e,t){const n=e.columns;let s;if(!t||!(0,T.isEqual)(e.entitySchema,t.entitySchema))s=this._getEntitySchema(e.entitySchema).pipe((0,c.tap)(r=>this._initDefaultSort(r,e)),(0,c.mergeMap)(r=>this._loadFirstData(r,e)));else{const r=!(0,T.isEqual)(n,t.columns);r&&this._initDefaultSort(this._entitySchema,e),this._entitySchema&&(r||!(0,T.isEqual)(e.filter,t.filter)||!(0,T.isEqual)(e.excludedIds,t.excludedIds))&&(s=this._loadFirstData(this._entitySchema,e))}s&&this._executeLoading(e,()=>s)}_onScrollToBottom(){if(this._isDataLoading||this._allPagesWasLoaded)return;const e=this._config;this._executeLoading(e,()=>this._loadNextData(this._entitySchema,e))}onSortChange(e){if((0,T.isEqual)(e,this._sort))return;const t=this._config;this._sort=e,this._executeLoading(t,()=>this._loadFirstData(this._entitySchema,t))}ngOnInit(){var e=this;return(0,S.A)(function*(){yield e._renderTableComponent(e.tableNgContainer)})()}ngOnChanges(e){this._tableRef?.setInput("selected",this.selectedRecords)}ngAfterViewInit(){this._initScrollToBottomObserver()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this._scrollToBottomObserver.destroy()}static{this.\u0275fac=function(t){return new(t||ta)(i.\u0275\u0275directiveInject(Uc),i.\u0275\u0275directiveInject(ht),i.\u0275\u0275directiveInject(xo),i.\u0275\u0275directiveInject(wo),i.\u0275\u0275directiveInject(Kn))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ta,selectors:[["ts-entity-data-view"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(XC,7,i.ViewContainerRef),i.\u0275\u0275viewQuery(eM,7)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.tableNgContainer=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.dataViewWrapper=s.first)}},inputs:{config:"config",selectedIds:"selectedIds"},outputs:{selectedIdsChange:"selectedIdsChange",dataChange:"dataChange",rowDoubleClick:"rowDoubleClick"},features:[i.\u0275\u0275NgOnChangesFeature],decls:4,vars:2,consts:[["dataViewWrapper",""],["tableNgContainer",""],[1,"entity-data-view-wrapper"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",2,0),i.\u0275\u0275elementContainer(2,null,1),i.\u0275\u0275elementEnd()),t&2&&i.\u0275\u0275styleProp("display",n.data.length>0?null:"none")},styles:[".entity-data-view-wrapper[_ngcontent-%COMP%]{height:100%;overflow:auto}"]})}}var zt;(function(a){a.Contains="contains",a.StartsWith="starts-with",a.Equals="equals"})(zt||(zt={}));var xh=m(36931);class wh{constructor(e){this._overlayRef=e,this.afterClosed$=new u.Subject}_close(e){this._overlayRef.dispose(),this.afterClosed$.next(e),this.afterClosed$.complete()}close(e){this._close(e)}}var zl=m(1337);function tM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-checkbox",8),i.\u0275\u0275listener("change",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(o.onColumnSelectedChange(r.name,s))}),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("checked",n.isColumnSelected(t.name)),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(n.getColumnCheckboxCaption(t))}}function nM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275template(1,tM,2,2,"mat-checkbox",7),i.\u0275\u0275element(2,"mat-divider"),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.columnConfigs)}}function iM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-radio-button",9),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("value",t.value),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.caption," ")}}const bg=new i.InjectionToken("SEARCH_INPUT_SETTINGS_DATA");class No{constructor(e,t,n){this._settingsOverlayRef=e,this._translateService=t,this.searchStrategyOptions=[{value:zt.StartsWith,caption:this._translateService.instant("SearchInput.Settings.StartsWith")},{value:zt.Contains,caption:this._translateService.instant("SearchInput.Settings.Contains")},{value:zt.Equals,caption:this._translateService.instant("SearchInput.Settings.Equals")}];const s=n?.settings||{};this.settings={searchStrategy:s.searchStrategy??zt.Contains,columns:s.columns?.slice()??[]},this.columnConfigs=n?.columnConfigs??[]}_setColumnSelected(e,t){const n=this.settings.columns;if(t)n.includes(e)||n.push(e);else{const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}close(){this._settingsOverlayRef.close(null)}apply(){this._settingsOverlayRef.close(this.settings)}isColumnSelected(e){return this.settings.columns.includes(e)}onColumnSelectedChange(e,t){this._setColumnSelected(e,t.checked)}getColumnCheckboxCaption(e){const t=e.caption,n=this._translateService.instant("SearchInput.Settings.SearchColumnTemplate");return we.String.Format(n,t)}static{this.\u0275fac=function(t){return new(t||No)(i.\u0275\u0275directiveInject(wh),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(bg))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:No,selectors:[["ts-search-input-settings"]],decls:11,vars:9,consts:[[1,"search-input-settings-container"],[4,"ngIf"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"bottom-actions"],["mat-button","",1,"",3,"click"],["mat-flat-button","","color","primary",1,"action-button",3,"click"],[3,"checked","change",4,"ngFor","ngForOf"],[3,"change","checked"],[3,"value"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,nM,3,1,"div",1),i.\u0275\u0275elementStart(2,"mat-radio-group",2),i.\u0275\u0275twoWayListener("ngModelChange",function(r){return i.\u0275\u0275twoWayBindingSet(n.settings.searchStrategy,r)||(n.settings.searchStrategy=r),r}),i.\u0275\u0275template(3,iM,2,2,"mat-radio-button",3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"div",4)(5,"button",5),i.\u0275\u0275listener("click",function(){return n.close()}),i.\u0275\u0275text(6),i.\u0275\u0275pipe(7,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(8,"button",6),i.\u0275\u0275listener("click",function(){return n.apply()}),i.\u0275\u0275text(9),i.\u0275\u0275pipe(10,"translate"),i.\u0275\u0275elementEnd()()()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.columnConfigs.length>0),i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("ngModel",n.settings.searchStrategy),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.searchStrategyOptions),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(7,5,"SearchInput.Settings.Cancel")),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(10,7,"SearchInput.Settings.Apply")," "))},dependencies:[b.NgForOf,b.NgIf,zl.MatRadioGroup,zl.MatRadioButton,Z.NgControlStatus,Z.NgModel,W.MatButton,Rt.MatCheckbox,jt.MatDivider,v.TranslatePipe],styles:[`.search-input-settings-container{background:#fff 0% 0% no-repeat padding-box;box-shadow:0 0 3px #0000001a;border:1px solid #e2e2e2;opacity:1;padding:11px;min-width:220px}.search-input-settings-container mat-checkbox{display:block}.search-input-settings-container mat-checkbox,.search-input-settings-container mat-radio-button{margin-left:4px;margin-right:4px}.search-input-settings-container mat-checkbox:not(:first-child),.search-input-settings-container mat-radio-button:not(:first-child){margin-top:8px}.search-input-settings-container mat-divider{margin:14px 0}.search-input-settings-container .bottom-actions{display:flex;justify-content:flex-end;margin:8px 0 4px}.search-input-settings-container .bottom-actions button:not(:first-child){margin-left:12px}
`],encapsulation:2})}}const sM={hasBackdrop:!0,backdropClass:"search-settings-backdrop",alignToElementRef:null,data:null};class na{constructor(e,t){this._injector=e,this._overlay=t}_getOverlayConfig(e){const n=this._overlay.position().flexibleConnectedTo(e.alignToElementRef).withPositions([{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top",offsetY:6}]);return new mn.OverlayConfig({hasBackdrop:e.hasBackdrop,backdropClass:e.backdropClass,panelClass:e.panelClass,scrollStrategy:this._overlay.scrollStrategies.block(),positionStrategy:n})}_createOverlay(e){const t=this._getOverlayConfig(e);return this._overlay.create(t)}_createInjector(e,t){return i.Injector.create({providers:[{provide:wh,useValue:t},{provide:bg,useValue:e.data}]})}_attachContainerPortal(e,t,n){const s=this._createInjector(t,n),r=new xh.ComponentPortal(No,null,s);return e.attach(r).instance}openSettingsMenu(e){const t={...sM,...e},n=this._createOverlay(t),s=new wh(n),r=this._attachContainerPortal(n,t,s);return n.backdropClick().subscribe(o=>{r.close()}),s.afterClosed$}static{this.\u0275fac=function(t){return new(t||na)(i.\u0275\u0275inject(i.Injector),i.\u0275\u0275inject(mn.Overlay))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:na,factory:na.\u0275fac})}}const aM=["searchSettingsButton"],rM=["*"];function oM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",8),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.openSettingsMenu())}),i.\u0275\u0275element(1,"div",9,0),i.\u0275\u0275elementEnd()}}class ki{set value(e){this._value=e,this._emittedValue=e}get value(){return this._value}constructor(e,t){this._translateService=e,this._searchInputSettingsService=t,this._value="",this._valueChangeDebounceTime=500,this._emitValueChangeWithDebounce=(0,T.debounce)(n=>this._emitValueChange(n),this._valueChangeDebounceTime),this.showSettings=!1,this.settings={searchStrategy:zt.Contains,columns:[]},this.settingsChange=new i.EventEmitter,this.valueChange=new i.EventEmitter,this.columnConfigs=[]}_emitValueChange(e){this._emittedValue!==e&&(this._emittedValue=e,this.valueChange.emit(e))}_changeSettings(e){e&&!(0,T.isEqual)(e,this.settings)&&(this.settings=e,this.settingsChange.emit(e))}ngOnInit(){this.placeholder||(this.placeholder=this._translateService.instant("SearchInput.Placeholder"))}onValueChanged(e){const t=e.target.value;t!==this._value&&(this._value=t,this._emitValueChangeWithDebounce(t))}onClear(){const e="";this._value=e,this._emitValueChangeWithDebounce.cancel(),this._emitValueChange(e)}openSettingsMenu(){this._searchInputSettingsService.openSettingsMenu({alignToElementRef:this.settingsButton,data:{settings:this.settings,columnConfigs:this.columnConfigs}}).subscribe(e=>this._changeSettings(e))}static{this.\u0275fac=function(t){return new(t||ki)(i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(na))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ki,selectors:[["ts-search-input"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(aM,5),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.settingsButton=s.first)}},inputs:{showSettings:"showSettings",value:"value",placeholder:"placeholder",settings:"settings",columnConfigs:"columnConfigs"},outputs:{settingsChange:"settingsChange",valueChange:"valueChange"},ngContentSelectors:rM,decls:8,vars:5,consts:[["searchSettingsButton",""],["matPrefix","","svgIcon","search",1,"search-icon"],["floatLabel","never",1,"search-container-form-field"],["matInput","","type","text","spellcheck","false","autocomplete","off",1,"search-input-field",3,"input","placeholder","value"],["matSuffix","","mat-icon-button","","aria-label","Clear",1,"close",3,"click"],["svgIcon","close"],["matSuffix","",1,"search-settings-tools"],["mat-icon-button","","matSuffix","","class","search-settings-button",3,"click",4,"ngIf"],["mat-icon-button","","matSuffix","",1,"search-settings-button",3,"click"],[1,"search-settings-button-icon"]],template:function(t,n){t&1&&(i.\u0275\u0275projectionDef(),i.\u0275\u0275element(0,"mat-icon",1),i.\u0275\u0275elementStart(1,"mat-form-field",2)(2,"input",3),i.\u0275\u0275listener("input",function(r){return n.onValueChanged(r)}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"button",4),i.\u0275\u0275listener("click",function(){return n.onClear()}),i.\u0275\u0275element(4,"mat-icon",5),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(5,"div",6),i.\u0275\u0275projection(6),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(7,oM,3,0,"button",7),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275property("placeholder",n.placeholder)("value",n.value),i.\u0275\u0275advance(),i.\u0275\u0275styleProp("visibility",n.value?"inherit":"hidden"),i.\u0275\u0275advance(4),i.\u0275\u0275property("ngIf",n.showSettings))},dependencies:[b.NgIf,W.MatIconButton,K.MatFormField,K.MatPrefix,K.MatSuffix,U.MatIcon,re.MatInput],styles:[`ts-search-input{display:flex}ts-search-input mat-icon[svgicon=search]{width:16px;height:16px;margin-inline-end:6px!important;padding-top:8px!important}ts-search-input .search-container-form-field .mat-mdc-form-field-infix,ts-search-input .search-container-form-field .mat-mdc-form-field-icon-suffix{display:flex;gap:4px;border-top:none!important;align-items:center}ts-search-input mat-form-field{flex-grow:1}ts-search-input mat-form-field .mat-mdc-text-field-wrapper button.close,ts-search-input mat-form-field .mat-mdc-text-field-wrapper .search-settings-button{--mdc-icon-button-icon-size: 13px;--mat-icon-button-state-layer-color: var(--crt-palette-primary-50);--mat-icon-button-hover-state-layer-opacity: 0;height:22px!important;width:22px!important;vertical-align:middle!important}ts-search-input mat-form-field .mat-mdc-text-field-wrapper button.close mat-icon{display:block;margin:auto}ts-search-input mat-form-field .mat-mdc-text-field-wrapper button.close:focus .mat-mdc-button-persistent-ripple{border:1px solid #c8c8c8}ts-search-input mat-form-field .mat-mdc-text-field-wrapper .search-settings-button .search-settings-button-icon{background:url(settings.svg) no-repeat;width:16px;height:16px;margin:auto;display:block}ts-search-input mat-form-field .mat-mdc-form-field-subscript-wrapper{height:2px!important}ts-search-input mat-form-field.mat-focused .mat-mdc-floating-label{opacity:0!important}
`],encapsulation:2})}}function cM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",9),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("value",t),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.caption)}}class Eo{get searchKey(){return this._searchKey}set searchKey(e){if(this._searchKey=e,this._selectedColumn){const t=!e;this._changeFilter(t)}}get filteredColumns(){return this._filteredColumns}set entitySchema(e){this._entitySchema=e,this._columns=e.columns.filter(t=>Cs.P.Text.includes(t.dataValueType)||t.dataValueType===C.r.Lookup||t.dataValueType===C.r.Guid),this._filteredColumns=this._columns}get selectedColumn(){return this._selectedColumn}constructor(e,t,n,s){this._entitySchemaService=e,this._maskService=t,this._dialogService=n,this._translateService=s,this._destroyed$=new u.Subject,this._searchKey="",this.valueChange=new i.EventEmitter}_buildFilterGroup(e){const t=new Ve;t.logicalOperation=di.And;const n=this._selectedColumn.dataValueType===C.r.Guid?ee.Equal:ee.Contain,s=this._selectedColumn.dataValueType===C.r.Guid?this._searchKey?.trim():this._searchKey;return t.addSchemaColumnFilterWithParameter(n,e,s),t}_getFilterColumnPath(){return this._selectedColumn.dataValueType!==C.r.Lookup?(0,u.of)(this._selectedColumn.name):(this._maskService.showBodyMask(),this._entitySchemaService.getEntitySchemaByUId(this._selectedColumn.referenceSchemaUId).pipe((0,c.map)(e=>{this._maskService.hideBodyMask();const t=e.entitySchema.getPrimaryDisplayColumn()?.name;if(t)return this._selectedColumn.name+"."+t;const n=e.entitySchema.getPrimaryColumn()?.name;return this._selectedColumn.name+"."+n})))}_changeFilter(e=!1){if(e){this.valueChange.emit(null);return}if(this._selectedColumn.dataValueType===C.r.Guid&&!(0,A.n7)(this._searchKey?.trim())){this._dialogService.openInfoDialog(this._translateService.instant("QuickEntityFilter.NonGuidMessage"));return}this._getFilterColumnPath().pipe((0,c.takeUntil)(this._destroyed$)).subscribe(t=>{const n=this._buildFilterGroup(t);this.valueChange.emit(n)})}searchColumn(e){e||this.selectColumn(null),e=e.toLocaleLowerCase().trim(),this._filteredColumns=this._columns.filter(t=>t.caption.toLocaleLowerCase().includes(e))}getColumnCaption(e){return e.caption}selectColumn(e){if(this._selectedColumn=e,!e){this._changeFilter(!0);return}this._searchKey&&this._changeFilter()}ngOnInit(){this._selectedColumn=this._entitySchema?.getPrimaryDisplayColumn()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Eo)(i.\u0275\u0275directiveInject(ht),i.\u0275\u0275directiveInject(hr),i.\u0275\u0275directiveInject(Je),i.\u0275\u0275directiveInject(v.TranslateService))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Eo,selectors:[["ts-quick-entity-filter"]],inputs:{entitySchema:"entitySchema"},outputs:{valueChange:"valueChange"},decls:10,vars:5,consts:[["auto","matAutocomplete"],[1,"select-column-container"],["type","text","matInput","","spellcheck","false",3,"input","matAutocomplete","value"],["matSuffix","",1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[1,"search-container"],[3,"valueChange","value"],[3,"value"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",1)(1,"mat-form-field")(2,"input",2),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.searchColumn(o.target.value))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",3),i.\u0275\u0275element(4,"div",4),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(5,"mat-autocomplete",5,0),i.\u0275\u0275listener("optionSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.selectColumn(o.option.value))}),i.\u0275\u0275template(7,cM,2,2,"mat-option",6),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(8,"div",7)(9,"ts-search-input",8),i.\u0275\u0275twoWayListener("valueChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.searchKey,o)||(n.searchKey=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275elementEnd()()}if(t&2){const s=i.\u0275\u0275reference(6);i.\u0275\u0275advance(2),i.\u0275\u0275property("matAutocomplete",s)("value",n.selectedColumn==null?null:n.selectedColumn.caption),i.\u0275\u0275advance(3),i.\u0275\u0275property("displayWith",n.getColumnCaption),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",n.filteredColumns),i.\u0275\u0275advance(2),i.\u0275\u0275twoWayProperty("value",n.searchKey)}},dependencies:[b.NgForOf,Oe.MatAutocomplete,qe.MatOption,Oe.MatAutocompleteTrigger,K.MatFormField,K.MatSuffix,re.MatInput,ki],styles:[`ts-quick-entity-filter{display:flex}ts-quick-entity-filter .select-column-container{flex-basis:50%;padding-right:20px}ts-quick-entity-filter .select-column-container .mat-mdc-form-field{width:100%!important}ts-quick-entity-filter .search-container{flex-basis:50%}
`],encapsulation:2})}}const lM=a=>({"lookup-dialog-counter-value-hidden":a});function uM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ts-quick-entity-filter",14),i.\u0275\u0275listener("valueChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onFilterChanged(s))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("entitySchema",t.entitySchema)}}function dM(a,e){a&1&&i.\u0275\u0275element(0,"mat-spinner",20)}function hM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",15)(1,"span",16),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"div",17)(5,"div",18),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(7,dM,1,0,"mat-spinner",19),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,4,"LookupDialog.Selected")),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(6,lM,t.displayedSelectedRecordsCount===null)),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.displayedSelectedRecordsCount||0," "),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.displayedSelectedRecordsCount===null)}}function pM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ts-entity-data-view",21),i.\u0275\u0275listener("dataChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onEntityRecordsLoaded(s))}),i.\u0275\u0275twoWayListener("selectedIdsChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275twoWayBindingSet(r.selectedIds,s)||(r.selectedIds=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275listener("selectedIdsChange",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onSelectedIdsChange())})("rowDoubleClick",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onRowDoubleClick(s))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("config",t.entityDataViewConfig),i.\u0275\u0275twoWayProperty("selectedIds",t.selectedIds)}}function mM(a,e){a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),a&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,1,"LookupDialog.Blankslate")))}function gM(a,e){a&1&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,"BaseTableDetail.BlankslateWithFilters")))}function fM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",22),i.\u0275\u0275template(1,mM,4,3,"ng-container",23)(2,gM,3,3,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275reference(3),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!n.entityFilter)("ngIfElse",t)}}class ia{get entityFilter(){return this._quickEntityFilter}get entityDataViewConfig(){return{entitySchema:this._entitySchema,columns:this._getDisplayedColumns(),tableConfig:this._getTableConfig(),excludedIds:this._getLookupDialogConfig().excludedIds,filter:this._quickEntityFilter,pageSize:this._pageSize}}get selectMode(){return this._dialogData.tableConfig.selectMode}get entitySchema(){return this._entitySchema}get defaultBlankslateVisible(){return this._defaultBlankslateVisible}get displayedSelectedRecordsCount(){return this._allPagesSelectionEnabled?this._allPagesSelectedCount:this._loadedSelectedCount}constructor(e,t,n,s,r,o,l){this._dialogData=e,this._dialogRef=t,this._entitySchemaService=n,this._restHandler=s,this._translateService=r,this._queryExecutor=o,this._dialogService=l,this._pageSize=20,this._allPagesSelectionWarningRecordsNumber=1e3,this._destroyed$=new u.Subject,this._allPagesRecordsCountRequestCancel$=new u.Subject,this._defaultBlankslateVisible=!1,this._loadedRecords=[],this._allPagesWasLoaded=!1,this._allPagesSelectionEnabled=!1,this._allPagesUnselectedIds=null,this._allPagesRecordsCount=null,this._allPagesSelectedCount=null,this._allRowsSelectState=null,this._loadedSelectedCount=0,this.selectedIds=[],q.checkArgumentEmpty("data",e),q.checkArgumentEmpty("lookupDialogConfig",e.lookupDialogConfig),this.selectedIds=e.lookupDialogConfig.selectedIds?.slice()??[],this._getEntitySchema(e.lookupDialogConfig.entitySchema).pipe((0,c.takeUntil)(this._destroyed$)).subscribe(d=>this._entitySchema=d),this._applyIncomingFilter()}_getPrimaryColumnName(){return this._entitySchema.getPrimaryColumn().name}_getLoadedRecordIds(){const e=this._getPrimaryColumnName();return this._loadedRecords.map(t=>t[e])}_unselectAllExceptLoaded(){const e=this.selectedIds;this.selectedIds=this._getLoadedRecordIds().filter(t=>e.includes(t))}_getLookupDialogConfig(){return this._dialogData.lookupDialogConfig}_actualizeLoadedSelectedCount(){this._loadedSelectedCount=this.selectedIds.length}_canExistNotLoadedSelectedRecords(e){return e===Xe.K.None&&!this._allPagesSelectionEnabled&&!this._allPagesWasLoaded}_actualizeAllPagesUnselectedIds(){const e=this.selectedIds,t=this._getLoadedRecordIds(),n=t.filter(r=>!e.includes(r)),s=t.filter(r=>e.includes(r));for(const r of n)this._allPagesUnselectedIds.add(r);for(const r of s)this._allPagesUnselectedIds.delete(r)}_calculateAllPagesSelectedCount(){this._allPagesSelectedCount=this._allPagesRecordsCount===null?null:this._allPagesRecordsCount-this._allPagesUnselectedIds.size}_setAllPagesRecordsCount(e){this._allPagesRecordsCount=e,this._calculateAllPagesSelectedCount()}_handleRequest(e){return t=>this._restHandler.handleRequest(t,e)}_getDisplayedColumns(){let e=this._getLookupDialogConfig().displayedColumns;if(!e){const t=this._entitySchema.getPrimaryDisplayColumn();e=t?[t.name]:[this._getPrimaryColumnName()]}return e}_getTableConfig(){return{...this._dialogData.tableConfig,allRowsSelectState:()=>this._allRowsSelectState,allRowsSelectToggleHandler:()=>this._allRowsSelectToggle()}}_applyIncomingFilter(){const e=this._getLookupDialogConfig().filter;e&&(this._quickEntityFilter||(this._quickEntityFilter=new Ve),this._quickEntityFilter.add(e))}_getEntitySchema(e){return typeof e=="object"?(0,u.of)(e):this._entitySchemaService.getEntitySchemaByUId(e).pipe(this._handleRequest(),(0,c.map)(t=>t.entitySchema))}_actualizeDefaultBlankslateVisibility(e){this._defaultBlankslateVisible=e.length===0}_confirmAllPagesSelection(){if(this.displayedSelectedRecordsCount<this._allPagesSelectionWarningRecordsNumber)return(0,u.of)(!0);const e=this._translateService.instant("LookupDialog.AllPagesSelectionWarning");return this._dialogService.openConfirmationDialog(e).pipe((0,c.map)(t=>t===Pu.result))}_enableAllPagesSelection(){this._unselectAllExceptLoaded(),this._allPagesSelectionEnabled=!0,this._allPagesRecordsCount||this._loadAllPagesRecordsCount(),this._allRowsSelectState=Xe.K.All,this._allPagesUnselectedIds=new Set}_disableAllPagesSelection({unselectAllRecords:e}){this._allPagesRecordsCountRequestCancel$.next(),this._allPagesSelectionEnabled=!1,e&&(this.selectedIds=[],this._allRowsSelectState=Xe.K.None),this._actualizeLoadedSelectedCount(),this._allPagesUnselectedIds=null}_createAllFilteredRecordsEsq(){const e=this._getPrimaryColumnName(),t=new Se(this._entitySchema.name);this._quickEntityFilter&&t.filters.add(this._quickEntityFilter);const n=this._getLookupDialogConfig().excludedIds;return n?.length>0&&t.filters.addSchemaColumnInFilterWithParameters(ee.Not_equal,e,n),t}_createAllFilteredIdsEsq(){const e=this._createAllFilteredRecordsEsq();return e.addSchemaColumn(this._getPrimaryColumnName()),e}_loadAllPagesRecordsCount(){const e=this._getPrimaryColumnName(),t=this._createAllFilteredRecordsEsq();t.addAggregationFunctionColumn(e,Th.Count,"Count"),this._queryExecutor.executeSelectQuery(t).pipe(this._handleRequest({skipBodyMask:!0}),(0,c.takeUntil)((0,u.merge)(this._allPagesRecordsCountRequestCancel$,this._destroyed$)),(0,c.catchError)(()=>(this._disableAllPagesSelection({unselectAllRecords:!1}),u.EMPTY)),(0,c.map)(n=>n[0].Count)).subscribe(n=>this._setAllPagesRecordsCount(n))}_loadIsAnyRecordExist(e){const t=this._createAllFilteredIdsEsq();return t.rowCount=1,e(t),this._queryExecutor.executeSelectQuery(t).pipe((0,c.takeUntil)(this._destroyed$),this._handleRequest({maskDelay:0}),(0,c.map)(n=>n.length===1),(0,c.catchError)(()=>(0,u.of)(!0)),(0,c.shareReplay)())}_clearNotLoadedRecordsCachedInfo(){this._isAnyNotLoadedRecordSelected$=null,this._isAnyNotLoadedRecordUnselected$=null}_loadIsAnyNotLoadedRecordSelected(){return this._isAnyNotLoadedRecordSelected$??(this._isAnyNotLoadedRecordSelected$=this._loadIsAnyRecordExist(e=>e.filters.addSchemaColumnInFilterWithParameters(ee.Equal,this._getPrimaryColumnName(),this.selectedIds)))}_loadIsAnyNotLoadedRecordUnselected(){return this._isAnyNotLoadedRecordUnselected$??(this._isAnyNotLoadedRecordUnselected$=this._loadIsAnyRecordExist(e=>e.filters.addSchemaColumnInFilterWithParameters(ee.Not_equal,this._getPrimaryColumnName(),this.selectedIds)))}_loadAllPagesSelectedIds(){const e=this._getPrimaryColumnName(),t=this._getLoadedRecordIds().filter(n=>this._allPagesUnselectedIds.has(n));return this._queryExecutor.executeSelectQuery(this._createAllFilteredIdsEsq()).pipe((0,c.takeUntil)(this._destroyed$),this._handleRequest(),(0,c.map)(n=>n.map(s=>s[e])),(0,c.map)(n=>n.filter(s=>!t.includes(s))))}_actualizeAllRowsSelectState(){let e;const t=this._getLoadedRecordIds(),n=t.length>0&&t.some(r=>this.selectedIds.includes(r)),s=n&&t.every(r=>this.selectedIds.includes(r));return this.selectedIds.length===0||!n&&this._allPagesWasLoaded?e=(0,u.of)(Xe.K.None):s&&(this._allPagesWasLoaded||this._allPagesSelectionEnabled)?e=(0,u.of)(Xe.K.All):n&&!s?e=(0,u.of)(Xe.K.Intermediate):e=n?this._loadIsAnyNotLoadedRecordUnselected().pipe((0,c.map)(r=>r?Xe.K.Intermediate:Xe.K.All)):this._loadIsAnyNotLoadedRecordSelected().pipe((0,c.map)(r=>r?Xe.K.Intermediate:Xe.K.None)),e.subscribe(r=>this._allRowsSelectState=r),e}_unselectNotLoadedRecords(){const e=this._getPrimaryColumnName(),t=this._createAllFilteredIdsEsq();t.filters.addSchemaColumnInFilterWithParameters(ee.Equal,e,this.selectedIds);const n=this._queryExecutor.executeSelectQuery(t).pipe(this._handleRequest(),(0,c.takeUntil)((0,u.merge)(this._destroyed$)),(0,c.map)(s=>s.map(r=>r[e])),(0,c.catchError)(()=>(0,u.of)([])),(0,c.share)());return n.subscribe(s=>{this.selectedIds=this.selectedIds.filter(r=>!s.includes(r))}),n}_toggleLoadedRecordsSelection(e){const t=this._getLoadedRecordIds();e===Xe.K.None?this.selectedIds=this.selectedIds.filter(n=>!t.includes(n)):this.selectedIds=[...new Set(this.selectedIds.concat(t))]}_toggleAllPagesSelectionIfRequired(e){const t=!this._allPagesSelectionEnabled&&this.selectedIds.length>0&&e===Xe.K.All&&!this._allPagesWasLoaded,n=this._allPagesSelectionEnabled&&e===Xe.K.None;return t?(this._enableAllPagesSelection(),!0):n?(this._disableAllPagesSelection({unselectAllRecords:!0}),!1):null}_allRowsSelectToggle(){const e=this._allRowsSelectState===Xe.K.All?Xe.K.None:Xe.K.All;this._allRowsSelectState=e,this._toggleLoadedRecordsSelection(e),this._canExistNotLoadedSelectedRecords(e)?(this._loadedSelectedCount=null,this._unselectNotLoadedRecords().subscribe(()=>this._actualizeLoadedSelectedCount())):this._actualizeLoadedSelectedCount(),this._toggleAllPagesSelectionIfRequired(e)===null&&this._allPagesSelectionEnabled&&(this._allPagesUnselectedIds.clear(),this._calculateAllPagesSelectedCount())}_resetSelectionOnFilterChanged(){this._allPagesSelectionEnabled&&this._disableAllPagesSelection({unselectAllRecords:!0}),this.selectMode!=="multi"&&(this.selectedIds=[]),this._setAllPagesRecordsCount(null),this._allRowsSelectState=null}_closeWithSelection(e){const t=this._getPrimaryColumnName();this._dialogRef.close({selectedIds:e,selectedRecords:this._loadedRecords.filter(n=>e.includes(n[t]))})}getDialogTitle(){if(!this._entitySchema)return"";const e=this._translateService.instant("LookupDialog.TitleTemplate");return we.String.Format(e,this._entitySchema.caption)}ngOnDestroy(){this._destroyed$.next()}onFilterChanged(e){this._resetSelectionOnFilterChanged(),this._quickEntityFilter=e,this._applyIncomingFilter()}onEntityRecordsLoaded({data:e,isLastPage:t}){if(this._loadedRecords=e,this._clearNotLoadedRecordsCachedInfo(),this._actualizeDefaultBlankslateVisibility(e),this._allPagesWasLoaded=t,this._allPagesSelectionEnabled){const n=this._getPrimaryColumnName();this.selectedIds=e.map(s=>s[n]).filter(s=>!this._allPagesUnselectedIds.has(s)),this._actualizeLoadedSelectedCount(),t&&this._disableAllPagesSelection({unselectAllRecords:!1})}!this._allRowsSelectState&&this.selectMode==="multi"&&this._actualizeAllRowsSelectState()}isAnyRecordSelected(){return this.displayedSelectedRecordsCount>0}onRowDoubleClick(e){if(this.selectMode!=="single")return;const t=this._getPrimaryColumnName();this._dialogRef.close({selectedIds:[e[t]],selectedRecords:[e]})}closeWithCurrentSelection(){this._allPagesSelectionEnabled?this._confirmAllPagesSelection().pipe((0,c.filter)(e=>e),(0,c.mergeMap)(()=>this._loadAllPagesSelectedIds())).subscribe(e=>this._closeWithSelection(e)):this._closeWithSelection(this.selectedIds)}onSelectedIdsChange(){this._allPagesSelectionEnabled?(this._actualizeAllPagesUnselectedIds(),this._calculateAllPagesSelectedCount()):this._actualizeLoadedSelectedCount(),this._actualizeAllRowsSelectState()}static{this.\u0275fac=function(t){return new(t||ia)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA),i.\u0275\u0275directiveInject(Y.MatDialogRef),i.\u0275\u0275directiveInject(ht),i.\u0275\u0275directiveInject(Uc),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(xe),i.\u0275\u0275directiveInject(Je))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ia,selectors:[["ts-lookup-dialog"]],decls:20,vars:12,consts:[["blankslateWithFilters",""],["mat-dialog-title",""],["mat-icon-button","",1,"close-dialog",3,"mat-dialog-close"],["svgIcon","close",1,"close-button-icon"],[1,"lookup-dialog-top-panel"],[1,"dialog-filters"],[3,"entitySchema","valueChange",4,"ngIf"],["class","counter-container",4,"ngIf"],["mat-dialog-content",""],[3,"config","selectedIds","dataChange","selectedIdsChange","rowDoubleClick",4,"ngIf"],["class","lookup-dialog-blank-slate",4,"ngIf"],["mat-dialog-actions",""],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],["mat-flat-button","","color","primary",3,"click","disabled"],[3,"valueChange","entitySchema"],[1,"counter-container"],[1,"counter-label"],[1,"lookup-dialog-counter-value-wrapper"],[1,"counter-value",3,"ngClass"],["diameter","18",4,"ngIf"],["diameter","18"],[3,"dataChange","selectedIdsChange","rowDoubleClick","config","selectedIds"],[1,"lookup-dialog-blank-slate"],[4,"ngIf","ngIfElse"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",1)(1,"div")(2,"span"),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"button",2),i.\u0275\u0275element(5,"mat-icon",3),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(6,"div",4)(7,"div",5),i.\u0275\u0275template(8,uM,1,1,"ts-quick-entity-filter",6),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(9,hM,8,8,"div",7),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(10,"div",8),i.\u0275\u0275template(11,pM,1,2,"ts-entity-data-view",9)(12,fM,4,2,"div",10),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(13,"div",11)(14,"button",12),i.\u0275\u0275text(15),i.\u0275\u0275pipe(16,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(17,"button",13),i.\u0275\u0275listener("click",function(){return n.closeWithCurrentSelection()}),i.\u0275\u0275text(18),i.\u0275\u0275pipe(19,"translate"),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(n.getDialogTitle()),i.\u0275\u0275advance(5),i.\u0275\u0275property("ngIf",n.entitySchema),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.selectMode==="multi"),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.entitySchema),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.defaultBlankslateVisible),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(16,8,"LookupDialog.CancelButton")),i.\u0275\u0275advance(2),i.\u0275\u0275property("disabled",!n.isAnyRecordSelected()),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(19,10,"LookupDialog.SelectButton")," "))},dependencies:[b.NgClass,b.NgIf,ta,W.MatButton,W.MatIconButton,Y.MatDialogClose,Y.MatDialogTitle,Y.MatDialogActions,Y.MatDialogContent,U.MatIcon,Ut.MatProgressSpinner,Eo,v.TranslatePipe],styles:["[_nghost-%COMP%]{padding:4px 10px;width:834px;max-width:100%;min-width:420px;box-sizing:border-box}.counter-container[_ngcontent-%COMP%]{display:flex;align-items:baseline}.counter-container[_ngcontent-%COMP%]   .counter-label[_ngcontent-%COMP%]{font-size:13px;color:#757575;margin-right:4px}.counter-container[_ngcontent-%COMP%]   .lookup-dialog-counter-value-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.counter-container[_ngcontent-%COMP%]   .lookup-dialog-counter-value-wrapper[_ngcontent-%COMP%]   .counter-value[_ngcontent-%COMP%]{font-size:14px;color:#444}.counter-container[_ngcontent-%COMP%]   .lookup-dialog-counter-value-wrapper[_ngcontent-%COMP%]   .counter-value.lookup-dialog-counter-value-hidden[_ngcontent-%COMP%]{visibility:hidden;width:0}[mat-dialog-content][_ngcontent-%COMP%]{max-height:55vh!important;min-height:267px;height:862px}[mat-dialog-content][_ngcontent-%COMP%]   .lookup-dialog-blank-slate[_ngcontent-%COMP%]{display:flex;justify-content:center;font-size:14px;color:#999;text-align:center;padding-top:22px}[mat-dialog-actions][_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end}"]})}}class sa{constructor(e){this._dialogService=e,this._defaultTableConfig={headerSticky:!0}}_createTableConfig(e){return{...this._defaultTableConfig,...e}}openWithMultiselect(e){const t={lookupDialogConfig:e,tableConfig:this._createTableConfig({selectMode:"multi"}),gtmData:null};return this._dialogService.open(ia,{data:t}).pipe((0,c.map)(n=>({selectedIds:n?.selectedIds})))}open(e){const t={lookupDialogConfig:e,tableConfig:this._createTableConfig({selectMode:"single"}),gtmData:null};return this._dialogService.open(ia,{data:t}).pipe((0,c.map)(n=>({selectedId:n?.selectedIds[0],selectedRecord:n?.selectedRecords[0]})))}static{this.\u0275fac=function(t){return new(t||sa)(i.\u0275\u0275inject(Je))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:sa,factory:sa.\u0275fac})}}class ji extends Jt{set maxValue(e){this._maxValue=e}set selected(e){this._selected=e}get formattedValue(){return this._formattedValue}constructor(e,t,n,s,r,o){super(e,t,n),this._element=s,this._cdRef=r,this._formatUtility=o,this._formattedValue="",this._selected=!1,this._maxValue=99999999999e-2,this._maxLargeValue=999999999999,this.controlType="ts-number-input",this.isLargeNumberEnabled=!1,this.inputBlur=new i.EventEmitter,this.precision=2}_updateFormattedValue(){this._formattedValue=this._formatUtility.formatNumberValue(this.innerValue,new Bs.V_({precision:this.precision}))}_exceededMaxValue(e){const t=Math.abs(e),n=t%1;return this.isLargeNumberEnabled&&n===0?t>this._maxLargeValue:t>this._maxValue}ngAfterViewInit(){this._selected&&(this._element.nativeElement.lastElementChild.focus(),this._cdRef.detectChanges())}ngOnInit(){this._updateFormattedValue()}onInputValueChange(){this.callChangeHandler()}onInputFocus(){this.innerValue&&(this._formattedValue=this._formatUtility.formatNumberValue(this.innerValue,new Bs.V_({ignoreThousandSeparator:!0,precision:this.precision})))}writeValue(e){this.setInnerValueSilent(e),this._updateFormattedValue(),this.stateChanges.next(),this._cdRef.detectChanges()}onBlur(e){this._updateFormattedValue(),e&&(e.currentTarget.value=this._formattedValue),this.inputBlur.emit()}onInput(e){let t=e.currentTarget.value;if(t===""){this.setInnerValueSilent(0),this._formattedValue="";return}if(t=this._formatUtility.formatStringValue(t),this.precision===0){const s=this._formatUtility.getNumberFormatInfo().decimalSeparator;t=t.replace(new RegExp(`\\${s}$`),"")}e.currentTarget.value=t;let n=this._formatUtility.parseStringToNumber(t,this.precision);t==="-"&&(n=0),(isNaN(n)||this._exceededMaxValue(n))&&(n=this.innerValue,e.currentTarget.value=this._formatUtility.formatNumberValue(n,new Bs.V_({ignoreThousandSeparator:!0,precision:this.precision}))),this.setInnerValueSilent(n)}static{this.\u0275fac=function(t){return new(t||ji)(i.\u0275\u0275directiveInject(Z.NgControl,10),i.\u0275\u0275directiveInject(Vl.AutofillMonitor),i.\u0275\u0275directiveInject(ea.FocusMonitor),i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(Bs.B4))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ji,selectors:[["ts-number-input"]],inputs:{isLargeNumberEnabled:"isLargeNumberEnabled",maxValue:"maxValue",selected:"selected",precision:"precision"},outputs:{inputBlur:"inputBlur"},features:[i.\u0275\u0275ProvidersFeature([{provide:K.MatFormFieldControl,useExisting:ji}]),i.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["input",""],["matInput","","dir","ltr",3,"change","blur","input","focus","value","disabled","required"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"input",1,0),i.\u0275\u0275listener("change",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onInputValueChange())})("blur",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onBlur(o))})("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onInput(o))})("focus",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onInputFocus())}),i.\u0275\u0275elementEnd()}t&2&&i.\u0275\u0275property("value",n.formattedValue)("disabled",n.disabled)("required",n.required)},dependencies:[vn.Dir,re.MatInput],styles:["input[_ngcontent-%COMP%]{text-align:left;border:0;height:100%;width:100%}input[_ngcontent-%COMP%]:focus{outline-style:none}"],changeDetection:0})}}function _M(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-checkbox",6),i.\u0275\u0275twoWayListener("ngModelChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275twoWayBindingSet(r.innerValue,s)||(r.innerValue=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275twoWayProperty("ngModel",t.innerValue),i.\u0275\u0275property("disabled",t.disabled)("disableRipple",!0),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.label)}}function yM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",11),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(s.openSelectLookupValueDialog())}),i.\u0275\u0275element(1,"mat-icon",12),i.\u0275\u0275elementEnd()}}function CM(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",13)}function MM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-form-field",7)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(3,"input",8),i.\u0275\u0275template(4,yM,2,0,"button",9)(5,CM,1,0,"mat-icon",10),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.label),i.\u0275\u0275advance(),i.\u0275\u0275property("value",t.getLookupDisplayValue())("required",t.required),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!t.disabled),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.disabled)}}function IM(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",13)}function bM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",7)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"input",14),i.\u0275\u0275twoWayListener("ngModelChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275twoWayBindingSet(r.innerValue,s)||(r.innerValue=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(4,IM,1,0,"mat-icon",10),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.label),i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("ngModel",t.innerValue),i.\u0275\u0275property("required",t.required)("disabled",t.disabled),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.disabled)}}function SM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"textarea",14),i.\u0275\u0275twoWayListener("ngModelChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(3);return i.\u0275\u0275twoWayBindingSet(r.innerValue,s)||(r.innerValue=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275twoWayProperty("ngModel",t.innerValue),i.\u0275\u0275property("required",t.required)("disabled",t.disabled)}}function vM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-form-field",7)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(3,SM,1,3,"textarea",15),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.label),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",t.inputTypes.LongText)}}function TM(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",13)}function xM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",7)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"ts-datetime-picker",17),i.\u0275\u0275twoWayListener("ngModelChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(3);return i.\u0275\u0275twoWayBindingSet(r.innerValue,s)||(r.innerValue=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(4,TM,1,0,"mat-icon",10),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.label),i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("ngModel",t.innerValue),i.\u0275\u0275property("label",t.label)("required",t.required)("disabled",t.disabled)("type",t.getDatetimePickerType()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.disabled)}}function wM(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",13)}function NM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",7)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"ts-number-input",18),i.\u0275\u0275twoWayListener("ngModelChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(3);return i.\u0275\u0275twoWayBindingSet(r.innerValue,s)||(r.innerValue=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(4,wM,1,0,"mat-icon",10),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.label),i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("ngModel",t.innerValue),i.\u0275\u0275property("required",t.required)("disabled",t.disabled)("precision",t.getNumberInputPrecision())("maxValue",t.numberMaxValue),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.disabled)}}function EM(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,xM,5,7,"mat-form-field",16)(2,NM,5,7,"mat-form-field",16),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.useDatepicker()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.useNumberInput())}}function DM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",1),i.\u0275\u0275elementContainerStart(1,2),i.\u0275\u0275template(2,_M,2,4,"mat-checkbox",3)(3,MM,6,5,"mat-form-field",4)(4,bM,5,5,"mat-form-field",4)(5,vM,4,2,"mat-form-field",4)(6,EM,3,2,"ng-container",5),i.\u0275\u0275elementContainerEnd(),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngClass","input-type-"+t.inputTypes[t.inputType].toLowerCase()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.inputType),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",t.inputTypes.Boolean),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",t.inputTypes.Lookup),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",t.inputTypes.Text),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",t.inputTypes.LongText)}}var Fe;(function(a){a[a.Boolean=0]="Boolean",a[a.Integer=1]="Integer",a[a.Float=2]="Float",a[a.Date=3]="Date",a[a.Time=4]="Time",a[a.DateTime=5]="DateTime",a[a.Lookup=6]="Lookup",a[a.Text=7]="Text",a[a.LongText=8]="LongText"})(Fe||(Fe={}));const Sg={[Fe.Boolean]:[C.r.Boolean],[Fe.Integer]:[C.r.Integer],[Fe.Float]:[C.r.Float,C.r.FLOAT0,C.r.FLOAT1,C.r.FLOAT2,C.r.FLOAT3,C.r.FLOAT4,C.r.FLOAT8,C.r.MONEY0,C.r.MONEY1,C.r.Money,C.r.MONEY3],[Fe.Date]:[C.r.Date],[Fe.Time]:[C.r.Time],[Fe.DateTime]:[C.r.DateTime],[Fe.Lookup]:[C.r.Lookup],[Fe.Text]:[C.r.Text,C.r.SHORT_TEXT,C.r.PHONE_TEXT,C.r.WEB_TEXT,C.r.EMAIL_TEXT,C.r.MEDIUM_TEXT,C.r.Color,C.r.RICH_TEXT],[Fe.LongText]:[C.r.LONG_TEXT,C.r.MAXSIZE_TEXT]};class Do extends Jt{get column(){return this._column}set column(e){this._specifyInputType(e),this._column=e}get inputType(){return this._inputType}get numberMaxValue(){return this._column?.dataValueType===C.r.Integer?this._integerMaxValue:this._floatMaxValue}constructor(e,t,n,s,r,o,l,d,h){super(e,t,n),this._entitySchemaService=s,this._lookupDialogService=r,this._restErrorHandler=o,this._maskService=l,this._matIconRegistry=d,this._domSanitizer=h,this._integerMaxValue=2147483647,this._floatMaxValue=1175494351e29,this.inputTypes=Fe,this._registerIcons()}_specifyInputType(e){const t=Object.keys(Sg).find(n=>Sg[n].includes(e.dataValueType));this._inputType=t?parseInt(t):null}_registerIcons(){this._matIconRegistry.addSvgIconLiteral("read-only",this._domSanitizer.bypassSecurityTrustHtml(m(75670)))}_getLookupDialogConfig(e){const t=this.innerValue;return{entitySchema:e,displayedColumns:null,selectedIds:t?.value?[t.value]:null}}_setLookupValue(e,t){if(!t.selectedRecord)return;const n=e.getPrimaryDisplayColumn();this.innerValue={value:t.selectedId,displayValue:n?t.selectedRecord[n.name]:t.selectedId}}focusElementViaMouse(){}initMonitors(){}useDatepicker(){return[Fe.Date,Fe.Time,Fe.DateTime].includes(this._inputType)}getDatetimePickerType(){return{[C.r.Date]:"date",[C.r.Time]:"time",[C.r.DateTime]:"datetime"}[this._column.dataValueType]}useNumberInput(){return[Fe.Integer,Fe.Float].includes(this._inputType)}getNumberInputPrecision(){return{[C.r.Integer]:0,[C.r.Float]:2,[C.r.FLOAT0]:0,[C.r.FLOAT1]:1,[C.r.FLOAT2]:2,[C.r.FLOAT3]:3,[C.r.FLOAT4]:4,[C.r.FLOAT8]:8,[C.r.Money]:2,[C.r.MONEY0]:0,[C.r.MONEY1]:1,[C.r.MONEY3]:3}[this._column.dataValueType]}openSelectLookupValueDialog(){this._maskService.showBodyMask();let e;this._restErrorHandler.handleRequest(this._entitySchemaService.getEntitySchemaByUId(this._column.referenceSchemaUId)).pipe((0,c.tap)(t=>{this._maskService.hideBodyMask(),e=t.entitySchema}),(0,c.mergeMap)(t=>this._lookupDialogService.open(this._getLookupDialogConfig(t.entitySchema)))).subscribe(t=>this._setLookupValue(e,t))}getLookupDisplayValue(){const e=this.innerValue;return e?.displayValue??e?.value??""}static{this.\u0275fac=function(t){return new(t||Do)(i.\u0275\u0275directiveInject(Z.NgControl,10),i.\u0275\u0275directiveInject(Vl.AutofillMonitor),i.\u0275\u0275directiveInject(ea.FocusMonitor),i.\u0275\u0275directiveInject(ht),i.\u0275\u0275directiveInject(sa),i.\u0275\u0275directiveInject(Ou),i.\u0275\u0275directiveInject(hr),i.\u0275\u0275directiveInject(U.MatIconRegistry),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Do,selectors:[["ts-entity-column-value-input"]],inputs:{column:"column",label:"label"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","entity-column-value-input-wrapper",3,"ngClass",4,"ngIf"],[1,"entity-column-value-input-wrapper",3,"ngClass"],[3,"ngSwitch"],[3,"ngModel","disabled","disableRipple","ngModelChange",4,"ngSwitchCase"],["floatLabel","always",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"ngModelChange","ngModel","disabled","disableRipple"],["floatLabel","always"],["matInput","","type","text","disabled","true",3,"value","required"],["matSuffix","","mat-icon-button","",3,"click",4,"ngIf"],["matSuffix","","svgIcon","read-only",4,"ngIf"],["matSuffix","","mat-icon-button","",3,"click"],["svgIcon","search"],["matSuffix","","svgIcon","read-only"],["matInput","","type","text",3,"ngModelChange","ngModel","required","disabled"],["matInput","","type","text",3,"ngModel","required","disabled","ngModelChange",4,"ngSwitchCase"],["floatLabel","always",4,"ngIf"],[3,"ngModelChange","ngModel","label","required","disabled","type"],[3,"ngModelChange","ngModel","required","disabled","precision","maxValue"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,DM,7,6,"div",0),t&2&&i.\u0275\u0275property("ngIf",n.inputType!==null)},dependencies:[b.NgClass,b.NgIf,b.NgSwitch,b.NgSwitchCase,b.NgSwitchDefault,Z.DefaultValueAccessor,Z.NgControlStatus,Z.RequiredValidator,Z.NgModel,Pi,W.MatIconButton,Rt.MatCheckbox,K.MatFormField,K.MatLabel,K.MatSuffix,U.MatIcon,re.MatInput,ji],styles:[`ts-entity-column-value-input .entity-column-value-input-wrapper{display:flex;align-items:center}ts-entity-column-value-input .entity-column-value-input-wrapper:not(.input-type-longtext){height:44px}ts-entity-column-value-input .entity-column-value-input-wrapper.input-type-lookup button[matsuffix]{height:25px;width:25px}ts-entity-column-value-input .entity-column-value-input-wrapper.input-type-lookup button[matsuffix] mat-icon{height:16px;width:16px}ts-entity-column-value-input .entity-column-value-input-wrapper mat-form-field{width:100%}ts-entity-column-value-input .entity-column-value-input-wrapper mat-form-field textarea{min-height:calc(1em + 1px)}
`],encapsulation:2})}}class aa{static{this.\u0275fac=function(t){return new(t||aa)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:aa})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Bs.B4],imports:[b.CommonModule,Z.FormsModule,K.MatFormFieldModule,re.MatInputModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(aa,{declarations:[ji],imports:[b.CommonModule,Z.FormsModule,K.MatFormFieldModule,re.MatInputModule],exports:[ji]})})();class Xn{static{this.\u0275fac=function(t){return new(t||Xn)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Xn})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,Z.FormsModule,qt,W.MatButtonModule,Rt.MatCheckboxModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,aa]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Xn,{declarations:[Do],imports:[b.CommonModule,Z.FormsModule,qt,W.MatButtonModule,Rt.MatCheckboxModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,aa],exports:[Do]})})();const AM=(a,e)=>({expanded:a,collapsed:e});class ra{constructor(){this._direction="right",this.animationState="initial",this.isExpanded=!1,this.toggle=new i.EventEmitter}set direction(e){this._direction=e}get direction(){return this._direction}set animationDisabled(e){this._animationDisabled=e}get animationDisabled(){return this._animationDisabled}_setDefaultAnimationState(){this.animationState="initial"}_changeAnimationState(e){this.animationState=e}_onMouseEnter(){this.isExpanded||this._changeAnimationState(`slide-${this.direction}`)}_onMouseLeave(){this._changeAnimationState("initial")}onMouseAction(e){if(this.animationDisabled){this._setDefaultAnimationState();return}switch(e){case"enter":this._onMouseEnter();break;case"leave":this._onMouseLeave();break}}onToggle(){this.toggle.emit()}static{this.\u0275fac=function(t){return new(t||ra)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ra,selectors:[["crt-expansion-button"]],inputs:{isExpanded:"isExpanded",direction:"direction",animationDisabled:"animationDisabled"},outputs:{toggle:"toggle"},decls:5,vars:17,consts:[[3,"mouseenter","mouseleave","click","ngClass","title"],["svgIcon","collapse",1,"arrow-icon"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275listener("mouseenter",function(){return n.onMouseAction("enter")})("mouseleave",function(){return n.onMouseAction("leave")})("click",function(){return n.onToggle()}),i.\u0275\u0275elementStart(3,"div"),i.\u0275\u0275element(4,"mat-icon",1),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275classMapInterpolate1("expansion-button-wrapper ",n.direction,""),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction2(14,AM,n.isExpanded,!n.isExpanded))("title",n.isExpanded?i.\u0275\u0275pipeBind1(1,10,"ExpansionButton.CollapseTooltip"):i.\u0275\u0275pipeBind1(2,12,"ExpansionButton.ExpandTooltip")),i.\u0275\u0275advance(3),i.\u0275\u0275classMapInterpolate1("expansion-btn ",n.animationState,""),i.\u0275\u0275advance(),i.\u0275\u0275classProp("reversed",n.isExpanded))},dependencies:[b.NgClass,U.MatIcon,v.TranslatePipe],styles:[`.expansion-button-wrapper{height:40px;display:flex;position:absolute}.expansion-button-wrapper.expanded{width:16px}.expansion-button-wrapper.collapsed{width:29px}.expansion-button-wrapper.left{justify-content:flex-end}.expansion-button-wrapper.left.expanded{left:-4px}.expansion-button-wrapper.left.collapsed{left:-17px}.expansion-button-wrapper.left .expansion-btn{border-radius:8px 0 0 8px}.expansion-button-wrapper.left .expansion-btn .arrow-icon{transform:rotate(0)}.expansion-button-wrapper.left .expansion-btn .arrow-icon.reversed{transform:rotate(180deg)}.expansion-button-wrapper.right{justify-content:flex-start}.expansion-button-wrapper.right.expanded{left:4px}.expansion-button-wrapper.right.collapsed{left:17px}.expansion-button-wrapper.right .expansion-btn{border-radius:0 8px 8px 0}.expansion-button-wrapper.right .expansion-btn .arrow-icon{transform:rotate(180deg)}.expansion-button-wrapper.right .expansion-btn .arrow-icon.reversed{transform:rotate(0)}.expansion-button-wrapper .expansion-btn{display:flex;justify-content:center;align-items:center;height:100%;cursor:pointer;transition:.3s cubic-bezier(.18,.89,.32,1.28)}.expansion-button-wrapper .expansion-btn.initial{width:16px}.expansion-button-wrapper .expansion-btn.slide-left,.expansion-button-wrapper .expansion-btn.slide-right{width:25px}.expansion-button-wrapper .expansion-btn .arrow-icon{height:16px;width:16px}
`],encapsulation:2})}}class oa{constructor(e,t){this._matIconRegistry=e,this._domSanitizer=t,this._registerIcons()}_registerIcons(){this._matIconRegistry.addSvgIconLiteral("collapse",this._domSanitizer.bypassSecurityTrustHtml(m(14186)))}static{this.\u0275fac=function(t){return new(t||oa)(i.\u0275\u0275inject(U.MatIconRegistry),i.\u0275\u0275inject(y.DomSanitizer))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:oa})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,U.MatIconModule,v.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(oa,{declarations:[ra],imports:[b.CommonModule,U.MatIconModule,v.TranslateModule],exports:[ra]})})();const OM="39px";function PM(a){(0,T.isEmpty)(a.renderStrategy)&&"placeholderSize"in a&&(a.renderStrategy=Sn.OnViewport),a.renderStrategy===Sn.OnViewport&&!a.placeholderSize&&(a.placeholderSize={height:OM})}var Kt;(function(a){a[a.Reuse=0]="Reuse",a[a.Rerender=1]="Rerender"})(Kt||(Kt={}));function kM(a,e){return function(t){c_(a.type);const n=tf(t),s=nf(t),r=sf(t),o={...a,inputs:n,outputs:s,validationInputs:r},l="selector"in a?{...o,selector:a.selector}:{...o,typeRef:t};l.reuseStrategy=a?.reuseStrategy??Kt.Rerender,PM(l),e==="web"?qg(l,t):Kg(l,t)}}function Tn(a){return kM(a,"web")}class jM{constructor(e){this.injector=e}}const RM=new i.InjectionToken("Add delay before enabling skeleton loader");class Be extends jM{set shape(e){this._shape=e;const t=this._classes.indexOf("crt-component-rounded");this.shape==="rounded"?t===-1&&this._classes.push("crt-component-rounded"):t>=0&&this._classes.splice(t,1)}get shape(){return this._shape}get classes(){return this.getClasses()}set classes(e){this.setClasses(e)}get loading(){return this._loading$.value}set loading(e){this._loading$.next(!!e),typeof e=="boolean"&&(e?this.handleStartLoadViewModelAttributes():this.handleFinishLoadViewModelAttributes())}constructor(e){super(e),this.injector=e,this._loading$=new u.BehaviorSubject(!1),this._classes=[],this.destroyed$=new u.Subject,this.loaderVisible=!1,this.documentDirection=null,this.documentDirection=e.get(vn.Directionality)?.value==="rtl"?"rtl":null,this.changeDetectorRef=this.injector.get(i.ChangeDetectorRef),this.directionality=this.injector.get(vn.Directionality),this.elementRef=this.injector.get(i.ElementRef),this._subscribeLoadingChanges()}_subscribeLoadingChanges(){const e=this.injector.get(RM,0,{optional:!0});this._loading$.pipe((0,c.switchMap)(t=>t?(0,u.of)(t).pipe((0,u.delay)(e)):(0,u.of)(t)),(0,c.tap)(t=>{this.loaderVisible=t,this.changeDetectorRef.markForCheck()}),(0,c.takeUntil)(this.destroyed$)).subscribe()}handleStartLoadViewModelAttributes(){}handleFinishLoadViewModelAttributes(){}setClasses(e){this._classes=e||[]}getClasses(){return this._classes}toggleClass(e,t,n){const s=e.indexOf(n);t&&s===-1&&e.push(n),!t&&s>=0&&e.splice(s,1)}switchClass(e,t,n){n.forEach(([s,r])=>{this.toggleClass(e,s===t,r)})}setValuesFromConfig(e,t=[]){const n=(0,T.omit)(e,["id","name","type",...t]);Object.entries(n).forEach(([s,r])=>{this[s]=r})}detectChanges(){this.changeDetectorRef.detectChanges()}isRtl(){return this.directionality.value==="rtl"}focus(){this.elementRef?.nativeElement.focus()}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Be)(i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Be,hostVars:2,hostBindings:function(t,n){t&2&&i.\u0275\u0275attribute("element-name",n.name)("dir",n.documentDirection)},inputs:{name:"name",id:"id",tabIndex:"tabIndex",styles:"styles",shape:"shape",classes:"classes",loading:"loading"},features:[i.\u0275\u0275InheritDefinitionFeature]})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],Be.prototype,"name",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],Be.prototype,"id",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Number)],Be.prototype,"tabIndex",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],Be.prototype,"styles",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String),(0,p.__metadata)("design:paramtypes",[String])],Be.prototype,"shape",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Array),(0,p.__metadata)("design:paramtypes",[Array])],Be.prototype,"classes",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Boolean),(0,p.__metadata)("design:paramtypes",[Boolean])],Be.prototype,"loading",null);var LM=m(26828),VM=m.n(LM),Ee;(function(a){a.None="none",a.Default="default",a.ExtraSmall="extra-small",a.Small="small",a.Medium="medium",a.Large="large",a.ExtraLarge="extra-large",a.X2Large="xxl",a.X3Large="xxxl"})(Ee||(Ee={}));const zM=Object.values(Ee);function Fl(a){return!!a&&typeof a=="string"&&zM.includes(a.toLowerCase())}function Nh(a){if(typeof a=="number")return!0;if(typeof a=="string"){const e=Number.parseInt(a);return String(e)===a}return!1}const FM=["container"],BM={Primary:{key:"primary",value:"#FFFFFF"}},Tv="transparent",vg={alignItems:"stretch"};class De extends Be{static{this._baseColors=Object.values(BM).map(({key:e,value:t})=>({key:e.toLowerCase(),value:t.toLowerCase()}))}set container(e){this._container=e}get container(){return this.featureValues.DisableRemoveDuplicateIDs?this._container:this.elementRef}get isResponsive(){return this.responsiveWidth<Number.MAX_VALUE}get isResponsiveWidth(){return this.elementResponsiveWidth?this.elementWidth<this.elementResponsiveWidth:this.width<this.responsiveWidth}get responsiveWidth(){return 395*this.window.devicePixelRatio}set responsiveWidth(e){throw new Error("responsiveWidth is not supported yet")}constructor(e){super(e),this.injector=e,this.width=Number.MAX_VALUE,this.elementWidth=Number.MAX_VALUE,this.items=[],this.visiblePadding=!0,this.borderRadius=Ee.None,this.stretch=!1,this.fitContent=!0,this.elementResponsiveWidth=0,this.window=this.injector.get(P.ZP),this.featureValues=this.injector.get(oe),this.renderer=this.injector.get(i.Renderer2)}static isBaseColorKey(e){if(e&&typeof e=="string"){const t=e.toLowerCase();return De._baseColors.some(n=>n.key===t)}return!1}static isBaseColorValue(e){if(e&&typeof e=="string"){const t=e.toLowerCase();return De._baseColors.some(n=>n.value===t)}return!1}static getBaseColorKey(e){const t=e.toLowerCase();return De._baseColors.find(n=>n.value===t)?.key}static getBaseColorValue(e){const t=e.toLowerCase();return De._baseColors.find(n=>n.key===t)?.value}_preparePadding(){const{top:e,bottom:t}=this.padding;let{left:n,right:s}=this.padding;return this.isRtl()&&([s,n]=[n,s]),{top:e,bottom:t,left:n,right:s}}_paddingClasses(){const e=[],t=this.padding;if(!t)return e;if((0,T.isObject)(t)){const{top:n,bottom:s,left:r,right:o}=this._preparePadding();return this.applySizeClass("container-padding-top-{0}",n,e),this.applySizeClass("container-padding-bottom-{0}",s,e),this.applySizeClass("container-padding-left-{0}",r,e),this.applySizeClass("container-padding-right-{0}",o,e),e}return this.applySizeClass("container-padding-{0}",t,e),e}_paddingStyles(){const e={},t=this.padding;if(!t)return e;if((0,T.isObject)(t)){const{top:n,bottom:s,left:r,right:o}=this._preparePadding();return this.applySizeStyle("paddingTop",n,e),this.applySizeStyle("paddingBottom",s,e),this.applySizeStyle("paddingLeft",r,e),this.applySizeStyle("paddingRight",o,e),e}return this.applySizeStyle("padding",t,e),e}_borderRadiusClasses(){const e=[],t=this.borderRadius;return t&&t!==Ee.None&&(this.applySizeClass("container-border-radius-{0}",t,e),e.push("container-border-area")),e}_borderRadiusStyles(){const e={},t=this.borderRadius;return t&&(Nh(t)?e.borderRadius=`${t}px`:Fl(t)||(e.borderRadius=t)),e}_colorClasses(){const e=this.color?.toLowerCase(),t=[];return De.isBaseColorKey(e)&&t.push(`container-background-color-${e}`),t}_colorStyles(){const e={};return this.color&&!De.isBaseColorKey(this.color)&&(e.backgroundColor=this.color),e}onScroll(){}applySizeClass(e,t,n){if(typeof t=="string"&&Fl(t)&&t!==Ee.None){const s=we.String.Format(e,t.toLowerCase());n.push(s)}}onResize(){this.window.requestAnimationFrame(()=>{this.zone.run(()=>{this.isResponsive&&(this.width=this.window.innerWidth,this.elementWidth=this.elementRef.nativeElement.clientWidth,this.updateResponsiveStyles(),this.detectChanges())})})}getClasses(){const e=super.getClasses(),t=this._paddingClasses(),n=this._colorClasses(),s=this._borderRadiusClasses();return[...e,...t,...n,...s]}applySizeStyle(e,t,n){t&&(Nh(t)?n[e]=`${t}px`:typeof t=="string"&&!Fl(t)&&(n[e]=t))}setValuesFromConfig(e,t=[]){super.setValuesFromConfig(e,["items"])}get containerStyles(){return{...(0,T.isObject)(this.styles)?this.styles:{},...this._paddingStyles(),...this._borderRadiusStyles(),...this._colorStyles()}}detectChangesAsync(e=null){this.window.requestAnimationFrame(()=>{setTimeout(()=>{this.detectChanges(),e?.()})})}subscribeResize(){this.resizeObserver=new(VM())(()=>this.onResize()),this.container&&this.resizeObserver.observe(this.container.nativeElement)}updateResponsiveStyles(){}ngOnInit(){this.visiblePadding=!this.featureValues.HideDesignPadding}ngAfterViewInit(){this.zone=this.injector.get(i.NgZone),this.subscribeResize()}ngOnDestroy(){super.ngOnDestroy(),this.resizeObserver?.disconnect()}static{this.\u0275fac=function(t){return new(t||De)(i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:De,viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(FM,5),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.container=s.first)}},hostVars:4,hostBindings:function(t,n){t&1&&i.\u0275\u0275listener("scroll",function(){return n.onScroll()}),t&2&&i.\u0275\u0275classProp("stretch",n.stretch)("fit-content",n.fitContent)},inputs:{items:"items",visiblePadding:"visiblePadding",padding:"padding",borderRadius:"borderRadius",color:"color",responsiveWidth:"responsiveWidth",stretch:"stretch",fitContent:"fitContent",elementResponsiveWidth:"elementResponsiveWidth"},features:[i.\u0275\u0275InheritDefinitionFeature]})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Array)],De.prototype,"items",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],De.prototype,"visiblePadding",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],De.prototype,"padding",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],De.prototype,"borderRadius",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",we.String)],De.prototype,"color",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Number),(0,p.__metadata)("design:paramtypes",[Object])],De.prototype,"responsiveWidth",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],De.prototype,"stretch",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],De.prototype,"fitContent",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],De.prototype,"elementResponsiveWidth",void 0);class ca extends De{constructor(){super(...arguments),this.slotHTMLElements=[]}setSlotElementStyles(e){e=this.castSlotElements(e.filter(t=>!(t instanceof Comment))),this.applySlotElementStyles(e)}castSlotElements(e){}getItemLayout(e){}castElementStylesToLayoutConfig(e){}applySlotElementStyles(e){e.forEach(t=>{const n=this.getItemLayout(t.layoutConfig);Object.entries(n).forEach(([s,r])=>{const o=(0,T.kebabCase)(s);this.renderer.setStyle(t,o,r)})})}get shouldUseSlots(){return!this.items||!this.items.length}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ca)))(n||ca)}})()}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:ca,features:[i.\u0275\u0275InheritDefinitionFeature]})}}const UM=["items"],HM=["*"],YM=a=>({containerDiv:a});function ZM(a,e){a&1&&i.\u0275\u0275elementContainer(0)}function WM(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"slot",7),i.\u0275\u0275listener("slotchange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(r.slotChange(s))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275projection(1)}}function $M(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",9),i.\u0275\u0275elementContainer(1,10),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(4);i.\u0275\u0275property("ngStyle",n.getItemLayout(t.layoutConfig)),i.\u0275\u0275advance(),i.\u0275\u0275property("crtViewElement",t)}}function GM(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,$M,2,2,"div",8),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.items)}}function QM(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",9),i.\u0275\u0275elementContainer(1,10),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(4);i.\u0275\u0275property("ngStyle",n.getItemLayout(t.layoutConfig)),i.\u0275\u0275advance(),i.\u0275\u0275property("crtViewElement",t)}}function JM(a,e){if(a&1&&i.\u0275\u0275template(0,QM,2,2,"div",8),a&2){const t=i.\u0275\u0275nextContext(2).containerDiv,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngForOf",n.fixItemsOverlap(n.items,n.useOldTemplate?t:n.elementRef.nativeElement).items)}}function qM(a,e){if(a&1&&i.\u0275\u0275template(0,GM,2,1,"ng-container",5)(1,JM,1,1,"ng-template",null,3,i.\u0275\u0275templateRefExtractor),a&2){const t=i.\u0275\u0275reference(2),n=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngIf",n.gridContainerAllowOverlapFeature)("ngIfElse",t)}}function KM(a,e){if(a&1&&i.\u0275\u0275template(0,ZM,1,0,"ng-container",6)(1,WM,2,0,"ng-template",null,1,i.\u0275\u0275templateRefExtractor)(3,qM,3,2,"ng-template",null,2,i.\u0275\u0275templateRefExtractor),a&2){const t=i.\u0275\u0275reference(2),n=i.\u0275\u0275reference(4),s=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngIf",s.shouldUseSlots)("ngIfThen",t)("ngIfElse",n)}}function XM(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"div",11,4),i.\u0275\u0275elementContainer(3,12),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275reference(2),n=i.\u0275\u0275nextContext(),s=i.\u0275\u0275reference(1);i.\u0275\u0275advance(),i.\u0275\u0275styleProp("grid-template-columns",n.gridTemplateColumns),i.\u0275\u0275property("ngStyle",n.gridStyles)("ngClass",n.classes),i.\u0275\u0275attribute("id",n.id),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngTemplateOutlet",s)("ngTemplateOutletContext",i.\u0275\u0275pureFunction1(7,YM,t))}}const e0={...vg,columnsTemplate:"minmax(32px, 1fr)"};let Ft=class sp extends ca{get hostClasses(){if(!this.useOldTemplate)return this.classes}get hostGridStyles(){if(!this.useOldTemplate)return this.gridStyles}get hostGridTemplateColumns(){if(!this.useOldTemplate)return this.gridTemplateColumns}get gridStyles(){const e={};return this.justifyItems&&(e.justifyItems=this.justifyItems),this.alignItems&&(e.alignItems=this.alignItems),this.isResponsiveWidth&&(e.gridTemplateAreas="initial"),{...this.containerStyles,...e,...this._gapStyles(),...this._rowsStyles(),...this._columnsStyles()}}get gridTemplateColumns(){return this.isResponsiveWidth?e0.columnsTemplate:this.gridStyles.gridTemplateColumns}constructor(e){super(e),this.injector=e,this._containerClasses=[],this.useOldTemplate=!1,this._gridContainerItemsLayoutService=this.injector.get(Xs),this.gridContainerAllowOverlapFeature=!!this.featureValues.GridContainerAllowOverlap}_gapStyles(){const e={},t=this.gap;if((0,T.isObject)(t)){const{columnGap:n,rowGap:s}=t;this.applySizeStyle("columnGap",n,e),this.applySizeStyle("rowGap",s,e)}else this.applySizeStyle("gap",this.gap,e);return e}_rowsStyles(){const e={};return this.isResponsiveWidth?e.gridAutoRows="max-content":typeof this.rows=="string"?e.gridAutoRows=this.rows:this.rows instanceof Array&&(e.gridTemplateRows=this.rows.join(" ")),e}_columnsStyles(){const e={};return typeof this.columns=="string"?e.gridAutoColumns=this.columns:this.columns instanceof Array&&(e.gridTemplateColumns=this.columns.join(" ")),e}_gridTemplateColumnsClasses(){const e=[];return this.isResponsiveWidth&&e.push("crt-grid-responsive"),e}_gapClasses(){const e=[],t=this.gap;if(t)if((0,T.isObject)(t)){const{columnGap:n,rowGap:s}=t;this.applySizeClass("container-column-gap-{0}",n,e),this.applySizeClass("container-row-gap-{0}",s,e)}else this.applySizeClass("container-gap-{0}",t,e);return e}_fullLayoutConfig(e){const t={};let n="";e?.column!==void 0&&(n+=e.column),e?.colSpan!==void 0&&(n&&(n+="/"),e.colSpan!==-1&&(n+="span "),n+=e.colSpan);let s="";return e?.row!==void 0&&(s+=e.row),e?.rowSpan!==void 0&&(s&&(s+="/"),e.rowSpan!==-1&&(s+="span "),s+=e.rowSpan),n&&(t.gridColumn=n),s&&(t.gridRow=s),t}_responsiveLayoutConfig(e){const t={},n=e?.rowSpan;return n!==void 0&&n!==-1&&(t.gridRow=`span ${n}`),t}_computedGridColumns(e){return getComputedStyle(e).getPropertyValue("container-template-columns").split(" ")}_applySlotElementsResponsiveStyles(e){for(const t of e){const n=t?.layoutConfig?.rowSpan;n!==void 0&&n!==-1&&(this.renderer.setStyle(t,"grid-row-start",`span ${n}`),this.renderer.setStyle(t,"grid-row-end","auto")),this.renderer.setStyle(t,"grid-column-start","auto"),this.renderer.setStyle(t,"grid-column-end","auto")}}getClasses(){const e=super.getClasses()||[],t=this._gridTemplateColumnsClasses(),n=this._gapClasses(),s=[...e,"crt-grid",...t,...n].sort((r,o)=>r.localeCompare(o));return(0,T.isEqual)(this._containerClasses,s)||(this._containerClasses=s),this._containerClasses}applySlotElementStyles(e){if(this.isResponsiveWidth){this._applySlotElementsResponsiveStyles(e);return}super.applySlotElementStyles(e)}castElementStylesToLayoutConfig(e){const[t,n,s,r]=["row","column","row-span","col-span"].map(o=>{const l=`layout-config-${o}`,d=e.getAttribute(l);if(d)return Number(d)});return{row:t,column:n,rowSpan:s,colSpan:r}}castSlotElements(e){for(const t of e)t.layoutConfig=this.castElementStylesToLayoutConfig(t);if(!this.gridContainerAllowOverlapFeature&&this.container?.nativeElement){const t=e.map(n=>({layoutConfig:n.layoutConfig}));this.fixItemsOverlap(t,this.container.nativeElement)}return e}onResize(){super.onResize(),this.shouldUseSlots&&this.window.requestAnimationFrame(()=>{this.zone.run(()=>{this.setSlotElementStyles(this.slotHTMLElements)})})}getItemLayout(e){return e?this.isResponsiveWidth?this._responsiveLayoutConfig(e):this._fullLayoutConfig(e):null}fixItemsOverlap(e,t){let n=[];if(this.allowOverlap!==!0&&e){const s=this._computedGridColumns(t);n=this._gridContainerItemsLayoutService.fixItemsOverlap(e,s.length).affectedItems}return{items:e,affectedItems:n}}slotChange(e){const t=e.target.assignedNodes();!t||!t.length||(this.slotHTMLElements=t,this.setSlotElementStyles(this.slotHTMLElements))}updateResponsiveStyles(){if(this.useOldTemplate)return;const e=this.elementRef.nativeElement;this.isResponsiveWidth?this.renderer.addClass(e,"crt-grid-responsive"):this.renderer.removeClass(e,"crt-grid-responsive"),this.renderer.setStyle(e,"grid-template-areas",this.isResponsiveWidth?"initial":null),this.renderer.setStyle(e,"grid-template-columns",this.gridTemplateColumns??null)}ngOnInit(){super.ngOnInit(),this.useOldTemplate=this.featureValues.DisableRemoveDuplicateIDs}ngAfterContentInit(){this.children.changes.pipe((0,c.startWith)(this.children),(0,c.takeUntil)(this.destroyed$)).subscribe(()=>{const e=this.children.map(({nativeElement:t})=>t);e?.length&&(this.slotHTMLElements=e,this.setSlotElementStyles(this.slotHTMLElements))})}static{this.\u0275fac=function(t){return new(t||sp)(i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:sp,selectors:[["crt-grid"]],contentQueries:function(t,n,s){if(t&1&&i.\u0275\u0275contentQuery(s,UM,4,i.ElementRef),t&2){let r;i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n.children=r)}},hostVars:6,hostBindings:function(t,n){t&2&&(i.\u0275\u0275styleMap(n.hostGridStyles),i.\u0275\u0275classMap(n.hostClasses),i.\u0275\u0275styleProp("grid-template-columns",n.hostGridTemplateColumns))},inputs:{rows:"rows",columns:"columns",gap:"gap",justifyItems:"justifyItems",alignItems:"alignItems",allowOverlap:"allowOverlap"},features:[i.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:HM,decls:3,vars:2,consts:[["template",""],["slotsTemplate",""],["itemsTemplate",""],["fixItemsLayoutConfig",""],["container",""],[4,"ngIf","ngIfElse"],[4,"ngIf","ngIfThen","ngIfElse"],[3,"slotchange"],[3,"ngStyle",4,"ngFor","ngForOf"],[3,"ngStyle"],[3,"crtViewElement"],[1,"crt-grid",3,"ngStyle","ngClass"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,n){if(t&1&&(i.\u0275\u0275projectionDef(),i.\u0275\u0275template(0,KM,5,3,"ng-template",null,0,i.\u0275\u0275templateRefExtractor)(2,XM,4,9,"ng-container",5)),t&2){const s=i.\u0275\u0275reference(1);i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.useOldTemplate)("ngIfElse",s)}},dependencies:[b.NgClass,b.NgForOf,b.NgIf,b.NgTemplateOutlet,b.NgStyle,xt],encapsulation:2})}};(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],Ft.prototype,"rows",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],Ft.prototype,"columns",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],Ft.prototype,"gap",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],Ft.prototype,"justifyItems",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],Ft.prototype,"alignItems",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Boolean)],Ft.prototype,"allowOverlap",void 0),Ft=(0,p.__decorate)([Tn({type:"crt.GridContainer",contentSlots:["items"],reuseStrategy:Kt.Reuse}),(0,p.__metadata)("design:paramtypes",[i.Injector])],Ft);function et(){return function(a,e){Reflect.defineMetadata(Oc+e.toString(),{},a.constructor)}}const t0=["items"],n0=["*"];function i0(a,e){a&1&&i.\u0275\u0275elementContainer(0)}function s0(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"slot",5),i.\u0275\u0275listener("slotchange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(r.slotChange(s))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275projection(1)}}function a0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",7),i.\u0275\u0275elementContainer(1,8),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(3);i.\u0275\u0275property("ngStyle",n.getItemLayout(t.layoutConfig)),i.\u0275\u0275advance(),i.\u0275\u0275property("crtViewElement",t)}}function r0(a,e){if(a&1&&i.\u0275\u0275template(0,a0,2,2,"div",6),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngForOf",t.items)}}function o0(a,e){if(a&1&&i.\u0275\u0275template(0,i0,1,0,"ng-container",4)(1,s0,2,0,"ng-template",null,1,i.\u0275\u0275templateRefExtractor)(3,r0,1,1,"ng-template",null,2,i.\u0275\u0275templateRefExtractor),a&2){const t=i.\u0275\u0275reference(2),n=i.\u0275\u0275reference(4),s=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngIf",s.shouldUseSlots)("ngIfThen",t)("ngIfElse",n)}}function c0(a,e){a&1&&i.\u0275\u0275elementContainer(0)}function l0(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"div",9),i.\u0275\u0275listener("scroll",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onInnerScroll())}),i.\u0275\u0275template(2,c0,1,0,"ng-container",10),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()}if(a&2){const t=i.\u0275\u0275nextContext(),n=i.\u0275\u0275reference(1);i.\u0275\u0275advance(),i.\u0275\u0275styleProp("flex-direction",t.flexDirection),i.\u0275\u0275property("ngStyle",t.flexStyles)("ngClass",t.classes),i.\u0275\u0275attribute("id",t.id)("flex-direction",t.flexDirection)("role",t.role),i.\u0275\u0275advance(),i.\u0275\u0275property("ngTemplateOutlet",n)}}const Ri={...vg,direction:"row",justifyContent:"start",gap:Ee.Small};let wt=class cu extends ca{constructor(){super(...arguments),this._containerClasses=[],this.useOldTemplate=!1,this.direction=Ri.direction,this.justifyContent=Ri.justifyContent,this.alignItems=Ri.alignItems,this.gap=Ri.gap,this.innerScroll=new i.EventEmitter}get hostClasses(){if(!this.useOldTemplate)return this.classes}get hostRole(){if(!this.useOldTemplate)return this.role}getClasses(){const t=[...super.getClasses(),"crt-flex",...this._gapClasses()].sort();return(0,T.isEqual)(this._containerClasses,t)||(this._containerClasses=t),this._containerClasses}_gapClasses(){const e=[],t=this.gap||Ri.gap;return this.applySizeClass("container-gap-{0}",t,e),e}castElementStylesToLayoutConfig(e){const[t,n,s,r,o,l,d,h,f,I]=["basis","align-self","grow","shrink","width","height","min-width","max-width","min-height","max-height"].map(O=>{const B=`layout-config-${O}`,J=e.getAttribute(B);if(J)return J});return{basis:t,alignSelf:n,grow:Number(s),shrink:Number(r),width:Number(o),height:Number(l),minWidth:Number(d),maxWidth:Number(h),minHeight:Number(f),maxHeight:Number(I)}}castSlotElements(e){for(const t of e){const n=this.castElementStylesToLayoutConfig(t);t.layoutConfig=n}return e}get hostFlexStyles(){if(!this.useOldTemplate)return this.flexStyles}get flexStyles(){const e={};e.justifyContent=this.justifyContent||Ri.justifyContent,e.alignItems=this.alignItems||Ri.alignItems,e.flexWrap=this.wrap||(this.isVertical?"nowrap":"wrap");const t=this.gap;return t&&(Nh(t)?e.gap=t+"px":Fl(t)||(e.gap=t)),{...this.containerStyles,...e}}get hostFlexDirection(){if(!this.useOldTemplate)return this.direction||this.styles?.flexDirection}get flexDirection(){return this.isVertical?this.direction||this.styles?.flexDirection:this.direction||this.styles?.flexDirection}get isVertical(){return["column","column-reverse"].includes(this.direction)}getItemLayout(e){let t={};return e?.basis&&(e.basis==="fit-content"?this.direction==="column"?t.height="fit-content":t.width="fit-content":t.flexBasis=e.basis),e?.grow!==void 0&&(t.flexGrow=e.grow),e?.shrink!==void 0&&(t.flexShrink=e.shrink),e?.alignSelf&&(t.alignSelf=e.alignSelf),e?.width&&(t.width=`${e.width}px`,t.minWidth=`${e.width}px`),e?.minWidth&&(t.minWidth=`${e.minWidth}px`),e?.maxWidth&&(t.maxWidth=`${e.maxWidth}px`),e?.height&&(t.height=`${e.height}px`,t.minHeight=`${e.height}px`),e?.minHeight&&(t.minHeight=`${e.minHeight}px`),e?.maxHeight&&(t.maxHeight=`${e.maxHeight}px`),e&&e.styles&&(t={...t,...e.styles}),t}ngOnInit(){super.ngOnInit(),this.useOldTemplate=!!this.featureValues.DisableRemoveDuplicateIDs}ngAfterContentInit(){this.children.changes.pipe((0,c.startWith)(this.children),(0,c.takeUntil)(this.destroyed$)).subscribe(()=>{const e=this.children.map(({nativeElement:t})=>t);e?.length&&(this.slotHTMLElements=e,this.setSlotElementStyles(this.slotHTMLElements))})}slotChange(e){const t=e.target.assignedNodes();!t||!t.length||(this.slotHTMLElements=t,this.setSlotElementStyles(this.slotHTMLElements))}onHostInnerScroll(){this.useOldTemplate||this.innerScroll.emit()}onInnerScroll(){this.innerScroll.emit()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(cu)))(n||cu)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:cu,selectors:[["crt-flex"]],contentQueries:function(t,n,s){if(t&1&&i.\u0275\u0275contentQuery(s,t0,4,i.ElementRef),t&2){let r;i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n.children=r)}},hostVars:8,hostBindings:function(t,n){t&1&&i.\u0275\u0275listener("scroll",function(){return n.onHostInnerScroll()}),t&2&&(i.\u0275\u0275attribute("role",n.hostRole)("flex-direction",n.hostFlexDirection),i.\u0275\u0275styleMap(n.hostFlexStyles),i.\u0275\u0275classMap(n.hostClasses),i.\u0275\u0275styleProp("flex-direction",n.hostFlexDirection))},inputs:{direction:"direction",justifyContent:"justifyContent",wrap:"wrap",alignItems:"alignItems",gap:"gap",role:"role"},outputs:{innerScroll:"innerScroll"},features:[i.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:n0,decls:3,vars:2,consts:[["template",""],["slotsTemplate",""],["itemsTemplate",""],[4,"ngIf","ngIfElse"],[4,"ngIf","ngIfThen","ngIfElse"],[3,"slotchange"],["class","crt-view-element-container",3,"ngStyle",4,"ngFor","ngForOf"],[1,"crt-view-element-container",3,"ngStyle"],[3,"crtViewElement"],[3,"scroll","ngStyle","ngClass"],[4,"ngTemplateOutlet"]],template:function(t,n){if(t&1&&(i.\u0275\u0275projectionDef(),i.\u0275\u0275template(0,o0,5,3,"ng-template",null,0,i.\u0275\u0275templateRefExtractor)(2,l0,3,8,"ng-container",3)),t&2){const s=i.\u0275\u0275reference(1);i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.useOldTemplate)("ngIfElse",s)}},dependencies:[b.NgClass,b.NgForOf,b.NgIf,b.NgTemplateOutlet,b.NgStyle,xt],encapsulation:2})}};(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],wt.prototype,"direction",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],wt.prototype,"justifyContent",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],wt.prototype,"wrap",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],wt.prototype,"alignItems",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],wt.prototype,"gap",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],wt.prototype,"role",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],wt.prototype,"innerScroll",void 0),wt=(0,p.__decorate)([Tn({type:"crt.FlexContainer",contentSlots:["items"],reuseStrategy:Kt.Reuse})],wt);function u0(a,e){if(a&1&&i.\u0275\u0275elementContainer(0,3),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("crtViewModel",t)("crtViewElement",n.itemViewConfig)}}function d0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275template(1,u0,1,2,"ng-container",2),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.viewModels)}}let Li=class lu extends Be{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(lu)))(n||lu)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:lu,selectors:[["ts-component-list"]],inputs:{itemViewConfig:"itemViewConfig",viewModels:"viewModels"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:2,vars:4,consts:[[1,"ts-component-list",3,"ngStyle","ngClass"],[4,"ngIf"],[3,"crtViewModel","crtViewElement",4,"ngFor","ngForOf"],[3,"crtViewModel","crtViewElement"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,d0,2,1,"div",1),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275property("ngStyle",n.styles)("ngClass",n.classes),i.\u0275\u0275attribute("id",n.id),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.viewModels))},dependencies:[b.NgClass,b.NgForOf,b.NgIf,b.NgStyle,Di,xt],encapsulation:2})}};(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],Li.prototype,"itemViewConfig",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",ft)],Li.prototype,"viewModels",void 0),Li=(0,p.__decorate)([Tn({type:"crt.ComponentList",reuseStrategy:Kt.Reuse})],Li);let Bl=class uu extends Be{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(uu)))(n||uu)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:uu,selectors:[["ts-list"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:16,vars:3,consts:[[1,"ts-list",3,"ngStyle","ngClass"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0)(1,"ul")(2,"li"),i.\u0275\u0275text(3,"1 Item"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"li"),i.\u0275\u0275text(5,"2 Item"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(6,"li"),i.\u0275\u0275text(7,"3 Item"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(8,"li"),i.\u0275\u0275text(9,"4 Item"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(10,"li"),i.\u0275\u0275text(11,"5 Item"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(12,"li"),i.\u0275\u0275text(13,"6 Item"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(14,"li"),i.\u0275\u0275text(15,"7 Item"),i.\u0275\u0275elementEnd()()()),t&2&&(i.\u0275\u0275property("ngStyle",n.styles)("ngClass",n.classes),i.\u0275\u0275attribute("id",n.id))},dependencies:[b.NgClass,b.NgStyle],encapsulation:2})}};Bl=(0,p.__decorate)([Tn({type:"crt.List",reuseStrategy:Kt.Reuse})],Bl);const h0=["*"],p0=a=>({"actions-menu-button-with-icon":a});function m0(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",11),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("svgIcon",t.config.trigger.svgIconName)}}function g0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",12),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.config.trigger.caption)}}function f0(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",6),i.\u0275\u0275listener("menuOpened",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onMenuOpened())}),i.\u0275\u0275template(1,m0,1,1,"mat-icon",7)(2,g0,2,1,"span",8),i.\u0275\u0275elementStart(3,"div",9),i.\u0275\u0275element(4,"div",10),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext(),n=i.\u0275\u0275reference(4);i.\u0275\u0275property("matMenuTriggerFor",n)("disabled",t.config.trigger.disabled),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.config.trigger.svgIconName),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.config.trigger.caption)}}function _0(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-divider"),a&2){const t=i.\u0275\u0275nextContext().index;i.\u0275\u0275styleProp("visibility",t===0?"hidden":"visible")}}function y0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",15),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.caption)}}function C0(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",23),a&2){const t=i.\u0275\u0275nextContext(3).$implicit;i.\u0275\u0275property("svgIcon",t.svgIconName)}}function M0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",21),i.\u0275\u0275template(1,C0,1,1,"mat-icon",22),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2).$implicit;i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.svgIconName)}}function I0(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",16),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext().$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.onMenuItemContainerClick(s,r))}),i.\u0275\u0275elementStart(1,"button",17),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext().$implicit,r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onMenuItemClick(s))}),i.\u0275\u0275elementStart(2,"div",18),i.\u0275\u0275template(3,M0,2,1,"span",19),i.\u0275\u0275elementStart(4,"span",20),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd()()()()}if(a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("disabled",n.isMenuItemDisabled(t))("ngClass",i.\u0275\u0275pureFunction1(4,p0,n.hasIcons())),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.hasIcons()),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.caption)}}function b0(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,_0,1,2,"mat-divider",13)(2,y0,2,1,"div",14)(3,I0,6,6,"ng-template",null,1,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementContainerEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275reference(4),s=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.code===s.dividerItemCode)("ngIfElse",n),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.code===s.dividerItemCode&&t.caption)}}const Ul={code:"__divider",caption:null};Object.freeze(Ul);class Ao{constructor(){this.menuItemClick=new i.EventEmitter}static{this.\u0275fac=function(t){return new(t||Ao)}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Ao,outputs:{menuItemClick:"menuItemClick"}})}}class Vi extends Ao{constructor(){super(...arguments),this.dividerItemCode=Ul.code}isMenuItemDisabled(e){return e.disabled===!0}onMenuItemClick(e){e.handler&&e.handler(),this.menuItemClick.emit(e.code)}onMenuItemContainerClick(e,t){this.isMenuItemDisabled(t)&&e.stopPropagation()}hasIcons(){return this.config?.menuItems?.some(e=>e.svgIconName)}trackByCode(e,t){return t.code}onMenuOpened(){this.visibleMenuItems=this.config?.menuItems?.filter(e=>!e.hidden)??[]}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Vi)))(n||Vi)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Vi,selectors:[["ts-actions-menu"]],inputs:{config:"config"},features:[i.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:h0,decls:6,vars:7,consts:[["menu","matMenu"],["menuItem",""],[1,"actions-menu-trigger-wrapper",3,"menuOpened","matMenuTriggerFor"],["mat-button","","class","actions-menu-trigger default",3,"matMenuTriggerFor","disabled","menuOpened",4,"ngIf"],[1,"actions-menu-panel",3,"overlapTrigger"],[4,"ngFor","ngForOf","ngForTrackBy"],["mat-button","",1,"actions-menu-trigger","default",3,"menuOpened","matMenuTriggerFor","disabled"],["class","actions-menu-trigger-icon",3,"svgIcon",4,"ngIf"],["class","actions-menu-trigger-caption",4,"ngIf"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],[1,"actions-menu-trigger-icon",3,"svgIcon"],[1,"actions-menu-trigger-caption"],[3,"visibility",4,"ngIf","ngIfElse"],["class","menu-divider-caption",4,"ngIf"],[1,"menu-divider-caption"],[3,"click"],["mat-menu-item","",3,"click","disabled","ngClass"],[1,"actions-menu-item-button-content"],["class","actions-menu-item-icon-wrapper",4,"ngIf"],[1,"actions-menu-item-text"],[1,"actions-menu-item-icon-wrapper"],[3,"svgIcon",4,"ngIf"],[3,"svgIcon"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275projectionDef(),i.\u0275\u0275elementStart(0,"div",2),i.\u0275\u0275listener("menuOpened",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onMenuOpened())}),i.\u0275\u0275projection(1),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(2,f0,5,4,"button",3),i.\u0275\u0275elementStart(3,"mat-menu",4,0),i.\u0275\u0275template(5,b0,5,3,"ng-container",5),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(4);i.\u0275\u0275property("matMenuTriggerFor",s),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.config==null?null:n.config.trigger),i.\u0275\u0275advance(),i.\u0275\u0275classMap(n.config==null?null:n.config.cssClasses),i.\u0275\u0275property("overlapTrigger",n.config==null?null:n.config.overlapTrigger),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",n.visibleMenuItems)("ngForTrackBy",n.trackByCode)}},dependencies:[b.NgClass,b.NgForOf,b.NgIf,W.MatButton,jt.MatDivider,U.MatIcon,R.MatMenu,R.MatMenuItem,R.MatMenuTrigger],styles:[`ts-actions-menu .actions-menu-trigger-wrapper{display:flex;align-items:center}.mat-mdc-menu-content .menu-divider-caption{padding:0 16px;text-transform:uppercase;font-size:14px;color:#4b7fc7;height:33px;line-height:33px}.actions-menu-panel{max-width:500px!important}.actions-menu-panel button.mat-mdc-menu-item{height:33px!important;line-height:33px!important;min-height:unset!important;padding-right:30px}.actions-menu-panel button.mat-mdc-menu-item.actions-menu-button-with-icon{padding-left:12px!important}.actions-menu-panel button.mat-mdc-menu-item .actions-menu-item-button-content{display:flex;flex-direction:row;align-items:center}.actions-menu-panel button.mat-mdc-menu-item .actions-menu-item-button-content .actions-menu-item-icon-wrapper{width:16px;height:16px;padding-right:8px;line-height:16px}.actions-menu-panel button.mat-mdc-menu-item .actions-menu-item-button-content .actions-menu-item-icon-wrapper mat-icon{width:16px;height:16px;margin:0!important}.actions-menu-panel mat-divider{margin:5px 12px}
`],encapsulation:2,changeDetection:0})}}class Tg{constructor(e){Object.assign(this,e)}}class xv extends Tg{constructor(e){super(e),this.externalLink=!1}}class Eh extends Tg{}var S0=m(81398);function v0(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-checkbox",1),i.\u0275\u0275listener("change",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.setValue(s.checked))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("disabled",t.isDisabled())("checked",t.getValue())("matTooltip",t.getTooltipText())}}class wv extends Eh{constructor(e){super(e),this.cellComponentClass=zi,this.valueType=C.r.Boolean}}class zi extends S0.P{isDisabled(){const e=this.columnDataSchema.disabled;return typeof e=="function"?e(this.record):e}getTooltipText(){const e=this.columnDataSchema.tooltip;return typeof e=="function"?e(this.record):e}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(zi)))(n||zi)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:zi,selectors:[["ts-checkbox-table-cell"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"disabled","checked","matTooltip","change",4,"ngIf"],[3,"change","disabled","checked","matTooltip"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,v0,1,3,"mat-checkbox",0),t&2&&i.\u0275\u0275property("ngIf",!n.isEmpty())},dependencies:[b.NgIf,Rt.MatCheckbox,vt.MatTooltip],encapsulation:2})}}const T0=(a,e,t)=>({menuItems:a,overlapTrigger:e,cssClasses:t});class la extends Ao{constructor(e,t){super(),this._matIconRegistry=e,this._domSanitizer=t,this.menuItems=[],this.cssClasses="",this.overlapTrigger=!0,this._registerIcons()}_registerIcons(){this._matIconRegistry.addSvgIconLiteral("vertical-dots",this._domSanitizer.bypassSecurityTrustHtml(m(112)))}static{this.\u0275fac=function(t){return new(t||la)(i.\u0275\u0275directiveInject(U.MatIconRegistry),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:la,selectors:[["ts-compact-actions-menu"]],inputs:{menuItems:"menuItems",cssClasses:"cssClasses",overlapTrigger:"overlapTrigger"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:2,vars:5,consts:[[3,"menuItemClick","config"],["svgIcon","vertical-dots"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"ts-actions-menu",0),i.\u0275\u0275listener("menuItemClick",function(r){return n.menuItemClick.emit(r)}),i.\u0275\u0275element(1,"mat-icon",1),i.\u0275\u0275elementEnd()),t&2&&i.\u0275\u0275property("config",i.\u0275\u0275pureFunction3(1,T0,n.menuItems,n.overlapTrigger,n.cssClasses))},dependencies:[U.MatIcon,Vi],styles:["[_nghost-%COMP%]{display:block}mat-icon[_ngcontent-%COMP%]{width:16px;height:16px;cursor:pointer}"],changeDetection:0})}}class x0{}class Oo{constructor(){this._value=new x0,this.valueChange=new i.EventEmitter}get startDate(){return this._startDate}set startDate(e){e.isSame(this._startDate)||(this._value.startDate=e.toDate(),this._startDate=e)}get endDate(){return this._endDate}set endDate(e){e.isSame(this._endDate)||(this._value.endDate=e.toDate(),this._endDate=e)}set value(e){const t={startDate:pf(e.startDate),endDate:Dp(e.endDate)};this._value=t,this._startDate=Rl()(t.startDate),this._endDate=Rl()(t.endDate)}get value(){return this._value}onValueChanged(){this.value.endDate=Dp(this.value.endDate),this.valueChange.emit(this.value)}static{this.\u0275fac=function(t){return new(t||Oo)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Oo,selectors:[["ts-date-range"]],inputs:{startDateRequired:"startDateRequired",endDateRequired:"endDateRequired",maxDate:"maxDate",value:"value"},outputs:{valueChange:"valueChange"},decls:15,vars:14,consts:[["startDatePicker",""],["endDatePicker",""],["floatLabel","never",1,"date-picker"],["matInput","",3,"ngModelChange","dateChange","max","matDatepicker","ngModel","disabled"],["matSuffix","",3,"for"],["svgIcon","start-date","matDatepickerToggleIcon","",1,"date-picker-icon"],["disabled","false"],[1,"period-separator"],["matInput","",3,"ngModelChange","dateChange","min","max","matDatepicker","ngModel","disabled"],["svgIcon","end-date","matDatepickerToggleIcon","",1,"date-picker-icon"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",2)(1,"input",3),i.\u0275\u0275twoWayListener("ngModelChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.startDate,o)||(n.startDate=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275listener("dateChange",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onValueChanged())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(2,"mat-datepicker-toggle",4),i.\u0275\u0275element(3,"mat-icon",5),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(4,"mat-datepicker",6,0),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(6,"span",7),i.\u0275\u0275text(7),i.\u0275\u0275pipe(8,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(9,"mat-form-field",2)(10,"input",8),i.\u0275\u0275twoWayListener("ngModelChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.endDate,o)||(n.endDate=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275listener("dateChange",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onValueChanged())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(11,"mat-datepicker-toggle",4),i.\u0275\u0275element(12,"mat-icon",9),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(13,"mat-datepicker",6,1),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(5),r=i.\u0275\u0275reference(14);i.\u0275\u0275advance(),i.\u0275\u0275property("max",n.value.endDate)("matDatepicker",s),i.\u0275\u0275twoWayProperty("ngModel",n.startDate),i.\u0275\u0275property("disabled",n.startDateRequired),i.\u0275\u0275advance(),i.\u0275\u0275property("for",s),i.\u0275\u0275advance(5),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(8,12,"DateRange.To")),i.\u0275\u0275advance(3),i.\u0275\u0275property("min",n.value.startDate)("max",n.maxDate)("matDatepicker",r),i.\u0275\u0275twoWayProperty("ngModel",n.endDate),i.\u0275\u0275property("disabled",n.endDateRequired),i.\u0275\u0275advance(),i.\u0275\u0275property("for",r)}},dependencies:[Z.DefaultValueAccessor,Z.NgControlStatus,Z.NgModel,zn.MatDatepicker,zn.MatDatepickerInput,zn.MatDatepickerToggle,zn.MatDatepickerToggleIcon,K.MatFormField,K.MatSuffix,U.MatIcon,re.MatInput,v.TranslatePipe],styles:["[_nghost-%COMP%]{display:flex}[_nghost-%COMP%]   .period-separator[_ngcontent-%COMP%]{padding-left:16px;padding-right:16px;padding-top:5px}[_nghost-%COMP%]   .date-picker-icon[_ngcontent-%COMP%]{width:20px!important;height:20px;padding-bottom:4px}[_nghost-%COMP%]   .date-picker-icon[_ngcontent-%COMP%]     svg{width:20px;height:20px}[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-bottom:-1em}"]})}}var Dh=m(91592);class ua extends Dh.X{constructor(){super(...arguments),this.getRegisteredEvents=()=>[{name:"click"}]}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ua)))(n||ua)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ua,selectors:[["ts-delete-button-table-cell"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:3,vars:3,consts:[["mat-icon-button","",1,"trash-icon",3,"click","title"],["svgIcon","trash"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"button",0),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275listener("click",function(){return n.fireEvent("click")}),i.\u0275\u0275element(2,"mat-icon",1),i.\u0275\u0275elementEnd()),t&2&&i.\u0275\u0275property("title",i.\u0275\u0275pipeBind1(1,1,"DeleteButtonTableCell.Tooltip"))},dependencies:[W.MatIconButton,U.MatIcon,v.TranslatePipe],encapsulation:2})}}var Po;(function(a){a[a.Error=1]="Error",a[a.Warning=2]="Warning",a[a.Information=4]="Information"})(Po||(Po={}));function w0(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",1),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("svgIcon",t.svgIconName)}}class Nv extends Eh{constructor(e){super(e),this.cellComponentClass=da}}class da extends Dh.X{get svgIconName(){return{[Po.Error]:this.errorIconName,[Po.Warning]:this.warningIconName,[Po.Information]:""}[this.getValue()]??""}constructor(e,t){super(),this._matIconRegistry=e,this._domSanitizer=t,this.errorIconName="error-icon",this.warningIconName="warning-icon",this._registerIcons()}_registerIcons(){[this.warningIconName,this.errorIconName].forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(m(48422)("./"+e+".svg")))})}static{this.\u0275fac=function(t){return new(t||da)(i.\u0275\u0275directiveInject(U.MatIconRegistry),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:da,selectors:[["ts-error-type-icon-table-cell"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","error-type-icon",3,"svgIcon",4,"ngIf"],[1,"error-type-icon",3,"svgIcon"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,w0,1,1,"mat-icon",0),t&2&&i.\u0275\u0275property("ngIf",!n.isEmpty()&&n.getValue())},dependencies:[b.NgIf,U.MatIcon],styles:[".error-type-icon[_ngcontent-%COMP%]{height:16px;width:16px}"]})}}class ko{constructor(e){this._environment=e}getUrl(){const e=this._environment.runtimeApplicationUrl||this._environment.defaultApplicationUrl;return b.Location.joinWithSlash(this._environment.workspaceBaseUrl,e)}static{this.\u0275fac=function(t){return new(t||ko)(i.\u0275\u0275inject("environment"))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ko,factory:ko.\u0275fac,providedIn:"root"})}}const N0=[[["","header",""]],[["","right-container",""]],"*"],E0=["[header]","[right-container]","*"];function D0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",8),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.title)}}class Nt{static{this._logoLinkUrl=""}static{this._logoImageUrl=""}get logoLinkUrl(){return Nt._logoLinkUrl}get logoImageUrl(){return Nt._logoImageUrl}constructor(e,t){this._environment=e,this._runtimeUrlProvider=t}static setLogoLinkUrl(e){Nt._logoLinkUrl=e}static setLogoImageUrl(e){Nt._logoImageUrl=e}buildLogoImageUrl(){return"img/terrasoft.axd?s=nui-binary-syssetting&r=MenuLogoImage&source_hash="+Date.now().toString().slice(0,-5)}initDefaultLogoImageUrl(){Nt.setLogoImageUrl("assets/app-logo.svg")}ngOnInit(){if(!this.logoLinkUrl){const e=this._runtimeUrlProvider.getUrl();Nt.setLogoLinkUrl(e)}this.logoImageUrl||Nt.setLogoImageUrl(b.Location.joinWithSlash(this._environment.workspaceBaseUrl,this.buildLogoImageUrl()))}static{this.\u0275fac=function(t){return new(t||Nt)(i.\u0275\u0275directiveInject("environment"),i.\u0275\u0275directiveInject(ko))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Nt,selectors:[["ts-header"]],inputs:{title:"title"},ngContentSelectors:E0,decls:11,vars:3,consts:[[1,"top-container"],[1,"left-container"],["class","title",4,"ngIf"],[1,"content-wrapper"],[1,"right-container"],[1,"logo-wrapper",3,"href"],["alt","logo image",1,"logo",3,"error","src"],[1,"content-wrapper","bottom-content-wrapper"],[1,"title"]],template:function(t,n){t&1&&(i.\u0275\u0275projectionDef(N0),i.\u0275\u0275elementStart(0,"div",0)(1,"div",1),i.\u0275\u0275template(2,D0,2,1,"span",2),i.\u0275\u0275elementStart(3,"div",3),i.\u0275\u0275projection(4),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(5,"div",4),i.\u0275\u0275projection(6,1),i.\u0275\u0275elementStart(7,"a",5)(8,"img",6),i.\u0275\u0275listener("error",function(){return n.initDefaultLogoImageUrl()}),i.\u0275\u0275elementEnd()()()(),i.\u0275\u0275elementStart(9,"div",7),i.\u0275\u0275projection(10,2),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.title),i.\u0275\u0275advance(5),i.\u0275\u0275propertyInterpolate("href",n.logoLinkUrl,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("src",n.logoImageUrl,i.\u0275\u0275sanitizeUrl))},dependencies:[b.NgIf],styles:["[_nghost-%COMP%]{display:block;padding:12px 22px 12px 21px}.top-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:center}.top-container[_ngcontent-%COMP%]   .left-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;overflow:hidden}.top-container[_ngcontent-%COMP%]   .left-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-family:Bpmonline Open Sans Light,serif;font-size:26px;height:26px}.top-container[_ngcontent-%COMP%]   .right-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:16px}.top-container[_ngcontent-%COMP%]   .right-container[_ngcontent-%COMP%]   .logo-wrapper[_ngcontent-%COMP%]{display:block}.top-container[_ngcontent-%COMP%]   .right-container[_ngcontent-%COMP%]   .logo-wrapper[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{height:fit-content;max-height:28px;max-width:134px}.content-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}.content-wrapper[_ngcontent-%COMP%]:not(:empty).top-left-content-wrapper:not(:first-child){padding-left:15px}.content-wrapper[_ngcontent-%COMP%]:not(:empty).bottom-content-wrapper{margin:14px 0 0}"]})}}function A0(a,e,t){const n=a.toLowerCase();switch(t){case zt.Contains:return n.includes(e);case zt.StartsWith:return n.indexOf(e)===0;case zt.Equals:return n===e}}function O0(a,e=zt.Contains){return q.checkArgumentEmpty("columnSelectors",a),(t,n)=>n?a.some(s=>{const r=typeof s=="string"?t[s]:s(t);return!r||typeof r!="string"?!1:A0(r,n,e)}):!0}var Ah=m(4737);class xg extends Ah.MatTableDataSource{constructor(e=[]){super(e),this._visibleContentSize=0,this._pageSize=40,this.resetVisibleContentSize()}resetVisibleContentSize(){this._visibleContentSize=this._pageSize}loadNext(){this._visibleContentSize+=this._pageSize,this._updateChangeSubscription()}_pageData(e){return this._visibleContentSize>=e.length?e:e.slice(0,this._visibleContentSize)}}const P0=["tableWrapper"],k0=["tableNgContainer"];function j0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",16)(1,"span",17),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"span",18),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,2,"MultiselectDialog.Selected")),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",t.selectedValues.length,"")}}function R0(a,e){a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),a&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,1,"MultiselectDialog.Blankslate")))}function L0(a,e){a&1&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,"MultiselectDialog.BlankslateWithFilters")))}function V0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",19),i.\u0275\u0275template(1,R0,4,3,"ng-container",20)(2,L0,3,3,"ng-template",null,2,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275reference(3),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!n.searchKey)("ngIfElse",t)}}class jo{get searchKey(){return this.searchKeyValue}set searchKey(e){this.searchKeyValue=e,this.tableDataSource.filter=e&&e.trim().toLowerCase()}constructor(e,t,n){this._dialogData=e,this._scrollToBottomObserverFactory=t,this._dialogRef=n,this.searchColumns=[],this.tableData=[],this.searchKeyValue="",this.title="",this.selectedValues=[],this.tableDataSource=new xg}renderTableComponent(e){var t=this;return(0,S.A)(function*(){yield Promise.all([m.e(5783),m.e(2411),m.e(4576)]).then(m.bind(m,24576)).then(n=>{const s=n.TableComponent;t.table=e.createComponent(s).instance,t.table.selectMode=t.selectMode,t.table.dataSchema=t.dataSchema,t.table.dataSource=t.tableDataSource,t.table.sortColumn=t.sortColumn,t.table.sortDirection=t.sortDirection,t.table.showSelectAllButton=t.showSelectAllButton,t.table.headerSticky=!0,t.table.selected=t.selectedValues,t.table.selectedChange.subscribe(r=>t.selectedValues=r),t.table.rowDoubleClick.subscribe(r=>t.closeWithSelection(r))})})()}initDataSource(){this.tableDataSource.data=this.tableData,this.tableDataSource.filterPredicate=O0(this.searchColumns)}loadNextData(){this.tableDataSource.loadNext()}ngOnInit(){var e=this;return(0,S.A)(function*(){!e._dialogData||!e._dialogData.data||(e.tableData=e._dialogData.data,e.dataSchema=e._dialogData.dataSchema,e.sortDirection=e._dialogData.sortDirection||"asc",e.sortColumn=e._dialogData.sortColumn,e.title=e._dialogData.title||e.title,e.selectMode=e._dialogData.selectMode||"multi",e.showSelectAllButton=e._dialogData.showSelectAllButton!==void 0?e._dialogData.showSelectAllButton:!0,e.searchColumns=e._dialogData.searchColumns||[],e.initDataSource(),yield e.renderTableComponent(e.tableNgContainer))})()}ngAfterViewInit(){const e=this.tableWrapper.nativeElement;e&&(this.scrollTableToBottomObserver=this._scrollToBottomObserverFactory.createObserver(e,this.loadNextData.bind(this)))}isEmpty(){return this.table?this.table.isEmpty():!0}closeWithSelection(e){this.selectMode==="single"&&this._dialogRef.close([e])}static{this.\u0275fac=function(t){return new(t||jo)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA),i.\u0275\u0275directiveInject(Kn),i.\u0275\u0275directiveInject(Y.MatDialogRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:jo,selectors:[["ts-multiselect-dialog"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(P0,7),i.\u0275\u0275viewQuery(k0,7,i.ViewContainerRef)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.tableWrapper=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.tableNgContainer=s.first)}},decls:22,vars:14,consts:[["tableWrapper",""],["tableNgContainer",""],["blankslateWithFilters",""],["mat-dialog-title",""],[1,"title"],["mat-icon-button","",1,"close-dialog",3,"mat-dialog-close"],["svgIcon","close",1,"close-button-icon"],[1,"multiselect-dialog-top-panel"],[1,"dialog-filters"],[3,"valueChange","value"],["class","select-counter-container",4,"ngIf"],["mat-dialog-content",""],["class","multiselect-dialog-blank-slate",4,"ngIf"],["mat-dialog-actions",""],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],["mat-flat-button","","color","primary",3,"mat-dialog-close","disabled"],[1,"select-counter-container"],[1,"counter-label"],[1,"counter-value"],[1,"multiselect-dialog-blank-slate"],[4,"ngIf","ngIfElse"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",3)(1,"span",4),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"button",5),i.\u0275\u0275element(5,"mat-icon",6),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(6,"div",7)(7,"div",8)(8,"ts-search-input",9),i.\u0275\u0275twoWayListener("valueChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.searchKey,o)||(n.searchKey=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(9,j0,6,4,"div",10),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(10,"div",11,0),i.\u0275\u0275elementContainer(12,null,1),i.\u0275\u0275template(14,V0,4,2,"div",12),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(15,"div",13)(16,"button",14),i.\u0275\u0275text(17),i.\u0275\u0275pipe(18,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(19,"button",15),i.\u0275\u0275text(20),i.\u0275\u0275pipe(21,"translate"),i.\u0275\u0275elementEnd()()}t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,8,n.title||"MultiselectDialog.Select")),i.\u0275\u0275advance(6),i.\u0275\u0275twoWayProperty("value",n.searchKey),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.selectMode==="multi"),i.\u0275\u0275advance(5),i.\u0275\u0275property("ngIf",n.isEmpty()),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(18,10,"MultiselectDialog.Cancel")),i.\u0275\u0275advance(2),i.\u0275\u0275property("mat-dialog-close",n.selectedValues)("disabled",n.selectedValues.length==0),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(21,12,"MultiselectDialog.Select")))},dependencies:[b.NgIf,W.MatButton,W.MatIconButton,Y.MatDialogClose,Y.MatDialogTitle,Y.MatDialogActions,Y.MatDialogContent,U.MatIcon,ki,v.TranslatePipe],styles:["[_nghost-%COMP%]{padding:4px 10px;width:834px;max-width:100%;min-width:420px;box-sizing:border-box}[mat-dialog-title][_ngcontent-%COMP%]{display:flex}[mat-dialog-title][_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:calc(100% - 20px);display:inline-block;overflow:hidden;text-overflow:ellipsis}.multiselect-dialog-top-panel[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;font-size:14px;font-family:Bpmonline Open Sans,serif;line-height:19px;margin-top:20px;margin-bottom:5px}.multiselect-dialog-top-panel[_ngcontent-%COMP%]   .dialog-filters[_ngcontent-%COMP%]{flex-grow:1}.multiselect-dialog-top-panel[_ngcontent-%COMP%]   .dialog-filters[_ngcontent-%COMP%]   ts-search-input[_ngcontent-%COMP%]{width:max(40%,300px)}.multiselect-dialog-top-panel[_ngcontent-%COMP%]   .select-counter-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center}.multiselect-dialog-top-panel[_ngcontent-%COMP%]   .select-counter-container[_ngcontent-%COMP%]   .counter-label[_ngcontent-%COMP%]{font-size:13px;color:#757575}.multiselect-dialog-top-panel[_ngcontent-%COMP%]   .select-counter-container[_ngcontent-%COMP%]   .counter-value[_ngcontent-%COMP%]{padding-left:3px;font-size:14px;color:#444}[mat-dialog-content][_ngcontent-%COMP%]{overflow:auto!important;max-height:55vh!important;min-height:267px;height:862px}[mat-dialog-content][_ngcontent-%COMP%]   .multiselect-dialog-blank-slate[_ngcontent-%COMP%]{display:flex;justify-content:center;font-size:14px;color:#999;text-align:center}[mat-dialog-actions][_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:flex-end}"]})}}var z0=m(75956);function F0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"a",6),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(2).$implicit,s=i.\u0275\u0275nextContext();i.\u0275\u0275property("routerLink",t),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(s.formatTextValue(n,s.columnDataSchema.valueType))}}function B0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2).$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(n.formatTextValue(t,n.columnDataSchema.valueType))}}function U0(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,F0,2,2,"a",5)(2,B0,2,1,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275reference(3),n=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.columnDataSchema.linkGenerator&&n.columnDataSchema.linkGenerator(n.record))("ngIfElse",t)}}function H0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",2),i.\u0275\u0275element(1,"span",3),i.\u0275\u0275template(2,U0,4,2,"ng-container",4),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",t.isDisplayedAsText())}}class ha extends z0.U{getValue(){if(!this.isDisplayedAsText())throw new Ka("Only text columns can be displayed via NamedFolderTableCellComponent.");return super.getValue()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ha)))(n||ha)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ha,selectors:[["ts-named-folder-table-cell"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["elseBlock",""],["class","named-folder-cell-wrapper",4,"ngIf"],[1,"named-folder-cell-wrapper"],[1,"folder-icon"],[4,"ngIf"],[3,"routerLink",4,"ngIf","ngIfElse"],[3,"routerLink"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,H0,3,1,"div",1),t&2&&i.\u0275\u0275property("ngIf",!n.isEmpty()&&n.getValue())},dependencies:[b.NgIf,ju.RouterLink],styles:[".named-folder-cell-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center}.named-folder-cell-wrapper[_ngcontent-%COMP%]   .folder-icon[_ngcontent-%COMP%]{display:inline-block;width:16px;height:16px;margin-right:8px;background:url(folder-icon.svg) no-repeat}"]})}}var pa;(function(a){a.All="0",a.Section="1",a.Lookup="2"})(pa||(pa={}));class Ro{constructor(){this.value=pa.All,this.valueChange=new i.EventEmitter}onValueChanged(e){this.value=e.value,this.valueChange.emit(this.value)}static{this.\u0275fac=function(t){return new(t||Ro)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ro,selectors:[["ts-object-type-filter"]],inputs:{value:"value"},outputs:{valueChange:"valueChange"},decls:22,vars:14,consts:[["typeViewFilter",""],[1,"type-filter"],["disableOptionCentering","true",3,"valueChange","selectionChange","value"],[1,"filter-type-caption"],["value","0",1,"type-mat-option"],[1,"filter-type-icon","filter-type-icon-0"],["value","1",1,"type-mat-option"],[1,"filter-type-icon","filter-type-icon-1"],["value","2",1,"type-mat-option"],[1,"filter-type-icon","filter-type-icon-2"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",1)(1,"mat-select",2,0),i.\u0275\u0275twoWayListener("valueChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.value,o)||(n.value=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275listener("selectionChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onValueChanged(o))}),i.\u0275\u0275elementStart(3,"mat-select-trigger"),i.\u0275\u0275element(4,"span"),i.\u0275\u0275elementStart(5,"span",3),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(7,"mat-option",4),i.\u0275\u0275element(8,"span",5),i.\u0275\u0275elementStart(9,"span"),i.\u0275\u0275text(10),i.\u0275\u0275pipe(11,"translate"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(12,"mat-option",6),i.\u0275\u0275element(13,"span",7),i.\u0275\u0275elementStart(14,"span"),i.\u0275\u0275text(15),i.\u0275\u0275pipe(16,"translate"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(17,"mat-option",8),i.\u0275\u0275element(18,"span",9),i.\u0275\u0275elementStart(19,"span"),i.\u0275\u0275text(20),i.\u0275\u0275pipe(21,"translate"),i.\u0275\u0275elementEnd()()()()}if(t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("value",n.value),i.\u0275\u0275advance(3),i.\u0275\u0275classMapInterpolate1("filter-type-icon filter-type-icon-",n.value,""),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(s.triggerValue),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(11,8,"ObjectTypeFilter.AllObjects")),i.\u0275\u0275advance(5),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(16,10,"ObjectTypeFilter.Sections")),i.\u0275\u0275advance(5),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(21,12,"ObjectTypeFilter.Lookups"))}},dependencies:[qe.MatOption,K.MatFormField,Ge.MatSelect,Ge.MatSelectTrigger,v.TranslatePipe],styles:["[_nghost-%COMP%]{line-height:16px;padding:4px 10px 0 0;min-width:100px}.filter-type-icon[_ngcontent-%COMP%]{width:16px;height:16px;background-repeat:no-repeat;margin-right:6px;display:inline-block}.filter-type-icon.filter-type-icon-0[_ngcontent-%COMP%]{background-image:url(filter_objects.svg)}.filter-type-icon.filter-type-icon-1[_ngcontent-%COMP%]{background-image:url(filter_sections.svg)}.filter-type-icon.filter-type-icon-2[_ngcontent-%COMP%]{background-image:url(filter_lookups.svg)}"]})}}function Y0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",14),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("value",t),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.caption," ")}}class Lo{constructor(e,t){this.entitySchemaService=e,this.data=t,this.isLoading=!1}_prepareEntityColumns(e){if(!e||!e.success){this.isLoading=!1;return}this.entitySchemaColumns=e.entitySchema.columns,this.entitySchemaColumns.sort((t,n)=>t.caption<n.caption?-1:1),this.data&&this.data.excludeFilter&&(this.entitySchemaColumns=this.entitySchemaColumns.filter(this.data.excludeFilter)),this.isLoading=!1}ngOnInit(){!this.data||!this.data.entitySchemaUId||(this.isLoading=!0,this.entitySchemaService.getEntitySchemaByUId(this.data.entitySchemaUId).subscribe(this._prepareEntityColumns.bind(this)))}onFilteredEntitySchemaColumnSelected(e){const t=e.option.value;this.selectedColumn=t}getEntitySchemaColumnCaption(e){return e&&e.caption}search(e){if(!e){this.filteredEntitySchemaColumns=this.entitySchemaColumns;return}e=e.toLowerCase(),this.filteredEntitySchemaColumns=this.entitySchemaColumns.filter(t=>t.caption.toLowerCase().indexOf(e)!==-1)}static{this.\u0275fac=function(t){return new(t||Lo)(i.\u0275\u0275directiveInject(ht),i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Lo,selectors:[["ts-select-entity-schema-column-dialog"]],decls:22,vars:17,consts:[["auto","matAutocomplete"],["mat-dialog-title",""],["mat-icon-button","",1,"close-dialog",3,"mat-dialog-close"],["svgIcon","close",1,"close-button-icon"],["mat-dialog-actions",""],["mat-flat-button","","color","accent",3,"mat-dialog-close","disabled"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],["mat-dialog-content",""],["floatLabel","never",1,"entity-schema-column"],["type","text","matInput","",3,"input","focus","placeholder","matAutocomplete"],["matSuffix","",1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",1)(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"button",2),i.\u0275\u0275element(5,"mat-icon",3),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(6,"div",4)(7,"button",5),i.\u0275\u0275text(8),i.\u0275\u0275pipe(9,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(10,"button",6),i.\u0275\u0275text(11),i.\u0275\u0275pipe(12,"translate"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(13,"div",7)(14,"mat-form-field",8)(15,"input",9),i.\u0275\u0275pipe(16,"translate"),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.search(o.target.value))})("focus",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.search(""))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(17,"div",10),i.\u0275\u0275element(18,"div",11),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(19,"mat-autocomplete",12,0),i.\u0275\u0275listener("optionSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onFilteredEntitySchemaColumnSelected(o))}),i.\u0275\u0275template(21,Y0,2,2,"mat-option",13),i.\u0275\u0275elementEnd()()}if(t&2){const s=i.\u0275\u0275reference(20);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,9,"SelectEntitySchemaColumnDialog.Title")),i.\u0275\u0275advance(5),i.\u0275\u0275property("mat-dialog-close",n.selectedColumn)("disabled",!n.selectedColumn),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(9,11,"SelectEntitySchemaColumnDialog.Select")," "),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(12,13,"SelectEntitySchemaColumnDialog.Cancel")," "),i.\u0275\u0275advance(4),i.\u0275\u0275property("placeholder",i.\u0275\u0275pipeBind1(16,15,"SelectEntitySchemaColumnDialog.SelectFieldPlaceholder"))("matAutocomplete",s),i.\u0275\u0275advance(4),i.\u0275\u0275property("displayWith",n.getEntitySchemaColumnCaption),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",n.filteredEntitySchemaColumns)}},dependencies:[b.NgForOf,Oe.MatAutocomplete,qe.MatOption,Oe.MatAutocompleteTrigger,W.MatButton,W.MatIconButton,Y.MatDialogClose,Y.MatDialogTitle,Y.MatDialogActions,Y.MatDialogContent,K.MatFormField,K.MatSuffix,U.MatIcon,re.MatInput,v.TranslatePipe],styles:["[_nghost-%COMP%]{padding:4px 10px 0;min-width:420px;min-height:136px}[mat-dialog-actions][_ngcontent-%COMP%]{margin-bottom:23px!important}[mat-dialog-content][_ngcontent-%COMP%]   .field-title[_ngcontent-%COMP%]{font-family:Bpmonline Open Sans,serif;color:#444;font-size:14px;line-height:18px;text-align:left}[mat-dialog-content][_ngcontent-%COMP%]   .entity-schema-column[_ngcontent-%COMP%]{width:100%;line-height:19px;font-size:14px}[mat-dialog-content][_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%;line-height:18px!important}"]})}}const Z0=["dataViewWrapper"],W0=["tableNgContainer"];function $0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",10),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.additionalText)}}function G0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",11)(1,"a",12),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("href",t.helpLinkUrl.url,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.helpLinkUrl.caption)}}function Q0(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"button",13),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"button",14),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("mat-dialog-close",!1),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(3,4,"TableDialog.Cancel")," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("mat-dialog-close",!0),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.continueButtonCaption)}}function J0(a,e){a&1&&(i.\u0275\u0275elementStart(0,"button",13),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"TableDialog.Close")," "))}class Vo{constructor(e,t){this.dialogData=e,this.scrollToBottomObserverFactory=t,this.title="",this.sortColumn="",this.additionalText="",this.continueButtonCaption=""}_renderTableComponent(e){var t=this;return(0,S.A)(function*(){yield Promise.all([m.e(5783),m.e(2411),m.e(4576)]).then(m.bind(m,24576)).then(n=>{const s=n.TableComponent;t._table=e.createComponent(s).instance,t._table.dataSchema=t.dataSchema,t._table.dataSource=t.tableDataSource,t._table.sortColumn=t.sortColumn,t._table.headerSticky=!0})})()}_initScrollToBottomObserver(){const e=this.dataViewWrapper.nativeElement;this._scrollToBottomObserver=this.scrollToBottomObserverFactory.createObserver(e,this._loadNextData.bind(this))}_loadNextData(){this.tableDataSource&&this.tableDataSource.loadNext()}ngAfterViewInit(){this._initScrollToBottomObserver()}ngOnInit(){var e=this;return(0,S.A)(function*(){!e.dialogData||!e.dialogData.data||(e.tableDataSource=new xg(e.dialogData.data),e.dataSchema=e.dialogData.dataSchema,e.title=e.dialogData.title||e.title,e.sortColumn=e.dialogData.sortColumn,e.additionalText=e.dialogData.additionalText,e.helpLinkUrl=e.dialogData.helpLinkUrl,e.continueButtonCaption=e.dialogData.continueButtonCaption,yield e._renderTableComponent(e.tableNgContainer))})()}ngOnDestroy(){this._scrollToBottomObserver&&this._scrollToBottomObserver.destroy()}static{this.\u0275fac=function(t){return new(t||Vo)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA),i.\u0275\u0275directiveInject(Kn))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Vo,selectors:[["ts-table-dialog"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(Z0,7),i.\u0275\u0275viewQuery(W0,7,i.ViewContainerRef)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.dataViewWrapper=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.tableNgContainer=s.first)}},decls:14,vars:5,consts:[["dataViewWrapper",""],["tableNgContainer",""],["withoutContinue",""],["mat-dialog-title",""],[1,"dialog-content-wrapper"],["class","table-dialog-additional-text",4,"ngIf"],["class","table-dialog-help-link-url",4,"ngIf"],["mat-dialog-content","",1,"data-table"],["mat-dialog-actions",""],[4,"ngIf","ngIfElse"],[1,"table-dialog-additional-text"],[1,"table-dialog-help-link-url"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,n){if(t&1&&(i.\u0275\u0275elementStart(0,"div",3)(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(3,"div",4),i.\u0275\u0275template(4,$0,2,1,"div",5)(5,G0,3,2,"div",6),i.\u0275\u0275elementStart(6,"div",7,0),i.\u0275\u0275elementContainer(8,null,1),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(10,"div",8),i.\u0275\u0275template(11,Q0,6,6,"ng-container",9)(12,J0,3,3,"ng-template",null,2,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()()),t&2){const s=i.\u0275\u0275reference(13);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.title),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.additionalText),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.helpLinkUrl),i.\u0275\u0275advance(6),i.\u0275\u0275property("ngIf",n.continueButtonCaption)("ngIfElse",s)}},dependencies:[b.NgIf,W.MatButton,Y.MatDialogClose,Y.MatDialogTitle,Y.MatDialogActions,Y.MatDialogContent,v.TranslatePipe],styles:[`ts-table-dialog{min-width:850px;max-width:900px;margin:0 8px!important;padding:0}ts-table-dialog .table-dialog-additional-text{margin-bottom:4px;display:inline}ts-table-dialog .table-dialog-help-link-url{display:inline;cursor:pointer}ts-table-dialog .data-table{overflow-y:auto!important;max-height:330px;margin:0;padding:0}ts-table-dialog .data-table table{padding-top:0}ts-table-dialog [mat-dialog-actions]{display:flex;flex-direction:row;justify-content:flex-end;margin:20px 0 10px!important}
`],encapsulation:2})}}function q0(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",7),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.data.additionalText)}}function K0(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"button",8),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"button",9),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("mat-dialog-close",!1),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(3,4,"ValidationErrorDialogComponent.Cancel")," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("mat-dialog-close",!0),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.data.continueButtonCaption)}}function X0(a,e){a&1&&(i.\u0275\u0275elementStart(0,"button",8),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"ValidationErrorDialogComponent.Close")," "))}class Hl{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||Hl)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Hl,selectors:[["ts-validation-error-dialog"]],decls:11,vars:5,consts:[["withoutContinue",""],["mat-dialog-title",""],["mat-dialog-content",""],["class","validation-dialog-additional-text",4,"ngIf"],[1,"validation-dialog-error"],["mat-dialog-actions",""],[4,"ngIf","ngIfElse"],[1,"validation-dialog-additional-text"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,n){if(t&1&&(i.\u0275\u0275elementStart(0,"div",1)(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(3,"div",2),i.\u0275\u0275template(4,q0,2,1,"span",3),i.\u0275\u0275elementStart(5,"span",4),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(7,"div",5),i.\u0275\u0275template(8,K0,6,6,"ng-container",6)(9,X0,3,3,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()),t&2){const s=i.\u0275\u0275reference(10);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.data.title),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.data.additionalText),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.data.validationError),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.data.continueButtonCaption)("ngIfElse",s)}},dependencies:[b.NgIf,W.MatButton,Y.MatDialogClose,Y.MatDialogTitle,Y.MatDialogActions,Y.MatDialogContent,v.TranslatePipe],styles:[`ts-validation-error-dialog{margin:0!important;padding:0 6px;width:720px}ts-validation-error-dialog [mat-dialog-actions]{float:right}ts-validation-error-dialog [mat-dialog-content] .validation-dialog-error,ts-validation-error-dialog [mat-dialog-content] .validation-dialog-additional-text{white-space:pre-wrap}ts-validation-error-dialog [mat-dialog-content] .validation-dialog-error{font-family:monospace;font-size:13px}
`],encapsulation:2})}}class zo{set template(e){this._clearView(),e&&this._renderTemplate(e)}constructor(e,t){this._viewContainer=e,this._injector=t}_clearView(){this._viewContainer.clear()}_renderTemplate(e){const t=i.Injector.create({providers:[],parent:this._injector});this._viewContainer.createEmbeddedView(e,{},{injector:t})}static{this.\u0275fac=function(t){return new(t||zo)(i.\u0275\u0275directiveInject(i.ViewContainerRef),i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:zo,selectors:[["","crtTemplateOutletWithCurrentInjector",""]],inputs:{template:[0,"crtTemplateOutletWithCurrentInjector","template"]}})}}function eI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",9),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("value",t),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",n.selectDisplayValue(t)," ")}}class Fo{constructor(){this.label="",this.selectedItem=null,this.selectedItemChange=new i.EventEmitter,this.list=[],this.fieldFocus=new i.EventEmitter,this.disabled="false"}_filterList(e){e?this.filteredList=this.list.filter(t=>t.displayValue.toLowerCase().indexOf(e.toLowerCase())>=0):this.filteredList=this.list}ngOnInit(){console.warn('Component "ComboboxEditComponent" is deprecated and will removed in future versions'),this.list$&&this.list$.pipe((0,c.map)(e=>this.list=e)).subscribe()}selectDisplayValue(e){return e&&e.displayValue||""}onOptionSelected(e){const t=e.option.value;this.selectedItem=t,this.selectedItemChange.emit(t)}onFieldInput(e){this._filterList(e.target.value)}onFieldFocus(){this.filteredList=this.list,this.fieldFocus.emit()}onAutocompleteClosed(e){this.list.some(n=>n.displayValue.toLowerCase()===e.toLowerCase())||(this.selectedItem=null,this.selectedItemChange.emit(null),this._filterList(""))}static{this.\u0275fac=function(t){return new(t||Fo)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Fo,selectors:[["ts-combobox-edit"]],inputs:{label:"label",selectedItem:"selectedItem",list$:"list$",disabled:"disabled"},outputs:{selectedItemChange:"selectedItemChange",fieldFocus:"fieldFocus"},decls:11,vars:6,consts:[["input",""],["auto","matAutocomplete"],["floatLabel","always",1,"combobox-edit"],[1,"combobox-edit-search-input"],["type","text","matInput","","spellcheck","false",3,"input","focus","matAutocomplete","value","disabled"],[1,"mat-mdc-select-arrow-wrapper"],[1,"mat-mdc-select-arrow"],[3,"optionSelected","closed","displayWith"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",2)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",3)(4,"input",4,0),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onFieldInput(o))})("focus",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onFieldFocus())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(6,"div",5),i.\u0275\u0275element(7,"div",6),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(8,"mat-autocomplete",7,1),i.\u0275\u0275listener("optionSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onOptionSelected(o))})("closed",function(){i.\u0275\u0275restoreView(s);const o=i.\u0275\u0275reference(5);return i.\u0275\u0275resetView(n.onAutocompleteClosed(o.value))}),i.\u0275\u0275template(10,eI,2,2,"mat-option",8),i.\u0275\u0275elementEnd()()()}if(t&2){const s=i.\u0275\u0275reference(9);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.label),i.\u0275\u0275advance(2),i.\u0275\u0275property("matAutocomplete",s)("value",n.selectDisplayValue(n.selectedItem))("disabled",n.disabled),i.\u0275\u0275advance(4),i.\u0275\u0275property("displayWith",n.selectDisplayValue),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",n.filteredList)}},dependencies:[b.NgForOf,Oe.MatAutocomplete,qe.MatOption,Oe.MatAutocompleteTrigger,K.MatFormField,K.MatLabel,re.MatInput],styles:[".combobox-edit[_ngcontent-%COMP%]{width:100%}.combobox-edit[_ngcontent-%COMP%]   .combobox-edit-search-input[_ngcontent-%COMP%]{width:100%;display:inline-flex;align-items:center}"]})}}var Yl=m(50725);const wg=new i.InjectionToken("Represents a set of configuration properties for getting resources");class tI{constructor(e,t,n){this._getResourcesEventName=e,this._setResourcesEventName=t,this._defaultResources=n}get defaultResources(){return this._defaultResources}get getResourcesEventName(){return q.checkStringIsNotEmpty("getResourcesEventName",this._getResourcesEventName)}get setResourcesEventName(){return q.checkStringIsNotEmpty("setResourcesEventName",this._setResourcesEventName)}}class Fi{constructor(e,t){this._customEventService=e,this._destroyed$=new u.Subject,this._defaultResources=this._getSafeResources(t.defaultResources),this._setResourcesEventName=t.setResourcesEventName,this._getResourcesEventName=t.getResourcesEventName}_getSafeResources(e){return e=e||{},e.localizableStrings=e.localizableStrings||{},e}getResources(){const e=new u.ReplaySubject;return this._customEventService.subscribe(this._setResourcesEventName).pipe((0,c.take)(1),(0,c.map)(t=>this._getSafeResources(t)),(0,c.map)(t=>(0,T.merge)(this._defaultResources,t)),(0,c.takeUntil)(this._destroyed$)).subscribe(t=>{e.next(t),e.complete()}),this._customEventService.createOutboundChannel(this._getResourcesEventName).next({}),e}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Fi)(i.\u0275\u0275inject(P.Dj),i.\u0275\u0275inject(wg))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Fi,factory:Fi.\u0275fac})}}class Ng{constructor(e,t){this._value=e,this._property=t}get property(){return this._property}get value(){return this._value}canMatchItem(e){if(!e)return!1;const t=e[this.property],n=t!=null,s=typeof t===this._value.constructor.name.toLowerCase();return n&&s}isItemMatch(e){return this.canMatchItem(e)&&this.isValueMatch(e[this.property])}}class Oh extends Ng{static{this.DEFAULT_PROPERTY="caption"}constructor(e,t){super(e,t||Oh.DEFAULT_PROPERTY)}isValueMatch(e){const t=e.toLowerCase(),n=this.value.toLowerCase(),s=(0,T.compact)(t.split(" "));return(0,T.compact)(n.split(" ")).every(o=>s.find(l=>l.includes(o)))}}class nI extends Ng{isValueMatch(e){return e===this.value}}class Bo{_isFilterNotFalsy(e){return e&&e.value!==null&&e.value!==void 0}transform(e,t){if(!e)return[];if(!t)return e;let n=[...e];return t.filter(this._isFilterNotFalsy).forEach(r=>{n=n.filter(o=>r.isItemMatch(o))}),n}static{this.\u0275fac=function(t){return new(t||Bo)}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"filter",type:Bo,pure:!0})}}function iI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",10),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.filteringValue="")}),i.\u0275\u0275element(1,"mat-icon",11),i.\u0275\u0275pipe(2,"async"),i.\u0275\u0275elementEnd()}if(a&2){let t;const n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("title",(t=i.\u0275\u0275pipeBind1(2,1,n.localizableStrings$))==null?null:t.ClearButtonTitle)}}function sI(a,e){a&1&&i.\u0275\u0275element(0,"mat-icon",12)}function aI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-list-item",16),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(r.onItemSelected(s))}),i.\u0275\u0275elementStart(1,"button",17),i.\u0275\u0275pipe(2,"async"),i.\u0275\u0275pipe(3,"async"),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(o.toggleFavorite(r,s))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"div",18),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd()()}if(a&2){let t;const n=e.$implicit,s=i.\u0275\u0275nextContext(3);i.\u0275\u0275classProp("active",n.isActive),i.\u0275\u0275attribute("data-qa",n.caption),i.\u0275\u0275advance(),i.\u0275\u0275property("ngClass",n.isFavorite?s.favoriteCssClass:s.regularCssClass)("title",n.isFavorite?(t=i.\u0275\u0275pipeBind1(2,6,s.localizableStrings$))==null?null:t.RemoveFromFavoriteButtonTitle:(t=i.\u0275\u0275pipeBind1(3,8,s.localizableStrings$))==null?null:t.AddToFavoriteButtonTitle),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate1(" ",n.caption," ")}}function rI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",14),i.\u0275\u0275template(1,aI,6,10,"mat-list-item",15),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext().ngIf;i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t)}}function oI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",19),i.\u0275\u0275element(1,"div",20),i.\u0275\u0275elementStart(2,"div",21),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"async"),i.\u0275\u0275elementEnd()()),a&2){let t;const n=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",(t=i.\u0275\u0275pipeBind1(4,1,n.localizableStrings$))==null?null:t.NoDataPlaceholder," ")}}function cI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-action-list"),i.\u0275\u0275template(1,rI,2,1,"div",13)(2,oI,5,3,"ng-template",null,1,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()),a&2){const t=e.ngIf,n=i.\u0275\u0275reference(3);i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.length>0)("ngIfElse",n)}}let ei=class ap extends Be{constructor(e,t,n){super(n),this._resourcesService=e,this._changeDetector=t,this._filters=[],this.regularCssClass="regular",this.favoriteCssClass="favorite",this.filteringValue="",this.displayOnlyFavorites=!1,this.items=[],this.itemSelected=new i.EventEmitter,this.favoriteStateChanged=new i.EventEmitter}get _searchFilter(){return new Oh(this.filteringValue)}get _favoritesFilter(){return new nI(this.displayOnlyFavorites,"isFavorite")}get filters(){return this._filters=[this._searchFilter],this.displayOnlyFavorites&&this._filters.push(this._favoritesFilter),this._filters}get localizableStrings$(){return this._resources$.pipe((0,c.map)(e=>e.localizableStrings))}ngOnInit(){this._resources$=this._resourcesService.getResources()}onItemSelected(e){const t={id:e.id};this.itemSelected.emit(t)}toggleFavorite(e,t){t.stopPropagation();const{id:n,isFavorite:s}=e,r={id:n,isFavorite:!s};this.favoriteStateChanged.emit(r)}onFilteringValueChanged(e){this.filteringValue=e,this._changeDetector.detectChanges()}toggleDisplayOnlyFavorites(){this.displayOnlyFavorites=!this.displayOnlyFavorites,this._changeDetector.detectChanges()}static{this.\u0275fac=function(t){return new(t||ap)(i.\u0275\u0275directiveInject(Fi),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ap,selectors:[["ts-filterable-list"]],inputs:{items:"items"},outputs:{itemSelected:"itemSelected",favoriteStateChanged:"favoriteStateChanged"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:14,vars:17,consts:[["searchIcon",""],["noData",""],[1,"filterable-list-container",3,"ngStyle","ngClass"],[1,"filter-input-container"],[1,"display-only-favorites-button-container"],["mat-icon-button","","data-qa","filter-favorite-btn",3,"click","ngClass","title"],["floatLabel","never","appearance","fill"],["matInput","","type","text","spellcheck","false","autocomplete","off","data-qa","search-input",3,"input","value","placeholder"],["matSuffix","","mat-icon-button","","aria-label","Clear","data-qa","clear-filter-btn",3,"click",4,"ngIf","ngIfElse"],[4,"ngIf"],["matSuffix","","mat-icon-button","","aria-label","Clear","data-qa","clear-filter-btn",3,"click"],["matSuffix","",1,"clear-icon",3,"title"],["matSuffix","",1,"search-icon"],["class","items-list",4,"ngIf","ngIfElse"],[1,"items-list"],["disableRipple","",3,"active","click",4,"ngFor","ngForOf"],["disableRipple","",3,"click"],["mat-icon-button","","data-qa","favorite-btn",3,"click","ngClass","title"],[1,"item-caption"],["data-qa","blank-slate",1,"blank-slate"],["data-qa","blank-slate-icon",1,"icon"],["data-qa","blank-slate-label",1,"label"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",2)(1,"div")(2,"div",3)(3,"div",4)(4,"button",5),i.\u0275\u0275pipe(5,"async"),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.toggleDisplayOnlyFavorites())}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(6,"mat-form-field",6)(7,"input",7),i.\u0275\u0275pipe(8,"async"),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onFilteringValueChanged(o.target.value))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(9,iI,3,3,"button",8)(10,sI,1,0,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275template(12,cI,4,2,"mat-action-list",9),i.\u0275\u0275pipe(13,"filter"),i.\u0275\u0275elementEnd()}if(t&2){let s,r;const o=i.\u0275\u0275reference(11);i.\u0275\u0275property("ngStyle",n.styles)("ngClass",n.classes),i.\u0275\u0275attribute("id",n.id),i.\u0275\u0275advance(4),i.\u0275\u0275property("ngClass",n.displayOnlyFavorites?n.favoriteCssClass:n.regularCssClass)("title",(s=i.\u0275\u0275pipeBind1(5,10,n.localizableStrings$))==null?null:s.FilterFavoriteTitle),i.\u0275\u0275advance(3),i.\u0275\u0275property("value",n.filteringValue)("placeholder",(r=i.\u0275\u0275pipeBind1(8,12,n.localizableStrings$))==null?null:r.SearchPlaceholder),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.filteringValue)("ngIfElse",o),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",i.\u0275\u0275pipeBind2(13,14,n.items,n.filters))}},dependencies:[b.NgClass,b.NgForOf,b.NgIf,b.NgStyle,K.MatFormField,K.MatSuffix,U.MatIcon,re.MatInput,Yl.MatActionList,Yl.MatListItem,W.MatIconButton,b.AsyncPipe,Bo],styles:[`.filterable-list-container{display:flex;flex-direction:column;height:100%;min-height:inherit;max-height:inherit}.filterable-list-container .display-only-favorites-button-container .mat-mdc-icon-button{height:32px;width:32px}.filterable-list-container .items-list{margin-top:8px}.filterable-list-container .blank-slate{display:flex;flex-direction:column;align-items:center}.filterable-list-container .blank-slate .label{color:#757575;font-size:12px;font-family:Open Sans,Regular,sans-serif;margin-top:16px}.filterable-list-container .blank-slate .icon{width:100px;height:104px;margin-top:24px;background:no-repeat url(data:image/svg+xml;base64,PHN2ZyBpZD0iaWNvbl9zZWFyY2hfYmlnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTA0IiB2aWV3Qm94PSIwIDAgMTAwIDEwNCI+DQogIDxnIGlkPSJQYXRoXzc0NTciIGRhdGEtbmFtZT0iUGF0aCA3NDU3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTcxNC44MTggLTY0OS41MTIpIiBmaWxsPSJyZ2JhKDEwMCwxODQsMjIzLDAuMSkiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCI+DQogICAgPHBhdGggZD0iTSAxNzE4LjYwMTY4NDU3MDMxMyA3NTIuNTA1ODU5Mzc1IEMgMTcyMS41NjE2NDU1MDc4MTMgNzUwLjM3MDQyMjM2MzI4MTMgMTcyNC4zMTk3MDIxNDg0MzggNzQ3LjEzMzIzOTc0NjA5MzggMTcyNi44MzQ1OTQ3MjY1NjMgNzQyLjgzNTgxNTQyOTY4NzUgQyAxNzI5LjQyMTI2NDY0ODQzOCA3MzguNDE1NTg4Mzc4OTA2MyAxNzMwLjc1NTM3MTA5Mzc1IDczNC41MjIwMzM2OTE0MDYzIDE3MzAuODEwOTEzMDg1OTM4IDczNC4zNTgzOTg0Mzc1IEwgMTczMS4wMDY1OTE3OTY4NzUgNzMzLjc4MTkyMTM4NjcxODggTCAxNzMwLjU4NDM1MDU4NTkzOCA3MzMuMzQzMzIyNzUzOTA2MyBDIDE3MjYuMjg1NTIyNDYwOTM4IDcyOC44NzkzMzM0OTYwOTM4IDE3MjIuOTE0MzA2NjQwNjI1IDcyMy43MTg5MzMxMDU0Njg4IDE3MjAuNTY0MzMxMDU0Njg4IDcxOC4wMDUzNzEwOTM3NSBDIDE3MTguMTI5NTE2NjAxNTYzIDcxMi4wODU1NzEyODkwNjI1IDE3MTYuODk1MDE5NTMxMjUgNzA1LjgwNzY3ODIyMjY1NjMgMTcxNi44OTUwMTk1MzEyNSA2OTkuMzQ2MDA4MzAwNzgxMyBDIDE3MTYuODk1MDE5NTMxMjUgNjkyLjc1MTk1MzEyNSAxNzE4LjE3NjUxMzY3MTg3NSA2ODYuMzU1NzczOTI1NzgxMyAxNzIwLjcwMzczNTM1MTU2MyA2ODAuMzM1MjY2MTEzMjgxMyBDIDE3MjMuMTQ0ODk3NDYwOTM4IDY3NC41MTk5NTg0OTYwOTM4IDE3MjYuNjM5NzcwNTA3ODEzIDY2OS4yOTczMDIyNDYwOTM4IDE3MzEuMDkxMTg2NTIzNDM4IDY2NC44MTIzMTY4OTQ1MzEzIEMgMTczNS41NDIxMTQyNTc4MTMgNjYwLjMyNzgxOTgyNDIxODggMTc0MC43MjQ4NTM1MTU2MjUgNjU2LjgwNzEyODkwNjI1IDE3NDYuNDk1MzYxMzI4MTI1IDY1NC4zNDgwODM0OTYwOTM4IEMgMTc1Mi40Njg3NSA2NTEuODAyNjczMzM5ODQzOCAxNzU4LjgxNDY5NzI2NTYyNSA2NTAuNTEyMDIzOTI1NzgxMyAxNzY1LjM1NzA1NTY2NDA2MyA2NTAuNTEyMDIzOTI1NzgxMyBDIDE3NzEuODk5MTY5OTIxODc1IDY1MC41MTIwMjM5MjU3ODEzIDE3NzguMjQ0ODczMDQ2ODc1IDY1MS44MDI2NzMzMzk4NDM4IDE3ODQuMjE4MjYxNzE4NzUgNjU0LjM0ODA4MzQ5NjA5MzggQyAxNzg5Ljk4ODc2OTUzMTI1IDY1Ni44MDcxMjg5MDYyNSAxNzk1LjE3MTUwODc4OTA2MyA2NjAuMzI3ODE5ODI0MjE4OCAxNzk5LjYyMjU1ODU5Mzc1IDY2NC44MTIzMTY4OTQ1MzEzIEMgMTgwNC4wNzM5NzQ2MDkzNzUgNjY5LjI5NzM2MzI4MTI1IDE4MDcuNTY4ODQ3NjU2MjUgNjc0LjUyMDAxOTUzMTI1IDE4MTAuMDEwMTMxODM1OTM4IDY4MC4zMzUyNjYxMTMyODEzIEMgMTgxMi41Mzc0NzU1ODU5MzggNjg2LjM1NTgzNDk2MDkzNzUgMTgxMy44MTg5Njk3MjY1NjMgNjkyLjc1MTk1MzEyNSAxODEzLjgxODk2OTcyNjU2MyA2OTkuMzQ2MDA4MzAwNzgxMyBDIDE4MTMuODE4OTY5NzI2NTYzIDcwNS45Mzk4MTkzMzU5Mzc1IDE4MTIuNTM3NDc1NTg1OTM4IDcxMi4zMzU3NTQzOTQ1MzEzIDE4MTAuMDEwMTMxODM1OTM4IDcxOC4zNTYxNDAxMzY3MTg4IEMgMTgwNy41Njg4NDc2NTYyNSA3MjQuMTcxMjY0NjQ4NDM3NSAxODA0LjA3Mzk3NDYwOTM3NSA3MjkuMzkzODU5ODYzMjgxMyAxNzk5LjYyMjU1ODU5Mzc1IDczMy44Nzg3ODQxNzk2ODc1IEMgMTc5NS4xNzE1MDg3ODkwNjMgNzM4LjM2MzI4MTI1IDE3ODkuOTg4NzY5NTMxMjUgNzQxLjg4MzkxMTEzMjgxMjUgMTc4NC4yMTgyNjE3MTg3NSA3NDQuMzQyOTU2NTQyOTY4OCBDIDE3NzguMjQ0ODczMDQ2ODc1IDc0Ni44ODgzNjY2OTkyMTg4IDE3NzEuODk5MDQ3ODUxNTYzIDc0OC4xNzkwMTYxMTMyODEzIDE3NjUuMzU3MDU1NjY0MDYzIDc0OC4xNzkwMTYxMTMyODEzIEMgMTc1OS42MDc1NDM5NDUzMTMgNzQ4LjE3OTAxNjExMzI4MTMgMTc1My45Nzk4NTgzOTg0MzggNzQ3LjE3MzUyMjk0OTIxODggMTc0OC42MzA2MTUyMzQzNzUgNzQ1LjE5MDM2ODY1MjM0MzggTCAxNzQ4LjA3MDQzNDU3MDMxMyA3NDQuOTgyNjY2MDE1NjI1IEwgMTc0Ny42MjIwNzAzMTI1IDc0NS4zNzc1MDI0NDE0MDYzIEMgMTc0Ny4yODQ3OTAwMzkwNjMgNzQ1LjY3NDQ5OTUxMTcxODggMTc0Ni45NDcxNDM1NTQ2ODggNzQ1LjkyMTgxMzk2NDg0MzggMTc0Ni41NTkzMjYxNzE4NzUgNzQ2LjE1NTgyMjc1MzkwNjMgQyAxNzM3LjA4NTQ0OTIxODc1IDc1MS44ODMxNzg3MTA5Mzc1IDE3MjkuNjYxNzQzMTY0MDYzIDc1Mi40NDk4MjkxMDE1NjI1IDE3MTguNjAxNjg0NTcwMzEzIDc1Mi41MDU4NTkzNzUgWiIgc3Ryb2tlPSJub25lIi8+DQogICAgPHBhdGggZD0iTSAxNzY1LjM1NzA1NTY2NDA2MyA2NTEuNTEyMDIzOTI1NzgxMyBDIDE3NTguOTUwMTk1MzEyNSA2NTEuNTEyMDIzOTI1NzgxMyAxNzUyLjczNjIwNjA1NDY4OCA2NTIuNzc1NzU2ODM1OTM3NSAxNzQ2Ljg4NzQ1MTE3MTg3NSA2NTUuMjY4MDY2NDA2MjUgQyAxNzQxLjIzNjIwNjA1NDY4OCA2NTcuNjc2MjA4NDk2MDkzOCAxNzM2LjE2MDQwMDM5MDYyNSA2NjEuMTI0Mzg5NjQ4NDM3NSAxNzMxLjgwMDkwMzMyMDMxMyA2NjUuNTE2Nzg0NjY3OTY4OCBDIDE3MjcuNDQwNDI5Njg3NSA2NjkuOTEwMTU2MjUgMTcyNC4wMTY5Njc3NzM0MzggNjc1LjAyNjA2MjAxMTcxODggMTcyMS42MjU4NTQ0OTIxODggNjgwLjcyMjI5MDAzOTA2MjUgQyAxNzE5LjE1MDI2ODU1NDY4OCA2ODYuNjE5NjI4OTA2MjUgMTcxNy44OTUwMTk1MzEyNSA2OTIuODg1NTU5MDgyMDMxMyAxNzE3Ljg5NTAxOTUzMTI1IDY5OS4zNDYwMDgzMDA3ODEzIEMgMTcxNy44OTUwMTk1MzEyNSA3MDUuNjc2NTEzNjcxODc1IDE3MTkuMTA0MjQ4MDQ2ODc1IDcxMS44MjY0NzcwNTA3ODEzIDE3MjEuNDg5MTM1NzQyMTg4IDcxNy42MjUgQyAxNzIzLjc5MTAxNTYyNSA3MjMuMjIxNjc5Njg3NSAxNzI3LjA5MzM4Mzc4OTA2MyA3MjguMjc2NjcyMzYzMjgxMyAxNzMxLjMwNDU2NTQyOTY4OCA3MzIuNjQ5NjU4MjAzMTI1IEwgMTczMi4xNDkyOTE5OTIxODggNzMzLjUyNjc5NDQzMzU5MzggTCAxNzMxLjc1NzgxMjUgNzM0LjY3OTg3MDYwNTQ2ODggQyAxNzMxLjU3OTIyMzYzMjgxMyA3MzUuMjA2MDU0Njg3NSAxNzI4LjEyNDc1NTg1OTM3NSA3NDUuMTg4OTY0ODQzNzUgMTcyMS4zOTczMzg4NjcxODggNzUxLjQ3NjY4NDU3MDMxMjUgQyAxNzI1LjExMzY0NzQ2MDkzOCA3NTEuNDEyNTk3NjU2MjUgMTcyOC40MDk1NDU4OTg0MzggNzUxLjIzMjIzODc2OTUzMTMgMTczMS41NzE0MTExMzI4MTMgNzUwLjcyNDc5MjQ4MDQ2ODggQyAxNzM2Ljc0NzMxNDQ1MzEyNSA3NDkuODk0MTA0MDAzOTA2MyAxNzQxLjIwOTk2MDkzNzUgNzQ4LjIyMTE5MTQwNjI1IDE3NDYuMDQyNjAyNTM5MDYzIDc0NS4yOTk2ODI2MTcxODc1IEMgMTc0Ni4zNzgwNTE3NTc4MTMgNzQ1LjA5NzI5MDAzOTA2MjUgMTc0Ni42Njk5MjE4NzUgNzQ0Ljg4MzU0NDkyMTg3NSAxNzQ2Ljk2MTA1OTU3MDMxMyA3NDQuNjI3MDc1MTk1MzEyNSBMIDE3NDcuODU3Nzg4MDg1OTM4IDc0My44MzczNDEzMDg1OTM4IEwgMTc0OC45NzgxNDk0MTQwNjMgNzQ0LjI1MjY4NTU0Njg3NSBDIDE3NTQuMjE1ODIwMzEyNSA3NDYuMTk0NDU4MDA3ODEyNSAxNzU5LjcyNjU2MjUgNzQ3LjE3OTAxNjExMzI4MTMgMTc2NS4zNTcwNTU2NjQwNjMgNzQ3LjE3OTAxNjExMzI4MTMgQyAxNzcxLjc2MzY3MTg3NSA3NDcuMTc5MDE2MTEzMjgxMyAxNzc3Ljk3NzUzOTA2MjUgNzQ1LjkxNTI4MzIwMzEyNSAxNzgzLjgyNjE3MTg3NSA3NDMuNDIyOTczNjMyODEyNSBDIDE3ODkuNDc3Mjk0OTIxODc1IDc0MS4wMTQ4MzE1NDI5Njg4IDE3OTQuNTUzMjIyNjU2MjUgNzM3LjU2NjcxMTQyNTc4MTMgMTc5OC45MTI3MTk3MjY1NjMgNzMzLjE3NDMxNjQwNjI1IEMgMTgwMy4yNzMzMTU0Mjk2ODggNzI4Ljc4MTAwNTg1OTM3NSAxODA2LjY5Njc3NzM0Mzc1IDcyMy42NjUyMjIxNjc5Njg4IDE4MDkuMDg4MDEyNjk1MzEzIDcxNy45NjkxMTYyMTA5Mzc1IEMgMTgxMS41NjM3MjA3MDMxMjUgNzEyLjA3MTg5OTQxNDA2MjUgMTgxMi44MTg5Njk3MjY1NjMgNzA1LjgwNjE1MjM0Mzc1IDE4MTIuODE4OTY5NzI2NTYzIDY5OS4zNDYwMDgzMDA3ODEzIEMgMTgxMi44MTg5Njk3MjY1NjMgNjkyLjg4NTU1OTA4MjAzMTMgMTgxMS41NjM3MjA3MDMxMjUgNjg2LjYxOTY4OTk0MTQwNjMgMTgwOS4wODgwMTI2OTUzMTMgNjgwLjcyMjI5MDAzOTA2MjUgQyAxODA2LjY5Njc3NzM0Mzc1IDY3NS4wMjYxMjMwNDY4NzUgMTgwMy4yNzMzMTU0Mjk2ODggNjY5LjkxMDIxNzI4NTE1NjMgMTc5OC45MTI3MTk3MjY1NjMgNjY1LjUxNjc4NDY2Nzk2ODggQyAxNzk0LjU1MzIyMjY1NjI1IDY2MS4xMjQzODk2NDg0Mzc1IDE3ODkuNDc3Mjk0OTIxODc1IDY1Ny42NzYyMDg0OTYwOTM4IDE3ODMuODI2MTcxODc1IDY1NS4yNjgwNjY0MDYyNSBDIDE3NzcuOTc3NTM5MDYyNSA2NTIuNzc1NzU2ODM1OTM3NSAxNzcxLjc2MzY3MTg3NSA2NTEuNTEyMDIzOTI1NzgxMyAxNzY1LjM1NzA1NTY2NDA2MyA2NTEuNTEyMDIzOTI1NzgxMyBNIDE3NjUuMzU3MDU1NjY0MDYzIDY0OS41MTIwMjM5MjU3ODEzIEMgMTc5Mi42NzUwNDg4MjgxMjUgNjQ5LjUxMjAyMzkyNTc4MTMgMTgxNC44MTg5Njk3MjY1NjMgNjcxLjgyMjk5ODA0Njg3NSAxODE0LjgxODk2OTcyNjU2MyA2OTkuMzQ2MDA4MzAwNzgxMyBDIDE4MTQuODE4OTY5NzI2NTYzIDcyNi44Njc5ODA5NTcwMzEzIDE3OTIuNjc1MDQ4ODI4MTI1IDc0OS4xNzkwMTYxMTMyODEzIDE3NjUuMzU3MDU1NjY0MDYzIDc0OS4xNzkwMTYxMTMyODEzIEMgMTc1OS4zNTQ5ODA0Njg3NSA3NDkuMTc5MDE2MTEzMjgxMyAxNzUzLjYwNDk4MDQ2ODc1IDc0OC4xMDEwMTMxODM1OTM4IDE3NDguMjgyOTU4OTg0Mzc1IDc0Ni4xMjc5OTA3MjI2NTYzIEMgMTc0Ny45NDc5OTgwNDY4NzUgNzQ2LjQyMjk3MzYzMjgxMjUgMTc0Ny41NjQ5NDE0MDYyNSA3NDYuNzE2OTc5OTgwNDY4OCAxNzQ3LjA3NjA0OTgwNDY4OCA3NDcuMDEyMDIzOTI1NzgxMyBDIDE3MzYuMzIzOTc0NjA5Mzc1IDc1My41MTIwMjM5MjU3ODEzIDE3MjguMDc5OTU2MDU0Njg4IDc1My41MTIwMjM5MjU3ODEzIDE3MTQuODE4OTY5NzI2NTYzIDc1My41MTIwMjM5MjU3ODEzIEMgMTcyNC41ODg5ODkyNTc4MTMgNzQ5LjM5Njk3MjY1NjI1IDE3MjkuNzc0MDQ3ODUxNTYzIDczNC4zMDIwMDE5NTMxMjUgMTcyOS44NjQwMTM2NzE4NzUgNzM0LjAzNjk4NzMwNDY4NzUgQyAxNzIxLjIyMzk5OTAyMzQzOCA3MjUuMDY1MDAyNDQxNDA2MyAxNzE1Ljg5NTAxOTUzMTI1IDcxMi44MzU5OTg1MzUxNTYzIDE3MTUuODk1MDE5NTMxMjUgNjk5LjM0NjAwODMwMDc4MTMgQyAxNzE1Ljg5NTAxOTUzMTI1IDY3MS44MjI5OTgwNDY4NzUgMTczOC4wMzc5NjM4NjcxODggNjQ5LjUxMjAyMzkyNTc4MTMgMTc2NS4zNTcwNTU2NjQwNjMgNjQ5LjUxMjAyMzkyNTc4MTMgWiIgc3Ryb2tlPSJub25lIiBmaWxsPSIjNjRiOGRmIi8+DQogIDwvZz4NCiAgPGcgaWQ9Ikdyb3VwXzc3NjAiIGRhdGEtbmFtZT0iR3JvdXAgNzc2MCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE3MTQuODE4IC02NDkuNTEyKSI+DQogICAgPGNpcmNsZSBpZD0iRWxsaXBzZV8xMzM2IiBkYXRhLW5hbWU9IkVsbGlwc2UgMTMzNiIgY3g9IjEyLjI1IiBjeT0iMTIuMjUiIHI9IjEyLjI1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNzQ4LjA2OSA2ODIuMDQyKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNjRiOGRmIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMiIvPg0KICAgIDxsaW5lIGlkPSJMaW5lXzUxMyIgZGF0YS1uYW1lPSJMaW5lIDUxMyIgeDE9IjEyLjQ2MyIgeTE9IjEyLjQ2MyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTc2OS4xMDYgNzAyLjgyOSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzY0YjhkZiIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjIiLz4NCiAgPC9nPg0KPC9zdmc+DQo=);background-position:center}.filterable-list-container .mat-mdc-icon-button{background-color:transparent}.filterable-list-container .mat-mdc-icon-button.favorite{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZmZiNzRkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNOC41LDEuMWwyLjMsNC42NjcsNS4yLjcxLTMuNywzLjY1Mi44LDQuOTcxTDguNSwxMi43NjcsMy45LDE1LjFsLjktNC45NzFMMSw2LjQ3N2w1LjItLjcxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMSAtMC4xKSIvPjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4=);background-position:center}.filterable-list-container .mat-mdc-icon-button.regular{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZGJkYmRiO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPjxwYXRoIGNsYXNzPSJhIiBkPSJNOC41LDMuMyw5LjksNi4ybC4yLjUuNS4xLDMuMi40TDExLjYsOS40bC0uNC40LjEuNS41LDMuMUw5LDExLjhsLS41LS4yLS41LjJMNS4yLDEzLjJsLjYtMywuMS0uNS0uNC0uNEwzLjIsNy4xbDMuMS0uNC41LS4xTDcsNi4xLDguNSwzLjNNOC41LDEsNi4yLDUuNywxLDYuNCw0LjgsMTBsLS45LDUsNC42LTIuM0wxMy4xLDE1bC0uOC01TDE2LDYuNGwtNS4yLS43WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEpIi8+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjwvc3ZnPg==);background-position:center}.filterable-list-container .mat-mdc-icon-button.regular:hover{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4NCjxkZWZzPiA8c3R5bGU+LmF7ZmlsbDojZmZiNzRkO30uYntmaWxsOm5vbmU7fTwvc3R5bGU+PC9kZWZzPg0KPHBhdGggY2xhc3M9ImEiIGQ9Ik04LjUsMy4zLDkuOSw2LjJsLjIuNS41LjEsMy4yLjRMMTEuNiw5LjRsLS40LjQuMS41LjUsMy4xTDksMTEuOGwtLjUtLjItLjUuMkw1LjIsMTMuMmwuNi0zLC4xLS41LS40LS40TDMuMiw3LjFsMy4xLS40LjUtLjFMNyw2LjEsOC41LDMuM004LjUsMSw2LjIsNS43LDEsNi40LDQuOCwxMGwtLjksNSw0LjYtMi4zTDEzLjEsMTVsLS44LTVMMTYsNi40bC01LjItLjdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMSkiLz4NCjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4=);background-position:center}.filterable-list-container .mat-mdc-icon-button{padding:0}.filter-input-container{display:flex;flex-direction:row;margin-right:10px;padding-left:6px}.filter-input-container .mat-mdc-form-field{--mdc-filled-text-field-hover-active-indicator-color: #c8c8c8;--mdc-filled-text-field-active-indicator-color: #c8c8c8;--mat-form-field-container-text-line-height: normal;--mdc-filled-text-field-input-text-color: #444444;--mdc-filled-text-field-input-text-placeholder-color: #999999;--mat-form-field-container-vertical-padding: 0;--mat-form-field-container-height: 19px;--mat-form-field-state-layer-color: transparent;font-size:13px;width:100%;padding-bottom:5px}.filter-input-container .mat-mdc-form-field .mat-mdc-input-element{vertical-align:middle}.filter-input-container .mat-mdc-form-field .mdc-text-field--filled{--mdc-filled-text-field-focus-active-indicator-height: 1px;background-color:transparent;align-items:center;padding:0}.filter-input-container .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none}.filter-input-container .mat-mdc-form-field-appearance-fill .mat-mdc-form-field-text-suffix .mat-mdc-icon-button,.filter-input-container .mat-mdc-form-field-appearance-fill .mat-mdc-form-field-text-suffix .mat-icon,.filter-input-container .mat-mdc-form-field .mat-mdc-form-field-icon-suffix .mat-mdc-icon-button,.filter-input-container .mat-mdc-form-field .mat-mdc-form-field-icon-suffix .mat-icon{width:18px;height:18px;font-size:18px;margin-right:8px;padding:0}.filter-input-container .mat-mdc-form-field-appearance-fill .mat-mdc-form-field-text-suffix .mat-icon,.filter-input-container .mat-mdc-form-field .mat-mdc-form-field-icon-suffix .mat-icon{color:#999;vertical-align:middle}.filter-input-container .mat-mdc-form-field-appearance-fill .mat-mdc-form-field-text-suffix .mat-icon.search-icon,.filter-input-container .mat-mdc-form-field .mat-mdc-form-field-icon-suffix .mat-icon.search-icon{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiPjxnIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzgwOTViMyIgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCI+PGNpcmNsZSBjeD0iNiIgY3k9IjYiIHI9IjQuNSIvPjxwYXRoIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgZD0iTSA5LjQsOS40IDE0LDE0Ii8+PC9nPjwvc3ZnPg==)}.filter-input-container .mat-mdc-form-field-appearance-fill .mat-mdc-form-field-text-suffix .mat-icon.clear-icon,.filter-input-container .mat-mdc-form-field .mat-mdc-form-field-icon-suffix .mat-icon.clear-icon{background:no-repeat url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4NCiAgPGcgaWQ9Ikdyb3VwXzIzNTUiIGRhdGEtbmFtZT0iR3JvdXAgMjM1NSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTk0MyAtMjEzNCkiPg0KICAgIDxsaW5lIGlkPSJMaW5lXzE0NiIgZGF0YS1uYW1lPSJMaW5lIDE0NiIgeTE9IjEwIiB4Mj0iMTAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk0Ni41IDIxMzcuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzc1NzU3NSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgICA8bGluZSBpZD0iTGluZV8xNDciIGRhdGEtbmFtZT0iTGluZSAxNDciIHgyPSIxMCIgeTI9IjEwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5NDYuNSAyMTM3LjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM3NTc1NzUiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV8xMDkyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSAxMDkyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDk0MyAyMTM0KSIgZmlsbD0ibm9uZSIvPg0KICA8L2c+DQo8L3N2Zz4NCg==)}.mdc-list.mat-mdc-list-base.mat-mdc-action-list{padding-top:0;overflow:auto}.mdc-list.mat-mdc-list-base.mat-mdc-action-list::-webkit-scrollbar{width:4px}.mdc-list.mat-mdc-list-base.mat-mdc-action-list::-webkit-scrollbar-track{background:transparent;border:4px solid transparent;background-clip:content-box}.mdc-list.mat-mdc-list-base.mat-mdc-action-list::-webkit-scrollbar-thumb{background:#999;border-radius:4px}.mdc-list.mat-mdc-list-base.mat-mdc-action-list .mat-mdc-list-item{font-size:13px;font-family:Open Sans,Regular,sans-serif;color:#444;height:33px;padding-left:6px;box-sizing:border-box}.mdc-list.mat-mdc-list-base.mat-mdc-action-list .mat-mdc-list-item.active{background-color:#e5ebfb}.mdc-list.mat-mdc-list-base.mat-mdc-action-list .mat-mdc-list-item:hover{background:#f2f5ff}.mdc-list.mat-mdc-list-base.mat-mdc-action-list .mat-mdc-list-item .mdc-list-item__content .mat-mdc-list-item-unscoped-content{display:flex;flex-direction:row;padding-left:8px}.mdc-list.mat-mdc-list-base.mat-mdc-action-list .mat-mdc-list-item .mdc-list-item__content .mat-mdc-list-item-unscoped-content .mat-mdc-icon-button{height:16px;width:16px}.mdc-list.mat-mdc-list-base.mat-mdc-action-list .mat-mdc-list-item .mdc-list-item__content .mat-mdc-list-item-unscoped-content .item-caption{padding-left:8px;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
`],encapsulation:3})}};(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Array)],ei.prototype,"items",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",i.EventEmitter)],ei.prototype,"itemSelected",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",i.EventEmitter)],ei.prototype,"favoriteStateChanged",void 0),ei=(0,p.__decorate)([Tn({type:"crt.FilterableList",reuseStrategy:Kt.Reuse}),(0,p.__metadata)("design:paramtypes",[Fi,i.ChangeDetectorRef,i.Injector])],ei);class ma{static{this.\u0275fac=function(t){return new(t||ma)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:ma})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[P.Dj,Fi,{provide:wg,useValue:new tI("getFilterableListResources","setFilterableListResources",{localizableStrings:{NoDataPlaceholder:"No data",SearchPlaceholder:"Search",FilterFavoriteTitle:"Only favorites",RemoveFromFavoriteButtonTitle:"Remove from favorites",AddToFavoriteButtonTitle:"Add to favorites",ClearButtonTitle:"Cancel"}})}],imports:[b.CommonModule,Z.FormsModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,Yl.MatListModule,W.MatButtonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(ma,{declarations:[ei,Bo],imports:[b.CommonModule,Z.FormsModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,Yl.MatListModule,W.MatButtonModule],exports:[ei]})})();function lI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",1),i.\u0275\u0275element(1,"mat-icon",2),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("svgIcon",t.iconName)}}class Ev extends Eh{constructor(e,t){super(e),this.cellComponentClass=ga,this.iconName=t}}class ga extends Dh.X{get iconName(){return this.columnDataSchema.iconName.length?this.columnDataSchema.iconName:this.getValue()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ga)))(n||ga)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ga,selectors:[["ts-icon-table-cell"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","drag-drop-icon-wrapper","cdkDragHandle","",4,"ngIf"],["cdkDragHandle","",1,"drag-drop-icon-wrapper"],[3,"svgIcon"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,lI,2,1,"div",0),t&2&&i.\u0275\u0275property("ngIf",!n.isEmpty())},dependencies:[b.NgIf,U.MatIcon]})}}function uI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-form-field",1)(1,"mat-label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"input",2),i.\u0275\u0275listener("keydown.enter",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onEnterKeyDown(s))}),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngStyle",t.styles)("ngClass",t.classes),i.\u0275\u0275attribute("id",t.id),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.caption),i.\u0275\u0275advance(),i.\u0275\u0275property("formControl",t.value)("value",t.value==null?null:t.value.value)}}let ti=class du extends Be{constructor(){super(...arguments),this.enterKeyDown=new i.EventEmitter}onEnterKeyDown(e){this.enterKeyDown.next(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(du)))(n||du)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:du,selectors:[["ts-input"]],inputs:{caption:"caption",value:"value"},outputs:{enterKeyDown:"enterKeyDown"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","full-width ts-input","appearance","fill",3,"ngStyle","ngClass",4,"ngIf"],["appearance","fill",1,"full-width","ts-input",3,"ngStyle","ngClass"],["matInput","","autocomplete","off",3,"keydown.enter","formControl","value"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,uI,4,6,"mat-form-field",0),t&2&&i.\u0275\u0275property("ngIf",n.value)},dependencies:[b.NgClass,b.NgIf,b.NgStyle,Z.DefaultValueAccessor,Z.NgControlStatus,K.MatFormField,K.MatLabel,re.MatInput,Z.FormControlDirective],encapsulation:2})}};(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],ti.prototype,"caption",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Z.FormControl)],ti.prototype,"value",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],ti.prototype,"enterKeyDown",void 0),ti=(0,p.__decorate)([Tn({type:"crt.DeprecatedInput",formControlConfig:{relatesTo:"value"},reuseStrategy:Kt.Reuse})],ti);let fa=class hu extends Be{static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(hu)))(n||hu)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:hu,selectors:[["ts-label"]],inputs:{label:"label"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[[1,"ts-label",3,"ngStyle","ngClass"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0)(1,"label"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275property("ngStyle",n.styles)("ngClass",n.classes),i.\u0275\u0275attribute("id",n.id),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.label))},dependencies:[b.NgClass,b.NgStyle],encapsulation:2})}};(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],fa.prototype,"label",void 0),fa=(0,p.__decorate)([Tn({type:"crt.DeprecatedLabel",reuseStrategy:Kt.Reuse})],fa);class Xt{static{this.\u0275fac=function(t){return new(t||Xt)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Xt})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[na],imports:[b.CommonModule,zl.MatRadioModule,Z.FormsModule,W.MatButtonModule,Rt.MatCheckboxModule,Y.MatDialogModule,jt.MatDividerModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,v.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Xt,{declarations:[ki,No],imports:[b.CommonModule,zl.MatRadioModule,Z.FormsModule,W.MatButtonModule,Rt.MatCheckboxModule,Y.MatDialogModule,jt.MatDividerModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,v.TranslateModule],exports:[ki]})})();const dI=["*"],hI=a=>({show:a});function pI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-expansion-button",2),i.\u0275\u0275listener("toggle",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onToggle())}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("direction",t.panelConfig==null?null:t.panelConfig.direction)("animationDisabled",t.panelConfig==null?null:t.panelConfig.animationDisabled)("isExpanded",t.isExpanded)}}class Uo{constructor(){this.isExpanded=!1,this.toggle=new i.EventEmitter}onToggle(){this.toggle.emit()}static{this.\u0275fac=function(t){return new(t||Uo)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Uo,selectors:[["ts-vertical-expansion-panel"]],inputs:{isExpanded:"isExpanded",panelConfig:"panelConfig"},outputs:{toggle:"toggle"},ngContentSelectors:dI,decls:4,vars:7,consts:[["class","expansion-button",3,"direction","animationDisabled","isExpanded","toggle",4,"ngIf"],[1,"panel",3,"ngClass"],[1,"expansion-button",3,"toggle","direction","animationDisabled","isExpanded"]],template:function(t,n){t&1&&(i.\u0275\u0275projectionDef(),i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275template(1,pI,1,3,"crt-expansion-button",0),i.\u0275\u0275elementStart(2,"div",1),i.\u0275\u0275projection(3),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275classMapInterpolate1("container button-placement-",n.panelConfig==null?null:n.panelConfig.direction,""),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.panelConfig==null?null:n.panelConfig.showToggleButton),i.\u0275\u0275advance(),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(5,hI,n.isExpanded)))},dependencies:[b.NgClass,b.NgIf,ra],styles:[".container[_ngcontent-%COMP%]{position:relative;height:100%}.expansion-button[_ngcontent-%COMP%]{position:absolute;z-index:3}.button-placement-left[_ngcontent-%COMP%]   .expansion-button[_ngcontent-%COMP%]{right:calc(100% + 10px)}.button-placement-right[_ngcontent-%COMP%]   .expansion-button[_ngcontent-%COMP%]{left:100%}.panel[_ngcontent-%COMP%]{display:none}.panel.show[_ngcontent-%COMP%]{display:flex;height:100%}"],changeDetection:0})}}const mI=["default-file-icon","file-excel","file-image","file-pdf","file-powerpoint","file-word"];var Eg=m(83173),Bi=m(99295),Dg=m(49393),Ag=m(36037),xn=m(18093);class Ho{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||Ho)(i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ho,selectors:[["ts-info-with-header-dialog"]],decls:9,vars:10,consts:[[1,"header-message"],[1,"message"],[1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",1),i.\u0275\u0275text(4),i.\u0275\u0275pipe(5,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(6,"button",2),i.\u0275\u0275text(7),i.\u0275\u0275pipe(8,"translate"),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,4,n.data==null?null:n.data.headerMessage)),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(5,6,n.data==null?null:n.data.message)),i.\u0275\u0275advance(2),i.\u0275\u0275property("mat-dialog-close",n.data==null||n.data.button==null?null:n.data.button.result),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(8,8,n.data==null||n.data.button==null?null:n.data.button.caption),`
`))},dependencies:[Y.MatDialogClose,v.TranslatePipe],styles:[".header-message[_ngcontent-%COMP%]{margin-bottom:24px}.message[_ngcontent-%COMP%]{margin-bottom:40px;white-space:pre-wrap}.action-button[_ngcontent-%COMP%]{float:right;text-transform:none;border-radius:16px;padding:0 16px}"]})}}class en{static{this.\u0275fac=function(t){return new(t||en)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:en})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Je,{provide:ea.FocusTrapFactory,useClass:ea.ConfigurableFocusTrapFactory}],imports:[b.CommonModule,W.MatButtonModule,Y.MatDialogModule,v.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(en,{declarations:[as,rs,os,Ho],imports:[b.CommonModule,W.MatButtonModule,Y.MatDialogModule,v.TranslateModule],exports:[as,os,Ho,rs]})})();const gI=["tooltipEl"],fI=a=>({rtl:a});class wn{constructor(e,t){this._directionality=e,this._sanitizer=t,this._defaultCssClass="base-tooltip crt-base-tooltip"}setInnerHTML(){this.tooltipEl&&(this.tooltipEl.nativeElement.innerHTML=this._sanitizer.sanitize(i.SecurityContext.HTML,this._tooltipConfig?.value))}set tooltipConfig(e){this._tooltipConfig!==e&&(this._tooltipConfig=e)}get tooltipConfig(){return this._tooltipConfig}get cssClasses(){let e=this._tooltipConfig?.cssClasses||this._defaultCssClass;const t=typeof e=="string";return t&&(e=e.split(" ")),e.includes("base-tooltip")&&this._directionality.value==="rtl"&&!e.includes("base-tooltip_rtl")&&e.push("base-tooltip_rtl"),t?e.join(" "):e}isRtl(){return this._directionality.value==="rtl"}ngAfterViewInit(){this.setInnerHTML()}static{this.\u0275fac=function(t){return new(t||wn)(i.\u0275\u0275directiveInject(vn.Directionality),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:wn,selectors:[["crt-base-tooltip"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(gI,5,i.ElementRef),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.tooltipEl=s.first)}},inputs:{tooltipConfig:"tooltipConfig"},decls:3,vars:6,consts:[["tooltipEl",""],[1,"tooltip-value",3,"ngClass"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275element(1,"span",1,0),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275classMap(n.cssClasses),i.\u0275\u0275advance(),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(4,fI,n.isRtl())))},dependencies:[b.NgClass],styles:[".base-tooltip[_ngcontent-%COMP%]{max-width:320px;max-height:50vh;overflow-y:auto;overflow-x:auto;box-shadow:0 2px 4px #18181840;padding-left:8px;padding-right:8px;margin:10px;opacity:1;word-wrap:break-word}.base-tooltip_rtl[_ngcontent-%COMP%]{padding-left:0;padding-right:8px}.base-tooltip[_ngcontent-%COMP%]   .rtl[_ngcontent-%COMP%]{direction:rtl;text-align:right}  .base-tooltip img{max-width:100%;height:auto}"]})}}class Yo{constructor(e){this.showEvent="mouseenter",this.hideEvent="mouseleave",this.capture=!1,this.closeOnOutsideClick=!1,P.cn.isMobile&&(e.closeOnOutsideClick=!0,e.showEvent="touchstart",e.hideEvent="touched"),Object.assign(this,e)}}var Ui=m(89422);const _I=500;class Nn{constructor(e,t,n,s){this._overlay=e,this._overlayPositionBuilder=t,this._elementRef=n,this._ngZone=s,this._delayTime=_I,this._allowedKeyboardEvent=[Ui.Key.Enter,Ui.Key.Escape,Ui.Key.Tab],this._class="crt-tooltip-trigger"}set tooltipConfig(e){if(!e)return;this._tooltipConfig=this._normalizeTooltipEvents(e);const t=P.cn.isMobile?"touchstart":"click";if(this._tooltipConfig.showEvent.includes(t)||this._elementRef.nativeElement.addEventListener(t,this._handleScreenReaderEnterEvent.bind(this)),this._tooltipRef){if(this._tooltipRef.instance.tooltipConfig=this._tooltipConfig.tooltipConfig,!this._tooltipRef.instance.tooltipConfig)return;this._tooltipRef.instance.tooltipConfig.cssClasses=this._tooltipConfig?.panelClass}}get tooltipConfig(){return this._tooltipConfig}set crtTooltip(e){!e||Array.isArray(e)&&e.length===0||(this.tooltipConfig=new Yo({tooltipConfig:{value:Array.isArray(e)?e.join("<br>"):e},componentType:wn}))}_createEventObservables(e,t){return e?e?.map(n=>(0,u.fromEvent)(t,n,{capture:this._tooltipConfig?.capture})):[]}_createShowEventStream(e){const t=this._createEventObservables(this._tooltipConfig?.showEvent,this._elementRef.nativeElement);return this._ngZone.runOutsideAngular(()=>(0,u.merge)(...t).pipe((0,c.auditTime)(this._delayTime),(0,c.takeUntil)(e)))}_createHideEventStream(e){const t=this._createEventObservables(this._tooltipConfig?.hideEvent,e);return this._ngZone.runOutsideAngular(()=>(0,u.merge)(...t))}_createEventsStream(e,t){this._subscription=t.subscribe(),this._subscription.add(e.subscribe());const n=(0,u.merge)(e,t);n.pipe((0,c.takeUntil)(t));const s=n.subscribe(r=>{if(this._tooltipConfig.showEvent?.includes(r.type)&&this.show(r),this._tooltipConfig.hideEvent?.includes(r.type)){let o=r.relatedTarget;this._overlayRef?.overlayElement.contains(o)||(o=this._elementRef.nativeElement,this.hide(),this._subscription.unsubscribe());const l=this._createHideEventStream(o),d=this._createShowEventStream(l);this._createEventsStream(d,l)}});this._subscription.add(s)}_createKeyboardEvent(){const e=this._ngZone.runOutsideAngular(()=>(0,u.fromEvent)(this._elementRef.nativeElement,"keydown",{capture:this._tooltipConfig?.capture}).pipe((0,c.filter)(n=>this._allowedKeyboardEvent.includes(n.key)))),t=this._ngZone.runOutsideAngular(()=>(0,u.fromEvent)(this._elementRef.nativeElement,"blur",{capture:this._tooltipConfig?.capture}));this._createKeyboardEventsStream(e,t)}_createKeyboardEventsStream(e,t){this._keypressSubscription=t.subscribe();const n=(0,u.merge)(e,t);n.pipe((0,c.takeUntil)(t));const s=n.subscribe(r=>{r instanceof KeyboardEvent?this._onHandleKeyboardEvent(r):r instanceof FocusEvent&&this._onHandleFocusEvent(r)});this._keypressSubscription.add(s)}_onHandleKeyboardEvent(e){switch(e.key){case Ui.Key.Enter:e.stopPropagation(),this._overlayRef?.hasAttached()?this.hide():this.show(e);break;case Ui.Key.Escape:this._overlayRef?.hasAttached()&&e.stopPropagation(),this.hide(),this._keypressSubscription.unsubscribe(),this._createKeyboardEvent();break;case Ui.Key.Tab:this._overlayRef?.hasAttached()&&(this.hide(),this._keypressSubscription.unsubscribe(),this._createKeyboardEvent());break}}_handleScreenReaderEnterEvent(e){e.stopPropagation();const t=document.activeElement===this._elementRef.nativeElement;if(e.isPrimary&&e.buttons===1&&t){const n=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,charCode:13,bubbles:!0,cancelable:!0});this._onHandleKeyboardEvent(n)}}_onHandleFocusEvent(e){if(e.type!=="blur")return;const t=e.relatedTarget;this._overlayRef?.overlayElement.contains(t)||(this.hide(),this._keypressSubscription.unsubscribe()),this._createKeyboardEvent()}_getPreferredPositions(){return[{originX:"end",originY:"center",overlayX:"start",overlayY:"center",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass},{originX:"end",originY:"bottom",overlayX:"center",overlayY:"top",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass},{originX:"center",originY:"center",overlayX:"end",overlayY:"top",offsetX:0,offsetY:0,panelClass:this._tooltipConfig?.panelClass}]}_prepareTooltipConfigFromOverlayConfig(e){const t=e.tooltipConfig;return this._tooltipConfig.tooltipConfig&&e.panelClass&&(t.cssClasses=e.panelClass),t}_createOverlay(){if(!this._tooltipConfig)return;const e=this._tooltipConfig?.preferredPositions??this._getPreferredPositions(),t=this._overlayPositionBuilder.flexibleConnectedTo(this._elementRef).withPositions(e),n={scrollStrategy:this._overlay.scrollStrategies.close(),positionStrategy:t};this._tooltipConfig?.width&&Object.assign(n,{width:this._tooltipConfig?.width}),this._tooltipConfig?.height&&Object.assign(n,{height:this._tooltipConfig?.height}),this._overlayRef=this._overlay.create(n),this._tooltipConfig.closeOnOutsideClick&&this._overlayRef.outsidePointerEvents().subscribe(()=>this.hide()),this._overlayRef.keydownEvents().pipe((0,c.filter)(s=>s.key===Ui.Key.Escape)).subscribe(()=>{this.hide()})}_subscribeOnClickToHide(){this._ngZone.runOutsideAngular(()=>(0,u.fromEvent)(this._elementRef.nativeElement,P.cn.isMobile?"touchstart":"click").subscribe(e=>{e.ignoreHandle=this._overlayRef?.hasAttached(),this.hide()}))}_normalizeTooltipEvents(e){const t=Array.isArray(e.showEvent)?e.showEvent:[e.showEvent],n=Array.isArray(e.hideEvent)?e.hideEvent:[e.hideEvent];return{...e,showEvent:t,hideEvent:n}}hide(){this._overlayRef?.hasAttached()&&(this._overlayRef.detach(),this._overlayRef.dispose(),this._overlayRef=null)}show(e){if(e.ignoreHandle)return;const t=e.relatedTarget;!this._tooltipConfig||t&&!document.body.contains(t)||(e?.stopPropagation(),this._overlayRef||this._createOverlay(),this._overlayRef.hasAttached()||(this._tooltipRef=this._overlayRef.attach(new xh.ComponentPortal(this._tooltipConfig.componentType))),this._tooltipRef&&(this._tooltipRef.instance.tooltipConfig=this._prepareTooltipConfigFromOverlayConfig(this._tooltipConfig),this._tooltipRef.location.nativeElement.setAttribute("id",this.id)))}ngAfterViewInit(){const e=this._createHideEventStream(this._elementRef.nativeElement),t=this._createShowEventStream(e);this._createEventsStream(t,e),this._createKeyboardEvent(),this._subscribeOnClickToHide()}ngOnDestroy(){this.hide(),this._subscription?.unsubscribe(),this._keypressSubscription?.unsubscribe()}static{this.\u0275fac=function(t){return new(t||Nn)(i.\u0275\u0275directiveInject(mn.Overlay),i.\u0275\u0275directiveInject(mn.OverlayPositionBuilder),i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(i.NgZone))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Nn,selectors:[["","crtTooltip",""]],hostVars:2,hostBindings:function(t,n){t&2&&i.\u0275\u0275classMap(n._class)},inputs:{id:[0,"crtTooltipId","id"],tooltipConfig:"tooltipConfig",crtTooltip:"crtTooltip"},exportAs:["crtTooltip"]})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],Nn.prototype,"id",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Yo),(0,p.__metadata)("design:paramtypes",[Yo])],Nn.prototype,"tooltipConfig",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object),(0,p.__metadata)("design:paramtypes",[Object])],Nn.prototype,"crtTooltip",null);class Zo{constructor(){this.tooltipId=(0,A.qv)(),this.ariaLabel="",this.type="default",this.tabIndex=0,this.icon="info-icon"}set tooltip(e){e instanceof Yo?this._tooltipConfig=e:this._tooltipConfig=this._createTooltipConfig(e)}get tooltip(){return this._tooltipConfig}get tooltipMode(){return{error:"Tooltip.Mode.Error",default:"Tooltip.Mode.Default",none:""}[this.type]||""}get iconClass(){return{error:"invalid-icon",default:"tooltip-icon",none:""}[this.type]||""}_createTooltipConfig(e){return new Yo({showEvent:["focus","mouseenter"],hideEvent:["blur","mouseleave"],componentType:wn,tooltipConfig:{value:e},preferredPositions:[{originX:"end",originY:"center",overlayX:"start",overlayY:"center"}]})}static{this.\u0275fac=function(t){return new(t||Zo)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Zo,selectors:[["crt-icon-tooltip"]],inputs:{tooltip:"tooltip",ariaLabel:"ariaLabel",type:"type",tabIndex:"tabIndex",icon:"icon"},decls:2,vars:9,consts:[["matSuffix","","crtTooltip","","role","button","aria-hidden","false",3,"crtTooltipId","tooltipConfig","ngClass","svgIcon","tabindex"]],template:function(t,n){t&1&&(i.\u0275\u0275element(0,"mat-icon",0),i.\u0275\u0275pipe(1,"translate")),t&2&&(i.\u0275\u0275property("crtTooltipId",n.tooltipId)("tooltipConfig",n.tooltip)("ngClass",n.iconClass)("svgIcon",n.icon)("tabindex",n.tabIndex),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(1,7,n.tooltipMode)+" "+n.ariaLabel)("aria-describedby",n.tooltipId))},dependencies:[b.NgClass,U.MatIcon,Nn,v.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{height:20px}.mat-icon[_ngcontent-%COMP%]{width:16px;height:16px;padding:2px}.mat-icon[_ngcontent-%COMP%]:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}"],changeDetection:0})}}class Wo{constructor(){this.showDelay=100,this.hideDelay=100,this.infoTooltipClass="",this.icon="info-tooltip",this.tooltipPosition="above"}static{this.\u0275fac=function(t){return new(t||Wo)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Wo,selectors:[["ts-info-tooltip-icon"]],inputs:{message:"message",showDelay:"showDelay",hideDelay:"hideDelay",infoTooltipClass:"infoTooltipClass",icon:"icon",tooltipPosition:"tooltipPosition"},decls:1,vars:6,consts:[[3,"svgIcon","matTooltip","matTooltipClass","matTooltipShowDelay","matTooltipHideDelay","matTooltipPosition"]],template:function(t,n){t&1&&i.\u0275\u0275element(0,"mat-icon",0),t&2&&i.\u0275\u0275property("svgIcon",n.icon)("matTooltip",n.message)("matTooltipClass",n.infoTooltipClass)("matTooltipShowDelay",n.showDelay)("matTooltipHideDelay",n.hideDelay)("matTooltipPosition",n.tooltipPosition)},dependencies:[U.MatIcon,vt.MatTooltip],styles:["[_nghost-%COMP%]{height:22px;width:22px}mat-icon[_ngcontent-%COMP%]{color:#22ac14;width:22px;height:22px;cursor:pointer}"]})}}function yI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.translate("OperationsPoint"))}}function CI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"li"),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t)}}function MI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"ol"),i.\u0275\u0275template(1,CI,2,1,"li",3),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.data==null?null:t.data.byOperations)}}function II(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span"),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.translate("RecordsPoint"))}}function bI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"li"),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t)}}function SI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"ol"),i.\u0275\u0275template(1,bI,2,1,"li",3),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.data==null?null:t.data.byRecords)}}class Zl extends wn{set tooltipConfig(e){this.data=e.value}constructor(e,t,n,s,r){super(e,t),this.directionality=e,this._translateService=n,this._dialogService=s,this._environment=r,this._translatePrefix="ObjectPermissions."}translate(e){return this._translateService.instant(this._translatePrefix+e)}getUrl(){return this._url||(this._url=this._environment.workspaceBaseUrl+"ClientApp/#/AdministratedObjects"),this._url}updateObjectPermissions(){this._dialogService.openConfirmationDialog(this.translate("UpdateObjectPermissionsMessage")).pipe((0,u.map)(e=>{e===Pu.result&&this.data.setObjectPermissionsFn(this.data.targetId).subscribe()})).subscribe()}static{this.\u0275fac=function(t){return new(t||Zl)(i.\u0275\u0275directiveInject(vn.Directionality),i.\u0275\u0275directiveInject(y.DomSanitizer),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(Je),i.\u0275\u0275directiveInject("environment"))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Zl,selectors:[["crt-object-permissions-warning"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:17,vars:14,consts:[[4,"ngIf"],["target","_blank",3,"href"],["target","_blank",1,"update-permissions-link",3,"click"],[4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div")(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(3,yI,2,1,"span",0)(4,MI,2,1,"ol",0)(5,II,2,1,"span",0)(6,SI,2,1,"ol",0),i.\u0275\u0275elementStart(7,"span"),i.\u0275\u0275text(8),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(9,"a",1),i.\u0275\u0275text(10),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(11,"span"),i.\u0275\u0275text(12),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(13,"a",2),i.\u0275\u0275listener("click",function(){return n.updateObjectPermissions()}),i.\u0275\u0275text(14),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(15,"p"),i.\u0275\u0275text(16),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275classMapInterpolate1("component-container ",n.cssClasses,""),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.translate("Warning")),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.data==null||n.data.byOperations==null?null:n.data.byOperations.length)>0),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.data==null||n.data.byOperations==null?null:n.data.byOperations.length)>0),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.data==null||n.data.byRecords==null?null:n.data.byRecords.length)>0),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.data==null||n.data.byRecords==null?null:n.data.byRecords.length)>0),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.translate("SetProperPermissionsBegin")),i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("href",n.getUrl(),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(n.translate("ObjectPermissions")),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.translate("SetProperPermissionsEnd")),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.translate("Link")),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.translate("End")))},dependencies:[b.NgForOf,b.NgIf],styles:[".component-container[_ngcontent-%COMP%]{min-width:450px;max-width:450px;border-bottom:0px!important}.component-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.component-container[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:4px;padding-inline-start:20px}.component-container[_ngcontent-%COMP%]   a.update-permissions-link[_ngcontent-%COMP%]{display:block;line-height:40px}"]})}}function vI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div"),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275classMapInterpolate1("rule ",n.getValidationClass(t.valid),""),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.caption," ")}}class $o extends wn{set tooltipConfig(e){this.validationTooltipConfig=e.value}constructor(e,t){super(e,t),this.directionality=e}getValidationClass(e){return e?"valid":typeof e=="boolean"?"invalid":"not-validated"}setInnerHTML(){}static{this.\u0275fac=function(t){return new(t||$o)(i.\u0275\u0275directiveInject(vn.Directionality),i.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:$o,selectors:[["crt-validation-result-tooltip"]],features:[i.\u0275\u0275InheritDefinitionFeature],decls:5,vars:5,consts:[[1,"header"],[1,"rules"],[3,"class",4,"ngFor","ngForOf"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div")(1,"div",0),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",1),i.\u0275\u0275template(4,vI,2,4,"div",2),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275classMapInterpolate1("component-container ",n.cssClasses,""),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1("",n.validationTooltipConfig==null?null:n.validationTooltipConfig.header,":"),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",n.validationTooltipConfig==null?null:n.validationTooltipConfig.validations))},dependencies:[b.NgForOf],styles:[".component-container[_ngcontent-%COMP%]{max-width:400px;display:flex;flex-direction:column;padding:16px;border-width:1px;border-style:solid}.component-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{text-align:left;font-weight:700;padding-bottom:6px}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule[_ngcontent-%COMP%]{width:50%;position:relative;left:24px;text-indent:-24px;padding-right:30px;box-sizing:border-box;margin-bottom:9px}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule[_ngcontent-%COMP%]:before{padding-right:8px;top:3px;position:relative}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.valid[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTUiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2M4MjIzIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3OSIgZGF0YS1uYW1lPSJQYXRoIDExODc5IiBkPSJNMTcuMDkzLDI4LjE4bDIuNSwzLDQuNS01IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NzMuNDA3IDU1MS4zMikiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzNjODIyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPC9nPgo8L3N2Zz4K)}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.invalid[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTQiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjYzIzZjIzIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3NyIgZGF0YS1uYW1lPSJQYXRoIDExODc3IiBkPSJNMTQyOCw0ODF2NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE3My41MDkgLTc3MS45ODgpIHJvdGF0ZSg0NSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2MyM2YyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgICA8cGF0aCBpZD0iUGF0aF8xMTg3OCIgZGF0YS1uYW1lPSJQYXRoIDExODc4IiBkPSJNMTQyOCw0ODF2NiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTg0NS45ODggLTg3LjUwOSkgcm90YXRlKDEzNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2MyM2YyMyIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPC9nPgo8L3N2Zz4K)}.component-container[_ngcontent-%COMP%]   .rules[_ngcontent-%COMP%]   .rule.not-validated[_ngcontent-%COMP%]:before{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KICA8ZyBpZD0iR3JvdXBfMTY1OTMiIGRhdGEtbmFtZT0iR3JvdXAgMTY1OTMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00ODYgLTU3MikiPgogICAgPHJlY3QgaWQ9IlJlY3RhbmdsZV80MjUxMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNDI1MTMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDg2IDU3MikiIGZpbGw9Im5vbmUiLz4KICAgIDxnIGlkPSJFbGxpcHNlXzMwODciIGRhdGEtbmFtZT0iRWxsaXBzZSAzMDg3IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0ODcgNTczKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNzU3NTc1IiBzdHJva2Utd2lkdGg9IjIiPgogICAgICA8Y2lyY2xlIGN4PSI3IiBjeT0iNyIgcj0iNyIgc3Ryb2tlPSJub25lIi8+CiAgICAgIDxjaXJjbGUgY3g9IjciIGN5PSI3IiByPSI2IiBmaWxsPSJub25lIi8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K)}"]})}}class ni{constructor(e){this._materialIconsRegistrator=e,this._materialIconsRegistrator.addIcons([{name:"tooltip-icon",icon:m(92825)}])}static{this.\u0275fac=function(t){return new(t||ni)(i.\u0275\u0275inject(Zt))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:ni})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,U.MatIconModule,vt.MatTooltipModule,v.TranslateModule,en]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(ni,{declarations:[Wo,wn,Nn,$o,Zl,Zo],imports:[b.CommonModule,U.MatIconModule,vt.MatTooltipModule,v.TranslateModule,en],exports:[Wo,wn,Nn,$o,Zo]})})();function TI(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",9),a&2){const t=e.$implicit;i.\u0275\u0275property("svgIcon",t)}}function xI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",10),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.getTriggerCaption())}}function wI(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",14),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("svgIcon",t.config.emptyOption==null?null:t.config.emptyOption.svgIconName)}}function NI(a,e){a&1&&i.\u0275\u0275element(0,"div",16)}function EI(a,e){if(a&1&&i.\u0275\u0275template(0,NI,1,0,"div",15),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngIf",t.needDisplayOptionIcons())}}function DI(a,e){a&1&&i.\u0275\u0275element(0,"mat-divider")}function AI(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"mat-option",11)(2,"div",12),i.\u0275\u0275template(3,wI,1,1,"mat-icon",13)(4,EI,1,1,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementStart(6,"span"),i.\u0275\u0275text(7),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275template(8,DI,1,0,"mat-divider",7),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275reference(5),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275styleProp("display",n.config.emptyOption?"":"none"),i.\u0275\u0275property("value",n.emptyValue),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.config.emptyOption==null?null:n.config.emptyOption.svgIconName)("ngIfElse",t),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(n.config.emptyOption==null?null:n.config.emptyOption.caption),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.config.emptyOption)}}function OI(a,e){if(a&1&&i.\u0275\u0275element(0,"mat-icon",14),a&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275property("svgIcon",t.svgIconName)}}function PI(a,e){a&1&&i.\u0275\u0275element(0,"div",16)}function kI(a,e){if(a&1&&i.\u0275\u0275template(0,PI,1,0,"div",15),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngIf",t.needDisplayOptionIcons())}}function jI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",17)(1,"div",12),i.\u0275\u0275template(2,OI,1,1,"mat-icon",13)(3,kI,1,1,"ng-template",null,1,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementStart(5,"span"),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd()()()),a&2){const t=e.$implicit,n=i.\u0275\u0275reference(4);i.\u0275\u0275property("value",t.value),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",t.svgIconName)("ngIfElse",n),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(t.caption)}}class Go{constructor(){this._panelClass=[],this.emptyValue={},this.innerValue=this.emptyValue,this.valueChange=new i.EventEmitter,this.disabled=!1}set config(e){this._config=e,this._validateConfig()}get config(){return this._config}set value(e){this.innerValue=e??this.emptyValue}get value(){return this.isEmptyValueSelected()?null:this.innerValue}set panelClass(e){e?.length>0&&(this._panelClass=[...e])}get panelClass(){return[...this._panelClass,"select-menu-panel"]}_validateValue(){if(this.isEmptyValueSelected()||this._getSelectedOption())return;const e=this.value,t=typeof e=="object"?JSON.stringify(e):e;throw new Error(`Value "${t}" is not specified in select menu configuration.`)}_validateConfig(){if(!this.config?.options)throw new Error(`Property "config" must be specified and contain valid options. Actual config is "${JSON.stringify(this.config)}".`)}_resetToFirstOptionIfNeeded(){this.config&&this.config.options.length>0&&!this.config.placeholder&&this.isEmptyValueSelected()&&(this.value=this.config.options[0].value,setTimeout(()=>{this.emitValueChange()},0))}_getSelectedOption(){const e=this.innerValue;return this.config.options.find(t=>t.value===e)}ngDoCheck(){this._validateValue(),this._resetToFirstOptionIfNeeded()}emitValueChange(){this.valueChange.emit(this.value)}trackByValue(e,t){return t.value}getTriggerCaption(){return this.isEmptyValueSelected()?this.config.placeholder?.caption:this._getSelectedOption().caption}getTriggerSvgIconName(){const e=this.config.placeholder?.svgIconName??this.config.emptyOption?.svgIconName;return this.isEmptyValueSelected()?e:this._getSelectedOption()?.svgIconName??e}isEmptyValueSelected(){return this.innerValue===this.emptyValue}needDisplayOptionIcons(){return!!this.config.emptyOption?.svgIconName||this.config.options.some(e=>e.svgIconName)}needDisplaySelectedCaption(){return this._config.hideSelectedCaption!==!0}static{this.\u0275fac=function(t){return new(t||Go)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Go,selectors:[["ts-select-menu"]],inputs:{config:"config",value:"value",disabled:"disabled",panelClass:"panelClass"},outputs:{valueChange:"valueChange"},decls:8,vars:9,consts:[["emptyOptionIconPlaceholder",""],["optionIconPlaceholder",""],["floatLabel","never"],["disableOptionCentering","",3,"valueChange","selectionChange","value","disabled","matTooltip","panelClass"],[1,"select-menu-trigger"],["class","select-menu-trigger-icon",3,"svgIcon",4,"ngIf"],["class","select-menu-trigger-caption",4,"ngIf"],[4,"ngIf"],["class","select-menu-option",3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[1,"select-menu-trigger-icon",3,"svgIcon"],[1,"select-menu-trigger-caption"],[1,"select-menu-option","select-menu-empty-option",3,"value"],[1,"select-menu-option-content"],[3,"svgIcon",4,"ngIf","ngIfElse"],[3,"svgIcon"],["class","select-menu-option-icon-placeholder",4,"ngIf"],[1,"select-menu-option-icon-placeholder"],[1,"select-menu-option",3,"value"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"mat-form-field",2)(1,"mat-select",3),i.\u0275\u0275twoWayListener("valueChange",function(r){return i.\u0275\u0275twoWayBindingSet(n.innerValue,r)||(n.innerValue=r),r}),i.\u0275\u0275listener("selectionChange",function(){return n.emitValueChange()}),i.\u0275\u0275elementStart(2,"mat-select-trigger")(3,"span",4),i.\u0275\u0275template(4,TI,1,1,"mat-icon",5)(5,xI,2,1,"span",6),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(6,AI,9,7,"ng-container",7)(7,jI,7,4,"mat-option",8),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("value",n.innerValue),i.\u0275\u0275property("disabled",n.disabled)("matTooltip",n.needDisplaySelectedCaption()?null:n.getTriggerCaption())("panelClass",n.panelClass),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.getTriggerSvgIconName()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.needDisplaySelectedCaption()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.config.placeholder),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.config.options)("ngForTrackBy",n.trackByValue))},dependencies:[b.NgForOf,b.NgIf,K.MatFormField,jt.MatDivider,U.MatIcon,qe.MatOption,Ge.MatSelect,Ge.MatSelectTrigger,vt.MatTooltip],styles:[`ts-select-menu .mat-mdc-form-field .mat-mdc-form-field-subscript-wrapper{display:none!important}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix{width:auto;padding:0!important;border-top:none!important}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select{width:auto;height:26px;display:flex;align-items:center;border-radius:2px}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select:not(.mat-mdc-select-disabled):focus,ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select:not(.mat-mdc-select-disabled):hover{background-color:#f2f5ff}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select .mat-mdc-select-trigger{padding:0 4px 0 8px}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select .mat-mdc-select-trigger .mat-mdc-select-value{max-width:100%;width:auto;color:#444;font-size:14px}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select .mat-mdc-select-trigger .mat-mdc-select-value .select-menu-trigger{display:flex;align-items:center;height:18px;line-height:18px;position:relative}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select .mat-mdc-select-trigger .mat-mdc-select-value .select-menu-trigger .select-menu-trigger-icon{height:16px;width:16px;margin:0 8px 0 0!important}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix mat-select .mat-mdc-select-trigger .mat-mdc-select-value .select-menu-trigger .select-menu-trigger-caption{position:relative;bottom:1px}ts-select-menu .mat-mdc-form-field .mat-mdc-text-field-wrapper .mdc-line-ripple{display:none}.mat-mdc-select-panel.select-menu-panel{max-height:500px!important;position:absolute;padding:1px}.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option{padding:0 18px;height:33px!important;min-height:33px!important;line-height:33px!important}.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option.select-menu-empty-option{margin-top:4px}.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option.select-menu-empty-option.select-menu-empty-option-hidden{display:none}.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option .select-menu-option-content,.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option .mdc-list-item__primary-text .select-menu-option-content{display:flex;align-items:center;font-size:14px;line-height:18px;padding-right:15px}.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option mat-icon,.mat-mdc-select-panel.select-menu-panel .mat-mdc-option.select-menu-option .select-menu-option-icon-placeholder{height:16px;width:16px;margin:0 8px 0 0!important}.mat-mdc-select-panel.select-menu-panel mat-divider{margin:5px 12px}
`],encapsulation:2})}}class _a{static{this.\u0275fac=function(t){return new(t||_a)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:_a})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,K.MatFormFieldModule,jt.MatDividerModule,U.MatIconModule,qe.MatOptionModule,Ge.MatSelectModule,vt.MatTooltipModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(_a,{declarations:[Go],imports:[b.CommonModule,K.MatFormFieldModule,jt.MatDividerModule,U.MatIconModule,qe.MatOptionModule,Ge.MatSelectModule,vt.MatTooltipModule],exports:[Go]})})();const RI="a29a3ba5-4b0d-de11-9a51-005056c00008",LI="720b771c-e7a7-4f31-9cfb-52cd21c3739f";var Ue;(function(a){a[a.Organization=0]="Organization",a[a.Division=1]="Division",a[a.Manager=2]="Manager",a[a.Team=3]="Team",a[a.User=4]="User",a[a.SelfServicePortalUser=5]="SelfServicePortalUser",a[a.FunctionalRole=6]="FunctionalRole",a[a.TechnicalUser=7]="TechnicalUser"})(Ue||(Ue={}));class Dv{}class Hi{constructor(e){this.httpClient=e,this.serviceEndpoint="ServiceModel/RightManagementService.svc/"}saveAdministratedObject(e){const t=this.serviceEndpoint+"SaveAdministratedObject";return this.httpClient.post(t,{administratedObject:e})}getAdministratedObject(e){const t=this.serviceEndpoint+"GetAdministratedObject";return this.httpClient.post(t,{schemaUId:e})}getAdministratedObjects(e){let t;switch(e){case pa.Section:t="GetSectionObjects";break;case pa.Lookup:t="GetLookupObjects";break;case pa.All:default:t="GetAllObjects";break}const n=this.serviceEndpoint+t;return this.httpClient.post(n,null)}getSysAdminUnitList(){if(!this._getSysAdminUnitList$){const e=this.serviceEndpoint+"GetSysAdminUnitList";this._getSysAdminUnitList$=this.httpClient.post(e,null).pipe((0,c.shareReplay)(1)),this._getSysAdminUnitList$.subscribe()}return this._getSysAdminUnitList$}getSysAdminUnitById(e){const t=this.serviceEndpoint+"GetSysAdminUnitById";return this.httpClient.post(t,{sysAdminUnitId:e})}static{this.\u0275fac=function(t){return new(t||Hi)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Hi,factory:Hi.\u0275fac})}}var VI=m(88359);const zI=["treeScrollWrapper"],Og=a=>({selected:a});function FI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-tree-node",5),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onNodeClick(s))}),i.\u0275\u0275element(1,"div",6),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(2,Og,n.isSelectedNode(t))),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",t.name," ")}}function BI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-tree-node",5),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onNodeClick(s))}),i.\u0275\u0275element(1,"div",7),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(4,Og,n.isSelectedNode(t))),i.\u0275\u0275advance(),i.\u0275\u0275property("ngClass",n.treeControl.isExpanded(t)?"minus":"plus"),i.\u0275\u0275attribute("aria-label","toggle "+t.name),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.name," ")}}class UI extends VI.FlatTreeControl{expandParents(e){const t=this.getLevel(e);if(t<1)return;const n=this.dataNodes.indexOf(e)-1;for(let s=n;s>=0;s--){const r=this.dataNodes[s];if(this.getLevel(r)<t){if(this.getDescendants(r).indexOf(e)===-1)continue;if(this.expand(r),this.getLevel(r)===0)break}}}}class Qo{constructor(){this.selectedUnitChange=new i.EventEmitter,this.treeControl=new UI(e=>e.level,e=>e.expandable),this.treeFlattener=new xn.MatTreeFlattener(this._transformNodeToFlatNode,e=>e.level,e=>e.expandable,e=>e.children),this.treeDataSource=new xn.MatTreeFlatDataSource(this.treeControl,this.treeFlattener)}set dataSource(e){this._dataSource!==e&&(this._dataSource=e,this._initTreeDataSource(),this._expandToSysAdminUnit(this.selectedUnit))}set selectedUnit(e){this._selectedUnit!==e&&(this._selectedUnit=e,this._expandToSysAdminUnit(e))}get selectedUnit(){return this._selectedUnit}_createNode(e){return{id:e.id,name:e.name,children:[]}}_transformNodeToFlatNode(e,t){return{id:e.id,name:e.name,expandable:!!(e.children&&e.children.length>0),level:t}}_createTreeDataFromFlatList(e){const t=[],n=[],s=e.map((r,o)=>(n[r.id]=o,this._createNode(r)),this);return e.forEach(r=>{const o=s[n[r.id]];if((0,A.gZ)(r.parentRoleId)||r.sysAdminUnitTypeValue===Ue.User)t.push(o);else{const l=s[n[r.parentRoleId]];if(!l)return;l.children.push(o)}}),t}_initTreeDataSource(){if(!Array.isArray(this._dataSource)){this.treeDataSource=null;return}this.treeDataSource.data=this._createTreeDataFromFlatList(this._dataSource)}_expandToSysAdminUnit(e){if(!e||!this.treeControl.dataNodes)return;const t=this.treeControl.dataNodes.find(n=>n.id===e.id);t&&(this.treeControl.expandParents(t),setTimeout(()=>this._scrollToItem(e),0))}_scrollToItem(e){const t=this._dataSource.findIndex(r=>r.id===e.id),n=this.treeScrollWrapper.nativeElement,s=n.scrollHeight/this._dataSource.length;n.scrollTop=t*s}hasChildren(e,t){return t.expandable}onNodeClick(e){const t=this._dataSource.find(n=>n.id===e.id);this._selectedUnit=t,this.selectedUnitChange.emit(t)}isSelectedNode(e){return!!(this.selectedUnit&&this.selectedUnit.id===e.id)}static{this.\u0275fac=function(t){return new(t||Qo)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Qo,selectors:[["ts-sysadminunit-tree"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(zI,7),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.treeScrollWrapper=s.first)}},inputs:{dataSource:"dataSource",selectedUnit:"selectedUnit"},outputs:{selectedUnitChange:"selectedUnitChange"},decls:5,vars:3,consts:[["treeScrollWrapper",""],[1,"tree-wrapper"],[3,"dataSource","treeControl"],["matTreeNodePadding","","matTreeNodePaddingIndent","27",3,"ngClass","click",4,"matTreeNodeDef"],["matTreeNodePadding","","matTreeNodePaddingIndent","27",3,"ngClass","click",4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodePadding","","matTreeNodePaddingIndent","27",3,"click","ngClass"],[1,"toggle-icon"],["matTreeNodeToggle","",1,"toggle-icon",3,"ngClass"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",1,0)(2,"mat-tree",2),i.\u0275\u0275template(3,FI,3,4,"mat-tree-node",3)(4,BI,3,6,"mat-tree-node",4),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275property("dataSource",n.treeDataSource)("treeControl",n.treeControl),i.\u0275\u0275advance(2),i.\u0275\u0275property("matTreeNodeDefWhen",n.hasChildren))},dependencies:[b.NgClass,xn.MatTreeNodeDef,xn.MatTreeNodePadding,xn.MatTreeNodeToggle,xn.MatTree,xn.MatTreeNode],styles:[".tree-wrapper[_ngcontent-%COMP%]{padding-top:15px;display:block;overflow:auto;max-height:313px}.tree-wrapper[_ngcontent-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{color:#444;line-height:19px;max-height:30px;min-height:30px;white-space:nowrap}.tree-wrapper[_ngcontent-%COMP%]   .mat-tree-node.selected[_ngcontent-%COMP%]{background-color:#f2f5ff}.tree-wrapper[_ngcontent-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]   .toggle-icon[_ngcontent-%COMP%]{width:16px;height:16px;margin-right:14px;margin-top:2px}.tree-wrapper[_ngcontent-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]   .plus[_ngcontent-%COMP%]{background:url(plus.svg) no-repeat;cursor:pointer}.tree-wrapper[_ngcontent-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]   .minus[_ngcontent-%COMP%]{background:url(minus.svg) no-repeat;cursor:pointer}"]})}}const HI=["usersListContainer"],YI=(a,e)=>({"mat-optgroup-label":a,"selectable-item":e}),ZI=a=>({selected:a});function WI(a,e){a&1&&i.\u0275\u0275element(0,"ts-mask")}function $I(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",22),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("value",t.sysAdminUnit)("ngClass",i.\u0275\u0275pureFunction2(4,YI,!t.sysAdminUnit,t.sysAdminUnit))("disabled",!t.sysAdminUnit),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate((t.sysAdminUnit==null?null:t.sysAdminUnit.name)||t.groupName)}}function GI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"cdk-virtual-scroll-viewport",20),i.\u0275\u0275template(1,$I,2,7,"mat-option",21),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275styleProp("height",t.calculateSearchResultContainerHeight()),i.\u0275\u0275advance(),i.\u0275\u0275property("cdkVirtualForOf",t.filteredSysAdminUnits)}}function QI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ts-sysadminunit-tree",23),i.\u0275\u0275twoWayListener("selectedUnitChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275twoWayBindingSet(r.selectedUnit,s)||(r.selectedUnit=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275listener("dblclick",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onTreeDoubleClick())}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("dataSource",t.dataSource),i.\u0275\u0275twoWayProperty("selectedUnit",t.selectedUnit)}}function JI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"ts-sysadminunit-tree",23),i.\u0275\u0275twoWayListener("selectedUnitChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275twoWayBindingSet(r.selectedUnit,s)||(r.selectedUnit=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275listener("dblclick",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onTreeDoubleClick())}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("dataSource",t.dataSource),i.\u0275\u0275twoWayProperty("selectedUnit",t.selectedUnit)}}function qI(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",27),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(r.onItemClick(s))})("dblclick",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(s.onTreeDoubleClick())}),i.\u0275\u0275elementStart(1,"div",28),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(2);i.\u0275\u0275propertyInterpolate("id",t.id),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(3,ZI,n.isSelectedItem(t))),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",t.name," ")}}function KI(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",24)(1,"cdk-virtual-scroll-viewport",25,1),i.\u0275\u0275template(3,qI,3,5,"div",26),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(3),i.\u0275\u0275property("cdkVirtualForOf",t.dataSource)}}var Te;(function(a){a[a.OrganizationRoles=0]="OrganizationRoles",a[a.FunctionalRoles=1]="FunctionalRoles",a[a.Users=2]="Users"})(Te||(Te={}));class Jo{constructor(e,t,n,s,r){this.dialogRef=e,this.dialogService=t,this.rightManagementService=n,this.translateService=s,this.data=r,this.isLoading=!1,this.selectedTabIndex=0}_getGroupNameByTabIndex(e){let t="";switch(e){case Te.OrganizationRoles:t=this.translateService.instant("SelectSysAdminUnitDialog.OrganizationalRoles");break;case Te.FunctionalRoles:t=this.translateService.instant("SelectSysAdminUnitDialog.FunctionalRoles");break;case Te.Users:t=this.translateService.instant("SelectSysAdminUnitDialog.Users");break}return t}_getAllEmployeesUnit(){return this.sysAdminUnits.find(e=>e.id===RI)}_getAllPortalUsersUnit(){return this.sysAdminUnits.find(e=>e.id===LI)}_getSysAdminUnitTypesByTabIndex(e){let t=[];switch(e){case Te.OrganizationRoles:t=[Ue.Organization,Ue.Division,Ue.Manager,Ue.SelfServicePortalUser];break;case Te.FunctionalRoles:t=[Ue.FunctionalRole];break;case Te.Users:t=[Ue.User,Ue.TechnicalUser];break}return t}_fillSysAdminUnitsWithGroup(e){this.sysAdminUnitsWithGroup=[],Object.keys(Te).forEach(t=>{const n=Number(Te[t]);if(isNaN(n))return;const s=this._getSysAdminUnitTypesByTabIndex(n),r=this._getGroupNameByTabIndex(n);this.sysAdminUnitsWithGroup.push({sysAdminUnit:null,tabIndex:n,groupName:r}),e.filter(o=>s.indexOf(o.sysAdminUnitTypeValue)>-1).forEach(o=>{this.sysAdminUnitsWithGroup.push({sysAdminUnit:o,tabIndex:n,groupName:r})})})}_prepareSysAdminUnits(e){if(!e||!e.success){this.isLoading=!1,e&&e.errorInfo&&this.dialogService.openInfoDialog(e.errorInfo.message);return}this.sysAdminUnits=e.sysAdminUnits,this._fillSysAdminUnitsWithGroup(this.sysAdminUnits),this.fillContentByTab(Te.OrganizationRoles),this.isLoading=!1}_applySysAdminUnit(){const e=this.data&&this.data.validator,t=e&&e(this.selectedUnit);if(t&&!t.success){this.dialogService.openInfoDialog(t.message);return}this.dialogRef.close(this.selectedUnit)}_changeTabIndexBySysAdminUnitType(e){let t=this.selectedTabIndex;switch(e){case Ue.Organization:case Ue.Division:case Ue.Manager:case Ue.SelfServicePortalUser:t=Te.OrganizationRoles;break;case Ue.FunctionalRole:t=Te.FunctionalRoles;break;case Ue.User:case Ue.TechnicalUser:t=Te.Users;break}this.selectedTabIndex=t}_scrollToSelectedItem(){const e=this.selectedUnit&&this.dataSource.findIndex(t=>t.id===this.selectedUnit.id);e!==-1&&setTimeout(()=>{this._viewport.scrollToIndex(e)},0)}ngOnInit(){this.isLoading=!0,this.rightManagementService.getSysAdminUnitList().subscribe(this._prepareSysAdminUnits.bind(this))}fillContentByTab(e){if(!Array.isArray(this.sysAdminUnits)){this.dataSource=null;return}const t=this._getSysAdminUnitTypesByTabIndex(e),n=this.sysAdminUnits.filter(s=>t.indexOf(s.sysAdminUnitTypeValue)>-1);if(e===Te.FunctionalRoles){n.push(this._getAllEmployeesUnit());const s=this._getAllPortalUsersUnit();s&&n.push(s)}this.dataSource=n,this.selectedTabIndex===Te.Users&&this._scrollToSelectedItem()}onTreeDoubleClick(){this.selectedUnit&&this._applySysAdminUnit()}onSelectButtonClick(){this._applySysAdminUnit()}getSysAdminUnitName(e){return e.name}onFilteredSysAdminUnitSelected(e){const t=e.option.value;this._changeTabIndexBySysAdminUnitType(t.sysAdminUnitTypeValue),this.selectedUnit=t,this.fillContentByTab(this.selectedTabIndex),this.selectedTabIndex===Te.Users&&this._scrollToSelectedItem()}search(e){if(!e||e.length<3){this.filteredSysAdminUnits=[];return}e=e.toLocaleLowerCase(),this.filteredSysAdminUnits=this.sysAdminUnitsWithGroup.filter(n=>!n.sysAdminUnit||n.sysAdminUnit.name.toLowerCase().indexOf(e.toLowerCase())!==-1).filter((n,s,r)=>n.sysAdminUnit||!n.sysAdminUnit&&r.findIndex(o=>o.groupName===n.groupName&&o.sysAdminUnit)>-1)}isOrganizationalRolesVisible(){return this.selectedTabIndex===Te.OrganizationRoles}isFunctionalRolesVisible(){return this.selectedTabIndex===Te.FunctionalRoles}isUsersVisible(){return this.selectedTabIndex===Te.Users}onItemClick(e){this.selectedUnit=e}isSelectedItem(e){return!!(this.selectedUnit&&this.selectedUnit.id===e.id)}calculateSearchResultContainerHeight(){return`${this.filteredSysAdminUnits.length*33}px`}static{this.\u0275fac=function(t){return new(t||Jo)(i.\u0275\u0275directiveInject(Y.MatDialogRef),i.\u0275\u0275directiveInject(Je),i.\u0275\u0275directiveInject(Hi),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(Y.MAT_DIALOG_DATA))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Jo,selectors:[["ts-select-sysadminunit-dialog"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(HI,5),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n._viewport=s.first)}},decls:33,vars:30,consts:[["auto","matAutocomplete"],["usersListContainer",""],[4,"ngIf"],["mat-dialog-title",""],["mat-icon-button","",1,"close-dialog",3,"mat-dialog-close"],["svgIcon","close",1,"close-button-icon"],["mat-dialog-actions",""],["mat-flat-button","","color","accent",3,"click","disabled"],["mat-button","","cdkFocusInitial","",3,"mat-dialog-close"],["mat-dialog-content",""],[1,"search-input"],["floatLabel","never"],["matInput","","type","text","spellcheck","false",3,"input","focus","placeholder","matAutocomplete"],["matSuffix","","svgIcon","search"],[3,"optionSelected","displayWith"],["itemSize","33","minBufferPx","297","maxBufferPx","396","class","search-list-viewport",3,"height",4,"ngIf"],["animationDuration","0ms","disableRipple","true",3,"selectedIndexChange","selectedIndex"],[3,"label"],[3,"dataSource","selectedUnit","selectedUnitChange","dblclick",4,"ngIf"],["class","users-wrapper",4,"ngIf"],["itemSize","33","minBufferPx","297","maxBufferPx","396",1,"search-list-viewport"],[3,"value","ngClass","disabled",4,"cdkVirtualFor","cdkVirtualForOf"],[3,"value","ngClass","disabled"],[3,"selectedUnitChange","dblclick","dataSource","selectedUnit"],[1,"users-wrapper"],["itemSize","30","minBufferPx","300","maxBufferPx","600",1,"users-list-viewport"],["class","mat-tree-node",3,"ngClass","id","click","dblclick",4,"cdkVirtualFor","cdkVirtualForOf"],[1,"mat-tree-node",3,"click","dblclick","ngClass","id"],[1,"user-item"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275template(0,WI,1,0,"ts-mask",2),i.\u0275\u0275elementStart(1,"div",3)(2,"span"),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(5,"button",4),i.\u0275\u0275element(6,"mat-icon",5),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(7,"div",6)(8,"button",7),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onSelectButtonClick())}),i.\u0275\u0275text(9),i.\u0275\u0275pipe(10,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(11,"button",8),i.\u0275\u0275text(12),i.\u0275\u0275pipe(13,"translate"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(14,"div",9)(15,"div",10)(16,"mat-form-field",11)(17,"input",12),i.\u0275\u0275pipe(18,"translate"),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.search(o.target.value))})("focus",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.search(o.target.value))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(19,"mat-icon",13),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(20,"mat-autocomplete",14,0),i.\u0275\u0275listener("optionSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onFilteredSysAdminUnitSelected(o))}),i.\u0275\u0275template(22,GI,2,3,"cdk-virtual-scroll-viewport",15),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(23,"mat-tab-group",16),i.\u0275\u0275twoWayListener("selectedIndexChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.selectedTabIndex,o)||(n.selectedTabIndex=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275listener("selectedIndexChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.fillContentByTab(o))}),i.\u0275\u0275elementStart(24,"mat-tab",17),i.\u0275\u0275pipe(25,"translate"),i.\u0275\u0275template(26,QI,1,2,"ts-sysadminunit-tree",18),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(27,"mat-tab",17),i.\u0275\u0275pipe(28,"translate"),i.\u0275\u0275template(29,JI,1,2,"ts-sysadminunit-tree",18),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(30,"mat-tab",17),i.\u0275\u0275pipe(31,"translate"),i.\u0275\u0275template(32,KI,4,1,"div",19),i.\u0275\u0275elementEnd()()()}if(t&2){const s=i.\u0275\u0275reference(21);i.\u0275\u0275property("ngIf",n.isLoading),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(4,16,"SelectSysAdminUnitDialog.Title")),i.\u0275\u0275advance(5),i.\u0275\u0275property("disabled",!n.selectedUnit),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(10,18,"SelectSysAdminUnitDialog.Select")," "),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(13,20,"SelectSysAdminUnitDialog.Cancel")),i.\u0275\u0275advance(5),i.\u0275\u0275property("placeholder",i.\u0275\u0275pipeBind1(18,22,"SelectSysAdminUnitDialog.Search"))("matAutocomplete",s),i.\u0275\u0275advance(3),i.\u0275\u0275property("displayWith",n.getSysAdminUnitName),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.filteredSysAdminUnits&&n.filteredSysAdminUnits.length>0),i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("selectedIndex",n.selectedTabIndex),i.\u0275\u0275advance(),i.\u0275\u0275property("label",i.\u0275\u0275pipeBind1(25,24,"SelectSysAdminUnitDialog.OrganizationalRoles")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.isOrganizationalRolesVisible()),i.\u0275\u0275advance(),i.\u0275\u0275property("label",i.\u0275\u0275pipeBind1(28,26,"SelectSysAdminUnitDialog.FunctionalRoles")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.isFunctionalRolesVisible()),i.\u0275\u0275advance(),i.\u0275\u0275property("label",i.\u0275\u0275pipeBind1(31,28,"SelectSysAdminUnitDialog.Users")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.isUsersVisible())}},dependencies:[Ct,b.NgClass,b.NgIf,Oe.MatAutocomplete,qe.MatOption,Oe.MatAutocompleteTrigger,W.MatButton,W.MatIconButton,Y.MatDialogClose,Y.MatDialogTitle,Y.MatDialogActions,Y.MatDialogContent,U.MatIcon,re.MatInput,K.MatFormField,K.MatSuffix,Dt.MatTab,Dt.MatTabGroup,Bi.CdkFixedSizeVirtualScroll,Bi.CdkVirtualForOf,Bi.CdkVirtualScrollViewport,Qo,v.TranslatePipe],styles:["[_nghost-%COMP%]{padding:4px 10px;min-width:580px;min-height:512px}[mat-dialog-actions][_ngcontent-%COMP%]{margin-bottom:5px!important}.search-input[_ngcontent-%COMP%]{padding-top:12px;font-size:14px}.search-input[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%;line-height:18px!important}.search-input[_ngcontent-%COMP%]   mat-icon[svgicon=search][_ngcontent-%COMP%]{width:16px;height:16px;line-height:0;vertical-align:middle}.search-list-viewport[_ngcontent-%COMP%]{max-height:254px}.selectable-item[_ngcontent-%COMP%]{padding-left:50px}.users-wrapper[_ngcontent-%COMP%]   .users-list-viewport[_ngcontent-%COMP%]{height:325px}.users-wrapper[_ngcontent-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{color:#444;line-height:19px;max-height:30px;min-height:30px;white-space:nowrap}.users-wrapper[_ngcontent-%COMP%]   .mat-tree-node.selected[_ngcontent-%COMP%]{background-color:#f2f5ff}.users-wrapper[_ngcontent-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]   .user-item[_ngcontent-%COMP%]{margin-left:30px}"]})}}class ya{static{this.\u0275fac=function(t){return new(t||ya)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:ya})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Hi],imports:[en,lt,ni,b.CommonModule,Eg.DragDropModule,Z.FormsModule,Oe.MatAutocompleteModule,W.MatButtonModule,Rt.MatCheckboxModule,Y.MatDialogModule,jt.MatDividerModule,Yc.MatExpansionModule,U.MatIconModule,re.MatInputModule,R.MatMenuModule,Ge.MatSelectModule,Dg.MatSlideToggleModule,Ag.MatSortModule,Ah.MatTableModule,Dt.MatTabsModule,vt.MatTooltipModule,xn.MatTreeModule,K.MatFormFieldModule,_a,v.TranslateModule,Bi.ScrollingModule,Bi.CdkVirtualScrollViewport]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(ya,{declarations:[Jo,Qo],imports:[en,lt,ni,b.CommonModule,Eg.DragDropModule,Z.FormsModule,Oe.MatAutocompleteModule,W.MatButtonModule,Rt.MatCheckboxModule,Y.MatDialogModule,jt.MatDividerModule,Yc.MatExpansionModule,U.MatIconModule,re.MatInputModule,R.MatMenuModule,Ge.MatSelectModule,Dg.MatSlideToggleModule,Ag.MatSortModule,Ah.MatTableModule,Dt.MatTabsModule,vt.MatTooltipModule,xn.MatTreeModule,K.MatFormFieldModule,_a,v.TranslateModule,Bi.ScrollingModule,Bi.CdkVirtualScrollViewport]})})();class qo{constructor(e){this._elRef=e,this.clickOutside=new i.EventEmitter}onOutsideClick(e){const t=e.target;this._elRef.nativeElement.contains(t)||this.clickOutside.emit()}static{this.\u0275fac=function(t){return new(t||qo)(i.\u0275\u0275directiveInject(i.ElementRef))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:qo,selectors:[["","crtClickOutside",""]],hostBindings:function(t,n){t&1&&i.\u0275\u0275listener("click",function(r){return n.onOutsideClick(r)},!1,i.\u0275\u0275resolveDocument)},outputs:{clickOutside:"crtClickOutside"}})}}class Ca{constructor(){this.isRequired=!1}get ariaRequired(){return this.isRequired}static{this.\u0275fac=function(t){return new(t||Ca)}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:Ca,selectors:[["","crtAriaRequired",""]],hostVars:1,hostBindings:function(t,n){t&2&&i.\u0275\u0275attribute("aria-required",n.ariaRequired)},inputs:{isRequired:[0,"crtAriaRequired","isRequired"]}})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],Ca.prototype,"isRequired",void 0);class tn{static{this.\u0275fac=function(t){return new(t||tn)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:tn})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,ds.B]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(tn,{declarations:[ta],imports:[b.CommonModule,ds.B],exports:[ta]})})();class ii{static{this.\u0275fac=function(t){return new(t||ii)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:ii})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[sa],imports:[b.CommonModule,en,tn,Oe.MatAutocompleteModule,W.MatButtonModule,Y.MatDialogModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,Ut.MatProgressSpinnerModule,Xt,v.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(ii,{declarations:[ia,Eo],imports:[b.CommonModule,en,tn,Oe.MatAutocompleteModule,W.MatButtonModule,Y.MatDialogModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,Ut.MatProgressSpinnerModule,Xt,v.TranslateModule]})})();class Ko{constructor(e){this._window=e,this._defaultBlinkInterval=500,this._defaultBlinkPrefix="*"}_getBlinkConfig(e){const t=this._window.document,n=e?.title||t.title;return{title:n,blinkTitle:e?.blinkTitle||`${this._defaultBlinkPrefix}${n}`,blinkInterval:e?.blinkInterval||this._defaultBlinkInterval,blinkOnce:(e||{}).blinkOnce===!0}}_createSyncSubject(){const e=new u.Subject;return(0,u.fromEvent)(this._window,"mousemove").pipe((0,c.first)(),(0,c.map)(t=>null)).subscribe(e),e}blink(e){return(0,u.of)(null)}static{this.\u0275fac=function(t){return new(t||Ko)(i.\u0275\u0275inject(P.ZP))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ko,factory:Ko.\u0275fac,providedIn:"root"})}}let Ph=class extends je{constructor(e){super(),this._notifyService=e}handle(e){var t=this;return(0,S.A)(function*(){yield t._notifyService.show(e.options)})()}};Ph=(0,p.__decorate)([Ke({requestType:"crt.ShowSnackbarRequest",type:"crt.ShowSnackbarHandler"}),(0,p.__metadata)("design:paramtypes",[Fn])],Ph);function XI(a){return a.cultureInfo.sysCultureName}const eb={showDelay:300,hideDelay:300,touchendHideDelay:1e3,position:"above"};let Xo=class rp{constructor(e){this._materialIconsRegistrator=e,mI.forEach(t=>{this._materialIconsRegistrator.addIcons([{name:t,icon:m(10722)(`./${t}.svg`)},{name:`${t}-large`,icon:m(12014)(`./${t}.svg`)}])})}static{this.\u0275fac=function(t){return new(t||rp)(i.\u0275\u0275inject(Zt))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:rp})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[P.rK,Ko,Xs,{provide:qe.MAT_DATE_LOCALE,useFactory:XI,deps:[L.oq]},{provide:qe.MAT_DATE_FORMATS,useValue:Zc.MAT_MOMENT_DATE_FORMATS},{provide:qe.DateAdapter,useClass:Zc.MomentDateAdapter,deps:[qe.MAT_DATE_LOCALE]},{provide:vt.MAT_TOOLTIP_DEFAULT_OPTIONS,useValue:eb}],imports:[b.CommonModule,qt,Xn,tn,ma,Z.FormsModule,ii,Oe.MatAutocompleteModule,W.MatButtonModule,Rt.MatCheckboxModule,zn.MatDatepickerModule,Y.MatDialogModule,jt.MatDividerModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,R.MatMenuModule,Zc.MatMomentDateModule,Ut.MatProgressSpinnerModule,qe.MatRippleModule,Ge.MatSelectModule,vt.MatTooltipModule,Xt,ju.RouterModule,ds.B,_o,v.TranslateModule,Z.ReactiveFormsModule,Vs,Yc.MatExpansionModule,oa,us,ya,qt,Xn,tn,ii,Xt,ds.B]})}};Xo=(0,p.__decorate)([mr({viewElements:[Ft,wt,ti,fa,Li,ei,Bl],converters:[Jd,qd,Ll,Kd,Xd,eh,th,nh,ih,sh,ah,rh,oh,ch,lh,dh,hh,ph,mh,gh,fh,_h,yh,Ch,Mh,Ih,bh,Sh],requestHandlers:[vh,Ph]}),(0,p.__metadata)("design:paramtypes",[Zt])],Xo),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Xo,{declarations:[Vi,zi,Fo,la,Oo,ua,da,Nt,ga,jo,ha,Ro,Lo,Vo,Hl,Ft,wt,fa,Li,ti,Bl,Uo,qo,Ca,zo],imports:[b.CommonModule,qt,Xn,tn,ma,Z.FormsModule,ii,Oe.MatAutocompleteModule,W.MatButtonModule,Rt.MatCheckboxModule,zn.MatDatepickerModule,Y.MatDialogModule,jt.MatDividerModule,K.MatFormFieldModule,U.MatIconModule,re.MatInputModule,R.MatMenuModule,Zc.MatMomentDateModule,Ut.MatProgressSpinnerModule,qe.MatRippleModule,Ge.MatSelectModule,vt.MatTooltipModule,Xt,ju.RouterModule,ds.B,_o,v.TranslateModule,Z.ReactiveFormsModule,Vs,Yc.MatExpansionModule,oa,us,ya],exports:[Vi,zi,Fo,la,Oo,qt,ua,Xn,tn,da,Nt,ti,ii,jo,ha,Ro,Xt,Lo,Vo,ds.B,Ft,wt,fa,Li,Uo,qo,Ca,zo]})}();class nn{constructor(e,t,n,s){this.overlay=e,this.overlayPositionBuilder=t,this.elementRef=n,this.ngZone=s,this.delayTime=500}_createIconHoveredStream(e){return this.ngZone.runOutsideAngular(()=>(0,u.fromEvent)(this.elementRef.nativeElement,"mouseenter").pipe((0,c.auditTime)(this.delayTime),(0,c.takeUntil)(e)))}_createIconMouseOutStream(){return this.ngZone.runOutsideAngular(()=>(0,u.fromEvent)(this.elementRef.nativeElement,"mouseleave"))}_createEventsStream(e,t){this.subscription=t.subscribe(),this.subscription.add(e.subscribe());const n=(0,u.merge)(e,t);n.pipe((0,c.takeUntil)(t));const s=n.subscribe(r=>{if(r.type==="mouseenter"&&this.show(),r.type==="mouseleave"){this.hide(),this.subscription.unsubscribe();const o=this._createIconMouseOutStream(),l=this._createIconHoveredStream(o);this._createEventsStream(l,o)}});this.subscription.add(s)}hide(){this.overlayRef.hasAttached()&&this.overlayRef.detach()}show(){this.hintConfig&&(this.overlayRef.hasAttached()||(this.tooltipRef=this.overlayRef.attach(new xh.ComponentPortal(this.hintConfig.componentType))),this.tooltipRef.instance.hintConfig=this.hintConfig.hintConfig)}ngOnInit(){const e=this.overlayPositionBuilder.flexibleConnectedTo(this.elementRef).withPositions([{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top",offsetX:this.hintConfig.positionX?this.hintConfig.positionX:0,offsetY:this.hintConfig.positionY?this.hintConfig.positionY:0}]);this.overlayRef=this.overlay.create({scrollStrategy:this.overlay.scrollStrategies.close(),positionStrategy:e})}ngAfterViewInit(){const e=this._createIconMouseOutStream(),t=this._createIconHoveredStream(e);this._createEventsStream(t,e)}ngOnDestroy(){this.hide(),this.subscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||nn)(i.\u0275\u0275directiveInject(mn.Overlay),i.\u0275\u0275directiveInject(mn.OverlayPositionBuilder),i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(i.NgZone))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:nn,selectors:[["","libHintOverlay",""]],inputs:{hintConfig:[0,"libHintOverlay","hintConfig"]},exportAs:["libHintOverlay"]})}}const tb=(a,e)=>({"forecast-hint-content":a,"forecast-hint-content-rtl":e});class sn{set hintConfig(e){this._hintConfig!==e&&(this._hintConfig=e)}get hintConfig(){return this._hintConfig}get cssClasses(){return this._hintConfig?.cssClasses||this._defaultCssClass}constructor(e){this._directionality=e,this._defaultCssClass="simple-hint"}isRtl(){return this._directionality.value==="rtl"}static{this.\u0275fac=function(t){return new(t||sn)(i.\u0275\u0275directiveInject(vn.Directionality))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:sn,selectors:[["ts-simple-hint"]],inputs:{hintConfig:"hintConfig"},decls:4,vars:8,consts:[[1,"simple-hint-value",3,"ngClass"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div")(1,"span",0),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(3,"br"),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275classMap(n.cssClasses),i.\u0275\u0275advance(),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction2(5,tb,!n.isRtl(),n.isRtl())),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",n.hintConfig==null?null:n.hintConfig.displayValue," "))},dependencies:[b.NgClass],styles:['.simple-hint[_ngcontent-%COMP%]{margin:15px 30px;min-width:60px;max-width:300px;display:inline-block;align-items:center;background:#fff;border-top:4px solid;position:relative;min-height:50px;padding:10px;text-align:left;box-shadow:#0000004d 0 0 .6em .02em;-moz-box-shadow:rgba(0,0,0,.3) 0 0 .2em;-webkit-box-shadow:rgba(0,0,0,.3) 0 0 .2em;font-size:13px;border-top-color:#20c964}.simple-hint[_ngcontent-%COMP%]   .simple-hint-content[_ngcontent-%COMP%]{direction:ltr}.simple-hint[_ngcontent-%COMP%]   .simple-hint-content-rtl[_ngcontent-%COMP%]{direction:ltr;text-align:right}.simple-hint[_ngcontent-%COMP%]:before{border-color:transparent transparent #20c964 transparent}.simple-hint[_ngcontent-%COMP%]:after, .simple-hint[_ngcontent-%COMP%]:before{content:"";display:block;position:absolute;width:0;height:0;border-style:solid}.simple-hint[_ngcontent-%COMP%]:after{left:calc(50% - 6px);top:-12px;border-color:transparent transparent #fff transparent;border-width:6px}.simple-hint[_ngcontent-%COMP%]:before{left:calc(50% - 7px);top:-17px;border-width:7px}']})}}class an{static{this.\u0275fac=function(t){return new(t||an)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:an})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(an,{declarations:[nn,sn],imports:[b.CommonModule],exports:[nn,sn]})})();class Av{}class Ma{constructor(e,t){this.httpClient=e,this._serviceGetProfileEndpoint=`${t}/QueryProfile`,this._serviceSaveProfileEndpoint=`${t}/UserProfile`}_innerSaveProfile(e,t,n){const{requirejs:s,require:r}=window;r?.defined("profile")&&r("profile").addKey(e);const o={key:e,data:JSON.stringify(t)};return n&&(o.isDef=!0),s?.undef("profile!"+e),this.httpClient.post(this._serviceSaveProfileEndpoint,o).pipe((0,c.map)(l=>l))}getProfile(e){return this.httpClient.post(this._serviceGetProfileEndpoint,{key:e})}saveProfile(e,t){return this._innerSaveProfile(e,t,!1)}saveDefaultProfile(e,t){return this._innerSaveProfile(e,t,!0)}static{this.\u0275fac=function(t){return new(t||Ma)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(jn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ma,factory:Ma.\u0275fac,providedIn:"root"})}}class ec{constructor(e){Object.assign(this,e)}}class Ia{constructor(e){this._http=e,this._serviceUrl="/rest/LanguageTranslationService/",this._languagesCache=null}_post(e,t){const n=this._serviceUrl+e;return this._http.post(n,t)}_getLanguages(){return(0,S.A)(function*(){return(yield(yield _t.create("SysLanguage")).load({attributes:["Code","Name"]})).map(s=>({value:s.Id,code:s.Code,displayValue:s.Name}))})()}getAvailableTranslationLanguages(){return this._languagesCache?.length>0?(0,u.of)(this._languagesCache):(0,u.from)(this._getLanguages()).pipe((0,c.map)(e=>e.sort((t,n)=>t.displayValue.localeCompare(n.displayValue))),(0,c.tap)(e=>this._languagesCache=e),(0,c.catchError)(()=>(this._languagesCache=[],(0,u.of)(this._languagesCache))))}translateText(e,t="",n=""){return this._post("TranslateText",{text:e,sourceLanguage:t,targetLanguage:n}).pipe((0,c.catchError)(s=>{throw console.error("Translation error:",s),s}))}translateTextWithSourceLanguageDetecting(e,t=""){return this._post("TranslateTextWithSourceLanguageDetecting",{text:e,targetLanguage:t}).pipe((0,c.catchError)(n=>{throw console.error("Language detection error:",n),n}))}static{this.\u0275fac=function(t){return new(t||Ia)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ia,factory:Ia.\u0275fac,providedIn:"root"})}}var En;(function(a){a.OnlyText="only-text",a.LeftIcon="left-icon",a.RightIcon="right-icon",a.OnlyIcon="only-icon"})(En||(En={}));var rn;function nb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",7),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.caption)}}function ib(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",3),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(s.onTranslateButtonClick())}),i.\u0275\u0275elementContainerStart(1,4),i.\u0275\u0275element(2,"mat-icon",5),i.\u0275\u0275template(3,nb,2,1,"span",6),i.\u0275\u0275elementContainerEnd(),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275classProp("translated",t.isTranslatedMode),i.\u0275\u0275property("libHintOverlay",t.getHint())("disabled",t.disabled)("ngClass",t.getClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.iconPosition),i.\u0275\u0275advance(),i.\u0275\u0275property("svgIcon","translate-icon")("ngClass",t.getIconClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.captionVisible)}}function sb(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,ib,4,9,"button",2),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.isTranslationButtonRendered)}}function ab(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",7),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.caption)}}function rb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",8),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onTranslateButtonClick())}),i.\u0275\u0275elementContainerStart(1,4),i.\u0275\u0275element(2,"mat-icon",5),i.\u0275\u0275template(3,ab,2,1,"span",6),i.\u0275\u0275elementContainerEnd(),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275classProp("translated",t.isTranslatedMode),i.\u0275\u0275property("disabled",t.disabled)("ngClass",t.getClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.iconPosition),i.\u0275\u0275advance(),i.\u0275\u0275property("svgIcon","translate-icon")("ngClass",t.getIconClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.captionVisible)}}let on=class op extends Be{static{rn=this}static{this._cache=new Map}get isTranslatedMode(){return this.isTranslated}set isTranslationError(e){if(this._translationError=e,e){if(this.showErrorSnackbar&&this._notifyService){const t=this.translateService.instant("MultilingualMessages.TranslationFailedHeader");this._notifyService.show({message:t})}this.translationError$?.emit()}}get isTranslationError(){return this._translationError}constructor(e){super(e),this.injector=e,this._focusedEditable=null,this._translationError=!1,this.sizeEnum=Ee,this.iconPositionEnum=En,this.autoEnabled=!1,this.isTranslationButtonRendered=!0,this.iconPosition=En.OnlyIcon,this.size=Ee.Medium,this.iconSize=Ee.Large,this.sourceLanguageCode="autodetect",this.targetLanguageCode="",this.translationKey="",this.sourceText="",this.isTranslated=!1,this.disabled=!1,this.showErrorSnackbar=!0,this.translationReady=new i.EventEmitter,this.translationError$=new i.EventEmitter,this._translationService=this.injector.get(Ia),this.translateService=this.injector.get(v.TranslateService),this._notifyService=this.injector.get(Fn),this._cdr=this.injector.get(i.ChangeDetectorRef)}static _hash(e){if(!e)return"0";let t=0;for(let n=0;n<e.length;n++)t=(t*31+e.charCodeAt(n))%Number.MAX_SAFE_INTEGER;return t.toString(16)}_captureFocusedEditableElement(){const e=document.activeElement;if(!e){this._focusedEditable=null;return}const t=e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable;this._focusedEditable=t?e:null}_restoreCaretAtEnd(){const e=this._focusedEditable;if(e){if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){const t=e.value.length;e.setSelectionRange(t,t);return}if(e.isContentEditable){const t=window.getSelection();if(!t)return;const n=document.createRange();n.selectNodeContents(e),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}}}_getTranslatedKey(e=""){const t=e||rn._hash(this.sourceText);return`${this.translationKey}|${this.sourceLanguageCode}|${this.targetLanguageCode}|${t}|translated`}_getOriginalKey(){return`${this.translationKey}|original`}_getCachedTranslation(){return rn._cache.get(this._getTranslatedKey())}_getOriginalText(){const e=this._getOriginalKey();return rn._cache.get(e)}_fetchTranslation(){const e=this._getCachedTranslation();return e?(0,u.of)(e):this.sourceLanguageCode==="autodetect"?this._translationService.translateTextWithSourceLanguageDetecting(this.sourceText,this.targetLanguageCode):this._translationService.translateText(this.sourceText,this.sourceLanguageCode,this.targetLanguageCode)}_restoreOriginalText(){let e=this._getOriginalText();!e&&this.originalText&&(rn._cache.set(this._getOriginalKey(),this.originalText),e=this.originalText),this._ensureTranslationCachedForOriginalText(),this.isTranslated=!1,this.translationReady.emit({translationKey:this.translationKey,translation:e}),this.disabled=!1}_ensureTranslationCachedForOriginalText(){if(this.originalText&&!this._getCachedTranslation()){const e=rn._hash(this.originalText),t=this._getTranslatedKey(e);rn._cache.set(t,this.sourceText)}}_onMouseDown(e){this.disabled||e.preventDefault()}rerenderButton(){this.isTranslationButtonRendered=!1,setTimeout(()=>{this.isTranslationButtonRendered=!0,this._cdr.detectChanges()})}translateText(){const e=this._getTranslatedKey(),t=this._getCachedTranslation();if(t){this.isTranslated=!0,this.isTranslationError=!1,this.translationReady.emit({translationKey:this.translationKey,translation:t}),this.disabled=!1;return}rn._cache.set(this._getOriginalKey(),this.sourceText),this._fetchTranslation().subscribe({next:n=>{if(!n){this.isTranslated=!1,this.isTranslationError=!0,this.disabled=!1,this._cdr.markForCheck();return}rn._cache.set(e,n),this.isTranslationError=!1,this.isTranslated=!0,this.translationReady.emit({translationKey:this.translationKey,translation:n}),this.disabled=!1},error:()=>{this.isTranslated=!1,this.isTranslationError=!0,this.disabled=!1}})}getClasses(){const e=[];return this.switchClass(e,this.iconPosition,[[En.LeftIcon,"button-icon-position-left"],[En.RightIcon,"button-icon-position-right"],[En.OnlyIcon,"button-icon-position-only-icon"]]),this.switchClass(e,this.size,[[Ee.None,"button-size-none"],[Ee.Small,"button-size-small"],[Ee.Medium,"button-size-medium"],[Ee.Large,"button-size-large"],[Ee.ExtraLarge,"button-size-extra-large"]]),e}get caption(){return this.isTranslationError?this.translateService.instant("TranslateToggle.DefaultCaption.Retry"):this.isTranslated?this.translateService.instant("TranslateToggle.DefaultCaption.Translated"):this.translateService.instant("TranslateToggle.DefaultCaption.Original")}get captionVisible(){return this.iconPosition!==En.OnlyIcon}getHint(){return new ec({hintConfig:{displayValue:this.caption,cssClasses:"translate-toggle-tooltip-hint"},componentType:sn})}getIconClasses(){const e=[];return this.switchClass(e,this.iconSize,[[Ee.Small,"button-icon-size-small"],[Ee.Medium,"button-icon-size-medium"],[Ee.Large,"button-icon-size-large"],[Ee.ExtraLarge,"button-icon-size-extra-large"]]),e}onTranslateButtonClick(){if(!this.disabled){if(this._captureFocusedEditableElement(),this.disabled=!0,this.isTranslationError){this.isTranslationError=!1,this.translateText(),this._restoreCaretAtEnd();return}this.isTranslated?(this._restoreOriginalText(),this._restoreCaretAtEnd()):(this.translateText(),this._restoreCaretAtEnd()),this.rerenderButton()}}static{this.\u0275fac=function(t){return new(t||op)(i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:op,selectors:[["crt-translate-toggle"]],hostBindings:function(t,n){t&1&&i.\u0275\u0275listener("mousedown",function(r){return n._onMouseDown(r)})},inputs:{iconPosition:"iconPosition",size:"size",iconSize:"iconSize",sourceLanguageCode:"sourceLanguageCode",targetLanguageCode:"targetLanguageCode",translationKey:"translationKey",sourceText:"sourceText",isTranslated:"isTranslated",disabled:"disabled",originalText:"originalText",showErrorSnackbar:"showErrorSnackbar"},outputs:{translationReady:"translationReady",translationError$:"translationError$"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["withoutHint",""],[4,"ngIf","ngIfElse"],["type","button","mat-button","","class","translate-toggle-button","disableRipple","",3,"translated","libHintOverlay","disabled","ngClass","click",4,"ngIf"],["type","button","mat-button","","disableRipple","",1,"translate-toggle-button",3,"click","libHintOverlay","disabled","ngClass"],[3,"ngSwitch"],[1,"icon",3,"svgIcon","ngClass"],["class","caption",4,"ngIf"],[1,"caption"],["type","button","mat-button","","disableRipple","",1,"translate-toggle-button",3,"click","disabled","ngClass"]],template:function(t,n){if(t&1&&i.\u0275\u0275template(0,sb,2,1,"ng-container",1)(1,rb,4,8,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275property("ngIf",n.iconPosition==="only-icon")("ngIfElse",s)}},dependencies:[b.NgClass,b.NgIf,b.NgSwitch,W.MatButton,U.MatIcon,nn],styles:["button.translate-toggle-button[_ngcontent-%COMP%]{min-width:unset;max-width:100%;min-height:unset;display:inline-flex;align-items:center;justify-content:center;padding:0;background-color:transparent;text-transform:none!important}button.translate-toggle-button[_ngcontent-%COMP%]:hover{background-color:transparent!important;outline:none;border:none}.caption[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;font-weight:500;font-size:12px;line-height:16px;vertical-align:middle}.icon[_ngcontent-%COMP%]{width:16px;height:16px;line-height:20px;vertical-align:middle;color:#8094b3}.translated[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:#004fd6}.button-icon-size-small[_ngcontent-%COMP%]{width:8px;height:8px}.button-icon-size-medium[_ngcontent-%COMP%]{width:12px;height:12px}.button-icon-size-large[_ngcontent-%COMP%]{width:16px;height:16px}.button-icon-size-extra-large[_ngcontent-%COMP%]{width:24px;height:24px}.button-size-small[_ngcontent-%COMP%]{min-width:12px!important;height:12px!important}.button-size-medium[_ngcontent-%COMP%]{min-width:16px!important;height:16px!important}.button-size-large[_ngcontent-%COMP%], .button-size-extra-large[_ngcontent-%COMP%]{min-width:24px!important;height:24px!important}  .auto-translate-toggle-tooltip-hint,   .translate-toggle-tooltip-hint{margin:0 30px;min-width:60px;max-width:300px;display:inline-block;align-items:center;background:#fff;position:relative;width:max-content;color:#757575;border-radius:50px;border:none;z-index:1;font-size:11px;padding:5px;box-shadow:none;top:10px;text-align:center}"]})}};(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],on.prototype,"translationReady",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],on.prototype,"translationError$",void 0),on=rn=(0,p.__decorate)([Tn({type:"crt.TranslateToggle"}),(0,p.__metadata)("design:paramtypes",[i.Injector])],on);function ob(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",7),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.caption)}}function cb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",3),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(s.onTranslateButtonClick())}),i.\u0275\u0275elementContainerStart(1,4),i.\u0275\u0275element(2,"mat-icon",5),i.\u0275\u0275template(3,ob,2,1,"span",6),i.\u0275\u0275elementContainerEnd(),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275classProp("translated",t.isTranslatedMode),i.\u0275\u0275property("libHintOverlay",t.getHint())("disabled",t.disabled)("ngClass",t.getClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.iconPosition),i.\u0275\u0275advance(),i.\u0275\u0275property("svgIcon","translate-icon")("ngClass",t.getIconClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.captionVisible)}}function lb(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,cb,4,9,"button",2),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.isTranslationButtonRendered)}}function ub(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",7),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.caption)}}function db(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",8),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.onTranslateButtonClick())}),i.\u0275\u0275elementContainerStart(1,4),i.\u0275\u0275element(2,"mat-icon",5),i.\u0275\u0275template(3,ub,2,1,"span",6),i.\u0275\u0275elementContainerEnd(),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275classProp("translated",t.isTranslatedMode),i.\u0275\u0275property("disabled",t.disabled)("ngClass",t.getClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.iconPosition),i.\u0275\u0275advance(),i.\u0275\u0275property("svgIcon","translate-icon")("ngClass",t.getIconClasses()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.captionVisible)}}const Pg="OmnichannelMessagingProfileData";let ba=class cp extends on{get isTranslatedMode(){return this.autoEnabled}constructor(e){super(e),this.injector=e,this.autoEnabled=!0,this._userProfileService=this.injector.get(Ma)}_attach(){!this.translateTrigger$||this._sub||(this._sub=this.translateTrigger$.subscribe(e=>{typeof e=="string"&&(this.sourceText=e),this.isTranslationError=!1,this.disabled=!0,this.isTranslated=!1,this.translateText()}))}_detach(){this._sub?.unsubscribe(),this._sub=void 0}_loadToggleState(){this._userProfileService.getProfile(Pg).subscribe({next:e=>{e?.autoTranslateEnabled!==void 0?(this.autoEnabled=e.autoTranslateEnabled,this.autoEnabled&&this._attach()):this.autoEnabled&&this._attach()},error:()=>{this.autoEnabled&&this._attach()}})}_saveToggleState(){const e={autoTranslateEnabled:this.autoEnabled};this._userProfileService.saveProfile(Pg,e).subscribe()}ngOnInit(){this._loadToggleState()}ngOnDestroy(){this._detach()}getHint(){return new ec({hintConfig:{displayValue:this.caption,cssClasses:"auto-translate-toggle-tooltip-hint"},componentType:sn})}onTranslateButtonClick(){this.disabled||(this.autoEnabled=!this.autoEnabled,this.autoEnabled?this._attach():this._detach(),this._saveToggleState(),this.rerenderButton())}get caption(){return this.translateService.instant(this.autoEnabled?"TranslateToggle.AutoCaption.Off":"TranslateToggle.AutoCaption.On")}get captionVisible(){return this.iconPosition!==this.iconPositionEnum.OnlyIcon}static{this.\u0275fac=function(t){return new(t||cp)(i.\u0275\u0275directiveInject(i.Injector))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:cp,selectors:[["crt-auto-translate-toggle"]],inputs:{translateTrigger$:"translateTrigger$"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:3,vars:2,consts:[["withoutHint",""],[4,"ngIf","ngIfElse"],["type","button","mat-button","","class","translate-toggle-button","disableRipple","",3,"translated","libHintOverlay","disabled","ngClass","click",4,"ngIf"],["type","button","mat-button","","disableRipple","",1,"translate-toggle-button",3,"click","libHintOverlay","disabled","ngClass"],[3,"ngSwitch"],[1,"icon",3,"svgIcon","ngClass"],["class","caption",4,"ngIf"],[1,"caption"],["type","button","mat-button","","disableRipple","",1,"translate-toggle-button",3,"click","disabled","ngClass"]],template:function(t,n){if(t&1&&i.\u0275\u0275template(0,lb,2,1,"ng-container",1)(1,db,4,8,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275property("ngIf",n.iconPosition==="only-icon")("ngIfElse",s)}},dependencies:[b.NgClass,b.NgIf,b.NgSwitch,W.MatButton,U.MatIcon,nn],styles:["button.translate-toggle-button[_ngcontent-%COMP%]{min-width:unset;max-width:100%;min-height:unset;display:inline-flex;align-items:center;justify-content:center;padding:0;background-color:transparent;text-transform:none!important}button.translate-toggle-button[_ngcontent-%COMP%]:hover{background-color:transparent!important;outline:none;border:none}.caption[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;font-weight:500;font-size:12px;line-height:16px;vertical-align:middle}.icon[_ngcontent-%COMP%]{width:16px;height:16px;line-height:20px;vertical-align:middle;color:#8094b3}.translated[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{color:#004fd6}.button-icon-size-small[_ngcontent-%COMP%]{width:8px;height:8px}.button-icon-size-medium[_ngcontent-%COMP%]{width:12px;height:12px}.button-icon-size-large[_ngcontent-%COMP%]{width:16px;height:16px}.button-icon-size-extra-large[_ngcontent-%COMP%]{width:24px;height:24px}.button-size-small[_ngcontent-%COMP%]{min-width:12px!important;height:12px!important}.button-size-medium[_ngcontent-%COMP%]{min-width:16px!important;height:16px!important}.button-size-large[_ngcontent-%COMP%], .button-size-extra-large[_ngcontent-%COMP%]{min-width:24px!important;height:24px!important}  .auto-translate-toggle-tooltip-hint,   .translate-toggle-tooltip-hint{margin:0 30px;min-width:60px;max-width:300px;display:inline-block;align-items:center;background:#fff;position:relative;width:max-content;color:#757575;border-radius:50px;border:none;z-index:1;font-size:11px;padding:5px;box-shadow:none;top:10px;text-align:center}"]})}};ba=(0,p.__decorate)([Tn({type:"crt.AutoTranslateToggle"}),(0,p.__metadata)("design:paramtypes",[i.Injector])],ba);let Yi=class lp{static{this.\u0275fac=function(t){return new(t||lp)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:lp})}static{this.\u0275inj=i.\u0275\u0275defineInjector({imports:[b.CommonModule,W.MatButtonModule,v.TranslateModule,U.MatIconModule,an]})}};Yi=(0,p.__decorate)([mr({viewElements:[on,ba]})],Yi),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Yi,{declarations:[on,ba],imports:[b.CommonModule,W.MatButtonModule,v.TranslateModule,U.MatIconModule,an],exports:[on,ba]})}();var Wl;(function(a){a.Completed="a1b0184b-0a54-4a47-ba08-a5772105d3b2"})(Wl||(Wl={}));var Zi;(function(a){a[a.Inactive=0]="Inactive",a[a.Active=1]="Active",a[a.ChatsExceeded=2]="ChatsExceeded"})(Zi||(Zi={}));class hb{}class kh{get chatQueueId(){return this._chatQueueId}set chatQueueId(e){this._chatQueueId=e}}class jh{constructor(e,t,n){this.queryExecutor=e,this._translateService=t,this.entityConverter=n,this.absentDataErrorKey="BaseSection.AbsentDataErrorMessage",this.primaryColumnName="Id"}_convertToErrorInfo(e){return{errorCode:null,message:e.message,stackTrace:e.stack}}_addColumnsToEsq(e){this.entityConverter.getEntityColumns({}).forEach(n=>{e.addSchemaColumn(n.path)})}_createDeleteQuery(){return new wu(this.entitySchemaName)}getBaseErrorResponse(e){return(0,u.of)({success:!1,errorInfo:this._convertToErrorInfo(e),result:null})}handleResponse(e){return e.pipe((0,c.map)(()=>({success:!0,errorInfo:null,result:[]})),(0,c.catchError)(t=>(0,u.of)({success:!1,errorInfo:this._convertToErrorInfo(t),result:[]})))}getItemByIdEsq(e){const t=new Se(this.entitySchemaName);return this._addColumnsToEsq(t),t.filters.addSchemaColumnFilterWithParameter(ee.Equal,this.primaryColumnName,e),t}createGetAllItemsEsq(){const e=new Se(this.entitySchemaName);return this._addColumnsToEsq(e),e}getUpdateQuery(e){const t=new Vc(this.entitySchemaName);return this.entityConverter.getEntityColumns(e).forEach(s=>{this.primaryColumnName===s.path?t.filters.addSchemaColumnFilterWithParameter(ee.Equal,this.primaryColumnName,s.value):t.addColumn(s.path,s.value,s.type)}),t}getInsertQuery(e){const t=new cr(this.entitySchemaName);return this.entityConverter.getEntityColumns(e).forEach(s=>{this.primaryColumnName===s.path&&!s.value||t.addColumn(s.path,s.value,s.type)}),t}getDeleteQuery(e){return this.getDeleteQueryWithPrimaryColumnFilter(e.id)}getDeleteQueryWithPrimaryColumnFilter(e){const t=this._createDeleteQuery();return t.filters.addSchemaColumnFilterWithParameter(ee.Equal,this.primaryColumnName,e),t}loadAdditionalInfo(e){return(0,u.of)(e)}getItems(){const e=this.createGetAllItemsEsq();return this.queryExecutor.executeSelectQuery(e).pipe((0,c.mergeMap)(t=>this.loadAdditionalInfo(t)),(0,c.map)(t=>({success:!0,errorInfo:null,result:t.map(n=>this.entityConverter.getEntity(n))})),(0,c.catchError)(t=>this.getBaseErrorResponse(t)))}getItem(e){const t=this.getItemByIdEsq(e);return this.queryExecutor.executeSelectQuery(t).pipe((0,c.tap)(n=>{if(!(n&&n[0])){const s=this._translateService.instant(this.absentDataErrorKey);throw new Error(s)}}),(0,c.mergeMap)(n=>this.loadAdditionalInfo(n)),(0,c.map)(n=>({success:!0,errorInfo:null,result:[this.entityConverter.getEntity(n[0])]})),(0,c.catchError)(n=>this.getBaseErrorResponse(n)))}insertItem(e){const t=this.getInsertQuery(e),n=this.queryExecutor.executeInsertQuery(t);return this.handleResponse(n)}updateItem(e){const t=this.getUpdateQuery(e),n=this.queryExecutor.executeUpdateQuery(t);return this.handleResponse(n)}deleteItem(e){const t=this.getDeleteQuery(e),n=this.queryExecutor.executeDeleteQuery(t);return this.handleResponse(n)}deleteById(e){const t=this.getDeleteQueryWithPrimaryColumnFilter(e),n=this.queryExecutor.executeDeleteQuery(t);return this.handleResponse(n)}}class $l{get photo(){return this._photo||((0,A.gZ)(this.photoId)?"":El(this.photoId))}set photo(e){this._photo=e}constructor(e,t,n){this.id=e,this.name=t,this.photoId=n}}class le{constructor(e,t,n){this.path=e,this.value=t,this.type=n}}class Sa{_getChatOperator(e){const t=new hb;return e.Operator&&(t.contact=this._getContact(e["Operator.Contact"]),t.displayValue=e.Operator.displayValue,t.value=e.Operator.value),t}_getContact(e){if(e)return new $l(e.value,e.displayValue,e.primaryImageValue)}_getChannel(e){const t=e.Channel,n=e["Channel.Provider"],s={};return t&&(s.id=t.value,s.name=t.displayValue),n&&(s.provider={id:n.value,name:n.displayValue,icon:ue(n.primaryImageValue)}),s.source=e["Channel.Source"],s.msgSettingsId=e["Channel.MsgSettingsId"],s}_getQueue(e){const t=e.Queue,n={};return t&&(n.id=t.value),n}_createChat(e){const t=this._getContact(e.Contact);t.account=e["Contact.Account"];const n=this._getChannel(e),s=this._getQueue(e),r=this._getChatOperator(e);return{id:e.Id,contact:t,lastMessageTime:e.ModifiedOn,status:e.Status,channel:n,chatPreview:e.ChatPreview,operator:r,unprocessedMsgCount:e.UnprocessedMsgCount,chatStartDate:e.ChatStartDate,closeDate:e.CloseDate,completionDate:e.CompletionDate,lastMessageDirection:e.LastMessageDirection,channelId:e.ChannelId,chatQueueId:e.ChatQueueId||s.id,languageCode:e["Language.Code"]}}_getLookupValue(e,t){return Object.prototype.hasOwnProperty.call(e,t)&&e[t]?e[t].value:void 0}getEntity(e){return this._createChat(e)}getEntityColumns(e){return[new le("Id",e.id,C.r.Guid),new le("Contact",this._getLookupValue(e,"contact"),C.r.Lookup),new le("Contact.Account",this._getLookupValue(e,"account"),C.r.Lookup),new le("ModifiedOn",e.lastMessageTime,C.r.DateTime),new le("Status",this._getLookupValue(e,"status"),C.r.Lookup),new le("Channel",this._getLookupValue(e,"channel"),C.r.Lookup),new le("Channel.Provider",this._getLookupValue(e,"channel"),C.r.Lookup),new le("Channel.Source",e.channel?.source,C.r.Text),new le("Channel.MsgSettingsId",e.channel?.msgSettingsId,C.r.Text),new le("ChatPreview",e.chatPreview,C.r.Text),new le("Operator",this._getLookupValue(e,"operator"),C.r.Lookup),new le("UnprocessedMsgCount",e.unprocessedMsgCount,C.r.Integer),new le("ChatStartDate",e.chatStartDate,C.r.DateTime),new le("CloseDate",e.closeDate,C.r.DateTime),new le("CompletionDate",e.completionDate,C.r.DateTime),new le("Operator.Contact",this._getLookupValue(e,"operatorContact"),C.r.Lookup),new le("Queue",this._getLookupValue(e,"queue"),C.r.Lookup),new le("Language.Code",e.languageCode,C.r.Lookup)]}static{this.\u0275fac=function(t){return new(t||Sa)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Sa,factory:Sa.\u0275fac})}}class Re extends jh{static get rowsCount(){return 30}constructor(e,t,n,s,r,o){super(t,n,s),this.rightsService=e,this.httpClient=r,this.userInfo=o,this._serviceUrl="/rest/OmnichannelChatService/",this._canManageChatsOperationCode="CanManageChats",this._cacheChatActions={},this.entitySchemaName="OmniChat"}_postWithChatId(e,t){const n=this._serviceUrl+t;return this.httpClient.post(n,{chatId:e})}_getMessages(e,t){const n=this._serviceUrl+t;return this.httpClient.post(n,{chatId:e}).pipe((0,c.map)(this._mapChatMessage()))}_getAllConversationMessages(e,t,n,s){const r=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),o=this._serviceUrl+"GetAllConversation";return this.httpClient.post(o,{contactId:e,channelId:t,rowCount:Re.rowsCount,rowOffset:n,translationLanguageCode:s},{headers:r}).pipe((0,c.map)(this._mapChatMessage()))}_mapChatMessage(){return e=>(e.forEach(t=>{t.time=new Date(t.time),t.author=new $l(t.author.id,t.author.name,t.author.photoId),t.macrosTemplate&&this._handleMessageMacros(t)}),e)}_handleMessageMacros(e){let t;try{t=JSON.parse(e.macrosTemplate.tokens)}catch(n){console.error("Failed to parse tokens:",n)}e.macrosTemplate.tokens=t}acceptChat(e){return this._postWithChatId(e,"AcceptChat")}getAllConversationByChat(e,t=0){const n=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"GetAllConversationByChat";return this.httpClient.post(s,{chatId:e,rowCount:Re.rowsCount,rowOffset:t},{headers:n}).pipe((0,c.map)(this._mapChatMessage()))}getAllConversation(e,t,n=0,s=null){return this._getAllConversationMessages(e,t,n,s)}getConversation(e){const t=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"GetConversation";return this.httpClient.post(n,{chatId:e},{headers:t}).pipe((0,c.map)(this._mapChatMessage()))}markAsRead(e){const t=this._serviceUrl+"MarkChatAsRead";this.httpClient.post(t,{chatId:e}).subscribe()}getMessageTemplate(e){const t=this._serviceUrl+"GetUnifiedMessageTemplate";return this.httpClient.post(t,{chatId:e})}getPreviousChatId(e){const t=this._serviceUrl+"GetPreviousChatId";return this.httpClient.post(t,{chatId:e})}sendMessage(e){const t="/rest/OmnichannelOutcomeMessagingService/SendMessage",n={message:e};return this.httpClient.post(t,n)}sendMessageWithAttachments(e,t){const n="/rest/OmnichannelOutcomeMessagingService/SendMessageWithAttachments",s=new FormData;return s.append("message",JSON.stringify(e)),Array.from(t).forEach((r,o)=>{s.append("file"+o,r,r.name)}),this.httpClient.post(n,s)}completeChat(e){return this._postWithChatId(e,"CloseActiveChat")}getOperatorChats(){const e=this._serviceUrl+"GetChats";return this.httpClient.post(e,{operatorId:this.userInfo.id}).pipe((0,c.map)(t=>({success:!0,errorInfo:null,result:t.Chats.map(n=>this.entityConverter.getEntity(n))})),(0,c.catchError)(t=>this.getBaseErrorResponse(t)))}getDirectedChats(){const e=this._serviceUrl+"GetDirectedChats";return this.httpClient.post(e,{operatorId:this.userInfo.id})}getChatHistory(e){return this._getMessages(e,"GetHistory")}getChatActions(e){if(this._cacheChatActions[e])return(0,u.of)(this._cacheChatActions[e]);const t=this._serviceUrl+"GetChatActions";return this.httpClient.post(t,{chatId:e}).pipe((0,c.tap)(n=>this._cacheChatActions[e]=n))}isOperatorCanManageChats(){return this.rightsService.getCanExecuteOperation(this._canManageChatsOperationCode).pipe((0,c.map)(e=>e))}isOperatorActive(){const e=new Se("OperatorSession");return e.rowCount=1,e.addSchemaColumn("OperatorState.OperatorAvailable","IsActive"),e.filters.addSchemaColumnFilterWithParameter(ee.Is_null,"SessionEndDate",null),e.filters.addSchemaColumnFilterWithParameter(ee.Equal,"SysUser",this.userInfo.id),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>t&&t[0].IsActive||!1),(0,c.catchError)(()=>(0,u.of)(!1)))}isOperatorHasActiveChannel(){const e=new Se("Channel");e.rowCount=1;const t=new Ve;return t.logicalOperation=di.Or,t.addSchemaColumnFilterWithParameter(ee.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnit:Operator].SysAdminUnit",this.userInfo.id),t.addSchemaColumnFilterWithParameter(ee.Equal,"ChatQueue.[ChatQueueOperator:ChatQueue:Id].[SysAdminUnitInRole:SysAdminUnitRoleId:Operator].SysAdminUnit",this.userInfo.id),e.filters.add(t),e.filters.addSchemaColumnFilterWithParameter(ee.Equal,"IsActive",!0),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(n=>n&&n.length>0||!1),(0,c.catchError)(()=>(0,u.of)(!1)))}hasUncompletedChats(e){const t=this._serviceUrl+"GetHasUncompletedChats";return this.httpClient.post(t,{channelId:e})}translateChatMessages(e,t,n){return this.httpClient.post("/rest/OmniChatTranslationService/TranslateChat",{chatId:e,sourceLanguage:t,targetLanguage:n}).pipe((0,c.map)(s=>s))}static{this.\u0275fac=function(t){return new(t||Re)(i.\u0275\u0275inject(Zr),i.\u0275\u0275inject(xe),i.\u0275\u0275inject(v.TranslateService),i.\u0275\u0275inject(Sa),i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(L.oq))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Re,factory:Re.\u0275fac,providedIn:"root"})}}var si;(function(a){a[a.Incoming=1]="Incoming",a[a.Outcoming=2]="Outcoming"})(si||(si={}));var va;(function(a){a[a.Text=0]="Text",a[a.File=1]="File",a[a.Image=2]="Image",a[a.System=5]="System",a[a.TextWithButtons=6]="TextWithButtons"})(va||(va={}));class Ov{}class Pv{}class kv{}class jv{}class Rv{}class cn{get availableColors(){return["linear-gradient(226.56deg, #E92170 2.58%, #9C1548 100%)","linear-gradient(223.63deg, #E23911 0%, #A11818 102.51%)","linear-gradient(265.43deg, #118F45 0.43%, #085C2B 92.69%)","linear-gradient(226.04deg, #078A7E 3.14%, #084C45 94.22%)","linear-gradient(224.97deg, #057ADD 5.35%, #274D8F 100%)","linear-gradient(220.79deg, #A758C5 2.27%, #841189 95.92%)","linear-gradient(143.25deg, #7848EE 1.25%, #512DA8 101.21%)","linear-gradient(223.46deg, #0058EF -4.85%, #0042B5 103.03%)","linear-gradient(143.8deg, #4F43C2 6.59%, #282261 95.27%)","linear-gradient(223.63deg, #06427C 0%, #0D2E4E 102.51%)"]}constructor(e){this.window=e,this.STORAGE_KEY="freedomContactColor",this._currentIndex=0,this._currentIndex=this._getIndexFromStorage()}_getIndexStorageKey(){return`${this.STORAGE_KEY}_index`}_getStorageKey(e){return`${this.STORAGE_KEY}_${e}`}_saveIndexToStorage(){this.window.localStorage.setItem(this._getIndexStorageKey(),this._currentIndex.toString())}_saveToStorage(e,t){this.window.localStorage.setItem(this._getStorageKey(e),t)}_removeFromStorage(e){this.window.localStorage.removeItem(this._getStorageKey(e))}_getIndexFromStorage(){const e=this.window.localStorage?.getItem(this._getIndexStorageKey());return e?Number(e):0}_getFromStorage(e){let t=this.window.localStorage.getItem(this._getStorageKey(e));return t&&!this.availableColors.some(n=>n===t)&&(this._removeFromStorage(e),t=""),t}getNextColor(e){let t=this._getFromStorage(e)||"";return t.indexOf("#")===-1&&(this._currentIndex>=this.availableColors.length&&(this._currentIndex=0),t=this.availableColors[this._currentIndex],this._currentIndex++,this._saveIndexToStorage(),this._saveToStorage(e,t)),t}static{this.\u0275fac=function(t){return new(t||cn)(i.\u0275\u0275inject(P.ZP))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:cn,factory:cn.\u0275fac,providedIn:"root"})}}const pb=a=>({"bot-message":a}),mb=a=>({display:a}),gb=()=>({}),kg=(a,e)=>({"first-in-sequence":a,"last-in-sequence":e}),fb=(a,e)=>({width:a,height:e});function _b(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",2)(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.firstMessageDate)}}function yb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",10)(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.separatorText)}}function Cb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",11)(1,"label",12),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"ts-contact-photo",13),i.\u0275\u0275listener("contactClick",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext().$implicit,r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.openContact(s.author.id))}),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("hidden",!n.isContactChanged(t)),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",t.isBotMessage?n.bot.name:t.author.name," "),i.\u0275\u0275advance(),i.\u0275\u0275property("contact",t.isBotMessage?i.\u0275\u0275pureFunction0(4,gb):t.author)("contactColor",n.getContactBackground(t))}}function Mb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",14)(1,"span"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.formatSystemMessage(t))}}function Ib(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-translate-toggle",21),i.\u0275\u0275listener("translationReady",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(r.onTranslationReady(s))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2).$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("translationKey",t.id)("sourceText",t.text)("iconPosition","left-icon")("sourceLanguageCode",(n.language==null?null:n.language.code)||n.chat.languageCode)("targetLanguageCode",n.targetLanguageCode)("isTranslated",t.isTranslated)("originalText",t.originalText)}}function bb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",15)(1,"div",16)(2,"span",17),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"div",18)(5,"span",19),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(7,Ib,1,7,"crt-translate-toggle",20),i.\u0275\u0275elementEnd()()()),a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction2(4,kg,n.isFirstMessageInSequence(t),n.isLastMessageInSequence(t))),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(n.getMessageDisplayText(t)),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(n.getLocalTime(t.time)),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.isIncomingMessage(t)&&((n.language==null?null:n.language.code)||n.chat.languageCode)&&n.useChatTranslationFeature)}}function Sb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",28)(1,"img",29),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(4);return i.\u0275\u0275resetView(r.openImage(s))})("load",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(4);return i.\u0275\u0275resetView(r.onChatImgLoaded(s))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(2,"span",30),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext(2).$implicit,s=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngStyle",i.\u0275\u0275pureFunction2(3,fb,s.imageContainerSize.width+"px",s.imageContainerSize.height+"px"))("src",s.getImageUrl(t.fileId),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(s.getLocalTime(n.time))}}function vb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",31)(1,"span",32)(2,"a",33),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(4,"span",19),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext(2).$implicit,s=i.\u0275\u0275nextContext();i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction2(4,kg,s.isFirstMessageInSequence(n),s.isLastMessageInSequence(n))),i.\u0275\u0275advance(2),i.\u0275\u0275property("href",s.getFileUrl(t.fileId),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.fileName),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(s.getLocalTime(n.time))}}function Tb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",25),i.\u0275\u0275template(1,Sb,4,6,"div",26)(2,vb,6,7,"div",27),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(3);i.\u0275\u0275property("ngSwitch",t.fileType),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",n.messageType.Image)}}function xb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",34)(1,"span",17),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"span",19),i.\u0275\u0275text(4),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext(2).$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.text),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.getLocalTime(t.time))}}function wb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",22),i.\u0275\u0275template(1,Tb,3,2,"div",23)(2,xb,5,2,"div",24),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.attachments),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.showMessageFromAttachment(t))}}function Nb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",3),i.\u0275\u0275text(1),i.\u0275\u0275template(2,yb,3,1,"div",4)(3,Cb,4,5,"div",5),i.\u0275\u0275elementStart(4,"div",6),i.\u0275\u0275template(5,Mb,3,1,"div",7)(6,bb,8,7,"div",8)(7,wb,3,2,"div",9),i.\u0275\u0275elementEnd()()),a&2){const t=e.$implicit,n=e.index,s=i.\u0275\u0275nextContext();i.\u0275\u0275classMap(s.getDirectionName(t.direction)+"-message"),i.\u0275\u0275propertyInterpolate1("id","message_",t.id,""),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(12,pb,t.isBotMessage))("ngStyle",i.\u0275\u0275pureFunction1(14,mb,s.getIsDuplicateMessage(t.id)?"none":"")),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",s.cachePreviousMessage(n)," "),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",s.isShowSeparator(t,n)),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!s.isSystemMessage(t)),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.type),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",s.messageType.System),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",s.messageType.Text)}}class yt{constructor(e,t,n,s,r,o){this._userInfo=e,this._translateService=t,this.injector=n,this._contactColorService=s,this._featureValues=r,this._sysSettingsService=o,this._omnichannelMessageFileSchema={name:"OmnichannelMessageFile",uid:"E6B4C4D4-0A51-4A6D-A8C5-18B63FADDAD4"},this._isFileApiEnabled=!1,this._fileServiceUrl=`rest/FileService/GetFile/${this._omnichannelMessageFileSchema.uid}/`,this._imageUrl=`img/entity/hash/${this._omnichannelMessageFileSchema.name}/Data/`,this._duplicateIds=[],this.messagesCounter=0,this.contactClick=new i.EventEmitter,this.messageType=va,this.bot={name:this._translateService.instant("ChatSettings.ChatWindow.Bots.Name")||"Creatio.ai"},this.imageContainerSize={width:200,height:120},this.lastSystemMessageIndex=0,this._isFileApiEnabled=this._featureValues.UseFileApiInChats,this._sysSettingsService.getValueByCode("EnableChatTranslation").pipe((0,u.take)(1)).subscribe(l=>{this.useChatTranslationFeature=l})}set messages(e){this._messages=e,e&&this._findDuplicateMessagesWithoutAttachments(),this._setLastSystemMessageIndex()}get messages(){return this._messages}static _trimSlashes(e){return e.replace(/(^([/\\])+)|(([/\\])+$)/,"")}static _isLargeImage(e,t){return e.naturalWidth>=t.offsetWidth||e.naturalHeight>=t.offsetHeight}_isNewDay(e){return this._previousMessage&&this._previousMessage.time&&e.time&&this._previousMessage.time.getDay()!==e.time.getDay()}_isNewMessages(e){const t=this.messages.length-this.messagesCounter;return e===t&&t>0}_formatDate(e){const t=new Date(e);return vu(t,this._userInfo.timeZoneOffsetHours),new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName).format(t)}_joinPath(...e){return e.map(t=>yt._trimSlashes(t)).join("/")}_setFirstMessageData(){if(this.messages?.length>0){const e=this.messages.find(t=>t.direction===si.Incoming);if(!e)return;this.firstMessageDate=this._formatDate(e.time),this.contactColor=this._contactColorService.getNextColor(e.author.id)}}_setLastSystemMessageIndex(){this._messages&&(this._messages.length<Re.rowsCount?this.lastSystemMessageIndex=0:this._messages.length===Re.rowsCount?this.lastSystemMessageIndex=Re.rowsCount-1:this.lastSystemMessageIndex=ge().findLastIndex(this._messages,e=>e.type===va.System)+1)}_isAuthorChanged(e,t){return e.author.id!==t.author.id||this.isSystemMessage(t)}_findDuplicateMessagesWithoutAttachments(){const e=this.messages.reduce((s,r)=>{const{text:o,time:l}=r,d=`${o}-${l}`;return s[d]||(s[d]=[]),s[d].push(r),s},{}),n=Object.values(e).flat().filter(s=>{const{text:r,time:o}=s,d=e[`${r}-${o}`].some(h=>!(0,T.isEmpty)(h.attachments));return(0,T.isEmpty)(s.attachments)&&d});this._duplicateIds=n.map(s=>s.id)}getDirectionName(e){return si[e].toLowerCase()}isIncomingMessage(e){return e.direction===si.Incoming}getContactBackground(e){return e.isBotMessage?"none":e.direction===1?this.contactColor:"#40bf62"}isContactChanged(e){return this._previousMessage?this._previousMessage.author.id!==e.author.id||this._previousMessage.isBotMessage!==e.isBotMessage||this._previousMessage.type===va.System:!0}ngOnChanges(){this._setFirstMessageData()}cachePreviousMessage(e){this._previousMessage=e>0?this.messages[e-1]:void 0}openContact(e){return this.contactClick.emit({contactId:e}),!1}trackMessageById(e,t){return t.id}isShowSeparator(e,t){return this._isNewDay(e)?this.separatorText=this._formatDate(e.time):this.separatorText=this._isNewMessages(t)?this._translateService.instant("ChatSettings.ChatWindow.NewMessages"):"",this.separatorText!==""}openImage(e){const t=e.target,n=document.body,s=document.createElement("div");s.classList.add("full-chat-image-container"),s.style.backgroundImage="url('"+t.src+"')",s.style.backgroundSize=yt._isLargeImage(t,n)?"contain":"auto",s.addEventListener("click",function(){n.removeChild(s)}),n.appendChild(s)}getFileUrl(e){return this._joinPath(ae(),this._fileServiceUrl,e)}getImageUrl(e){return this._isFileApiEnabled?this.getFileUrl(e):this._joinPath(ae(),this._imageUrl,e)}isFirstMessageInSequence(e){const t=this.messages.findIndex(s=>s.id===e.id);if(t===0)return!0;const n=this.messages[t-1];return this._isAuthorChanged(e,n)}isLastMessageInSequence(e){const t=this.messages.findIndex(s=>s.id===e.id);if(t===this.messages.length-1)return!0;const n=this.messages[t+1];return this._isAuthorChanged(e,n)}isSystemMessage(e){return e.type===va.System}onChatImgLoaded(e){const t=e.target;this.isImageOversize(t.width,t.height)&&t.parentElement.classList.add("img-contain")}isImageOversize(e,t){const n=e/t,s=this.imageContainerSize.width/this.imageContainerSize.height;return Math.max(n,s)/Math.min(n,s)<=2&&e>this.imageContainerSize.width&&t>this.imageContainerSize.height}formatSystemMessage(e){const t=new Date(e.time);vu(t,this._userInfo.timeZoneOffsetHours);const n=this._formatDate(t),s=Tu(t,this._userInfo.cultureInfo);return e.text.replace("{datePart}",n).replace("{timePart}",s)}getLocalTime(e){const t=new Date(e);return vu(t,this._userInfo.timeZoneOffsetHours),Tu(t,this._userInfo.cultureInfo)}showMessageFromAttachment(e){return e.text}getIsDuplicateMessage(e){return this.messages?this._duplicateIds.indexOf(e)!==-1:!1}onTranslationReady(e){const{translationKey:t,translation:n}=e,s=this.messages?.find(r=>r.id===t);s&&(s.text=n)}getMessageDisplayText(e){return this.isIncomingMessage(e)?e.text||e.originalText:e.originalText||e.text}static{this.\u0275fac=function(t){return new(t||yt)(i.\u0275\u0275directiveInject(L.oq),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(i.Injector),i.\u0275\u0275directiveInject(cn),i.\u0275\u0275directiveInject(oe),i.\u0275\u0275directiveInject(Mt))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:yt,selectors:[["crt-chat-messages"]],inputs:{messages:"messages",messagesCounter:"messagesCounter",language:"language",targetLanguageCode:"targetLanguageCode",chat:"chat"},outputs:{contactClick:"contactClick"},features:[i.\u0275\u0275NgOnChangesFeature],decls:2,vars:3,consts:[["class","first-message-date-separator messages-separator",4,"ngIf"],["class","message",3,"class","id","ngClass","ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"first-message-date-separator","messages-separator"],[1,"message",3,"id","ngClass","ngStyle"],["class","messages-separator",4,"ngIf"],["class","message-author",3,"hidden",4,"ngIf"],[1,"text-block",3,"ngSwitch"],["class","system-message-type",4,"ngSwitchCase"],["class","message-type text-message-type",3,"ngClass",4,"ngSwitchCase"],["class","attachment-message-type",4,"ngSwitchDefault"],[1,"messages-separator"],[1,"message-author",3,"hidden"],[1,"author-name"],[1,"author-photo",3,"contactClick","contact","contactColor"],[1,"system-message-type"],[1,"message-type","text-message-type",3,"ngClass"],[1,"text-message-wrapper"],[1,"message-text"],[1,"message-info-container"],[1,"message-time"],[3,"translationKey","sourceText","iconPosition","sourceLanguageCode","targetLanguageCode","isTranslated","originalText","translationReady",4,"ngIf"],[3,"translationReady","translationKey","sourceText","iconPosition","sourceLanguageCode","targetLanguageCode","isTranslated","originalText"],[1,"attachment-message-type"],[3,"ngSwitch",4,"ngFor","ngForOf"],["class","message-type text-message-type",4,"ngIf"],[3,"ngSwitch"],["class","message-type image-message-type",4,"ngSwitchCase"],["class","message-type file-message-type",3,"ngClass",4,"ngSwitchDefault"],[1,"message-type","image-message-type"],["alt","",1,"image-container",3,"click","load","ngStyle","src"],[1,"image-time"],[1,"message-type","file-message-type",3,"ngClass"],[1,"download-file","message-text"],[1,"file-message-type-link",3,"href"],[1,"message-type","text-message-type"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,_b,3,1,"div",0)(1,Nb,8,16,"div",1),t&2&&(i.\u0275\u0275property("ngIf",n.firstMessageDate),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.messages)("ngForTrackBy",n.trackMessageById))},dependencies:[b.NgClass,b.NgForOf,b.NgIf,b.NgStyle,b.NgSwitch,b.NgSwitchCase,b.NgSwitchDefault,St,on],styles:[".message[_ngcontent-%COMP%]{flex-direction:column;display:flex}.message[_ngcontent-%COMP%]:last-child{animation:_ngcontent-%COMP%_fadein .5s ease 1 alternate}@keyframes _ngcontent-%COMP%_fadein{0%{opacity:0}to{opacity:1}}.message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{font-family:Open Sans,serif;font-size:11px;text-align:center;letter-spacing:0;color:#999;opacity:1;vertical-align:top}.message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:50%;cursor:pointer}.message[_ngcontent-%COMP%]   .message-author[_ngcontent-%COMP%]{margin-bottom:-13px;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{position:relative;bottom:-3px;font-family:Open Sans,serif;letter-spacing:0;color:#999;opacity:1;padding-top:2px;font-size:11px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-info-container[_ngcontent-%COMP%]   .translate-btn[_ngcontent-%COMP%]{float:right}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:3px;display:inline-block;padding:8px 10px;margin:1px 0 1px 39px;text-align:left}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{font-family:Open Sans,serif;font-size:15px;letter-spacing:0;color:#444;opacity:1;white-space:pre-wrap;word-break:break-word}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-time[_ngcontent-%COMP%]{position:absolute;right:18px;bottom:18px;color:#fff;background-color:#999;font-size:11px;border-radius:12px;padding-left:5px;padding-right:5px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .message-image-item[_ngcontent-%COMP%]{position:relative}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .image-message-type[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{background-repeat:no-repeat;background-size:auto;background-position:center;object-fit:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .system-message-type[_ngcontent-%COMP%]{font-size:11px;text-align:center;color:#999;margin-top:17px}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{padding-left:22px;text-decoration:none}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K);background-repeat:no-repeat;background-position:2px 5px}.message.incoming-message[_ngcontent-%COMP%]{text-align:left}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:0 16px 16px 0;padding-right:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.text-message-type[_ngcontent-%COMP%]{padding-left:14px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 16px 0}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:0 16px 16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#4e7bd8}.message.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzQ2OV8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA0Njkg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzQ5MiIgZGF0YS1uYW1lPSJHcm91cCA3NDkyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMTguNSAtNDM4LjA0MikiPg0KICAgIDxwYXRoIGlkPSJQYXRoXzY5NDQiIGRhdGEtbmFtZT0iUGF0aCA2OTQ0IiBkPSJNLTMxNSw0NDUuNTQybDUsNC41LDUtNC41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogIDwvZz4NCiAgPGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguNSAwLjUpIiBmaWxsPSJub25lIiBzdHJva2U9IiM1NDY1N2QiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogIDxsaW5lIGlkPSJMaW5lXzc3OSIgZGF0YS1uYW1lPSJMaW5lIDc3OSIgeDI9IjEyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjUgMTQuNSkiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzU0NjU3ZCIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjEiLz4NCiAgPHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiLz4NCjwvc3ZnPg0K)}.message.incoming-message[_ngcontent-%COMP%]   .author-photo[_ngcontent-%COMP%]{float:left}.message.incoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-left:7px}.message.outcoming-message[_ngcontent-%COMP%]{text-align:right}.message.outcoming-message[_ngcontent-%COMP%]   .author-name[_ngcontent-%COMP%]{margin-right:7px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{border-radius:16px 0 0 16px;padding-left:16px;padding-right:14px;margin-right:0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence[_ngcontent-%COMP%]:not(.last-in-sequence){border-radius:16px 16px 0}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.last-in-sequence[_ngcontent-%COMP%]:not(.first-in-sequence){border-radius:16px 0 16px 16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.first-in-sequence.last-in-sequence[_ngcontent-%COMP%]{border-radius:16px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{float:right;text-align:center;margin-left:13px}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   a.file-message-type-link[_ngcontent-%COMP%]{color:#e5e8ee}.message.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .file-message-type[_ngcontent-%COMP%]   span.download-file[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGRhdGEtbmFtZT0iQ29tcG9uZW50IDQ2OSDigJMgMSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIvPgogIAogIAogIAogIAo8ZyBjbGFzcz0iY3VycmVudExheWVyIiBzdHlsZT0iIj48dGl0bGU+TGF5ZXIgMTwvdGl0bGU+PGcgaWQ9Ikdyb3VwXzc0OTIiIGRhdGEtbmFtZT0iR3JvdXAgNzQ5MiIgY2xhc3M9IiIgc3Ryb2tlPSIjZGFkYWRhIiBzdHJva2Utb3BhY2l0eT0iMSI+CiAgICA8cGF0aCBpZD0iUGF0aF82OTQ0IiBkYXRhLW5hbWU9IlBhdGggNjk0NCIgZD0iTTMuNSw3LjUwMDAwNzgxMjQ5OTk3MyBsNSw0LjUgbDUsLTQuNSAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2RhZGFkYSIgc3Ryb2tlLW1pdGVybGltaXQ9IjEwIiBzdHJva2Utd2lkdGg9IjAuOCIgc3Ryb2tlLW9wYWNpdHk9IjEiLz4KICA8L2c+PGxpbmUgaWQ9IkxpbmVfNzc4IiBkYXRhLW5hbWU9IkxpbmUgNzc4IiB5MT0iMTEuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjNTQ2NTdkIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIgeTI9IjAuNSIgeDI9IjguNSIgeDE9IjguNSIgY2xhc3M9IiIvPjxsaW5lIGRhdGEtbmFtZT0iTGluZSA3NzgiIHkxPSIxMS41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMC41IiB4Mj0iOC41IiB4MT0iOC41IiBjbGFzcz0iIiBpZD0ic3ZnXzEiLz48bGluZSBpZD0iTGluZV83NzkiIGRhdGEtbmFtZT0iTGluZSA3NzkiIHgyPSIxNC41IiBmaWxsPSJub25lIiBzdHJva2U9IiNkYWRhZGEiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIiB5Mj0iMTQuNDgxNzAxNzM5MTMyNDA0IiB5MT0iMTQuNDgxNzAxNzM5MTMyNDA0IiB4MT0iMi41IiBjbGFzcz0iIi8+PHJlY3QgaWQ9IlJlY3RhbmdsZV82NTAyIiBkYXRhLW5hbWU9IlJlY3RhbmdsZSA2NTAyIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIGZpbGw9Im5vbmUiIGNsYXNzPSIiIHk9IjIuMTk3ODAyNTQzNjQwMTM2NyIgeD0iNTEuMDk4OTAzNjU2MDA1ODYiIHRyYW5zZm9ybT0icm90YXRlKC0xLjU5MTE0NTE1NzgxNDAyNTkgNTkuMDk4OTAzNjU2MDA2MDE2LDEwLjE5NzgwMjU0MzY0MDAzNCkgIi8+PC9nPjwvc3ZnPg==)}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo[_ngcontent-%COMP%]   .contact-photo.no-photo[_ngcontent-%COMP%]{font-size:12px!important}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]{display:inline-block;width:16px}.message.outcoming-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{line-height:1.6em;font-size:1em;width:16px;height:16px;min-width:16px;min-height:16px}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]{background:linear-gradient(#fafcfe,#fafcfe) padding-box,linear-gradient(to bottom right,#0077ff40,#8a1fe640,#f1255b40,#ff180040) border-box;border:1px solid transparent}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{color:#444}.message.bot-message[_ngcontent-%COMP%]   .text-message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#999}.message.bot-message[_ngcontent-%COMP%]   ts-contact-photo.author-photo[_ngcontent-%COMP%]     .contact-photo{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgaWQ9Ikljb24gfCBBSSBDb3BpbG90IC0gMTZ4MTYgfCBoZWF2eSI+CjxnIGlkPSJTdWJ0cmFjdCI+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDBfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMC4yMzU3NjEgNi4wNjQzNEMwLjA4MTc0MTkgNi42ODQxNiAwIDcuMzMyNTMgMCA4QzAgMTIuNDE4MyAzLjU4MTcyIDE2IDggMTZDMTAuOTYxMSAxNiAxMy41NDY1IDE0LjM5MTIgMTQuOTI5NyAxMkgxMi43MzYxQzExLjU5OSAxMy4zNDUgOS44OTkyMSAxNC4xOTkxIDggMTQuMTk5MUM0LjU3NjMzIDE0LjE5OTEgMS44MDA4OSAxMS40MjM3IDEuODAwODkgOEMxLjgwMDg5IDcuNjUzNzkgMS44MjkyNyA3LjMxNDIxIDEuODgzODMgNi45ODM0NkwwLjIzNTc2MSA2LjA2NDM0Wk0xMi43MzYxIDQuMDAwMDFDMTEuNTk5IDIuNjU0OTggOS44OTkyMyAxLjgwMDg5IDggMS44MDA4OUM3LjMzNTY1IDEuODAwODkgNi42OTU3MSAxLjkwNTQgNi4wOTU3MiAyLjA5ODg3TDMuNTI4NDcgMS4zNjUzN0M0LjgwNTAxIDAuNTAzMzI3IDYuMzQzNzMgMCA4IDBDMTAuOTYxMSAwIDEzLjU0NjUgMS42MDg4IDE0LjkyOTggNC4wMDAwMUgxMi43MzYxWiIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjwvZz4KPGcgaWQ9InNoYXBlIj4KPHBhdGggZD0iTTE2IDhMNyAxMS41TDguNSA4TDAgMkwxNiA4WiIgZmlsbD0idXJsKCNwYWludDJfcmFkaWFsXzQ3NDdfNzgxMDIpIi8+CjxwYXRoIGQ9Ik0xNiA4TDcgMTEuNUw4LjUgOEwwIDJMMTYgOFoiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyKSIvPgo8L2c+CjwvZz4KPGRlZnM+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQwX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTg3OTk3IC0wLjgyMjgyOSkgcm90YXRlKDcyLjA0NjgpIHNjYWxlKDM2LjYyNyAxNS43Mzc5KSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQxX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjM1OTE5IC01LjEpIHJvdGF0ZSg1My43Njk0KSBzY2FsZSgzNi45NDMyIDE2LjQ2NSkiPgo8c3RvcCBzdG9wLWNvbG9yPSIjMDgxQTJGIi8+CjxzdG9wIG9mZnNldD0iMC42MSIgc3RvcC1jb2xvcj0iIzhBMUZFNiIvPgo8c3RvcCBvZmZzZXQ9IjAuOTM1IiBzdG9wLWNvbG9yPSIjRjEyNTVCIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iI0ZGMTgwMCIvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50Ml9yYWRpYWxfNDc0N183ODEwMiIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgwLjIwMTQ3NCAxLjUxMTQ1KSByb3RhdGUoNTkuNjc5NCkgc2NhbGUoMjMuOTY2NiAxNS4zMDQzKSI+CjxzdG9wIHN0b3AtY29sb3I9IiMwMDc3RkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjYxIiBzdG9wLWNvbG9yPSIjOEExRkU2Ii8+CjxzdG9wIG9mZnNldD0iMC45MzUiIHN0b3AtY29sb3I9IiNGMTI1NUIiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxODAwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQzX3JhZGlhbF80NzQ3Xzc4MTAyIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKC0zLjYgLTEuMDI4MTMpIHJvdGF0ZSgzNy4wOTQ1KSBzY2FsZSgyOS4zMzY1IDEzLjE5MzQpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzA4MUEyRiIvPgo8c3RvcCBvZmZzZXQ9IjAuNjEiIHN0b3AtY29sb3I9IiM4QTFGRTYiLz4KPHN0b3Agb2Zmc2V0PSIwLjkzNSIgc3RvcC1jb2xvcj0iI0YxMjU1QiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNGRjE4MDAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K)!important;background-size:16px 16px;cursor:default}.messages-separator[_ngcontent-%COMP%]{width:100%;text-align:center;border-bottom:1px solid #e3e6ec;line-height:.1em;margin:17px 0}.messages-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#fff;padding:0 10px;letter-spacing:0;color:#999;opacity:1;font-family:Open Sans,serif;font-size:11px}.first-message-date-separator[_ngcontent-%COMP%]{border:none;margin-top:8px}.incoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#eaedf3;border:1px solid #e3e6ec;align-self:flex-start}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]{background-color:#006ce0;align-self:flex-end}.outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%], .outcoming-message[_ngcontent-%COMP%]   .message-type[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fff}.text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{position:relative;background-color:#fff;border:none}.incoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-left:0}.outcoming-message[_ngcontent-%COMP%]   .text-block[_ngcontent-%COMP%]   .message-type.image-message-type[_ngcontent-%COMP%]{padding-right:0}.message-type[_ngcontent-%COMP%]   .message-info-container[_ngcontent-%COMP%]{align-items:center}  .text-message-wrapper .translate-toggle-button{background:transparent;opacity:0;float:right}  .text-message-wrapper .translate-toggle-button .icon{color:#004fd6}.text-message-wrapper[_ngcontent-%COMP%]:hover   .translate-toggle-button[_ngcontent-%COMP%], .text-message-wrapper[_ngcontent-%COMP%]:hover     .translate-toggle-button{opacity:1}"]})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Array),(0,p.__metadata)("design:paramtypes",[Array])],yt.prototype,"messages",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],yt.prototype,"messagesCounter",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",kh)],yt.prototype,"chat",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],yt.prototype,"contactClick",void 0);function Eb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",1)(1,"span",2),i.\u0275\u0275text(2),i.\u0275\u0275elementStart(3,"a",3),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(s.contactClicked(s.chat.operator.contact==null?null:s.chat.operator.contact.id))}),i.\u0275\u0275text(4),i.\u0275\u0275elementEnd()()()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",t.getEndDateCaption(t.chat.completionDate)," "),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.chat.operator.contact==null?null:t.chat.operator.contact.name)}}function Db(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div")(1,"div",1)(2,"span",2),i.\u0275\u0275text(3),i.\u0275\u0275elementStart(4,"a",3),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.contactClicked(s.chat.contact.id))}),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(6,"div",4)(7,"crt-chat-messages",5),i.\u0275\u0275twoWayListener("chatChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275twoWayBindingSet(r.chat,s)||(r.chat=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(8,Eb,5,2,"div",6),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",t.getStartDateCaption(t.chat.chatStartDate)," "),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.chat.contact.name),i.\u0275\u0275advance(2),i.\u0275\u0275property("messages",t.messages),i.\u0275\u0275twoWayProperty("chat",t.chat),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.isChatCompleted())}}class Dn{constructor(e,t,n){this.chatService=e,this._userInfo=t,this._translateService=n,this.contactClick=new i.EventEmitter,this.messagesLoaded=new i.EventEmitter}_loadHistory(){this.chatService.getChatHistory(this.chatId).pipe((0,u.tap)(e=>{e&&(this.messages=e,this._setChatInfo())})).subscribe()}_setChatInfo(){this.chatService.getItem(this.chatId).subscribe(e=>{e.success&&(this.chat=e.result[0],this.messagesLoaded.emit())})}getStartDateCaption(e){const t=this._translateService.instant("ChatSettings.History.Captions.StartDate");return we.String.Format(t,this.formatChatDate(e))}getEndDateCaption(e){const t=this._translateService.instant("ChatSettings.History.Captions.EndDate");return we.String.Format(t,this.formatChatDate(e))}formatChatDate(e){const t={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},n=e?new Date(e):new Date;return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName,t).format(n)}ngOnInit(){(0,A.gZ)(this.chatId)||this._loadHistory()}contactClicked(e){this.contactClick.emit({contactId:e})}isChatCompleted(){return this.chat.status.value===Wl.Completed}static{this.\u0275fac=function(t){return new(t||Dn)(i.\u0275\u0275directiveInject(Re),i.\u0275\u0275directiveInject(L.oq),i.\u0275\u0275directiveInject(v.TranslateService))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Dn,selectors:[["crt-omnichannel-messaging-chat-history"]],inputs:{chatId:[0,"chatid","chatId"]},outputs:{contactClick:"contactClick",messagesLoaded:"messagesLoaded"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"chat-status-info-container"],[1,"chat-date"],[1,"contact-name",3,"click"],[1,"chat-history-component-container"],[3,"chatChange","messages","chat"],["class","chat-status-info-container",4,"ngIf"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,Db,9,5,"div",0),t&2&&i.\u0275\u0275property("ngIf",n.chat)},dependencies:[b.NgIf,yt],styles:[`.chat-date{color:#999;font-size:13px;font-family:Open Sans,serif}.chat-history-component-container{margin-bottom:19px}.contact-name{font-size:13px;color:#4e7bd8;cursor:pointer}.contact-name:hover{text-decoration:underline}.full-chat-image-container{top:0;width:100%;height:100%;z-index:999999999999;position:fixed;align-items:center;background-position:center;background-repeat:no-repeat;background-color:#000000b3}
`],encapsulation:2})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",we.String)],Dn.prototype,"chatId",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],Dn.prototype,"contactClick",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],Dn.prototype,"messagesLoaded",void 0);class Lv{}const jg=new i.InjectionToken("ContextService");class tc{get contextService(){return this._contextService===void 0&&(this._contextService=this._injector.get(jg,null)),this._contextService}constructor(e,t,n){this._modelGenerator=e,this._window=t,this._injector=n,this._schemaName="AcademyUrlData"}_createAcademyHelpUrlDataItem(e){return{configurationVersion:e.ConfigurationVersion,contextHelpCode:e.Code,contextHelpId:e.ContextHelpId,enableContextHelp:e.EnableContextHelp,lmsUrl:e.LMSUrl,productEdition:e.ProductEdition,useLmsDocumentation:e.UseLmsDocumentation}}_getSchemaColumns(){return["ContextHelpId","EnableContextHelp","Code","ProductEdition","ConfigurationVersion","UseLmsDocumentation","LMSUrl"]}_createDataSourceParameters(e){return[{type:ne.Filter,value:this._getContextHelpCodeFilter(e)}]}_getContextHelpCodeFilter(e){return new bt(ee.Equal,new pe({columnPath:"Code"}),new fe({value:e}))}_getAcademyHelpUrlData(e){return this._modelGenerator.generateOne({type:"crt.EntityDataSource",config:{entitySchemaName:this._schemaName}},"").pipe((0,c.switchMap)(t=>t.load({attributes:this._getSchemaColumns(),parameters:e})),(0,c.map)(t=>t.length===1?this._createAcademyHelpUrlDataItem(t[0]):null))}_buildUrl(e){let t="#";return e&&(t=e.useLmsDocumentation?this._getLmsDocumentationUrl(e):we.String.empty),t}_getLmsDocumentationUrl(e){const t=[],n=e.productEdition;n&&t.push("product="+encodeURIComponent(n));const s=e.configurationVersion;s&&t.push("ver="+encodeURIComponent(s));const r=e.enableContextHelp,o=e.contextHelpId;return r&&o&&t.push("id="+encodeURIComponent(o)),`${e.lmsUrl}?${t.join("&")}`}getAcademyHelpUrl(e){if(e===we.String.empty)return(0,u.of)(we.String.empty);const t=this._createDataSourceParameters(e);return this._getAcademyHelpUrlData(t).pipe((0,c.map)(n=>n?this._buildUrl(n):we.String.empty))}openContextHelp(){const e=this.contextService;if(!e)throw new Error(`${jg.toString()} was not provided`);const t=e.getContextCode();this.getAcademyHelpUrl(t).subscribe(n=>{this._window.open(n)})}static{this.\u0275fac=function(t){return new(t||tc)(i.\u0275\u0275inject(Dl),i.\u0275\u0275inject(P.ZP),i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:tc,factory:tc.\u0275fac,providedIn:"root"})}}class Ta{constructor(e){this._academyService=e,this.academyUrl$=new u.BehaviorSubject("")}ngOnInit(){this._academyService.getAcademyHelpUrl("ChatAccess").pipe((0,u.take)(1)).subscribe(e=>{this.academyUrl$.next(e)})}static{this.\u0275fac=function(t){return new(t||Ta)(i.\u0275\u0275directiveInject(tc))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ta,selectors:[["ts-facebook-channel-error-dialog"]],decls:12,vars:12,consts:[["mat-dialog-content",""],[1,"message"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0)(1,"span",1),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementStart(4,"a",2),i.\u0275\u0275pipe(5,"async"),i.\u0275\u0275text(6),i.\u0275\u0275pipe(7,"translate"),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(8,"div",3)(9,"button",4),i.\u0275\u0275text(10),i.\u0275\u0275pipe(11,"translate"),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(3,4,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Message")," "),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("href",i.\u0275\u0275pipeBind1(5,6,n.academyUrl$),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(7,8,"ChatSettings.ChannelDetail.FacebookSettings.InvalidSettings.Link.Text")," "),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(11,10,"InfoDialog.OK")," "))},dependencies:[W.MatButton,Y.MatDialogClose,Y.MatDialogActions,Y.MatDialogContent,b.AsyncPipe,v.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{float:right;margin-left:auto;border-radius:4px}"]})}}class nc extends Ot.S{constructor(e,t){super(),this.sysSettingsService=e,this.userInfo=t,this._enabled=!1,this._initialized=!1}_initializeDataLayer(){const e=window;e.dataLayer&&(this._dataLayer=e.dataLayer)}_initializeScripts(e){e&&(e=e.replace(/'/g,'"'),this._appendChildScriptTag(document.head,"script",this._getHtmlTagContent("script",e)),this._appendChildScriptTag(document.body,"noscript",this._getHtmlTagContent("noscript",e)))}_getHtmlTagContent(e,t){if(!t||!e)return"";const n=new RegExp("<"+e+"[\\s\\S]*?>[\\s\\S]*?<\\/"+e+">","gi"),s=t.match(n);if(s&&s.length===1){const r=s[0],o=new RegExp("<(\\/|)"+e+"(.*?|)>","gi");return r.replace(o,"").trim()}else return""}_appendChildScriptTag(e,t,n){if(!e||!t||!n)return;const s=document.createElement(t);s.appendChild(document.createTextNode(n)),e.appendChild(s)}_initializeDefaultVariables(e){const t=this.userInfo,n={productName:e.ProductName,productEdition:e.ProductEdition,primaryCulture:{displayValue:t.cultureInfo.sysCultureName,value:t.cultureInfo.sysCultureId},customerId:e.CustomerId,version:e.ConfigurationVersion,userId:t.id,userType:this._getUserType(),accessType:t.accessType};this._pushVariables(n)}_getUserType(){return this.userInfo.isSSP?"External":"Employee"}_pushVariables(e){try{this._dataLayer.push(e)}catch(t){console.log(t.message)}}_initializeGoogleTagManager(e){e.UseGoogleTagManager&&(this._initializeScripts(e.GoogleTagManagerScript),this._initializeDataLayer(),this._enabled=!!this._dataLayer,this._enabled&&this._initializeDefaultVariables(e))}_executeInitialization(){const e=["UseGoogleTagManager","GoogleTagManagerScript","ProductName","ProductEdition","ConfigurationVersion","CustomerId"],t=this.sysSettingsService.getByCodes(e);return t.pipe((0,c.take)(1)).subscribe(n=>{const s=n&&n.success&&n.values&&(0,T.mapValues)(n.values||{},r=>r.value);s&&this._initializeGoogleTagManager(s),this._initialized=!0}),t.pipe((0,c.map)(()=>{}))}_resetCustomData(e){const t={};for(const n of Object.keys(e))t[n]=void 0;this._pushVariables(t)}initialize(){return this._initialized?(0,u.of)(void 0):(this._initializationObservable$||(this._initializationObservable$=this._executeInitialization()),this._initializationObservable$)}track(e){this._enabled&&(this._pushVariables(Object.assign(e,{description:JSON.stringify(e.description),event:e?.event||"bpmonlineInfo",virtualUrl:location.href})),this._resetCustomData(e))}static{this.\u0275fac=function(t){return new(t||nc)(i.\u0275\u0275inject(Mt),i.\u0275\u0275inject(L.oq))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:nc,factory:nc.\u0275fac,providedIn:"root"})}}const Ab=["sourceInput"],Ob=["targetInput"];function Pb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",18),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.sourceDropdownOpen?r.clearSelection(s,"source"):null)}),i.\u0275\u0275element(1,"mat-icon",19),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("svgIcon",t.sourceDropdownOpen?"small-close":"menu-arrow")}}function kb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",20),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("value",t),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.displayValue||t.caption||t.code," ")}}function jb(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",18),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.targetDropdownOpen?r.clearSelection(s,"target"):null)}),i.\u0275\u0275element(1,"mat-icon",19),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("svgIcon",t.targetDropdownOpen?"small-close":"menu-arrow")}}function Rb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"mat-option",20),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit;i.\u0275\u0275property("value",t),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.displayValue||t.caption||t.code," ")}}function Lb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"span",23),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd()()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",t.languageDetectionError?i.\u0275\u0275pipeBind1(4,1,"MultilingualMessages.LanguageDetectionError"):t.translationError||""," ")}}class tt{constructor(e,t,n){this._gtm=e,this._cdr=t,this._directionality=n,this.sourceLanguageControl=new Z.FormControl("",[Z.Validators.required]),this.targetLanguageControl=new Z.FormControl("",[Z.Validators.required]),this.translationError=null,this.languageDetectionError=!1,this.sourceDropdownOpen=!1,this.targetDropdownOpen=!1,this.availableLanguages=[],this.autoTranslateOnLanguageChange=!1,this.disabled=!1,this.sourceLanguageChange=new i.EventEmitter,this.translate=new i.EventEmitter,this.targetLanguageChange=new i.EventEmitter,this.displayFn=s=>s?s.displayValue||s.caption||s.code:""}_trackGtm(){this._gtm.track({action:"MultilingualTranslate",moduleName:"Multilingual",schemaName:"Multilingual",description:this.sourceLanguage})}_setSourceLanguage(){const e=this.availableLanguages.find(t=>t.code===this.sourceLanguage)||null;this.sourceLanguageControl.setValue(e,{emitEvent:!1})}_initFilter(){this.filteredLanguages$=this.sourceLanguageControl.valueChanges.pipe((0,c.startWith)(this.sourceLanguageControl.value||""),(0,c.map)(e=>this._filter(e))),this.targetFilteredLanguages$=this.targetLanguageControl.valueChanges.pipe((0,c.startWith)(this.targetLanguageControl.value||""),(0,c.map)(e=>this._filter(e)))}_filter(e){if(!this.availableLanguages)return[];if(e&&typeof e!="string")return this.availableLanguages;const t=(e||"").toString().toLowerCase();return this.availableLanguages.filter(n=>(n.displayValue||"").toLowerCase().includes(t)||(n.caption||"").toLowerCase().includes(t)||(n.code||"").toLowerCase().includes(t))}_setTargetLanguage(){const e=this.availableLanguages.find(t=>t.code===this.targetLanguage)||null;this.targetLanguageControl.setValue(e,{emitEvent:!1}),this._cdr.detectChanges()}ngOnChanges(e){e.sourceLanguage&&this.sourceLanguage&&this.availableLanguages?.length>0&&this._setSourceLanguage(),e.targetLanguage&&this.targetLanguage&&this.availableLanguages?.length>0&&this._setTargetLanguage(),e.availableLanguages&&this._initFilter(),e.disabled&&(this.disabled?(this.sourceLanguageControl.disable({emitEvent:!1}),this.targetLanguageControl.disable({emitEvent:!1})):(this.sourceLanguageControl.enable({emitEvent:!1}),this.targetLanguageControl.enable({emitEvent:!1})))}ngOnInit(){this.availableLanguages?.length>0?(this._initFilter(),this.sourceLanguage&&this._setSourceLanguage(),this.targetLanguage&&this._setTargetLanguage()):this.loadLanguages()}isSelected(){const e=this.sourceLanguageControl.value;return!!e&&typeof e!="string"&&!!e.code}clearSelection(e,t="source"){e.stopPropagation(),t==="target"?(this.targetLanguageControl.setValue("",{emitEvent:!0}),this.targetLanguageControl.markAsTouched(),this.targetLanguage=null):t==="source"&&(this.sourceLanguageControl.setValue("",{emitEvent:!0}),this.sourceLanguage=null),this._initFilter(),setTimeout(()=>{t==="target"?this._targetInputRef?.nativeElement.focus():t==="source"&&this._sourceInputRef?.nativeElement.focus()})}onSourceLanguageSelected(e){this.disabled||e.code===this.sourceLanguage||(this.sourceLanguage=e.code,this.sourceLanguageControl.setValue(e,{emitEvent:!1}),this._trackGtm(),this.sourceLanguageChange.emit(e),this.autoTranslateOnLanguageChange&&this.translate.emit({sourceLanguage:this.sourceLanguage,targetLanguage:this.targetLanguage}))}onTargetLanguageSelected(e){this.disabled||e.code===this.targetLanguage||(this.targetLanguage=e.code,this.targetLanguageControl.setValue(e,{emitEvent:!1}),this.targetLanguageChange.emit(e))}translateAll(){!this.sourceLanguage||this.disabled||(this.translationError=null,this.translate.emit({sourceLanguage:this.sourceLanguage,targetLanguage:this.targetLanguage}))}setTranslationError(e){this.translationError=e,this._cdr.markForCheck()}setLanguageDetectionError(e){this.languageDetectionError=e,e?this.sourceLanguageControl.setValue("",{emitEvent:!1}):this.setTranslationError(null),this._cdr.markForCheck()}loadLanguages(){const e={type:"crt.LoadTranslationLanguagesRequest",languages:[],$context:null};return Ae.instance.process(e).then(()=>{this.availableLanguages=e.languages,this.sourceLanguage&&this._setSourceLanguage(),this.targetLanguage&&this._setTargetLanguage(),this._initFilter(),this._cdr.markForCheck()}).catch(()=>{this._cdr.markForCheck()})}isRtl(){return this._directionality.value==="rtl"}getHint(e){return new ec({hintConfig:{displayValue:e,cssClasses:"omnichat-tooltip-hint"},componentType:sn})}isTranslateDisabled(){return this.disabled||!this.sourceLanguage||!this.targetLanguage||!this.sourceLanguageControl.valid||!this.targetLanguageControl.valid}static{this.\u0275fac=function(t){return new(t||tt)(i.\u0275\u0275directiveInject(nc),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(vn.Directionality))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:tt,selectors:[["crt-translate-language-picker"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(Ab,5),i.\u0275\u0275viewQuery(Ob,5)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n._sourceInputRef=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n._targetInputRef=s.first)}},inputs:{sourceLanguage:"sourceLanguage",availableLanguages:"availableLanguages",autoTranslateOnLanguageChange:"autoTranslateOnLanguageChange",disabled:"disabled",targetLanguage:"targetLanguage"},outputs:{sourceLanguageChange:"sourceLanguageChange",translate:"translate",targetLanguageChange:"targetLanguageChange"},features:[i.\u0275\u0275NgOnChangesFeature],decls:34,vars:45,consts:[["sourceInput",""],["sourceLangAuto","matAutocomplete"],["targetInput",""],["langAuto","matAutocomplete"],[1,"mlt-root"],[1,"mlt-row"],["appearance","outline","floatLabel","always",1,"mlt-lang-field","mlt-source-field"],["matInput","","type","text","required","",1,"mlt-lang-input",3,"formControl","matAutocomplete","placeholder"],["mat-icon-button","","type","button","class","mlt-clear-btn","tabindex","-1","disableRipple","",3,"click",4,"ngIf"],["panelClass","mlt-lang-panel",3,"optionSelected","opened","closed","displayWith","panelWidth"],[3,"value",4,"ngFor","ngForOf"],[1,"mlt-arrow-container"],[1,"mlt-arrow-icon",3,"svgIcon"],["appearance","outline","floatLabel","always",1,"mlt-lang-field","mlt-target-field"],["type","button",1,"mlt-translate-btn",3,"click","disabled"],[3,"libHintOverlay"],["svgIcon","translate-icon",1,"mlt-translate-icon"],["class","mlt-error-container",4,"ngIf"],["mat-icon-button","","type","button","tabindex","-1","disableRipple","",1,"mlt-clear-btn",3,"click"],[3,"svgIcon"],[3,"value"],[1,"mlt-error-container"],[1,"mlt-error-message"],[1,"mlt-error-text"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",4)(1,"div",5)(2,"mat-form-field",6)(3,"mat-label"),i.\u0275\u0275text(4),i.\u0275\u0275pipe(5,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(6,"input",7,0),i.\u0275\u0275pipe(8,"translate"),i.\u0275\u0275template(9,Pb,2,1,"button",8),i.\u0275\u0275elementStart(10,"mat-autocomplete",9,1),i.\u0275\u0275listener("optionSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onSourceLanguageSelected(o.option.value))})("opened",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.sourceDropdownOpen=!0)})("closed",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.sourceDropdownOpen=!1)}),i.\u0275\u0275template(12,kb,2,2,"mat-option",10),i.\u0275\u0275pipe(13,"async"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(14,"div",11),i.\u0275\u0275element(15,"mat-icon",12),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(16,"mat-form-field",13)(17,"mat-label"),i.\u0275\u0275text(18),i.\u0275\u0275pipe(19,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(20,"input",7,2),i.\u0275\u0275pipe(22,"translate"),i.\u0275\u0275template(23,jb,2,1,"button",8),i.\u0275\u0275elementStart(24,"mat-autocomplete",9,3),i.\u0275\u0275listener("optionSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onTargetLanguageSelected(o.option.value))})("opened",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.targetDropdownOpen=!0)})("closed",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.targetDropdownOpen=!1)}),i.\u0275\u0275template(26,Rb,2,2,"mat-option",10),i.\u0275\u0275pipe(27,"async"),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(28,"button",14),i.\u0275\u0275pipe(29,"translate"),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.translateAll())}),i.\u0275\u0275elementStart(30,"div",15),i.\u0275\u0275pipe(31,"translate"),i.\u0275\u0275element(32,"mat-icon",16),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275template(33,Lb,5,3,"div",17),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(11),r=i.\u0275\u0275reference(25);i.\u0275\u0275classProp("is-disabled",n.disabled),i.\u0275\u0275advance(),i.\u0275\u0275classProp("rtl",n.isRtl()),i.\u0275\u0275advance(),i.\u0275\u0275classProp("mlt-dropdown-open",n.sourceDropdownOpen),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(5,29,"MultilingualMessages.Caption")),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("placeholder",i.\u0275\u0275pipeBind1(8,31,"MultilingualMessages.LanguagePlaceholder")),i.\u0275\u0275property("formControl",n.sourceLanguageControl)("matAutocomplete",s),i.\u0275\u0275attribute("aria-autocomplete","list"),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.sourceLanguageControl.value&&!n.disabled),i.\u0275\u0275advance(),i.\u0275\u0275property("displayWith",n.displayFn)("panelWidth",230),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",i.\u0275\u0275pipeBind1(13,33,n.filteredLanguages$)),i.\u0275\u0275advance(3),i.\u0275\u0275property("svgIcon",n.isRtl()?"arrow-left":"arrow-right"),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(19,35,"MultilingualMessages.SourceCaption")),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("placeholder",i.\u0275\u0275pipeBind1(22,37,"MultilingualMessages.LanguagePlaceholder")),i.\u0275\u0275property("formControl",n.targetLanguageControl)("matAutocomplete",r),i.\u0275\u0275attribute("aria-autocomplete","list"),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.targetLanguageControl.value&&!n.disabled),i.\u0275\u0275advance(),i.\u0275\u0275property("displayWith",n.displayFn)("panelWidth",230),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",i.\u0275\u0275pipeBind1(27,39,n.targetFilteredLanguages$)),i.\u0275\u0275advance(2),i.\u0275\u0275property("disabled",n.isTranslateDisabled()),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(29,41,"MultilingualMessages.Translate")),i.\u0275\u0275advance(2),i.\u0275\u0275property("libHintOverlay",n.getHint(i.\u0275\u0275pipeBind1(31,43,"MultilingualMessages.Translate"))),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.languageDetectionError||n.translationError)}},dependencies:[b.NgForOf,b.NgIf,Z.DefaultValueAccessor,Z.NgControlStatus,Z.RequiredValidator,Z.FormControlDirective,K.MatFormField,K.MatLabel,Oe.MatAutocomplete,qe.MatOption,Oe.MatAutocompleteTrigger,re.MatInput,U.MatIcon,W.MatIconButton,nn,b.AsyncPipe,v.TranslatePipe],styles:[".mlt-root.is-disabled[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.mlt-error-container[_ngcontent-%COMP%]{padding-top:4px}.mlt-error-container[_ngcontent-%COMP%]   .mlt-error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.mlt-error-container[_ngcontent-%COMP%]   .mlt-error-message[_ngcontent-%COMP%]   .mlt-error-text[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;font-weight:500;font-style:normal;font-size:12px;line-height:16px;color:#d2310d}.mlt-toolbar[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px;flex-wrap:wrap}.mlt-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;justify-content:space-between}.mlt-row.rtl[_ngcontent-%COMP%]   .mlt-target-field[_ngcontent-%COMP%]{order:4}.mlt-row.rtl[_ngcontent-%COMP%]   .mlt-arrow-container[_ngcontent-%COMP%]{order:3}.mlt-row.rtl[_ngcontent-%COMP%]   .mlt-source-field[_ngcontent-%COMP%]{order:2}.mlt-row.rtl[_ngcontent-%COMP%]   .mlt-translate-btn[_ngcontent-%COMP%]{order:1}.mlt-lang-field[_ngcontent-%COMP%]{min-width:100px;max-width:190px;margin:0;position:relative}.mlt-lang-field[_ngcontent-%COMP%]   .mat-mdc-form-field-subscript-wrapper[_ngcontent-%COMP%]{display:none}.mlt-lang-field[_ngcontent-%COMP%]   .mat-mdc-form-field-wrapper[_ngcontent-%COMP%]{padding-bottom:0}.mlt-lang-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{padding:0 30px 0 6px}.mlt-lang-field[_ngcontent-%COMP%]   input.mat-mdc-input-element[_ngcontent-%COMP%]{padding:6px 0;font-size:14px;line-height:20px}.mlt-lang-field[_ngcontent-%COMP%]   .mlt-clear-btn[_ngcontent-%COMP%]{position:absolute;top:50%;right:-8px;transform:translateY(-50%);width:16px;height:16px;display:inline-flex;align-items:center;justify-content:center;padding:0;color:#00000073;transition:color .15s ease;line-height:1}.mlt-lang-field[_ngcontent-%COMP%]   .mlt-clear-btn.mat-mdc-icon-button[_ngcontent-%COMP%]{--mdc-icon-button-icon-size: 16px;width:24px;height:24px}.mlt-lang-field[_ngcontent-%COMP%]   .mlt-clear-btn[_ngcontent-%COMP%]:hover{color:#000000bf}.mlt-lang-field[_ngcontent-%COMP%]   .mlt-clear-btn[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;margin:0}.mlt-lang-field[_ngcontent-%COMP%]   .mlt-lang-input[_ngcontent-%COMP%]{max-width:114px}.mlt-row.rtl[_ngcontent-%COMP%]   .mlt-lang-field[_ngcontent-%COMP%]   .mlt-clear-btn[_ngcontent-%COMP%]{right:auto;left:-8px}[_nghost-%COMP%]     .mlt-lang-field .mat-mdc-text-field-wrapper{min-height:32px}[_nghost-%COMP%]     .mlt-lang-field .mat-mdc-form-field-flex{padding:0!important}[_nghost-%COMP%]     .mlt-lang-field .mdc-text-field{height:32px;padding-right:8px;padding-left:8px}[_nghost-%COMP%]     .mlt-lang-field .mat-mdc-form-field-infix{padding:0!important;min-height:32px;display:flex;align-items:center}[_nghost-%COMP%]     .mlt-lang-field .mat-mdc-floating-label{font-size:12px}[_nghost-%COMP%]     .mlt-lang-field .mdc-notched-outline__notch{padding:0!important}[_nghost-%COMP%]     .mlt-lang-field .mat-mdc-form-field-subscript-wrapper{display:none!important;height:0!important}[_nghost-%COMP%]     .mlt-lang-field .mdc-notched-outline__leading{border-start-start-radius:4px!important;border-end-start-radius:4px!important}[_nghost-%COMP%]     .mlt-lang-field .mdc-notched-outline__trailing{border-start-end-radius:4px!important;border-end-end-radius:4px!important}[_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-notched-outline__trailing{border:1px solid var(--crt-palette-link-500, #004fd6)!important;border-left-color:transparent!important}[_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-notched-outline__notch{border:1px solid var(--crt-palette-link-500, #004fd6)!important;border-right-color:transparent!important;border-left-color:transparent!important;border-top-color:transparent!important}[_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-floating-label.mat-mdc-floating-label{color:var(--crt-palette-link-500, #004fd6)}[_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-notched-outline__leading{border:1px solid var(--crt-palette-link-500, #004fd6)!important;border-right-color:transparent!important}[dir=rtl]   [_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-notched-outline__leading{border:1px solid var(--crt-palette-link-500, #004fd6)!important;border-left-color:transparent!important;border-right-color:var(--crt-palette-link-500, #004fd6)!important}[dir=rtl]   [_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-notched-outline__trailing{border:1px solid var(--crt-palette-link-500, #004fd6)!important;border-right-color:transparent!important;border-left-color:var(--crt-palette-link-500, #004fd6)!important}[dir=rtl]   [_nghost-%COMP%]     .mlt-lang-field .mdc-text-field--focused .mdc-notched-outline__notch{border:1px solid var(--crt-palette-link-500, #004fd6)!important;border-right-color:transparent!important;border-left-color:transparent!important;border-top-color:transparent!important}.mlt-translate-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid transparent;color:var(--crt-palette-link-500, #004fd6);font:inherit;display:inline-flex;align-items:center;gap:4px;cursor:pointer;padding:2px 6px;border-radius:4px;line-height:16px;font-size:12px}.mlt-translate-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#1976d214}.mlt-translate-btn[_ngcontent-%COMP%]:active:not(:disabled){background:#1976d229}.mlt-translate-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:default}.mlt-translate-btn[_ngcontent-%COMP%]   .mlt-translate-icon[_ngcontent-%COMP%]{width:16px;height:16px}.mlt-translate-btn[_ngcontent-%COMP%]   .mlt-translate-label.is-loading[_ngcontent-%COMP%]:after{display:none}.mlt-lang-panel[_ngcontent-%COMP%]{max-height:220px;padding-top:0}.mat-mdc-option[_ngcontent-%COMP%]   .mdc-list-item__primary-text[_ngcontent-%COMP%]{font-size:12px}.mlt-arrow-icon[_ngcontent-%COMP%]{color:var(--crt-palette-link-500, #004fd6);width:16px;height:16px}"],changeDetection:0})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],tt.prototype,"sourceLanguage",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Array)],tt.prototype,"availableLanguages",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],tt.prototype,"autoTranslateOnLanguageChange",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],tt.prototype,"disabled",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",String)],tt.prototype,"targetLanguage",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],tt.prototype,"sourceLanguageChange",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],tt.prototype,"translate",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],tt.prototype,"targetLanguageChange",void 0);class ic{open(e){return(0,u.of)({})}}const Wi={OK:{key:"OK",config:{color:"primary",caption:"Dialog.Ok"}},YES:{key:"YES",config:{color:"primary",caption:"Dialog.Yes"}},NO:{key:"NO",config:{color:"default",caption:"Dialog.No"}}};class xa{constructor(e){this.httpClient=e,this._serviceUrl="/rest/TelegramOmnichannelMessagingService/"}registerTelegramChannel(e){const t=this._serviceUrl+"RegisterChannel";return this.httpClient.post(t,{token:e})}validateRegisterChannel(e){return[{condition:!e.IsTokenValid,message:"ChatSettings.ChannelPage.Telegram.InvalidTelegramToken"},{condition:e.IsTokenExist,message:"ChatSettings.ChannelPage.Telegram.TelegramTokenAlreadyExists"},{condition:e.IsActiveWebhook,message:"ChatSettings.ChannelPage.Telegram.ActiveWebhookErrorMessageForCreating"}].find(n=>n.condition)?.message||""}getTelegramUserName(e){const t=this._serviceUrl+"GetUserName";return this.httpClient.post(t,{settingsId:e})}removeTelegramChannel(e){const t=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"RemoveChannel";return this.httpClient.post(n,{telegramId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||xa)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:xa,factory:xa.\u0275fac,providedIn:"root"})}}let Rh=class extends je{constructor(e,t,n,s){super(),this._telegramService=e,this._messageDialogProvider=t,this._translateService=n,this._maskService=s}_setModelValue(e,t,n,s){const r=e.getViewModelAttributePaths(t,n)[0];e[r]=s}_setModelValues(e,t){var n=this;return(0,S.A)(function*(){const s=yield e.getPrimaryModelName();n._setModelValue(e,s,"Name",t.ChannelName),n._setModelValue(e,s,"Source",t.TelegramId),n._setModelValue(e,s,"MsgSettingsId",t.SettingsId)})()}handle(e){var t=this;return(0,S.A)(function*(){const n=e.$context,s=yield n.validate();if(Object.keys(s).length>0)return;yield t._maskService.showBodyMask();const r=yield n.TelegramToken,o=yield(0,u.firstValueFrom)(t._telegramService.registerTelegramChannel(r)),l=t._telegramService.validateRegisterChannel(o);if(yield t._maskService.hideBodyMask(),l?.length>0)t._messageDialogProvider.open({data:{message:t._translateService.instant(l),actions:[Wi.OK]}});else return yield t._setModelValues(n,o),t.next?.handle(e)})()}};Rh=(0,p.__decorate)([Ke({requestType:"crt.SaveRecordRequest",type:"crt.TelegramChannelSaveHandler",scopes:["TelegramChannel_AddingPage"]}),(0,p.__metadata)("design:paramtypes",[xa,ic,v.TranslateService,Zn])],Rh);var pt;(function(a){a.FacebookMessenger="50491c6c-d82b-4b86-b38c-99262d11a5ac",a.Telegram="645170ab-c67a-4dcc-9def-c0e5236bdfe0",a.WhatsApp="1398dc73-b428-4e21-b97a-c1bb6b4bc621",a.AdaConnector="fd6491c5-0ebe-408a-a4c3-057a1ac79dd4"})(pt||(pt={}));class sc{wrapPhoneNumber(e){return`+${e}`}getRequestData(e,t,n){return{token:e,appId:t,channelPhoneNumber:this.wrapPhoneNumber(n)}}constructor(e){this.httpClient=e,this._serviceUrl="/rest/WhatsAppOmnichannelMessagingService/"}tryConnect(e,t,n){const s=this._serviceUrl+"Validate";return this.httpClient.post(s,this.getRequestData(e,t,n))}register(e,t,n){const s=this._serviceUrl+"RegisterChannel";return this.httpClient.post(s,this.getRequestData(e,t,n))}validateRegisterChannel(e){let t="";if(!e?.IsConnectionSuccess&&e?.errorInfo?.errorCode){const n=e.errorInfo.errorCode;["InvalidAppSidException","InvalidAccountPhoneNumberException","AuthenticateException"].indexOf(n)>-1?t=`ChatSettings.ChannelPage.WhatsApp.ErrorMessages.${n}`:t=e.errorInfo.message}return t}removeWhatsAppChannel(e){const t=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"RemoveChannel";return this.httpClient.post(n,{whatsAppId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||sc)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:sc,factory:sc.\u0275fac,providedIn:"root"})}}class Vb{get type(){switch(this.typeId){case pt.FacebookMessenger:return pt.FacebookMessenger;case pt.Telegram:return pt.Telegram;default:throw new Error(`Type with id ${this.typeId} not found`)}}}class wa{_createChannel(e){const t=e.Provider,n=e.ChatQueue,s=e.Language;return{id:e.Id,name:e.Name,typeId:t.value,typeName:t.displayValue,msgSettingsId:e.MsgSettingsId,queueId:n.value,queueName:n.displayValue,source:e.Source,isActive:e.IsActive,languageId:s.value,languageName:s.displayValue}}getEntity(e){return this._createChannel(e)}getEntityColumns(e){return[new le("Id",e.id,C.r.Guid),new le("Name",e.name,C.r.Text),new le("Provider",e.typeId,C.r.Lookup),new le("MsgSettingsId",e.msgSettingsId,C.r.Guid),new le("ChatQueue",e.queueId,C.r.Lookup),new le("Source",e.source,C.r.Text),new le("IsActive",e.isActive,C.r.Boolean),new le("Language",e.languageId,C.r.Lookup)]}static{this.\u0275fac=function(t){return new(t||wa)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:wa,factory:wa.\u0275fac})}}class $i extends jh{constructor(e,t,n){super(e,t,n),this.entitySchemaName="Channel"}_createNewChannel(e){const t=new Vb;return t.id=(0,A.qv)(),t.typeId=e,t}getLookupValues(e){const t=new Se(e);return t.addSchemaColumn("Id"),t.addSchemaColumn("Name").withOrdering(Qe.Asc,0),this.queryExecutor.executeSelectQuery(t).pipe((0,c.map)(n=>n.map(s=>({value:s.Id,displayValue:s.Name}))))}getChannelTypeItems(){const e=new Se("ChannelProvider");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(Qe.Asc,0),e.addSchemaColumn("PageUrl"),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>t.map(n=>({value:n.Id,displayValue:n.Name,pageUrl:n.PageUrl}))))}getChannelQueueItems(){const e=new Se("ChatQueue");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(Qe.Asc,0),e.addSchemaColumn("[ChatQueueOperator:ChatQueue].Id","Operator"),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>{const n=t.filter(r=>!!r.Operator);return n.filter((r,o)=>n.findIndex(l=>l.Id===r.Id)===o).map(r=>({value:r.Id,displayValue:r.Name}))}))}getActiveLanguages(){const e=new Se("SysLanguage");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name").withOrdering(Qe.Asc,0),e.filters.addSchemaColumnFilterWithParameter(ee.Equal,"IsUsed",1),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>t.map(n=>({value:n.Id,displayValue:n.Name}))))}generateNewChannelResponse(e){return{success:!0,result:[this._createNewChannel(e)]}}checkCanSaveChannel(e,t,n){const s=new Se("Channel");s.filters.addSchemaColumnFilterWithParameter(ee.Equal,"Source",e),s.filters.addSchemaColumnFilterWithParameter(ee.Equal,"Provider",t),this.queryExecutor.executeSelectQuery(s).subscribe(r=>{n(!(r&&r[0]))})}static{this.\u0275fac=function(t){return new(t||$i)(i.\u0275\u0275inject(xe),i.\u0275\u0275inject(v.TranslateService),i.\u0275\u0275inject(wa))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:$i,factory:$i.\u0275fac})}}let Lh=class extends je{constructor(e,t,n,s,r){super(),this._whatsAppService=e,this._channelService=t,this._messageDialogProvider=n,this._translateService=s,this._maskService=r}_handleConnectError(e){if(e?.errorInfo?.errorCode){const t=this._whatsAppService.validateRegisterChannel(e);this._messageDialogProvider.open({data:{message:this._translateService.instant(t),actions:[Wi.OK]}})}}_getDigits(e){return e.replace(/\D+/g,"")}_setModelValue(e,t,n,s){const r=e.getViewModelAttributePaths(t,n)[0];e[r]=s}_setModelValues(e,t,n){var s=this;return(0,S.A)(function*(){const r=yield e.getPrimaryModelName();s._setModelValue(e,r,"MsgSettingsId",t.SettingsId),s._setModelValue(e,r,"Source",n),s._setModelValue(e,r,"Name",n)})()}handle(e){var t=this;return(0,S.A)(function*(){const n=e.$context,s=yield n.validate();if(Object.keys(s).length>0)return;yield t._maskService.showBodyMask();const r=yield n.TwilioToken,o=yield n.ApplicationId,l=t._getDigits(yield n.PhoneNumber);if(yield(0,u.firstValueFrom)(t.validateIntegration(l,r,o))){const h=yield(0,u.firstValueFrom)(t._whatsAppService.register(r,o,l)),f=t._whatsAppService.validateRegisterChannel(h);if(yield t._maskService.hideBodyMask(),f?.length>0)t._messageDialogProvider.open({data:{message:t._translateService.instant(f),actions:[Wi.OK]}});else return yield t._setModelValues(e.$context,h,l),t.next?.handle(e)}})()}validateIntegration(e,t,n){return new u.Observable(s=>{this._channelService.checkCanSaveChannel(e,pt.WhatsApp,r=>{r?this._whatsAppService.tryConnect(t,n,e).subscribe(o=>{o?.IsConnectionSuccess?s.next(!0):(this._maskService.hideBodyMask(),this._handleConnectError(o),s.next(!1)),s.complete()}):(this._maskService.hideBodyMask(),this._messageDialogProvider.open({data:{message:this._translateService.instant("ChatSettings.ChannelPage.WhatsApp.ChannelDuplicatedErrorMessage"),actions:[Wi.OK]}}),s.next(!1),s.complete())})})}};Lh=(0,p.__decorate)([Ke({requestType:"crt.SaveRecordRequest",type:"crt.WhatsAppSaveChannelHandler",scopes:["WhatsAppChannel_AddingPage"]}),(0,p.__metadata)("design:paramtypes",[sc,$i,ic,v.TranslateService,Zn])],Lh);class Vv extends null{}let Vh=class extends je{constructor(e,t,n){super(),this.dialogService=e,this.queryExecutor=t,this.translateService=n,this._dataSourceName="QueueAgentsListDS"}_getEntityName(e){return e.$context.dataSchemas[this._dataSourceName]?.dataSourceConfig?.config?.entitySchemaName}_getInsertQuery(e,t){var n=this;return(0,S.A)(function*(){const s=n._getEntityName(e),r=new cr(s);return[{path:"Operator",value:t,type:C.r.Guid},{path:"ChatQueue",value:yield e.$context.Id,type:C.r.Guid}].forEach(l=>{r.addColumn(l.path,l.value,l.type)}),r})()}_createDuplicationsValidator(e){return t=>{const n=e.find(s=>s.attributes.QueueAgentsListDS_Operator.value===t.id);return{success:(0,T.isEmpty)(n),message:this.translateService.instant("ChatSettings.ChatQueueOperatorDetail.DuplicationMessage")}}}_saveViewModel(e){return(0,S.A)(function*(){const{$context:t,scopes:n}=e,s={type:"crt.SaveRecordRequest",preventCardClose:!0,scopes:n,$context:t};return yield Ae.instance.process(s)})()}_reloadAgentDetail(e){return(0,S.A)(function*(){const t=e.$context,n=yield t.getPrimaryModelName(),s=yield t.getPrimaryDataSchema(),r={type:"crt.LoadDataRequest",config:{loadType:ve.Reload},$context:t,parameters:[{type:"primaryColumnValue",value:s.primaryAttributeName}],dataSourceName:n};yield Ae.instance.process(r)})()}handle(e){var t=this;return(0,S.A)(function*(){if(e.$context.PrimaryModelMode===z.Create&&!(yield t._saveViewModel(e)))return;const s=yield e.$context.QueueAgentsList,r=yield(0,u.lastValueFrom)(t.dialogService.open(Jo,{data:{validator:t._createDuplicationsValidator(s)}}));if(r?.id){const o=yield t._getInsertQuery(e,r.id),l=t.queryExecutor.executeInsertQuery(o);yield(0,u.lastValueFrom)(l),yield t._reloadAgentDetail(e)}yield t.next?.handle(e)})()}};Vh=(0,p.__decorate)([Ke({type:"crt.CreateQueueAgentHandler",requestType:"crt.CreateQueueAgentHandlerRequest"}),(0,p.__metadata)("design:paramtypes",[Je,xe,v.TranslateService])],Vh);let zh=class extends je{constructor(e){super(),this.telegramService=e,this._telegramBotAttrName="TelegramBot"}_setTelegramBotLink(e,t){const n=`<a target='_blank' href='https://t.me/${e}'>${e}</a>`;t[this._telegramBotAttrName]=n}handle(e){var t=this;return(0,S.A)(function*(){const n=e.$context,s=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"MsgSettingsId")[0],r=yield n[s],o=yield n[t._telegramBotAttrName];return r&&!o&&!t._getUserName$&&(t._getUserName$=t.telegramService.getTelegramUserName(r).subscribe(l=>{t._setTelegramBotLink(l,n),t._getUserName$.unsubscribe()})),yield t.next?.handle(e)})()}};zh=(0,p.__decorate)([Ke({type:"crt.TelegramChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["TelegramChannel_EditPage"]}),(0,p.__metadata)("design:paramtypes",[xa])],zh);var Gi;(function(a){a.Edit="edit",a.Add="add",a.Copy="copy"})(Gi||(Gi={}));class zb{open(e,t){return(0,u.of)({})}}class Qi{constructor(e,t){this.httpClient=e,this.sysSettingsService=t,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/",this._settingsCodes=["IdentityServerUrl"],this._sysSettingsValues={},this.sysSettingsService.getByCodes(this._settingsCodes).subscribe(n=>{const s=n&&n.success&&n.values&&(0,T.mapValues)(n.values||{},r=>r.value);s&&(this._sysSettingsValues=s)})}getApplicationId(){return this.httpClient.get(this._serviceUrl+"GetCurrentFacebookAppId")}getApiVersion(){return"v20.0"}getIdentityServerUrl(){return this._sysSettingsValues.IdentityServerUrl}getPageName(e,t){return this.httpClient.get(this._serviceUrl+`GetPageName?pageId=${e}&channelId=${t}`).pipe((0,u.map)(n=>JSON.parse(n).name),(0,u.take)(1))}static{this.\u0275fac=function(t){return new(t||Qi)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(Mt))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Qi,factory:Qi.\u0275fac})}}class Na{constructor(e,t,n){this._sysSettingsService=e,this._facebookSettingsService=t,this._window=n,this._permissions="pages_show_list,pages_messaging,pages_manage_metadata,business_management,pages_read_engagement",this._fieldsToSubscribe="messages,messaging_postbacks,message_echoes,standby,messaging_handovers",this._sdkUrl="https://connect.facebook.net/en_US/sdk.js"}get fbApiLibrary(){return this._window.FB||null}_initApi(e){console.log(`FB.init call for appId:${e}`),this.fbApiLibrary.init({appId:e,autoLogAppEvents:!0,cookie:!0,xfbml:!0,version:this._facebookSettingsService.getApiVersion()})}_getSubscribedApps(e){return new u.Observable(t=>{console.log(`FB.api call for path '/me/subscribed_apps?access_token=${e}'`),this.fbApiLibrary.api(`/me/subscribed_apps?access_token=${e}`,"GET",{},n=>{const s=n?.data?.[0]?.subscribed_fields||[];t.next(s),t.complete()})})}isFacebookSettingValid(){var e=this;return(0,S.A)(function*(){return(yield(0,u.firstValueFrom)(e._sysSettingsService.getValueByCode("IdentityServerUrl")))&&e._window.location.protocol==="https:"})()}initApi(){return this.fbApiLibrary?(0,u.of)(!0):this.loadLibrary().pipe((0,u.concatMap)(()=>this._facebookSettingsService.getApplicationId()),(0,u.concatMap)(e=>{const t=e.replace(/\D+/g,"").trim();return this._initApi(t),(0,u.of)(!0)}))}loadLibrary(){return new u.Observable(e=>{console.log("Loading FB SDK...");const t=document.createElement("script");t.src=this._sdkUrl,t.onload=()=>{console.log("FB SDK loaded"),e.next(),e.complete()},t.onerror=n=>{e.error(n)},document.body.appendChild(t)})}login(){const e={scope:this._permissions,return_scopes:!0,auth_type:"rerequest"};return new u.Observable(t=>{console.log("FB.login call"),this.fbApiLibrary.login(n=>{n.authResponse&&n.status==="connected"&&(t.next(),t.complete())},e)})}getPages(){return new u.Observable(e=>{console.log("FB.api call for path 'me/accounts'"),this.fbApiLibrary.api("me/accounts",t=>{const n=[];t.data.forEach(s=>{n.push({id:s.id,name:s.name,token:s.access_token})}),e.next(n),e.complete()})})}subscribeApps(e,t){return new u.Observable(n=>{console.log(`FB.api call for path '/me/subscribed_apps?subscribed_fields=${t}&access_token=${e}'`),this.fbApiLibrary.api(`/me/subscribed_apps?subscribed_fields=${t}&access_token=${e}`,"POST",{},s=>{n.next(!!s),n.complete()})})}attachPage(e){return this._getSubscribedApps(e).pipe((0,u.concatMap)(t=>{const n=(0,T.union)(t,this._fieldsToSubscribe.split(",")).join(",");return this.subscribeApps(e,n)}))}static{this.\u0275fac=function(t){return new(t||Na)(i.\u0275\u0275inject(Mt),i.\u0275\u0275inject(Qi),i.\u0275\u0275inject("Window"))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Na,factory:Na.\u0275fac})}}class ac{constructor(e){this.httpClient=e,this._serviceUrl="/rest/FacebookOmnichannelMessagingService/"}registerFacebookChannel(e,t){const n=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"Register";return this.httpClient.post(s,{token:e,source:t},{headers:n})}removeFacebookChannel(e){const t=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),n=this._serviceUrl+"RemoveChannel";return this.httpClient.post(n,{facebookId:e},{headers:t})}static{this.\u0275fac=function(t){return new(t||ac)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ac,factory:ac.\u0275fac,providedIn:"root"})}}let Fh=class extends je{constructor(e,t,n,s,r,o){super(),this._facebookApiProvider=e,this._channelService=t,this._facebookRegistrationService=n,this._maskService=s,this._dialogProvider=r,this._messageDialogProvider=o}_isCreateFacebookChannelRequest(e){return e.entityName==="Channel"&&this._getDefaultValue(e,"Provider")===pt.FacebookMessenger}_getDefaultValue(e,t){return e.defaultValues.find(n=>n.attributeName===t)?.value}_getChannel(e){return{id:(0,A.qv)(),name:e.name,typeId:pt.FacebookMessenger,source:e.id,isActive:!1}}_addFacebookMessengerChannels(e){var t=this;return(0,S.A)(function*(){if(!(yield t._facebookApiProvider.isFacebookSettingValid())){yield(0,u.firstValueFrom)(t._dialogProvider.open(Ta,{panelClass:["crt-message-dialog"]}));return}t.initFacebookPages().pipe((0,u.concatMap)(n=>(0,u.from)(n)),(0,u.concatMap)(n=>t._facebookApiProvider.attachPage(n.token).pipe((0,u.concatMap)(()=>{const s=t._getChannel(n);return t._maskService.showBodyMask(),t._facebookRegistrationService.registerFacebookChannel(n.token,n.id).pipe((0,u.concatMap)(r=>r?.success?(s.msgSettingsId=r.SettingsId,s.id=(0,A.qv)(),s.isActive=!0,(0,u.from)(t._channelService.insertItem(s)).pipe((0,u.concatMap)(()=>t._openChannelEditingPage(e,n.id,n.name,s.id)))):(t._messageDialogProvider.open({data:{message:r?.errorInfo?.message||"An unknown error occurred during the operation.",actions:[Wi.OK]}}),u.EMPTY)))})))).subscribe(()=>{console.log("FB channel connected")},null,()=>{(0,u.from)(t._reloadChannelsList(e)),t._maskService.hideBodyMask()})})()}_reloadChannelsList(e){return(0,S.A)(function*(){const{$context:t,scopes:n}=e,s=e.$context.models.find(o=>o.dataSource.initialConfig.entitySchemaName==="Channel"),r={type:"crt.LoadDataRequest",scopes:n,config:{loadType:ve.Reload},$context:t,dataSourceName:s.dataSource.dataSourceName};yield Ae.instance.process(r)})()}_openChannelEditingPage(e,t,n,s){return(0,S.A)(function*(){const r=e.$context;yield r.executeRequest({type:"crt.OpenPageRequest",schemaName:"FBMessengerChannel_EditPage",modelInitConfigs:[{recordId:s,action:Gi.Edit}],$context:r})})()}initFacebookPages(){return this._facebookApiProvider.initApi().pipe((0,u.concatMap)(()=>this._facebookApiProvider.login()),(0,u.concatMap)(()=>this._facebookApiProvider.getPages()))}handle(e){var t=this;return(0,S.A)(function*(){if(!t._isCreateFacebookChannelRequest(e))return t.next?.handle(e);yield t._addFacebookMessengerChannels(e)})()}};Fh=(0,p.__decorate)([Ke({requestType:"crt.CreateRecordRequest",type:"crt.FacebookChannelCreateRecordHandler",scopes:["ChatSettingsPage"]}),(0,p.__metadata)("design:paramtypes",[Na,$i,ac,Zn,zb,ic])],Fh);var ln;(function(a){a.Entity="entity",a.Schema="schema",a.Module="module"})(ln||(ln={}));var Bt;(function(a){a.Push="push",a.Replace="replace"})(Bt||(Bt={}));var Bh;(function(a){a.Blank="_blank",a.Self="_self"})(Bh||(Bh={}));var An;(function(a){a.Auto="auto",a.PreferFreedomUI="freedom-ui"})(An||(An={}));var Uh;(function(a){a.Dashboard="Dashboard",a.Page="Page",a.Desktop="Desktop",a.MiniPage="MiniPage",a.Sidebar="Sidebar",a.DashboardPage="DashboardPage",a.MobilePage="MobilePage"})(Uh||(Uh={}));var Hh=m(23710);class Rg{static initialize(){Hh.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),Hh.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(e,t="",n="_"){const s=new RegExp(`^${t}`);return t+e.replace(s,"")+n+Hh.generate()}}Rg.initialize();class ai{static getSchemaRequire(e){return new Promise(t=>{Terrasoft.require([e],n=>t(n))})}static isSchemaInheritedFrom(e,t){var n=this;return(0,S.A)(function*(){let s=Terrasoft.configuration.Structures[t];s||(yield n.getSchemaRequire(t),s=Terrasoft.configuration.Structures[t]);const r=s?.structureParent;return r?r===e||n.isSchemaInheritedFrom(e,r):!1})()}}class F{static{this._angularSchemaType=9}static get angularSchemaType(){return F._angularSchemaType}static{this._angularModules=["PageSchemaViewModule","CardSchemaViewModule","HomePage","Desktop","SectionSchemaViewModule"]}static _getTypeColumnName(e,t){return F.getEntityStructure(e,t??An.Auto)?.pages.find(r=>r.typeColumnName)?.typeColumnName}static _getTypeColumnValue(e){return(0,S.A)(function*(){const{entityName:t,typeColumnValue:n}=e;if(n)return n;const s=F._getTypeColumnName(t,e.uiTypePriority),r=F.getRecordLookupValue(e.recordId);return!s||!r?null:(yield(yield _t.create(t)).load({attributes:[s],parameters:[{type:ne.Filter,value:new bt(ee.Equal,new pe({columnPath:"Id"}),new fe({value:r}))}]}))?.[0]?.[s]?.value})()}static _getModuleStructureBySectionSchema(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(t=>t.sectionSchema===e)}static _getSectionModuleName(e){return F._getModuleStructureBySectionSchema(e)?.sectionModule}static _getSectionEditPageModuleName(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(n=>n.cardSchema===e||n.pages?.some(s=>s.cardSchema===e))?.cardModule}static _getModuleName(e){return(0,S.A)(function*(){const t=F._getSectionModuleName(e)??F._getSectionEditPageModuleName(e);if(t)return t;if(yield ai.isSchemaInheritedFrom("BasePageV2",e))return"CardModuleV2";switch(!0){case(yield ai.isSchemaInheritedFrom("BaseHomePage",e)):return"HomePage";case(yield ai.isSchemaInheritedFrom("BaseIntroPageSchema",e)):return"IntroPage";case(yield ai.isSchemaInheritedFrom("BaseSectionV2",e)):return"SectionModuleV2";default:return"PageSchemaViewModule"}})()}static _getTypedPage(e,t){if(!t||t.length<=1)return;if(e.entityPageName){const s=t.find(r=>r.cardSchema===e.entityPageName);if(s)return s}let n=e.typeColumnValue;if(!n&&e.entityName){const r=F.getEntityStructure(e.entityName,e.uiTypePriority)?.attribute;if(r){const o=e.defaultValues?.find(l=>l.attributeName===r);n=o?.value?.value||o?.value}}if(n)return t.find(s=>s.UId===n)}static _getDefaultPages(e){return e?.filter(t=>F._isDefaultPage(t))}static _getNotTypedAddPage(e){return e?.find(t=>F._isAddPage(t)&&!t.UId)}static _getTypedAddPage(e){return e?.find(t=>F._isAddPage(t)&&t.UId)}static _getTypedDefaultPage(e){return e?.find(t=>F._isDefaultPage(t)&&t.UId)}static _getNotTypedDefaultPage(e){return e?.find(t=>F._isDefaultPage(t)&&!t.UId)}static _isDefaultPage(e){return e.isDefault||!e.actions}static _isAddPage(e){return e.actions?.add}static _getDefaultPage(e){const t=F.getEntityStructure(e.entityName,e.uiTypePriority);if(!t)return;const n=F._getDefaultPages(t.pages),r=F._getTypedPage(e,n)||F._getNotTypedDefaultPage(n);return!r&&t.pages?.length?(console.warn("Default page not found and random page is given instead. Please, check passed options."),t.pages[0]):r}static _getAddPage(e){const n=F.getEntityStructure(e.entityName,e.uiTypePriority)?.pages,s=F.getPagesForAddAction(n);if(s?.length<=1)return s?.[0];const r=F._getTypedPage(e,s);if(r)return r;const o=F._getNotTypedAddPage(n),l=F._getNotTypedDefaultPage(n);let d=o||l;return d||(console.warn("Add or default page not found and random page is given instead. Please, check options."),console.warn(e),d=n?.[0]),d}static _getEditPage(e){return F._getDefaultPage(e)}static _getGroupedTypedPages(e){const t={};for(const n of e){const{UId:s}=n;s&&(t[s]=t[s]??[],t[s].push(n))}return t}static _getModuleConfig(e){return Object.values(Terrasoft.configuration.ModuleStructure).find(t=>t.cardSchema===e||t.sectionSchema===e||t.pages?.some(n=>n.cardSchema===e))}static getPagesForAddAction(e){if((0,T.isEmpty)(e))return[];const t=F._getGroupedTypedPages(e),n=F._getNotTypedAddPage(e),s=F._getNotTypedDefaultPage(e),r=Object.values(t).map(l=>{const d=F._getTypedAddPage(l);if(d)return d;const h=F._getTypedDefaultPage(l);return h&&n?{...n,...(0,T.pick)(h,["caption","captionLcz","UId"])}:n||h||s});if(!(0,T.isEmpty)(r))return r;const o=n||s;return o?[o]:[]}static getCardSchemaName(e){return e?.cardSchema??e?.cardSchemaName}static getEntityStructure(e,t=An.Auto){if(!e)return;let n;return t===An.PreferFreedomUI&&(n=Object.values(Terrasoft.configuration.EntityStructure).find(s=>s.page8X&&s.entitySchemaName===e)),n??Terrasoft.ModuleUtils.getEntityStructureByName(e)}static getRecordLookupValue(e){return typeof e=="string"?e:e?.value}static getPageForActionAsync(e){return(0,S.A)(function*(){const t=yield F._getTypeColumnValue(e),n={...e,typeColumnValue:t};return F.getPageForAction(n)})()}static getPageForAction(e){let t;return e.action===Gi.Add?t=F._getAddPage(e):t=F._getEditPage(e),t||(t=F._getDefaultPage(e)),t}static getPageSchemaNameForAction(e){return(0,S.A)(function*(){if(e.entityPageName)return e.entityPageName;const t=yield F.getPageForActionAsync(e);return F.getCardSchemaName(t)})()}static isAngularSchema(e){return(0,S.A)(function*(){return yield ai.getSchemaRequire(e),(yield ai.getSchemaRequire(e+"Structure")).type===F._angularSchemaType})()}static generateChainModuleId(e){return Rg.generateUnique(e+"_chain")}static getValuePairs(e){return e&&e.map(t=>{let n,s;const r=t.value;return r?.value?(s=r.value,n=r.displayValue):s=r,{name:t.attributeName,value:s,displayValue:n}})}static getModuleName(e,t){return(0,S.A)(function*(){if(!e&&!t)throw new Pc("schemaName");return e&&!t&&(t=yield F._getModuleName(e)),t})()}static getEditPageModuleName(e,t=An.Auto){return F.getEntityStructure(e,t)?.cardModuleName}static hasEntityEditPage(e){return(0,S.A)(function*(){return!!(yield F.getPageForActionAsync(e))})()}static isSectionEditPage(e){return!!F._getSectionEditPageModuleName(e)}static isAngularListPage(e){return(0,S.A)(function*(){return(yield F.isAngularSchema(e))?ai.isSchemaInheritedFrom("BaseGridSectionTemplate",e):!1})()}static isAngularRouting(e){return F._angularModules.includes(e)}static getSectionEntityName(e){return F._getModuleStructureBySectionSchema(e)?.entitySchemaName}static getPageEntitySchemaName(e){const t=this._getModuleConfig(e);return t?.entitySchemaName?t.entitySchemaName:Object.values(Terrasoft.configuration.EntityStructure).find(s=>s.pages?.some(r=>r.cardSchema===e))?.entitySchemaName}static getEntityPageStructure(e){return Object.values(Terrasoft.configuration.EntityStructure).find(n=>n.pages.find(s=>s.cardSchema===e))?.pages?.find(n=>n.cardSchema===e)}static isMiniPage(e){const t=F.getEntityPageStructure(e);if(t){const n=t.schemaGroup===Uh.MiniPage;return Promise.resolve(n)}return ai.isSchemaInheritedFrom("BaseMiniPageTemplate",e)}static getSysModuleId(e){return(F._getModuleConfig(e)||Object.values(Terrasoft.configuration.ModuleStructure).find(n=>n.sectionModule===e))?.moduleId}static getEntityPageUITypePriority(e,t){return(0,S.A)(function*(){return t&&(yield F.isAngularListPage(t))&&F.getSectionEntityName(t)===e?An.PreferFreedomUI:An.Auto})()}}class ri{static{this._moduleAliases={CardSchemaViewModule:"Card",PageSchemaViewModule:"Page",SectionSchemaViewModule:"Section"}}static getModuleNameByAlias(e){const t=this._moduleAliases;return Object.keys(t).find(n=>t[n]===e)}static replaceModuleNameByAlias(e){const t=e.split("/");return t[0]=this._moduleAliases[t[0]]||t[0],t.join("/")}static{this.\u0275fac=function(t){return new(t||ri)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ri,factory:ri.\u0275fac,providedIn:"root"})}}const Fb="\\[(.+)\\]";class Gl{static _parseChildRoutes(e,t){const n=[],s=e.match(Fb);if(s?.length>0){const r=s[1],[o,l]=this._getChildRoutesIndexes(r),d=o>=0&&l>0;let h=r,f;d&&(f=r.substring(o,l+1),h=r.replace(f,"")),h.split(",").forEach((I,O)=>{const B=this._getChildSegmentByPath(I);if(B.contextName=`${t}_${B.target}${O}`,d){const J=r.indexOf(I);r.at(J+I.length)==="["&&(B.children=this._parseChildRoutes(f,B.contextName))}n.push(B)})}return n}static _getChildRoutesIndexes(e){const t=[],n=[],s=[];for(let r=0;r<e.length;r++){const o=e.charAt(r);if(o==="[")t.push(r);else if(o==="]"){const l=t.pop();n.push(l),s.push(r)}}return[n.at(-1),s.at(-1)]}static _getRootSegmentByPath(e){if(!e)return{recordId:void 0,contextName:"root",action:void 0,schemaName:void 0,moduleName:void 0};const t=e.split("/");let n,s,r,o;return t.length===5&&t[0]==="SectionModuleV2"?[n,,s,r,o]=t:[n,s,r,o]=t,{moduleName:ri.getModuleNameByAlias(n)||n,schemaName:s,action:r,recordId:o,contextName:"root"}}static _getChildSegmentByPath(e){const t=e.split("=");let n,s;t[1]?(s=t[0],n=t[1]):n=t[0];const[r,o,l]=n.split("/");return{schemaName:r,action:o,recordId:l,target:s}}static parse(e){const n=new URL(e).hash.split("#")[1];return Gl.parseLocation(n)}static parseLocation(e){const t=e?.indexOf("[");let n,s="";t>=0?(n=e.substring(0,t),s=e.substring(t)):n=e;const r=this._getRootSegmentByPath(n);let o=[];return s&&(o=this._parseChildRoutes(s,r.contextName)),{root:r,children:o}}static getQueryParams(e){const t=e.lastIndexOf("?"),n={};return t<0||e.substring(t+1).split("&").forEach(r=>{const o=r.split("=");n[o[0]]=o[1]}),n}}class On extends Ot.S{constructor(e){super(),this.window=e,this.state$=new u.Subject,this._indexHistoryStates()}_indexHistoryStates(){const e=()=>{const t=this.getState();if(!t||!("historyIndex"in t)){let n;this.previousState?n=this.previousState?.historyIndex+1:n=this.window.history.length-1;const s={...t,historyIndex:n};this.window.history.replaceState(s,"indexState")}};e(),this.window.addEventListener("popstate",e,!0),this._popstateSubscription=new u.Subscription(()=>this.window.removeEventListener("popstate",e))}replaceAliasWithModuleName(e){const t=e.split("/");return t[0]=ri.getModuleNameByAlias(t[0])||t[0],t.join("/")}onPopState(e){}prepareExternalUrl(e){}getBaseHref(){return`${this.window.Terrasoft.workspaceBaseUrl}/Shell`}getRoute(e){const n={...Gl.parse(this.window.location.href),state:e};return this._applyChildStateToChildSegment(n.children,e.children),n}_applyChildStateToChildSegment(e,t){!e||!t||e.forEach((n,s)=>{const r=t[s];n.parameters=r.parameters,n.defaultValues=r.modelInitConfigs?.[0]?.defaultValues,n.children&&this._applyChildStateToChildSegment(n.children,r.children)})}ngOnDestroy(){this._popstateSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||On)(i.\u0275\u0275inject(P.ZP))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:On,factory:On.\u0275fac,providedIn:"root"})}}const Lg=new i.InjectionToken("ShellModuleAliasesFactory");function Vg(a,e){return a?.moduleName===e?.moduleName&&a?.schemaName===e?.schemaName&&a?.action===e?.action&&a?.recordId===e?.recordId&&a?.contextName===e?.contextName}function zg(a,e){if(!(a?.length===e?.length))return!1;for(let n=0;n<a?.length;n++){const s=Vg(a[n],e[n]),r=zg(a[n].children,e[n].children),o=a[n].target===e[n].target;if(!(s&&r?o:!1))return!1}return!0}function Fg(a,e,t,n){let s=[];return(0,T.isEmpty)(t)||t.forEach(r=>{const o=n===a,l=r.target===e;if(o&&l)s.push(r);else{const h=Fg(a,e,r?.children,r.contextName);s=[...s,...h]}}),s}function Bg(a){const e=(0,T.omit)(a,"historyIndex","children","navigationId");return e.modelInitConfigs=e.modelInitConfigs?.map(t=>(0,T.omit)(t,"name")),e}function Bb(a,e){return(0,T.isEqual)(Bg(a),Bg(e))}function Yh(a){const e=a.children||[];return(0,T.isEmpty)(e)?a:Yh(e[0])}const Ub="ChainModuleStub",zv="navigation",Fv="ExecutionZones",Bv={Modal:"modal"},Ea={ClassicUI:"7x",FreedomUI:"8x"};var nt;(function(a){a.Back="back",a.Forward="forward",a.ExecuteTransition="executeTransition",a.Go="go"})(nt||(nt={}));class Da{static{this._backEvent={type:nt.Back}}_addToBucket(e,t){let n=e[t.type];n||(n=[],e[t.type]=n),n.push(t)}_eventBucketsReducer(e,t){return t.type===nt.Go&&t.delta===-1?this._addToBucket(e,Da._backEvent):this._addToBucket(e,t),e}_prepareForwardEvents(e,t){let n=[];const s=[];for(const r of e)(r.config.mode===Bt.Push?s:n).push(r);return n.length===0&&t&&s.length>0&&(s[0].config.mode=Bt.Replace),n.length>0&&(n=[n[n.length-1]]),[...n,...s]}normalize(e){const t=e.reduce(this._eventBucketsReducer.bind(this),{}),n=t[nt.Go],s=t[nt.Forward];if(n||s)return[...n||[],...s||[]];const r=t[nt.Back],o=t[nt.ExecuteTransition];return r&&!o?[r[0]]:this._prepareForwardEvents(o,!!r)}static{this.\u0275fac=function(t){return new(t||Da)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Da,factory:Da.\u0275fac,providedIn:"root"})}}const Hb="navigation";class rc{constructor(e,t,n,s){this._zoneService=e,this._normalizer=t,this._logger=n,this._applicationInfo=s,this._queue=[],this._state=Wn.Idle,this.navigationEventsReady$=new i.EventEmitter(!1);const r=e.register(Hb,_l.ExecutionTracking);this._stateChangeSubscription=r.onStateChange$.subscribe(this._onStateChange.bind(this))}_onStateChange(e){this._state!==e&&(this._state=e,e===Wn.Idle&&this._execQueue())}_execQueue(){if(!this._queue.length||this._state===Wn.Busy)return;const e=this._normalizer.normalize(this._queue);this._applicationInfo.isDebugEnabled&&this._logger.log(`Executing ${this._queue.length} events as ${e.length}`,this._queue,{sourceEvents:this._queue,normalizedEvents:e}),this._queue=[],this.navigationEventsReady$.next(e)}_push(e){this._queue.push(e),this._execQueue()}pushTransition(e){this._push({type:nt.ExecuteTransition,config:e})}push(e,t){this._push({type:e,delta:t})}ngOnDestroy(){this._stateChangeSubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||rc)(i.\u0275\u0275inject(Cl),i.\u0275\u0275inject(Da),i.\u0275\u0275inject(P.gP),i.\u0275\u0275inject(dt))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:rc,factory:rc.\u0275fac,providedIn:"root"})}}class Aa{constructor(e,t,n,s){this._locationStrategy=e,this._navigationQueue=t,this._moduleAliasesFeatureFactory=n,this._featureValues=s,this._handlerChain=Ae.instance,this._onNavigationEventsReadySubscription=this._navigationQueue.navigationEventsReady$.pipe((0,u.switchMap)(r=>this._handleNavigationEvents(r))).subscribe(),this._moduleAliasesFeatureFactory().then(r=>this._moduleAliasesFeatureEnabled=r)}_handleNavigationBack(){if(this._featureValues.EnableNavigationToDesktopBeforeQuit&&!this._locationStrategy.previousState){this._locationStrategy.pushState({moduleName:"Desktop"},"","Desktop");return}this._locationStrategy.back()}_handleNavigationEvent(e){switch(e.type){case nt.Back:this._handleNavigationBack();break;case nt.Forward:this._locationStrategy.forward();break;case nt.Go:this._locationStrategy.go(e.delta);break}}_handleNavigationEvents(e){var t=this;return(0,S.A)(function*(){const n=e.length-1;for(let s=0;s<e.length;s++){const r=e[s];if(r.type===nt.ExecuteTransition){const o=s<n;yield t._executeTransition(r.config,o)}else t._handleNavigationEvent(r)}})()}_changeHistoryStateUsing8xRouting({mode:e,state:t,pageTitle:n,location:s}){if(n=n??"",e===Bt.Replace)return this.replaceState(t,n,s);if(e===Bt.Push)return this.pushState(t,n,s)}_changeHistoryStateUsing7xRouting(e,t){var n=this;return(0,S.A)(function*({mode:s,state:r,location:o},l){const d=s===Bt.Replace?"ReplaceHistoryState":"PushHistoryState";yield n._handlerChain.process({type:"crt.7XRequest",$context:null,action:d,hash:o,stateObj:r,silent:r?.silent??l})}).apply(this,arguments)}_changeHistoryState(e,t,n){var s=this;return(0,S.A)(function*(){t?s._changeHistoryStateUsing8xRouting(e):yield s._changeHistoryStateUsing7xRouting(e,n)})()}_load7xModule(e){var t=this;return(0,S.A)(function*({state:n,moduleConfig:s}){const r=n.initConfig,l=F.isAngularRouting(n.moduleName)?Ub:n.moduleName,d={renderTo:"centerPanel",id:s?.moduleId??n?.moduleId,keepAlive:s?.keepAlive??!0,instanceConfig:r,replaceLastModuleInChain:n.replaceLastModuleInChain};yield t._handlerChain.process({type:"crt.7XRequest",$context:null,action:"LoadModule",moduleName:l,moduleParams:d})}).apply(this,arguments)}_executeTransition(e,t){var n=this;return(0,S.A)(function*(){const s=e.state,r=s.children?.length>0,o=F.isAngularRouting(s.moduleName)||r,l=!!s.isInChain;t&&(s.silent=!0,s.moduleId=e.moduleConfig?.moduleId??s?.moduleId),yield n._changeHistoryState(e,o,l),!t&&l&&!r&&(yield n._load7xModule(e))})()}_getProcessedHash(e){return this._moduleAliasesFeatureEnabled?ri.replaceModuleNameByAlias(e):e}executeTransition(e){this._navigationQueue.pushTransition(e)}pushState(e,t,n){const s=this._getProcessedHash(n);this._locationStrategy.pushState(e,t,s)}replaceState(e,t,n){const s=this._getProcessedHash(n);this._locationStrategy.replaceState(e,t,s)}go(e){this._navigationQueue.push(nt.Go,e)}back(){this._navigationQueue.push(nt.Back)}forward(){this._navigationQueue.push(nt.Forward)}ngOnDestroy(){this._onNavigationEventsReadySubscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||Aa)(i.\u0275\u0275inject(On),i.\u0275\u0275inject(rc),i.\u0275\u0275inject(Lg),i.\u0275\u0275inject(oe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Aa,factory:Aa.\u0275fac,providedIn:"root"})}}const Yb=new i.InjectionToken("Navigation guard");class Zh extends qa{constructor(){super(...arguments),this.requestType="crt.RightsService"}}(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],Zh.prototype,"getCanExecuteOperation",void 0),(0,p.__decorate)([It(),(0,p.__metadata)("design:type",Function)],Zh.prototype,"getCanExecuteOperations",void 0);class oc{constructor(e,t,n){this._rightsService=e,this._featureService=t,this._navigationGuards=n}_getNavigationOptionType(e){const t=e.operationType||"",s=new URLSearchParams(t.replace("?","")).get("type");return Object.values(ln).find(r=>r.toLowerCase()===s?.toLowerCase())}_getIsNeedRedirectByNavigationModule(e){var t=this;return(0,S.A)(function*(){return!(yield t._featureService.getFeatureState("DisableProcessCrtNavigationModuleLink"))&&e==="CrtNavigation"})()}_redirectByPathInfo(e){var t=this;return(0,S.A)(function*(){const n=e.schemaName;if(!n)return Promise.resolve(!1);const s=t._getNavigationOptionType(e);if(!s||s===ln.Entity)return Promise.resolve(!1);const r=yield t._getNewTransitionConfig(s,n);return F.isAngularRouting(r.state.moduleName)?Promise.resolve(r):Promise.resolve(!0)})()}_getNewTransitionConfig(e,t){return(0,S.A)(function*(){const n={state:{},path:""};if(e===ln.Module)n.state.moduleName=t,n.path=t;else if(e===ln.Schema){const s=yield F.getModuleName(t);n.state.moduleName=s,n.state.schemaName=t,n.path=`${s}/${t}`}return n})()}canActivate(e){var t=this;return(0,S.A)(function*(){if(yield t._getIsNeedRedirectByNavigationModule(e.moduleName))return t._redirectByPathInfo(e);if(!(yield t._featureService.getFeatureState("EnablePageOpeningRestrictions"))||(yield t._rightsService.getCanExecuteOperation("CanBypassPageOpeningRestrictions")))return Promise.resolve(!0);for(const r of t._navigationGuards){const o=yield r.canActivate(e);if(o!==!0)return Promise.resolve(o)}return Promise.resolve(!0)})()}static{this.\u0275fac=function(t){return new(t||oc)(i.\u0275\u0275inject(Zh),i.\u0275\u0275inject(Rn),i.\u0275\u0275inject(Yb))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:oc,factory:oc.\u0275fac,providedIn:"root"})}}class Oa{constructor(e,t,n,s,r){var o=this;this._location=e,this._moduleAliasesFeatureFactory=t,this._historyService=n,this._navigationGuardsService=s,this._featureValues=r,this._popState$=(0,u.fromEvent)(window,"popstate"),this._navigateStart$=new u.Subject,this._navigateEnd$=new u.Subject,this._prevRoute={},this._currentRoute={},this.navigateStart$=this._navigateStart$.asObservable(),this.navigateEnd$=this._navigateEnd$.asObservable(),this.historyState$=(0,u.merge)((0,u.of)(this._location.getState()),this._location.state$.pipe((0,c.mergeMap)(()=>(0,u.of)(this._location.getState()))),this._popState$.pipe((0,c.mergeMap)(()=>(0,u.of)(this._location.getState())))).pipe((0,c.switchMap)(function(){var l=(0,S.A)(function*(d){const h=yield o._navigationGuardsService.canActivate(o.getActiveRouteInfo());let f=d;if(h===!1)throw new Error("Navigation prevented.");if(h!==void 0&&typeof h!="boolean"){const I=o._location.path();o._featureValues.DisableShellDelayedReplaceState?o._historyService.replaceState(h.state,h.title||"",h.path||I):yield o._delayedReplaceState(h.state,h.title||"",h.path||I),f=h.state}return f});return function(d){return l.apply(this,arguments)}}()),(0,c.tap)(l=>{if(this._moduleAliasesFeatureEnabled){const d=this._location.path();this._shouldReplaceModuleNameByAlias(d)&&this._historyService.replaceState(l,"",d)}}),(0,c.share)()),this.location$=(0,u.merge)((0,u.of)(new URL(window.location.href)),this._location.state$.pipe((0,c.mergeMap)(()=>(0,u.of)(new URL(window.location.href)))),this._popState$.pipe((0,c.mergeMap)(()=>(0,u.of)(new URL(window.location.href))))),this.crtRoute$=this.historyState$.pipe((0,u.map)(l=>this._location.getRoute(l)),(0,c.tap)(l=>{this._prevRoute=this._currentRoute,this._currentRoute=l}),(0,u.filter)(l=>!(0,T.isEqual)(this._prevRoute,l)),(0,u.shareReplay)({bufferSize:1,refCount:!1})),this._moduleAliasesFeatureFactory().then(l=>this._moduleAliasesFeatureEnabled=l)}_delayedReplaceState(e,t,n){var s=this;return(0,S.A)(function*(){yield new Promise(r=>{setTimeout(()=>{s._historyService.replaceState(e,t,n),r()},0)})})()}_shouldReplaceModuleNameByAlias(e){return ri.replaceModuleNameByAlias(e)!==e}_filterChildrenRoute(e,t){const n=!Vg(e,this._prevRoute.root),s=!Bb(t,this._prevRoute.state);return n||s}onNavigateStart(){this._navigateStart$.next()}onNavigateEnd(){this._navigateEnd$.next()}getNavigation$(e){return this.crtRoute$.pipe((0,u.filter)(t=>{if(e)throw new Error("Not implemented yet");return!(0,T.isEmpty)(t.state?.children)||!(0,T.isEmpty)(this._prevRoute.state?.children)?this._filterChildrenRoute(t.root,t.state):!0}))}getChildNavigation$(e,t){return this.crtRoute$.pipe((0,u.filter)(n=>!zg(n.children,this._prevRoute.children)),(0,u.map)(n=>Fg(e,t,n.children,n.root.contextName)))}getActiveRouteInfo(){const e=this._location.getActivePathInfo(),t=this._location.getState(),n={moduleName:t&&t.moduleName||e.moduleName,schemaName:t&&t.schemaName||e.schemaName,operationType:e.operationType||t.operation,recordId:e.recordId};return t&&t.isInChain&&(n.isInChain=!0),n}static{this.\u0275fac=function(t){return new(t||Oa)(i.\u0275\u0275inject(On),i.\u0275\u0275inject(Lg),i.\u0275\u0275inject(Aa),i.\u0275\u0275inject(oc),i.\u0275\u0275inject(oe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Oa,factory:Oa.\u0275fac,providedIn:"root"})}}class cc{constructor(e,t,n,s){this._window=e,this._locationStrategy=t,this._router=n,this._featureValues=s,this._destroyed$=new u.Subject,this._refreshCacheHash$=this._observeRefreshCacheHash(),this._historyStateChanged$=this._observe8xHistoryStateChanged()}_sendRefreshCacheHashRequestIfNeeded(){var e=this;return(0,S.A)(function*(){(e._featureValues.DisableRefreshCacheHash8xFilter||(yield e._is8xNavigation()))&&(yield Ae.instance.process({type:"crt.7XRequest",action:"RefreshCacheHash",$context:null}))})()}_observeRefreshCacheHash(){return this._router.navigateEnd$.pipe((0,c.tap)(()=>this._sendRefreshCacheHashRequestIfNeeded().catch(console.error)),(0,u.takeUntil)(this._destroyed$))}_send8xHistoryStateChangedRequestIfNeeded(e){var t=this;return(0,S.A)(function*(){(yield t._isHistoryStateChanged(e))&&(yield Ae.instance.process({type:"crt.7XRequest",action:"8xHistoryStateChanged",$context:null,back:t._isBack(e)}))})()}_observe8xHistoryStateChanged(){return(0,u.fromEvent)(this._window,"popstate").pipe((0,c.tap)(({state:e})=>this._send8xHistoryStateChangedRequestIfNeeded(e).catch(console.error)),(0,u.map)(()=>{}),(0,u.takeUntil)(this._destroyed$))}_is8xNavigation(){var e=this;return(0,S.A)(function*(){const t=e._locationStrategy.getState();if(t?.schemaName)return yield F.isAngularSchema(t.schemaName);const n=e._getActivePathInfo();if(n.schemaName)return yield F.isAngularSchema(n.schemaName);const s=t?.moduleName??n.moduleName;return F.isAngularRouting(s)})()}_getActivePathInfo(){return this._locationStrategy.getActivePathInfo()}_isHistoryStateChanged(e){var t=this;return(0,S.A)(function*(){const n=t._getActivePathInfo(),s=e?.schemaName??n.schemaName;if(!(s&&!(yield F.isAngularSchema(s)))){const h=e?.moduleName??n.moduleName;if(!(h&&!s&&!F.isAngularRouting(h))&&!e?.isInChain)return!1}const l=t._locationStrategy.previousState?.moduleId===e?.moduleId;return!t._wasChildrenRouting()||!l})()}_wasChildrenRouting(){return this._locationStrategy.previousState?.children?.length>0}_isBack(e){return e?.historyIndex<this._locationStrategy.previousState?.historyIndex}init(){this._refreshCacheHash$.subscribe(),this._historyStateChanged$.subscribe()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||cc)(i.\u0275\u0275inject(P.ZP),i.\u0275\u0275inject(On),i.\u0275\u0275inject(Oa),i.\u0275\u0275inject(oe))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:cc,factory:cc.\u0275fac,providedIn:"root"})}}const Wh=new i.InjectionToken("CHILD_HISTORY_STATE_BUILDERS"),Ug=new i.InjectionToken("ENTITY_CHILD_HISTORY_STATE_BUILDERS",{factory:()=>{const a=(0,i.inject)(Wh,{optional:!0})||[],e=(0,i.inject)(Ug)||[];return a.concat(e)}}),Hg=new i.InjectionToken("SCHEMA_CHILD_HISTORY_STATE_BUILDERS",{factory:()=>{const a=(0,i.inject)(Wh,{optional:!0})||[],e=(0,i.inject)(Hg)||[];return a.concat(e)}});class Zb{static _applyRecordId(e,t,n){return e&&e!==Gi.Add?t+"/"+n:t}static _getLocationByUrlSegment(e){const t=[e.moduleName,e.schemaName,e.action].filter(n=>n&&n!=="undefined").join("/");return this._applyRecordId(e.action,t,e.recordId)}static _getPrevRootLocation(e){const t=Gl.parseLocation(e);return this._getLocationByUrlSegment(t.root)}static _getRootLocationSegment(e){return{schemaName:e.schemaName,moduleName:e.moduleName,action:e.modelInitConfigs?.[0]?.action,recordId:e.modelInitConfigs?.[0]?.recordId}}static _getRootLocation(e,t){let n;const s=this._getChildrenState(t),{prevLocation:r,isInChain:o}=e;if(r&&(o||!(0,T.isEmpty)(s)))n=this._getPrevRootLocation(r);else{const l=this._getRootLocationSegment(e);n=this._getLocationByUrlSegment(l)}return n}static _getChildrenState(e){return e.children||[]}static _getChildLocationSegment(e){return{schemaName:e.schemaName,action:e.modelInitConfigs?.[0]?.action,recordId:e.modelInitConfigs?.[0]?.recordId}}static _getChildrenLocation(e){let t="";if((0,T.isEmpty)(e))return t;const n=[...e].sort((r,o)=>r.target.localeCompare(o.target));let s="";return n.forEach(r=>{s===r.target?t+=",":(t+=`${r.target}=`,s=r.target);const o=this._getChildLocationSegment(r);t+=this._getLocationByUrlSegment(o);const l=this._getChildrenLocation(r.children);t=t.concat(`${l}`)}),`[${t}]`}static getLocationByState(e,t){const n=this._getRootLocation(e,t),s=this._getChildrenState(t),r=this._getChildrenLocation(s);return n+r}}class Ji{constructor(e){this.injector=e,this.locationStrategy=e.get(On),this._childHistoryStateBuilders=this.getChildHistoryStateBuilders()||[]}_getChildHistoryStates(e){return Promise.all(this._childHistoryStateBuilders.map(t=>t.getState(e)))}_getPrevChildHistoryStates(e){return e}_getState(e,t){var n=this;return(0,S.A)(function*(){let s=yield n._getChildHistoryStates(t);s=s.filter(d=>!(0,T.isEmpty)(d));let r;(0,T.isEmpty)(s)?r=n.getRootState(e,t):r=yield n._applyChildrenHistoryStates(e,s);const o=n._getPrevChildHistoryStates(e.prevState);return!(0,T.isEmpty)(o?.children)&&(0,T.isEmpty)(s)&&(r.keepAlive=!0),r})()}_applyChildrenHistoryStates(e,t){const n=(0,T.cloneDeep)(e.prevState)??{},s=Yh(n);return this._setChildrenState(s,t),n}_setChildrenState(e,t){e.children=t}_getLocation(e,t){return Zb.getLocationByState(e,t)}_getSchemaUIType(e){return(0,S.A)(function*(){if(e.schemaName)return(yield F.isAngularSchema(e.schemaName))?Ea.FreedomUI:Ea.ClassicUI})()}getChildHistoryStateBuilders(){return(0,i.inject)(Wh,{optional:!0})}getModelInitConfigs(e){return[]}getSchemaName(e,t){return Promise.resolve("")}getStateModuleId(e){return""}getModuleName(e,t){const n=e.schemaUIType===Ea.ClassicUI?t.state?.moduleName:"";return Promise.resolve(n)}getRootState(e,t){const n={...(0,T.cloneDeep)(t?.state??{})};if(n.isInChain=e.isInChain,n.moduleName=e.moduleName,e.isInChain||(n.moduleId=this.getStateModuleId(e)),e.schemaUIType===Ea.ClassicUI){const s=e.modelInitConfigs?.[0];n.operation=s?.action,n.primaryColumnValue=s?.recordId,n.valuePairs=F.getValuePairs(s?.defaultValues),n.isSeparateMode=!0,n.isInChain&&(n.schemaName=e?.schemaName)}else n.schemaName=e.schemaName,n.modelInitConfigs=e.modelInitConfigs;return n}getModuleConfig({isInChain:e,moduleName:t,prevState:n}){return e?{moduleId:(n?.moduleId??"")+F.generateChainModuleId(t)}:null}getCommonTransitionInfo(e){var t=this;return(0,S.A)(function*(){const n=t.locationStrategy.getState(),s={};return s.schemaName=yield t.getSchemaName(s,e),s.schemaUIType=yield t._getSchemaUIType(s),s.navigationState=e.state,s.isInChain=s.navigationState?.isInChain??n?.isInChain,s.modelInitConfigs=t.getModelInitConfigs(e),s.prevState=n,s.prevLocation=t.locationStrategy.path(),s.moduleName=yield t.getModuleName(s,e),s})()}getTransitionConfig(e){var t=this;return(0,S.A)(function*(){const n=yield t.getCommonTransitionInfo(e);if(!n)return null;const s=yield t._getState(n,e),r=t._getLocation(n,s),o=t.getModuleConfig(n);return{mode:e.mode,location:r,state:s,pageTitle:"",moduleConfig:o}})()}buildUrlWithoutState(e){var t=this;return(0,S.A)(function*(){const n=yield t.getCommonTransitionInfo(e),s=t._getLocation(n,{});return t.locationStrategy.getRelativePath(s)})()}static{this.\u0275fac=function(t){return new(t||Ji)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ji,factory:Ji.\u0275fac})}}class Pa extends Ji{getChildHistoryStateBuilders(){return(0,i.inject)(Ug)}getSchemaName(e,t){return(0,S.A)(function*(){const n=yield F.getPageForActionAsync(t.options);return e.page=n,F.getCardSchemaName(n)||t.options.entityPageName})()}getModuleName(e,t){var n=()=>super.getModuleName,s=this;return(0,S.A)(function*(){const r=yield n().call(s,e,t);if(r)return r;const o=e.page?.cardModuleName;if(o)return o;const{uiTypePriority:l,entityName:d}=t.options;return F.getEditPageModuleName(d,l)||e.schemaName&&F.getModuleName(e.schemaName)})()}getCommonTransitionInfo(e){var t=()=>super.getCommonTransitionInfo,n=this;return(0,S.A)(function*(){const s=yield t().call(n,e);return s.moduleName?(s?.schemaUIType===Ea.ClassicUI&&e.options.action!==Gi.Edit&&(s.isInChain=!0),s):null})()}getModelInitConfigs(e){const{action:t,defaultValues:n,recordId:s}=e.options;if(!t)return null;const r=n?.filter(l=>l.value),o={action:t};return t===Gi.Add?o.defaultValues=r:o.recordId=F.getRecordLookupValue(s),[o]}getStateModuleId(e){const t=e.modelInitConfigs?.[0];return[e.moduleName,t?.recordId,e.schemaName].filter(Boolean).join("_")}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Pa)))(n||Pa)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Pa,factory:Pa.\u0275fac})}}class ka extends Ji{getModuleConfig({navigationState:e}){return{keepAlive:e?.keepAlive??!0}}getRootState(e,t){const n=t.options,s={...t?.state??{}};return s.moduleId=n.moduleId,s.moduleName=n.moduleName,s.parameters=n.parameters,s.initConfig=n.initConfig,s.silent??=!1,s}getModuleName(e,t){const n=e.isInChain?e.prevLocation:t.options?.moduleName;return Promise.resolve(n)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ka)))(n||ka)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ka,factory:ka.\u0275fac})}}class ja extends Ji{_getTransitionConfigWithoutSchemaName(e){const t={...(0,T.cloneDeep)(e?.state??{})};return this.locationStrategy.getState()?.isInChain&&(t.isInChain??=!0),t.moduleId=`${t.moduleName}_`,{mode:e.mode,location:t.moduleName,state:t}}getChildHistoryStateBuilders(){return(0,i.inject)(Hg)}getSchemaName(e,t){const{schemaName:n}=t.options;return Promise.resolve(n)}getModuleName(e,t){var n=()=>super.getModuleName,s=this;return(0,S.A)(function*(){return(yield n().call(s,e,t))||F.getModuleName(e.schemaName)})()}getRootState(e,t){const n=super.getRootState(e,t),{parameters:s}=t.options;return e.schemaUIType===Ea.FreedomUI&&s&&(n.parameters=s),n}getModelInitConfigs(e){return e.options.modelInitConfigs}getStateModuleId(e){return[e.moduleName,e.schemaName].filter(Boolean).join("_")}getTransitionConfig(e){if(!e.options.schemaName){const t=this._getTransitionConfigWithoutSchemaName(e);return Promise.resolve(t)}return super.getTransitionConfig(e)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ja)))(n||ja)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ja,factory:ja.\u0275fac})}}class lc{constructor(){this._entityTransitionConfigBuilder=(0,i.inject)(Pa),this._schemaTransitionConfigBuilder=(0,i.inject)(ja),this._moduleTransitionConfigBuilder=(0,i.inject)(ka),this._navigationEventNotifier=(0,i.inject)(cc),this._router=(0,i.inject)(Oa),this._historyService=(0,i.inject)(Aa),this._translateService=(0,i.inject)(v.TranslateService),this._entitySchemaService=(0,i.inject)(ht),this.locationStrategy=(0,i.inject)(On),this.window=(0,i.inject)(P.ZP),this.handlerChain=Ae.instance,this._navigationEventNotifier.init()}_translate(e){return this._translateService.instant(`Navigation.${e}`)}_getEntityNavigationConfig(e){return{mode:e?.mode??Bt.Push,state:e?.state??{},options:e.options}}_getEntityTransitionConfig(e){const t=this._getEntityNavigationConfig(e);return this._entityTransitionConfigBuilder.getTransitionConfig(t)}_getSchemaNavigationConfig(e){return{mode:e?.mode??Bt.Push,state:e?.state??{},options:e.options}}_getSchemaTransitionConfig(e){const t=this._getSchemaNavigationConfig(e);return this._schemaTransitionConfigBuilder.getTransitionConfig(t)}_getModuleNavigationConfig(e){return{mode:e?.mode??Bt.Push,state:e?.state??{},options:e.options}}_getModuleTransitionConfig(e){const t=this._getModuleNavigationConfig(e);return this._moduleTransitionConfigBuilder.getTransitionConfig(t)}_showEntityNavigationError(e){console.error(this._translate("DoesntHaveAddPageMessage"));const t=e.options.entityName;this._entitySchemaService.getEntitySchemaByName(t).pipe((0,c.map)(n=>n.entitySchema?.uId),(0,u.take)(1)).subscribe(n=>{if(n){const s=this._translate("GoToEntityDesignerMessage"),l=`${ae()}ClientApp/#/EntitySchemaDesigner/${n}?callbackAction=RelatedPage`,d=we.String.format(s,l);console.info(d)}})}executeTransition(e){return this._historyService.executeTransition(e),Promise.resolve()}back(){this._historyService.back()}getState(){return this.locationStrategy.getState()}getCurrentState(){const e=this.getState();return Yh(e)??e}navigate(e){var t=this;return(0,S.A)(function*(){t._router.onNavigateStart();let n;switch(e.options.type){case ln.Schema:n=yield t._getSchemaTransitionConfig(e);break;case ln.Entity:if(n=yield t._getEntityTransitionConfig(e),!n){t._router.onNavigateEnd(),t._showEntityNavigationError(e);return}break;case ln.Module:n=yield t._getModuleTransitionConfig(e);break}yield t.executeTransition(n)})()}navigateToClientApp(e,t=Bh.Blank){const n=ae(),s=N(n,"ClientApp","#",e);this.window.open(s,t)}getActiveRouteInfo(){return this._router.getActiveRouteInfo()}getEntityPageUITypePriority(e){var t=this;return(0,S.A)(function*(){const n=t.getActiveRouteInfo().schemaName;return yield F.getEntityPageUITypePriority(e,n)})()}static{this.\u0275fac=function(t){return new(t||lc)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:lc,factory:lc.\u0275fac,providedIn:"root"})}}class Wb extends je{constructor(e){super(),this._rightsService=e.get(Zr),this._navigationService=e.get(lc)}_redirectToMainApplication(){var e=this;return(0,S.A)(function*(){yield e._navigationService.navigate({mode:Bt.Push,options:{type:ln.Schema},state:{moduleName:"Desktop"}})})()}getOperation(){return""}showMessage(){}handle(e){var t=this;return(0,S.A)(function*(){return(yield(0,u.firstValueFrom)(t._rightsService.getCanExecuteOperation(t.getOperation())))?t.next?.handle(e):(t.showMessage(),t._redirectToMainApplication())})()}}let $h=class extends Wb{constructor(e){super(e),this._operation="CanManageChats",this._dialogService=e.get(Je)}getOperation(){return this._operation}showMessage(){this._dialogService.openOperationPermissionsErrorDialog(this._operation)}};$h=(0,p.__decorate)([Ke({type:"crt.ChatSettingsPageInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["ChatSettingsPage","ChatQueues_FormPage"]}),(0,p.__metadata)("design:paramtypes",[i.Injector])],$h);let Gh=class extends je{constructor(e,t,n,s){super(),this._chatService=e,this._maskService=t,this._messageDialogProvider=n,this._translateService=s,this._channelsListName="ChannelsList",this._activeChatsValidationErrorMsgCode="ChatSettings.Channel.ActiveChatsValidationError"}_validateForActiveChats(e){var t=this;return(0,S.A)(function*(){yield t._maskService.showBodyMask();const n=yield(0,u.lastValueFrom)(t._chatService.hasUncompletedChats(e));if(yield t._maskService.hideBodyMask(),n){const s=t._translateService.instant(t._activeChatsValidationErrorMsgCode);return t._messageDialogProvider.open({data:{message:s,actions:[Wi.OK]}}),!1}return!0})()}_isValid(e){return this._validateForActiveChats(e)}handle(e){var t=this;return(0,S.A)(function*(){if(e.itemsAttributeName===t._channelsListName){const n=e.recordId;if(!(yield t._isValid(n)))return}t.next?.handle(e)})()}};Gh=(0,p.__decorate)([Ke({requestType:"crt.DeleteRecordRequest",type:"crt.ChanelDeleteRecordHandler",scopes:["ChatSettingsPage"]}),(0,p.__metadata)("design:paramtypes",[Re,Zn,ic,v.TranslateService])],Gh);let Qh=class extends je{constructor(e){super(),this._translateService=e,this._channelsListAttribute="ChannelsList",this._validationImageAttribute="ValidationImage"}_getAttributeValue(e,t,n){const s=e.getViewModelAttributePaths(t,n);return!s||s.length===0?"":e.attributes[s[0]]}_setupValidationError(e,t,n,s){const r=this._getAttributeValue(e,t,"Name"),o=this._translateService.instant(`ChatSettings.ChannelPage.ErrorCodes.${n}`,{channelName:r});s.tooltip=o,e.set(this._validationImageAttribute,s)}_resetValidationError(e){e.set(this._validationImageAttribute,null)}_validateChannelRecord(e){var t=this;return(0,S.A)(function*(){const n=e.attributes[t._validationImageAttribute];if(!n)return;const s=yield e.getPrimaryModelName(),r=t._getAttributeValue(e,s,"ErrorCode");return r?t._setupValidationError(e,s,r,n):t._resetValidationError(e)})()}_subscribeViewModelEvents(e){var t=this;const n=new u.Subscription;n.add(e.events$.pipe((0,u.filter)(({type:s,payload:r})=>s===Ne.FinishLoadModelAttributes&&r&&r[this._channelsListAttribute])).subscribe({next:function(){var s=(0,S.A)(function*(){const r=e.attributes[t._channelsListAttribute];for(const o of r)yield t._validateChannelRecord(o)});return function(){return s.apply(this,arguments)}}(),complete:()=>{n.unsubscribe()}}))}handle(e){var t=this;return(0,S.A)(function*(){yield t.next?.handle(e),t._subscribeViewModelEvents(e.$context)})()}};Qh=(0,p.__decorate)([Ke({requestType:"crt.HandleViewModelInitRequest",type:"crt.ChannelErrorValidationHandler",scopes:["ChatSettingsPage"]}),(0,p.__metadata)("design:paramtypes",[v.TranslateService])],Qh);let Jh=class extends je{_setFacebookPageLink(e,t,n){const s=`<a target='_blank' href='https://facebook.com/${t}'>${e}</a>`;n[this._facebookPageLinkAttrName]=s}constructor(e){super(),this._facebookSettingsService=e,this._facebookPageLinkAttrName="FacebookLink"}handle(e){var t=this;return(0,S.A)(function*(){const n=e.$context,s=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"Source")[0],r=yield n[s],o=yield n[t._facebookPageLinkAttrName];if(r&&!o&&!t._pageRequested){t._pageRequested=!0;const l=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"Id")[0],d=yield n[l];t._getPageName$=t._facebookSettingsService.getPageName(r,d).subscribe(h=>{t._setFacebookPageLink(h,r,n),t._getPageName$.unsubscribe()})}return yield t.next?.handle(e)})()}};Jh=(0,p.__decorate)([Ke({type:"crt.FacebookChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["FBMessengerChannel_EditPage"]}),(0,p.__metadata)("design:paramtypes",[Qi])],Jh);let qh=class extends je{constructor(e,t,n){super(),this._messageDialogProvider=e,this._translateService=t,this._maskService=n}_savePrimaryData(e){var t=this;return(0,S.A)(function*(){const n={type:"crt.SavePrimaryDataRequest",$context:e.$context,scopes:e.scopes},s=yield t.handlerChain.process(n);return s.find(o=>o.success===!1)||s[0]})()}handle(e){var t=this;return(0,S.A)(function*(){const s=yield e.$context.validate();if(!(Object.keys(s).length>0)){yield t._maskService.showBodyMask();try{const r=yield t._savePrimaryData(e);if(!r.success)throw new Error(r.errorInfo);yield t.handlerChain.process({$context:e.$context,type:"crt.ClosePageRequest"})}catch(r){t._messageDialogProvider.open({data:{message:t._translateService.instant(r?.message),actions:[Wi.OK]}})}finally{t._maskService.hideBodyMask()}}})()}};qh=(0,p.__decorate)([Ke({requestType:"crt.SaveRecordRequest",type:"crt.TelegramUpdateChannelHandler",scopes:["TelegramChannel_EditPage"]}),(0,p.__metadata)("design:paramtypes",[ic,v.TranslateService,Zn])],qh);let Kh=class extends je{constructor(){super(...arguments),this._whatsappAttrName="WhatsAppLink"}_setWhatsAppLink(e,t){const n=`<a target='_blank' href='https://wa.me/${e}'>${e}</a>`;t[this._whatsappAttrName]=n}handle(e){var t=this;return(0,S.A)(function*(){const n=e.$context,s=n.getViewModelAttributePaths(yield n.getPrimaryModelName(),"Source")[0],r=yield n[s],o=yield n[t._whatsappAttrName];return r&&!o&&t._setWhatsAppLink(r,n),yield t.next?.handle(e)})()}};Kh=(0,p.__decorate)([Ke({type:"crt.WhatsAppChannelAttributeChangedHandler",requestType:"crt.HandleViewModelAttributeChangeRequest",scopes:["WhatsAppChannel_EditPage"]})],Kh);let uc=class up{constructor(e){e.addIcons([{name:"translate-icon",icon:m(37719)},{name:"arrow-left",icon:m(18030)},{name:"arrow-right",icon:m(96637)},{name:"menu-arrow",icon:m(67566)},{name:"small-close",icon:m(71222)}])}static{this.\u0275fac=function(t){return new(t||up)(i.\u0275\u0275inject(Zt))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:up})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[Ia],imports:[b.CommonModule,v.TranslateModule,Z.ReactiveFormsModule,ni,K.MatFormFieldModule,Oe.MatAutocompleteModule,re.MatInputModule,U.MatIconModule,W.MatButtonModule,an]})}};uc=(0,p.__decorate)([mr({viewElements:[tt]}),(0,p.__metadata)("design:paramtypes",[Zt])],uc),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(uc,{declarations:[tt],imports:[b.CommonModule,v.TranslateModule,Z.ReactiveFormsModule,ni,K.MatFormFieldModule,Oe.MatAutocompleteModule,re.MatInputModule,U.MatIconModule,W.MatButtonModule,an],exports:[tt]})}();class Ra{_createChatQueueOperator(e){return{id:e.Id,operator:e.Operator,chatQueue:e.ChatQueue}}getValueFromLookup(e,t){return e.hasOwnProperty(t)&&!(0,T.isEmpty)(e[t])?e[t].value:void 0}getEntity(e){return this._createChatQueueOperator(e)}getEntityColumns(e){return[new le("Id",e.id,C.r.Guid),new le("Operator",this.getValueFromLookup(e,"operator"),C.r.Lookup),new le("ChatQueue",this.getValueFromLookup(e,"chatQueue"),C.r.Lookup)]}static{this.\u0275fac=function(t){return new(t||Ra)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ra,factory:Ra.\u0275fac})}}class dc extends jh{constructor(e,t,n){super(e,t,n),this.entitySchemaName="ChatQueueOperator"}mapSysAdminUnit(e){return{id:e.Id,name:e.Name,parentRoleId:e.ParentRole&&e.ParentRole.value,sysAdminUnitTypeValue:e.SysAdminUnitTypeValue}}addSysAdminUnitQueryFilters(e){const t=new Ve;t.logicalOperation=di.Or,t.addSchemaColumnFilterWithParameter(ee.Not_equal,"SysAdminUnitTypeValue",4),t.addSchemaColumnFilterWithParameter(ee.Equal,"Active",1),e.filters.addSchemaColumnFilterWithParameter(ee.Equal,"ConnectionType",0),e.filters.add(t)}getSysAdminUnitQuery(){const e=new Se("SysAdminUnit");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name"),e.addSchemaColumn("ParentRole"),e.addSchemaColumn("SysAdminUnitTypeValue"),e.addSchemaColumn("ConnectionType"),e.addSchemaColumn("Active"),this.addSysAdminUnitQueryFilters(e),e}getItemsByChatQueueId(e){const t=this.createGetAllItemsEsq();return t.filters.addSchemaColumnFilterWithParameter(ee.Equal,"ChatQueue",e),this.queryExecutor.executeSelectQuery(t).pipe((0,c.map)(n=>({success:!0,errorInfo:null,result:n.map(s=>this.entityConverter.getEntity(s))})),(0,c.catchError)(n=>this.getBaseErrorResponse(n)))}getSysAdminUnitList(){const e=this.getSysAdminUnitQuery();return this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>({success:!0,errorInfo:null,sysAdminUnits:t.map(n=>this.mapSysAdminUnit(n))})))}static{this.\u0275fac=function(t){return new(t||dc)(i.\u0275\u0275inject(xe),i.\u0275\u0275inject(v.TranslateService),i.\u0275\u0275inject(Ra))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:dc,factory:dc.\u0275fac})}}let hc=class dp{static{this.\u0275fac=function(t){return new(t||dp)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:dp})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[$i,wa,Re,Sa,Na,Qi,Ra,L.vn,{provide:Hi,useClass:dc},(0,E.provideHttpClient)((0,E.withInterceptorsFromDi)())],imports:[b.CommonModule,Vn,Z.FormsModule,v.TranslateModule,W.MatButtonModule,Y.MatDialogModule,uc,Yi]})}};hc=(0,p.__decorate)([mr({requestHandlers:[Rh,Lh,Vh,zh,Fh,Gh,Qh,Jh,Kh,$h,qh]})],hc),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(hc,{declarations:[Dn,yt,Ta],imports:[b.CommonModule,Vn,Z.FormsModule,v.TranslateModule,W.MatButtonModule,Y.MatDialogModule,uc,Yi],exports:[Dn,yt,Ta,tt]})}();class oi{static{this.MARKDOWN_CODE_BLOCK_REGEX=/```[\s\S]*?```/}static{this.ESCAPED_HTML_REGEX=/&lt;[^&]*&gt;/}static{this.SPECIAL_CHARS_REGEX=/[.*+?^${}()|[\]\\]/g}static{this.TEXT_BETWEEN_TAGS_REGEX=/>([^<]*)</g}static isEscapedOrMarkdown(e){return oi.MARKDOWN_CODE_BLOCK_REGEX.test(e)||oi.ESCAPED_HTML_REGEX.test(e)}}class $b{canHandle(e){return!/<[^>]*>/.test(e)||oi.isEscapedOrMarkdown(e)}highlight(e,t,n){const s=t.replace(oi.SPECIAL_CHARS_REGEX,"\\$&"),r=new RegExp(s,"gi");return e.replace(r,o=>n(o))}}class Gb{canHandle(e){return/<[^>]*>/.test(e)&&!oi.isEscapedOrMarkdown(e)}highlight(e,t,n){const s=t.replace(oi.SPECIAL_CHARS_REGEX,"\\$&"),r=new RegExp(s,"gi");return e.replace(oi.TEXT_BETWEEN_TAGS_REGEX,(o,l)=>`>${l.replace(r,h=>n(h))}<`)}}class un{constructor(){this.strategies=[new $b,new Gb]}static{this.HIGHLIGHT_CLASS="highlight-word"}static{this.ELLIPSIS_CHAR="\u2026"}isValidInput(e,t){return!!t?.trim()&&!!e}shouldHighlightWhole(e,t){const n=e.toLowerCase().replace(un.ELLIPSIS_CHAR,"");return t.toLowerCase().includes(n)}getStrategy(e){return this.strategies.find(t=>t.canHandle(e))||this.strategies[0]}wrapWithHighlight(e){return`<span class="${un.HIGHLIGHT_CLASS}">${e}</span>`}transform(e,t,n=!1){return this.isValidInput(e,t)?n&&this.shouldHighlightWhole(e,t)?this.wrapWithHighlight(e):this.getStrategy(e).highlight(e,t,r=>this.wrapWithHighlight(r)):e}static{this.\u0275fac=function(t){return new(t||un)}}static{this.\u0275pipe=i.\u0275\u0275definePipe({name:"highlight",type:un,pure:!0})}}class La{static{this.\u0275fac=function(t){return new(t||La)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:La})}static{this.\u0275inj=i.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(La,{declarations:[un],exports:[un]})})();const Qb=a=>({"background-image":a});function Jb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"label",20),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.chat.contact.account.displayValue)}}function qb(a,e){a&1&&(i.\u0275\u0275elementStart(0,"label",21),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,"ChatSettings.ChatWindow.LastChatMessageAuthorCaption")))}function Kb(a,e){a&1&&(i.\u0275\u0275elementStart(0,"label",22),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(2,1,"ChatSettings.ChatWindow.DraftMessageCaption")))}function Xb(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"p",23),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275classProp("is-draft-message",t.draftMessage),i.\u0275\u0275attribute("data-item-marker",t.chat.id),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.draftMessage," ")}}function eS(a,e){a&1&&i.\u0275\u0275element(0,"div",24)}function tS(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"p",23),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275classProp("is-own-message",t.isOwnMessage()),i.\u0275\u0275attribute("data-item-marker",t.chat.id),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.chat.chatPreview," ")}}function nS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",25)(1,"button",26),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.acceptChat())}),i.\u0275\u0275element(2,"span",27),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",t.getAcceptButtonCaption()," ")}}class Va{get draftMessage(){return this._draftMessage}set draftMessage(e){this._draftMessage=e}constructor(e,t,n,s,r){this._translateService=e,this._chatService=t,this._userInfo=n,this._contactColorService=s,this._dialogService=r,this.isChatAccepted=!1}isOperatorFilled(){return!!this.chat.operator?.value}acceptChat(){window.sessionStorage.setItem(`lastChatAccepted_${this.chat.id}`,this.chat.id),this._chatService.acceptChat(this.chat.id).subscribe(e=>{this.isChatAccepted=e,e?this.chatAccepted?.next(this.chat):this._dialogService.openInfoDialog(this._translateService.instant("ChatSettings.ChatWindow.AlreadyAssignedChat"))})}acceptButtonVisible(){return!this.isOperatorFilled()&&!this.isChatAccepted}getAcceptButtonCaption(){return this._translateService.instant("ChatSettings.ChatWindow.AcceptChatButton")}formatChatDate(e){const t={hour:"2-digit",minute:"2-digit"},n=e?new Date(e):new Date;return new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName,t).format(n)}isOwnMessage(){return this.draftMessage?!1:this.chat.lastMessageDirection===si.Outcoming}onCompleteChat(e){this._chatService.completeChat(this.chat.id).subscribe(),e.preventDefault(),e.stopPropagation()}getHint(e){return new ec({hintConfig:{displayValue:e,cssClasses:"chat-list-tooltip-hint"},componentType:sn})}ngOnInit(){this.draftMessage=window.sessionStorage.getItem(this.chat.id),this.contactColor=this._contactColorService.getNextColor(this.chat.contact.id)}static{this.\u0275fac=function(t){return new(t||Va)(i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(Re),i.\u0275\u0275directiveInject(L.oq),i.\u0275\u0275directiveInject(cn),i.\u0275\u0275directiveInject(Je))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Va,selectors:[["ts-chat-item"]],inputs:{chat:"chat",chatAccepted:"chatAccepted"},decls:24,vars:22,consts:[["chatPreview",""],[1,"chat-item-wrapper"],[1,"contact-photo-container"],[3,"contact","contactColor"],[1,"chat-info-container"],[1,"contact-name-container"],[1,"contact-name"],[1,"message-info"],[1,"message-time"],[1,"channel-icon",3,"ngStyle"],["class","account-name",4,"ngIf"],["class","last-message-direction",4,"ngIf"],["class","draft-message-caption",4,"ngIf"],[1,"message-preview"],["class","chat-preview-message",3,"is-draft-message",4,"ngIf","ngIfElse"],["class","new-chat-message-indicator",4,"ngIf"],[1,"chat-list-menu"],[1,"close-chat-container",3,"click","libHintOverlay"],[1,"close-chat"],["class","buttons-container",4,"ngIf"],[1,"account-name"],[1,"last-message-direction"],[1,"draft-message-caption"],[1,"chat-preview-message"],[1,"new-chat-message-indicator"],[1,"buttons-container"],["data-item-marker","AcceptChatButton",1,"accept-chat-button",3,"click"],[1,"accept-chat-icon"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",1)(1,"div",2),i.\u0275\u0275element(2,"ts-contact-photo",3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",4)(4,"div",5)(5,"a",6),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(7,"div",7)(8,"label",8),i.\u0275\u0275text(9),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(10,"div",9),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(11,Jb,2,1,"label",10)(12,qb,3,3,"label",11)(13,Kb,3,3,"label",12),i.\u0275\u0275elementStart(14,"div",13),i.\u0275\u0275template(15,Xb,2,4,"p",14)(16,eS,1,0,"div",15),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(17,tS,2,4,"ng-template",null,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(19,"div",16)(20,"div",17),i.\u0275\u0275pipe(21,"translate"),i.\u0275\u0275listener("click",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onCompleteChat(o))}),i.\u0275\u0275element(22,"span",18),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(23,nS,4,1,"div",19),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(18);i.\u0275\u0275classProp("is-not-assigned",!n.isOperatorFilled()),i.\u0275\u0275attribute("data-item-marker","chat-item-"+n.chat.id),i.\u0275\u0275advance(2),i.\u0275\u0275property("contact",n.chat.contact)("contactColor",n.contactColor),i.\u0275\u0275advance(3),i.\u0275\u0275styleProp("color",n.acceptButtonVisible()?"":n.contactColor),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(n.chat.contact.name),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(n.formatChatDate(n.chat.lastMessageTime)),i.\u0275\u0275advance(),i.\u0275\u0275property("ngStyle",i.\u0275\u0275pureFunction1(20,Qb,"url("+(n.chat.channel==null||n.chat.channel.provider==null?null:n.chat.channel.provider.icon)+")")),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.chat.contact.account),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.isOwnMessage()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.draftMessage),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.draftMessage)("ngIfElse",s),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.chat.unprocessedMsgCount),i.\u0275\u0275advance(4),i.\u0275\u0275property("libHintOverlay",n.getHint(i.\u0275\u0275pipeBind1(21,18,"ChatSettings.ChatWindow.Actions.Complete"))),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.acceptButtonVisible())}},dependencies:[b.NgIf,b.NgStyle,St,nn,v.TranslatePipe],styles:[`.chat-item-wrapper{padding:19px 0 0 8px;cursor:pointer}.chat-item-wrapper:hover{background-color:#e3e9f9;border-radius:8px}.chat-item-wrapper:hover .chat-list-menu{display:block}.chat-item-wrapper.is-not-assigned{background-color:#f5f9fe;cursor:auto}.chat-item-wrapper .chat-list-menu{position:absolute;display:none;box-shadow:0 3px 6px #00000029;border-radius:4px;margin-left:278px;background-color:transparent}.chat-item-wrapper .chat-list-menu .close-chat-container{height:41px;width:38px;padding-left:12px;padding-top:14px;cursor:pointer;background-color:#fff}.chat-item-wrapper .chat-list-menu .close-chat-container:hover{opacity:.92}.chat-item-wrapper .chat-list-menu .close-chat-container .close-chat{width:16px;min-width:16px;height:16px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNi43MDciIHZpZXdCb3g9IjAgMCAxNiAxNi43MDciPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiMwMDZjZTA7c3Ryb2tlOiMwMDZjZTA7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5ie2ZpbGw6I2ZmZjtmaWxsLXJ1bGU6ZXZlbm9kZDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzg4LjE4NSAtMzczLjc2NCkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTM4Ny42ODUsMzg0LjI2NGgzdjNsMy0zaDd2LTEwaC0xM1oiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTEyODguNzQxLDQ3My43MDlhLjU4NC41ODQsMCwwLDAtLjgyNywwbC0yLjcxOSwyLjctMS0xYS41ODUuNTg1LDAsMCwwLS44My44MjRsMS40MDcsMS40MTZhLjU4Ny41ODcsMCwwLDAsLjgyNiwwbDMuMTM0LTMuMTA4YS41ODMuNTgzLDAsMCwwLDAtLjgyNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE2NjcuMzg3IC05Ni4zMTMpIi8+PC9nPjwvc3ZnPg==);display:block}.chat-item-wrapper .contact-photo-container{display:inline-block;vertical-align:top}.chat-item-wrapper .chat-info-container{display:inline-block;margin-left:17px;width:calc(100% - 50px);border-bottom:#e3e6ec 1px solid;padding-bottom:14px;cursor:pointer;padding-right:15px}.chat-item-wrapper .chat-info-container .contact-name-container{justify-content:space-between;display:flex}.chat-item-wrapper .chat-info-container .contact-name-container .contact-name{font-size:16px;color:#006ce0;text-decoration:none;display:block;word-break:break-word}.chat-item-wrapper .chat-info-container .contact-name-container .message-info{justify-items:end;align-items:center;white-space:nowrap}.chat-item-wrapper .chat-info-container .contact-name-container .message-time{display:inline-block;vertical-align:middle;font-size:14px;color:#757575;padding-right:8px}.chat-item-wrapper .chat-info-container .contact-name-container .channel-icon{display:inline-block;vertical-align:middle;width:24px;height:24px;background-color:#fff;background-repeat:no-repeat;background-position:center;background-size:16px;border-radius:50%}.chat-item-wrapper .chat-info-container .contact-name-container+.message-preview{margin-top:12px}.chat-item-wrapper .chat-info-container .draft-message-caption{font-size:12px;color:#006ce0;display:block;margin-top:5px;cursor:pointer}.chat-item-wrapper .chat-info-container .account-name{font-size:11px;color:#999;display:block;margin-top:5px;cursor:pointer}.chat-item-wrapper .chat-info-container .last-message-direction{font-size:12px;color:#006ce0;display:block;margin-top:5px;cursor:pointer}.chat-item-wrapper .chat-info-container .message-preview{width:100%;-webkit-user-select:text;user-select:text;white-space:pre-line;margin-top:2px;justify-content:space-between;display:flex}.chat-item-wrapper .chat-info-container .message-preview .new-chat-message-indicator{border-radius:50%;background-color:#006ce0;width:8px;height:8px;margin-top:4px}.chat-item-wrapper .chat-info-container .message-preview .chat-preview-message{max-height:54px;overflow:hidden;font-size:13px;margin:0;text-overflow:ellipsis;-webkit-line-clamp:3;-webkit-box-orient:vertical;display:-webkit-box;width:calc(100% - 20px)}.chat-item-wrapper .chat-info-container .message-preview .chat-preview-message.is-own-message,.chat-item-wrapper .chat-info-container .message-preview .chat-preview-message.is-draft-message{color:#757575;font-size:12px}.chat-item-wrapper .buttons-container{display:inline-block;width:100%}.chat-item-wrapper .buttons-container .accept-chat-button{background:#f4f8fe;border-radius:2px;border:#f4f8fe;opacity:1;text-align:left;letter-spacing:0;color:#006ce0;padding:3px 14px;float:right;cursor:pointer;font-family:Open Sans,Roboto,Helvetica Neue,sans-serif;font-size:13px;height:27px;outline:0}.chat-item-wrapper .buttons-container .accept-chat-button:hover{background:#e3e9f9;border:#e3e9f9}.chat-item-wrapper .buttons-container span.accept-chat-icon{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxNC43MDciIHZpZXdCb3g9IjAgMCAxNCAxNC43MDciPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiMwMDZjZTA7c3Ryb2tlOiMwMDZjZTA7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuNSAwLjUpIj48cGF0aCBjbGFzcz0iYSIgZD0iTS0zODcuNjg1LDM4NC4yNjRoM3YzbDMtM2g3di0xMGgtMTNaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzODcuNjg1IC0zNzQuMjY0KSIvPjwvZz48L3N2Zz4);background-repeat:no-repeat;background-position:0 0;border:none;padding-left:14px;padding-right:8px;vertical-align:sub}.chat-list-tooltip-hint{margin:15px 30px;min-width:60px;max-width:300px;display:inline-block;align-items:center;background:#fff;position:relative;text-align:left;width:max-content;color:#757575;border-radius:50px;border:none;z-index:1;font-size:11px;padding:5px;box-shadow:none}
`],encapsulation:2})}}class za{constructor(e){this.httpClient=e}getTemplateText(e,t){return this.httpClient.post("rest/MacrosHelperService/GetMultiLanguageTextTemplate",{request:{entityId:t,entityName:"OmniChat",templateId:e}})}getTemplates(e,t=5){return this.httpClient.post("rest/TemplateHintService/GetTemplateHints",{text:e,rowsCount:t}).pipe((0,c.map)(s=>s.TemplateHints))}getNextTemplates(e,t,n){return this.httpClient.post("rest/TemplateHintService/GetNextTemplateHints",{text:e,skipRows:t,rowsCount:n}).pipe((0,c.map)(r=>r.TemplateHints))}static{this.\u0275fac=function(t){return new(t||za)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:za,factory:za.\u0275fac,providedIn:"root"})}}const iS=["templateInput"];function sS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",10),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.chooseTemplate(s,r.id))}),i.\u0275\u0275elementStart(1,"div",11),i.\u0275\u0275element(2,"div",12),i.\u0275\u0275pipe(3,"highlight"),i.\u0275\u0275element(4,"div",13),i.\u0275\u0275pipe(5,"highlight"),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("innerHTML",i.\u0275\u0275pipeBind2(3,2,t.name,n.templateText),i.\u0275\u0275sanitizeHtml),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("innerHTML",i.\u0275\u0275pipeBind2(5,5,t.text,n.templateText),i.\u0275\u0275sanitizeHtml)}}class Ql{constructor(e,t){this._messageTemplateService=e,this.ref=t,this._isMenuShown=!1,this.templateSelected=new i.EventEmitter,this.selectorClosed=new i.EventEmitter,this.searchEnabled=!1}set menuItems(e){this._menuItems=e}get menuItems(){return this._menuItems}get isMenuShown(){return this._isMenuShown}loadTemplates(e){this._messageTemplateService.getTemplates(this.templateText).subscribe(t=>{this.menuItems=t,this.ref.detectChanges(),e&&(e.preventDefault(),e.stopPropagation())})}resetTemplateSearchInput(){this.templateInput.nativeElement.value=this.templateText=""}toggleMenuVisibility(){this._isMenuShown?(this.trigger.closeMenu(),this._isMenuShown=!1):(this.trigger.openMenu(),this._isMenuShown=!0,this.loadTemplates())}chooseTemplate(e,t){this.searchEnabled=!1,this.resetTemplateSearchInput(),this.templateSelected.emit(t)}onMenuClosed(){this.searchEnabled=!1,this.resetTemplateSearchInput(),this._isMenuShown=!1,this.selectorClosed.emit()}onInputTemplate(e){this.templateText=e.target.value,this.loadTemplates(e)}onSearchClick(e){this.searchEnabled=!0,this.templateInput.nativeElement.focus(),e.preventDefault(),e.stopPropagation()}closeSearch(e){this.searchEnabled=!1,this.resetTemplateSearchInput(),this.loadTemplates(e),e.preventDefault(),e.stopPropagation()}static{this.\u0275fac=function(t){return new(t||Ql)(i.\u0275\u0275directiveInject(za),i.\u0275\u0275directiveInject(i.ChangeDetectorRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ql,selectors:[["ts-template-lookup-selector"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(R.MatMenuTrigger,5),i.\u0275\u0275viewQuery(iS,5)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.trigger=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.templateInput=s.first)}},inputs:{menuItems:"menuItems"},outputs:{templateSelected:"templateSelected",selectorClosed:"selectorClosed"},decls:12,vars:13,consts:[["menu","matMenu"],["templateInput",""],[3,"matMenuTriggerFor"],["yPosition","above","xPosition","after",1,"templates-lookup-menu",3,"closed"],[1,"search-template-wrapper",3,"click"],[1,"template-caption"],[1,"search-template-icon","search-icon",3,"click"],["type","text",1,"search-bar",3,"input","click"],[1,"clear-search-template-icon",3,"click"],["class","template-item-button","mat-button","",3,"click",4,"ngFor","ngForOf"],["mat-button","",1,"template-item-button",3,"click"],[1,"template-item-text-wrapper"],[1,"title",3,"innerHTML"],[1,"preview",3,"innerHTML"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275element(0,"div",2),i.\u0275\u0275elementStart(1,"mat-menu",3,0),i.\u0275\u0275listener("closed",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onMenuClosed())}),i.\u0275\u0275elementStart(3,"div",4),i.\u0275\u0275listener("click",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onSearchClick(o))}),i.\u0275\u0275elementStart(4,"span",5),i.\u0275\u0275text(5),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(7,"span",6),i.\u0275\u0275listener("click",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onSearchClick(o))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(8,"input",7,1),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onInputTemplate(o))})("click",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(o.stopPropagation())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(10,"span",8),i.\u0275\u0275listener("click",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.closeSearch(o))}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(11,sS,6,8,"button",9),i.\u0275\u0275elementEnd()}if(t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275property("matMenuTriggerFor",s),i.\u0275\u0275advance(4),i.\u0275\u0275classProp("template-caption-hide",n.searchEnabled),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(6,11,"MessageTemplate.TemplateSearchCaption")),i.\u0275\u0275advance(2),i.\u0275\u0275classProp("search-icon-open",n.searchEnabled),i.\u0275\u0275advance(),i.\u0275\u0275classProp("search-bar-open",n.searchEnabled),i.\u0275\u0275advance(2),i.\u0275\u0275classProp("clear-search-template-icon-open",n.searchEnabled),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.menuItems)}},dependencies:[b.NgForOf,W.MatButton,R.MatMenu,R.MatMenuTrigger,v.TranslatePipe,un],styles:[".templates-lookup-menu{width:280px;transform:translate(30px);background:#fff 0 0 no-repeat padding-box;box-shadow:0 3px 3px #00000029;border:1px solid #e3e6ec;opacity:1;overflow:hidden!important;padding-bottom:8px}  .templates-lookup-menu .highlight-word{color:#056ee0;font-weight:700}  .templates-lookup-menu .search-template-wrapper{border-bottom:1px solid #999999;height:33px;margin:0 10px 5px 15px;cursor:pointer}  .templates-lookup-menu .search-template-wrapper .search-icon{position:absolute;right:0;transition:all .5s ease}  .templates-lookup-menu .search-template-wrapper .search-icon-open{z-index:1000;color:#fff;right:238px}  .templates-lookup-menu .search-template-wrapper .template-caption{position:absolute;transition:all .5s ease;margin-top:8px;display:inline-block;color:#056ee0;font-size:16px}  .templates-lookup-menu .search-template-wrapper .template-caption-hide{color:#fff;left:15px}  .templates-lookup-menu .search-template-wrapper .search-bar{border:0 none;height:20px;transition:all .5s ease;width:0;padding:0;position:absolute;right:0;color:#444;margin-left:8px;outline:none;font-size:14px}  .templates-lookup-menu .search-template-wrapper .search-bar-open{display:block;width:218px;top:0;margin-right:20px;margin-top:8px}  .templates-lookup-menu .search-template-wrapper .search-template-icon{width:16px;height:16px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNi4wMDciIGhlaWdodD0iMTYuMDA4IiB2aWV3Qm94PSIwIDAgMTYuMDA3IDE2LjAwOCI+PGRlZnM+PHN0eWxlPi5hLC5iLC5je2ZpbGw6bm9uZTt9LmEsLmJ7c3Ryb2tlOiMyODQ1Nzg7fS5he3N0cm9rZS1taXRlcmxpbWl0OjEwO30uZHtzdHJva2U6bm9uZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI2My44MiA2NC42NSkiPjxnIGNsYXNzPSJhIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI2My44MiAtNjQuNjUpIj48Y2lyY2xlIGNsYXNzPSJkIiBjeD0iNiIgY3k9IjYiIHI9IjYiLz48Y2lyY2xlIGNsYXNzPSJjIiBjeD0iNiIgY3k9IjYiIHI9IjUuNSIvPjwvZz48cGF0aCBjbGFzcz0iYiIgZD0iTS4zNDQuMzQ0LDUuNSw1LjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMjU0LjMyIC01NS4xNSkiLz48L2c+PHJlY3QgY2xhc3M9ImMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDcgMC4wMDgpIi8+PC9zdmc+);display:inline-block;cursor:pointer;margin-top:12px;margin-right:12px}  .templates-lookup-menu .search-template-wrapper .clear-search-template-icon{width:0;height:10px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5Ljg3MyIgaGVpZ2h0PSI5Ljg3MyIgdmlld0JveD0iMCAwIDkuODczIDkuODczIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojNzA3MDcwO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTU1OS41NjQgLTM0Ny41NjMpIj48bGluZSBjbGFzcz0iYSIgeDI9IjkuMTY2IiB5Mj0iOS4xNjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1NTkuOTE3IDM0Ny45MTcpIi8+PGxpbmUgY2xhc3M9ImEiIHgxPSI5LjE2NiIgeTI9IjkuMTY2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNTU5LjkxNyAzNDcuOTE3KSIvPjwvZz48L3N2Zz4=);display:inline-block;cursor:pointer;transition:all .5s ease;padding:0;position:absolute;right:0;margin-top:15px;margin-right:12px}  .templates-lookup-menu .search-template-wrapper .clear-search-template-icon-open{display:block;width:10px;top:0;margin-right:12px}  .templates-lookup-menu .menu-title{text-align:left;padding:8px;font-size:13px;font-family:Open Sans,sans-serif;color:#444}  .templates-lookup-menu .menu-title-hint{border-top:1px solid #e3e6ec;color:#8095b3}  .templates-lookup-menu .mat-mdc-button{font-size:13px;font-family:Open Sans,sans-serif;line-height:inherit;padding-bottom:4px;padding-top:4px;height:inherit!important;margin-left:8px;margin-right:8px;width:264px;text-align:left;text-transform:none!important}  .templates-lookup-menu .mat-mdc-button:not(:last-child){border-bottom:1px solid #ededed}  .templates-lookup-menu .mat-mdc-button:hover:not([disabled]){background:#e5ebfb 0 0 no-repeat padding-box}  .templates-lookup-menu .mat-mdc-button.cdk-keyboard-focused{background-color:#e5ebfb}  .templates-lookup-menu .mat-mdc-button.cdk-program-focused{background-color:#e5ebfb}  .templates-lookup-menu .mat-mdc-button .template-item-text-wrapper{margin-bottom:8px;padding-top:8px}  .templates-lookup-menu .mat-mdc-button .template-item-text-wrapper .title{line-height:normal;font-size:11px;color:#757575;margin-bottom:8px}  .templates-lookup-menu .mat-mdc-button .template-item-text-wrapper .preview{line-height:normal;color:#181818;font-size:13px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;white-space:initial}"]})}}function aS(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",5),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.unprocessedMsgCount)}}function rS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"span",2),i.\u0275\u0275template(1,aS,2,1,"div",3),i.\u0275\u0275elementStart(2,"ts-contact-photo",4),i.\u0275\u0275listener("contactClick",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.goToChat(s))}),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275classMap(t.id===n.currentChat.id?"active-chat":""),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.unprocessedMsgCount),i.\u0275\u0275advance(),i.\u0275\u0275property("contact",t.contact)("contactColor",n.contactColorService.getNextColor(t.contact.id))}}class pc{constructor(e,t,n,s,r){this.chatService=e,this.customEventService=t,this._userInfo=n,this.ref=s,this.contactColorService=r,this.chatClick=new i.EventEmitter}_loadChats(){this.chatService.getOperatorChats().pipe((0,c.filter)(e=>e.success),(0,c.map)(e=>e.result)).subscribe(e=>{const t=e.filter(n=>n.operator.value===this._userInfo.id);this.activeChats=t?.length>1?t:[],this.updateCounter(this.currentChat.id,0),this.ref.detectChanges()})}_convertWSMessage(e){return{sender:e.Header?.Sender,body:typeof e?.Body=="string"?JSON.parse(e.Body):e.Body}}removeChat(e){this.activeChats=this.activeChats.filter(t=>t.id.toLowerCase()!==e.toLowerCase())}addChat(e){this.chatService.getItem(e).subscribe(t=>{t&&t.success&&(this.activeChats.push(t.result[0]),this.activeChats=[...this.activeChats])})}updateCounter(e,t){this.activeChats.forEach(n=>{n.id===e&&(n.unprocessedMsgCount=t)}),this.ref.detectChanges()}handleWsMessages(e){if(e=JSON.parse(e),e.Header?.Sender){const n=this._convertWSMessage(e),s=n.body;switch(n.sender){case"UnreadMessageInChat":s.ChatId.toLowerCase()!==this.currentChat.id.toLowerCase()&&this.updateCounter(s.ChatId,s.Count);break;case"CompleteChat":this.removeChat(s.ChatId);break;case"NewTransferredChat":this.addChat(s.ChatId);break;default:break}}}ngOnInit(){this.activeChats=this.initialActiveChats||[],this.activeChats.length===0&&this._loadChats(),this.updateCounter(this.currentChat.id,0),this.customEventService.subscribe("OmniChatWSMessages").subscribe(e=>this.handleWsMessages(e))}goToChat(e){e.id!==this.currentChat.id&&(this.updateCounter(e.id,0),this.chatClick.emit({chat:e}))}static{this.\u0275fac=function(t){return new(t||pc)(i.\u0275\u0275directiveInject(Re),i.\u0275\u0275directiveInject(P.Dj),i.\u0275\u0275directiveInject(L.oq),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(cn))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:pc,selectors:[["ts-active-chats"]],inputs:{currentChat:"currentChat",initialActiveChats:"initialActiveChats"},outputs:{chatClick:"chatClick"},decls:2,vars:1,consts:[[1,"active-chats"],["class","active-chat-item",3,"class",4,"ngFor","ngForOf"],[1,"active-chat-item"],["class","messages-counter",4,"ngIf"],[1,"active-chat-icon",3,"contactClick","contact","contactColor"],[1,"messages-counter"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,rS,3,5,"span",1),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.activeChats))},dependencies:[b.NgForOf,b.NgIf,St],styles:[".active-chats[_ngcontent-%COMP%]{display:inline-grid;gap:6px;padding:0 0 16px 10px;grid-auto-flow:column}.active-chats[_ngcontent-%COMP%]   .active-chat-item[_ngcontent-%COMP%]{width:32px;height:32px}.active-chats[_ngcontent-%COMP%]   .active-chat-item.active-chat[_ngcontent-%COMP%]{width:36px;height:36px;margin-top:-3px}.active-chats[_ngcontent-%COMP%]   .active-chat-item.active-chat[_ngcontent-%COMP%]   .active-chat-icon[_ngcontent-%COMP%]     .contact-photo{border:2px solid #ffffff;box-shadow:0 0 0 1px #006ce0}.active-chats[_ngcontent-%COMP%]   .active-chat-item[_ngcontent-%COMP%]   .messages-counter[_ngcontent-%COMP%]{background:red;width:19px;height:19px;border-radius:50%;text-align:center;font-size:12px;color:#fff;z-index:2;position:relative;margin:-11px 0 -8px -8px}"]})}}class Fa{constructor(e,t){this.queryExecutor=e,this.httpClient=t,this._serviceUrl="/rest/ChatTransferService/"}mapOperator(e){return{value:e.id,status:e.status,contact:new $l(e.contact.id,e.contact.name,e.contact.photoId)}}getQueues(){const e=new Se("ChatQueue");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name"),e.filters.addSchemaColumnIsNotNullFilter("[ChatQueueOperator:ChatQueue:Id].Id"),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>t.map(n=>({id:n.Id,name:n.Name}))))}getOperators(e){const t=this._serviceUrl+"GetOperators";return this.httpClient.post(t,{search:e}).pipe((0,c.map)(n=>n.map(this.mapOperator)))}transferToQueue(e,t){const n=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"TransferChatToQueue";return this.httpClient.post(s,{message:e,queueId:t},{headers:n})}transferToOperator(e,t){const n=new E.HttpHeaders().set("Content-Type","application/json; charset=utf-8"),s=this._serviceUrl+"TransferChatToOperator";return this.httpClient.post(s,{message:e,operatorId:t},{headers:n})}static{this.\u0275fac=function(t){return new(t||Fa)(i.\u0275\u0275inject(xe),i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Fa,factory:Fa.\u0275fac,providedIn:"root"})}}function oS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",2),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.transferChat(s,r))}),i.\u0275\u0275element(1,"ts-contact-photo",3),i.\u0275\u0275elementStart(2,"div",4),i.\u0275\u0275element(3,"div",5),i.\u0275\u0275pipe(4,"highlight"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(5,"div")(6,"span",6),i.\u0275\u0275text(7),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(8,"div",7),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275classProp("disabled",n.isMenuItemDisabled(t)),i.\u0275\u0275propertyInterpolate1("id","operator-menu-item-",t.value,""),i.\u0275\u0275advance(),i.\u0275\u0275property("contact",t.contact)("contactColor",n.contactColorService.getNextColor(t.contact.id)),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("innerHTML",i.\u0275\u0275pipeBind2(4,11,t.contact.name,n.searchName),i.\u0275\u0275sanitizeHtml),i.\u0275\u0275advance(2),i.\u0275\u0275classMapInterpolate1("operator-item-status-wrapper operator-status-",n.getStatus(t.status).value,""),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(n.getStatus(t.status).tip)}}class Ba{constructor(e,t,n,s){this.contactColorService=e,this.chatTransferService=t,this.ref=n,this._translateService=s,this._isTransferring=!1,this.searchName="",this.chatTransferredToOperator=new i.EventEmitter}sortOperators(e){const t=[Zi.Active,Zi.Inactive,Zi.ChatsExceeded];return e.sort((n,s)=>t.indexOf(n.status)-t.indexOf(s.status))}ngOnInit(){this.loadOperators()}loadOperators(e=""){this.searchName=e,this.chatTransferService.getOperators(e).subscribe(t=>{this.menuItems=this.sortOperators(t),this.isTabActive=this.menuItems.length>0,this.ref.detectChanges()})}transferChat(e,t){if(this.isMenuItemDisabled(t)||this._isTransferring){e.preventDefault(),e.stopPropagation();return}this._isTransferring=!0,this.chatTransferService.transferToOperator(this.systemMessageTemplate,t.value).subscribe(n=>{this.chatTransferredToOperator.emit(n),this._isTransferring=!1})}getStatus(e){const t=Zi[e];return{tip:this._translateService.instant(`ChatSettings.Transfer.OperatorStatusTips.${t}`),value:t.toLocaleLowerCase()}}isMenuItemDisabled(e){return e.status===Zi.ChatsExceeded}static{this.\u0275fac=function(t){return new(t||Ba)(i.\u0275\u0275directiveInject(cn),i.\u0275\u0275directiveInject(Fa),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(v.TranslateService))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ba,selectors:[["ts-transfer-operator-list"]],inputs:{systemMessageTemplate:"systemMessageTemplate"},outputs:{chatTransferredToOperator:"chatTransferredToOperator"},decls:2,vars:1,consts:[[1,"transfer-operator-menu-items"],["mat-menu-item","","class","operator-item",3,"id","disabled","click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"operator-item",3,"click","id"],[1,"operator-photo",3,"contact","contactColor"],[1,"operator-item-text-wrapper"],[3,"innerHTML"],[1,"status-tip"],[1,"status-indicator"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,oS,9,14,"button",1),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.menuItems))},dependencies:[b.NgForOf,St,R.MatMenuItem,un],styles:[".operator-item[_ngcontent-%COMP%]{line-height:16px;padding:4px 9px 4px 16px;margin:0 8px;width:320px;height:48px!important}.operator-item[_ngcontent-%COMP%]     .mat-mdc-menu-item-text{display:flex;justify-content:space-between;align-items:center;width:100%;font-size:13px}.operator-item.disabled[_ngcontent-%COMP%]{cursor:default;color:#00000061}.operator-item[_ngcontent-%COMP%]:hover:not(.disabled){background:#eaedf3 0 0 no-repeat padding-box}.operator-item.cdk-keyboard-focused[_ngcontent-%COMP%], .operator-item.cdk-program-focused[_ngcontent-%COMP%]{background-color:#eaedf3}.operator-item[_ngcontent-%COMP%]   .operator-photo[_ngcontent-%COMP%]{width:32px;height:32px}.operator-item[_ngcontent-%COMP%]   .operator-item-text-wrapper[_ngcontent-%COMP%]{flex:auto;white-space:break-spaces;line-height:16px;margin-left:8px}.operator-item[_ngcontent-%COMP%]   .operator-item-status-wrapper[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:flex-end}.operator-item[_ngcontent-%COMP%]   .operator-item-status-wrapper[_ngcontent-%COMP%]   .status-tip[_ngcontent-%COMP%]{display:none}.operator-item[_ngcontent-%COMP%]   .operator-item-status-wrapper.operator-status-chatsexceeded[_ngcontent-%COMP%]:first-child{border-top:2px solid rgb(17,0,255)}.operator-item[_ngcontent-%COMP%]:hover   .operator-item-status-wrapper[_ngcontent-%COMP%]   .status-tip[_ngcontent-%COMP%]{display:block}.status-indicator[_ngcontent-%COMP%]{border-radius:50%;width:8px;height:8px;margin-left:8px;flex:none}.operator-status-active[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{background-color:#22ac14}.operator-status-inactive[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{background-color:#df1f26}.operator-status-chatsexceeded[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]{background-color:#757575}.operator-status-chatsexceeded[_ngcontent-%COMP%]   .status-indicator[_ngcontent-%COMP%]:first-child{border-top:2px solid rgb(17,0,255)}.transfer-operator-menu-items[_ngcontent-%COMP%]{max-height:426px;overflow:auto}.transfer-operator-menu-items[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:not(.operator-item.disabled) + .operator-item.disabled[_ngcontent-%COMP%]{border-top:1px solid #dbdbdb}.transfer-operator-menu-items[_ngcontent-%COMP%]::-webkit-scrollbar{-webkit-appearance:none;width:4px;height:4px}.transfer-operator-menu-items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003}"]})}}function cS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",2),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.transferChat(s,r.id))}),i.\u0275\u0275elementStart(1,"div",3)(2,"div"),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()()}if(a&2){const t=e.$implicit;i.\u0275\u0275propertyInterpolate1("id","queue-menu-item-",t.id,""),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(t.name)}}class Ua{constructor(e,t){this.chatTransferService=e,this.ref=t,this._isTransferring=!1,this.chatTransferredToQueue=new i.EventEmitter}ngOnInit(){this.chatTransferService.getQueues().subscribe(e=>{this.menuItems=e.filter(t=>t.id!==this.transferData.chatQueueId),this.isTabActive=this.menuItems.length>0,this.ref.detectChanges()})}transferChat(e,t){if(this._isTransferring){e.preventDefault(),e.stopPropagation();return}this._isTransferring=!0,this.chatTransferService.transferToQueue(this.systemMessageTemplate,t).subscribe(n=>{this.chatTransferredToQueue.emit(n),this._isTransferring=!1})}static{this.\u0275fac=function(t){return new(t||Ua)(i.\u0275\u0275directiveInject(Fa),i.\u0275\u0275directiveInject(i.ChangeDetectorRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ua,selectors:[["ts-transfer-queue-list"]],inputs:{systemMessageTemplate:"systemMessageTemplate",transferData:"transferData"},outputs:{chatTransferredToQueue:"chatTransferredToQueue"},decls:2,vars:1,consts:[[1,"transfer-queue-menu-items"],["mat-menu-item","",3,"id","click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click","id"],[1,"queue-item-text-wrapper"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,cS,4,3,"button",1),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.menuItems))},dependencies:[b.NgForOf,R.MatMenuItem],styles:[".mat-mdc-menu-item[_ngcontent-%COMP%]{padding-bottom:4px;padding-top:4px;height:inherit!important;margin-left:16px;margin-right:16px;width:302px;border-bottom:1px solid #ededed}.mat-mdc-menu-item[_ngcontent-%COMP%]:hover:not([disabled]){background:#eaedf3 0 0 no-repeat padding-box}.mat-mdc-menu-item.cdk-keyboard-focused[_ngcontent-%COMP%], .mat-mdc-menu-item.cdk-program-focused[_ngcontent-%COMP%]{background-color:#eaedf3}.mat-mdc-menu-item[_ngcontent-%COMP%]   .mat-mdc-menu-item-text[_ngcontent-%COMP%]{font-size:13px;line-height:inherit}.queue-item-text-wrapper[_ngcontent-%COMP%]{padding-left:16px}.transfer-queue-menu-items[_ngcontent-%COMP%]{max-height:426px;overflow:auto}.transfer-queue-menu-items[_ngcontent-%COMP%]::-webkit-scrollbar{-webkit-appearance:none;width:4px;height:4px}.transfer-queue-menu-items[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003}"]})}}var Jl;(function(a){a[a.ToOperator=0]="ToOperator",a[a.ToQueue=1]="ToQueue"})(Jl||(Jl={}));const lS=["templateInput"],uS=["tabs"];function dS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",12),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onSearchClick(s))}),i.\u0275\u0275elementStart(1,"span",13),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onSearchClick(s))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(2,"input",14,2),i.\u0275\u0275listener("click",function(s){return i.\u0275\u0275restoreView(t),i.\u0275\u0275resetView(s.stopPropagation())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"span",15),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.closeSearch(s))}),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275classProp("search-icon-open",t.searchEnabled),i.\u0275\u0275advance(),i.\u0275\u0275classProp("search-bar-open",t.searchEnabled),i.\u0275\u0275advance(2),i.\u0275\u0275classProp("clear-search-template-icon-open",t.searchEnabled)}}function hS(a,e){a&1&&(i.\u0275\u0275elementStart(0,"div",16),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"ChatSettings.Transfer.ToOperator")," "))}function pS(a,e){a&1&&(i.\u0275\u0275elementStart(0,"div",17),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"ChatSettings.Transfer.NoAvailableAgents")," "))}function mS(a,e){a&1&&(i.\u0275\u0275elementStart(0,"div",18),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"ChatSettings.Transfer.ToQueue")," "))}function gS(a,e){a&1&&(i.\u0275\u0275elementStart(0,"div",17),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"ChatSettings.Transfer.NoAvailableQueues")," "))}class mc{_setTabUnderlineFirstOpen(){this.childTabs.forEach(e=>{e.realignInkBar()})}_resetTemplateSearchInput(){this.templateInput?.nativeElement&&(this.templateInput.nativeElement.value="")}constructor(e){this.featureService=e,this.selectedTabIndex=0,this.chatTransferred=new i.EventEmitter,this.searchEnabled=!1,this.isShowOperatorTab=this.featureService.getFeatureState("CanTransferToOperator")}ngAfterViewInit(){(0,u.fromEvent)(this.templateInput.nativeElement,"keyup").pipe((0,c.map)(e=>e.target.value),(0,c.startWith)(""),(0,c.debounceTime)(300),(0,c.distinctUntilChanged)()).subscribe(e=>{this.operatorList?.loadOperators(e)})}onTabChanged(e){this.isTransferToOperator()&&this.operatorList.loadOperators()}isTransferToQueue(){return this.selectedTabIndex==Jl.ToQueue}isTransferToOperator(){return this.selectedTabIndex==Jl.ToOperator}openMenu(){this._setTabUnderlineFirstOpen(),this.trigger.openMenu(),this.isTransferToOperator()&&(this.searchEnabled=!1,this.operatorList.loadOperators(),this._resetTemplateSearchInput())}closeMenu(){this.trigger.closeMenu(),this._resetTemplateSearchInput()}onChatTranfered(e){this.closeMenu(),this.chatTransferred.emit(e)}onSearchClick(e){this.searchEnabled=!0,this.templateInput.nativeElement.focus(),e.preventDefault(),e.stopPropagation()}closeSearch(e){this.searchEnabled=!1,this.operatorList.loadOperators(),this._resetTemplateSearchInput(),e.preventDefault(),e.stopPropagation()}isQueuesTabActive(){return this.queueList?.isTabActive}isAgentsTabActive(){return this.operatorList?.isTabActive}static{this.\u0275fac=function(t){return new(t||mc)(i.\u0275\u0275directiveInject(hn))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:mc,selectors:[["ts-chat-transfer"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(R.MatMenuTrigger,5),i.\u0275\u0275viewQuery(R.MatMenu,5),i.\u0275\u0275viewQuery(Ba,5),i.\u0275\u0275viewQuery(Ua,5),i.\u0275\u0275viewQuery(lS,5),i.\u0275\u0275viewQuery(uS,5)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.trigger=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.menu=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.operatorList=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.queueList=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.templateInput=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.childTabs=s)}},inputs:{systemMessageTemplate:"systemMessageTemplate",transferData:"transferData"},outputs:{chatTransferred:"chatTransferred"},decls:17,vars:11,consts:[["menu","matMenu"],["tabs",""],["templateInput",""],[3,"matMenuTriggerFor"],["yPosition","above","xPosition","after",1,"chat-transfer-menu"],[1,"chat-transfer-header"],["class","search-template-wrapper",3,"click",4,"ngIf"],["mat-stretch-tabs","","animationDuration","0ms","disableRipple","true",3,"selectedIndexChange","click","selectedTabChange","selectedIndex"],["mat-tab-label",""],["class","no-available-text",4,"ngIf"],[3,"chatTransferredToOperator","systemMessageTemplate"],[3,"chatTransferredToQueue","systemMessageTemplate","transferData"],[1,"search-template-wrapper",3,"click"],[1,"search-template-icon","search-icon",3,"click"],["type","text",1,"search-bar",3,"click"],[1,"clear-search-template-icon",3,"click"],["data-item-marker","TransferToOperatorMenuItem"],[1,"no-available-text"],["data-item-marker","TransferToQueueMenuItem"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275element(0,"div",3),i.\u0275\u0275elementStart(1,"mat-menu",4,0)(3,"div",5),i.\u0275\u0275text(4),i.\u0275\u0275pipe(5,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(6,dS,5,6,"div",6),i.\u0275\u0275elementStart(7,"mat-tab-group",7,1),i.\u0275\u0275twoWayListener("selectedIndexChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275twoWayBindingSet(n.selectedTabIndex,o)||(n.selectedTabIndex=o),i.\u0275\u0275resetView(o)}),i.\u0275\u0275listener("click",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(o.stopPropagation())})("selectedTabChange",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onTabChanged(o))}),i.\u0275\u0275elementStart(9,"mat-tab"),i.\u0275\u0275template(10,hS,3,3,"ng-template",8)(11,pS,3,3,"div",9),i.\u0275\u0275elementStart(12,"ts-transfer-operator-list",10),i.\u0275\u0275listener("chatTransferredToOperator",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onChatTranfered(o))}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(13,"mat-tab"),i.\u0275\u0275template(14,mS,3,3,"ng-template",8)(15,gS,3,3,"div",9),i.\u0275\u0275elementStart(16,"ts-transfer-queue-list",11),i.\u0275\u0275listener("chatTransferredToQueue",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onChatTranfered(o))}),i.\u0275\u0275elementEnd()()()()}if(t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275property("matMenuTriggerFor",s),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(5,9,"ChatSettings.Transfer.TransferWindowCaption")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.isTransferToOperator()),i.\u0275\u0275advance(),i.\u0275\u0275twoWayProperty("selectedIndex",n.selectedTabIndex),i.\u0275\u0275advance(4),i.\u0275\u0275property("ngIf",!n.isAgentsTabActive()),i.\u0275\u0275advance(),i.\u0275\u0275property("systemMessageTemplate",n.systemMessageTemplate),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",!n.isQueuesTabActive()),i.\u0275\u0275advance(),i.\u0275\u0275property("systemMessageTemplate",n.systemMessageTemplate)("transferData",n.transferData)}},dependencies:[b.NgIf,R.MatMenu,R.MatMenuTrigger,Dt.MatTabLabel,Dt.MatTab,Dt.MatTabGroup,Ua,Ba,v.TranslatePipe],styles:['.mat-mdc-menu-panel.chat-transfer-menu{width:336px;max-width:336px;transform:translate(30px);background:#fff 0 0 no-repeat padding-box;box-shadow:0 3px 3px #00000029;border:1px solid #e3e6ec;opacity:1;padding-bottom:6px;padding-top:15px;margin-top:30px;border-radius:8px!important;overflow:visible}  .mat-mdc-menu-panel.chat-transfer-menu:before{border-color:transparent;border-bottom-color:#fff!important;top:-5px;right:32px;border-width:0 8px 6px;transform-origin:center bottom;content:"";position:absolute;border-style:solid;filter:drop-shadow(1px -1px 2px #bbb);clip:rect(-10px,20px,6px,auto)}  .mat-mdc-menu-panel.chat-transfer-menu .mat-mdc-tab{min-width:25px!important;padding:5px;background-color:transparent}  .mat-mdc-menu-panel.chat-transfer-menu .mat-mdc-tab.mdc-tab--active{min-width:25px!important;padding:5px;background-color:transparent}  .mat-mdc-menu-panel.chat-transfer-menu .chat-transfer-header{color:#006ce0;font-size:12px;margin-left:16px;-webkit-user-select:none;user-select:none}  .mat-mdc-menu-panel.chat-transfer-menu .highlight-word{color:#056ee0;font-weight:700}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper{cursor:pointer}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .search-icon{position:absolute;top:12px;right:12px;transition:all .5s ease}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .search-icon-open{z-index:1000;color:#fff;right:300px}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .template-caption{position:absolute;transition:all .5s ease;margin-top:8px;display:inline-block;color:#056ee0;font-size:16px}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .template-caption-hide{color:#fff;left:15px}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .search-bar{border:0 none;height:30px;transition:all .5s ease;width:0;padding:0;position:absolute;right:0;color:#444;margin-left:8px;outline:none;font-size:14px}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .search-bar-open{display:block;width:282px;top:0;margin-right:10px;margin-top:8px;padding-left:27px;border-bottom:1px dotted #444444}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .search-template-icon{width:16px;height:16px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNi4wMDciIGhlaWdodD0iMTYuMDA4IiB2aWV3Qm94PSIwIDAgMTYuMDA3IDE2LjAwOCI+PGRlZnM+PHN0eWxlPi5hLC5iLC5je2ZpbGw6bm9uZTt9LmEsLmJ7c3Ryb2tlOiMyODQ1Nzg7fS5he3N0cm9rZS1taXRlcmxpbWl0OjEwO30uZHtzdHJva2U6bm9uZTt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjI2My44MiA2NC42NSkiPjxnIGNsYXNzPSJhIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI2My44MiAtNjQuNjUpIj48Y2lyY2xlIGNsYXNzPSJkIiBjeD0iNiIgY3k9IjYiIHI9IjYiLz48Y2lyY2xlIGNsYXNzPSJjIiBjeD0iNiIgY3k9IjYiIHI9IjUuNSIvPjwvZz48cGF0aCBjbGFzcz0iYiIgZD0iTS4zNDQuMzQ0LDUuNSw1LjUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMjU0LjMyIC01NS4xNSkiLz48L2c+PHJlY3QgY2xhc3M9ImMiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDcgMC4wMDgpIi8+PC9zdmc+);display:inline-block;cursor:pointer}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .clear-search-template-icon{width:0;height:10px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI5Ljg3MyIgaGVpZ2h0PSI5Ljg3MyIgdmlld0JveD0iMCAwIDkuODczIDkuODczIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojNzA3MDcwO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTU1OS41NjQgLTM0Ny41NjMpIj48bGluZSBjbGFzcz0iYSIgeDI9IjkuMTY2IiB5Mj0iOS4xNjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE1NTkuOTE3IDM0Ny45MTcpIi8+PGxpbmUgY2xhc3M9ImEiIHgxPSI5LjE2NiIgeTI9IjkuMTY2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNTU5LjkxNyAzNDcuOTE3KSIvPjwvZz48L3N2Zz4=);background-size:10px 10px;display:inline-block;cursor:pointer;transition:all .5s ease;padding:0;position:absolute;right:0;top:0;margin-top:15px;margin-right:12px}  .mat-mdc-menu-panel.chat-transfer-menu .search-template-wrapper .clear-search-template-icon-open{display:block;width:10px;top:0;margin-right:12px}  .mat-mdc-menu-panel.chat-transfer-menu .no-available-text{font-family:Open Sans,Regular,sans-serif;font-size:14px;text-align:center;color:gray;margin:8px 0 5px}']})}}const Yg="OmnichannelMessaging";class gc{generate(e){let t="#";return e?.channel?.source&&(t=`https://facebook.com/${e?.channel?.source}`),(0,u.of)(t)}static{this.\u0275fac=function(t){return new(t||gc)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:gc,factory:gc.\u0275fac,providedIn:"root"})}}class fc{constructor(e){this.httpClient=e,this._serviceUrl="/rest/TelegramOmnichannelMessagingService/",this._cacheLinks={}}generate(e){const t=e?.channel?.msgSettingsId;return t&&!(0,A.gZ)(t)?this._cacheLinks[t]?(0,u.of)(this._cacheLinks[t]):this.getTelegramUserName(t).pipe((0,c.map)(n=>`https://t.me/${n}`),(0,c.tap)(n=>this._cacheLinks[t]=n)):(console.warn("msgSettingsId is empty"),u.EMPTY)}getTelegramUserName(e){const t=this._serviceUrl+"GetUserName";return this.httpClient.post(t,{settingsId:e})}static{this.\u0275fac=function(t){return new(t||fc)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:fc,factory:fc.\u0275fac,providedIn:"root"})}}class _c{generate(e){let t="#";return e?.channel?.source&&(t=`https://wa.me/${e.channel.source}`),(0,u.of)(t)}static{this.\u0275fac=function(t){return new(t||_c)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:_c,factory:_c.\u0275fac,providedIn:"root"})}}class yc{constructor(e,t){this.httpClient=e,this._featureService=t,this._featureService.getFeatureState("ESDeduplication").subscribe(n=>{this.elasticDeduplicationEnabled=n||!1})}findDuplicatesOnSave(e){return this.httpClient.post("/rest/DeduplicationService/FindDuplicatesOnSave",e).pipe((0,c.map)(n=>n&&n.FindDuplicatesOnSaveResult||[]))}findDuplicatesOnSaveES(e){return this.httpClient.post("/rest/DeduplicationServiceV2/FindDuplicatesOnSave",e).pipe((0,c.map)(n=>{const r=(JSON.parse(n&&n.FindDuplicatesOnSaveResult||!1)||[]).map(o=>o.Id);return r.length>0&&r.push(e.primaryColumnValue),r}))}static{this.\u0275fac=function(t){return new(t||yc)(i.\u0275\u0275inject(E.HttpClient),i.\u0275\u0275inject(hn))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:yc,factory:yc.\u0275fac,providedIn:"root"})}}function fS(a){switch(a){case"asc":return Qe.Asc;case"desc":return Qe.Desc;default:return Qe.None}}function Uv(a){switch(a){case OrderDirection.Asc:return"asc";case OrderDirection.Desc:return"desc";default:return"none"}}let Xh=class pu{constructor(e){this.httpClient=e,this.serviceEndpoint="ServiceModel/ProcessEngineService.svc/"}_executePost(e,t){const n=this.serviceEndpoint+t;return this.httpClient.post(n,e)}_getRequestSortingColumns(e){return e?Object.entries(e).map(([n,s],r)=>({path:n,direction:fS(s),position:r})):[]}createProcessParameterValues(e){const t=[];return e&&Object.entries(e).forEach(([n,s])=>{let r=s;(0,T.isDate)(s)&&(r=xu(s)),t.push({name:n,value:r})}),t}executeProcessByName(e,t,n){const s={schemaName:e,parameterValues:this.createProcessParameterValues(t),resultParameterNames:n};return this._executePost(s,"RunProcess")}executeProcessForMatchingRecords(e){const t={schemaName:e.processName,inputParameterName:e.inputParameterName,entitySchemaName:e.entitySchemaName,filterConfig:JSON.stringify(e.filterConfig),isSupportMultiplePageOpening:!1,sortingColumns:this._getRequestSortingColumns(e.sortingColumns)};return this._executePost(t,"RunProcessForMatchingRecords")}completeExecuting(e,t){const n={processElementUId:e,parameterValues:this.createProcessParameterValues(t)};return this._executePost(n,"CompleteExecuting")}changeToAppropriateDcmInstance(e,t,n){const s={currentStageId:e,entitySchemaName:t,recordId:n};return this._executePost(s,"ChangeToAppropriateDcmInstance")}static{this.\u0275fac=function(t){return new(t||pu)(i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:pu,factory:pu.\u0275fac,providedIn:"root"})}};Xh=(0,p.__decorate)([(0,P.op)({requestType:"crt.ProcessEngineService"}),(0,p.__metadata)("design:paramtypes",[E.HttpClient])],Xh);const _S=["templatesMenuContainer"];function yS(a,e){a&1&&(i.\u0275\u0275elementStart(0,"div",8),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"MessageTemplate.SuggestionHint")," "))}function CS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",9),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.chooseTemplate(s,r.id))}),i.\u0275\u0275elementStart(1,"div",10),i.\u0275\u0275element(2,"div",11),i.\u0275\u0275pipe(3,"highlight"),i.\u0275\u0275element(4,"div",12),i.\u0275\u0275pipe(5,"highlight"),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275propertyInterpolate1("id","template-menu-item-",t.id,""),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("innerHTML",i.\u0275\u0275pipeBind2(3,4,t.name,n.searchString),i.\u0275\u0275sanitizeHtml),i.\u0275\u0275advance(2),i.\u0275\u0275propertyInterpolate("innerHTML",i.\u0275\u0275pipeBind2(5,7,t.text,n.searchString),i.\u0275\u0275sanitizeHtml)}}class Cc{constructor(e,t,n){this._translateService=e,this.ref=t,this.scrollToBottomObserverFactory=n,this._isMenuShown=!1,this.loadNext=new i.EventEmitter,this.showTemplateSuggestionHint=!1,this.templateSelected=new i.EventEmitter,this.selectorClosed=new i.EventEmitter}set menuItems(e){this._menuItems=e,this._toggleMenuVisibility(),this.scrollPageToBottomObserver?.resetScrollMaxPosition()}get menuItems(){return this._menuItems}get isMenuShown(){return this._isMenuShown}_toggleMenuVisibility(){!this._isMenuShown&&this._menuItems?.length>0||this.showTemplateSuggestionHint?(this.trigger.openMenu(),this._isMenuShown=!0):this._isMenuShown&&this._menuItems?.length===0&&(this.trigger.closeMenu(),this._isMenuShown=!1)}_resetMaxListHeight(){if(!this.templatesMenuContainer)return;let e=0;const t=this.templatesMenuContainer.nativeElement.children,n=Math.min(t.length,5),s=1;for(let r=0;r<n;r++)e=e+t[r].offsetHeight;this.templatesMenuContainer.nativeElement.style.maxHeight=s*(n-1)+e+"px"}_destroyScrollToBottomObserver(){this.scrollPageToBottomObserver?.destroy()}_initScrollToBottomObserver(){this.scrollPageToBottomObserver=this.scrollToBottomObserverFactory.createObserver(this.templatesMenuContainer.nativeElement,()=>{this.loadNext.emit()})}focusFirstItem(){this.menu.focusFirstItem()}chooseTemplate(e,t){this.templateSelected.emit(t)}onMenuClosed(){this._isMenuShown=!1,this._menuItems=[],this.selectorClosed.emit()}ngAfterViewInit(){this._initScrollToBottomObserver()}ngOnDestroy(){this._destroyScrollToBottomObserver()}ngAfterViewChecked(){this._resetMaxListHeight()}static{this.\u0275fac=function(t){return new(t||Cc)(i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(Kn))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Cc,selectors:[["ts-template-selector"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(R.MatMenuTrigger,5),i.\u0275\u0275viewQuery(R.MatMenu,5),i.\u0275\u0275viewQuery(_S,5)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.trigger=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.menu=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.templatesMenuContainer=s.first)}},inputs:{menuItems:"menuItems",searchString:"searchString"},outputs:{loadNext:"loadNext",templateSelected:"templateSelected",selectorClosed:"selectorClosed"},decls:10,vars:6,consts:[["menu","matMenu"],["templatesMenuContainer",""],[3,"matMenuTriggerFor"],["yPosition","above","xPosition","after",1,"templates_menu",3,"closed"],[1,"menu-title"],["class","menu-title menu-title-hint",4,"ngIf"],[1,"menu-items"],["mat-menu-item","",3,"id","click",4,"ngFor","ngForOf"],[1,"menu-title","menu-title-hint"],["mat-menu-item","",3,"click","id"],[1,"template-item-text-wrapper"],[1,"title",3,"innerHTML"],[1,"preview",3,"innerHTML"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275element(0,"div",2),i.\u0275\u0275elementStart(1,"mat-menu",3,0),i.\u0275\u0275listener("closed",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onMenuClosed())}),i.\u0275\u0275elementStart(3,"div",4),i.\u0275\u0275text(4),i.\u0275\u0275pipe(5,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(6,yS,3,3,"div",5),i.\u0275\u0275elementStart(7,"div",6,1),i.\u0275\u0275template(9,CS,6,10,"button",7),i.\u0275\u0275elementEnd()()}if(t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275property("matMenuTriggerFor",s),i.\u0275\u0275advance(4),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(5,4,"MessageTemplate.Suggestion")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.showTemplateSuggestionHint),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngForOf",n.menuItems)}},dependencies:[b.NgForOf,b.NgIf,R.MatMenu,R.MatMenuItem,R.MatMenuTrigger,v.TranslatePipe,un],styles:['.templates_menu{width:280px;transform:translate(30px);border-radius:8px!important;background:#fff 0 0 no-repeat padding-box;box-shadow:0 3px 3px #00000029;border:1px solid #e3e6ec;opacity:1;padding-bottom:6px;overflow:visible!important}  .templates_menu.mat-mdc-menu-panel .menu-items{max-height:320px;overflow-x:hidden}  .templates_menu.mat-mdc-menu-panel .menu-items::-webkit-scrollbar{-webkit-appearance:none;width:5px;height:5px}  .templates_menu.mat-mdc-menu-panel .menu-items::-webkit-scrollbar-thumb{background-color:#0003}  .templates_menu:after{border-color:transparent;border-top-color:#fff!important;bottom:-6px;right:30px;border-width:6px 8px 0;transform-origin:center bottom;content:"";position:absolute;border-style:solid;filter:drop-shadow(1px 3px 2px #bbb);clip:rect(0,20px,20px,auto)}  .templates_menu .highlight-word{color:#056ee0;font-weight:700}  .templates_menu .menu-title{text-align:left;padding:9px 0 4px 20px;font-size:12px;font-family:Open Sans,sans-serif;color:#006ce0}  .templates_menu .menu-title-hint{border-top:1px solid #e3e6ec;color:#8095b3}  .templates_menu .mat-mdc-menu-item{padding-bottom:4px;padding-top:4px;height:inherit!important;margin-left:8px;margin-right:8px;width:264px}  .templates_menu .mat-mdc-menu-item:not(:last-child){border-bottom:1px solid #ededed}  .templates_menu .mat-mdc-menu-item:hover:not([disabled]){background:#eaedf3 0 0 no-repeat padding-box}  .templates_menu .mat-mdc-menu-item.cdk-keyboard-focused:not([disabled]){background-color:#eaedf3}  .templates_menu .mat-mdc-menu-item.cdk-program-focused{background-color:#eaedf3}  .templates_menu .mat-mdc-menu-item .mat-mdc-menu-item-text{font-size:13px;font-family:Open Sans,sans-serif;line-height:inherit}  .templates_menu .mat-mdc-menu-item .template-item-text-wrapper{margin-bottom:8px;padding-top:8px}  .templates_menu .mat-mdc-menu-item .template-item-text-wrapper .title{line-height:normal;font-size:11px;color:#757575;margin-bottom:8px}  .templates_menu .mat-mdc-menu-item .template-item-text-wrapper .preview{line-height:normal;color:#181818;font-size:13px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;white-space:initial}']})}}const MS=["senderTranslationToggle"],IS=["languagePicker"],bS=["conversationContainer"],SS=["inputField"],vS=["templatesList"],TS=["transferChat"],xS=a=>({chatQueueId:a}),wS=a=>({"disabled-attachment":a}),NS=(a,e)=>({down:a,up:e});function ES(a,e){a&1&&i.\u0275\u0275element(0,"ts-mask",51)}function DS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",52),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.toggleTranslationPanel())}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("libHintOverlay",t.translationButtonHint)}}function AS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",53),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.completeChat())}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("libHintOverlay",t.getHint(i.\u0275\u0275pipeBind1(1,1,"ChatSettings.ChatWindow.Actions.Complete")))}}function OS(a,e){a&1&&i.\u0275\u0275element(0,"div")}function PS(a,e){a&1&&i.\u0275\u0275element(0,"div")}function kS(a,e){a&1&&i.\u0275\u0275element(0,"div")}function jS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",54),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onSearchContactDuplicatesClick(s))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("libHintOverlay",t.getHint(i.\u0275\u0275pipeBind1(1,1,"ChatSettings.ChatWindow.Actions.ContactDuplicates.Find")))}}function RS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",55),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.openDuplicatesPageClick(s))}),i.\u0275\u0275elementStart(2,"span",56),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("libHintOverlay",t.getHint(i.\u0275\u0275pipeBind1(1,2,"ChatSettings.ChatWindow.Actions.ContactDuplicates.Show"))),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(t.contactDuplicatesList.length)}}function LS(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",57),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275elementStart(2,"span",56),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("libHintOverlay",t.getHint(i.\u0275\u0275pipeBind1(1,2,"ChatSettings.ChatWindow.Actions.ContactDuplicates.NotFound"))),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(t.contactDuplicatesList.length)}}function VS(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"a",58),i.\u0275\u0275element(1,"div",59),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275propertyInterpolate("href",t.getContactSearchLink(t.chat.contact.name),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275property("libHintOverlay",t.getHint(i.\u0275\u0275pipeBind1(2,2,"ChatSettings.ChatWindow.Actions.SearchFacebook")))}}function zS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",60),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.openTransferMenu())}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275property("libHintOverlay",t.getHint(i.\u0275\u0275pipeBind1(1,1,"ChatSettings.ChatWindow.Actions.Transfer")))}}function FS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",66),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(s.openAccount(s.chat.contact.account.value))}),i.\u0275\u0275text(1),i.\u0275\u0275element(2,"div",67),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.chat.contact.account.displayValue," ")}}function BS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",61)(1,"ts-contact-photo",62),i.\u0275\u0275element(2,"img",63),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",64),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.openContact(s.chat.contact.id))}),i.\u0275\u0275text(4),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(5,FS,3,1,"div",65),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("contact",t.chat.contact)("contactColor",t.contactColorService.getNextColor(t.chat.contact==null?null:t.chat.contact.id)),i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("src",t.chat.channel==null||t.chat.channel.provider==null?null:t.chat.channel.provider.icon,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate1(" ",t.chat.contact.name," "),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.chat.contact.account)}}function US(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",77)(1,"div",78),i.\u0275\u0275text(2,"Email"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",79)(4,"a",82),i.\u0275\u0275text(5),i.\u0275\u0275elementEnd()()()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(4),i.\u0275\u0275property("href","mailto:"+(t.firstMessageAuthor==null?null:t.firstMessageAuthor.email),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.firstMessageAuthor==null?null:t.firstMessageAuthor.email)}}function HS(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",76)(1,"div",77)(2,"div",78),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(5,"div",79)(6,"a",80),i.\u0275\u0275text(7),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275template(8,US,6,2,"div",81),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(4,4,"ChatSettings.PreChatSummary.Fields.Source")),i.\u0275\u0275advance(3),i.\u0275\u0275property("href",t.channelLink,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.chat==null||t.chat.channel==null?null:t.chat.channel.name),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.firstMessageAuthor==null?null:t.firstMessageAuthor.email)}}function YS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",68)(1,"div",69),i.\u0275\u0275element(2,"div",70),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(3,"div",71)(4,"div",72),i.\u0275\u0275text(5),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementStart(7,"div",73),i.\u0275\u0275listener("click",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.toggleSummary())}),i.\u0275\u0275text(8),i.\u0275\u0275pipe(9,"translate"),i.\u0275\u0275element(10,"span",74),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(11,HS,9,6,"div",75),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(5),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(6,5,"ChatSettings.PreChatSummary.Caption")," "),i.\u0275\u0275advance(2),i.\u0275\u0275attribute("data-item-marker",t.isSummaryShow?"HideChatSummary":"ShowChatSummary"),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(9,7,t.isSummaryShow?"ChatSettings.PreChatSummary.Toggle.Opened":"ChatSettings.PreChatSummary.Toggle.Closed")," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction2(9,NS,!t.isSummaryShow,t.isSummaryShow)),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.isSummaryShow)}}function ZS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",83)(1,"crt-translate-language-picker",84,7),i.\u0275\u0275listener("sourceLanguageChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.selectedLanguage=s)})("targetLanguageChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onTargetLanguageChange(s))})("translate",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onTranslateEvent(s))}),i.\u0275\u0275elementEnd()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("messages",t.messages)("targetLanguage",t.targetLanguageCode)("sourceLanguage",t.chat.languageCode)}}function WS(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",85),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.statusText)}}function $S(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"label",86),i.\u0275\u0275element(1,"span",87),i.\u0275\u0275elementStart(2,"span",88),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"span",89),i.\u0275\u0275listener("click",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.removeAttachment(s))}),i.\u0275\u0275elementEnd()()}if(a&2){const t=e.$implicit;i.\u0275\u0275attribute("file-name",t.name),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(t.name)}}function GS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-translate-toggle",91,9),i.\u0275\u0275listener("translationReady",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(r.onTranslationReady(s))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275propertyInterpolate("sourceText",t.inputMessageContainer.nativeElement.innerText),i.\u0275\u0275property("targetLanguageCode",(t.selectedLanguage==null?null:t.selectedLanguage.code)||t.chat.languageCode)("iconPosition",t.iconPositionEnum.OnlyIcon)}}function QS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-auto-translate-toggle",92,9),i.\u0275\u0275listener("translationReady",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(r.onTranslationReady(s))}),i.\u0275\u0275elementEnd()}if(a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("targetLanguageCode",(t.selectedLanguage==null?null:t.selectedLanguage.code)||t.chat.languageCode)("iconPosition",t.iconPositionEnum.OnlyIcon)("translateTrigger$",t.autoTranslateTrigger$.asObservable())}}function JS(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275template(1,GS,2,3,"crt-translate-toggle",90)(2,QS,2,3,"ng-template",null,8,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275reference(3),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!n.isAutoTranslateOutgoingEnabled)("ngIfElse",t)}}function qS(a,e){a&1&&(i.\u0275\u0275namespaceSVG(),i.\u0275\u0275elementStart(0,"svg",93),i.\u0275\u0275element(1,"circle",94),i.\u0275\u0275elementEnd())}class He{static{this.CURRENT_CHAT_CACHE_NAME="current_chat_in_conversation"}set chat(e){const t=e?.id!==this._chat?.id;this._chat=e,t&&this._chat?.id&&(this._reloadChat(),this._loadMessageTemplate())}get chat(){return this._chat}constructor(e,t,n,s,r,o,l,d,h,f,I,O,B,J){this.chatService=e,this._userInfo=t,this.ref=n,this._translateService=s,this._deduplicationService=r,this._dialogService=o,this._processEngineService=l,this._messagingSysSettings=d,this._messageTemplateService=h,this.window=f,this.contactColorService=I,this.injector=O,this._userProfileService=B,this._sysSettingsService=J,this._initialized=!1,this._isComponentLoaded=!1,this._maxFileSize=25*1024*1024,this._overSizeFilesName=[],this._processActions=[],this._templateSearchString="",this._isAllLoaded=!1,this._chatTargetLanguageKey="chat_target_language",this.iconPositionEnum=En,this.messagesCounter=0,this.messageText="",this.duplicatesSearchText="",this.isChatCompleted=!1,this.statusText="",this.showSearchDuplicatesButton=!1,this.contactDuplicatesList=[],this.chosenFiles=[],this.isLoading=!0,this.isSending=!1,this.isChatTransferred=!1,this.isSummaryShow=!1,this.isTranslationPanelVisible=!0,this.isTranslationButtonRendered=!0,this.isAutoTranslateOutgoingEnabled=!1,this.autoTranslateTrigger$=new u.Subject,this.isFirstOpen=!1,this.contactClick=new i.EventEmitter,this.accountClick=new i.EventEmitter,this.backClick=new i.EventEmitter,this.duplicatesContactsClick=new i.EventEmitter,this._initializeLanguage(),this._sysSettingsService.getValueByCode("EnableChatTranslation").pipe((0,u.take)(1)).subscribe(te=>{this.useChatTranslationFeature=te})}_initializeLanguage(){this.targetLanguageCode=this.window.sessionStorage.getItem(this._chatTargetLanguageKey)||this._userInfo.cultureInfo.sysCultureName}_loadTranslationPanelState(){this._userProfileService.getProfile(Yg).subscribe({next:e=>{e?.isTranslationPanelVisible!==void 0&&(this.isTranslationPanelVisible=e.isTranslationPanelVisible,this._updateTranslationButtonHint(),this.ref.detectChanges())},error:()=>{this.isTranslationPanelVisible=!1}})}_saveTranslationPanelState(){const e={isTranslationPanelVisible:this.isTranslationPanelVisible};this._userProfileService.saveProfile(Yg,e).subscribe()}_updateTranslationButtonHint(){const e=this.isTranslationPanelVisible?"ChatSettings.ChatWindow.Actions.Translation.Hide":"ChatSettings.ChatWindow.Actions.Translation.Show";this.translationButtonHint=this.getHint(this._translateService.instant(e))}_replaceNbsps(e){return e.replace(/&nbsp;/gi," ")}_addNewMessage(e){this.messages.find(n=>n.id===e.id)||(this.messages.push(e),this._updateCounter(e),this.ref.detectChanges(),this._followToMessage(e.id),this.isLastMessageVisible&&this.scrollDown())}_updateCounter(e){e.direction===si.Incoming?this.messagesCounter++:this.messagesCounter=0}_saveScrollToStorage(){const e=this.conversationContainer.nativeElement.scrollTop;this.window.sessionStorage.setItem(`${this.chat.id}_scrollTop`,e)}_initScrollFromStorage(){const e=parseInt(this.window.sessionStorage.getItem(`${this.chat.id}_scrollTop`));e>=0?this.conversationContainer.nativeElement.scrollTop=e:this._scrollToNewMessages()}_initIntersectionObserver(){const e=this.messages[this.messages.length-1].id,t=this.conversationContainer.nativeElement,n={root:t,rootMargin:"0px",threshold:.5};t.addEventListener("scroll",this._saveScrollToStorage.bind(this)),this._observer=new IntersectionObserver(s=>{const r=s[0].isIntersecting;this._initialized||(this._scrollToNewMessages(),this._initialized=!0),this.isLastMessageVisible=r,this.ref.detectChanges()},n),this._followToMessage(e),this._observeFirstMessage(n)}_observeFirstMessage(e){const t=this.messages[0].id;this._observerFirstMessage=new IntersectionObserver(n=>{n[0].isIntersecting&&!this._isAllLoaded&&(this._observerFirstMessage.disconnect(),this.chatService.getAllConversation(this.chat.contact.id,this.chat.channelId||this.chat.channel.id,this.messages.length,this.targetLanguageCode).subscribe({next:r=>{r.length<Re.rowsCount&&(this._isAllLoaded=!0),this.messages=[...r,...this.messages],this.ref.detectChanges(),this._getMessageElementById(t).scrollIntoView(!0),this._observeFirstMessage(e)},error:r=>{throw new Error(r.message)}}))},e),this._observerFirstMessage.observe(this._getMessageElementById(t))}_followToMessage(e){this._observer.disconnect();const t=this._getMessageElementById(e);t&&this._observer.observe(t)}_getMessageElementById(e){return this.conversationContainer.nativeElement.querySelector("#message_"+e)}_scrollToNewMessages(){if(this.messagesCounter>0){const e=this.messages[this.messages.length-this.messagesCounter].id;this._getMessageElementById(e).scrollIntoView(!1)}}_loadConversation(){this.chatService.getAllConversation(this.chat.contact.id,this.chat.channelId||this.chat.channel.id,0,this.targetLanguageCode).subscribe({next:e=>{this._handleLoadConversation(e)},error:e=>{throw new Error(e.message)}})}_handleLoadConversation(e){if(e.length===0){this.isLoading=!1,this.ref.detectChanges();return}this.messages=e,this.ref.detectChanges(),this._isAllLoaded=e.length<Re.rowsCount,this.isFirstOpen&&this.scrollDown(),this._initIntersectionObserver(),this.chatService.markAsRead(this.chat.id),this.isLoading=!1,this._initScrollFromStorage(),this._setFirstMessageAuthor()}_loadMessageTemplate(){this.chatService.getMessageTemplate(this.chat.id).subscribe({next:e=>{this.messageTemplate=e},error:e=>{throw this.messageTemplate={},new Error(e.message)}})}_reloadChat(){this.isLoading=!0,this.chatService.getItem(this.chat.id).subscribe(e=>{e&&e.success&&(this.chat=e.result[0],this._evaluateLanguageDetectionFailure(),this._loadAutoTranslateOutgoingState(),this._isChatForCurrentOperator(this.chat)||this.chat.status.value===Wl.Completed?this._loadConversation():(this.backClick.emit(),this._dialogService.openInfoDialog(this._translateService.instant("ChatSettings.ChatWindow.AlreadyAssignedChat"))))})}_isChatForCurrentOperator(e){return e.operator?.value===this._userInfo.id||e.operator?.value===void 0||e.operator?.value===null}_setDuplicatesMessage(e){if(e.length>1){const t=this._translateService.instant("ChatSettings.Deduplication.DuplicatesFoundTemplate");this.duplicatesSearchText=we.String.format(t,e.length),this.contactDuplicatesList=e,this.isFirstOpen||this._openDuplicatesPage()}else this.duplicatesSearchText=this._translateService.instant("ChatSettings.Deduplication.DuplicatesNotFound"),this.contactDuplicatesList=[];this.ref.detectChanges()}_openDuplicatesPage(){this.duplicatesContactsClick.emit({contactsId:this.contactDuplicatesList,currentContactId:this.chat.contact.id})}_isCanSendMessage(){const e=this.getHasText(),t=this.chosenFiles&&this.chosenFiles.length>0;return(e||t)&&!this.isChatCompleted&&!this.isChatTransferred}_clearMessage(){this.messageText="",this.inputMessageContainer.nativeElement.innerText="",this.inputMessageContainer.nativeElement.focus(),this.chosenFiles=[]}_isAttachmentCanBeAdded(e){return e.size<=this._maxFileSize}_handleSendingResponse(e){e.Success||this._dialogService.openInfoDialog(e.ErrorMessage||e.error.error)}_loadActions(){this.chatService.getChatActions(this.chat.id).subscribe(e=>{this._processActions=e},e=>{throw new Error(e.message)})}_insertTemplateAtPosition(e,t){return e=e.replace(/<[^>]*>?/gm,""),e=this.messageText.slice(0,t)+e+this.messageText.slice(t),e=e.replace(/\n\s*\n/g,`
`),e=this._replaceNbsps(e),e}_runProcess(e){this._processEngineService.executeProcessByName(e,{ChatId:this.chat.id,ContactId:this.chat.contact.id}).subscribe()}_getTemplateSearchSequence(){const e=this.messageText.match(/\/\/(.+)/);return e&&e.length>0?e[1]:""}_searchEnabled(){return this.messageText.indexOf("//")!==-1}_insertTemplate(e,t,n){this._messageTemplateService.getTemplateText(e,this.chat.id).subscribe(s=>{this.messageText=this.messageText.replace("//"+this._templateSearchString,"");const r=this.messageText.length>0;this.messageText=this.inputMessageContainer.nativeElement.innerText=(0,mg.decode)(this._insertTemplateAtPosition(s.GetMultiLanguageTextTemplateResult.textTemplate,this.getCaretIndex())).toString(),typeof t=="function"&&(n?t.call(n):t()),this.cacheInputMessage(this.messageText),this.foundTemplateLanguage=r?null:s.GetMultiLanguageTextTemplateResult.foundTemplateLanguage})}_setInputFocus(){setTimeout(()=>this.inputMessageContainer.nativeElement.focus(),0);const e=document.createRange();e.selectNodeContents(this.inputMessageContainer.nativeElement),e.collapse(!1);const t=document.getSelection();t.removeAllRanges(),t.addRange(e)}_clearState(){this.isChatCompleted=!1,this.statusText=""}_loadCachedMessage(){const e=this.inputMessageContainer.nativeElement,t=this.window.sessionStorage.getItem(this.chat.id);t?(this.messageText=this.inputMessageContainer.nativeElement.innerText=t,setTimeout(()=>this._setInputFocus(),0)):setTimeout(()=>e.focus(),0)}_saveCurrentChatToStorage(){this.window.sessionStorage.setItem(He.CURRENT_CHAT_CACHE_NAME,this.chat.id)}_getDeduplicationParams(){return{schemaName:"Contact",primaryColumnValue:this.chat.contact.id,model:[{columnName:"Name",schemaName:"Contact",value:[this.chat.contact.name]}],columns:["Id","Name"]}}_getChannelLinkService(e){let t;switch(e){case pt.Telegram:t=this.injector.get(fc);break;case pt.FacebookMessenger:t=this.injector.get(gc);break;case pt.WhatsApp:t=this.injector.get(_c);break;default:console.log(`Channel link generator for provider ${e} was not found.`);break}return t}_setFirstMessageAuthor(){if(this.messages?.length>0){const e=this.messages.find(t=>t.direction===si.Incoming);if(!e)return;this.firstMessageAuthor=e.author}}_translate(e){const t={type:"crt.TranslateChatMessagesRequest",chatId:this.chat.id,sourceLanguage:e.sourceLanguage,targetLanguage:e.targetLanguage,$context:null};this._languagePicker&&this._languagePicker.setLanguageDetectionError(!1),Ae.instance.process(t).then(n=>{n?.length>0&&(n.forEach(s=>{const r=this.messages.findIndex(o=>o.id===s.id);r>-1?((0,T.isEmpty)(s.text)||(this.messages[r].text=s.text),this.messages[r].originalText=s.originalText,this.messages[r].isTranslated=!0):(s.isTranslated=!0,this.messages.push(s))}),this.ref.detectChanges())},n=>{if(this._languagePicker){const s=this._translateService.instant("MultilingualMessages.TranslationFailedHeader");this._languagePicker.setTranslationError(s)}})}_clearTranslationState(){this._senderTranslationToggle&&(this._senderTranslationToggle.isTranslated=!1)}_updateLanguage(){var e=this;return(0,S.A)(function*(){const t=yield _t.create("OmniChat"),n=e.selectedLanguage?.value;n&&(e.chat.languageCode=e.selectedLanguage?.code,yield t.update({Language:n},[{type:ne.PrimaryColumnValue,value:e.chat.id}]))})()}_getChatClosedStatusText(){const e=new Date,t=new Intl.DateTimeFormat(this._userInfo.cultureInfo.sysCultureName).format(e),n=Tu(e,this._userInfo.cultureInfo);return this._translateService.instant("ChatSettings.ChatWindow.ChatIsCompleted").replace("{datePart}",t).replace("{timePart}",n)}_evaluateLanguageDetectionFailure(){if(!(!this.chat||!this._languagePicker)&&this.useChatTranslationFeature){const e=this.chat?.languageCode;if(typeof e=="string"){const t=!e||e.trim()==="";this._languagePicker.setLanguageDetectionError(!!t)}}}_loadAutoTranslateOutgoingState(){this.chat&&this._sysSettingsService.getValueByCode("AutoTranslateOutgoingMessages",!1).subscribe(e=>{this.isAutoTranslateOutgoingEnabled=e})}_innerSendMessage(){this.messageTemplate.Message=this.messageText,this.isSending=!0,setTimeout(()=>{this.isSending=!1,this.ref.detectChanges()},2e3);let e;this.chosenFiles.length>0?e=this.chatService.sendMessageWithAttachments(this.messageTemplate,this.chosenFiles):e=this.chatService.sendMessage(this.messageTemplate),e.subscribe(this._handleSendingResponse.bind(this),this._handleSendingResponse.bind(this)),this._clearMessage(),this._clearTranslationState(),this.clearCachedMessage()}createChannelLink(){const e=this.chat?.channel?.provider?.id;this._getChannelLinkService(e)?.generate(this.chat).subscribe(n=>{this.channelLink=n})}processTemplateSuggestion(){this.templatesList.showTemplateSuggestionHint=this._searchEnabled();const e=this._getTemplateSearchSequence();this.templatesList.showTemplateSuggestionHint?(this._templateSearchString=this.templatesList.searchString=e,this._messageTemplateService.getTemplates(e,6).subscribe(t=>{this.templatesMenu=t,this.ref.detectChanges(),this._setInputFocus()}),this.templatesList.showTemplateSuggestionHint=!1):(this.templatesMenu=[],this.ref.detectChanges())}ngOnInit(){this._clearState(),q.checkArgumentEmpty("chat",this.chat),this.messagesCounter=this.chat.unprocessedMsgCount,this._loadActions(),this._loadCachedMessage(),this.isFirstOpen?this.searchContactDuplicates():this.showSearchDuplicatesButton=!0,this._isComponentLoaded=!0,this._saveCurrentChatToStorage(),this._updateTranslationButtonHint(),this._loadTranslationPanelState()}ngAfterViewInit(){this.transferChat.transferData={chatQueueId:this.chat.chatQueueId},this._evaluateLanguageDetectionFailure()}ngOnChanges(){this.createChannelLink()}getHint(e){return new ec({hintConfig:{displayValue:e,cssClasses:"omnichat-tooltip-hint"},componentType:sn})}completeChat(){this.chatService.completeChat(this.chat.id).subscribe(()=>{this.showCompleteChatMessage()})}scrollDown(){this.conversationContainer.nativeElement.scrollTop=this.conversationContainer.nativeElement.scrollHeight,this.isLastMessageVisible=!0}openContact(e){return this.contactClick.emit({contactId:e}),!1}toggleTranslationPanel(){this.isTranslationPanelVisible=!this.isTranslationPanelVisible,this._updateTranslationButtonHint(),this._saveTranslationPanelState(),this.isTranslationButtonRendered=!1,setTimeout(()=>{this.isTranslationButtonRendered=!0,this.ref.detectChanges()})}openAccount(e){return this.accountClick.emit({accountId:e}),!1}openTemplateLookup(){this.messageText=this.messageText.replace(/\/+$/,"")+"//",this.inputMessageContainer.nativeElement.textContent=this.messageText,this._setInputFocus(),this.processTemplateSuggestion()}getCaretIndex(){this.inputMessageContainer.nativeElement.focus();let e;if(window.getSelection){e=window.getSelection().getRangeAt(0);const t=e.cloneRange();t.selectNodeContents(this.inputMessageContainer.nativeElement),t.setEnd(e.endContainer,e.endOffset);let n=t.toString().length;return e.endContainer.previousElementSibling!==null?++n:n}return 0}sendMessage(){this._isCanSendMessage()&&(this.isAutoTranslateOutgoingEnabled&&this._senderTranslationToggle?.autoEnabled&&(!this.foundTemplateLanguage||this.chat.languageCode!==this.foundTemplateLanguage)?(this.autoTranslateTrigger$.next(this.inputMessageContainer.nativeElement.innerText),this.foundTemplateLanguage=null):this._innerSendMessage())}onKeyDown(e){this.templatesList.isMenuShown&&(e.key==="ArrowDown"||e.key==="ArrowUp")&&(this.templatesList.focusFirstItem(),e.preventDefault()),e.key==="Enter"&&!(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),this.sendMessage())}hideComponent(){this._isComponentLoaded=!1}getMenuActions(){const e=[];return this._processActions.length>0?(e.push({code:Ul.code,caption:this._translateService.instant("ChatSettings.ChatWindow.Actions.ProcessesDivider")}),this._processActions.forEach(t=>{e.push({caption:t.Caption,code:t.ProcessName})})):e.push({code:Ul.code,caption:this._translateService.instant("ChatSettings.ChatWindow.Actions.EmptyProcessesList")}),e}onMenuItemClick(e){this._runProcess(e)}backToChatsList(){this._observer?.disconnect(),this._observerFirstMessage?.disconnect(),this.backClick.emit()}isShownContactSearchButton(){return this.chat.channel?.provider?.id===pt.FacebookMessenger}getContactSearchLink(e){return`${this._messagingSysSettings.SearchInFacebookURL||"https://www.facebook.com/search/people/?q="}${e}`}searchContactDuplicates(){this.showSearchDuplicatesButton=!1;const e=this.chat.contact.name;if(this._deduplicationService.elasticDeduplicationEnabled){const t=this._getDeduplicationParams();this._deduplicationService.findDuplicatesOnSaveES(t).subscribe(n=>this._setDuplicatesMessage(n))}else this._deduplicationService.findDuplicatesOnSave({schemaName:"Contact",request:{Name:e}}).subscribe(t=>this._setDuplicatesMessage(t))}openDuplicatesPageClick(e){e.preventDefault(),this._openDuplicatesPage()}onSearchContactDuplicatesClick(e){e.preventDefault(),this.searchContactDuplicates()}onFileSelected(e){const t=e.target.files||[];if(t.length>0&&[...t].forEach(n=>{this._isAttachmentCanBeAdded(n)?this.chosenFiles.push(n):this._overSizeFilesName.push(n.name)}),this._overSizeFilesName.length>0){const n=we.String.format(this._translateService.instant("ChatSettings.ChatWindow.OversizeFiles"),this._overSizeFilesName.join(`
`));this._dialogService.openInfoDialog(n),this._overSizeFilesName=[]}this.inputMessageContainer.nativeElement.focus(),e.target.value=null}removeAttachment(e){const t=e.target.parentNode.getAttribute("file-name");this.chosenFiles=this.chosenFiles.filter(n=>t!==n.name)}onPaste(e){try{const t=e.clipboardData.files[0];if(t){const n=(0,b.formatDate)(t.lastModifiedDate||t.lastModified||new Date,"yyyy-MM-dd_HH-mm-ss","en-US"),s=new File([t],`image_${n}.png`,{type:t.type,lastModified:t.lastModified});this.chosenFiles.push(s)}}catch(t){console.error(t)}}openTransferMenu(){this.isChatTransferred||this.transferChat.openMenu()}onInput(e){this.messageText=e.target.innerText,this.processTemplateSuggestion(),this.foundTemplateLanguage=null,this.cacheInputMessage(this.messageText)}loadNextTemplates(){const e=this.templatesMenu.length,t=this._getTemplateSearchSequence();this._messageTemplateService.getNextTemplates(t,e,5).subscribe(n=>{n.length!==0&&(n.forEach(s=>{this.templatesMenu.find(o=>o.id===s.id)||(this.templatesMenu=[...this.templatesMenu.slice(),s])}),this.ref.detectChanges())})}onTemplateSelected(e){this._insertTemplate(e,this._setInputFocus,this)}onTemplateSelectorClosed(){this._setInputFocus()}showCompleteChatMessage(){this._isComponentLoaded&&(this.isChatCompleted||(this.isChatCompleted=!0,this.inputMessageContainer.nativeElement.innerText="",this.statusText=this._getChatClosedStatusText(),this.ref.detectChanges(),this.scrollDown()))}addMessageToConversation(e){if(!this._isComponentLoaded)return;const t=e.ChatId,n=e.Message;if(t.toLowerCase()===this.chat.id.toLowerCase()){if(n.time=new Date(n.time),n.author){const s=new $l(n.author.id,n.author.name,n.author.photoId);s.email=n.author.email,s.account=n.author.account,n.author=s}this._addNewMessage(n)}}markAsRead(){this._isComponentLoaded&&this.chatService.markAsRead(this.chat.id)}addSystemMessageToConversation(e){this.addMessageToConversation(e)}activateChat(e){this._observer?.disconnect(),this.chat=e.chat,this.ngOnInit()}clearCachedMessage(){this.window.sessionStorage.removeItem(this.chat.id)}cacheInputMessage(e){this.window.sessionStorage.setItem(this.chat.id,e)}isAttachmentDisabled(){return this.chat.channel?.provider?.id.toLowerCase()===pt.WhatsApp}onChatTransferred(){this.isChatTransferred=!0}toggleSummary(){this.isSummaryShow=!this.isSummaryShow}onTranslationReady(e){this.messageText=this.inputMessageContainer.nativeElement.innerText=e.translation,this.cacheInputMessage(this.messageText),this.isAutoTranslateOutgoingEnabled&&this._innerSendMessage()}onTranslateEvent(e){this._updateLanguage(),this._translate(e),this.targetLanguageCode=e.targetLanguage}getHasText(){return!(0,T.isEmpty)(this._replaceNbsps(this.messageText).trim())}onTargetLanguageChange(e){this.window.sessionStorage.setItem(this._chatTargetLanguageKey,e.code)}static{this.\u0275fac=function(t){return new(t||He)(i.\u0275\u0275directiveInject(Re),i.\u0275\u0275directiveInject(L.oq),i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(yc),i.\u0275\u0275directiveInject(Je),i.\u0275\u0275directiveInject(Xh),i.\u0275\u0275directiveInject("messagingSysSettings"),i.\u0275\u0275directiveInject(za),i.\u0275\u0275directiveInject(P.ZP),i.\u0275\u0275directiveInject(cn),i.\u0275\u0275directiveInject(i.Injector),i.\u0275\u0275directiveInject(Ma),i.\u0275\u0275directiveInject(Mt))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:He,selectors:[["ts-conversation"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(MS,5),i.\u0275\u0275viewQuery(IS,5),i.\u0275\u0275viewQuery(bS,7),i.\u0275\u0275viewQuery(SS,7),i.\u0275\u0275viewQuery(vS,7),i.\u0275\u0275viewQuery(TS,5)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n._senderTranslationToggle=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n._languagePicker=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.conversationContainer=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.inputMessageContainer=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.templatesList=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.transferChat=s.first)}},inputs:{chat:"chat",isFirstOpen:"isFirstOpen",activeChats:"activeChats"},outputs:{contactClick:"contactClick",accountClick:"accountClick",backClick:"backClick",duplicatesContactsClick:"duplicatesContactsClick"},features:[i.\u0275\u0275NgOnChangesFeature],decls:58,vars:53,consts:[["searchDuplicatesButton",""],["searchDuplicatesResult",""],["searchDuplicatesNotFound",""],["transferChat",""],["conversationContainer",""],["templatesList",""],["inputField",""],["languagePicker",""],["autoTranslateToggle",""],["senderTranslationToggle",""],["class","component-mask",4,"ngIf"],[1,"conversation-wrapper"],[1,"contact-info"],[1,"contact-info-header"],["data-item-marker","BackToChatsList",1,"left-arrow",3,"click"],[1,"back-button",3,"click"],[1,"spacer"],["class","translation-button","data-item-marker","TranslationButton",3,"libHintOverlay","click",4,"ngIf"],["class","close-chat","data-item-marker","CloseChat",3,"libHintOverlay","click",4,"ngIf"],[4,"ngIf","ngIfThen"],["target","_blank","class","open-in-facebook","rel","noopener",3,"href",4,"ngIf"],["class","transfer-chat","data-item-marker","TransferChat",3,"libHintOverlay","click",4,"ngIf"],[3,"chatTransferred","systemMessageTemplate","transferData"],[1,"header-menu-button",3,"menuItemClick","menuItems","cssClasses"],["class","contact-info-main",4,"ngIf"],[1,"contact-info-separator"],["class","chat-summary",4,"ngIf"],["class","translation-container",4,"ngIf"],[1,"conversation",3,"id"],[1,"messages",3,"messages","messagesCounter","chat","language","targetLanguageCode"],["class","status-row",4,"ngIf"],[1,"scroll-to-down-button",3,"click","hidden"],[1,"footer"],[1,"attachments-wrapper"],["contenteditable","false","class","preview-attachment",4,"ngFor","ngForOf"],[3,"loadNext","templateSelected","selectorClosed","menuItems"],[1,"input-wrapper"],[1,"send-attachment-button",3,"ngClass","libHintOverlay"],["data-item-marker","SendAttachment","type","file","name","attachment","multiple","",3,"change"],[1,"input-message-container"],["data-item-marker","ChatInputField",1,"input-message",3,"input","keydown","paste"],[1,"chat-message-input-actions-wrapper"],[4,"ngIf"],[1,"template-button",3,"click"],[3,"libHintOverlay"],[1,"template-icon"],[1,"send-button-with-spinner"],["data-item-marker","SendMessage",1,"send-button",3,"click"],["class","spin-container",4,"ngIf"],[1,"active-chats-container"],[3,"chatClick","initialActiveChats","currentChat"],[1,"component-mask"],["data-item-marker","TranslationButton",1,"translation-button",3,"click","libHintOverlay"],["data-item-marker","CloseChat",1,"close-chat",3,"click","libHintOverlay"],["data-item-marker","SearchDuplicates",1,"search-duplicates",3,"click","libHintOverlay"],[1,"search-duplicates","wide-button",3,"click","libHintOverlay"],[1,"duplicates-count"],[1,"search-duplicates","wide-button",3,"libHintOverlay"],["target","_blank","rel","noopener",1,"open-in-facebook",3,"href"],[1,"tooltip-hint",3,"libHintOverlay"],["data-item-marker","TransferChat",1,"transfer-chat",3,"click","libHintOverlay"],[1,"contact-info-main"],[1,"chat-contact-photo",3,"contact","contactColor"],["alt","",1,"channel-icon",3,"src"],[1,"contact-name",3,"click"],["class","account-info",3,"click",4,"ngIf"],[1,"account-info",3,"click"],[1,"account-icon"],[1,"chat-summary"],[1,"summary-icon-container"],[1,"summary-icon"],[1,"summary-content-container"],[1,"summary-title"],[1,"summary-toggle",3,"click"],[1,"toggle-arrow",3,"ngClass"],["class","summary-items",4,"ngIf"],[1,"summary-items"],[1,"summary-item"],[1,"item-title"],[1,"item-value"],["data-item-marker","ChatSummaryChannelLink","target","_blank",3,"href"],["class","summary-item",4,"ngIf"],[3,"href"],[1,"translation-container"],[3,"sourceLanguageChange","targetLanguageChange","translate","messages","targetLanguage","sourceLanguage"],[1,"status-row"],["contenteditable","false",1,"preview-attachment"],[1,"attachment-icon"],[1,"attachment-name"],[1,"attachment-remove",3,"click"],["translationKey","chat-editor",3,"sourceText","targetLanguageCode","iconPosition","translationReady",4,"ngIf","ngIfElse"],["translationKey","chat-editor",3,"translationReady","sourceText","targetLanguageCode","iconPosition"],["translationKey","chat-editor",3,"translationReady","targetLanguageCode","iconPosition","translateTrigger$"],[1,"spin-container"],["r","12","cy","16","cx","16"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275template(0,ES,1,0,"ts-mask",10),i.\u0275\u0275elementStart(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.backToChatsList())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(5,"div",15),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.backToChatsList())}),i.\u0275\u0275text(6),i.\u0275\u0275pipe(7,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(8,"div",16),i.\u0275\u0275template(9,DS,1,1,"div",17)(10,AS,2,3,"div",18)(11,OS,1,0,"div",19)(12,PS,1,0,"div",19)(13,kS,1,0,"div",19)(14,jS,2,3,"ng-template",null,0,i.\u0275\u0275templateRefExtractor)(16,RS,4,4,"ng-template",null,1,i.\u0275\u0275templateRefExtractor)(18,LS,4,4,"ng-template",null,2,i.\u0275\u0275templateRefExtractor)(20,VS,3,4,"a",20)(21,zS,2,3,"div",21),i.\u0275\u0275elementStart(22,"ts-chat-transfer",22,3),i.\u0275\u0275listener("chatTransferred",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onChatTransferred())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(24,"ts-compact-actions-menu",23),i.\u0275\u0275listener("menuItemClick",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onMenuItemClick(o))}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(25,BS,6,5,"div",24),i.\u0275\u0275element(26,"div",25),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(27,YS,12,12,"div",26)(28,ZS,3,3,"div",27),i.\u0275\u0275elementStart(29,"div",28,4),i.\u0275\u0275element(31,"crt-chat-messages",29),i.\u0275\u0275template(32,WS,2,1,"div",30),i.\u0275\u0275elementStart(33,"div",31),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.scrollDown())}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(34,"div",32)(35,"div",33),i.\u0275\u0275template(36,$S,5,2,"label",34),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(37,"ts-template-selector",35,5),i.\u0275\u0275listener("loadNext",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.loadNextTemplates())})("templateSelected",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onTemplateSelected(o))})("selectorClosed",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onTemplateSelectorClosed())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(39,"div",36)(40,"label",37),i.\u0275\u0275pipe(41,"translate"),i.\u0275\u0275elementStart(42,"input",38),i.\u0275\u0275listener("change",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onFileSelected(o))}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(43,"div",39)(44,"div",40,6),i.\u0275\u0275pipe(46,"translate"),i.\u0275\u0275listener("input",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onInput(o))})("keydown",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onKeyDown(o))})("paste",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.onPaste(o))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(47,"div",41),i.\u0275\u0275template(48,JS,4,2,"ng-container",42),i.\u0275\u0275elementStart(49,"button",43),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.openTemplateLookup())}),i.\u0275\u0275elementStart(50,"div",44),i.\u0275\u0275pipe(51,"translate"),i.\u0275\u0275element(52,"span",45),i.\u0275\u0275elementEnd()()()(),i.\u0275\u0275elementStart(53,"div",46)(54,"button",47),i.\u0275\u0275listener("click",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.sendMessage())}),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(55,qS,2,0,"svg",48),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275elementStart(56,"div",49)(57,"ts-active-chats",50),i.\u0275\u0275listener("chatClick",function(o){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.activateChat(o))}),i.\u0275\u0275elementEnd()()()}if(t&2){const s=i.\u0275\u0275reference(15),r=i.\u0275\u0275reference(17),o=i.\u0275\u0275reference(19),l=i.\u0275\u0275reference(38);i.\u0275\u0275property("ngIf",n.isLoading),i.\u0275\u0275advance(6),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(7,41,"ChatSettings.ChatWindow.Actions.Back")," "),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.chat&&n.useChatTranslationFeature&&n.isTranslationButtonRendered),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!n.isChatCompleted&&!n.isChatTransferred),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.isFirstOpen||!n.showSearchDuplicatesButton)&&n.contactDuplicatesList.length===0)("ngIfThen",o),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.isFirstOpen||!n.showSearchDuplicatesButton)&&n.contactDuplicatesList.length>1)("ngIfThen",r),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.showSearchDuplicatesButton)("ngIfThen",s),i.\u0275\u0275advance(7),i.\u0275\u0275property("ngIf",n.isShownContactSearchButton()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!n.isChatCompleted&&!n.isChatTransferred),i.\u0275\u0275advance(),i.\u0275\u0275property("systemMessageTemplate",n.messageTemplate)("transferData",i.\u0275\u0275pureFunction1(49,xS,n.chat.chatQueueId)),i.\u0275\u0275advance(2),i.\u0275\u0275property("menuItems",n.getMenuActions())("cssClasses","chat-menu-actions"),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.chat.contact),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.chat),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.chat&&n.useChatTranslationFeature&&n.isTranslationPanelVisible),i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate1("id","chat_",n.chat.id,""),i.\u0275\u0275advance(2),i.\u0275\u0275property("messages",n.messages)("messagesCounter",n.messagesCounter)("chat",n.chat)("language",n.selectedLanguage)("targetLanguageCode",n.targetLanguageCode),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.statusText),i.\u0275\u0275advance(),i.\u0275\u0275property("hidden",n.isLastMessageVisible),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngForOf",n.chosenFiles),i.\u0275\u0275advance(),i.\u0275\u0275property("menuItems",n.templatesMenu),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(51,wS,n.isAttachmentDisabled()))("libHintOverlay",n.getHint(i.\u0275\u0275pipeBind1(41,43,"ChatSettings.ChatWindow.AttachFile"))),i.\u0275\u0275advance(4),i.\u0275\u0275attribute("data-placeholder",i.\u0275\u0275pipeBind1(46,45,"ChatSettings.ChatWindow.NewMessagePlaceholder"))("contenteditable",!n.isChatCompleted&&!n.isChatTransferred),i.\u0275\u0275advance(4),i.\u0275\u0275property("ngIf",n.useChatTranslationFeature&&((n.selectedLanguage==null?null:n.selectedLanguage.code)||n.chat.languageCode)&&n.getHasText()),i.\u0275\u0275advance(2),i.\u0275\u0275property("libHintOverlay",n.getHint(i.\u0275\u0275pipeBind1(51,47,"MessageTemplate.QuickSearchHint"))),i.\u0275\u0275advance(2),i.\u0275\u0275classProp("template-icon-active",l.isMenuShown),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",n.isSending),i.\u0275\u0275advance(2),i.\u0275\u0275property("initialActiveChats",n.activeChats)("currentChat",n.chat)}},dependencies:[b.NgClass,b.NgForOf,b.NgIf,v.TranslateDirective,St,la,Ct,nn,yt,tt,on,ba,Cc,pc,mc,v.TranslatePipe],styles:['@charset "UTF-8";  .mat-mdc-table,   .mdc-list-item__primary-text{font-family:Open Sans,serif}  ts-lookup-dialog .mat-mdc-button-base.mat-primary{background-color:#006ce0}  .omnichat-tooltip-hint{margin:0 30px;min-width:60px;max-width:300px;display:inline-block;align-items:center;background:#fff;position:relative;width:max-content;color:#757575;border-radius:50px;border:none;z-index:1;font-size:11px;padding:5px;box-shadow:none;top:10px;text-align:center}  .actions-menu-panel.chat-menu-actions .mat-mdc-menu-content mat-divider{margin:0}  .actions-menu-panel.chat-menu-actions .mat-mdc-menu-content .menu-divider-caption{text-transform:initial}.conversation-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;font-family:Open Sans,sans-serif}.conversation-wrapper[_ngcontent-%COMP%]   .contact-info-separator[_ngcontent-%COMP%]{width:calc(100% - 30px);text-align:center;border-bottom:1px solid #e3e6ec;line-height:.1em;margin:17px 0 5px 17px}.conversation-wrapper[_ngcontent-%COMP%]   .translation-container[_ngcontent-%COMP%]{padding:0 0 8px;width:340px}.conversation[_ngcontent-%COMP%]{padding:0 15px;height:100%;overflow-y:auto;flex-grow:1}.conversation[_ngcontent-%COMP%]   .status-row[_ngcontent-%COMP%]{font-family:Open Sans,serif;font-size:11px;text-align:center;color:#999;margin-top:17px}.scroll-to-down-button[_ngcontent-%COMP%]{height:25px;width:25px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNSIgaGVpZ2h0PSIyNSIgdmlld0JveD0iMCAwIDI1IDI1Ij48ZGVmcz48c3R5bGU+LmEsLmIsLmR7ZmlsbDpub25lO30uYSwuYntzdHJva2U6IzgwOTViMzt9LmJ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5je3N0cm9rZTpub25lO308L3N0eWxlPjwvZGVmcz48ZyBjbGFzcz0iYSI+PGNpcmNsZSBjbGFzcz0iYyIgY3g9IjEyLjUiIGN5PSIxMi41IiByPSIxMi41Ii8+PGNpcmNsZSBjbGFzcz0iZCIgY3g9IjEyLjUiIGN5PSIxMi41IiByPSIxMiIvPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMS4yNSAxNi4xNikgcm90YXRlKC05MCkiPjxsaW5lIGNsYXNzPSJiIiB4MT0iOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTAuMzQgMS4yNSkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTIxMzIuNDc3LDMxMS4xODNsLTQtNCw0LTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMTI4LjgxNyAtMzA1LjkzMikiLz48L2c+PC9zdmc+);background-color:#fff;border-radius:50%;position:sticky;bottom:0;right:0;float:right;cursor:pointer;z-index:100}.message-author[_ngcontent-%COMP%]{margin-bottom:-13px;margin-top:17px}.contact-info[_ngcontent-%COMP%]{line-height:24px;padding-bottom:7px}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]{display:flex}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .pseudo-position[_ngcontent-%COMP%]{position:relative;width:0;height:0}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .wide-button[_ngcontent-%COMP%]{width:auto;padding-right:12px;padding-left:32px;background-position:12px center!important}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .left-arrow[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:12px;background-repeat:no-repeat;background-position:center;background-size:16px;margin-left:9px;cursor:pointer;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmIsLmN7ZmlsbDpub25lO30uYiwuY3tzdHJva2U6IzAwNmNlMDt9LmJ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0wLjMwMyAtMC4zMDQpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjE0OSAwLjE0OSkiPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMTU1IDAuMTU1KSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguOTIxIDkuMjcxKSI+PHBhdGggY2xhc3M9ImIiIGQ9Ik0tMjAyLjU1Niw4MTUuMDY4djQuODYzaDUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcxNy43NTQgLTQzNy4yMjkpIHJvdGF0ZSg0NSkiLz48L2c+PHBhdGggY2xhc3M9ImMiIGQ9Ik0tMjA2LDgxNy43OTJoNy44MzkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIxMC41NDEgLTgwOS4xMzcpIi8+PC9nPjwvZz48L3N2Zz4)}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{cursor:pointer;color:#006ce0;font-size:12px}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .translation-button[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:12px;background-repeat:no-repeat;background-position:center;margin-left:9px;cursor:pointer;background-size:16px;background-color:#0058ef;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTcuNDkxMzQgMi43MjMwNUM3LjQ5MTM0IDIuMzIyNjQgNy4xNTM1MiAxLjk5ODA1IDYuNzM2ODEgMS45OTgwNUM2LjMyMDA5IDEuOTk4MDUgNS45ODIyNyAyLjMyMjY0IDUuOTgyMjcgMi43MjMwNVYyLjkxMDc3SDIuNzU0NTNDMi4zMzc4MiAyLjkxMDc3IDIgMy4yMzUzNiAyIDMuNjM1NzdDMiA0LjAzNjE4IDIuMzM3ODIgNC4zNjA3NyAyLjc1NDUzIDQuMzYwNzdIOC4xMDQ2QzcuOTc2NDcgNC42NDY1NSA3LjgzOTMxIDQuOTI1NTIgNy42OTU1NCA1LjE5Njc3QzcuMjg0MSA1Ljk3MzA1IDYuODE4NTkgNi42ODYxMSA2LjM1NjE0IDcuMzE0ODlDNi4wMzA1MiA2LjgyODAxIDUuNzIyNjEgNi4zMjA4NCA1LjQyNTg3IDUuNzk5NzFDNS4yMjU4NSA1LjQ0ODQ1IDQuNzY3MzQgNS4zMTk0OSA0LjQwMTc3IDUuNTExNjhDNC4wMzYxOSA1LjcwMzg3IDMuOTAxOTkgNi4xNDQ0MyA0LjEwMiA2LjQ5NTdDNC40OTYwMSA3LjE4NzYzIDQuOTE4NTcgNy44NzMzOSA1LjM4NDc0IDguNTMyNDVDNS4wMTM3NSA4Ljk2MjQ4IDQuNjgwMzIgOS4zMTI4NSA0LjQyNDUgOS41NjkyNUM0LjI2MjUzIDkuNzMxNTkgNC4xMzIwNSA5Ljg1NTg3IDQuMDQzMzQgOS45Mzg0NUM0LjAwMiA5Ljk3OTczIDMuOTY1MTMgMTAuMDEwNiAzLjk0MzAyIDEwLjAzMDVMMy45MTg4NSAxMC4wNTIxTDMuOTEzNjkgMTAuMDU2N0MzLjYwNTcyIDEwLjMyNjEgMy41ODI0MyAxMC43ODUgMy44NjI2NiAxMS4wODExQzQuMTQzIDExLjM3NzQgNC42MjAyIDExLjM5OTIgNC45Mjg1MiAxMS4xMjk4TDQuNDIwOTIgMTAuNTkzNEM0LjkyODUyIDExLjEyOTggNC45MjgzNyAxMS4xMyA0LjkyODUyIDExLjEyOThMNC45MzAxNiAxMS4xMjg0TDQuOTMzMDMgMTEuMTI1OUw0Ljk0MjM5IDExLjExNzZMNC45NzUxMyAxMS4wODgzQzUuMDAzMDQgMTEuMDYzMiA1LjA0MjkgMTEuMDI2OSA1LjA5MzM5IDEwLjk3OTlDNS4xOTQzNiAxMC44ODU5IDUuMzM4MDEgMTAuNzQ4OSA1LjUxMzgzIDEwLjU3MjdDNS43MzQ4IDEwLjM1MTIgNi4wMDcxOSAxMC4wNjcxIDYuMzA5OTMgOS43Mjc2QzYuNTQ4MDYgMTAuMDA3MiA2Ljc5NzA0IDEwLjI3ODYgNy4wNTgyNiAxMC41NDAxQzcuMzQ2ODMgMTAuODI5IDcuODI0NDcgMTAuODM4NCA4LjEyNTExIDEwLjU2MTFDOC40MjU3NCAxMC4yODM5IDguNDM1NTMgOS44MjQ5MiA4LjE0Njk3IDkuNTM2MDVDOC4xNDA5NCA5LjIyOTY5IDcuNTUxNDMgOC45MDU1NCA3LjI3NTU3IDguNTY2MzdDOC4xNDE5MSA3LjQ0NzUyIDkuMDgwMDggNi4wMDU3MSA5LjczMjk5IDQuMzYwNzdIMTAuNzE1MUMxMS4xMzE4IDQuMzYwNzcgMTEuNDY5NiA0LjAzNjE4IDExLjQ2OTYgMy42MzU3N0MxMS40Njk2IDMuMjM1MzYgMTEuMTMxOCAyLjkxMDc3IDEwLjcxNTEgMi45MTA3N0g5LjIyMDI2QzkuMjA4NTUgMi45MTA1MSA5LjE5Njg3IDIuOTEwNTEgOS4xODUyMiAyLjkxMDc3SDcuNDkxMzRWMi43MjMwNVoiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOS44ODQ0NyA3LjQ0ODAxQzEwLjIxNTkgNi42Nzk5NyAxMS4zNTE2IDYuNjg5NCAxMS42NjkyIDcuNDYyODRMMTMuOTQ3MSAxMy4wMTAxQzE0LjEwMDEgMTMuMzgyNiAxMy45MDk4IDEzLjgwMzYgMTMuNTIyMiAxMy45NTA2QzEzLjEzNDYgMTQuMDk3NiAxMi42OTYzIDEzLjkxNDggMTIuNTQzNCAxMy41NDIzTDExLjkxNDggMTIuMDExNkw5LjU0ODYgMTIuMDExNkw4Ljg4Mjk5IDEzLjU1MzlDOC43MjMzNyAxMy45MjM4IDguMjgxOTIgMTQuMDk5MyA3Ljg5Njk5IDEzLjk0NTlDNy41MTIwNSAxMy43OTI1IDcuMzI5NDEgMTMuMzY4NCA3LjQ4OTAzIDEyLjk5ODVMOC4yNzY5NyAxMS4xNzI4QzguMjk1OTIgMTEuMDU3NCA4LjM0MzE4IDEwLjk1MTEgOC40MTE3MSAxMC44NjA2TDkuODg0NDcgNy40NDgwMVpNMTAuMTc0NCAxMC41NjE2SDExLjMxOTRMMTAuNzYxMSA5LjIwMjA4TDEwLjE3NDQgMTAuNTYxNloiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=)}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .close-chat[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:12px;background-repeat:no-repeat;background-position:center;background-size:16px;margin-left:9px;cursor:pointer;background-size:11px;background-position-y:calc(50% + 1px);background-color:#009688;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMi43MDciIHZpZXdCb3g9IjAgMCAxMiAxMi43MDciPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiNmZmY7c3Ryb2tlOiNmZmY7c3Ryb2tlLW1pdGVybGltaXQ6MTA7fS5ie2ZpbGw6IzAwOTY4ODtmaWxsLXJ1bGU6ZXZlbm9kZDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC41IDAuNSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTM4Ny42ODUsMzgyLjcyNmgyLjUzOHYyLjUzOGwyLjUzOC0yLjUzOGg1LjkyM3YtOC40NjJoLTExWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzg3LjY4NSAtMzc0LjI2NCkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTEyODguNzQxLDQ3My43MDlhLjU4NC41ODQsMCwwLDAtLjgyNywwbC0yLjcxOSwyLjctMS0xYS41ODUuNTg1LDAsMCwwLS44My44MjRsMS40MDcsMS40MTZhLjU4Ny41ODcsMCwwLDAsLjgyNiwwbDMuMTM0LTMuMTA4YS41ODMuNTgzLDAsMCwwLDAtLjgyNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyNzkuNzAxIC00NzEuMjU1KSIvPjwvZz48L3N2Zz4)}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .search-duplicates[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:12px;background-repeat:no-repeat;background-position:center;background-size:16px;margin-left:9px;cursor:pointer;width:auto;min-width:24px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNi4zNTMiIHZpZXdCb3g9IjAgMCAxNiAxNi4zNTMiPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiNmZmY7fS5hLC5ie3N0cm9rZTojZmZmO3N0cm9rZS1taXRlcmxpbWl0OjEwO30uYiwuY3tmaWxsOm5vbmU7fS5ke3N0cm9rZTpub25lO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxIDAuNSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTQ1My4wNDgsNDg0LjkzNWgtNS41YTUuOTkzLDUuOTkzLDAsMCwxLDYuMjUtNC44ODEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ1OC41NDggLTQ3MS45MzUpIi8+PGNpcmNsZSBjbGFzcz0iYSIgY3g9IjMiIGN5PSIzIiByPSIzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzKSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYuNSA4KSI+PGcgY2xhc3M9ImEiPjxjaXJjbGUgY2xhc3M9ImQiIGN4PSIzIiBjeT0iMyIgcj0iMyIvPjxjaXJjbGUgY2xhc3M9ImMiIGN4PSIzIiBjeT0iMyIgcj0iMi41Ii8+PC9nPjxsaW5lIGNsYXNzPSJiIiB4Mj0iMyIgeTI9IjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQuNSA0LjUpIi8+PC9nPjwvZz48cmVjdCBjbGFzcz0iYyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+);background-color:#604edc}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .search-duplicates[_ngcontent-%COMP%]   .duplicates-count[_ngcontent-%COMP%]{color:#fff;line-height:24px;font-size:12px}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .transfer-chat[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:12px;background-repeat:no-repeat;background-position:center;margin-left:9px;cursor:pointer;background-size:16px;background-color:#05a9f3;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmN7ZmlsbDojZmZmO30uYSwuYntzdHJva2U6I2ZmZjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmIsLmR7ZmlsbDpub25lO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NTkuNTQ4IC00NzEuNDM1KSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tNDUzLjA0OCw0ODQuOTM1aC01LjVhNS45OTMsNS45OTMsMCwwLDEsNi4yNS00Ljg4MSIvPjxjaXJjbGUgY2xhc3M9ImEiIGN4PSIzIiBjeT0iMyIgcj0iMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQ1NS41NDggNDcxLjkzNSkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTS01NTQuNDc3LDQ4Mi4wMDdhMy4yNCwzLjI0LDAsMCwwLC43ODEsMy4zMjQsMy4yMzcsMy4yMzcsMCwwLDAsNC41NzksMCwzLjIzOSwzLjIzOSwwLDAsMCwwLTQuNTc5LDMuMjI3LDMuMjI3LDAsMCwwLTIuNDY5LS45NDQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwMy4wOTcgMC40MzEpIi8+PHBhdGggY2xhc3M9ImMiIGQ9Ik0tNTUwLjU2NSw0NzhsLTMsMiwzLDJaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMDMuMDE4IDAuNDMxKSIvPjwvZz48cmVjdCBjbGFzcz0iZCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+)}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .open-in-facebook[_ngcontent-%COMP%]{display:block;height:24px;width:24px;border-radius:12px;background-repeat:no-repeat;background-position:center;background-size:16px;margin-left:9px;cursor:pointer;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDE2IDE2OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8cGF0aCBzdHlsZT0iZmlsbDojRkZGRkZGOyIgZD0iTTkuMzIsMTYuMDJ2LTguMWgyLjE5YzAuMTMtMC44OSwwLjI0LTEuNzksMC4zNS0yLjY4SDkuMzJjMC0wLjA2LTAuMDItMS4zOCwwLTEuOTkNCgljMC0wLjI4LDAuMTgtMC41MSwwLjQzLTAuNjdjMC4xNC0wLjEsMC4zLTAuMTYsMC40OS0wLjE0YzAuMjYsMCwxLjQtMC4wMiwxLjY5LTAuMDJ2LTIuNGMtMC4wNiwwLTAuMSwwLTAuMTQsMA0KCWMtMC42OSwwLTEuNCwwLTIuMDksMGMtMC40MywwLTAuODUsMC4wNi0xLjI0LDAuMjJjLTAuNTEsMC4yMi0wLjkxLDAuNTUtMS4yNiwxQzYuOTQsMS41OCw2Ljc2LDEuOTUsNi42OCwyLjM2DQoJQzYuNjQsMi41OCw2LjYyLDIuOCw2LjYyLDMuMDVjMCwwLjY3LDAsMi4xNSwwLDIuMTVjLTAuMDYsMC0yLjE3LDAuMDItMi4yMSwwLjAyYzAsMC44NywwLDEuNzcsMCwyLjY0YzAuNDEsMCwxLjgxLDAsMi4wOSwwDQoJYzAuMDgsMCwwLjEyLDAuMDIsMC4xMiwwLjEyYzAsMC4wNiwwLDguMDQsMCw4LjA0Ii8+DQo8L3N2Zz4);background-color:#006ce0}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .header-menu-button[_ngcontent-%COMP%]{padding:5px}.contact-info[_ngcontent-%COMP%]   .contact-info-header[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{flex:1 auto}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]{text-align:center}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]     .chat-contact-photo .contact-photo{width:48px;height:48px;border-radius:50%;cursor:auto;right:1.3em;line-height:2.7em;font-size:1.8em}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]     .chat-contact-photo .channel-icon{display:inline-block;background:#fff;border-radius:50%;width:18px;height:18px;padding:1px;position:relative;right:1.3em;bottom:-1.8em}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]     .chat-contact-photo img.contact-photo+.channel-icon{bottom:0}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]   .contact-name[_ngcontent-%COMP%]{color:#006ce0;font-size:22px;padding-top:8px;cursor:pointer}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]   .account-info[_ngcontent-%COMP%]{font-size:12px;color:#757575}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]   .account-info[_ngcontent-%COMP%]   .account-icon[_ngcontent-%COMP%]{height:16px;width:16px;display:inline-block;margin-bottom:-2px;background-repeat:no-repeat;background-position:center;background-size:16px;cursor:pointer;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZmZmO30uYntmaWxsOm5vbmU7c3Ryb2tlOiMwMDZjZTA7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNDc2IC0xNDQpIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDc2IDE0NCkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTAsMCwzLjQ5MSwzLjQzNiwwLDYuODY0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDgwLjc1NSAxNTAuMjU2KSIvPjwvZz48L3N2Zz4)}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]   .account-info[_ngcontent-%COMP%]   .account-icon[_ngcontent-%COMP%]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZmZmO30uYntmaWxsOm5vbmU7c3Ryb2tlOiMwMDZjZTA7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNDc2IC0xNDQpIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDc2IDE0NCkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTAsMCwzLjQ5MSwzLjQzNiwwLDYuODY0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDg0LjUwOSAxNTAuMjU2KSIvPjxwYXRoIGNsYXNzPSJiIiBkPSJNMCwwLDMuNDkxLDMuNDM2LDAsNi44NjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0ODAgMTUwLjI1NikiLz48L2c+PC9zdmc+)}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]   .account-info[_ngcontent-%COMP%]:hover{color:#006ce0;cursor:pointer}.contact-info[_ngcontent-%COMP%]   .contact-info-main[_ngcontent-%COMP%]   .account-info[_ngcontent-%COMP%]:hover   .account-icon[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZmZmO30uYntmaWxsOm5vbmU7c3Ryb2tlOiMwMDZjZTA7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNDc2IC0xNDQpIj48cmVjdCBjbGFzcz0iYSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDc2IDE0NCkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTAsMCwzLjQ5MSwzLjQzNiwwLDYuODY0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDg0LjUwOSAxNTAuMjU2KSIvPjxwYXRoIGNsYXNzPSJiIiBkPSJNMCwwLDMuNDkxLDMuNDM2LDAsNi44NjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0ODAgMTUwLjI1NikiLz48L2c+PC9zdmc+)}.footer[_ngcontent-%COMP%]{margin-left:17px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-end;flex-grow:.1;margin-top:10px;margin-bottom:20px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]{border:1px solid #c8c8c8;border-radius:15px;margin:5px 0 0;width:100%;resize:none;outline:none;min-height:32px;max-height:212px;overflow:auto;color:#181818;font-size:14px;font-family:Open Sans,serif;-moz-appearance:textfield;background-color:#eaedf3;background-color:-moz-field;padding:5px 48px 8px 8px;overflow-wrap:break-word;word-break:break-word;word-wrap:break-word;-moz-margin-end:-5px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]:has( + .chat-message-input-actions-wrapper[_ngcontent-%COMP%]   crt-translate-toggle)[_ngcontent-%COMP%]{padding-right:54px}@-moz-document url-prefix(){.footer .input-wrapper .input-message{scrollbar-width:thin}}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]:before{content:"\\feff"}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]:empty:before{content:attr(data-placeholder);color:#757575;font-size:12px;padding-top:5px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]:empty:focus:before{content:""}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar{-webkit-appearance:none;width:5px;height:5px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message[_ngcontent-%COMP%]   [_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .input-message-container[_ngcontent-%COMP%]{position:relative;flex:1 1 auto;display:flex;flex-direction:column}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .chat-message-input-actions-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:4px;right:12px;display:flex;align-items:flex-end;gap:6px;z-index:2}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .chat-message-input-actions-wrapper[_ngcontent-%COMP%]   .template-button[_ngcontent-%COMP%]{border:0;background:transparent;width:16px;height:16px;padding:0}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .chat-message-input-actions-wrapper[_ngcontent-%COMP%]   .template-button[_ngcontent-%COMP%]:focus{outline:none}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .chat-message-input-actions-wrapper[_ngcontent-%COMP%]   .template-icon[_ngcontent-%COMP%]{width:16px;height:16px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzgwOTViMztzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC41IDEuNSkiPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMTUiIGhlaWdodD0iMTMiIHJ4PSIxIi8+PGxpbmUgY2xhc3M9ImEiIHgyPSIxNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCA0KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIgMikiLz48bGluZSBjbGFzcz0iYSIgeTI9IjgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQgNC41KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiA3KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiAxMCkiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjwvc3ZnPg==);display:inline-block;cursor:pointer}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .chat-message-input-actions-wrapper[_ngcontent-%COMP%]   .template-icon[_ngcontent-%COMP%]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzAwNmNlMDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE2MDYgLTc2OCkiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2MDYuNSA3NjkuNSkiPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMTUiIGhlaWdodD0iMTMiIHJ4PSIxIi8+PGxpbmUgY2xhc3M9ImEiIHgyPSIxNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCA0KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIgMikiLz48bGluZSBjbGFzcz0iYSIgeTI9IjgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQgNC41KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiA3KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiAxMCkiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTYwNiA3NjgpIi8+PC9nPjwvc3ZnPg==)}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .chat-message-input-actions-wrapper[_ngcontent-%COMP%]   .template-icon-active[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzAwNmNlMDtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE2MDYgLTc2OCkiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2MDYuNSA3NjkuNSkiPjxyZWN0IGNsYXNzPSJhIiB3aWR0aD0iMTUiIGhlaWdodD0iMTMiIHJ4PSIxIi8+PGxpbmUgY2xhc3M9ImEiIHgyPSIxNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCA0KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iMTEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIgMikiLz48bGluZSBjbGFzcz0iYSIgeTI9IjgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQgNC41KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiA3KSIvPjxsaW5lIGNsYXNzPSJhIiB4Mj0iNyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNiAxMCkiLz48L2c+PHJlY3QgY2xhc3M9ImIiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTYwNiA3NjgpIi8+PC9nPjwvc3ZnPg==)}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-button-with-spinner[_ngcontent-%COMP%]{position:relative;width:36px;height:36px;display:flex;align-items:flex-start;min-width:36px;max-width:36px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-button-with-spinner[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]{padding:5px 0;border:0;color:#fff;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO30uYiwuZHtmaWxsOiMwMDZjZTA7fS5ie3N0cm9rZS1saW5lY2FwOnJvdW5kO30uYywuZHtzdHJva2U6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHJlY3QgY2xhc3M9ImEiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjxnIGNsYXNzPSJiIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNTE3Ljg0OSAxLjM0NSkiPjxwYXRoIGNsYXNzPSJjIiBkPSJNIC0yNTE2LjgzOTExMTMyODEyNSAxMy42MjYxNDE1NDgxNTY3NCBMIC0yNTE2LjUxMzY3MTg3NSAxMi4yOTI2MTMwMjk0Nzk5OCBMIC0yNTE2LjUwMDk3NjU2MjUgMTIuMjQwMDUzMTc2ODc5ODggTCAtMjUxNi40OTk3NTU4NTkzNzUgMTIuMTg1OTczMTY3NDE5NDMgTCAtMjUxNi4zOTk2NTgyMDMxMjUgNy45Njc4MTE1ODQ0NzI2NTYgTCAtMjUxMC40MjI4NTE1NjI1IDcuMjYwNTQzMzQ2NDA1MDI5IEwgLTI1MTAuNDIyODUxNTYyNSA2LjI2NzQ2MzIwNzI0NDg3MyBMIC0yNTE2LjM5OTY1ODIwMzEyNSA1LjU2MDE5NDk2OTE3NzI0NiBMIC0yNTE2LjQ5OTc1NTg1OTM3NSAxLjM0MjAzMzI2NzAyMTE3OSBMIC0yNTE2LjUwMDk3NjU2MjUgMS4yODc5NTMyNTc1NjA3MyBMIC0yNTE2LjUxMzY3MTg3NSAxLjIzNTM5MzI4NTc1MTM0MyBMIC0yNTE2LjgzNjE4MTY0MDYyNSAtMC4wODY3NTA0NzAxMDE4MzMzNCBDIC0yNTExLjc4OTMwNjY0MDYyNSAyLjM2MjkzNDgyNzgwNDU2NSAtMjUwNS4wODY5MTQwNjI1IDUuNjU1MzkxMjE2Mjc4MDc2IC0yNTAzLjAxNDg5MjU3ODEyNSA2Ljc3MDQ1Mjk3NjIyNjgwNyBDIC0yNTA0LjE5MjEzODY3MTg3NSA3LjQ0MDAxOTYwNzU0Mzk0NSAtMjUwNy41MzY2MjEwOTM3NSA5LjIwNzkxMDUzNzcxOTcyNyAtMjUxNi44MzkxMTEzMjgxMjUgMTMuNjI2MTQxNTQ4MTU2NzQgWiIvPjxwYXRoIGNsYXNzPSJkIiBkPSJNIC0yNTE2LjEwNDAwMzkwNjI1IDEyLjcyMjk1NDc1MDA2MTA0IEMgLTI1MDkuMDA5Mjc3MzQzNzUgOS4zNDM5NDgzNjQyNTc4MTMgLTI1MDUuNjQ3NDYwOTM3NSA3LjYzMTU5NzA0MjA4Mzc0IC0yNTA0LjA2NzM4MjgxMjUgNi43ODI1NTcwMTA2NTA2MzUgQyAtMjUwNi41NTU5MDgyMDMxMjUgNS40OTY4NDM4MTQ4NDk4NTQgLTI1MTEuODU2Njg5NDUzMTI1IDIuODkxMjE5MTM5MDk5MTIxIC0yNTE2LjA5ODYzMjgxMjUgMC44Mjc3MTUwMzkyNTMyMzQ5IEwgLTI1MTYuMDI4MDc2MTcxODc1IDEuMTE2ODkzMjkxNDczMzg5IEwgLTI1MTYuMDAyNDQxNDA2MjUgMS4yMjIwMTMyMzUwOTIxNjMgTCAtMjUxNS45OTk3NTU4NTkzNzUgMS4zMzAxNzMyNTQwMTMwNjIgTCAtMjUxNS45MDk5MTIxMDkzNzUgNS4xMTQ2NDY0MzQ3ODM5MzYgTCAtMjUxMC4zNjQyNTc4MTI1IDUuNzcwOTMzMTUxMjQ1MTE3IEwgLTI1MTAuMzY0MjU3ODEyNSA3Ljc1NzA3MzQwMjQwNDc4NSBMIC0yNTE1LjkwOTkxMjEwOTM3NSA4LjQxMzM1OTY0MjAyODgwOSBMIC0yNTE1Ljk5OTc1NTg1OTM3NSAxMi4xOTc4MzMwNjEyMTgyNiBMIC0yNTE2LjAwMjQ0MTQwNjI1IDEyLjMwNTk5MzA4MDEzOTE2IEwgLTI1MTYuMDI4MDc2MTcxODc1IDEyLjQxMTExMzczOTAxMzY3IEwgLTI1MTYuMTA0MDAzOTA2MjUgMTIuNzIyOTU0NzUwMDYxMDQgTSAtMjUxNy41NzM3MzA0Njg3NSAxNC41MjgwMDM2OTI2MjY5NSBMIC0yNTE2Ljk5OTUxMTcxODc1IDEyLjE3NDExMzI3MzYyMDYxIEwgLTI1MTYuODg5MTYwMTU2MjUgNy41MjIyNTM1MTMzMzYxODIgTCAtMjUxMC40ODE2ODk0NTMxMjUgNi43NjQwMDMyNzY4MjQ5NTEgTCAtMjUxNi44ODkxNjAxNTYyNSA2LjAwNTc1MzA0MDMxMzcyMSBMIC0yNTE2Ljk5OTUxMTcxODc1IDEuMzUzODkzMjgwMDI5Mjk3IEwgLTI1MTcuNTczNzMwNDY4NzUgLTAuOTk5OTk2NzIxNzQ0NTM3NCBDIC0yNTE3LjU3MzczMDQ2ODc1IC0wLjk5OTk5NjcyMTc0NDUzNzQgLTI1MDIuMTgxMzk2NDg0Mzc1IDYuNDU1MjYzMTM3ODE3MzgzIC0yNTAyLjA2NzM4MjgxMjUgNi43NjAxNTMyOTM2MDk2MTkgTCAtMjUwMi4wNjQ5NDE0MDYyNSA2Ljc2MDE1MzI5MzYwOTYxOSBMIC0yNTAyLjA2Mzk2NDg0Mzc1IDYuNzYwMTUzMjkzNjA5NjE5IEwgLTI1MDIuMDY0NDUzMTI1IDYuNzYwNTUzMzU5OTg1MzUyIEMgLTI1MDIuMDY0OTQxNDA2MjUgNi43NjE3MDM0OTEyMTA5MzggLTI1MDIuMDY1NDI5Njg3NSA2Ljc2Mjg1MzE0NTU5OTM2NSAtMjUwMi4wNjU5MTc5Njg3NSA2Ljc2NDAwMzI3NjgyNDk1MSBDIC0yNTAyLjA2NTQyOTY4NzUgNi43NjUxNDMzOTQ0NzAyMTUgLTI1MDIuMDY0OTQxNDA2MjUgNi43NjYzMDMwNjI0Mzg5NjUgLTI1MDIuMDY0NDUzMTI1IDYuNzY3NDUzMTkzNjY0NTUxIEwgLTI1MDIuMDYzOTY0ODQzNzUgNi43Njc4NTMyNjAwNDAyODMgTCAtMjUwMi4wNjQ5NDE0MDYyNSA2Ljc2Nzg1MzI2MDA0MDI4MyBMIC0yNTAyLjA2NzM4MjgxMjUgNi43Njc4NTMyNjAwNDAyODMgQyAtMjUwMi4wNjczODI4MTI1IDYuNzY3ODUzMjYwMDQwMjgzIC0yNTAyLjcwMTkwNDI5Njg3NSA3LjQ4MzMzMzExMDgwOTMyNiAtMjUxNy41NzM3MzA0Njg3NSAxNC41MjgwMDM2OTI2MjY5NSBaIi8+PC9nPjwvc3ZnPg);margin:3px auto 0;display:block;cursor:pointer;outline:0;width:16px;min-width:16px;height:16px;background-repeat:no-repeat;background-color:transparent;align-self:center}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-button-with-spinner[_ngcontent-%COMP%]   .spin-container[_ngcontent-%COMP%]{width:32px;height:32px;position:absolute;animation:_ngcontent-%COMP%_sendSpin 2s infinite;top:4px;display:inline;flex:none}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-button-with-spinner[_ngcontent-%COMP%]   .spin-container[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{fill:none;stroke-width:1;stroke:#006ce0;stroke-linecap:round;animation:_ngcontent-%COMP%_fillSpin 2s linear infinite}@keyframes _ngcontent-%COMP%_sendSpin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_fillSpin{0%{stroke-dashoffset:0;stroke-dasharray:0 100}to{stroke-dashoffset:0;stroke-dasharray:100 0}}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-attachment-button[_ngcontent-%COMP%]{width:16px;min-width:16px;height:16px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYXtzdHJva2U6IzI4NDU3ODtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMi4xNjQgMS40MSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNLTIzOS4wNDYsNDEwLjEwNmwtNS41LDUuNDM1YTEuNDUxLDEuNDUxLDAsMCwwLDAsMiwxLjQ1MiwxLjQ1MiwwLDAsMCwyLDBsNi41NzQtNi40OWEyLjIsMi4yLDAsMCwwLDAtM2gwYTIuMiwyLjIsMCwwLDAtMywwbC03LjQ4Miw3LjU1YTIuOTM1LDIuOTM1LDAsMCwwLC4zMjYsMy40NCwyLjU2OCwyLjU2OCwwLDAsMCw0LjA4MiwwYzEuMjA5LTEuMjA5LDYtNS45OSw2LTUuOTkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI0Ni44ODIgLTQwNy40NjEpIi8+PC9nPjxyZWN0IGNsYXNzPSJiIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiLz48L3N2Zz4);display:block;cursor:pointer;margin-bottom:8px;margin-inline-end:5px}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-attachment-button[_ngcontent-%COMP%]:hover{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iQ29tcG9uZW50XzcxNl8xIiBkYXRhLW5hbWU9IkNvbXBvbmVudCA3MTYg4oCTIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPgogIDxnIGlkPSJHcm91cF81Nzg0IiBkYXRhLW5hbWU9Ikdyb3VwIDU3ODQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIuMTY1IDEuNDEpIj4KICAgIDxnIGlkPSJHcm91cF81NzgzIiBkYXRhLW5hbWU9Ikdyb3VwIDU3ODMiPgogICAgICA8cGF0aCBpZD0iUGF0aF80MjkyIiBkYXRhLW5hbWU9IlBhdGggNDI5MiIgZD0iTS0yMzkuMDQ2LDQxMC4xMDZsLTUuNSw1LjQzNWExLjQ1MSwxLjQ1MSwwLDAsMCwwLDIsMS40NTIsMS40NTIsMCwwLDAsMiwwbDYuNTc0LTYuNDlhMi4yLDIuMiwwLDAsMCwwLTNoMGEyLjIsMi4yLDAsMCwwLTMsMGwtNy40ODIsNy41NWEyLjkzNSwyLjkzNSwwLDAsMCwuMzI2LDMuNDQsMi41NjgsMi41NjgsMCwwLDAsNC4wODIsMGMxLjIwOS0xLjIwOSw2LTUuOTksNi01Ljk5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDYuODgyIC00MDcuNDYxKSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDA2Y2UwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS13aWR0aD0iMSIvPgogICAgPC9nPgogIDwvZz4KICA8cmVjdCBpZD0iUmVjdGFuZ2xlXzUwMzkiIGRhdGEtbmFtZT0iUmVjdGFuZ2xlIDUwMzkiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4)}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-attachment-button[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.footer[_ngcontent-%COMP%]   .input-wrapper[_ngcontent-%COMP%]   .send-attachment-button.disabled-attachment[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyBpZD0iaWNvbl9hZGRfbmEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTYgMTYiPg0KICA8ZyBpZD0iR3JvdXBfNzM2MyIgZGF0YS1uYW1lPSJHcm91cCA3MzYzIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNDkuMDQ2IC00MDYuMDUpIj4NCiAgICA8ZyBpZD0iR3JvdXBfNzM2MiIgZGF0YS1uYW1lPSJHcm91cCA3MzYyIj4NCiAgICAgIDxwYXRoIGlkPSJQYXRoXzY5MTYiIGRhdGEtbmFtZT0iUGF0aCA2OTE2IiBkPSJNLTIzOS4wNDYsNDEwLjEwN2wtNS41LDUuNDM0YTEuNDUxLDEuNDUxLDAsMCwwLDAsMiwxLjQ1MiwxLjQ1MiwwLDAsMCwyLDBsNi41NzQtNi40OTFhMi4yLDIuMiwwLDAsMCwwLTNoMGEyLjIsMi4yLDAsMCwwLTMsMGwtNy40ODIsNy41NTFhMi45MzUsMi45MzUsMCwwLDAsLjMyNiwzLjQ0LDIuNTY4LDIuNTY4LDAsMCwwLDQuMDgyLDBjMS4yMDktMS4yMDksNi01Ljk5MSw2LTUuOTkxIiBmaWxsPSJub25lIiBzdHJva2U9IiM5OTkiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3Ryb2tlLXdpZHRoPSIxIi8+DQogICAgPC9nPg0KICA8L2c+DQogIDxyZWN0IGlkPSJSZWN0YW5nbGVfNjQzMyIgZGF0YS1uYW1lPSJSZWN0YW5nbGUgNjQzMyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiBmaWxsPSJub25lIi8+DQo8L3N2Zz4NCg==);cursor:default;pointer-events:none}.footer[_ngcontent-%COMP%]   .attachments-wrapper[_ngcontent-%COMP%]{max-height:100px;overflow:auto;margin-left:15px}.footer[_ngcontent-%COMP%]   .attachments-wrapper[_ngcontent-%COMP%]   .preview-attachment[_ngcontent-%COMP%]{border:1px solid gray;display:flex;overflow:hidden;border-radius:10px;align-items:center;margin:2px 5px 2px 10px}.footer[_ngcontent-%COMP%]   .attachments-wrapper[_ngcontent-%COMP%]   .preview-attachment[_ngcontent-%COMP%]   .attachment-icon[_ngcontent-%COMP%]{width:16px;min-width:16px;height:16px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDojNmNjOGM1O30uYntmaWxsOiNmZmY7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcuMjYzIC0xNy44MSkiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03LjI2MyAxNy44MSkiPjxwYXRoIGNsYXNzPSJhIiBkPSJNMCwwSDE2VjE2SDBaIi8+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMi4yNjMgMy4xOSkiPjxwYXRoIGNsYXNzPSJiIiBkPSJNNDYsMjhoM3Y1SDQ2WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQwIC0yNSkiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTQ2LDIzLjkyMlYyM2g1djYuODg1SDQ5LjkyMVYyMy45MjJaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDAgLTIxLjkxMykiLz48cGF0aCBjbGFzcz0iYiIgZD0iTTEzLDIxLjg4OVYxNC4xMTFMMTgsMTNWMjNaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTMgLTEzKSIvPjwvZz48L2c+PC9nPjwvc3ZnPg==);margin:0 0 0 10px}.footer[_ngcontent-%COMP%]   .attachments-wrapper[_ngcontent-%COMP%]   .preview-attachment[_ngcontent-%COMP%]   .attachment-remove[_ngcontent-%COMP%]{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDE0IDE0Ij48ZGVmcz48c3R5bGU+LmEsLmJ7ZmlsbDpub25lO30uYntzdHJva2U6I2I1YjViNTtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9PC9zdHlsZT48L2RlZnM+PHJlY3QgY2xhc3M9ImEiIHdpZHRoPSIxNCIgaGVpZ2h0PSIxNCIvPjxsaW5lIGNsYXNzPSJiIiB5MT0iOCIgeDI9IjgiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMgMykiLz48bGluZSBjbGFzcz0iYiIgeDI9IjgiIHkyPSI4IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzIDMpIi8+PC9zdmc+);margin:2px 10px 0 0;width:16px;min-width:16px;height:16px;cursor:pointer}.footer[_ngcontent-%COMP%]   .attachments-wrapper[_ngcontent-%COMP%]   .preview-attachment[_ngcontent-%COMP%]   .attachment-name[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:pre;overflow:hidden;margin:5px;font-size:13px}.chat-summary[_ngcontent-%COMP%]{display:flex;padding-left:15px;margin-bottom:8px}.chat-summary[_ngcontent-%COMP%]   .summary-icon-container[_ngcontent-%COMP%]{padding-right:12px}.chat-summary[_ngcontent-%COMP%]   .summary-icon-container[_ngcontent-%COMP%]   .summary-icon[_ngcontent-%COMP%]{width:32px;height:32px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDojZmZmO30uYiwuY3tmaWxsOm5vbmU7c3Ryb2tlOiMwMDZjZTA7fS5ie3N0cm9rZS1taXRlcmxpbWl0OjEwO30uZCwuZXtzdHJva2U6bm9uZTt9LmV7ZmlsbDojZjNmM2YzO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTI0OCAtMTg2KSI+PGcgY2xhc3M9ImEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyNDggMTg2KSI+PHBhdGggY2xhc3M9ImQiIGQ9Ik0gMTYgMzEuNSBDIDExLjg1OTgwMDMzODc0NTEyIDMxLjUgNy45Njc0MTAwODc1ODU0NDkgMjkuODg3NzIwMTA4MDMyMjMgNS4wMzk4NDAyMjE0MDUwMjkgMjYuOTYwMTU5MzAxNzU3ODEgQyAyLjExMjI3OTg5MTk2Nzc3MyAyNC4wMzI1OTA4NjYwODg4NyAwLjUgMjAuMTQwMTk5NjYxMjU0ODggMC41IDE2IEMgMC41IDExLjg1OTgwMDMzODc0NTEyIDIuMTEyMjc5ODkxOTY3NzczIDcuOTY3NDEwMDg3NTg1NDQ5IDUuMDM5ODQwMjIxNDA1MDI5IDUuMDM5ODQwMjIxNDA1MDI5IEMgNy45Njc0MTAwODc1ODU0NDkgMi4xMTIyNzk4OTE5Njc3NzMgMTEuODU5ODAwMzM4NzQ1MTIgMC41IDE2IDAuNSBDIDIwLjE0MDE5OTY2MTI1NDg4IDAuNSAyNC4wMzI1OTA4NjYwODg4NyAyLjExMjI3OTg5MTk2Nzc3MyAyNi45NjAxNTkzMDE3NTc4MSA1LjAzOTg0MDIyMTQwNTAyOSBDIDI5Ljg4NzcyMDEwODAzMjIzIDcuOTY3NDEwMDg3NTg1NDQ5IDMxLjUgMTEuODU5ODAwMzM4NzQ1MTIgMzEuNSAxNiBDIDMxLjUgMjAuMTQwMTk5NjYxMjU0ODggMjkuODg3NzIwMTA4MDMyMjMgMjQuMDMyNTkwODY2MDg4ODcgMjYuOTYwMTU5MzAxNzU3ODEgMjYuOTYwMTU5MzAxNzU3ODEgQyAyNC4wMzI1OTA4NjYwODg4NyAyOS44ODc3MjAxMDgwMzIyMyAyMC4xNDAxOTk2NjEyNTQ4OCAzMS41IDE2IDMxLjUgWiIvPjxwYXRoIGNsYXNzPSJlIiBkPSJNIDE2IDEgQyAxMS45OTMzNDkwNzUzMTczOCAxIDguMjI2NTIwNTM4MzMwMDc4IDIuNTYwMjcwMzA5NDQ4MjQyIDUuMzkzNDAwMTkyMjYwNzQyIDUuMzkzNDAwMTkyMjYwNzQyIEMgMi41NjAyNzAzMDk0NDgyNDIgOC4yMjY1MjA1MzgzMzAwNzggMSAxMS45OTMzNDkwNzUzMTczOCAxIDE2IEMgMSAyMC4wMDY2NDkwMTczMzM5OCAyLjU2MDI3MDMwOTQ0ODI0MiAyMy43NzM0Nzk0NjE2Njk5MiA1LjM5MzQwMDE5MjI2MDc0MiAyNi42MDY1OTk4MDc3MzkyNiBDIDguMjI2NTIwNTM4MzMwMDc4IDI5LjQzOTcyOTY5MDU1MTc2IDExLjk5MzM0OTA3NTMxNzM4IDMxIDE2IDMxIEMgMjAuMDA2NjQ5MDE3MzMzOTggMzEgMjMuNzczNDc5NDYxNjY5OTIgMjkuNDM5NzI5NjkwNTUxNzYgMjYuNjA2NTk5ODA3NzM5MjYgMjYuNjA2NTk5ODA3NzM5MjYgQyAyOS40Mzk3Mjk2OTA1NTE3NiAyMy43NzM0Nzk0NjE2Njk5MiAzMSAyMC4wMDY2NDkwMTczMzM5OCAzMSAxNiBDIDMxIDExLjk5MzM0OTA3NTMxNzM4IDI5LjQzOTcyOTY5MDU1MTc2IDguMjI2NTIwNTM4MzMwMDc4IDI2LjYwNjU5OTgwNzczOTI2IDUuMzkzNDAwMTkyMjYwNzQyIEMgMjMuNzczNDc5NDYxNjY5OTIgMi41NjAyNzAzMDk0NDgyNDIgMjAuMDA2NjQ5MDE3MzMzOTggMSAxNiAxIE0gMTYgMCBDIDI0LjgzNjU1OTI5NTY1NDMgMCAzMiA3LjE2MzQ0MDcwNDM0NTcwMyAzMiAxNiBDIDMyIDI0LjgzNjU1OTI5NTY1NDMgMjQuODM2NTU5Mjk1NjU0MyAzMiAxNiAzMiBDIDcuMTYzNDQwNzA0MzQ1NzAzIDMyIDAgMjQuODM2NTU5Mjk1NjU0MyAwIDE2IEMgMCA3LjE2MzQ0MDcwNDM0NTcwMyA3LjE2MzQ0MDcwNDM0NTcwMyAwIDE2IDAgWiIvPjwvZz48bGluZSBjbGFzcz0iYiIgeDI9IjEuNTA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjU4Ljc0OCAxOTguNSkiLz48bGluZSBjbGFzcz0iYiIgeDI9IjEuNTA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjU4Ljc0OCAyMDEuNSkiLz48bGluZSBjbGFzcz0iYiIgeDI9IjEuNTA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjU4Ljc0OCAyMDQuNSkiLz48bGluZSBjbGFzcz0iYiIgeDI9IjcuNTA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjYxLjc0OCAxOTguNSkiLz48bGluZSBjbGFzcz0iYiIgeDI9IjcuNTA1IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjYxLjc0OCAyMDEuNSkiLz48bGluZSBjbGFzcz0iYiIgeDI9IjEuNzUyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjYxLjc0OCAyMDQuNSkiLz48cGF0aCBjbGFzcz0iYyIgZD0iTTAsMCwyLjE4MiwxLjg3NSw1LjItMS43NTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyNjQuOTE4IDIwNC40MzgpIi8+PC9nPjwvc3ZnPg);background-size:contain}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]{width:calc(100% - 49px)}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-title[_ngcontent-%COMP%]{font-size:11px;line-height:32px;color:#757575;-webkit-user-select:none;user-select:none}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-toggle[_ngcontent-%COMP%]{cursor:pointer;float:right;color:#006ce0}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .toggle-arrow[_ngcontent-%COMP%]{border:solid #006ce0;border-width:0 1px 1px 0;display:inline-block;padding:2.8px;margin:3px 12px 0 2px}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .toggle-arrow.down[_ngcontent-%COMP%]{transform:rotate(45deg);-webkit-transform:rotate(45deg);vertical-align:text-top}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .toggle-arrow.up[_ngcontent-%COMP%]{transform:rotate(-135deg);-webkit-transform:rotate(-135deg);vertical-align:text-bottom}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-items[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-items[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{max-width:100%}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-items[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{font-size:13px;color:#999}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-items[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .item-value[_ngcontent-%COMP%]{font-size:14px;overflow:hidden;text-overflow:ellipsis}.chat-summary[_ngcontent-%COMP%]   .summary-content-container[_ngcontent-%COMP%]   .summary-items[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   .item-value[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#006ce0}'],changeDetection:0})}}(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",kh),(0,p.__metadata)("design:paramtypes",[kh])],He.prototype,"chat",null),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Object)],He.prototype,"isFirstOpen",void 0),(0,p.__decorate)([Q(),(0,p.__metadata)("design:type",Array)],He.prototype,"activeChats",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],He.prototype,"contactClick",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],He.prototype,"accountClick",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],He.prototype,"backClick",void 0),(0,p.__decorate)([et(),(0,p.__metadata)("design:type",Object)],He.prototype,"duplicatesContactsClick",void 0);class Mc{constructor(e,t,n){this.queryExecutor=e,this.userInfo=t,this.httpClient=n,this._serviceUrl="/rest/OmnichannelOperatorService/",this._cacheStatuses=[]}getOperatorStatuses(){if(this._cacheStatuses.length>0)return(0,u.of)(this._cacheStatuses);const e=new Se("OperatorState");return e.addSchemaColumn("Id"),e.addSchemaColumn("Name"),e.addSchemaColumn("Code"),this.queryExecutor.executeSelectQuery(e).pipe((0,c.map)(t=>t.map(n=>({code:n.Code,name:n.Name,image:N(ae(),"img/entity/hash/OperatorState/Image/",n.Id)}))),(0,c.tap)(t=>this._cacheStatuses=t))}getOperatorStatus(){const e=this._serviceUrl+"GetCurrentState";return this.httpClient.post(e,null).pipe((0,c.map)(t=>t.CurrentStateCode))}updateLastActivity(){const e=this._serviceUrl+"UpdateLastActivityDate";return this.httpClient.post(e,{})}changeState(e){const t=this._serviceUrl+"ChangeState";this.httpClient.post(t,{newState:e}).subscribe()}static{this.\u0275fac=function(t){return new(t||Mc)(i.\u0275\u0275inject(xe),i.\u0275\u0275inject(L.oq),i.\u0275\u0275inject(E.HttpClient))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Mc,factory:Mc.\u0275fac,providedIn:"root"})}}function KS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"mat-option",8),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(r.changeState(s.code))}),i.\u0275\u0275element(1,"img",9),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()}if(a&2){const t=e.$implicit;i.\u0275\u0275property("value",t.code),i.\u0275\u0275advance(),i.\u0275\u0275property("src",t.image,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.name," ")}}function XS(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",1)(1,"mat-form-field",2)(2,"mat-select",3),i.\u0275\u0275twoWayListener("valueChange",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275twoWayBindingSet(r.currentStatusCode,s)||(r.currentStatusCode=s),i.\u0275\u0275resetView(s)}),i.\u0275\u0275elementStart(3,"mat-select-trigger")(4,"span",4),i.\u0275\u0275element(5,"img",5),i.\u0275\u0275elementStart(6,"span",6),i.\u0275\u0275text(7),i.\u0275\u0275elementEnd()()(),i.\u0275\u0275template(8,KS,3,3,"mat-option",7),i.\u0275\u0275elementEnd()()()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275twoWayProperty("value",t.currentStatusCode),i.\u0275\u0275advance(3),i.\u0275\u0275property("src",t.getTriggerImage(),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.getTriggerCaption()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.statuses)}}class Ha{constructor(e,t,n){this.operatorStatusService=e,this._sysSettingsService=t,this._featureValues=n,this.stopPolling$=new u.Subject,this._activeStatusCode="Active",this._lastOperatorActivityPingTimeout=6e4}_startPolling(){return(0,u.interval)(this._lastOperatorActivityPingTimeout).pipe((0,u.filter)(()=>this.currentStatusCode===this._activeStatusCode&&this._featureValues.OperatorStatusAutoUpdateEnabled),(0,u.switchMap)(()=>this.operatorStatusService.updateLastActivity()),(0,u.takeUntil)(this.stopPolling$))}_updateLastOperatorActivity(e){this._featureValues.OperatorStatusAutoUpdateEnabled&&(e===this._activeStatusCode?this._startPolling().subscribe():this.stopPolling$.next())}ngOnInit(){(0,u.forkJoin)([this.operatorStatusService.getOperatorStatus(),this.operatorStatusService.getOperatorStatuses(),this._sysSettingsService.getByCode("LastOperatorActivityPingTimeout")]).subscribe(([e,t,n])=>{this._lastOperatorActivityPingTimeout=n?.value||6e4,this.currentStatusCode=e,this.statuses=t,this._updateLastOperatorActivity(e)})}changeState(e){this._updateLastOperatorActivity(e),this.operatorStatusService.changeState(e)}getTriggerImage(){return this.statuses?.filter(e=>e.code===this.currentStatusCode)[0].image}getTriggerCaption(){return this.statuses?.filter(e=>e.code===this.currentStatusCode)[0].name}static{this.\u0275fac=function(t){return new(t||Ha)(i.\u0275\u0275directiveInject(Mc),i.\u0275\u0275directiveInject(Mt),i.\u0275\u0275directiveInject(oe))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Ha,selectors:[["ts-operator-status"]],inputs:{currentStatusCode:"currentStatusCode"},decls:1,vars:1,consts:[["class","operator-status-container",4,"ngIf"],[1,"operator-status-container"],["floatLabel","never"],["disableOptionCentering","","panelClass","operator-chat-state-select-menu-panel",3,"valueChange","value"],[1,"select-menu-trigger"],["alt","Current status",1,"triggered-status-image",3,"src"],[1,"triggered-status-caption"],["class","mat-option-status",3,"value","click",4,"ngFor","ngForOf"],[1,"mat-option-status",3,"click","value"],["alt","Change status",3,"src"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,XS,9,4,"div",0),t&2&&i.\u0275\u0275property("ngIf",n.statuses&&n.currentStatusCode)},dependencies:[b.NgForOf,b.NgIf,K.MatFormField,Ge.MatSelect,Ge.MatSelectTrigger,qe.MatOption],styles:[".cdk-overlay-pane .mat-mdc-select-panel.operator-chat-state-select-menu-panel{position:absolute;padding:1px}  .cdk-overlay-pane .mat-mdc-select-panel.operator-chat-state-select-menu-panel mat-option.mat-option-status.mat-mdc-option{padding:0 18px;height:33px!important;line-height:33px!important}  .cdk-overlay-pane .mat-mdc-select-panel.operator-chat-state-select-menu-panel mat-option.mat-option-status.mat-mdc-option .mdc-list-item__primary-text{display:flex;align-items:center;font-size:14px;font-family:Open Sans,Regular,sans-serif;line-height:18px;padding-right:15px}  .cdk-overlay-pane .mat-mdc-select-panel.operator-chat-state-select-menu-panel mat-option.mat-option-status.mat-mdc-option .mdc-list-item__primary-text img{margin-right:5px;width:10px;height:10px}  ts-operator-status .operator-status-container .triggered-status-image{width:12px;height:12px}  ts-operator-status .operator-status-container .triggered-status-caption{margin-left:8px}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper{padding-bottom:0!important}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix{width:auto;padding:0!important;border-top-style:none}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select{width:auto;height:26px;display:flex;align-items:center;border-radius:2px}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select:hover,   ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select:focus-visible,   ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select[aria-expanded=true]{background-color:#f2f5ff}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select .mat-mdc-select-trigger{padding:0 4px 0 8px}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select .mat-mdc-select-trigger .mat-mdc-select-value{max-width:100%;width:auto}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select .mat-mdc-select-trigger .mat-mdc-select-value .mat-mdc-select-value-text{color:#444;font-size:14px}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select .mat-mdc-select-trigger .mat-mdc-select-value .mat-mdc-select-value-text .select-menu-trigger{display:flex;align-items:center;height:18px;line-height:18px;position:relative;bottom:1px}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-select .mat-mdc-select-trigger .mat-mdc-select-arrow-wrapper{position:relative;top:1px!important}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mdc-line-ripple{display:none}  ts-operator-status .operator-status-container .mat-mdc-form-field-type-mat-select .mat-mdc-form-field-subscript-wrapper{height:0}"]})}}let Zg=[];function e1(a){return()=>{const t=a.get(L.fv).loadCurrentUserInfo().pipe((0,c.map)(()=>a.get(Mt)),(0,c.switchMap)(n=>n.getByCodes(["SearchInFacebookURL"])),(0,c.filter)(n=>n&&n.success),(0,c.map)(n=>(0,T.mapValues)(n.values||{},s=>s.value)),(0,c.tap)(n=>Zg=n));return(0,u.lastValueFrom)(t,{defaultValue:null})}}class Ya{_registerIcons(){Object.keys(this._registeredIcons).forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer?.bypassSecurityTrustHtml(this._registeredIcons[e]))})}constructor(e,t){this._matIconRegistry=e,this._domSanitizer=t,this._registeredIcons={close:m(89920),search:m(81412)},this._registerIcons()}static{this.\u0275fac=function(t){return new(t||Ya)(i.\u0275\u0275inject(U.MatIconRegistry),i.\u0275\u0275inject(y.DomSanitizer))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Ya})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[kf,Rf,{provide:"messagingSysSettings",useFactory:()=>Zg},{provide:i.APP_INITIALIZER,useFactory:e1,deps:[i.Injector],multi:!0},Cu,mu,(0,E.provideHttpClient)((0,E.withInterceptorsFromDi)())],imports:[b.CommonModule,v.TranslateModule,Vn,Z.FormsModule,Ge.MatSelectModule,W.MatButtonModule,R.MatMenuModule,U.MatIconModule,ci.BrowserAnimationsModule,Xo,lt,an,Dt.MatTabsModule,gt.MatSnackBarModule,mn.OverlayModule,dr,hc,La,Yi]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Ya,{declarations:[Va,He,Ha,Cc,pc,Ql,mc,Ua,Ba],imports:[b.CommonModule,v.TranslateModule,Vn,Z.FormsModule,Ge.MatSelectModule,W.MatButtonModule,R.MatMenuModule,U.MatIconModule,ci.BrowserAnimationsModule,Xo,lt,an,Dt.MatTabsModule,gt.MatSnackBarModule,mn.OverlayModule,dr,hc,La,Yi],exports:[Va,He,Ha,St]})})();class Ic{_buildRequestUrl(e){return this._isAbsoluteUrl(e)?e:b.Location.joinWithSlash(this.getUrl(),e)}_isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}getUrl(){return H()}intercept(e,t){return e=e.clone({url:this._buildRequestUrl(e.url)}),t.handle(e).pipe((0,c.catchError)(n=>(console.log(n),(0,u.throwError)(n))))}static{this.\u0275fac=function(t){return new(t||Ic)}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Ic,factory:Ic.\u0275fac})}}class Za extends Ic{getUrl(){return ae()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(Za)))(n||Za)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:Za,factory:Za.\u0275fac})}}const t1=a=>({"has-new-chats":a}),n1=a=>({"can-expand":a});function i1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",11)(1,"div",12),i.\u0275\u0275element(2,"span",13),i.\u0275\u0275elementStart(3,"div",14)(4,"div",15)(5,"span",16),i.\u0275\u0275text(6),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(7,"a",17),i.\u0275\u0275text(8),i.\u0275\u0275elementEnd()()()()()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(6),i.\u0275\u0275textInterpolate(t.notificationsDisabledMessage.textStart),i.\u0275\u0275advance(),i.\u0275\u0275propertyInterpolate("href",t.notificationsDisabledMessage==null||t.notificationsDisabledMessage.splitTextLink==null?null:t.notificationsDisabledMessage.splitTextLink.href,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.notificationsDisabledMessage==null||t.notificationsDisabledMessage.splitTextLink==null?null:t.notificationsDisabledMessage.splitTextLink.displayText)}}function s1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"a",25),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(4);i.\u0275\u0275propertyInterpolate("href",t.appUrl+t.blankSlate.splitTextLink.href,i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.blankSlate.splitTextLink.displayText)}}function a1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"a",26),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275text(2),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(4);i.\u0275\u0275propertyInterpolate("href",i.\u0275\u0275pipeBind1(1,2,"ChatSettings.ChatWindow.AcademyLink"),i.\u0275\u0275sanitizeUrl),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.blankSlate.academyLink.displayText)}}function r1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",22),i.\u0275\u0275text(1),i.\u0275\u0275template(2,s1,2,2,"a",23),i.\u0275\u0275text(3),i.\u0275\u0275template(4,a1,3,4,"a",24),i.\u0275\u0275text(5,". "),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.blankSlate.textStart," "),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.blankSlate.splitTextLink),i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.blankSlate.textEnd," "),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.blankSlate.academyLink)}}function o1(a,e){if(a&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"div",18),i.\u0275\u0275element(2,"div",19),i.\u0275\u0275elementStart(3,"div",20),i.\u0275\u0275text(4),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(5,r1,6,4,"div",21),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275advance(2),i.\u0275\u0275classMap(t.blankSlate.logoClass),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(t.blankSlate.reason),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.isBlankSlateDescriptionVisible)}}function c1(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",30),i.\u0275\u0275listener("click",function(){const s=i.\u0275\u0275restoreView(t).$implicit,r=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(r.openChat(s))}),i.\u0275\u0275element(1,"ts-chat-item",31),i.\u0275\u0275elementEnd()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275property("chat",t)("chatAccepted",n.chatAccepted$)}}function l1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",32),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",t.errorMessage," ")}}function u1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",27),i.\u0275\u0275template(1,c1,2,2,"div",28)(2,l1,2,1,"div",29),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(3,t1,(t.waitingChats==null?null:t.waitingChats.length)>0)),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",t.chats),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.errorMessage)}}function d1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"span",38),i.\u0275\u0275text(1),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate(t.waitingChats==null?null:t.waitingChats.length)}}function h1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",39),i.\u0275\u0275element(1,"ts-chat-item",31),i.\u0275\u0275elementEnd()),a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext(3);i.\u0275\u0275advance(),i.\u0275\u0275property("chat",t)("chatAccepted",n.chatAccepted$)}}function p1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",33)(1,"span",34),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(4,d1,2,1,"span",35),i.\u0275\u0275elementStart(5,"div",36),i.\u0275\u0275template(6,h1,2,2,"div",37),i.\u0275\u0275elementEnd()()),a&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngClass",i.\u0275\u0275pureFunction1(6,n1,(t.waitingChats==null?null:t.waitingChats.length)>1)),i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(3,4,"ChatSettings.ChatWindow.NewChatsTitle")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",(t.waitingChats==null?null:t.waitingChats.length)>1),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngForOf",t.waitingChats)}}function m1(a,e){if(a&1&&(i.\u0275\u0275elementStart(0,"div",3)(1,"div",4)(2,"span",5),i.\u0275\u0275text(3),i.\u0275\u0275pipe(4,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(5,i1,9,3,"div",6),i.\u0275\u0275elementStart(6,"div",7),i.\u0275\u0275element(7,"ts-operator-status",8),i.\u0275\u0275elementEnd()(),i.\u0275\u0275template(8,o1,6,4,"ng-container",9)(9,u1,3,5,"ng-template",null,0,i.\u0275\u0275templateRefExtractor)(11,p1,7,8,"div",10),i.\u0275\u0275elementEnd()),a&2){const t=i.\u0275\u0275reference(10),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(i.\u0275\u0275pipeBind1(4,6,"ChatSettings.ChatWindow.ChatListTitle")),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.notificationsDisabledMessage),i.\u0275\u0275advance(2),i.\u0275\u0275property("currentStatusCode",n.operatorStateCode),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",(n.emptyList||n.noActiveChats)&&n.blankSlate)("ngIfElse",t),i.\u0275\u0275advance(3),i.\u0275\u0275property("ngIf",(n.waitingChats==null?null:n.waitingChats.length)>0)}}function g1(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"ts-conversation",40),i.\u0275\u0275listener("contactClick",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.handleContactClick(s))})("accountClick",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.handleAccountClick(s))})("backClick",function(){i.\u0275\u0275restoreView(t);const s=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(s.showChatsList())})("duplicatesContactsClick",function(s){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.handleDuplicatesContactsClick(s))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()}if(a&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("chat",t.chosenChat)("isFirstOpen",t.isFirstOpen)("activeChats",t.chats)}}const f1="UnreadMessageInChat",_1="NewIncomingChat",y1="UpdateIncomingChat",C1="CompleteChat",M1="AcceptChat",I1="OperatorStateChanged",b1="NewConversationMessage",S1="NewSystemMessage",v1="CommunicationOmniChatPanelActive",T1="NewTransferredChat",x1="OpenChatWithContact",w1="NewChatCreated",N1="Active";class bc{set chats(e){e=e||[],this._chats=e,this.noActiveChats=e.length<1,this.noActiveChats&&this._formBlankSlate()}get chats(){return this._chats}set waitingChats(e){e=e||[],this._waitingChats=e,this.emptyList=e.length<1&&this.noActiveChats,(this.emptyList||this.noActiveChats)&&this._formBlankSlate()}get waitingChats(){return this._waitingChats}get isBlankSlateDescriptionVisible(){return!!this.blankSlate?.textStart||!!this.blankSlate?.textEnd}constructor(e,t,n,s,r){this.chatService=e,this._translateService=t,this._userInfo=n,this.customEventService=s,this.window=r,this._blankSlateConfig={0:"ChatSettings.ChatWindow.BlankSlates.Default",1:"ChatSettings.ChatWindow.BlankSlates.Default",2:"ChatSettings.ChatWindow.BlankSlates.HasNotRightsAndHasChannelAndInactive",3:"ChatSettings.ChatWindow.BlankSlates.HasNotRightsAndHasChannelAndIsActive",4:"ChatSettings.ChatWindow.BlankSlates.HasRightsAndNoChannel",5:"ChatSettings.ChatWindow.BlankSlates.HasRightsAndNoChannel",6:"ChatSettings.ChatWindow.BlankSlates.HasRightsAndChannelButInactive",7:"ChatSettings.ChatWindow.BlankSlates.HasRightsAndChannelAndIsActive"},this.appUrl=`${se()}`,this.isFirstOpen=!1,this.blankSlate=this._translateService.instant("ChatSettings.ChatWindow.BlankSlates.Default"),this.isChatPannelActive=!1,this.subscriptions=new u.Subscription,this.chatAccepted$=new u.Subject,this._chats=[],this._waitingChats=[],this.contactClick=new i.EventEmitter,this.accountClick=new i.EventEmitter,this.duplicatesContactsClick=new i.EventEmitter,this.subscriptions.add(this.chatAccepted$.subscribe(o=>{this.openChat(o,!0)}))}_updateCounter(e,t){const n=this._findChat(e);n&&(n.unprocessedMsgCount=t)}_updateChat(e){let t=this._findChat(e)||{};t?.id||(t=this.waitingChats.find(n=>this._compareById(n,e))||{}),this._loadChat(e,n=>Object.assign(t,n))}_removeAcceptedChat(e){this.waitingChats=this.waitingChats.filter(t=>!this._compareById(t,e))}_removeCompletedChat(e){this.chats=this.chats.filter(t=>!this._compareById(t,e))}_findChat(e){return this.chats.find(t=>this._compareById(t,e))}_compareById(e,t){return e.id.toLowerCase()===t.toLowerCase()}_isWaitingChatNotExists(e){return!(this.waitingChats&&this.waitingChats.some(t=>t.id===e))}_addNewChat(e){this._isWaitingChatNotExists(e)&&this._loadChat(e,t=>{this._isWaitingChatNotExists(e)&&(this.waitingChats.unshift(t),this.waitingChats=this._sortByLastMessageTime(this.waitingChats))})}_addChat(e){this.chats&&this.chats.some(t=>t.id===e)||this._loadChat(e,t=>{this.chats.unshift(t),this.chats=[...this.chats],this.emptyList=this.chats.length<1})}_loadChat(e,t){this.subscriptions.add(this.chatService.getItem(e).subscribe(n=>{n&&n.success&&t(n.result[0])}))}_sortByLastMessageTime(e){return e.sort((t,n)=>t.lastMessageTime>n.lastMessageTime?-1:1)}_loadChats(){this.subscriptions.add(this.chatService.getOperatorChats().subscribe(e=>{if(e&&e.success)if(e.result.length>0){let t=e.result||[];t=this._sortByLastMessageTime(t),this.chats=t.filter(s=>s.operator?.value)||[],this.waitingChats=t.filter(s=>!s.operator?.value)||[];const n=this.window.sessionStorage.getItem(He.CURRENT_CHAT_CACHE_NAME);if(n){const s=this.chats.find(r=>r.id===n);s&&this.openChat(s)}}else this.chats=[],this.waitingChats=[];else e&&e.errorInfo?this.errorMessage=e.errorInfo.message:this.emptyList=!0;this._formBlankSlate()}))}_formBlankSlate(){this.subscriptions.add((0,u.forkJoin)([this.chatService.isOperatorCanManageChats(),this.chatService.isOperatorHasActiveChannel(),this.chatService.isOperatorActive()]).subscribe(([e,t,n])=>{if(this.noActiveChats&&this.waitingChats.length>0){const s=this._translateService.instant("ChatSettings.ChatWindow.BlankSlates.HasNoActiveChats");s instanceof Object&&(s.logoClass="no-active-chats"),this.blankSlate=s}else this._setBlankSlate(e,t,n)}))}tryRequestNotification(){window.Notification?.requestPermission().then(function(e){(e==="denied"||e==="default")&&(this.notificationsDisabledMessage=this._translateService.instant("NotificationsDisabled"))}.bind(this))}_convertWSMessage(e){return{sender:e.Header?.Sender,body:typeof e?.Body=="string"?JSON.parse(e.Body):e.Body}}_getBlankSlateFromConfig(e,t,n){const s=this._blankSlateConfig[parseInt([Number(e),Number(t),Number(n)].join(""),2)];return this._translateService.instant(s)}_setBlankSlate(e,t,n){this.blankSlate=this._getBlankSlateFromConfig(e,t,n)}ngOnInit(){this._loadChats(),this.tryRequestNotification(),this.subscriptions.add(this.customEventService.subscribe("OmniChatWSMessages").subscribe(e=>this.handleWsMessages(e)))}ngOnDestroy(){this.subscriptions.unsubscribe()}openChat(e,t=!1){(e.operator?.value||t)&&(this.chosenChat=e,this.isFirstOpen=t,this.conversationMode=!0,t&&!(this.chats&&this.chats.some(n=>n.id===e.id))&&(window.sessionStorage.removeItem(`lastChatAccepted_${e.id}`),e.unprocessedMsgCount=0,this.chats.unshift(e),this._removeAcceptedChat(e.id)))}handleContactClick(e){this.contactClick.emit(e)}handleAccountClick(e){this.accountClick.emit(e)}handleDuplicatesContactsClick(e){this.duplicatesContactsClick.emit(e)}showChatsList(){this._loadChats(),this.conversationMode=!1,this.conversationComponent&&(this.conversationComponent.hideComponent(),this.window.sessionStorage.removeItem(He.CURRENT_CHAT_CACHE_NAME))}handleWsMessages(e){if(e=JSON.parse(e),e.Header?.Sender){const n=this._convertWSMessage(e),s=n.body;switch(n.sender){case v1:this.isChatPannelActive=s.isChatPannelActive,window.sessionStorage.setItem("CommunicationOmniChatPanelActive",this.isChatPannelActive.toString()),this.isChatPannelActive&&this.conversationComponent?.markAsRead();break;case f1:this.conversationMode||this._updateCounter(s.ChatId,s.Count);break;case _1:this._addNewChat(s.ChatId);break;case y1:this.conversationMode||this._updateChat(s.ChatId);break;case M1:window.sessionStorage.getItem(`lastChatAccepted_${s.ChatId}`)||this._loadChat(s.ChatId,r=>{this._userInfo&&r.operator&&this._userInfo.id===r.operator.value?this.openChat(r,!0):this._removeAcceptedChat(s.ChatId)});break;case I1:this.emptyList&&this._formBlankSlate(),this.operatorStateCode=s?.StateCode,this.operatorStateCode===N1&&this._loadChats();break;case b1:{const r=JSON.parse(this.window.sessionStorage.getItem("CommunicationOmniChatPanelActive"));this.conversationMode?(this.conversationComponent?.addMessageToConversation(s),r&&this.conversationComponent?.markAsRead()):this._updateChat(s.ChatId);break}case S1:this.conversationComponent?.addSystemMessageToConversation(s);break;case C1:this._removeCompletedChat(s.ChatId),this.conversationMode&&this.chosenChat.id===s.ChatId&&this.conversationComponent?.showCompleteChatMessage();break;case T1:this._addChat(s.ChatId);break;case x1:this._loadChat(s.ChatId,r=>{this.openChat(r)});break;case w1:this.conversationComponent?.chat&&(this.conversationComponent.chat.id=s.ChatId);break}}}static{this.\u0275fac=function(t){return new(t||bc)(i.\u0275\u0275directiveInject(Re),i.\u0275\u0275directiveInject(v.TranslateService),i.\u0275\u0275directiveInject(L.oq),i.\u0275\u0275directiveInject(P.Dj),i.\u0275\u0275directiveInject(P.ZP))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:bc,selectors:[["ts-omnichannel-messaging-chat-list"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(He,5),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.conversationComponent=s.first)}},outputs:{contactClick:"contactClick",accountClick:"accountClick",duplicatesContactsClick:"duplicatesContactsClick"},features:[i.\u0275\u0275ProvidersFeature([P.Dj])],decls:2,vars:2,consts:[["hasChats",""],["class","chat-list-wrap-container",4,"ngIf"],[4,"ngIf"],[1,"chat-list-wrap-container"],[1,"chat-list-header-container"],[1,"chat-list-header-title"],["class","notifications-disabled-alert",4,"ngIf"],[1,"operator-status-header-container"],[3,"currentStatusCode"],[4,"ngIf","ngIfElse"],["class","waiting-chat-container",3,"ngClass",4,"ngIf"],[1,"notifications-disabled-alert"],[1,"n-tip","n-tip-red","align-bottom","notification-tooltip-hint"],[1,"n-tip-anchor"],[1,"n-tip-border"],[1,"n-tip-panel"],[1,"n-tip-content"],["target","_blank","rel","noopener",1,"n-tip-content",3,"href"],[1,"blankslate-wrapper"],[1,"blankslate-logo"],[1,"blankslate-reason"],["class","blankslate-description",4,"ngIf"],[1,"blankslate-description"],["rel","noopener",3,"href",4,"ngIf"],["target","_blank","rel","noopener",3,"href",4,"ngIf"],["rel","noopener",3,"href"],["target","_blank","rel","noopener",3,"href"],[1,"chat-list",3,"ngClass"],["class","chat-item",3,"click",4,"ngFor","ngForOf"],["class","chat-list-error-info",4,"ngIf"],[1,"chat-item",3,"click"],[3,"chat","chatAccepted"],[1,"chat-list-error-info"],[1,"waiting-chat-container",3,"ngClass"],[1,"new-chats-title"],["class","new-chats-counter",4,"ngIf"],[1,"waiting-chat-list"],["class","waiting-chat-item",4,"ngFor","ngForOf"],[1,"new-chats-counter"],[1,"waiting-chat-item"],[3,"contactClick","accountClick","backClick","duplicatesContactsClick","chat","isFirstOpen","activeChats"]],template:function(t,n){t&1&&i.\u0275\u0275template(0,m1,12,8,"div",1)(1,g1,2,3,"ng-container",2),t&2&&(i.\u0275\u0275property("ngIf",!n.conversationMode),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",n.conversationMode))},dependencies:[b.NgClass,b.NgForOf,b.NgIf,Va,He,Ha,v.TranslatePipe],styles:[`@charset "UTF-8";.chat-list-wrap-container{width:331px;height:100%;margin-left:25px}.blankslate-wrapper{font-size:18px;padding:15px;color:#999;font-family:Open Sans Light,serif}.blankslate-wrapper .blankslate-logo{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzQiIGhlaWdodD0iMTM4Ljk5OSIgdmlld0JveD0iMCAwIDEzNCAxMzguOTk5Ij48ZGVmcz48c3R5bGU+LmEsLmIsLmN7ZmlsbDpub25lO30uYSwuYntzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmIsLmN7c3Ryb2tlOiMwMDZjZTA7c3Ryb2tlLXdpZHRoOjJweDt9LmQsLmV7c3Ryb2tlOm5vbmU7fS5le2ZpbGw6IzAwNmNlMDt9PC9zdHlsZT48L2RlZnM+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIzMTguOTUgLTEyMTY3LjQwMSkiPjxnIGNsYXNzPSJhIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MDQgMTE2MzYuNzE2KSI+PHBhdGggY2xhc3M9ImQiIGQ9Ik0xNTgyLjY3MSw1MzAuNjg1YTY2LjY1Niw2Ni42NTYsMCwwLDAtNDcuNTYxLDExMi45N2MtLjEyMS4zNTQtNy4wNywyMC41MjktMjAuMTYsMjYuMDI5LDE3Ljc3LDAsMjguODE1LDAsNDMuMjI0LTguNjg3YTEwLjk1MywxMC45NTMsMCwwLDAsMS42MTYtMS4xODEsNjYuNTQ2LDY2LjU0NiwwLDEsMCwyMi44ODEtMTI5LjEzWiIvPjxwYXRoIGNsYXNzPSJlIiBkPSJNIDE1ODIuNjcxMDIwNTA3ODEzIDUzMi42ODQ5OTc1NTg1OTM4IEMgMTU3My45OTMwNDE5OTIxODggNTMyLjY4NDk5NzU1ODU5MzggMTU2NS41NzU4MDU2NjQwNjMgNTM0LjM5MjM5NTAxOTUzMTMgMTU1Ny42NTMxOTgyNDIxODggNTM3Ljc1OTcwNDU4OTg0MzggQyAxNTUzLjg0NDg0ODYzMjgxMyA1MzkuMzc4Mjk1ODk4NDM3NSAxNTUwLjE3MTYzMDg1OTM3NSA1NDEuMzgxNzc0OTAyMzQzOCAxNTQ2LjczNTQ3MzYzMjgxMyA1NDMuNzE0NTk5NjA5Mzc1IEMgMTU0My4zMzExNzY3NTc4MTMgNTQ2LjAyNTY5NTgwMDc4MTMgMTU0MC4xMzAwMDQ4ODI4MTMgNTQ4LjY3OTkzMTY0MDYyNSAxNTM3LjIyMDU4MTA1NDY4OCA1NTEuNjAzNTc2NjYwMTU2MyBDIDE1MzQuMzExMDM1MTU2MjUgNTU0LjUyNzQwNDc4NTE1NjMgMTUzMS42Njk1NTU2NjQwNjMgNTU3Ljc0NDYyODkwNjI1IDE1MjkuMzY5NTA2ODM1OTM4IDU2MS4xNjU5NTQ1ODk4NDM4IEMgMTUyNy4wNDc2MDc0MjE4NzUgNTY0LjYxOTY4OTk0MTQwNjMgMTUyNS4wNTMzNDQ3MjY1NjMgNTY4LjMxMTc2NzU3ODEyNSAxNTIzLjQ0MjI2MDc0MjE4OCA1NzIuMTM5NzA5NDcyNjU2MyBDIDE1MjAuMDkwMjA5OTYwOTM4IDU4MC4xMDQxMjU5NzY1NjI1IDE1MTguMzkwNTAyOTI5Njg4IDU4OC41NjU3MzQ4NjMyODEzIDE1MTguMzkwNTAyOTI5Njg4IDU5Ny4yODk2MTE4MTY0MDYzIEMgMTUxOC4zOTA1MDI5Mjk2ODggNjA1LjgzNzg5MDYyNSAxNTIwLjAyNzk1NDEwMTU2MyA2MTQuMTQyODgzMzAwNzgxMyAxNTIzLjI1NzIwMjE0ODQzOCA2MjEuOTczOTM3OTg4MjgxMyBDIDE1MjQuODA5NDQ4MjQyMTg4IDYyNS43MzgxNTkxNzk2ODc1IDE1MjYuNzMyMjk5ODA0Njg4IDYyOS4zNzcwMTQxNjAxNTYzIDE1MjguOTcyMjkwMDM5MDYzIDYzMi43ODk1NTA3ODEyNSBDIDE1MzEuMTg5Njk3MjY1NjI1IDYzNi4xNjc0ODA0Njg3NSAxNTMzLjczODc2OTUzMTI1IDYzOS4zNTU4MzQ5NjA5Mzc1IDE1MzYuNTQ4OTUwMTk1MzEzIDY0Mi4yNjYxMTMyODEyNSBMIDE1MzcuMzk3MDk0NzI2NTYzIDY0My4xNDQ0MDkxNzk2ODc1IEwgMTUzNy4wMDM0MTc5Njg3NSA2NDQuMzAwMjMxOTMzNTkzOCBDIDE1MzYuOTI3OTc4NTE1NjI1IDY0NC41MjE2Njc0ODA0Njg4IDE1MzUuMTE1NzIyNjU2MjUgNjQ5Ljc5MjExNDI1NzgxMjUgMTUzMS42MTg3NzQ0MTQwNjMgNjU1Ljc1MjI1ODMwMDc4MTMgQyAxNTI4LjY0OTI5MTk5MjE4OCA2NjAuODEzMTcxMzg2NzE4OCAxNTI1LjQyMTM4NjcxODc1IDY2NC43OTU0NzExOTE0MDYzIDE1MjEuOTczNTEwNzQyMTg4IDY2Ny42NjExMzI4MTI1IEMgMTUzNS42MTgwNDE5OTIxODggNjY3LjUxOTQwOTE3OTY4NzUgMTU0NS4xNjA2NDQ1MzEyNSA2NjYuNTA3NTY4MzU5Mzc1IDE1NTcuMTQxNjAxNTYyNSA2NTkuMjg0MDU3NjE3MTg3NSBDIDE1NTcuNjMwMjQ5MDIzNDM4IDY1OC45ODk0NDA5MTc5Njg4IDE1NTguMDUxODc5ODgyODEzIDY1OC42ODEzMzU0NDkyMTg4IDE1NTguNDY4MzgzNzg5MDYzIDY1OC4zMTQ1MTQxNjAxNTYzIEwgMTU1OS4zNjQyNTc4MTI1IDY1Ny41MjU1MTI2OTUzMTI1IEwgMTU2MC40ODM4ODY3MTg3NSA2NTcuOTM5NTE0MTYwMTU2MyBDIDE1NjcuNTc4NzM1MzUxNTYzIDY2MC41NjI4MDUxNzU3ODEzIDE1NzUuMDQzNTc5MTAxNTYzIDY2MS44OTI5NDQzMzU5Mzc1IDE1ODIuNjcxMDIwNTA3ODEzIDY2MS44OTI5NDQzMzU5Mzc1IEMgMTU5MS4zNDgyNjY2MDE1NjMgNjYxLjg5Mjk0NDMzNTkzNzUgMTU5OS43NjUwMTQ2NDg0MzggNjYwLjE4NTYwNzkxMDE1NjMgMTYwNy42ODczNzc5Mjk2ODggNjU2LjgxODI5ODMzOTg0MzggQyAxNjExLjQ5NTQ4MzM5ODQzOCA2NTUuMTk5NzA3MDMxMjUgMTYxNS4xNjg1NzkxMDE1NjMgNjUzLjE5NjIyODAyNzM0MzggMTYxOC42MDQ3MzYzMjgxMjUgNjUwLjg2MzQ2NDM1NTQ2ODggQyAxNjIyLjAwODkxMTEzMjgxMyA2NDguNTUyMzY4MTY0MDYyNSAxNjI1LjIxMDIwNTA3ODEyNSA2NDUuODk4MTkzMzU5Mzc1IDE2MjguMTE5NTA2ODM1OTM4IDY0Mi45NzQ1NDgzMzk4NDM4IEMgMTYzMS4wMjkwNTI3MzQzNzUgNjQwLjA1MDc4MTI1IDE2MzMuNjcwNTMyMjI2NTYzIDYzNi44MzM1NTcxMjg5MDYzIDE2MzUuOTcwNzAzMTI1IDYzMy40MTIzNTM1MTU2MjUgQyAxNjM4LjI5MjYwMjUzOTA2MyA2MjkuOTU4Njc5MTk5MjE4OCAxNjQwLjI4Njg2NTIzNDM3NSA2MjYuMjY2NjAxNTYyNSAxNjQxLjg5Nzk0OTIxODc1IDYyMi40Mzg3ODE3MzgyODEzIEMgMTY0NS4yNTAxMjIwNzAzMTMgNjE0LjQ3NDU0ODMzOTg0MzggMTY0Ni45NDk4MjkxMDE1NjMgNjA2LjAxMzEyMjU1ODU5MzggMTY0Ni45NDk4MjkxMDE1NjMgNTk3LjI4OTYxMTgxNjQwNjMgQyAxNjQ2Ljk0OTgyOTEwMTU2MyA1ODguNTY1Nzk1ODk4NDM3NSAxNjQ1LjI1MDEyMjA3MDMxMyA1ODAuMTA0MTg3MDExNzE4OCAxNjQxLjg5Nzk0OTIxODc1IDU3Mi4xMzk3MDk0NzI2NTYzIEMgMTY0MC4yODY3NDMxNjQwNjMgNTY4LjMxMTgyODYxMzI4MTMgMTYzOC4yOTI2MDI1MzkwNjMgNTY0LjYxOTY4OTk0MTQwNjMgMTYzNS45NzA3MDMxMjUgNTYxLjE2NTk1NDU4OTg0MzggQyAxNjMzLjY3MDUzMjIyNjU2MyA1NTcuNzQ0NjI4OTA2MjUgMTYzMS4wMjkwNTI3MzQzNzUgNTU0LjUyNzQwNDc4NTE1NjMgMTYyOC4xMTk1MDY4MzU5MzggNTUxLjYwMzU3NjY2MDE1NjMgQyAxNjI1LjIxMDIwNTA3ODEyNSA1NDguNjc5OTMxNjQwNjI1IDE2MjIuMDA4OTExMTMyODEzIDU0Ni4wMjU2OTU4MDA3ODEzIDE2MTguNjA0NzM2MzI4MTI1IDU0My43MTQ1Mzg1NzQyMTg4IEMgMTYxNS4xNjg1NzkxMDE1NjMgNTQxLjM4MTc3NDkwMjM0MzggMTYxMS40OTU0ODMzOTg0MzggNTM5LjM3ODI5NTg5ODQzNzUgMTYwNy42ODczNzc5Mjk2ODggNTM3Ljc1OTcwNDU4OTg0MzggQyAxNTk5Ljc2NTAxNDY0ODQzOCA1MzQuMzkyMzk1MDE5NTMxMyAxNTkxLjM0ODI2NjYwMTU2MyA1MzIuNjg0OTk3NTU4NTkzOCAxNTgyLjY3MTAyMDUwNzgxMyA1MzIuNjg0OTk3NTU4NTkzOCBNIDE1ODIuNjcxMDIwNTA3ODEzIDUzMC42ODQ5OTc1NTg1OTM4IEMgMTYxOS4yNzU3NTY4MzU5MzggNTMwLjY4NDk5NzU1ODU5MzggMTY0OC45NDk4MjkxMDE1NjMgNTYwLjUwNDMzMzQ5NjA5MzggMTY0OC45NDk4MjkxMDE1NjMgNTk3LjI4OTYxMTgxNjQwNjMgQyAxNjQ4Ljk0OTgyOTEwMTU2MyA2MzQuMDczNzMwNDY4NzUgMTYxOS4yNzU3NTY4MzU5MzggNjYzLjg5Mjk0NDMzNTkzNzUgMTU4Mi42NzEwMjA1MDc4MTMgNjYzLjg5Mjk0NDMzNTkzNzUgQyAxNTc0LjYyODA1MTc1NzgxMyA2NjMuODkyOTQ0MzM1OTM3NSAxNTY2LjkyMTc1MjkyOTY4OCA2NjIuNDUyMjA5NDcyNjU2MyAxNTU5Ljc5MDI4MzIwMzEyNSA2NTkuODE1MzY4NjUyMzQzOCBDIDE1NTkuMzQyNzczNDM3NSA2NjAuMjA5NTMzNjkxNDA2MyAxNTU4LjgyODI0NzA3MDMxMyA2NjAuNjAyNTM5MDYyNSAxNTU4LjE3NDMxNjQwNjI1IDY2MC45OTY4MjYxNzE4NzUgQyAxNTQzLjc2NTI1ODc4OTA2MyA2NjkuNjg0MjY1MTM2NzE4OCAxNTMyLjcxOTcyNjU2MjUgNjY5LjY4NDI2NTEzNjcxODggMTUxNC45NDk4MjkxMDE1NjMgNjY5LjY4NDI2NTEzNjcxODggQyAxNTI4LjA0MDI4MzIwMzEyNSA2NjQuMTg0NTA5Mjc3MzQzOCAxNTM0Ljk4OTYyNDAyMzQzOCA2NDQuMDA5Mzk5NDE0MDYyNSAxNTM1LjExMDIyOTQ5MjE4OCA2NDMuNjU1MzM0NDcyNjU2MyBDIDE1MjMuNTMxMjUgNjMxLjY2MzgxODM1OTM3NSAxNTE2LjM5MDUwMjkyOTY4OCA2MTUuMzE4MTc2MjY5NTMxMyAxNTE2LjM5MDUwMjkyOTY4OCA1OTcuMjg5NjExODE2NDA2MyBDIDE1MTYuMzkwNTAyOTI5Njg4IDU2MC41MDQzMzM0OTYwOTM4IDE1NDYuMDYzMzU0NDkyMTg4IDUzMC42ODQ5OTc1NTg1OTM4IDE1ODIuNjcxMDIwNTA3ODEzIDUzMC42ODQ5OTc1NTg1OTM4IFoiLz48L2c+PHBhdGggY2xhc3M9ImIiIGQ9Ik0xNTQ3Ljk1LDYwOS42ODZoN3YxMGwxMC0xMGgzOHYtNDNoLTU1WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoODExIDExNjQ0LjcxNSkiLz48cGF0aCBjbGFzcz0iYyIgZD0iTTIzODIuNTUzLDEyMjMwLjczNmw3LjY2OSw5LjY2NiwxNi43MjgtMTkuNDE0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNiAxLjk5OSkiLz48L2c+PC9zdmc+);width:135px;height:139px;margin:80px auto 0}.blankslate-wrapper .blankslate-logo.no-active-chats{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzQiIGhlaWdodD0iMTM4Ljk5OSIgdmlld0JveD0iMCAwIDEzNCAxMzguOTk5Ij48ZGVmcz48c3R5bGU+LmEsLmIsLmV7ZmlsbDpub25lO30uYSwuYntzdHJva2UtbWl0ZXJsaW1pdDoxMDt9LmJ7c3Ryb2tlOiMwMDZjZTA7c3Ryb2tlLXdpZHRoOjJweDt9LmN7ZmlsbDojMDA2Y2UwO30uZHtmaWxsOiNmZmY7Zm9udC1zaXplOjVweDtmb250LWZhbWlseTpPcGVuU2Fucy1TZW1pQm9sZCwgT3BlbiBTYW5zO2ZvbnQtd2VpZ2h0OjYwMDt9LmV7c3Ryb2tlOiMwMDU4ZWY7fS5mLC5ne3N0cm9rZTpub25lO30uZ3tmaWxsOiMwMDZjZTA7fTwvc3R5bGU+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzYyIC0yMzIpIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtOTU2Ljk1IC0xMTkzNS40KSI+PGcgY2xhc3M9ImEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgwNCAxMTYzNi43MTYpIj48cGF0aCBjbGFzcz0iZiIgZD0iTTE1ODIuNjcxLDUzMC42ODVhNjYuNjU2LDY2LjY1NiwwLDAsMC00Ny41NjEsMTEyLjk3Yy0uMTIxLjM1NC03LjA3LDIwLjUyOS0yMC4xNiwyNi4wMjksMTcuNzcsMCwyOC44MTUsMCw0My4yMjQtOC42ODdhMTAuOTUzLDEwLjk1MywwLDAsMCwxLjYxNi0xLjE4MSw2Ni41NDYsNjYuNTQ2LDAsMSwwLDIyLjg4MS0xMjkuMTNaIi8+PHBhdGggY2xhc3M9ImciIGQ9Ik0gMTU4Mi42NzEwMjA1MDc4MTMgNTMyLjY4NDk5NzU1ODU5MzggQyAxNTczLjk5MzA0MTk5MjE4OCA1MzIuNjg0OTk3NTU4NTkzOCAxNTY1LjU3NTgwNTY2NDA2MyA1MzQuMzkyMzk1MDE5NTMxMyAxNTU3LjY1MzE5ODI0MjE4OCA1MzcuNzU5NzA0NTg5ODQzOCBDIDE1NTMuODQ0ODQ4NjMyODEzIDUzOS4zNzgyOTU4OTg0Mzc1IDE1NTAuMTcxNjMwODU5Mzc1IDU0MS4zODE3NzQ5MDIzNDM4IDE1NDYuNzM1NDczNjMyODEzIDU0My43MTQ1OTk2MDkzNzUgQyAxNTQzLjMzMTE3Njc1NzgxMyA1NDYuMDI1Njk1ODAwNzgxMyAxNTQwLjEzMDAwNDg4MjgxMyA1NDguNjc5OTMxNjQwNjI1IDE1MzcuMjIwNTgxMDU0Njg4IDU1MS42MDM1NzY2NjAxNTYzIEMgMTUzNC4zMTEwMzUxNTYyNSA1NTQuNTI3NDA0Nzg1MTU2MyAxNTMxLjY2OTU1NTY2NDA2MyA1NTcuNzQ0NjI4OTA2MjUgMTUyOS4zNjk1MDY4MzU5MzggNTYxLjE2NTk1NDU4OTg0MzggQyAxNTI3LjA0NzYwNzQyMTg3NSA1NjQuNjE5Njg5OTQxNDA2MyAxNTI1LjA1MzM0NDcyNjU2MyA1NjguMzExNzY3NTc4MTI1IDE1MjMuNDQyMjYwNzQyMTg4IDU3Mi4xMzk3MDk0NzI2NTYzIEMgMTUyMC4wOTAyMDk5NjA5MzggNTgwLjEwNDEyNTk3NjU2MjUgMTUxOC4zOTA1MDI5Mjk2ODggNTg4LjU2NTczNDg2MzI4MTMgMTUxOC4zOTA1MDI5Mjk2ODggNTk3LjI4OTYxMTgxNjQwNjMgQyAxNTE4LjM5MDUwMjkyOTY4OCA2MDUuODM3ODkwNjI1IDE1MjAuMDI3OTU0MTAxNTYzIDYxNC4xNDI4ODMzMDA3ODEzIDE1MjMuMjU3MjAyMTQ4NDM4IDYyMS45NzM5Mzc5ODgyODEzIEMgMTUyNC44MDk0NDgyNDIxODggNjI1LjczODE1OTE3OTY4NzUgMTUyNi43MzIyOTk4MDQ2ODggNjI5LjM3NzAxNDE2MDE1NjMgMTUyOC45NzIyOTAwMzkwNjMgNjMyLjc4OTU1MDc4MTI1IEMgMTUzMS4xODk2OTcyNjU2MjUgNjM2LjE2NzQ4MDQ2ODc1IDE1MzMuNzM4NzY5NTMxMjUgNjM5LjM1NTgzNDk2MDkzNzUgMTUzNi41NDg5NTAxOTUzMTMgNjQyLjI2NjExMzI4MTI1IEwgMTUzNy4zOTcwOTQ3MjY1NjMgNjQzLjE0NDQwOTE3OTY4NzUgTCAxNTM3LjAwMzQxNzk2ODc1IDY0NC4zMDAyMzE5MzM1OTM4IEMgMTUzNi45Mjc5Nzg1MTU2MjUgNjQ0LjUyMTY2NzQ4MDQ2ODggMTUzNS4xMTU3MjI2NTYyNSA2NDkuNzkyMTE0MjU3ODEyNSAxNTMxLjYxODc3NDQxNDA2MyA2NTUuNzUyMjU4MzAwNzgxMyBDIDE1MjguNjQ5MjkxOTkyMTg4IDY2MC44MTMxNzEzODY3MTg4IDE1MjUuNDIxMzg2NzE4NzUgNjY0Ljc5NTQ3MTE5MTQwNjMgMTUyMS45NzM1MTA3NDIxODggNjY3LjY2MTEzMjgxMjUgQyAxNTM1LjYxODA0MTk5MjE4OCA2NjcuNTE5NDA5MTc5Njg3NSAxNTQ1LjE2MDY0NDUzMTI1IDY2Ni41MDc1NjgzNTkzNzUgMTU1Ny4xNDE2MDE1NjI1IDY1OS4yODQwNTc2MTcxODc1IEMgMTU1Ny42MzAyNDkwMjM0MzggNjU4Ljk4OTQ0MDkxNzk2ODggMTU1OC4wNTE4Nzk4ODI4MTMgNjU4LjY4MTMzNTQ0OTIxODggMTU1OC40NjgzODM3ODkwNjMgNjU4LjMxNDUxNDE2MDE1NjMgTCAxNTU5LjM2NDI1NzgxMjUgNjU3LjUyNTUxMjY5NTMxMjUgTCAxNTYwLjQ4Mzg4NjcxODc1IDY1Ny45Mzk1MTQxNjAxNTYzIEMgMTU2Ny41Nzg3MzUzNTE1NjMgNjYwLjU2MjgwNTE3NTc4MTMgMTU3NS4wNDM1NzkxMDE1NjMgNjYxLjg5Mjk0NDMzNTkzNzUgMTU4Mi42NzEwMjA1MDc4MTMgNjYxLjg5Mjk0NDMzNTkzNzUgQyAxNTkxLjM0ODI2NjYwMTU2MyA2NjEuODkyOTQ0MzM1OTM3NSAxNTk5Ljc2NTAxNDY0ODQzOCA2NjAuMTg1NjA3OTEwMTU2MyAxNjA3LjY4NzM3NzkyOTY4OCA2NTYuODE4Mjk4MzM5ODQzOCBDIDE2MTEuNDk1NDgzMzk4NDM4IDY1NS4xOTk3MDcwMzEyNSAxNjE1LjE2ODU3OTEwMTU2MyA2NTMuMTk2MjI4MDI3MzQzOCAxNjE4LjYwNDczNjMyODEyNSA2NTAuODYzNDY0MzU1NDY4OCBDIDE2MjIuMDA4OTExMTMyODEzIDY0OC41NTIzNjgxNjQwNjI1IDE2MjUuMjEwMjA1MDc4MTI1IDY0NS44OTgxOTMzNTkzNzUgMTYyOC4xMTk1MDY4MzU5MzggNjQyLjk3NDU0ODMzOTg0MzggQyAxNjMxLjAyOTA1MjczNDM3NSA2NDAuMDUwNzgxMjUgMTYzMy42NzA1MzIyMjY1NjMgNjM2LjgzMzU1NzEyODkwNjMgMTYzNS45NzA3MDMxMjUgNjMzLjQxMjM1MzUxNTYyNSBDIDE2MzguMjkyNjAyNTM5MDYzIDYyOS45NTg2NzkxOTkyMTg4IDE2NDAuMjg2ODY1MjM0Mzc1IDYyNi4yNjY2MDE1NjI1IDE2NDEuODk3OTQ5MjE4NzUgNjIyLjQzODc4MTczODI4MTMgQyAxNjQ1LjI1MDEyMjA3MDMxMyA2MTQuNDc0NTQ4MzM5ODQzOCAxNjQ2Ljk0OTgyOTEwMTU2MyA2MDYuMDEzMTIyNTU4NTkzOCAxNjQ2Ljk0OTgyOTEwMTU2MyA1OTcuMjg5NjExODE2NDA2MyBDIDE2NDYuOTQ5ODI5MTAxNTYzIDU4OC41NjU3OTU4OTg0Mzc1IDE2NDUuMjUwMTIyMDcwMzEzIDU4MC4xMDQxODcwMTE3MTg4IDE2NDEuODk3OTQ5MjE4NzUgNTcyLjEzOTcwOTQ3MjY1NjMgQyAxNjQwLjI4Njc0MzE2NDA2MyA1NjguMzExODI4NjEzMjgxMyAxNjM4LjI5MjYwMjUzOTA2MyA1NjQuNjE5Njg5OTQxNDA2MyAxNjM1Ljk3MDcwMzEyNSA1NjEuMTY1OTU0NTg5ODQzOCBDIDE2MzMuNjcwNTMyMjI2NTYzIDU1Ny43NDQ2Mjg5MDYyNSAxNjMxLjAyOTA1MjczNDM3NSA1NTQuNTI3NDA0Nzg1MTU2MyAxNjI4LjExOTUwNjgzNTkzOCA1NTEuNjAzNTc2NjYwMTU2MyBDIDE2MjUuMjEwMjA1MDc4MTI1IDU0OC42Nzk5MzE2NDA2MjUgMTYyMi4wMDg5MTExMzI4MTMgNTQ2LjAyNTY5NTgwMDc4MTMgMTYxOC42MDQ3MzYzMjgxMjUgNTQzLjcxNDUzODU3NDIxODggQyAxNjE1LjE2ODU3OTEwMTU2MyA1NDEuMzgxNzc0OTAyMzQzOCAxNjExLjQ5NTQ4MzM5ODQzOCA1MzkuMzc4Mjk1ODk4NDM3NSAxNjA3LjY4NzM3NzkyOTY4OCA1MzcuNzU5NzA0NTg5ODQzOCBDIDE1OTkuNzY1MDE0NjQ4NDM4IDUzNC4zOTIzOTUwMTk1MzEzIDE1OTEuMzQ4MjY2NjAxNTYzIDUzMi42ODQ5OTc1NTg1OTM4IDE1ODIuNjcxMDIwNTA3ODEzIDUzMi42ODQ5OTc1NTg1OTM4IE0gMTU4Mi42NzEwMjA1MDc4MTMgNTMwLjY4NDk5NzU1ODU5MzggQyAxNjE5LjI3NTc1NjgzNTkzOCA1MzAuNjg0OTk3NTU4NTkzOCAxNjQ4Ljk0OTgyOTEwMTU2MyA1NjAuNTA0MzMzNDk2MDkzOCAxNjQ4Ljk0OTgyOTEwMTU2MyA1OTcuMjg5NjExODE2NDA2MyBDIDE2NDguOTQ5ODI5MTAxNTYzIDYzNC4wNzM3MzA0Njg3NSAxNjE5LjI3NTc1NjgzNTkzOCA2NjMuODkyOTQ0MzM1OTM3NSAxNTgyLjY3MTAyMDUwNzgxMyA2NjMuODkyOTQ0MzM1OTM3NSBDIDE1NzQuNjI4MDUxNzU3ODEzIDY2My44OTI5NDQzMzU5Mzc1IDE1NjYuOTIxNzUyOTI5Njg4IDY2Mi40NTIyMDk0NzI2NTYzIDE1NTkuNzkwMjgzMjAzMTI1IDY1OS44MTUzNjg2NTIzNDM4IEMgMTU1OS4zNDI3NzM0Mzc1IDY2MC4yMDk1MzM2OTE0MDYzIDE1NTguODI4MjQ3MDcwMzEzIDY2MC42MDI1MzkwNjI1IDE1NTguMTc0MzE2NDA2MjUgNjYwLjk5NjgyNjE3MTg3NSBDIDE1NDMuNzY1MjU4Nzg5MDYzIDY2OS42ODQyNjUxMzY3MTg4IDE1MzIuNzE5NzI2NTYyNSA2NjkuNjg0MjY1MTM2NzE4OCAxNTE0Ljk0OTgyOTEwMTU2MyA2NjkuNjg0MjY1MTM2NzE4OCBDIDE1MjguMDQwMjgzMjAzMTI1IDY2NC4xODQ1MDkyNzczNDM4IDE1MzQuOTg5NjI0MDIzNDM4IDY0NC4wMDkzOTk0MTQwNjI1IDE1MzUuMTEwMjI5NDkyMTg4IDY0My42NTUzMzQ0NzI2NTYzIEMgMTUyMy41MzEyNSA2MzEuNjYzODE4MzU5Mzc1IDE1MTYuMzkwNTAyOTI5Njg4IDYxNS4zMTgxNzYyNjk1MzEzIDE1MTYuMzkwNTAyOTI5Njg4IDU5Ny4yODk2MTE4MTY0MDYzIEMgMTUxNi4zOTA1MDI5Mjk2ODggNTYwLjUwNDMzMzQ5NjA5MzggMTU0Ni4wNjMzNTQ0OTIxODggNTMwLjY4NDk5NzU1ODU5MzggMTU4Mi42NzEwMjA1MDc4MTMgNTMwLjY4NDk5NzU1ODU5MzggWiIvPjwvZz48cGF0aCBjbGFzcz0iYiIgZD0iTTE1NDcuOTUsNjA5LjY4Nmg3djEwbDEwLTEwaDM4di00M2gtNTVaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MTEgMTE2NDQuNzE1KSIvPjxyZWN0IGNsYXNzPSJjIiB3aWR0aD0iMjEiIGhlaWdodD0iMTEiIHJ4PSIxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMzg5Ljk1IDEyMjQwLjQpIi8+PC9nPjx0ZXh0IGNsYXNzPSJkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDM4IDMxMykiPjx0c3BhbiB4PSIwIiB5PSIwIj5ORVc8L3RzcGFuPjwvdGV4dD48bGluZSBjbGFzcz0iZSIgeTE9IjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0MzQuNSAyOTYuNSkiLz48bGluZSBjbGFzcz0iZSIgeDE9IjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0MjQuNSAzMDcuNSkiLz48bGluZSBjbGFzcz0iZSIgeDE9IjQiIHkxPSI0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNDI3LjUgMjk5LjUpIi8+PC9nPjwvc3ZnPg)}.blankslate-wrapper .blankslate-reason{margin:70px auto 0;text-align:center}.blankslate-wrapper .blankslate-description{margin:50px auto 0 30px;border-left:2px solid #64b8df;padding:15px 50px 15px 20px;width:auto}.blankslate-wrapper .blankslate-description a{color:#4e7bd8;text-decoration:none}.blankslate-wrapper .blankslate-description a:hover{text-decoration:underline}.chat-list{overflow-y:auto;height:calc(100% - 60px)}.chat-list.has-new-chats{height:calc(100% - 280px)}.chat-list ::-webkit-scrollbar{-webkit-appearance:none;width:5px;height:5px}.chat-list ::-webkit-scrollbar-thumb{background-color:#0003}div.chat-list-header-container{border-bottom:#e3e6ec 1px solid}div.chat-list-header-container .chat-list-header-title{display:inline-block;text-align:left;letter-spacing:0px;color:#006ce0;font-size:16px;font-family:Open Sans,serif;margin:10px 0}div.chat-list-header-container .notifications-disabled-alert{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNi4wMDEiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNi4wMDEgMTYiPjxkZWZzPjxzdHlsZT4uYXtmaWxsOiNmZjk0M2U7fS5iLC5ke2ZpbGw6bm9uZTt9LmJ7c3Ryb2tlOiNmZmY7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLXdpZHRoOjJweDt9LmN7ZmlsbDojZmZmO308L3N0eWxlPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4NzcuODYyIC0xNTEuNTMzKSI+PHBhdGggY2xhc3M9ImEiIGQ9Ik0tODYyLjgyOCwxNjYuNzUxSC04NzYuOWEuOTY0Ljk2NCwwLDAsMS0uODQtMS40MzhsNy4wMzMtMTIuNTA1YS45NjUuOTY1LDAsMCwxLDEuNjgyLDBsNy4wMzQsMTIuNTA1QS45NjUuOTY1LDAsMCwxLTg2Mi44MjgsMTY2Ljc1MVoiLz48bGluZSBjbGFzcz0iYiIgeTI9IjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC04NjkuODYxIDE1Ny41MzMpIi8+PGNpcmNsZSBjbGFzcz0iYyIgY3g9IjEiIGN5PSIxIiByPSIxIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtODcwLjg2MiAxNjMuNTMzKSIvPjwvZz48cmVjdCBjbGFzcz0iZCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMSkiLz48L3N2Zz4=);display:inline-block;width:16px;height:16px;position:absolute;margin-top:14px;margin-left:8px}div.chat-list-header-container .operator-status-header-container{display:block;margin-top:10px;float:right;margin-right:20px}ts-conversation ::-webkit-scrollbar{-webkit-appearance:none;width:5px;height:5px}ts-conversation ::-webkit-scrollbar-thumb{background-color:#0003}ts-omnichannel-messaging-chat-list{height:100%}body .cdk-overlay-container{z-index:1003}body .cdk-overlay-container .mat-mdc-menu-panel{min-height:30px;border-radius:0}body .cdk-overlay-container .mat-mdc-menu-item:hover:not([disabled]){background:#f2f5ff}body .cdk-overlay-container .mat-mdc-menu-content{padding:0}body .cdk-overlay-container .actions-menu-item-button-content{font-family:Open Sans,serif}.full-chat-image-container{top:0;width:100%;height:100%;z-index:999999999999;position:fixed;align-items:center;background-position:center;background-repeat:no-repeat;background-color:#000000b3}.waiting-chat-container{position:fixed;bottom:15px;height:210px;overflow:hidden;transition:height .5s;max-height:60em;background-color:#fff;padding-top:10px;margin-right:53px;width:331px}.waiting-chat-container .new-chats-counter{display:block;width:19px;height:19px;background-color:red;border-radius:50%;color:#fff;position:absolute;text-align:center;font-size:12px;top:30px;left:3px}.waiting-chat-container.can-expand:hover{height:auto;border-top:#e3e6ec 1px solid}.waiting-chat-container.can-expand:hover .new-chats-title{font-size:16px;color:#006ce0}.waiting-chat-container.can-expand:hover .waiting-chat-list{overflow:hidden auto;scrollbar-width:none}.waiting-chat-container.can-expand:hover .waiting-chat-list::-webkit-scrollbar{width:0px}.waiting-chat-container.can-expand:hover .new-chats-counter{display:none}.waiting-chat-container.can-expand:hover .waiting-chat-item{visibility:visible!important}.waiting-chat-container .new-chats-title{font-size:12px;color:#757575}.waiting-chat-container .waiting-chat-list{max-height:58em}.waiting-chat-container .waiting-chat-list .waiting-chat-item{padding-top:10px;visibility:hidden}.waiting-chat-container .waiting-chat-list .waiting-chat-item:first-child{visibility:visible}.waiting-chat-container .waiting-chat-list .waiting-chat-item:last-child{padding-bottom:15px}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned{background-color:#006ce0;border:1px solid #e5e5e5;border-radius:8px;color:#fff;padding-right:15px;padding-left:15px}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .accept-chat-button{border-radius:16px}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .chat-info-container{border-bottom:none;margin-left:16px;cursor:default;padding-right:0}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .chat-info-container .account-name{text-overflow:ellipsis;overflow:hidden;-webkit-line-clamp:3;-webkit-box-orient:vertical;white-space:pre;max-height:18px;width:calc(100% - 80px)}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .message-time{color:#fff}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .contact-photo-container{display:inline-block;border:1px solid white;border-radius:50%;height:34px}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .contact-photo-container img{cursor:default}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .contact-name-container .contact-name{color:#fff;cursor:default;text-overflow:ellipsis;overflow:hidden;-webkit-line-clamp:3;-webkit-box-orient:vertical;white-space:pre;max-height:22px}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .contact-name-container .contact-name:hover{text-decoration:none}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .chat-list-menu{display:none;visibility:hidden}.waiting-chat-container .waiting-chat-list .waiting-chat-item ts-chat-item .chat-item-wrapper.is-not-assigned .buttons-container{padding-bottom:10px}.n-tip{position:relative;top:20px;left:-113px}.n-tip.align-bottom .n-tip-anchor,.n-tip.align-bottom .n-tip-anchor:after{border-left-color:transparent;border-right-color:transparent;border-top-color:transparent;border-bottom-style:solid}.n-tip-content{overflow:hidden;word-wrap:break-word;font-size:13px;font-family:Open Sans,Regular,sans-serif;white-space:pre-wrap;color:#181818;margin-right:.4em}.n-tip-anchor{position:absolute;border-width:.6em}.n-tip-anchor:before{position:absolute;font-size:1.2em;color:transparent;z-index:-1;text-shadow:0 0 .3em rgba(0,0,0,.3)}.n-tip-anchor:after{content:"";border-width:.6em;position:absolute}.n-tip-anchor,.n-tip-anchor:after{border-style:double}.n-tip-red .n-tip-border{background-color:#fff;border-color:#ff4013}.n-tip-red .n-tip-anchor{border-color:#ff4013}.n-tip-red .n-tip-anchor:after{border-color:#fff}.align-bottom .n-tip-anchor{left:50%;margin-left:-.5em;margin-top:-1.1em}.align-bottom .n-tip-anchor:before{left:-.5em;top:-.1em;content:"\\25b2"}.align-bottom .n-tip-anchor:after{margin-top:-.2em;margin-left:-.6em}.align-bottom .n-tip-border{border-left:none;border-bottom:none;border-right:none}.n-tip-border{padding:1.5em;border:.3em solid;box-shadow:#0000004d 0 0 .6em .02em;-moz-box-shadow:rgba(0,0,0,.3) 0 0 .2em;-webkit-box-shadow:rgba(0,0,0,.3) 0 0 .2em}.notification-tooltip-hint{display:none;align-items:center;background:#fff;text-align:left;border-radius:50px;border:none;padding:5px;box-shadow:none;width:240px;max-width:240px}div:hover.notifications-disabled-alert div.notification-tooltip-hint{display:block}
`],encapsulation:2})}}function E1(a,e){if(a&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"button",5),i.\u0275\u0275listener("click",function(s){const r=i.\u0275\u0275restoreView(t).$implicit,o=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(o.contactChosen(s,r))}),i.\u0275\u0275element(1,"ts-contact-photo",6),i.\u0275\u0275elementStart(2,"div",7)(3,"span"),i.\u0275\u0275text(4),i.\u0275\u0275elementEnd()()()}if(a&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275propertyInterpolate1("id","contact-menu-item-",t.id,""),i.\u0275\u0275advance(),i.\u0275\u0275property("contact",t)("contactColor",n.contactColorService.getNextColor(t.id)),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate(t.name)}}class Sc{constructor(e,t,n){this.contactColorService=e,this.customEventService=t,this.container=n,this.contactClick=new i.EventEmitter}ngAfterViewInit(){this.trigger.openMenu()}ngOnInit(){this.contacts$=this.customEventService.getDataViaEvent("SetContactList")}destroy(){const e=this.container.element.nativeElement;e.parentElement.removeChild(e)}contactChosen(e,t){this.contactClick.emit({contactId:t.id})}static{this.\u0275fac=function(t){return new(t||Sc)(i.\u0275\u0275directiveInject(cn),i.\u0275\u0275directiveInject(P.Dj),i.\u0275\u0275directiveInject(i.ViewContainerRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:Sc,selectors:[["ts-popup-list"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(R.MatMenuTrigger,5),i.\u0275\u0275viewQuery(R.MatMenu,5)),t&2){let s;i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.trigger=s.first),i.\u0275\u0275queryRefresh(s=i.\u0275\u0275loadQuery())&&(n.menu=s.first)}},inputs:{contacts$:"contacts$"},outputs:{contactClick:"contactClick"},decls:6,vars:4,consts:[["menu","matMenu"],[1,"ts-popup-list",3,"matMenuTriggerFor"],["yPosition","below","xPosition","after",1,"popup-list-menu",3,"closed"],[1,"contact-items"],["mat-menu-item","","class","contact-item",3,"id","click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"contact-item",3,"click","id"],[1,"contact-photo",3,"contact","contactColor"],[1,"contact-item-text-wrapper"]],template:function(t,n){if(t&1){const s=i.\u0275\u0275getCurrentView();i.\u0275\u0275element(0,"div",1),i.\u0275\u0275elementStart(1,"mat-menu",2,0),i.\u0275\u0275listener("closed",function(){return i.\u0275\u0275restoreView(s),i.\u0275\u0275resetView(n.destroy())}),i.\u0275\u0275elementStart(3,"div",3),i.\u0275\u0275template(4,E1,5,5,"button",4),i.\u0275\u0275pipe(5,"async"),i.\u0275\u0275elementEnd()()}if(t&2){const s=i.\u0275\u0275reference(2);i.\u0275\u0275property("matMenuTriggerFor",s),i.\u0275\u0275advance(4),i.\u0275\u0275property("ngForOf",i.\u0275\u0275pipeBind1(5,2,n.contacts$))}},dependencies:[b.NgForOf,St,R.MatMenu,R.MatMenuItem,R.MatMenuTrigger,b.AsyncPipe],styles:[`.ts-popup-list{width:1px;height:1px}.popup-list-menu{width:336px;max-width:336px!important;margin-top:5px;border-radius:10px!important;max-height:356px!important;overflow:unset!important;position:absolute;left:-30px}.popup-list-menu .mat-mdc-menu-content{padding:5px 0!important}.popup-list-menu .contact-items{overflow:hidden auto;max-height:346px}.popup-list-menu .contact-items::-webkit-scrollbar{-webkit-appearance:none;width:4px;height:4px}.popup-list-menu .contact-items::-webkit-scrollbar-thumb{background-color:#0003}.popup-list-menu .contact-items .contact-item{height:48px!important;margin:0;padding-left:16px}.popup-list-menu .contact-items .contact-item .contact-photo{display:inline-block;vertical-align:middle}.popup-list-menu .contact-items .contact-item .contact-item-text-wrapper{display:inline-block;width:260px;vertical-align:middle;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-left:8px}.popup-list-menu:before{border-color:transparent;border-bottom-color:#fff!important;top:-6px;left:36px;border-width:0px 8px 6px;transform-origin:center top;content:"";position:absolute;border-style:solid}
`],encapsulation:2})}}const D1="CRT_CSRF",Hv="CRT_LOADER",Yv="CRT_SESSIONID",Zv="bpmHref",Wv="bpmRef",ep={production:!0,appPath:at(),workspaceBaseUrl:ae(),csrfCookieName:D1,defaultCulture:"en-US",defaultApplicationUrl:"Nui/ViewModule.aspx",translateServiceUri:"/assets/i18n/"},A1=m.p+"assets/i18n/libs/",O1=m.p+"assets/i18n/";function P1(a,e){return()=>(0,u.lastValueFrom)(a.loadCurrentUserInfo().pipe((0,c.tap)(()=>e.initialize())),{defaultValue:null})}class vc{constructor(e){this.injector=e}ngDoBootstrap(e){const t=(0,M.createCustomElement)(bc,{injector:this.injector});customElements.get("ts-omnichannel-messaging-chat-list")||customElements.define("ts-omnichannel-messaging-chat-list",t);const n=(0,M.createCustomElement)(Dn,{injector:this.injector});customElements.get("ts-omnichannel-messaging-chat-history")||customElements.define("ts-omnichannel-messaging-chat-history",n);const s=(0,M.createCustomElement)(Sc,{injector:this.injector});customElements.get("ts-popup-contact-list")||customElements.define("ts-popup-contact-list",s)}static{this.\u0275fac=function(t){return new(t||vc)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:vc})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[{provide:i.APP_INITIALIZER,useFactory:P1,deps:[L.fv,$],multi:!0},{provide:E.HTTP_INTERCEPTORS,useClass:Za,multi:!0},{provide:"environment",useValue:ep},L.vn,P.rK,(0,E.provideHttpClient)((0,E.withXsrfConfiguration)({cookieName:ep.csrfCookieName,headerName:ep.csrfCookieName}))],imports:[y.BrowserModule,Ya,R.MatMenuModule,kn.forRoot({defaultLanguage:"en-US",resourceSources:[{prefix:O1,suffix:".json"},{prefix:A1,suffix:".json"}]})]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(vc,{declarations:[bc,Sc],imports:[y.BrowserModule,Ya,R.MatMenuModule,v.TranslateModule]})})(),y.platformBrowser().bootstrapModule(vc).catch(a=>console.error(a))},86464:(D,X,m)=>{m.d(X,{r:()=>y});var y;(function(g){g[g.Guid=0]="Guid",g[g.Text=1]="Text",g[g.Integer=4]="Integer",g[g.Float=5]="Float",g[g.Money=6]="Money",g[g.DateTime=7]="DateTime",g[g.Date=8]="Date",g[g.Time=9]="Time",g[g.Lookup=10]="Lookup",g[g.Enum=11]="Enum",g[g.Boolean=12]="Boolean",g[g.Blob=13]="Blob",g[g.Image=14]="Image",g[g.CUSTOM_OBJECT=15]="CUSTOM_OBJECT",g[g.IMAGELOOKUP=16]="IMAGELOOKUP",g[g.COLLECTION=17]="COLLECTION",g[g.Color=18]="Color",g[g.LOCALIZABLE_STRING=19]="LOCALIZABLE_STRING",g[g.ENTITY=20]="ENTITY",g[g.ENTITY_COLLECTION=21]="ENTITY_COLLECTION",g[g.ENTITY_COLUMN_MAPPING_COLLECTION=22]="ENTITY_COLUMN_MAPPING_COLLECTION",g[g.HASH_TEXT=23]="HASH_TEXT",g[g.SECURE_TEXT=24]="SECURE_TEXT",g[g.FILE=25]="FILE",g[g.MAPPING=26]="MAPPING",g[g.SHORT_TEXT=27]="SHORT_TEXT",g[g.MEDIUM_TEXT=28]="MEDIUM_TEXT",g[g.MAXSIZE_TEXT=29]="MAXSIZE_TEXT",g[g.LONG_TEXT=30]="LONG_TEXT",g[g.FLOAT1=31]="FLOAT1",g[g.FLOAT2=32]="FLOAT2",g[g.FLOAT3=33]="FLOAT3",g[g.FLOAT4=34]="FLOAT4",g[g.LOCALIZABLE_PARAMETER_VALUES_LIST=35]="LOCALIZABLE_PARAMETER_VALUES_LIST",g[g.METADATA_TEXT=36]="METADATA_TEXT",g[g.STAGE_INDICATOR=37]="STAGE_INDICATOR",g[g.OBJECT_LIST=38]="OBJECT_LIST",g[g.COMPOSITE_OBJECT_LIST=39]="COMPOSITE_OBJECT_LIST",g[g.FLOAT8=40]="FLOAT8",g[g.FILE_LOCATOR=41]="FILE_LOCATOR",g[g.PHONE_TEXT=42]="PHONE_TEXT",g[g.RICH_TEXT=43]="RICH_TEXT",g[g.WEB_TEXT=44]="WEB_TEXT",g[g.EMAIL_TEXT=45]="EMAIL_TEXT",g[g.COMPOSITE_OBJECT=46]="COMPOSITE_OBJECT",g[g.FLOAT0=47]="FLOAT0",g[g.MONEY0=48]="MONEY0",g[g.MONEY1=49]="MONEY1",g[g.MONEY3=50]="MONEY3"})(y||(y={}))},6530:(D,X,m)=>{m.d(X,{gZ:()=>R,n7:()=>M,qv:()=>i});const y="00000000-0000-0000-0000-000000000000",g=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function E(P){let v="";for(let L=0;L<P;L++)v+=((1+Math.random())*65536|0).toString(16).substring(1);return v}function i(){return[E(2),E(1),E(1),E(1),E(3)].join("-")}function M(P){return!!P&&g.test(P)}function R(P){return!P||P===y}},84065:(D,X,m)=>{m.d(X,{NS:()=>Ec,Vx:()=>G,op:()=>Ga,Dj:()=>P,X4:()=>jn,MV:()=>_e,G8:()=>v,gX:()=>Pn,sj:()=>At,gP:()=>Le,$A:()=>Et,wZ:()=>lt,cn:()=>_u,rK:()=>Ge,ZP:()=>W,S:()=>at,BB:()=>Qa,hk:()=>Ac,mh:()=>c,BV:()=>hn,DH:()=>mu,pR:()=>gu});var y=m(67057),g=m(22307),E=m(62278),i=m(36486);const M=new g.InjectionToken("CustomEventApplicationIdToken"),R=new g.InjectionToken("CustomEventServiceToken");class P{constructor(x,w=null){this.document=x,this.appId=w,this.customEventName="TSCustomEventChannel",this.appId=w||Math.random().toString()}subscribe(x){return this.customEventObserver$=this.customEventObserver$||(0,E.fromEvent)(document,this.customEventName),this.customEventObserver$.pipe((0,i.filter)(w=>w.detail.eventName===x&&w.detail.sender!==this.appId),(0,i.map)(w=>w.detail.payload))}createOutboundChannel(x){const w=new E.Subject;return w.asObservable().subscribe(j=>{const V=new CustomEvent(this.customEventName,{detail:{eventName:x,sender:this.appId,payload:j}});this.document.dispatchEvent(V)}),w}getDataViaEvent(x,w={}){return new E.Observable(j=>{this.subscribe(x).pipe((0,i.first)()).subscribe(V=>{j.next(V),j.complete()}),this.createOutboundChannel(x).next(w)})}getDataStreamViaEvent(x,w={}){return new E.Observable(j=>{const V=this.subscribe(x).subscribe(ce=>{j.next(ce)},E.noop,()=>j.complete());return this.createOutboundChannel(x).next(w),()=>{V.unsubscribe()}})}static{this.\u0275fac=function(w){return new(w||P)(g.\u0275\u0275inject(y.DOCUMENT),g.\u0275\u0275inject(M,8))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"})}}const v=["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","title","video","xmp"];var L=m(34268),$=m.n(L);const ge="(?=^.{1,250}$)^[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?\\.)+[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?$",u=()=>new RegExp(ge,"g"),b=()=>new RegExp(CONTAINS_EMAIL_PATTERN,"g");function ie(A){return u().test(A)}function We(A){return CONTAINS_EMAIL_REGEXP().test(A)}const it={name:"uponSanitizeElement",func:(A,x)=>{const w=x.tagName;ie(w)&&A.insertAdjacentText("afterbegin",`<${w}>`)}},st={name:"afterSanitizeAttributes",func:(A,x)=>{const w=window?.location?.origin;if(A.nodeName==="A"&&!A.getAttribute("href")?.toLowerCase().startsWith(w)){A.setAttribute("target","_blank");let j=A.getAttribute("rel")||"";["noopener","noreferrer"].forEach(V=>{j.includes(V)||(j+=" "+V)}),A.setAttribute("rel",j.trim())}}},_e=new g.InjectionToken("Represents a DOM purifier",{factory:()=>($().addHook(it.name,it.func),$().addHook(st.name,st.func),$()),providedIn:"platform"});function ct(A){return A?Array.isArray(A)?A:[A]:[]}function $e(A){return A||{}}function ae(){}function at(){return()=>{}}var se=m(26714);class H{static create(x){return new x}}class _{constructor(){this.speechResult=new E.Subject,this.speechEnd=new E.Subject}static _getInternalApiClass(){return window.SpeechRecognition||window.webkitSpeechRecognition}static isSupported(){return _._getInternalApiClass()!==void 0}_subscribeEvents(){this._internalApi.addEventListener("result",this.onResult.bind(this)),this._internalApi.addEventListener("speechend",this.onSpeechEnd.bind(this))}_unsubscribeEvents(){this._internalApi.removeEventListener("result",this.onResult),this._internalApi.removeEventListener("speechend",this.onSpeechEnd)}init(x){const w=_._getInternalApiClass();this._internalApi=H.create(w),this._internalApi.continuous=!0,this._internalApi.lang=x.lang||"en-US",this._subscribeEvents()}onResult(x){const{resultIndex:w,results:j}=x,V=j[w][0];if(!V)throw new Error("No results to transcript");this.speechResult.next(V.transcript)}onSpeechEnd(){this.speechEnd.next()}destroy(){this._unsubscribeEvents(),this._internalApi=null}startRecognition(){this._internalApi.start()}stopRecognition(){this._internalApi.stop()}static{this.\u0275fac=function(w){return new(w||_)}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}var N=m(73436);class k{get messages$(){return this._messages$}constructor(x,w){this._ngZone=w;const j=new E.Subject;this._messages$=j.pipe(this._runInZone(this._ngZone)),this._broadcastChannel=new N.BroadcastChannel(x),this._broadcastChannel.onmessage=V=>j.next(V)}_runInZone(x){return w=>new E.Observable(j=>{w.subscribe(V=>x.run(()=>j.next(V)))})}publish(x){return(0,E.from)(this._broadcastChannel.postMessage(x))}}class G{constructor(x){this._ngZone=x}createInstance(x){return new k(x,this._ngZone)}static{this.\u0275fac=function(w){return new(w||G)(g.\u0275\u0275inject(g.NgZone))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac,providedIn:"root"})}}class ue{static toColdObservable(x){return new Observable(w=>{x().subscribe(V=>{w.next(V),w.complete()})})}}class Le{log(x,w,...j){console.log(x,...j)}warn(x,w,...j){console.warn(x,...j)}error(x,w,...j){console.error(x,...j)}exception(x,w,...j){(console.exception||console.error)(x,...j)}static{this.\u0275fac=function(w){return new(w||Le)}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac})}}const qi={dataAccess:"data-access",feature:"feature",ui:"ui",util:"util",components:"components",deprecated:"deprecated"},Nc={studioFree:"studio-free",studioEnterprise:"studio-enterprise",sdk:"sdk"};var Ki=m(73308);class p{constructor(x,w,j=null){this._injector=x,this._registrationMap=w,this._defaultInstanceType=j}_getInstance(x,w,j){return w?"injectable"in w&&w.injectable!=null?j.get(w.injectable):"useFactory"in w&&typeof w.useFactory=="function"?w.useFactory(x):"useValue"in w?w.useValue:null:null}_getDefaultInstance(x,w){return this._getInstance(x,this._defaultInstanceType,w)}_getInstanceByType(x,w){if(this._registrationMap.has(x)){const j=this._registrationMap.get(x);return this._getInstance(x,j,w)}}_getInstanceByPredicate(x,w){for(const[j,V]of this._registrationMap){if(typeof j!="function")continue;if(j(x,this._injector))return this._getInstance(x,V,w)}}_getInstanceByPredicateAsync(x,w){var j=this;return(0,Ki.A)(function*(){for(const[V,ce]of j._registrationMap){if(typeof V!="function")continue;const Pt=V(x,j._injector);if(Pt instanceof Promise?yield Pt:Pt)return j._getInstance(x,ce,w)}return null})()}create(x=null,w){const j=w??this._injector;return x==null?this._getDefaultInstance(x,j):this._getInstanceByType(x,j)??this._getInstanceByPredicate(x,j)??this._getDefaultInstance(x,j)}createAsync(){var x=this;return(0,Ki.A)(function*(w=null,j){const V=j??x._injector;return w==null?x._getDefaultInstance(w,V):x._getInstanceByType(w,V)??(yield x._getInstanceByPredicateAsync(w,V))??x._getDefaultInstance(w,V)}).apply(this,arguments)}static{this.\u0275fac=function(w){g.\u0275\u0275invalidFactory()}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"})}}var oe=m(28399);class Pn{static _createMappings(x){const w=new Map;return x=x??[],x.forEach(j=>{const V=j.predicate,ce=(0,oe.omit)(j,"predicate");w.set(V,ce)}),w}static create(x){const{mappings:w,default:j,token:V,predicateToken:ce}=x??{};return{provide:V,useFactory:ye=>{const Pt=ce?ye.get(ce,[],{optional:!0}):[],Ja=this._createMappings([...w??[],...Pt??[]]);return new p(ye,Ja,j)},deps:[g.Injector]}}static createForPredicates(x){const{mappings:w,predicateToken:j}=x??{};return!j&&!w?.length?[]:w.map(V=>({provide:j,useValue:V,multi:!0}))}}class Ec{setNext(x){return this.nextHandler=x,x}handle(x){if(this.nextHandler)return this.nextHandler.handle(x)}}function mt(A){return Array.isArray(A)?A:[A]}function Ie(A,x){return x.forEach(({replaceMacros:w,replaceValue:j})=>{A=A.map(V=>V===w?j??"":V)}),A}function c(A,x){if(!A)return"";if(!x)return A;let w=[A];return x=mt(x),w=$a(w,x),w=Ie(w,x),w.join("")}function $a(A,x){if(!A)return[];let w=mt(A);if(!x)return w;const j=mt(x),V=j.map(({replaceMacros:ce})=>ce);return j.forEach(({searchValue:ce,replaceMacros:ye})=>{if(ce&&ye){const Pt=new RegExp(`(${ye})`,"g"),Ja=w.map(li=>V.includes(li)?li:li.split(ce).join(ye).split(Pt));w=(0,oe.flatten)(Ja)}}),w}var Dc=m(4930);function Ga(A){return function(x){Reflect.defineMetadata("requestType",A.requestType,x)}}function $g(A){return x=>{const w=x.pipe(share()),j=w.pipe(tap(A),take(1));return concat(j,w)}}function hp(A){return x=>x.pipe(concatMap((w,j)=>A(w,j).pipe(map(V=>[w,V]))))}function Qa(A){return x=>x.pipe((0,i.mergeMap)((w,j)=>A(w,j).pipe((0,i.map)(V=>[w,V]))))}function Ac(A){return x=>x.pipe((0,i.mergeMap)((w,j)=>A(w,j).pipe((0,i.map)(()=>w))))}function mu(A){return x=>x.pipe((0,i.switchMap)((w,j)=>A(w,j).pipe((0,i.map)(V=>[w,V]))))}function gu(A){return x=>x.pipe((0,i.switchMap)((w,j)=>A(w,j).pipe((0,i.map)(()=>w))))}function hn(A){return x=>A?new E.Observable(w=>{const j=ye=>A.run(()=>w.next(ye)),V=ye=>A.run(()=>w.error(ye)),ce=()=>A.run(()=>w.complete());return x.subscribe({next:j,error:V,complete:ce})}):x}function fu(A){return x=>A?new Observable(w=>{const j=ye=>A.runOutsideAngular(()=>w.next(ye)),V=ye=>A.runOutsideAngular(()=>w.error(ye)),ce=()=>A.runOutsideAngular(()=>w.complete());return x.subscribe({next:j,error:V,complete:ce})}):x}var Xi=m(23710);class Et{static initialize(){Xi.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),Xi.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(x,w="",j="_"){const V=new RegExp(`^${w}`);return w+x.replace(V,"")+j+Xi.generate()}static getUniqueIncrementalName(x,w){if(!w.includes(x))return x;let j;for(let V=1;V<=w.length;V++)if(j=`${x}-${V}`,!w.includes(j))return j;return j}}Et.initialize();const pp=new g.InjectionToken("An abstraction over window.navigator object",{factory:()=>window.navigator,providedIn:"root"});var pn=m(6530);const kn=new g.InjectionToken("CURRENT_TAB_ID_TOKEN"),mn={provide:kn,useValue:(0,pn.qv)()},Z=new g.InjectionToken("Dialog token"),W=new g.InjectionToken("WindowToken",{providedIn:"root",factory:U});function U(){return window}const Ge={provide:W,useFactory:U};class gt{constructor(x){this._window=x,this._hasFocus=!1,this._window.addEventListener("focus",()=>{this._hasFocus=!0}),this._window.addEventListener("blur",()=>{this._hasFocus=!1})}_getIsDocumentVisible(){return document.visibilityState!=="hidden"}get hasFocus(){return this._hasFocus}get isActive(){return this._getIsDocumentVisible()}focus(){this._window.focus()}static{this.\u0275fac=function(w){return new(w||gt)(g.\u0275\u0275inject(W))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:gt,factory:gt.\u0275fac,providedIn:"root"})}}var Dt=m(40409);class ci{constructor(x){this._injector=x}defineComponent(x,w,j=null){const V=(0,Dt.createCustomElement)(w,{injector:j||this._injector});customElements.get(x)||customElements.define(x,V)}static{this.\u0275fac=function(w){return new(w||ci)(g.\u0275\u0275inject(g.Injector))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:ci,factory:ci.\u0275fac,providedIn:"root"})}}function Ut(A,x){return A.creatio.tabId=x,(0,E.of)(void 0)}const mp={provide:g.APP_INITIALIZER,multi:!0,useFactory:(A,x)=>()=>Ut(A,x),deps:[W,kn]},Ct=new g.InjectionToken("LOCAL_STORAGE_SERVICE_CONFIG");class rt{static forRoot(x={}){return{ngModule:rt,providers:[{provide:Ct,useValue:x}]}}static{this.\u0275fac=function(w){return new(w||rt)}}static{this.\u0275mod=g.\u0275\u0275defineNgModule({type:rt})}static{this.\u0275inj=g.\u0275\u0275defineInjector({})}}const es="LOCAL_STORAGE_NOT_SUPPORTED";class At{constructor(x={}){this._isSupported=!1,this._prefix="ls",this._storageType="localStorage";const{prefix:w,storageType:j}=x||{};w!=null&&this._setPrefix(w),j!=null&&this._setStorageType(j),this._isSupported=this._checkSupport()}_deriveKey(x){return`${this._prefix}${x}`}_checkSupport(){try{const x=this._storageType in window&&window[this._storageType]!==null;if(x){this._webStorage=window[this._storageType];const w=this._deriveKey(`__${Math.round(Math.random()*1e7)}`);this._webStorage.setItem(w,""),this._webStorage.removeItem(w)}return x}catch(x){return console.error(x.message),!1}}_setPrefix(x){this._prefix=x;const w=".";this._prefix&&!this._prefix.endsWith(w)&&(this._prefix=this._prefix?`${this._prefix}${w}`:"")}_setStorageType(x){this._storageType=x}get(x){if(!this._isSupported)return console.warn(es),null;const w=this._webStorage?this._webStorage.getItem(this._deriveKey(x)):null;if(!w||w==="null")return null;try{return JSON.parse(w)}catch{return null}}set(x,w){const j=w===void 0?null:JSON.stringify(w);if(!this._isSupported)return console.warn(es),!1;try{this._webStorage&&this._webStorage.setItem(this._deriveKey(x),j)}catch(V){return console.error(V.message),!1}return!0}remove(...x){let w=!0;return x.forEach(j=>{this._isSupported||(console.warn(es),w=!1);try{this._webStorage.removeItem(this._deriveKey(j))}catch(V){console.error(V.message),w=!1}}),w}static{this.\u0275fac=function(w){return new(w||At)(g.\u0275\u0275inject(Ct,8))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac,providedIn:"root"})}}class lt{playFromSource(x){return(0,Ki.A)(function*(w,j=!1){const V=new Audio(w),ce=V.play();if(ce!==void 0)try{yield ce}catch(ye){if(V.muted=!0,j)throw ye}}).apply(this,arguments)}static{this.\u0275fac=function(w){return new(w||lt)}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac,providedIn:"root"})}}var C;(function(A){A.Small="small",A.Medium="medium",A.Large="large",A.XL="xl",A.XXL="xxl"})(C||(C={}));class Ot{constructor(x,w){this._window=x,this._document=w,this._minScreenSize=600,this._mediumScreenSize=790,this._largeScreenSize=1079,this._xlScreenSize=1280,this._screenSizeChanges$=new E.BehaviorSubject(this._currentScreenSizeType),this._changeScreenSizeType()}get currentScreenSizeType(){return this._currentScreenSizeType}get currentScreenSize(){return this._currentScreenSize}get isSmallScreen(){return this._currentScreenSizeType===C.Small}_setScreenSizeTypeAttribute(x){this._document.body.setAttribute("screen-size-type",x)}_getScreenSizeType(){return this._currentScreenSize=this._window.innerWidth,this._currentScreenSize<=this._minScreenSize?C.Small:this._currentScreenSize<=this._mediumScreenSize?C.Medium:this._currentScreenSize<=this._largeScreenSize?C.Large:this._currentScreenSize<=this._xlScreenSize?C.XL:C.XXL}_changeScreenSizeType(){const x=this._getScreenSizeType();return x===this._currentScreenSizeType?!1:(this._currentScreenSizeType=x,this._setScreenSizeTypeAttribute(x),!0)}screenSizeTypeChangeNotifier(){return this._screenSizeChanges$.asObservable()}refreshCurrentScreenSizeType(){this._changeScreenSizeType()&&this._screenSizeChanges$.next(this._currentScreenSizeType)}static{this.\u0275fac=function(w){return new(w||Ot)(g.\u0275\u0275inject(W),g.\u0275\u0275inject(y.DOCUMENT))}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:Ot,factory:Ot.\u0275fac,providedIn:"root"})}}const jn=new g.InjectionToken("DESKTOP_NOTIFICATION_SENDER_PROVIDER");class _u{static get isMobile(){const x=window.navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(x)}}var Mt;(function(A){A[A.StayLoggedIn=0]="StayLoggedIn",A[A.Exit=1]="Exit",A[A.NotSet=2]="NotSet"})(Mt||(Mt={}));var yu=m(27075),Cu=m(79772);class S{constructor(){this._liveAnnouncer=(0,g.inject)(yu.LiveAnnouncer),this._translateService=(0,g.inject)(Cu.TranslateService)}announce(x,w){var j=this;return(0,Ki.A)(function*(V,ce,ye=200){const Pt=j._translateService.instant(V);yield j._liveAnnouncer.announce(Pt,ce,ye)}).apply(this,arguments)}static{this.\u0275fac=function(w){return new(w||S)}}static{this.\u0275prov=g.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac,providedIn:"root"})}}},81398:(D,X,m)=>{m.d(X,{P:()=>i});var y=m(22307),g=m.n(y),E=m(91592);class i extends E.X{constructor(){super(...arguments),this.valueChange=new y.EventEmitter}setRecordValue(R){this.record[this.columnDataSchema.name]=R}setValue(R){this.setRecordValue(R),this.valueChange.emit(R)}static{this.\u0275fac=(()=>{let R;return function(v){return(R||(R=y.\u0275\u0275getInheritedFactory(i)))(v||i)}})()}static{this.\u0275dir=y.\u0275\u0275defineDirective({type:i,outputs:{valueChange:"valueChange"},features:[y.\u0275\u0275InheritDefinitionFeature]})}}},91592:(D,X,m)=>{m.d(X,{X:()=>E});var y=m(22307),g=m.n(y);class E{constructor(){this.getRegisteredEvents=()=>[]}set eventHandlers(M){this._eventHandlers=M,this._validateEventHandlers()}get eventHandlers(){return this._eventHandlers}_stringify(M){const R=[()=>JSON.stringify(M),()=>M.toString()];for(let P=0;P<R.length;P++){const v=R[P];try{return v()}catch{}}return""}_checkEventCanBeHandled(M){const R=this.getRegisteredEvents();if(!R||R.some(L=>L.name===M))return;const P=R.map(L=>L.name).join(", ");let v=`Handler for event "${M}" can not be specified because the event was not registered in table cell class. Registered table column events to subscribe: ${P}.`;throw this.columnDataSchema&&(v+=` Column name: "${this.columnDataSchema.name}".`),new Error(v)}_checkHandlerIsFunction(M,R){if(typeof R!="function")throw new TypeError(`Handler for event with name "${M}" must be a function, but actual is"${this._stringify(R)}".`)}_validateEventHandlers(){if(!this.eventHandlers)return;Object.keys(this.eventHandlers).forEach(R=>{this._checkEventCanBeHandled(R),this._checkHandlerIsFunction(R,this.eventHandlers[R])})}_checkEventDataType(M,R){return M instanceof R||M.constructor===R}_validateFiringEvent(M,R){const P=this._registeredEvents.find(L=>L.name===M);if(!P)throw new Error(`Event with name "${M}" is not registered in the cell class and can not be fired.`);const v=P.dataType;if(R&&(!v||!this._checkEventDataType(R,v)))throw new TypeError(`Type of the data in the event "${M}" must be "${v}", but actual data is "${this._stringify(R)}".`)}_getValidEventHandler(M){const R=this.eventHandlers&&this.eventHandlers[M];if(R)return this._checkHandlerIsFunction(M,R),R}isEmpty(){return!(this.columnDataSchema&&this.record)}fireEvent(M,R){this._validateFiringEvent(M,R);const P=this._getValidEventHandler(M);return P&&P(this.record,R)}ngOnInit(){this._registeredEvents=this.getRegisteredEvents()}getValue(){const M=this.record[this.columnDataSchema.name],R=this.columnDataSchema.formatter;return R?R(M,this.record):M}static{this.\u0275fac=function(R){return new(R||E)}}static{this.\u0275dir=y.\u0275\u0275defineDirective({type:E,inputs:{columnDataSchema:"columnDataSchema",record:"record",eventHandlers:"eventHandlers"}})}}},75956:(D,X,m)=>{m.d(X,{U:()=>at});var y=m(86464),g=m(47149),E=m(71260),i=m(91592),M=m(22307),R=m.n(M),P=m(23092),v=m(67057),L=m.n(v),$=m(92291),T=m.n($),ge=m(77901),u=m.n(ge);const b=se=>({$implicit:se});function ie(se,H){if(se&1&&(M.\u0275\u0275elementContainerStart(0),M.\u0275\u0275elementStart(1,"a",7),M.\u0275\u0275text(2),M.\u0275\u0275elementEnd(),M.\u0275\u0275elementContainerEnd()),se&2){const _=M.\u0275\u0275nextContext().$implicit,N=M.\u0275\u0275nextContext(2).$implicit,k=M.\u0275\u0275nextContext(2);M.\u0275\u0275advance(),M.\u0275\u0275property("routerLink",k.getLinkUrl(_))("target",k.getLinkTarget(_)),M.\u0275\u0275advance(),M.\u0275\u0275textInterpolate(k.formatTextValue(N))}}function We(se,H){if(se&1){const _=M.\u0275\u0275getCurrentView();M.\u0275\u0275elementStart(0,"a",8),M.\u0275\u0275listener("click",function(k){M.\u0275\u0275restoreView(_);const G=M.\u0275\u0275nextContext().$implicit,ue=M.\u0275\u0275nextContext(4);return M.\u0275\u0275resetView(ue.onLinkClick(k,G))}),M.\u0275\u0275text(1),M.\u0275\u0275elementEnd()}if(se&2){const _=M.\u0275\u0275nextContext().$implicit,N=M.\u0275\u0275nextContext(2).$implicit,k=M.\u0275\u0275nextContext(2);M.\u0275\u0275property("href",k.getLinkUrl(_),M.\u0275\u0275sanitizeUrl)("target",k.getLinkTarget(_)),M.\u0275\u0275advance(),M.\u0275\u0275textInterpolate(k.formatTextValue(N))}}function it(se,H){if(se&1&&(M.\u0275\u0275elementContainerStart(0),M.\u0275\u0275template(1,ie,3,3,"ng-container",6)(2,We,2,3,"ng-template",null,2,M.\u0275\u0275templateRefExtractor),M.\u0275\u0275elementContainerEnd()),se&2){const _=H.$implicit,N=M.\u0275\u0275reference(3),k=M.\u0275\u0275nextContext(4);M.\u0275\u0275advance(),M.\u0275\u0275property("ngIf",k.getIsRouterLink(_))("ngIfElse",N)}}function st(se,H){if(se&1&&(M.\u0275\u0275elementStart(0,"span"),M.\u0275\u0275text(1),M.\u0275\u0275elementEnd()),se&2){const _=M.\u0275\u0275nextContext(2).$implicit,N=M.\u0275\u0275nextContext(2);M.\u0275\u0275advance(),M.\u0275\u0275textInterpolate(N.formatTextValue(_))}}function _e(se,H){if(se&1&&(M.\u0275\u0275elementContainerStart(0),M.\u0275\u0275template(1,it,4,2,"ng-container",6)(2,st,2,1,"ng-template",null,1,M.\u0275\u0275templateRefExtractor),M.\u0275\u0275elementContainerEnd()),se&2){const _=M.\u0275\u0275reference(3),N=M.\u0275\u0275nextContext(3);M.\u0275\u0275advance(),M.\u0275\u0275property("ngIf",N.getLink(N.record))("ngIfElse",_)}}function ct(se,H){if(se&1&&M.\u0275\u0275element(0,"mat-checkbox",9),se&2){const _=M.\u0275\u0275nextContext().$implicit;M.\u0275\u0275property("checked",!!_)}}function $e(se,H){if(se&1&&M.\u0275\u0275template(0,_e,4,2,"ng-container",3)(1,ct,1,1,"mat-checkbox",5),se&2){const _=M.\u0275\u0275nextContext(2);M.\u0275\u0275property("ngIf",_.isDisplayedAsText()),M.\u0275\u0275advance(),M.\u0275\u0275property("ngIf",_.isDisplayedAsBoolean())}}function ae(se,H){if(se&1&&(M.\u0275\u0275elementContainerStart(0),M.\u0275\u0275template(1,$e,2,2,"ng-template",4,0,M.\u0275\u0275templateRefExtractor),M.\u0275\u0275elementContainerEnd()),se&2){const _=M.\u0275\u0275reference(2),N=M.\u0275\u0275nextContext();M.\u0275\u0275advance(),M.\u0275\u0275property("ngTemplateOutletContext",M.\u0275\u0275pureFunction1(2,b,N.getValue()))("ngTemplateOutlet",_)}}class at extends i.X{constructor(H,_){super(),this.numberUtils=_,this._textValueTypes=[y.r.Guid].concat(g.P.DateTime).concat(g.P.Number).concat(g.P.Text).concat(g.P.Lookup),this.getRegisteredEvents=()=>[{name:"click"}],this.userCulture=H.cultureInfo.sysCultureName}getLink(H){return this.columnDataSchema.linkGenerator?this.columnDataSchema.linkGenerator(H):""}getLinkUrl(H){return typeof H=="string"?H:H.url}getLinkTarget(H){const _="_self";return typeof H=="string"?_:H.target||_}getIsRouterLink(H){return H?typeof H=="string"?!0:H.useRouterLink||!1:!1}onLinkClick(H,_){_&&typeof _!="string"&&_.preventDefaultClick===!0&&(H.preventDefault(),this.fireEvent("click"))}isDisplayedAsText(){return!this.columnDataSchema.valueType||this._textValueTypes.indexOf(this.columnDataSchema.valueType)!==-1}isDisplayedAsBoolean(){return this.columnDataSchema.valueType===y.r.Boolean}formatTextValue(H){if(H==null)return"";switch(this.columnDataSchema.valueType){case y.r.Date:return H.toLocaleDateString(this.userCulture);case y.r.Time:return H.toLocaleTimeString(this.userCulture);case y.r.DateTime:return H.toLocaleString(this.userCulture);case y.r.Integer:return this.numberUtils.formatNumberValue(H,new E.V_({precision:0}));case y.r.Float:case y.r.Money:return this.numberUtils.formatNumberValue(H);case y.r.FLOAT0:case y.r.MONEY0:return this.numberUtils.formatNumberValue(H,new E.V_({precision:0}));case y.r.FLOAT1:case y.r.MONEY1:return this.numberUtils.formatNumberValue(H,new E.V_({precision:1}));case y.r.FLOAT2:return this.numberUtils.formatNumberValue(H,new E.V_({precision:2}));case y.r.FLOAT3:case y.r.MONEY3:return this.numberUtils.formatNumberValue(H,new E.V_({precision:3}));case y.r.FLOAT4:return this.numberUtils.formatNumberValue(H,new E.V_({precision:4}));case y.r.FLOAT8:return this.numberUtils.formatNumberValue(H,new E.V_({precision:8}));case y.r.IMAGELOOKUP:case y.r.Lookup:{const N=H;return N?.displayValue||N?.value}case y.r.LOCALIZABLE_STRING:{const N=H;return N&&N.getValue(this.userCulture)}default:return H}}static{this.\u0275fac=function(_){return new(_||at)(M.\u0275\u0275directiveInject(P.oq),M.\u0275\u0275directiveInject(E.B4))}}static{this.\u0275cmp=M.\u0275\u0275defineComponent({type:at,selectors:[["ts-table-cell"]],features:[M.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["t",""],["textBlock",""],["hyperlinkBlock",""],[4,"ngIf"],[3,"ngTemplateOutletContext","ngTemplateOutlet"],["disabled","true",3,"checked",4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"routerLink","target"],[3,"click","href","target"],["disabled","true",3,"checked"]],template:function(_,N){_&1&&M.\u0275\u0275template(0,ae,3,4,"ng-container",3),_&2&&M.\u0275\u0275property("ngIf",!N.isEmpty())},dependencies:[v.NgIf,v.NgTemplateOutlet,$.MatCheckbox,ge.RouterLink],encapsulation:2})}}},56911:(D,X,m)=>{m.d(X,{K:()=>y});var y;(function(g){g.None="none",g.Intermediate="intermediate",g.All="all"})(y||(y={}))},14276:(D,X,m)=>{m.d(X,{B:()=>se});var y=m(83173),g=m.n(y),E=m(67057),i=m.n(E),M=m(10821),R=m.n(M),P=m(37851),v=m.n(P),L=m(92291),$=m.n(L),T=m(36037),ge=m.n(T),u=m(4737),b=m.n(u),ie=m(77901),We=m.n(ie),it=m(79772),st=m.n(it),_e=m(6900),ct=m.n(_e),$e=m(75956),ae=m(22307),at=m.n(ae);class se{static{this.\u0275fac=function(N){return new(N||se)}}static{this.\u0275mod=ae.\u0275\u0275defineNgModule({type:se})}static{this.\u0275inj=ae.\u0275\u0275defineInjector({imports:[_e.AngularTreeGridModule,E.CommonModule,y.DragDropModule,M.MatButtonModule,P.MatIconModule,L.MatCheckboxModule,T.MatSortModule,u.MatTableModule,ie.RouterModule,it.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&ae.\u0275\u0275setNgModuleScope(se,{declarations:[$e.U],imports:[_e.AngularTreeGridModule,E.CommonModule,y.DragDropModule,M.MatButtonModule,P.MatIconModule,L.MatCheckboxModule,T.MatSortModule,u.MatTableModule,ie.RouterModule,it.TranslateModule],exports:[$e.U]})})()},93248:(D,X,m)=>{m.d(X,{Fg:()=>g,HO:()=>E,Oi:()=>y,oy:()=>i});const y="user-info-cache",g="currentUserInfo",E="application-info-cache",i="applicationInfo"},61843:(D,X,m)=>{m.d(X,{dJ:()=>g,fX:()=>E});const y="A5420246-0A8E-E111-84A3-00155D054C03",g="en-US";class E{constructor(M){Object.assign(this,M)}static getDefaultCulture(){return new E({sysCultureId:y,sysCultureName:g,decimalSeparator:".",thousandSeparator:","})}}},47149:(D,X,m)=>{m.d(X,{P:()=>i,Q:()=>E});var y=m(86464);const g="DataValueType",E={[y.r.Date]:{type:y.r.Date,id:"603d4960-a1a2-45e9-b232-206a54421b01",name:"Date",icon:"data-type-date-icon.svg",designerIcon:m(26861),translateKey:`${g}.DateCaption`},[y.r.Time]:{type:y.r.Time,id:"04cc757b-8f06-482c-8a1a-0c0e171d2410",name:"Time",icon:"data-type-time-icon.svg",designerIcon:m(8510),translateKey:`${g}.TimeCaption`},[y.r.DateTime]:{type:y.r.DateTime,id:"d21e9ef4-c064-4012-b286-fa1a8171da44",name:"DateTime",icon:"data-type-datetime-icon.svg",designerIcon:m(55146),translateKey:`${g}.DateTimeCaption`},[y.r.Text]:{type:y.r.Text,id:"8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",name:"Text",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:m(97180),designerAutonumberIcon:m(78683),translateKey:`${g}.TextCaption`},[y.r.SHORT_TEXT]:{type:y.r.SHORT_TEXT,id:"325a73b8-0f47-44a0-8412-7606f78003ac",name:"ShortText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:m(97180),designerAutonumberIcon:m(78683),translateKey:`${g}.ShortTextCaption`},[y.r.PHONE_TEXT]:{type:y.r.PHONE_TEXT,id:"26cba63c-daf1-4f36-b2ea-73c0d675d90c",name:"PhoneText",icon:"data-type-phone-icon.svg",designerIcon:m(59155),translateKey:`${g}.PhoneTextCaption`},[y.r.WEB_TEXT]:{type:y.r.WEB_TEXT,id:"26cba64c-daf1-4f36-b2ea-73c0d695d90c",name:"WebText",icon:"data-type-text-icon.svg",designerIcon:m(64337),translateKey:`${g}.WebTextCaption`},[y.r.EMAIL_TEXT]:{type:y.r.EMAIL_TEXT,id:"66cba64c-daf1-4f36-b8ea-73c0d695d90c",name:"EmailText",icon:"data-type-text-icon.svg",designerIcon:m(71011),translateKey:`${g}.EmailTextCaption`},[y.r.MEDIUM_TEXT]:{type:y.r.MEDIUM_TEXT,id:"ddb3a1ee-07e8-4d62-b7a9-d0e618b00fbd",name:"MediumText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:m(97180),designerAutonumberIcon:m(78683),translateKey:`${g}.MediumTextCaption`},[y.r.LONG_TEXT]:{type:y.r.LONG_TEXT,id:"5ca35f10-a101-4c67-a96a-383da6afacfc",name:"LongText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:m(97180),designerAutonumberIcon:m(78683),translateKey:`${g}.LongTextCaption`},[y.r.MAXSIZE_TEXT]:{type:y.r.MAXSIZE_TEXT,id:"c0f04627-4620-4bc0-84e5-9419dc8516b1",name:"MaxSizeText",icon:"data-type-unlimited-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:m(97180),designerAutonumberIcon:m(78683),translateKey:`${g}.MaxSizeTextCaption`},[y.r.Integer]:{type:y.r.Integer,id:"6b6b74e2-820d-490e-a017-2b73d4ccf2b0",name:"Integer",icon:"data-type-integer-icon.svg",designerIcon:m(60521),translateKey:`${g}.IntegerCaption`},[y.r.FLOAT0]:{type:y.r.FLOAT0,id:"60532cfd-8645-4a54-be81-bef507aa2339",name:"Float0",icon:"data-type-float0-icon.svg",designerIcon:m(68877),translateKey:`${g}.FLOAT0Caption`},[y.r.FLOAT1]:{type:y.r.FLOAT1,id:"07ba84ce-0bf7-44b4-9f2c-7b15032eb98c",name:"Float1",icon:"data-type-float1-icon.svg",designerIcon:m(68877),translateKey:`${g}.FLOAT1Caption`},[y.r.FLOAT2]:{type:y.r.FLOAT2,id:"5cc8060d-6d10-4773-89fc-8c12d6f659a6",name:"Float2",icon:"data-type-float2-icon.svg",designerIcon:m(68877),translateKey:`${g}.FLOAT2Caption`},[y.r.FLOAT3]:{type:y.r.FLOAT3,id:"3f62414e-6c25-4182-bcef-a73c9e396f31",name:"Float3",icon:"data-type-float3-icon.svg",designerIcon:m(68877),translateKey:`${g}.FLOAT3Caption`},[y.r.FLOAT4]:{type:y.r.FLOAT4,id:"ff22e049-4d16-46ee-a529-92d8808932dc",name:"Float4",icon:"data-type-float4-icon.svg",designerIcon:m(68877),translateKey:`${g}.FLOAT4Caption`},[y.r.FLOAT8]:{type:y.r.FLOAT8,id:"a4aaf398-3531-4a0d-9d75-a587f5b5b59e",name:"Float8",icon:"data-type-float8-icon.svg",designerIcon:m(68877),translateKey:`${g}.FLOAT8Caption`},[y.r.Guid]:{type:y.r.Guid,id:"23018567-a13c-4320-8687-fd6f9e3699bd",name:"Guid",icon:"data-type-guid-icon.svg",designerIcon:m(92458),translateKey:`${g}.GuidCaption`},[y.r.Lookup]:{type:y.r.Lookup,id:"b295071f-7ea9-4e62-8d1a-919bf3732ff2",name:"Lookup",icon:"data-type-lookup-icon.svg",designerIcon:m(61631),translateKey:`${g}.LookupCaption`},[y.r.Boolean]:{type:y.r.Boolean,id:"90b65bf8-0ffc-4141-8779-2420877af907",name:"Boolean",icon:"data-type-boolean-icon.svg",designerIcon:m(36659),translateKey:`${g}.BooleanCaption`},[y.r.HASH_TEXT]:{type:y.r.HASH_TEXT,id:"ecbcce18-2a17-4ead-829a-9d02fa9578a4",name:"HashText",icon:"data-type-crs-text-icon.svg",designerIcon:m(97180),translateKey:`${g}.HashTextCaption`},[y.r.SECURE_TEXT]:{type:y.r.SECURE_TEXT,id:"3509b9dd-2c90-4540-b82e-8f6ae85d8248",name:"SecureText",icon:"data-type-encrypted-text-icon.svg",designerIcon:m(28010),translateKey:`${g}.SecureTextCaption`},[y.r.IMAGELOOKUP]:{type:y.r.IMAGELOOKUP,id:"b039feb0-ee7c-4884-8aa6-d6d45d84316f",name:"ImageLookup",icon:"data-type-image-link-icon.svg",designerIcon:m(65689),translateKey:`${g}.ImageLookupCaption`},[y.r.Money]:{type:y.r.Money,id:"969093e2-2b4e-463b-883a-3d3b8c61f0cd",name:"Money",icon:"data-type-currency-icon.svg",designerIcon:m(32643),translateKey:`${g}.MoneyCaption`},[y.r.MONEY0]:{type:y.r.MONEY0,id:"6cc9cbe3-a486-4ed3-bea6-5c96f36d77ff",name:"Money0",icon:"data-type-currency-icon.svg",designerIcon:m(32643),translateKey:`${g}.Money0Caption`},[y.r.MONEY1]:{type:y.r.MONEY1,id:"8842ed44-069a-4fae-b1a2-ee17384689eb",name:"Money1",icon:"data-type-currency-icon.svg",designerIcon:m(32643),translateKey:`${g}.Money1Caption`},[y.r.MONEY3]:{type:y.r.MONEY3,id:"85ff33ce-d57d-4197-9e9b-c2dcb1cfc35e",name:"Money3",icon:"data-type-currency-icon.svg",designerIcon:m(32643),translateKey:`${g}.Money3Caption`},[y.r.Float]:{type:y.r.Float,id:"57ee4c31-5ec4-45fa-b95d-3a2868aa89a8",name:"Float",icon:"data-type-float1-icon.svg",designerIcon:m(68877),translateKey:`${g}.FloatCaption`},[y.r.FILE]:{type:y.r.FILE,id:"a33c9252-d401-453e-949d-169157067ed9",name:"File",icon:"data-type-file-icon.svg",designerIcon:m(55039),translateKey:`${g}.FileCaption`},[y.r.Image]:{type:y.r.Image,id:"fa6e6e49-b996-475e-a77e-73904e4c5a88",name:"Image",icon:"data-type-image-icon.svg",designerIcon:m(55039),translateKey:`${g}.ImageCaption`},[y.r.Blob]:{type:y.r.Blob,id:"b7342b7a-5dde-40de-aa7c-24d2a57b3202",name:"Blob",icon:"data-type-blob-icon.svg",designerIcon:m(55039),translateKey:`${g}.BlobCaption`},[y.r.Color]:{type:y.r.Color,id:"dafb71f9-ee9f-4e0b-a4d7-37aa15987155",name:"Color",icon:"data-type-color-icon.svg",designerIcon:m(39078),translateKey:`${g}.ColorCaption`},[y.r.RICH_TEXT]:{type:y.r.RICH_TEXT,id:"79bccffa-8c8b-4863-b376-a69d2244182b",name:"RichText",icon:"data-type-rich-text-icon.svg",designerIcon:m(67021),translateKey:`${g}.RichCaption`},[y.r.ENTITY]:{type:y.r.ENTITY,id:"ebd85d37-0abf-4bbf-bb32-97dc3dffcc8c",name:"Entity",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.Entity`},[y.r.ENTITY_COLLECTION]:{type:y.r.ENTITY_COLLECTION,id:"51fb23ba-3eb2-11e2-b7d5-b0c76188709b",name:"EntityCollection",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.EntityCollection`},[y.r.ENTITY_COLUMN_MAPPING_COLLECTION]:{type:y.r.ENTITY_COLUMN_MAPPING_COLLECTION,id:"b53eaa2a-4bb7-4a6b-9f4f-58ccab293e31",name:"EntityColumnMappingCollection",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.EntityColumnMappingCollection`},[y.r.CUSTOM_OBJECT]:{type:y.r.CUSTOM_OBJECT,id:"84ed6865-9692-4c98-aaed-4d15b96a95c2",name:"CustomObject",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.CustomObject`},[y.r.OBJECT_LIST]:{type:y.r.OBJECT_LIST,id:"4b51a8b5-1ee9-4437-9d58-f35e083cbcdf",name:"ObjectList",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.ObjectList`},[y.r.COMPOSITE_OBJECT_LIST]:{type:y.r.COMPOSITE_OBJECT_LIST,id:"651ec16f-d140-46db-b9e2-825c985a8ac2",name:"CompositeObjectList",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.CompositeObjectList`},[y.r.COMPOSITE_OBJECT]:{type:y.r.COMPOSITE_OBJECT,id:"632e4371-0a7f-46cd-a284-a623b3933027",name:"CompositeObject",icon:"data-type-composite-object-icon.svg",designerIcon:m(97180),translateKey:`${g}.CompositeObject`},[y.r.COLLECTION]:{type:y.r.COLLECTION,name:"Collection",icon:"data-type-other-icon.svg",designerIcon:m(97180),translateKey:`${g}.Collection`},[y.r.LOCALIZABLE_STRING]:{type:y.r.LOCALIZABLE_STRING,id:"95c6e6c4-2cc8-46be-a1cb-96f942655f86",name:"LocalizableString",icon:"data-type-text-icon.svg",designerIcon:m(97180),translateKey:`${g}.LocalizableString`},[y.r.METADATA_TEXT]:{type:y.r.METADATA_TEXT,id:"394e160f-c8e0-46fa-9c0d-75d97e9e9169",name:"MetaDataText",icon:"data-type-text-icon.svg",designerIcon:m(97180),translateKey:`${g}.MetaDataText`}},i={DateTime:[y.r.Date,y.r.Time,y.r.DateTime],Text:[y.r.Text,y.r.SHORT_TEXT,y.r.MEDIUM_TEXT,y.r.LONG_TEXT,y.r.PHONE_TEXT,y.r.WEB_TEXT,y.r.EMAIL_TEXT,y.r.MAXSIZE_TEXT,y.r.LOCALIZABLE_STRING,y.r.RICH_TEXT],Number:[y.r.FLOAT0,y.r.FLOAT1,y.r.FLOAT2,y.r.FLOAT3,y.r.FLOAT4,y.r.FLOAT8,y.r.Integer,y.r.MONEY0,y.r.MONEY1,y.r.Money,y.r.MONEY3,y.r.Float],Lookup:[y.r.Lookup,y.r.IMAGELOOKUP]}},74975:(D,X,m)=>{m.d(X,{S:()=>E});var y=m(22307),g=m.n(y);class E{constructor(){const M=this.constructor;if((0,y.inject)(M,y.InjectFlags.Optional|y.InjectFlags.SkipSelf))throw Error(`[${M.name}]: trying to create multiple instances,
			but this service should be a singleton.`)}}},90964:(D,X,m)=>{m.d(X,{g:()=>R});var y=m(73308),g=m(62278),E=m(36486),i=m(22307);const M=new i.InjectionToken("USE_MEASURE_PERFORMANCE_TOOLS",{providedIn:"root",factory:()=>!!window.__useMeasurePerformanceTools});class R{constructor(v){this._useMeasurePerformanceTools=v,this._consequentMeasureStartTimeCorrection=.001,this._lastNowStartTime=0,this.rendering$=new g.BehaviorSubject(null)}_getNowStartTimeWithCorrection(){const v=performance.now(),L=v<=this._lastNowStartTime?this._lastNowStartTime+this._consequentMeasureStartTimeCorrection:v;return this._lastNowStartTime=L,L}measure(v,L,$){if(!this._useMeasurePerformanceTools)return L();const T=$||this._getNowStartTimeWithCorrection(),ge=L();return performance.measure(v,{start:T}),ge}measureCallback(v,L){var $=this;return(0,y.A)(function*(){if(!$._useMeasurePerformanceTools)return L();const T=$._getNowStartTimeWithCorrection(),ge=yield L();return performance.measure(v,{start:T}),ge})()}measure$(v){if(!this._useMeasurePerformanceTools)return $=>$;let L;return $=>(0,g.of)(null).pipe((0,E.tap)(()=>L=this._getNowStartTimeWithCorrection()),(0,g.switchMap)(()=>$),(0,E.tap)(()=>{const T=typeof v=="string"?v:v();performance.measure(T,{start:L})}))}static{this.\u0275fac=function(L){return new(L||R)(i.\u0275\u0275inject(M,8))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"})}}},23092:(D,X,m)=>{m.d(X,{fv:()=>st,oq:()=>ge,vn:()=>it});var y=m(5757),g=m.n(y),E=m(22307),i=m.n(E),M=m(62278),R=m.n(M),P=m(93248),v=m(61843),L=m(74975),$=m(89720),T=m(90964);class ge{constructor(){this.cultureInfo=new v.fX,this.defCultureInfo=new v.fX}}const u="Information about the current user is not initialized yet. Use UserInfoService to load current user information.";function b(){return{get id(){throw new ReferenceError(u)},get contactId(){throw new ReferenceError(u)},get contactName(){throw new ReferenceError(u)},get accountId(){throw new ReferenceError(u)},get accountName(){throw new ReferenceError(u)},get isSSP(){throw new ReferenceError(u)},get timeZoneId(){throw new ReferenceError(u)},get cultureInfo(){throw new ReferenceError(u)},get defCultureInfo(){throw new ReferenceError(u)},get timeZoneOffsetHours(){throw new ReferenceError(u)},get photoId(){throw new ReferenceError(u)},get accessType(){throw new ReferenceError(u)},get sessionId(){throw new ReferenceError(u)}}}const ie=b(),We={get id(){return ie.id},get contactId(){return ie.contactId},get contactName(){return ie.contactName},get accountId(){return ie.accountId},get accountName(){return ie.accountName},get isSSP(){return ie.isSSP},get timeZoneId(){return ie.timeZoneId},get cultureInfo(){return ie.cultureInfo},get defCultureInfo(){return ie.defCultureInfo},get timeZoneOffsetHours(){return ie.timeZoneOffsetHours},get photoId(){return ie.photoId},get accessType(){return ie.accessType},get sessionId(){return ie.sessionId}};Object.freeze(We);const it={provide:ge,useFactory:()=>We};class st extends L.S{constructor(ct,$e,ae){super(),this._httpClient=ct,this._cacheManager=$e,this._measurePerformanceService=ae,this._serviceEndpoint="/ServiceModel/UserInfoService.svc"}_applyUserInfo(ct){Object.keys(ie).forEach($e=>{delete ie[$e]}),Object.assign(ie,ct)}loadCurrentUserInfo(){if(!this._userInfo$){const ct=`${this._serviceEndpoint}/GetCurrentUserInfo`;this._userInfo$=this._cacheManager.executeWithCache(P.Oi,P.Fg,this._httpClient.post(ct,null)).pipe(this._measurePerformanceService.measure$("UserInfoService: load current user info with cache"),(0,M.tap)($e=>this._applyUserInfo($e?.userInfo)),(0,M.shareReplay)({bufferSize:1,refCount:!1}))}return this._userInfo$}static{this.\u0275fac=function($e){return new($e||st)(E.\u0275\u0275inject(y.HttpClient),E.\u0275\u0275inject($.G),E.\u0275\u0275inject(T.g))}}static{this.\u0275prov=E.\u0275\u0275defineInjectable({token:st,factory:st.\u0275fac,providedIn:"root"})}}},89720:(D,X,m)=>{m.d(X,{G:()=>se});var y=m(22307),g=m(73308),E=m(5757),i=m(84065),M=m(62278),R=m(36486),P=m(30293),v=m(40234);const L={name:"crt-shell-db",version:15,objectStoresMeta:Object.values(P.w).map(H=>({store:H,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]})),isDefault:!0};class ${constructor(_){this.dbService=_,this._shouldRemoveDataBaseErrorNames=["VersionError","InvalidStateError","UnknownError"],this._dbReady=!0,this.dbService||(this._dbReady=!1,console.info("For using persistent cache, you need to register NgxIndexedDBService."))}_getErrorMessage(_){return _ instanceof Error?`Name: ${_.name}, Message: ${_.message}`:_ instanceof Event&&_.target&&"error"in _.target?`${_.target.error?.message}`:typeof _=="string"?_:JSON.stringify(_)}_handleError(_){const N=typeof _=="string"||_ instanceof Error&&this._shouldRemoveDataBaseErrorNames.includes(_.name);return this._dbReady&&N?(indexedDB.deleteDatabase(L.name),console.warn(`IndexedDB has been refreshed. ${this._getErrorMessage(_)}`),this._dbReady=!1,(0,M.of)(void 0)):(console.warn(`IndexedDB request error. ${this._getErrorMessage(_)}`),(0,M.of)(void 0))}_executeIndexedDBOperation(_,N){return this._dbReady?_():(0,M.of)(N)}get dbReady(){return this._dbReady}add(_,N){return this._executeIndexedDBOperation(()=>this.dbService.add(_,N),void 0).pipe((0,M.catchError)(k=>this._handleError(k)))}bulkAdd(_,N){return this._executeIndexedDBOperation(()=>this.dbService.bulkAdd(_,N),[]).pipe((0,M.catchError)(k=>this._handleError(k)))}getByKey(_,N){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(_,"key",N),null).pipe((0,M.catchError)(k=>this._handleError(k)))}getByKeys(_,N){if(N.length===0)return(0,M.of)([]);const k=N.map(G=>this._executeIndexedDBOperation(()=>this.getByKey(_,G),null));return(0,M.forkJoin)(k).pipe((0,M.map)(G=>G.filter(Boolean)),(0,M.catchError)(G=>this._handleError(G)))}clear(_){return this._executeIndexedDBOperation(()=>this.dbService.clear(_),!1).pipe((0,M.catchError)(N=>this._handleError(N)))}update(_,N){return this._executeIndexedDBOperation(()=>this.dbService.update(_,N),void 0).pipe((0,M.catchError)(k=>this._handleError(k)))}bulkUpdate(_,N){return this._executeIndexedDBOperation(()=>this.dbService.bulkPut(_,N),[]).pipe((0,M.catchError)(k=>this._handleError(k)))}delete(_,N){return this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(_,N),!0).pipe((0,M.catchError)(k=>this._handleError(k)))}deleteByIndex(_,N){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(_,"key",N),null).pipe((0,M.switchMap)(k=>k?this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(_,k.id),!1):(0,M.of)(!0)),(0,M.catchError)(k=>this._handleError(k)))}getAll(_){return this._executeIndexedDBOperation(()=>this.dbService.getAll(_),null).pipe((0,M.catchError)(N=>this._handleError(N)))}static{this.\u0275fac=function(N){return new(N||$)(y.\u0275\u0275inject(v.NgxIndexedDBService,8))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"})}}function T(H){const _=document.cookie.match(new RegExp("(^| )"+H+"=([^;]+)"));return _?_[2]:null}function ge(){return T("UserType")==="SSP"?"ssp/":""}class u{constructor(_,N,k){this._indexedDBService=_,this.memoryCache=k,this._tableName=N.tableName,this._keyPrefix=N.keyPrefix}_getPrefixedKey(_){return this._keyPrefix?`${this._keyPrefix}_${_}`:_}_getIndexedDBRecord(_){return(0,M.firstValueFrom)(this._indexedDBService.getByKey(this._tableName,_))}_getIndexedDBRecords(_){return(0,M.firstValueFrom)(this._indexedDBService.getByKeys(this._tableName,_))}has(_){var N=this;return(0,g.A)(function*(){if(yield N.memoryCache?.has(N._getPrefixedKey(_)))return!0;const k=yield N._getIndexedDBRecord(N._getPrefixedKey(_));return yield N.memoryCache?.set(N._getPrefixedKey(_),k?.data),!!k?.data})()}get(_){var N=this;return(0,g.A)(function*(){if(yield N.memoryCache?.has(N._getPrefixedKey(_)))return N.memoryCache.get(N._getPrefixedKey(_));const k=yield N._getIndexedDBRecord(N._getPrefixedKey(_));return yield N.memoryCache?.set(N._getPrefixedKey(_),k?.data),k?.data??null})()}getAll(){var _=this;return(0,g.A)(function*(){const N=yield _.memoryCache?.getAll();return N?.length>0?N:yield(0,M.firstValueFrom)(_._indexedDBService.getAll(_._tableName).pipe((0,M.map)(k=>k.map(G=>({key:G.key,value:G.data}))),(0,M.tap)(k=>_.memoryCache?.bulkSet(k))))})()}set(_,N){var k=this;return(0,g.A)(function*(){const G=yield k._getIndexedDBRecord(k._getPrefixedKey(_));G?yield(0,M.firstValueFrom)(k._indexedDBService.update(k._tableName,{id:G.id,key:k._getPrefixedKey(_),data:N})):yield(0,M.firstValueFrom)(k._indexedDBService.add(k._tableName,{key:k._getPrefixedKey(_),data:N})),yield k.memoryCache?.set(k._getPrefixedKey(_),N)})()}bulkSet(_){var N=this;return(0,g.A)(function*(){if(!_||_.length===0)return;const k=(yield N._getIndexedDBRecords(_.map(ue=>N._getPrefixedKey(ue.key))))||[],G=_.map(ue=>{const Le=k.filter(Boolean).find(Nc=>Nc.key===N._getPrefixedKey(ue.key)),qi={key:N._getPrefixedKey(ue.key),data:ue.value};return Le?.id?{...qi,id:Le.id}:qi});yield(0,M.firstValueFrom)(N._indexedDBService.bulkUpdate(N._tableName,G)),yield N.memoryCache?.bulkSet(_)})()}delete(_){var N=this;return(0,g.A)(function*(){yield(0,M.firstValueFrom)(N._indexedDBService.deleteByIndex(N._tableName,N._getPrefixedKey(_))),yield N.memoryCache?.delete(N._getPrefixedKey(_))})()}clear(){var _=this;return(0,g.A)(function*(){yield(0,M.firstValueFrom)(_._indexedDBService.clear(_._tableName)),yield _.memoryCache?.clear()})()}}class b{constructor(){this._cache=new Map}has(_){return Promise.resolve(this._cache.has(_))}get(_){return Promise.resolve(this._cache.get(_))}getAll(){return Promise.resolve([...this._cache].map(([_,N])=>({key:_,value:N})))}set(_,N){return this._cache.set(_,N),Promise.resolve()}bulkSet(_){return _.forEach(N=>{this._cache.set(N.key,N.value)}),Promise.resolve()}delete(_){return this._cache.delete(_),Promise.resolve()}clear(){return this._cache.clear(),Promise.resolve()}}var ie=m(41483);class We{constructor(_){this._indexedDBService=_}create(_){switch(_.type){case ie.P.Memory:return new b;case ie.P.Persistent:return new u(this._indexedDBService,_.options);case ie.P.PersistentAndMemory:return new u(this._indexedDBService,_.options,new b);default:throw new Error(`Unsupported cache type: ${_.type}`)}}static{this.\u0275fac=function(N){return new(N||We)(y.\u0275\u0275inject($))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:We,factory:We.\u0275fac,providedIn:"root"})}}const it="ClientCacheVersion";class st{constructor(_,N,k,G){this._injector=_,this._systemCaches=N,this._useSystemClientCache=k,this._usePersistentCache=G,this._caches=new Map}_getPersistentCacheRegistryItems(){var _=this;return(0,g.A)(function*(){return(yield(0,M.firstValueFrom)(_._indexedDBService.getAll(P.w.CacheRegistry)))?.map(k=>k.data)??[]})()}_initializePersistentCacheRegistry(){var _=this;return(0,g.A)(function*(){if(!_._usePersistentCache){_._persistentCacheRegistry=new Map;return}const k=(yield _._getPersistentCacheRegistryItems()).map(G=>[G.name,G]);_._persistentCacheRegistry=new Map(k)})()}_initializeRegisteredCaches(){this._persistentCacheRegistry.forEach(_=>{const N=this._cacheFactory.create({name:_.name,type:_.useMemoryCache?ie.P.PersistentAndMemory:ie.P.Persistent,options:{tableName:_.tableName}});this._caches.set(_.name,N)})}_registerPersistentCache(_){var N=this;return(0,g.A)(function*(){if(!N._usePersistentCache)return;const k={name:_.name,tableName:_.options.tableName,useMemoryCache:_.type===ie.P.PersistentAndMemory,hash:""};yield(0,M.firstValueFrom)(N._indexedDBService.add(P.w.CacheRegistry,{key:_.name,data:k})),N._persistentCacheRegistry.set(_.name,k)})()}_updatePersistentCacheHash(_,N){var k=this;return(0,g.A)(function*(){const G=k._persistentCacheRegistry.get(_);G.hash=N,k._persistentCacheRegistry.set(_,G);const ue=yield(0,M.firstValueFrom)(k._indexedDBService.getByKey(P.w.CacheRegistry,_));ue?.data&&(ue.data.hash=N,yield(0,M.firstValueFrom)(k._indexedDBService.update(P.w.CacheRegistry,{id:ue.id,key:_,data:G})))})()}_isPersistentCache(_){return _===ie.P.Persistent||_===ie.P.PersistentAndMemory}_initializeSystemCaches(){var _=this;return(0,g.A)(function*(){const N=_._systemCaches||[];if(N.length===0)return;const k=N.filter(G=>!_._caches.has(G.name));yield Promise.all(k.map(G=>_._create(G)))})()}_create(_){var N=this;return(0,g.A)(function*(){if(N._caches.has(_.name))throw new Error(`Cache instance with name "${_.name}" already exists.`);const k=N._cacheFactory.create({..._,type:N._usePersistentCache?_.type:ie.P.Memory});return N._caches.set(_.name,k),N._isPersistentCache(_.type)&&(yield N._registerPersistentCache(_)),k})()}_internalInitialize(){var _=this;return(0,g.A)(function*(){_._indexedDBService=_._injector.get($),_._cacheFactory=_._injector.get(We),_._httpClient=_._injector.get(E.HttpClient),_._caches.clear(),yield _._initializePersistentCacheRegistry(),_._initializeRegisteredCaches(),yield _._initializeSystemCaches(),yield _._validateSystemCaches()})()}_validateSystemCaches(){var _=this;return(0,g.A)(function*(){if(!_._caches.size||!_._indexedDBService.dbReady||!_._usePersistentCache)return;const N=ge(),{hashes:k=[],cacheVersion:G=0}=yield(0,M.lastValueFrom)(_._httpClient.get(`${N}api/ClientCache/Hashes`).pipe((0,R.catchError)(()=>(console.warn("Failed to get system hashes"),(0,M.of)({hashes:[],cacheVersion:0})))));if(_._getIsNeedForceClearCache(G)){yield _._innerClearAll();return}yield Promise.all(k.map(({name:Le,value:qi})=>_._internalValidateCache(Le,qi)))})()}_getIsNeedForceClearCache(_){const N=this._injector.get(i.sj),k=N.get(it),G=_&&_!==k;return G&&N.set(it,_),G}_internalValidateCache(_,N){var k=this;return(0,g.A)(function*(){if(!k._persistentCacheRegistry.has(_)||!k._usePersistentCache)return;if(k._persistentCacheRegistry.get(_).hash!==N){const ue=k._caches.get(_);ue&&(yield ue.clear(),yield k._updatePersistentCacheHash(_,N))}})()}_innerClearAll(){var _=this;return(0,g.A)(function*(){yield Promise.all([..._._caches.values()].map(N=>N.clear()))})()}whenInitialized(){return this._initialized??=this._internalInitialize(),this._initialized}get(_){var N=this;return(0,g.A)(function*(){yield N.whenInitialized();const k=N._caches.get(_);if(!k)throw new Error(`Cache instance with name "${_}" does not exist.`);return k})()}getOrCreate(_){var N=this;return(0,g.A)(function*(){if(yield N.whenInitialized(),!N._caches.has(_.name)){if(!_.type)throw new Error(`Cache type must be specified for cache "${_.name}".`);yield N._create({..._,type:_.type})}return N._caches.get(_.name)})()}clearAll(){var _=this;return(0,g.A)(function*(){yield _.whenInitialized(),yield _._innerClearAll()})()}validateCache(_,N){var k=this;return(0,g.A)(function*(){yield k.whenInitialized(),yield k._internalValidateCache(_,N)})()}executeWithCache(_,N,k){return this._useSystemClientCache?(0,M.from)(this.whenInitialized()).pipe((0,M.map)(()=>this._caches.get(_)),(0,M.switchMap)(function(){var G=(0,g.A)(function*(ue){return{cacheValue:yield ue?.get(N),cacheInstance:ue}});return function(ue){return G.apply(this,arguments)}}()),(0,M.switchMap)(({cacheValue:G,cacheInstance:ue})=>G!=null?(0,M.of)(G):k.pipe((0,M.tap)(Le=>ue?.set(N,Le))))):k}executeWithBulkCache(_,N){return this._useSystemClientCache?(0,M.from)(this.whenInitialized()).pipe((0,M.map)(()=>this._caches.get(_)),(0,M.switchMap)(function(){var k=(0,g.A)(function*(G){return{cachedItems:yield G?.getAll(),cacheInstance:G}});return function(G){return k.apply(this,arguments)}}()),(0,M.switchMap)(({cachedItems:k,cacheInstance:G})=>k?.length?(0,M.of)(k):N.pipe((0,M.switchMap)(function(){var ue=(0,g.A)(function*(Le){return yield G?.bulkSet(Le),Le});return function(Le){return ue.apply(this,arguments)}}())))):N}}var _e;(function(H){H.Share="Share",H.Own="Own",H.TryConnectToShared="TryConnectToShared"})(_e||(_e={}));var ct=m(72051),$e=m(13875);const ae=new y.InjectionToken("CACHE_MODE"),at=window;class se{get _cacheManager(){switch(this._cacheMode){case _e.Share:return at.cacheManager;case _e.Own:return this._innerCacheManager;case _e.TryConnectToShared:return at.cacheManager??this._innerCacheManager;default:throw new Error("Unknown cache mode")}}set _cacheManager(_){switch(this._cacheMode){case _e.Share:at.cacheManager=_;break;case _e.Own:case _e.TryConnectToShared:this._innerCacheManager=_;break;default:throw new Error("Unknown cache mode")}}constructor(_,N,k,G){this._innerCacheManager=null,this._cacheMode=G||_e.TryConnectToShared;const ue=this._cacheMode!==_e.TryConnectToShared;this._cacheManager||(this._cacheManager=new st(_,N??[],k===!0,ue))}whenInitialized(){return this._cacheManager.whenInitialized()}get(_){return this._cacheManager.get(_)}getOrCreate(_){return this._cacheManager.getOrCreate(_)}clearAll(){return this._cacheManager.clearAll()}validateCache(_,N){return this._cacheManager.validateCache(_,N)}executeWithCache(_,N,k){return this._cacheManager.executeWithCache(_,N,k)}executeWithBulkCache(_,N){return this._cacheManager.executeWithBulkCache(_,N)}static{this.\u0275fac=function(N){return new(N||se)(y.\u0275\u0275inject(y.Injector),y.\u0275\u0275inject(ct.P,8),y.\u0275\u0275inject($e.X,8),y.\u0275\u0275inject(ae,8))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac,providedIn:"root"})}}},41483:(D,X,m)=>{m.d(X,{P:()=>y});var y;(function(g){g.Memory="Memory",g.Persistent="Persistent",g.PersistentAndMemory="PersistentAndMemory"})(y||(y={}))},72051:(D,X,m)=>{m.d(X,{P:()=>E});var y=m(22307),g=m.n(y);const E=new y.InjectionToken("SYSTEM_CACHE")},13875:(D,X,m)=>{m.d(X,{X:()=>E});var y=m(22307),g=m.n(y);const E=new y.InjectionToken("USE_SYSTEM_CLIENT_CACHE",{providedIn:"root",factory:()=>!!window.__useSystemClientCache})},30293:(D,X,m)=>{m.d(X,{w:()=>y});var y;(function(g){g.CacheRegistry="cache-registry",g.Images="images",g.BusinessRules="business-rules",g.RuntimeEntitySchema="runtime-entity-schema",g.RuntimeFreedomUISchemas="runtime-freedom-ui-schemas",g.UserInfo="user-info",g.SystemSettingsCache="system-settings",g.ApplicationInfo="application-info",g.Features="features",g.Rights="rights",g.Auth="auth",g.Acl="acl",g.UserLevelSchema="user-level-schema",g.ConfigurationData="configuration-data"})(y||(y={}))},71260:(D,X,m)=>{m.d(X,{B4:()=>R,V_:()=>i});var y=m(22307),g=m.n(y),E=m(23092);class i{constructor(v){this.precision=2,Object.assign(this,v)}}class M{constructor(v={}){this.decimalSeparator=v.decimalSeparator||"",this.thousandSeparator=v.thousandSeparator||""}}class R{constructor(v){this._userInfo=v,this._digitsInRank=3}_collapseRepeatedChar(v,L){return v.replace(new RegExp(`[\\${L}]{1,}`,"g"),L)}_insertThousandSeparators(v,L){const $=v.split("");for(let T=$.length-this._digitsInRank;T>0;T-=this._digitsInRank)$.splice(T,0,L);return $.join("")}formatNumberValue(v,L=null){if(v=parseFloat(v&&v.toString()),!v||isNaN(v))return"0";let $="";v<0&&($="-"),L=L||new i;const T=this.getNumberFormatInfo(),{decimalSeparator:ge,thousandSeparator:u}=T,b=v.toFixed(L.precision).split(".");let ie=b[0].replace("-","");L.ignoreThousandSeparator||(ie=this._insertThousandSeparators(ie,u));const We=b.length>1?b[1].replace(/0{1,}$/,""):"";return We!==""?`${$}${ie}${ge}${We}`:`${$}${ie}`}removeFractionalPart(v){const L=".",[$]=v.toString().split(L);return $}getNumberFormatInfo(){const v=this._userInfo.cultureInfo;return new M({decimalSeparator:v.decimalSeparator,thousandSeparator:v.thousandSeparator})}parseStringToNumber(v,L=2){if(!v)return NaN;typeof v!="string"&&(v=String(v));const $=this.getNumberFormatInfo().decimalSeparator;let T=this.formatStringValue(v);T=T.replace($,".");const ge=parseFloat(T);return Number(ge.toFixed(L))}formatStringValue(v){typeof v!="string"&&(v=String(v));const L=v.match(/^-/)||"",$=this.getNumberFormatInfo().decimalSeparator,T=this._collapseRepeatedChar(v,$),ge=new RegExp(`[^0-9\\${$}]+`,"g");return L+T.replace(ge,"")}convertNumericStringToExponentialFormat(v,L=2){if(v&&v!==""){const $=parseFloat(v);if(!isNaN($))return $.toExponential(L)}return""}static{this.\u0275fac=function(L){return new(L||R)(y.\u0275\u0275inject(E.oq))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"})}}},26242:D=>{D.exports=`<svg id="Group_7" data-name="Group 7" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
	<rect id="Rectangle_7" data-name="Rectangle 7" width="24" height="24" fill="none"/>
	<line id="Line_5" data-name="Line 5" y1="10" x2="10" transform="translate(7 7)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
	<line id="Line_6" data-name="Line 6" x2="10" y2="10" transform="translate(7 7)" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="1"/>
</svg>
`},92825:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M13.1592 7.99998C13.1592 5.15064 10.8494 2.84079 8.00004 2.84079C5.1507 2.84079 2.84085 5.15064 2.84085 7.99998C2.84085 10.8493 5.1507 13.1592 8.00004 13.1592C10.8494 13.1592 13.1592 10.8493 13.1592 7.99998ZM8.00004 1.50079C11.5894 1.50079 14.4992 4.41058 14.4992 7.99998C14.4992 11.5894 11.5894 14.4992 8.00004 14.4992C4.41064 14.4992 1.50085 11.5894 1.50085 7.99998C1.50085 4.41058 4.41064 1.50079 8.00004 1.50079ZM7.16167 5.39671C7.16167 4.93555 7.53551 4.56171 7.99667 4.56171H8.00333C8.46449 4.56171 8.83833 4.93555 8.83833 5.39671C8.83833 5.85786 8.46449 6.23171 8.00333 6.23171H7.99667C7.53551 6.23171 7.16167 5.85786 7.16167 5.39671ZM7.99979 6.95437C8.46095 6.95477 8.83447 7.32893 8.83407 7.79009L8.83163 10.6063C8.83123 11.0674 8.45706 11.4409 7.9959 11.4405C7.53475 11.4401 7.16123 11.066 7.16163 10.6048L7.16407 7.78864C7.16447 7.32749 7.53864 6.95397 7.99979 6.95437Z" fill="currentColor"/>
</svg>
`},89920:D=>{D.exports=`<svg id="Group_7" data-name="Group 7" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
  <rect id="Rectangle_7" data-name="Rectangle 7" width="16" height="16" fill="none"/>
  <line id="Line_5" data-name="Line 5" y1="10" x2="10" transform="translate(3 3)" fill="none" stroke="#999" stroke-miterlimit="10" stroke-width="1"/>
  <line id="Line_6" data-name="Line 6" x2="10" y2="10" transform="translate(3 3)" fill="none" stroke="#999" stroke-miterlimit="10" stroke-width="1"/>
</svg>
`},81412:D=>{D.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" enable-background="new 0 0 16 16"><g fill="none" stroke="#8095b3" stroke-width="1.2" stroke-miterlimit="10"><circle cx="6" cy="6" r="4.5"/><path stroke-linecap="round" d="M 9.4,9.4 14,14"/></g></svg>'},8035:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3 1V15H13V5H8.99999V1H3ZM2 0H9.99999V4H14V16H2V0Z" fill="#006CE0"/>
<path d="M10 0L14 4H10V0Z" fill="#006CE0"/>
</svg>
`},25689:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.0667 3.80034V12.2003H9.40001V3.80034H14.0667ZM15 2.867H8.46667V13.1337H15V2.867Z" fill="#207245"/>
<path d="M13.1334 4.73367H11.2667V5.66701H13.1334V4.73367Z" fill="#207245"/>
<path d="M10.3334 4.73367H9.40002V5.66701H10.3334V4.73367Z" fill="#207245"/>
<path d="M13.1334 6.60034H11.2667V7.53368H13.1334V6.60034Z" fill="#207245"/>
<path d="M10.3334 6.60034H9.40002V7.53368H10.3334V6.60034Z" fill="#207245"/>
<path d="M13.1334 8.46701H11.2667V9.40034H13.1334V8.46701Z" fill="#207245"/>
<path d="M10.3334 8.46701H9.40002V9.40034H10.3334V8.46701Z" fill="#207245"/>
<path d="M13.1334 10.3337H11.2667V11.267H13.1334V10.3337Z" fill="#207245"/>
<path d="M10.3334 10.3337H9.40002V11.267H10.3334V10.3337Z" fill="#207245"/>
<path d="M8.46667 2.14835V13.8524L1.93333 12.4897V3.511L8.46667 2.14835ZM9.4 1.00034L1 2.75501V13.255L9.4 15.0097V1.00968V1.00034Z" fill="#207245"/>
<path d="M3.80005 5.66699L6.60005 10.8003" stroke="#207245" stroke-miterlimit="10"/>
<path d="M3.80005 10.3337L6.60005 5.20035" stroke="#207245" stroke-miterlimit="10"/>
</svg>
`},21431:D=>{D.exports=`<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M15.5458 3H1.54578V13H15.5458V3Z" stroke="#FF8800" stroke-miterlimit="10"/>
<path d="M11.0458 8C11.8742 8 12.5458 7.32843 12.5458 6.5C12.5458 5.67157 11.8742 5 11.0458 5C10.2173 5 9.54578 5.67157 9.54578 6.5C9.54578 7.32843 10.2173 8 11.0458 8Z" fill="#FF8800"/>
<path d="M1.54578 13V11.6514L5.09954 6.32074L10.9439 13H1.54578Z" stroke="#FF8800"/>
<path d="M15.5458 13H13.8134L11.776 9.94392L13.447 9.10838L15.5458 11.2071V13Z" stroke="#FF8800"/>
</svg>
`},94570:D=>{D.exports=`<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3 8V2H10.3L14 5.42461V14H6.5" stroke="#F40000" stroke-miterlimit="10"/>
<path d="M10.4702 2H9.47021V6H13.4702V5H10.4702V2Z" fill="#F40000"/>
<path d="M12.4598 11.07C12.4498 10.98 12.3799 10.86 12.2999 10.78C12.0799 10.56 11.5899 10.44 10.8499 10.43C10.3499 10.43 9.73986 10.47 9.10986 10.56C8.82986 10.39 8.52986 10.21 8.29986 9.98996C7.67986 9.39996 7.15984 8.57996 6.83984 7.67996C6.85984 7.59996 6.87984 7.51995 6.89984 7.44995C6.89984 7.44995 7.24985 5.41996 7.15985 4.73996C7.14985 4.64996 7.13984 4.61995 7.11984 4.54995L7.08984 4.46997C6.98984 4.24997 6.80986 4.00996 6.51986 4.01996H6.33984C6.00984 4.01996 5.74984 4.17997 5.67984 4.43997C5.46984 5.23997 5.67986 6.42995 6.07986 7.97995L5.97986 8.22995C5.69986 8.93995 5.33984 9.64996 5.02984 10.27L4.98987 10.35C4.65987 11.01 4.35984 11.57 4.08984 12.04L3.80984 12.19C3.80984 12.19 3.30986 12.46 3.19986 12.53C2.24986 13.11 1.60985 13.77 1.50985 14.3C1.47985 14.47 1.50986 14.68 1.66986 14.78L1.93985 14.9199C2.05985 14.9799 2.17984 15.01 2.30984 15.01C2.98984 15.01 3.77984 14.14 4.86984 12.21C6.12984 11.79 7.55984 11.44 8.80984 11.25C9.76984 11.8 10.9398 12.18 11.6798 12.18C11.8098 12.18 11.9299 12.17 12.0199 12.14C12.1599 12.1 12.2799 12.02 12.3499 11.91C12.4899 11.69 12.5199 11.38 12.4799 11.07H12.4598ZM2.13986 14.4799C2.25986 14.1299 2.74986 13.45 3.47986 12.84C3.52986 12.8 3.63987 12.69 3.73987 12.59C2.97987 13.83 2.46986 14.32 2.13986 14.47V14.4799ZM6.43985 4.36996C6.65985 4.36996 6.77985 4.92996 6.78985 5.45996C6.79985 5.98996 6.67984 6.35997 6.52984 6.62997C6.40984 6.21997 6.34985 5.57995 6.34985 5.16995C6.34985 5.16995 6.34985 4.36996 6.43985 4.36996ZM5.15985 11.58C5.30985 11.3 5.46985 11.0099 5.62985 10.6999C6.02985 9.93995 6.26984 9.33997 6.45984 8.84997C6.82984 9.53997 7.28986 10.12 7.82986 10.59C7.89986 10.65 7.96985 10.71 8.03985 10.77C6.93985 10.99 5.98985 11.26 5.15985 11.59V11.58ZM12.0898 11.52C12.0198 11.56 11.8298 11.59 11.7098 11.59C11.3098 11.59 10.8198 11.4 10.1298 11.1C10.3998 11.08 10.6399 11.07 10.8599 11.07C11.2599 11.07 11.3799 11.0699 11.7699 11.1699C12.1599 11.2699 12.1699 11.48 12.0999 11.52H12.0898Z" fill="#F40000"/>
</svg>
`},17935:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.0667 3.80034V12.2003H9.40001V3.80034H14.0667ZM15 2.867H8.46667V13.1337H15V2.867Z" fill="#D24625"/>
<path d="M13.1333 10.3337H8.46667V11.267H13.1333V10.3337Z" fill="#D24625"/>
<path d="M8.46667 2.14835V13.8524L1.93333 12.4897V3.511L8.46667 2.14835ZM9.4 1.00034L1 2.75501V13.255L9.4 15.0097V1.00968V1.00034Z" fill="#D24625"/>
<path d="M11.2667 4.73367V6.60034H13.1334C13.1334 5.57367 12.2934 4.73367 11.2667 4.73367Z" fill="#D24625"/>
<path d="M6.63733 7.067C6.63733 6.227 6.33866 5.50835 5.89999 5.16302C5.22799 4.64035 4.192 4.73366 4.192 4.73366H3.79065V11.267H4.72398V9.44701C5.05065 9.44701 5.46132 9.37234 5.83465 9.09234C6.36665 8.69101 6.62799 8.00968 6.62799 7.05768L6.63733 7.067ZM5.28399 8.34566C5.11599 8.47633 4.90133 8.51368 4.73333 8.51368V5.62968C4.91066 5.65768 5.12533 5.71368 5.29333 5.86302C5.564 6.09635 5.704 6.49768 5.704 7.05768C5.704 7.49635 5.62932 8.07501 5.28399 8.33634V8.34566Z" fill="#D24625"/>
<path d="M10.3334 7.53366V5.66699C9.98802 5.66699 9.67069 5.76966 9.40002 5.92832V9.14834C9.67069 9.307 9.98802 9.40967 10.3334 9.40967C11.36 9.40967 12.2 8.56967 12.2 7.543H10.3334V7.53366Z" fill="#D24625"/>
</svg>
`},94896:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.0667 3.80034V12.2003H9.40001V3.80034H14.0667ZM15 2.867H8.46667V13.1337H15V2.867Z" fill="#2A5699"/>
<path d="M13.1334 4.73367H9.40002V5.66701H13.1334V4.73367Z" fill="#2A5699"/>
<path d="M13.1334 6.60034H9.40002V7.53368H13.1334V6.60034Z" fill="#2A5699"/>
<path d="M13.1334 8.46701H9.40002V9.40034H13.1334V8.46701Z" fill="#2A5699"/>
<path d="M13.1334 10.3337H9.40002V11.267H13.1334V10.3337Z" fill="#2A5699"/>
<path d="M8.46667 2.14835V13.8524L1.93333 12.4897V3.511L8.46667 2.14835ZM9.4 1.00034L1 2.75501V13.255L9.4 15.0097V1.00968V1.00034Z" fill="#2A5699"/>
<path d="M5.90935 10.3337L5.19069 7.35632L4.48135 10.3337H3.88403L2.8667 5.66699H3.61335L4.2107 8.58833L4.90136 5.66699H5.49868L6.18936 8.61633L6.78668 5.66699H7.53337L6.51604 10.3337H5.90935Z" fill="#2A5699"/>
</svg>
`},27107:D=>{D.exports=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M31 6L39 14H31V6Z" fill="#0058EF"/>
<mask id="path-2-inside-1_3672_46963" fill="white">
<path fill-rule="evenodd" clip-rule="evenodd" d="M31 6H11V44H39V14H31V6Z"/>
</mask>
<path d="M11 6V4H9V6H11ZM31 6H33V4H31V6ZM11 44H9V46H11V44ZM39 44V46H41V44H39ZM39 14H41V12H39V14ZM31 14H29V16H31V14ZM11 8H31V4H11V8ZM13 44V6H9V44H13ZM39 42H11V46H39V42ZM37 14V44H41V14H37ZM39 12H31V16H39V12ZM33 14V6H29V14H33Z" fill="#0058EF" mask="url(#path-2-inside-1_3672_46963)"/>
</svg>
`},76185:D=>{D.exports=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.849 16.7535L20.249 32.1535" stroke="#207245" stroke-width="2" stroke-miterlimit="10"/>
<path d="M11.849 30.7535L20.249 15.3535" stroke="#207245" stroke-width="2" stroke-miterlimit="10"/>
<path d="M26.8625 4.75354L4.44897 9.74786V38.7394L26.8625 43.2465V4.75354Z" stroke="#207245" stroke-width="2"/>
<path d="M26.8625 10.1133H43.551V38.0085H26.8625M26.8625 15.8385H31.5311M26.8625 21.3201H31.5311M26.8625 27.0454H31.5311M26.8625 32.6488H31.5311M34.2463 15.8385H39.9148M34.2463 21.3201H39.9148M34.2463 27.0454H39.9148M34.2463 32.6488H39.9148" stroke="#207245" stroke-width="2"/>
</svg>
`},87831:D=>{D.exports=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5 37V11H43V37H5Z" stroke="#FF8800" stroke-width="2" stroke-miterlimit="10"/>
<path d="M33.6655 20.1493C33.6655 21.8257 32.3244 23.1657 30.6932 23.1657C29.0621 23.1657 27.7209 21.8257 27.7209 20.1493C27.7209 18.4729 29.0621 17.1329 30.6932 17.1329C32.3244 17.1329 33.6655 18.4729 33.6655 20.1493Z" stroke="#FF8800" stroke-width="2"/>
<path d="M6.09387 37V33.8161L14.9636 19.1407L31.0907 37H6.09387Z" stroke="#FF8800" stroke-width="2"/>
<path d="M42.0514 37H37.8244L32.1907 29.215L37.0649 26.7508L42.0514 32.5684V37Z" stroke="#FF8800" stroke-width="2"/>
</svg>
`},96682:D=>{D.exports=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 24V6H29.9001L41 16.2738V42H18.5" stroke="#F40000" stroke-width="2" stroke-miterlimit="10"/>
<path d="M29.3433 6.01556V16.5029C33.371 16.5029 41.4263 16.5029 41.4263 16.5029" stroke="#F40000" stroke-width="2"/>
<path d="M35.9689 33.2099C35.9389 32.9399 35.7289 32.5799 35.4889 32.3399C34.8289 31.6799 33.3589 31.3199 31.1389 31.2899C29.6389 31.2899 27.8089 31.4099 25.9189 31.6799C25.0789 31.1699 24.1789 30.6299 23.4889 29.9699C21.6289 28.1999 20.0689 25.7399 19.1089 23.0399C19.1689 22.7999 19.2289 22.5598 19.2889 22.3498C19.2889 22.3498 20.3389 16.2599 20.0689 14.2199C20.0389 13.9499 20.0089 13.8599 19.9489 13.6499L19.8589 13.4099C19.5589 12.7499 19.0189 12.0299 18.1489 12.0599H17.6089C16.6189 12.0599 15.8389 12.5399 15.6289 13.3199C14.9989 15.7199 15.6289 19.2898 16.8289 23.9398L16.5289 24.6898C15.6889 26.8198 14.6089 28.9499 13.6789 30.8099L13.559 31.0499C12.569 33.0299 11.6689 34.7099 10.8589 36.1199L10.0189 36.5699C10.0189 36.5699 8.51893 37.3799 8.18893 37.5899C5.33893 39.3299 3.41892 41.3099 3.11892 42.8999C3.02892 43.4099 3.11893 44.0399 3.59893 44.3399L4.4089 44.7598C4.7689 44.9398 5.12888 45.0299 5.51888 45.0299C7.55888 45.0299 9.92887 42.4199 13.1989 36.6299C16.9789 35.3699 21.2689 34.3199 25.0189 33.7499C27.8989 35.3999 31.4089 36.5399 33.6289 36.5399C34.0189 36.5399 34.3789 36.5098 34.6489 36.4198C35.0689 36.2999 35.4289 36.0599 35.6389 35.7299C36.0589 35.0699 36.1489 34.1399 36.0289 33.2099H35.9689ZM5.00893 43.4398C5.36893 42.3898 6.83892 40.3499 9.02892 38.5199C9.17892 38.3999 9.50895 38.0699 9.80895 37.7699C7.52895 41.4899 5.99893 42.9599 5.00893 43.4099V43.4398ZM17.9089 13.1099C18.5689 13.1099 18.9289 14.7899 18.9589 16.3799C18.9889 17.9699 18.6289 19.0799 18.1789 19.8899C17.8189 18.6599 17.6389 16.7398 17.6389 15.5098C17.6389 15.5098 17.6389 13.1099 17.9089 13.1099ZM14.0689 34.7399C14.5189 33.8999 14.9989 33.0298 15.4789 32.0998C16.6789 29.8198 17.3989 28.0199 17.9689 26.5499C19.0789 28.6199 20.4589 30.3599 22.0789 31.7699C22.2889 31.9499 22.4989 32.1299 22.7089 32.3099C19.4089 32.9699 16.5589 33.7799 14.0689 34.7699V34.7399ZM34.8589 34.5599C34.6489 34.6799 34.0789 34.7699 33.7189 34.7699C32.5189 34.7699 31.0489 34.1999 28.9789 33.2999C29.7889 33.2399 30.5089 33.2099 31.1689 33.2099C32.3689 33.2099 32.7289 33.2098 33.8989 33.5098C35.0689 33.8098 35.0989 34.4399 34.8889 34.5599H34.8589Z" fill="#F40000"/>
</svg>
`},30351:D=>{D.exports=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M26.8625 4.75354L4.44897 9.74786V38.7394L26.8625 43.2465V4.75354Z" stroke="#D24625" stroke-width="2"/>
<path d="M33.8 14.2097V19.8097H39.4C39.4 16.7297 36.88 14.2097 33.8 14.2097Z" fill="#D24625"/>
<path d="M31.0004 22.6097V17.0097C29.9644 17.0097 29.0124 17.3177 28.2004 17.7937V27.4537C29.0124 27.9297 29.9644 28.2377 31.0004 28.2377C34.0804 28.2377 36.6004 25.7177 36.6004 22.6377H31.0004V22.6097Z" fill="#D24625"/>
<path d="M19.9124 21.2097C19.9124 18.6897 19.0163 16.5337 17.7003 15.4977C15.6843 13.9297 12.5764 14.2097 12.5764 14.2097H11.3723V33.8097H14.1723V28.3497C15.1523 28.3497 16.3843 28.1257 17.5043 27.2857C19.1003 26.0817 19.8843 24.0377 19.8843 21.1817L19.9124 21.2097ZM15.8523 25.0457C15.3483 25.4377 14.7043 25.5497 14.2003 25.5497V16.8977C14.7323 16.9817 15.3764 17.1497 15.8804 17.5977C16.6924 18.2977 17.1124 19.5017 17.1124 21.1817C17.1124 22.4977 16.8883 24.2337 15.8523 25.0177V25.0457Z" fill="#D24625"/>
<path d="M26.8625 10.0612H43.551V37.9563H26.8625" stroke="#D24625" stroke-width="2"/>
<path d="M26.8748 32.0246H39.8748" stroke="#D24625" stroke-width="2"/>
</svg>
`},23472:D=>{D.exports=`<svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.728 31.001L15.5721 22.069L13.444 31.001H11.6521L8.6001 17.001H10.8401L12.6321 25.765L14.7041 17.001H16.496L18.5681 25.849L20.36 17.001H22.6001L19.5481 31.001H17.728Z" fill="#2A5699"/>
<path d="M26.8413 4.54126L4.42773 9.53558V38.5271L26.8413 43.0342V4.54126Z" stroke="#2A5699" stroke-width="2"/>
<path d="M26.8413 9.90106H43.5298V37.7962H26.8413M26.8413 15.6263H39.5098M26.8413 21.1079H39.5098M26.8413 26.8331H39.5098M26.8413 32.4365H39.5098" stroke="#2A5699" stroke-width="2"/>
</svg>
`},75670:D=>{D.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" enable-background="new 0 0 20 20"><g fill="#afb4c1"><path d="m9 11.8h2v3.3h-2z"/><circle cx="10" cy="12" r="1.5"/></g><g fill="none" stroke="#afb4c1" stroke-miterlimit="10"><path d="m16.5 18.5h-13c-.6 0-1-.4-1-1v-9c0-.6.4-1 1-1h13c.6 0 1 .4 1 1v9c0 .6-.4 1-1 1z"/><path d="M5.5,7V5.5c0-2.2,1.8-4,4-4h1c2.2,0,4,1.8,4,4V7" stroke-width="1.25"/></g></svg>'},112:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16"><defs/><g transform="translate(143.941 -406.051)"><rect width="2" height="2" transform="translate(-136.941 408.051)" style="fill: #8095b3;"/><rect width="2" height="2" transform="translate(-136.941 413.051)" style="fill: #8095b3;"/><rect width="2" height="2" transform="translate(-136.941 418.051)" style="fill: #8095b3;"/></g><rect width="16" height="16" style="fill: none;"/></svg>
`},67347:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16"><defs/><path d="M-26.666,687.452l2.438,2,4.062-4" transform="translate(31.666 -676.453)" style="fill: none; stroke: #54657d; stroke-miterlimit: 10;"/><g transform="translate(0 2)" style="fill: none; stroke: #54657d; stroke-miterlimit: 10;"><rect width="16" height="14" style="stroke: none;"/><rect x="0.5" y="0.5" width="15" height="13" style="fill: none;"/></g><line x2="16" transform="translate(0 6.5)" style="fill: none; stroke: #54657d; stroke-miterlimit: 10;"/><g transform="translate(2)" style="stroke: #54657d; stroke-miterlimit: 10; fill: #fff;"><rect width="3" height="5" style="stroke: none;"/><rect x="0.5" y="0.5" width="2" height="4" style="fill: none;"/></g><g transform="translate(11)" style="stroke: #54657d; stroke-miterlimit: 10; fill: #fff;"><rect width="3" height="5" style="stroke: none;"/><rect x="0.5" y="0.5" width="2" height="4" style="fill: none;"/></g></svg>
`},63202:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16"><defs/><g transform="translate(-1816.814 -33.301)"><g transform="translate(1816.814 33.301)" style="fill: none; stroke: #54657d; stroke-miterlimit: 10;"><circle cx="8" cy="8" r="8" style="stroke: none;"/><circle cx="8" cy="8" r="7.5" style="fill: none;"/></g><path d="M1824.814,36.015v5.244l3.266,3.8" style="fill: none; stroke: #54657d; stroke-miterlimit: 10;"/></g></svg>
`},77017:D=>{D.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.error-icon-a{fill:#df1f26;}.error-icon-b,.error-icon-c{fill:none;}.error-icon-b{stroke:#fff;stroke-miterlimit:10;stroke-width:1.5px;}</style></defs><circle class="error-icon-a" cx="7" cy="7" r="7" transform="translate(1 1)"/><line class="error-icon-b" x2="6" y2="6" transform="translate(5 5)"/><line class="error-icon-b" y1="6" x2="6" transform="translate(5 5)"/><rect class="error-icon-c" width="16" height="16"/></svg>'},64207:D=>{D.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16.001" height="16" viewBox="0 0 16.001 16"><defs><style>.warning-icon-a{fill:#ff9800;}.warning-icon-b,.warning-icon-d{fill:none;}.warning-icon-b{stroke:#fff;stroke-linecap:round;stroke-miterlimit:10;stroke-width:2px;}.warning-icon-c{fill:#fff;}</style></defs><g transform="translate(-1330.138 361.759)"><path class="warning-icon-a" d="M1345.172-346.541H1331.1a.964.964,0,0,1-.84-1.438l7.033-12.505a.965.965,0,0,1,1.682,0l7.034,12.505A.965.965,0,0,1,1345.172-346.541Z"/><line class="warning-icon-b" y2="3" transform="translate(1338.139 -355.279)"/><circle class="warning-icon-c" cx="1.25" cy="1.25" r="1.25" transform="translate(1336.889 -350.529)"/></g><rect class="warning-icon-d" width="16" height="16" transform="translate(0.001)"/></svg>'},14186:D=>{D.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.a,.b{fill:none;}.b{stroke:#fff;stroke-linecap:round;stroke-width:1.5px;}</style></defs><g transform="translate(16) rotate(90)"><rect class="a" width="16" height="16"/><path class="b" d="M10.365,0,5.182,5.465,0,0" transform="translate(2.818 5.268)"/></g></svg>'},67566:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
	<path fill="currentColor" d="m4 7 4 4 4-4Z"/>
	<path fill="none" d="M0 0h16v16H0z"/>
</svg>
`},71222:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M11.6934 5.35551C11.8887 5.16024 11.8887 4.84366 11.6934 4.6484C11.4981 4.45314 11.1816 4.45314 10.9863 4.6484L8.3418 7.29289L5.6973 4.6484C5.50204 4.45314 5.18546 4.45314 4.9902 4.6484C4.79493 4.84366 4.79493 5.16024 4.9902 5.35551L7.63469 8L4.9902 10.6445C4.79493 10.8398 4.79493 11.1563 4.9902 11.3516C5.18546 11.5469 5.50204 11.5469 5.6973 11.3516L8.3418 8.70711L10.9863 11.3516C11.1816 11.5469 11.4981 11.5469 11.6934 11.3516C11.8887 11.1563 11.8887 10.8398 11.6934 10.6445L9.0489 8L11.6934 5.35551Z" fill="currentColor"/>
</svg>
`},18030:D=>{D.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.3965 8.12903L1.78105 8.12903" stroke="currentColor"/>
<path d="M7.21062 2.37312L1.45715 8.12659L7.21062 13.8801" stroke="currentColor"/>
</svg>
`},96637:D=>{D.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.45715 8.12659H14.0726" stroke="currentColor"/>
<path d="M8.64305 13.8825L14.3965 8.12903L8.64305 2.37556" stroke="currentColor"/>
</svg>
`},37719:D=>{D.exports=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.9008 17.65L12.7758 20.475C12.7424 20.5417 12.6966 20.5959 12.6383 20.6375C12.5799 20.6792 12.5091 20.7 12.4258 20.7C12.2924 20.7 12.1924 20.6459 12.1258 20.5375C12.0591 20.4292 12.0508 20.3167 12.1008 20.2L16.1258 10.2C16.1591 10.1334 16.2008 10.0834 16.2508 10.05C16.3008 10.0167 16.3591 10 16.4258 10H16.6758C16.7424 10 16.8008 10.0167 16.8508 10.05C16.9008 10.0834 16.9424 10.1334 16.9758 10.2L21.0008 20.2C21.0508 20.3167 21.0424 20.4292 20.9758 20.5375C20.9091 20.6459 20.8091 20.7 20.6758 20.7C20.5924 20.7 20.5216 20.6792 20.4633 20.6375C20.4049 20.5959 20.3591 20.5417 20.3258 20.475L19.2008 17.65H13.9008ZM8.87578 12.975L4.27578 17.6C4.20911 17.6834 4.12995 17.725 4.03828 17.725C3.94661 17.725 3.85911 17.6834 3.77578 17.6C3.69245 17.5167 3.65078 17.4334 3.65078 17.35C3.65078 17.2667 3.69245 17.1834 3.77578 17.1L8.37578 12.475C7.80911 11.8917 7.22995 11.1584 6.63828 10.275C6.04661 9.39172 5.63411 8.63338 5.40078 8.00005H6.17578C6.39245 8.53338 6.77161 9.20005 7.31328 10C7.85495 10.8 8.37578 11.4584 8.87578 11.975C9.84245 10.9917 10.6758 9.96255 11.3758 8.88755C12.0758 7.81255 12.5258 6.85005 12.7258 6.00005H3.15078C3.05078 6.00005 2.96745 5.96672 2.90078 5.90005C2.83411 5.83338 2.80078 5.75005 2.80078 5.65005C2.80078 5.55005 2.83411 5.46672 2.90078 5.40005C2.96745 5.33338 3.05078 5.30005 3.15078 5.30005H8.65078V4.65005C8.65078 4.55005 8.68411 4.46672 8.75078 4.40005C8.81745 4.33338 8.90078 4.30005 9.00078 4.30005C9.10078 4.30005 9.18411 4.33338 9.25078 4.40005C9.31745 4.46672 9.35078 4.55005 9.35078 4.65005V5.30005H14.8508C14.9508 5.30005 15.0341 5.33338 15.1008 5.40005C15.1674 5.46672 15.2008 5.55005 15.2008 5.65005C15.2008 5.75005 15.1674 5.83338 15.1008 5.90005C15.0341 5.96672 14.9508 6.00005 14.8508 6.00005H13.4758C13.1924 7.00005 12.6883 8.07922 11.9633 9.23755C11.2383 10.3959 10.3758 11.475 9.37578 12.475L11.9508 15.125L11.6758 15.85L8.87578 12.975ZM14.1508 17H18.9508L16.5508 10.975L14.1508 17Z" stroke="currentColor" fill="currentColor"/>
</svg>
`},49967:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="65.898" height="50" viewBox="0 0 65.898 50">
  <g id="Group_10554" data-name="Group 10554" transform="translate(-630.824 -282)">
    <g id="Group_10553" data-name="Group 10553" transform="translate(-8 4)">
      <rect id="Rectangle_23319" data-name="Rectangle 23319" width="24" height="8" transform="translate(640 311) rotate(-90)" fill="#757575" opacity="0.15"/>
      <rect id="Rectangle_23320" data-name="Rectangle 23320" width="15" height="8" transform="translate(655 313) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23321" data-name="Rectangle 23321" width="50" height="8" transform="translate(671 328) rotate(-90)" fill="#757575" opacity="0.16"/>
      <rect id="Rectangle_23326" data-name="Rectangle 23326" width="20" height="8" transform="translate(671 298) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23322" data-name="Rectangle 23322" width="30" height="8" transform="translate(687 311) rotate(-90)" fill="#757575" opacity="0.12"/>
      <rect id="Rectangle_23327" data-name="Rectangle 23327" width="17" height="8" transform="translate(687 298) rotate(-90)" fill="#757575" opacity="0.36"/>
      <rect id="Rectangle_23323" data-name="Rectangle 23323" width="11" height="8" transform="translate(640 298) rotate(-90)" fill="#757575" opacity="0.15"/>
      <rect id="Rectangle_23324" data-name="Rectangle 23324" width="25" height="8" transform="translate(655 313) rotate(-90)" fill="#757575" opacity="0.19"/>
      <path id="Path_9959" data-name="Path 9959" d="M223.923,2054c8.8,1.753,9.21,7.979,18.455,7.661s19.38-15.618,29.076-15.618,13.109-8.362,16.091-8.043" transform="translate(416.077 -1753.707)" fill="none" stroke="#757575" stroke-linecap="round" stroke-width="2" opacity="0.36"/>
    </g>
  </g>
</svg>
`},78683:D=>{D.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 1.49845H0.783829V4.00128H2.48383V0.000488281H0V1.49845Z" fill="#FF4013"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14 1.00089H5.08699V3.00089H14V1.00089ZM14 6.00052H5.08699V8.00052H14V6.00052ZM0 12.7274V13.9998H3.19044V9.99979H0V11.1761H1.5V11.5073H0.75V12.3962H1.5V12.7274H0ZM14 10.9998H5.08699V12.9998H14V10.9998Z" fill="#FF4013"/>
<path d="M2.14577e-05 7.56383V8.99972L3.15902 8.99977V7.56383L2.26167 7.56378L3.15902 6.86625L3.15902 5.00135L2.14577e-05 5.00128L0 6.43327H1.5L2.14577e-05 7.56383Z" fill="#FF4013"/>
</svg>
`},36659:D=>{D.exports=`<svg id="Boolean_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_12" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-width="2"><rect width="14" height="14" stroke="none"/><rect x="1" y="1" width="12" height="12" fill="none"/></g><path id="Path_30" d="M10.5,4.5,5.912,9,4,7.162" transform="translate(1 0.5)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-width="2"/></svg>
`},39078:D=>{D.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8.183.779c2.084.007 2.813.35 4.468 1.861l-1.875 2.424-2.95-1.229Z" fill="#ff1c06"/><path d="M7.643 14.846c-2.083-.006-2.813-.35-4.467-1.861l1.875-2.424L8 11.79Z" fill="#ffc6b8"/><path d="M15.024 8.156c-.064 2.22-.431 3.006-2 4.809l-2.4-1.931 1.322-3.175Z" fill="#ff4013"/><path d="M13.074 3.143c1.5 1.443 1.8 2.195 1.949 4.431l-3.03.46-1.286-2.925Z" fill="#ff320e"/><path d="M3.224 12.86c-1.5-1.443-1.795-2.195-1.948-4.43l3.029-.46 1.287 2.925Z" fill="#ffe8e3"/><path d="M12.999 12.98c-1.578 1.562-2.386 1.878-4.769 2.1l-.4-3.055 3.149-1.384Z" fill="#ff795a"/><g transform="translate(-798.326 92.909)" fill="none"><path d="M798.326-92.909h16v16h-16z"/><circle cx="7" cy="7" r="7" transform="translate(799.326 -91.909)" stroke="#ff4013" stroke-width="2"/><circle cx="3" cy="3" r="3" transform="translate(803.326 -87.909)" stroke="#ff4013" stroke-width="2"/><g stroke="#ff4013" stroke-width="2"><path d="M806.326-81.454v3.686"/><path d="M806.326-88.519v-3.386"/><path d="M803.211-84.909h-3.685"/><path d="M812.826-84.909h-3.387"/><path d="M804.126-87.162c-.8-.8-2.306-2.252-3.1-3.05"/><path d="M811.628-79.605c-.729-.73-2.31-2.2-3.04-2.926"/><path d="m804.02-82.6-3 3"/><path d="m811.629-90.213-3.088 2.978"/></g></g></svg>
`},26861:D=>{D.exports=`<svg id="Date_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_6448" transform="translate(1 3)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="14" height="12" stroke="none"/><rect x="1" y="1" width="12" height="10" fill="none"/></g><line id="Line_764" x2="12" transform="translate(2 7)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_11729" d="M176.171,1073.754v3" transform="translate(-171.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/><path id="Path_11730" d="M176.171,1073.754v3" transform="translate(-165.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/></svg>
`},55146:D=>{D.exports=`<svg id="Datetime_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Icon_left_panel_date_time_16x16_heavy" transform="translate(0)"><rect id="Rectangle_6448" width="16" height="16" fill="none"/><path id="Path_6271" d="M1895.033,260.278h-4.149v-9h12v2" transform="translate(-1889.884 -248.278)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7772" d="M0,0H4.5" transform="translate(1 6)" fill="none" stroke="#ff4013" stroke-width="2"/><line id="Line_771" y2="4" transform="translate(4)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_772" y2="4" transform="translate(10)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Path_6272" transform="translate(-1889.764 -248.582)" fill="none" stroke-miterlimit="10"><path d="M1905.764,258.584a5,5,0,1,1-5-5A5,5,0,0,1,1905.764,258.584Z" stroke="none"/><path d="M 1900.7626953125 261.5840454101562 C 1902.417602539062 261.5840454101562 1903.763916015625 260.23828125 1903.763916015625 258.5840759277344 C 1903.763916015625 256.9292602539062 1902.417602539062 255.5829772949219 1900.7626953125 255.5829772949219 C 1899.109130859375 255.5829772949219 1897.763916015625 256.9292602539062 1897.763916015625 258.5840759277344 C 1897.763916015625 260.23828125 1899.109130859375 261.5840454101562 1900.7626953125 261.5840454101562 M 1900.7626953125 263.5840454101562 C 1898.000244140625 263.5840454101562 1895.763916015625 261.3454284667969 1895.763916015625 258.5840759277344 C 1895.763916015625 255.8215942382812 1898.000244140625 253.5829772949219 1900.7626953125 253.5829772949219 C 1903.524169921875 253.5829772949219 1905.763916015625 255.8215942382812 1905.763916015625 258.5840759277344 C 1905.763916015625 261.3454284667969 1903.524169921875 263.5840454101562 1900.7626953125 263.5840454101562 Z" stroke="none" fill="#ff4013"/></g><path id="Path_6273" d="M1900.1,255.194v4h2.5" transform="translate(-1889.098 -249.194)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},71011:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2 3.5H14V12C14 12.1326 13.9473 12.2598 13.8536 12.3536C13.7598 12.4473 13.6326 12.5 13.5 12.5H2.5C2.36739 12.5 2.24021 12.4473 2.14645 12.3536C2.05268 12.2598 2 12.1326 2 12V3.5Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14 3.5L8 9L2 3.5" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},55039:D=>{D.exports=`<svg id="File_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Group_7055" transform="translate(-733.278 92.545)"><g id="Rectangle_6454" transform="translate(735.278 -91.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="12" height="14" stroke="none"/><rect x="1" y="1" width="10" height="12" fill="none"/></g><line id="Line_774" x2="6" transform="translate(738.278 -87.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_775" x2="6" transform="translate(738.278 -84.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_777" x2="4" transform="translate(738.278 -81.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},68877:D=>{D.exports=`<svg id="Float_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_14515" transform="translate(-144 -422)"><rect id="Rectangle_39433" width="16" height="16" transform="translate(144 422)" fill="none"/></g><path id="Path_11302" d="M6.957-4.64a6.469,6.469,0,0,1-.8,3.6A2.764,2.764,0,0,1,3.707.127,2.732,2.732,0,0,1,1.285-1.079,6.377,6.377,0,0,1,.47-4.64a6.53,6.53,0,0,1,.793-3.621A2.752,2.752,0,0,1,3.707-9.426,2.739,2.739,0,0,1,6.135-8.208,6.39,6.39,0,0,1,6.957-4.64Zm-4.539,0a7.22,7.22,0,0,0,.3,2.447,1.022,1.022,0,0,0,.993.74A1.033,1.033,0,0,0,4.7-2.2,7.02,7.02,0,0,0,5-4.64a7,7,0,0,0-.308-2.453,1.034,1.034,0,0,0-.987-.746,1.025,1.025,0,0,0-.99.746A7.208,7.208,0,0,0,2.418-4.64ZM7.759-.908a1.064,1.064,0,0,1,.286-.806,1.158,1.158,0,0,1,.832-.273,1.125,1.125,0,0,1,.816.279,1.061,1.061,0,0,1,.289.8,1.061,1.061,0,0,1-.292.79,1.105,1.105,0,0,1-.812.289,1.138,1.138,0,0,1-.825-.282A1.057,1.057,0,0,1,7.759-.908ZM13.69,0H11.728V-5.37l.019-.882.032-.965q-.489.489-.679.641l-1.066.857L9.088-6.9l2.99-2.38H13.69Z" transform="translate(0.53 12.426)" fill="#ff4013"/></svg>
`},92458:D=>{D.exports=`<svg id="Guid_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_42308" width="16" height="16" fill="none"/><path id="Path_11737" d="M1.162,0H3.43V-9.8H1.162Zm9.926-10.388v3.654a2.894,2.894,0,0,0-2.254-.91A3.661,3.661,0,0,0,5.068-3.766,3.661,3.661,0,0,0,8.834.112a2.9,2.9,0,0,0,2.352-.98V0h2.086V-10.388ZM9.212-1.68A1.911,1.911,0,0,1,7.28-3.766,1.911,1.911,0,0,1,9.212-5.852,1.908,1.908,0,0,1,11.13-3.766,1.908,1.908,0,0,1,9.212-1.68Z" transform="translate(0.838 13)" fill="#ff4013" stroke="rgba(0,0,0,0)" stroke-width="1"/></svg>
`},65689:D=>{D.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1742_819)">
<path d="M10.913 8.99277L7.40833 13.0074H13.0074V11.2395L10.913 8.99277ZM10.8641 6.00745L15.0074 10.4519V15.0074H3.00745L10.8641 6.00745Z" fill="#ff4013"/>
<path d="M3.43597 9.72806C2.87697 10.2871 2.20496 9.92807 1.64496 9.37007C1.08596 8.81107 0.726988 8.13807 1.28699 7.57907L3.07794 5.78806C3.63694 5.22906 4.30898 5.58806 4.86798 6.14606C5.42798 6.70506 5.78595 7.37706 5.22595 7.93706L3.43597 9.72806Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M7.93689 5.22705C7.37689 5.78605 6.70591 5.42704 6.14691 4.86804C5.58691 4.30904 5.22894 3.63704 5.78894 3.07804L7.57892 1.28704C8.13892 0.728043 8.80993 1.08704 9.36993 1.64604C9.92993 2.20504 10.2879 2.87704 9.72888 3.43704L7.93689 5.22705Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M4.70691 6.51907L6.51791 4.70807" stroke="#ff4013" stroke-width="2"/>
<path d="M11.301 2.00702H14.0079V14.007H2.00793V11.581" stroke="#ff4013" stroke-width="2"/>
</g>
<defs>
<clipPath id="clip0_1742_819">
<rect width="16.007" height="16.007" fill="#ff4013"/>
</clipPath>
</defs>
</svg>
`},60521:D=>{D.exports=`<svg id="Integer_icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99433 4.65198C9.48732 5.09802 9.74027 5.69781 9.74027 6.39946C9.74027 7.11039 9.46186 7.74386 8.95863 8.29085L8.95331 8.29664C8.68048 8.58037 8.17318 8.98047 7.44252 9.47417L7.44143 9.4749C7.00788 9.76552 6.67964 10.0338 6.4484 10.2773C6.39755 10.3308 6.35224 10.3822 6.31202 10.4316H9.03463C9.42976 10.4316 9.75009 10.7519 9.75009 11.1471C9.75009 11.5422 9.42976 11.8625 9.03463 11.8625H4.36201V11.5055C4.36201 10.774 4.62396 10.1113 5.14954 9.53003C5.45393 9.18287 5.98212 8.74216 6.73359 8.22779C7.28336 7.835 7.61754 7.57002 7.77738 7.40238C8.08169 7.07198 8.22096 6.73348 8.22096 6.38964C8.22096 6.03409 8.11952 5.81409 7.95289 5.66027C7.78277 5.50324 7.51683 5.40148 7.12478 5.40148C6.72877 5.40148 6.47218 5.52561 6.29884 5.75228L6.29169 5.76164L6.28392 5.77051C6.13055 5.94579 6.0142 6.20942 5.96505 6.5873C5.91679 6.95826 5.61042 7.29659 5.18377 7.29659C4.7751 7.29659 4.39395 6.95656 4.44447 6.49553C4.51728 5.83108 4.75991 5.26428 5.17392 4.82141C5.68203 4.26788 6.36125 4 7.15424 4C7.87626 4 8.49451 4.21025 8.99122 4.6492L8.99433 4.65198ZM14.8743 4.5961C15.3635 5.01371 15.6083 5.57814 15.6083 6.262C15.6083 6.71398 15.4974 7.12093 15.2526 7.45671C15.1531 7.59318 15.0352 7.71289 14.9008 7.81669C15.0605 7.92572 15.2015 8.0545 15.3211 8.20545C15.6165 8.55303 15.7556 8.98069 15.7556 9.46307C15.7556 10.1963 15.4914 10.8144 14.9713 11.2883C14.4419 11.7715 13.7612 12 12.9634 12C12.2299 12 11.6078 11.8045 11.1119 11.4124L11.1064 11.408C10.628 11.014 10.3332 10.4794 10.2052 9.83055C10.1107 9.35139 10.5042 8.97835 10.9288 8.97835C11.3492 8.97835 11.6378 9.30727 11.7079 9.64478C11.7693 9.94025 11.9002 10.158 12.0891 10.3154C12.3147 10.495 12.5969 10.5985 12.9634 10.5985C13.3872 10.5985 13.6961 10.4769 13.9229 10.2668C14.1282 10.0596 14.2363 9.80805 14.2363 9.49253C14.2363 9.15687 14.1319 8.93882 13.9486 8.7817C13.7609 8.62082 13.483 8.52399 13.0419 8.52399H12.7866C12.4159 8.52399 12.1154 8.22345 12.1154 7.85271C12.1154 7.48197 12.4159 7.18143 12.7866 7.18143H13.0125C13.4306 7.18143 13.6903 7.08609 13.85 6.9535C14.0037 6.81675 14.0989 6.61783 14.0989 6.31109C14.0989 6.00164 14.0017 5.79895 13.8513 5.66111L13.8504 5.66027C13.6842 5.50686 13.4217 5.4113 13.0223 5.4113C12.6106 5.4113 12.3484 5.51295 12.1702 5.68456L12.1656 5.68906C12.0215 5.82278 11.914 6.00455 11.8495 6.25293C11.766 6.57474 11.481 6.87436 11.0816 6.87436C10.6572 6.87436 10.2506 6.49494 10.3668 6.00508C10.4953 5.4634 10.7597 5.01133 11.1524 4.66211C11.6438 4.20736 12.2763 4 13.0125 4C13.739 4 14.3777 4.18225 14.8711 4.59337L14.8743 4.5961ZM3.41307 4.92822V11.1029C3.41307 11.5224 3.07297 11.8625 2.65342 11.8625C2.23388 11.8625 1.89377 11.5224 1.89377 11.1029V6.23307C1.68552 6.37174 1.46266 6.49124 1.22573 6.59268C0.723506 6.80771 0.244141 6.40276 0.244141 5.92406C0.244141 5.5872 0.467589 5.3135 0.755873 5.2089C0.963927 5.13341 1.17934 5.03405 1.39555 4.90741C1.64533 4.74519 1.85627 4.57307 2.04007 4.3863C2.18718 4.23681 2.39336 4.13748 2.62233 4.13748C3.05905 4.13748 3.41307 4.4915 3.41307 4.92822Z" fill="#ff4013"/>
</svg>
`},61631:D=>{D.exports=`<svg id="Lookup_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_6916" transform="translate(2.277 2)"><g id="Group_6915" transform="translate(-0.277)"><circle id="Ellipse_237" cx="4.5" cy="4.5" r="4.5" fill="none" stroke="#ff4013" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path id="Path_6243" d="M.344.344,4.123,4.123" transform="translate(7.877 7.876)" fill="none" stroke="#ff4013" stroke-width="2"/></g></g><rect id="Rectangle_24756" width="16" height="16" fill="none"/></svg>
`},32643:D=>{D.exports=`<svg id="Money_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><path id="Path_7070" d="M-318.645,863.293h-6v-8h14v4" transform="translate(325.645 -852.293)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7071" d="M-322.646,855.292a2,2,0,0,1-2,2" transform="translate(326.646 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7072" d="M-312.246,857.292a2,2,0,0,1-2-2" transform="translate(326.246 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7073" d="M-324.646,861.692a2,2,0,0,1,2,2" transform="translate(326.646 -853.692)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Ellipse_1363" transform="translate(6 5)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="2" cy="2" r="2" stroke="none"/><circle cx="2" cy="2" r="1" fill="none"/></g><path id="Path_7074" d="M-310.846,861.425c0,.737-1.12,1.333-2.5,1.333s-2.5-.6-2.5-1.333,1.12-1.333,2.5-1.333S-310.846,860.69-310.846,861.425Z" transform="translate(325.846 -851.092)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7075" d="M-310.846,863.292c0,.589-1.12,1.333-2.5,1.333s-2.5-.744-2.5-1.333" transform="translate(325.846 -850.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},59155:D=>{D.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.3353 1.83815L6.26378 1.46676L6.26378 1.46676L5.3353 1.83815ZM6.03813 3.59524L5.10965 3.96663L5.10965 3.96663L6.03813 3.59524ZM5.82454 4.94398L5.05632 4.3038L5.0563 4.30383L5.82454 4.94398ZM5.44629 5.39792L6.21451 6.03811L6.21453 6.03808L5.44629 5.39792ZM5.52758 7.19434L4.82047 7.90144L4.8205 7.90147L5.52758 7.19434ZM6.8057 8.47236L7.5128 7.76526L7.51278 7.76523L6.8057 8.47236ZM8.60205 8.55382L7.96198 7.7855L7.96187 7.78559L8.60205 8.55382ZM9.05613 8.17554L9.69619 8.94386L9.69631 8.94376L9.05613 8.17554ZM10.4048 7.96192L10.7762 7.03345L10.7761 7.03344L10.4048 7.96192ZM12.1617 8.66476L11.7903 9.59322L11.7903 9.59323L12.1617 8.66476ZM12.9999 9.90268H11.9999V9.90272L12.9999 9.90268ZM13 11.7369H14V11.7368L13 11.7369ZM4.09733 2C4.23363 2 4.3562 2.08298 4.40682 2.20954L6.26378 1.46676C5.90943 0.580885 5.05144 0 4.09733 0V2ZM4.40682 2.20953L5.10965 3.96663L6.96661 3.22386L6.26378 1.46676L4.40682 2.20953ZM5.10965 3.96663C5.15517 4.08044 5.13462 4.20985 5.05632 4.3038L6.59277 5.58417C7.14152 4.92566 7.28485 4.01947 6.96661 3.22385L5.10965 3.96663ZM5.0563 4.30383L4.67804 4.75777L6.21453 6.03808L6.59279 5.58414L5.0563 4.30383ZM4.67807 4.75774C3.90567 5.68462 3.96693 7.0479 4.82047 7.90144L6.23468 6.48723C6.11298 6.36552 6.10396 6.17076 6.21451 6.03811L4.67807 4.75774ZM4.8205 7.90147L6.09862 9.17949L7.51278 7.76523L6.23466 6.4872L4.8205 7.90147ZM6.09859 9.17947C6.95196 10.0328 8.31517 10.0946 9.24224 9.32204L7.96187 7.78559C7.82939 7.89599 7.63468 7.88713 7.5128 7.76526L6.09859 9.17947ZM9.24212 9.32213L9.69619 8.94386L8.41606 7.40722L7.96198 7.7855L9.24212 9.32213ZM9.69631 8.94376C9.79033 8.86541 9.91963 8.8449 10.0334 8.8904L10.7761 7.03344C9.98045 6.71516 9.07438 6.85861 8.41594 7.40732L9.69631 8.94376ZM10.0333 8.89039L11.7903 9.59322L12.5331 7.73629L10.7762 7.03345L10.0333 8.89039ZM11.7903 9.59323C11.917 9.64389 11.9999 9.76649 11.9999 9.90268H13.9999C13.9999 8.94847 13.4189 8.09059 12.5331 7.73628L11.7903 9.59323ZM11.9999 9.90272L12 11.7369L14 11.7368L13.9999 9.90264L11.9999 9.90272ZM12 11.7369C12 11.8823 11.8822 12 11.737 12V14C12.987 14 14 12.9867 14 11.7369H12ZM11.737 12C6.35945 12 2 7.64067 2 2.26318H0C0 8.74528 5.25492 14 11.737 14V12ZM2 2.26318C2 2.11782 2.11785 2 2.26316 2V0C1.01322 0 0 1.0133 0 2.26318H2ZM2.26316 2H4.09733V0H2.26316V2Z" fill="#FF4013"/>
</svg>
`},67021:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15H13C14.1046 15 15 14.1046 15 13V3C15 1.89543 14.1046 1 13 1Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M9 12H7V6H4V4H12V6H9V12Z" fill="#FF4013"/>
</svg>
`},28010:D=>{D.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.14 6.90901C5.13775 7.50618 5.25259 8.098 5.478 8.65101L1.5 12.629V15.229H4.1V13.669H5.66V12.109H7.22L8.078 11.251C8.631 11.4764 9.22282 11.5912 9.82 11.589C10.7456 11.589 11.6504 11.3145 12.4201 10.8003C13.1897 10.286 13.7895 9.55512 14.1438 8.69996C14.498 7.84481 14.5907 6.90381 14.4101 5.99598C14.2295 5.08815 13.7838 4.25426 13.1293 3.59975C12.4747 2.94524 11.6409 2.49951 10.733 2.31893C9.82519 2.13835 8.8842 2.23103 8.02904 2.58525C7.17388 2.93947 6.44297 3.53932 5.92872 4.30894C5.41448 5.07856 5.14 5.98339 5.14 6.90901ZM12.4832 5.95178C12.4832 6.84671 11.7577 7.57221 10.8628 7.57221C9.96785 7.57221 9.24236 6.84671 9.24236 5.95178C9.24236 5.05684 9.96785 4.33135 10.8628 4.33135C11.7577 4.33135 12.4832 5.05684 12.4832 5.95178Z" fill="#FF4013"/>
</svg>
`},97180:D=>{D.exports=`<svg id="Text_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_39432" width="16" height="16" fill="none"/><path id="Path_11304" d="M5.113,0H2.994V-8.23H.28V-9.994H7.827V-8.23H5.113Z" transform="translate(4 13)" fill="#ff4013"/></svg>
`},8510:D=>{D.exports=`<svg id="Time_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Ellipse_1346" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="7" cy="7" r="7" stroke="none"/><circle cx="7" cy="7" r="6" fill="none"/></g><path id="Path_6908" d="M1824.814,31.345v6h3" transform="translate(-1816.814 -29.345)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},64337:D=>{D.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 8H14" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 13.8375C9.38071 13.8375 10.5 11.2239 10.5 7.99998C10.5 4.77601 9.38071 2.16248 8 2.16248C6.61929 2.16248 5.5 4.77601 5.5 7.99998C5.5 11.2239 6.61929 13.8375 8 13.8375Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},73308:(D,X,m)=>{m.d(X,{A:()=>g});function y(E,i,M,R,P,v,L){try{var $=E[v](L),T=$.value}catch(ge){return void M(ge)}$.done?i(T):Promise.resolve(T).then(R,P)}function g(E){return function(){var i=this,M=arguments;return new Promise(function(R,P){var v=E.apply(i,M);function L(T){y(v,R,P,L,$,"next",T)}function $(T){y(v,R,P,L,$,"throw",T)}L(void 0)})}}}}]);
