(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[7712],{17712:(U,Ke,m)=>{m.r(Ke),m.d(Ke,{AddSummaryItemHandler:()=>q,AddSummaryItemRequest:()=>we,BaseSummaryItemColumnProvider:()=>Mn.U,BaseUpdateSummaryItemHandler:()=>N,CAN_MANAGE_SUMMARIES_LICENSE_OPERATION_CODE:()=>De.W,CreateSummaryItemHandler:()=>ne,CreateSummaryItemRequest:()=>He,CrtSummariesActionsDirective:()=>P,CrtSummariesComponent:()=>g,CrtSummariesPreprocessorsModule:()=>D,CrtSummariesRuntimeModule:()=>de,CrtSummaryItemComponent:()=>C,CrtSummaryItemEditDialogComponent:()=>Oe.E,CrtSummaryItemEditDialogModule:()=>x,CrtSummaryItemModule:()=>M,DeleteSummaryItemHandler:()=>re,DeleteSummaryItemRequest:()=>Ue,EditSummaryItemHandler:()=>te,EditSummaryItemRequest:()=>je,ExpandSummariesHandler:()=>ee,QUICK_SUMMARY_ITEM_CREATION_ACTION_FUNCTIONS_FACTORY:()=>Ve.n,QUICK_SUMMARY_ITEM_CREATION_ACTION_FUNCTIONS_FACTORY_PROVIDER:()=>Mt,QUICK_SUMMARY_ITEM_CREATION_ACTION_ICON_FACTORY_PROVIDER:()=>xt,QuickSummaryItemCreationActionsModule:()=>R,QuickSummaryItemCreationActionsProvider:()=>b,ResetSummariesHandler:()=>oe,ResetSummariesRequest:()=>$e,SUMMARY_ITEM_AVAILABLE_COLUMN_DATA_VALUE_TYPES:()=>le.p,SUMMARY_ITEM_NOT_AVAILABLE_COLUMN_PATHS:()=>le.b,SUMMARY_ITEM_VALUE_EXPRESSION_FUNCTION_LOCALIZATION_KEYS:()=>ht.I,SaveSummariesForAllHandler:()=>ce,SaveSummariesForAllRequest:()=>Le,SummaryItemColumnExplorer:()=>it.$,SummaryItemColumnProvider:()=>Et.t,SummaryItemEditingService:()=>Ee.x,SummaryItemExpressionMetadataCreator:()=>O,SummaryItemMetaSettingsCreator:()=>Re.A,SummaryItemSetupService:()=>Ae.G,UpdateSummaryItemValueAfterModelInsertHandler:()=>ae,UpdateSummaryItemValueAfterModelUpdateHandler:()=>ie,UpdateSummaryItemValueBeforeModelLoadHandler:()=>se,UpdateSummaryItemValueOnModelEventDeleteHandler:()=>me,UpdateSummaryItemValueRequest:()=>Be,createSummariesExpandedAttributeName:()=>xe,createSummaryItemLabel:()=>St.I,createSummaryItemLabelResourceKey:()=>F.tK,createSummaryItemModelAttributeName:()=>F.G0,createSummaryItemTargetAttributeName:()=>F.IZ,createSummaryItemValueAttributeName:()=>F.GE,generateSummariesName:()=>qe,generateSummaryItemName:()=>F.QG});var c=m(5960),S=m(67057),he=m(55642),f=m(79772),Y=m(37851),X=m(56484),ze=m(61148),r=m(22307),_=m(77592),We=m(1034),Je=m(96677),Ze=m(52793),Xe=m(68712),Tt=m(89422),Ot=m(39763),Vt=m(54653),Nt=m(84137);const Pt=["actionsMenuTrigger"];function bt(i,t){i&1&&r.\u0275\u0275elementContainer(0)}function Ft(i,t){if(i&1){const e=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementStart(1,"div",6,2),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275listener("menuOpened",function(){r.\u0275\u0275restoreView(e);const a=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(a.actionsOpened=!0)})("menuClosed",function(){r.\u0275\u0275restoreView(e);const a=r.\u0275\u0275nextContext();return a.actionsOpened=!1,r.\u0275\u0275resetView(a.focus())}),r.\u0275\u0275template(4,bt,1,0,"ng-container",7),r.\u0275\u0275elementEnd(),r.\u0275\u0275element(5,"crt-menu",8,3),r.\u0275\u0275elementContainerEnd()}if(i&2){const e=r.\u0275\u0275reference(6),n=r.\u0275\u0275nextContext(),a=r.\u0275\u0275reference(4);r.\u0275\u0275advance(),r.\u0275\u0275property("title",n.title)("crtMenuTriggerFor",e),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(3,5,"SummaryItem.AriaLabel")),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngTemplateOutlet",a),r.\u0275\u0275advance(),r.\u0275\u0275property("items",n.actions)}}function Dt(i,t){i&1&&r.\u0275\u0275elementContainer(0)}function wt(i,t){if(i&1&&(r.\u0275\u0275elementStart(0,"div",9),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275template(2,Dt,1,0,"ng-container",7),r.\u0275\u0275elementEnd()),i&2){const e=r.\u0275\u0275nextContext(),n=r.\u0275\u0275reference(4);r.\u0275\u0275property("title",e.title),r.\u0275\u0275attribute("aria-label",r.\u0275\u0275pipeBind1(1,4,"SummaryItem.AriaLabel"))("aria-disabled",e.readonly),r.\u0275\u0275advance(2),r.\u0275\u0275property("ngTemplateOutlet",n)}}function Ht(i,t){if(i&1&&(r.\u0275\u0275elementStart(0,"span",12),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),i&2){const e=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate1(" ",e.label,": ")}}function Ut(i,t){if(i&1&&(r.\u0275\u0275elementStart(0,"span",13),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),i&2){let e;const n=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275textInterpolate((e=n.value)!==null&&e!==void 0?e:"")}}function jt(i,t){if(i&1&&r.\u0275\u0275element(0,"mat-icon",14),i&2){const e=r.\u0275\u0275nextContext(2);r.\u0275\u0275property("crtTooltip",e.error)}}function Bt(i,t){if(i&1&&r.\u0275\u0275template(0,Ht,2,1,"span",10)(1,Ut,2,1,"span",11)(2,jt,1,1,"ng-template",null,4,r.\u0275\u0275templateRefExtractor),i&2){const e=r.\u0275\u0275reference(3),n=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",n.label),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.invalid)("ngIfElse",e)}}let C=class ye extends Xe.K{constructor(){super(...arguments),this._translateService=(0,r.inject)(f.TranslateService),this._errorLabel=this._translateService.instant("SummaryItem.Statuses.Error"),this.tabIndex=0,this.actionsOpened=!1,this.invalid=!1}set error(t){this._error=t,this.invalid=!!t,this.changeDetectorRef.markForCheck()}get error(){return this._error}set readonly(t){this._readonly=t,this.changeDetectorRef.markForCheck()}get readonly(){return this._readonly}get title(){const t=this.label?this.value||this.error?`${this.label}: `:this.label:"",e=this.invalid?`${this._errorLabel}. ${this.error}`:this.value??"";return t+e}onKeydown(t){(t.code===Tt.Key.Enter||t.code==="Space")&&this.actions?.length&&!this.readonly&&this._actionsMenuTrigger?.openMenu()}static{this.\u0275fac=(()=>{let t;return function(n){return(t||(t=r.\u0275\u0275getInheritedFactory(ye)))(n||ye)}})()}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:ye,selectors:[["crt-summary-item"]],viewQuery:function(e,n){if(e&1&&r.\u0275\u0275viewQuery(Pt,5),e&2){let a;r.\u0275\u0275queryRefresh(a=r.\u0275\u0275loadQuery())&&(n._actionsMenuTrigger=a.first)}},hostVars:7,hostBindings:function(e,n){e&1&&r.\u0275\u0275listener("keydown",function(s){return n.onKeydown(s)}),e&2&&(r.\u0275\u0275hostProperty("tabindex",n.tabIndex),r.\u0275\u0275classProp("crt-summary-item-readonly",n.readonly)("crt-summary-item-actions-opened",n.actionsOpened)("crt-summary-item-invalid",n.invalid))},inputs:{label:"label",value:"value",error:"error",actions:"actions",readonly:"readonly"},features:[r.\u0275\u0275InheritDefinitionFeature],decls:5,vars:2,consts:[["summaryItem",""],["summaryItemContent",""],["actionsMenuTrigger","crtMenuTrigger"],["actionsMenu",""],["errorIcon",""],[4,"ngIf","ngIfElse"],["role","button",1,"crt-summary-item",3,"menuOpened","menuClosed","title","crtMenuTriggerFor"],[4,"ngTemplateOutlet"],[3,"items"],["role","button",1,"crt-summary-item",3,"title"],["class","crt-summary-item-label",4,"ngIf"],["class","crt-summary-item-value",4,"ngIf","ngIfElse"],[1,"crt-summary-item-label"],[1,"crt-summary-item-value"],["svgIcon","info-icon","title","",1,"crt-summary-item-invalid-icon",3,"crtTooltip"]],template:function(e,n){if(e&1&&r.\u0275\u0275template(0,Ft,7,7,"ng-container",5)(1,wt,3,6,"ng-template",null,0,r.\u0275\u0275templateRefExtractor)(3,Bt,4,3,"ng-template",null,1,r.\u0275\u0275templateRefExtractor),e&2){const a=r.\u0275\u0275reference(2);r.\u0275\u0275property("ngIf",(n.actions==null?null:n.actions.length)&&!n.readonly)("ngIfElse",a)}},dependencies:[S.NgIf,S.NgTemplateOutlet,Ot.IK,Vt.O,Y.MatIcon,Nt.d,f.TranslatePipe],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]{flex-shrink:1;min-width:0}[_nghost-%COMP%]:not(.crt-summary-item-readonly):hover   .crt-summary-item[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):focus-visible   .crt-summary-item[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly).crt-summary-item-actions-opened   .crt-summary-item[_ngcontent-%COMP%]{background-color:var(--crt-palette-interaction-500)}[_nghost-%COMP%]:not(.crt-summary-item-readonly):hover   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):hover   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-value[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):focus-visible   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly):focus-visible   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-value[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly).crt-summary-item-actions-opened   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], [_nghost-%COMP%]:not(.crt-summary-item-readonly).crt-summary-item-actions-opened   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-value[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-A400)}.crt-summary-item-readonly[_nghost-%COMP%]   .crt-summary-item[_ngcontent-%COMP%]{cursor:default}[_nghost-%COMP%]:focus-visible{outline:none}[_nghost-%COMP%]:focus-visible   .crt-summary-item[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:9px}.crt-summary-item-invalid[_nghost-%COMP%]:hover   .crt-summary-item[_ngcontent-%COMP%], .crt-summary-item-invalid[_nghost-%COMP%]:focus-visible   .crt-summary-item[_ngcontent-%COMP%], .crt-summary-item-invalid.crt-summary-item-actions-opened[_nghost-%COMP%]   .crt-summary-item[_ngcontent-%COMP%]{background-color:var(--crt-palette-error-50)}.crt-summary-item-invalid[_nghost-%COMP%]:hover   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-invalid[_nghost-%COMP%]:focus-visible   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-invalid.crt-summary-item-actions-opened[_nghost-%COMP%]   .crt-summary-item[_ngcontent-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%]{color:var(--crt-palette-error-500)}.crt-summary-item-invalid[_nghost-%COMP%]   .crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-invalid[_nghost-%COMP%]   .crt-summary-item-invalid-icon[_ngcontent-%COMP%]{color:var(--crt-palette-error-500)}.crt-summary-item-invalid[_nghost-%COMP%]   .crt-summary-item-invalid-icon[_ngcontent-%COMP%]{width:16px;height:16px}.crt-summary-item[_ngcontent-%COMP%]{font-family:var(--crt-body-2-font-family);font-size:var(--crt-body-2-font-size);line-height:var(--crt-body-2-line-height);font-weight:var(--crt-body-2-font-weight);letter-spacing:var(--crt-body-2-letter-spacing);text-transform:var(--crt-body-2-text-transform);-webkit-font-smoothing:antialiased;height:18px;box-sizing:border-box;display:flex;border-radius:9px;padding:1px 8px;align-items:center;white-space:nowrap;cursor:pointer}.crt-summary-item-label[_ngcontent-%COMP%], .crt-summary-item-value[_ngcontent-%COMP%]{line-height:18px}.crt-summary-item-label[_ngcontent-%COMP%]{color:var(--crt-palette-label-500);padding-inline-end:4px;flex-shrink:1;min-width:0;overflow:hidden;text-overflow:ellipsis}.crt-summary-item-value[_ngcontent-%COMP%]{color:var(--crt-palette-secondary-500);font-weight:600}"],changeDetection:0})}};(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",String)],C.prototype,"label",void 0),(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",String)],C.prototype,"value",void 0),(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",String),(0,c.__metadata)("design:paramtypes",[String])],C.prototype,"error",null),(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",Array)],C.prototype,"actions",void 0),(0,c.__decorate)([(0,_.k)({defaultValue:!1}),(0,c.__metadata)("design:type",Boolean),(0,c.__metadata)("design:paramtypes",[Boolean])],C.prototype,"readonly",null),C=(0,c.__decorate)([(0,We.v)({type:"crt.SummaryItem",reuseStrategy:Je.B.Reuse}),(0,Ze.f)({designControlConfig:{selfSelect:!1},designViewItemCommands:{copy:"crt.CopySummaryItemCommand"}})],C);var Se=m(4164);let ge=class{_isEqualByModel(t,e){return"modelName"in t&&"modelName"in e&&t.modelName?t.modelName===e.modelName:!1}_isEqualByViewElement(t,e){return"viewElementName"in t&&"viewElementName"in e&&t.viewElementName?t.viewElementName===e.viewElementName:!1}convert(t,e,n){return!t||!n?!1:this._isEqualByViewElement(t,n)||this._isEqualByModel(t,n)}};ge=(0,c.__decorate)([(0,Se.a)({type:"crt.IsTargetSummaryItem"})],ge);var d=m(73308),$t=m(91775),Lt=m(65288),Qt=m(49638),K=m(62278),I=m(86464),T;(function(i){i.None="None",i.Count="Count",i.Sum="Sum",i.Avg="Avg",i.Min="Min",i.Max="Max",i.TopOne="TopOne"})(T||(T={}));var ve;(function(i){i.SysSetting="SysSetting",i.SysValue="SysValue",i.Parameter="Parameter",i.Record="Record",i.Collection="Collection",i.EsqAggregation="EsqAggregation"})(ve||(ve={}));var _e;(function(i){i.PowerFx="PowerFx"})(_e||(_e={}));const kt=new Map([["count",T.Count],["avg",T.Avg],["max",T.Max],["min",T.Min],["sum",T.Sum]]);class O{constructor(){this.collectionVariableName="SummaryItem"}_getColumnName(t,e){return e?t.name?`${e}${t.name}`:t.path?`${e}${t.path}`:t.name:t.name}_getAdjustedOptions(t){const e=(t?.columns??[]).filter(n=>!!n?.path).map(n=>this._getAdjustedColumn(n,t.function));return{...t,columns:e}}_getAdjustedColumn(t,e){return{...t,name:this._getColumnName(t,e)?.replace(/\./g,""),aggregationType:kt.get(e)}}_createExpression(t){const e=t.columns.map(n=>n.name).filter(Boolean);return!t.function||!e.length?"":`#${this.collectionVariableName}#.${e[0]}`}_createExpressionVariables(t){const{entitySchemaName:e,filters:n,columns:a,hierarchyConfig:s}=t??{},o=s?{...s,hierarchicalColumnFiltersValue:s.hierarchicalColumnFiltersValue?.toJson()}:void 0;return[{name:this.collectionVariableName,variableType:ve.EsqAggregation,dataValueType:I.r.CUSTOM_OBJECT,config:{value:e,columns:a,filters:n,hierarchy:o}}]}create(t){const e=this._getAdjustedOptions(t);if(!e.entitySchemaName)return null;const n=this._createExpression(e);return n?{engineType:_e.PowerFx,expression:n,expressionVariables:this._createExpressionVariables(e),parameters:[],resultDataValueType:t.resultDataValueType}:null}static{this.\u0275fac=function(e){return new(e||O)}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}let Ce=class{constructor(t,e){this._expressionMetadataCreator=t,this._entitySchemaQueryBuilder=e}_getModelFilters(t,e){const n={type:"crt.GetDataSourceLoadFiltersRequest",dataSourceName:t,$context:e};return $t.t.instance.process(n)}_getFiltersWithExcludeHierarchyFilters(t,e){return e.map(n=>n?.type!==Lt.E.Filter||!n?.value?n:t===n.value?null:n).filter(n=>!!n)}_getHierarchyWithFiltersConfig(t,e){var n=this;return(0,d.A)(function*(){const{options:a,parameters:s}=yield e.getDataSourceLoadParameters(t),o=a?.hierarchyConfig??null;if(!o)return{hierarchyConfig:o,excludedFilters:null};const u=o?.hierarchicalColumnFiltersValue,l=s?yield n._getFilters(t,e,u,s):null;return{hierarchyConfig:o,excludedFilters:l}})()}_getFilters(t,e,n,a){var s=this;return(0,d.A)(function*(){const o=s._getFiltersWithExcludeHierarchyFilters(n,a),u=e?.dataSchemas?.[t];return yield(0,K.lastValueFrom)(s._entitySchemaQueryBuilder.build(u,[],o).pipe((0,K.map)(l=>l.getMetadata().filters)))})()}_getEntitySchemaName(t,e){return e?.dataSchemas?.[t]?.dataSourceConfig?.config?.entitySchemaName}convert(t,e,n,a){var s=this;return(0,d.A)(function*(){if(!n||!a)return null;let o=yield s._getModelFilters(n,e);if(!o)return null;const{hierarchyConfig:u,excludedFilters:l}=yield s._getHierarchyWithFiltersConfig(n,e);return l&&(o=l),s._expressionMetadataCreator.create({entitySchemaName:s._getEntitySchemaName(n,e),filters:o,columns:a.columns,function:a.function,hierarchyConfig:u,resultDataValueType:a.resultDataValueType})})()}};Ce=(0,c.__decorate)([(0,Se.a)({type:"crt.SummaryItemToExpressionMetadata"}),(0,c.__metadata)("design:paramtypes",[O,Qt.O])],Ce);var z=m(41287),A=m(844),Ie=m(92009),Ae=m(91856);let q=class extends z.l{constructor(t,e){super(),this._schemaService=t,this._summaryItemSetupService=e}_getSummaryItemModelName(t){return this._schemaService.getViewConfigInfoByName(t)?.viewConfig?._designOptions?.modelName}_setupSummaryItem(t){const{summariesName:e}=t,n=this._getSummaryItemModelName(e);return n?this._summaryItemSetupService.setup(n):Promise.resolve(null)}_createSummaryItem(t,e){const{scopes:n,$context:a,summariesName:s}=t,{resources:o,viewConfig:u}=e,l={type:"crt.CreateSummaryItemRequest",scopes:n,$context:a,resources:o,summariesName:s,summaryItemViewConfig:u};return this.handlerChain.process(l)}handle(t){var e=this;return(0,d.A)(function*(){const n=yield e._setupSummaryItem(t);return n&&(yield e._createSummaryItem(t,n)),e.next?.handle(t)})()}};q=(0,c.__decorate)([(0,A.l)({type:"crt.AddSummaryItemHandler",requestType:"crt.AddSummaryItemRequest"}),(0,c.__metadata)("design:paramtypes",[Ie.R,Ae.G])],q);var Me=m(52439),h=m(59969);function Gt(i){return i?.name?.replace(/[^\w]/g,"")||qe()}function qe(){return h.$A.generateUnique("Summaries")}function xe(i){return`${Gt(i)}_Expanded`}let ee=class extends z.l{constructor(t){super(),this._schemaService=t}_getSummariesViewConfig(t){return this._schemaService.getViewConfigInfoByName(t)?.viewConfig}_getSummariesExpandedStateAttributeName(t){const{expanded:e}=t;return typeof e=="boolean"?null:(0,Me.qG)(e)?(0,Me.YK)(e).attributePath:xe(t)}handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,summariesName:s}=t;if(!s)return e.next?.handle(t);const o=e._getSummariesViewConfig(s);if(!o)return e.next?.handle(t);const u=e._getSummariesExpandedStateAttributeName(o);if(!u)return e.next?.handle(t);const l={type:"crt.ChangeViewModelAttributeValueRequest",scopes:n,$context:a,attributeName:u,attributeValue:!0};return yield e.handlerChain.process(l),e.next?.handle(t)})()}};ee=(0,c.__decorate)([(0,A.l)({type:"crt.ExpandSummariesHandler",requestType:"crt.CreateSummaryItemRequest"}),(0,c.__metadata)("design:paramtypes",[Ie.R])],ee);var et=m(40968),tt=m(22592),nt=m(99298),W=m(13111),V=m(28399),Ee=m(27286);class N extends z.l{updateSummaryItemValue(t,e,n){const a={type:"crt.UpdateSummaryItemValueRequest",scopes:e,$context:n,target:t};return this.handlerChain.process(a)}}let te=class extends N{constructor(t,e,n,a){super(),this._maskService=t,this._schemaPartsService=e,this._summaryItemEditingService=n,this._liveAnnouncementService=a}_editSummaryItem(t,e){var n=this;return(0,d.A)(function*(){let a=!1;const s=`PREPARE_EDITING_SUMMARY_ITEM_${t}`;return yield n._maskService.showMask(s,e),yield n._schemaPartsService.apply(function(){var o=(0,d.A)(function*([u,l]){const p=yield n._getSummaryItemMetaSettings(t,u,l);if(yield n._maskService.hideMask(s,e),!p?.viewConfig)return;const y=yield(0,K.firstValueFrom)(n._summaryItemEditingService.edit((0,V.cloneDeep)(p)));!y?.viewConfig||(0,V.isEqual)(p,y)||(a=!0,(0,V.assign)(p.viewConfig,y.viewConfig),yield l.upsertResources(y.resources))});return function(u){return o.apply(this,arguments)}}()),a&&(yield n._schemaPartsService.commit({silent:!1})),a})()}_getSummaryItemMetaSettings(t,e,n){return(0,d.A)(function*(){const a=e.getViewConfigInfoByName(t)?.viewConfig;return a?{resources:yield n.loadResources(),viewConfig:a}:null})()}handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,name:s}=t;return!s||!a||(yield e._editSummaryItem(s,a))&&(yield e.updateSummaryItemValue({viewElementName:s},n,a),yield e._liveAnnouncementService.announce("SummaryItem.Statuses.Edited")),e.next?.handle(t)})()}};te=(0,c.__decorate)([(0,A.l)({type:"crt.EditSummaryItemHandler",requestType:"crt.EditSummaryItemRequest"}),(0,c.__param)(0,(0,et.j)(nt.V)),(0,c.__metadata)("design:paramtypes",[tt.s,W.N,Ee.x,h.DW])],te);var Re=m(65878);let ne=class extends N{constructor(t,e,n){super(),this._schemaPartsService=t,this._liveAnnouncementService=e,this._summaryItemMetaSettingsCreator=n}_createSummaryItem(t,e){var n=this;return(0,d.A)(function*(){const{resources:a,viewConfig:s}=e;let o=!1;yield n._schemaPartsService.apply(function(){var u=(0,d.A)(function*([l,p]){const y=l.getViewConfigInfoByName(t)?.viewConfig;y&&(y.items??=[],y.items.push(s),a&&(yield p.upsertResources(a)),o=!0)});return function(l){return u.apply(this,arguments)}}()),yield n._schemaPartsService.commit({silent:!1}),o&&(yield n._liveAnnouncementService.announce("SummaryItem.Statuses.Added"))})()}_createSummaryItemMetaSettings(t){const{resources:e,summaryItemViewConfig:n,summaryItemCreationConfig:a}=t;return a?this._summaryItemMetaSettingsCreator.create(a):{resources:e,viewConfig:n}}handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,summariesName:s}=t,o=e._createSummaryItemMetaSettings(t),u=o?.viewConfig?.name;return u&&(yield e._createSummaryItem(s,o),yield e.updateSummaryItemValue({viewElementName:u},n,a)),e.next?.handle(t)})()}};ne=(0,c.__decorate)([(0,A.l)({type:"crt.CreateSummaryItemHandler",requestType:"crt.CreateSummaryItemRequest"}),(0,c.__metadata)("design:paramtypes",[W.N,h.DW,Re.A])],ne);let re=class extends z.l{constructor(t){super(),this._liveAnnouncementService=t}_deleteSummaryItem(t){const{scopes:e,$context:n,name:a}=t,s={type:"crt.RemoveViewElementRequest",scopes:e,$context:n,name:a};return this.handlerChain.process(s)}handle(t){var e=this;return(0,d.A)(function*(){yield e._deleteSummaryItem(t),yield e._liveAnnouncementService.announce("SummaryItem.Statuses.Deleted")})()}};re=(0,c.__decorate)([(0,A.l)({type:"crt.DeleteSummaryItemHandler",requestType:"crt.DeleteSummaryItemRequest"}),(0,c.__metadata)("design:paramtypes",[h.DW])],re);let ae=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,model:s}=t;if(s?.name){const o={modelName:s?.name};yield e.updateSummaryItemValue(o,n,a)}return e.next?.handle(t)})()}};ae=(0,c.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueAfterModelInsertHandler",requestType:"crt.HandleAfterModelInsertRequest"})],ae);let ie=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,model:s}=t;if(s?.name){const o={modelName:s?.name};yield e.updateSummaryItemValue(o,n,a)}return e.next?.handle(t)})()}};ie=(0,c.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueAfterModelUpdateHandler",requestType:"crt.HandleAfterModelUpdateRequest"})],ie);let se=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,model:s}=t;if(s?.name){const o={modelName:s?.name};yield e.updateSummaryItemValue(o,n,a)}return e.next?.handle(t)})()}};se=(0,c.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueBeforeModelLoadHandler",requestType:"crt.HandleBeforeModelLoadRequest"})],se);var Yt=m(85604);let me=class extends N{handle(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,modelEvent:s,modelName:o}=t;if(s?.type===Yt.M.Delete&&s?.payload?.primaryAttributesValues.length===1){const u={modelName:o};yield e.updateSummaryItemValue(u,n,a)}return e.next?.handle(t)})()}};me=(0,c.__decorate)([(0,A.l)({type:"crt.UpdateSummaryItemValueOnModelEventDeleteHandler",requestType:"crt.HandleModelEventRequest"})],me);var Te=m(31774),Kt=m(44462);class rt extends z.l{constructor(t){super(),this._messageDialogProvider=t}isActionConfirmed(){return(0,K.lastValueFrom)(this._messageDialogProvider.confirmation(this.confirmationDialogMessage),{defaultValue:null})}setSummariesItems(t,e,n){const a=this.getSummariesViewConfig(t,n);if(!a)return;const s=this.getSummariesViewConfig(t,e);a.items=s?.items??[],n.init(n.schema)}findSummaryItemsResources(t,e,n){const a=this.getSummariesViewConfig(t,n),s=Array.isArray(a.items)?a.items.map(u=>(0,Kt.kS)(u.label)):[],o=Object.entries(e.localizableStrings).filter(([u])=>s.includes(u));return{localizableStrings:Object.fromEntries((0,V.cloneDeep)(o)),localizableImages:{}}}getSummariesViewConfig(t,e){return e.getViewConfigInfoByName(t)?.viewConfig}handle(t){var e=this;return(0,d.A)(function*(){(yield e.isActionConfirmed())&&(yield e.innerHandle(t))})()}}let oe=class extends rt{constructor(t,e,n,a,s){super(t),this._liveAnnouncementService=e,this._maskService=n,this._schemaPartsService=a,this._schemaService=s,this.confirmationDialogMessage="ConfirmationDialog.ResetSummaries"}_getSummariesResources(t,e){var n=this;return(0,d.A)(function*(){const[a,s]=e,o=yield s.loadResources();return n.findSummaryItemsResources(t,o,a)})()}_cleanSummariesResources(t,e,n){var a=this;return(0,d.A)(function*(){const s=yield a._getSummariesResources(t,e),o=yield a._getSummariesResources(t,n);Object.keys(s.localizableStrings).forEach(l=>{const p=s.localizableStrings[l],y=o.localizableStrings[l];Object.keys(p).forEach(v=>{p[v]=y?.[v]})});const[,u]=e;yield u.upsertResources(s)})()}_resetSummaryItems(t){var e=this;return(0,d.A)(function*(){const{summariesName:n,$context:a}=t,s=`RESETTING_${n}_SUMMARIES`;e._maskService.showMask(s,a);const[o,u]=yield e._schemaPartsService.use("ALL_EMPLOYERS");yield e._schemaPartsService.apply(function(){var l=(0,d.A)(function*([p,y]){yield e._cleanSummariesResources(n,[p,y],[o,u]),e.setSummariesItems(n,o,p)});return function(p){return l.apply(this,arguments)}}(),"USER"),yield e._schemaPartsService.commit({silent:!1}),e._maskService.hideMask(s,a)})()}_updateSummaryItemsValue(t){var e=this;return(0,d.A)(function*(){const{scopes:n,$context:a,summariesName:s}=t,l=(e.getSummariesViewConfig(s,e._schemaService)?.items??[]).map(({name:p})=>e.handlerChain.process({type:"crt.UpdateSummaryItemValueRequest",scopes:n,$context:a,target:{viewElementName:p}}));yield Promise.all(l)})()}innerHandle(t){var e=this;return(0,d.A)(function*(){t.summariesName&&(yield e._resetSummaryItems(t),yield e._updateSummaryItemsValue(t),yield e._liveAnnouncementService.announce("Summaries.ProfileActions.ResetToDefaultSuccessfully"))})()}};oe=(0,c.__decorate)([(0,A.l)({type:"crt.ResetSummariesHandler",requestType:"crt.ResetSummariesRequest"}),(0,c.__param)(2,(0,et.j)(nt.V)),(0,c.__metadata)("design:paramtypes",[Te.r,h.DW,tt.s,W.N,Ie.R])],oe);var at=m(6503);let ce=class fe extends rt{constructor(t,e,n){super(t),this._schemaPartsService=e,this._notifyService=n,this.confirmationDialogMessage="ConfirmationDialog.SaveSummariesForAll"}_setAllEmployeePart(t,e,n){var a=this;return(0,d.A)(function*(){yield a._schemaPartsService.apply(function(){var s=(0,d.A)(function*([o,u]){a.setSummariesItems(t,e,o),yield u.upsertResources(n)});return function(o){return s.apply(this,arguments)}}(),"ALL_EMPLOYERS")})()}innerHandle(t){var e=this;return(0,d.A)(function*({summariesName:n}){if(!n)return;const[a,s]=yield e._schemaPartsService.use("USER"),o=yield s.loadResources(),u=e.findSummaryItemsResources(n,o,a);yield e._setAllEmployeePart(n,a,u),yield e._schemaPartsService.commit({silent:!1}),yield e._notifyService.show({message:"Summaries.ProfileActions.SaveForAllSuccessfully"})}).apply(this,arguments)}static{this.\u0275fac=function(e){return new(e||fe)(r.\u0275\u0275inject(Te.r),r.\u0275\u0275inject(W.N),r.\u0275\u0275inject(at.F))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac,providedIn:"root"})}};ce=(0,c.__decorate)([(0,A.l)({type:"crt.SaveSummariesForAllHandler",requestType:"crt.SaveSummariesForAllRequest"}),(0,c.__metadata)("design:paramtypes",[Te.r,W.N,at.F])],ce);var it=m(39482);let M=class Qe{static{this.\u0275fac=function(e){return new(e||Qe)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Qe})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[it.$,O,Re.A],imports:[S.CommonModule,ze.D,Y.MatIconModule,X.S,f.TranslateModule]})}};M=(0,c.__decorate)([(0,he.g)({converters:[ge,Ce],viewElements:[C],requestHandlers:[q,ee,te,ne,re,ae,ie,se,me,oe,ce]})],M),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(M,{declarations:[C],imports:[S.CommonModule,ze.D,Y.MatIconModule,X.S,f.TranslateModule],exports:[C]})}();var st=m(59247),mt=m(49281),ot=m(35314),ue=m(31149),ct=m(56069),ut=m(43981),lt=m(57274),Oe=m(83296);class x{static{this.\u0275fac=function(e){return new(e||x)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:x})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[S.CommonModule,ue.q,ct.r,ut.k,X.S,Y.MatIconModule,mt.MatInputModule,lt.u,f.TranslateModule,ot.y,st.ReactiveFormsModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(x,{declarations:[Oe.E],imports:[S.CommonModule,ue.q,ct.r,ut.k,X.S,Y.MatIconModule,mt.MatInputModule,lt.u,f.TranslateModule,ot.y,st.ReactiveFormsModule],exports:[Oe.E]})})();var dt=m(50663),pt=m(59649),yt=m(96176),ft=m(39202),zt=m(34760),Wt=m(10098);class P{static{this.\u0275fac=function(e){return new(e||P)}}static{this.\u0275dir=r.\u0275\u0275defineDirective({type:P,selectors:[["","crtSummariesActions",""]]})}}var Jt=m(13232),Zt=m(71983),Xt=m(12577),qt=m(5475),en=m(30491);const tn=i=>({"aria-expanded":i});function nn(i,t){if(i&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementContainer(1,9),r.\u0275\u0275elementContainerEnd()),i&2){const e=t.$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("crtViewElement",e)}}function rn(i,t){if(i&1){const e=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"crt-button",11),r.\u0275\u0275pipe(1,"translate"),r.\u0275\u0275listener("clicked",function(){r.\u0275\u0275restoreView(e);const a=r.\u0275\u0275nextContext(3);return r.\u0275\u0275resetView(a.toggleExpansionState())}),r.\u0275\u0275elementEnd()}if(i&2){const e=r.\u0275\u0275nextContext(3);r.\u0275\u0275property("attributes",r.\u0275\u0275pureFunction1(5,tn,e.expanded))("icon",e.expanded?"summaries-expansion-indicator-expanded":"summaries-expansion-indicator-collapsed")("title",r.\u0275\u0275pipeBind1(1,3,e.expanded?"Summaries.Hints.Collapse":"Summaries.Hints.Expand"))}}function an(i,t){if(i&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275template(1,rn,2,7,"crt-button",10),r.\u0275\u0275elementContainerEnd()),i&2){const e=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",e.hasHidden)}}function sn(i,t){if(i&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275elementContainer(1,9),r.\u0275\u0275elementContainerEnd()),i&2){const e=t.$implicit;r.\u0275\u0275advance(),r.\u0275\u0275property("crtViewElement",e)}}function mn(i,t){if(i&1&&(r.\u0275\u0275elementStart(0,"div",12),r.\u0275\u0275template(1,sn,2,1,"ng-container",13),r.\u0275\u0275elementEnd()),i&2){const e=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngForOf",e.wrappedItems)("ngForTrackBy",e.trackByFn)}}function on(i,t){if(i&1){const e=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",4)(1,"crt-adaptive-container",5),r.\u0275\u0275listener("visibilityStateChange",function(a){r.\u0275\u0275restoreView(e);const s=r.\u0275\u0275nextContext();return r.\u0275\u0275resetView(s.onVisibilityStateChange(a))}),r.\u0275\u0275template(2,nn,2,1,"ng-container",6)(3,an,2,1,"ng-container",7),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(4,mn,2,2,"div",8),r.\u0275\u0275elementEnd()}if(i&2){const e=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("wrap",!1)("items",e.renderedItems)("trackByFn",e.trackByFn)("getItemsByElements",e.getItemsByElements),r.\u0275\u0275advance(3),r.\u0275\u0275property("ngIf",e.expanded)}}function cn(i,t){i&1&&r.\u0275\u0275elementContainer(0)}function un(i,t){if(i&1&&(r.\u0275\u0275elementContainerStart(0),r.\u0275\u0275element(1,"crt-button",14),r.\u0275\u0275pipe(2,"translate"),r.\u0275\u0275pipe(3,"translate"),r.\u0275\u0275elementContainerEnd()),i&2){const e=r.\u0275\u0275nextContext();r.\u0275\u0275advance(),r.\u0275\u0275property("title",r.\u0275\u0275pipeBind1(2,5,e.title||"Summaries.Actions.Title"))("caption",e.items!=null&&e.items.length?"":r.\u0275\u0275pipeBind1(3,7,"Summaries.Caption"))("iconPosition",e.items!=null&&e.items.length?"only-icon":"left-icon")("menuItems",e.actions)("disabled",e.disabled)}}let g=class ke extends Xe.K{set items(t){this._items=(t||[]).filter(e=>e?.type==="crt.SummaryItem"),this._setRenderedItems()}get items(){return this._items}set expanded(t){t!=null&&(this._expanded=!!t)}get expanded(){return this._expanded}constructor(t){super(t),this.injector=t,this._visibleItems={},this._expanded=!0,this.renderedItems=[],this.wrappedItems=[],this.hasHidden=!0,this.expandedChange=new r.EventEmitter}_setRenderedItems(){const t=this._items.map(e=>({...e,value:this._visibleItems[e.name]?e.value:void 0}));(0,V.isEqual)(t,this.renderedItems)||(this.renderedItems=t,this.changeDetectorRef.detectChanges())}_setLoadedItems(t){Array.from(t).map(n=>n?.getAttribute&&n.getAttribute("element-name")).filter(Boolean).forEach(n=>{const a=this.items.find(s=>s.name===n);a&&(this._visibleItems[a.name]=a)})}_setWrappedItems(t){this.wrappedItems=this.getItemsByElements(this.items,t),this.changeDetectorRef.detectChanges()}trackByFn(t,e){return e.name+e.value+e.label}onVisibilityStateChange(t){this.hasHidden=!!t.hiddenItems.length,this._setLoadedItems(t.visibleItems),this._setRenderedItems(),this._setWrappedItems(t.hiddenItems)}toggleExpansionState(){this.expandedChange.emit(!this.expanded),this.changeDetectorRef.detectChanges()}getItemsByElements(t,e){return!t||!e?[]:e.map(a=>a?.getAttribute&&a.getAttribute("element-name")).map(a=>t?.find(s=>s.name===a)).filter(Boolean)}static{this.\u0275fac=function(e){return new(e||ke)(r.\u0275\u0275directiveInject(r.Injector))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:ke,selectors:[["crt-summaries"]],contentQueries:function(e,n,a){if(e&1&&r.\u0275\u0275contentQuery(a,P,5,r.TemplateRef),e&2){let s;r.\u0275\u0275queryRefresh(s=r.\u0275\u0275loadQuery())&&(n.summariesActionsTemplate=s.first)}},inputs:{items:"items",actions:"actions",expanded:"expanded",title:"title",disabled:"disabled",readonly:"readonly"},outputs:{expandedChange:"expandedChange"},features:[r.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[[1,"crt-summaries"],["class","crt-summaries-list",4,"ngIf"],[4,"ngTemplateOutlet"],[4,"ngIf"],[1,"crt-summaries-list"],["justifyContent","end",3,"visibilityStateChange","wrap","items","trackByFn","getItemsByElements"],[4,"crtAdaptiveContainerItem"],[4,"crtAdaptiveContainerSuffix"],["class","crt-summaries-wrapped-items",4,"ngIf"],[3,"crtViewElement"],["iconPosition","only-icon","displayType","text","size","small","class","crt-summaries-expansion-indicator",3,"attributes","icon","title","clicked",4,"ngIf"],["iconPosition","only-icon","displayType","text","size","small",1,"crt-summaries-expansion-indicator",3,"clicked","attributes","icon","title"],[1,"crt-summaries-wrapped-items"],[4,"ngFor","ngForOf","ngForTrackBy"],["size","small","icon","sum-icon","clickMode","menu","displayType","text",1,"crt-summaries-actions",3,"title","caption","iconPosition","menuItems","disabled"]],template:function(e,n){e&1&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275template(1,on,5,5,"div",1)(2,cn,1,0,"ng-container",2)(3,un,4,9,"ng-container",3),r.\u0275\u0275elementEnd()),e&2&&(r.\u0275\u0275classProp("crt-summaries-with-hidden",n.hasHidden),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",n.items==null?null:n.items.length),r.\u0275\u0275advance(),r.\u0275\u0275property("ngTemplateOutlet",n.summariesActionsTemplate),r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",!n.summariesActionsTemplate&&!n.readonly))},dependencies:[S.NgForOf,S.NgIf,S.NgTemplateOutlet,Jt.B,Zt.u,Xt.V,qt.t,en.H,f.TranslatePipe],styles:["[_nghost-%COMP%]{flex-shrink:1;min-width:0}.crt-summaries[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:2px}.crt-summaries-list[_ngcontent-%COMP%]{min-width:0}.crt-summaries-wrapped-items[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:flex-end}.crt-summaries-expansion-indicator[_ngcontent-%COMP%]{margin-inline-start:2px}"],changeDetection:0})}};(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",Array),(0,c.__metadata)("design:paramtypes",[Array])],g.prototype,"items",null),(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",Array)],g.prototype,"actions",void 0),(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",Boolean),(0,c.__metadata)("design:paramtypes",[Boolean])],g.prototype,"expanded",null),(0,c.__decorate)([(0,_.k)(),(0,c.__metadata)("design:type",String)],g.prototype,"title",void 0),(0,c.__decorate)([(0,_.k)({defaultValue:!1}),(0,c.__metadata)("design:type",Boolean)],g.prototype,"disabled",void 0),(0,c.__decorate)([(0,_.k)({defaultValue:!1}),(0,c.__metadata)("design:type",Boolean)],g.prototype,"readonly",void 0),(0,c.__decorate)([(0,zt.j)(),(0,c.__metadata)("design:type",r.EventEmitter)],g.prototype,"expandedChange",void 0),g=(0,c.__decorate)([(0,We.v)({type:"crt.Summaries",reuseStrategy:Je.B.Reuse}),(0,Ze.f)({typeCaption:"Components.Summaries.Caption",viewElementGroupType:Wt.J.Components,toolbarConfig:{position:190,icon:m(93616),defaultPropertyValues:{items:[]}},designControlConfig:{allowDesignContent:!0},designViewItemCommands:{copy:"crt.CopySummariesCommand"},propertiesPanelComponentTypeName:"crt.SummariesPropertiesPanel",collectionPropertyNames:["items"]}),(0,c.__metadata)("design:paramtypes",[r.Injector])],g);var ln=m(21832),dn=m(73335),pn=m(42936),le=m(99056),ht=m(57984),St=m(29134),Ve=m(14716);const gt=new r.InjectionToken("Represents a factory for creating functions of summary item creation action"),yn=2,Ne=9,fn=[dn.D.OwnAttribute],hn=[I.r.Guid];class b{constructor(t,e,n){this._translateService=t,this._quickSummaryItemActionIconFactory=e,this._quickSummaryItemActionFunctionsFactory=n}_toExpressionColumn(t){return{type:pn.d.Column,path:t.path}}_getPrimaryDataSchemaAttributes(t){return t.getPrimaryAttributesNames().map(e=>(t?.attributes??[]).find(n=>n?.name===e)).filter(e=>e?.path)}_getAvailableDataSchemaAttributesGroups(t,e){const n=this._getAvailableDataSchemaAttributes(t);if(!n.length)return[];if(n.length<=yn)return[n];const a=this._getDefinedDataSchemaAttributes(e,n);if(a.length===Ne)return[a];const s=n.filter(o=>!a.some(u=>o.name===u.name)).slice(0,Ne-a.length);return[a,s].filter(o=>o.length)}_getAvailableDataSchemaAttributes(t){return(t?.attributes??[]).filter(e=>e?.caption&&fn.includes(e?.attributeType)&&!hn.includes(e?.dataValueType)&&!le.b.includes(e?.path)&&le.p.includes(e?.dataValueType)).sort((e,n)=>e.caption?.localeCompare(n.caption))}_getDefinedDataSchemaAttributes(t,e){const n=t?.isCollection?t?.attributes?.map(a=>a?.path).filter(Boolean)??[]:[];return e.filter(a=>n.includes(a.name)).slice(0,Ne)}_createCountQuickSummaryItemAction(t){const e=t.map(n=>this._toExpressionColumn(n));return e.length?{name:"Count",icon:"formula-icon",caption:this._translateService.instant("Summaries.Actions.CreateCount"),summaryItemOptions:{label:this._translateService.instant("Summaries.QuickSummaries.Count"),expression:{function:"count",columns:e,resultDataValueType:I.r.Integer}}}:null}_createQuickSummaryItemActionByAttribute(t){const{name:e,caption:n,dataValueType:a}=t??{},s=this._quickSummaryItemActionIconFactory.create(a),o=this._quickSummaryItemActionFunctionsFactory.create(a)??[];return{name:e,icon:s,caption:n,actions:o.map(u=>this._createQuickSummaryItemActionByFunction(t,u))}}_createQuickSummaryItemActionByFunction(t,e){const n=this._translateService.instant(ht.I[e]);return{name:`${t.name}_${e}`,icon:"formula-icon",caption:n,summaryItemOptions:{label:(0,St.I)(t.caption,n),expression:{function:e,columns:[this._toExpressionColumn(t)],resultDataValueType:t.dataValueType}}}}getActionsGroups(t,e){if(!t||!e)return[];const n=this._getPrimaryDataSchemaAttributes(t),a=this._getAvailableDataSchemaAttributesGroups(t,e),s=this._createCountQuickSummaryItemAction(n),o=a.map(u=>u.map(l=>this._createQuickSummaryItemActionByAttribute(l)));return s?o.length?(o[0].unshift(s),o):[[s]]:o}static{this.\u0275fac=function(e){return new(e||b)(r.\u0275\u0275inject(f.TranslateService),r.\u0275\u0275inject(gt),r.\u0275\u0275inject(Ve.n))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac})}}const Pe={type:"crt.MenuDivider"},Sn="CanCreateDefaultSummariesSettings";let be=class{constructor(t,e,n){this._rightsService=t,this._translateService=e,this._quickSummaryItemCreationActionsProvider=n}_getProfileActions(t){var e=this;return(0,d.A)(function*(){if(!t)return[];const n=[{type:"crt.MenuItem",caption:e._translateService.instant("Summaries.ProfileActions.ResetToDefault"),icon:"reset-summaries",clicked:{request:"crt.ResetSummariesRequest",params:{summariesName:t}}}];return(yield e._rightsService.getCanExecuteOperation(Sn))&&n.unshift({type:"crt.MenuItem",caption:e._translateService.instant("Summaries.ProfileActions.SaveForAll"),icon:"save",clicked:{request:"crt.SaveSummariesForAllRequest",params:{summariesName:t}}}),n})()}_createQuickSummaryItemMenuItemsSection(t,e,n){var a=this;return(0,d.A)(function*(){if(!t||!e)return[];const s=n.getModelByName(e),o=n._dataSourcesInfos.get(e);if(!s||!o)return[];const u=yield(0,K.lastValueFrom)(s.getSchema()),l=a._quickSummaryItemCreationActionsProvider.getActionsGroups(u,o),p=l?.flat()?.length,y=l.map(v=>a._createQuickSummaryItemMenuItems(t,v,e)).filter(v=>v?.length).map((v,Z,pe)=>Z===pe.length-1?v:[...v,Pe]).flat();return p?[{type:"crt.MenuLabel",caption:a._translateService.instant("Summaries.QuickSummaries.QuickSetup")},...y,Pe]:[]})()}_createQuickSummaryItemMenuItems(t,e,n){return e?.length?e.map(a=>this._createQuickSummaryItemMenuItem(t,a,n)).filter(Boolean):[]}_createQuickSummaryItemMenuItem(t,e,n){return e?.actions?.length?this._createQuickSummaryItemMenuSubMenuItem(t,e,n):this._createQuickSummaryItemMenuActionItem(t,e,n)}_createQuickSummaryItemMenuSubMenuItem(t,e,n){const{name:a,icon:s,caption:o,actions:u}=e;return{type:"crt.MenuItem",name:`${t}_Create_${a}`,icon:s,caption:o,items:this._createQuickSummaryItemMenuItems(t,u,n)}}_createQuickSummaryItemMenuActionItem(t,e,n){const{name:a,icon:s,caption:o,summaryItemOptions:{label:u,expression:l}={}}=e;return{type:"crt.MenuItem",name:`${t}_Create_${a}`,icon:s,caption:o,clicked:{request:"crt.CreateSummaryItemRequest",params:{summaryItemCreationConfig:{label:u,expression:l,modelName:n},summariesName:t}}}}_createAdvancedSetupActions(t){return t?[{type:"crt.MenuLabel",caption:this._translateService.instant("Summaries.AdvancedSetup.Title")},{type:"crt.MenuItem",name:`${t}_AddCustomSummary`,icon:"add-button-icon",caption:this._translateService.instant("Summaries.AdvancedSetup.Actions.AddCustomSummary"),clicked:{request:"crt.AddSummaryItemRequest",params:{summariesName:t}}},Pe]:[]}convert(t,e,n,a){var s=this;return(0,d.A)(function*(){const o=yield s._getProfileActions(n),u=yield s._createQuickSummaryItemMenuItemsSection(n,a,e),l=s._createAdvancedSetupActions(n);return[...u,...l,...o]})()}};be=(0,c.__decorate)([(0,Se.a)({type:"crt.ToSummariesActionsAsync"}),(0,c.__metadata)("design:paramtypes",[ln.f,f.TranslateService,b])],be);let E=class Ge{constructor(t){this._materialIconsRegistrar=t,this._materialIconsRegistrar.addIcons([{name:"summaries-expansion-indicator-expanded",icon:m(25608)},{name:"summaries-expansion-indicator-collapsed",icon:m(69303)}])}static{this.\u0275fac=function(e){return new(e||Ge)(r.\u0275\u0275inject(dt.K))}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Ge})}static{this.\u0275inj=r.\u0275\u0275defineInjector({imports:[S.CommonModule,ue.q,pt.Z,yt.c,ft.a,f.TranslateModule]})}};E=(0,c.__decorate)([(0,he.g)({viewElements:[g],converters:[be]}),(0,c.__metadata)("design:paramtypes",[dt.K])],E),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(E,{declarations:[g,P],imports:[S.CommonModule,ue.q,pt.Z,yt.c,ft.a,f.TranslateModule],exports:[g,P]})}();var Fe=m(31376),gn=m(12841);class j extends h.NS{constructor(t){super(),this._translateService=t}handle(t){const e=t?.viewConfig;return e?e._designOptions?.modelName?super.handle(t):(typeof e.title=="string"||(e.title=this._translateService.instant("Summaries.Hints.NoDataSource")),typeof e.disabled=="boolean"||(0,Me.qG)(e.disabled)||(e.disabled=!0),super.handle(t)):super.handle(t)}static{this.\u0275fac=function(e){return new(e||j)(r.\u0275\u0275inject(f.TranslateService))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac})}}var vn=m(71281);class B extends h.NS{constructor(t){super(),this._profileAttributeService=t}handle(t){const{metadata:e,viewConfig:n}=t??{};return!e||!n?.name?super.handle(t):typeof n.expanded=="boolean"?super.handle(t):(this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,n,"expanded",xe(n)),super.handle(t))}static{this.\u0275fac=function(e){return new(e||B)(r.\u0275\u0275inject(vn.H))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:B,factory:B.\u0275fac})}}var vt=m(86710),_t=m(26594),De=m(43139);class $ extends h.NS{constructor(t,e){super(),this._featureValues=t,this._licenseOperationValues=e}handle(t){const e=t?.viewConfig,n=this._licenseOperationValues[De.W];return this._featureValues.DisableSummariesRestrictionsPreprocessing||n||!e?super.handle(t):(e.readonly=!0,super.handle(t))}static{this.\u0275fac=function(e){return new(e||$)(r.\u0275\u0275inject(_t.G),r.\u0275\u0275inject(vt.W))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac})}}var _n=m(74368);class L extends h.NS{constructor(t){super(),this._metadataSchemaUtils=t}_canBindSummariesActions(t){const{viewConfig:e,metadata:n}=t;return e?.name&&e.actions==null&&e.readonly!==!0&&n!=null}_bindSummariesActionsToAttribute(t){const{metadata:e,viewConfig:n}=t,a=e.viewModelConfig.attributes,s=n.name,o=n._designOptions?.modelName,u=`${s}_Actions`,l=this._metadataSchemaUtils.findAllAttributesByDataSourceAttributePath(e,o)??[];a[u]={converter:`crt.ToSummariesActionsAsync : '${s}' : '${o}'`,triggers:l.map(p=>({request:"crt.HandleViewModelAttributeChangeRequest",filter:`crt.ToObjectProp : 'attributeName' | crt.IsEqual : '${p}'`}))},n.actions=`$${u}`}handle(t){return this._canBindSummariesActions(t)&&this._bindSummariesActionsToAttribute(t),super.handle(t)}static{this.\u0275fac=function(e){return new(e||L)(r.\u0275\u0275inject(_n.u))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:L,factory:L.\u0275fac})}}class Q extends h.NS{constructor(t,e){super(),this._featureValues=t,this._licenseOperationValues=e}handle(t){const e=t?.viewConfig,n=this._licenseOperationValues[De.W];return this._featureValues.DisableSummariesRestrictionsPreprocessing||n||!e?super.handle(t):(e.readonly=!0,super.handle(t))}static{this.\u0275fac=function(e){return new(e||Q)(r.\u0275\u0275inject(_t.G),r.\u0275\u0275inject(vt.W))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:Q,factory:Q.\u0275fac})}}var F=m(98305);const Ct=new r.InjectionToken("Represents a factory for creating summary item value format");class k extends h.NS{constructor(t){super(),this._valueFormatFactory=t}_isValidValueOptions(t){return!!(t?.attribute&&t?.modelName&&t?.expression?.function&&t?.expression?.columns)}handle(t){const{metadata:e,viewConfig:n}=t??{};if(!e||!n?.name||n.value!==void 0)return super.handle(t);const a=n._designOptions?.value;if(!this._isValidValueOptions(a))return super.handle(t);const{attribute:s,expression:o,modelName:u}=a,l=(0,F.IZ)(n),p=(0,F.G0)(n),y=o.resultDataValueType??I.r.Text,v=`${a.attribute}_Format`,Z=`${a.attribute}_ExecutionResult`,pe=`${a.attribute}_ExecutionError`,Rt=`${a.attribute}_ExpressionOptions`;return n.value=`$${s}`,n.error=`$${pe}`,e.viewModelConfig??={},e.viewModelConfig.attributes={...e.viewModelConfig.attributes??{},[Z]:{converter:`crt.SummaryItemToExpressionMetadata : $${p} : $${Rt} | crt.ToExpressionResult`,triggers:[{request:"crt.UpdateSummaryItemValueRequest",filter:`crt.ToObjectProp : 'target' | crt.IsTargetSummaryItem : $${l}`}],triggersOptions:{debounce:100}},[pe]:{from:Z,converter:"crt.ToObjectProp: 'errorInfo' | crt.ToObjectProp: 'message'"},[s]:{from:Z,converter:`crt.ToObjectProp: 'result' | crt.FormatValue : $${v} | crt.ToEmptyPlaceholder : ${y}`},[v]:{value:this._valueFormatFactory.create(y)},[Rt]:{value:{...o,resultDataValueType:y}},[p]:{value:u},[l]:{value:{modelName:u,viewElementName:n.name}}},super.handle(t)}static{this.\u0275fac=function(e){return new(e||k)(r.\u0275\u0275inject(Ct))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac})}}class G extends h.NS{constructor(t){super(),this._translateService=t}handle(t){const e=t?.viewConfig;return!e?.name||e.actions||e.readonly===!0?super.handle(t):(e.actions=[{type:"crt.MenuItem",name:`${e.name}_EditAction`,caption:this._translateService.instant("SummaryItem.Actions.Edit"),icon:"pen",clicked:{request:"crt.EditSummaryItemRequest",params:{name:e.name}}},{type:"crt.MenuItem",name:`${e.name}_DeleteAction`,caption:this._translateService.instant("SummaryItem.Actions.Delete"),icon:"delete-button-icon",clicked:{request:"crt.DeleteSummaryItemRequest",params:{name:e.name}}}],super.handle(t))}static{this.\u0275fac=function(e){return new(e||G)(r.\u0275\u0275inject(f.TranslateService))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac})}}var Cn=m(60030);const It=new r.InjectionToken("Represents a handler to process summaries metadata on metadata init"),At=new r.InjectionToken("Represents a handler to process summary item metadata on metadata init");class J extends Cn.X{constructor(t,e){super(),this._summariesOnMetadataInitHandler=t,this._summaryItemOnMetadataInitHandler=e}_removeSummaryItemsWithoutParent(t){t.viewConfig=(t?.viewConfig||[]).filter(e=>e.type!=="crt.SummaryItem")}crtOnMetaDataInit(t){var e=this;return(0,d.A)(function*(){const n=t;return e._removeSummaryItemsWithoutParent(n),e._summariesOnMetadataInitHandler&&(yield e.processElementsOnMetadataInit("crt.Summaries",e._summariesOnMetadataInitHandler,n)),e._summaryItemOnMetadataInitHandler&&(yield e.processElementsOnMetadataInit("crt.SummaryItem",e._summaryItemOnMetadataInitHandler,n)),Promise.resolve(t)})()}static{this.\u0275fac=function(e){return new(e||J)(r.\u0275\u0275inject(It,8),r.\u0275\u0275inject(At,8))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}var In=m(34143);const Mt=h.gX.create({token:Ve.n,mappings:[{predicate:i=>Fe.D.includes(i),useValue:["sum","avg","max","min"]},{predicate:i=>In.i.includes(i),useValue:["max","min"]},{predicate:i=>i===I.r.Guid,useValue:["count"]}],default:{useValue:[]}}),xt=h.gX.create({token:gt,mappings:[{predicate:I.r.Integer,useValue:"number-integer"},{predicate:i=>(0,V.without)(Fe.D,I.r.Integer).includes(i),useValue:"number-decimal"},{predicate:I.r.Date,useValue:"date"},{predicate:I.r.Time,useValue:"time"},{predicate:I.r.DateTime,useValue:"date-time"}],default:{useValue:"formula-icon"}});class R{static{this.\u0275fac=function(e){return new(e||R)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:R})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[b,xt,Mt]})}}const An=h.gX.create({token:Ct,mappings:[{predicate:i=>(0,V.without)(Fe.D,I.r.Money).includes(i),useFactory:i=>({dataType:i,trimTrailingZeros:!0})}],default:{useFactory:i=>({dataType:i})}});class D{static{this.\u0275fac=function(e){return new(e||D)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:D})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[{provide:gn.m,useClass:J,multi:!0},{provide:It,useFactory:t=>{const e=t.get(j);return e.setNext(t.get(B)).setNext(t.get($)).setNext(t.get(L)),e},deps:[r.Injector]},{provide:At,useFactory:t=>{const e=t.get(Q);return e.setNext(t.get(k)).setNext(t.get(G)),e},deps:[r.Injector]},L,B,j,G,k,$,Q,An],imports:[R]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(D,{imports:[R]})})();var Et=m(3022);let de=class Ye{static{this.\u0275fac=function(e){return new(e||Ye)}}static{this.\u0275mod=r.\u0275\u0275defineNgModule({type:Ye})}static{this.\u0275inj=r.\u0275\u0275defineInjector({providers:[Et.t,Ee.x,Ae.G],imports:[S.CommonModule,R,E,M,x,D,f.TranslateModule,E,M,x]})}};de=(0,c.__decorate)([(0,he.g)({includes:[E,M]})],de),function(){(typeof ngJitMode>"u"||ngJitMode)&&r.\u0275\u0275setNgModuleScope(de,{imports:[S.CommonModule,R,E,M,x,D,f.TranslateModule],exports:[E,M,x]})}();var w=m(81517),H=m(2828);let we=class extends w.S{constructor(){super(...arguments),this.type="crt.AddSummaryItemRequest"}};we=(0,c.__decorate)([(0,H.$)({type:"crt.AddSummaryItemRequest"})],we);let He=class extends w.S{constructor(){super(...arguments),this.type="crt.CreateSummaryItemRequest"}};He=(0,c.__decorate)([(0,H.$)({type:"crt.CreateSummaryItemRequest"})],He);let Ue=class extends w.S{constructor(){super(...arguments),this.type="crt.DeleteSummaryItemRequest"}};Ue=(0,c.__decorate)([(0,H.$)({type:"crt.DeleteSummaryItemRequest"})],Ue);let je=class extends w.S{constructor(){super(...arguments),this.type="crt.EditSummaryItemRequest"}};je=(0,c.__decorate)([(0,H.$)({type:"crt.EditSummaryItemRequest"})],je);let Be=class extends w.S{constructor(){super(...arguments),this.type="crt.UpdateSummaryItemValueRequest"}};Be=(0,c.__decorate)([(0,H.$)({type:"crt.UpdateSummaryItemValueRequest"})],Be);let $e=class extends w.S{constructor(){super(...arguments),this.type="crt.ResetSummariesRequest"}};$e=(0,c.__decorate)([(0,H.$)({type:"crt.ResetSummariesRequest"})],$e);let Le=class extends w.S{constructor(){super(...arguments),this.type="crt.SaveSummariesForAllRequest"}};Le=(0,c.__decorate)([(0,H.$)({type:"crt.SaveSummariesForAllRequest"})],Le);var Mn=m(32020)},69303:U=>{U.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M3.27572 5.27844C3.64335 4.90719 4.2394 4.90719 4.60703 5.27844L8 8.70489L11.393 5.27844C11.7606 4.90719 12.3566 4.90719 12.7243 5.27844C13.0919 5.6497 13.0919 6.25163 12.7243 6.62289L8.66565 10.7216C8.29802 11.0928 7.70198 11.0928 7.33435 10.7216L3.27572 6.62289C2.90809 6.25163 2.90809 5.6497 3.27572 5.27844Z" fill="currentColor"/>\r
</svg>\r
`},25608:U=>{U.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.33435 5.27844C7.70198 4.90719 8.29802 4.90719 8.66565 5.27844L12.7243 9.37711C13.0919 9.74837 13.0919 10.3503 12.7243 10.7216C12.3566 11.0928 11.7606 11.0928 11.393 10.7216L8 7.29511L4.60703 10.7216C4.2394 11.0928 3.64335 11.0928 3.27572 10.7216C2.90809 10.3503 2.90809 9.74837 3.27572 9.37711L7.33435 5.27844Z" fill="currentColor"/>\r
</svg>\r
`},93616:U=>{U.exports=`<svg width="71" height="62" viewBox="0 0 71 62" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="6.46143" y="23.5" width="20.8433" height="6" rx="3" fill="#CCDEFC"/>\r
<rect x="30.3047" y="23.5" width="15.0966" height="6" rx="3" fill="#CCDEFC"/>\r
<rect x="11.3577" y="32.5" width="12.9471" height="6" rx="3" fill="#CCDEFC"/>\r
<rect x="27.3047" y="32.5" width="18.0966" height="6" rx="3" fill="#CCDEFC"/>\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M49.5246 22.9091C49.7444 22.4312 50.2223 22.125 50.7483 22.125H62.5777C63.2202 22.125 63.8363 22.3802 64.2906 22.8345C64.7449 23.2888 65.0001 23.9049 65.0001 24.5473V26.6981C65.0001 27.442 64.397 28.0451 63.6531 28.0451C62.9092 28.0451 62.3062 27.442 62.3062 26.6981V24.8189H53.6769L58.2234 30.1232C58.6558 30.6276 58.6558 31.3719 58.2234 31.8763L53.6769 37.1806H62.3062V35.3014C62.3062 34.5575 62.9092 33.9544 63.6531 33.9544C64.397 33.9544 65.0001 34.5575 65.0001 35.3014V37.4522C65.0001 38.0946 64.7449 38.7107 64.2906 39.165C63.8363 39.6193 63.2202 39.8745 62.5777 39.8745H50.7483C50.2223 39.8745 49.7444 39.5683 49.5246 39.0904C49.3048 38.6125 49.3833 38.0504 49.7257 37.651L55.4267 30.9998L49.7257 24.3485C49.3833 23.9491 49.3048 23.387 49.5246 22.9091Z" fill="#004FD6"/>\r
</svg>\r
`}}]);
