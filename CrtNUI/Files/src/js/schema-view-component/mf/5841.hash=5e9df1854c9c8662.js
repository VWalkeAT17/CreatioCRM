(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[5841],{90262:(G,A,e)=>{e.d(A,{G:()=>p});var n=e(27075),i=e.n(n),s=e(64511),r=e.n(s),t=e(22307),y=e.n(t),m=e(59247),u=e.n(m),_=e(66459),l=e.n(_),E=e(82944),b=e(67057),F=e.n(b),I=e(49393),S=e.n(I);function U(g,O){if(g&1&&(t.\u0275\u0275elementStart(0,"div",5),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),g&2){const x=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(x.title)}}function o(g,O){if(g&1&&(t.\u0275\u0275elementStart(0,"div",6),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),g&2){const x=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(x.description)}}class p extends E.F{set default(O){this.value=O}get default(){return this.value}constructor(O,x,M){super(O,x,M),this.controlType="crt-slide-toggle",this.useDefaultWidth=!1,this.labelPosition="before",this.toggleChange=new t.EventEmitter}valueChanged(O){this.innerValue=O.checked,this.toggleChange.emit(O)}static{this.\u0275fac=function(x){return new(x||p)(t.\u0275\u0275directiveInject(m.NgControl,10),t.\u0275\u0275directiveInject(s.AutofillMonitor),t.\u0275\u0275directiveInject(n.FocusMonitor))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:p,selectors:[["crt-slide-toggle"]],inputs:{title:"title",description:"description",useDefaultWidth:"useDefaultWidth",labelPosition:"labelPosition",default:"default"},outputs:{toggleChange:"toggleChange"},features:[t.\u0275\u0275ProvidersFeature([{provide:_.MatFormFieldControl,useExisting:p}]),t.\u0275\u0275InheritDefinitionFeature],decls:5,vars:8,consts:[["input",""],[1,"slide-wrapper",3,"change","ngClass","disabled","checked","labelPosition"],[1,"slide-content"],["class","slide-title",4,"ngIf"],["class","slide-description",4,"ngIf"],[1,"slide-title"],[1,"slide-description"]],template:function(x,M){if(x&1){const B=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"mat-slide-toggle",1,0),t.\u0275\u0275listener("change",function(D){return t.\u0275\u0275restoreView(B),t.\u0275\u0275resetView(M.valueChanged(D))}),t.\u0275\u0275elementStart(2,"div",2),t.\u0275\u0275template(3,U,2,1,"div",3)(4,o,2,1,"div",4),t.\u0275\u0275elementEnd()()}x&2&&(t.\u0275\u0275classProp("slide-toggle-default-width",M.useDefaultWidth),t.\u0275\u0275property("ngClass","slide-toggle-label-position--"+M.labelPosition)("disabled",M.disabled)("checked",M.innerValue)("labelPosition",M.labelPosition),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",M.title),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",M.description))},dependencies:[b.NgClass,b.NgIf,I.MatSlideToggle],styles:[`.slide-wrapper.slide-toggle-default-width{width:100%;max-width:400px}.slide-wrapper.slide-toggle-default-width .mdc-form-field{width:100%;justify-content:space-between}.slide-wrapper.slide-toggle-default-width .mdc-form-field .mdc-label{margin-left:0}.slide-wrapper.slide-toggle-default-width.slide-toggle-label-position--before .mdc-form-field .mdc-switch{margin-right:0}
`],encapsulation:2})}}},30306:(G,A,e)=>{e.d(A,{E:()=>E});var n=e(5960),i=e.n(n),s=e(1034),r=e(96677),t=e(68712),y=e(22307),m=e.n(y),u=e(58433);const _=()=>({height:"52px"}),l=()=>({height:"32px",width:"100px","margin-right":"8px"});let E=class Te extends t.K{static{this.\u0275fac=(()=>{let F;return function(S){return(F||(F=y.\u0275\u0275getInheritedFactory(Te)))(S||Te)}})()}static{this.\u0275cmp=y.\u0275\u0275defineComponent({type:Te,selectors:[["crt-base-message-composer-skeleton"]],features:[y.\u0275\u0275InheritDefinitionFeature],decls:3,vars:4,consts:[[1,"message-composer-skeleton-container"],["appearance","line","count","1",1,"message-composer-skeleton-container-body",3,"styles"],["appearance","line","count","2",1,"message-composer-skeleton-container-buttons",3,"styles"]],template:function(I,S){I&1&&(y.\u0275\u0275elementStart(0,"div",0),y.\u0275\u0275element(1,"crt-skeleton-loader",1)(2,"crt-skeleton-loader",2),y.\u0275\u0275elementEnd()),I&2&&(y.\u0275\u0275advance(),y.\u0275\u0275property("styles",y.\u0275\u0275pureFunction0(2,_)),y.\u0275\u0275advance(),y.\u0275\u0275property("styles",y.\u0275\u0275pureFunction0(3,l)))},dependencies:[u.W],styles:[".message-composer-skeleton-container-body[_ngcontent-%COMP%]{margin:5px 0}.message-composer-skeleton-container-buttons[_ngcontent-%COMP%]{justify-content:space-between;text-align:end}"]})}};E=(0,n.__decorate)([(0,s.v)({type:"crt.BaseMessageComposerSkeleton",reuseStrategy:r.B.Reuse})],E)},58551:(G,A,e)=>{e.d(A,{l:()=>L});var n=e(5960),i=e.n(n),s=e(22307),r=e.n(s),t=e(59247),y=e.n(t),m=e(50825),u=e.n(m),_=e(6530),l=e(77592),E=e(34760),b=e(1034),F=e(96677),I=e(79772),S=e.n(I),U=e(59969),o=e(95145),p=e(73270),g=e(54918),O=e(31774),x=e(2122),M=e(26594),B=e(85040),T=e(83455),D=e(48534),f=e(41314),H=e(28399),Y=e.n(H),q=e(62278),re=e.n(q),ce=e(36486),d=e.n(ce),h=e(29957),c=e.n(h),C=e(86190),j=e(67057),Q=e.n(j),ae=e(13232),pe=e(37851),ue=e.n(pe),Ee=e(45093),te=e(66459),de=e.n(te),W=e(54327),Z=e(78027),k=e(59834);const se=["crtRichTextInput"],ne=["attachUploadElement"],me=["baseMessageComposerWrap"],Me=z=>({"extendable-message-composer":z});function Ie(z,v){if(z&1&&(s.\u0275\u0275elementStart(0,"div",22),s.\u0275\u0275element(1,"img",23),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275pipe(3,"bypassSecurityTrust"),s.\u0275\u0275elementEnd()),z&2){const $=s.\u0275\u0275nextContext().$implicit,K=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate2("alt","",s.\u0275\u0275pipeBind1(2,4,"MessageComposer.AttachmentPreview"),": ",$.file.name,""),s.\u0275\u0275property("src",s.\u0275\u0275pipeBind2(3,6,K.getFilePreview($),"resourceUrl"),s.\u0275\u0275sanitizeUrl)}}function Oe(z,v){if(z&1&&s.\u0275\u0275element(0,"mat-icon",24),z&2){const $=s.\u0275\u0275nextContext().$implicit,K=s.\u0275\u0275nextContext();s.\u0275\u0275property("svgIcon",K.getFileIcon($.file.name))}}function Ce(z,v){if(z&1){const $=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",16),s.\u0275\u0275template(1,Ie,4,9,"div",17)(2,Oe,1,1,"mat-icon",18),s.\u0275\u0275elementStart(3,"span",19),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(5,"span",20),s.\u0275\u0275text(6),s.\u0275\u0275pipe(7,"memoryFormat"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"mat-icon",21),s.\u0275\u0275pipe(9,"translate"),s.\u0275\u0275pipe(10,"translate"),s.\u0275\u0275listener("click",function(){const w=s.\u0275\u0275restoreView($).$implicit,ee=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(ee.onRemoveAttachClick(w.id))})("keydown.enter",function(){const w=s.\u0275\u0275restoreView($).$implicit,ee=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(ee.onRemoveAttachClick(w.id))}),s.\u0275\u0275elementEnd()()}if(z&2){const $=v.$implicit,K=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",K.canShowPreview($)),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",!K.canShowPreview($)),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate($.file.name),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(7,7,$.file.size||$.size)),s.\u0275\u0275advance(2),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(9,9,"MessageComposer.RemoveAttachmentHint")),s.\u0275\u0275attribute("aria-label",s.\u0275\u0275pipeBind1(10,11,"MessageComposer.RemoveAttachmentHint"))("aria-hidden",!1)}}function X(z,v){z&1&&s.\u0275\u0275elementContainer(0)}function le(z,v){if(z&1&&(s.\u0275\u0275elementStart(0,"div"),s.\u0275\u0275template(1,X,1,0,"ng-container",11),s.\u0275\u0275elementEnd()),z&2){const $=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",$.channelSelector)}}function a(z,v){z&1&&s.\u0275\u0275elementContainer(0)}function P(z,v){if(z&1){const $=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",25),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView($);const w=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(w.onCancelClick())}),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd()}z&2&&(s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(1,2,"MessageComposer.CancelButtonHint")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(3,4,"MessageComposer.CancelButtonText")," "))}function R(z,v){if(z&1){const $=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"crt-button",26),s.\u0275\u0275pipe(1,"translate"),s.\u0275\u0275listener("clicked",function(){s.\u0275\u0275restoreView($);const w=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(w.onSaveDraftClick())}),s.\u0275\u0275text(2),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275elementEnd()}z&2&&(s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(1,2,"MessageComposer.SaveDraftButtonText")),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(3,4,"MessageComposer.SaveDraftButtonText")," "))}let L=class Be{set height(v){v&&(this._height=v+"px")}set dataCachingService(v){this._dataCachingService=v}get dataCachingService(){return(0,H.isEmpty)(this._dataCachingService)&&(this._dataCachingService=this._injector.get(C.$)),this._dataCachingService}constructor(v,$,K,w,ee,ie,ge,he,fe){this._injector=v,this._fileService=$,this._fileIconService=K,this._richTextEditorUploadService=w,this._sysSettingsService=ee,this._changeDetectorRef=ie,this._messageDialogProvider=ge,this._copilotToEditorCommunicationService=he,this._liveAnnouncementService=fe,this._publishMessageHotKeys=["ctrl+enter","command+enter"],this._publishKeyboardAction="publishMessage",this._bytesInMegabyte=1024*1024,this._setCacheDraftDataDebounce=300,this._filterExtensions="",this._disableFileSecurityMode="9801c625-fafb-4ed3-9383-c3c942a5c1e3",this._denyFileSecurityMode="60849c6e-24b4-45df-9aad-2f69d419823c",this._fileSecurityMode=this._denyFileSecurityMode,this._maxFileSize=0,this.keyboardHotkeysMap={keydown:{[this._publishKeyboardAction]:{sequence:this._publishMessageHotKeys}}},this.inputControl=new t.FormControl(null),this.attachments=[],this.disabled=!1,this.sendingButtonDisabled=!1,this.footerPanelExpanded=!1,this.selectionChange=new s.EventEmitter,this.footerPanelIndent=0,this.useTemplates=!1,this.useDrafts=!1,this.discardBtnVisible=!1,this.maxAttachmentsSize=0,this.messageChangesCancel=new s.EventEmitter,this.composerCleared=new s.EventEmitter,this.messageInputFocus=new s.EventEmitter,this.messageInputBlur=new s.EventEmitter,this.messageInputClick=new s.EventEmitter,this.messageChanged=new s.EventEmitter,this.messagePublish=new s.EventEmitter,this.selectTemplate=new s.EventEmitter,this.attachmentAdded=new s.EventEmitter,this.saveDraft=new s.EventEmitter,this.newMention=new s.EventEmitter,this._snackBar=v.get(m.MatSnackBar),this._translateService=v.get(I.TranslateService),this._featureValues=v.get(M.G);const ve="FileExtensionsDenyList",Pe="FileExtensionsAllowList";this._sysSettingsService.getByCodes(["FileSecurityMode","MaxFileSize",ve,Pe]).subscribe(De=>{if(De?.success&&(this._maxFileSize=De.values.MaxFileSize?.value||0,this._fileSecurityMode=De.values.FileSecurityMode?.value.toLowerCase()||this._denyFileSecurityMode,this._fileSecurityMode!==this._disableFileSecurityMode)){const be=this._fileSecurityMode===this._denyFileSecurityMode?ve:Pe;this._filterExtensions=De.values[be]?.value||""}})}get extendableMessageComposer(){return this._featureValues.ExtendableMessageComposer}_blurCurrentElement(){document.activeElement.blur()}_isContentTypeString(v){return v?.byteLength===void 0}_convertToBase64String(v){return this._isContentTypeString(v)?v:(0,f.M6)(v)}_cacheInputMessage(){if((0,H.isEmpty)(this.inputControl?.value))this.dataCachingService.remove(this.composerCacheCode);else try{this.dataCachingService.set(this.composerCacheCode,this.inputControl.value)}catch(v){console.error(v),this.dataCachingService.remove(this.composerCacheCode)}}_setCacheDraftData(v){if((0,H.isEmpty)(v))return;const $=this.dataCachingService.get(v)??"";if(!(0,H.isEmpty)($)){const K=this.inputControl?.value??"";if(K.includes($))return;this.inputControl.setValue($+K)}}_waitScrollEnd(){return new Promise(v=>{const $=this.baseMessageComposerWrap?.nativeElement;if(!$){v(!0);return}const K=new IntersectionObserver(w=>{const[ee]=w;ee.isIntersecting&&(K?.unobserve($),v(!0))});K.observe($)})}_getOversizeAttachmentsErrorMessage(v){v=v.reverse();const $=this._translateService.instant("InfoDialog.FileUpload.MaxFileSizeExceededExceptionMessage"),K=`\r
\r
`,w=this._translateService.instant("InfoDialog.FileUpload.FileListHeader"),ee=$+K+w+`:\r
{1}`;let ie="";return ie+=(0,h.formatString)(ee,this._maxFileSize,v.map(ge=>"- "+ge).join(`\r
`)),ie+=K,ie+=this._translateService.instant("InfoDialog.FileUpload.ChangeFileSizeInfoMessage"),ie}_getExtensionAttachmentsErrorMessage(v){const $=(0,H.groupBy)(v,he=>he.name.split(".").pop().toLowerCase()),K=this._fileSecurityMode===this._denyFileSecurityMode?"InvalidExtension.Deny":"InvalidExtension.Allow",w=this._translateService.instant("InfoDialog.FileUpload."+K),ee=`\r
\r
`,ie=this._translateService.instant("InfoDialog.FileUpload.FileListHeader");let ge="";for(const he in $)if(Object.prototype.hasOwnProperty.call($,he)){const fe=$[he];let ve=(0,h.formatString)(w+ee+ie+`:\r
`,he);fe.forEach(Pe=>{ve+="- "+Pe.name+`\r
`}),ge+=ve+`\r
`}return ge}_isFileExtensionAllowed(v){if(this._fileSecurityMode===this._disableFileSecurityMode)return!0;const $=v.name.split(".").pop().toLowerCase(),K=this._filterExtensions.toLowerCase();return this._fileSecurityMode===this._denyFileSecurityMode?K.indexOf($)===-1:K.indexOf($)>=0}_validateAttachmentsSize(v){if(this.maxAttachmentsSize<=0)return!0;let $=0;this.attachments.forEach(w=>$+=w.size?w.size:w.file.size);for(const w in v)if(Object.prototype.hasOwnProperty.call(v,w)){const ee=v[w].size;ee&&($+=ee)}const K=$/this._bytesInMegabyte<=this.maxAttachmentsSize;if(!K){const w=(0,h.formatString)(this._translateService.instant("MessageComposer.Email.AttachmentsSizeLimitReached"),this.maxAttachmentsSize);this._messageDialogProvider.error(w)}return K}_removeCopilotHighlighting(){this._copilotToEditorCommunicationService?.notify({editorAction:B.u.RemoveHighlighting})}showSnackbar(v){this._snackBar.openFromComponent(v,{duration:3e3,panelClass:"message-action-snackbar-container"})}onMessageInputBlur(){this._cacheInputMessage(),this.messageInputBlur.emit()}onMessageInputFocus(){this.disabled||this.messageInputFocus.emit()}onMessagePublish(){this._removeCopilotHighlighting(),this.messagePublish.emit()}focus(){this.disabled||(this.footerPanelExpanded=!0,this._waitScrollEnd().then(()=>{this.crtRichTextInput?.focus(),this.messageInputFocus.emit()}))}onInputClick(){this.disabled||(this.footerPanelExpanded=!0,this.messageInputClick.emit())}onHotKeyPressed({action:v,event:$}){v===this._publishKeyboardAction&&!this.sendingButtonDisabled&&($.preventDefault(),this._blurCurrentElement(),this.onMessagePublish())}onCancelClick(){this._messageDialogProvider.confirmation("CanDiscardUnsavedData.Default.Message").subscribe(v=>{v&&(this.clear(),this.messageChangesCancel.emit())})}onSaveDraftClick(){this._removeCopilotHighlighting(),this.dataCachingService.remove(this.composerCacheCode),this.saveDraft.emit()}onRichTextFilesUploaded(v){const $=v.map(({file:K,fileId:w})=>(K.id=w,K));this.uploadFiles({target:{files:$}})}uploadFiles({target:v}){if(!this._validateAttachmentsSize(v.files))return;const $=[],K=[],w=Array.from(v.files).map(ie=>this._maxFileSize>0&&ie.size/this._bytesInMegabyte>=this._maxFileSize?($.push(ie.name),(0,q.of)(!0)):this._isFileExtensionAllowed(ie)?this._fileService.read(ie).pipe((0,ce.switchMap)(fe=>(fe.id=(0,H.isEmpty)(ie.id)?(0,_.qv)():ie.id,this.attachments.some(ve=>ve.file.id===fe.id)||(this.attachments=[...this.attachments,fe]),this._changeDetectorRef.markForCheck(),(0,q.of)(!0)))):(K.push(ie),(0,q.of)(!0)));let ee="";K.length>0&&(ee+=this._getExtensionAttachmentsErrorMessage(K)),$.length>0?ee+=this._getOversizeAttachmentsErrorMessage($):(0,H.isEmpty)(ee)||(ee=ee.slice(0,-4)),(0,H.isEmpty)(ee)||this._messageDialogProvider.error(ee),v.value="",(0,q.forkJoin)(w).subscribe(()=>{this.attachmentAdded.emit(),this._liveAnnouncementService.announce("MessageComposer.Attachment.Added"),this._changeDetectorRef.markForCheck()})}onRemoveAttachClick(v){this.attachments=this.attachments.filter($=>$.id!==v),this.crtRichTextInput.removeReadyToUploadFile(v),this._liveAnnouncementService.announce("MessageComposer.Attachment.Removed"),this._changeDetectorRef.markForCheck()}onMessageChanged(){this.messageChanged.emit()}clear(){this.crtRichTextInput?.focus(),this.dataCachingService.remove(this.composerCacheCode),this.inputControl.setValue(""),this.crtRichTextInput?.clearSelection(),this.attachments.forEach(v=>this.crtRichTextInput.removeReadyToUploadFile(v.id)),this.attachments=[],this._blurCurrentElement(),this._changeDetectorRef.markForCheck(),this.composerCleared.emit()}getValue(){return this.inputControl.value}setValue(v){this.inputControl.setValue(v)}onSelectAttachments(){this.attachUploadElement.nativeElement.click()}canShowPreview(v){return this._featureValues.ShowAttachmentsPreview?(this._isContentTypeString(v.content)?v.content!=="":v.content.byteLength>0)&&this.getFileIcon(v.file.name).startsWith(p.k.IMAGE):!1}getFilePreview(v){return this.canShowPreview(v)?`data:${v.file.type};base64,${this._convertToBase64String(v.content)}`:""}getFileIcon(v){return this._fileIconService.getFileIcon(v,"large")}saveInlineImagesToDb(v){return this._richTextEditorUploadService.uploadImages([this.crtRichTextInput.currentEditor],v).pipe((0,ce.last)())}onSelectTemplate(){this.selectTemplate.emit()}onBeforeUnload(){this.crtRichTextInput?.isFocused&&this._cacheInputMessage()}isValueEmpty(){return(0,H.isEmpty)(this.inputControl.value)}isDiscardBtnVisible(){return this.discardBtnVisible||!this.isValueEmpty()}onNewMention(v){this.newMention.next(v)}ngOnChanges(v){const $=v.composerCacheCode?.currentValue;(0,H.debounce)(()=>this._setCacheDraftData($),this._setCacheDraftDataDebounce)()}onSelectionChange(v){this.selectionChange.next(v)}static{this.\u0275fac=function($){return new($||Be)(s.\u0275\u0275directiveInject(s.Injector),s.\u0275\u0275directiveInject(T.d),s.\u0275\u0275directiveInject(g.H),s.\u0275\u0275directiveInject(x.H),s.\u0275\u0275directiveInject(o.A),s.\u0275\u0275directiveInject(s.ChangeDetectorRef),s.\u0275\u0275directiveInject(O.r),s.\u0275\u0275directiveInject(D.i),s.\u0275\u0275directiveInject(U.DW))}}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Be,selectors:[["crt-base-message-composer"]],viewQuery:function($,K){if($&1&&(s.\u0275\u0275viewQuery(se,5),s.\u0275\u0275viewQuery(ne,5),s.\u0275\u0275viewQuery(me,5)),$&2){let w;s.\u0275\u0275queryRefresh(w=s.\u0275\u0275loadQuery())&&(K.crtRichTextInput=w.first),s.\u0275\u0275queryRefresh(w=s.\u0275\u0275loadQuery())&&(K.attachUploadElement=w.first),s.\u0275\u0275queryRefresh(w=s.\u0275\u0275loadQuery())&&(K.baseMessageComposerWrap=w.first)}},hostVars:2,hostBindings:function($,K){$&1&&s.\u0275\u0275listener("beforeunload",function(){return K.onBeforeUnload()},!1,s.\u0275\u0275resolveWindow),$&2&&s.\u0275\u0275styleProp("--height",K._height)},inputs:{disabled:"disabled",sendingButtonDisabled:"sendingButtonDisabled",footerPanelExpanded:"footerPanelExpanded",footerPanelOptions:"footerPanelOptions",channelSelector:"channelSelector",selectionActions:"selectionActions",disableSelectionOptions:"disableSelectionOptions",footerPanelIndent:"footerPanelIndent",inputPlaceHolder:"inputPlaceHolder",useTemplates:"useTemplates",useDrafts:"useDrafts",composerCacheCode:"composerCacheCode",discardBtnVisible:"discardBtnVisible",sendButtonIcon:"sendButtonIcon",maxAttachmentsSize:"maxAttachmentsSize",mentionsService:"mentionsService",height:"height",dataCachingService:"dataCachingService"},outputs:{selectionChange:"selectionChange",messageChangesCancel:"messageChangesCancel",composerCleared:"composerCleared",messageInputFocus:"messageInputFocus",messageInputBlur:"messageInputBlur",messageInputClick:"messageInputClick",messageChanged:"messageChanged",messagePublish:"messagePublish",selectTemplate:"selectTemplate",attachmentAdded:"attachmentAdded",saveDraft:"saveDraft",newMention:"newMention"},features:[s.\u0275\u0275NgOnChangesFeature],decls:20,vars:32,consts:[["baseMessageComposerWrap",""],["crtRichTextInput",""],["attachUploadElement",""],[1,"base-message-composer"],[1,"base-message-composer-input"],["labelPosition","hidden","data-qa","base-message-composer-text-input",1,"base-message-composer-input-field",3,"editorBlur","editorFocus","editorValueChanged","crtKeyboardHotkeyPressed","click","selectAttachments","selectTemplate","newMention","filesUploaded","selectionChange","crtKeyboardHotkeys","control","showClip","useTemplates","readonly","placeholder","mentionsService","useBodyFilesLinks","selectionActions","disableSelectionOptions","label"],[1,"message-composer-attachments"],["role","group","class","message-composer-attachment",4,"ngFor","ngForOf"],["data-qa","base-message-composer-footer",1,"base-message-composer-footer",3,"hidden","ngClass"],["type","file","multiple","",2,"display","none",3,"change"],[4,"ngIf"],[4,"ngTemplateOutlet"],[1,"base-message-composer-footer-actions"],["alt","discard","color","default","size","large","class","base-message-composer-footer-actions-button","data-qa","base-message-composer-cancel-btn",3,"title","clicked",4,"ngIf"],["alt","save draft","color","default","size","large","class","base-message-composer-footer-actions-button","data-qa","base-message-composer-save-draft-btn",3,"title","clicked",4,"ngIf"],["alt","send","color","accent","size","large","iconPosition","left-icon","data-qa","base-message-composer-submit-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title","icon","disabled"],["role","group",1,"message-composer-attachment"],["class","message-composer-attachment-icon",4,"ngIf"],["matSuffix","","class","message-composer-attachment-icon",3,"svgIcon",4,"ngIf"],[1,"message-composer-attachment-name"],[1,"message-composer-attachment-size"],["tabindex","0","role","button","svgIcon","message-composer-attach-cross","data-qa","message-composer-attachment-remove-icon",1,"message-composer-attachment-remove-icon",3,"click","keydown.enter","title"],[1,"message-composer-attachment-icon"],[3,"src","alt"],["matSuffix","",1,"message-composer-attachment-icon",3,"svgIcon"],["alt","discard","color","default","size","large","data-qa","base-message-composer-cancel-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title"],["alt","save draft","color","default","size","large","data-qa","base-message-composer-save-draft-btn",1,"base-message-composer-footer-actions-button",3,"clicked","title"]],template:function($,K){if($&1){const w=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",3)(1,"div",4,0)(3,"crt-rich-text-editor",5,1),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275listener("editorBlur",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onMessageInputBlur())})("editorFocus",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onMessageInputFocus())})("editorValueChanged",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onMessageChanged())})("crtKeyboardHotkeyPressed",function(ie){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onHotKeyPressed(ie))})("click",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onInputClick())})("selectAttachments",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onSelectAttachments())})("selectTemplate",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onSelectTemplate())})("newMention",function(ie){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onNewMention(ie))})("filesUploaded",function(ie){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onRichTextFilesUploaded(ie))})("selectionChange",function(ie){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onSelectionChange(ie))}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(6,"div",6),s.\u0275\u0275template(7,Ce,11,13,"div",7),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(8,"div",8)(9,"input",9,2),s.\u0275\u0275listener("change",function(ie){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.uploadFiles(ie))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(11,le,2,1,"div",10)(12,a,1,0,"ng-container",11),s.\u0275\u0275elementStart(13,"div",12),s.\u0275\u0275template(14,P,4,6,"crt-button",13)(15,R,4,6,"crt-button",14),s.\u0275\u0275elementStart(16,"crt-button",15),s.\u0275\u0275pipe(17,"translate"),s.\u0275\u0275listener("clicked",function(){return s.\u0275\u0275restoreView(w),s.\u0275\u0275resetView(K.onMessagePublish())}),s.\u0275\u0275text(18),s.\u0275\u0275pipe(19,"translate"),s.\u0275\u0275elementEnd()()()()}$&2&&(s.\u0275\u0275advance(3),s.\u0275\u0275property("crtKeyboardHotkeys",K.keyboardHotkeysMap)("control",K.inputControl)("showClip",!0)("useTemplates",K.useTemplates)("readonly",K.disabled)("placeholder",K.inputPlaceHolder)("mentionsService",K.mentionsService)("useBodyFilesLinks",!1)("selectionActions",K.selectionActions)("disableSelectionOptions",K.disableSelectionOptions)("label",s.\u0275\u0275pipeBind1(5,24,"MessageComposer.ComposerAreaLabel")),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngForOf",K.attachments),s.\u0275\u0275advance(),s.\u0275\u0275styleProp("margin-inline-start",K.footerPanelIndent,"px"),s.\u0275\u0275property("hidden",!K.footerPanelExpanded)("ngClass",s.\u0275\u0275pureFunction1(30,Me,K.extendableMessageComposer)),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngIf",K.extendableMessageComposer),s.\u0275\u0275advance(),s.\u0275\u0275property("ngTemplateOutlet",K.footerPanelOptions),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",K.isDiscardBtnVisible()),s.\u0275\u0275advance(),s.\u0275\u0275property("ngIf",K.useDrafts&&!K.isValueEmpty()),s.\u0275\u0275advance(),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(17,26,"MessageComposer.SendButtonHint")),s.\u0275\u0275property("icon",K.sendButtonIcon)("disabled",K.sendingButtonDisabled),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1("",s.\u0275\u0275pipeBind1(19,28,"MessageComposer.SendButtonText")," "))},dependencies:[j.NgClass,j.NgForOf,j.NgIf,j.NgTemplateOutlet,ae.B,pe.MatIcon,Ee.R,te.MatSuffix,W.h,Z.v,k.l,I.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.base-message-composer{position:relative}.base-message-composer-footer{margin-top:7px;display:flex;justify-content:flex-end;align-items:center}.base-message-composer-footer.extendable-message-composer{justify-content:space-between}.base-message-composer-footer[hidden]{display:none;height:0px}.base-message-composer-footer-actions{display:flex}.base-message-composer-footer-actions .base-message-composer-footer-actions-button .crt-button.button-size-large{border-radius:4px;margin-inline-start:8px}.base-message-composer-input{display:flex}.base-message-composer-input-field{width:100%;margin-inline-start:0}.base-message-composer-input-field .crt-input,.base-message-composer-input-field .crt-input-control{padding-inline-end:0!important}.base-message-composer-input-field .rich-editor-wrapper{min-height:48px;border:1px solid var(--crt-palette-border-500);border-radius:8px}.base-message-composer-input-field .rich-editor-wrapper:hover,.base-message-composer-input-field .rich-editor-wrapper:focus-within{border:1px solid var(--crt-palette-primary-500)}.base-message-composer-input-field .rich-editor-wrapper [data-cke-editorplaceholder]:before{max-width:calc(100% - 44px)}.base-message-composer-input-field .rich-editor-wrapper .cke_editable{line-height:20px;padding-inline-start:16px;padding-top:16px;padding-bottom:16px;width:calc(100% - 22px);height:var(--height, unset)}.base-message-composer .message-composer-attachments{display:flex;flex-wrap:wrap;font-family:var(--crt-caption-font-family);font-size:var(--crt-caption-font-size);line-height:var(--crt-caption-line-height);font-weight:var(--crt-caption-font-weight);letter-spacing:var(--crt-caption-letter-spacing);text-transform:var(--crt-caption-text-transform);-webkit-font-smoothing:antialiased}.base-message-composer .message-composer-attachments .message-composer-attachment{display:flex;max-width:100%;margin-inline-end:30px;margin-top:10px}.base-message-composer .message-composer-attachments .message-composer-attachment-icon{width:24px;min-width:24px;height:17px;margin-inline-end:10px;border:1px solid var(--crt-palette-label-100);border-radius:4px}.base-message-composer .message-composer-attachments .message-composer-attachment-icon img{object-fit:contain;height:100%;width:100%}.base-message-composer .message-composer-attachments .message-composer-attachment-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-inline-end:10px}.base-message-composer .message-composer-attachments .message-composer-attachment-size{color:var(--crt-palette-label-500);margin-inline-end:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon{width:16px;min-width:8px;height:16px;cursor:pointer;color:var(--crt-palette-label-500)}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon svg{height:8px}.base-message-composer .message-composer-attachments .message-composer-attachment-remove-icon:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.base-message-composer .base-message-composer-input .base-message-composer-input-field .rich-editor-wrapper div.icons{padding-inline-end:5px;position:absolute;right:0;background:var(--crt-palette-background-50);border-top-left-radius:12px;padding-top:2px}[dir=rtl] .base-message-composer .base-message-composer-input .base-message-composer-input-field .rich-editor-wrapper div.icons{left:0;border-top-right-radius:12px;border-top-left-radius:initial;right:auto}.base-message-composer .rich-editor{padding-bottom:10px}
`],encapsulation:2})}};(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"disabled",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"sendingButtonDisabled",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"footerPanelExpanded",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],L.prototype,"footerPanelOptions",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],L.prototype,"channelSelector",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",s.TemplateRef)],L.prototype,"selectionActions",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"selectionChange",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Boolean)],L.prototype,"disableSelectionOptions",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"footerPanelIndent",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",String)],L.prototype,"inputPlaceHolder",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"useTemplates",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"useDrafts",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",String)],L.prototype,"composerCacheCode",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"discardBtnVisible",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",String)],L.prototype,"sendButtonIcon",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"maxAttachmentsSize",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"messageChangesCancel",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"composerCleared",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"messageInputFocus",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"messageInputBlur",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"messageInputClick",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"messageChanged",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"messagePublish",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"selectTemplate",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"attachmentAdded",void 0),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"saveDraft",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Object)],L.prototype,"mentionsService",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],L.prototype,"height",null),(0,n.__decorate)([(0,E.j)(),(0,n.__metadata)("design:type",Object)],L.prototype,"newMention",void 0),(0,n.__decorate)([(0,l.k)(),(0,n.__metadata)("design:type",C.$),(0,n.__metadata)("design:paramtypes",[C.$])],L.prototype,"dataCachingService",null),L=(0,n.__decorate)([(0,b.v)({type:"crt.BaseMessageComposer",reuseStrategy:F.B.Reuse}),(0,n.__metadata)("design:paramtypes",[s.Injector,T.d,g.H,x.H,o.A,s.ChangeDetectorRef,O.r,D.i,U.DW])],L)},52808:(G,A,e)=>{e.d(A,{B:()=>S});var n=e(5960),i=e.n(n),s=e(22307),r=e.n(s),t=e(77592),y=e(34760),m=e(1034),u=e(68712),_=e(67057),l=e.n(_),E=e(13232);const b=U=>({"selected-composer":U});function F(U,o){if(U&1){const p=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"crt-button",2),s.\u0275\u0275listener("clicked",function(){const O=s.\u0275\u0275restoreView(p).$implicit,x=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(x.showComposer(O))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(U&2){const p=o.$implicit,g=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(3,b,g.isComposerSelected(p)))("icon",g.getComposerIcon(p))("caption",g.getComposerCaption(p))}}function I(U,o){if(U&1&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,F,2,5,"ng-container",1),s.\u0275\u0275elementContainerEnd()),U&2){const p=s.\u0275\u0275nextContext();s.\u0275\u0275advance(),s.\u0275\u0275property("ngForOf",p.visibleChannels)}}let S=class Ae extends u.K{constructor(){super(...arguments),this._iconsMap={Email:"email-composer-icon",Feed:"feed-composer-icon"},this.selectedChannelIndexChange=new s.EventEmitter}get isVisible(){return this.visibleChannels?.length>1}get visibleChannels(){return this.channels?.filter(o=>o.visible!==!1)}set selectedChannelIndex(o){this._selectedChannelIndex=o,this.changeDetectorRef.markForCheck()}showComposer(o){this.selectedChannelIndex=this.channels.indexOf(o),this.selectedChannelIndexChange.emit(this._selectedChannelIndex)}getComposerIcon(o){const p=o.data;return p?.icon?p?.icon:this._iconsMap[p?.schemaType]||"send-icon"}getComposerCaption(o){return o.data?.caption||""}isComposerSelected(o){return this.channels.indexOf(o)===this._selectedChannelIndex}static{this.\u0275fac=(()=>{let o;return function(g){return(o||(o=s.\u0275\u0275getInheritedFactory(Ae)))(g||Ae)}})()}static{this.\u0275cmp=s.\u0275\u0275defineComponent({type:Ae,selectors:[["crt-channel-selector"]],inputs:{channels:"channels",selectedChannelIndex:"selectedChannelIndex"},outputs:{selectedChannelIndexChange:"selectedChannelIndexChange"},features:[s.\u0275\u0275ProvidersFeature([]),s.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],["size","large","iconPosition","only-icon",1,"select-composer-button",3,"clicked","ngClass","icon","caption"]],template:function(p,g){p&1&&s.\u0275\u0275template(0,I,2,1,"ng-container",0),p&2&&s.\u0275\u0275property("ngIf",g.isVisible)},dependencies:[_.NgClass,_.NgForOf,_.NgIf,E.B],styles:[`.select-composer-button{margin-inline-end:4px;border-radius:8px}.select-composer-button button:hover{border-radius:8px}.select-composer-button.selected-composer{background-color:var(--crt-button-default-hover-color)}.select-composer-button.selected-composer button{color:var(--crt-palette-primary-500)!important}
`],encapsulation:2})}};(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Array)],S.prototype,"channels",void 0),(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],S.prototype,"selectedChannelIndex",null),(0,n.__decorate)([(0,y.j)(),(0,n.__metadata)("design:type",Object)],S.prototype,"selectedChannelIndexChange",void 0),S=(0,n.__decorate)([(0,m.v)({type:"crt.ChannelSelector"})],S)},44395:(G,A,e)=>{e.d(A,{Z:()=>b});var n=e(73308),i=e(5960),s=e(22307),r=e(34760),t=e(77592),y=e(95145),m=e(68712);const u="OptimizeComponentsAccessibilityBehavior";var _=e(62278),l=e(58909);const E=["baseComposer"];class b extends m.K{constructor(I){super(I),this.injector=I,this.isAnimationDisabled=!1,this.footerPanelExpanded=!1,this.maxAttachmentsSize=0,this.composerEventChange=new s.EventEmitter,this.selectionChange=new s.EventEmitter,this._elementRef=I.get(s.ElementRef),this._sysSettingsService=I.get(y.A),this._initOptimizeComponentsAccessibilityBehavior()}_initOptimizeComponentsAccessibilityBehavior(){var I=this;return(0,n.A)(function*(){I.isAnimationDisabled=yield(0,_.lastValueFrom)(I._sysSettingsService.getValueByCode(u,I.isAnimationDisabled)),I.isAnimationDisabled&&(I.footerPanelExpanded=!0)})()}publishInputFocusEvent(){this.composerEventChange.emit([{name:l.An,params:{isFocused:this.footerPanelExpanded}}]),this.baseComposer&&(this.baseComposer.maxAttachmentsSize=this.maxAttachmentsSize)}onMessageInputFocus(){this.footerPanelExpanded=!0,this.publishInputFocusEvent()}onMessageInputBlur(){this.baseComposer?.getValue()||(this.isAnimationDisabled||(this.footerPanelExpanded=!1),this.publishInputFocusEvent())}onMessageInputClick(){this.baseComposer?.getValue()||(this.footerPanelExpanded=!0,this.publishInputFocusEvent())}sendComponentReadyEvent(I){this.composerEventChange.emit([{name:l.iQ,params:{composerSchemaType:I}}])}get element(){return this.elementRef?.nativeElement}onSelectionChange(I){this.selectionChange.next(I)}static{this.\u0275fac=function(S){return new(S||b)(s.\u0275\u0275directiveInject(s.Injector))}}static{this.\u0275dir=s.\u0275\u0275defineDirective({type:b,viewQuery:function(S,U){if(S&1&&s.\u0275\u0275viewQuery(E,5),S&2){let o;s.\u0275\u0275queryRefresh(o=s.\u0275\u0275loadQuery())&&(U.baseComposer=o.first)}},inputs:{maxAttachmentsSize:"maxAttachmentsSize",selection:"selection",disableSelectionOptions:"disableSelectionOptions"},outputs:{composerEventChange:"composerEventChange",selectionChange:"selectionChange"},features:[s.\u0275\u0275InheritDefinitionFeature]})}}(0,i.__decorate)([(0,r.j)(),(0,i.__metadata)("design:type",Object)],b.prototype,"composerEventChange",void 0),(0,i.__decorate)([(0,t.k)(),(0,i.__metadata)("design:type",String)],b.prototype,"selection",void 0),(0,i.__decorate)([(0,r.j)(),(0,i.__metadata)("design:type",Object)],b.prototype,"selectionChange",void 0),(0,i.__decorate)([(0,t.k)(),(0,i.__metadata)("design:type",Boolean)],b.prototype,"disableSelectionOptions",void 0)},30816:(G,A,e)=>{e.d(A,{n:()=>X,P:()=>Ce});var n=e(73308),i=e(5960),s=e(15783),r=e(67057),t=e(22307),y=e(59247),m=e(91775),u=e(6530),_=e(77592),l=e(34760),E=e(1034),b=e(96677),F=e(52793),I=e(10098),S=e(79772),U=e(88033),o=e(6503),p=e(95145),g=e(31774),O;(function(le){le.DefaultMailbox="crt.DefaultSenderComposerRequest",le.CaseMailbox="crt.CaseSenderComposerRequest"})(O||(O={}));var x=e(29423),M=e(23092),B=e(28399),T=e(62278),D=e(29957),f=e(16296),H=e(58909),Y=e(46690),q=e(85688),re=e(55529),ce=e(59784),d=e(2023),h=e(44395),c=e(13232),C=e(58433),j=e(66803),Q=e(19344),ae=e(2126),pe=e(58551),ue=e(30306);const Ee=["toRecipientSearch"],te=["ccRecipientSearch"],de=["bccRecipientSearch"],W=[[["","slot","channelspanel"]],[["","slot","selectionactions"]]],Z=["[slot='channelsPanel']","[slot='selectionActions']"],k=le=>({display:le}),se=()=>({height:"12px",width:"80%","margin-bottom":"5px","margin-top":"5px"});function ne(le,a){if(le&1&&(t.\u0275\u0275element(0,"crt-button",28),t.\u0275\u0275pipe(1,"translate")),le&2){const P=t.\u0275\u0275nextContext();t.\u0275\u0275propertyInterpolate("title",t.\u0275\u0275pipeBind1(1,3,"MessageComposer.Email.ChangeReplyAction")),t.\u0275\u0275property("icon",P.getReplyActionIcon())("menuItems",P.itemActionItems)}}function me(le,a){if(le&1){const P=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",29),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(P);const L=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(L.toggleVisibleCc())}),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}le&2&&(t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"MessageComposer.Email.CC")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"MessageComposer.Email.CcToggleCaption")," "))}function Me(le,a){if(le&1){const P=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",30),t.\u0275\u0275pipe(1,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(P);const L=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(L.toggleVisibleBcc())}),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()}le&2&&(t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(1,2,"MessageComposer.Email.BCC")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,4,"MessageComposer.Email.BccToggleCaption")," "))}function Ie(le,a){le&1&&t.\u0275\u0275projection(0)}function Oe(le,a){le&1&&t.\u0275\u0275projection(0,1)}class Ce{}let X=class Le extends h.Z{get activityId(){return this._activityId}get replyAction(){return this._replyAction}set replyAction(a){this._replyAction=a,this._updateLabelsWidth()}set from(a){if(this._from=a,this._skeletonLoading){this._defaultFrom=this._from;return}this._setFrom(this._from)}get from(){return this._from}set sendersMailboxes(a){a&&(this._sendersMailboxes=a,this.fromLookupValues=this._getFromLookupValues(this._sendersMailboxes),a.length>0&&this._updateAddressFields(a),this._mailboxSendersSet.next(this.maxAttachmentsSize))}get sendersMailboxes(){return this._sendersMailboxes}set to(a){a!=null&&this.toInputControl?.setRecipients(a)}get to(){return this._to}set cc(a){a!=null&&this.ccInputControl?.setRecipients(a)}get cc(){return this._cc}set bcc(a){a!=null&&this.bccInputControl?.setRecipients(a)}get bcc(){return this._bcc}set body(a){a!=null&&this.baseComposer.setValue(a)}get body(){return this._body}set recipientsMailboxes(a){a?.recipients&&(this.toInputControl.rawRecipinets=a.recipients,this.ccInputControl.rawRecipinets=a.recipients,this.bccInputControl.rawRecipinets=a.recipients)}set emailId(a){this._debounceSetReplyAction(a)}set skeletonLoading(a){this._skeletonLoading=a}get skeletonLoading(){return this._skeletonLoading||this.loading}get cacheCode(){if((0,B.isEmpty)(this._userId)||!(0,B.isEmpty)(this.entitySchemaName)&&(0,B.isEmpty)(this.recordId)||this._replyAction===f.T.EditDraft)return"";let a=`email_composer_cache_data_${this._userId}_`;return!(0,B.isEmpty)(this.entitySchemaName)&&!(0,B.isEmpty)(this.recordId)&&(a+=`${this.entitySchemaName}_${this.recordId}`),a}set headerLabelsWidth(a){a&&(this._headerLabelsWidth=this.getReplyButtonVisible()?this._defaultHeaderLabelsWidth:a,this._headerLabelsWidthString=this._headerLabelsWidth+"px")}get headerLabelsWidth(){return this._headerLabelsWidth}set expandOnLoad(a){a&&this.onMessageInputFocus()}set composerEvent(a){a?.forEach(P=>{switch(P?.name){case H.M7:this._handleReplyAction(P.params?.emailId,P.params?.action);break;case H.J3:this._emailSaved(P.params.response);break}})}constructor(a,P){super(a),this._document=P,this._defaultAttachmentsSizeLimit=50,this._emailSchemaName="Activity",this._iconsMap={reply:"reply-message","reply-all":"reply-all-message",forward:"forward-message"},this._defaultHeaderLabelsWidth=136,this._debounceTime=500,this._skeletonLoading=!1,this._defaultFrom="",this._subscriptions=[],this._headers=[],this._postponeSignature=!1,this._mailboxSendersSet=new T.Subject,this._debounceSetSignature=(0,B.debounce)(this._setSignature,this._debounceTime),this._debounceSetReplyAction=(0,B.debounce)(R=>this._setReplyAction(R),this._debounceTime),this.fromInputControl=new y.FormControl(null),this.itemActionItems=[],this.subjectInputControl=new y.FormControl(null),this._defaultHeaderLabelsWidthString="136px",this.subjectChange=new t.EventEmitter,this.fromChange=new t.EventEmitter,this.toChange=new t.EventEmitter,this.ccChange=new t.EventEmitter,this.bccChange=new t.EventEmitter,this.bodyChange=new t.EventEmitter,this.isReplyExpanded=!1,this.visibleCc=!1,this.visibleCcChange=new t.EventEmitter,this.visibleBcc=!1,this.visibleBccChange=new t.EventEmitter,this.headerExpanded=!1,this.headerExpandedChange=new t.EventEmitter,this.emailComposerCleared=new t.EventEmitter,this.emailComposerSaved=new t.EventEmitter,this.refreshRecipients=new t.EventEmitter,this._isDesignTime=a.get(x.w,!1),this._sendEmailService=a.get(Y.y),this._maskService=a.get(U.s),this._messageDialogProvider=a.get(g.r),this._translateService=a.get(S.TranslateService),this._sysSettingsService=a.get(p.A),this._emailsService=a.get(q.d),this._emailTemplatesService=a.get(re.B),this._emailSignatureService=a.get(ce.S),this.emailComposerCachingService=a.get(d.v),this.notifyService=a.get(o.F),this._userInfo=a.get(M.oq),!this._isDesignTime&&(this._userId=this._userInfo.id,this._init(),this._initItemActionItems())}_initItemActionItems(){this.itemActionItems=[{caption:this._translateService.instant("MessageComposer.Email.Reply"),type:"crt.MenuItem",name:"Reply",icon:"reply-message",handleItemClick:()=>this.changeReplyAction(f.T.Reply)},{caption:this._translateService.instant("MessageComposer.Email.ReplyAll"),type:"crt.MenuItem",name:"ReplyAll",icon:"reply-all-message",handleItemClick:()=>this.changeReplyAction(f.T.ReplyAll)},{caption:this._translateService.instant("MessageComposer.Email.Forward"),type:"crt.MenuItem",name:"Forward",icon:"forward-message",handleItemClick:()=>this.changeReplyAction(f.T.Forward)}]}_init(){this._skeletonLoading=!0,this._subscribeToEvents(),this._subscriptions.push((0,T.of)(this._sysSettingsService.getValueByCode("MaxAttachmentsSize",this._defaultAttachmentsSizeLimit),this._mailboxSendersSet).pipe((0,T.concatAll)()).subscribe(a=>{this.maxAttachmentsSize=a,this._skeletonLoading=!1,this.changeDetectorRef.markForCheck(),this._requestDefaultSender().then(()=>this._setDefaultFrom())}))}_requestDefaultSender(){if((0,B.isEmpty)(this.defaultSenderRequest))return new Promise(P=>P());const a={type:this.defaultSenderRequest,...this._getDefaultSenderRequestParams()};return m.t.instance.process(a).then(P=>this._defaultFrom=P).then()}_getDefaultSenderRequestParams(){return{recordId:this.defaultSenderRequest===O.DefaultMailbox?this._userId:this.recordId}}_setDefaultFrom(){!(0,B.isEmpty)(this._defaultFrom)&&(0,B.isEmpty)(this.from)&&this._setFrom(this._defaultFrom)}_setFrom(a){if((0,B.isEmpty)(a))this.fromInputControl?.setValue("");else{a=a.toLowerCase();let P=this.fromLookupValues?.find(R=>R.displayValue.toLowerCase().trim()===a.trim());(0,B.isEmpty)(P)&&(P=this.fromLookupValues?.find(R=>R.displayValue.toLowerCase().includes(a))),P?(this.fromInputControl?.setValue(P),this._debounceSetSignature()):this.fromInputControl?.setValue("")}}_subscribeToEvents(){this._subscriptions.push(this.fromInputControl.valueChanges.pipe((0,T.startWith)(null),(0,T.pairwise)()).subscribe(([a,P])=>{(a??"")!==(P??"")&&this.fromChange.emit(P?.displayValue)})),this._subscriptions.push(this.subjectInputControl.valueChanges.pipe((0,T.startWith)(null),(0,T.pairwise)()).subscribe(([a,P])=>{a!==P&&this.subjectChange.emit(P)}))}_emailSaved(a){a.activityId===this._activityId&&(this._isDraftSaving?this._processDraftSaved(a):this._processEmailSaving(a).pipe((0,T.concatMap)(P=>this._processSendingResult(P))).subscribe())}_processDraftSaved(a){if(a.success)if(a.templateId){this._maskService.hideBodyMask(),this._loadAndInsertTemplate(a.templateId);return}else this.notifyService.show({message:"MessageComposer.Email.DraftSaved"}),this._updateNextSteps(),this.onMessageCancel();else this._showErrorMessage(this._translateService.instant("MessageComposer.Email.SaveDraftError"));this._maskService.hideBodyMask()}_processEmailSaving(a){return a.success?this._sendEmailService.sendEmail(this._activityId):(0,T.of)(a)}_unsubscribeFromEvents(){this._subscriptions.forEach(a=>a?.unsubscribe())}_setReplyAction(a){!(0,B.isEmpty)(a)&&a!==u.To&&(this._replyAction=f.T.EditDraft,this._postponeSignature=!0,this._handleReplyAction(a,f.T.EditDraft))}_setSignature(){if(this._postponeSignature)return;const a=this.fromInputControl.value,P=this.baseComposer?.getValue();if((0,B.isEmpty)(a)&&(0,B.isEmpty)(P))return;const L=this.sendersMailboxes?.find(v=>v.id===a?.value),z=L?.useSignature?L?.signature:D.String.empty;this._subscriptions.push(this._emailSignatureService.updateSignatureInBody(()=>this.baseComposer?.getValue(),z).subscribe(v=>this.baseComposer?.setValue(v)))}_handleReplyAction(a,P){if(!(!(0,B.isEmpty)(a)&&this._inReplyTo?.id===a&&this.replyAction===P)){if((0,B.isEmpty)(a)){this._clearFields(),window.requestAnimationFrame(()=>{this.baseComposer?.focus()});return}this._subscriptions.push(this._emailsService.getEmail(a,[f.T.Forward,f.T.EditDraft].includes(P)).pipe((0,T.concatMap)(R=>(this._inReplyTo=P===f.T.EditDraft?null:R,this.replyAction=P,P===f.T.EditDraft?(0,T.of)({...R,bodyShort:R.body}):this._emailsService.getReplyDraft(R,P)))).subscribe(R=>{P!==f.T.EditDraft?(this._inReplyTo.body=R.body,this._inReplyTo.bodyShort=R.bodyShort,this._activityId=null):this._activityId=R.id,this.isReplyExpanded=!1,this._postponeSignature=!1,this._fillForm(R,!0)}))}}_removeSenderFromRecipients(a){this.replyAction!==f.T.ReplyAll||!this.fromLookupValues||this.fromLookupValues.length>1||(a.to=this._filterSenderFromRecipients(a.to),a.cc=this._filterSenderFromRecipients(a.cc))}_filterSenderFromRecipients(a){const P=this.fromLookupValues[0];if(!(!P||!a||(0,B.isEmpty)(P.displayValue)))return a.filter(R=>!R.includes(P.displayValue)&&!P.displayValue.includes(R))}_updateAddressFields(a){const P=a.length===1?a[0].senderEmailAddress:this._from;!(0,B.isEmpty)(P)&&!this.fromInputControl?.value&&this._setFrom(P),this.fromLookupValues.length===1&&(this.toInputControl?.setRecipients(this._filterSenderFromRecipients(this.toInputControl?.getRecipients())),this.ccInputControl?.setRecipients(this._filterSenderFromRecipients(this.ccInputControl?.getRecipients())))}_fillForm(a,P=!1){this._removeSenderFromRecipients(a),this.toInputControl.setRecipients(a.to),this.ccInputControl.setRecipients(a.cc),this.bccInputControl.setRecipients(a.bcc),this.setVisibleCc(a.cc?.length>0),this.setVisibleBcc(a.bcc?.length>0),this._headers=a.headers,this.subjectInputControl.setValue(a.subject);const R=this.baseComposer.getValue();if(!R||P){const z=!(0,B.isEmpty)(R)&&(0,B.isEmpty)(this._activityId)?this._emailsService.getDraftUserContent(R,!0):a.bodyShort;this.baseComposer.setValue(z)}this.replyAction===f.T.EditDraft?this.from=a.from:(this.from="",this._requestDefaultSender().then(()=>this._setDefaultFrom()));let L=[];P||(L=this.baseComposer.attachments.filter(z=>z.content.byteLength===void 0?z.content!=="":z.content.byteLength>0)),this.baseComposer.attachments=[...L,...a.attachments],this.baseComposer?.focus()}_getFromLookupValues(a){return a?.map(P=>({value:P.id,displayValue:P.senderDisplayValue?`${P.senderDisplayValue} <${P.senderEmailAddress}>`:P.senderEmailAddress}))}_getEmail(){const a=this.baseComposer.attachments;let P=!1;return this._activityId?P=!0:this._activityId=(0,u.qv)(),this.baseComposer.saveInlineImagesToDb({schemaName:this._emailSchemaName,recordId:this._activityId,fileSchemaName:""}).pipe((0,T.map)(()=>({id:this._activityId,from:this.fromInputControl?.value?.displayValue,to:this.toInputControl.getRecipients(),cc:this.ccInputControl.getRecipients(),bcc:this.bccInputControl.getRecipients(),subject:this.subjectInputControl?.value,body:this.baseComposer?.getValue(),isDraft:P,headers:(0,B.cloneDeep)(this._headers),attachments:a?.map(R=>({...R,recordId:this._activityId,fileEntitySchemaName:"ActivityFile",recordEntitySchemaName:this._emailSchemaName,recordColumnName:"Activity"}))})))}_validate(){const a=new Array;return this.fromInputControl.value||a.push(this._translateService.instant("MessageComposer.Email.FromValidationErrorMessage")),!this.toInputControl.validate()&&!this.ccInputControl.validate()&&!this.bccInputControl.validate()&&a.push(this._translateService.instant("MessageComposer.Email.ToValidationErrorMessage")),this.subjectInputControl.value||a.push(this._translateService.instant("MessageComposer.Email.SubjectValidationErrorMessage")),a.length>0?(this._showErrorMessage(a.join(`\r
\r
`)),!1):!0}_showErrorMessage(a){this._messageDialogProvider.error(a)}_onTemplateSelected(a){var P=this;return(0,n.A)(function*(){if(a&&!a.canceled){const L=(yield a?.getLookupValues())[0]?.value;if((0,B.isEmpty)(L))return;if(P.entitySchemaName?.toLowerCase()==="activity"&&!P._activityId){P.saveDraft(L);return}P._loadAndInsertTemplate(L)}})()}_loadAndInsertTemplate(a){(0,B.isEmpty)(a)||(this._maskService.showBodyMask(),this._emailTemplatesService.getMultiLanguageTemplate(a,this.entitySchemaName,this.entitySchemaName?.toLowerCase()==="activity"?this._activityId:this.recordId).subscribe({next:P=>this._insertTemplate(P?.subjectTemplate,P?.textTemplate),error:P=>this._onErrorProcessedTemplate(P)}))}_onErrorProcessedTemplate(a=null){this._maskService.hideBodyMask(),a&&console.error(a),this._showErrorMessage("MessageComposer.Email.TemplateInsertError")}_insertTemplate(a,P){const R=this.baseComposer?.getValue();(0,B.isEmpty)(R)||(P+=R),this.baseComposer?.setValue(P);const L=this._translateService.instant("MessageComposer.Email.Draft").toUpperCase();((0,B.isEmpty)(this.subjectInputControl?.value)||this.subjectInputControl?.value===L)&&this.subjectInputControl?.setValue(a),this._maskService.hideBodyMask(),this.baseComposer?.focus()}_saveEmail(a,P){this._inReplyTo&&!this.isReplyExpanded&&(a.body=this._emailsService.getSafeUserContentReplyBody(a.body,this._inReplyTo.body));const R={inReplyToId:this._inReplyTo?.id,masterRecordId:this.recordId,masterSchemaName:this.entitySchemaName,defaultValues:new Array,bindingColumns:new Array,templateId:P};this.bindingColumns&&this.bindingColumns.forEach(z=>{R.bindingColumns.push({activityColumnName:z.activityColumnName,formAttributeName:z.formAttributeName})});const L={email:a,params:R};return this.emailComposerSaved.emit(L),(0,T.of)()}_processSendingResult(a){if(a.success)this.notifyService.show({message:"MessageComposer.Email.EmailSent"}),this._updateNextSteps(),this.onMessageCancel();else{const P=this._translateService.instant("MessageComposer.Email.PublishError");this._showErrorMessage(D.String.format(P,a.errorInfo.message))}return this._maskService.hideBodyMask(),(0,T.of)(!0)}_updateNextSteps(){const a={type:"crt.ChangeNextStepsStateRequest",$context:null};m.t.instance.process(a)}_clearFields(){this._activityId=null,this.baseComposer?.clear(),this.fromInputControl?.setValue(""),this.toInputControl?.clear(),this.ccInputControl?.clear(),this.bccInputControl?.clear(),this.subjectInputControl?.setValue(""),this.replyAction=null,this._inReplyTo=null}_updateLabelsWidth(){this.getReplyButtonVisible()&&((!this.toInputControl||!this.ccInputControl||!this.bccInputControl)&&this.changeDetectorRef.detectChanges(),this.headerLabelsWidth=this._defaultHeaderLabelsWidth,this.toInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth,this.ccInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth,this.bccInputControl.recipientLabelWidth=this._defaultHeaderLabelsWidth)}getReplyButtonVisible(){return this.replyAction&&this.replyAction!==f.T.EditDraft}saveDraft(a){this.subjectInputControl.value||this.subjectInputControl.setValue(this._translateService.instant("MessageComposer.Email.Draft").toUpperCase()),this._isDraftSaving=!0,this._maskService.showBodyMask(),this._subscriptions.push(this._getEmail().pipe((0,T.concatMap)(P=>this._saveEmail(P,a))).subscribe())}onSelectTemplate(){const a=this._emailTemplatesService.getTemplatesLookupConfig(this.entitySchemaName);a.afterClosed=P=>this._onTemplateSelected(P),m.t.instance.process(a)}onMessagePublish(){this._validate()&&(this._isDraftSaving=!1,this._maskService.showBodyMask(),this._subscriptions.push(this._getEmail().pipe((0,T.concatMap)(a=>this._saveEmail(a))).subscribe()))}onMessageChanged(){const a=this._document.getElementsByClassName("email-composer-reply-expander");a.length>0&&a[a.length-1].addEventListener("click",this.toggleReplyBody.bind(this)),this.bodyChange.emit(this.baseComposer.getValue())}setHeaderExpanded(a){this.headerExpanded=a,this.headerExpandedChange.emit(this.headerExpanded)}setVisibleCc(a){this.visibleCc=a,this.visibleCcChange.emit(this.visibleCc)}setVisibleBcc(a){this.visibleBcc=a,this.visibleBccChange.emit(this.visibleBcc)}onMessageCancel(){this._clearFields(),this.setHeaderExpanded(!!this.isAnimationDisabled),this.setVisibleCc(!1),this.setVisibleBcc(!1)}onMessageInputFocus(){this.footerPanelExpanded=!0,this.publishInputFocusEvent(),this.setHeaderExpanded(!0)}onMessageInputBlur(){this.headerExpanded||(this.footerPanelExpanded=!1,this.publishInputFocusEvent())}onMessageInputClick(){this.headerExpanded||(this.footerPanelExpanded=!0,super.onMessageInputClick())}toggleVisibleCc(){this.setVisibleCc(!this.visibleCc)}toggleVisibleBcc(){this.setVisibleBcc(!this.visibleBcc)}getReplyActionIcon(){return this._iconsMap[this.replyAction]}changeReplyAction(a){if(a===this.replyAction)return;this.replyAction=a;let P=(0,T.of)(this._inReplyTo);a===f.T.Forward&&this._inReplyTo.attachments?.length===0&&(P=this._emailsService.getAttachments(this._inReplyTo.id).pipe((0,T.switchMap)(R=>(this._inReplyTo.attachments=R,(0,T.of)(this._inReplyTo))))),this._subscriptions.push(P.pipe((0,T.concatMap)(R=>this._emailsService.getReplyDraft(R,a))).subscribe(R=>{this._fillForm(R)}))}toggleReplyBody(){const a=this.baseComposer.getValue();this._inReplyTo.body=this._emailsService.getSafeUserContentReplyBody(a,this._inReplyTo.body),this.baseComposer.setValue(this._inReplyTo.body),this.isReplyExpanded=!0}onFromFocus(){this.setHeaderExpanded(!0)}ngOnDestroy(){this._unsubscribeFromEvents(),this._clearFields()}ngAfterViewInit(){this.sendComponentReadyEvent("Email")}loadRecipients({query:a,recipientsLength:P}){this.refreshRecipients.next({query:a,recipientsLength:P})}toChanged(a){this.toChange.next(a)}ccChanged(a){this.ccChange.next(a)}bccChanged(a){this.bccChange.next(a)}static{this.\u0275fac=function(P){return new(P||Le)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(r.DOCUMENT))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:Le,selectors:[["crt-email-composer"]],viewQuery:function(P,R){if(P&1&&(t.\u0275\u0275viewQuery(Ee,5),t.\u0275\u0275viewQuery(te,5),t.\u0275\u0275viewQuery(de,5)),P&2){let L;t.\u0275\u0275queryRefresh(L=t.\u0275\u0275loadQuery())&&(R.toInputControl=L.first),t.\u0275\u0275queryRefresh(L=t.\u0275\u0275loadQuery())&&(R.ccInputControl=L.first),t.\u0275\u0275queryRefresh(L=t.\u0275\u0275loadQuery())&&(R.bccInputControl=L.first)}},hostVars:4,hostBindings:function(P,R){P&2&&t.\u0275\u0275styleProp("--defaultHeaderLabelsWidthString",R._defaultHeaderLabelsWidthString)("--headerLabelsWidthString",R._headerLabelsWidthString)},inputs:{subject:"subject",from:"from",sendersMailboxes:"sendersMailboxes",to:"to",cc:"cc",bcc:"bcc",body:"body",recipientsMailboxes:"recipientsMailboxes",emailId:"emailId",skeletonLoading:"skeletonLoading",height:"height",defaultSenderRequest:"defaultSenderRequest",bindingColumns:"bindingColumns",recordId:"recordId",entitySchemaName:"entitySchemaName",isReplyExpanded:"isReplyExpanded",visibleCc:"visibleCc",visibleBcc:"visibleBcc",headerExpanded:"headerExpanded",headerLabelsWidth:"headerLabelsWidth",expandOnLoad:"expandOnLoad",composerEvent:"composerEvent"},outputs:{subjectChange:"subjectChange",fromChange:"fromChange",toChange:"toChange",ccChange:"ccChange",bccChange:"bccChange",bodyChange:"bodyChange",visibleCcChange:"visibleCcChange",visibleBccChange:"visibleBccChange",headerExpandedChange:"headerExpandedChange",emailComposerCleared:"emailComposerCleared",emailComposerSaved:"emailComposerSaved",refreshRecipients:"refreshRecipients"},features:[t.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:Z,decls:37,vars:59,consts:[["toRecipientSearch",""],["ccRecipientSearch",""],["bccRecipientSearch",""],["baseComposer",""],["channelSelector",""],["selectionActions",""],[1,"email-composer",3,"ngStyle"],[1,"email-composer-header"],[1,"email-composer-header-actions"],["class","email-composer-header-actions-button","size","large","clickMode","menu","data-qa","change-reply-action",3,"title","icon","menuItems",4,"ngIf"],[1,"email-composer-header-properties"],[1,"email-composer-header-properties-main"],[1,"email-composer-header-properties-main-from-field"],["data-qa","email-composer-from",1,"without-padding-top",3,"focusin","control","items","value","useStaticFiltering","label","labelPosition","appearance"],[1,"email-composer-header-properties-main-controls"],["displayType","text","data-qa","cc-button","class","email-composer-header-properties-main-controls-togglebtn",3,"title","clicked",4,"ngIf"],["displayType","text","data-qa","bcc-button","class","email-composer-header-properties-main-controls-togglebtn",3,"title","clicked",4,"ngIf"],[1,"email-composer-header-properties-collapsible"],["data-qa","email-composer-to",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-cc"],["data-qa","email-composer-cc",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-bcc"],["data-qa","email-composer-bcc",3,"recipientsChanged","loadRecipients","rawRecipients","recipientLabel","recipientLabelWidth"],[1,"email-composer-header-properties-collapsible-subject"],["data-qa","email-composer-subject",1,"without-padding-top",3,"control","value","appearance","label","labelPosition"],[3,"selectionChange","messagePublish","selectTemplate","messageChangesCancel","messageInputFocus","messageInputBlur","messageInputClick","messageChanged","saveDraft","composerCleared","composerCacheCode","inputPlaceHolder","footerPanelExpanded","channelSelector","selectionActions","disableSelectionOptions","useTemplates","useDrafts","height","discardBtnVisible","dataCachingService"],[3,"ngStyle"],["appearance","line","count","3",1,"email-composer-skeleton-loader",3,"styles"],["size","large","clickMode","menu","data-qa","change-reply-action",1,"email-composer-header-actions-button",3,"title","icon","menuItems"],["displayType","text","data-qa","cc-button",1,"email-composer-header-properties-main-controls-togglebtn",3,"clicked","title"],["displayType","text","data-qa","bcc-button",1,"email-composer-header-properties-main-controls-togglebtn",3,"clicked","title"]],template:function(P,R){if(P&1){const L=t.\u0275\u0275getCurrentView();t.\u0275\u0275projectionDef(W),t.\u0275\u0275elementStart(0,"div",6)(1,"div",7)(2,"div",8),t.\u0275\u0275template(3,ne,2,5,"crt-button",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",10)(5,"div",11)(6,"div",12)(7,"crt-combobox",13),t.\u0275\u0275pipe(8,"translate"),t.\u0275\u0275listener("focusin",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onFromFocus())}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(9,"div",14),t.\u0275\u0275template(10,me,4,6,"crt-button",15)(11,Me,4,6,"crt-button",16),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(12,"div",17)(13,"crt-recipient-search",18,0),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275listener("recipientsChanged",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.toChanged(v))})("loadRecipients",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.loadRecipients(v))}),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(16,"div",19)(17,"crt-recipient-search",20,1),t.\u0275\u0275pipe(19,"translate"),t.\u0275\u0275listener("recipientsChanged",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.ccChanged(v))})("loadRecipients",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.loadRecipients(v))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(20,"div",21)(21,"crt-recipient-search",22,2),t.\u0275\u0275pipe(23,"translate"),t.\u0275\u0275listener("recipientsChanged",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.bccChanged(v))})("loadRecipients",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.loadRecipients(v))}),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(24,"div",23),t.\u0275\u0275element(25,"crt-input",24),t.\u0275\u0275pipe(26,"translate"),t.\u0275\u0275elementEnd()()()(),t.\u0275\u0275elementStart(27,"crt-base-message-composer",25,3),t.\u0275\u0275pipe(29,"translate"),t.\u0275\u0275listener("selectionChange",function(v){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onSelectionChange(v))})("messagePublish",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onMessagePublish())})("selectTemplate",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onSelectTemplate())})("messageChangesCancel",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onMessageCancel())})("messageInputFocus",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onMessageInputFocus())})("messageInputBlur",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onMessageInputBlur())})("messageInputClick",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onMessageInputClick())})("messageChanged",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.onMessageChanged())})("saveDraft",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.saveDraft())})("composerCleared",function(){return t.\u0275\u0275restoreView(L),t.\u0275\u0275resetView(R.emailComposerCleared.emit())}),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(30,Ie,1,0,"ng-template",null,4,t.\u0275\u0275templateRefExtractor)(32,Oe,1,0,"ng-template",null,5,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(34,"div",26),t.\u0275\u0275element(35,"crt-skeleton-loader",27)(36,"crt-base-message-composer-skeleton"),t.\u0275\u0275elementEnd()}if(P&2){const L=t.\u0275\u0275reference(31),z=t.\u0275\u0275reference(33);t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(54,k,R.skeletonLoading?"none":"")),t.\u0275\u0275advance(),t.\u0275\u0275property("@.disabled",R.isAnimationDisabled)("@collapse",!R.isAnimationDisabled&&!R.headerExpanded),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",R.getReplyButtonVisible()),t.\u0275\u0275advance(4),t.\u0275\u0275property("control",R.fromInputControl)("items",R.fromLookupValues)("value",R.from)("useStaticFiltering",!0)("label",t.\u0275\u0275pipeBind1(8,42,"MessageComposer.Email.From"))("labelPosition","left")("appearance","legacy"),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",!R.visibleCc),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",R.visibleCc&&!R.visibleBcc),t.\u0275\u0275advance(2),t.\u0275\u0275property("rawRecipients",R.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(15,44,"MessageComposer.Email.To"))("recipientLabelWidth",R.headerLabelsWidth),t.\u0275\u0275advance(3),t.\u0275\u0275property("@collapse",!R.visibleCc),t.\u0275\u0275advance(),t.\u0275\u0275property("rawRecipients",R.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(19,46,"MessageComposer.Email.CC"))("recipientLabelWidth",R.headerLabelsWidth),t.\u0275\u0275advance(3),t.\u0275\u0275property("@collapse",!R.visibleBcc),t.\u0275\u0275advance(),t.\u0275\u0275property("rawRecipients",R.recipientsMailboxes)("recipientLabel",t.\u0275\u0275pipeBind1(23,48,"MessageComposer.Email.BCC"))("recipientLabelWidth",R.headerLabelsWidth),t.\u0275\u0275advance(4),t.\u0275\u0275property("control",R.subjectInputControl)("value",R.subject)("appearance","legacy")("label",t.\u0275\u0275pipeBind1(26,50,"MessageComposer.Email.Subject"))("labelPosition","left"),t.\u0275\u0275advance(2),t.\u0275\u0275property("composerCacheCode",R.cacheCode)("inputPlaceHolder",t.\u0275\u0275pipeBind1(29,52,"MessageComposer.Email.BodyPlaceholder"))("footerPanelExpanded",R.footerPanelExpanded)("channelSelector",L)("selectionActions",z)("disableSelectionOptions",R.disableSelectionOptions)("useTemplates",!0)("useDrafts",!0)("height",R.height)("discardBtnVisible",R.headerExpanded)("dataCachingService",R.emailComposerCachingService),t.\u0275\u0275advance(7),t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(56,k,R.skeletonLoading?"":"none")),t.\u0275\u0275advance(),t.\u0275\u0275property("styles",t.\u0275\u0275pureFunction0(58,se))}},dependencies:[r.NgIf,r.NgStyle,c.B,C.W,j.q,Q.j,ae.m,pe.l,ue.E,S.TranslatePipe],styles:[`@charset "UTF-8";.email-composer-header{display:flex}.email-composer-header-actions{position:absolute}.email-composer-header-properties{width:100%}.email-composer-header-properties-main{display:flex}.email-composer-header-properties-main-from-field{width:80%}.email-composer-header-properties-main-controls{width:20%;display:flex;justify-content:flex-end}.email-composer-header-properties-main-controls-togglebtn{margin-left:8px}.email-composer-reply-expander{width:48px}.email-composer-reply-expander:after{content:"\\22ef";width:16px;height:24px;font-size:18px;background-color:var(--crt-palette-interaction-400);padding:0 16px;line-height:22px;border-radius:8px;cursor:pointer;display:block}.email-composer-reply-expander:hover{color:var(--crt-palette-primary-500)}.email-composer .email-composer-header-properties-main-from-field crt-combobox.without-padding-top .crt-input,.email-composer .email-composer-header-properties-collapsible-subject crt-input.without-padding-top .crt-input,.email-composer .recipients-container{padding-top:0}.email-composer .email-composer-header-properties-collapsible-subject crt-input.crt-base-edit-input .crt-base-input-container .crt-input .crt-input-label-container,.email-composer .email-composer-header-properties-main-from-field crt-combobox.crt-base-edit-input .crt-base-input-container .crt-input .crt-input-label-container{width:var(--headerLabelsWidthString, var(--defaultHeaderLabelsWidthString));min-width:var(--headerLabelsWidthString, var(--defaultHeaderLabelsWidthString))}.email-composer .email-composer-header-properties .email-composer-header-properties-main-controls crt-button.email-composer-header-properties-main-controls-togglebtn button.crt-button{padding:0 5px}.email-composer-skeleton-loader{justify-content:space-between;text-align:end}
`],encapsulation:2,data:{animation:[(0,s.trigger)("collapse",[(0,s.state)("false",(0,s.style)({height:s.AUTO_STYLE,visibility:s.AUTO_STYLE,overflow:"hidden",opacity:1})),(0,s.state)("true",(0,s.style)({height:"0",visibility:"hidden",overflow:"hidden",opacity:0})),(0,s.transition)("false => true",(0,s.animate)("300ms ease-in")),(0,s.transition)("true => false",(0,s.animate)("300ms ease-out"))])]}})}};(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String)],X.prototype,"subject",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"subjectChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String),(0,i.__metadata)("design:paramtypes",[D.String])],X.prototype,"from",null),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"fromChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],X.prototype,"sendersMailboxes",null),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],X.prototype,"to",null),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"toChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],X.prototype,"cc",null),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"ccChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],X.prototype,"bcc",null),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"bccChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String),(0,i.__metadata)("design:paramtypes",[D.String])],X.prototype,"body",null),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"bodyChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Ce),(0,i.__metadata)("design:paramtypes",[Ce])],X.prototype,"recipientsMailboxes",null),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String),(0,i.__metadata)("design:paramtypes",[D.String])],X.prototype,"emailId",null),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],X.prototype,"skeletonLoading",null),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Number)],X.prototype,"height",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String)],X.prototype,"defaultSenderRequest",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Array)],X.prototype,"bindingColumns",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String)],X.prototype,"recordId",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",D.String)],X.prototype,"entitySchemaName",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Object)],X.prototype,"isReplyExpanded",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Object)],X.prototype,"visibleCc",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"visibleCcChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Object)],X.prototype,"visibleBcc",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"visibleBccChange",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Object)],X.prototype,"headerExpanded",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"headerExpandedChange",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"emailComposerCleared",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"emailComposerSaved",void 0),(0,i.__decorate)([(0,l.j)(),(0,i.__metadata)("design:type",Object)],X.prototype,"refreshRecipients",void 0),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Number),(0,i.__metadata)("design:paramtypes",[Number])],X.prototype,"headerLabelsWidth",null),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],X.prototype,"expandOnLoad",null),(0,i.__decorate)([(0,_.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],X.prototype,"composerEvent",null),X=(0,i.__decorate)([(0,E.v)({type:"crt.EmailComposer",contentSlots:["channelsPanel","selectionActions"],reuseStrategy:b.B.Reuse}),(0,F.f)({propertiesPanelComponentTypeName:"crt.EmailComposerPropertiesPanel",viewElementGroupType:I.J.CustomElements,typeCaption:"MessageComposer.Email.Caption"}),(0,i.__metadata)("design:paramtypes",[t.Injector,Document])],X)},23854:(G,A,e)=>{e.d(A,{r:()=>te});var n=e(73308),i=e(5960),s=e.n(i),r=e(22307),t=e.n(r),y=e(61541),m=e(6530),u=e(77592),_=e(34760),l=e(1034),E=e(96677),b=e(52793),F=e(10098),I=e(79772),S=e.n(I),U=e(6503),o=e(88033),p=e(60575),g=e(31774),O=e(4092),x=e(23092),M=e(28399),B=e.n(M),T=e(62278),D=e.n(T),f=e(58909),H=e(98488),Y=e(79341),q=e(52808),re=e(44395),ce=e(67057),d=e.n(ce),h=e(90262),c=e(58551);const C=[[["","slot","channelspanel"]],[["","slot","selectionactions"]]],j=["[slot='channelsPanel']","[slot='selectionActions']"];function Q(de,W){de&1&&r.\u0275\u0275projection(0)}function ae(de,W){de&1&&r.\u0275\u0275projection(0,1)}function pe(de,W){de&1&&r.\u0275\u0275element(0,"div",10)}function ue(de,W){if(de&1){const Z=r.\u0275\u0275getCurrentView();r.\u0275\u0275elementStart(0,"div",6),r.\u0275\u0275template(1,pe,1,0,"div",7),r.\u0275\u0275elementStart(2,"div",8)(3,"crt-slide-toggle",9),r.\u0275\u0275pipe(4,"translate"),r.\u0275\u0275pipe(5,"translate"),r.\u0275\u0275listener("toggleChange",function(se){r.\u0275\u0275restoreView(Z);const ne=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(ne.onExternalPublishingChange(se))})("keydown.enter",function(){r.\u0275\u0275restoreView(Z);const se=r.\u0275\u0275nextContext(2);return r.\u0275\u0275resetView(se.onExternalPublishingEnter())}),r.\u0275\u0275elementEnd()()()}if(de&2){const Z=r.\u0275\u0275nextContext(2);r.\u0275\u0275advance(),r.\u0275\u0275property("ngIf",Z.showFooterDivider),r.\u0275\u0275advance(2),r.\u0275\u0275property("default",Z.forExternal)("useDefaultWidth",!0),r.\u0275\u0275attribute("title",r.\u0275\u0275pipeBind1(4,5,"Feed.ExternalUserTagTooltip"))("aria-label",r.\u0275\u0275pipeBind1(5,7,"Feed.ExternalUserTagTooltip"))}}function Ee(de,W){if(de&1&&r.\u0275\u0275template(0,ue,6,9,"div",5),de&2){const Z=r.\u0275\u0275nextContext();r.\u0275\u0275property("ngIf",Z.allowExternalPost)}}let te=class Ue extends re.Z{set composerEvent(W){W?.forEach(Z=>{Z?.name===f.Od&&(this.footerPanelIndent=Z?.params.offset)})}set allowExternalPost(W){this._allowExternalPost=W}get allowExternalPost(){return this._allowExternalPost&&!this._userInfo.isSSP}get showFooterDivider(){return!!(this.footerPanelIndent>0||this.channelsPanel?.length>0&&this.channelsPanel.first?.isVisible)}constructor(W,Z,k,se,ne,me,Me){super(W),this._feedMessageComposerService=Z,this._messageDialogProvider=k,this._maskService=se,this._feedMentionServiceFactory=ne,this._translateService=me,this._userInfo=Me,this._attachments=[],this._forExternalDefault=!1,this._forExternal=!1,this._allowExternalPost=!1,this._feedComposerTypeName="Feed",this._sendExternalBtnIcon="send-external-button-icon",this.footerPanelIndent=0,this.messageChangesCanceled=new r.EventEmitter,this.messagePosted=new r.EventEmitter,this.feedMentionService=this._feedMentionServiceFactory.getInstance(null,null),this._googleTagManager=W.get(p.A),this.notifyService=this.injector.get(U.F)}get _isNewMessage(){return(0,M.isEmpty)(this._messageId)}get _isChildMessage(){return!(0,M.isEmpty)(this._parentMessageId)}set parentMessageId(W){this._parentMessageId=W}set messageId(W){this._messageId=W}set message(W){this._message=W}set schemaUId(W){this._schemaUId=W}set forExternal(W){this._forExternal=W}get forExternal(){return this._forExternal}set forExternalDefault(W){this._forExternal=W,this._forExternalDefault=W}get forExternalDefault(){return this._forExternalDefault}get disabled(){return this.cardState===y.n.Add}get sendButtonIcon(){return this.forExternal?this._sendExternalBtnIcon:""}get placeholder(){const W=this.disabled?"Feed.Publisher.DisabledInputPlaceholder":"Feed.Publisher.DefaultInputPlaceholder";return this._translateService.instant(W)}get cacheCode(){const W=this._userInfo?.id;if(!this._isNewMessage||this._isChildMessage||(0,M.isEmpty)(W)||!(0,M.isEmpty)(this.entitySchemaName)&&(0,M.isEmpty)(this.primaryColumnValue))return"";let Z=`feed_composer_cache_data_${W}_`;return!(0,M.isEmpty)(this.entitySchemaName)&&!(0,M.isEmpty)(this.primaryColumnValue)&&(Z+=`${this.entitySchemaName}_${this.primaryColumnValue}`),Z}_getMessage(){const W=this._isNewMessage?(0,m.qv)():this._messageId,Z=this.baseComposer.attachments.map(k=>({...k,recordId:W,fileEntitySchemaName:"FeedFile",recordEntitySchemaName:"SocialMessage",recordColumnName:"RecordId"}));return this.baseComposer.saveInlineImagesToDb({schemaName:"SocialMessage",recordId:W,fileSchemaName:"FeedFile",recordColumnName:"RecordId"}).pipe((0,T.map)(()=>({Id:W,Message:this.baseComposer.getValue(),EntityId:this.primaryColumnValue,EntitySchemaName:this.entitySchemaName,Attachments:Z,EntitySchemaUId:this._schemaUId,UserAccess:this._forExternal?O.U.External:O.U.General})))}_onFeedMessagePublishError(){this._messageDialogProvider.error("Feed.Publisher.PostingErrorMsg"),this._maskService.hideBodyMask()}_onFeedMessageSuccessfullyPosted(W){this.baseComposer.clear(),this._forExternal=this._forExternalDefault,this._maskService.hideBodyMask(),this.notifyService.show({message:"MessageComposer.MessageSent"}),this.messagePosted.emit(W),this._sendGTMData()}_sendGTMData(){const W={moduleName:this._feedComposerTypeName,schemaName:"FeedComposer",action:"FeedPostAdded"};this._googleTagManager.track(W)}_createOrUpdateChildMessage(W){return this._isNewMessage?this._feedMessageComposerService.postChildMessage(W,this._parentMessageId):this._feedMessageComposerService.updateChildMessage(W)}_createOrUpdateMessage(W){return this._isNewMessage?this._feedMessageComposerService.postMessage(W):this._feedMessageComposerService.updateMessage(W)}_composeFeedMessage(W){return this._isChildMessage?this._createOrUpdateChildMessage(W):this._createOrUpdateMessage(W)}_validate(){const Z=(this.baseComposer?.getValue()||"").replace(/<(?!img)[^>]*>|\s|&nbsp;/g,""),k=!(0,M.isEmpty)(Z);return k||this._messageDialogProvider.info("Feed.Publisher.PostingEmptyMsg"),k}_confirmPublish(){if(this._isNewMessage&&this.allowExternalPost||this.forExternalDefault===this.forExternal||!this.forExternal)return Promise.resolve(!0);const W=this._isChildMessage?"Feed.Publisher.ConfirmCommentAccessLevelChange":"Feed.Publisher.ConfirmMessageAccessLevelChange";return(0,T.lastValueFrom)(this._messageDialogProvider.confirmation(W))}_loadAttachments(W,Z,k){this._feedMessageComposerService.loadAttachments(W,Z,k).subscribe(se=>{this._attachments=se?se.map(ne=>{const me=new File([],ne.fileName);return{id:ne.fileId,size:ne.fileSize,file:me,content:new ArrayBuffer(0)}}):[],this.baseComposer&&(this.baseComposer.attachments=this._attachments,this.changeDetectorRef.detectChanges())})}ngOnChanges(W){const Z=W.primaryColumnValue?.currentValue||this.primaryColumnValue,k=W.entitySchemaName?.currentValue||this.entitySchemaName,se=W.schemaUId?.currentValue||this._schemaUId,ne=W.messageId?.currentValue;(0,M.isEmpty)(ne)||this._loadAttachments(ne,se,Z),Z&&(se||k)&&(this.feedMentionService=this._feedMentionServiceFactory.getInstance(Z,k,se))}onMessagePublish(){var W=this;return(0,n.A)(function*(){if(!(!W._validate()||!(yield W._confirmPublish()))){W._maskService.showBodyMask();try{W._getMessage().pipe((0,T.concatMap)(Z=>W._composeFeedMessage(Z)),(0,T.concatMap)(Z=>((0,m.gZ)(Z)?W._onFeedMessagePublishError():W._onFeedMessageSuccessfullyPosted(Z),(0,T.of)(!0)))).subscribe({error:()=>W._onFeedMessagePublishError()})}catch{W._onFeedMessagePublishError()}}})()}onMessageChangesCancel(){this._forExternal=this._forExternalDefault,this.messageChangesCanceled.emit()}ngAfterViewInit(){(0,M.isEmpty)(this._message)||this.baseComposer.setValue(this._message),this.baseComposer.attachments=this._attachments,this.sendComponentReadyEvent(this._feedComposerTypeName)}focus(){this.baseComposer?.focus()}onExternalPublishingChange(W){this._forExternal=W?.checked??!1,this.focus()}onExternalPublishingEnter(){this._forExternal=!this._forExternal}onNewMention(W){this.forExternal||(this._forExternal=!!W?.find(Z=>Z.connectionType===`${O.U.External}`),this.changeDetectorRef.detectChanges())}static{this.\u0275fac=function(Z){return new(Z||Ue)(r.\u0275\u0275directiveInject(r.Injector),r.\u0275\u0275directiveInject(H.D),r.\u0275\u0275directiveInject(g.r),r.\u0275\u0275directiveInject(o.s),r.\u0275\u0275directiveInject(Y.o),r.\u0275\u0275directiveInject(I.TranslateService),r.\u0275\u0275directiveInject(x.oq))}}static{this.\u0275cmp=r.\u0275\u0275defineComponent({type:Ue,selectors:[["crt-feed-composer"]],contentQueries:function(Z,k,se){if(Z&1&&r.\u0275\u0275contentQuery(se,q.B,4),Z&2){let ne;r.\u0275\u0275queryRefresh(ne=r.\u0275\u0275loadQuery())&&(k.channelsPanel=ne)}},inputs:{primaryColumnValue:"primaryColumnValue",cardState:"cardState",entitySchemaName:"entitySchemaName",composerEvent:"composerEvent",allowExternalPost:"allowExternalPost",parentMessageId:"parentMessageId",messageId:"messageId",message:"message",schemaUId:"schemaUId",forExternal:"forExternal",forExternalDefault:"forExternalDefault"},outputs:{messageChangesCanceled:"messageChangesCanceled",messagePosted:"messagePosted"},features:[r.\u0275\u0275InheritDefinitionFeature,r.\u0275\u0275NgOnChangesFeature],ngContentSelectors:j,decls:8,vars:12,consts:[["baseComposer",""],["channelSelector",""],["selectionActions",""],["footerPanelOptions",""],[3,"selectionChange","messageInputFocus","messageInputBlur","messageInputClick","messagePublish","messageChangesCancel","newMention","composerCacheCode","inputPlaceHolder","footerPanelExpanded","mentionsService","sendingButtonDisabled","disabled","footerPanelIndent","footerPanelOptions","channelSelector","selectionActions","disableSelectionOptions","sendButtonIcon"],["class","feed-composer-footer",4,"ngIf"],[1,"feed-composer-footer"],["class","feed-composer-footer-divider",4,"ngIf"],[1,"feed-composer-footer-external-slide-wrap"],["data-qa","post-for-external","title","External","labelPosition","'after'",3,"toggleChange","keydown.enter","default","useDefaultWidth"],[1,"feed-composer-footer-divider"]],template:function(Z,k){if(Z&1){const se=r.\u0275\u0275getCurrentView();r.\u0275\u0275projectionDef(C),r.\u0275\u0275elementStart(0,"crt-base-message-composer",4,0),r.\u0275\u0275listener("selectionChange",function(me){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onSelectionChange(me))})("messageInputFocus",function(){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onMessageInputFocus())})("messageInputBlur",function(){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onMessageInputBlur())})("messageInputClick",function(){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onMessageInputClick())})("messagePublish",function(){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onMessagePublish())})("messageChangesCancel",function(){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onMessageChangesCancel())})("newMention",function(me){return r.\u0275\u0275restoreView(se),r.\u0275\u0275resetView(k.onNewMention(me))}),r.\u0275\u0275elementEnd(),r.\u0275\u0275template(2,Q,1,0,"ng-template",null,1,r.\u0275\u0275templateRefExtractor)(4,ae,1,0,"ng-template",null,2,r.\u0275\u0275templateRefExtractor)(6,Ee,1,1,"ng-template",null,3,r.\u0275\u0275templateRefExtractor)}if(Z&2){const se=r.\u0275\u0275reference(3),ne=r.\u0275\u0275reference(5),me=r.\u0275\u0275reference(7);r.\u0275\u0275property("composerCacheCode",k.cacheCode)("inputPlaceHolder",k.placeholder)("footerPanelExpanded",k.footerPanelExpanded)("mentionsService",k.feedMentionService)("sendingButtonDisabled",k.disabled)("disabled",k.disabled)("footerPanelIndent",k.footerPanelIndent)("footerPanelOptions",me)("channelSelector",se)("selectionActions",ne)("disableSelectionOptions",k.disableSelectionOptions)("sendButtonIcon",k.sendButtonIcon)}},dependencies:[ce.NgIf,h.G,c.l,I.TranslatePipe],styles:[".feed-composer-footer[_ngcontent-%COMP%]{display:flex;flex:auto}.feed-composer-footer-external-slide-wrap[_ngcontent-%COMP%]{width:auto}.feed-composer-footer-divider[_ngcontent-%COMP%]{margin-top:4px;margin-inline-end:24px;margin-inline-start:20px;height:16px;border-left:1px solid var(--crt-palette-border-500)}"]})}};(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String)],te.prototype,"primaryColumnValue",void 0),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String)],te.prototype,"cardState",void 0),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String)],te.prototype,"entitySchemaName",void 0),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",Array),(0,i.__metadata)("design:paramtypes",[Array])],te.prototype,"composerEvent",null),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],te.prototype,"allowExternalPost",null),(0,i.__decorate)([(0,_.j)(),(0,i.__metadata)("design:type",Object)],te.prototype,"messageChangesCanceled",void 0),(0,i.__decorate)([(0,_.j)(),(0,i.__metadata)("design:type",r.EventEmitter)],te.prototype,"messagePosted",void 0),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String),(0,i.__metadata)("design:paramtypes",[String])],te.prototype,"parentMessageId",null),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String),(0,i.__metadata)("design:paramtypes",[String])],te.prototype,"messageId",null),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String),(0,i.__metadata)("design:paramtypes",[String])],te.prototype,"message",null),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",String),(0,i.__metadata)("design:paramtypes",[String])],te.prototype,"schemaUId",null),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],te.prototype,"forExternal",null),(0,i.__decorate)([(0,u.k)(),(0,i.__metadata)("design:type",Boolean),(0,i.__metadata)("design:paramtypes",[Boolean])],te.prototype,"forExternalDefault",null),te=(0,i.__decorate)([(0,l.v)({type:"crt.FeedComposer",contentSlots:["channelsPanel","selectionActions"],reuseStrategy:E.B.Reuse}),(0,b.f)({propertiesPanelComponentTypeName:"crt.FeedComposerPropertiesPanel",viewElementGroupType:F.J.CustomElements,typeCaption:"MessageComposer.Feed.Caption"}),(0,i.__metadata)("design:paramtypes",[r.Injector,H.D,g.r,o.s,Y.o,I.TranslateService,x.oq])],te)},87300:(G,A,e)=>{e.d(A,{V:()=>d});var n=e(5960),i=e.n(n),s=e(15783),r=e.n(s),t=e(22307),y=e.n(t),m=e(77592),u=e(34760),_=e(1034),l=e(96677),E=e(52793),b=e(10098),F=e(38071),I=e(68712),S=e(90204),U=e(28399),o=e.n(U),p=e(62278),g=e.n(p),O=e(58909),x=e(36122),M=e(67057),B=e.n(M),T=e(52808);const D=["items"],f=["composerHeader"],H=["selectorActions"],Y=["container"],q=h=>({display:h});function re(h,c){h&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"div",null,1),t.\u0275\u0275elementContainerEnd())}function ce(h,c){if(h&1){const C=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",6,2)(2,"crt-channel-selector",7),t.\u0275\u0275listener("selectedChannelIndexChange",function(Q){t.\u0275\u0275restoreView(C);const ae=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(ae.onSelectedChannelIndexChange(Q))}),t.\u0275\u0275elementEnd()()}if(h&2){const C=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngStyle",t.\u0275\u0275pureFunction1(3,q,C.getChannelSelectorVisible()?"unset":"none")),t.\u0275\u0275advance(2),t.\u0275\u0275property("channels",C.items)("selectedChannelIndex",C.selectedComposerChannelIndex)}}let d=class We extends I.K{get _visibleItems(){return this.items?.filter(c=>c.visible!==!1)}get visibleTemplate(){const c=this.itemsTemplates?.length>this.selectedComposerChannelIndex?this.selectedComposerChannelIndex:0;return this.itemsTemplates?.get(c)}get renderEmbededChannelSelector(){return this._featureService.getFeatureState("ExtendableMessageComposer").pipe((0,p.map)(c=>!c))}set defaultChannel(c){(0,U.isEmpty)(c)||(this._defaultChannel=c,this._setDefaultComposer())}get items(){return this._items}set items(c){this._items=c,this._setDefaultComposer()}set composerEvent(c){c?.forEach(C=>{switch(C?.name){case O.iQ:this._handleComposerReady(C.params?.composerSchemaType);break;case O.An:C.params&&(this._isVisible=C.params?.isFocused,this._updateOffsetOnFocus());break;case O.M7:this._handleReplyActionEvent({emailId:C.params?.emailId,action:C.params?.action})}})}set selectedComposerChannelIndex(c){this._isVisible=!1,this._selectedChannelIndex$.next(c),this.changeDetectorRef.markForCheck()}get selectedComposerChannelIndex(){return this._selectedChannelIndex$.value}constructor(c,C){super(c),this._changeComposerService=C,this._defaultChannel="crt.FeedComposer",this._subscriptions=[],this._updateView=new p.Subject,this._rendered=new Map,this._selectedChannelIndex$=new p.BehaviorSubject(0),this.composerEventChange=new t.EventEmitter,this.selectedComposerChannelIndexChange=new t.EventEmitter,this.preserveContent=!0,this._subscribeToChangeComposerEvent(this._changeComposerService),this._featureService=c.get(F.wf)}_setDefaultComposer(){if(!this._items)return;const c=this._visibleItems.findIndex(C=>C.type===this._defaultChannel);this.selectedComposerChannelIndex=c<0?0:c,this.selectedComposerChannelIndexChange.emit(this.selectedComposerChannelIndex)}_subscribeToChangeComposerEvent(c){this._subscriptions.push(c.getComposerObservable().subscribe(C=>{const j=this._visibleItems?.find(Q=>Q.data.schemaType===C);j&&this.showComposer(j)}))}_updateOffsetOnFocus(){!this._isVisible||!this.renderEmbededChannelSelector||window.requestAnimationFrame(()=>{if(this._isVisible&&!this.selectorActions){this._updateOffsetOnFocus();return}this.composerEventChange.emit([{name:O.Od,params:{offset:this.selectorActions?.nativeElement?.offsetWidth??0}}])})}_handleReplyActionEvent(c){const C=this.items.findIndex(Q=>Q.data?.schemaType==="Email");if(C<0)return;const j=this.items[this.selectedComposerChannelIndex];(!j||j.data?.schemaType!=="Email")&&(this._replyActionEvent=c,this.selectedComposerChannelIndex=C,this.changeDetectorRef.detectChanges()),window.requestAnimationFrame(()=>{this.composerHeader?.nativeElement?.scrollIntoView({behavior:"smooth",block:"nearest"})})}_handleComposerReady(c){const C=[];if(this._isVisible=!1,typeof c=="string"&&c==="Feed"&&this.selectorActions?.nativeElement)C.push({name:O.Od,params:{offset:this.selectorActions?.nativeElement?.offsetWidth??0}});else if(c==="Email"){const j=this.items[this.selectedComposerChannelIndex];this._replyActionEvent&&j.data?.schemaType==="Email"&&(C.push({name:O.M7,params:this._replyActionEvent}),this._replyActionEvent=null)}this.composerEventChange.emit(C)}_renderItem(c,C){if(C!==this.selectedComposerChannelIndex)return;const j=this.itemsTemplates.get(C),Q=c.createEmbeddedView(j);this._rendered.set(j,Q),this.detectChanges(),requestAnimationFrame(()=>{const ae=Q.rootNodes.filter(pe=>!(pe instanceof Comment));this._setVisibilityInDom(ae,"unset")})}_changeItemVisibility(c,C,j){const Q=C.rootNodes.filter(ae=>!(ae instanceof Comment));c===this.selectedComposerChannelIndex?this._setVisibilityInDom(Q,"unset"):this._setVisibilityInDom(Q,"none")}_setVisibilityInDom(c,C){c.forEach(j=>{const Q=j;Q.style.display=C,C==="none"?Q.classList.remove("rendered"):Q.classList.add("rendered")})}_destroyRenderedItem(c){this._rendered.get(c)?.destroy(),this._rendered.delete(c)}showComposer(c){this.selectedComposerChannelIndex=this.items.indexOf(c)}showItem(){this.containers?.forEach((c,C)=>{const j=this.itemsTemplates.get(C);if(!j)return;const Q=this._rendered.get(j);if(!Q){this._renderItem(c,C);return}if(this.preserveContent){this._changeItemVisibility(C,Q);return}C!==this.selectedComposerChannelIndex&&this._destroyRenderedItem(j)})}ngAfterViewInit(){this._subscriptions.push(this._updateView.asObservable().pipe((0,p.debounceTime)(0)).subscribe(()=>{this.showItem()})),this._subscriptions.push((0,p.merge)(this._selectedChannelIndex$.asObservable()).subscribe(()=>{this._updateView.next()}))}ngOnDestroy(){this._subscriptions.forEach(c=>c?.unsubscribe())}onSelectedChannelIndexChange(c){this.selectedComposerChannelIndex=c}getChannelSelectorVisible(){return this._isVisible?!!(this._visibleItems&&this._visibleItems.length>1):!1}static{this.\u0275fac=function(C){return new(C||We)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(x.I))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:We,selectors:[["crt-message-composer-selector"]],contentQueries:function(C,j,Q){if(C&1&&t.\u0275\u0275contentQuery(Q,D,4,t.TemplateRef),C&2){let ae;t.\u0275\u0275queryRefresh(ae=t.\u0275\u0275loadQuery())&&(j.itemsTemplates=ae)}},viewQuery:function(C,j){if(C&1&&(t.\u0275\u0275viewQuery(f,5),t.\u0275\u0275viewQuery(H,5),t.\u0275\u0275viewQuery(Y,5,t.ViewContainerRef)),C&2){let Q;t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(j.composerHeader=Q.first),t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(j.selectorActions=Q.first),t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(j.containers=Q)}},inputs:{defaultChannel:"defaultChannel",items:"items",composerEvent:"composerEvent",selectedComposerChannelIndex:"selectedComposerChannelIndex",preserveContent:"preserveContent"},outputs:{composerEventChange:"composerEventChange",selectedComposerChannelIndexChange:"selectedComposerChannelIndexChange"},features:[t.\u0275\u0275ProvidersFeature([]),t.\u0275\u0275InheritDefinitionFeature],decls:6,vars:4,consts:[["composerHeader",""],["container",""],["selectorActions",""],[1,"message-composer-selector"],[4,"ngFor","ngForOf"],["class","message-composer-selector-actions",3,"ngStyle",4,"ngIf"],[1,"message-composer-selector-actions",3,"ngStyle"],[3,"selectedChannelIndexChange","channels","selectedChannelIndex"]],template:function(C,j){C&1&&(t.\u0275\u0275elementStart(0,"div",3),t.\u0275\u0275element(1,"div",null,0),t.\u0275\u0275template(3,re,3,0,"ng-container",4)(4,ce,3,5,"div",5),t.\u0275\u0275pipe(5,"async"),t.\u0275\u0275elementEnd()),C&2&&(t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",j.itemsTemplates),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(5,2,j.renderEmbededChannelSelector)))},dependencies:[M.NgForOf,M.NgIf,M.NgStyle,T.B,M.AsyncPipe],styles:[`.message-composer-selector{position:relative;min-height:32px}.message-composer-selector-actions{position:absolute;bottom:0;display:flex}
`],encapsulation:2,data:{animation:[(0,s.trigger)("collapse",[(0,s.state)("false",(0,s.style)({height:s.AUTO_STYLE,visibility:s.AUTO_STYLE,overflow:"hidden",opacity:1})),(0,s.state)("true",(0,s.style)({height:"0",visibility:"hidden",overflow:"hidden",opacity:0})),(0,s.transition)("false => true",(0,s.animate)("300ms ease-in")),(0,s.transition)("true => false",(0,s.animate)("300ms ease-out"))])]}})}};(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String),(0,n.__metadata)("design:paramtypes",[String])],d.prototype,"defaultChannel",null),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],d.prototype,"items",null),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],d.prototype,"composerEvent",null),(0,n.__decorate)([(0,u.j)(),(0,n.__metadata)("design:type",Object)],d.prototype,"composerEventChange",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Number),(0,n.__metadata)("design:paramtypes",[Number])],d.prototype,"selectedComposerChannelIndex",null),(0,n.__decorate)([(0,u.j)(),(0,n.__metadata)("design:type",Object)],d.prototype,"selectedComposerChannelIndexChange",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Object)],d.prototype,"preserveContent",void 0),d=(0,n.__decorate)([(0,_.v)({type:"crt.MessageComposerSelector",contentSlots:[{name:"items",lazy:!0,input:!0}],reuseStrategy:l.B.Reuse}),(0,E.f)({toolbarConfig:{position:250,defaultPropertyValues:{items:[],name:"MessageComposer_"+S.N},icon:e(62127)},propertiesPanelComponentTypeName:"crt.MessageComposerPropertiesPanel",viewElementGroupType:b.J.Components,typeCaption:"Components.MessageComposer.Caption"}),(0,n.__metadata)("design:paramtypes",[t.Injector,x.I])],d)},2126:(G,A,e)=>{e.d(A,{m:()=>B});var n=e(22307),i=e.n(n),s=e(59247),r=e.n(s),t=e(6530),y=e(79772),m=e.n(y),u=e(59969),_=e(32625),l=e(28399),E=e.n(l),b=e(67057),F=e.n(b),I=e(84137),S=e(66803),U=e(12325),o=e(37851),p=e.n(o),g=e(82650);const O=["selectedRecipient"],x=T=>({"recipient-not-valid":T});function M(T,D){if(T&1){const f=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",7,0),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275listener("keydown.delete",function(){const Y=n.\u0275\u0275restoreView(f).$implicit,q=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(q.removeRecipient(Y.value))}),n.\u0275\u0275elementStart(3,"crt-label",8),n.\u0275\u0275pipe(4,"encodeHtml"),n.\u0275\u0275text(5),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"mat-icon",9),n.\u0275\u0275pipe(7,"translate"),n.\u0275\u0275listener("click",function(){const Y=n.\u0275\u0275restoreView(f).$implicit,q=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(q.removeRecipient(Y.value))})("keydown.enter",function(){const Y=n.\u0275\u0275restoreView(f).$implicit,q=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(q.removeRecipient(Y.value))}),n.\u0275\u0275elementEnd()()}if(T&2){const f=D.$implicit,H=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(11,x,!H.validateRecipient(f))),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,5,H.recipientLabel)),n.\u0275\u0275advance(3),n.\u0275\u0275property("crtTooltip",n.\u0275\u0275pipeBind1(4,7,H.getTooltip(f))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate1(" ",H.getRecipientDisplayValue(f)," "),n.\u0275\u0275advance(),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(7,9,"MessageComposer.Email.RemoveRecipientLabel"))}}class B extends _.g{get dropDownRecipients(){return this.filteredRecipients.filter(D=>!this.selectedRecipients.some(f=>D.displayValue===f.displayValue))}set rawRecipinets(D){D&&this._loadRecipients(D,this.recipientSearchControl.value,this._rawRecipients.length)}set recipientLabelWidth(D){D&&(this._labelWidth=D+"px")}constructor(D,f,H){super(D,null,f),this._translateService=H,this._hasNextPage=!0,this._rawRecipients=[],this._filterValue="",this.recipientSearchControl=new s.FormControl(null),this.selectedRecipients=new Array,this.filteredRecipients=new Array,this._labelWidth="136px",this.loadRecipients=new n.EventEmitter,this.recipientsChanged=new n.EventEmitter,this.recipientSearchControl.valueChanges.subscribe(Y=>this._selectRecipient(Y))}_selectRecipient(D){D&&D.value&&!this.selectedRecipients.some(f=>f.displayValue===D.displayValue)&&(this.selectedRecipients.push(D),this.recipientsChanged.emit(this.selectedRecipients.map(f=>f.displayValue)))}_setRecipientsComboboxList(D,f=!1){this._rawRecipients=f?[...this._rawRecipients,...D]:D;const H=D.map(Y=>Y.emails).flat(1).filter(Y=>Y.displayValue.toLowerCase().includes(this._filterValue?.toLowerCase()||""));this.filteredRecipients=f?[...this.filteredRecipients,...H]:H}_loadRecipients(D,f,H=0){this.recipientsLoading=!0,this._hasNextPage=D.length>0,D&&D.length>0?this._setRecipientsComboboxList(D,H>0):H===0&&!(0,l.isEmpty)(f)&&(f.includes(";")||f.includes(",")?this._selectPastedEmails(f):this._setRecipientsComboboxList([{emails:[this._mapRecipient(f)]}])),this.recipientsLoading=!1,this.changeDetectorRef.markForCheck()}_selectPastedEmails(D){D.split(/[;,]/).map(f=>f.trim()).filter(f=>!(0,l.isEmpty)(f)).forEach(f=>{this._selectRecipient(this._mapRecipient(f))}),this.clearCombobox(),window.requestAnimationFrame(()=>{this.selectedRecipient.last?.nativeElement?.focus()})}_mapRecipient(D){return{value:(0,t.qv)(),displayValue:D.trim()}}getRecipients(){return this.selectedRecipients?this.selectedRecipients.map(D=>D.displayValue):[]}setRecipients(D){this.selectedRecipients=D?.filter(f=>!(0,l.isEmpty)(f)).map(f=>this._mapRecipient(f))}clear(){this.clearCombobox(),this.selectedRecipients=[],this.recipientsChanged.emit([])}validate(){return this.selectedRecipients.length>0&&this.selectedRecipients.filter(D=>!this.validateRecipient(D)).length===0}searchRecipients(D){(0,l.isEmpty)(D)&&(D={viewElement:"crt.ComboBox",filterValue:null}),this._rawRecipients=[],this.filteredRecipients=[],this._filterValue=D.filterValue,this.loadRecipients.emit({query:D.filterValue,recipientsLength:0})}clearCombobox(){this._hasNextPage=!0,this.recipientSearchControl.setValue(null)}removeRecipient(D){this.selectedRecipients=this.selectedRecipients.filter(f=>f.value!==D),this.recipientsChanged.emit(this.selectedRecipients.map(f=>f.displayValue)),this.changeDetectorRef.markForCheck()}getRecipientDisplayValue(D){const f=new RegExp(`\\s?<${u.Eu}>`,"g"),H=new RegExp(/^;+|;+$/,"g"),Y=new RegExp(/[^\s]/,"g"),q=D.displayValue.replace(f,"").replace(H,"");return Y.test(q)?q:D.displayValue}validateRecipient(D){return(0,u.m2)(D.displayValue)}getTooltip(D){return this.validateRecipient(D)?(0,u.Z6)(D.displayValue)?"":D.displayValue:`"${D.displayValue}" ${this._translateService.instant("MessageComposer.Email.NotContainsEmail")}`}loadNextPage(){this._hasNextPage&&(this.recipientsLoading=!0,this.loadRecipients.emit({query:this.recipientSearchControl.value,recipientsLength:this._rawRecipients.length}))}static{this.\u0275fac=function(f){return new(f||B)(n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(y.TranslateService))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:B,selectors:[["crt-recipient-search"]],viewQuery:function(f,H){if(f&1&&n.\u0275\u0275viewQuery(O,5,n.ElementRef),f&2){let Y;n.\u0275\u0275queryRefresh(Y=n.\u0275\u0275loadQuery())&&(H.selectedRecipient=Y)}},hostVars:2,hostBindings:function(f,H){f&2&&n.\u0275\u0275styleProp("--labelWidth",H._labelWidth)},inputs:{rawRecipinets:"rawRecipinets",recipientLabel:"recipientLabel",recipientLabelWidth:"recipientLabelWidth"},outputs:{loadRecipients:"loadRecipients",recipientsChanged:"recipientsChanged"},features:[n.\u0275\u0275InheritDefinitionFeature],decls:8,vars:9,consts:[["selectedRecipient",""],[1,"recipients-container"],[1,"recipients-label-container"],["labelType","caption"],[1,"selected-recipients-container"],["class","selected-recipient","tabindex","0",3,"ngClass","keydown.delete",4,"ngFor","ngForOf"],["labelPosition","none","data-item-marker","recipients-search-combobox",3,"closed","showList","paginationChange","control","items","loading","debounceTime","appearance"],["tabindex","0",1,"selected-recipient",3,"keydown.delete","ngClass"],["labelEllipsis","true",1,"selected-recipient-label",3,"crtTooltip"],["svgIcon","message-composer-attach-cross","data-qa","selected-recipient-remove-button","tabindex","0",1,"selected-recipient-remove-button",3,"click","keydown.enter"]],template:function(f,H){f&1&&(n.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"crt-label",3),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"div",4),n.\u0275\u0275template(6,M,8,13,"div",5),n.\u0275\u0275elementStart(7,"crt-combobox",6),n.\u0275\u0275listener("closed",function(){return H.clearCombobox()})("showList",function(q){return H.searchRecipients(q)})("paginationChange",function(){return H.loadNextPage()}),n.\u0275\u0275elementEnd()()()),f&2&&(n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(4,7,H.recipientLabel)," "),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngForOf",H.selectedRecipients),n.\u0275\u0275advance(),n.\u0275\u0275property("control",H.recipientSearchControl)("items",H.dropDownRecipients)("loading",H.recipientsLoading)("debounceTime",100)("appearance","legacy"))},dependencies:[b.NgClass,b.NgForOf,I.d,S.q,U.V,o.MatIcon,g.m,y.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}.recipients-container{display:flex;width:100%;padding-top:8px}.recipients-container .recipients-label-container{margin-inline-end:10px;display:flex;width:var(--labelWidth, 136px);min-width:var(--labelWidth, 136px);flex-direction:row-reverse}.recipients-container .recipients-label-container .crt-label{color:var(--crt-base-input-label-color);margin-top:9px}.recipients-container .selected-recipients-container{display:flex;width:calc(100% - var(--labelWidth, 136px));flex-wrap:wrap;min-height:32px;align-items:flex-end}.recipients-container .selected-recipients-container .selected-recipient{display:flex;align-items:center;background-color:var(--crt-palette-interaction-900);border-radius:12px;padding:0 12px;margin:4px 0;margin-inline-end:12px;width:min-content;max-width:calc(100% - 36px);cursor:pointer}.recipients-container .selected-recipients-container .selected-recipient label{color:var(--crt-palette-link-500)}.recipients-container .selected-recipients-container .selected-recipient.recipient-not-valid{background-color:var(--crt-palette-navigation-primary-500)}.recipients-container .selected-recipients-container .selected-recipient.recipient-not-valid label{color:var(--crt-palette-label-contrast-500)}.recipients-container .selected-recipients-container .selected-recipient:first-of-type{margin-top:9px}.recipients-container .selected-recipients-container .selected-recipient-label{max-width:100%}.recipients-container .selected-recipients-container .selected-recipient-remove-button{display:none;flex-basis:10px;height:10px;flex-grow:0;flex-shrink:0;width:unset;color:var(--crt-palette-label-500)}.recipients-container .selected-recipients-container .selected-recipient-remove-button:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:4px}.recipients-container .selected-recipients-container .selected-recipient:hover .selected-recipient-remove-button,.recipients-container .selected-recipients-container .selected-recipient:focus-within .selected-recipient-remove-button{display:flex}.recipients-container .selected-recipients-container .selected-recipient:hover .selected-recipient-label,.recipients-container .selected-recipients-container .selected-recipient:focus-within .selected-recipient-label{max-width:calc(100% - 10px)}.recipients-container .selected-recipients-container .selected-recipient:focus-visible{box-shadow:inset 0 0 0 1px var(--focus-outline-outer-color),inset 0 0 0 2px var(--focus-outline-inner-color);outline:none;border-radius:12px}
`],encapsulation:2})}}},50868:(G,A,e)=>{e.d(A,{q:()=>r});var n=e(5960),i=e.n(n),s=e(4164);let r=class{convert(y){const m=y[1],u=y[0];return m?null:u}};r=(0,n.__decorate)([(0,s.a)({type:"crt.ConditionalEmailId"})],r)},19484:(G,A,e)=>{e.d(A,{K:()=>u});var n=e(5960),i=e.n(n),s=e(6530),r=e(4164),t=e(62278),y=e.n(t),m=e(43673);let u=class{constructor(l){this._recipientsService=l}convert(l){return(0,t.lastValueFrom)(this._recipientsService.getRecipients(l.event.query,l.event.recipientsLength).pipe((0,t.map)(E=>({recipients:E,loadStamp:(0,s.qv)()}))))}};u=(0,n.__decorate)([(0,r.a)({type:"crt.ToRecipientsMailboxes"}),(0,n.__metadata)("design:paramtypes",[m.e])],u)},21122:(G,A,e)=>{e.d(A,{m:()=>u});var n=e(5960),i=e.n(n),s=e(4164),r=e(23092),t=e(62278),y=e.n(t),m=e(2047);let u=class{constructor(l,E){this._mailboxesService=l,this._userInfoService=E}convert(){return(0,t.lastValueFrom)(this._userInfoService.loadCurrentUserInfo().pipe((0,t.concatMap)(l=>this._mailboxesService.getMailboxesForSend(l?.userInfo.id))))}};u=(0,n.__decorate)([(0,s.a)({type:"crt.ToSendersMailboxes"}),(0,n.__metadata)("design:paramtypes",[m.W,r.fv])],u)},48531:(G,A,e)=>{e.d(A,{B:()=>t});var n=e(41287),i=e(93338),s=e(16296),r=e(58909);class t extends n.l{constructor(){super(...arguments),this.action=s.T.Reply}_processReply(m){const u=Object.keys(m.$context.attributes).filter(_=>_.startsWith(i._));u.length&&u.forEach(_=>m.$context[_]=[{name:r.M7,params:{emailId:m.recordId,action:this.action}}])}handle(m){return new Promise(u=>{this._processReply(m),u()})}}},99553:(G,A,e)=>{e.d(A,{E:()=>_});var n=e(73308),i=e(5960),s=e.n(i),r=e(41287),t=e(844),y=e(62278),m=e.n(y),u=e(2047);let _=class extends r.l{constructor(E){super(),this._service=E}handle(E){var b=this;return(0,n.A)(function*(){const F=E.recordId,I=yield(0,y.firstValueFrom)(b._service.getCaseDefaultMailbox(F));return I?.senderEmailAddress?I?.senderEmailAddress:yield b.next?.handle(E)})()}};_=(0,i.__decorate)([(0,t.l)({type:"crt.CaseSenderComposerHandler",requestType:"crt.CaseSenderComposerRequest"}),(0,i.__metadata)("design:paramtypes",[u.W])],_)},74575:(G,A,e)=>{e.d(A,{H:()=>m});var n=e(73308),i=e(5960),s=e.n(i),r=e(41287),t=e(844),y=e(36122);let m=class extends r.l{constructor(_){super(),this._service=_}handle(_){var l=this;return(0,n.A)(function*(){l._service.openComposer(_.composerSchemaType),yield l.next?.handle(_)})()}};m=(0,i.__decorate)([(0,t.l)({type:"crt.ChangeComposerHandler",requestType:"crt.ChangeComposerRequest"}),(0,i.__metadata)("design:paramtypes",[y.I])],m)},13787:(G,A,e)=>{e.d(A,{e:()=>g});var n=e(73308),i=e(5960),s=e.n(i),r=e(61541),t=e(844),y=e(40968),m=e(59969),u=e(38071),_=e(95145),l=e(29858),E=e(55359),b=e(66446),F=e(28399),I=e.n(F),S=e(62278),U=e.n(S),o=e(48531),p=e(16296);let g=class extends o.B{constructor(x,M,B,T){super(),this._featureService=x,this._entityConnectionService=M,this._sysSettingsService=B,this._window=T,this._freedomUiType="f4d757e1-2aeb-496f-b751-3d5b39708ea3",this._uiTypeSysSettingCode="EditPagesUITypeForFreedomHost",this.action=p.T.EditDraft}_openEditPage(x){var M=this;return(0,n.A)(function*(){let B;const T=(0,F.get)(M._window,["Terrasoft","isAngularHost"]),D=yield(0,S.lastValueFrom)(M._sysSettingsService.getValueByCode(M._uiTypeSysSettingCode));T&&D===M._freedomUiType?B={type:"crt.OpenPageRequest",schemaName:"EmailMiniPage",modelInitConfigs:[{recordId:x.recordId,action:r.n.Edit}],$context:x.$context}:B={type:"crt.UpdateRecordRequest",entityName:"Activity",recordId:x.recordId,$context:x.$context},yield M.handlerChain.process(B)})()}_openAddPage(x){var M=this;return(0,n.A)(function*(){const B=yield b.a.getPageSchemaNameForAction({entityName:"Activity",action:r.n.Add,typeColumnValue:E.Iq.toLowerCase()}),T=yield M._getDefaultValues(x),D={type:"crt.CreateRecordRequest",entityName:"Activity",entityPageName:B,defaultValues:T,$context:x.$context};yield M.handlerChain.process(D)})()}_getDefaultValues(x){var M=this;return(0,n.A)(function*(){const B=[{attributeName:"Type",value:E.Iq}],T=yield x.$context.getPrimaryDataSchema(),D=T.name,f=yield x.$context[T.primaryAttributeName],H=yield M._entityConnectionService.getEntityConnectionColumns("Activity",D),{$context:Y}=x;return x.bindingColumns&&(yield Promise.all(x.bindingColumns.map(function(){var q=(0,n.A)(function*(re){const ce=yield Y[re.formAttributeName];ce&&B.push({attributeName:re.activityColumnName,value:ce.value||ce.activityAttributeName})});return function(re){return q.apply(this,arguments)}}()))),H&&H.forEach(q=>{B.push({attributeName:q.name,value:f})}),B})()}handle(x){var M=()=>super.handle,B=this;return(0,n.A)(function*(){(yield(0,S.lastValueFrom)(B._featureService.getFeatureState("UseEmailComposer")))?yield M().call(B,{recordId:x.recordId,type:"crt.ReplyEmailComposerRequest",$context:x.$context}):(0,F.isEmpty)(x.recordId)?yield B._openAddPage(x):yield B._openEditPage(x),yield B.next?.handle(x)})()}};g=(0,i.__decorate)([(0,t.l)({type:"crt.CreateEmailRequestHandler",requestType:"crt.CreateEmailRequest"}),(0,i.__param)(3,(0,y.j)(m.ZP)),(0,i.__metadata)("design:paramtypes",[u.wf,l.r,_.A,Window])],g)},37552:(G,A,e)=>{e.d(A,{x:()=>_});var n=e(73308),i=e(5960),s=e.n(i),r=e(41287),t=e(844),y=e(62278),m=e.n(y),u=e(2047);let _=class extends r.l{constructor(E){super(),this._service=E}handle(E){var b=this;return(0,n.A)(function*(){const F=E.recordId,I=yield(0,y.firstValueFrom)(b._service.getDefaultMailboxForSend(F));return I?.senderEmailAddress?I?.senderEmailAddress:yield b.next?.handle(E)})()}};_=(0,i.__decorate)([(0,t.l)({type:"crt.DefaultSenderComposerHandler",requestType:"crt.DefaultSenderComposerRequest"}),(0,i.__metadata)("design:paramtypes",[u.W])],_)},52162:(G,A,e)=>{e.d(A,{T:()=>m});var n=e(73308),i=e(5960),s=e.n(i),r=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.EditDraft}handle(_){var l=()=>super.handle,E=this;return(0,n.A)(function*(){yield l().call(E,_),yield E.next?.handle(_)})()}};m=(0,i.__decorate)([(0,r.l)({type:"crt.EditDraftEmailComposerRequestHandler",requestType:"crt.EditDraftEmailComposerRequest"}),(0,i.__metadata)("design:paramtypes",[])],m)},29373:(G,A,e)=>{e.d(A,{F:()=>U,_:()=>o});var n=e(73308),i=e(5960),s=e.n(i),r=e(22307),t=e.n(r),y=e(81517),m=e(2828),u=e(41287),_=e(844),l=e(62278),E=e.n(l),b=e(36486),F=e.n(b),I=e(58909),S=e(85688);let U=class extends y.S{};U=(0,i.__decorate)([(0,m.$)({type:"crt.EmailComposerSavedRequest"})],U);let o=class extends u.l{constructor(g){super(),this._composerEventAttrName="ComposerEvent",this._emailsService=g.get(S.d)}handle(g){var O=this;return(0,n.A)(function*(){const x=g.$context,M=g.emailWithParams;if(!M)return Promise.resolve();const B=M.params,D=x.modelInitConfigs.filter(f=>f.action==="add");return D.length===1&&D[0].defaultValues?.forEach(H=>{B.defaultValues.push({attributeName:H.attributeName,value:H.value})}),B.bindingColumns&&(yield Promise.all(B.bindingColumns.map(function(){var f=(0,n.A)(function*(H){const Y=yield x[H.formAttributeName];Y&&B.defaultValues.push({attributeName:H.activityColumnName,value:Y.value||Y.activityAttributeName})});return function(H){return f.apply(this,arguments)}}()))),(0,l.lastValueFrom)(O._emailsService.saveEmail(M.email,M.params).pipe((0,b.switchMap)(f=>{B.templateId&&(f.templateId=B.templateId);const H=Object.keys(g.$context.attributes).filter(Y=>Y.startsWith(O._composerEventAttrName));return H.length&&H.forEach(Y=>g.$context[Y]=[{name:I.J3,params:{response:f}}]),(0,l.of)({})})))})()}};o=(0,i.__decorate)([(0,_.l)({type:"crt.EmailComposerSavedHandler",requestType:"crt.EmailComposerSavedRequest"}),(0,i.__metadata)("design:paramtypes",[r.Injector])],o)},16111:(G,A,e)=>{e.d(A,{M:()=>u});var n=e(73308),i=e(5960),s=e.n(i),r=e(41287),t=e(40269),y=e(65288),m=e(844);let u=class extends r.l{_getNeedClosePage(l){var E=this;return(0,n.A)(function*(){return(yield l.$context.IsChanged)?!1:(yield l.$context.ElementExecutionData)?!(yield E._getActualSendDate(l)):!0})()}_getActualSendDate(l){return(0,n.A)(function*(){const E=yield l.$context.Id;return((yield(yield t.K.create("Activity")).load({attributes:["SendDate"],parameters:[{type:y.E.PrimaryColumnValue,value:E}]}))[0]||{}).SendDate})()}handle(l){var E=this;return(0,n.A)(function*(){if(!(yield l.$context.ComposerVisible)){yield E.next?.handle(l);return}l.$context.ComposerVisible=!1,(yield l.$context.IsReplyMode)?l.$context.IsReplyMode=!1:(yield E._getNeedClosePage(l))&&(yield E.handlerChain.process({type:"crt.ClosePageRequest",$context:l.$context})),yield E.next?.handle(l)})()}};u=(0,i.__decorate)([(0,m.l)({type:"crt.EmailFormPageComposerClearedHandler",requestType:"crt.onEmailComposerClearedRequest",scopes:["EmailFormPage"]})],u)},28307:(G,A,e)=>{e.d(A,{p:()=>b});var n=e(73308),i=e(5960),s=e.n(i),r=e(41287),t=e(844),y=e(89285),m=e(65576),u=e(28399),_=e.n(u),l=e(62278),E=e.n(l);let b=class extends r.l{_subscribeViewModelEvents(I){var S=this;const U=new l.Subscription;U.add(I.events$.pipe((0,l.filter)(({type:o})=>o===m.n.FinishLoadModelAttributes)).subscribe({next:function(){var o=(0,n.A)(function*(p){yield S._updateComposerVisibility(p,I),yield S._updateEmailBody(p,I)});return function(g){return o.apply(this,arguments)}}(),complete:()=>{U.unsubscribe()}}))}_updateComposerVisibility(I,S){return(0,n.A)(function*(){if((yield S.getPrimaryModelMode())!==y.b.Update||!I?.payload?.SendDate||!I?.payload?.Id)return;const o=yield S.Id,p=!!(yield S.SendDate);!o||p||(S.ComposerVisible=!0)})()}_updateEmailBody(I,S){return(0,n.A)(function*(){if((yield S.getPrimaryModelMode())!==y.b.Update||!I?.payload?.EmailBody||!I?.payload?.IsHtmlBody)return;const o=yield S.IsHtmlBody,p=yield S.EmailBody;!o&&!u.isEmpty(p)&&!p.startsWith("<pre>")&&(S.EmailBody=`<pre>${u.escape(p)}</pre>`)})()}handle(I){var S=this;return(0,n.A)(function*(){yield S.next?.handle(I),S._subscribeViewModelEvents(I.$context)})()}};b=(0,i.__decorate)([(0,t.l)({type:"crt.EmailFormPageViewModelInitRequestHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["EmailFormPage"]})],b)},58298:(G,A,e)=>{e.d(A,{I:()=>b});var n=e(73308),i=e(5960),s=e.n(i),r=e(41287),t=e(844),y=e(89285),m=e(65576),u=e(28399),_=e.n(u),l=e(62278),E=e.n(l);let b=class extends r.l{_subscribeViewModelEvents(I){var S=this;const U=new l.Subscription;U.add(I.events$.pipe((0,l.filter)(({type:o})=>o===m.n.FinishLoadModelAttributes)).subscribe({next:function(){var o=(0,n.A)(function*(p){yield S._tryOpenDraft(p,I),yield S._updateRecipients(p,I)});return function(g){return o.apply(this,arguments)}}(),complete:()=>{U.unsubscribe()}}))}_tryOpenDraft(I,S){var U=this;return(0,n.A)(function*(){if((yield S.getPrimaryModelMode())!==y.b.Update||!I?.payload?.SendDate||!I?.payload?.Id)return;const p=yield S.Id,g=!!(yield S.SendDate);!p||g||(yield U.handlerChain.process({type:"crt.EditDraftEmailComposerRequest",recordId:p,$context:S}))})()}_updateRecipients(I,S){return(0,n.A)(function*(){if((yield S.getPrimaryModelMode())!==y.b.Create||!I?.payload?.Recepient)return;const o=yield S.Recepient;u.isEmpty(o)||(S.EmailComposer_To=[...o.split(";")])})()}handle(I){var S=this;return(0,n.A)(function*(){yield S.next?.handle(I),S._subscribeViewModelEvents(I.$context)})()}};b=(0,i.__decorate)([(0,t.l)({type:"crt.EmailMiniPageViewModelInitRequestHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["EmailMiniPage"]})],b)},81875:(G,A,e)=>{e.d(A,{p:()=>m});var n=e(73308),i=e(5960),s=e.n(i),r=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.Forward}handle(_){var l=()=>super.handle,E=this;return(0,n.A)(function*(){yield l().call(E,_),yield E.next?.handle(_)})()}};m=(0,i.__decorate)([(0,r.l)({type:"crt.ForwardEmailComposerRequestHandler",requestType:"crt.ForwardEmailComposerRequest"}),(0,i.__metadata)("design:paramtypes",[])],m)},83743:(G,A,e)=>{e.d(A,{B:()=>u,C:()=>_});var n=e(73308),i=e(5960),s=e.n(i),r=e(81517),t=e(2828),y=e(41287),m=e(844);let u=class extends r.S{};u=(0,i.__decorate)([(0,t.$)({type:"crt.RefreshEmailRecipientsRequest"})],u);let _=class extends y.l{handle(E){var b=this;return(0,n.A)(function*(){yield b.next?.handle(E)})()}};_=(0,i.__decorate)([(0,m.l)({type:"crt.RefreshEmailRecipientsHandler",requestType:"crt.RefreshEmailRecipientsRequest"})],_)},8610:(G,A,e)=>{e.d(A,{F:()=>m});var n=e(73308),i=e(5960),s=e.n(i),r=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.ReplyAll}handle(_){var l=()=>super.handle,E=this;return(0,n.A)(function*(){yield l().call(E,_),yield E.next?.handle(_)})()}};m=(0,i.__decorate)([(0,r.l)({type:"crt.ReplyAllEmailComposerRequestHandler",requestType:"crt.ReplyAllEmailComposerRequest"}),(0,i.__metadata)("design:paramtypes",[])],m)},54880:(G,A,e)=>{e.d(A,{I:()=>m});var n=e(73308),i=e(5960),s=e.n(i),r=e(844),t=e(48531),y=e(16296);let m=class extends t.B{constructor(){super(),this.action=y.T.Reply}handle(_){var l=()=>super.handle,E=this;return(0,n.A)(function*(){yield l().call(E,_),yield E.next?.handle(_)})()}};m=(0,i.__decorate)([(0,r.l)({type:"crt.ReplyEmailComposerRequestHandler",requestType:"crt.ReplyEmailComposerRequest"}),(0,i.__metadata)("design:paramtypes",[])],m)},15841:(G,A,e)=>{e.d(A,{Q:()=>Re});var n=e(5960),i=e(67057),s=e(37851),r=e(50825),t=e(76608),y=e(55642),m=e(79772),u=e(5476),_=e(56484),l=e(59247),E=e(49393),b=e(90262),F=e(22307);class I{static{this.\u0275fac=function(V){return new(V||I)}}static{this.\u0275mod=F.\u0275\u0275defineNgModule({type:I})}static{this.\u0275inj=F.\u0275\u0275defineInjector({imports:[i.CommonModule,l.FormsModule,l.ReactiveFormsModule,E.MatSlideToggleModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&F.\u0275\u0275setNgModuleScope(I,{declarations:[b.G],imports:[i.CommonModule,l.FormsModule,l.ReactiveFormsModule,E.MatSlideToggleModule],exports:[b.G]})})();var S=e(18351),U=e(36943),o=e(59969),p=e(31149),g=e(56069),O=e(24091),x=e(57274),M=e(61148),B=e(57463),T=e(83455),D=e(72882),f=e(12841),H=e(24507),Y=e(8346),q=e(82650),re=e(87300),ce=e(30816),d=e(23854),h=e(58551),c=e(30306),C=e(52808),j=e(2126),Q=e(50868),ae=e(21122),pe=e(19484),ue=e(74575),Ee=e(54880),te=e(8610),de=e(81875),W=e(37552),Z=e(99553),k=e(52162),se=e(13787),ne=e(29373),me=e(83743),Me=e(28307),Ie=e(58298),Oe=e(16111),Ce=e(74368),X=e(93338),le=e(26594),a=e(28399);class P{constructor(N){this._featureValues=N,this._selectedChannelAttributeName="SelectedComposerChannelIndex",this._channelsAttributeName="ComposerChannels",this._selectedChannelAttributeDefValue=0,this._channelSelectorItemName="ChannelSelector",this._channelSelectorTypeName="crt.ChannelSelector",this._parentComposerType="crt.MessageComposerSelector",this._metadataSchemaUtils=(0,F.inject)(Ce.u)}_getViewConfigs(N,V){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",V,N.viewConfig).map(J=>J?.viewConfig).filter(Boolean)}_createAndBindExtendableComposerAttributes(N,V){V.forEach((J,_e)=>{if(!Array.isArray(J.items)||!J.items.length)return;let oe;(0,a.isEmpty)(J.selectedComposerChannelIndex)?(oe=`${this._selectedChannelAttributeName}_${_e}`,N[oe]={value:this._selectedChannelAttributeDefValue},J.selectedComposerChannelIndex=`$${oe}`):oe=J.selectedComposerChannelIndex;const ye=`${this._channelsAttributeName}_${_e}`,Se=[];J.items.forEach(He=>{this._createChannelSelector(He,oe,ye,Se)}),N[ye]={value:Se}})}_createChannelSelector(N,V,J,_e){const oe=N.data;if(!(!oe||(0,a.isEmpty)(oe.schemaType))&&(_e.push({visible:N.visible,data:{icon:oe.icon,schemaType:oe.schemaType,caption:oe.caption}}),(0,a.isEmpty)(N.channelsPanel))){const ye={name:`${this._channelSelectorItemName}_${N.name}`,type:this._channelSelectorTypeName,selectedChannelIndex:`$${V}`,channels:`$${J}`};N.channelsPanel=[ye]}}_createAndBindComposerEventAttribute(N,V){V.forEach((J,_e)=>{if(!Array.isArray(J.items)||!J.items.length)return;const oe=`${X._}_${_e}`;N[oe]={value:[]},J.composerEvent="$"+oe,J.items.forEach(ye=>{ye.composerEvent="$"+oe})})}_createAndBindComposerAttributes(N){const V=this._getViewConfigs(N,this._parentComposerType),J=N.viewModelConfig.attributes;this._createAndBindComposerEventAttribute(J,V),this._featureValues.ExtendableMessageComposer&&this._createAndBindExtendableComposerAttributes(J,V)}crtOnMetaDataInit(N){const V=N;return this._createAndBindComposerAttributes(V),Promise.resolve(N)}static{this.\u0275fac=function(V){return new(V||P)(F.\u0275\u0275inject(le.G))}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac})}}var R=e(73308),L=e(12404);class z{constructor(N){this._selectionActionsMetadataService=N,this._pageSize=150,this._metadataSchemaUtils=(0,F.inject)(Ce.u)}_getViewConfigs(N,V){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",V,N.viewConfig).map(J=>J?.viewConfig).filter(Boolean)}_setCrudEventsBindings(N){N.emailComposerSaved={request:"crt.EmailComposerSavedRequest",params:{emailWithParams:"@event"}},N.refreshRecipients={request:"crt.RefreshEmailRecipientsRequest",params:{event:"@event"}}}_setAttributes(N,V){V.from=`$${this._createAttribute(N,`${V.name}_From`,"")}`,V.to=`$${this._createAttribute(N,`${V.name}_To`,[])}`,V.cc=`$${this._createAttribute(N,`${V.name}_Cc`,[])}`,V.bcc=`$${this._createAttribute(N,`${V.name}_Bcc`,[])}`,V.subject=`$${this._createAttribute(N,`${V.name}_Subject`,"")}`,V.headerExpanded=`$${this._createAttribute(N,`${V.name}_HeaderExpanded`,"")}`,V.visibleCc=`$${this._createAttribute(N,`${V.name}_VisibleCc`,"")}`,V.visibleBcc=`$${this._createAttribute(N,`${V.name}_VisibleBcc`,"")}`}_setCalculatedAttributes(N,V){V.sendersMailboxes=`$${this._getOrAddEmailSendersAttribute(N,V,V.recordId)}`,V.recipientsMailboxes=`$${this._getOrAddEmailRecipientsAttribute(N,V,V.recordId)}`}_findCalculatedAttribute(N,V,J){const _e=N.viewModelConfig.attributes,oe=Object.keys(_e).find(ye=>{const Se=_e[ye]??{};return Se.from===V&&Se.converter===J});return(0,a.isEmpty)(oe)?void 0:oe}_createAttribute(N,V,J){const _e=N.viewModelConfig.attributes;return _e[V]={value:J},V}_createCalculatedAttribute(N,V,J,_e){const oe=N.viewModelConfig.attributes;return oe[V]={from:J,converter:_e},V}_getOrAddEmailSendersAttribute(N,V,J){return this._findCalculatedAttribute(N,J,"crt.ToSendersMailboxes")||this._createCalculatedAttribute(N,`${V.name}_SendersMailboxes`,J,"crt.ToSendersMailboxes")}_getOrAddEmailRecipientsAttribute(N,V,J){return this._findCalculatedAttribute(N,J,"crt.ToRecipientsMailboxes")||this._createCalculatedAttribute(N,`${V.name}_RecipientsMailboxes`,"crt.RefreshEmailRecipientsRequest","crt.ToRecipientsMailboxes")}crtOnMetaDataInit(N){var V=this;return(0,R.A)(function*(){const J=N,_e=V._getViewConfigs(J,"crt.EmailComposer");for(const oe of _e)V._setCrudEventsBindings(oe),V._setAttributes(J,oe),V._setCalculatedAttributes(J,oe),yield V._selectionActionsMetadataService.setRewriteOptions(J,oe);return Promise.resolve(N)})()}static{this.\u0275fac=function(V){return new(V||z)(F.\u0275\u0275inject(L.S))}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac})}}class v{constructor(N){this._selectionActionsMetadataService=N,this._metadataSchemaUtils=(0,F.inject)(Ce.u)}_getViewConfigs(N,V){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",V,N.viewConfig).map(J=>J?.viewConfig).filter(Boolean)}crtOnMetaDataInit(N){var V=this;return(0,R.A)(function*(){const J=N,_e=V._getViewConfigs(J,"crt.FeedComposer");for(const oe of _e)yield V._selectionActionsMetadataService.setRewriteOptions(J,oe);return Promise.resolve(N)})()}static{this.\u0275fac=function(V){return new(V||v)(F.\u0275\u0275inject(L.S))}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac})}}var $=e(86190),K=e(36122),w=e(85688),ee=e(2047),ie=e(55529),ge=e(59784),he=e(46690),fe=e(43673),ve=e(2023),Pe=e(98488),De=e(79341),be=e(43482),Fe=e(81517),Ve=e(2828);let xe=class extends Fe.S{};xe=(0,n.__decorate)([(0,Ve.$)({type:"crt.CreateEmailRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CreateEmailRequest",propertiesPanelComponentTypeName:"crt.CreateEmailRequestPropertiesPanelComponent"})],xe);function je(){const Ne=[xe]}je();let Re=class Ke{constructor(N,V){this._matIconRegistry=N,this._domSanitizer=V,this._registerIcons()}_registerIcons(){[{name:"reply-message",icon:e(5719)},{name:"reply-all-message",icon:e(90277)},{name:"forward-message",icon:e(71348)}].forEach(({name:V,icon:J})=>{this._matIconRegistry.addSvgIconLiteral(V,this._domSanitizer.bypassSecurityTrustHtml(J))})}static{this.\u0275fac=function(V){return new(V||Ke)(F.\u0275\u0275inject(s.MatIconRegistry),F.\u0275\u0275inject(t.DomSanitizer))}}static{this.\u0275mod=F.\u0275\u0275defineNgModule({type:Ke})}static{this.\u0275inj=F.\u0275\u0275defineInjector({providers:[T.d,$.$,K.I,w.d,ee.W,ie.B,ge.S,he.y,fe.e,ve.v,Pe.D,D.Z,De.o,be.O,{provide:o.U2,useFactory:N=>new o.Dj(N),deps:[i.DOCUMENT]},{provide:f.m,useClass:P,multi:!0},{provide:f.m,useClass:z,multi:!0},{provide:f.m,useClass:v,multi:!0}],imports:[i.CommonModule,H.P,p.q,u.q,_.S,g.r,O.S,x.u,M.D,I,s.MatIconModule,r.MatSnackBarModule,B.q,S.C,Y.d,m.TranslateModule,U.k]})}};Re=(0,n.__decorate)([(0,y.g)({viewElements:[re.V,ce.n,d.r,h.l,c.E,C.B],requestHandlers:[ue.H,Ee.I,te.F,de.p,W.x,Z.E,k.T,se.e,ne._,me.C,Me.p,Ie.I,Oe.M],converters:[Q.q,ae.m,pe.K]}),(0,n.__metadata)("design:paramtypes",[s.MatIconRegistry,t.DomSanitizer])],Re),function(){(typeof ngJitMode>"u"||ngJitMode)&&F.\u0275\u0275setNgModuleScope(Re,{declarations:[re.V,ce.n,d.r,j.m,h.l,c.E,C.B],imports:[i.CommonModule,H.P,p.q,u.q,_.S,g.r,O.S,x.u,q.m,M.D,I,s.MatIconModule,r.MatSnackBarModule,B.q,S.C,Y.d,m.TranslateModule,U.k],exports:[re.V,ce.n,d.r,h.l,c.E,C.B]})}()},58909:(G,A,e)=>{e.d(A,{An:()=>t,J3:()=>i,M7:()=>n,Od:()=>s,iQ:()=>r});const n="ReplyEmailEvent",i="EmailSavedEvent",s="BlindZoneWidthEvent",r="ReadyEvent",t="FocusInputEvent"},16296:(G,A,e)=>{e.d(A,{T:()=>n});var n;(function(i){i.Reply="reply",i.ReplyAll="reply-all",i.Forward="forward",i.EditDraft="edit-draft"})(n||(n={}))},36122:(G,A,e)=>{e.d(A,{I:()=>m});var n=e(62278),i=e.n(n),s=e(29957),r=e.n(s),t=e(22307),y=e.n(t);class m{constructor(){this._changeComposer$=new n.Subject}getComposerObservable(){return this._changeComposer$.asObservable()}openComposer(_){s.String.isNullOrWhiteSpace(_)||this._changeComposer$.next(_)}static{this.\u0275fac=function(l){return new(l||m)}}static{this.\u0275prov=t.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},86190:(G,A,e)=>{e.d(A,{$:()=>m});var n=e(59969),i=e(28399),s=e.n(i),r=e(22307),t=e.n(r),y=e(38071);class m{constructor(_,l){this._doNotUseCache=!1,this._storage=_.localStorage,l.getFeatureState("DoNotCacheComposerData").subscribe(E=>{this._doNotUseCache=E})}remove(_){(0,i.isEmpty)(_)||this._doNotUseCache||this._storage.removeItem(_)}set(_,l){(0,i.isEmpty)(_)||this._doNotUseCache||this._storage.setItem(_,l)}get(_){return(0,i.isEmpty)(_)||this._doNotUseCache?"":this._storage.getItem(_)}static{this.\u0275fac=function(l){return new(l||m)(r.\u0275\u0275inject(n.ZP),r.\u0275\u0275inject(y.wf))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},2023:(G,A,e)=>{e.d(A,{v:()=>m});var n=e(59969),i=e(86190),s=e(22307),r=e.n(s),t=e(85688),y=e(38071);class m extends i.${constructor(_,l,E){super(_,E),this._emailsService=l}set(_,l){const E=this._emailsService.getDraftUserContent(l);super.set(_,E)}static{this.\u0275fac=function(l){return new(l||m)(s.\u0275\u0275inject(n.ZP),s.\u0275\u0275inject(t.d),s.\u0275\u0275inject(y.wf))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},59784:(G,A,e)=>{e.d(A,{S:()=>F});var n=e(28399),i=e.n(n),s=e(62278),r=e.n(s),t=e(36486),y=e.n(t),m=e(29957),u=e.n(m),_=e(22307),l=e.n(_),E=e(56089),b=e(23092);class F{constructor(S,U){this._macrosHelperService=S,this._userInfo=U,this._indentation="<br>",this._signatureTag="<signature>",this._signatureTpl="<signature>{0}</signature>",this._macrosRegex=new RegExp(/\[#(.+?)#\]/)}_replaceSignatureInBody(S,U){return S.includes(this._signatureTag)?S.replace(this._getSignatureRegExp(),U):S.concat(U)}_getSignatureRegExp(){return/((<br.{1,4}>)|(\\r\\n)){0,1}((<br.{1,4}>)|(\\r\\n)){0,1}(<div>){0,1}<signature>[\s\S]*?<\/signature>(<\/div>){0,1}/}_getFormattedSignature(S){const U=S.indexOf(this._signatureTag);return(0,n.isEmpty)(S)||U===-1?m.String.format(`<div>${this._signatureTpl}</div>`,S||""):U===0?m.String.format("<div>{0}</div>",S):S}_processSignature(S,U){const o=this._getFormattedSignature(U);let p=S()||"";return(0,n.isEmpty)(p)?p=((0,n.isEmpty)(U)?this._indentation:this._indentation.repeat(2)).concat(o):p=this._replaceSignatureInBody(p,o),p}get signatureTpl(){return this._signatureTpl}get signatureTplWithIndent(){return this._indentation.repeat(2).concat(this.signatureTpl)}isBodyContainSignature(S){return!(0,n.isEmpty)(this._getSignatureRegExp().exec(S))}updateSignatureInBody(S,U){if(U=U||"",this._macrosRegex.test(U)){const o={entityId:this._userInfo.contactId,entityName:"Contact",textTemplate:U};return this._macrosHelperService.getTemplateByEntity(o,!0).pipe((0,s.map)(p=>this._processSignature(S,p)),(0,t.catchError)(()=>(0,s.of)(U)))}else return(0,s.of)(this._processSignature(S,U))}static{this.\u0275fac=function(U){return new(U||F)(_.\u0275\u0275inject(E.$),_.\u0275\u0275inject(b.oq))}}static{this.\u0275prov=_.\u0275\u0275defineInjectable({token:F,factory:F.\u0275fac})}}},55529:(G,A,e)=>{e.d(A,{B:()=>I});var n=e(73308),i=e(41108),s=e(56267),r=e(5704),t=e(58504),y=e(29025),m=e(53163),u=e(62278),_=e.n(u),l=e(22307),E=e.n(l),b=e(56089),F=e(38071);class I{constructor(U,o){this._macrosService=U,this._featureService=o,this._templatesEntitySchemaName="EmailTemplate",this._lookupPageSchemaName="EmailTemplatesLookupPage",this._featureService.getFeatureState("RichTextEditor.InlineStyles").subscribe(p=>{this._inlineCssStyles=p})}_handleEmailTextTemplate(U){var o=this;return(0,n.A)(function*(){if(o._inlineCssStyles){let p;try{p=(yield e.e(1372).then(e.t.bind(e,91372,23))).default(U,{removeStyleTags:!0})}catch(g){console.error(`Error while inlining styles. Perhaps the input html document is not valid:
`+g),p=U}return p=p.replace(/<(html|body)\b(?=[^<]*>)/gi,"<div").replace(/<\/(html|body)>/gi,"</div>").replace(/<(\/)?(head)([^><]*?)>/gim,""),p}else return`<div>${U}</div>`.replace(new RegExp(/<(\/)?(html|head|body)([^><]*?)>/gim),"")})()}_getLookupPageFiltersConfig(U){const o="lookupObjectFilter",p=new i.X(s.H.Or),g=new r.x(t.H.Equal,new y.g({columnPath:"[SysSchema:UId:Object].Name"}),new m.J({value:U})),O=new r.x(t.H.Is_null,new y.g({columnPath:"Object"}),new m.J({value:null}));return p.add(g),p.add(O),{filterAttributes:[{name:o,loadOnChange:!1}],attributesConfig:{[o]:{value:p}}}}getTemplatesLookupConfig(U){return{type:"crt.OpenSelectionWindowRequest",$context:{},entitySchemaName:this._templatesEntitySchemaName,schemaName:this._lookupPageSchemaName,features:{create:{enabled:!1},select:{multiple:!1,selectAll:!1}},filtersConfig:this._getLookupPageFiltersConfig(U)}}getMultiLanguageTemplate(U,o,p){var g=this;return this._macrosService.getMultiLanguageTemplate(p,o,U).pipe((0,u.switchMap)(function(){var O=(0,n.A)(function*(x){return x.textTemplate=yield g._handleEmailTextTemplate(x.textTemplate),x});return function(x){return O.apply(this,arguments)}}()))}static{this.\u0275fac=function(o){return new(o||I)(l.\u0275\u0275inject(b.$),l.\u0275\u0275inject(F.wf))}}static{this.\u0275prov=l.\u0275\u0275defineInjectable({token:I,factory:I.\u0275fac})}}},85688:(G,A,e)=>{e.d(A,{d:()=>re});var n=e(5757),i=e.n(n),s=e(22307),r=e.n(s),t=e(49973),y=e(58504),m=e(86464),u=e(74709),_=e(43785),l=e(18587),E=e(6530),b=e(79772),F=e.n(b),I=e(65751),S=e(29858),U=e(26628),o=e(48899),p=e(55359),g=e(26594),O=e(28399),x=e.n(O),M=e(62278),B=e.n(M),T=e(36486),D=e.n(T),f=e(29957),H=e.n(f),Y=e(59784),q=e(16296);class re{constructor(d,h){this._injector=d,this._featureValues=h,this._replyBodyLimiter="<div bodylimiter",this._copyEntitiesMethod="/rest/EntityUtilsService/CopyEntities",this._inReplyToActivityHeader="X-In-Reply-To-Activity",this._httpClient=this._injector.get(n.HttpClient),this._queryExecutor=this._injector.get(I.w),this._translateService=this._injector.get(b.TranslateService),this._emailSignatureService=this._injector.get(Y.S),this._fileApiService=this._injector.get(U.k),this._entityConnectionService=this._injector.get(S.r),this._entitySchemaService=this._injector.get(o.e)}_getEmailEsq(d){const h=new t.s("Activity");return h.addSchemaColumn("Sender"),h.addSchemaColumn("Recepient"),h.addSchemaColumn("CopyRecepient"),h.addSchemaColumn("BlindCopyRecepient"),h.addSchemaColumn("Title"),h.addSchemaColumn("Body"),h.addSchemaColumn("SendDate"),h.addSchemaColumn("HeaderProperties"),h.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",d),h}_mapEmail(d){const h={id:d.Id,from:d.Sender,subject:d.Title,body:d.Body,sendDate:d.SendDate,attachments:[]},c=d.Recepient.toString(),C=d.CopyRecepient.toString(),j=d.BlindCopyRecepient.toString(),Q=d.HeaderProperties.toString();return h.to=f.String.isNullOrWhiteSpace(c)?[]:c.split(";").filter(Boolean),h.cc=f.String.isNullOrWhiteSpace(C)?[]:C.split(";").filter(Boolean),h.bcc=f.String.isNullOrWhiteSpace(j)?[]:j.split(";").filter(Boolean),h.headers=f.String.isNullOrWhiteSpace(Q)?[]:Q.split(`
`).filter(Boolean).map(ae=>this._mapHeader(ae)),h}_getAttachmentsEsq(d){const h=new t.s("ActivityFile");return h.addSchemaColumn("Id"),h.addSchemaColumn("Name"),h.addSchemaColumn("Size"),h.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Activity",d),h.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Inline",!1),h}_mapAttachment(d){const h=new File([],d.Name);return{id:d.Id,size:d.Size,file:h,content:new ArrayBuffer(0)}}_prepareRecipient(d){return d.replace("<","&lt;").replace(">","&gt;")}_getBody(d){const h="<span style='font-weight: bold;'>{0}: </span><span>{1}</span><br>",c="<br>{0}><hr style='border:none;border-top: 1px solid #E3E3E3;'>",j="<div><blockquote style='margin-left: 0.8ex;border-left: 1px solid #E3E3E3;padding-left: 1ex;font: inherit;'>{0}</blockquote></div>",Q=this._prepareRecipient(d.from),ae=d.to?this._prepareRecipient(d.to.join(";")):"",pe=d.body,ue=d.body.match(/<body.*?>([\s\S]*)<\/body>/),Ee=ue&&ue[1]||pe,te=new f.StringBuilder;if(te.appendFormat(this._emailSignatureService.signatureTplWithIndent,f.String.empty),te.appendFormat(c,this._replyBodyLimiter),te.appendFormat(h,this._translateService.instant("MessageComposer.Email.From"),Q),te.appendFormat(h,this._translateService.instant("MessageComposer.Email.SentOn"),d.sendDate),te.appendFormat(h,this._translateService.instant("MessageComposer.Email.To"),ae),d.cc?.length!==0){const de=d.cc?this._prepareRecipient(d.cc.join(";")):"";te.appendFormat(h,this._translateService.instant("MessageComposer.Email.CC"),de)}return te.appendFormat(h,this._translateService.instant("MessageComposer.Email.Subject"),d.subject),te.appendFormat(j,Ee),te.toString()}_getShortBody(d=!0){const h="<br>{0}>",c='<div><div class="email-composer-reply-expander"></div></div>',C=new f.StringBuilder;return d&&C.appendFormat(this._emailSignatureService.signatureTplWithIndent,f.String.empty),C.appendFormat(h,this._replyBodyLimiter),C.appendFormat(c),C.toString()}_getSubjectPrefix(d){return d===q.T.Forward?"FW: ":"RE: "}_getSubject(d,h){const c=this._getSubjectPrefix(h),C=d.subject;return C.startsWith(c)?C:c+C}_setRecipients(d,h,c){let C=[];const j=h.from;switch(c){case q.T.Reply:C=f.String.isNullOrWhiteSpace(j)?[]:[j];break;case q.T.ReplyAll:{const Q=h.to?h.to:[];C=f.String.isNullOrWhiteSpace(j)?[...Q]:[j,...Q];break}default:break}d.to=C,d.cc=c===q.T.ReplyAll?h.cc:[],d.bcc=[]}_getInsertQuery(d,h){return this._getQueryWithEmailColumns(d,h).pipe((0,T.map)(c=>(c.addColumn("Id",d.id,m.r.Guid),c)))}_getUpdateQuery(d,h){return this._getQueryWithEmailColumns(d,h).pipe((0,T.map)(c=>(c.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",d.id),c)))}_mapHeader(d){const h=d.split("=");return{name:h[0],value:h[1]}}_getHeaderProperties(d,h){const c=d.headers||[];return!(0,O.isEmpty)(h.inReplyToId)&&!c.find(C=>C.name===this._inReplyToActivityHeader)&&c.push({name:this._inReplyToActivityHeader,value:h.inReplyToId}),c.map(C=>`${C.name}=${C.value}`).join(`
`)}_getQueryWithEmailColumns(d,h){const c=d.isDraft?new u.N("Activity"):new _.L("Activity");return c.addColumn("Title",d.subject,m.r.Text),c.addColumn("Body",d.body,m.r.Text),c.addColumn("Sender",d.from,m.r.Text),c.addColumn("Recepient",d.to?.join(";"),m.r.Text),c.addColumn("CopyRecepient",d.cc?.join(";"),m.r.Text),c.addColumn("BlindCopyRecepient",d.bcc?.join(";"),m.r.Text),c.addColumn("Type",p.Iq,m.r.Guid),c.addColumn("ActivityCategory",p.Aw,m.r.Guid),c.addColumn("IsHtmlBody",!0,m.r.Boolean),c.addColumn("HeaderProperties",this._getHeaderProperties(d,h),m.r.Text),this._entitySchemaService.getEntitySchemaByName("Activity").pipe((0,T.switchMap)(C=>this._addDefaultValues(h,c,C.entitySchema.columns)),(0,T.switchMap)(C=>this._addEntityConnectionColumns(h,C)),(0,T.switchMap)(C=>(0,O.isEmpty)(h?.inReplyToId)?(0,M.of)(C):this._copyConnectionColumnsFromParent(h,C)))}_getColumnDataValueType(d){return[m.r.LONG_TEXT,m.r.MAXSIZE_TEXT].includes(d.dataValueType)?m.r.Text:d.dataValueType}_copyConnectionColumnsFromParent(d,h){return this._featureValues.SkipParentEmailConnections?(0,M.of)(h):this._entityConnectionService.getAllEntityConnectionColumns("Activity").pipe((0,T.switchMap)(c=>{if(!c||c.length===0)return(0,M.of)({columns:c,values:null});const C=new t.s("Activity");return c.forEach(j=>{C.addSchemaColumn(j.name)}),C.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",d.inReplyToId),this._queryExecutor.executeSelectQuery(C).pipe((0,T.map)(j=>({columns:c,values:j&&j[0]})))}),(0,T.switchMap)(({columns:c,values:C})=>(c&&C&&c.forEach(j=>{if(!(0,O.isEmpty)(C[j.name])){const Q=this._getColumnDataValueType(j);h.addColumn(j.name,C[j.name],Q)}}),(0,M.of)(h))))}_addEntityConnectionColumns(d,h){return(0,O.isEmpty)(d?.masterSchemaName)||(0,O.isEmpty)(d?.masterRecordId)?(0,M.of)(h):(0,M.from)(this._entityConnectionService.getEntityConnectionColumns("Activity",d?.masterSchemaName)).pipe((0,T.switchMap)(c=>(c&&c.forEach(C=>{const j=this._getColumnDataValueType(C);h.addColumn(C.name,d.masterRecordId,j)}),(0,M.of)(h))))}_addDefaultValues(d,h,c){const C=d.defaultValues;return C&&C.forEach(j=>{const Q=c.find(ae=>ae.name===j.attributeName);if(Q){const ae=this._getColumnDataValueType(Q);h.addColumn(j.attributeName,j.value,ae)}}),(0,M.of)(h)}_executeQuery(d,h){return d.isDraft?this._getUpdateQuery(d,h).pipe((0,T.switchMap)(c=>this._queryExecutor.executeUpdateQuery(c))):this._getInsertQuery(d,h).pipe((0,T.switchMap)(c=>this._queryExecutor.executeInsertQuery(c)))}_trimStart(d,h){return d.startsWith(h)?d.slice(h.length):d}_trimEnd(d,h){return d.endsWith(h)?d.slice(0,d.length-h.length):d}_trimBrTag(d){let h=this._trimStart(d,"&nbsp;");return h=this._trimEnd(h,"<br>"),h}_deleteRemovedAttachments(d){const h=new l.x("ActivityFile");return h.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Activity",d.id),h.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Inline",!1),d.attachments.forEach(C=>h.filters.addSchemaColumnFilterWithParameter(y.H.Not_equal,"Id",C.id)),this._queryExecutor.executeDeleteQuery(h)}getEmail(d,h){const c=this._getEmailEsq(d),C=this._queryExecutor.executeSelectQuery(c).pipe((0,T.map)(Q=>this._mapEmail(Q[0]))),j=h?this.getAttachments(d):(0,M.of)([]);return(0,M.forkJoin)([C,j]).pipe((0,T.map)(Q=>{const ae=Q[0];return ae.attachments=Q[1],ae}))}getAttachments(d){const h=this._getAttachmentsEsq(d);return this._queryExecutor.executeSelectQuery(h).pipe((0,T.map)(c=>c.map(C=>this._mapAttachment(C))))}getReplyDraft(d,h){const c={id:(0,E.qv)(),from:"",subject:this._getSubject(d,h),body:this._getBody(d),bodyShort:this._getShortBody(),isDraft:!1,attachments:h===q.T.Forward&&d.attachments?[...d.attachments]:[]};return this._setRecipients(c,d,h),(0,M.of)(c)}getSafeUserContentReplyBody(d,h){const c=this.getDraftUserContent(d),C=this.getDraftUserContent(h);return h.replace(C,c)}getDraftUserContent(d,h=!1){const c=d.indexOf(this._replyBodyLimiter);return c!==-1&&(d=this._trimBrTag(d.substring(0,c))),h?d+this._getShortBody(!1):d}saveEmail(d,h){return this._executeQuery(d,h).pipe((0,T.concatMap)(c=>{if(!c.success)throw new Error(c.errorInfo?.message);let C=d.attachments;return C?(C=C.filter(j=>j.content.byteLength>0),C.length===0?(0,M.of)([c]):(0,M.from)(C).pipe((0,T.concatMap)(j=>this._fileApiService.upload(j)),(0,T.last)())):(0,M.of)([c])}),(0,T.concatMap)(c=>{if(!c[0].success)throw new Error(c[0].errorInfo?.message);if(d.isDraft)return this._deleteRemovedAttachments(d).pipe((0,T.switchMap)(()=>(0,M.of)([c])),(0,M.catchError)(()=>(0,M.of)([c])));if(d.attachments.filter(Q=>Q.content.byteLength===0).length===0)return(0,M.of)([c]);const j={sourceEntityId:h?.inReplyToId,recipientEntityId:d.id,columnName:"Activity",entitySchemaName:"Activity",sourceEntitySchemaNames:["ActivityFile"],isOnlyInline:!0,inlineIds:d.attachments.filter(Q=>Q.content.byteLength===0).map(Q=>Q.id)};return this._httpClient.post(this._copyEntitiesMethod,j)}),(0,T.switchMap)(c=>{if(c.CopyEntitiesResult&&c.CopyEntitiesResult.length===0)throw new Error(c.errorInfo?.message);return(0,M.of)({success:!0,activityId:d.id})}),(0,M.catchError)(c=>(0,M.of)({success:!1,errorInfo:{errorCode:null,message:c.message,stackTrace:""},activityId:d.id})))}static{this.\u0275fac=function(h){return new(h||re)(s.\u0275\u0275inject(s.Injector),s.\u0275\u0275inject(g.G))}}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:re,factory:re.\u0275fac})}}},79341:(G,A,e)=>{e.d(A,{o:()=>_});var n=e(5757),i=e.n(n),s=e(43482),r=e(22307),t=e.n(r),y=e(81923),m=e(38071),u=e(95145);class _{constructor(E,b,F,I){this._httpClient=E,this._entitySchemaRepository=b,this._featureService=F,this._sysSettingsService=I}getInstance(E,b,F){return new s.O(this._httpClient,this._entitySchemaRepository,E,b,this._featureService,this._sysSettingsService,F)}static{this.\u0275fac=function(b){return new(b||_)(r.\u0275\u0275inject(n.HttpClient),r.\u0275\u0275inject(y.v),r.\u0275\u0275inject(m.wf),r.\u0275\u0275inject(u.A))}}static{this.\u0275prov=r.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}},43482:(G,A,e)=>{e.d(A,{O:()=>S});var n=e(5757),i=e.n(n),s=e(58504),r=e(6530),t=e(28399),y=e.n(t),m=e(62278),u=e.n(m),_=e(36486),l=e.n(_),E=e(29957),b=e.n(E),F=e(22307),I=e.n(F);class S{constructor(o,p,g,O,x,M,B){this._httpClient=o,this._entitySchemaRepository=p,this._entityId=g,this._entitySchemaName=O,this._featureService=x,this._sysSettingsService=M,this._entitySchemaUId=B,this._getContactsFromDbMethod="/rest/ESNFeedModuleService/GetContactsForMention",this._getContactsFromEsMethod="/rest/ESNFeedModuleService/GetESContactsForMention",this._searchPageSize=15,this._useGlobalSearch=!1,this._featureService.getFeaturesState(["GlobalSearch_V2","ESMention","UseContactMentionFilterComparisonTypeForContactMention"]).subscribe(T=>{const D=T?.slice(0,2),f=T&&T[2];this._useGlobalSearch=D?.length===2&&!D.includes(!1),f&&(this._comparisonType=s.H.Contain)})}_getSchemaUId(){return this._entitySchemaUId&&!(0,r.gZ)(this._entitySchemaUId)?(0,m.of)(this._entitySchemaUId):this._entitySchemaRepository.getSchemaByName(this._entitySchemaName).pipe((0,_.map)(o=>o.uId))}_mapContactsResponse(o){return o.result.map(p=>({value:p.value,displayValue:p.displayValue,primaryImageValue:p.primaryImage,connectionType:p.connectionType}))}_getComparisonType(){return this._comparisonType?(0,m.of)(this._comparisonType):this._sysSettingsService.getByCode("StringColumnSearchComparisonType").pipe((0,_.map)(o=>o?.value===1?s.H.Contain:s.H.Start_with),(0,_.map)(o=>(this._comparisonType=o,o)))}_getMentionsFromDb(o){return(0,m.forkJoin)([this._getSchemaUId(),this._getComparisonType()]).pipe((0,_.switchMap)(([p,g])=>this._httpClient.post(this._getContactsFromDbMethod,{entityId:this._entityId,entitySchemaUId:p,searchName:o,searchType:g}).pipe((0,_.map)(O=>this._mapContactsResponse(O)))))}_getMentionsFromGlobalSearch(o){if((0,t.isEmpty)(o))return(0,m.of)([]);const p=(o||E.String.empty).trim().split(" ").map(g=>g.trim());return this._httpClient.post(this._getContactsFromEsMethod,{query:p,rowsOffset:0,rowCount:this._searchPageSize}).pipe((0,_.map)(g=>this._mapContactsResponse(g)))}getContacts(o){return this._useGlobalSearch?this._getMentionsFromGlobalSearch(o):this._getMentionsFromDb(o)}static{this.\u0275fac=function(p){F.\u0275\u0275invalidFactory()}}static{this.\u0275prov=F.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac})}}},98488:(G,A,e)=>{e.d(A,{D:()=>S});var n=e(5757),i=e.n(n),s=e(6530),r=e(28399),t=e.n(r),y=e(62278),m=e.n(y),u=e(36486),_=e.n(u),l=e(22307),E=e.n(l),b=e(81923),F=e(72882),I=e(26628);class S{constructor(o,p,g,O){this._httpClient=o,this._entitySchemaRepository=p,this._feedNotificationService=g,this._fileApiService=O,this._postMessageMethod="/rest/EsnService/PostMessage",this._editMessageMethod="/rest/EsnService/EditMessage",this._postCommentMethod="/rest/EsnService/PostComment",this._editCommentMethod="/rest/EsnService/EditComment",this._readAttachmentsMethod="/rest/EsnService/ReadAttachments",this._deleteAttachmentsMethod="/rest/EsnService/DeleteAttachments"}_getSchemaUId(o){return this._entitySchemaRepository.getSchemaByName(o).pipe((0,u.map)(p=>p.uId))}_postMessage(o,p){return this._httpClient.post(o,p).pipe((0,u.map)(g=>g.Id))}_modifyMessage(o,p){return this._httpClient.post(o,p).pipe((0,u.map)(g=>g.success))}_uploadAttachments(o){const p=o.filter(g=>g.content.byteLength>0);return p.length===0?(0,y.of)(!0):(p.forEach(g=>{g.fileEntitySchemaName="FeedFile"}),(0,y.from)(p).pipe((0,u.concatMap)(g=>this._fileApiService.upload(g)),(0,u.last)(),(0,u.map)(()=>!0)))}_deleteAttachments(o,p,g,O){return this._httpClient.post(this._deleteAttachmentsMethod,{messageId:o,attachmentsToKeepIds:p,schemaUId:g,entityId:O})}_getAttachmentIds(o){const p=new RegExp(/FileService\/Download\/FeedFile\/(.+?)"/gi);return[...o.Message.matchAll(p)].map(O=>O[1]).concat(o.Attachments?.map(O=>O.id))}_updateMessageAttachments(o,p){const g=p?o.Id:s.To;return((0,r.isEmpty)(o.Attachments)?(0,y.of)(!0):this._uploadAttachments(o.Attachments)).pipe((0,u.concatMap)(()=>{const x=this._getAttachmentIds(o);return this._deleteAttachments(o.Id,x,o.EntitySchemaUId,o.EntityId)}),(0,u.map)(()=>g))}updateMessage(o){return this._modifyMessage(this._editMessageMethod,{messageId:o.Id,message:{Id:o.Id,SchemaUId:o.EntitySchemaUId,EntityId:o.EntityId,Message:o.Message,UserAccess:o.UserAccess}}).pipe((0,u.switchMap)(p=>this._updateMessageAttachments(o,p)))}updateChildMessage(o){return this._modifyMessage(this._editCommentMethod,{commentId:o.Id,comment:{Id:o.Id,SchemaUId:o.EntitySchemaUId,EntityId:o.EntityId,Message:o.Message,UserAccess:o.UserAccess}}).pipe((0,u.switchMap)(p=>this._updateMessageAttachments(o,p)))}postMessage(o){return this._getSchemaUId(o.EntitySchemaName).pipe((0,u.switchMap)(p=>this._postMessage(this._postMessageMethod,{message:{Id:o.Id,SchemaUId:p,EntityId:o.EntityId,Message:o.Message,UserAccess:o.UserAccess}})),(0,u.concatMap)(p=>(0,r.isEmpty)(o.Attachments)?(0,y.of)(p):this._uploadAttachments(o.Attachments).pipe((0,u.map)(()=>p))),(0,u.map)(p=>(this._feedNotificationService.onFeedPostPublished(p,o.EntityId),p)))}postChildMessage(o,p){return this._postMessage(this._postCommentMethod,{messageId:p,comment:{Id:o.Id,SchemaUId:o.EntitySchemaUId,EntityId:o.EntityId,Message:o.Message,UserAccess:o.UserAccess}}).pipe((0,u.concatMap)(g=>(0,r.isEmpty)(o.Attachments)?(0,y.of)(g):this._uploadAttachments(o.Attachments).pipe((0,u.map)(()=>g))))}loadAttachments(o,p,g,O,x){const M=O||"FeedFile",B=x||"RecordId";return this._httpClient.post(this._readAttachmentsMethod,{messageId:o,schemaUId:p,entityId:g,schemaName:M,columnName:B}).pipe((0,u.map)(T=>T.files.map(D=>({fileId:D.Id,fileName:D.Name,fileSize:D.Size,fileCreatedOn:D.CreatedOn,getBoundDataSchemaByAttributePath:function(){return{name:M}}}))))}static{this.\u0275fac=function(p){return new(p||S)(l.\u0275\u0275inject(n.HttpClient),l.\u0275\u0275inject(b.v),l.\u0275\u0275inject(F.Z),l.\u0275\u0275inject(I.k))}}static{this.\u0275prov=l.\u0275\u0275defineInjectable({token:S,factory:S.\u0275fac})}}},2047:(G,A,e)=>{e.d(A,{W:()=>o});var n=e(5757),i=e.n(n),s=e(49973),r=e(41108),t=e(56267),y=e(58504),m=e(6530),u=e(28399),_=e.n(u),l=e(62278),E=e.n(l),b=e(36486),F=e.n(b),I=e(22307),S=e.n(I),U=e(65751);class o{constructor(g,O){this._queryExecutor=g,this._httpClient=O,this._getCaseSenderMethod="/rest/SenderObtainingService/ObtainSenderMailbox"}_getMailboxesEsq(g){const O=new s.s("MailboxSyncSettings");O.addSchemaColumn("SenderEmailAddress"),O.addSchemaColumn("SenderDisplayValue"),O.addSchemaColumn("Signature"),O.addSchemaColumn("UseSignature"),O.addSchemaColumn("CreatedBy");const x=new r.X(t.H.Or);return x.addSchemaColumnFilterWithParameter(y.H.Equal,"SysAdminUnit",g),x.addSchemaColumnFilterWithParameter(y.H.Equal,"IsShared",!0),O.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"SendEmailsViaThisAccount",!0),O.filters.add(x),O}_getCaseParamsEsq(g){const O=new s.s("Case");return O.addSchemaColumn("ParentActivity.Recepient","To"),O.addSchemaColumn("ParentActivity.CopyRecepient","CC"),O.addSchemaColumn("ParentActivity.BlindCopyRecepient","BCC"),O.addSchemaColumn("Contact"),O.addSchemaColumn("Category"),O.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"Id",g),O}_mapMailbox(g){return{id:g.Id,senderEmailAddress:g.SenderEmailAddress,senderDisplayValue:g.SenderDisplayValue,signature:g.Signature,useSignature:g.UseSignature,createdBy:g.CreatedBy}}_mapGetSenderRequestConfig(g){const O=[g.To,g.CC,g.BCC].filter(x=>!(0,u.isEmpty)(x));return{recipients:O.length>0?O.join(";"):"",contactId:g.Contact?g.Contact.value:null,categoryId:g.Category?g.Category.value:null}}_mapCaseSenderMailbox(g){return!g||!g.ObtainSenderMailboxResult||(0,u.isEmpty)(g.ObtainSenderMailboxResult.MailboxName)?null:{id:(0,m.qv)(),senderEmailAddress:g.ObtainSenderMailboxResult.MailboxName,useSignature:!1}}getMailboxesForSend(g){const O=this._getMailboxesEsq(g);return this._queryExecutor.executeSelectQuery(O).pipe((0,b.map)(x=>x?.map(M=>this._mapMailbox(M))))}getDefaultMailboxForSend(g){const O=this._getMailboxesEsq(g);return O.filters.addSchemaColumnFilterWithParameter(y.H.Equal,"IsDefault",!0),this._queryExecutor.executeSelectQuery(O).pipe((0,b.map)(x=>x?.map(M=>this._mapMailbox(M))),(0,b.switchMap)(x=>(0,l.of)(x[0])))}getCaseDefaultMailbox(g){const O=this._getCaseParamsEsq(g);return this._queryExecutor.executeSelectQuery(O).pipe((0,b.map)(x=>(0,u.isEmpty)(x)?null:this._mapGetSenderRequestConfig(x[0])),(0,b.concatMap)(x=>(0,u.isEmpty)(x)?(0,l.of)(null):this._httpClient.post(this._getCaseSenderMethod,x)),(0,b.switchMap)(x=>(0,l.of)(this._mapCaseSenderMailbox(x))))}static{this.\u0275fac=function(O){return new(O||o)(I.\u0275\u0275inject(U.w),I.\u0275\u0275inject(n.HttpClient))}}static{this.\u0275prov=I.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac,providedIn:"root"})}}},43673:(G,A,e)=>{e.d(A,{e:()=>O});var n=e(5757),i=e.n(n),s=e(49973),r=e(61320),t=e(41108),y=e(56267),m=e(58504),u=e(6530),_=e(59969),l=e(26594),E=e(28399),b=e.n(E),F=e(36486),I=e.n(F),S=e(29957),U=e.n(S),o=e(22307),p=e.n(o),g=e(65751);class O{constructor(M,B,T){this._queryExecutor=M,this._httpClient=B,this._globalSearchFeatureCode="GlobalSearch_V2",this._esEmailsSearchFeatureCode="IsESEmailsSearch",this._sendInitialQueryToGsFeatureCode="SendInitialQueryToGS",this._globalSearchMethodName="/rest/ESEmailService/SearchEmailsPage",this._itemsPerPage=15,this._useGlobalSearch=!1,this._sendInitialQueryToGs=!1,this._useGlobalSearch=T[this._globalSearchFeatureCode]&&T[this._esEmailsSearchFeatureCode],this._sendInitialQueryToGs=T[this._sendInitialQueryToGsFeatureCode]}_getRecipientsEsq(M,B){const T=new s.s("VwRecepientEmail"),D=T.addSchemaColumn("Email");D.orderDirection=r.Z.Asc,T.rowCount=this._itemsPerPage,T.rowsOffset=B;const f=new t.X(y.H.Or);return f.addSchemaColumnFilterWithParameter(m.H.Contain,"Email",M),f.addSchemaColumnFilterWithParameter(m.H.Contain,"ContactName",M),T.filters.add(f),T}_mapRecipient(M){return{value:(0,u.qv)(),displayValue:M}}_getRecipientsFromGlobalSearch(M,B){const T=(M||S.String.empty).trim(),D=T.split(" ").map(f=>f.trim());return this._sendInitialQueryToGs&&T&&D.push(T),this._httpClient.post(this._globalSearchMethodName,{query:D,rowsOffset:B,rowCount:this._itemsPerPage}).pipe((0,F.map)(f=>{const H=JSON.parse(f?.SearchEmailsResult||"[]")||[],Y=[];return H.forEach(function(q){const re={emails:[]};Object.keys(q).forEach(function(ce){const d=q[ce];(0,_.m2)(d)&&re.emails.push(this._mapRecipient(d))},this),re.emails.length>0&&Y.push(re)},this),Y}))}_getRecipientsFromDb(M,B){const T=this._getRecipientsEsq(M,B);return this._queryExecutor.executeSelectQuery(T).pipe((0,F.map)(D=>D?.map(f=>({emails:[this._mapRecipient(f.Email)]}))))}getRecipients(M,B=0){return this._useGlobalSearch&&!(0,E.isEmpty)(M)?this._getRecipientsFromGlobalSearch(M,B):this._getRecipientsFromDb(M,B)}static{this.\u0275fac=function(B){return new(B||O)(o.\u0275\u0275inject(g.w),o.\u0275\u0275inject(n.HttpClient),o.\u0275\u0275inject(l.G))}}static{this.\u0275prov=o.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac})}}},46690:(G,A,e)=>{e.d(A,{y:()=>_});var n=e(5757),i=e.n(n),s=e(62278),r=e.n(s),t=e(36486),y=e.n(t),m=e(22307),u=e.n(m);class _{constructor(E){this._httpClient=E,this._publishMessageMethod="/rest/EmailSendService/Send"}_mapSendResult(E){const b=E.SendResult[0].ErrorMessage,F={success:b===""};return F.success||(F.errorInfo={message:b,errorCode:"",stackTrace:""}),F}publishMessage(E){return this._httpClient.post(this._publishMessageMethod,{ActivityId:E})}sendEmail(E){return this.publishMessage(E).pipe((0,t.switchMap)(b=>(0,s.of)(this._mapSendResult(b))),(0,s.catchError)(b=>(0,s.of)({success:!1,errorInfo:{errorCode:null,message:b.message,stackTrace:""}})))}static{this.\u0275fac=function(b){return new(b||_)(m.\u0275\u0275inject(n.HttpClient))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:_,factory:_.\u0275fac})}}},55359:(G,A,e)=>{e.d(A,{Aw:()=>m,Iq:()=>s,zY:()=>r});const n="C449D832-A4CC-4B01-B9D5-8A12C42A9F89",i="Activity",s="E2831DEC-CFC0-DF11-B00F-001D60E938C6",r="fbe0acdc-cfc0-df11-b00f-001d60e938c6",t="42c74c49-58e6-df11-971b-001d60e938c6",y="f51c4643-58e6-df11-971b-001d60e938c6",m="8038A396-7825-E011-8165-00155D043204"},93338:(G,A,e)=>{e.d(A,{_:()=>n});const n="ComposerEvent"},82650:(G,A,e)=>{e.d(A,{m:()=>t});var n=e(87210),i=e.n(n),s=e(22307),r=e.n(s);class t{transform(m){return(0,n.encode)(m)}static{this.\u0275fac=function(u){return new(u||t)}}static{this.\u0275pipe=s.\u0275\u0275definePipe({name:"encodeHtml",type:t,pure:!0,standalone:!0})}static{this.\u0275prov=s.\u0275\u0275defineInjectable({token:t,factory:t.\u0275fac,providedIn:"root"})}}},72882:(G,A,e)=>{e.d(A,{Z:()=>u});var n=e(22307),i=e.n(n),s=e(62278),r=e.n(s),t=e(91065),y=e(5240),m=e(23092);class u{constructor(l,E){this._messageChannelService=l,this._userInfo=E,this._subscriptions=[],this.newMessageEvent=new n.EventEmitter,this.feedPostPublishedEvent=new n.EventEmitter,this._subscribeMessageChannelEvents()}_subscribeMessageChannelEvents(){this._subscriptions.push(this._messageChannelService.messageEvent$.pipe((0,s.filter)(l=>l.header.sender==="UpdateSocialMessage"),(0,s.map)(l=>{const E=l.body;return{MessageId:l.id.toString(),AuthorId:E.sysAdminUnitId,Operation:E.operation,EntityId:E.channelId,ParentId:E.parentId,EntityName:E.entityName}})).subscribe(l=>this.newMessageEvent.emit(l)))}onFeedPostPublished(l,E){const b={MessageId:l,Operation:t.x.Insert,EntityId:E};this.feedPostPublishedEvent.emit(b)}ngOnDestroy(){this._subscriptions.forEach(l=>l?.unsubscribe())}static{this.\u0275fac=function(E){return new(E||u)(n.\u0275\u0275inject(y.A),n.\u0275\u0275inject(m.oq))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:u,factory:u.\u0275fac})}}},91065:(G,A,e)=>{e.d(A,{x:()=>n});var n;(function(i){i.Insert="insert",i.Update="update",i.Delete="delete",i.ForceUpdate="forceUpdate"})(n||(n={}))},71348:G=>{G.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">\r
	<path d="M11.41 9.7832L14.41 6.7832L11.41 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
	<path d="M2.41003 12.7832C2.41003 11.1919 3.04218 9.66578 4.16739 8.54056C5.29261 7.41534 6.81874 6.7832 8.41003 6.7832H14.41" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
</svg>\r
`},62127:G=>{G.exports=`<svg width="73" height="64" viewBox="0 0 73 64" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path d="M39.6128 25.1749H18.6128C16.9559 25.1749 15.6128 26.5181 15.6128 28.1749C15.6128 29.8318 16.9559 31.1749 18.6128 31.1749H39.6128C41.2696 31.1749 42.6128 29.8318 42.6128 28.1749C42.6128 26.5181 41.2696 25.1749 39.6128 25.1749Z" fill="#D1D1D1"/>\r
<path d="M53.6128 35.1749H18.6128C16.9559 35.1749 15.6128 36.5181 15.6128 38.1749C15.6128 39.8318 16.9559 41.1749 18.6128 41.1749H53.6128C55.2696 41.1749 56.6128 39.8318 56.6128 38.1749C56.6128 36.5181 55.2696 35.1749 53.6128 35.1749Z" fill="#D1D1D1"/>\r
<path d="M53.998 27.454V30.9513C53.998 31.1514 54.2593 31.2275 54.3667 31.0587L56.0831 28.3619L53.998 27.454Z" fill="#004FD6"/>\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M61.9104 17.6219C61.9908 16.803 61.103 16.2429 60.3985 16.6681L48.9928 23.5514C48.2977 23.9709 48.3658 25.0001 49.1101 25.3243L52.1202 26.6359L58.0677 21.0965C58.2443 20.932 58.5071 21.1632 58.3665 21.3593L53.998 27.454L56.0831 28.3619L59.3996 29.8074C60.022 30.0787 60.7281 29.6641 60.7944 28.9884L61.9104 17.6219Z" fill="#004FD6"/>\r
<path d="M46.834 17.1179H11.25C9.59315 17.1179 8.25 18.4611 8.25 20.1179V46.2319C8.25 47.8888 9.59314 49.2319 11.25 49.2319H61.25C62.9069 49.2319 64.25 47.8888 64.25 46.2319V36.1749" stroke="#70ACEE" stroke-linecap="round"/>\r
</svg>\r
`},90277:G=>{G.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">\r
	<path d="M5.41003 9.7832L2.41003 6.7832L5.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
	<path d="M8.41003 9.7832L5.41003 6.7832L8.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
	<path d="M14.41 12.7832C14.41 11.1919 13.7779 9.66578 12.6527 8.54056C11.5275 7.41534 10.0013 6.7832 8.41003 6.7832H5.41003" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
</svg>\r
`},5719:G=>{G.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">\r
	<path d="M5.41003 9.7832L2.41003 6.7832L5.41003 3.7832" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
	<path d="M14.41 12.7832C14.41 11.1919 13.7779 9.66578 12.6527 8.54056C11.5275 7.41534 10.0013 6.7832 8.41003 6.7832H2.41003" stroke="#0D2E4E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\r
</svg>\r
`}}]);
