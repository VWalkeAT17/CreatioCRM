(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[9035],{99035:(T,Te,l)=>{l.r(Te),l.d(Te,{CrtEntityHierarchyFilterComponent:()=>f,CrtEntityHierarchyFilterModule:()=>oe,CrtHierarchyTreeNodePaddingDirectiveModule:()=>O,CrtSpecificationFilterModule:()=>Q,HierarchyTreeNodePaddingDirective:()=>q,createHierarchyFilters:()=>R,refreshEntityHierarchy:()=>it});var d=l(5960),b=l(67057),he=l(37851),lt=l(55642),S=l(79772),Pe=l(5476),Me=l(50663),Re=l(79419),$e=l(41276),je=l(31149),Be=l(24091),ke=l(39713),Oe=l(80953),Qe=l(96176),dt=l(12841),i=l(22307),A=l(77592),$=l(34760),ht=l(1034),pt=l(96677),ut=l(52793),mt=l(10098),ft=l(38071),Ke=l(58758),yt=l(68712);function w(o,e,t){let n;for(let r=0;n===void 0&&r<o?.length;r++){const a=o[r];a[t]===e?n=a:n=w(a.children,e,t)}return n}function gt(o,e){return We(o)?.map(n=>w(e,n,"id"))||[]}function We(o){const e=o?.split("_");if(!e?.length)return[];const t=e.map((n,r)=>e[r-1]?e.slice(0,r+1).join("_"):n);return t.pop(),t}var g;(function(o){o.ManualDisplayMode="manualDisplayMode",o.ByParentDisplayMode="byParentDisplayMode"})(g||(g={}));var ze=l(36486),v;(function(o){o.Boolean="359e0e35-bb39-4f07-9b9f-aec6ad076828",o.String="7aad419a-9e7a-4785-8d13-c7ff1402e13d",o.Integer="2212241a-71eb-468b-a3d5-c0f39dfe51c9",o.Decimal="beb46531-4f29-452c-be18-1ed5f1aa8b80",o.List="ecf578a0-4b4d-40e6-909c-39af2a798d32"})(v||(v={}));class F{constructor(e){this._cdk=e,this.valueChange=new i.EventEmitter}ngOnDestroy(){this._valueChangeSubscription?.unsubscribe(),this._valueChangeSubscription=null}static{this.\u0275fac=function(t){return new(t||F)(i.\u0275\u0275directiveInject(i.ChangeDetectorRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:F,selectors:[["crt-base-specification-filter"]],inputs:{specificationId:"specificationId"},outputs:{valueChange:"valueChange"},decls:0,vars:0,template:function(t,n){},encapsulation:2})}}var K=l(59247),_t=l(12092),Ct=l(81207);const vt=["*"];class P{constructor(){this.customToggleStyles={toggle:{height:"20px",width:"20px"}}}static{this.\u0275fac=function(t){return new(t||P)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:P,selectors:[["crt-specification-filter-panel"]],inputs:{caption:"caption"},ngContentSelectors:vt,decls:3,vars:6,consts:[["togglePosition","after","toggleType","material",3,"expanded","fullWidthHeader","title","extraStyles"]],template:function(t,n){t&1&&(i.\u0275\u0275projectionDef(),i.\u0275\u0275elementStart(0,"crt-expansion-panel",0),i.\u0275\u0275pipe(1,"uppercase"),i.\u0275\u0275projection(2),i.\u0275\u0275elementEnd()),t&2&&i.\u0275\u0275property("expanded",!0)("fullWidthHeader",!1)("title",i.\u0275\u0275pipeBind1(1,4,n.caption))("extraStyles",n.customToggleStyles)},dependencies:[Ct.o,b.UpperCasePipe],styles:[`crt-specification-filter-panel crt-expansion-panel-header{padding:4px 0}
`],encapsulation:2,changeDetection:0})}}class W extends F{set caption(e){this._caption=e,this.radioGroupAriaLabel=`Choose the state for ${this.caption} filter`}get caption(){return this._caption}constructor(e,t){super(e),this._cdk=e,this._translateService=t,this._booleanSpecFilterTranslateKey="SpecificationFilter.Boolean",this.radioButtonOptions=[{value:!0,caption:this._translateService.instant(`${this._booleanSpecFilterTranslateKey}.Yes`)},{value:!1,caption:this._translateService.instant(`${this._booleanSpecFilterTranslateKey}.No`)}]}ngOnInit(){this.reset()}reset(){this._valueChangeSubscription?.unsubscribe(),this.control=new K.FormControl(void 0),this._valueChangeSubscription=this.control.valueChanges.subscribe(e=>this.valueChange.emit({specificationId:this.specificationId,value:e})),this._cdk.detectChanges()}static{this.\u0275fac=function(t){return new(t||W)(i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(S.TranslateService))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:W,selectors:[["crt-boolean-specification-filter"]],inputs:{caption:"caption"},features:[i.\u0275\u0275ProvidersFeature([{provide:F,useExisting:(0,i.forwardRef)(()=>W)}]),i.\u0275\u0275InheritDefinitionFeature],decls:2,vars:5,consts:[[3,"caption"],[3,"radioGroupAriaLabel","items","control"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0),i.\u0275\u0275element(1,"crt-icon-radio-button",1),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275property("caption",n.caption),i.\u0275\u0275advance(),i.\u0275\u0275property("radioGroupAriaLabel",n.radioGroupAriaLabel)("items",n.radioButtonOptions)("control",n.control),i.\u0275\u0275attribute("data-qa",n.caption))},dependencies:[_t.b,P],styles:[`crt-boolean-specification-filter .crt-icon-radio-button{padding-top:2px}crt-boolean-specification-filter .crt-icon-radio-group{gap:1rem}crt-boolean-specification-filter .crt-icon-radio-group .mdc-radio__background:before{height:8px!important;width:8px!important;left:calc(50% - 4px)!important;top:calc(50% - 4px)!important;border-radius:50%}
`],encapsulation:2,changeDetection:0})}}var m=l(62278),Nt=l(19344);class z extends F{set caption(e){this._caption=e,this.ariaLabel=`Fill in the ${this.caption} filter`}get caption(){return this._caption}constructor(e){super(e),this._cdk=e}ngOnInit(){this.reset()}reset(){this._valueChangeSubscription?.unsubscribe(),this.control=new K.FormControl(void 0),this._valueChangeSubscription=this.control.valueChanges.pipe((0,m.debounceTime)(500)).subscribe(e=>this.valueChange.emit({specificationId:this.specificationId,value:e?.length?e:void 0})),this._cdk.detectChanges()}static{this.\u0275fac=function(t){return new(t||z)(i.\u0275\u0275directiveInject(i.ChangeDetectorRef))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:z,selectors:[["crt-string-specification-filter"]],inputs:{caption:"caption"},features:[i.\u0275\u0275ProvidersFeature([{provide:F,useExisting:(0,i.forwardRef)(()=>z)}]),i.\u0275\u0275InheritDefinitionFeature],decls:3,vars:6,consts:[[3,"caption"],[3,"placeholder","ariaLabel","control"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0),i.\u0275\u0275element(1,"crt-input",1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275property("caption",n.caption),i.\u0275\u0275advance(),i.\u0275\u0275property("placeholder",i.\u0275\u0275pipeBind1(2,4,"SpecificationFilter.String.Placeholder"))("ariaLabel",n.ariaLabel)("control",n.control))},dependencies:[Nt.j,P,S.TranslatePipe],styles:[`crt-string-specification-filter .crt-input{min-height:unset!important;padding-top:4px!important;padding-bottom:4px!important}crt-string-specification-filter .crt-input .crt-input-label-container{display:none!important}
`],encapsulation:2,changeDetection:0})}}var xt=l(32667),re=l(16504);function pe(o,e){return t=>{const r=K.Validators.max(o)(t);return r?{max:{...r.max,message:e}}:null}}function ue(o,e){return t=>{const r=K.Validators.min(o)(t);return r?{min:{...r.min,message:e}}:null}}var St=l(71614);class J extends F{set caption(e){this._caption=e,this.fromAriaLabel=`Fill in the ${this.caption} filter starting value`,this.toAriaLabel=`Fill in the ${this.caption} filter ending value`}get caption(){return this._caption}constructor(e,t,n){super(e),this._cdk=e,this.directionality=t,this._translateService=n,this.format={decimalPrecision:0}}ngOnInit(){this.reset()}reset(){this._valueChangeSubscription?.unsubscribe(),this.fromControl=new K.FormControl(void 0),this.toControl=new K.FormControl(void 0),this._valueChangeSubscription=this.fromControl.valueChanges.pipe((0,ze.mergeWith)(this.toControl.valueChanges),(0,m.debounceTime)(500)).subscribe(e=>this._emitValue()),this._cdk.detectChanges()}_getMaxValue(){return this.format.decimalPrecision>0?re.M_.Float.max:re.M_.Integer.max}_getMinValue(){return this.format.decimalPrecision>0?re.M_.Float.min:re.M_.Integer.min}_emitValue(){this.fromControl.value!==null||this.toControl.value!==null?this._handleNonNullValues():this._handleNullValues()}_handleNonNullValues(){(this.fromControl.value!==this._prevFrom||this.toControl.value!==this._prevTo)&&(this.fromControl.valid&&this.toControl.valid&&(this._emitValueChange(),this._updatePreviousValues()),this._updateValidators())}_handleNullValues(){this._prevFrom===void 0&&this._prevTo===void 0||(this.valueChange.emit({specificationId:this.specificationId,value:void 0}),this._prevFrom=null,this._prevTo=null)}_emitValueChange(){this.valueChange.emit({specificationId:this.specificationId,value:{from:this.fromControl.value,to:this.toControl.value}})}_updatePreviousValues(){this._prevFrom=this.fromControl.value,this._prevTo=this.toControl.value}_updateValidators(){this._updateToControlValidators(),this._updateFromControlValidators()}_updateToControlValidators(){this.toControl.clearValidators(),this.toControl.addValidators(ue(this.fromControl.value,this._translateService.instant("SpecificationFilter.Numeric.MinValueError"))),this.toControl.addValidators(ue(this._getMinValue(),this._translateService.instant("SpecificationFilter.Numeric.MinValueError"))),this.toControl.addValidators(pe(this._getMaxValue(),this._translateService.instant("SpecificationFilter.Numeric.MaxValueError"))),this.toControl.invalid&&this.toControl.updateValueAndValidity()}_updateFromControlValidators(){this.fromControl.clearValidators(),this.fromControl.addValidators(pe(this.toControl.value,this._translateService.instant("SpecificationFilter.Numeric.MaxValueError"))),this.fromControl.addValidators(ue(this._getMinValue(),this._translateService.instant("SpecificationFilter.Numeric.MinValueError"))),this.fromControl.addValidators(pe(this._getMaxValue(),this._translateService.instant("SpecificationFilter.Numeric.MaxValueError"))),this.fromControl.invalid&&this.fromControl.updateValueAndValidity()}static{this.\u0275fac=function(t){return new(t||J)(i.\u0275\u0275directiveInject(i.ChangeDetectorRef),i.\u0275\u0275directiveInject(xt.Directionality),i.\u0275\u0275directiveInject(S.TranslateService))}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:J,selectors:[["crt-numeric-specification-filter"]],inputs:{caption:"caption",format:"format"},features:[i.\u0275\u0275ProvidersFeature([{provide:F,useExisting:(0,i.forwardRef)(()=>J)}]),i.\u0275\u0275InheritDefinitionFeature],decls:9,vars:18,consts:[[3,"caption"],[1,"numerics-container"],[3,"ariaLabel","placeholder","control","format"],[1,"to","specification-caption"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0)(1,"div",1),i.\u0275\u0275element(2,"crt-number-input",2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementStart(4,"div",3),i.\u0275\u0275text(5),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275element(7,"crt-number-input",2),i.\u0275\u0275pipe(8,"translate"),i.\u0275\u0275elementEnd()()),t&2&&(i.\u0275\u0275property("caption",n.caption),i.\u0275\u0275advance(),i.\u0275\u0275classProp("rtl",(n.directionality==null?null:n.directionality.value)==="rtl"),i.\u0275\u0275advance(),i.\u0275\u0275property("ariaLabel",n.fromAriaLabel)("placeholder",i.\u0275\u0275pipeBind1(3,12,"SpecificationFilter.Numeric.Placeholder"))("control",n.fromControl)("format",n.format),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(6,14,"SpecificationFilter.Numeric.To")," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("ariaLabel",n.toAriaLabel)("placeholder",i.\u0275\u0275pipeBind1(8,16,"SpecificationFilter.Numeric.Placeholder"))("control",n.toControl)("format",n.format))},dependencies:[St.S,P,S.TranslatePipe],styles:[`crt-numeric-specification-filter .numerics-container{display:flex;padding-top:3.5px;padding-bottom:3.5px}crt-numeric-specification-filter .numerics-container .to{padding-right:12px;margin-top:auto;margin-bottom:auto;min-width:50px}crt-numeric-specification-filter .numerics-container crt-number-input{min-width:0}crt-numeric-specification-filter .numerics-container crt-number-input .crt-input{min-height:unset!important}crt-numeric-specification-filter .numerics-container crt-number-input .crt-input .crt-input-label-container{max-height:0px}crt-numeric-specification-filter .numerics-container.rtl .to{padding-right:0;padding-left:12px}
`],encapsulation:2,changeDetection:0})}}var Je=l(60101);function Ft(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div")(1,"crt-checkbox",2),i.\u0275\u0275listener("valueChange",function(r){const a=i.\u0275\u0275restoreView(t).$implicit,c=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(c.onValueChange(a.id,r))}),i.\u0275\u0275elementEnd()()}if(o&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ariaLabel",n.getCheckboxAriaLabel(t))("label",t.name)("title",t.name)}}class j extends F{constructor(){super(...arguments),this._selectedIds=[],this.options=[]}getCheckboxAriaLabel(e){const t=this._selectedIds.includes(e.id);let n=`${e.name}`;return t&&(n=`${n} Selected`),n}onValueChange(e,t){t?this._selectedIds.push(e):this._selectedIds=this._selectedIds.filter(n=>n!==e),this.valueChange.emit({specificationId:this.specificationId,value:this._selectedIds?.length?this._selectedIds:void 0})}reset(){this._selectedIds=[],this.checkboxes?.forEach(e=>e.value=!1)}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(j)))(n||j)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:j,selectors:[["crt-list-specification-filter"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(Je.U,5),t&2){let r;i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n.checkboxes=r)}},inputs:{caption:"caption",options:"options"},features:[i.\u0275\u0275ProvidersFeature([{provide:F,useExisting:(0,i.forwardRef)(()=>j)}]),i.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[[3,"caption"],[4,"ngFor","ngForOf"],["labelPosition","right",3,"valueChange","ariaLabel","label","title"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"crt-specification-filter-panel",0),i.\u0275\u0275template(1,Ft,2,3,"div",1),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275property("caption",n.caption),i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.options))},dependencies:[b.NgForOf,Je.U,P],styles:[`crt-list-specification-filter crt-specification-filter-panel crt-expansion-panel .crt-expansion-panel.mat-expansion-panel .mat-expansion-panel-content .mat-expansion-panel-body{padding-top:4px}crt-list-specification-filter .crt-checkbox-container{padding-top:0;padding-bottom:8px}
`],encapsulation:2,changeDetection:0})}}function It(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-boolean-specification-filter",7),i.\u0275\u0275listener("valueChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onFilterValueChange(r))}),i.\u0275\u0275elementEnd()}if(o&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275property("specificationId",t.specificationId)("caption",t.caption)}}function Et(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-string-specification-filter",7),i.\u0275\u0275listener("valueChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onFilterValueChange(r))}),i.\u0275\u0275elementEnd()}if(o&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275property("specificationId",t.specificationId)("caption",t.caption)}}function bt(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-numeric-specification-filter",7),i.\u0275\u0275listener("valueChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onFilterValueChange(r))}),i.\u0275\u0275elementEnd()}if(o&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275property("specificationId",t.specificationId)("caption",t.caption)}}function wt(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-numeric-specification-filter",8),i.\u0275\u0275listener("valueChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onFilterValueChange(r))}),i.\u0275\u0275elementEnd()}if(o&2){const t=i.\u0275\u0275nextContext().$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275property("specificationId",t.specificationId)("caption",t.caption)("format",n.decimalFormat)}}function Ht(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-list-specification-filter",9),i.\u0275\u0275listener("valueChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onFilterValueChange(r))}),i.\u0275\u0275elementEnd()}if(o&2){const t=i.\u0275\u0275nextContext().$implicit;i.\u0275\u0275property("specificationId",t.specificationId)("options",t.listItems)("caption",t.caption)}}function Vt(o,e){if(o&1&&(i.\u0275\u0275elementContainerStart(0),i.\u0275\u0275elementStart(1,"div",3),i.\u0275\u0275template(2,It,1,2,"crt-boolean-specification-filter",4)(3,Et,1,2,"crt-string-specification-filter",4)(4,bt,1,2,"crt-numeric-specification-filter",4)(5,wt,1,3,"crt-numeric-specification-filter",5)(6,Ht,1,3,"crt-list-specification-filter",6),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementContainerEnd()),o&2){const t=e.$implicit,n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitch",t.type),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",n.specificationTypes.Boolean),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",n.specificationTypes.String),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",n.specificationTypes.Integer),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",n.specificationTypes.Decimal),i.\u0275\u0275advance(),i.\u0275\u0275property("ngSwitchCase",n.specificationTypes.List)}}function At(o,e){o&1&&(i.\u0275\u0275elementStart(0,"div",10),i.\u0275\u0275text(1),i.\u0275\u0275pipe(2,"translate"),i.\u0275\u0275elementEnd()),o&2&&(i.\u0275\u0275advance(),i.\u0275\u0275textInterpolate1(" ",i.\u0275\u0275pipeBind1(2,1,"SpecificationFilter.NoData")," "))}class B{constructor(){this._specificationValues=new Map,this.filterChange=new i.EventEmitter,this.specificationTypes={Boolean:v.Boolean,String:v.String,Integer:v.Integer,Decimal:v.Decimal,List:v.List},this.decimalFormat={decimalPrecision:2}}onFilterValueChange(e){e.value!==void 0?this._specificationValues.set(e.specificationId,e.value):this._specificationValues.delete(e.specificationId),this.filterChange.emit({specificationFiltersConfiguration:this.specificationFilters,specificationFiltersValues:this._specificationValues,specificationEntityName:this.specificationEntityName,specificationReferenceColumnName:this.specificationReferenceColumnName})}reset(){this._specificationValues=new Map,this.specificationFilterInputs.forEach(e=>{e.reset()})}static{this.\u0275fac=function(t){return new(t||B)}}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:B,selectors:[["crt-specification-filter"]],viewQuery:function(t,n){if(t&1&&i.\u0275\u0275viewQuery(F,5),t&2){let r;i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n.specificationFilterInputs=r)}},inputs:{specificationEntityName:"specificationEntityName",specificationReferenceColumnName:"specificationReferenceColumnName",specificationFilters:"specificationFilters"},outputs:{filterChange:"filterChange"},decls:3,vars:2,consts:[[1,"container"],[4,"ngFor","ngForOf"],["class","no-data specification-text",4,"ngIf"],[3,"ngSwitch"],[3,"specificationId","caption","valueChange",4,"ngSwitchCase"],[3,"specificationId","caption","format","valueChange",4,"ngSwitchCase"],[3,"specificationId","options","caption","valueChange",4,"ngSwitchCase"],[3,"valueChange","specificationId","caption"],[3,"valueChange","specificationId","caption","format"],[3,"valueChange","specificationId","options","caption"],[1,"no-data","specification-text"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"div",0),i.\u0275\u0275template(1,Vt,7,6,"ng-container",1)(2,At,3,3,"div",2),i.\u0275\u0275elementEnd()),t&2&&(i.\u0275\u0275advance(),i.\u0275\u0275property("ngForOf",n.specificationFilters),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",!(n.specificationFilters!=null&&n.specificationFilters.length)))},dependencies:[b.NgForOf,b.NgIf,b.NgSwitch,b.NgSwitchCase,W,z,J,j,S.TranslatePipe],styles:["[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{padding:0 4px}[_nghost-%COMP%]   .no-data[_ngcontent-%COMP%]{text-align:center}"],changeDetection:0})}}var u=l(73308),M=l(49973),me=l(61320),I=l(58504),D=l(41108),ae=l(81923),ee=l(65751);const E="9d8c9238-7a6b-9cc0-be1f-45b130cd4918";class G{constructor(e,t,n){this._entitySchemaRepository=e,this._queryExecutor=t,this._translateService=n,this._allFiltersNodeCaptionPath="EntityHierarchyFilter.AllFilterCaption"}_getLookupDataEsq(e){var t=this;return(0,u.A)(function*(){const r=(yield(0,m.firstValueFrom)(t._entitySchemaRepository.getSchemaByName(e))).getPrimaryDisplayColumn(),a=new M.s(e);return a.addSchemaColumn(r.name).withOrdering(me.Z.Asc,0),a})()}_getLookupData(e){var t=this;return(0,u.A)(function*(){const n=yield t._getLookupDataEsq(e);return yield(0,m.firstValueFrom)(t._queryExecutor.executeSelectQuery(n))})()}_getNodeFilter(e,t,n){let r=null;return e?(r=e.clone(),r.addSchemaColumnFilterWithParameter(I.H.Equal,t,n)):r=this._getLookupFilter(t,n),r}_getLookupFilter(e,t){const n=new D.X;return n.addSchemaColumnFilterWithParameter(I.H.Equal,e,t),n}_formSubNodes(e,t,n,r){var a=this;return(0,u.A)(function*(){const c=[],s=t.columns.find(p=>p.name===e.columnName);let h=r.get(s.referenceSchemaName);h||(h=yield a._getLookupData(s.referenceSchemaName),r.set(s.referenceSchemaName,h));for(const p of h){const C=a._getNodeFilter(n,s.name,p.Id),y={id:p.Id,value:p.Id,caption:p.Name,filter:C,children:[]},V=e.children??[];for(const L of V){const H=yield a._formSubNodes(L,t,C,r);y.children=y.children.concat(H.map(N=>({...N,id:`${y.id}_${N.id}`})))}c.push(y)}return c})()}convert(e,t){var n=this;return(0,u.A)(function*(){const r=yield(0,m.firstValueFrom)(n._entitySchemaRepository.getSchemaByName(t)),a=n.createRootNode(),c=new Map;for(const s of e){const h=yield n._formSubNodes(s,r,null,c);a.children=a.children.concat(h)}return[a]})()}createRootNode(){return{id:E,value:null,caption:this._translateService.instant(this._allFiltersNodeCaptionPath),filter:null,columnName:"All",children:[]}}static{this.\u0275fac=function(t){return new(t||G)(i.\u0275\u0275inject(ae.v),i.\u0275\u0275inject(ee.w),i.\u0275\u0275inject(S.TranslateService))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:G,factory:G.\u0275fac,providedIn:"root"})}}var Dt=l(72860),Lt=l(25697),Tt=l(13232),Pt=l(12325),Mt=l(91244),Rt=l(46558),$t=l(66675);const jt=["navigateBackButton"];function Bt(o,e){o&1&&i.\u0275\u0275element(0,"mat-icon",8)}function kt(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"div",14)(1,"crt-search-filter",15),i.\u0275\u0275listener("valueChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(a.onSearchFilterChanged(r))}),i.\u0275\u0275elementEnd()()}}function Ot(o,e){o&1&&(i.\u0275\u0275element(0,"crt-label",16),i.\u0275\u0275pipe(1,"translate"),i.\u0275\u0275pipe(2,"translate")),o&2&&(i.\u0275\u0275property("caption",i.\u0275\u0275pipeBind1(1,2,"EntityHierarchyFilter.NoDataCaption")),i.\u0275\u0275attribute("aria-label",i.\u0275\u0275pipeBind1(2,4,"EntityHierarchyFilter.NoDataCaption")))}function Qt(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-button",22),i.\u0275\u0275listener("clicked",function(){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext().node,a=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(a.onShowSpecificationFilters(r))})("keydown",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext().node,c=i.\u0275\u0275nextContext(3);return i.\u0275\u0275resetView(c.onKeyShowSpecificationFilters(a,r))}),i.\u0275\u0275elementEnd()}if(o&2){const t=i.\u0275\u0275nextContext().node,n=i.\u0275\u0275nextContext(3);i.\u0275\u0275property("iconPosition","left-icon")("icon","filter")("title",n.getNodeFilterAriaLabel(t)),i.\u0275\u0275attribute("aria-label",n.getNodeFilterAriaLabel(t))}}function Kt(o,e){if(o&1&&(i.\u0275\u0275elementStart(0,"div",17)(1,"div",18)(2,"div",19),i.\u0275\u0275text(3),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(4,"div",20),i.\u0275\u0275template(5,Qt,1,4,"crt-button",21),i.\u0275\u0275elementEnd()()),o&2){const t=e.node,n=i.\u0275\u0275nextContext(3);i.\u0275\u0275attribute("aria-label",n.getNodeAriaLabel(t)),i.\u0275\u0275advance(3),i.\u0275\u0275textInterpolate1(" ",t.Caption," "),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.specificationEntityName)}}function Wt(o,e){o&1&&i.\u0275\u0275element(0,"div",23)}function zt(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275template(0,kt,2,0,"div",9)(1,Ot,3,6,"crt-label",10),i.\u0275\u0275elementStart(2,"crt-virtual-scroll-tree-view",11),i.\u0275\u0275listener("nodeExpanded",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onNodeExpanded(r))})("expandedItemsChanged",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onExpandedItemsChanged(r))})("selectedItemKeyChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onSelectedItemKeyChange(r))})("paginationChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext(2);return i.\u0275\u0275resetView(a.onPaginationChange(r))}),i.\u0275\u0275template(3,Kt,6,3,"ng-template",12),i.\u0275\u0275elementEnd(),i.\u0275\u0275template(4,Wt,1,0,"div",13)}if(o&2){const t=i.\u0275\u0275nextContext(2);i.\u0275\u0275property("ngIf",t.isByParentModeEnabled()&&t.isSearchEnabled()),i.\u0275\u0275advance(),i.\u0275\u0275property("ngIf",t.isTreeEmpty()),i.\u0275\u0275advance(),i.\u0275\u0275property("items",t.flatItems)("selectedItemKey",t.selectedNodeId)("expandedItems",t.expandedItems),i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",t.loaderVisible)}}function Jt(o,e){if(o&1&&(i.\u0275\u0275elementStart(0,"crt-toggle-container-item",5)(1,"div",6),i.\u0275\u0275template(2,Bt,1,0,"mat-icon",7)(3,zt,5,6,"ng-template",null,1,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()()),o&2){const t=i.\u0275\u0275reference(4),n=i.\u0275\u0275nextContext();i.\u0275\u0275advance(2),i.\u0275\u0275property("ngIf",n.initializing)("ngIfElse",t)}}function Gt(o,e){if(o&1){const t=i.\u0275\u0275getCurrentView();i.\u0275\u0275elementStart(0,"crt-toggle-container-item",24)(1,"div",6)(2,"div",25)(3,"div",26)(4,"crt-button",27,2),i.\u0275\u0275pipe(6,"translate"),i.\u0275\u0275listener("clicked",function(){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onHideSpecificationFilters())})("keydown",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(a.onKeyBackButton(r))}),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(7,"crt-button",28),i.\u0275\u0275pipe(8,"translate"),i.\u0275\u0275listener("clicked",function(){i.\u0275\u0275restoreView(t);const r=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(r.onClearSpecificationFilter())})("keydown",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(a.onKeyClearSpecificationFilter(r))}),i.\u0275\u0275elementEnd()(),i.\u0275\u0275element(9,"hr",29),i.\u0275\u0275elementStart(10,"div",30),i.\u0275\u0275element(11,"crt-label",31),i.\u0275\u0275elementEnd()(),i.\u0275\u0275elementStart(12,"crt-specification-filter",32),i.\u0275\u0275listener("filterChange",function(r){i.\u0275\u0275restoreView(t);const a=i.\u0275\u0275nextContext();return i.\u0275\u0275resetView(a.onSpecificationFilterChange(r))}),i.\u0275\u0275elementEnd()()()}if(o&2){const t=i.\u0275\u0275nextContext();i.\u0275\u0275advance(4),i.\u0275\u0275property("iconPosition","left-icon")("icon","back-button-icon")("caption",i.\u0275\u0275pipeBind1(6,10,"EntityHierarchyFilter.BackButtonCaption")),i.\u0275\u0275advance(3),i.\u0275\u0275property("iconPosition","left-icon")("icon","eraser-icon")("caption",i.\u0275\u0275pipeBind1(8,12,"EntityHierarchyFilter.ClearAllFiltersButtonCaption")),i.\u0275\u0275advance(4),i.\u0275\u0275property("caption",t.selectedNodeFullPathCaption),i.\u0275\u0275advance(),i.\u0275\u0275property("specificationFilters",t.specificationFiltersConfiguration)("specificationReferenceColumnName",t.specificationReferenceColumnName)("specificationEntityName",t.specificationEntityName)}}let f=class ce extends yt.K{constructor(){super(...arguments),this._selectedTabIndex=0,this._searchActive=!1,this._searchTextValue="",this._initialNodes=[],this._initialNodesSet=!1,this._allNodesCount=0,this._searchResultNodes=[],this._paginationLoadedNodes=0,this._isSearchEnabled=!1,this._batchSize=30,this._featureService=(0,i.inject)(ft.wf),this._searchEnabledFeatureName="ShowParentHierarchySearch",this.initializing=!0,this.skeletonStyles={height:"18px","margin-top":"8px","margin-left":"4px"},this.flatItems=[],this.items=[],this.loadSpecificationFilters=new i.EventEmitter,this.specificationFilterChange=new i.EventEmitter,this.expandedItemsChange=new i.EventEmitter,this.loadNext=new i.EventEmitter,this.loadSearchNext=new i.EventEmitter,this.nodeClick=new i.EventEmitter,this.tabIndexChange=new i.EventEmitter}get searchTextValue(){return this._searchTextValue}set searchTextValue(e){this._searchTextValue=e,this._searchActive=e&&e!=="",this._searchActive||this.loadNext.emit([])}set nodes(e){!this._initialNodesSet&&e?.length>0&&(this._initialNodes=structuredClone(e),this._initialNodesSet=!0);const t=this._convertNodesToFlatStructure(e);if(JSON.stringify(this.flatItems)!==JSON.stringify(t)){if(this.flatItems=t,this.items=e,this._searchActive){if(this.items&&this.items?.length>0&&this.items[0]?.id!==E){const n=structuredClone(this._initialNodes)?.[0];n.children=[],n&&(n.children=e,this.selectedNodeId=n.id,this.nodes=[n])}this._expandAllNodes()}e?.length&&this._initTreeExpandedNodes(),this.loading=!1,this.initializing=!1}}get nodes(){return this.items}set selectedNodeId(e){this._selectNodeById(e)}get selectedNodeId(){return this._selectedNodeId}set expandedItems(e){this._expandedItems=e||[]}get expandedItems(){return this._expandedItems}set searchResultNodes(e){e&&(this._searchResultNodes=this._mergeNodes(this._searchResultNodes,e),this._allNodesCount=this._countNodes(this._searchResultNodes),this._searchActive&&(this.nodes=this._searchResultNodes))}set selectedTabIndex(e){e!=null&&(this._selectedTabIndex=e,this.tabIndexChange.emit(e))}get selectedTabIndex(){return this._selectedTabIndex}_selectNodeById(e){this._selectedNodeId=e,!(!e||this._lastSelectedNodeId===e)&&(this._lastSelectedNodeId=e,this.nodeClick.emit(this.selectedNodeId),this.specificationFilter?.reset())}_initTreeExpandedNodes(){const e=this.items?.[0];this.expandedItems?.length===0&&(this._expandedItems=[e.id],this.selectedNodeId=e.id,this.onExpandedItemsChanged(this.expandedItems))}_convertNodesToFlatStructure(e,t=[],n=0,r=""){return e?.forEach(a=>{t.push({Id:a.id,Caption:a.caption,Level:n,ParentId:r,Expandable:!a.isLastLevel,IsLastItem:a.isLastItem}),this._convertNodesToFlatStructure(a.children,t,n+1,a.id)}),t}_refocusActiveNode(){setTimeout(()=>{const e=document.querySelector(".crt-virtual-scroll-view-item-selected");e&&e.focus()},50)}_updateSearchFilterValue(e){e!==this.searchTextValue&&(this.searchTextValue=e||"",this._searchResultNodes=[],this._paginationLoadedNodes=0,this.loadSearchNext.emit({searchPhrase:this.searchTextValue,number:this._batchSize,offset:0}))}_countNodes(e){if(!e)return 0;let t=0;for(const n of e)n.id!==E&&t++,n.children?.length&&(t+=this._countNodes(n.children));return t}_mergeNodes(e,t){const n=t.filter(a=>a.children.length===0),r=[...e,...n];for(const a of t.filter(c=>c.children.length>0)){const c=e.find(s=>s.id===a.id);if(c)for(const s of a.children)c.children?.filter(h=>h.id===s.id).length===0&&c.children.push(s);else r.push(a)}return r}_expandAllNodes(){this.expandedItems=this.flatItems?.map(e=>e.Id),this.onExpandedItemsChanged(this.expandedItems)}ngOnInit(){this._featureService.getFeatureState(this._searchEnabledFeatureName).pipe((0,ze.take)(1)).subscribe(e=>{this._isSearchEnabled=e})}ngAfterViewInit(){this.toggleContainer.showItem()}onSelectedItemKeyChange(e){this.selectedNodeId=e}getNodeAriaLabel(e){let t=e.Caption;if(e.Expandable){const r=this.expandedItems&&this.expandedItems.includes(e.Id)?"Expanded":"Collapsed";t=`${t} ${r}`}return this.selectedNodeId===e.Id&&(t=`${t} Selected`),t}getNodeFilterAriaLabel(e){return`${e.Caption} Open additional filtering`}onSpecificationFilterChange(e){this.specificationFilterChange.emit(e)}onShowSpecificationFilters(e){const t=w(this.items,e.Id,"id");if(!t)return;e.id!==this._lastSelectedNodeId&&this._selectNodeById(e.Id);const n=gt(e.Id,this.items);if(e.id!==E){const r=w(this.items,E,"id");r&&n.unshift(r)}n.push(t),this.selectedNodeFullPathCaption=n.map(r=>r.caption).join(" / "),this.selectedTabIndex=1,setTimeout(()=>this._navigateBackButton?.focus(),50),this.loadSpecificationFilters.emit(this.specificationEntityName)}onKeyShowSpecificationFilters(e,t){t.key==="Enter"&&this.onShowSpecificationFilters(e)}onKeyBackButton(e){e.key==="Enter"&&(this.onHideSpecificationFilters(),this._refocusActiveNode())}onHideSpecificationFilters(){this.selectedTabIndex=0}onKeyClearSpecificationFilter(e){e.key==="Enter"&&this.onClearSpecificationFilter()}onClearSpecificationFilter(){this.specificationFilter?.reset(),this.specificationFilterChange.emit({specificationEntityName:this.specificationEntityName,specificationReferenceColumnName:this.specificationReferenceColumnName,specificationFiltersConfiguration:this.specificationFiltersConfiguration,specificationFiltersValues:new Map})}onNodeExpanded(e){const t=w(this.items,e.Id,"id");t.id!==E&&(this.loading=!0),this.loadNext.emit([t])}onExpandedItemsChanged(e){this.expandedItemsChange.emit(e)}onPaginationChange(e){if(this._searchActive)this._allNodesCount>this._paginationLoadedNodes&&this._allNodesCount%this._batchSize===0?(this.loading=!0,this.loadSearchNext.emit({searchPhrase:this.searchTextValue,number:this._batchSize,offset:this._allNodesCount}),this._paginationLoadedNodes+=this._allNodesCount):this.loading=!1;else{const t=e?.parentKeys.map(n=>w(this.nodes,n,"id")).filter(n=>n!==void 0);if(!t?.length)return;this.loading=!0,this.loadNext.emit(t)}}onSearchFilterChanged(e){this._updateSearchFilterValue(e?.value)}isByParentModeEnabled(){return this.displayMode===g.ByParentDisplayMode}isTreeEmpty(){return this.items?.length===0}isSearchEnabled(){return this._isSearchEnabled}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ce)))(n||ce)}})()}static{this.\u0275cmp=i.\u0275\u0275defineComponent({type:ce,selectors:[["crt-entity-hierarchy-filter"]],viewQuery:function(t,n){if(t&1&&(i.\u0275\u0275viewQuery(B,5),i.\u0275\u0275viewQuery(Ke.I,5),i.\u0275\u0275viewQuery(jt,5)),t&2){let r;i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n.specificationFilter=r.first),i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n.toggleContainer=r.first),i.\u0275\u0275queryRefresh(r=i.\u0275\u0275loadQuery())&&(n._navigateBackButton=r.first)}},inputs:{nodes:"nodes",specificationReferenceColumnName:"specificationReferenceColumnName",specificationEntityName:"specificationEntityName",specificationFiltersConfiguration:"specificationFiltersConfiguration",selectedNodeId:"selectedNodeId",expandedItems:"expandedItems",displayMode:"displayMode",searchResultNodes:"searchResultNodes",selectedTabIndex:"selectedTabIndex"},outputs:{loadSpecificationFilters:"loadSpecificationFilters",specificationFilterChange:"specificationFilterChange",expandedItemsChange:"expandedItemsChange",loadNext:"loadNext",loadSearchNext:"loadSearchNext",nodeClick:"nodeClick",tabIndexChange:"tabIndexChange"},features:[i.\u0275\u0275InheritDefinitionFeature],decls:5,vars:2,consts:[["items",""],["treeViewContainer",""],["navigateBackButton",""],[3,"selectedTabIndex","slidingAnimation"],["name",""],[1,"hierarchy-container"],["slot","items"],["class","tree-skeleton-icon","svgIcon","tree-skeleton",4,"ngIf","ngIfElse"],["svgIcon","tree-skeleton",1,"tree-skeleton-icon"],["class","search-filter-wrapper",4,"ngIf"],["labelType","caption","class","no-data-label","labelColor","var(--crt-palette-label-400)",3,"caption",4,"ngIf"],[3,"nodeExpanded","expandedItemsChanged","selectedItemKeyChange","paginationChange","items","selectedItemKey","expandedItems"],["crtVirtualScrollTreeViewItemOutlet",""],["class","crt-hierarchy-progress-bar",4,"ngIf"],[1,"search-filter-wrapper"],[3,"valueChange"],["labelType","caption","labelColor","var(--crt-palette-label-400)",1,"no-data-label",3,"caption"],["data-item-hierarchy-tree-node","",1,"tree-node"],["node-caption-container","",1,"tree-node-caption-container"],[1,"tree-node-caption","pointer"],[1,"suffix-node-sticky-container"],["node-filter-container","","class","tree-node-filters suffix-node","size","small","color","transparent",3,"iconPosition","icon","title","clicked","keydown",4,"ngIf"],["node-filter-container","","size","small","color","transparent",1,"tree-node-filters","suffix-node",3,"clicked","keydown","iconPosition","icon","title"],[1,"crt-hierarchy-progress-bar"],[1,"specification-container"],[1,"navigation-body-wrapper"],[1,"navigation-header"],["size","large","displayType","text","color","primary",1,"navigate-back-button",3,"clicked","keydown","iconPosition","icon","caption"],["size","medium","size","large","displayType","text","color","default",3,"clicked","keydown","iconPosition","icon","caption"],[1,"navigation-divider"],[1,"navigation-path-caption"],["labelType","caption","labelColor","var(--crt-palette-label-400)",3,"caption"],[3,"filterChange","specificationFilters","specificationReferenceColumnName","specificationEntityName"]],template:function(t,n){t&1&&(i.\u0275\u0275elementStart(0,"crt-toggle-container",3),i.\u0275\u0275template(1,Jt,5,2,"ng-template",4,0,i.\u0275\u0275templateRefExtractor)(3,Gt,13,14,"ng-template",4,0,i.\u0275\u0275templateRefExtractor),i.\u0275\u0275elementEnd()),t&2&&i.\u0275\u0275property("selectedTabIndex",n.selectedTabIndex)("slidingAnimation",!0)},dependencies:[b.NgIf,he.MatIcon,B,Dt.x,Ke.I,Lt.H,Tt.B,Pt.V,Mt.o,Rt.c,$t.d,S.TranslatePipe],styles:[`body{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}crt-tree-view{--node-padding: 1.5rem !important;--root-node-padding: 1.5rem !important;--node-gap: 0 !important}crt-tree-view .child-node{margin-inline-start:0}crt-entity-hierarchy-filter{overflow:auto;min-width:12rem;border-right:1px solid var(--crt-palette-border-500)}crt-entity-hierarchy-filter .tree-skeleton-icon{min-height:12rem;width:100%;opacity:.6;min-width:12rem}crt-entity-hierarchy-filter .tree-skeleton-icon:before{animation:tree-skeleton-icon-progress 2s ease-in-out infinite;background-size:200px 100%;position:absolute;top:0;left:0;width:200px;height:100%;content:"";background-image:linear-gradient(90deg,#fff0,#fff9,#fff0)}@keyframes tree-skeleton-icon-progress{0%{transform:translate(-200px)}to{transform:translate(calc(200px + 100vw))}}crt-entity-hierarchy-filter crt-toggle-container,crt-entity-hierarchy-filter .crt-toggle-container{border-radius:0!important}crt-entity-hierarchy-filter crt-toggle-container crt-toggle-container-item div[slot=items],crt-entity-hierarchy-filter .crt-toggle-container crt-toggle-container-item div[slot=items]{height:95%}crt-entity-hierarchy-filter crt-toggle-container .search-filter-wrapper crt-search-filter,crt-entity-hierarchy-filter .crt-toggle-container .search-filter-wrapper crt-search-filter{display:block;width:92.5%;max-width:92.5%;box-sizing:border-box;margin-left:1.4rem}crt-entity-hierarchy-filter crt-toggle-container .no-data-label,crt-entity-hierarchy-filter .crt-toggle-container .no-data-label{margin-left:1.5rem;margin-top:.5rem;height:7%}crt-entity-hierarchy-filter .hierarchy-container .tab-body.default-padding,crt-entity-hierarchy-filter .specification-container .tab-body.default-padding{padding:0}crt-entity-hierarchy-filter .pointer{cursor:pointer}crt-entity-hierarchy-filter crt-tree-view{height:100%}crt-entity-hierarchy-filter .tree-node{height:2.5rem;display:flex;align-items:center;padding-left:.5rem;padding-right:.5rem}crt-entity-hierarchy-filter .tree-node:not(.nested-node){width:100%}crt-entity-hierarchy-filter .tree-node .tree-node-caption-container{display:flex}crt-entity-hierarchy-filter .tree-node .tree-node-filters{padding:5px 5px 0;margin-left:auto}crt-entity-hierarchy-filter .tree-node .suffix-node-sticky-container{display:flex;width:100%}crt-entity-hierarchy-filter .tree-node .suffix-node-sticky-container .suffix-node{display:flex;position:sticky;right:8px;left:8px}crt-entity-hierarchy-filter .tree-node:hover .tree-node-filters{visibility:unset}crt-entity-hierarchy-filter .tree-node-hidden{display:none}crt-entity-hierarchy-filter .nested-node{display:flex}crt-entity-hierarchy-filter .nested-node .nested-node-filters{padding:5px 5px 0;margin-left:auto}crt-entity-hierarchy-filter .nested-node .nested-node-filters:hover,crt-entity-hierarchy-filter .nested-node .nested-node-filters:focus{visibility:unset}crt-entity-hierarchy-filter .nested-node:hover .nested-node-filters{visibility:unset}crt-entity-hierarchy-filter .nested-node.focused .nested-node-filters{visibility:unset}crt-entity-hierarchy-filter .nested-node .mat-icon.chevron-icon{height:16px}crt-entity-hierarchy-filter .nested-node .nested-node-icon{align-items:center;display:flex}crt-entity-hierarchy-filter .nested-node .nested-node-icon .chevron-icon.icon-collapsed{transform:rotate(-90deg)}crt-entity-hierarchy-filter .nested-node .nested-node-icon :hover{cursor:pointer}crt-entity-hierarchy-filter .nested-node .nested-node-caption-container{display:flex}crt-entity-hierarchy-filter .nested-node .nested-node-caption-container .nested-node-caption{align-items:center;display:flex;margin-left:.5rem}crt-entity-hierarchy-filter .navigation-body-wrapper{display:flex;flex-direction:column;min-height:0;min-width:0;flex-grow:1;padding:0 4px}crt-entity-hierarchy-filter .navigation-body-wrapper .navigation-header{display:flex;flex-direction:row;justify-content:space-between;align-items:center;height:2.5rem}crt-entity-hierarchy-filter .navigation-body-wrapper .navigation-divider{margin:0;border-style:none;height:1px}crt-entity-hierarchy-filter .navigation-body-wrapper .navigation-path-caption{height:2.5rem;display:flex;flex-wrap:wrap;align-items:center}crt-entity-hierarchy-filter .crt-hierarchy-progress-bar{position:absolute;bottom:0;width:100%;z-index:10;height:2px;background-repeat:no-repeat;background-image:linear-gradient(90deg,var(--crt-palette-label-50) 0%,var(--crt-palette-navigation-secondary-500) 100%);background-color:var(--crt-palette-label-50);background-size:40% 100%;animation:loader-animation 1.4s infinite}@keyframes loader-animation{0%{background-position-x:-67%}to{background-position-x:167%}}crt-entity-hierarchy-filter[dir=rtl]{border-left:1px solid var(--crt-palette-border-500);border-right:none}crt-entity-hierarchy-filter[dir=rtl] .tree-node .tree-node-caption{margin-left:0rem}crt-entity-hierarchy-filter[dir=rtl] .tree-node .tree-node-filters{margin-right:auto;margin-left:0}crt-entity-hierarchy-filter[dir=rtl] .crt-hierarchy-progress-bar{background-image:linear-gradient(270deg,var(--crt-palette-label-50) 0%,var(--crt-palette-navigation-secondary-500) 100%);animation-direction:reverse}
`],encapsulation:2,changeDetection:0})}};(0,d.__decorate)([(0,A.k)({reuseStrategy:{resetValue:!0}}),(0,d.__metadata)("design:type",Array),(0,d.__metadata)("design:paramtypes",[Array])],f.prototype,"nodes",null),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",String)],f.prototype,"specificationReferenceColumnName",void 0),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",String)],f.prototype,"specificationEntityName",void 0),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",Array)],f.prototype,"specificationFiltersConfiguration",void 0),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"loadSpecificationFilters",void 0),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"specificationFilterChange",void 0),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",String),(0,d.__metadata)("design:paramtypes",[String])],f.prototype,"selectedNodeId",null),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",Array),(0,d.__metadata)("design:paramtypes",[Array])],f.prototype,"expandedItems",null),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",String)],f.prototype,"displayMode",void 0),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",Array),(0,d.__metadata)("design:paramtypes",[Array])],f.prototype,"searchResultNodes",null),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"expandedItemsChange",void 0),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"loadNext",void 0),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"loadSearchNext",void 0),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"nodeClick",void 0),(0,d.__decorate)([(0,$.j)(),(0,d.__metadata)("design:type",Object)],f.prototype,"tabIndexChange",void 0),(0,d.__decorate)([(0,A.k)(),(0,d.__metadata)("design:type",Number),(0,d.__metadata)("design:paramtypes",[Number])],f.prototype,"selectedTabIndex",null),f=(0,d.__decorate)([(0,ht.v)({type:"crt.EntityHierarchyFilter",reuseStrategy:pt.B.Reuse}),(0,ut.f)({toolbarConfig:{position:290,icon:l(27778),hint:"Components.EntityHierarchyFilter.Hint"},typeCaption:"Components.EntityHierarchyFilter.Caption",viewElementGroupType:mt.J.Components,propertiesPanelComponentTypeName:"crt.EntityHierarchyFilterPropertiesPanel",designViewItemCommands:{create:"crt.CreateEntityHierarchyFilterComponentCommand",update:"crt.ChangeFilterViewItemCommand",delete:"crt.RemoveFilterViewItemCommand"}})],f);var fe=l(4164);function ye(o){return o=o.split("_").pop(),o=o==="empty"?null:o,o}var Ge=l(28399),Xe=l(38772),ge=l(56267),_e=l(50237);class Ue{constructor(e){this.injector=e,this._queryExecutor=this.injector.get(ee.w),this._nameColumn="Name",this._idColumn="Id"}_getLookupData(e){var t=this;return(0,u.A)(function*(){const n=e.schemaName,r=e.count,a=yield t.getLookupDataEsq(e);r&&(a.rowCount=r,a.rowsOffset=e.offset);const c=new D.X(ge.H.And,n);return e.predefinedFilters&&c.add(D.X.fromJson(e.predefinedFilters,_e.b)),t.addFiltersToQuery(e,a,c),(0,m.firstValueFrom)(t._queryExecutor.executeSelectQuery(a))})()}_loadDataByCaption(e,t,n,r,a){var c=this;return(0,u.A)(function*(){const s=c._getEsqForSearchQuery(t,n,r,a);s.filters.addSchemaColumnFilterWithParameter(I.H.Contain,c._nameColumn,e.trim());const h=yield(0,m.firstValueFrom)(c._queryExecutor.executeSelectQuery(s).pipe((0,m.take)(1)));return c._processEsqResultsToNodes(h,n)})()}_getEsqForSearchQuery(e,t,n,r=0){const a=new M.s(e);return a.addSchemaColumn(t),a.addSchemaColumn(this._nameColumn),a.addSchemaColumn(this._idColumn),a.rowCount=n,a.rowsOffset=r,a}_processEsqResultsToNodes(e,t){const n=[];return e.forEach(r=>{const a={id:r.Id,caption:r.Name,columnName:this._nameColumn,children:[],isLastLevel:!0,filter:null,parentId:r[t]?.value??void 0,value:r.Id};n.push(a)}),n}_loadNextLevelData(e,t,n){var r=this;return(0,u.A)(function*(){const a=new Map;e.forEach(s=>a.set(s.id,s));let c=r._collectPendingParentIds(e,a);for(;c.length>0;){const s=r._getEsqForSearchQuery(t,n,-1);s.filters.addSchemaColumnInFilterWithParameters(I.H.Equal,r._idColumn,c);const h=yield(0,m.firstValueFrom)(r._queryExecutor.executeSelectQuery(s).pipe((0,m.take)(1))),p=r._addMissingResultNodes(h,a,n);c=r._collectPendingParentIds(p,a)}return Array.from(a.values())})()}_collectPendingParentIds(e,t){const n=new Set;for(const r of e){const a=r.parentId;a&&!t.has(a)&&n.add(a)}return Array.from(n)}_addMissingResultNodes(e,t,n){const r=[];return e.forEach(a=>{const c=a.Id;if(!t.has(c)){const s=a[n]?.value??null,h={id:c,caption:a.Name,columnName:this._nameColumn,children:[],isLastLevel:!0,filter:null,parentId:s??void 0,value:c};t.set(c,h),r.push(h)}}),r}_buildHierarchyFromFlat(e){const t=this._initializeNodeMap(e);this._linkParentChildRelations(t);const n=this._collectRootNodes(t);return this._markLastItemFlag(n),n}_initializeNodeMap(e){const t=new Map;for(const n of e)t.has(n.id)||t.set(n.id,{id:n.id,caption:n.caption,columnName:n.columnName,children:[],isLastLevel:!0,filter:n.filter,parentId:n.parentId,value:n.id});return t}_linkParentChildRelations(e){for(const t of e.values()){const n=t.parentId;if(n&&n!==t.id){const r=e.get(n);r&&(r.children.push(t),r.isLastLevel=!1)}}}_collectRootNodes(e){const t=[];for(const n of e.values()){const r=n.parentId;(!r||!e.has(r))&&t.push(n)}return t.sort((n,r)=>n.caption.localeCompare(r.caption)),t}_markLastItemFlag(e){if(e.length!==0){for(const t of e)t.isLastItem=!1;e[e.length-1].isLastItem=!0}}addSorting(e,t,n,r){const a=!e.sortingDirection||e.sortingDirection?.toLowerCase()==="asc"?me.Z.Asc:me.Z.Desc;!e.sortingColumnName||e.sortingColumnName===t?n.withOrdering(a,0):r.addSchemaColumn(e.sortingColumnName).withOrdering(a,0)}loadData(e){var t=this;return(0,u.A)(function*(){const n=yield t._getLookupData(e),r="empty",a=e.parentNodes?.map(s=>s.id||r).join("_"),c=n.map(s=>{const h=s.Id||r;return{id:a?`${a}_${h}`:h,value:h,caption:t.getItemCaption(s),columnName:e.columnName,filters:null,children:[],isLastLevel:!e.nextLevelColumnName||+s.NextLevelCount==0}}).sort((s,h)=>{const p=s.id.split("_").filter(y=>y===r).length,C=h.id.split("_").filter(y=>y===r).length;return p-C});return c.length===e.count&&(c[c.length-1].isLastItem=!0),c})()}loadByCaptionContains(e,t,n,r,a){var c=this;return(0,u.A)(function*(){if(!e||!t)return[];const s=yield c._loadDataByCaption(e,t,n,r,a);return c._loadNextLevelData(s,t,n).then(h=>c._buildHierarchyFromFlat(h))})()}}function R(o,e){const t=new D.X(ge.H.And,o);return e?.forEach(n=>{n.id&&n.id!=="empty"?t.addSchemaColumnFilterWithParameter(I.H.Equal,n.columnName,n.id):t.addSchemaColumnIsNullFilter(n.columnName)}),t}class X extends Ue{constructor(e){super(e),this._notFilledCaptionKey="EntityHierarchyFilter.NotFilledNode",this._entitySchemaRepository=this.injector.get(ae.v),this._translateService=this.injector.get(S.TranslateService)}getLookupDataEsq(e){var t=this;return(0,u.A)(function*(){const n=yield(0,m.firstValueFrom)(t._entitySchemaRepository.getSchemaByName(e.schemaName));t._referencedColumn=n.columns.find(p=>p.name===e.columnName);const r=yield(0,m.firstValueFrom)(t._entitySchemaRepository.getSchemaByName(t._referencedColumn.referenceSchemaName)),a=new M.s(r.name),c=r.getPrimaryDisplayColumn().name,s=r.getPrimaryColumn().name,h=a.addSchemaColumn(`${c}`,"Name");return a.addSchemaColumn(`${s}`,"Id"),t.addSorting(e,c,h,a),a})()}getItemCaption(e){return e.Name||`${this._referencedColumn.caption}: ${this._translateService.instant(this._notFilledCaptionKey)}`}addFiltersToQuery(e,t,n){const r=e.schemaName,a=e.columnName,c=e.nextLevelColumnName;if(n.add(R(r,e.parentNodes)),t.filters.addExistsFilter(`[${r}:${a}:Id].Id`,n),c){const h={filter:R(this._referencedColumn.referenceSchemaName,e.parentNodes.map(p=>({columnName:`[${r}:${c}:Id].${p.columnName}`,id:p.id,value:p.value,caption:null})))};t.addAggregationSubQueryColumn(`[${r}:${e.columnName}:Id].${c}.Id`,Xe.C.Count,h,"NextLevelCount")}}static{this.\u0275fac=function(t){return new(t||X)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:X,factory:X.\u0275fac,providedIn:"root"})}}class U extends Ue{constructor(e){super(e),this._entitySchemaRepository=this.injector.get(ae.v)}getLookupDataEsq(e){var t=this;return(0,u.A)(function*(){const n=yield(0,m.firstValueFrom)(t._entitySchemaRepository.getSchemaByName(e.schemaName)),r=new M.s(e.schemaName),a=n.getPrimaryDisplayColumn().name,c=n.getPrimaryColumn().name,s=r.addSchemaColumn(`${a}`,"Name");return r.addSchemaColumn(`${c}`,"Id"),t.addSorting(e,a,s,r),r})()}getItemCaption(e){return e.Name}addFiltersToQuery(e,t,n){const r=e.schemaName,a=e.columnName;let c=[...e.parentNodes||[]];c.length?c=[c[c.length-1]]:c=[{id:"empty",value:null,caption:null,columnName:a}],n.add(R(r,c)),t.filters.add(n),t.addAggregationFunctionColumn(`[${r}:${a}:Id].Id`,Xe.C.Count,"NextLevelCount")}static{this.\u0275fac=function(t){return new(t||U)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}}function Xt(o,e){switch(e){case g.ByParentDisplayMode:return o.get(U);case g.ManualDisplayMode:return o.get(X)}return o.get(X)}let Ce=class{constructor(e,t){this.injector=e,this._entityHierarchyFiltersService=t,this._rowCount=30}_getParentNodes(e,t){const n=[],r=e.id.split("_");return r.map((c,s)=>r[s-1]?r.slice(0,s+1).join("_"):c).forEach(c=>{if(c===E)return;const s=ye(c);n.push({id:s,columnName:w(t,c,"id").columnName})}),n}convert(e,t,n,r){var a=this;return(0,u.A)(function*([c,s,h],p,C,y,V=g.ManualDisplayMode){if(!C)return[];const L=Xt(a.injector,V);if(!s?.length){const N=a._entityHierarchyFiltersService.createRootNode(),_=c[0];if(!c?.length||!_)return[N];const x=V===g.ByParentDisplayMode?_.columnName:_.children?.[0]?.columnName;return N.children=yield L.loadData({schemaName:C,columnName:_.columnName,nextLevelColumnName:x,predefinedFilters:h,parentNodes:[],count:a._rowCount,offset:0,sortingColumnName:_.sortingColumnName,sortingDirection:_.sortingDirection}),[N]}const H=(0,Ge.cloneDeep)(yield p[y]);for(const N of s){const _=w(H,N.id,"id");if(!_)continue;const x=_.id===E||V===g.ByParentDisplayMode?c?.[0]:w(c,_.columnName,"columnName")?.children?.[0],ie=x?.columnName;if(!ie)continue;const De=V===g.ByParentDisplayMode?ie:x?.children?.[0]?.columnName,ei=a._getParentNodes(_,H);_.children=_.children||[],_.children?.forEach(ii=>{ii.isLastItem=!1});const ti=yield L.loadData({schemaName:C,columnName:x?.columnName,nextLevelColumnName:De,predefinedFilters:h,parentNodes:ei,count:a._rowCount,offset:_.children.length,sortingColumnName:x?.sortingColumnName,sortingDirection:x?.sortingDirection});_.children.push(...ti)}return H}).apply(this,arguments)}};Ce=(0,d.__decorate)([(0,fe.a)({type:"crt.ToHierarchyNodesConverter"}),(0,d.__metadata)("design:paramtypes",[i.Injector,G])],Ce);function Ze(o,e,t,n){return ve.apply(this,arguments)}function ve(){return ve=(0,u.A)(function*(o,e,t,n,r=g.ManualDisplayMode){if(!o)return;const a=new D.X(ge.H.And,t);if(o.id===E)return a;const c=(0,Ge.cloneDeep)(o),s=yield e[n];if(c.id=ye(c.id),a.add(R(t,[c])),r===g.ManualDisplayMode){const h=We(o.id);let p=[],C=s[0];for(const y of h)p.push({id:ye(y),columnName:C?.columnName}),C=C.children?.[0];p=p?.filter(y=>y.id!==E),p?.length&&a.add(R(t,p))}return a}),ve.apply(this,arguments)}let Ne=class{convert(e,t,n,r){return(0,u.A)(function*([a,c],s,h,p,C=g.ManualDisplayMode){const y=yield Ze(a,s,h,p,C);if(y)return c&&y.add(c),y}).apply(this,arguments)}};Ne=(0,d.__decorate)([(0,fe.a)({type:"crt.ToHierarchyFiltersConverter"})],Ne);let xe=class{constructor(e){this._queryExecutor=e}_formEsq(e,t,n,r){var a=this;return(0,u.A)(function*(){const c=new M.s(e),s=t[t.length-1];c.addSchemaColumn(s.columnName,"Caption");let h=null;return r===g.ManualDisplayMode?h=R(e,t):r===g.ByParentDisplayMode&&(h=R(e,[{columnName:"Id",id:s.id,value:s.value,caption:null}])),c.filters.add(h),yield(0,m.firstValueFrom)(a._queryExecutor.executeSelectQuery(c))})()}_getNodes(e,t,n,r){return(0,u.A)(function*(){const a=yield e[t],c=n.split("_");let s=a[0];const h=[];return r===g.ManualDisplayMode?c.forEach(p=>{h.push({id:p,value:p,columnName:s?.columnName}),s=s?.children?.[0]}):r===g.ByParentDisplayMode&&h.push({id:c[c.length-1],value:c[c.length-1],columnName:s?.columnName}),h})()}convert(e,t,n,r,a){var c=this;return(0,u.A)(function*([s,h],p,C,y,V,L=g.ManualDisplayMode){const H=yield p[V];let N=w(H,s,"id");const _=w(H,E,"id");if(!s)return _;if(!N&&s!==E){const x=yield c._getNodes(p,y,s,L);if(x.find(De=>!De.columnName))return _;const ie=yield c._formEsq(C,x,h,L);if(!ie?.length)return _;N={id:s,value:x[x.length-1].value,columnName:x[x.length-1].columnName,caption:ie[0].Caption.displayValue}}return N}).apply(this,arguments)}};xe=(0,d.__decorate)([(0,fe.a)({type:"crt.HierarchyCheckSelectedNodeExistsConverter"}),(0,d.__metadata)("design:paramtypes",[ee.w])],xe);var Se=l(81517),Fe=l(2828),Z=l(41287),Y=l(844);let Ye=class extends Se.S{};Ye=(0,d.__decorate)([(0,Fe.$)({type:"crt.EntityHierarchyFilterNodeChangeRequest"})],Ye);let Ie=class extends Z.l{handle(e){return(0,u.A)(function*(){const t=e.$context;yield t.set(e.selectedNodeIdProfileAttributeName,e.nodeId),yield t.set(e.specificationFilterAttributeName,null)})()}};Ie=(0,d.__decorate)([(0,Y.l)({type:"crt.EntityHierarchyFilterNodeChangeHandler",requestType:"crt.EntityHierarchyFilterNodeChangeRequest"})],Ie);let qe=class extends Se.S{};qe=(0,d.__decorate)([(0,Fe.$)({type:"crt.EntityHierarchyFilterLoadNodeDataRequest"})],qe);let Ee=class ne extends Z.l{handle(e){return(0,u.A)(function*(){yield e.$context.set(e.searchPhraseAttributeName,null),yield e.$context.set(e.expandedNodesAttributeName,e.nodes)})()}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=i.\u0275\u0275getInheritedFactory(ne)))(n||ne)}})()}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:ne,factory:ne.\u0275fac,providedIn:"root"})}};Ee=(0,d.__decorate)([(0,Y.l)({type:"crt.EntityHierarchyFilterLoadNodeDataHandler",requestType:"crt.EntityHierarchyFilterLoadNodeDataRequest"})],Ee);class k{constructor(e){this._queryExecutor=e}_loadSpecificationListItems(e){const t=e.filter(r=>r.type===v.List);if(!t?.length)return(0,m.of)(e);const n=new M.s("SpecificationListItem");return n.isDistinct=!0,n.addSchemaColumn("Specification"),n.addSchemaColumn("Name"),n.addSchemaColumn("Id"),n.filters.addSchemaColumnInFilterWithParameters(I.H.Equal,"Specification",t.map(r=>r.specificationId)),this._queryExecutor.executeSelectQuery(n).pipe((0,m.map)(r=>this._mapListItems(r)),(0,m.map)(r=>(e.forEach(a=>{a.type===v.List&&(a.listItems=r.filter(c=>c.specificationId===a.specificationId))}),e)))}_mapListItems(e){return e.map(t=>({id:t.Id,name:t.Name,specificationId:t.Specification.value})).sort((t,n)=>t.name.localeCompare(n.name))}_loadSpecifications(e,t,n,r){const a=new M.s(e);if(a.isDistinct=!0,a.addSchemaColumn("Specification"),a.addSchemaColumn("Specification.Type"),a.addSchemaColumn("Specification.Name"),a.filters.addSchemaColumnIsNotNullFilter("Specification"),n){const c=D.X.fromJson(n,_e.b);a.filters.addExistsFilter(`${t}.Id`,c)}if(r){const c=D.X.fromJson(r,_e.b);a.filters.addExistsFilter(`${t}.Id`,c)}return this._queryExecutor.executeSelectQuery(a).pipe((0,m.map)(c=>this._mapSpecifications(c)))}_mapSpecifications(e){return e.map(t=>({specificationId:t.Specification.value,type:t["Specification.Type"].value,caption:t["Specification.Name"]})).sort((t,n)=>t.caption.localeCompare(n.caption))}formSpecificationModels(e,t,n,r){return this._loadSpecifications(e,t,n,r).pipe((0,m.switchMap)(a=>this._loadSpecificationListItems(a)))}formFilters(e,t,n,r){const a=new D.X;for(const c of t.keys()){const s=e.find(p=>p.specificationId===c),h=new D.X;h.addSchemaColumnFilterWithParameter(I.H.Equal,`[${n}:${r}].Specification`,c),s.type===v.Boolean&&this._addBooleanValueFilter(h,t.get(c),n,r),s.type===v.String&&this._addStringValueFilter(h,t.get(c),n,r),(s.type===v.Decimal||s.type===v.Integer)&&this._addNumericValueFilter(h,t.get(c),n,r,s.type),s.type===v.List&&this._addListValueFilter(h,t.get(c),n,r),a.add(h)}return a}_addListValueFilter(e,t,n,r){t?.length&&e.addSchemaColumnInFilterWithParameters(I.H.Equal,`[${n}:${r}].ListItemValue`,t)}_addNumericValueFilter(e,t,n,r,a){const c=a===v.Decimal?"FloatValue":"IntValue";t?.from!==null&&t?.from!==void 0&&e.addSchemaColumnFilterWithParameter(I.H.Greater_or_equal,`[${n}:${r}].${c}`,t.from),t?.to!==null&&t?.to!==void 0&&e.addSchemaColumnFilterWithParameter(I.H.Less_or_equal,`[${n}:${r}].${c}`,t.to)}_addStringValueFilter(e,t,n,r){e.addSchemaColumnFilterWithParameter(I.H.Contain,`[${n}:${r}].StringValue`,t)}_addBooleanValueFilter(e,t,n,r){e.addSchemaColumnFilterWithParameter(I.H.Equal,`[${n}:${r}].BooleanValue`,t)}static{this.\u0275fac=function(t){return new(t||k)(i.\u0275\u0275inject(ee.w))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:k,factory:k.\u0275fac})}}let be=class se extends Z.l{constructor(e){super(),this._injector=e,this._specificationService=this._injector.get(k)}handle(e){var t=this;return(0,u.A)(function*(){const n=e.$context,r=yield n[e.predefinedFilterAttributeName],a=yield n[e.selectedNodeAttributeName],c=yield Ze(a,n,e.schemaName,e.nodesConfigAttributeName,e.displayMode),s=yield(0,m.lastValueFrom)(t._specificationService.formSpecificationModels(e.specificationEntityName,e.specificationReferenceColumnName,r,c));yield e.$context.set(e.specificationFiltersConfigurationAttributeName,s)})()}static{this.\u0275fac=function(t){return new(t||se)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:se,factory:se.\u0275fac,providedIn:"root"})}};be=(0,d.__decorate)([(0,Y.l)({type:"crt.EntityHierarchyLoadSpecificationFiltersHandler",requestType:"crt.EntityHierarchyLoadSpecificationFiltersRequest"}),(0,d.__metadata)("design:paramtypes",[i.Injector])],be);let we=class le extends Z.l{constructor(e){super(),this._injector=e,this._specificationService=this._injector.get(k)}handle(e){var t=this;return(0,u.A)(function*(){const n=e.data,r=t._specificationService.formFilters(n.specificationFiltersConfiguration,n.specificationFiltersValues,n.specificationEntityName,n.specificationReferenceColumnName);yield e.$context.set(e.specificationFilterAttributeName,r)})()}static{this.\u0275fac=function(t){return new(t||le)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac,providedIn:"root"})}};we=(0,d.__decorate)([(0,Y.l)({type:"crt.EntityHierarchyFormSpecificationFiltersHandler",requestType:"crt.EntityHierarchyFormSpecificationFiltersRequest"}),(0,d.__metadata)("design:paramtypes",[i.Injector])],we);var et=l(91775),tt=l(85604);function it(o,e,t){return He.apply(this,arguments)}function He(){return He=(0,u.A)(function*(o,e,t){const n=Object.keys(o.attributes).find(N=>N.endsWith("_ExpandedNodes"));if(!n)return;const r=n.replace("_ExpandedNodes",""),a=`${r}_SchemaName`,c=`${r}_SelectedNode`,s=o.attributes[`${r}_SearchValue`]||"",h=30,p=0,C=e.type===tt.M.Delete,y=o.attributes[a]===e.dataSchemaName,V=o.dataSchemas[t].dataSourceConfig.config.entitySchemaName===o.attributes[a];if(!C&&!y||C&&!V)return;const L=o.attributes[n],H=o.attributes[c];s!==""?yield et.t.instance.process({type:"crt.EntityHierarchyFilterLoadSearchNodeDataRequest",$context:o,schemaName:o.attributes[a],parentColumnNames:[H?.columnName],nodesAttributeName:n.replace("_ExpandedNodes","_SearchResultNodes"),displayMode:g.ByParentDisplayMode,searchPhrase:s,searchPhraseAttributeName:`${r}_SearchValue`,number:h,offset:p}):yield et.t.instance.process({type:"crt.EntityHierarchyFilterLoadNodeDataRequest",$context:o,nodes:L==null?H:null,expandedNodesAttributeName:n})}),He.apply(this,arguments)}let Ve=class extends Z.l{handle(e){var t=this;return(0,u.A)(function*(){const{modelEvent:n,$context:r,modelName:a}=e,c=n?.payload?.primaryAttributesValues;return(Array.isArray(c)&&c.length===1||n.type===tt.M.Delete)&&(yield it(r,n,a)),t.next?.handle?.(e)})()}};Ve=(0,d.__decorate)([(0,Y.l)({type:"crt.EntityHierarchyRefreshOnCrudHandler",requestType:"crt.HandleModelEventRequest"})],Ve);let nt=class extends Se.S{};nt=(0,d.__decorate)([(0,Fe.$)({type:"crt.EntityHierarchyFilterLoadNodeDataRequest"})],nt);let Ae=class de extends Z.l{constructor(e){super(),this._injector=e,this._baseEntityHierarchyFilterLoadDataService=this._injector.get(U)}_handleByParentDisplayMode(e){var t=this;return(0,u.A)(function*(){const n=yield t._baseEntityHierarchyFilterLoadDataService.loadByCaptionContains(e.searchPhrase,e.schemaName,e.parentColumnNames[0],e.number,e.offset);yield e.$context.set(e.searchPhraseAttributeName,e.searchPhrase),n?.length===0&&(yield e.$context.set(e.nodesAttributeName,null)),yield e.$context.set(e.nodesAttributeName,n)})()}_handleManualDisplayMode(e){var t=this;return(0,u.A)(function*(){const n=e.parentColumnNames.map(function(){var c=(0,u.A)(function*(s){return(yield t._baseEntityHierarchyFilterLoadDataService.loadByCaptionContains(e.searchPhrase,e.schemaName+s,s,e.number,e.offset))??[]});return function(s){return c.apply(this,arguments)}}()),a=(yield Promise.all(n)).flat().filter(c=>!!c);a.length&&(yield e.$context.set(e.searchPhraseAttributeName,e.searchPhrase),yield e.$context.set(e.nodesAttributeName,a))})()}handle(e){var t=this;return(0,u.A)(function*(){e.displayMode===g.ByParentDisplayMode?yield t._handleByParentDisplayMode(e):yield t._handleManualDisplayMode(e)})()}static{this.\u0275fac=function(t){return new(t||de)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:de,factory:de.\u0275fac,providedIn:"root"})}};Ae=(0,d.__decorate)([(0,Y.l)({type:"crt.EntityHierarchyFilterLoadSearchNodeDataRequest",requestType:"crt.EntityHierarchyFilterLoadSearchNodeDataRequest"}),(0,d.__metadata)("design:paramtypes",[i.Injector])],Ae);var Ut=l(58957),Zt=l(71281),Yt=l(74368);function qt(o){return{specificationFilterAttributeName:`${o}_SpecificationFilters`,filterAttributeName:`${o}_Filters`,selectedNodeAttributeName:`${o}_SelectedNode`,nodesConfigAttributeName:`${o}_NodesConfig`,filterConverter:"crt.ToHierarchyFiltersConverter",nodesAttributeName:`${o}_Nodes`,expandedNodesAttributeName:`${o}_ExpandedNodes`,specificationFiltersConfigurationAttributeName:`${o}_SpecificationFiltersConfiguration`,selectedTabIndexAttributeName:`${o}_SelectedTabInd`,predefinedFilterAttributeName:`${o}_PredefinedFilter`,selectedNodeIdAttributeName:`${o}_SelectedNodeId`,selectedNodeIdProfileAttributeName:`${o}_SelectedNodeId_Profile`,schemaNameAttributeName:`${o}_SchemaName`,searchPhraseAttributeName:`${o}_SearchValue`,searchResultNodesAttributeName:`${o}_SearchResultNodes`}}class te{constructor(e){this.injector=e,this._componentName="crt.EntityHierarchyFilter",this._expandedItemsAttributeNameSuffix="_ExpandedItems",this._selectedNodeIdAttributeNameSuffix="_SelectedNodeId",this._specificationSettings=[],this._metadataSchemaUtils=(0,i.inject)(Yt.u),this._queryExecutor=e.get(ee.w),this._profileAttributeService=e.get(Zt.H),this._entitySchemaRepository=e.get(ae.v),this._packageInfoService=e.get(Ut.S)}_getComponents(e){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",this._componentName,e.viewConfig).map(t=>t.viewConfig)}_getComponentName(e){return e.name.replace(/\./g,"_")}_setExpandedItemsAttrValue(e,t){if(t.expandedItems)return;const n=`${t.name}${this._expandedItemsAttributeNameSuffix}`;this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"expandedItems",n)}_setAttributeWithChangeRequestForSelectedNodeId(e,t){this._profileAttributeService.createOrUpdateAttributeWithChangeRequest(e,t,"selectedNodeId")}_getSpecificationSettingsEntity(){const e=new M.s("SpecificationSettings");return e.addSchemaColumn("SpecificationEntityName"),e.addSchemaColumn("EntityName"),(0,m.lastValueFrom)(this._queryExecutor.executeSelectQuery(e))}_setSpecificationEntityName(e){const t=this._specificationSettings.find(n=>n.EntityName===e.schemaName);e.specificationEntityName=t?t.SpecificationEntityName:""}_setSpecificationEntityColumnReferenceName(e){var t=this;return(0,u.A)(function*(){if(!e.specificationEntityName)return;const r=(yield(0,m.lastValueFrom)(t._entitySchemaRepository.getSchemaByName(e.specificationEntityName))).columns.filter(a=>!["ModifiedBy","CreatedBy"].includes(a.name)).find(a=>a.referenceSchemaName===e.schemaName);e.specificationReferenceColumnName=r?.name})()}_setComponentConfigValues(e,t){e.nodeClick={request:"crt.EntityHierarchyFilterNodeChangeRequest",params:{selectedNodeIdProfileAttributeName:t.selectedNodeIdProfileAttributeName,specificationFilterAttributeName:t.specificationFilterAttributeName,nodeId:"@event"}},e.specificationFilterChange={request:"crt.EntityHierarchyFormSpecificationFiltersRequest",params:{selectedNodeAttributeName:t.selectedNodeAttributeName,nodesAttributeName:t.nodesAttributeName,specificationReferenceColumnName:e.specificationReferenceColumnName,specificationFilterAttributeName:t.specificationFilterAttributeName,data:"@event"}},e.loadNext={request:"crt.EntityHierarchyFilterLoadNodeDataRequest",params:{expandedNodesAttributeName:t.expandedNodesAttributeName,searchPhraseAttributeName:t.searchPhraseAttributeName,nodes:"@event"}},e.loadSearchNext={request:"crt.EntityHierarchyFilterLoadSearchNodeDataRequest",params:{schemaName:e.schemaName,parentColumnNames:this._extractColumnNames(e.nodesConfig),nodesAttributeName:t.searchResultNodesAttributeName,displayMode:e.displayMode,searchPhrase:"@event.searchPhrase",searchPhraseAttributeName:t.searchPhraseAttributeName,number:"@event.number",offset:"@event.offset"}},e.nodes||(e.nodes=`$${t.nodesAttributeName}`),e.loadSpecificationFilters={request:"crt.EntityHierarchyLoadSpecificationFiltersRequest",params:{specificationEntityName:"@event",selectedNodeAttributeName:t.selectedNodeAttributeName,nodesAttributeName:t.nodesAttributeName,nodesConfigAttributeName:t.nodesConfigAttributeName,schemaName:e.schemaName,displayMode:e.displayMode,specificationFiltersConfigurationAttributeName:t.specificationFiltersConfigurationAttributeName,specificationReferenceColumnName:e.specificationReferenceColumnName,predefinedFilterAttributeName:t.predefinedFilterAttributeName}},e.tabIndexChange={request:"crt.ChangeViewModelAttributeValueRequest",params:{attributeName:t.selectedTabIndexAttributeName,attributeValue:"@event"}}}_setComponentAttributes(e,t,n){const r=t.viewModelConfig.attributes;r[n.schemaNameAttributeName]={value:e.schemaName},e.displayMode=e.displayMode||g.ManualDisplayMode,r[n.nodesConfigAttributeName]={value:e.nodesConfig},r[n.searchResultNodesAttributeName]={value:null},r[n.expandedNodesAttributeName]={value:null},r[n.specificationFilterAttributeName]={value:null},r[n.searchPhraseAttributeName]={value:null},r[n.specificationFiltersConfigurationAttributeName]={value:[]},e.specificationFiltersConfiguration=`$${n.specificationFiltersConfigurationAttributeName}`,r[n.selectedTabIndexAttributeName]={value:0},e.selectedTabIndex=`$${n.selectedTabIndexAttributeName}`,e.searchResultNodes=`$${n.searchResultNodesAttributeName}`,r[n.filterAttributeName]={from:[n.selectedNodeAttributeName,n.specificationFilterAttributeName],converter:`${n.filterConverter} : '${e.schemaName}' : '${n.nodesConfigAttributeName}' : '${e.displayMode}'`,filter:`crt.ToBoolean : $${n.selectedNodeAttributeName}`},r[n.nodesAttributeName]={from:[n.nodesConfigAttributeName,n.expandedNodesAttributeName,n.predefinedFilterAttributeName],converter:`crt.ToHierarchyNodesConverter : '${e.schemaName}' : '${n.nodesAttributeName}' : '${e.displayMode}'`},r[n.selectedNodeAttributeName]={from:[n.selectedNodeIdProfileAttributeName,n.predefinedFilterAttributeName],converter:`crt.HierarchyCheckSelectedNodeExistsConverter : '${e.schemaName}' : '${n.nodesConfigAttributeName}' : '${n.nodesAttributeName}' : '${e.displayMode}'`}}_getComponentAttributeNames(e){const t=this._getComponentName(e);return qt(t)}_isSpecificationPackageInstalled(){var e=this;return(0,u.A)(function*(){return!!(yield(0,m.lastValueFrom)(e._packageInfoService.getPackagesInfo())).find(n=>n.Name==="CrtSpecification")})()}_loadSpecificationSettings(){var e=this;return(0,u.A)(function*(){if(e._specificationSettings.length||!(yield e._isSpecificationPackageInstalled()))return;const t=yield e._getSpecificationSettingsEntity();e._specificationSettings=t})()}_extractColumnNames(e){const t=[];for(const{columnName:n,children:r}of e)n&&t.push(n),r?.length&&t.push(...this._extractColumnNames(r));return t}crtOnMetaDataInit(e){var t=this;return(0,u.A)(function*(){const n=e,r=t._getComponents(n);for(const a of r){yield t._loadSpecificationSettings();const c=t._getComponentAttributeNames(a);t._setComponentAttributes(a,n,c),t._setSpecificationEntityName(a),yield t._setSpecificationEntityColumnReferenceName(a),t._setComponentConfigValues(a,c),t._setExpandedItemsAttrValue(n,a),t._setAttributeWithChangeRequestForSelectedNodeId(n,a)}return e})()}static{this.\u0275fac=function(t){return new(t||te)(i.\u0275\u0275inject(i.Injector))}}static{this.\u0275prov=i.\u0275\u0275defineInjectable({token:te,factory:te.\u0275fac})}}class q{constructor(e,t){this.el=e,this.renderer=t,this.isRtl=!1,this.paddingPerLevel=2,this.treeNodeSelector="[data-item-hierarchy-tree-node]"}ngOnInit(){if(!this.el?.nativeElement?.ariaLevel)return;const e=+this.el.nativeElement.ariaLevel;let t=.5;e!==1&&(t=(e-1)*this.paddingPerLevel);const n=`${t}rem`;let r="padding-left";this.isRtl&&(r="padding-right");const a=this.el.nativeElement.querySelector(this.treeNodeSelector);this.renderer.setStyle(a,r,n)}static{this.\u0275fac=function(t){return new(t||q)(i.\u0275\u0275directiveInject(i.ElementRef),i.\u0275\u0275directiveInject(i.Renderer2))}}static{this.\u0275dir=i.\u0275\u0275defineDirective({type:q,selectors:[["","crtHierarchyTreeNodePadding",""]],inputs:{isRtl:"isRtl"}})}}class O{static{this.\u0275fac=function(t){return new(t||O)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:O})}static{this.\u0275inj=i.\u0275\u0275defineInjector({})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(O,{declarations:[q],exports:[q]})})();var rt=l(40203),at=l(7281),ot=l(57274),ct=l(93213),st=l(25063);class Q{static{this.\u0275fac=function(t){return new(t||Q)}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Q})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[k],imports:[b.CommonModule,rt.D,at.L,ot.u,ct.$,st.D,S.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(Q,{declarations:[B,W,P,z,J,j],imports:[b.CommonModule,rt.D,at.L,ot.u,ct.$,st.D,S.TranslateModule],exports:[B]})})();let oe=class Le{constructor(e){this._materialIconsRegistrar=e,this._materialIconsRegistrar.addIcons([{name:"hierarchy-chevron-down",icon:l(70674)},{name:"tree-skeleton",icon:l(49430)},{name:"filter",icon:l(7716)}])}static{this.\u0275fac=function(t){return new(t||Le)(i.\u0275\u0275inject(Me.K))}}static{this.\u0275mod=i.\u0275\u0275defineNgModule({type:Le})}static{this.\u0275inj=i.\u0275\u0275defineInjector({providers:[G,{provide:dt.m,useClass:te,multi:!0}],imports:[b.CommonModule,Qe.c,he.MatIconModule,Pe.q,O,Q,$e.F,je.q,Be.S,Oe.x,S.TranslateModule,ke.E,Re.q]})}};oe=(0,d.__decorate)([(0,lt.g)({viewElements:[f],converters:[Ce,Ne,xe],requestHandlers:[Ie,Ee,be,we,Ve,Ae]}),(0,d.__metadata)("design:paramtypes",[Me.K])],oe),function(){(typeof ngJitMode>"u"||ngJitMode)&&i.\u0275\u0275setNgModuleScope(oe,{declarations:[f],imports:[b.CommonModule,Qe.c,he.MatIconModule,Pe.q,O,Q,$e.F,je.q,Be.S,Oe.x,S.TranslateModule,ke.E,Re.q],exports:[f]})}()},70674:T=>{T.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path fill-rule="evenodd" clip-rule="evenodd" d="M3.27572 5.27844C3.64335 4.90719 4.2394 4.90719 4.60703 5.27844L8 8.70489L11.393 5.27844C11.7606 4.90719 12.3566 4.90719 12.7243 5.27844C13.0919 5.6497 13.0919 6.25163 12.7243 6.62289L8.66565 10.7216C8.29802 11.0928 7.70198 11.0928 7.33435 10.7216L3.27572 6.62289C2.90809 6.25163 2.90809 5.6497 3.27572 5.27844Z" fill="currentColor"/>\r
</svg>\r
`},27778:T=>{T.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="16" y="17" width="2" height="39" rx="1" fill="#D1D1D1"/>\r
<rect x="34.752" y="31" width="2" height="25" rx="1" fill="#D1D1D1"/>\r
<rect x="17" y="24" width="2" height="9" rx="1" transform="rotate(-90 17 24)" fill="#D1D1D1"/>\r
<rect x="35.752" y="41" width="2" height="9" rx="1" transform="rotate(-90 35.752 41)" fill="#D1D1D1"/>\r
<rect x="34.752" y="56" width="2" height="10" rx="1" transform="rotate(-90 34.752 56)" fill="#D1D1D1"/>\r
<rect x="9" y="3" width="16" height="12" rx="3" fill="#40ACF0"/>\r
<rect x="28" y="17" width="16" height="12" rx="3" fill="#004FD6"/>\r
<rect x="46.752" y="33" width="16" height="12" rx="3" fill="#004FD6"/>\r
<rect x="46.752" y="49" width="16" height="12" rx="3" fill="#004FD6"/>\r
</svg>\r
`},7716:T=>{T.exports=`<svg width="12" height="10" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path d="M4.66667 9C4.66667 9.55229 5.11438 10 5.66667 10H6.33333C6.88562 10 7.33333 9.55229 7.33333 9C7.33333 8.44771 6.88562 8 6.33333 8H5.66667C5.11438 8 4.66667 8.44771 4.66667 9ZM1 0C0.447715 0 0 0.447715 0 1C0 1.55228 0.447715 2 1 2L11 2C11.5523 2 12 1.55228 12 1C12 0.447715 11.5523 0 11 0L1 0ZM2 5C2 5.55228 2.44772 6 3 6L9 6C9.55229 6 10 5.55228 10 5C10 4.44772 9.55229 4 9 4L3 4C2.44772 4 2 4.44772 2 5Z" fill="currentColor"/>\r
</svg>\r
`},49430:T=>{T.exports=`<svg\r
	xmlns="http://www.w3.org/2000/svg" fill="none">\r
	<rect x="12" y="12" width="16" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="36" y="12" width="45%" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="12" y="52" width="16" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="36" y="52" width="20%" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect width="100%" height="40" transform="translate(0 80)" fill="#E7ECFA"/>\r
	<rect x="12" y="92" width="16" height="16" rx="8" fill="white"/>\r
	<rect x="36" y="92" width="75%" height="16" rx="8" fill="white"/>\r
	<rect x="16" y="132" width="16" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="40" y="132" width="70%" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="36" y="172" width="16" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="60" y="172" width="45%" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="12" y="212" width="16" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="36" y="212" width="70%" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="12" y="252" width="16" height="16" rx="8" fill="#E7E7E7"/>\r
	<rect x="36" y="252" width="15%" height="16" rx="8" fill="#E7E7E7"/>\r
</svg>`}}]);
