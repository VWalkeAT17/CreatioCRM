(self.webpackChunkapp_studio_enterprise_schema_view=self.webpackChunkapp_studio_enterprise_schema_view||[]).push([[2656],{42656:(L,f,e)=>{e.d(f,{e:()=>ct});var n=e(5960),d=e(67057),t=e(37851),P=e(55642),C=e(79772),v=e(18351),m=e(47951),M=e(5476),_=e(56484),u=e(1891),p=e(28627),h=e(50663),a=e(57274),o=e(31149),s=e(24091),i=e(90895),l=e(25853),E=e(61148),x=e(39713),y=e(3585),A=e(31616),W=e(63726),V=e(43691),Q=e(5433),k=e(12841),$=e(51521),R=e(18611),T=e(38739),I=e(28503),B=e(30073),K=e(88263),U=e(68759),G=e(90615),nt=e(7917),ot=e(83463),O=e(22307),tt=e(77592),et=e(34760),rt=e(1034),N=e(52793),F=e(50999),c=e(10098),r=e(59969),g=e(8144),D=e(20555),b=e(62278);const j=["*"];let w=class Et extends g.Mm{constructor(S){super(S),this._modeWidthLimit=794,this._subscriptions=new b.Subscription,this.combinedModeEnabledChange=new O.EventEmitter,this.chatViewInit=new O.EventEmitter,this.combinedModeButtonVisibleChange=new O.EventEmitter,this.changeCombinedMode=new O.EventEmitter,this.openChatSession=new O.EventEmitter,this.openChatSessionWithMessage=new O.EventEmitter,this._customEventService=S.get(r.Dj)}_toggleCombinedModeButtonVisibility(S){this.combinedModeButtonVisible!==S&&(this.combinedModeButtonVisible=S,this.combinedModeButtonVisibleChange.emit(S))}_resetCombinedModeButtonEnabled(S){S||(this.combinedModeEnabled=!0,this.combinedModeEnabledChange.emit(!0))}updateResponsiveStyles(){const z=this.elementRef.nativeElement?.parentElement?.getBoundingClientRect().width>this._modeWidthLimit;this._toggleCombinedModeButtonVisibility(z),this._resetCombinedModeButtonEnabled(z),!(z===this.isCombinedMode||!this.combinedModeEnabled)&&this.changeCombinedMode.emit(z)}ngOnInit(){this._subscriptions.add(this._customEventService.subscribe(D.kl).subscribe(S=>this.openChatSession.emit(S))),this._subscriptions.add(this._customEventService.subscribe(D.ll).subscribe(S=>this.openChatSessionWithMessage.emit(S)))}ngAfterViewInit(){super.ngAfterViewInit(),this.chatViewInit.emit()}ngOnDestroy(){this._subscriptions.unsubscribe()}static{this.\u0275fac=function(H){return new(H||Et)(O.\u0275\u0275directiveInject(O.Injector))}}static{this.\u0275cmp=O.\u0275\u0275defineComponent({type:Et,selectors:[["crt-chat"]],inputs:{combinedModeEnabled:"combinedModeEnabled",isCombinedMode:"isCombinedMode",combinedModeButtonVisible:"combinedModeButtonVisible"},outputs:{combinedModeEnabledChange:"combinedModeEnabledChange",chatViewInit:"chatViewInit",combinedModeButtonVisibleChange:"combinedModeButtonVisibleChange",changeCombinedMode:"changeCombinedMode",openChatSession:"openChatSession",openChatSessionWithMessage:"openChatSessionWithMessage"},features:[O.\u0275\u0275InheritDefinitionFeature],ngContentSelectors:j,decls:2,vars:0,consts:[[1,"items"]],template:function(H,z){H&1&&(O.\u0275\u0275projectionDef(),O.\u0275\u0275elementStart(0,"div",0),O.\u0275\u0275projection(1),O.\u0275\u0275elementEnd())},styles:["[_nghost-%COMP%]{display:block;height:100%}.items[_ngcontent-%COMP%]{height:100%}"]})}};(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",Boolean)],w.prototype,"combinedModeEnabled",void 0),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",Object)],w.prototype,"combinedModeEnabledChange",void 0),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",Object)],w.prototype,"chatViewInit",void 0),(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",Boolean)],w.prototype,"isCombinedMode",void 0),(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",Boolean)],w.prototype,"combinedModeButtonVisible",void 0),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",Object)],w.prototype,"combinedModeButtonVisibleChange",void 0),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",O.EventEmitter)],w.prototype,"changeCombinedMode",void 0),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",O.EventEmitter)],w.prototype,"openChatSession",void 0),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",O.EventEmitter)],w.prototype,"openChatSessionWithMessage",void 0),w=(0,n.__decorate)([(0,rt.v)({type:"crt.Chat",contentSlots:["items"]}),(0,N.f)({toolbarConfig:{requiredFeatures:{ShowDesignerDemoItems:!0},position:261,groupType:F.h.Components,icon:e(15208),hint:"Components.Chat.Hint",defaultPropertyValues:{masterSchemaId:"$Id",items:[]},defaultLocalizableStrings:{caption:"Components.Chat.Caption",label:"Components.Chat.Caption"}},propertiesPanelComponentTypeName:"crt.ChatPropertiesPanel",viewElementGroupType:c.J.Components,typeCaption:"Components.Chat.Caption",designControlConfig:{allowDesignContent:!0},designViewItemCommands:{create:"crt.CreateChatCommand"}}),(0,n.__metadata)("design:paramtypes",[O.Injector])],w);var J=e(89863),Y=e(11395),it=e(68712),lt=e(65001),at=e(95211),xt=e(28399),At=e(13232);const Bt=["toolbarItems"],Lt=["inputs"],Rt=X=>({"message-editor-body-button-focussed":X});function bt(X,S){X&1&&O.\u0275\u0275elementContainer(0)}function St(X,S){if(X&1&&(O.\u0275\u0275elementStart(0,"div"),O.\u0275\u0275template(1,bt,1,0,"ng-container",8),O.\u0275\u0275elementEnd()),X&2){const H=S.$implicit;O.\u0275\u0275advance(),O.\u0275\u0275property("ngTemplateOutlet",H)}}function Wt(X,S){if(X&1&&(O.\u0275\u0275elementContainerStart(0),O.\u0275\u0275elementStart(1,"div",6),O.\u0275\u0275template(2,St,2,1,"div",7),O.\u0275\u0275elementEnd(),O.\u0275\u0275elementContainerEnd()),X&2){const H=O.\u0275\u0275nextContext();O.\u0275\u0275advance(2),O.\u0275\u0275property("ngForOf",H.inputsTemplates)}}function Kt(X,S){X&1&&O.\u0275\u0275elementContainer(0)}function Ut(X,S){if(X&1&&(O.\u0275\u0275elementStart(0,"div"),O.\u0275\u0275template(1,Kt,1,0,"ng-container",8),O.\u0275\u0275elementEnd()),X&2){const H=S.$implicit;O.\u0275\u0275advance(),O.\u0275\u0275property("ngTemplateOutlet",H)}}function Ft(X,S){if(X&1&&(O.\u0275\u0275elementContainerStart(0),O.\u0275\u0275elementStart(1,"div",9),O.\u0275\u0275template(2,Ut,2,1,"div",7),O.\u0275\u0275elementEnd(),O.\u0275\u0275elementContainerEnd()),X&2){const H=O.\u0275\u0275nextContext();O.\u0275\u0275advance(2),O.\u0275\u0275property("ngForOf",H.toolbarItemsTemplates)}}let st=class _t extends it.K{constructor(){super(...arguments),this.sizeEnum=lt.Z,this.iconPositionEnum=at.q,this.sendMessage=new O.EventEmitter}set toolbarItems(S){this._toolbarItems=S}set inputs(S){this._inputs=S}onSendClicked(){this.isInputContentEmpty()||this.sendMessage.emit(this.chatInput)}isInputContentEmpty(){return(0,xt.isEmpty)(this.chatInput)}static{this.\u0275fac=(()=>{let S;return function(z){return(S||(S=O.\u0275\u0275getInheritedFactory(_t)))(z||_t)}})()}static{this.\u0275cmp=O.\u0275\u0275defineComponent({type:_t,selectors:[["crt-message-editor-body"]],contentQueries:function(H,z,Z){if(H&1&&(O.\u0275\u0275contentQuery(Z,Bt,4,O.TemplateRef),O.\u0275\u0275contentQuery(Z,Lt,4,O.TemplateRef)),H&2){let q;O.\u0275\u0275queryRefresh(q=O.\u0275\u0275loadQuery())&&(z.toolbarItemsTemplates=q),O.\u0275\u0275queryRefresh(q=O.\u0275\u0275loadQuery())&&(z.inputsTemplates=q)}},inputs:{toolbarItems:"toolbarItems",inputs:"inputs",isFocused:"isFocused",chatInput:"chatInput"},outputs:{sendMessage:"sendMessage"},features:[O.\u0275\u0275InheritDefinitionFeature],decls:8,vars:12,consts:[[1,"message-editor-body"],[4,"ngIf"],[1,"message-editor-body-toolbar"],[1,"message-editor-body-toolbar-dropzone"],[1,"message-editor-body-toolbar-send"],[3,"clicked","ngClass","iconPosition","size","icon","disabled","title"],[1,"message-editor-input-container"],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"],[1,"message-editor-toolbar-container"]],template:function(H,z){H&1&&(O.\u0275\u0275elementStart(0,"div",0),O.\u0275\u0275template(1,Wt,3,1,"ng-container",1),O.\u0275\u0275elementStart(2,"div",2)(3,"div",3),O.\u0275\u0275template(4,Ft,3,1,"ng-container",1),O.\u0275\u0275elementEnd(),O.\u0275\u0275elementStart(5,"div",4)(6,"crt-button",5),O.\u0275\u0275pipe(7,"translate"),O.\u0275\u0275listener("clicked",function(){return z.onSendClicked()}),O.\u0275\u0275elementEnd()()()()),H&2&&(O.\u0275\u0275advance(),O.\u0275\u0275property("ngIf",z.inputsTemplates==null?null:z.inputsTemplates.length),O.\u0275\u0275advance(3),O.\u0275\u0275property("ngIf",z.toolbarItemsTemplates==null?null:z.toolbarItemsTemplates.length),O.\u0275\u0275advance(2),O.\u0275\u0275propertyInterpolate("title",O.\u0275\u0275pipeBind1(7,8,"MessageEditor.SendButtonHint")),O.\u0275\u0275property("ngClass",O.\u0275\u0275pureFunction1(10,Rt,z.isFocused===!0))("iconPosition",z.iconPositionEnum.OnlyIcon)("size",z.sizeEnum.Small)("icon","send-icon")("disabled",z.isInputContentEmpty()))},dependencies:[d.NgClass,d.NgForOf,d.NgIf,d.NgTemplateOutlet,At.B,C.TranslatePipe],styles:["[_nghost-%COMP%]{position:relative;width:100%}[_nghost-%COMP%]   .message-editor-body[_ngcontent-%COMP%]   .message-editor-body-toolbar[_ngcontent-%COMP%]{display:flex;margin-top:-32px;padding:7px 8px 3px 5px}[_nghost-%COMP%]   .message-editor-body[_ngcontent-%COMP%]   .message-editor-body-toolbar[_ngcontent-%COMP%]   .message-editor-body-toolbar-dropzone[_ngcontent-%COMP%]{flex-grow:1}[_nghost-%COMP%]   .message-editor-body[_ngcontent-%COMP%]   .message-editor-body-toolbar[_ngcontent-%COMP%]   .message-editor-body-toolbar-dropzone[_ngcontent-%COMP%]   .message-editor-toolbar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row}[_nghost-%COMP%]   .message-editor-body[_ngcontent-%COMP%]   .message-editor-body-toolbar[_ngcontent-%COMP%]   .message-editor-body-toolbar-send[_ngcontent-%COMP%]{text-align:right}"]})}};(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],st.prototype,"toolbarItems",null),(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],st.prototype,"inputs",null),(0,n.__decorate)([(0,et.j)(),(0,n.__metadata)("design:type",Object)],st.prototype,"sendMessage",void 0),(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",Boolean)],st.prototype,"isFocused",void 0),(0,n.__decorate)([(0,tt.k)(),(0,n.__metadata)("design:type",String)],st.prototype,"chatInput",void 0),st=(0,n.__decorate)([(0,rt.v)({type:"crt.MessageEditorBody",contentSlots:[{name:"inputs",lazy:!0,input:!0},{name:"toolbarItems",lazy:!0,input:!0}]})],st);var Dt=e(73308),jt=e(41287),Vt=e(844),Ht=e(96158);let pt=class extends jt.l{constructor(){super(...arguments),this._actionCode=Ht.g.TriggerMention}handle(S){var H=this;return(0,Dt.A)(function*(){yield H.next?.handle(S),S.$context[S.actionTarget]=H._actionCode,setTimeout(()=>S.$context[S.actionTarget]="",0)})()}};pt=(0,n.__decorate)([(0,Vt.l)({type:"crt.TriggerMentionRequestHandler",requestType:"crt.TriggerMentionRequest"})],pt);var Nt=e(4164),wt=e(13555);let ut=class{constructor(S){this._searchTrimValue=50,this._chatDraftService=S.get(wt.X)}_trimChatPreview(S,H,z){const Z=S||"",q=H?.trim();if(!q||this._chatDraftService.getDraft(z))return S;if(!Z)return Z.length>this._searchTrimValue?Z.slice(0,this._searchTrimValue)+"\u2026":Z;const Tt=Z.toLowerCase().indexOf(q.toLowerCase());if(Tt===-1)return Z.length>this._searchTrimValue?Z.slice(0,this._searchTrimValue)+"\u2026":Z;const gt=Math.max(0,Tt-Math.floor((this._searchTrimValue-q.length)/2));let Ct=gt+this._searchTrimValue;Ct>Z.length&&(Ct=Z.length);let vt=Z.slice(gt,Ct);return gt>0&&(vt="\u2026"+vt),vt}convert(S,H){var z=this;return(0,Dt.A)(function*(){if(!S)return[];const Z=yield H.attributes.ChatsSearchFilter;return S.map(q=>({...q,preview:z._trimChatPreview(q.preview,Z,q.id)}))})()}};ut=(0,n.__decorate)([(0,Nt.a)({type:"crt.ChatPreviewTrimConverter"}),(0,n.__metadata)("design:paramtypes",[O.Injector])],ut);var $t=e(42963),zt=e(39097),Qt=e(20903),kt=e(99556),Gt=e(53395),Xt=e(53251),Zt=e(35794),Jt=e(2675),Yt=e(11661),qt=e(46865),te=e(16365),ee=e(29846),ne=e(1978),oe=e(40870);let ct=class Mt{constructor(S){this._materialIconsRegistrator=S,this._materialIconsRegistrator.addIcons([{name:"message-editor-send-icon",icon:e(21888)},{name:"arrow-down-heavy",icon:e(73869)},{name:"empty-chat-contact-designer-skeleton-icon",icon:e(78517)}])}static{this.\u0275fac=function(H){return new(H||Mt)(O.\u0275\u0275inject(h.K))}}static{this.\u0275mod=O.\u0275\u0275defineNgModule({type:Mt})}static{this.\u0275inj=O.\u0275\u0275defineInjector({providers:[{provide:k.m,useClass:ne.k,multi:!0},{provide:k.m,useClass:oe.D,multi:!0}],imports:[t.MatIconModule,d.CommonModule,a.u,v.C,o.q,s.S,C.TranslateModule,V.X,i.J,$.MarkdownModule.forRoot(),m.x,l.A,M.q,_.S,u.H,E.D,x.E,p.f,Q.f]})}};ct=(0,n.__decorate)([(0,P.g)({viewElements:[R.g,T.E,I.j,st,B.z,K.k,w,ot.l,U.I],requestHandlers:[$t.o,zt.G,Qt.x,pt,kt.m,Gt.b,Xt.h,A.R,W.l,ee.o,Zt.i,Jt.Z,Yt.Y,qt.I,te.T],converters:[ut]}),(0,n.__metadata)("design:paramtypes",[h.K])],ct),function(){(typeof ngJitMode>"u"||ngJitMode)&&O.\u0275\u0275setNgModuleScope(ct,{declarations:[G.z,R.g,T.E,I.j,st,B.z,nt.z,K.k,w,J.d,ot.l,U.I,Y.P],imports:[t.MatIconModule,d.CommonModule,a.u,v.C,o.q,s.S,C.TranslateModule,V.X,i.J,$.MarkdownModule,m.x,l.A,M.q,y.d,_.S,u.H,E.D,x.E,p.f,Q.f],exports:[G.z,R.g,T.E,I.j,st,B.z,nt.z,K.k,w,ot.l,U.I,Y.P]})}()},88263:(L,f,e)=>{e.d(f,{k:()=>s});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(76608),v=e.n(C),m=e(77592),M=e(34760),_=e(1034),u=e(96677),p=e(8144),h=e(13232),a=e(79772),o=e.n(a);let s=class ft extends p.Mm{set caption(l){this._consentText=l}get caption(){return this._sanitizer.bypassSecurityTrustHtml(this._consentText)}constructor(l){super(l),this.acceptClicked=new t.EventEmitter,this._sanitizer=l.get(C.DomSanitizer)}agreeClicked(){this.acceptClicked.emit()}static{this.\u0275fac=function(E){return new(E||ft)(t.\u0275\u0275directiveInject(t.Injector))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:ft,selectors:[["crt-chat-disclaimer"]],inputs:{consentCode:"consentCode",caption:"caption"},outputs:{acceptClicked:"acceptClicked"},features:[t.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[1,"outer-border"],[1,"disclaimer-message",3,"innerHTML"],["color","primary","size","large","data-qa","button-disclaimer-agree",1,"agree-button",3,"clicked"]],template:function(E,x){E&1&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275element(1,"span",1),t.\u0275\u0275elementStart(2,"crt-button",2),t.\u0275\u0275listener("clicked",function(){return x.agreeClicked()}),t.\u0275\u0275text(3),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275elementEnd()()),E&2&&(t.\u0275\u0275advance(),t.\u0275\u0275property("innerHTML",x.caption,t.\u0275\u0275sanitizeHtml),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(4,2,"CopilotDisclaimer.AgreeButton")," "))},dependencies:[h.B,a.TranslatePipe],styles:['.outer-border[_ngcontent-%COMP%]{position:relative;display:inline-block;padding:12px 16px;border-radius:15px;border-width:1px;z-index:1}.outer-border[_ngcontent-%COMP%]   .agree-button[_ngcontent-%COMP%]{padding-top:8px;float:inline-end}.outer-border[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;z-index:-1;border-radius:16px}.outer-border[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:1px;border-radius:15px;z-index:-1}.disclaimer-message[_ngcontent-%COMP%]{display:block}']})}};(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String)],s.prototype,"consentCode",void 0),(0,n.__decorate)([(0,M.j)(),(0,n.__metadata)("design:type",Object)],s.prototype,"acceptClicked",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String),(0,n.__metadata)("design:paramtypes",[String])],s.prototype,"caption",null),s=(0,n.__decorate)([(0,_.v)({type:"crt.ChatDisclaimer",reuseStrategy:u.B.Reuse}),(0,n.__metadata)("design:paramtypes",[t.Injector])],s)},68759:(L,f,e)=>{e.d(f,{I:()=>k});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(86464),v=e(77592),m=e(1034),M=e(15959),_=e(67057),u=e.n(_),p=e(13232),h=e(95588),a=e(84137),o=e(39763),s=e(54653),i=e(79772),l=e.n(i),E=e(38884),x=e(79693);const y=$=>({dataType:$}),A=$=>({$implicit:$});function W($,R){if($&1&&(t.\u0275\u0275elementStart(0,"div",12),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),$&2){const T=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate1(" ",T.chat.unreadMessagesCount," ")}}function V($,R){if($&1){const T=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",13)(1,"crt-button",14,0),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275listener("click",function(B){return t.\u0275\u0275restoreView(T),B.preventDefault(),t.\u0275\u0275resetView(B.stopPropagation())})("menuOpened",function(){t.\u0275\u0275restoreView(T);const B=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(B.isActionsMenuOpened=!0)})("menuClosed",function(){t.\u0275\u0275restoreView(T);const B=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(B.isActionsMenuOpened=!1)}),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(4,"crt-menu",15,1),t.\u0275\u0275elementEnd()}if($&2){const T=t.\u0275\u0275reference(5),I=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(),t.\u0275\u0275property("crtMenuTriggerFor",T)("crtMenuTriggerData",t.\u0275\u0275pureFunction1(6,A,I.chatMenuItems))("caption",t.\u0275\u0275pipeBind1(3,4,"ChatList.ChatItem.ActionsMenuCaption")),t.\u0275\u0275advance(3),t.\u0275\u0275property("items",I.chatMenuItems)}}function Q($,R){if($&1){const T=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",3),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(T);const B=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(B.chatClick())})("mouseenter",function(){t.\u0275\u0275restoreView(T);const B=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(B.onChatHovered(!0))})("mouseleave",function(){t.\u0275\u0275restoreView(T);const B=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(B.onChatHovered(!1))}),t.\u0275\u0275elementStart(1,"div",4),t.\u0275\u0275element(2,"crt-image-input",5),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"div",6),t.\u0275\u0275element(4,"div",7),t.\u0275\u0275pipe(5,"highlight"),t.\u0275\u0275elementStart(6,"div",8),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275text(8),t.\u0275\u0275pipe(9,"dateTimeFormat"),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(10,"div",9),t.\u0275\u0275pipe(11,"highlight"),t.\u0275\u0275pipe(12,"translate"),t.\u0275\u0275template(13,W,2,1,"div",10)(14,V,6,8,"div",11),t.\u0275\u0275elementEnd()()}if($&2){const T=t.\u0275\u0275nextContext();t.\u0275\u0275classMap(T.classes),t.\u0275\u0275attribute("aria-pressed",T.isSelected),t.\u0275\u0275advance(2),t.\u0275\u0275classMap(T.imageClass),t.\u0275\u0275property("value",T.chat.author.photo)("placeholder",T.chat.author.name)("customBorderWidth","1px")("crtTooltip",T.chat.author.name),t.\u0275\u0275advance(2),t.\u0275\u0275property("innerHtml",t.\u0275\u0275pipeBind2(5,17,T.chat.caption,T.searchFilter),t.\u0275\u0275sanitizeHtml),t.\u0275\u0275attribute("aria-label",T.chat.author.name+": "+T.chat.caption),t.\u0275\u0275advance(2),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(7,20,"ChatItem.Date")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind2(9,22,T.chat.date,t.\u0275\u0275pureFunction1(31,y,T.dateFormatType))," "),t.\u0275\u0275advance(2),t.\u0275\u0275property("innerHtml",t.\u0275\u0275pipeBind3(11,25,T.chat.preview,T.searchFilter,!0),t.\u0275\u0275sanitizeHtml),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(12,29,"ChatItem.LastMessage")+": "+T.chat.preview),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",T.chat.unreadMessagesCount>0),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",(T.chatMenuItems==null?null:T.chatMenuItems.length)&&T.messageActionsVisible)}}let k=class Pt{get classes(){return this.isSelected&&this.isCombinedMode?"chat-item chat-item-selected":"chat-item"}get imageClass(){return this.chat?.author.name==="Creatio.ai"?"chat-author-default":"chat-author"}get isCombined(){return this.isCombinedMode}set chat(R){this._chat=R,this._chat&&(this.dateFormatType=this._checkIfDateToday(this._chat.date)?C.r.Time:C.r.Date),(0,t.runInInjectionContext)(this._injector,()=>{(0,t.afterNextRender)(()=>{this._disableAvatarTabFocus()})})}get chat(){return this._chat}get chatMenuItems(){return this._chatMenuItems}set chatMenuItems(R){R?.forEach(T=>{T.clicked.params.callback=I=>{this.menuItemsFocused.emit(I)}}),this._chatMenuItems=R}constructor(R,T){this.elementRef=R,this._injector=T,this._searchTrimValue=50,this.isHovered=!1,this.isFocused=!1,this.isActionsMenuOpened=!1,this.dateFormatType=C.r.Time,this.chatFocused=new t.EventEmitter,this.menuItemsFocused=new t.EventEmitter,this.chatClicked=new t.EventEmitter}_disableAvatarTabFocus(){document.querySelectorAll('.avatar *:not([tabindex="-1"])').forEach(T=>{T.setAttribute("tabindex","-1")})}_checkIfDateToday(R){if(!R)return!1;const T=typeof R=="string"?new Date(R):R;if(!(T instanceof Date)||isNaN(T.getTime()))return!1;const I=new Date;return T.getDate()===I.getDate()&&T.getMonth()===I.getMonth()&&T.getFullYear()===I.getFullYear()}_onChatFocused(){this.chatFocused.emit(this.chat),this.isHovered=!0}_onChatBlurred(){this.isHovered=!1}chatClick(){this.chatClicked.emit(this.chat)}onChatHovered(R){R?this._onChatFocused():this._onChatBlurred()}get messageActionsVisible(){return this.isHovered||this.isActionsMenuOpened||this.isFocused}onFocus(){this.isFocused=!0,this._onChatFocused()}onBlur(){this._onChatBlurred()}onFocusOut(R){const T=R.relatedTarget,I=this.elementRef.nativeElement;(!T||!I.contains(T))&&(this.isFocused=!1)}static{this.\u0275fac=function(T){return new(T||Pt)(t.\u0275\u0275directiveInject(t.ElementRef),t.\u0275\u0275directiveInject(t.Injector))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:Pt,selectors:[["crt-chat-item"]],hostVars:2,hostBindings:function(T,I){T&1&&t.\u0275\u0275listener("focus",function(){return I.onFocus()})("blur",function(){return I.onBlur()})("focusout",function(K){return I.onFocusOut(K)}),T&2&&t.\u0275\u0275classProp("combined-item-mode",I.isCombined)},inputs:{chat:"chat",searchFilter:"searchFilter",chatMenuItems:"chatMenuItems",isCombinedMode:"isCombinedMode",isSelected:"isSelected"},outputs:{chatFocused:"chatFocused",menuItemsFocused:"menuItemsFocused",chatClicked:"chatClicked"},decls:1,vars:1,consts:[["trigger","crtMenuTrigger"],["chatMenu",""],["tabindex","-1","role","button",3,"class","click","mouseenter","mouseleave",4,"ngIf"],["tabindex","-1","role","button",3,"click","mouseenter","mouseleave"],["aria-hidden","true",1,"avatar"],["readonly","true","placeholderMode","abbreviation","borderRadius","large","positioning","cover","size","small",3,"value","placeholder","customBorderWidth","crtTooltip"],[1,"preview-container"],["role","heading","aria-level","3",1,"caption",3,"innerHtml"],[1,"date"],["role","text",1,"preview",3,"innerHtml"],["class","unread-counter",4,"ngIf"],["class","actions-container",4,"ngIf"],[1,"unread-counter"],[1,"actions-container"],["data-qa","actions-button","icon","more-button-icon","iconPosition","only-icon","color","default","size","small","iconPosition","only-icon",1,"chat-item-actions-button",3,"click","menuOpened","menuClosed","crtMenuTriggerFor","crtMenuTriggerData","caption"],[3,"items"]],template:function(T,I){T&1&&t.\u0275\u0275template(0,Q,15,33,"div",2),T&2&&t.\u0275\u0275property("ngIf",I.chat)},dependencies:[_.NgIf,p.B,h.g,a.d,o.IK,s.O,i.TranslatePipe,E.V,x.v],styles:[".chat-item[_ngcontent-%COMP%]{display:flex;padding:16px 16px 16px 8px;align-items:flex-start;align-self:stretch;min-width:0}.chat-item[_ngcontent-%COMP%]   .author[_ngcontent-%COMP%]{margin:0 4px;display:flex;align-items:flex-end;padding-bottom:2px}.chat-item[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]{display:grid;margin-inline-start:8px;padding-top:2px;flex-direction:column;align-items:flex-start;gap:6px;flex:1 0 0;min-width:0;grid-template-columns:1fr auto;grid-template-rows:auto auto}.chat-item[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{align-items:center;gap:10px;flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;min-width:0;grid-column:1;grid-row:1}.chat-item[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{margin-left:8px;white-space:nowrap;grid-column:2;grid-row:1}.chat-item[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .preview[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;word-break:break-word;grid-column:1;grid-row:2;min-height:16px}.chat-item[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .unread-counter[_ngcontent-%COMP%]{margin-left:8px;white-space:nowrap;grid-column:2;grid-row:2;display:flex;justify-content:center;align-items:center;width:20px;height:20px;border-radius:50%;padding:0;justify-self:end;align-self:end}.chat-item[_ngcontent-%COMP%]   .preview-container[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{grid-column:2;grid-row:2;display:flex;justify-content:center;align-items:center;justify-self:end;align-self:end;height:16px}.chat-item-selected[_ngcontent-%COMP%]{border-start-start-radius:8px;border-end-start-radius:8px}[_nghost-%COMP%]:not(.combined-item-mode)   .chat-item[_ngcontent-%COMP%]:hover{cursor:pointer;border-radius:8px}.combined-item-mode[_nghost-%COMP%]   .chat-item[_ngcontent-%COMP%]:hover{cursor:pointer;border-start-start-radius:8px;border-end-start-radius:8px}"]})}};(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",M.H),(0,n.__metadata)("design:paramtypes",[M.H])],k.prototype,"chat",null),(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",String)],k.prototype,"searchFilter",void 0),(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],k.prototype,"chatMenuItems",null),(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",Boolean)],k.prototype,"isCombinedMode",void 0),(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",Boolean)],k.prototype,"isSelected",void 0),k=(0,n.__decorate)([(0,m.v)({type:"crt.ChatItem"}),(0,n.__metadata)("design:paramtypes",[t.ElementRef,t.Injector])],k)},83463:(L,f,e)=>{e.d(f,{l:()=>F});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(77592),v=e(34760),m=e(1034),M=e(96677),_=e(79772),u=e.n(_),p=e(8144),h=e(36169),a=e(26594),o=e(97842),s=e(62278),i=e.n(s),l=e(29957),E=e.n(l),x=e(67057),y=e.n(x),A=e(13232),W=e(12325),V=e(86432),Q=e(58433),k=e(41571),$=e(66675),R=e(22817),T=e(68759);const I=["chatListContainer"],B=["chatItemRef"];function K(c,r){if(c&1){const g=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-search-filter",9),t.\u0275\u0275listener("valueChange",function(b){t.\u0275\u0275restoreView(g);const j=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(j.onSearchFilterChanged(b))}),t.\u0275\u0275elementEnd()}if(c&2){const g=t.\u0275\u0275nextContext();t.\u0275\u0275property("value",g.searchFilter)("iconOnly",!1)}}function U(c,r){if(c&1){const g=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-chat-item",11,3),t.\u0275\u0275listener("chatClicked",function(b){t.\u0275\u0275restoreView(g);const j=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(j.onChatClicked(b))})("chatFocused",function(b){t.\u0275\u0275restoreView(g);const j=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(j.onChatFocused(b))})("menuItemsFocused",function(b){t.\u0275\u0275restoreView(g);const j=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(j.menuItemsFocused(b))}),t.\u0275\u0275elementEnd()}if(c&2){const g=r.$implicit,D=t.\u0275\u0275nextContext(2);t.\u0275\u0275property("chat",g)("searchFilter",D.searchFilter)("isCombinedMode",D.isCombinedMode)("isSelected",g.id===D.selectedChatId)("chatMenuItems",D.menuItems),t.\u0275\u0275attribute("aria-label",D.getChatItemAriaLabel(g))("data-item-marker",g.previewFromServer)("aria-selected",g.id===D.selectedChatId)}}function G(c,r){if(c&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"crt-skeleton-loader",12),t.\u0275\u0275elementContainerEnd()),c&2){const g=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(),t.\u0275\u0275property("styles",g.skeletonConfig)}}function nt(c,r){if(c&1){const g=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",13,3),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementStart(3,"div",14),t.\u0275\u0275listener("crtObserveElementInViewportStateChange",function(b){t.\u0275\u0275restoreView(g);const j=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(j.onLastItemStateChange(b))}),t.\u0275\u0275elementEnd()()}c&2&&t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(2,1,"ChatList.ARIA.LoadMoreTrigger"))}function ot(c,r){if(c&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,U,2,8,"crt-chat-item",10)(2,G,2,1,"ng-container",8)(3,nt,4,3,"ng-template",null,2,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementContainerEnd()),c&2){const g=t.\u0275\u0275reference(4),D=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275property("ngForOf",D.chats)("ngForTrackBy",D.trackByChatId),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",D.loading)("ngIfElse",g)}}function O(c,r){if(c&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275element(1,"crt-placeholder",17),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementContainerEnd()),c&2){const g=t.\u0275\u0275nextContext(3);t.\u0275\u0275advance(),t.\u0275\u0275propertyInterpolate("title",t.\u0275\u0275pipeBind1(2,3,"ChatList.NoDataBySearchFilter")),t.\u0275\u0275propertyInterpolate("subhead",t.\u0275\u0275pipeBind1(3,5,"ChatList.NoDataBySearchFilterSubtitle")),t.\u0275\u0275property("image",g.placeholderSearch)}}function tt(c,r){if(c&1){const g=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",19),t.\u0275\u0275element(1,"crt-lottie",20)(2,"crt-label",21),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementStart(4,"crt-button",22),t.\u0275\u0275pipe(5,"translate"),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(g);const b=t.\u0275\u0275nextContext(4);return t.\u0275\u0275resetView(b.onCreateChatClicked())}),t.\u0275\u0275text(6),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275elementEnd()()}if(c&2){const g=t.\u0275\u0275nextContext(4);t.\u0275\u0275advance(),t.\u0275\u0275property("config",g.noDataAnimationOptions),t.\u0275\u0275advance(),t.\u0275\u0275property("caption",t.\u0275\u0275pipeBind1(3,4,"ChatList.NoDataMessage")),t.\u0275\u0275advance(2),t.\u0275\u0275property("title",t.\u0275\u0275pipeBind1(5,6,"ChatList.CreateChatButton")),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(7,8,"ChatList.CreateChatButton")," ")}}function et(c,r){if(c&1&&t.\u0275\u0275template(0,tt,8,10,"div",18),c&2){const g=t.\u0275\u0275nextContext(3);t.\u0275\u0275property("ngIf",g.showNoDataBlankState)}}function rt(c,r){if(c&1&&(t.\u0275\u0275elementStart(0,"div",16),t.\u0275\u0275template(1,O,4,7,"ng-container",8)(2,et,1,1,"ng-template",null,4,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()),c&2){const g=t.\u0275\u0275reference(3),D=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",D.searchFilter)("ngIfElse",g)}}function N(c,r){if(c&1&&t.\u0275\u0275template(0,rt,4,2,"div",15),c&2){const g=t.\u0275\u0275nextContext();t.\u0275\u0275property("ngIf",!g.loading&&(g.chats==null?null:g.chats.length)===0)}}let F=class Ot extends p.Mm{get addCombinedModeClass(){return this.isCombinedMode}get isSearchDisabled(){return!this._featureValues||!this.searchDisableFeatureName?!1:this._featureValues[this.searchDisableFeatureName]}constructor(r,g){super(r),this._injector=r,this._featureValues=g,this._rowsToLoadCount=15,this._focusedIndex=-1,this._destroy$=new s.Subject,this._translateService=(0,t.inject)(_.TranslateService),this.skeletonConfig={display:"inline-flex",height:"80px",width:"100%","margin-bottom":"16px"},this.noDataAnimationOptions={animationData:()=>e.e(9295).then(e.t.bind(e,39295,19)),autoplay:!0,loop:!1},this.placeholderSearch={type:"animation",name:"search",autoplay:!0,loop:!0},this.searchFilterChange=new t.EventEmitter,this.chatsListChange=new t.EventEmitter,this.menuItems=[],this.focusedChatIdChange=new t.EventEmitter,this.currentPageChange=new t.EventEmitter,this.chatClicked=new t.EventEmitter,this.createChatClicked=new t.EventEmitter,this.loadData=new t.EventEmitter,this.showNoDataBlankState=!0}_containerFocusedHandler(r){if(this._focusedIndex=0,r.key!=="Enter")return;const g=this.chatItemElements?.first?.nativeElement;g&&(r.preventDefault(),g.focus())}_focusOnContainer(){if(this.loading)return;this._focusedIndex=0;const r=this.chatListContainerRef?.nativeElement;r&&r.focus()}_getActionsButton(r){return r.querySelector(".chat-item-actions-button button")}_itemsFocusedHandler(r){const g=this.chatItemElements.toArray(),D=this.chatItemComponents.toArray();if(!g.length)return;const b=document.activeElement,j=g.findIndex(at=>at.nativeElement.contains(b));if(j===-1)return;const w=at=>{at>=0&&at<g.length?(this._focusedIndex=at,g[at].nativeElement.focus()):this._focusOnContainer()},J=g[j].nativeElement,Y=this._getActionsButton(J),it=Y&&b===Y,lt=!!Y;switch(r.key){case"Tab":r.preventDefault(),r.shiftKey?it?J.focus():w(j-1):lt&&!it?Y?.focus():w(j+1);break;case"ArrowDown":r.preventDefault(),lt&&!it?Y?.focus():w(j+1);break;case"ArrowUp":r.preventDefault(),it?J.focus():w(j-1);break;case"Enter":r.preventDefault(),it?(D[j].keepMenuVisible=!0,Y?.click()):this.onChatClicked(this.chats[j]),this._focusedIndex=-1;break;case"Escape":r.preventDefault(),it?J.focus():this._focusOnContainer();break}}ngAfterViewInit(){this.chatItemElements.changes.pipe((0,s.takeUntil)(this._destroy$)).subscribe(()=>{setTimeout(()=>{const r=this.chatItemElements.toArray();r[this._focusedIndex]&&r[this._focusedIndex].nativeElement.focus()})})}onChatClicked(r){this.chatClicked.emit(r)}onCreateChatClicked(){this.createChatClicked.emit()}onLastItemStateChange(r){r.visible!==!1&&(this.loading||this.chats.length<this._rowsToLoadCount||this.loadData.emit({count:this._rowsToLoadCount,search:this.searchFilter||""}))}onKeydown(r){return document.activeElement===this.chatListContainerRef.nativeElement?this._containerFocusedHandler(r):this._itemsFocusedHandler(r)}onChatFocused(r){this.focusedChatId=r?.id,this.focusedChatIdChange.emit(this.focusedChatId)}onSearchFilterChanged(r){this.searchFilter!==r?.value&&(this.searchFilter=r?.value||"",this.loading=!0,this.chats=[],this.chatsListChange.emit(this.chats),this.searchFilterChange.emit(this.searchFilter),this.currentPageChange.emit(0),this.loadData.emit({count:this._rowsToLoadCount,search:this.searchFilter||""}))}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}menuItemsFocused(r){const D=this.chatItemComponents.toArray().find(b=>b.chat.id===r);D?.keepMenuVisible&&(D.keepMenuVisible=!1,D.isFocused=!0,setTimeout(()=>{const b=this._getActionsButton(D.elementRef.nativeElement);b&&b.focus()},0))}getChatItemAriaLabel(r){if(r.caption&&r.preview){const g=this._translateService.instant("ChatList.ARIA.ChatItem");if(g)return l.String.format(g,r.caption,r.preview)}return""}trackByChatId(r,g){return g.id}static{this.\u0275fac=function(g){return new(g||Ot)(t.\u0275\u0275directiveInject(t.Injector),t.\u0275\u0275directiveInject(a.G))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:Ot,selectors:[["crt-chat-list"]],viewQuery:function(g,D){if(g&1&&(t.\u0275\u0275viewQuery(I,7),t.\u0275\u0275viewQuery(B,5,t.ElementRef),t.\u0275\u0275viewQuery(B,5)),g&2){let b;t.\u0275\u0275queryRefresh(b=t.\u0275\u0275loadQuery())&&(D.chatListContainerRef=b.first),t.\u0275\u0275queryRefresh(b=t.\u0275\u0275loadQuery())&&(D.chatItemElements=b),t.\u0275\u0275queryRefresh(b=t.\u0275\u0275loadQuery())&&(D.chatItemComponents=b)}},hostVars:2,hostBindings:function(g,D){g&2&&t.\u0275\u0275classProp("combined-mode",D.addCombinedModeClass)},inputs:{searchFilter:"searchFilter",chats:"chats",menuItems:"menuItems",selectedChatId:"selectedChatId",searchDisableFeatureName:"searchDisableFeatureName",focusedChatId:"focusedChatId",isCombinedMode:"isCombinedMode",currentPage:"currentPage",showNoDataBlankState:"showNoDataBlankState"},outputs:{searchFilterChange:"searchFilterChange",chatsListChange:"chatsListChange",focusedChatIdChange:"focusedChatIdChange",currentPageChange:"currentPageChange",chatClicked:"chatClicked",createChatClicked:"createChatClicked",loadData:"loadData"},features:[t.\u0275\u0275ProvidersFeature([{provide:h.P,useValue:1e3}]),t.\u0275\u0275InheritDefinitionFeature],decls:8,vars:6,consts:[["chatListContainer",""],["blankslate",""],["lastRow",""],["chatItemRef",""],["noDataBlankslate",""],[1,"chats-search-container"],[3,"value","iconOnly","valueChange",4,"ngIf"],["tabindex","0","role","listbox",1,"chat-list-container",3,"keydown"],[4,"ngIf","ngIfElse"],[3,"valueChange","value","iconOnly"],["tabindex","-1","role","option",3,"chat","searchFilter","isCombinedMode","isSelected","chatMenuItems","chatClicked","chatFocused","menuItemsFocused",4,"ngFor","ngForOf","ngForTrackBy"],["tabindex","-1","role","option",3,"chatClicked","chatFocused","menuItemsFocused","chat","searchFilter","isCombinedMode","isSelected","chatMenuItems"],["appearance","line","count","4",3,"styles"],["tabindex","-1","role","option","aria-selected","false",1,"observe-last-row"],["crtObserveElementInViewport","",3,"crtObserveElementInViewportStateChange"],["class","no-data-container",4,"ngIf"],[1,"no-data-container"],[3,"image","title","subhead"],["class","no-data-content",4,"ngIf"],[1,"no-data-content"],[3,"config"],["labelTextAlign","center",1,"no-data-label",3,"caption"],["size","large","icon","edit-button-icon","iconPosition","left-icon",1,"create-chat-button",3,"clicked","title"]],template:function(g,D){if(g&1){const b=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",5),t.\u0275\u0275template(1,K,1,2,"crt-search-filter",6),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(2,"div",7,0),t.\u0275\u0275pipe(4,"translate"),t.\u0275\u0275listener("keydown",function(w){return t.\u0275\u0275restoreView(b),t.\u0275\u0275resetView(D.onKeydown(w))}),t.\u0275\u0275template(5,ot,5,4,"ng-container",8)(6,N,1,1,"ng-template",null,1,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()}if(g&2){const b=t.\u0275\u0275reference(7);t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",!D.isSearchDisabled),t.\u0275\u0275advance(),t.\u0275\u0275attribute("aria-label",t.\u0275\u0275pipeBind1(4,4,"ChatList.ARIA.Label")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngIf",D.loaderVisible||D.chats&&D.chats.length>0)("ngIfElse",b)}},dependencies:[x.NgForOf,x.NgIf,A.B,W.V,V.w,Q.W,k.w,$.d,R.Q,T.I,_.TranslatePipe],styles:[".chat-list-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:relative;height:calc(100% - 40px);margin:2px 2px 0 0;width:100%;max-width:794px;overflow-y:auto}.chat-list-container[_ngcontent-%COMP%]   #chat-list-no-data-animation[_ngcontent-%COMP%]{cursor:pointer}.chat-list-container[_ngcontent-%COMP%]   .no-data-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:calc(100% - 40px)}.chat-list-container[_ngcontent-%COMP%]   .no-data-container[_ngcontent-%COMP%]   .no-data-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:absolute;flex-direction:column;top:50%;left:50%;transform:translate(-50%,-50%)}.chat-list-container[_ngcontent-%COMP%]   .no-data-container[_ngcontent-%COMP%]   .no-data-content[_ngcontent-%COMP%]   .create-chat-button[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .chats-search-container[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]:not(.combined-mode){width:100%;margin-right:0}.combined-mode[_nghost-%COMP%]{width:354px;margin-inline-end:16px}.combined-mode[_nghost-%COMP%]   .chat-list-container[_ngcontent-%COMP%]{min-width:354px!important}.observe-last-row[_ngcontent-%COMP%]{height:1px;position:sticky;left:0;right:0}.observe-last-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:1px}"]})}};(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",l.String)],F.prototype,"searchFilter",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"searchFilterChange",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],F.prototype,"chats",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"chatsListChange",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],F.prototype,"menuItems",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",l.String)],F.prototype,"selectedChatId",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",l.String)],F.prototype,"searchDisableFeatureName",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",l.String)],F.prototype,"focusedChatId",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"focusedChatIdChange",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Boolean)],F.prototype,"isCombinedMode",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Number)],F.prototype,"currentPage",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"currentPageChange",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"chatClicked",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"createChatClicked",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],F.prototype,"loadData",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Object)],F.prototype,"showNoDataBlankState",void 0),F=(0,n.__decorate)([(0,m.v)({type:"crt.ChatList",contentSlots:["chats"],reuseStrategy:M.B.Reuse}),(0,n.__metadata)("design:paramtypes",[t.Injector,o.x])],F)},90615:(L,f,e)=>{e.d(f,{z:()=>p});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(11629),v=e(77592);const m=["messages"],M=[[["",8,"messages-header"]]],_=[".messages-header"];function u(h,a){}class p{get _lastAuthor(){return this._renderedMessages.length===0?this._lastMessageAuthor:this._renderedMessages[this._renderedMessages.length-1]?.author?.name??null}constructor(a){this._renderer=a,this._renderedMessages=[],this._lastMessageAuthor=null,this._messagesCounter=0,this._lastMessageDirections=null,this._isRendering=!1,this._messageElementsMap=new Map,this._messageEventHandlers=new Map,this.messagePositionAttributeName="chat-message-position",this.messageIdAttributeName="chat-message-id",this.event=new t.EventEmitter}_getParentContainer(){return this.messagesContainer.nativeElement.parentElement}_updateMessages(a){if(this._isRendering)return;if(this._isRendering=!0,a.length===0){this.reset(),this._isRendering=!1;return}const o=new Set(this._renderedMessages.map(E=>E.id)),s=new Set(a.map(E=>E.id)),i=this._renderedMessages.filter(E=>!s.has(E.id)),l=a.filter(E=>o.has(E.id)&&JSON.stringify(this._renderedMessages.find(x=>x.id===E.id))!==JSON.stringify(E));i.forEach(E=>{this._removeMessage(E.id)}),l.forEach(E=>{this._updateMessage(E)}),a.forEach((E,x)=>{const y=this._messageElementsMap.get(E.id);if(y){const A=this._getParentContainer();Array.from(A.children).indexOf(y)!==x&&(this._renderer.removeChild(A,y),this._insertMessageAtPosition(y,x,A))}else this._addMessage(E,a)}),this._renderedMessages=[...a],this._isRendering=!1}_removeMessage(a){const o=this._messageElementsMap.get(a);if(o){const s=this._messageEventHandlers.get(a);s&&(o.removeEventListener("event",s),this._messageEventHandlers.delete(a)),this._renderer.removeChild(this._getParentContainer(),o),this._messageElementsMap.delete(a)}}_updateMessage(a){const o=this._messageElementsMap.get(a.id);o&&this._renderer.setProperty(o,"message",a)}_addMessage(a,o){this._messagesCounter++;const s=C.L.getSelector(a.type),i=this._renderer.createElement(s);i.classList.add("chat-message"),this._lastMessageDirections!==a.direction&&(i.classList.add("message-group-starter"),this._lastMessageDirections=a.direction),this._renderer.setProperty(i,"message",a),this._renderer.setProperty(i,"searchFilter",this.searchFilter),this._renderer.setAttribute(i,this.messagePositionAttributeName,`${this._messagesCounter}`),this._renderer.setAttribute(i,this.messageIdAttributeName,a.id);const l=this._getParentContainer(),E=o.findIndex(y=>y.id===a.id);this._insertMessageAtPosition(i,E,l),this._messageElementsMap.set(a.id,i);const x=y=>{this.event.emit(y.detail)};i.addEventListener("event",x),this._messageEventHandlers.set(a.id,x)}_insertMessageAtPosition(a,o,s){const i=Array.from(s.children);o<i.length?this._renderer.insertBefore(s,a,i[o]):this._renderer.appendChild(s,a)}_processMessages(a){let o=this._lastAuthor;return a.map(s=>s.author?.name!==o||s.isBotMessage===!0?(o=s.author?.name??null,this._lastMessageAuthor=o,s):{...s,author:null})}ngAfterViewChecked(){this.rerenderMessages(this.messages)}rerenderMessages(a){if(!a||a?.length===0||this._isRendering||this._getParentContainer()?.childElementCount>0||this._renderedMessages.length===0||(this.messages?.length??0)===0)return;this._isRendering=!0,this.reset();const o=this._processMessages(a);o.forEach(s=>{this._addMessage(s,o)}),this._renderedMessages=[...o],this._isRendering=!1}reset(){this._messagesCounter=0,this._renderedMessages=[];for(const[s,i]of this._messageElementsMap.entries()){const l=this._messageEventHandlers.get(s);l&&i.removeEventListener("event",l)}this._messageEventHandlers.clear(),this._messageElementsMap.clear();const a=this._getParentContainer();Array.from(a?.children||[]).forEach(s=>{this._renderer.removeChild(a,s)})}ngOnChanges(a){if("searchFilter"in a){const o=this.messagesContainer.nativeElement.scrollTop;this.reset(),requestAnimationFrame(()=>{this.messagesContainer.nativeElement.scrollTop=o})}if("messages"in a){const o=a.messages?.currentValue||this.messages;if(!o||o.length===0){this.reset();return}const s=this._processMessages(o);this._updateMessages(s)}}static{this.\u0275fac=function(o){return new(o||p)(t.\u0275\u0275directiveInject(t.Renderer2))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:p,selectors:[["crt-chat-messages"]],viewQuery:function(o,s){if(o&1&&t.\u0275\u0275viewQuery(m,7,t.ElementRef),o&2){let i;t.\u0275\u0275queryRefresh(i=t.\u0275\u0275loadQuery())&&(s.messagesContainer=i.first)}},inputs:{searchFilter:"searchFilter",messages:"messages"},outputs:{event:"event"},features:[t.\u0275\u0275NgOnChangesFeature],ngContentSelectors:_,decls:6,vars:0,consts:[["messages",""],[1,"wrapper"],[1,"header-container"],[1,"messages-container"]],template:function(o,s){o&1&&(t.\u0275\u0275projectionDef(M),t.\u0275\u0275elementStart(0,"div",1)(1,"div",2),t.\u0275\u0275projection(2),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(3,"div",3),t.\u0275\u0275template(4,u,0,0,"ng-template",null,0,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()())}})}}(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",String)],p.prototype,"searchFilter",void 0),(0,n.__decorate)([(0,v.k)(),(0,n.__metadata)("design:type",Array)],p.prototype,"messages",void 0)},38739:(L,f,e)=>{e.d(f,{E:()=>i});var n=e(5960),d=e.n(n),t=e(77592),P=e(1034),C=e(96677),v=e(23872),m=e(22307),M=e.n(m),_=e(67057),u=e.n(_),p=e(12325),h=e(95588),a=e(86432);function o(l,E){if(l&1&&m.\u0275\u0275element(0,"crt-image-input",10),l&2){const x=m.\u0275\u0275nextContext(2);m.\u0275\u0275property("value",x.author.photo)("placeholder",x.author.name)}}function s(l,E){if(l&1&&(m.\u0275\u0275elementStart(0,"div",7),m.\u0275\u0275template(1,o,1,2,"crt-image-input",8),m.\u0275\u0275element(2,"crt-label",9),m.\u0275\u0275elementEnd()),l&2){const x=m.\u0275\u0275nextContext();m.\u0275\u0275advance(),m.\u0275\u0275property("ngIf",x.shouldShowImage),m.\u0275\u0275advance(),m.\u0275\u0275property("caption",x.author.name)}}let i=class yt{constructor(){this.ignoredAuthors=["Creatio.ai"]}get shouldShowImage(){return!!(this.author&&!this.ignoredAuthors.includes(this.author.name))}_initAnimation(){this.typingAnimation={animationData:()=>e.e(7228).then(e.t.bind(e,37228,19)),autoplay:!0,loop:!0}}ngOnInit(){this._initAnimation()}static{this.\u0275fac=function(x){return new(x||yt)}}static{this.\u0275cmp=m.\u0275\u0275defineComponent({type:yt,selectors:[["crt-chat-typing"]],inputs:{author:"author",message:"message",loading:"loading"},decls:7,vars:3,consts:[[1,"typing"],["class","author",4,"ngIf"],[1,"typing-message"],[1,"animation"],["width","16px","height","16px",3,"config"],[1,"text"],["labelColor","var(--crt-palette-label-500)","labelType","caption","labelFontSize","10px",1,"typing-text",3,"caption"],[1,"author"],["readonly","true","class","author-image","placeholderMode","abbreviation","borderRadius","large","positioning","cover","size","extra-small",3,"value","placeholder",4,"ngIf"],["labelColor","var(--crt-palette-label-500)","labelType","caption","labelFontSize","12px",1,"author-text",3,"caption"],["readonly","true","placeholderMode","abbreviation","borderRadius","large","positioning","cover","size","extra-small",1,"author-image",3,"value","placeholder"]],template:function(x,y){x&1&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275template(1,s,3,2,"div",1),m.\u0275\u0275elementStart(2,"div",2)(3,"div",3),m.\u0275\u0275element(4,"crt-lottie",4),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(5,"div",5),m.\u0275\u0275element(6,"crt-label",6),m.\u0275\u0275elementEnd()()()),x&2&&(m.\u0275\u0275advance(),m.\u0275\u0275property("ngIf",y.author),m.\u0275\u0275advance(3),m.\u0275\u0275property("config",y.typingAnimation),m.\u0275\u0275advance(2),m.\u0275\u0275property("caption",y.message))},dependencies:[_.NgIf,p.V,h.g,a.w],styles:[".author[_ngcontent-%COMP%], .typing-message[_ngcontent-%COMP%]{display:flex;gap:8px;margin:10px 0}"]})}};(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",v.B)],i.prototype,"author",void 0),(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",String)],i.prototype,"message",void 0),(0,n.__decorate)([(0,t.k)(),(0,n.__metadata)("design:type",Boolean)],i.prototype,"loading",void 0),i=(0,n.__decorate)([(0,P.v)({type:"crt.ChatTyping",reuseStrategy:C.B.Reuse})],i)},89863:(L,f,e)=>{e.d(f,{d:()=>h});var n=e(22307),d=e.n(n),t=e(67057),P=e.n(t),C=e(58433);const v=()=>({width:"80%",height:"32px","border-radius":"8px"}),m=()=>[1,2,3,4],M=(a,o)=>({left:a,right:o}),_=()=>({width:"60%",height:"16px","border-radius":"16px"}),u=()=>({width:"80%",height:"104px","border-radius":"16px"});function p(a,o){if(a&1&&(n.\u0275\u0275elementStart(0,"div",6),n.\u0275\u0275element(1,"crt-skeleton-loader",1)(2,"crt-skeleton-loader",7),n.\u0275\u0275elementEnd()),a&2){const s=o.index;n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction2(3,M,(s+1)%2===0,(s+1)%2!==0)),n.\u0275\u0275advance(),n.\u0275\u0275property("styles",n.\u0275\u0275pureFunction0(6,_)),n.\u0275\u0275advance(),n.\u0275\u0275property("styles",n.\u0275\u0275pureFunction0(7,u))}}class h{constructor(){}static{this.\u0275fac=function(s){return new(s||h)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:h,selectors:[["crt-conversation-skeleton"]],decls:6,vars:4,consts:[[1,"conversation-skeleton-container"],["appearance","line","count","1",1,"caption",3,"styles"],[1,"divider"],[1,"messages"],["class","item-skeleton",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-container"],[1,"item-skeleton",3,"ngClass"],["appearance","line","count","1",1,"content",3,"styles"]],template:function(s,i){s&1&&(n.\u0275\u0275elementStart(0,"div",0),n.\u0275\u0275element(1,"crt-skeleton-loader",1)(2,"div",2),n.\u0275\u0275elementStart(3,"div",3),n.\u0275\u0275template(4,p,3,8,"div",4),n.\u0275\u0275elementEnd(),n.\u0275\u0275element(5,"div",5),n.\u0275\u0275elementEnd()),s&2&&(n.\u0275\u0275advance(),n.\u0275\u0275property("styles",n.\u0275\u0275pureFunction0(2,v)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngForOf",n.\u0275\u0275pureFunction0(3,m)))},dependencies:[t.NgClass,t.NgForOf,C.W],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;justify-content:center}.conversation-skeleton-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;width:100%;max-width:800px;height:100%}.conversation-skeleton-container[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{height:1px;margin:16px 0 24px;width:100%}.conversation-skeleton-container[_ngcontent-%COMP%]   .messages[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding-bottom:16px}.conversation-skeleton-container[_ngcontent-%COMP%]   .item-skeleton[_ngcontent-%COMP%]{margin:16px 8px 0}.conversation-skeleton-container[_ngcontent-%COMP%]   .item-skeleton.right[_ngcontent-%COMP%]{text-align:right}.conversation-skeleton-container[_ngcontent-%COMP%]   .item-skeleton.left[_ngcontent-%COMP%]{text-align:left}.conversation-skeleton-container[_ngcontent-%COMP%]   .item-skeleton[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{margin-bottom:8px}.conversation-skeleton-container[_ngcontent-%COMP%]   .item-skeleton[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{margin-bottom:16px}.conversation-skeleton-container[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{padding:12px 8px;flex-shrink:0;border-radius:8px;height:80px}"]})}}},18611:(L,f,e)=>{e.d(f,{g:()=>N});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(77592),v=e(34760),m=e(1034),M=e(52793),_=e(50999),u=e(10098),p=e(8144),h=e(22701),a=e(48594),o=e(36169),s=e(90204),i=e(28399),l=e.n(i),E=e(43778),x=e(19540),y=e(90615),A=e(37851),W=e.n(A),V=e(67057),Q=e.n(V),k=e(13232),$=e(89863),R=e(79772),T=e.n(R);const I=["typing"],B=["contentWrap"],K=[[["","slot","information"]],[["","slot","placeholder"]],[["","slot","tools"]],[["","slot","actions"]],[["","slot","typing"]]],U=["[slot='information']","[slot='placeholder']","[slot='tools']","[slot='actions']","[slot='typing']"];function G(F,c){F&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"div",12),t.\u0275\u0275projection(2,3),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(3,"div",13),t.\u0275\u0275elementContainerEnd())}function nt(F,c){if(F&1){const r=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-button",14),t.\u0275\u0275listener("clicked",function(){t.\u0275\u0275restoreView(r);const D=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(D.onLoadPreviousMessagesClicked())}),t.\u0275\u0275text(1),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275elementEnd()}F&2&&(t.\u0275\u0275property("size","medium"),t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(2,2,"Conversation.LoadPreviousChat")))}function ot(F,c){F&1&&(t.\u0275\u0275elementStart(0,"div",15,2),t.\u0275\u0275projection(2,4),t.\u0275\u0275elementEnd())}function O(F,c){if(F&1&&(t.\u0275\u0275elementStart(0,"span",20),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),F&2){const r=t.\u0275\u0275nextContext(3);t.\u0275\u0275advance(),t.\u0275\u0275textInterpolate(r.unreadMessages>9?"9+":r.unreadMessages)}}function tt(F,c){if(F&1){const r=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",16),t.\u0275\u0275listener("click",function(){t.\u0275\u0275restoreView(r);const D=t.\u0275\u0275nextContext(2);return t.\u0275\u0275resetView(D.onScrollToBottomButtonClick())}),t.\u0275\u0275template(1,O,2,1,"span",17),t.\u0275\u0275elementStart(2,"div",18),t.\u0275\u0275element(3,"mat-icon",19),t.\u0275\u0275elementEnd()()}if(F&2){const r=t.\u0275\u0275nextContext(2);t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",r.unreadMessages>0)}}function et(F,c){if(F&1){const r=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,G,4,0,"ng-container",4),t.\u0275\u0275elementStart(2,"div",5),t.\u0275\u0275projection(3),t.\u0275\u0275elementStart(4,"div",6,1),t.\u0275\u0275template(6,nt,3,4,"crt-button",7),t.\u0275\u0275elementStart(7,"crt-chat-messages",8),t.\u0275\u0275listener("event",function(D){t.\u0275\u0275restoreView(r);const b=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(b.onChatMessageEvent(D))}),t.\u0275\u0275projection(8,1,[1,"messages-header"]),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(9,ot,3,0,"div",9),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(10,tt,4,1,"div",10),t.\u0275\u0275elementStart(11,"div",11),t.\u0275\u0275projection(12,2),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementContainerEnd()}if(F&2){const r=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",!r.isEmbeddedMode),t.\u0275\u0275advance(5),t.\u0275\u0275property("ngIf",r.hasPreviousMessages),t.\u0275\u0275advance(),t.\u0275\u0275property("messages",r.messages)("searchFilter",r.searchFilter),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",r.isTyping),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",r.isScrolledUp)}}function rt(F,c){F&1&&t.\u0275\u0275element(0,"crt-conversation-skeleton")}let N=class It extends p.Mm{get _messagesContainer(){return this._chatMessagesComponent?.messagesContainer?.nativeElement?.parentElement}get _scrollContainer(){return this._contentWrap?.nativeElement}set conversationEvent(c){c?.forEach(r=>{r.name===E.R&&(this._chatMessagesComponent?.reset(),this.isScrolledUp=!1,this.unreadMessages=0,this._isPaginationEnabled=!1)}),c?.length&&this.conversationEventChange.emit([])}constructor(c){super(c),this.injector=c,this._scrollOnOpen=!0,this._isSilentScroll=!1,this._isPaginationEnabled=!0,this._isPaginationTriggered=!1,this._scrollPositionBeforePagination=0,this._previousScrollTop=0,this._shouldRestoreFocus=!1,this._lockFocus=!1,this._isMessagesCountChanged=!1,this._scrollPaginationThreshold=300,this._needRestorePagination=!1,this._onScrollHandlerFn=(0,i.debounce)(r=>this._onScrollHandler(r),100),this._observeLastVisibleMessageElementFn=(0,i.debounce)(()=>this._observeLastVisibleMessageElement(),100),this.unreadMessages=0,this.isScrolledUp=!1,this.actions=[],this.information=[],this.tools=[],this.placeholder=[],this.disableAutoScroll=!1,this.typing=[],this.messages=[],this.previewMessageIdChange=new t.EventEmitter,this.hasPreviousMessages=!1,this.isTyping=!1,this.isEmbeddedMode=!1,this.conversationEventChange=new t.EventEmitter,this.paginationChange=new t.EventEmitter,this.loadPreviousMessages=new t.EventEmitter,this.messageEvent=new t.EventEmitter,this._observeLastVisibleMessageElement=()=>{if(!this._messagesContainer)return;const r=this._messagesContainer.querySelectorAll(`[${this._chatMessagesComponent.messagePositionAttributeName}]`),g=r.length;if(g===0)return;const D=this._getLastVisibleMessageElement(r),b=D?parseInt(D.getAttribute(this._chatMessagesComponent.messagePositionAttributeName)):0;this.isScrolledUp=!this._isMessageBottomBorderVisible(r[g-1]),this.unreadMessages=Math.min(g-b,this.unreadMessages||0),this.changeDetectorRef.detectChanges()},this._chatScrollPositionService=c.get(x.U)}_scrollToBottom(c=!1,r="end"){if(!this.isScrolledUp&&(!this.disableAutoScroll||c)){const g=this._typingContainer?.nativeElement||this._messagesContainer?.lastChild;setTimeout(()=>{g?.scrollIntoView?.({block:r})},0),this.isScrolledUp=!1}}_startObserve(c,r){c&&(this._stopObserve(c),this._observer=new IntersectionObserver(g=>r(g.filter(D=>D.target===c),c)),this._observer.observe(c))}_stopObserve(c){this._observer&&this._observer.unobserve(c)}_observeMessages(){if(!this._messagesContainer)return;new MutationObserver(r=>{const g=r.filter(D=>D.type==="childList"&&D.addedNodes.length>0).pop();if(g&&!this._needRestorePagination){const D=g.addedNodes[g.addedNodes.length-1];D.nodeType===Node.ELEMENT_NODE&&this._processLastElement(D)}}).observe(this._messagesContainer,{childList:!0,subtree:!1})}_processLastElement(c){c?.message?.direction===a.Tt.Outcoming?(this.isScrolledUp=!1,this._scrollToBottom()):c?.message?.direction===a.Tt.Incoming&&!this.isScrolledUp?this._scrollToMessageTop(this._messagesContainer?.lastChild):this.isScrolledUp&&this._isMessagesCountChanged&&(this.unreadMessages=(this.unreadMessages||0)+1,this.changeDetectorRef.detectChanges()),this.isScrolledUp||(this._observer?.disconnect(),this._startObserve(c,r=>{r.forEach(g=>{this.isScrolledUp=!g.isIntersecting&&this.messages?.length>0,this.changeDetectorRef.detectChanges()})}))}_getLastVisibleMessageElement(c){const r=this._contentWrap.nativeElement;let g=null;return c.forEach(D=>{if(D instanceof HTMLElement){const b=D.getBoundingClientRect(),j=r.getBoundingClientRect();b.top<j.bottom&&b.bottom>j.top&&(g=D)}}),g}_isMessageBottomBorderVisible(c){const r=this._contentWrap.nativeElement.getBoundingClientRect();return c.getBoundingClientRect().bottom-r.bottom<1}_setScrollPosition(){const c=this._contentWrap?.nativeElement;if(c&&this.conversationId&&this.messages&&!this.disableAutoScroll&&this._scrollPositionBeforePagination<1){if(this.previewMessageId){this._scrollToMessage(this.previewMessageId),this._scrollOnOpen=!1;return}const r=this._chatScrollPositionService.getScrollPosition(this.conversationId);r!==void 0?setTimeout(()=>{this._isSilentScroll=!0,c.scrollTop=r},0):this._scrollToBottom(),this._scrollOnOpen=!1}}_scrollToMessage(c){requestAnimationFrame(()=>{const r=this._getMessageElementById(c);r?this._scrollToMessageTop(r):this._scrollToBottom(),this.isScrolledUp=!1})}_observeContentWrap(){this._contentWrap?.nativeElement&&(this._messageContentWrapMutationObserver=new MutationObserver(c=>{this._contentWrap?.nativeElement&&this._messageContentWrapMutationObserver!==null&&(this._setScrollPosition(),this._messageContentWrapMutationObserver.disconnect(),this._messageContentWrapMutationObserver=null)}),this._messageContentWrapMutationObserver.observe(this.elementRef.nativeElement,{childList:!0,subtree:!0}))}_getFirstUnreadMessageElement(){const c=this.messages.filter(g=>g.direction===a.Tt.Incoming);if(c.length<this.unreadMessages)return null;const r=c[c.length-this.unreadMessages];return this._getMessageElementById(r.id)}_getMessageElementById(c){return this._messagesContainer.querySelector(`[${this._chatMessagesComponent.messageIdAttributeName}="${c}"]`)}_scrollToMessageTop(c){setTimeout(()=>{c?.scrollIntoView?.({block:"start"})},0)}_onScrollHandler(c){this._isScrollingUp(c)&&this._scrollContainer?.scrollTop<=this._scrollPaginationThreshold&&this._isPaginationEnabled&&(this._scrollPositionBeforePagination=this._getCurrentScrollHeight(),this._lockFocus=!0,this._isPaginationTriggered=!0,this.paginationChange.emit({id:this.conversationId,offset:this.messages.length})),this.conversationId&&!this._isSilentScroll&&!this.loading&&(this._chatScrollPositionService.saveScrollPosition(this.conversationId,this._scrollContainer?.scrollTop||0),this.previewMessageId="",this.previewMessageIdChange.emit(this.previewMessageId)),this._isSilentScroll=!1}_getCurrentScrollHeight(){return this._scrollContainer?.scrollHeight||0}_restorePaginationScroll(){this._scrollPositionBeforePagination>0?setTimeout(()=>{if(!this._scrollContainer||this._scrollPositionBeforePagination<1)return;const c=this._scrollContainer.scrollHeight;this._scrollContainer.scrollTop=c-this._scrollPositionBeforePagination,this._scrollPositionBeforePagination=0,this._needRestorePagination=!1},0):this._needRestorePagination=!1}_isScrollingUp(c){const g=c.target.scrollTop,D=g===0||g<this._previousScrollTop;return this._previousScrollTop=g,D}_restoreFocusIfNeeded(c){if(c.messages){const r=document.activeElement===this._scrollContainer;setTimeout(()=>{this._scrollContainer&&(r||this._shouldRestoreFocus)&&this._scrollContainer.focus(),this._lockFocus=!1},0)}}_getLastMessage(){return this.messages?.length?this.messages[this.messages.length-1]:null}_isFirstMessageChanged(c){return!c||!c.messages||!c.messages.currentValue||!c.messages.previousValue||c.messages.currentValue.length===0||c.messages.previousValue.length===0?!1:c.messages.currentValue[0].id!==c.messages.previousValue[0].id}_isInputPropertyChanged(c,r,g=!1){return r[c]&&r[c].previousValue!==r[c].currentValue&&(!g||r[c].currentValue)}_hideStaleButtons(c){if(!c||c.length===0)return;const{lastButtonIndex:r,lastIsPendingWithButtons:g,earlierButtonIndexes:D}=this._findButtonMessageIndexes(c);if(r===-1)return;const b=r<c.length-1;if(!b&&g&&D.length===0)return;const j=this._clearStaleButtons(c,D,r,g,b);j&&(this.messages=j,this.changeDetectorRef.markForCheck())}_findButtonMessageIndexes(c){let r=-1,g=!1;const D=[];for(let b=c.length-1;b>=0;b--){const j=c[b];j.type!==h.X.TextWithButtons||!j.buttons?.length||(r===-1?(r=b,g=j.confirmationResult==null):D.push(b))}return{lastButtonIndex:r,lastIsPendingWithButtons:g,earlierButtonIndexes:D}}_clearStaleButtons(c,r,g,D,b){const j=c.slice();let w=!1;for(const J of r){const Y=c[J];Y.buttons?.length&&(j[J]={...Y,buttons:[]},w=!0)}if(b||!D){const J=c[g];J.buttons?.length&&(j[g]={...J,buttons:[]},w=!0)}return w?j:null}handleFinishLoadViewModelAttributes(){super.handleFinishLoadViewModelAttributes(),setTimeout(()=>{this._observeMessages(),this._isPaginationTriggered||this._observeContentWrap(),this._scrollContainer?.addEventListener?.("scroll",this._observeLastVisibleMessageElementFn),this._scrollContainer?.addEventListener?.("scroll",this._onScrollHandlerFn.bind(this)),this._scrollContainer?.addEventListener("focus",()=>this._shouldRestoreFocus=!0),this._scrollContainer?.addEventListener("blur",()=>this._shouldRestoreFocus=this._lockFocus)},0)}ngAfterViewInit(){super.ngAfterViewInit(),this._observeContentWrap()}ngAfterViewChecked(){!this.loaderVisible&&this.elementRef.nativeElement?.checkVisibility?.()?this._scrollOnOpen&&(this._scrollContainer?this._setScrollPosition():this._observeContentWrap()):(this._isSilentScroll=!0,this._scrollOnOpen=!0)}ngOnChanges(c){if(this._isInputPropertyChanged("previewMessageId",c,!0)){this._scrollToMessage(c.previewMessageId.currentValue),this._scrollOnOpen=!1;return}if("messages"in c){const r=c.messages;r?.previousValue?.length===0&&(this.unreadMessages=0,this.isScrolledUp=!1),this._isMessagesCountChanged=r.previousValue?.length!==r.currentValue?.length,this._hideStaleButtons(c.messages.currentValue||[])}else this._isMessagesCountChanged=!1;(this._isInputPropertyChanged("conversationId",c)||this._isInputPropertyChanged("searchFilter",c))&&(this._scrollPositionBeforePagination=this._contentWrap?.nativeElement.scrollTop||0,this._scrollOnOpen=!0,this._observeContentWrap(),"messages"in c&&(this._isPaginationEnabled=!0)),this._isInputPropertyChanged("isTyping",c,!0)&&this._getLastMessage()?.direction===a.Tt.Outcoming&&this._scrollToBottom(!1,"start"),this._isFirstMessageChanged(c)&&(this._needRestorePagination=!0,this._restorePaginationScroll()),this._restoreFocusIfNeeded(c)}ngOnDestroy(){super.ngOnDestroy(),this._scrollContainer?.removeEventListener?.("scroll",this._observeLastVisibleMessageElementFn),this._scrollContainer?.removeEventListener?.("scroll",this._onScrollHandlerFn)}onScrollToBottomButtonClick(){this.isScrolledUp=!1,this.previewMessageId="",this.previewMessageIdChange.emit(this.previewMessageId),this.unreadMessages>0?this._scrollToMessageTop(this._getFirstUnreadMessageElement()):this._scrollToBottom(!0)}onLoadPreviousMessagesClicked(){this.loadPreviousMessages.emit()}onChatMessageEvent(c){this.messageEvent.emit(c)}static{this.\u0275fac=function(r){return new(r||It)(t.\u0275\u0275directiveInject(t.Injector))}}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:It,selectors:[["crt-conversation"]],viewQuery:function(r,g){if(r&1&&(t.\u0275\u0275viewQuery(y.z,5),t.\u0275\u0275viewQuery(I,5,t.ElementRef),t.\u0275\u0275viewQuery(B,5,t.ElementRef)),r&2){let D;t.\u0275\u0275queryRefresh(D=t.\u0275\u0275loadQuery())&&(g._chatMessagesComponent=D.first),t.\u0275\u0275queryRefresh(D=t.\u0275\u0275loadQuery())&&(g._typingContainer=D.first),t.\u0275\u0275queryRefresh(D=t.\u0275\u0275loadQuery())&&(g._contentWrap=D.first)}},inputs:{actions:"actions",information:"information",tools:"tools",placeholder:"placeholder",disableAutoScroll:"disableAutoScroll",typing:"typing",conversationId:"conversationId",conversationEvent:"conversationEvent",messages:"messages",previewMessageId:"previewMessageId",hasPreviousMessages:"hasPreviousMessages",isTyping:"isTyping",searchFilter:"searchFilter",isEmbeddedMode:"isEmbeddedMode"},outputs:{previewMessageIdChange:"previewMessageIdChange",conversationEventChange:"conversationEventChange",paginationChange:"paginationChange",loadPreviousMessages:"loadPreviousMessages",messageEvent:"messageEvent"},features:[t.\u0275\u0275ProvidersFeature([{provide:o.P,useValue:1e3}]),t.\u0275\u0275InheritDefinitionFeature,t.\u0275\u0275NgOnChangesFeature],ngContentSelectors:U,decls:3,vars:2,consts:[["skeleton",""],["contentWrap",""],["typing",""],[4,"ngIf","ngIfElse"],[4,"ngIf"],[1,"conversation-container"],["tabindex","0","role","region",1,"chat-panel-content-wrap"],["class","load-previous-messages","color","outline",3,"size","clicked",4,"ngIf"],[3,"event","messages","searchFilter"],["class","typing",4,"ngIf"],["class","scroll-to-bottom",3,"click",4,"ngIf"],[1,"tools"],[1,"actions-container"],[1,"divider"],["color","outline",1,"load-previous-messages",3,"clicked","size"],[1,"typing"],[1,"scroll-to-bottom",3,"click"],["class","unread-messages",4,"ngIf"],[1,"arrow-wrap"],["svgIcon","arrow-down-heavy"],[1,"unread-messages"]],template:function(r,g){if(r&1&&(t.\u0275\u0275projectionDef(K),t.\u0275\u0275template(0,et,13,6,"ng-container",3)(1,rt,1,0,"ng-template",null,0,t.\u0275\u0275templateRefExtractor)),r&2){const D=t.\u0275\u0275reference(2);t.\u0275\u0275property("ngIf",!g.loaderVisible)("ngIfElse",D)}},dependencies:[A.MatIcon,V.NgIf,k.B,y.z,$.d,R.TranslatePipe],styles:[".chat-panel-content-wrap[_ngcontent-%COMP%]{flex:1 1 auto;overflow-y:auto;box-sizing:border-box;overflow-x:hidden}.chat-panel-content-wrap[_ngcontent-%COMP%]   crt-button.load-previous-messages[_ngcontent-%COMP%]{display:block;margin:8px auto 16px}.conversation-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow:auto;width:100%;max-width:800px;align-self:center}.conversation-container[_ngcontent-%COMP%]   .scroll-to-bottom[_ngcontent-%COMP%]{position:sticky;margin-left:auto;margin-right:auto;transform:translate(-50%);bottom:4px;display:inline-flex;flex-direction:column;align-items:center;border-radius:16px}.conversation-container[_ngcontent-%COMP%]   .scroll-to-bottom[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{position:fixed;min-width:8px;height:16px;top:-8px;left:-4px;border-radius:8px;padding:0 4px;text-align:center;direction:ltr}.conversation-container[_ngcontent-%COMP%]   .scroll-to-bottom[_ngcontent-%COMP%]   .arrow-wrap[_ngcontent-%COMP%]{width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center}.conversation-container[_ngcontent-%COMP%]   .scroll-to-bottom[_ngcontent-%COMP%]   .arrow-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:16px;height:16px}.tools[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding-top:8px}[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;align-items:flex-start}[_nghost-%COMP%]   .divider[_ngcontent-%COMP%]{height:1px;margin:16px 0;width:100%}[dir=rtl][_ngcontent-%COMP%]   .scroll-to-bottom[_ngcontent-%COMP%]   .unread-messages[_ngcontent-%COMP%]{left:unset;right:-4px}.actions-container[_ngcontent-%COMP%]{width:100%}"]})}};(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],N.prototype,"actions",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],N.prototype,"information",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],N.prototype,"tools",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],N.prototype,"placeholder",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Object)],N.prototype,"disableAutoScroll",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],N.prototype,"typing",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",String)],N.prototype,"conversationId",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],N.prototype,"conversationEvent",null),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array)],N.prototype,"messages",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",String)],N.prototype,"previewMessageId",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],N.prototype,"previewMessageIdChange",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Object)],N.prototype,"hasPreviousMessages",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Object)],N.prototype,"isTyping",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",String)],N.prototype,"searchFilter",void 0),(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Object)],N.prototype,"isEmbeddedMode",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],N.prototype,"conversationEventChange",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],N.prototype,"paginationChange",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],N.prototype,"loadPreviousMessages",void 0),(0,n.__decorate)([(0,v.j)(),(0,n.__metadata)("design:type",Object)],N.prototype,"messageEvent",void 0),N=(0,n.__decorate)([(0,m.v)({type:"crt.Conversation",contentSlots:["actions","information","typing","tools","placeholder"]}),(0,M.f)({toolbarConfig:{requiredFeatures:{ShowDesignerDemoItems:!0},position:110,groupType:_.h.Components,icon:e(70807),defaultPropertyValues:{actions:[],information:[],messages:[],tools:[{name:"MessageEditor_"+s.N,type:"crt.MessageEditor",items:[{name:"MessageEditorBody_"+s.N,type:"crt.MessageEditorBody",inputs:[{name:"MessageEditorInput_"+s.N,type:"crt.MessageEditorInput"}]}]}],placeholder:[],typing:[]},addCommandTypeName:"crt.AddConversationCommand"},designControlConfig:{allowDesignContent:!0},propertiesPanelComponentTypeName:"crt.ConversationPropertiesPanel",viewElementGroupType:u.J.LayoutElements,typeCaption:"Conversation.Caption",placeholderSize:{height:"1000px"}}),(0,n.__metadata)("design:paramtypes",[t.Injector])],N)},11395:(L,f,e)=>{e.d(f,{P:()=>s});var n=e(22307),d=e.n(n),t=e(59247),P=e.n(t),C=e(23681),v=e.n(C),m=e(59969),M=e(97998),_=e(18046),u=e(19344),p=e(13232),h=e(12325),a=e(79772),o=e.n(a);class s{constructor(l,E,x,y,A){this._dialogRef=l,this._dialogData=E,this._domPurifier=x,this._crtControlStateAdapter=y,this._injector=A,this.chatTitleInputControl=new t.FormControl("",{validators:[this._crtControlStateAdapter.transform({instance:new M.Y(this._injector)})]})}get chatTitle(){return this._dialogData.chatTitle}onCloseButtonClicked(){this._dialogRef.close()}onSaveButtonClicked(){const l=this._domPurifier.sanitize(this.chatTitleInputControl.value)||"";l.trim()!==""&&this._dialogRef.close(l)}static{this.\u0275fac=function(E){return new(E||s)(n.\u0275\u0275directiveInject(C.MatDialogRef),n.\u0275\u0275directiveInject(C.MAT_DIALOG_DATA),n.\u0275\u0275directiveInject(m.MV),n.\u0275\u0275directiveInject(_.f),n.\u0275\u0275directiveInject(n.Injector))}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:s,selectors:[["crt-rename-chat"]],decls:11,vars:20,consts:[[1,"rename-dialog-container"],["labelType","headline-3","labelColor","var(--crt-palette-secondary-500)",1,"dialog-title",3,"title","caption"],[1,"dialog-input",3,"keyup.enter","control","value","label","labelPosition","multiline"],[1,"dialog-actions"],["data-item-marker","closeButton",1,"cancel-button",3,"clicked","caption"],["color","primary","data-item-marker","saveButton",1,"save-button",3,"clicked","disabled","caption"]],template:function(E,x){E&1&&(n.\u0275\u0275elementStart(0,"div",0),n.\u0275\u0275element(1,"crt-label",1),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementStart(4,"crt-input",2),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275listener("keyup.enter",function(){return x.onSaveButtonClicked()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"div",3)(7,"crt-button",4),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275listener("clicked",function(){return x.onCloseButtonClicked()}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(9,"crt-button",5),n.\u0275\u0275pipe(10,"translate"),n.\u0275\u0275listener("clicked",function(){return x.onSaveButtonClicked()}),n.\u0275\u0275elementEnd()()()),E&2&&(n.\u0275\u0275advance(),n.\u0275\u0275property("title",n.\u0275\u0275pipeBind1(2,10,"ChatList.RenameChat.LabelTitle"))("caption",n.\u0275\u0275pipeBind1(3,12,"ChatList.RenameChat.LabelTitle")),n.\u0275\u0275advance(3),n.\u0275\u0275property("control",x.chatTitleInputControl)("value",x.chatTitle)("label",n.\u0275\u0275pipeBind1(5,14,"ChatList.RenameChat.InputTitle"))("labelPosition","above")("multiline",!0),n.\u0275\u0275advance(3),n.\u0275\u0275property("caption",n.\u0275\u0275pipeBind1(8,16,"ChatList.RenameChat.CancelButton")),n.\u0275\u0275advance(2),n.\u0275\u0275property("disabled",!x.chatTitleInputControl.valid)("caption",n.\u0275\u0275pipeBind1(10,18,"ChatList.RenameChat.SaveButton")))},dependencies:[u.j,p.B,h.V,a.TranslatePipe],styles:[".rename-dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}"]})}}},96158:(L,f,e)=>{e.d(f,{g:()=>n});var n;(function(d){d.TriggerMention="triggerMention",d.Focus="focus"})(n||(n={}))},30073:(L,f,e)=>{e.d(f,{z:()=>R});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(59247),v=e.n(C),m=e(77592),M=e(34760),_=e(1034),u=e(3585),p=e(68712),h=e(28399),a=e.n(h),o=e(96158),s=e(67057),i=e.n(s),l=e(19344),E=e(54327),x=e(79772),y=e.n(x);const A=["crtInput"],W=["editableDiv"],V=["plainInput"],Q=T=>({"message-editor-input-focused":T});function k(T,I){if(T&1){const B=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"crt-input",5,1),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275listener("focusout",function(){t.\u0275\u0275restoreView(B);const U=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(U.onBlur())})("crtKeyboardHotkeyPressed",function(U){t.\u0275\u0275restoreView(B);const G=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(G.onHotKeyPressed(U))}),t.\u0275\u0275elementEnd()}if(T&2){const B=t.\u0275\u0275nextContext();t.\u0275\u0275propertyInterpolate("placeholder",t.\u0275\u0275pipeBind1(3,5,"MessageEditor.InputPlaceholder")),t.\u0275\u0275property("control",B.messageFormControl)("labelPosition","hidden")("multiline",!0)("crtKeyboardHotkeys",B.keyboardHotkeysMap)}}function $(T,I){if(T&1){const B=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",6,2),t.\u0275\u0275pipe(2,"translate"),t.\u0275\u0275listener("input",function(U){t.\u0275\u0275restoreView(B);const G=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(G.onContentChanged(U))})("focusout",function(){t.\u0275\u0275restoreView(B);const U=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(U.onBlur())})("mentionSelected",function(){t.\u0275\u0275restoreView(B);const U=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(U.onMentionSelected())})("crtKeyboardHotkeyPressed",function(U){t.\u0275\u0275restoreView(B);const G=t.\u0275\u0275nextContext();return t.\u0275\u0275resetView(G.onHotKeyPressed(U))}),t.\u0275\u0275elementEnd()}if(T&2){const B=t.\u0275\u0275nextContext();t.\u0275\u0275property("mentionService",B.mentionService)("crtKeyboardHotkeys",B.keyboardHotkeysMap),t.\u0275\u0275attribute("data-placeholder",t.\u0275\u0275pipeBind1(2,3,"MessageEditor.InputPlaceholder"))}}let R=class dt extends p.K{constructor(){super(...arguments),this._publishMessageHotKeys=["Enter"],this._publishKeyboardAction="publishMessage",this.keyboardHotkeysMap={keydown:{[this._publishKeyboardAction]:{sequence:this._publishMessageHotKeys}}},this.messageFormControl=new C.FormControl(""),this.inputMode="text",this.getMentionService=new t.EventEmitter,this.sendHotkeyPressed=new t.EventEmitter,this.chatInputChange=new t.EventEmitter,this.isFocusedChange=new t.EventEmitter,this.sendMessage=new t.EventEmitter}set action(I){switch(I){case o.g.TriggerMention:this._triggerMention();break;case o.g.Focus:{const B=this.onMessageEditorAreaClicked();this._setCursorPositionToEnd(B);break}}}set chatInput(I){this.inputMode==="text"?I!==this.messageFormControl?.value&&this.messageFormControl?.setValue(I):this.inputMode==="html"&&I!==this.editableDiv?.nativeElement.innerHTML&&this.editableDiv?.nativeElement&&(this.editableDiv.nativeElement.innerHTML=I)}_setIsFocused(I){this.isFocused=I,this.isFocusedChange.emit(I)}_getMentionService(I){this.mentionService=I}_triggerMention(){if(this.inputMode!=="html"){console.warn('"Mention" action is only supported for html input mode');return}const I=new Event("input",{bubbles:!0,cancelable:!0}),B=this.mentionDirective.mentionSymbol,K=this.editableDiv.nativeElement;K.innerHTML==="<br>"?K.innerHTML=B:K.innerHTML.endsWith(B)?K.innerHTML=K.innerHTML.slice(0,-B.length):K.innerHTML+=B;const G=K.lastChild||K,nt=document.createRange();nt.setStart(G,G.textContent.length),nt.collapse(!0);const ot=window.getSelection();ot.removeAllRanges(),ot.addRange(nt),K.focus(),K.dispatchEvent(I)}_setCursorPositionToEnd(I){I&&requestAnimationFrame(()=>{if(I instanceof HTMLInputElement||I instanceof HTMLTextAreaElement){const G=I.value.length;I.setSelectionRange(G,G);return}const B=document.createRange(),K=window.getSelection();let U=I;for(;U.lastChild;)U=U.lastChild;U.nodeType!==Node.TEXT_NODE&&(U=U.appendChild(document.createTextNode(""))),B.setStart(U,U.textContent?.length??0),B.collapse(!0),K?.removeAllRanges(),K?.addRange(B),I instanceof HTMLDivElement&&(I.scrollTop=I.scrollHeight)})}onBlur(){this._setIsFocused(!1)}ngOnInit(){this.getMentionService.emit(this._getMentionService.bind(this)),this.messageFormControl?.valueChanges.subscribe(I=>{this.onInputContentChanged(I)})}onContentChanged(I){const B=I.target.innerHTML;this.chatInput=B,this.chatInputChange.emit(B)}onMessageEditorAreaClicked(){let I;if(this.inputMode==="text"?(this.crtInput?.focus(),I=this.crtInput?.textArea?.nativeElement):(this.editableDiv.nativeElement.focus(),I=this.editableDiv.nativeElement),!this.isFocused)return this._setIsFocused(!0),I}onInputContentChanged(I){I!==this.chatInput&&(this.chatInput=I,this.chatInputChange.emit(I))}onHotKeyPressed({action:I,event:B}){if(B.shiftKey===!1&&I===this._publishKeyboardAction){if(B.preventDefault(),this.inputMode==="text")(0,h.isEmpty)(this.messageFormControl?.value)||this.sendMessage.emit();else if(this.inputMode==="html"){const K=this.editableDiv.nativeElement.innerHTML.trim();K&&(this.sendMessage.emit(K),this.editableDiv.nativeElement.innerHTML="")}}}onMentionSelected(){const I=this.editableDiv.nativeElement.innerHTML;this.chatInput=I,this.chatInputChange.emit(I),this.onMessageEditorAreaClicked()}static{this.\u0275fac=(()=>{let I;return function(K){return(I||(I=t.\u0275\u0275getInheritedFactory(dt)))(K||dt)}})()}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:dt,selectors:[["crt-message-editor-input"]],viewQuery:function(B,K){if(B&1&&(t.\u0275\u0275viewQuery(u.d,5),t.\u0275\u0275viewQuery(A,5),t.\u0275\u0275viewQuery(W,5),t.\u0275\u0275viewQuery(V,5)),B&2){let U;t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(K.mentionDirective=U.first),t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(K.crtInput=U.first),t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(K.editableDiv=U.first),t.\u0275\u0275queryRefresh(U=t.\u0275\u0275loadQuery())&&(K.plainInput=U.first)}},inputs:{inputMode:"inputMode",action:"action",chatInput:"chatInput",isFocused:"isFocused",mentionService:"mentionService"},outputs:{getMentionService:"getMentionService",sendHotkeyPressed:"sendHotkeyPressed",chatInputChange:"chatInputChange",isFocusedChange:"isFocusedChange",sendMessage:"sendMessage"},features:[t.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[["divMode",""],["plainInput","","crtInput",""],["editableDiv",""],[1,"message-editor-input",3,"click","ngClass"],["role","textbox","aria-multiline","true",3,"control","labelPosition","multiline","placeholder","crtKeyboardHotkeys","focusout","crtKeyboardHotkeyPressed",4,"ngIf","ngIfElse"],["role","textbox","aria-multiline","true",3,"focusout","crtKeyboardHotkeyPressed","control","labelPosition","multiline","placeholder","crtKeyboardHotkeys"],["contenteditable","true","tabindex","0","role","textbox","aria-multiline","true","crtMention","",1,"editable-div",3,"input","focusout","mentionSelected","crtKeyboardHotkeyPressed","mentionService","crtKeyboardHotkeys"]],template:function(B,K){if(B&1){const U=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",3),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(U),t.\u0275\u0275resetView(K.onMessageEditorAreaClicked())}),t.\u0275\u0275template(1,k,4,7,"crt-input",4)(2,$,3,5,"ng-template",null,0,t.\u0275\u0275templateRefExtractor),t.\u0275\u0275elementEnd()}if(B&2){const U=t.\u0275\u0275reference(3);t.\u0275\u0275property("ngClass",t.\u0275\u0275pureFunction1(3,Q,K.isFocused===!0)),t.\u0275\u0275advance(),t.\u0275\u0275property("ngIf",K.inputMode==="text")("ngIfElse",U)}},dependencies:[s.NgClass,s.NgIf,l.j,E.h,u.d,x.TranslatePipe],styles:[".message-editor-input[_ngcontent-%COMP%]{display:flex;min-height:80px;max-height:147px;border:1px solid var(--crt-palette-border-900);border-radius:8px;padding-bottom:32px}.message-editor-input.message-editor-input-focused[_ngcontent-%COMP%], .message-editor-input[_ngcontent-%COMP%]:hover{border:1px solid var(--message-editor-input-hover-border-color)}.message-editor-input[_ngcontent-%COMP%]   crt-input[_ngcontent-%COMP%], .message-editor-input[_ngcontent-%COMP%]   .editable-div[_ngcontent-%COMP%]{flex:1;overflow-y:scroll}.message-editor-input[_ngcontent-%COMP%]   .editable-div[_ngcontent-%COMP%]{outline:none;padding:12px}"],changeDetection:0})}};(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String)],R.prototype,"inputMode",void 0),(0,n.__decorate)([(0,M.j)(),(0,n.__metadata)("design:type",t.EventEmitter)],R.prototype,"getMentionService",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String),(0,n.__metadata)("design:paramtypes",[String])],R.prototype,"action",null),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",String),(0,n.__metadata)("design:paramtypes",[String])],R.prototype,"chatInput",null),(0,n.__decorate)([(0,M.j)(),(0,n.__metadata)("design:type",Object)],R.prototype,"sendHotkeyPressed",void 0),(0,n.__decorate)([(0,M.j)(),(0,n.__metadata)("design:type",t.EventEmitter)],R.prototype,"chatInputChange",void 0),(0,n.__decorate)([(0,M.j)(),(0,n.__metadata)("design:type",t.EventEmitter)],R.prototype,"isFocusedChange",void 0),(0,n.__decorate)([(0,M.j)(),(0,n.__metadata)("design:type",Object)],R.prototype,"sendMessage",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Boolean)],R.prototype,"isFocused",void 0),(0,n.__decorate)([(0,m.k)(),(0,n.__metadata)("design:type",Object)],R.prototype,"mentionService",void 0),R=(0,n.__decorate)([(0,_.v)({type:"crt.MessageEditorInput"})],R)},7917:(L,f,e)=>{e.d(f,{z:()=>m});var n=e(5960),d=e.n(n),t=e(1034),P=e(68712),C=e(22307),v=e.n(C);let m=class mt extends P.K{static{this.\u0275fac=(()=>{let _;return function(p){return(_||(_=C.\u0275\u0275getInheritedFactory(mt)))(p||mt)}})()}static{this.\u0275cmp=C.\u0275\u0275defineComponent({type:mt,selectors:[["crt-message-editor-reply"]],features:[C.\u0275\u0275InheritDefinitionFeature],decls:0,vars:0,template:function(u,p){}})}};m=(0,n.__decorate)([(0,t.v)({type:"crt.MessageEditorReply"})],m)},28503:(L,f,e)=>{e.d(f,{j:()=>E});var n=e(5960),d=e.n(n),t=e(22307),P=e.n(t),C=e(77592),v=e(1034),m=e(96677),M=e(52793),_=e(10098),u=e(68712),p=e(67057),h=e.n(p),a=e(7917);const o=["items"];function s(x,y){x&1&&t.\u0275\u0275elementContainer(0)}function i(x,y){if(x&1&&(t.\u0275\u0275elementStart(0,"div"),t.\u0275\u0275template(1,s,1,0,"ng-container",3),t.\u0275\u0275elementEnd()),x&2){const A=y.$implicit;t.\u0275\u0275advance(),t.\u0275\u0275property("ngTemplateOutlet",A)}}function l(x,y){if(x&1&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,i,2,1,"div",2),t.\u0275\u0275elementContainerEnd()),x&2){const A=t.\u0275\u0275nextContext();t.\u0275\u0275advance(),t.\u0275\u0275property("ngForOf",A.itemsTemplates)}}let E=class ht extends u.K{set items(y){this._items=y}static{this.\u0275fac=(()=>{let y;return function(W){return(y||(y=t.\u0275\u0275getInheritedFactory(ht)))(W||ht)}})()}static{this.\u0275cmp=t.\u0275\u0275defineComponent({type:ht,selectors:[["crt-message-editor"]],contentQueries:function(A,W,V){if(A&1&&t.\u0275\u0275contentQuery(V,o,4,t.TemplateRef),A&2){let Q;t.\u0275\u0275queryRefresh(Q=t.\u0275\u0275loadQuery())&&(W.itemsTemplates=Q)}},inputs:{items:"items"},features:[t.\u0275\u0275InheritDefinitionFeature],decls:3,vars:1,consts:[[1,"message-editor"],[4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"]],template:function(A,W){A&1&&(t.\u0275\u0275elementStart(0,"div",0),t.\u0275\u0275element(1,"crt-message-editor-reply"),t.\u0275\u0275template(2,l,2,1,"ng-container",1),t.\u0275\u0275elementEnd()),A&2&&(t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",W.itemsTemplates==null?null:W.itemsTemplates.length))},dependencies:[p.NgForOf,p.NgIf,p.NgTemplateOutlet,a.z],styles:["[_nghost-%COMP%]{width:100%}"]})}};(0,n.__decorate)([(0,C.k)(),(0,n.__metadata)("design:type",Array),(0,n.__metadata)("design:paramtypes",[Array])],E.prototype,"items",null),E=(0,n.__decorate)([(0,v.v)({type:"crt.MessageEditor",reuseStrategy:m.B.Reuse,contentSlots:[{name:"items",lazy:!0,input:!0}]}),(0,M.f)({propertiesPanelComponentTypeName:"crt.MessageEditorPropertiesPanel",viewElementGroupType:_.J.Components,typeCaption:"MessageEditor.Caption"})],E)},35794:(L,f,e)=>{e.d(f,{Z:()=>o,i:()=>s});var n=e(73308),d=e(5960),t=e.n(d),P=e(81517),C=e(2828),v=e(41287),m=e(844),M=e(40968),_=e(22592),u=e(56704),p=e(99298),h=e(62278),a=e.n(h);let o=class extends P.S{};o=(0,d.__decorate)([(0,C.$)({type:"crt.AcceptOmniChatRequest"})],o);let s=class extends v.l{constructor(l,E){super(),this._omnichannelChatService=l,this._maskService=E}handle(l){var E=this;return(0,n.A)(function*(){if(l.chatId){const x=`ACCEPT_OMNI_CHAT_${l.chatId}`;yield E._maskService.showMask(x,l.$context),yield(0,h.lastValueFrom)(E._omnichannelChatService.acceptChat(l.chatId)),yield E._maskService.hideMask(x,l.$context)}yield E.next?.handle(l)})()}};s=(0,d.__decorate)([(0,m.l)({requestType:"crt.AcceptOmniChatRequest",type:"crt.AcceptOmniChatHandler"}),(0,d.__param)(1,(0,M.j)(p.V)),(0,d.__metadata)("design:paramtypes",[u.I,_.s])],s)},42963:(L,f,e)=>{e.d(f,{o:()=>p});var n=e(73308),d=e(5960),t=e.n(d),P=e(22307),C=e.n(P),v=e(41287),m=e(86464),M=e(844),_=e(8017),u=e(48534);let p=class extends v.l{constructor(a){super(),this._sanitizeHtmlPipe=a.get(_.b),this._copilotToEditorCommunicationService=a.get(u.i)}handle(a){var o=this;return(0,n.A)(function*(){const s=o._sanitizeHtmlPipe.transform(a.message.text,{mode:"textOnly",dataType:m.r.MAXSIZE_TEXT});o._copilotToEditorCommunicationService.notify({editorAction:a.action,selection:s}),yield o.next?.handle(a)})()}};p=(0,d.__decorate)([(0,M.l)({type:"crt.ChatMessageActionHandler",requestType:"crt.ChatMessageActionRequest"}),(0,d.__metadata)("design:paramtypes",[P.Injector])],p)},99556:(L,f,e)=>{e.d(f,{m:()=>h});var n=e(73308),d=e(5960),t=e.n(d),P=e(22307),C=e.n(P),v=e(41287),m=e(844),M=e(18357),_=e(62278),u=e.n(_),p=e(13161);let h=class extends v.l{constructor(o){super(),this._profileService=o.get(M.c)}handle(o){var s=this;return(0,n.A)(function*(){return yield s.next?.handle(o),(0,_.lastValueFrom)(s._profileService.getProfile(p.j).pipe((0,_.share)()))})()}};h=(0,d.__decorate)([(0,m.l)({type:"crt.LoadChatProfileHandler",requestType:"crt.LoadChatProfileRequest"}),(0,d.__metadata)("design:paramtypes",[P.Injector])],h)},53395:(L,f,e)=>{e.d(f,{b:()=>a});var n=e(73308),d=e(5960),t=e.n(d),P=e(22307),C=e.n(P),v=e(41287),m=e(844),M=e(18357),_=e(23092),u=e(62278),p=e.n(u),h=e(13161);let a=class extends v.l{constructor(s){super(),this._profileService=s.get(M.c),this._userInfo=s.get(_.oq)}handle(s){var i=this;return(0,n.A)(function*(){const{$context:l}=s,E={lastChatId:yield l.CurrentCopilotSessionId,isCombinedMode:yield l.IsCombinedMode,isChatsListVisible:yield l.ChatsListVisible,combinedModeEnabled:yield l.CombinedModeEnabled,savedInSessionId:i._userInfo.sessionId};yield(0,u.lastValueFrom)(i._profileService.saveProfile(h.j,E).pipe((0,u.share)())),yield i.next?.handle(s)})()}};a=(0,d.__decorate)([(0,m.l)({type:"crt.SaveChatProfileHandler",requestType:"crt.SaveChatProfileRequest"}),(0,d.__metadata)("design:paramtypes",[P.Injector])],a)},53251:(L,f,e)=>{e.d(f,{h:()=>M,w:()=>m});var n=e(73308),d=e(5960),t=e.n(d),P=e(81517),C=e(41287),v=e(844);class m extends P.S{}let M=class extends C.l{handle(u){var p=this;return(0,n.A)(function*(){u.$context.ActiveChats=u.chats,yield p.next?.handle(u)})()}};M=(0,d.__decorate)([(0,v.l)({type:"crt.ChatListChangeHandler",requestType:"crt.ChatListChangeRequest"})],M)},16365:(L,f,e)=>{e.d(f,{T:()=>v});var n=e(73308),d=e(5960),t=e.n(d),P=e(41287),C=e(844);let v=class extends P.l{constructor(){super()}handle(M){var _=this;return(0,n.A)(function*(){M.$context.IsChatConversationVisible=!1;const u=M.chatMessagesAttributeName;M.$context[`${u}`]=[],yield _.next?.handle(M)})()}};v=(0,d.__decorate)([(0,C.l)({type:"crt.CloseOmniChatConversationHandler",requestType:"crt.CloseOmniChatConversationRequest"}),(0,d.__metadata)("design:paramtypes",[])],v)},17709:(L,f,e)=>{e.d(f,{M:()=>u});var n=e(41287),d=e(6530),t=e(79772),P=e(22701),C=e(48594);class v{static get(h){switch(h){case C.Go.TextWithButtons:return P.X.TextWithButtons;case C.Go.Image:return P.X.Image;case C.Go.File:return P.X.File;case C.Go.System:return P.X.System;case C.Go.Text:default:return P.X.Text}}}var m=e(56704),M=e(23092),_=e(84323);class u extends n.l{constructor(h){super(),this.injector=h,this.userInfo=this.injector.get(M.oq),this.omniChatService=this.injector.get(m.I),this.translateService=this.injector.get(t.TranslateService)}_createChatStartedMessage(h,a){return{id:(0,d.qv)(),type:P.X.System,date:h.date,macrosTemplate:{template:this.translateService.instant("ChatMessage.System.ChatStartedMessage"),tokens:[{key:"chatStartedAt",type:"datetime",value:h.date.toString()},{key:"chatStartedBy",type:"lookup",value:{entitySchemaName:"Contact",primaryColumnValue:h.author.id,caption:h.author.name}},{key:"icon",type:"icon",value:"flag-icon"}]},chatId:a}}getUserLocalDate(h){return(0,_.v8)(h,this.userInfo.timeZoneOffsetHours),h}getConvertedMessages(h,a){return h.map(o=>({attachments:o.attachments,macrosTemplate:o.macrosTemplate,id:o.id,author:o.author,date:this.getUserLocalDate(o.time),direction:o.direction,isBotMessage:o.isBotMessage,text:o.text,type:v.get(o.type),chatId:a}))}getDatePart(h){return h.toISOString().split("T")[0]}addChatStartedMessage(h){const a=h.find(s=>s.type!==P.X.System);if(!a)return null;const o=this._createChatStartedMessage(a);return h.unshift(o),o.id}addDateChangedDividers(h,a){if(h.length===0)return;const o=JSON.stringify({type:P.X.System,date:null,macrosTemplate:{template:"{dateHeader}",tokens:[{key:"icon",type:"icon",value:"date-time"}]}});let s=this.getDatePart(h[h.length-1].date);for(let i=h.length-1;i>=0;i--)if((i===0||this.getDatePart(h[i].date)!==s)&&h[i].id!==a){const l=JSON.parse(o);l.date=new Date(s),l.macrosTemplate.tokens.push({key:"dateHeader",type:"date",value:s}),h.splice(i===0?0:i+1,0,l),s=this.getDatePart(h[i].date)}}addChatStartedMessagesOnChatIdChange(h){if(h.length===0)return;let a=null;const o=[];for(let s=0;s<h.length;s++){const i=h[s];if(i.chatId&&i.chatId!==a){const l=i.type!==P.X.System?i:h.find((E,x)=>x>=s&&E.type!==P.X.System);if(l){const E=this._createChatStartedMessage(l,i.chatId);o.push({index:s,message:E})}a=i.chatId}}for(let s=o.length-1;s>=0;s--){const{index:i,message:l}=o[s];h.splice(i,0,l)}}}},2675:(L,f,e)=>{e.d(f,{Z:()=>u});var n=e(73308),d=e(5960),t=e.n(d),P=e(22307),C=e.n(P),v=e(844),m=e(62278),M=e.n(m),_=e(17709);let u=class extends _.M{constructor(h){super(h),this._injector=h}_getAllChatMessages(h,a){var o=this;return(0,n.A)(function*(s,i,l=0,E=null){return(yield(0,m.lastValueFrom)(o.omniChatService.getAllConversation(s,i,l,E))).map(y=>{const A=y.chatId;return o.getConvertedMessages([y],A)?.[0]}).filter(Boolean)}).apply(this,arguments)}handle(h){var a=this;return(0,n.A)(function*(){yield a.next?.handle(h),h.$context.ConversationLoading=!0;const o=h.$context,s=yield a._getAllChatMessages(h.contactId,h.channelId,h.offset??0,h.translationLanguageCode??null),i=h.chatMessagesAttributeName,l=yield o[`${i}`];l&&Array.isArray(l)?o[`${i}`]=s.concat(l):o[`${i}`]=s,h.$context.ConversationLoading=!1})()}};u=(0,d.__decorate)([(0,v.l)({type:"crt.LoadAllConversationHandler",requestType:"crt.LoadAllConversationRequest"}),(0,d.__metadata)("design:paramtypes",[P.Injector])],u)},39097:(L,f,e)=>{e.d(f,{G:()=>a});var n=e(73308),d=e(5960),t=e.n(d),P=e(22307),C=e.n(P),v=e(6530),m=e(844),M=e(62278),_=e.n(M),u=e(17709),p=e(15932),h=e(43778);let a=class extends u.M{constructor(s){super(s),this._injector=s}_getChatMessages(s){var i=this;return(0,n.A)(function*(){return i.getConvertedMessages(yield(0,M.lastValueFrom)(i.omniChatService.getConversation(s)))})()}handle(s){var i=this;return(0,n.A)(function*(){yield i.next?.handle(s);const l=s.$context;if(!l[`${s.chatMessagesAttributeName}`])return;const E=s.chatId,x=s.loadMode;let y,A,W,V;switch(x){case p.W.Append:W=yield l[`${s.previousChatIdAttributeName}`],y=yield i._getChatMessages(W),V=i.addChatStartedMessage(y),i.addDateChangedDividers(y,V),A=yield l[`${s.chatMessagesAttributeName}`],l.ConversationEvent=[{name:h.R}],l[`${s.chatMessagesAttributeName}`]=y.concat(A),W=yield(0,M.lastValueFrom)(i.omniChatService.getPreviousChatId(W)),l[`${s.previousChatIdAttributeName}`]=W===v.To?null:W;return;case p.W.Replace:default:y=yield i._getChatMessages(E),l.ChatId=E,l.ConversationEvent=[{name:h.R}],V=i.addChatStartedMessage(y),i.addDateChangedDividers(y,V),l[`${s.chatMessagesAttributeName}`]=y,s.previousChatIdAttributeName&&(W=yield(0,M.lastValueFrom)(i.omniChatService.getPreviousChatId(E)),l[`${s.previousChatIdAttributeName}`]=W===v.To?null:W);return}})()}};a=(0,d.__decorate)([(0,m.l)({type:"crt.LoadConversationHandler",requestType:"crt.LoadConversationRequest"}),(0,d.__metadata)("design:paramtypes",[P.Injector])],a)},20903:(L,f,e)=>{e.d(f,{x:()=>h});var n=e(73308),d=e(5960),t=e.n(d),P=e(22307),C=e.n(P),v=e(41287),m=e(844),M=e(79772),_=e.n(M),u=e(13555),p=e(92385);let h=class extends v.l{constructor(o){super(),this._chatDraftService=o.get(u.X),this._translateService=o.get(M.TranslateService),this._copilotContentUtils=o.get(p.$)}_updateChatPreview(o,s){var i=this;return(0,n.A)(function*(){const l=yield o.$context.ActiveChats;if(!l)return;const E=l.findIndex(W=>W.id===s);if(E===-1)return;const x=l[E],y=i._copilotContentUtils.sanitizeContent(o.newValue),A=i._copilotContentUtils.toPlainText(y);o.newValue&&A!==""?x.preview=i._translateService.instant("ChatList.DraftPreview")+A:x.preview=x.previewFromServer,o.$context.ActiveChats=l})()}handle(o){var s=this;return(0,n.A)(function*(){yield s.next?.handle(o),o.$context[o.attributesMapping.chatInput]=o.newValue;const i=yield o.$context[o.attributesMapping.chatId];s._chatDraftService.setDraft(i,o.newValue),yield s._updateChatPreview(o,i)})()}};h=(0,d.__decorate)([(0,m.l)({type:"crt.MessageEditorInputChangeHandler",requestType:"crt.MessageEditorInputChangeRequest"}),(0,d.__metadata)("design:paramtypes",[P.Injector])],h)},11661:(L,f,e)=>{e.d(f,{Y:()=>v});var n=e(73308),d=e(5960),t=e.n(d),P=e(41287),C=e(844);let v=class extends P.l{constructor(){super()}handle(M){var _=this;return(0,n.A)(function*(){const u=M.$context,{chatId:p,offset:h}=M,o=(yield u.ChatsInProgressItems)?.find(function(){var i=(0,n.A)(function*(l){return(yield l.Id)===p});return function(l){return i.apply(this,arguments)}}()),s={type:"crt.LoadAllConversationRequest",$context:u,contactId:yield o.ContactId,channelId:yield o.ChannelId,offset:h,chatMessagesAttributeName:"ChatMessages"};_.handlerChain.process(s),yield _.next?.handle(M)})()}};v=(0,d.__decorate)([(0,C.l)({type:"crt.OmniChatPaginationHandler",requestType:"crt.OmniChatPaginationRequest",scopes:["AgentSideBar"]}),(0,d.__metadata)("design:paramtypes",[])],v)},29846:(L,f,e)=>{e.d(f,{o:()=>E});var n=e(73308),d=e(5960),t=e.n(d),P=e(41287),C=e(41108),v=e(56267),m=e(58504),M=e(844),_=e(56704),u=e(23092),p=e(52874),h=e.n(p),a=e(36486),o=e.n(a),s=e(16629);const i="ChatsNewItemsDS",l="ChatsInProgressItemsDS";let E=class extends P.l{constructor(y,A,W){super(),this._chatEventService=y,this._omnichannelChatService=A,this._userInfo=W}_loadChatToDataSource(y,A,W){var V=this;return(0,n.A)(function*(){const Q={type:"crt.LoadDataRequest",$context:A,dataSourceName:W,parameters:[{type:"primaryColumnValue",value:y}],config:{loadType:"load"}};yield V.handlerChain.process(Q),V._rerenderChatList(A)})()}_createFilterForChatIds(y){const A=new C.X;return A.logicalOperation=v.H.And,A.addSchemaColumnInFilterWithParameters(m.H.Equal,"Id",y),A.toJson()}_rerenderChatList(y){y.fake=p.Guid.create()}_loadChatsToDataSource(y,A,W){var V=this;return(0,n.A)(function*(){const Q={type:"crt.LoadDataRequest",$context:A,dataSourceName:W,parameters:[{type:"filter",value:V._createFilterForChatIds(y)}],config:{loadType:"load"}};yield V.handlerChain.process(Q),V._rerenderChatList(A)})()}_loadInitialChats(y){this._omnichannelChatService.getDirectedChats().subscribe(A=>{(!A||A.length===0)&&(A=[p.Guid.createEmpty().toString()]),this._loadChatsToDataSource(A,y,i)})}_subscribeOnNewChat(y){this._chatEventService.newIncomingChatEvent$().pipe((0,a.switchMap)(A=>this._loadChatToDataSource(A,y,i))).subscribe()}_subscribeOnAcceptChat(y){var A=this;this._chatEventService.acceptChatEvent$().pipe((0,a.switchMap)(function(){var W=(0,n.A)(function*(V){const{ChatId:Q,OperatorId:k}=V,$=yield y.ChatsNewItems,R=$?.find(function(){var T=(0,n.A)(function*(I){return(yield I.Id)===Q});return function(I){return T.apply(this,arguments)}}());if(R){if(k===A._userInfo.id)return A._loadChatToDataSource(Q,y,l).then((0,n.A)(function*(){const T={type:"crt.LoadAllConversationRequest",$context:y,contactId:yield R.ContactId,channelId:yield R.ChannelId,chatMessagesAttributeName:"ChatMessages"};A.handlerChain.process(T),y.IsChatConversationVisible=!0,yield $.remove(R),A._rerenderChatList(y)}));yield $.remove(R)}return Promise.resolve()});return function(V){return W.apply(this,arguments)}}())).subscribe()}handle(y){var A=this;return(0,n.A)(function*(){A._loadInitialChats(y.$context),A._subscribeOnNewChat(y.$context),A._subscribeOnAcceptChat(y.$context),yield A.next?.handle(y)})()}};E=(0,d.__decorate)([(0,M.l)({type:"crt.OmniChatInitHandler",requestType:"crt.HandleViewModelInitRequest",scopes:["AgentSideBar"]}),(0,d.__metadata)("design:paramtypes",[s.o,_.I,u.oq])],E)},46865:(L,f,e)=>{e.d(f,{I:()=>v});var n=e(73308),d=e(5960),t=e.n(d),P=e(41287),C=e(844);let v=class extends P.l{constructor(){super()}handle(M){var _=this;return(0,n.A)(function*(){yield _.next?.handle(M);const u=M.$context,{chatId:p}=M,a=(yield u.ChatsInProgressItems)?.find(function(){var s=(0,n.A)(function*(i){return(yield i.Id)===p});return function(i){return s.apply(this,arguments)}}()),o={type:"crt.LoadAllConversationRequest",$context:u,contactId:yield a.ContactId,channelId:yield a.ChannelId,chatMessagesAttributeName:"ChatMessages"};_.handlerChain.process(o),u.IsChatConversationVisible=!0})()}};v=(0,d.__decorate)([(0,C.l)({type:"crt.OpenOmniChatHandler",requestType:"crt.OpenOmniChatRequest"}),(0,d.__metadata)("design:paramtypes",[])],v)},13161:(L,f,e)=>{e.d(f,{j:()=>n});const n="ChatPanel"},15959:(L,f,e)=>{e.d(f,{H:()=>n});class n{constructor(){this.isTyping=!1,this.unreadMessagesCount=0}}},43778:(L,f,e)=>{e.d(f,{R:()=>d,u:()=>n});class n{}const d="reset"},15932:(L,f,e)=>{e.d(f,{W:()=>n});var n;(function(d){d.Replace="replace",d.Append="append"})(n||(n={}))},40870:(L,f,e)=>{e.d(f,{D:()=>m});var n=e(73308),d=e(22307),t=e.n(d),P=e(74368),C=e(28399),v=e.n(C);class m{constructor(){this._metadataSchemaUtils=(0,d.inject)(P.u)}_getViewConfigs(_,u){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",u,_).map(p=>p?.viewConfig).filter(Boolean)}_setMessageEvent(_){(0,C.isEmpty)(_.messageEvent)&&(_.messageEvent={request:"crt.ChatMessageInteractionRequest",params:{message:"@event.payload.text ?? @event.payload",eventName:"@event.eventName",payload:"@event.payload"}})}crtOnMetaDataInit(_){var u=this;return(0,n.A)(function*(){const h=_?.viewConfig;if(!h)return _;const a=u._getViewConfigs(h,"crt.Conversation");for(const o of a)u._setMessageEvent(o);return _})()}static{this.\u0275fac=function(u){return new(u||m)}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},1978:(L,f,e)=>{e.d(f,{k:()=>m});var n=e(73308),d=e(22307),t=e.n(d),P=e(74368),C=e(28399),v=e.n(C);class m{constructor(){this._metadataSchemaUtils=(0,d.inject)(P.u)}_getViewConfigs(_,u){return this._metadataSchemaUtils.getViewConfigInfoByProperty("type",u,_).map(p=>p?.viewConfig).filter(Boolean)}_updateBindings(_,u){this._setChatInputAttribute(_,u),this._setSendMessageRequest(_),this._setBindingsMappingAttribure(_,u)}_setChatInputAttribute(_,u){if(!(0,C.isEmpty)(_.chatInput))return;const p=`ChatInput_${_.name}`;u[p]={value:null},_.chatInput=`$${p}`}_setSendMessageRequest(_){if(!(0,C.isEmpty)(_.sendMessage))return;const u=this._getBindingsMappingAttribureName(_);_.sendMessage={request:"crt.MessageEditorSendRequest",params:{attributesMapping:`$${u}`}}}_setBindingsMappingAttribure(_,u){const p=this._getBindingsMappingAttribureName(_),h=u[p]?.value||{};h.ChatInput=_.chatInput.split("$").pop(),u[p]={value:h},_.bindingsMappingAttribute=p}_getBindingsMappingAttribureName(_){return _.bindingsMappingAttribute||`BindingsMapping_${_.name}`}crtOnMetaDataInit(_){var u=this;return(0,n.A)(function*(){const p=_,h=u._getViewConfigs(p.viewConfig,"crt.MessageEditor"),a=p.viewModelConfig.attributes;for(const o of h)u._updateBindings(o,a);return Promise.resolve(_)})()}static{this.\u0275fac=function(u){return new(u||m)}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac})}}},13555:(L,f,e)=>{e.d(f,{X:()=>m});var n=e(62278),d=e.n(n),t=e(36486),P=e.n(t),C=e(22307),v=e.n(C);class m{constructor(){this._saveMessageDebounceTimeout=500,this._storageKeyPrefix="chat-draft",this._draftUpdatesMap=new Map}_getOrCreateSubject(_){if(!this._draftUpdatesMap.has(_)){const u=new n.Subject;u.pipe((0,t.debounceTime)(this._saveMessageDebounceTimeout)).subscribe(p=>{const h=this._getStorageKey(_);p===null?sessionStorage.removeItem(h):sessionStorage.setItem(h,p)}),this._draftUpdatesMap.set(_,u)}return this._draftUpdatesMap.get(_)}_getStorageKey(_){return`${this._storageKeyPrefix}-${_||"new"}`}setDraft(_,u){this._getOrCreateSubject(_).next(u)}getDraft(_){const u=this._getStorageKey(_);return sessionStorage.getItem(u)||""}clearDraft(_){this._getOrCreateSubject(_).next(null)}ngOnDestroy(){this._draftUpdatesMap.forEach(_=>{_.complete()}),this._draftUpdatesMap.clear()}static{this.\u0275fac=function(u){return new(u||m)}}static{this.\u0275prov=C.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"})}}},16629:(L,f,e)=>{e.d(f,{o:()=>M});var n=e(22307),d=e.n(n),t=e(5240),P=e(36486),C=e.n(P);const v="NewIncomingChat",m="AcceptChat";class M{constructor(u){this._injector=u,this._messageChannelService=u.get(t.A)}_getEventBody(u){return this._messageChannelService.messageEvent$.pipe((0,P.filter)(p=>p.header.sender===u),(0,P.map)(p=>p.body))}newIncomingChatEvent$(){return this._getEventBody(v).pipe((0,P.map)(u=>u.ChatId))}acceptChatEvent$(){return this._getEventBody(m).pipe((0,P.map)(u=>({ChatId:u.ChatId,OperatorId:u.OperatorId})))}static{this.\u0275fac=function(p){return new(p||M)(n.\u0275\u0275inject(n.Injector))}}static{this.\u0275prov=n.\u0275\u0275defineInjectable({token:M,factory:M.\u0275fac,providedIn:"root"})}}},19540:(L,f,e)=>{e.d(f,{U:()=>P});var n=e(59969),d=e(22307),t=e.n(d);class P{constructor(v){this.window=v}saveScrollPosition(v,m=0){this.window.sessionStorage.setItem(`${v}_scrollTop`,m.toString())}getScrollPosition(v){const m=this.window.sessionStorage.getItem(`${v}_scrollTop`);if(m===null||m==="")return;const M=Number(m);return isNaN(M)?void 0:M}static{this.\u0275fac=function(m){return new(m||P)(d.\u0275\u0275inject(n.ZP))}}static{this.\u0275prov=d.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"})}}},92385:(L,f,e)=>{e.d(f,{$:()=>p});var n=e(79772),d=e.n(n),t=e(34268),P=e.n(t),C=e(89986),v=e(22307),m=e.n(v),M=e(13555);const _=["span"],u=["class","data-mention"];class p{constructor(a,o){this._translateService=a,this._chatDraftService=o,this._domPurifier=P()(window),this._domPurifier.addHook("uponSanitizeElement",C.F.func)}_replaceMentions(a){if(!a.includes('class="mention"')&&!a.includes("class='mention'"))return a;const o=document.createElement("div");return o.innerHTML=a,o.querySelectorAll(".mention").forEach(s=>{const l=s.textContent||""||" ";s.replaceWith(document.createTextNode(l))}),o.innerHTML}_stripMarkdown(a){return a.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/__(.*?)__/g,"$1").replace(/_(.*?)_/g,"$1").replace(/`([^`]+?)`/g,"$1").replace(/^>+\s?/gm,"").replace(/^#{1,6}\s?/gm,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/\\n/g,`
`).replace(/\n{2,}/g,`

`).trim()}sanitizeContent(a){const o={ALLOWED_TAGS:_,ALLOWED_ATTR:u};return this._domPurifier.sanitize(a,o)}getPreview(a,o,s){if(!s)return this._translateService.instant("ChatList.YourPreview")+this.toPlainText(o);const i=this.sanitizeContent(this._chatDraftService.getDraft(a));return i&&i.length>0?this._translateService.instant("ChatList.DraftPreview")+this.toPlainText(i):this.toPlainText(o)}toPlainText(a){if(!a)return"";const o=this._replaceMentions(a);return this._stripMarkdown(o)}static{this.\u0275fac=function(o){return new(o||p)(v.\u0275\u0275inject(n.TranslateService),v.\u0275\u0275inject(M.X))}}static{this.\u0275prov=v.\u0275\u0275defineInjectable({token:p,factory:p.\u0275fac,providedIn:"root"})}}},89986:(L,f,e)=>{e.d(f,{F:()=>n});const n={name:"uponSanitizeElement",func:(d,t)=>{if(t.tagName==="span"){const P=d.getAttribute("class"),C=d.getAttribute("data-mention");if(!(P==="mention"&&C)){const m=document.createTextNode(d.textContent||"");d.parentNode?.replaceChild(m,d)}}}}},3585:(L,f,e)=>{e.d(f,{d:()=>h});var n=e(22307),d=e(62278),t=e(67057),P=e(59969),C=e(90895),v=e(95588);const m=["popupContainer"],M=a=>({"active-item":a});function _(a,o){if(a&1&&(n.\u0275\u0275elementStart(0,"span",8),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()),a&2){const s=n.\u0275\u0275nextContext().$implicit;n.\u0275\u0275propertyInterpolate("title",s.description),n.\u0275\u0275advance(),n.\u0275\u0275textInterpolate(s.description)}}function u(a,o){if(a&1){const s=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",3),n.\u0275\u0275listener("click",function(){const l=n.\u0275\u0275restoreView(s).$implicit,E=n.\u0275\u0275nextContext();return n.\u0275\u0275resetView(E.selectMention(l))}),n.\u0275\u0275element(1,"crt-image-input",4),n.\u0275\u0275elementStart(2,"div",5)(3,"span",6),n.\u0275\u0275text(4),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(5,_,2,2,"span",7),n.\u0275\u0275elementEnd()()}if(a&2){const s=o.$implicit,i=o.index,l=n.\u0275\u0275nextContext();n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(5,M,i===l.activeIndex)),n.\u0275\u0275advance(),n.\u0275\u0275property("value",s.photo||null)("placeholder",s.displayValue),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(s.displayValue),n.\u0275\u0275advance(),n.\u0275\u0275property("ngIf",s.description)}}class p{constructor(){this._changeDetector=(0,n.inject)(n.ChangeDetectorRef),this._liveAnnouncementService=(0,n.inject)(P.DW),this._isVisible=!1,this.mentions=[],this.activeIndex=-1,this.mentionSelected=new n.EventEmitter,this.scrolledToBottom=new n.EventEmitter,this._scrollHandler=o=>{const s=o.target;s.scrollTop+s.clientHeight>=s.scrollHeight-20&&this.scrolledToBottom.emit()}}selectMention(o){this.mentionSelected.emit(o),this.hide()}show(o){this._isVisible=!0;const s=10,i=this.popupContainerRef?.nativeElement;if(i){const E=window.innerHeight-o.top;i.classList.remove("popup-hidden"),Object.assign(i.style,{position:"absolute",width:`${o.width}px`,left:`${o.left}px`,bottom:`${E+s}px`,top:"auto"}),setTimeout(()=>{i.getBoundingClientRect().top<0&&Object.assign(i.style,{bottom:"auto",top:`${o.top}px`,maxHeight:`${o.top-s}px`})},0)}this._changeDetector.detectChanges()}hide(){this._isVisible=!1,this.popupContainerRef?.nativeElement?.classList.add("popup-hidden")}isVisible(){return this._isVisible}getItems(){return Array.from(this.popupContainerRef?.nativeElement?.children||[])}highlightItem(o){if(this.getItems().forEach((i,l)=>{i.classList.toggle("active-item",l===o)}),o>=0&&o<this.mentions.length){const i=this.mentions[o],l=`${i.displayValue} ${i.description||""}`.trim();this._liveAnnouncementService.announce(l,"polite")}}selectItem(o){o>=0&&o<this.mentions.length&&this.selectMention(this.mentions[o])}scrollToItem(o){this.popupContainerRef?.nativeElement&&o>=0&&this.getItems()[o]?.scrollIntoView({behavior:"auto",block:"nearest"})}ngAfterViewInit(){this.popupContainerRef?.nativeElement?.addEventListener("scroll",this._scrollHandler)}ngOnDestroy(){this.popupContainerRef?.nativeElement?.removeEventListener("scroll",this._scrollHandler)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275cmp=n.\u0275\u0275defineComponent({type:p,selectors:[["crt-mention-popup"]],viewQuery:function(s,i){if(s&1&&n.\u0275\u0275viewQuery(m,5),s&2){let l;n.\u0275\u0275queryRefresh(l=n.\u0275\u0275loadQuery())&&(i.popupContainerRef=l.first)}},inputs:{mentions:"mentions",activeIndex:"activeIndex"},outputs:{mentionSelected:"mentionSelected",scrolledToBottom:"scrolledToBottom"},standalone:!0,features:[n.\u0275\u0275StandaloneFeature],decls:3,vars:3,consts:[["popupContainer",""],[1,"container"],["class","item",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"item",3,"click","ngClass"],["readonly","true","placeholderMode","abbreviation","borderRadius","large","positioning","cover","size","small","aria-hidden","true",1,"image",3,"value","placeholder"],[1,"text"],[1,"name"],["class","description",3,"title",4,"ngIf"],[1,"description",3,"title"]],template:function(s,i){s&1&&(n.\u0275\u0275elementStart(0,"div",1,0),n.\u0275\u0275template(2,u,6,7,"div",2),n.\u0275\u0275elementEnd()),s&2&&(n.\u0275\u0275classProp("popup-hidden",!(i.mentions!=null&&i.mentions.length)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngForOf",i.mentions))},dependencies:[t.CommonModule,t.NgClass,t.NgForOf,t.NgIf,C.J,v.g],styles:["body[_ngcontent-%COMP%]{--focus-outline-outer-color: var(--crt-palette-secondary-500);--focus-outline-inner-color: white}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{position:absolute;border-radius:4px;max-width:500px;max-height:276px;overflow-y:auto;z-index:1000;padding:8px 0 8px 8px}[_nghost-%COMP%]   .container.popup-hidden[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 16px;cursor:pointer;border-radius:4px;gap:8px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;width:calc(100% - 32px);max-width:100%;flex-direction:column;gap:2px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], [_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}"]})}}class h{get mentionSymbol(){return this._mentionSymbol}constructor(o,s,i){this._injector=o,this._el=s,this._viewContainerRef=i,this._subscriptions=new d.Subscription,this._activeIndex=-1,this._page=0,this._pageSize=15,this._currentSearch="",this._mentionSymbol="@",this._mentionClassName="mention",this._lastRange=null,this._searchSubject=new d.Subject,this.mentionSelected=new n.EventEmitter}onInput(o){const s=o.target,i=window.getSelection();if(!i||i.rangeCount===0){this._popupComponent.hide();return}const l=i.getRangeAt(0),E=l.startOffset;if(!(s.textContent||s.innerHTML)){this._popupComponent.hide();return}const y=l.startContainer.textContent.substring(0,E),A=y.lastIndexOf(this._mentionSymbol);if(this._lastRange=l.cloneRange(),A!==-1){const W=y.substring(A+1);this._page=0,this._fetchMentions(W)}else this._popupComponent.hide()}_fetchMentions(o,s=!1){this._currentSearch=o,this._searchSubject.next({search:o,append:s})}_executeSearch(o,s){const i=this._page*this._pageSize;this.mentionService.getContacts(o,i,this._pageSize).pipe((0,d.take)(1)).subscribe(l=>{this._populatePopup(l,s)})}_createPopup(){this._componentRef=this._viewContainerRef.createComponent(p,{injector:this._injector});const o=this._componentRef.location.nativeElement;document.body.appendChild(o),this._popupComponent=this._componentRef.instance,this._popupComponent.mentionSelected.subscribe(s=>this._selectMention(s)),this._popupComponent.scrolledToBottom.subscribe(()=>{this._page++,this._fetchMentions(this._currentSearch,!0)})}_populatePopup(o,s){if(o.length===0&&!s){this._popupComponent.hide();return}s||o.length===0?this._popupComponent.mentions=[...this._popupComponent.mentions,...o]:(this._popupComponent.mentions=o,this._page=0),this._popupComponent.activeIndex=this._activeIndex,this._popupComponent.show(this._el.nativeElement.getBoundingClientRect())}_selectMention(o){const s=this._el.nativeElement,i=window.getSelection(),l=this._lastRange||i.getRangeAt(0);if(l){const x=l.startContainer.textContent.substring(0,l.startOffset).lastIndexOf(this._mentionSymbol);if(x!==-1){const y=l.startContainer,A=y.textContent.substring(0,x);y.textContent=A,l.setStart(y,A.length),l.collapse(!0);const W=document.createElement("span");W.dataset.mention=o.value,Object.assign(W,{className:this._mentionClassName,contentEditable:"false",textContent:o.displayValue}),l.insertNode(W),s.childElementCount===1&&l.insertNode(document.createTextNode("\u200B")),this._forcePlaceCursorAtEnd(W)}}this.mentionSelected.emit(o),this._popupComponent.hide(),s.focus()}_handleKeyboard(o){if(!this._popupComponent.isVisible())return;const s=this._popupComponent.getItems();if(s.length!==0)switch(o.key){case"ArrowDown":o.preventDefault(),this._activeIndex=(this._activeIndex+1)%s.length,this._popupComponent.highlightItem(this._activeIndex),this._activeIndex>=s.length-3&&(this._page++,this._fetchMentions(this._currentSearch,!0)),this._popupComponent.scrollToItem(this._activeIndex);break;case"ArrowUp":o.preventDefault(),this._activeIndex=(this._activeIndex-1+s.length)%s.length,this._popupComponent.highlightItem(this._activeIndex),this._popupComponent.scrollToItem(this._activeIndex);break;case"Enter":o.preventDefault(),o.stopImmediatePropagation(),o.stopPropagation(),this._activeIndex>=0&&this._activeIndex<s.length&&this._popupComponent.selectItem(this._activeIndex);break;case"Remove":case"Delete":this._handleRemove(o),o.preventDefault();break;case"Escape":o.preventDefault(),this._popupComponent.hide();break;case"Tab":this._popupComponent.hide();break}}_handleRemove(o){const i=window.getSelection().getRangeAt(0);if(i.collapsed&&i.startContainer.nodeType===3){const l=i.startContainer,E=o.key==="Backspace"?l.previousSibling:l.nextSibling;E instanceof HTMLElement&&E.classList.contains(this._mentionClassName)&&E.remove()}}_forcePlaceCursorAtEnd(o){const s=o.parentNode,i=document.createTextNode("\xA0");o.nextSibling?s.insertBefore(i,o.nextSibling):s.appendChild(i);const l=document.createRange();l.setStart(i,1),l.collapse(!0);const E=window.getSelection();E.removeAllRanges(),E.addRange(l)}_subscribeClick(){this._subscriptions.add((0,d.fromEvent)(document,"click",{capture:!0}).subscribe(o=>{if(this._popupComponent?.isVisible()){const s=o.target,i=this._popupComponent.popupContainerRef?.nativeElement,l=this._el.nativeElement;i&&!i.contains(s)&&s!==l&&!l.contains(s)&&this._popupComponent.hide()}}))}_subscribeKeydown(){this._subscriptions.add((0,d.fromEvent)(this._el.nativeElement,"keydown",{capture:!0}).subscribe(o=>this._handleKeyboard(o)))}ngOnInit(){this._createPopup(),this._subscriptions.add(this._searchSubject.pipe((0,d.debounceTime)(10)).subscribe(({search:o,append:s})=>{this._executeSearch(o,s)})),this._subscribeClick(),this._subscribeKeydown()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._componentRef?.destroy()}static{this.\u0275fac=function(s){return new(s||h)(n.\u0275\u0275directiveInject(n.Injector),n.\u0275\u0275directiveInject(n.ElementRef),n.\u0275\u0275directiveInject(n.ViewContainerRef))}}static{this.\u0275dir=n.\u0275\u0275defineDirective({type:h,selectors:[["","crtMention",""]],hostBindings:function(s,i){s&1&&n.\u0275\u0275listener("input",function(E){return i.onInput(E)})},inputs:{mentionService:"mentionService"},outputs:{mentionSelected:"mentionSelected"},standalone:!0})}}},31616:(L,f,e)=>{e.d(f,{R:()=>_});var n=e(73308),d=e(5960),t=e.n(d),P=e(41287),C=e(844),v=e(33429),m=e(62278),M=e.n(m);let _=class extends P.l{constructor(p){super(),this._translationService=p}handle(p){var h=this;return(0,n.A)(function*(){try{p.languages=yield(0,m.lastValueFrom)(h._translationService.getAvailableTranslationLanguages())}catch{p.languages=[]}yield h.next?.handle(p)})()}};_=(0,d.__decorate)([(0,C.l)({requestType:"crt.LoadTranslationLanguagesRequest",type:"crt.LoadTranslationLanguagesHandler"}),(0,d.__metadata)("design:paramtypes",[v.K])],_)},63726:(L,f,e)=>{e.d(f,{l:()=>_});var n=e(73308),d=e(5960),t=e.n(d),P=e(41287),C=e(844),v=e(62278),m=e.n(v),M=e(56704);let _=class extends P.l{constructor(p){super(),this._service=p}handle(p){var h=this;return(0,n.A)(function*(){return yield h.next?.handle(p),yield(0,v.lastValueFrom)(h._service.translateChatMessages(p.chatId,p.sourceLanguage,p.targetLanguage))})()}};_=(0,d.__decorate)([(0,C.l)({type:"crt.TranslateChatMessagesHandler",requestType:"crt.TranslateChatMessagesRequest"}),(0,d.__metadata)("design:paramtypes",[M.I])],_)},20555:(L,f,e)=>{e.d(f,{bd:()=>t,kl:()=>n,ll:()=>d});const n="OpenChatSessionEvent",d="OpenChatSessionWithMessageEvent",t="Copilot"},85040:(L,f,e)=>{e.d(f,{u:()=>n});var n;(function(d){d.SetHighlighting="setHighlighting",d.RemoveHighlighting="removeHighlighting"})(n||(n={}))},48534:(L,f,e)=>{e.d(f,{i:()=>v});var n=e(62278),d=e.n(n),t=e(85040),P=e(22307),C=e.n(P);class v{constructor(){this._currentSubscriptionIdentifier=null,this._currentSubscription=null,this._replaceSelectionSubject=new n.Subject}_unsubscribeLastEditor(){if(this._currentSubscription){const M={editorAction:t.u.RemoveHighlighting};this._replaceSelectionSubject?.next(M),this._currentSubscriptionIdentifier=null,this._currentSubscription.unsubscribe()}}subscribeToNotifications(M,_){this._currentSubscriptionIdentifier!==M&&(this._unsubscribeLastEditor(),this._currentSubscriptionIdentifier=M,this._currentSubscription=this._replaceSelectionSubject.subscribe(_))}notify(M){this._replaceSelectionSubject?.next(M)}static{this.\u0275fac=function(_){return new(_||v)}}static{this.\u0275prov=P.\u0275\u0275defineInjectable({token:v,factory:v.\u0275fac,providedIn:"root"})}}},15208:L=>{L.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<g id="Components | Chat - 72x64 | bright">\r
<g id="Icon">\r
<rect x="16.5" y="7.5" width="39" height="49" rx="2.5" stroke="#70ACEE"/>\r
<g id="Frame 19809">\r
<rect id="Rectangle 45209" x="21" y="11" width="16" height="2" rx="1" fill="#7FC7F4"/>\r
<g id="Frame 19808">\r
<g id="Frame 19814">\r
<circle id="Ellipse 3260" cx="23" cy="17" r="2" fill="#D1D1D1"/>\r
<g id="Frame 17499">\r
<rect x="21" y="20" width="24" height="9" rx="2" fill="#D1D1D1"/>\r
<g id="Frame 19807">\r
<line id="Line 2314" x1="24" y1="23.5" x2="30" y2="23.5" stroke="white"/>\r
<line id="Line 2315" x1="24" y1="25.5" x2="42" y2="25.5" stroke="white"/>\r
</g>\r
</g>\r
</g>\r
<g id="Frame 19815">\r
<circle id="Ellipse 3260_2" cx="49" cy="30" r="2" fill="#80C8F5"/>\r
<g id="Frame 17500">\r
<rect x="27" y="33" width="24" height="9" rx="2" fill="#80C8F5"/>\r
<g id="Frame 19807_2">\r
<line id="Line 2314_2" x1="30" y1="36.5" x2="48" y2="36.5" stroke="white"/>\r
<line id="Line 2315_2" x1="44" y1="38.5" x2="48" y2="38.5" stroke="white"/>\r
</g>\r
</g>\r
</g>\r
<g id="Frame 19816">\r
<circle id="Ellipse 3260_3" cx="23" cy="43" r="2" fill="#D1D1D1"/>\r
<g id="Frame 17499_2">\r
<rect x="21" y="46" width="24" height="7" rx="2" fill="#D1D1D1"/>\r
<g id="Frame 19807_3">\r
<line id="Line 2314_3" x1="24" y1="49.5" x2="42" y2="49.5" stroke="white"/>\r
</g>\r
</g>\r
</g>\r
</g>\r
</g>\r
</g>\r
</g>\r
</svg>\r
`},70807:L=>{L.exports=`<svg width="72" height="64" viewBox="0 0 72 64" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path d="M58 15H28C26.3431 15 25 16.3431 25 18C25 19.6569 26.3431 21 28 21H58C59.6569 21 61 19.6569 61 18C61 16.3431 59.6569 15 58 15Z" fill="#40ACF0"/>\r
<path d="M58 36H40C38.3431 36 37 37.3431 37 39C37 40.6569 38.3431 42 40 42H58C59.6569 42 61 40.6569 61 39C61 37.3431 59.6569 36 58 36Z" fill="#D1D1D1"/>\r
<path d="M58 26H40C38.3431 26 37 27.3431 37 29C37 30.6569 38.3431 32 40 32H58C59.6569 32 61 30.6569 61 29C61 27.3431 59.6569 26 58 26Z" fill="#D1D1D1"/>\r
<path d="M58 46H40C38.3431 46 37 47.3431 37 49C37 50.6569 38.3431 52 40 52H58C59.6569 52 61 50.6569 61 49C61 47.3431 59.6569 46 58 46Z" fill="#D1D1D1"/>\r
<circle cx="29" cy="39" r="4" fill="#004FD6"/>\r
<circle cx="29" cy="29" r="4" fill="#004FD6"/>\r
<circle cx="29" cy="49" r="4" fill="#004FD6"/>\r
<path d="M15 26C18.3137 26 21 23.3137 21 20C21 16.6863 18.3137 14 15 14C11.6863 14 9 16.6863 9 20C9 23.3137 11.6863 26 15 26Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>\r
<path d="M15 17.1152V20.3722L16.682 22.3302" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round"/>\r
</svg>\r
`},78517:L=>{L.exports='<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path d="M42.2,39.7l-8.1-3.6-.5-1.6c-.2-.6-.4-1.1-.9-1.2a.68.68,0,0,1-.4-.6L32,29.5a.91.91,0,0,1,.3-.7,6.1,6.1,0,0,0,1.5-3.6c.1-.7.5-1.3.6-2l.7-3.8a.85.85,0,0,0-.5-1.1c-.2,0-.3-.3-.3-.7a44.6,44.6,0,0,0,.5-6.7c-.3-2.3-2.1-7-6.9-6.7C15.2.4,16.2,6.6,11.8,8.5a2.6,2.6,0,0,0,2.8.5c-.2.2-1.8.3-2.5,3.3a3.76,3.76,0,0,1,2-1.5c-1.5.8-.1,5.7-.1,6.2v.6a.78.78,0,0,1-.3.7c-.6.3-.6.6-.6,1.1l.7,3.8a7.62,7.62,0,0,1,.6,2,7.7,7.7,0,0,0,1.5,3.6.91.91,0,0,1,.3.7l-.3,3.2a.82.82,0,0,1-.4.6c-.5.1-.8.7-.9,1.2l-.5,1.6L5.9,39.7A24.11,24.11,0,0,0,24,47.9,23.83,23.83,0,0,0,42.2,39.7Z" fill="#cacaca"/><g opacity="0.05"><path d="M24,2A22,22,0,1,1,2,24,22,22,0,0,1,24,2m0-2A24,24,0,1,0,48,24,24,24,0,0,0,24,0Z" fill="#181818"/></g></svg>'},21888:L=>{L.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path d="M13.5538 7.23804L4.32784 2.12044C4.17412 2.03159 3.99711 1.99031 3.81954 2.00192C3.64197 2.01352 3.47196 2.07747 3.33133 2.18556C3.18772 2.29787 3.08345 2.45217 3.03332 2.62654C2.98319 2.80092 2.98976 2.98652 3.05209 3.15698L4.59066 7.41713C4.60623 7.4596 4.63447 7.49638 4.67164 7.52255C4.70881 7.54873 4.75313 7.56306 4.79872 7.56365H8.75192C8.86558 7.56187 8.9757 7.60289 9.06004 7.67843C9.14438 7.75397 9.19668 7.85841 9.20637 7.97067C9.21011 8.02993 9.20155 8.08932 9.18122 8.14516C9.16089 8.20101 9.12922 8.25213 9.08817 8.29536C9.04712 8.3386 8.99755 8.37303 8.94254 8.39652C8.88753 8.42002 8.82824 8.43208 8.76834 8.43196H4.79872C4.75313 8.43256 4.70881 8.44689 4.67164 8.47307C4.63447 8.49924 4.60623 8.53601 4.59066 8.57849L3.05209 12.8386C3.00593 12.9699 2.99202 13.1101 3.01151 13.2478C3.03101 13.3854 3.08336 13.5165 3.16421 13.63C3.24505 13.7436 3.35206 13.8364 3.47636 13.9007C3.60065 13.9651 3.73864 13.9991 3.87887 14C4.02808 13.9993 4.17481 13.962 4.30594 13.8915L13.5538 8.75758C13.6893 8.68132 13.8019 8.57083 13.8803 8.43737C13.9587 8.30391 14 8.15224 14 7.99781C14 7.84338 13.9587 7.69171 13.8803 7.55825C13.8019 7.42479 13.6893 7.3143 13.5538 7.23804Z" fill="currentColor"/>\r
</svg>\r
`},73869:L=>{L.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M8.58802 13.7571C8.43705 13.9072 8.22896 14 7.99921 14C7.75841 14 7.54141 13.8981 7.38902 13.735L3.25662 9.7663C2.92401 9.44687 2.91333 8.91829 3.23276 8.58568C3.55219 8.25307 4.08078 8.24239 4.41339 8.56182L7.16421 11.2037L7.16421 2.835C7.16421 2.37384 7.53805 2 7.99921 2C8.46037 2 8.83421 2.37384 8.83421 2.835L8.83421 11.2052L11.5866 8.56182C11.9192 8.24239 12.4478 8.25307 12.7672 8.58568C13.0867 8.91829 13.076 9.44687 12.7434 9.7663L8.58802 13.7571Z" fill="currentColor"/>\r
</svg>\r
`}}]);
