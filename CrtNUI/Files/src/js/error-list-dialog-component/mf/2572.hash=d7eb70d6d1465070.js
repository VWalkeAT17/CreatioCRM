(self.webpackChunkapp_studio_enterprise_error_list_dialog=self.webpackChunkapp_studio_enterprise_error_list_dialog||[]).push([[2572],{48422:(x,K,_)=>{var y={"./error-icon.svg":77017,"./warning-icon.svg":64207};function m(N){var c=w(N);return _(c)}function w(N){if(!_.o(y,N)){var c=new Error("Cannot find module '"+N+"'");throw c.code="MODULE_NOT_FOUND",c}return y[N]}m.keys=function(){return Object.keys(y)},m.resolve=w,x.exports=m,m.id=48422},12572:(x,K,_)=>{var y=_(76608),m=_(74369),w=_(67057),N=_(5757),c=_(22307),V=_(44951),$=_(77901),T=_(79772);const q="CRT_CSRF",ee="CRT_LOADER",ue="CRT_SESSIONID",Ie="bpmHref",pe="bpmRef";var O=_(23176),S=_(73308),j=_(6530);class qe extends Error{constructor(){super("Next handler already specified")}}var P=_(28399);class Ae{constructor(){this._refs=new Set,this.lazyLoadingDisabled=!1}static{this._globalInstancePath="creatio._lazyModulesManager"}static get instance(){if(!this._instance){let e=(0,P.get)(window,this._globalInstancePath);e||(e=new this,(0,P.set)(window,this._globalInstancePath,e)),this._instance=e}return this._instance}add(e){this._refs.add(e)}size(){return this._refs.size}loadAll(){return Promise.all(Array.from(this._refs).map(e=>e.loadAndBootstrap()))}clear(){this._refs.clear()}}var ve;(function(i){i[i.Schema=0]="Schema",i[i.Remote=1]="Remote",i[i.Host=2]="Host"})(ve||(ve={}));const we=window;class et{constructor(){this.store={typeInfos:new Map}}static{this._prefix="creatio.registry."}static get store(){if(!this._instance){let e=(0,P.get)(we,this._prefix+this.registryKey);e||(e=new this,(0,P.set)(we,this._prefix+this.registryKey,e)),this._instance=e}return this._instance.store}}class as extends et{static{this.registryKey="pkgTopology"}static get items(){return this.store.typeInfos}static get(e){const t=this.items.get(e);if(t===void 0)throw new Error(`Package with name ${e} not found in topology`);return t}}class tt{constructor(e){this._request=e;const t=[...this._request.scopes??[]].reverse().map((s,r)=>[s,r]);this._scopesOrder=Object.fromEntries(t)}_getOrderByScopes(e){if(!e.scopes)return Number.MAX_VALUE;const t=e.scopes.filter(s=>s in this._scopesOrder).map(s=>this._scopesOrder[s]);return Math.min(...t)}_getOrderByPkgTopology(e){return e.source.type===ve.Host?Number.MAX_VALUE:as.get(e.source.packageName)}compare(e,t){const s=this._getOrderByScopes(e),r=this._getOrderByScopes(t);let n=s-r;if(n)return n;const a=this._getOrderByPkgTopology(e),u=this._getOrderByPkgTopology(t);return n=a-u,n||(n=e.source.type-t.source.type,n)}}var le=_(4930);const f="module",v="viewElement",R="mobileViewElement",k="interfaceDesignerItem",J="mobileInterfaceDesignerItem",Ee="requestHandler",_t="designTimeViewElement",st="validator",kt="converter";function Ui(i,e){Reflect.defineMetadata(f,i,e)}function qi(i){const e=Reflect.getMetadata(f,i);if(!e)throw new Error(`Module metadata was not found on '${i.name}' class`);return e}function Dn(i,e){Reflect.defineMetadata(v,i,e)}function jc(i,e){Reflect.defineMetadata(R,i,e)}function Jl(i){return Reflect.getMetadata(v,i)}function $c(i){return Reflect.getMetadata(R,i)}function Uc(i,e){Reflect.defineMetadata(st,i,e)}function qc(i){const e=Reflect.getOwnMetadata(st,i);if(!e)throw new Error(`Validator metadata was not found on '${i.name}' class`);return e}function Hc(i,e){Reflect.defineMetadata(kt,i,e)}function Kc(i){const e=Reflect.getOwnMetadata(kt,i);if(!e)throw new Error(`Converter metadata was not found on '${i.name}' class`);return e}function zc(i,e){Reflect.defineMetadata(k,i,e)}function Gc(i,e){Reflect.defineMetadata(J,i,e)}function Wc(i){return Reflect.getOwnMetadata(k,i)}function Jc(i){return Reflect.getOwnMetadata(J,i)}function Zc(i,e){Reflect.defineMetadata(_t,i,e)}function Zl(i){const e=Reflect.getOwnMetadata(_t,i);if(!e)throw new Error(`Design time view element metadata was not found on '${i.name}' class`);return e}function Tn(i){return Reflect.hasOwnMetadata(k,i)}function Hi(i){return Reflect.hasOwnMetadata(J,i)}function Yc(i,e){Reflect.defineMetadata(Ee,i,e)}function Xc(i){const e=Reflect.getMetadata(Ee,i);if(!e)throw new Error(`Request handler metadata was not found on '${i.name}' class`);return e}function Ki(i){const e=Reflect.getMetadata("requestType",i);if(!e)throw new Error(`requestType was not found on '${i.name}' class`);return{requestType:e,typeRef:i}}function Yl(i){const t=Reflect.getMetadataKeys(i).filter(s=>s.startsWith(crtInputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,i);return[s.replace(crtInputPrefix,""),r]}))}function Xl(i){const t=Reflect.getMetadataKeys(i).filter(s=>s.startsWith(crtOutputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,i);return[s.replace(crtOutputPrefix,""),r]}))}function os(i){const t=Reflect.getMetadataKeys(i).filter(s=>s.startsWith(crtValidationInputPrefix));return Object.fromEntries(t.map(s=>{const r=Reflect.getMetadata(s,i);return[s.replace(crtValidationInputPrefix,""),r]}))}function Nn(i){const t=Reflect.getOwnMetadataKeys(i).filter(s=>s.startsWith(crtInjectPrefix));return Object.fromEntries(t.map(s=>{const r=Number(s.replace(crtInjectPrefix,"")),n=Reflect.getMetadata(s,i);return[r,n]}))}function zi(i){const e=i.prototype?Object.getPrototypeOf(i.prototype):null;return e?e.constructor:null}function cs(i){const e=Reflect.getOwnMetadata("design:paramtypes",i);if(!e){if(i.length>0)throw new Error(`Dependency Injection error. Cannot read dependencies of class '${i.name}'. Please make sure class '${i.name}' has decorator and 'emitDecoratorMetadata' option is enabled in your 'tsconfig.json' file.`);const s=zi(i);return s&&s!==Object?cs(s):[]}const t=Nn(i);return Object.entries(t).forEach(([s,r])=>e[s]=r),e}function Gi(i){console.error("Not supported: lazy modules should not be dependent on other lazy modules. Some functions may not work correctly",i)}function Lt(i){if(!Array.isArray(i))return[];if(i.length===0)return[];const e=new Set,t=[...i];for(;t.length>0;){const s=t.pop();if(!s||e.has(s))continue;if(typeof s!="function"){Gi(s);continue}e.add(s);const r=qi(s)?.includes||[];t.push(...r)}return[...e]}function Wi(i,e){return i?.length?i.some(t=>e?.includes(t)):!0}const xn=window;xn.creatio??={},xn.creatio._bootstrappedCrtModules??=new Map;const gr=xn.creatio._bootstrappedCrtModules;function yt(i){gr.forEach((e,t)=>{e.root&&i(e,t)})}function Vn(i){yt(e=>e.options?.onContextCreate?.(i))}function Bt(i){yt(e=>e.options?.onContextUpdate?.(i))}function us(i){yt(e=>e.options?.onContextDestroy?.(i))}class He{constructor(){var e=this;this._handlers=[],this._requestListeners=new Map,this._handlersCache=new Map,this._handlersScopesByContextId=new Map,this.handlerChain$={process:function(){var t=(0,S.A)(function*(s){let r;if(e._hasCacheHandler(s))r=e._getCacheHandler(s);else{const n=e._getMatchedHandlers(s);Ae.instance.lazyLoadingDisabled||(yield e._loadLazyHandlers(s,n)),r=e._buildHandlersChain(s,n)}return e._requestListeners.forEach(n=>n?.(s)),r?.handle(s)});return function(r){return t.apply(this,arguments)}}(),register:t=>(this._handlersCache.delete(t.requestType),this._handlers.push(t),()=>{const s=this._handlers.indexOf(t);s>-1?(this._handlers.splice(s,1),this._handlersCache.delete(t.requestType)):console.warn(`${t?.requestType} not found to unsubscribe`)}),update:t=>{const s=this._handlers.find(r=>r.type===t.type);s&&(s.createHandler=t.createHandler)},subscribe:(t,s)=>{if(!t)return()=>{};const r=(0,j.qv)(),n=a=>{(!s||a.$context===s)&&t(a)};return this._requestListeners.set(r,n),()=>this._requestListeners.delete(r)}}}clearContextedHandlersCache(e){return(this._handlersScopesByContextId.get(e)??[]).every(({requestType:s,scope:r})=>this._handlersCache.get(s)?.delete(r))}clear(){this._handlers.splice(0),this._requestListeners.clear(),this._handlersCache.clear(),this._handlersScopesByContextId.clear()}_getCacheHandler(e){const t=this._handlersCache.get(e.type),s=this._getCacheScopesKey(e);return t.get(s)}_hasCacheHandler(e){const t=this._handlersCache.get(e.type),s=this._getCacheScopesKey(e);return t&&t.has(s)}_getCacheScopesKey(e){const t=this._getInjectionContext(e?.$context)?.id??"";return(e.scopes||[""]).join("_").concat(t)}_getInjectionContext(e){return e?._injectionContext||e?.parent&&this._getInjectionContext(e.parent)}_setContextedScopes(e,t){const s=this._getInjectionContext(e?.$context)?.id,r=this._handlersScopesByContextId.has(s)?this._handlersScopesByContextId.get(s):[];r.push({requestType:e.type,scope:t}),this._handlersScopesByContextId.set(s,r)}_setCacheHandler(e,t){const s=this._handlersCache.has(e.type)?this._handlersCache.get(e.type):new Map,r=this._getCacheScopesKey(e);s.set(r,t),this._getInjectionContext(e?.$context)?.id&&this._setContextedScopes(e,r),this._handlersCache.set(e.type,s)}_isRequestHandler(e){return typeof e.handle=="function"&&typeof e.setNext=="function"}_checkHandlerInstanceOf(e){if(!this._isRequestHandler(e))throw new Error('Handler should implement "BaseRequestHandler"')}_loadLazyHandlers(e,t){var s=this;return(0,S.A)(function*(){const r=new Set;t.forEach(u=>{u.lazy&&!u.createHandler&&r.add(u.lazyModuleRef)});const n=[...r];yield Promise.all(n.map(u=>u.loadAndBootstrap()));const a=s._getInjectionContext(e?.$context);if(a&&r.size){const u=yield Lt(n.map(d=>d.typeRef));for(const d of u)a.addLazyModule(d);Bt(a)}})()}_getMatchedHandlers(e){return this._handlers.filter(t=>t.requestType!==e.type?!1:Wi(t.scopes,e.scopes))}_buildHandlersChain(e,t){const s=new tt(e);t.sort((u,d)=>s.compare(u,d));const r=this._getInjectionContext(e?.$context),n=t.map(u=>u.createHandler.call(u,r));n.forEach(u=>this._checkHandlerInstanceOf(u)),this._joinHandlersInChain(n);const a=n[0];return this._setCacheHandler(e,a),a}_joinHandlersInChain(e){for(let t=0;t<e.length-1;t++)try{e[t].setNext(e[t+1])}catch(s){throw s instanceof qe?new Error("Handler factory should return new instance of BaseRequestHandler class or its subclass (next handler should not be specified)"):s}}}const Ft=window;class Se{get _chain(){return Ft.handlerChain}set _chain(e){Ft.handlerChain=e}static get instance(){return Se._instance||(Se._instance=new Se)}constructor(){this._chain||this._createGlobalHandlerChain()}_createGlobalHandlerChain(){this._chain=new He}clearContextedHandlersCache(e){return this._chain.clearContextedHandlersCache(e)}register(e){return this._chain.handlerChain$.register(e)}update(e){return this._chain.handlerChain$.update(e)}process(e){return this._chain.handlerChain$.process(e)}subscribe(e,t){return this._chain.handlerChain$.subscribe(e,t)}clear(){this._chain.clear()}}function Pe(i,e){if(i.split(".").length<2)throw new Error(`Error when register ${i}. Type property should have format "VendorPrefix.${e}"`)}function Qc(i,e){return Pe(i,e)}function eu(i){const[e,t]=i.split("."),s=On(t);if(!e||s!==t)throw new Error(`Error when register ${i}. Type property should have Pascal case, e.g. ${e+"."+s}. The first letter of each word in a compound word should be capitalized`)}function Ke(i){const[e,t]=i.split("."),s=On(t);if(e.toLowerCase()==="crt"&&s!==t)throw new Error(`Error when register ${i}. Type property should have Pascal case, e.g. ${e+"."+s}. The first letter of each word in a compound word should be capitalized`)}function On(i){return(0,P.upperFirst)((0,P.camelCase)(i))}function kn(i,e){if(!e)throw new Error(`Error when resolve ${i}. Type was not registered.`)}function Ji(i,e,t){if(t.has(i)&&!isEqual(t.get(i),e))throw new Error(`Error when register ${i}. Element with this type has already exist`)}class tu extends et{static{this.registryKey="HandlerChainServicesRegistry"}static validate({requestType:e}){Pe(e,this.registryKey),Ke(e),this.checkUniqueRequestType(e)}static checkUniqueRequestType(e){if(this.services.get(e))throw new Error(`${e} already registered`)}static register(e){this.validate(e),this.services.set(e.requestType,e)}static get services(){return this.store.typeInfos}}class E{constructor(){this.handlerChain=Se.instance}static{this._instanceOfKey="devkit_BaseRequestHandler"}get next(){return this._next}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===E._instanceOfKey}setNext(e){if(this._next)throw new qe;this._next=e}}var o=_(62278);class b{constructor(e){this._injector=e,this._handlerChain=Se.instance,this._unsubscribesHandlers=[],this._registerHandlerChain()}_registerHandlerChain(){tu.services.forEach((e,t)=>{Pe(t,"HandlerChainServiceTypeName"),Ke(t);const s=class extends E{constructor(n){super(),this._innerInjector=n}handle(n){const u=this._innerInjector.get(e.typeRef)[n.method](...n.args);let d;return u instanceof Promise?d=u:u instanceof o.Observable?d=(0,o.lastValueFrom)(u,{defaultValue:null}):d=Promise.resolve(u),d}},r=()=>new s(this._injector);this._unsubscribesHandlers.push(this._handlerChain.register({requestType:t,createHandler:r,source:{type:ve.Host}}))})}ngOnDestroy(){this._unsubscribesHandlers.forEach(e=>e())}static{this.\u0275fac=function(t){return new(t||b)(c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac})}}const M={provide:c.APP_INITIALIZER,useFactory:()=>()=>{},deps:[b],multi:!0};var h=_(5960);const F=new c.InjectionToken("FEATURE_VALUES",{factory:()=>({})});var z=_(41483),ce=_(13875),ge=_(89720),te=_(90964),l=_(36486),Zi=_(72051),Yi=_(30293);const Xi="features-cache",Sm={provide:Zi.P,useValue:{name:Xi,type:z.P.PersistentAndMemory,options:{tableName:Yi.w.Features}},multi:!0},Ql=new Array("constructor","ngOnDestroy");let Qi=!1;const su=new Proxy({},{get(i,e){if(Qi||Ql.includes(e))return i[e];throw new Error(`FEATURE_VALUES. "${String(e)}" not loaded`)}}),ed={provide:F,useFactory:()=>su},td=new c.InjectionToken("FEATURE_SERVICE_GET_FEATURES_STATES_ENDPOINT",{factory:()=>"rest/FeatureService/GetFeatureStates",providedIn:"root"});let Ln=class Oi{constructor(e,t,s,r,n){this.httpClient=e,this._getFeatureStatesEndpoint=t,this._useSystemClientCache=s,this._cacheManager=r,this._measurePerformanceService=n,this._cachedCodes=new Map,this._featuresLoaded=!1,this._destroyed$=new o.Subject,this._isDevMode=(0,c.isDevMode)()}_getFeaturesFromURL(){const e=location.hash,t=e.indexOf("?");if(this._isDevMode&&t>=0){const s=e.substring(t+1);return[...new URLSearchParams(s.startsWith("?")?s.slice(1):s)].filter(([n])=>n.startsWith("feature:")).map(([n,a])=>({key:n.substring(8),value:a==="true"}))}return[]}_loadFeaturesValues(){const e=this.httpClient.post(this._getFeatureStatesEndpoint,{}).pipe((0,l.map)(t=>t.GetFeatureStatesResult.map(s=>({key:s.Key,value:s.Value===1}))));return this._useSystemClientCache?(0,o.from)(this._cacheManager.getOrCreate({name:Xi,type:z.P.Memory})).pipe((0,l.switchMap)(()=>this._cacheManager.executeWithBulkCache(Xi,e)),this._measurePerformanceService.measure$("FeatureService: load features with cache bulk")):e}_enrichFeaturesWithUrlValues(e){const t=this._getFeaturesFromURL();return[...e,...t]}updateCachedFeatureValues(e,t){Object.assign(e,t),Object.freeze(e)}loadFeatureStates(){return this._featureStates$?this._featureStates$:(this._featureStates$=this._loadFeaturesValues().pipe((0,l.map)(e=>this._enrichFeaturesWithUrlValues(e)),(0,l.map)(e=>{e.forEach(s=>{this._cachedCodes.set(s.key,s.value)});const t=e.map(s=>[s.key,s.value]);return Object.fromEntries(t)}),(0,l.tap)(e=>{this.updateCachedFeatureValues(su,e),this._featuresLoaded=!0,Qi=!0}),(0,l.catchError)(()=>(Qi=!0,this._featuresLoaded=!0,(0,o.of)(null))),(0,o.shareReplay)({bufferSize:1,refCount:!1}),(0,l.takeUntil)(this._destroyed$)),this._featureStates$)}getFeatureState(e){return e?this._featuresLoaded?(0,o.of)(this._cachedCodes.get(e)||!1):this.loadFeatureStates().pipe((0,l.map)(()=>this._cachedCodes.get(e)||!1)):(0,o.of)(!1)}getFeaturesState(e){return(0,o.from)(this.getFeaturesStateAsync(e))}getFeaturesStateAsync(e){return Promise.all(e.map(t=>{const s=typeof t=="string"?this.getFeatureState(t):t;return new Promise(r=>s.pipe((0,l.first)()).subscribe({next:r}))}))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Oi)(c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(td),c.\u0275\u0275inject(ce.X,8),c.\u0275\u0275inject(ge.G),c.\u0275\u0275inject(te.g))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Oi,factory:Oi.\u0275fac,providedIn:"root"})}};Ln=(0,h.__decorate)([(0,O.op)({requestType:"crt.FeatureService"}),(0,h.__metadata)("design:paramtypes",[N.HttpClient,String,Boolean,ge.G,te.g])],Ln);function sd(i){return()=>(0,o.lastValueFrom)(i.loadFeatureStates(),{defaultValue:null})}const rd={provide:c.APP_INITIALIZER,useFactory:sd,deps:[Ln],multi:!0};function nd(i){return i.endsWith("/")||(i+="/"),i}function id(i){return i.replace(/(^([/\\])+)|(([/\\])+$)/,"")}function ad(i){return i=i.replace(location.hash,""),i.replace(location.search,"")}function od(i){return`${cd()}/Navigation/Navigation.aspx?schemaName=${i}`}function Cm(){return"/"}function bt(){let i=location.pathname;const e=i.match(/.*?\/\d\/?/);return e&&e.length===1?i=nd(e[0]):i="",ud(location.origin,i)}function ru(){let i=location.href.replace(bt(),"");return i=ad(i),i||"/"}function Am(){const i=ru(),e=bt(),t=i.split("/").filter(Boolean)[0];return t?`${e}${t}/`:e}function Bn(){let e=bt().replace(location.origin,"");return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}function cd(){return bt().replace(/\/0\/?$|\/+$/,"")}function ud(...i){return i.map(e=>id(e)).join("/")}function vm(i,e){return`${od(i)}&recordId=${e}`}function Em(i,e){function t(a,u){return a.toLowerCase().replace(u,"").split("/").filter(d=>d).join("/")}const s=bt().toLowerCase(),r=t(i,s),n=t(e,s);return r===n}function Mm(i){return i?Bn()+imageServiceUrl+i:null}function Rm(){return Bn()+esqServiceUrl}function Im(i){const{uId:e,name:t,packageUId:s,userLevelSchema:r}=i;if(!e&&!t)throw new Error("uId or name is required");const n=bt(),a=ru(),u=`#/InterfaceDesigner/${e||t}`,d=new URLSearchParams;return s&&d.append("packageUId",s),r&&d.append("userLevelSchema","true"),`${n}${a}${u}?${d.toString()}`}const ld="Translations/Custom/",dd="CommonFeatures.UseCustomCoreLocalizations",nu=new c.InjectionToken("FETCH_MULTI_TRANSLATE_RESOURCES_SOURCES"),iu=new c.InjectionToken("FETCH_MULTI_TRANSLATE_CUSTOM_RESOURCES_SOURCES");class St{constructor(e,t,s){this._resourceSources=e,this._customResourceSources=t,this._featureService=s}_getCustomResourcesSource(){return this._customResourceSources?.length?this._customResourceSources:[{prefix:w.Location.joinWithSlash(bt(),ld),suffix:".json"}]}getResourceOptions(){return(0,o.from)(this._featureService.getFeatureState(dd)).pipe((0,o.map)(e=>e?this._getCustomResourcesSource():[]),(0,o.map)(e=>[...this._resourceSources??[],...e]))}static{this.\u0275fac=function(t){return new(t||St)(c.\u0275\u0275inject(nu),c.\u0275\u0275inject(iu,8),c.\u0275\u0275inject(Ln))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:St,factory:St.\u0275fac})}}const au=new c.InjectionToken("NestedTranslateLoader");class jt{constructor(e){this._optionsProvider=e}_fetchTranslation(e){return fetch(e,{cache:"no-cache"}).then(t=>{if(!t.ok&&t.status!==304)throw new Error(`Loading translations failed: ${e} (${t.status})`);return t.json()})}_handleFetchResults(e){for(const s of e.filter(r=>r.status==="rejected"))console.error(s.reason);const t=e.filter(s=>s.status==="fulfilled").map(s=>s.value||{});return(0,P.merge)({},...t)}getTranslation(e){return this._optionsProvider.getResourceOptions().pipe((0,o.switchMap)(t=>{const s=t.map(({prefix:r,suffix:n})=>this._fetchTranslation(`${r}${e}${n}`));return(0,o.from)(Promise.allSettled(s)).pipe((0,o.map)(r=>this._handleFetchResults(r)))}))}static{this.\u0275fac=function(t){return new(t||jt)(c.\u0275\u0275inject(St))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:jt,factory:jt.\u0275fac})}}class _r{static _getResourceSourcesProviders(e){const{resourceSources:t,customResourceSources:s}=e??{},r=(s??[]).map(n=>({...n,provide:iu,multi:!0}));return[{provide:nu,useValue:t},...r]}static forRoot(e){const t=T.TranslateModule.forRoot({...e,loader:{provide:T.TranslateLoader,useClass:jt}});return t.providers.push(St,...this._getResourceSourcesProviders(e)),t}static forNested(e){const t=T.TranslateModule.forRoot(e);return t.providers.push({provide:au,useClass:jt},St,...this._getResourceSourcesProviders(e)),t}static with(e){return{ngModule:_r,providers:[jt,St,...this._getResourceSourcesProviders(e)]}}static{this.\u0275fac=function(t){return new(t||_r)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:_r})}static{this.\u0275inj=c.\u0275\u0275defineInjector({})}}var A=_(86464),ea=_(37851);class ou{constructor(e){Object.assign(this,e)}}class wm extends ou{constructor(e){super(e),this.externalLink=!1}}class cu extends ou{}var uu=_(91592),$t;(function(i){i[i.Error=1]="Error",i[i.Warning=2]="Warning",i[i.Information=4]="Information"})($t||($t={}));function hd(i,e){if(i&1&&c.\u0275\u0275element(0,"mat-icon",1),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("svgIcon",t.svgIconName)}}class pd extends cu{constructor(e){super(e),this.cellComponentClass=Fn}}class Fn extends uu.X{get svgIconName(){return{[$t.Error]:this.errorIconName,[$t.Warning]:this.warningIconName,[$t.Information]:""}[this.getValue()]??""}constructor(e,t){super(),this._matIconRegistry=e,this._domSanitizer=t,this.errorIconName="error-icon",this.warningIconName="warning-icon",this._registerIcons()}_registerIcons(){[this.warningIconName,this.errorIconName].forEach(e=>{this._matIconRegistry.addSvgIconLiteral(e,this._domSanitizer.bypassSecurityTrustHtml(_(48422)("./"+e+".svg")))})}static{this.\u0275fac=function(t){return new(t||Fn)(c.\u0275\u0275directiveInject(ea.MatIconRegistry),c.\u0275\u0275directiveInject(y.DomSanitizer))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:Fn,selectors:[["ts-error-type-icon-table-cell"]],features:[c.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","error-type-icon",3,"svgIcon",4,"ngIf"],[1,"error-type-icon",3,"svgIcon"]],template:function(t,s){t&1&&c.\u0275\u0275template(0,hd,1,1,"mat-icon",0),t&2&&c.\u0275\u0275property("ngIf",!s.isEmpty()&&s.getValue())},dependencies:[w.NgIf,ea.MatIcon],styles:[".error-type-icon[_ngcontent-%COMP%]{height:16px;width:16px}"]})}}function md(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"div",1),c.\u0275\u0275element(1,"mat-icon",2),c.\u0275\u0275elementEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("svgIcon",t.iconName)}}class fd extends cu{constructor(e,t){super(e),this.cellComponentClass=yr,this.iconName=t}}class yr extends uu.X{get iconName(){return this.columnDataSchema.iconName.length?this.columnDataSchema.iconName:this.getValue()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(yr)))(s||yr)}})()}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:yr,selectors:[["ts-icon-table-cell"]],features:[c.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[["class","drag-drop-icon-wrapper","cdkDragHandle","",4,"ngIf"],["cdkDragHandle","",1,"drag-drop-icon-wrapper"],[3,"svgIcon"]],template:function(t,s){t&1&&c.\u0275\u0275template(0,md,2,1,"div",0),t&2&&c.\u0275\u0275property("ngIf",!s.isEmpty())},dependencies:[w.NgIf,ea.MatIcon]})}}var re=_(23681),gd=_(4737);class _d extends gd.MatTableDataSource{constructor(e=[]){super(e),this._visibleContentSize=0,this._pageSize=40,this.resetVisibleContentSize()}resetVisibleContentSize(){this._visibleContentSize=this._pageSize}loadNext(){this._visibleContentSize+=this._pageSize,this._updateChangeSubscription()}_pageData(e){return this._visibleContentSize>=e.length?e:e.slice(0,this._visibleContentSize)}}class ta extends Error{constructor(e){super(`Argument with name '${e}' is empty.`)}}class jn extends Error{constructor(e){super(`Argument with name '${e}' is out of range.`)}}class H{static checkArgumentEmpty(e,t){if(t==null)throw new ta(e)}static checkArrayEmpty(e,t){if(H.checkArgumentEmpty(e,t),t.length===0)throw new ta(e)}static checkStringIsNotEmpty(e,t){if(this.checkArgumentEmpty(e,t),t==="")throw new ta(e);return t}static checkArgumentOutOfRange(e,t,s){if(s.begin&&t<s.begin)throw new jn(e);if(s.end&&t>s.end)throw new jn(e)}static checkEnumOutOfRange(e,t,s){if(!s||!Object.values(s).includes(t))throw new jn(e)}}class br{createObserver(e,t,s){return new yd(e,t,s)}static{this.\u0275fac=function(t){return new(t||br)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:br,factory:br.\u0275fac,providedIn:"root"})}}class yd{constructor(e,t,s){if(this._bottomBuffer=100,this._lastScrollMaxPosition=0,this._emitter=new c.EventEmitter,H.checkArgumentEmpty("element",e),this._element=e,this._subscribeOnScroll(),s){if(s<=0)throw new Error(`Value of 'bottomBuffer' paramter must be positive, but actual value is ${s}.`);this._bottomBuffer=s}t&&this.subscribe(t)}_isWindowObserved(e){return!(this._element instanceof HTMLElement)}_scrolledToBottom(){const e=this._element,t=this._isWindowObserved(e)?e.document.documentElement.scrollTop:e.scrollTop,s=this._isWindowObserved(e)?e.document.body.scrollHeight:e.scrollHeight,r=this._isWindowObserved(e)?e.innerHeight:e.offsetHeight;if(!s||!r)return!1;const n=s-r-this._bottomBuffer;return this._lastScrollMaxPosition=t>this._lastScrollMaxPosition?t:this._lastScrollMaxPosition,this._lastScrollMaxPosition===t&&t>=n}_processScroll(){this._scrolledToBottom()&&this._emitter.emit()}_subscribeOnScroll(){this._eventListener=this._processScroll.bind(this),this._element.addEventListener("scroll",this._eventListener)}subscribe(e){this._emitter.subscribe(e)}resetScrollMaxPosition(){this._lastScrollMaxPosition=0}destroy(){this._element.removeEventListener("scroll",this._eventListener),this._element=null,this._emitter.unsubscribe()}}var ls=_(10821);const bd=["dataViewWrapper"],Sd=["tableNgContainer"];function Cd(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"div",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.additionalText)}}function Ad(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"div",11)(1,"a",12),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("href",t.helpLinkUrl.url,c.\u0275\u0275sanitizeUrl),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.helpLinkUrl.caption)}}function vd(i,e){if(i&1&&(c.\u0275\u0275elementContainerStart(0),c.\u0275\u0275elementStart(1,"button",13),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(4,"button",14),c.\u0275\u0275text(5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementContainerEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(),c.\u0275\u0275property("mat-dialog-close",!1),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(3,4,"TableDialog.Cancel")," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",!0),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(t.continueButtonCaption)}}function Ed(i,e){i&1&&(c.\u0275\u0275elementStart(0,"button",13),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),i&2&&(c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,1,"TableDialog.Close")," "))}class ds{constructor(e,t){this.dialogData=e,this.scrollToBottomObserverFactory=t,this.title="",this.sortColumn="",this.additionalText="",this.continueButtonCaption=""}_renderTableComponent(e){var t=this;return(0,S.A)(function*(){yield Promise.all([_.e(5783),_.e(2411),_.e(8585)]).then(_.bind(_,88585)).then(s=>{const r=s.TableComponent;t._table=e.createComponent(r).instance,t._table.dataSchema=t.dataSchema,t._table.dataSource=t.tableDataSource,t._table.sortColumn=t.sortColumn,t._table.headerSticky=!0})})()}_initScrollToBottomObserver(){const e=this.dataViewWrapper.nativeElement;this._scrollToBottomObserver=this.scrollToBottomObserverFactory.createObserver(e,this._loadNextData.bind(this))}_loadNextData(){this.tableDataSource&&this.tableDataSource.loadNext()}ngAfterViewInit(){this._initScrollToBottomObserver()}ngOnInit(){var e=this;return(0,S.A)(function*(){!e.dialogData||!e.dialogData.data||(e.tableDataSource=new _d(e.dialogData.data),e.dataSchema=e.dialogData.dataSchema,e.title=e.dialogData.title||e.title,e.sortColumn=e.dialogData.sortColumn,e.additionalText=e.dialogData.additionalText,e.helpLinkUrl=e.dialogData.helpLinkUrl,e.continueButtonCaption=e.dialogData.continueButtonCaption,yield e._renderTableComponent(e.tableNgContainer))})()}ngOnDestroy(){this._scrollToBottomObserver&&this._scrollToBottomObserver.destroy()}static{this.\u0275fac=function(t){return new(t||ds)(c.\u0275\u0275directiveInject(re.MAT_DIALOG_DATA),c.\u0275\u0275directiveInject(br))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:ds,selectors:[["ts-table-dialog"]],viewQuery:function(t,s){if(t&1&&(c.\u0275\u0275viewQuery(bd,7),c.\u0275\u0275viewQuery(Sd,7,c.ViewContainerRef)),t&2){let r;c.\u0275\u0275queryRefresh(r=c.\u0275\u0275loadQuery())&&(s.dataViewWrapper=r.first),c.\u0275\u0275queryRefresh(r=c.\u0275\u0275loadQuery())&&(s.tableNgContainer=r.first)}},decls:14,vars:5,consts:[["dataViewWrapper",""],["tableNgContainer",""],["withoutContinue",""],["mat-dialog-title",""],[1,"dialog-content-wrapper"],["class","table-dialog-additional-text",4,"ngIf"],["class","table-dialog-help-link-url",4,"ngIf"],["mat-dialog-content","",1,"data-table"],["mat-dialog-actions",""],[4,"ngIf","ngIfElse"],[1,"table-dialog-additional-text"],[1,"table-dialog-help-link-url"],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-flat-button","","color","primary","cdkFocusInitial","",3,"mat-dialog-close"],["mat-button","",3,"mat-dialog-close"]],template:function(t,s){if(t&1&&(c.\u0275\u0275elementStart(0,"div",3)(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",4),c.\u0275\u0275template(4,Cd,2,1,"div",5)(5,Ad,3,2,"div",6),c.\u0275\u0275elementStart(6,"div",7,0),c.\u0275\u0275elementContainer(8,null,1),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(10,"div",8),c.\u0275\u0275template(11,vd,6,6,"ng-container",9)(12,Ed,3,3,"ng-template",null,2,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()()),t&2){const r=c.\u0275\u0275reference(13);c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.title),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",s.additionalText),c.\u0275\u0275advance(),c.\u0275\u0275property("ngIf",s.helpLinkUrl),c.\u0275\u0275advance(6),c.\u0275\u0275property("ngIf",s.continueButtonCaption)("ngIfElse",r)}},dependencies:[w.NgIf,ls.MatButton,re.MatDialogClose,re.MatDialogTitle,re.MatDialogActions,re.MatDialogContent,T.TranslatePipe],styles:[`ts-table-dialog{min-width:850px;max-width:900px;margin:0 8px!important;padding:0}ts-table-dialog .table-dialog-additional-text{margin-bottom:4px;display:inline}ts-table-dialog .table-dialog-help-link-url{display:inline;cursor:pointer}ts-table-dialog .data-table{overflow-y:auto!important;max-height:330px;margin:0;padding:0}ts-table-dialog .data-table table{padding-top:0}ts-table-dialog [mat-dialog-actions]{display:flex;flex-direction:row;justify-content:flex-end;margin:20px 0 10px!important}
`],encapsulation:2})}}var Ut;(function(i){i.Schema="Schema",i.Assembly="Assembly",i.SqlScript="SqlScript",i.SchemaData="SchemaData",i.Package="Package"})(Ut||(Ut={}));var Ct=_(29957),hs;(function(i){i[i.Primary=0]="Primary",i[i.Secondary=1]="Secondary",i[i.Cancel=2]="Cancel",i[i.Delete=3]="Delete"})(hs||(hs={}));const Md={caption:"ConfirmationDialog.YES",result:hs.Secondary},Rd={caption:"ConfirmationDialog.NO",result:hs.Primary},Pm={caption:"ConfirmationDialog.CANCEL",result:hs.Cancel},Dm={caption:"ConfirmationDialog.DELETE",result:hs.Delete};function Id(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"button",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),i&2){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("mat-dialog-close",t.secondaryButton.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,2,t.secondaryButton.caption)," ")}}function wd(i,e){if(i&1&&(c.\u0275\u0275elementStart(0,"button",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd()),i&2){const t=e.$implicit;c.\u0275\u0275property("mat-dialog-close",t.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(2,2,t.caption)," ")}}class ps{constructor(e){this.data=e,this.buttons=[],e&&(this.primaryButton=e.primaryButton,this.secondaryButton=e.secondaryButton,this.message=e.message,this.buttons=e.buttons),this.buttons?.length||(this.primaryButton??=Rd,this.secondaryButton??=Md)}static{this.\u0275fac=function(t){return new(t||ps)(c.\u0275\u0275directiveInject(re.MAT_DIALOG_DATA))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:ps,selectors:[["ts-confirmation-dialog"]],decls:9,vars:7,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngIf"],["class","action-button","mat-button","",3,"mat-dialog-close",4,"ngFor","ngForOf"],["mat-button","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(7,Id,3,4,"button",4)(8,wd,3,4,"button",5),c.\u0275\u0275elementEnd()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",s.primaryButton.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,5,s.primaryButton.caption)," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",s.secondaryButton),c.\u0275\u0275advance(),c.\u0275\u0275property("ngForOf",s.buttons))},dependencies:[w.NgForOf,w.NgIf,ls.MatButton,re.MatDialogClose,re.MatDialogActions,re.MatDialogContent,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{margin:27px 0 0!important;justify-content:flex-end}"]})}}class ms{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||ms)(c.\u0275\u0275directiveInject(re.MAT_DIALOG_DATA))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:ms,selectors:[["ts-error-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","warn","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd()()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[ls.MatButton,re.MatDialogClose,re.MatDialogActions,re.MatDialogContent,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class fs{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||fs)(c.\u0275\u0275directiveInject(re.MAT_DIALOG_DATA))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:fs,selectors:[["ts-info-dialog"]],decls:7,vars:4,consts:[["mat-dialog-content",""],[1,"message"],["mat-dialog-actions",""],["type","button","mat-flat-button","","color","primary","cdkFocusInitial","",1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0)(1,"span",1),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd()(),c.\u0275\u0275elementStart(3,"div",2)(4,"button",3),c.\u0275\u0275text(5),c.\u0275\u0275pipe(6,"translate"),c.\u0275\u0275elementEnd()()),t&2&&(c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(s.data==null?null:s.data.message),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(6,2,"InfoDialog.OK")," "))},dependencies:[ls.MatButton,re.MatDialogClose,re.MatDialogActions,re.MatDialogContent,T.TranslatePipe],styles:["[mat-dialog-content][_ngcontent-%COMP%]{max-height:450px;overflow-y:auto!important}[mat-dialog-content][_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{white-space:pre-line;word-break:break-word}[mat-dialog-actions][_ngcontent-%COMP%]{justify-content:right;margin:27px 0 0!important}"]})}}class qt{constructor(e,t,s,r){this.document=e,this._ngZone=t,this._translateService=s,this.dialog=r}_stopEventPropagation(e,t){e.afterOpened().pipe((0,l.takeUntil)(t)).subscribe(s=>{const n=this.document.getElementsByClassName("cdk-overlay-container")[0];n&&n.addEventListener("click",function(a){a.stopImmediatePropagation()})})}getMessageDialogConfig(e){const t={width:"450px",panelClass:["dialog-top-border"],data:{}};if(typeof e=="string")return t.data.message=e,t;e.panelClass?.length>0&&t.panelClass.push(...e.panelClass);const s=e;return s.primaryButton&&(t.data.primaryButton=s.primaryButton),s.secondaryButton&&(t.data.secondaryButton=s.secondaryButton),s.buttons&&(t.data.buttons=s.buttons),t.data.message=s.message,t}open(e,t){return this._ngZone.run(()=>{const s=this.dialog.open(e,t),r=s.afterClosed();return this._stopEventPropagation(s,r),r})}openInfoDialog(e){return this.open(fs,this.getMessageDialogConfig(e))}openErrorDialog(e){return this.open(ms,this.getMessageDialogConfig(e))}openConfirmationDialog(e){return this.open(ps,this.getMessageDialogConfig(e))}openOperationPermissionsErrorDialog(e){const t=Ct.String.format(this._translateService.instant("OperationPermissionsErrorDialog.ErrorTemplate"),e);return this.openInfoDialog(t)}closeById(e){this.dialog.getDialogById(e)?.close()}closeAll(){this.dialog.closeAll()}hasOpenDialogs(){return!!this.dialog.openDialogs?.length}getOpenDialogs(){return this.dialog.openDialogs}static{this.\u0275fac=function(t){return new(t||qt)(c.\u0275\u0275inject(w.DOCUMENT),c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(T.TranslateService),c.\u0275\u0275inject(re.MatDialog))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:qt,factory:qt.\u0275fac})}}var B;(function(i){i.PrimaryColumnValue="primaryColumnValue",i.ColumnValue="columnValue",i.Filter="filter",i.PrimaryDisplayValueFilter="primaryDisplayValueFilter",i.Empty="empty",i.Never="never"})(B||(B={}));var de=_(78240);class Sr{static{this._instanceOfKey="devkit_BaseFilter"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isEnabled=!0,this.trimDateTimeParameterToDate=!1,this.filterType=e}static fromJson(e,t,s){throw new Error(`fromJson not supported on filter type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,de.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,de.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class ze extends Sr{static{this._instanceOfKey="devkit_SingleFilter"}static get _instanceOfKeys(){return[...Sr._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(e),this.comparisonType=t,this.leftExpression=s?.clone()}toJson(){return{...super.toJson(),leftExpression:this.serializeItem(this.leftExpression)}}_getUsedColumns(){return this.leftExpression._getUsedColumns()}}var ie;(function(i){i[i.None=0]="None",i[i.Compare=1]="Compare",i[i.IsNull=2]="IsNull",i[i.Between=3]="Between",i[i.In=4]="In",i[i.Exists=5]="Exists",i[i.FilterGroup=6]="FilterGroup"})(ie||(ie={}));class Ne extends ze{static{this._instanceOfKey="devkit_CompareFilter"}static get _instanceOfKeys(){return[...ze._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(ie.Compare,e,t),this.filterType=ie.Compare,this.rightExpression=s?.clone()}static fromJson(e,t,s){return new Ne(e.comparisonType,s.fromJson(e.leftExpression,t),s.fromJson(e.rightExpression,t))}clone(){const e=new Ne(this.comparisonType,this.leftExpression,this.rightExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpression:this.serializeItem(this.rightExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightExpression._getUsedColumns()]}}var ne;(function(i){i[i.Between=0]="Between",i[i.Contain=11]="Contain",i[i.End_with=13]="End_with",i[i.Equal=3]="Equal",i[i.Exists=15]="Exists",i[i.Greater=7]="Greater",i[i.Greater_or_equal=8]="Greater_or_equal",i[i.Is_not_null=2]="Is_not_null",i[i.Is_null=1]="Is_null",i[i.Less=5]="Less",i[i.Less_or_equal=6]="Less_or_equal",i[i.Not_contain=12]="Not_contain",i[i.Not_end_with=14]="Not_end_with",i[i.Not_equal=4]="Not_equal",i[i.Not_exists=16]="Not_exists",i[i.Not_start_with=10]="Not_start_with",i[i.Start_with=9]="Start_with"})(ne||(ne={}));var Ce;(function(i){i[i.SchemaColumn=0]="SchemaColumn",i[i.Function=1]="Function",i[i.Parameter=2]="Parameter",i[i.SubQuery=3]="SubQuery",i[i.ArithmeticOperation=4]="ArithmeticOperation"})(Ce||(Ce={}));class Ge{static{this._instanceOfKey="devkit_BaseExpression"}static get _instanceOfKeys(){return[this._instanceOfKey]}static[Symbol.hasInstance](e){return(e?.constructor?._instanceOfKeys??[]).includes(this._instanceOfKey)}constructor(e){this.isBlock=!1,this.isBlock=e?.isBlock}static fromJson(e,t,s){throw new Error(`fromJson not supported on expression type ${this.constructor.name}`)}serializeItem(e){return typeof e.toJson=="function"?e.toJson():(0,de.classToPlain)(e,{exposeUnsetFields:!1,excludePrefixes:["_"]})}toJson(){return(0,de.classToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class se extends Ge{static{this._instanceOfKey="devkit_ColumnExpression"}static get _instanceOfKeys(){return[...Ge._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Ce.SchemaColumn,this.columnPath=e?.columnPath}static fromJson(e){return new se({columnPath:e.columnPath})}clone(){return new se(this)}_getUsedColumns(){return[{path:this.columnPath}]}}function Pd(i){return i.getFullYear()<1970}function Dd(i){const e=i.getTimezoneOffset()*6e4;return new Date(i.getTime()-e).toISOString().slice(0,-1)}function Td(i){const e=i.getFullYear(),t=Cr(i.getMonth()+1),s=Cr(i.getDate()),r=Cr(i.getHours()),n=Cr(i.getMinutes()),a=Cr(i.getSeconds()),u=Nd(i.getMilliseconds());return`${e}-${t}-${s}T${r}:${n}:${a}.${u}`}function Cr(i){return String(i).padStart(2,"0")}function Nd(i){return String(i).padStart(3,"0")}function sa(i){if(!(i instanceof Date))throw new TypeError;return Pd(i)?Td(i):Dd(i)}function lu(i){return`"${sa(i)}"`}class ae extends Ge{static{this._instanceOfKey="devkit_ParameterExpression"}static get _instanceOfKeys(){return[...Ge._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Ce.Parameter;const t=e?.value;if(t instanceof Date){const s=new Date;s.setTime(t.getTime()),this.value=s}else t?this.value=typeof t=="object"?{...t}:t:this.value=t;this.dataValueType=e?.dataValueType??A.r.Text,this.parameter={dataValueType:this.dataValueType,...this._getParameterValueMetadata()}}static fromJson(e){return new ae(e.parameter)}_convertStringToBlobArray(e){const t=[];let s=0;for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);n<128?t[s++]=String.fromCharCode(n):n<2048?(t[s++]=String.fromCharCode(n>>6|192),t[s++]=String.fromCharCode(n&63|128)):(t[s++]=String.fromCharCode(n>>12|224),t[s++]=String.fromCharCode(n>>6&63|128),t[s++]=String.fromCharCode(n&63|128))}return t}_getParameterValueMetadata(){return this.dataValueType===A.r.Blob?{arrayValue:this.value?this._convertStringToBlobArray(this.value):[]}:this.value instanceof Date?{value:lu(this.value)}:{value:this.value}}clone(){return new ae(this)}_getUsedColumns(){return[]}}(0,h.__decorate)([(0,de.Exclude)(),(0,h.__metadata)("design:type",Object)],ae.prototype,"value",void 0),(0,h.__decorate)([(0,de.Exclude)(),(0,h.__metadata)("design:type",Number)],ae.prototype,"dataValueType",void 0);class Tm{}const du=new c.InjectionToken("ContextService");var Oe;(function(i){i.ViewElement="viewElement",i.Page="page"})(Oe||(Oe={}));var Z;(function(i){i.OwnAttribute="Own",i.ForwardReferenceAttribute="ForwardReference",i.BackReferenceAttribute="BackReference",i.AggregationAttribute="Aggregation",i.FunctionAttribute="Function"})(Z||(Z={}));var hu;(function(i){i[i.General=0]="General",i[i.Advanced=1]="Advanced",i[i.None=2]="None"})(hu||(hu={}));var gs;(function(i){i[i.EntitySchema=3]="EntitySchema",i[i.ClientUnitSchema=4]="ClientUnitSchema"})(gs||(gs={}));class xd{get closed(){return this._closed}constructor(e){this._initialTeardown=e,this._closed=!1}unsubscribe(){this._closed||(this._closed=!0,(0,P.isFunction)(this._initialTeardown)&&this._initialTeardown())}}var Ar;(function(i){i.PTP="PTPMsg",i.BROADCAST="BroadcastMsg",i.SERVER="ServerMsg"})(Ar||(Ar={}));var Vd=_(52874);const Od=new c.InjectionToken("MessageChannelAccessTokenFactory");var pu=_(66736);class vr{constructor(e){this._zone=e,this._message$=new o.Subject}init(e,t){return this._zone.runOutsideAngular(()=>{const s=t?{accessTokenFactory:t,withCredentials:!0}:void 0;return this._connection=new pu.HubConnectionBuilder().withUrl(e,s).withAutomaticReconnect().withHubProtocol(new pu.JsonHubProtocol).build(),this._connection.on("ServerMessage",r=>this._zone.run(()=>this._message$.next(r))),(0,o.from)(this._connection.start())})}sendMessage(e){return(0,o.from)(this._connection.send("SendMessage",e))}getMessages(){return this._message$}ngOnDestroy(){this._connection.off("ServerMessage"),this._message$.complete(),this._connection.stop().then()}static{this.\u0275fac=function(t){return new(t||vr)(c.\u0275\u0275inject(c.NgZone))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:vr,factory:vr.\u0275fac,providedIn:"root"})}}var kd=_(5766);const Ld=1e3,mu=3e4,fu=1e4,gu="ping",ra="pong";class Er{constructor(e){this._ngZone=e}_createHeartbeatRequestMessage(){return{Id:(0,j.qv)(),Header:{Sender:"ConsoleCommand",BodyTypeName:"System.String"},Body:gu}}_isHeartbeatRequestMessage(e){const t=e.Header?.Sender==="ConsoleCommand",s=e.Body===gu;return t&&s}_isHeartbeatResponseMessage(e){const t=e.Header?.Sender==="CommandService",s=e.Body===ra;return t&&s}startHeartbeat(e){this.stopHeartbeat(),this._ngZone.runOutsideAngular(()=>{console.log(`WS-Heartbeat: connection ping scheduled for every [${mu/1e3}] sec`);const t=(0,o.timer)(Ld,mu).pipe((0,o.tap)(()=>{e.next(this._createHeartbeatRequestMessage())}),(0,o.concatMap)(()=>(0,o.race)(e.pipe((0,o.filter)(s=>this._isHeartbeatResponseMessage(s)),(0,o.take)(1),(0,o.map)(s=>s.Body)),(0,o.of)("timeout").pipe((0,o.delay)(fu)))));this._subscription=t.subscribe(s=>{switch(s){case ra:console.log(`WS-Heartbeat: Server responded with: ${ra}`);break;case"timeout":console.error(`WS-Heartbeat: Server failed to respond in ${fu/1e3} seconds`);break}})})}stopHeartbeat(){this._subscription?.unsubscribe()}excludeHeartbeatResponses(){return(0,o.filter)(e=>!this._isHeartbeatRequestMessage(e)&&!this._isHeartbeatResponseMessage(e))}ngOnDestroy(){this.stopHeartbeat()}static{this.\u0275fac=function(t){return new(t||Er)(c.\u0275\u0275inject(c.NgZone))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Er,factory:Er.\u0275fac,providedIn:"root"})}}const _u=[1,2e3,5e3,1e4,2e4,...Array(10).fill(3e4)],Bd=_u.length;class Mr{constructor(e){this._heartbeatService=e,this._reconnectAttempts=0,this._webSocketCreated$=new o.ReplaySubject(1),this._reconnected$=new o.Subject,this._isInitialConnection=!0}get reconnected$(){return this._reconnected$.asObservable()}_maxReconnectAttemptsReached(){return this._reconnectAttempts>=Bd}_resetReconnectAttempts(){this._reconnectAttempts=0}_getWebSocketUrl(){var e=this;return(0,S.A)(function*(){const t=yield e._accessTokenFactory?.();return t?`${e._serverUrl}?access_token=${encodeURIComponent(t)}`:e._serverUrl})()}_scheduleReconnectionAttempt(e){if(this._maxReconnectAttemptsReached()){console.error("WebSocket: Max reconnect attempts reached",e);return}const t=_u[this._reconnectAttempts];setTimeout(()=>{this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!0}).catch(console.error),this._reconnectAttempts++},t)}_handleWebSocketClosed(e){this._heartbeatService.stopHeartbeat(),this._scheduleReconnectionAttempt(e)}_createAndConnectWebSocketAsync(e){var t=this;return(0,S.A)(function*(){let s;try{s=yield t._getWebSocketUrl()}catch(r){throw e.reconnectOnAccessTokenFactoryError&&t._scheduleReconnectionAttempt(r),r}return new Promise(r=>{t._webSocket$=(0,kd.webSocket)({url:s,openObserver:{next:()=>{console.log(`Websocket channel opened for url: ${t._serverUrl}`),t._heartbeatService.startHeartbeat(t._webSocket$),t._resetReconnectAttempts(),t._isInitialConnection||(console.log("WebSocket reconnected successfully"),t._reconnected$.next()),t._isInitialConnection=!1,r()}}}),t._webSocketSubscription?.unsubscribe(),t._webSocketSubscription=t._webSocket$.subscribe({error:n=>t._handleWebSocketClosed(n),complete:()=>t._handleWebSocketClosed()}),t._webSocketCreated$.next(t._webSocket$)})})()}_subscribeToSocketMessages(e,t){return e.pipe(this._heartbeatService.excludeHeartbeatResponses()).subscribe({next:s=>t.next(s),error:()=>{this._maxReconnectAttemptsReached()&&t.error(new Error("Max reconnect attempts reached"))}})}init(e,t){return this._serverUrl=e,this._accessTokenFactory=t,(0,o.from)(this._createAndConnectWebSocketAsync({reconnectOnAccessTokenFactoryError:!1}))}sendMessage(e){return new o.Observable(t=>{this._webSocket$.next(e),t.next(),t.complete()})}getMessages(){return new o.Observable(e=>{let t;const s=this._webSocketCreated$.subscribe(r=>{t?.unsubscribe(),t=this._subscribeToSocketMessages(r,e)});return()=>{t.unsubscribe(),s.unsubscribe()}})}ngOnDestroy(){this._heartbeatService.stopHeartbeat(),this._webSocket$?.complete(),this._webSocketSubscription?.unsubscribe(),this._reconnected$.complete()}static{this.\u0275fac=function(t){return new(t||Mr)(c.\u0275\u0275inject(Er))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Mr,factory:Mr.\u0275fac,providedIn:"root"})}}class ke{static create(e){const t=new ke;return Object.assign(t,e),t}get isDebugEnabled(){return!!window.Terrasoft?.isDebug}static{this.\u0275fac=function(t){return new(t||ke)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ke,factory:ke.\u0275fac,providedIn:"root"})}}var na=_(93248),ia;(function(i){i.Production="production",i.PreProduction="pre-production",i.Development="development"})(ia||(ia={}));const yu=ke.create({serviceUrl:"",clientConnectionClassName:""}),Nm={provide:ke,useFactory:()=>yu};let Rr=class ki{constructor(e,t,s){this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=s,this._serviceEndpoint="ServiceModel/ApplicationInfoService.svc/"}_initApplicationInfo(){const e=this._serviceEndpoint+"GetApplicationInfo";this._applicationInfoObservable$=this._cacheManager.executeWithCache(na.HO,na.oy,this._httpClient.post(e,null)).pipe(this._measurePerformanceService.measure$("ApplicationInfoService: load application info with cache"),(0,l.map)(t=>{const s=t?.applicationInfo,r=ke.create(s);return Object.assign(yu,r),t}),(0,l.shareReplay)({bufferSize:1,refCount:!1})),this._applicationInfoObservable$.subscribe()}loadApplicationInfo(){return this._applicationInfoObservable$||this._initApplicationInfo(),this._applicationInfoObservable$}loadApplicationResources(){const e=this._serviceEndpoint+"GetApplicationResources";return this._cacheManager.executeWithCache(na.HO,"AppResources",this._httpClient.post(e,null))}loadSysValues(){return this.loadApplicationInfo().pipe((0,l.map)(e=>e?.applicationInfo?.sysValues))}getCoreVersion(){return this._coreVersion?(0,o.of)(this._coreVersion):this.loadSysValues().pipe((0,o.tap)(e=>this._coreVersion=e?.coreVersion),(0,l.map)(()=>this._coreVersion))}getIsProductionEnvironment(){return(this._environmentType?(0,o.of)(this._environmentType):this.loadSysValues().pipe((0,o.tap)(t=>this._environmentType=t?.environmentType),(0,l.map)(()=>this._environmentType))).pipe((0,l.map)(t=>t===ia.Production))}static{this.\u0275fac=function(t){return new(t||ki)(c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(ge.G),c.\u0275\u0275inject(te.g))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ki,factory:ki.\u0275fac,providedIn:"root"})}};Rr=(0,h.__decorate)([(0,O.op)({requestType:"crt.SysValuesService"}),(0,h.__metadata)("design:paramtypes",[N.HttpClient,ge.G,te.g])],Rr);const xm={provide:c.APP_INITIALIZER,useFactory:i=>()=>i.loadApplicationInfo(),deps:[Rr],multi:!0};let $n=class Li{get reconnected$(){return this.msgChannel?.reconnected$||o.EMPTY}constructor(e,t,s,r){this.injector=r,this._destroyed$=new o.Subject,this.init$=new o.ReplaySubject(1),this.messageEvent$=new o.Subject,!e.clientConnectionClassName||e.clientConnectionClassName===""?t.loadApplicationInfo().subscribe(n=>{this._initialize(n.applicationInfo,s)}):this._initialize(e,s)}_initialize(e,t){this.msgChannel=this._getChannel(e.clientConnectionClassName),this._initChannel(e.serviceUrl,t)}_getChannel(e){switch(e){case"Terrasoft.WebSocketChannel":return this.injector.get(Mr);case"Terrasoft.SignalRChannel":return this.injector.get(vr)}}_buildMessageEvent(e){let t;if(e.Body&&typeof e.Body=="string")try{t=JSON.parse(e.Body)}catch(s){return(0,c.isDevMode)()&&console.warn(`MessageChannelService. Parse error: ${s}`),null}else e.Body&&typeof e.Body=="object"&&(t=e.Body);return{header:{sender:e?.Header?.Sender,bodyTypeName:e?.Header?.BodyTypeName},body:t,id:e.Id}}_subscribeToMsgChannel(){this.msgChannel.getMessages().pipe((0,l.takeUntil)(this._destroyed$)).subscribe(e=>{const t=this._buildMessageEvent(e);t&&this.messageEvent$.next(t)})}_initChannel(e,t){this.msgChannel.init(e,t).subscribe({complete:()=>{this.init$.next(this.msgChannel),this._subscribeToMsgChannel()}})}_sendMessageInternal(e,t,s){const r={Id:Vd.Guid.create().toString(),Header:{Sender:e,BodyTypeName:"System.String",ChannelType:t},Body:JSON.stringify(s)};return this.init$.pipe((0,o.take)(1),(0,l.switchMap)(()=>this.msgChannel.sendMessage(r)))}getMessages(e){return H.checkArgumentEmpty("sender",e),this.messageEvent$.pipe((0,l.filter)(t=>t.header.sender===e))}subscribe(e,t){H.checkArgumentEmpty("sender",e),H.checkArgumentEmpty("callback",t);const s=this.getMessages(e).subscribe(t);return Promise.resolve(new xd(()=>s.unsubscribe()))}sendMessage(e,t,s){let r,n;const a=!!s;a?(r=e,n=t,H.checkStringIsNotEmpty("sender",r),H.checkEnumOutOfRange("channelType",s,Ar)):(n=e,r=t,H.checkArgumentEmpty("channelType",r),H.checkEnumOutOfRange("channelType",r,Ar));const u=this._sendMessageInternal(r,s,n);return a?(0,o.firstValueFrom)(u):u}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.init$.complete(),this.messageEvent$.complete()}static{this.\u0275fac=function(t){return new(t||Li)(c.\u0275\u0275inject(ke),c.\u0275\u0275inject(Rr),c.\u0275\u0275inject(Od,8),c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Li,factory:Li.\u0275fac,providedIn:"root"})}};$n=(0,h.__decorate)([(0,O.op)({requestType:"crt.MessageChannelService"}),(0,h.__metadata)("design:paramtypes",[ke,Rr,Function,c.Injector])],$n);const Fd=new c.InjectionToken("Represents a list of schema change message predicates"),jd=new c.InjectionToken("Represents a list of schema remove message predicates"),$d=new c.InjectionToken("Represents a list of schema rights message predicates");class Ht{constructor(e,t,s,r,n){this._messageChannelService=e,this._broadcastChannelFactory=t,this._changePredicates=s,this._removePredicates=r,this._rightsPredicates=n,this._destroyed$=new o.Subject,this.schemaChanged$=new o.Subject,this.schemaRemoved$=new o.Subject,this.rightsChanged$=new o.Subject,this.requireJsChanged$=new o.Subject,this._subscribeMessageChannelEvent()}_getSchemaType(e){let t;switch(e){case"ClientUnitSchemaManager":t=gs.ClientUnitSchema;break;case"EntitySchemaManager":t=gs.EntitySchema;break}return t}_processMessage(e,t){const s=e.body,r=this._getSchemaType(s.ManagerName);r&&t.next({name:s.Name,uId:s.UId,schemaType:r,userId:s.UserId,isNew:s.IsNew,extendParent:s.ExtendParent})}_subscribeMessageChannelEvent(){this._messageChannelService.messageEvent$.pipe((0,l.filter)(e=>this._changePredicates?.some(t=>t(e))),(0,l.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaChanged$)),this._messageChannelService.messageEvent$.pipe((0,l.filter)(e=>this._removePredicates?.some(t=>t(e))),(0,l.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.schemaRemoved$)),this._messageChannelService.messageEvent$.pipe((0,l.filter)(e=>this._rightsPredicates?.some(t=>t(e))),(0,l.takeUntil)(this._destroyed$)).subscribe(e=>this._processMessage(e,this.rightsChanged$)),this._broadcastChannelFactory.createInstance("schema-requirejs-path-changed").messages$.subscribe(e=>this._processMessage({body:e},this.requireJsChanged$))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete(),this.schemaChanged$.complete()}static{this.\u0275fac=function(t){return new(t||Ht)(c.\u0275\u0275inject($n),c.\u0275\u0275inject(O.Vx),c.\u0275\u0275inject(Fd,8),c.\u0275\u0275inject(jd,8),c.\u0275\u0275inject($d,8))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ht,factory:Ht.\u0275fac,providedIn:"root"})}}class Ir{constructor(e){this.schemaChangeListener=e,this._repository=new Map,this._uIdMap=new Map,this._destroyed$=new o.Subject,this.schemaChangeListener.schemaChanged$.pipe((0,l.filter)(t=>t.schemaType===this.provider.schemaType),(0,l.takeUntil)(this._destroyed$)).subscribe(t=>this.clearSchemaCacheByUId(t.uId))}add(e){this._repository.set(e.name,e),this._uIdMap.set(e.uId,e.name)}getCachedSchema(e){return this._repository.get(e)}getIsSchemaCached(e){return this._repository.has(e)}getCachedSchemesNames(){return[...this._repository.keys()]}getSchemaByName(e){const t=this.getCachedSchema(e);return t?(0,o.of)(t):this.provider.getSchemaByName(e).pipe((0,l.tap)(s=>this.add(s)))}getSchemaByUId(e){const t=this._uIdMap.get(e),s=t&&this.getCachedSchema(t);return s?(0,o.of)(s):this.provider.getSchemaByUId(e).pipe((0,l.tap)(r=>this.add(r)))}clearSchemaCacheByName(e){const t=this.getCachedSchema(e);t&&this._uIdMap.delete(t.uId),this._repository.delete(e)}clearSchemaCacheByUId(e){const t=this._uIdMap.get(e);t&&this._repository.delete(t),this._uIdMap.delete(e)}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||Ir)(c.\u0275\u0275inject(Ht))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ir,factory:Ir.\u0275fac})}}class Un{static getPathItemInfo(e){const s=/\[([\w-]+):([\w-]+):?([\w-]*)]$/g.exec(e);if(s){const r=s[1],n=s[2],a=s[3];return{isBackReference:!0,referenceSchemaName:r,referenceSchemaColumnName:n,columnName:a}}return{isBackReference:!1,columnName:e}}static getLastBackwardSchemaNameByColumnPath(e){let t="";return e?.split(".").reverse()?.forEach(r=>{t||r.includes("[")&&(t=this.getPathItemInfo(r).referenceSchemaName)}),t}static getLastForwardColumnPath(e){const t=e?.split(".")||[],s=t.map(r=>r.includes("[")).lastIndexOf(!0);return s===-1?e:t.slice(s+1).join(".")}}var qn;(function(i){i.List="List",i.SelectionWindow="SelectionWindow"})(qn||(qn={}));class aa{get isLookupType(){return this.dataValueType?this.dataValueType===A.r.Lookup:!1}constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.columnCaptionPath=e.columnCaptionPath,this.dataValueType=e.dataValueType,this.usageType=e.usageType,this.referenceSchemaUId=e.referenceSchemaUId,this.referenceSchemaName=e.referenceSchemaName,this.isRequired=e.isRequired,this.isValueCloneable=e.isValueCloneable,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.defaultValueSchema=e.defaultValueSchema,this.lookupMode=e.lookupMode,this.useSeconds=e.useSeconds)}}class Ud{constructor(e){e&&(this.uId=e.uId,this.name=e.name,this.caption=e.caption,this.extendParent=e.extendParent,this.packageUId=e.packageUId)}}class bu extends Ud{getPrimaryColumn(){return this.primaryColumnUId&&this.columns?.find(e=>e.uId===this.primaryColumnUId)}getPrimaryDisplayColumn(){return this.primaryDisplayColumnUId&&this.columns?.find(e=>e.uId===this.primaryDisplayColumnUId)}getPrimaryColorColumn(){return this.primaryColorColumnUId&&this.columns?.find(e=>e.uId===this.primaryColorColumnUId)}getHierarchyColumn(){return this.hierarchyColumnUId&&this.columns?.find(e=>e.uId===this.hierarchyColumnUId)}getCreatedOnColumn(){return this.createdOnColumnUId&&this.columns?.find(e=>e.uId===this.createdOnColumnUId)}getCreatedByColumn(){return this.createdByColumnUId&&this.columns?.find(e=>e.uId===this.createdByColumnUId)}getModifiedOnColumn(){return this.modifiedOnColumnUId&&this.columns?.find(e=>e.uId===this.modifiedOnColumnUId)}getModifiedByColumn(){return this.modifiedByColumnUId&&this.columns?.find(e=>e.uId===this.modifiedByColumnUId)}}var qd=_(61843),We=_(23092),Je;(function(i){i[i.None=0]="None",i[i.Const=1]="Const",i[i.Settings=2]="Settings",i[i.SystemValue=3]="SystemValue",i[i.Sequence=4]="Sequence"})(Je||(Je={}));var Hn=_(47149);class Hd{static _getDefaultValue(e){if(!e)return null;if(e.source===Je.Sequence)return{valueSourceType:Je.Sequence,value:"Sequence",sequencePrefix:e.sequencePrefix,sequenceNumberOfChars:e.sequenceNumberOfChars};if(e.source===Je.Const){const t=e.value,s=typeof t=="string"?t:t.value;return{valueSourceType:Je.Const,value:s,valueSource:s,sequenceNumberOfChars:0}}return e.source===Je.Settings?{valueSourceType:Je.Settings,value:e.calculatedValue,valueSource:e.value,sequenceNumberOfChars:0}:e.source===Je.SystemValue?{valueSourceType:Je.SystemValue,value:e.calculatedValue,valueSource:e.sourceValue,sequenceNumberOfChars:0}:{valueSourceType:e.source,value:null,sequenceNumberOfChars:0}}static _getPrimaryDisplayColorColumnUId(e){if(!e.primaryColorColumnName)return null;const t=Object.values(e.columns).find(s=>s.name===e.primaryColorColumnName);if(!t)throw new Error(`Primary color column set in object ${e.name} but column ${e.primaryColorColumnName} does not exist`);return t?.uId}static map(e,t){const s={};return Object.entries(e.columns).forEach(([,r])=>{const n=r,a=n.dataValueTypeName==="Binary"?"Blob":n.dataValueTypeName,u=Object.entries(Hn.Q).find(([,g])=>g.name===a),d=u?Number(u[0]):n.dataValueType,p=this._getDefaultValue(n.defaultValue);s[n.uId]={uId:n.uId,name:n.name,caption:{[t]:n.caption},dataValueType:d,isInherited:!!n.isInherited,isRequired:!!n.isRequired,isValueCloneable:!!n.isValueCloneable,usageType:n.usageType,referenceSchemaName:n.referenceSchemaName,isMasked:!!n.isMasked,isFormatValidated:!!n.isFormatValidated,isSimpleLookup:!!n.isSimpleLookup,isSensitiveData:!!n.isSensitiveData,isValueMasked:!!n.isValueMasked,valueMaskingSettings:n.valueMaskingSettings,useSeconds:!!n.useSeconds,defValue:p}}),{administratedByOperations:e.administratedByOperations,administratedByRecords:e.administratedByRecords,useMasterRecordRights:e.useMasterRecordRights,masterRecordSchemaName:e.masterRecordSchemaName,primaryColumnUId:e.primaryColumn?.uId,primaryDisplayColumnUId:e.primaryDisplayColumn?.uId,primaryColorColumnUId:this._getPrimaryDisplayColorColumnUId(e),hierarchyColumnUId:e.hierarchyColumnUId,createdOnColumnUId:e.createdOnColumnUId,createdByColumnUId:e.createdByColumnUId,modifiedOnColumnUId:e.modifiedOnColumnUId,modifiedByColumnUId:e.modifiedByColumnUId,uId:e.uId,name:e.name,caption:{[t]:e.caption},columns:{Items:s},isVirtual:!!e.isVirtual,isDBView:!!e.isDBView,administratedByColumns:!!e.administratedByColumns,description:{[t]:e.description},parentUId:e.parentUId,isTrackChangesInDB:!!e.isTrackChangesInDB,extendParent:!!e.extendParent}}}const Kd="runtime-entity-schema";let oa=class{constructor(e){this._window=e}_getItems(e,t=[]){var s=this;let r=[];const n=[...t];return new Promise(a=>{this._window.require(e,(0,S.A)(function*(...u){r=yield Promise.all(u.map(d=>s.map(d))),a({schemes:r,notFoundSchemes:n})}),u=>{const d=u.requireModules??[];n.push(...d),e=e.filter(p=>!d.includes(p)),e.length===0&&a({schemes:r,notFoundSchemes:n}),a(this._getItems(e,n))})})}map(e){return Promise.resolve(e)}get(e){var t=this;return new Promise(s=>{this._window.require([e],function(){var r=(0,S.A)(function*(n){const a=yield t.map(n);s(a)});return function(n){return r.apply(this,arguments)}}(),()=>{s(null)})})}getItems(e){return this._getItems(e,[])}};oa=(0,h.__decorate)([(0,h.__param)(0,(0,c.Inject)(O.ZP)),(0,h.__metadata)("design:paramtypes",[Object])],oa);class Kt{constructor(e,t){this._userInfo=e,this._httpClient=t}_getServiceUrlSspPart(){return this._userInfo.isSSP?"ssp/":""}_getDataServiceUrlWithSspPart(){return`DataService/${this._getServiceUrlSspPart()}`}getSchemaDesignerServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/SchemaDesignerRequest"}getRuntimeEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemaRequest"}getEntitySchemaServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/EntitySchemaRequest"}getRuntimeEntitySchemeServiceEndpoint(){return this._getDataServiceUrlWithSspPart()+"json/SyncReply/RuntimeEntitySchemesRequest"}getEntity(e){return(0,o.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemaServiceEndpoint(),{name:e}))}getEntities(e){return(0,o.lastValueFrom)(this._httpClient.post(this.getRuntimeEntitySchemeServiceEndpoint(),e))}static{this.\u0275fac=function(t){return new(t||Kt)(c.\u0275\u0275inject(We.oq),c.\u0275\u0275inject(N.HttpClient))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Kt,factory:Kt.\u0275fac,providedIn:"root"})}}const ca=["SysSettings"];class wr extends oa{constructor(e,t,s,r,n,a,u){super(e),this._featureValues=t,this._userInfo=s,this._entityHttpService=r,this._cacheManager=n,this._schemaChangeListener=a,this._measurePerformanceService=u,this._destroyed$=new o.Subject,this._schemaChangeListener.schemaChanged$.pipe((0,l.filter)(d=>d.schemaType===gs.EntitySchema),(0,l.switchMap)(d=>(0,o.from)(this._clearSchemaCacheByName(d.name))),(0,l.takeUntil)(this._destroyed$)).subscribe()}get _entitySchemaCache(){return this._cacheManager.getOrCreate({name:Kd,type:z.P.Memory})}_clearSchemaCacheByName(e){var t=this;return(0,S.A)(function*(){t._featureValues.DisableRuntimeEntitySchemaCaching||(yield t._measurePerformanceService.measureCallback("EntityRequireService: clear schema cache",(0,S.A)(function*(){yield(yield t._entitySchemaCache).delete(e)})))})()}_getLookupEntities(e){const t=e.flatMap(r=>Object.values(r.columns.Items).filter(n=>n.dataValueType===A.r.Lookup&&n.referenceSchemaName&&!e.find(a=>a.name===n.referenceSchemaName)).map(n=>n.referenceSchemaName)),s=[...new Set(t)];return this.getItems(s)}_getReferenceEntityNameFromBackReferencePath(e){return Un.getPathItemInfo(e).referenceSchemaName}_getReferenceSchemaName(e,t){const s=this._getReferenceEntityNameFromBackReferencePath(e);let r;if(s)r=s;else{const n=Object.entries(t.columns.Items).find(([,u])=>u.name===e);if(!n)throw new Error(`Can't find column '${e}' in EntitySchema '${t.name}'`);const[,a]=n;r=a.referenceSchemaName}return r}_loadSchemasByPath(e,t,s){var r=this;return(0,S.A)(function*(){const n=s.find(C=>C.name===e);if(!n)return{schemas:[],notFoundSchemas:[e]};const a=[...t],u=a.shift(),d=r._getReferenceSchemaName(u,n);if(!d)return{schemas:[],notFoundSchemas:[]};let p=s.find(C=>C.name===d);if(!p)try{if(p=yield r.get(d),p)s.push(p);else return{schemas:[],notFoundSchemas:[d]}}catch{return{schemas:[],notFoundSchemas:[d]}}const g=a.length?yield r._loadSchemasByPath(p.name,a,s):{schemas:[],notFoundSchemas:[]};return{schemas:[p,...g.schemas],notFoundSchemas:g.notFoundSchemas}})()}_getForwardReferenceSchemas(e,t){var s=this;return(0,S.A)(function*(){const r=yield Promise.all(e.filter(n=>n.forwardReferencePaths).flatMap(n=>n.forwardReferencePaths.flatMap(a=>s._loadSchemasByPath(n.name,a.split("."),t))));return{schemes:r.flatMap(n=>n.schemas),notFoundSchemes:r.flatMap(n=>n.notFoundSchemas)}})()}_getEntitiesToLoadLookups(e,t){return t.schemes.filter(s=>e.requests.find(r=>r.loadLookupColumns===!0&&r.name===s.name))}map(e){return Promise.resolve(Hd.map(e,this._userInfo.cultureInfo.sysCultureName))}get(e){var t=()=>super.get,s=this;return(0,S.A)(function*(){let r;return s._featureValues.DisableRuntimeEntitySchemaCaching||(yield s._measurePerformanceService.measureCallback("EntityRequireService: get schema from cache",(0,S.A)(function*(){const a=yield(yield s._entitySchemaCache).get(e);if(a)return a}))),ca.includes(e)?r=(yield s._entityHttpService.getEntity(e)).schema:r=yield t().call(s,e),s._featureValues.DisableRuntimeEntitySchemaCaching||(yield s._measurePerformanceService.measureCallback("EntityRequireService: set schema to cache",(0,S.A)(function*(){yield(yield s._entitySchemaCache).set(e,r)}))),r})()}getItems(e){var t=()=>super.getItems,s=this;return(0,S.A)(function*(){const r=[...new Set(e)];let n=r,a=[];s._featureValues.DisableRuntimeEntitySchemaCaching||(yield s._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",(0,S.A)(function*(){const I=yield s._entitySchemaCache;a=(yield s._measurePerformanceService.measureCallback("EntityRequireService: get schemas from cache",()=>Promise.all(r.map(U=>I.get(U))))).filter(U=>!!U);const X=a.map(U=>U.name);if(n=r.filter(U=>!X.includes(U)),n.length===0)return{schemes:[...a],notFoundSchemes:[]}})));const u=n.filter(I=>ca.includes(I)),d=n.filter(I=>!ca.includes(I));let p={success:!0,schemes:[],notFoundSchemes:[]};if(u.length!==0){const I={requests:u.map(W=>({name:W,loadLookupColumns:!1}))};p=yield s._entityHttpService.getEntities(I)}const g=yield t().call(s,d),C=[...g.schemes,...p.schemes];return s._featureValues.DisableRuntimeEntitySchemaCaching||(yield s._measurePerformanceService.measureCallback("EntityRequireService: set schemas to cache",(0,S.A)(function*(){yield(yield s._entitySchemaCache).bulkSet((0,P.uniqBy)(C,"name").map(W=>({key:W.name,value:W})))}))),{schemes:[...C,...a],notFoundSchemes:[...g.notFoundSchemes,...p.notFoundSchemes]}})()}getEntity(e){var t=this;return(0,S.A)(function*(){const s=yield t.get(e);return{success:!!s,schema:s}})()}getEntities(e){var t=this;return(0,S.A)(function*(){const s=e.requests.map(d=>d.name),r=yield t.getItems(s),n=t._getEntitiesToLoadLookups(e,r),a=yield t._getLookupEntities(n),u=yield t._getForwardReferenceSchemas(e.requests,[...r.schemes,...a.schemes]);return{success:!0,schemes:[...r.schemes,...a.schemes,...u.schemes],notFoundSchemes:[...r.notFoundSchemes,...a.notFoundSchemes,...u.notFoundSchemes]}})()}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||wr)(c.\u0275\u0275inject(O.ZP),c.\u0275\u0275inject(F),c.\u0275\u0275inject(We.oq),c.\u0275\u0275inject(Kt),c.\u0275\u0275inject(ge.G),c.\u0275\u0275inject(Ht),c.\u0275\u0275inject(te.g))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:wr,factory:wr.\u0275fac,providedIn:"root"})}}class Pr{constructor(e,t,s,r){this.httpClient=e,this._entityRequire=t,this._entityHttp=s,this._featureValues=r}_useRequire(){return this._featureValues?.UseRequireEntitySchema8x??!1}getEntity(e){var t=this;return(0,S.A)(function*(){return t._useRequire()?t._entityRequire.getEntity(e):t._entityHttp.getEntity(e)})()}getEntities(e){var t=this;return(0,S.A)(function*(){return t._useRequire()?t._entityRequire.getEntities(e):t._entityHttp.getEntities(e)})()}static{this.\u0275fac=function(t){return new(t||Pr)(c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(wr),c.\u0275\u0275inject(Kt),c.\u0275\u0275inject(F,8))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Pr,factory:Pr.\u0275fac,providedIn:"root"})}}class At{constructor(e,t,s,r){this.httpClient=e,this._userInfo=t,this._schemaLoader=s,this._entityHttp=r,this._entitySchemaServiceRequests=new Map,this._destroyed$=new o.Subject}_convertToEntitySchema(e){const t=new bu;return t.uId=e.uId,t.name=e.name,t.caption=this._getCaptionElement(e),t.extendParent=e.extendParent,t.packageUId=e.packageUId,t.administratedByColumns=e.administratedByColumns,t.administratedByOperations=e.administratedByOperations,t.administratedByRecords=e.administratedByRecords,t.description=e.description,t.isDBView=e.isDBView,t.isTrackChangesInDB=e.isTrackChangesInDB,t.isVirtual=e.isVirtual,t.masterRecordSchemaName=e.masterRecordSchemaName,t.primaryColumnUId=e.primaryColumnUId,t.primaryDisplayColumnUId=e.primaryDisplayColumnUId,t.primaryColorColumnUId=e.primaryColorColumnUId,t.hierarchyColumnUId=e.hierarchyColumnUId,t.createdOnColumnUId=e.createdOnColumnUId,t.createdByColumnUId=e.createdByColumnUId,t.modifiedOnColumnUId=e.modifiedOnColumnUId,t.modifiedByColumnUId=e.modifiedByColumnUId,t.useMasterRecordRights=e.useMasterRecordRights,t.parentUId=e.parentUId,t.columns=Object.values(e.columns.Items).map(s=>{const r=new aa;return r.uId=s.uId,r.name=s.name,r.caption=this._getCaptionElement(s),r.dataValueType=s.dataValueType,r.usageType=s.usageType,r.referenceSchemaUId=s.referenceSchemaUId,r.referenceSchemaName=s.referenceSchemaName,r.isRequired=s.isRequired,r.isValueCloneable=s.isValueCloneable,r.isMasked=s.isMasked,r.isFormatValidated=s.isFormatValidated,r.isSensitiveData=s.isSensitiveData,r.isValueMasked=s.isValueMasked,r.valueMaskingSettings=s.valueMaskingSettings,r.defaultValueSchema=s.defValue,r.lookupMode=s.isSimpleLookup?qn.List:qn.SelectionWindow,r.useSeconds=s.useSeconds,r}),t}_getCaptionElement(e){return e.caption[this._userInfo.cultureInfo.sysCultureName]||e.caption[qd.dJ]}_createEntitySchemaColumnFromInformationObject(e){const t=new aa;return t.uId=e.columnUId,t.name=e.columnName,t.caption=e.columnCaption,t.dataValueType=e.columnDataValueType,t.usageType=e.columnUsageType,t.referenceSchemaUId=e.referenceSchemaUId,t.referenceSchemaName=e.referenceSchemaName,t.columnCaptionPath=e.columnCaptionPath,t}_getEntitySchemaFromEndpoint(e,t){return this.httpClient.post(e,t).pipe((0,l.mergeMap)(s=>s.schema?(0,o.of)({success:!0,entitySchema:this._convertToEntitySchema(s.schema)}):(0,o.throwError)({success:!1,entitySchema:null,errorInfo:s.errorInfo})))}_getEntitySchemaColumnByPath(e,t,s="."){const r=`${e}_${s}_${t}`;if(this._entitySchemaServiceRequests.has(r))return this._entitySchemaServiceRequests.get(r);const n=this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),{getSchemaColumnInformation:{entitySchemaUId:e,schemaColumnPath:t,schemaColumnCaptionPathDelimiter:s}}).pipe((0,l.tap)(({success:a})=>{if(!a)throw new Error("SchemaDesignerService request has failed")}),(0,l.map)(({getSchemaColumnInformationResponse:a})=>this._createEntitySchemaColumnFromInformationObject(a)),(0,l.tap)(()=>this._entitySchemaServiceRequests.delete(r)),(0,l.share)());return this._entitySchemaServiceRequests.set(r,n),n}_combineEntitySchemaColumnInformationRequestsWithPaths(e,t){return t.reduce((s,r)=>({...s,[r]:this._getEntitySchemaColumnByPath(e,r)}),{})}getEntitySchemaByUId(e,t){const s=`${e}_${t}`;if(this._entitySchemaServiceRequests.has(s))return this._entitySchemaServiceRequests.get(s);const r=t?this._entityHttp.getEntitySchemaServiceEndpoint():this._entityHttp.getRuntimeEntitySchemaServiceEndpoint(),n={uId:e};t&&(n.packageUId=t);const a=this._getEntitySchemaFromEndpoint(r,n).pipe((0,l.tap)(()=>this._entitySchemaServiceRequests.delete(s)),(0,l.share)());return this._entitySchemaServiceRequests.set(s,a),a}getEntitySchemaByName(e){if(this._entitySchemaServiceRequests.has(e))return this._entitySchemaServiceRequests.get(e);const t=(0,o.from)(this._schemaLoader.getEntity(e)).pipe((0,l.map)(s=>({success:s.success,entitySchema:s.schema?this._convertToEntitySchema(s.schema):null,errorInfo:s.errorInfo})),(0,l.tap)(()=>this._entitySchemaServiceRequests.delete(e)),(0,l.share)(),(0,l.catchError)(s=>(this._entitySchemaServiceRequests.delete(e),(0,o.throwError)(()=>s))));return this._entitySchemaServiceRequests.set(e,t),t}getEntitySchemes(e){const t=JSON.stringify(e);if(this._entitySchemaServiceRequests.has(t))return this._entitySchemaServiceRequests.get(t);const s=(0,o.from)(this._schemaLoader.getEntities(e)).pipe((0,l.map)(r=>({success:r.success,schemes:r.schemes.map(n=>this._convertToEntitySchema(n)),notFoundSchemes:r.notFoundSchemes})),(0,l.tap)(()=>this._entitySchemaServiceRequests.delete(t)),(0,l.share)(),(0,l.catchError)(r=>(0,o.throwError)(()=>r)));return this._entitySchemaServiceRequests.set(t,s),s}getEntitySchemaColumnsInformationByMetaPath(e,t){const s={getSchemaColumnsInformation:{entitySchemaUId:e,schemaColumnMetaPaths:t}};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),s).pipe((0,l.tap)(({success:r})=>{if(!r)throw new Error("SchemaDesignerService request is failed")}),(0,l.map)(({getSchemaColumnsInformationResponse:r})=>r.map(n=>({column:this._createEntitySchemaColumnFromInformationObject(n),columnMetaPath:n.columnMetaPath,columnPath:n.columnPath,columnCaptionPath:n.columnCaptionPath}))))}getEntitySchemaColumnsInformationByPath(e,t,s){return this._getEntitySchemaColumnByPath(e,t,s)}getEntitySchemaColumnsInformationByPathsArray(e,t){return(0,o.forkJoin)(this._combineEntitySchemaColumnInformationRequestsWithPaths(e,t))}getColumnCaptionPathByMetaPath(e){const t={getColumnCaptionPathByMetaPath:e};return this.httpClient.post(this._entityHttp.getSchemaDesignerServiceEndpoint(),t).pipe((0,l.tap)(({success:s})=>{if(!s)throw new Error("SchemaDesignerService request is failed")}),(0,l.map)(({columnCaptionPath:s})=>s))}ngOnDestroy(){this._destroyed$.next(),this._destroyed$.complete()}static{this.\u0275fac=function(t){return new(t||At)(c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(We.oq),c.\u0275\u0275inject(Pr),c.\u0275\u0275inject(Kt))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:At,factory:At.\u0275fac,providedIn:"root"})}}class Dr{constructor(e){this._entitySchemaService=e,this.schemaType=gs.EntitySchema}_getSchema(e){return e.pipe((0,l.switchMap)(t=>t.success===!0?(0,o.of)(t):(0,o.throwError)(()=>new Error(t.errorInfo?.message))),(0,l.map)(t=>t.entitySchema))}_getScheme(e){return e.pipe((0,l.switchMap)(t=>t.success===!0?(0,o.of)(t):(0,o.throwError)(()=>new Error(t.errorInfo?.message))),(0,l.map)(t=>t.schemes))}getSchemaByUId(e){const t=this._entitySchemaService.getEntitySchemaByUId(e);return this._getSchema(t).pipe((0,l.catchError)(s=>{const r=s.message||`Entity schema with UId '${e}' not found`;return console.error(r),(0,o.throwError)(()=>new Error(r))}))}getSchemaByName(e){const t=this._entitySchemaService.getEntitySchemaByName(e);return this._getSchema(t).pipe((0,l.catchError)(s=>{const r=s.message||`Entity schema with name '${e}' not found`;return console.error(r),(0,o.throwError)(()=>new Error(r))}))}getSchemes(e){const t=this._entitySchemaService.getEntitySchemes(e);return this._getScheme(t).pipe((0,l.catchError)(s=>{const r=s.message||"Entity schemas not found: "+JSON.stringify(e);return console.error(r),(0,o.throwError)(()=>new Error(r))}))}static{this.\u0275fac=function(t){return new(t||Dr)(c.\u0275\u0275inject(At))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Dr,factory:Dr.\u0275fac,providedIn:"root"})}}class rt extends Ir{constructor(e,t){super(t),this.provider=e,this.schemaChangeListener=t}_checkPath(e){if(!e||e.length===0)throw new Error("Path is null or empty")}_getEntitySchemaColumn(e,t){const s=e.columns.find(r=>r.name===t);return s||null}_findEntitySchemesByPath(e,t){this._checkPath(t);const s=[...t],r=this.getCachedSchema(e);if(!r)return null;const n=s.shift(),a=Un.getPathItemInfo(n);let u=[];if(a.isBackReference)u=this._findEntitySchemesByPath(a.referenceSchemaName,s);else{const p=this._getEntitySchemaColumn(r,a.columnName);if(s.length===0)return[r];if(!p?.isLookupType)return null;u=this._findEntitySchemesByPath(p.referenceSchemaName,s)}if(!u)return null;const d=u.filter(p=>p.name!==r.name);return[r,...d]}_getAreSchemesCached(e){for(const t of e){const s=this.getCachedSchema(t.name);if(!s)return!1;const r=s.columns.filter(a=>a.isLookupType).every(a=>this.getIsSchemaCached(a.referenceSchemaName));if(t.loadLookupColumns&&!r)return!1;const n=t.forwardReferencePaths??[];for(const a of n){const u=a.split(".");if(!this.findEntitySchemaColumnByPath(t.name,u))return!1}}return!0}_addSchemaIfNotExists(e,t){e.has(t.name)||e.set(t.name,t)}_addSchemesIfNotExists(e,t){t.forEach(s=>{this._addSchemaIfNotExists(e,s)})}_getCachedSchemes(e){const t=new Map;return e.forEach(s=>{const r=this.getCachedSchema(s.name);if(!r)return;if(this._addSchemaIfNotExists(t,r),s.loadLookupColumns){const a=r.columns.filter(u=>u.isLookupType).map(u=>this.getCachedSchema(u.referenceSchemaName)).filter(u=>u!=null);this._addSchemesIfNotExists(t,a)}(s.forwardReferencePaths??[]).forEach(a=>{const u=a.split("."),d=this._findEntitySchemesByPath(s.name,u);d&&this._addSchemesIfNotExists(t,d)})}),[...t.values()]}getSchemes(e){if(this._getAreSchemesCached(e))return(0,o.of)(this._getCachedSchemes(e));const t={requests:e,cachedSchemesNames:this.getCachedSchemesNames()};return this.provider.getSchemes(t).pipe((0,l.tap)(s=>s.forEach(r=>this.add(r))),(0,l.map)(()=>this._getCachedSchemes(e)))}findEntitySchemaByPath(e,t){this._checkPath(t);const s=this.getCachedSchema(e);if(!s)return null;const r=[...t],n=r.shift(),a=Un.getPathItemInfo(n);if(a.isBackReference)return this.findEntitySchemaByPath(a.referenceSchemaName,r);const u=this._getEntitySchemaColumn(s,a.columnName);return u?r.length===0?s:u?.isLookupType?this.findEntitySchemaByPath(u.referenceSchemaName,r):null:null}findEntitySchemaColumnByPath(e,t){const s=this.findEntitySchemaByPath(e,t);if(!s)return null;const r=[...t].pop(),n=Un.getPathItemInfo(r);return this._getEntitySchemaColumn(s,n.columnName)}static{this.\u0275fac=function(t){return new(t||rt)(c.\u0275\u0275inject(Dr),c.\u0275\u0275inject(Ht))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:rt,factory:rt.\u0275fac,providedIn:"root"})}}class ua{}class vt{get attributes(){return this._parent?[...this._parent.attributes,...this._attributes]:[...this._attributes]}get parent(){return this._parent}constructor(e){if(e!=null){this.name=e.name,this.type=e.type,e.caption&&(this.caption=typeof e.caption=="string"?e.caption:{...e.caption}),this.primaryAttributeName=e.primaryAttributeName,this.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this.primaryColorAttributeName=e.primaryColorAttributeName,this.hierarchyAttributeName=e.hierarchyAttributeName,this.createdByAttributeName=e.createdByAttributeName,this.createdOnAttributeName=e.createdOnAttributeName,this.modifiedByAttributeName=e.modifiedByAttributeName,this.modifiedOnAttributeName=e.modifiedOnAttributeName,e.dataSourceConfig&&(this.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig.config}}),this._parent=e.parent;const t=e.attributes??[];this._attributes=[],t.forEach(s=>{if(this._parent){this._parent.findAttributeByName(s.name)||this._attributes.push(s.clone());return}this._attributes.push(s.clone())})}else this._attributes=[]}clearAttributes(){this._attributes=[]}addAttribute(e){if(this._parent){this._parent.findAttributeByName(e.name)||this._attributes.push(e);return}this._attributes.push(e)}findAttributeByName(e){return this.attributes.find(t=>t.name===e)??null}getPrimaryAttributesNames(){return[this.primaryAttributeName]}getPrimaryLoadAttributes(){const e=[];return this.primaryAttributeName&&e.push(this.primaryAttributeName),this.primaryDisplayAttributeName&&e.push(this.primaryDisplayAttributeName),e}clone(){return new vt(this)}createChild(){const e=new vt;return e.name=this.name,e.type=this.type,this.caption&&(e.caption=typeof this.caption=="string"?this.caption:{...this.caption}),e.primaryAttributeName=this.primaryAttributeName,e.primaryDisplayAttributeName=this.primaryDisplayAttributeName,e.primaryColorAttributeName=this.primaryColorAttributeName,e.hierarchyAttributeName=this.hierarchyAttributeName,e.createdByAttributeName=this.createdByAttributeName,e.createdOnAttributeName=this.createdOnAttributeName,e.modifiedByAttributeName=this.modifiedByAttributeName,e.modifiedOnAttributeName=this.modifiedOnAttributeName,this.dataSourceConfig&&(e.dataSourceConfig={...this.dataSourceConfig,config:{...this.dataSourceConfig.config}}),e._attributes=[],e._parent=this,e}}class Su extends Error{get isCritical(){return!0}constructor(e,t){super(t),this.dataSource=e}}class la extends Su{constructor(e,t){super(e,t)}}class zd extends Su{get isCritical(){return!1}constructor(e,t){super(e,t)}}class da{constructor(e,t){this.dataSourceName=e,this.injector=t,this._errors=[],this.supportTransactions=!1}get scope(){return this._scope}get hasErrors(){return this._errors.length!==0}get hasCriticalErrors(){return this._errors.some(e=>e.isCritical)}get affectedAttributes(){return[]}get isForceUpdateUnchangedData(){return!1}getLastError(){return this.hasErrors?this._errors[this._errors.length-1]:null}get isAggregate(){return!1}getEmptySchema(){return new vt}init(e,t){return this.initialConfig=e,this._scope=t,(0,o.of)(this)}load(e,t,s){return this.innerLoad(e,t,s)}save(e,t){return this.innerSave(e,t)}insert(e){return this.innerInsert(e)}delete(e){return this.innerDelete(e)}getSchema(){return this.dataSchema?(0,o.of)(this.dataSchema):this.innerGetSchema().pipe((0,l.tap)(e=>{this.dataSchema=e}))}getLookupDataSchema(e){return this.innerGetLookupDataSchema(e)}getDefaultValues(){return this.innerGetDefaultValues()}canEdit(e){return this.innerCanEdit(e)}canDelete(e){return this.innerCanDelete(e)}canCreate(e){return this.innerCanCreate(e)}getOwnLoadParameters(){return null}getAllowCopyingRecords(){return!1}}const Cu="crt.EntityDataSource",Au="crt.PageParametersDataSource",Vm="PageParameters";function Ze(i){return function(e,t,s){const r=function(...n){const a=Se.instance.process({type:i?.requestType?i.requestType:this.requestType,method:i?.methodName?i.methodName:t,args:n});return i?.omitResult?Promise.resolve(void 0):a};s?s.value=r:e[t]=r}}class Kn{}const vu=Symbol("CreateModelFrom");class nt extends Kn{constructor(e){super(),this.requestType="crt.ModelGenerator",this._crtModel=e}static get instance(){return this._instance||(this._instance=new nt),this._instance}get name(){return this._crtModel?.name}static[vu](e){return new nt(e)}static create(e){var t=this;return(0,S.A)(function*(){const s=yield t.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},"");return new nt(s)})()}getSchema(){return this._crtModel._getAsyncResult(this._crtModel.getSchema())}load(e){return e?.loadOptions&&!e?.options&&(e.options=e.loadOptions),this._crtModel._getAsyncResult(this._crtModel.load(e))}insert(e){return this._crtModel._getAsyncResult(this._crtModel.insert(e))}update(e,t){var s=this;return(0,S.A)(function*(){const r=Object.keys(e);if(r.length){const a=(yield s.getSchema()).primaryAttributeName;r.filter(u=>u!==a).forEach(u=>s._crtModel.attributeChanged(u))}return s._crtModel._getAsyncResult(s._crtModel.update(e,t))})()}copy(e,t={}){return this._crtModel._getAsyncResult(this._crtModel.copy(e,t))}create(e={}){return this._crtModel._getAsyncResult(this._crtModel.create(e))}delete(e){return this._crtModel._getAsyncResult(this._crtModel.delete(e))}canSave(e){return this._crtModel._getAsyncResult(this._crtModel.canSave(e))}canDelete(e){return this._crtModel._getAsyncResult(this._crtModel.canDelete(e))}insertInTransaction(e,t){return this._crtModel.insertInTransaction(e,t)}updateInTransaction(e,t,s){return this._crtModel.updateInTransaction(e,t,s)}deleteInTransaction(e,t){return this._crtModel.deleteInTransaction(e,t)}}(0,h.__decorate)([Ze({methodName:"generateOne"}),(0,h.__metadata)("design:type",Function)],nt.prototype,"_create",void 0);const Gd=new c.InjectionToken("COPILOT_INTENT_REPOSITORY_TOKEN");class De extends Kn{constructor(){super(...arguments),this.requestType="crt.SysSettingsService"}}(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],De.prototype,"getByCodes",void 0),(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],De.prototype,"getByCode",void 0),(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],De.prototype,"update",void 0),(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],De.prototype,"updateMany",void 0);class Eu{static{this._codeCharactersRegex=new RegExp("^[A-Za-z0-9\\s_]*$")}static{this._wordsMatchRegex=new RegExp(/\w+/g)}static generateCode(e,t=-1){const r=(e.match(this._wordsMatchRegex)||[]).filter(n=>n.length!==0).map(n=>n[0].toUpperCase()+n.substring(1)).join("");return t>=0?r.slice(0,t):r}static isTextUsableForCodeGeneration(e){return this._codeCharactersRegex.test(e)}}class Tr{constructor(){this._sysSettingsService=(0,c.inject)(De),this._defaultCodeMaxLength=41}_checkCodeIsUnique(e,t){return e?!e.includes(t):!0}_generateCode(e){const{prefix:t,options:s,generateFromName:r,name:n}=e,{codeMaxLength:a,defaultNewCode:u}=s;if(r){if(!Eu.isTextUsableForCodeGeneration(n))return null;const d=t+u,p=(a??this._defaultCodeMaxLength)-d.length,g=Eu.generateCode(n,p);return d+g}return O.$A.generateUnique(u,t)}generate(e,t,s){const r={generateFromName:!!t,name:t,prefix:null,options:s};return(0,o.from)(this._sysSettingsService.getByCode("SchemaNamePrefix")).pipe((0,o.map)(n=>n.value),(0,o.tap)(n=>r.prefix=n),(0,o.repeat)(r.generateFromName?1:void 0),(0,o.map)(()=>this._generateCode(r)),(0,o.filter)(n=>this._checkCodeIsUnique(e,n)),(0,o.take)(1),(0,o.defaultIfEmpty)(null))}static{this.\u0275fac=function(t){return new(t||Tr)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Tr,factory:Tr.\u0275fac})}}class Nr{constructor(){this._designItems=new Map}getDesignItem(e){return this._designItems.get(e)}getDesignItems(){return Array.from(this._designItems.values())}setDesignItem(e){this._designItems.set(e.UId,e)}static{this.\u0275fac=function(t){return new(t||Nr)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Nr,factory:Nr.\u0275fac})}}class zt{constructor(){this._repository=(0,c.inject)(Gd),this._copilotCodeGenerator=(0,c.inject)(Tr),this._designRepository=(0,c.inject)(Nr)}_loadIntentUIdByActionUId(e){return(0,o.from)(nt.create("CopilotAction")).pipe((0,o.switchMap)(t=>t.load({attributes:["Intent"],parameters:[{type:B.Filter,value:new Ne(ne.Equal,new se({columnPath:"Id"}),new ae({value:e}))}]})),(0,o.map)(t=>{const s=t[0]||{};return(0,P.isEmpty)(s)?null:s.Intent?.value}))}_applyActionToIntent(e,t){const r=(e.Actions||[]).findIndex(a=>a.Id===t.Id);if(r===-1)return!1;const n=e.Actions[r];return e.Actions.splice(r,1,{...n,...t}),!0}_applyParameterToIntent(e,t){const s=t.SourceCollection==="InputParameters"?e.InputParameters:e.OutputParameters,r=s.findIndex(n=>n.UId===t.UId);return r!==-1?(s.splice(r,1,{...s[r],...t}),!0):!1}_getSuccessResponse(){return{success:!0}}_getSuccessResponseObservable(){return(0,o.of)(this._getSuccessResponse())}_getDesignIntent(e){return(0,o.of)(this._designRepository.getDesignItem(e))}_getDesignIntents(){return Array.from(this._designRepository.getDesignItems())}_setDesignIntent(e){this._designRepository.setDesignItem(e)}_getIntentByParameterUId(e){for(const t of this._getDesignIntents()){if(t.InputParameters.find(n=>n.UId===e))return(0,o.of)({intent:t,sourceCollection:"InputParameters"});if(t.OutputParameters.find(n=>n.UId===e))return(0,o.of)({intent:t,sourceCollection:"OutputParameters"})}return(0,o.of)({})}getIntent(e){return this._repository.get(e).pipe((0,o.tap)(t=>{this._setDesignIntent(t)}))}getAllSkills(){return this._repository.getAllCodes("CopilotIntent")}getAllAgents(){return this._repository.getAllCodes("CopilotAgent")}getIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,o.map)(({intent:t,sourceCollection:s})=>s==="InputParameters"?t.InputParameters:t.OutputParameters),(0,o.map)(t=>t.find(s=>s.UId===e)))}getIntentParameters(e,t){return this._getDesignIntent(e).pipe((0,o.map)(s=>t==="InputParameters"?s.InputParameters:s.OutputParameters))}updateIntentParameter(e){return this._getIntentByParameterUId(e.UId).pipe((0,o.switchMap)(({intent:t,sourceCollection:s})=>(e.SourceCollection=s,this._applyParameterToIntent(t,e)?this._getSuccessResponseObservable():this._getSuccessResponseObservable())))}createIntentParameter(e){return this._getDesignIntent(e.Intent.value).pipe((0,o.map)(t=>((e.SourceCollection==="InputParameters"?t.InputParameters:t.OutputParameters).push(e),this._getSuccessResponse())))}deleteIntentParameter(e){return this._getIntentByParameterUId(e).pipe((0,o.map)(({intent:t,sourceCollection:s})=>{const r=s==="InputParameters"?t?.InputParameters:t?.OutputParameters,n=(r??[]).findIndex(a=>a.UId===e);return n!==-1&&r.splice(n,1),t}),(0,o.switchMap)(t=>this._repository.update(t)))}createIntent(e){return this._repository.create(e.UId).pipe((0,o.map)(t=>(Object.assign(t,e),t)),(0,o.switchMap)(t=>this._repository.update(t)))}updateIntent(e){return(0,o.forkJoin)([this._getDesignIntent(e.UId),this._repository.get(e.UId)]).pipe((0,o.map)(([t,s])=>{const r={...s,...t,...e};return this._setDesignIntent(r),r}),(0,o.switchMap)(t=>this._repository.update(t)))}createAction(e){return this._repository.get(e.Intent.value).pipe((0,o.map)(t=>(t.Actions.push(e),t)),(0,o.switchMap)(t=>this._repository.update(t)))}createSubIntent(e,t){return this._repository.createSubIntent(e,t)}deleteSubIntent(e,t){return this._repository.deleteSubIntent(e,t)}getActionByUId(e){return this._loadIntentUIdByActionUId(e).pipe((0,o.switchMap)(t=>t?this._repository.get(t).pipe((0,o.map)(s=>s.Actions.filter(r=>r.Id===e)),(0,o.map)(s=>s[0])):(0,o.of)({})))}getIntentByActionUId(e){return this.getActionByUId(e).pipe((0,o.switchMap)(t=>t?.Intent?this.getIntent(t.Intent.value):(0,o.of)({})))}updateAction(e){return this._loadIntentUIdByActionUId(e.Id).pipe((0,o.switchMap)(t=>this._repository.get(t).pipe((0,o.switchMap)(s=>this._applyActionToIntent(s,e)?this._repository.update(s):(0,o.of)({})))))}generateActionCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Action"})}generateSkillCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Skill"})}generateAgentCode(e,t=null){return this._copilotCodeGenerator.generate(e,t,{defaultNewCode:"Agent"})}deleteAction(e,t){return this._repository.get(e).pipe((0,o.map)(s=>(s.Actions=s.Actions.filter(r=>r.Id!==t),s)),(0,o.switchMap)(s=>this._repository.update(s)))}static{this.\u0275fac=function(t){return new(t||zt)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:zt,factory:zt.\u0275fac})}}var ha;(function(i){i[i.None=0]="None",i[i.Self=1]="Self",i[i.ExplicitEntry=2]="ExplicitEntry",i[i.Delegated=4]="Delegated",i[i.FuncRoleFromOrgRole=8]="FuncRoleFromOrgRole",i[i.UpHierarchy=16]="UpHierarchy",i[i.AsManager=32]="AsManager",i[i.All=63]="All"})(ha||(ha={}));class zn{get queryDtoType(){return this._queryDtoType}constructor(e,t){this.operationType=e,this.rootSchemaName=t,H.checkArgumentEmpty("_operationType",e),H.checkArgumentEmpty("_rootSchemaName",t)}getMetadata(){return(0,de.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}(0,h.__decorate)([(0,de.Exclude)(),(0,h.__metadata)("design:type",String)],zn.prototype,"_queryDtoType",void 0),(0,h.__decorate)([(0,de.Expose)({name:"__type"}),(0,h.__metadata)("design:type",String),(0,h.__metadata)("design:paramtypes",[])],zn.prototype,"queryDtoType",null);class xr extends ze{static{this._instanceOfKey="devkit_BetweenFilter"}static get _instanceOfKeys(){return[...ze._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(ie.Between,ne.Between,e),this.filterType=ie.Between,this.rightLessExpression=t?.clone(),this.rightGreaterExpression=s?.clone()}static fromJson(e,t,s){return new xr(s.fromJson(e.leftExpression,t),s.fromJson(e.rightLessExpression,t),s.fromJson(e.rightGreaterExpression,t))}clone(){const e=new xr(this.leftExpression,this.rightLessExpression,this.rightGreaterExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightLessExpression:this.serializeItem(this.rightLessExpression),rightGreaterExpression:this.serializeItem(this.rightGreaterExpression)}}_getUsedColumns(){return[...super._getUsedColumns(),...this.rightLessExpression._getUsedColumns(),...this.rightGreaterExpression._getUsedColumns()]}}class Gt extends ze{static{this._instanceOfKey="devkit_ExistsFilter"}static get _instanceOfKeys(){return[...ze._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s=ne.Exists,r=!0){super(ie.Exists,s,e),this.filterType=ie.Exists,this.subFilters=t?.clone(),this.isAggregative=r}static fromJson(e,t,s){const r=s.fromJson(e.leftExpression,t),n=e.subFilters;let a;return n&&(a=t.fromJson(e.subFilters)),new Gt(r,a,e.comparisonType,e.isAggregative)}clone(){const e=new Gt(this.leftExpression,this.subFilters,this.comparisonType,this.isAggregative);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[...super._getUsedColumns(),...this.subFilters?._getUsedColumns()??[]]}}class Wt extends ze{static{this._instanceOfKey="devkit_InFilter"}static get _instanceOfKeys(){return[...ze._instanceOfKeys,this._instanceOfKey]}constructor(e,t,s){super(ie.In,e,t),this.filterType=ie.In,this.rightExpressions=s.map(r=>r?.clone())??[]}static fromJson(e,t,s){const r=e.rightExpressions??[];return new Wt(e.comparisonType,s.fromJson(e.leftExpression,t),r.map(n=>s.fromJson(n,t)))}clone(){const e=new Wt(this.comparisonType,this.leftExpression,this.rightExpressions);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}toJson(){return{...super.toJson(),rightExpressions:this.rightExpressions.map(e=>this.serializeItem(e))}}_getUsedColumns(){const e=this.rightExpressions.map(t=>t._getUsedColumns()).flat();return[...super._getUsedColumns(),...e]}}class it extends ze{static{this._instanceOfKey="devkit_IsNullFilter"}static get _instanceOfKeys(){return[...ze._instanceOfKeys,this._instanceOfKey]}constructor(e,t){[ne.Is_null,ne.Is_not_null].includes(e)||console.warn(`Invalid comparison type: ${ne[e]} in IsNullFilter.`),super(ie.IsNull,it._getComparisonType(e),t),this.filterType=ie.IsNull,this.isNull=!0,this.isNull=this.comparisonType===ne.Is_null}static _getComparisonType(e){return e===ne.Is_not_null?e:ne.Is_null}static fromJson(e,t,s){return new it(it._getComparisonType(e.comparisonType),s.fromJson(e.leftExpression,t))}clone(){const e=new it(it._getComparisonType(this.comparisonType),this.leftExpression);return e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}}var _s;(function(i){i[i.And=0]="And",i[i.Or=1]="Or"})(_s||(_s={}));var ys;(function(i){i[i.None=0]="None",i[i.CurrentUser=1]="CurrentUser",i[i.CurrentUserContact=2]="CurrentUserContact",i[i.Yesterday=3]="Yesterday",i[i.Today=4]="Today",i[i.Tomorrow=5]="Tomorrow",i[i.PreviousWeek=6]="PreviousWeek",i[i.CurrentWeek=7]="CurrentWeek",i[i.NextWeek=8]="NextWeek",i[i.PreviousMonth=9]="PreviousMonth",i[i.CurrentMonth=10]="CurrentMonth",i[i.NextMonth=11]="NextMonth",i[i.PreviousQuarter=12]="PreviousQuarter",i[i.CurrentQuarter=13]="CurrentQuarter",i[i.NextQuarter=14]="NextQuarter",i[i.PreviousHalfYear=15]="PreviousHalfYear",i[i.CurrentHalfYear=16]="CurrentHalfYear",i[i.NextHalfYear=17]="NextHalfYear",i[i.PreviousYear=18]="PreviousYear",i[i.CurrentYear=19]="CurrentYear",i[i.PreviousHour=20]="PreviousHour",i[i.CurrentHour=21]="CurrentHour",i[i.NextHour=22]="NextHour",i[i.NextYear=23]="NextYear",i[i.NextNDays=24]="NextNDays",i[i.PreviousNDays=25]="PreviousNDays",i[i.NextNHours=26]="NextNHours",i[i.PreviousNHours=27]="PreviousNHours",i[i.PrimaryColumn=34]="PrimaryColumn",i[i.PrimaryDisplayColumn=35]="PrimaryDisplayColumn",i[i.PrimaryImageColumn=36]="PrimaryImageColumn",i[i.DayOfYearToday=37]="DayOfYearToday",i[i.DayOfYearTodayPlusDaysOffset=38]="DayOfYearTodayPlusDaysOffset",i[i.NextNDaysOfYear=39]="NextNDaysOfYear",i[i.PreviousNDaysOfYear=40]="PreviousNDaysOfYear",i[i.PrimaryColorColumn=41]="PrimaryColorColumn"})(ys||(ys={}));class Gn extends Ge{static{this._instanceOfKey="devkit_FunctionExpression"}static get _instanceOfKeys(){return[...Ge._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Ce.Function}}var Me;(function(i){i[i.None=0]="None",i[i.Macros=1]="Macros",i[i.Aggregation=2]="Aggregation",i[i.DatePart=3]="DatePart",i[i.Length=4]="Length",i[i.Window=5]="Window",i[i.DateAdd=6]="DateAdd",i[i.DateDiff=7]="DateDiff"})(Me||(Me={}));class Jt extends Gn{static{this._instanceOfKey="devkit_MacrosFunctionExpression"}static get _instanceOfKeys(){return[...Gn._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=Me.Macros,this.macrosType=e?.macrosType,this.functionArgument=e?.functionArgument}static fromJson(e,t,s){const r=t&&s&&e.functionArgument?s.fromJson(e.functionArgument,t):void 0;return new Jt({functionArgument:r,macrosType:e.macrosType})}clone(){return new Jt(this)}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class me extends Sr{static{this._instanceOfKey="devkit_FilterGroup"}static get _instanceOfKeys(){return[...Sr._instanceOfKeys,this._instanceOfKey]}get items(){const e={};return this.filters.forEach((t,s)=>{e[s]=this.serializeItem(t)}),e}constructor(e=_s.And,t){super(ie.FilterGroup),this.filterType=ie.FilterGroup,this.filters=new Map,this.logicalOperation=e,this.rootSchemaName=t}static fromJson(e,t){const s=e.logicalOperation,r=new me(s||_s.And,e.rootSchemaName);return Object.entries(e.items).forEach(([n,a])=>{r.add(t.fromJson(a),n)}),r}toJson(){const e={};return e.filterType=this.filterType,e.isEnabled=this.isEnabled,e.logicalOperation=this.logicalOperation,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e.items=this.items,this.rootSchemaName&&(e.rootSchemaName=this.rootSchemaName),e}_createParameterValueExpressions(e){return e.map(t=>new ae({value:t}))}getItemByIndex(e){return this.items[Object.keys(this.items)[e]]}addSchemaColumnFilterWithParameter(e,t,s,r){const n=new se({columnPath:t}),a=new ae({value:s}),u=new Ne(e,n,a);this.add(u,r)}addSchemaColumnInFilterWithParameters(e,t,s,r){const n=new se({columnPath:t}),a=this._createParameterValueExpressions(s),u=new Wt(e,n,a);this.add(u,r)}addPrimarySchemaColumnInFilter(e,t){const s=new Jt({macrosType:ys.PrimaryColumn}),r=this._createParameterValueExpressions(e),n=new Wt(ne.Equal,s,r);this.add(n,t)}addSchemaColumnIsNullFilter(e,t){const s=new se({columnPath:e}),r=new it(ne.Is_null,s);this.add(r,t)}addSchemaColumnIsNotNullFilter(e,t){const s=new se({columnPath:e}),r=new it(ne.Is_not_null,s);this.add(r,t)}addSchemaColumnBetweenFilterWithParameters(e,t,s,r){const n=new se({columnPath:e}),a=new ae({value:t}),u=new ae({value:s}),d=new xr(n,a,u);this.add(d,r)}addExistsFilter(e,t,s){const r=new se({columnPath:e}),n=new Gt(r,t);this.add(n,s)}addNotExistsFilter(e,t,s){const r=new se({columnPath:e}),n=new Gt(r,t,ne.Not_exists);this.add(n,s)}add(e,t){H.checkArgumentEmpty("filter",e);const s=t||(0,j.qv)();this.filters.set(s,e)}clone(){const e=new me(this.logicalOperation,this.rootSchemaName);return this.filters.forEach((t,s)=>{e.filters.set(s,t.clone())}),e.isEnabled=this.isEnabled,e.trimDateTimeParameterToDate=this.trimDateTimeParameterToDate,e}_getUsedColumns(){const e=[];return this.filters.forEach(t=>{let s=t._getUsedColumns?t._getUsedColumns():[];s=s.map(r=>({path:r.path,schemaName:r.schemaName??this.rootSchemaName})),e.push(...s)}),e}}(0,h.__decorate)([(0,de.Exclude)(),(0,h.__metadata)("design:type",Object)],me.prototype,"filters",void 0),(0,h.__decorate)([(0,de.Expose)(),(0,h.__metadata)("design:type",Object),(0,h.__metadata)("design:paramtypes",[])],me.prototype,"items",null);class Wn extends zn{constructor(e,t){super(e,t),this.filters=new me}clearFilters(){this.filters.filters.clear()}getMetadata(){return{...super.getMetadata(),filters:this.filters.toJson()}}_getUsedColumns(){const e=this.filters._getUsedColumns();return e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),e}}(0,h.__decorate)([(0,de.Exclude)(),(0,h.__metadata)("design:type",Object)],Wn.prototype,"filters",void 0);var bs;(function(i){i[i.Select=0]="Select",i[i.Insert=1]="Insert",i[i.Update=2]="Update",i[i.Delete=3]="Delete"})(bs||(bs={}));class pa extends Wn{constructor(e){super(bs.Update,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.UpdateQuery",this.isForceUpdate=!1}get columnValues(){return{items:(0,de.classToPlain)(this._columnValues)}}addColumn(e,t,s){H.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new ae({value:t,dataValueType:s}))}}(0,h.__decorate)([(0,de.Expose)(),(0,h.__metadata)("design:type",Object),(0,h.__metadata)("design:paramtypes",[])],pa.prototype,"columnValues",null);class ma extends zn{constructor(e){super(bs.Insert,e),this._columnValues=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.InsertQuery"}get columnValues(){return{items:(0,de.classToPlain)(this._columnValues)}}addColumn(e,t,s){H.checkArgumentEmpty("columnName",e),this._columnValues.set(e,new ae({value:t,dataValueType:s}))}}(0,h.__decorate)([(0,de.Expose)(),(0,h.__metadata)("design:type",Object),(0,h.__metadata)("design:paramtypes",[])],ma.prototype,"columnValues",null);class Mu extends Wn{constructor(e){super(bs.Delete,e),this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.DeleteQuery"}}var at;(function(i){i.None="",i.Count="Count",i.Sum="Sum",i.Avg="Avg",i.Min="Min",i.Max="Max",i.TopOne="TopOne"})(at||(at={}));const fa="rights-cache",Om={provide:Zi.P,useValue:{name:fa,type:z.P.PersistentAndMemory,options:{tableName:Yi.w.Rights}},multi:!0};class Wd{constructor(){this._cache=new Map}setToCache(e,t){this._cache.set(e,t)}deleteFromCache(e){this._cache.delete(e)}getFromCache(e){return this._cache.get(e)}}class Jd extends Wd{constructor(){super(...arguments),this.httpClient=(0,c.inject)(N.HttpClient)}_createCacheKey(e,t={}){return`${e}!${JSON.stringify(t)}`}_cacheRequest(e,t){const s=this.getFromCache(t);if((0,P.isUndefined)(s)){const r=e().pipe((0,o.shareReplay)({bufferSize:1,refCount:!1}));return this.setToCache(t,r),r}return s}getMethodEndpoint(e){return`${this.serviceEndpoint.replace(/\/$/,"")}/${e}`}executePostRequestWithCache(e,t={}){const s=this.getMethodEndpoint(e),r=this._createCacheKey(e,t),n=()=>this.httpClient.post(s,t);return this._cacheRequest(n,r)}executeGetRequestWithCache(e){const t=this.getMethodEndpoint(e),s=this._createCacheKey(e),r=()=>this.httpClient.get(t);return this._cacheRequest(r,s)}resetCache(e,t={}){const s=this._createCacheKey(e,t);this.deleteFromCache(s)}}let ga=class Pn extends Jd{constructor(){super(...arguments),this._persistentCache=null,this._cacheManager=(0,c.inject)(ge.G),this._measurePerformanceService=(0,c.inject)(te.g),this._useSystemClientCache=(0,c.inject)(ce.X,{optional:!0})??!1,this.serviceEndpoint="rest/RightsService"}_getPersistentCacheInstance(){return this._persistentCache?(0,o.of)(this._persistentCache):(0,o.from)(this._cacheManager.getOrCreate({name:fa,type:z.P.Memory})).pipe((0,l.tap)(e=>this._persistentCache=e))}_getSchemaDeleteRights(e){return this.executePostRequestWithCache("GetSchemaDeleteRights",e).pipe((0,l.map)(t=>({result:t&&t.GetSchemaDeleteRightsResult?.length===0,message:t?.GetSchemaDeleteRightsResult})))}_getCanDeleteByRecord(e){const t=`${this.serviceEndpoint}/GetCanDelete`;return this.httpClient.post(t,e).pipe((0,l.map)(s=>({result:s&&s.GetCanDeleteResult?.length===0,message:s?.GetCanDeleteResult})))}_getCanAddData(e){const t=e.map(r=>this.getFromCache(`GetCanAdd_${r}`)).filter(r=>!!r),s=e.filter(r=>!t.find(n=>n.schemaName===r));return{cachedResult:t,requestSchemaNames:s}}_internalGetExecuteOperation(e){return this._cacheManager.executeWithCache(fa,e,this.httpClient.post(this.getMethodEndpoint("GetCanExecuteOperation"),{operation:e}).pipe((0,l.map)(t=>t?.GetCanExecuteOperationResult))).pipe(this._measurePerformanceService.measure$("RightsService: get execute operation with cache"))}getCanExecuteOperation(e){return this.getCanExecuteOperations([e]).pipe((0,l.mergeMap)(t=>(0,o.of)((t||[])[0])))}getCanExecuteOperations(e){return this._useSystemClientCache?this._getPersistentCacheInstance().pipe((0,l.switchMap)(t=>t.getAll()),(0,l.switchMap)(t=>{const s=e.map(r=>{const n=t.find(a=>a.key===r);return n?(0,o.of)(n.value):this._internalGetExecuteOperation(r)});return(0,o.combineLatest)(s)})):(0,o.combineLatest)(e.map(t=>this._internalGetExecuteOperation(t)))}getIsTechnicalUser(){const e=`${this.serviceEndpoint}/GetIsTechnicalUser`;return this.httpClient.post(e,null).pipe((0,l.map)(t=>t?.GetIsTechnicalUserResult))}getCanAdd(e){const t="GetCanAdd",{cachedResult:s,requestSchemaNames:r}=this._getCanAddData(e);if(!r.length)return(0,o.of)(s);const n=`${this.serviceEndpoint}/${t}`;return this.httpClient.post(n,r).pipe((0,l.map)(a=>a.map(u=>({schemaName:u.Key,result:(0,P.isEmpty)(u.Value),errorMessage:u.Value}))),(0,l.tap)(a=>a.forEach(u=>this.setToCache(`${t}_${u.schemaName}`,u))),(0,l.map)(a=>a.concat(s)))}getCanEdit(e){const t=`${this.serviceEndpoint}/GetCanEdit`;return this.httpClient.post(t,e).pipe((0,l.map)(s=>({result:s&&s.GetCanEditResult?.length===0,message:s?.GetCanEditResult})))}getCanDelete(e){if(e.primaryColumnValue)return this._getCanDeleteByRecord(e);const t={schemaName:e.schemaName};return this._getSchemaDeleteRights(t)}copyRights(e){const t=`${this.serviceEndpoint}/CopyRights`;return this.httpClient.post(t,e)}getCanEditColumns(e){return this.executePostRequestWithCache("GetCanEditColumns",e).pipe((0,l.map)(t=>{const s=t?.GetCanEditColumnsResult??[],r={};return s.forEach(n=>r[n.Key]=n.Value),r}))}getCanReadColumns(e){return this.executePostRequestWithCache("GetCanReadColumns",e).pipe((0,l.map)(t=>{const s=t?.GetCanReadColumnsResult??[],r={};return s.forEach(n=>r[n.Key]=n.Value),r}))}getCanExecuteEntityOperation(e,t){const s=`${this.serviceEndpoint}/GetCanExecuteEntityOperation`,r={entitySchemaName:e,entityOperationCode:t};return this.httpClient.post(s,r).pipe((0,l.mergeMap)(n=>(0,o.of)(n?.GetCanExecuteEntityOperationResult)))}getAclGranted(e){return(0,o.firstValueFrom)(this.executeGetRequestWithCache("GetReadDeniedEntityList")).then(t=>!t.GetReadDeniedEntityListResult.includes(e),t=>(console.error(`Error while making request to ReadDeniedEntityList: ${t}`),!0))}applyChanges(e){const t=`${this.serviceEndpoint}/ApplyChanges`;return(0,o.firstValueFrom)(this.httpClient.post(t,e)).then(()=>!0,s=>{throw console.error(`Error while making request to ApplyChanges: ${s}`),s})}getRecordRights(e){return(0,o.firstValueFrom)(this.executePostRequestWithCache("GetRecordRights",e)).then(t=>t,t=>{throw console.error(`Error while making request to GetRecordRights: ${t}`),t})}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Pn)))(s||Pn)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Pn,factory:Pn.\u0275fac,providedIn:"root"})}};ga=(0,h.__decorate)([(0,O.op)({requestType:"crt.RightsService"})],ga);class Le{static{this.\u0275fac=function(t){return new(t||Le)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Le,factory:Le.\u0275fac})}}function km(i){return i=i||new Date,new Date(i.getFullYear(),i.getMonth(),i.getDate())}function Lm(i){return i=i||new Date,new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59,999)}function Ru(i){if(!i)return null;function e(){throw new Error(`String "${i}" is not a valid serialized date.`)}typeof i!="string"&&e();const[t,s]=i.split("T");if(s&&(s[s.length-1]==="Z"||s.indexOf("+")!==-1||s.indexOf("-")!==-1)){const n=Date.parse(i);return isNaN(n)&&e(),new Date(n)}try{const[n,a,u]=t.split("-"),[d,p,g]=s.split(":"),[C,I]=g.split(".");return new Date(parseInt(n),parseInt(a)-1,parseInt(u),parseInt(d),parseInt(p),parseInt(C),parseInt(I))}catch{e()}}function Bm(i,e){e==null&&(e=0),i.setSeconds(i.getSeconds()+e*3600)}function Fm(i,e,t){const s=t||{hour:"2-digit",minute:"2-digit"};return new Intl.DateTimeFormat(e.sysCultureName,s).format(i)}function jm(i,e,t){const s=Math.abs(e.getTime()-i.getTime()),r=Math.floor(s/(1e3*60*60)),n=Math.floor(s%(1e3*60*60)/(1e3*60)),a=Math.floor(s%(1e3*60)/1e3),u={hours:r,minutes:n,seconds:a};return new Intl.DurationFormat(t.sysCultureName).format(u)}function _a(i,e){switch(H.checkArgumentEmpty("dataValueType",e),e){case A.r.Date:case A.r.Time:case A.r.DateTime:return Ru(i);default:return i}}function Zd(i,e){if(ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),!i)return i;const t={};return Object.keys(i).forEach(s=>{const r=i[s];t[s]=e[s]?_a(r,e[s]):r}),t}function $m(i,e){return ValidationUtilities.checkArgumentEmpty("columnValueTypes",e),i&&i.map(t=>t&&Zd(t,e))}class Jn extends Error{}var Ss;(function(i){i.Entity="Entity",i.ClientUnit="ClientUnit",i.Intent="Intent"})(Ss||(Ss={}));class Et{constructor(){this._phoneUtil=null,this._phoneNumberType=null,this._phoneMaskOverrides=new Map([["id",["+{62} 000 000 000 000","+{62} 000 000 00"]]])}getAllPhoneMasks(e){let t=[];for(const r in this._phoneNumberType)if(isNaN(Number(r))){const n=this._phoneUtil.getExampleNumberForType(e,this._phoneNumberType[r]);if(!n)continue;const a=n.getCountryCode().toString(),u=this._phoneUtil.format(n,null),d=`+{${a.replace("0","\\0")}} ${u.replace(/-/g," ").replace(/\d/g,"0")}`;t.find(p=>p===d)||t.push(d)}const s=this._phoneMaskOverrides.get(e);return s&&(t.push(...s),t=Array.from(new Set(t))),t}initialize(){var e=this;return(0,S.A)(function*(){if(!(e._phoneUtil&&e._phoneNumberType))try{const t=yield _.e(1588).then(_.t.bind(_,1588,23));e._phoneUtil=t.PhoneNumberUtil.getInstance(),e._phoneNumberType=t.PhoneNumberType}catch(t){throw console.error("Error loading google-libphonenumber:",t),t}})()}isValidPhoneNumber(e){if(!this._phoneUtil)return!0;try{const t=this._phoneUtil.parse(e);return this._phoneUtil.isValidNumber(t)}catch{return!1}}static{this.\u0275fac=function(t){return new(t||Et)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Et,factory:Et.\u0275fac,providedIn:"root"})}}const ya={ShortTextCaption:50,MediumTextCaption:250,LongTextCaption:500},Zn={Integer:{max:2147483647,min:-2147483647},Float:{max:6999999999999999e-2,min:-6999999999999999e-2}};function Yd(i){let e;switch(i){case A.r.SHORT_TEXT:e=ya.ShortTextCaption;break;case A.r.PHONE_TEXT:case A.r.MEDIUM_TEXT:e=ya.MediumTextCaption;break;case A.r.LONG_TEXT:case A.r.EMAIL_TEXT:e=ya.LongTextCaption;break;default:return}return{maxLength:e}}function Xd(i){if([A.r.Float,A.r.FLOAT0,A.r.FLOAT1,A.r.FLOAT2,A.r.FLOAT3,A.r.FLOAT4,A.r.FLOAT8,A.r.MONEY0,A.r.MONEY1,A.r.Money,A.r.MONEY3].includes(i))return{minValue:Zn.Float.min,maxValue:Zn.Float.max};if(i===A.r.Integer)return{minValue:Zn.Integer.min,maxValue:Zn.Integer.max}}class Vr{get isDate(){return this.dataValueType===A.r.Date||this.dataValueType===A.r.DateTime||this.dataValueType===A.r.Time}get isImage(){return this.dataValueType===A.r.IMAGELOOKUP||this.dataValueType===A.r.Image}get isLookup(){return this.dataValueType===A.r.Lookup}set isSystem(e){this._isSystem=e}get isSystem(){return this._isSystem}get isAggregate(){return this.attributeType===Z.AggregationAttribute?!0:this.attributeType===Z.FunctionAttribute&&this.functionConfig?.type==="aggregation"}constructor(e){if(this._isSystem=!1,e!=null){this.name=e.name,this.caption=e.caption,this.path=e.path,this.dataValueType=e.dataValueType,e.validators&&(this.validators={...e.validators||{}});const t=e.defaultValue;t&&(t instanceof o.Observable?this.defaultValue=t.pipe((0,l.map)(s=>this._getConvertDefaultValue(s))):this.defaultValue=(0,o.of)(this._getConvertDefaultValue(t))),this.defaultValueSchema=e.defaultValueSchema,this.isValueCloneable=e.isValueCloneable,this.attributeType=e.attributeType,this.referenceSchemaName=e.referenceSchemaName,this.functionConfig=e.functionConfig,this.aggregationConfig=e.aggregationConfig,this.isMasked=e.isMasked,this.isFormatValidated=e.isFormatValidated,this.isSensitiveData=e.isSensitiveData,this.isValueMasked=e.isValueMasked,this.valueMaskingSettings=e.valueMaskingSettings,this.usageType=e.usageType,this.isRequired=e.isRequired,this.lookupMode=e.lookupMode,this.isSystem=!!e.isSystem,this.useSeconds=e.useSeconds}}_getConvertDefaultValue(e){if(this.isDate)if(e instanceof Date){const t=new Date;return t.setTime(e.getTime()),t}else return e;else return typeof e=="object"?{...e}:e}clone(){return new Vr(this)}addDefaultValidators(){const e=this.validators??{};this.isRequired&&(e["crt.Required"]={type:"crt.Required"}),!this.validators&&Object.keys(e).length>0&&(this.validators=e)}}class Iu{constructor(e=null,t,s){e==null?this._dataSchema=new vt:this._dataSchema=t?.useClone?e.clone():e.createChild(),this._phoneValidationService=s||c.Injector.create({providers:[{provide:Et,useClass:Et}]}).get(Et)}_createDataSchemaAttributeByConfig(e){const t=new Vr;return t.name=e.name,t.caption=e.caption,t.path=e.path,t.dataValueType=e.dataValueType,t.validators={...e.validators||{}},t.defaultValue=(0,o.of)(typeof e.defaultValue=="object"?{...e.defaultValue}:e.defaultValue),t.defaultValueSchema=e.defaultValueSchema,t.isValueCloneable=e.isValueCloneable,t.attributeType=e.attributeType,t.referenceSchemaName=e.referenceSchemaName,t.functionConfig=e.functionConfig,t.aggregationConfig=e.aggregationConfig,t.usageType=e.usageType,t.isMasked=e.isMasked,t.isFormatValidated=e.isFormatValidated,t.isSensitiveData=e.isSensitiveData,t.isValueMasked=e.isValueMasked,t.valueMaskingSettings=e.valueMaskingSettings,t.isRequired=e.isRequired,t.lookupMode=e.lookupMode,t.isSystem=e.isSystem??!1,t.useSeconds=e.useSeconds??!1,t}setEntitySchemaColumnValidators(e,t){return e.isRequired&&this.setAttributeRequiredValidator(t),this.setAttributeTextDataValueTypeValidator(t,e.dataValueType).setAttributeNumberDataValueTypeValidator(t,e.dataValueType).setAttributePhoneDataValueTypeValidator(t,e)}setAttributeValidator(e,t,s){const r=this._dataSchema.attributes.find(a=>a.name===e),n=r.validators||{};return n[t]=s,r.validators=n,this}setAttributeRequiredValidator(e){return this.setAttributeValidator(e,"crt.Required",{type:"crt.Required"})}setAttributeMaxLengthValidator(e,t){return this.setAttributeValidator(e,"crt.MaxLength",{type:"crt.MaxLength",params:{maxLength:t}})}setAttributeTextDataValueTypeValidator(e,t){const s=Yd(t);return s?this.setAttributeMaxLengthValidator(e,s.maxLength):this}setAttributeMinValueValidator(e,t){return this.setAttributeValidator(e,"crt.Min",{type:"crt.Min",params:{min:t}})}setAttributeMaxValueValidator(e,t){return this.setAttributeValidator(e,"crt.Max",{type:"crt.Max",params:{max:t}})}setAttributeMinMaxValidator(e,t,s){return this.setAttributeMinValueValidator(e,t).setAttributeMaxValueValidator(e,s)}setAttributeNumberDataValueTypeValidator(e,t){const s=Xd(t);return s&&this.setAttributeMinMaxValidator(e,s.minValue,s.maxValue),this}setAttributePhoneDataValueTypeValidator(e,t){return[A.r.PHONE_TEXT].includes(t.dataValueType)&&t.isMasked&&(this._phoneValidationService.initialize().then(),this.setAttributeValidator(e,"crt.PhoneNumber",{type:"crt.PhoneNumber"})),this}setAttributesDefaultValue(e){return this._dataSchema.attributes.forEach(t=>{t.defaultValue=e.pipe((0,l.map)(s=>s[t.name]))}),this}addAttribute(e,t){const{name:s,caption:r,dataValueType:n,isValueCloneable:a,referenceSchemaName:u,isMasked:d,isFormatValidated:p,usageType:g,isRequired:C,isSensitiveData:I,isValueMasked:W,valueMaskingSettings:X}=e,U=new Vr;return U.name=t.attributeName||s,U.path=t.attributePath||s,U.caption=r,U.dataValueType=n,U.isValueCloneable=!!a,U.attributeType=t.attributeType||Z.OwnAttribute,U.referenceSchemaName=u,U.validators={},U.isMasked=d,U.isFormatValidated=p,U.isSensitiveData=I,U.isValueMasked=W,U.valueMaskingSettings=X,U.usageType=g,U.isRequired=C,U.defaultValueSchema=e.defaultValueSchema,U.lookupMode=e.lookupMode,U.useSeconds=e.useSeconds,U.isSystem=(0,P.compact)([this._dataSchema.createdByAttributeName,this._dataSchema.createdOnAttributeName,this._dataSchema.modifiedByAttributeName,this._dataSchema.modifiedOnAttributeName,this._dataSchema.primaryAttributeName,"ProcessListeners"]).includes(U.name),this._dataSchema.addAttribute(U),t.attributeType===Z.OwnAttribute&&this.setEntitySchemaColumnValidators(e,U.name),t.attributeType===Z.AggregationAttribute&&(U.aggregationConfig=t.aggregationConfig),t.attributeType===Z.FunctionAttribute&&(U.functionConfig=t.functionConfig),this}addOwnAttribute(e){return this.addAttribute(e,{attributeType:Z.OwnAttribute})}setEntitySchema(e){return this._dataSchema.dataSourceConfig={type:"crt.EntityDataSource",config:{entitySchemaName:e.name}},this._dataSchema.name=e.name,this._dataSchema.type=Ss.Entity,this._dataSchema.primaryAttributeName=e.getPrimaryColumn()?.name,this._dataSchema.primaryDisplayAttributeName=e.getPrimaryDisplayColumn()?.name,this._dataSchema.primaryColorAttributeName=e.getPrimaryColorColumn()?.name,this._dataSchema.hierarchyAttributeName=e.getHierarchyColumn()?.name,this._dataSchema.caption=e.caption,this._dataSchema.createdByAttributeName=e.columns.find(t=>t.uId===e.createdByColumnUId)?.name,this._dataSchema.createdOnAttributeName=e.columns.find(t=>t.uId===e.createdOnColumnUId)?.name,this._dataSchema.modifiedByAttributeName=e.columns.find(t=>t.uId===e.modifiedByColumnUId)?.name,this._dataSchema.modifiedOnAttributeName=e.columns.find(t=>t.uId===e.modifiedOnColumnUId)?.name,this._dataSchema.clearAttributes(),e.columns.forEach(t=>{this.addOwnAttribute(t)}),this}setDataSchemaConfig(e){return this._dataSchema.name=e.name,this._dataSchema.type=e.type,this._dataSchema.caption=typeof e.caption=="string"?e.caption:{...e.caption},this._dataSchema.primaryAttributeName=e.primaryAttributeName,this._dataSchema.primaryDisplayAttributeName=e.primaryDisplayAttributeName,this._dataSchema.dataSourceConfig={...e.dataSourceConfig,config:{...e.dataSourceConfig?.config}},(e.attributes||[]).forEach(s=>{const r=this._createDataSchemaAttributeByConfig(s);this._dataSchema.addAttribute(r)}),this}build(){return this._dataSchema.clone()}}class Qd extends la{get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,`Entity schema with name '${t}' not found.`),this._entitySchemaName=t}}class eh extends la{constructor(e){super(e,`Entity schema name for data source ${e.dataSourceName} is not provided`)}}class th extends Error{constructor(e){super(`Item with key '${e}' does not exist.`)}}var Cs;(function(i){i[i.None=0]="None",i[i.Asc=1]="Asc",i[i.Desc=2]="Desc"})(Cs||(Cs={}));class ot{constructor(e){this.orderDirection=Cs.None,this.orderPosition=-1,this.isVisible=!0,this.expression=e}withOrdering(e,t){return H.checkArgumentEmpty("orderDirection",e),H.checkArgumentEmpty("orderPosition",t),H.checkArgumentOutOfRange("orderPosition",t,{begin:-1}),this.orderDirection=e,this.orderPosition=t,this}withOptions(e){return H.checkArgumentEmpty("options",e),this.isVisible=e.isVisible??!0,this}withCaption(e){return H.checkArgumentEmpty("caption",e),this.caption=e,this}_getUsedColumns(){return this.expression._getUsedColumns()}toJson(){return(0,de.instanceToPlain)(this,{exposeUnsetFields:!1,excludePrefixes:["_"]})}}class sh extends ot{constructor(e){super(new se({columnPath:e}))}}class Or extends Ge{static{this._instanceOfKey="devkit_SubQueryExpression"}static get _instanceOfKeys(){return[...Ge._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Ce.SubQuery,this.columnPath=e?.columnPath;const t=e?.subFilters;typeof t?.clone=="function"?this.subFilters=t.clone():t?(this.subFilters=new me(t.logicalOperation,t.rootSchemaName),this.subFilters.isEnabled=t.isEnabled,Object.entries(t.items).forEach(([s,r])=>{this.subFilters.add(r,s)})):this.subFilters=t,this.subOrderDirection=e.subOrderDirection,this.subOrderColumn=e.subOrderColumn}static fromJson(e,t){return new Or({columnPath:e.columnPath,subFilters:t.fromJson(e.subFilters),subOrderDirection:e.subOrderDirection,subOrderColumn:e.subOrderColumn})}clone(){return new Or(this)}toJson(){const e=super.toJson();return this.subFilters&&(e.subFilters=this.serializeItem(this.subFilters)),e}_getUsedColumns(){return[{path:this.columnPath},...this.subFilters?._getUsedColumns()??[]]}}class kr extends Or{static{this._instanceOfKey="devkit_AggregationSubQueryExpression"}static get _instanceOfKeys(){return[...Or._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.aggregationType=e?.aggregationType,this.functionType=e?.functionType}static fromJson(e,t){const s=super.fromJson(e,t);return new kr({aggregationType:e.aggregationType,functionType:e.functionType,...s})}clone(){return new kr(this)}}class rh extends ot{constructor(e,t,s,r,n){super(new kr({aggregationType:t,columnPath:e,subFilters:s,subOrderDirection:r,subOrderColumn:n}))}}class nh extends ot{constructor(e,t){super(new ae({value:e,dataValueType:t}))}}class Lr extends Ge{static{this._instanceOfKey="devkit_ArithmeticExpression"}static get _instanceOfKeys(){return[...Ge._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.expressionType=Ce.ArithmeticOperation,this.arithmeticOperation=e?.arithmeticOperation,this.leftArithmeticOperand=e?.leftArithmeticOperand.clone(),this.rightArithmeticOperand=e?.rightArithmeticOperand.clone()}static fromJson(e,t,s){const r=s?.fromJson(e.leftArithmeticOperand,t),n=s?.fromJson(e.rightArithmeticOperand,t),a={leftArithmeticOperand:r,rightArithmeticOperand:n,arithmeticOperation:e.arithmeticOperation,isBlock:e.isBlock};return new Lr(a)}clone(){return new Lr(this)}_getUsedColumns(){return[...this.leftArithmeticOperand._getUsedColumns(),...this.rightArithmeticOperand._getUsedColumns()]}}class ih extends ot{constructor(e,t,s){super(new Lr({arithmeticOperation:e,leftArithmeticOperand:t,rightArithmeticOperand:s}))}}class ah extends ot{constructor(e){super(new Jt({macrosType:e}))}}class Mt extends Gn{static{this._instanceOfKey="devkit_ArgumentFunctionExpression"}static get _instanceOfKeys(){return[...Gn._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionArgument=e?.functionArgument?.clone()}toJson(){const e=super.toJson();return this.functionArgument&&(e.functionArgument=this.serializeItem(this.functionArgument)),e}_getUsedColumns(){return this.functionArgument?._getUsedColumns()??[]}}class Zt extends Mt{static{this._instanceOfKey="devkit_DatePartFunctionExpression"}static get _instanceOfKeys(){return[...Mt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=Me.DatePart,this.datePartType=e?.datePartType}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t),n=e.datePartType;return new Zt({functionArgument:r,datePartType:n,isBlock:e.isBlock})}clone(){return new Zt(this)}}class oh extends ot{constructor(e,t){super(new Zt({datePartType:e,functionArgument:t}))}get datePartType(){return this.expression?.datePartType}}class Br extends Mt{static{this._instanceOfKey="devkit_AggregationFunctionExpression"}static get _instanceOfKeys(){return[...Mt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=Me.Aggregation,this.aggregationType=e?.aggregationType,this.aggregationEvalType=e?.aggregationEvalType}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t),n=e.aggregationType,a=e.aggregationEvalType;return new Br({functionArgument:r,aggregationType:n,aggregationEvalType:a,isBlock:e.isBlock})}clone(){return new Br(this)}}class ch extends ot{constructor(e,t,s){super(new Br({aggregationType:e,aggregationEvalType:t,functionArgument:s}))}}class Fr extends Mt{static{this._instanceOfKey="devkit_LengthFunctionExpression"}static get _instanceOfKeys(){return[...Mt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=Me.Length}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t);return new Fr({functionArgument:r,isBlock:e.isBlock})}clone(){return new Fr(this)}}class uh extends ot{constructor(e){super(new Fr({functionArgument:e}))}}class jr extends Mt{static{this._instanceOfKey="devkit_WindowFunctionExpression"}static get _instanceOfKeys(){return[...Mt._instanceOfKeys,this._instanceOfKey]}constructor(e){super(e),this.functionType=Me.Window}static fromJson(e,t,s){const r=s?.fromJson(e.functionArgument,t);return new jr({functionArgument:r,isBlock:e.isBlock})}clone(){return new jr(this)}}class lh extends ot{constructor(e){super(new jr({functionArgument:e}))}}var Yt;(function(i){i[i.None=0]="None",i[i.All=1]="All",i[i.Distinct=2]="Distinct"})(Yt||(Yt={}));class $r extends Wn{constructor(e){super(bs.Select,e),this._columns=new Map,this._queryDtoType="Terrasoft.Nui.ServiceModel.DataContract.SelectQuery",this.isDistinct=!1,this.rowCount=-1,this.rowsOffset=-1,this.useLocalization=!0,this.useRecordDeactivation=!1,this.isHierarchical=!1,this.hierarchicalMaxDepth=0,this.hierarchicalFullDataLoad=!1,this.hierarchicalColumnFiltersValue=new me,this._getIsPageable=()=>this.rowCount>0&&this.rowsOffset>-1}_internalAddColumn(e,t){this._columns.has(e)||this._columns.set(e,t)}getColumn(e){if(!this._columns.has(e))throw new th(e);return this.findColumn(e)}findColumn(e){return this._columns.get(e)}getMetadata(){return{...super.getMetadata(),columns:{items:(0,de.classToPlain)(this._columns,{exposeUnsetFields:!1,excludePrefixes:["_"]})},allColumns:!1,isDistinct:this.isDistinct,ignoreDisplayValues:!1,rowCount:this.rowCount,rowsOffset:this.rowsOffset,adminUnitRoleSources:this.adminUnitRoleSources,isPageable:this._getIsPageable(),conditionalValues:this.conditionalValues?this.conditionalValues:null,isHierarchical:this.isHierarchical,hierarchicalMaxDepth:this.hierarchicalMaxDepth,hierarchicalColumnName:this.hierarchicalColumnName,hierarchicalColumnValue:this.hierarchicalColumnValue,hierarchicalFullDataLoad:this.hierarchicalFullDataLoad,useLocalization:this.useLocalization,useRecordDeactivation:this.useRecordDeactivation}}addColumn(e,t){return this._internalAddColumn(t,e),e}addSchemaColumn(e,t){H.checkArgumentEmpty("columnPath",e);const s=new sh(e);return this._internalAddColumn(t||e,s),s}addAggregationSubQueryColumn(e,t,s,r){const n=new rh(e,t,s.filter,s.sortByDirection,s.sortByColumn);return this._internalAddColumn(r||e,n),n}addParameterColumn(e,t,s){const r=new nh(e,t);return this._internalAddColumn(s,r),r}addArithmeticColumn(e,t,s,r){const n=new ih(e,t,s);return this._internalAddColumn(r,n),n}addMacrosFunctionColumn(e,t){const s=new ah(e);return this._internalAddColumn(t,s),s}addDatePartFunctionColumn(e,t,s){const r=new se({columnPath:e}),n=new oh(t,r);return this._internalAddColumn(s,n),n}addAggregationFunctionColumn(e,t,s,r=Yt.None){const n=new se({columnPath:e}),a=new ch(t,r,n);return this._internalAddColumn(s,a),a}addLengthFunctionColumn(e,t){const s=new se({columnPath:e}),r=new uh(s);return this._internalAddColumn(t,r),r}addWindowFunctionColumn(e,t,s,r=Yt.None){const n=new Br({aggregationType:t,aggregationEvalType:r,functionArgument:new se({columnPath:e})}),a=new lh(n);return this._internalAddColumn(s,a),a}_getUsedColumns(){const e=[];return this._columns.forEach(t=>{e.push(...t._getUsedColumns())}),e.forEach(t=>{t.schemaName||(t.schemaName=this.rootSchemaName)}),[...e,...super._getUsedColumns()]}}function dh(i){switch(i){case"asc":return Cs.Asc;case"desc":return Cs.Desc;default:return Cs.None}}const wu=new c.InjectionToken("A factory of entity schema column appender"),Pu=new c.InjectionToken("A factory of data schema to data source attribute converter");class hh{_getExpressionColumnPath(e,t){const s="[{referenceSchemaName}:{referenceAttributeName}:{attributeName}]",r=e.relationData.map(p=>Ct.String.format(s,p)).join("."),n=e.attributePath.split("."),a=n.length>1?"{ownColumnPath}.{relationString}.{columnPath}":"{relationString}.{columnPath}";n.pop();const d={ownColumnPath:n.join("."),relationString:r,columnPath:t};return Ct.String.format(a,d)}_updateFilterLeftExpression(e,t){switch(e.expressionType){case Ce.SchemaColumn:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case Ce.SubQuery:e.columnPath=this._getExpressionColumnPath(t,e.columnPath);break;case Ce.Function:e.functionType!==Me.Macros&&this._updateFilterLeftExpression(e.functionArgument,t);break}}_updateRelatedFilterGroup(e,t){e instanceof me?this._updateRelatedFilterGroupInstance(e,t):this._updateRelatedFilterGroupObject(e,t)}_updateRelatedFilterGroupObject(e,t){Object.values(e.items).forEach(s=>{this._updateRelatedFilter(s,t)})}_updateRelatedFilterGroupInstance(e,t){e.filters.forEach(s=>this._updateRelatedFilter(s,t))}_updateRelatedFilter(e,t){if(e.filterType!==ie.FilterGroup){const s=e.leftExpression;s&&this._updateFilterLeftExpression(s,t)}else this._updateRelatedFilterGroup(e,t)}convertToRelatedFilter(e,t=[]){if(!e)return e;let s;if(e instanceof Sr)s=e.clone();else{const r=JSON.stringify(e);s=JSON.parse(r)}return[...t].reverse().forEach(r=>{r.relationData&&r.relationData.length!==0&&this._updateRelatedFilter(s,r)}),s}}const ph="invalidate-data-schema-cache";class ct{constructor(e,t){this._entitySchemaRepository=e,this._broadcastChannelFactory=t,this._dataSchemas=new Map,this._subscribeOnChangesInDesigner()}_subscribeOnChangesInDesigner(){this._broadcastChannelFactory.createInstance(ph).messages$.subscribe(({schemaName:e})=>{this._removeCachedSchema(e)})}_createEntityDataSchema(e){const t=new Iu;return t.setEntitySchema(e),(0,o.of)(t.build())}_getEntityDataSchema(e){return this._entitySchemaRepository.getSchemaByName(e).pipe((0,l.switchMap)(t=>this._createEntityDataSchema(t)))}_removeCachedSchema(e){this._dataSchemas.has(e)&&(this._dataSchemas.delete(e),this._entitySchemaRepository.clearSchemaCacheByName(e))}get(e){return this._dataSchemas.has(e)?(0,o.of)(this._dataSchemas.get(e)):this._getEntityDataSchema(e).pipe((0,l.tap)(t=>this._dataSchemas.set(e,t)))}getByEntitySchema(e){const t=e.name;return this._dataSchemas.has(t)?(0,o.of)(this._dataSchemas.get(t)):this._createEntityDataSchema(e).pipe((0,l.tap)(s=>this._dataSchemas.set(t,s)))}static{this.\u0275fac=function(t){return new(t||ct)(c.\u0275\u0275inject(rt),c.\u0275\u0275inject(O.Vx))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ct,factory:ct.\u0275fac,providedIn:"platform"})}}class Ur{constructor(e,t){this._dataSchemaRepository=e,this._featureValues=t}_getDataSchema(e){var t=this;return(0,S.A)(function*(){const s=yield(0,o.firstValueFrom)(t._dataSchemaRepository.get(e));if(!s)throw new Error(`Can not find DataSchema with name '${e}'`);return s})()}_getDataSchemaAttribute(e,t){var s=this;return(0,S.A)(function*(){const r=e instanceof vt?e:yield s._getDataSchema(e),n=r.findAttributeByName(t);if(!n)throw new Error(`Can not find column '${t}' in Schema '${r.name}'`);return n})()}_getDataSchemaPrimaryAttribute(e){var t=this;return(0,S.A)(function*(){const s=yield t._getDataSchema(e);return t._getDataSchemaAttribute(s,s.primaryAttributeName)})()}_createRelationPathItemFromForwardPathItem(e,t){var s=this;return(0,S.A)(function*(){const r=yield s._getDataSchemaAttribute(e,t);let n=null,a=null;const u=r.dataValueType===A.r.Lookup;return u&&(n=r.referenceSchemaName,a=(yield s._getDataSchema(n)).primaryAttributeName),{isJoin:u,referenceSchemaName:n,referenceAttributeName:a,ownSchemaAttributeName:t,ownSchemaName:e}})()}_createRelationPathItemFromJoinPathItem(e,t,s,r){var n=this;return(0,S.A)(function*(){const a=s?yield n._getDataSchemaAttribute(t,s):yield n._getDataSchemaPrimaryAttribute(t);return{isJoin:!0,referenceSchemaName:t,referenceAttributeName:a.name,ownSchemaAttributeName:r,ownSchemaName:e}})()}_createRelationPathItem(e,t){const r=/(?<joinType>.*)\[(?<refSchema>.*?):(?<ownColumn>.*?)(?::(?<refColumn>.*))?]/.exec(t);if(r){const n=r.groups;return this._createRelationPathItemFromJoinPathItem(e,n.refSchema,n.refColumn,n.ownColumn)}return this._createRelationPathItemFromForwardPathItem(e,t)}_getReverseRelationPath(e){const t=[...e],s=[];let r;for(;(r=t.pop())!=null;)s.push({isJoin:!0,ownSchemaName:r.referenceSchemaName,ownSchemaAttributeName:r.referenceAttributeName,referenceSchemaName:r.ownSchemaName,referenceAttributeName:r.ownSchemaAttributeName});return s}_buildRelationPath(e,t){var s=this;return(0,S.A)(function*(){const r=t.split("."),n=[];let a=e;for(const u of r){const d=yield s._createRelationPathItem(a,u);a=d.referenceSchemaName,n.push(d)}return n})()}_getRelationPathToSourceSchema(e,t,s){var r=this;return(0,S.A)(function*(){const n=[...t],a=n.pop(),u=s.split("."),p=(yield r._buildRelationPath(e,s)).pop(),g={isJoin:!0,ownSchemaName:a.isJoin?a.referenceSchemaName:a.ownSchemaName,ownSchemaAttributeName:a.isJoin?a.referenceAttributeName:a.ownSchemaAttributeName,referenceSchemaName:p.ownSchemaName,referenceAttributeName:u.pop()},C=[...n,...a.isJoin?[a]:[],g];return r._featureValues.DisableDsDepsJoinOptimization||C.length===1?C:C.filter(I=>{if(!I.isJoin)return!0;const W=I.ownSchemaName===I.referenceSchemaName,X=I.ownSchemaAttributeName===I.referenceAttributeName;return!(W&&X)})})()}_buildRelationDataFromPath(e){return e.map(t=>({attributeName:t.ownSchemaAttributeName,referenceAttributeName:t.referenceAttributeName,referenceSchemaName:t.referenceSchemaName}))}_getDataSourceParameterRelationData(e,t){var s=this;return(0,S.A)(function*(){const r=yield s._buildRelationPath(t.dataSchemaName,t.relationPath),n=yield s._getRelationPathToSourceSchema(e,r,t.attributePath),a=s._getReverseRelationPath(n);return s._buildRelationDataFromPath(a)})()}_getIsSelfSchemaRelation(e,t){return!this._featureValues.DisableSkipDSEqualRelations&&t.dataSchemaName===e&&t.attributePath===t.relationPath&&t.attributePath.split(".").length===1}_convertEntityDataSourceParameter(e,t){var s=this;return(0,S.A)(function*(){if(!t.relationsConfigs||t.relationsConfigs.length===0)return t;let r=e.name;const n=[];for(const a of t.relationsConfigs){if(s._getIsSelfSchemaRelation(r,a)){a.attributePath===e.primaryAttributeName||n.push({...a,relationData:[{referenceSchemaName:a.dataSchemaName,attributeName:a.attributePath,referenceAttributeName:a.relationPath}]});continue}const d=yield s._getDataSourceParameterRelationData(r,a);r=d[d.length-1].referenceSchemaName,n.push({...a,relationData:d})}return{...t,relationsConfigs:n}})()}convert(e,t,s=!1){return t.length===0?Promise.resolve([]):s?Promise.resolve(t):Promise.all(t.map(r=>this._convertEntityDataSourceParameter(e,r)))}static{this.\u0275fac=function(t){return new(t||Ur)(c.\u0275\u0275inject(ct),c.\u0275\u0275inject(F))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ur,factory:Ur.\u0275fac,providedIn:"root"})}}class As{constructor(e,t){this._dataSchemaRepository=e,this._parametersConverter=t}_createPrimaryColumnValueFilter(e,t){const n=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(n).pipe((0,o.map)(a=>{const u=new se({columnPath:a.primaryAttributeName}),d=new ae({value:t.value});return new Ne(ne.Equal,u,d)}))}_createColumnValueFilter(e){const t=e.value.attributePath,s=e.value.attributeValue,r=new se({columnPath:t}),n=new ae({value:s}),a=new Ne(ne.Equal,r,n);return(0,o.of)(a)}_createPrimaryDisplayValueFilter(e,t){const n=(t.relationsConfigs||[])[0]?.dataSchemaName??e;return this._dataSchemaRepository.get(n).pipe((0,o.map)(a=>{const u=new se({columnPath:a.primaryDisplayAttributeName}),d=new ae({value:t.value});return new Ne(t.comparisonType,u,d)}))}_createCustomFilter(e){let t={};return e.value&&(t=typeof e.value=="string"?JSON.parse(e.value):e.value),(0,o.of)(t)}_createEmptyParameterFiler(e){const t=e.relationsConfigs||[];if(t.length===0)return(0,o.of)({});const s=t[0];return this._dataSchemaRepository.get(s.dataSchemaName).pipe((0,o.map)(r=>r.primaryAttributeName),(0,o.map)(r=>{const n=new se({columnPath:r});return new Gt(n,null)}))}_createEsqFilter(e,t){switch(t.type){case B.PrimaryColumnValue:return this._createPrimaryColumnValueFilter(e,t);case B.ColumnValue:return this._createColumnValueFilter(t);case B.PrimaryDisplayValueFilter:return this._createPrimaryDisplayValueFilter(e,t);case B.Filter:return this._createCustomFilter(t);case B.Empty:return this._createEmptyParameterFiler(t)}}applyParameters(e,t){if(e.length===0)return(0,o.of)(t);const s=e.map(r=>this._createEsqFilter(t.rootSchemaName,r).pipe((0,o.map)(n=>new hh().convertToRelatedFilter(n,r.relationsConfigs))));return(0,o.forkJoin)(s).pipe((0,o.tap)(r=>{r.forEach(n=>{(0,P.isEmpty)(n)||t.filters.add(n)})}),(0,o.map)(()=>t))}convertToEntityDataSourceParameters(e,t,s=!1){return(0,o.from)(this._parametersConverter.convert(e,t,s))}static{this.\u0275fac=function(t){return new(t||As)(c.\u0275\u0275inject(ct),c.\u0275\u0275inject(Ur))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:As,factory:As.\u0275fac,providedIn:"root"})}}class vs{constructor(e,t,s){this.entitySchemaQueryUtils=e,this._entitySchemaColumnAppenderFactory=t,this._dataSchemaToDataSourceAttributeConverter=s}_addPagingToEsq(e,t){t&&(e.rowsOffset=t.rowsOffset,e.rowCount=t.rowCount)}_addSortingToEsq(e,t){t&&t.columns.forEach((s,r)=>{const n=e.findColumn(s.columnName),a=dh(s.direction);n?n.withOrdering(a,r):e.addSchemaColumn(s.columnName).withOrdering(a,r)})}_addIsDistinctToEsq(e,t){t&&(e.isDistinct=!0)}_excludeHierarchyFiltersFromFiltersCollection(e,t){return t.map(s=>s?.type!==B.Filter||!s?.value||e.hierarchicalColumnFiltersValue!==s.value?s:null).filter(s=>!!s)}_addHierarchyOptionsToEsq(e,t){t&&(t.hierarchicalFullDataLoad&&(e.hierarchicalFullDataLoad=t.hierarchicalFullDataLoad),t.hierarchicalColumnName&&(e.hierarchicalColumnName=t.hierarchicalColumnName,e.isHierarchical=!0),t.hierarchicalColumnValue&&(e.hierarchicalColumnValue=t.hierarchicalColumnValue),t.hierarchicalMaxDepth&&(e.hierarchicalMaxDepth=t.hierarchicalMaxDepth),t.hierarchicalColumnFiltersValue&&(e.hierarchicalColumnFiltersValue=t.hierarchicalColumnFiltersValue))}_addColumnToEsq(e,t){t.filter(Boolean).forEach(s=>{this._entitySchemaColumnAppenderFactory.create(s).addColumn(e,s)})}_prepareAttributePairsForLoad(e,t){return t.map(s=>{if(typeof s=="string"){const r=s,n=e.attributes.find(a=>a.name===r);return n?this._dataSchemaToDataSourceAttributeConverter.create(n.attributeType).convert(n):{name:r,path:r}}else return s})}_applyESQParameters(e,t){return e.hierarchicalColumnFiltersValue&&(t=this._excludeHierarchyFiltersFromFiltersCollection(e,t)),this.entitySchemaQueryUtils.applyParameters(t,e)}build(e,t,s,r){if(s.some(n=>n.type===B.Never))throw new Error('Failed to build entity schema query: parameters contains "Never" model parameter.');return(0,o.forkJoin)([this.entitySchemaQueryUtils.convertToEntityDataSourceParameters(e,s),(0,o.of)(this._prepareAttributePairsForLoad(e,t))]).pipe((0,o.map)(([n,a])=>({esq:new $r(e.name),esqParameters:n,dataSourceAttributes:a})),(0,o.tap)(({esq:n,dataSourceAttributes:a})=>this._addColumnToEsq(n,a)),(0,o.tap)(({esq:n})=>this._addSortingToEsq(n,r?.sortingConfig)),(0,o.tap)(({esq:n})=>this._addPagingToEsq(n,r?.pagingConfig)),(0,o.tap)(({esq:n})=>this._addIsDistinctToEsq(n,r?.isDistinct)),(0,o.tap)(({esq:n})=>this._addHierarchyOptionsToEsq(n,r?.hierarchyConfig)),(0,o.switchMap)(({esq:n,esqParameters:a})=>this._applyESQParameters(n,a)))}static{this.\u0275fac=function(t){return new(t||vs)(c.\u0275\u0275inject(As),c.\u0275\u0275inject(wu),c.\u0275\u0275inject(Pu))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:vs,factory:vs.\u0275fac,providedIn:"root"})}}const ba=i=>{switch(i){case A.r.Guid:return A.r.Guid;case A.r.Text:case A.r.SHORT_TEXT:case A.r.PHONE_TEXT:case A.r.WEB_TEXT:case A.r.EMAIL_TEXT:case A.r.MEDIUM_TEXT:case A.r.MAXSIZE_TEXT:case A.r.LONG_TEXT:case A.r.HASH_TEXT:case A.r.SECURE_TEXT:case A.r.RICH_TEXT:return A.r.Text;case A.r.Integer:case A.r.Enum:return A.r.Integer;case A.r.Float:case A.r.FLOAT0:case A.r.FLOAT1:case A.r.FLOAT2:case A.r.FLOAT3:case A.r.FLOAT4:case A.r.FLOAT8:case A.r.MONEY0:case A.r.MONEY1:case A.r.Money:case A.r.MONEY3:return A.r.Float;case A.r.DateTime:case A.r.Date:case A.r.Time:return A.r.DateTime;case A.r.Lookup:case A.r.IMAGELOOKUP:return A.r.Lookup;case A.r.Boolean:return A.r.Boolean;case A.r.Blob:return A.r.Blob;case A.r.Image:return A.r.Image;case A.r.Color:return A.r.Color;default:throw new Error(`Type ${i} not implemented`)}};function Um(i,e=null,t=DataValueType.Float){if(!i||i.length===0)return e;if(i.length===1)return i[0];let s=i.map(r=>ba(r)).map(r=>DataValueTypeGroup.Number.includes(r)?t:r);return s=[...new Set(s)],s.length===1?s[0]:e}class mh extends da{constructor(){super(...arguments),this.supportTransactions=!0}}class qr extends mh{get isForceUpdateUnchangedData(){return!!this.initialConfig?.isForceUpdateUnchangedData}get affectedAttributes(){return[...this._affectedAttributes]}get isAggregate(){return this.dataSchema?this.dataSchema.attributes.some(t=>t.isAggregate):!1}get entitySchemaName(){return this._entitySchemaName}constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._affectedAttributes=[],this._errorReferenceAttributes=[],this.type=Cu,this._featureValues=t.get(F),this._queryExecutor=t.get(Le),this._entitySchemaService=t.get(At),this._httpClient=this.injector.get(N.HttpClient),this._rightsService=this.injector.get(ga),this.dataSchemaRepository=this.injector.get(ct),this._entitySchemaRepository=this.injector.get(rt),this._entitySchemaQueryBuilder=this.injector.get(vs),this._entitySchemaQueryUtils=this.injector.get(As),this._window=this.injector.get(O.ZP),this._measurePerformanceService=this.injector.get(te.g);const s=this.injector.get(We.oq);this._entityDefaultValuesUrl=s.isSSP?"/ssp/rest/EntitySchemaService/GetEntityDefaultValues":"/rest/EntitySchemaService/GetEntityDefaultValues",this.translateService=this.injector.get(T.TranslateService)}_buildSelectEsq(e,t,s){return this.getSchema().pipe((0,l.switchMap)(r=>this._entitySchemaQueryBuilder.build(r,e,t,s)),(0,l.map)(r=>(this._featureValues["DataSource-DisableRecordDeactivation"]!==!0&&(r.useRecordDeactivation=this.initialConfig.useRecordDeactivation),r.adminUnitRoleSources=this._getEsqAdminUnitRoleSources(),r)))}_getEsqAdminUnitRoleSources(){let e;const t=this.initialConfig.adminUnitRoleSources;return(0,P.isNumber)(t)?t:((0,P.isArray)(t)&&t.forEach(s=>{const r=ha[s];(0,P.isNumber)(r)&&(e=e|r)}),e)}_normalizeValue(e,t){switch(t){case A.r.Lookup:return e||null;case A.r.Date:case A.r.Time:case A.r.DateTime:return e instanceof Date?lu(e):typeof e=="string"&&Date.parse(e)>0?`"${e}"`:e;default:return e}}_buildUpdateEsq(e,t){return this.getSchema().pipe((0,l.switchMap)(s=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(s,e,!0)),(0,l.map)(s=>({updateQuery:new pa(this._entitySchemaName),esqParameters:s})),(0,l.tap)(({updateQuery:s})=>{s.isForceUpdate=!!this.initialConfig.isForceUpdate,Object.keys(t).forEach(r=>{const n=this._findEntitySchemaColumn(r);if(!n)throw new Error(`Column ${r} not found`);const a=t[r];this._isEntityColumnValue(a)&&s.addColumn(n.name,this._normalizeValue(a,n.dataValueType),ba(n.dataValueType))})}),(0,l.switchMap)(({updateQuery:s,esqParameters:r})=>this._entitySchemaQueryUtils.applyParameters(r,s)),(0,l.catchError)(s=>(0,o.throwError)(()=>s)))}_buildInsertEsq(e){const t=new ma(this._entitySchemaName);return Object.keys(e).forEach(s=>{const r=this._findEntitySchemaColumn(s);if(!r)throw new Error(`Column ${s} not found`);const n=e[s];this._isEntityColumnValue(n)&&t.addColumn(r.name,this._normalizeValue(n,r.dataValueType),ba(r.dataValueType))}),t}_buildDeleteEsq(e){return this.getSchema().pipe((0,l.switchMap)(t=>this._entitySchemaQueryUtils.convertToEntityDataSourceParameters(t,e,!0)),(0,l.switchMap)(t=>{const s=new Mu(this._entitySchemaName);return this._entitySchemaQueryUtils.applyParameters(t,s)}))}_checkOwnAttributes(e){return this.getSchema().pipe((0,l.switchMap)(t=>{const s=t.attributes.filter(r=>r.attributeType!==Z.OwnAttribute).filter(r=>!(0,P.isUndefined)(e[r.name]));return s.length!==0?(0,o.throwError)(()=>new Error(`Not valid attributes for this data source: ${s.map(r=>r.name).join(",")}`)):(0,o.of)(null)}))}_findEntitySchemaColumn(e){return this._entitySchema.columns.find(t=>t.name===e)}_isEntityColumnValue(e){const t=s=>typeof s=="object"&&(s===null||"value"in s);return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="bigint"||e instanceof Date||t(e)}_parseDefaultValues(e,t){const s=new Map(e.attributes.map(r=>[r.name,r.dataValueType]));return t.reduce((r,n)=>{const{defaultValue:a,name:u}=n;if((0,P.isNil)(a.value))return r;if(a.displayValue)return{...r,[u]:a};const d=_a(a.value,s.get(u));return{...r,[u]:d}},{})}_getDefaultValues(e){const t=`${this._entityDefaultValuesUrl}?entityName=${e}`;return this._httpClient.get(t).pipe((0,l.catchError)(s=>this._catchErrorResponse(s)),(0,l.map)(s=>s.GetEntityDefaultValuesResult),(0,l.mergeMap)(s=>this.getSchema().pipe((0,l.tap)(r=>{let n=this._window.defaultValueStorage;const a=s?.find(u=>u.name===r.primaryAttributeName)?.defaultValue?.value;if(n=n||{},a){const u=`${e}_${a}`;n[u]=s,this._window.defaultValueStorage=n}}),(0,l.map)(r=>this._parseDefaultValues(r,s)))))}_catchErrorResponse(e){return console.log(e),(0,o.of)({GetEntityDefaultValuesResult:[]})}_requestEntitySchemaColumnsInfo(e){const t=e.map(s=>s.attributePath);return this._entitySchemaService.getEntitySchemaColumnsInformationByPathsArray(this._entitySchema.uId,t).pipe((0,l.map)(s=>e.map(r=>({column:s[r.attributePath],config:r}))))}_getEntitySchemaForwardReferenceColumnsInfo(e){const t={name:this._entitySchemaName,loadLookupColumns:!1,forwardReferencePaths:e.map(s=>s.attributePath)};return this._entitySchemaRepository.getSchemes([t]).pipe((0,l.map)(()=>e.map(s=>{const r=s.attributePath.split("."),n=this._entitySchemaRepository.findEntitySchemaColumnByPath(this._entitySchemaName,r);return{column:new aa(n),config:s}})))}_createReferenceAttributes(e,t){return t.length===0?(0,o.of)(e):(0,o.of)(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"]).pipe((0,l.switchMap)(s=>s?this._requestEntitySchemaColumnsInfo(t):this._getEntitySchemaForwardReferenceColumnsInfo(t))).pipe((0,l.tap)(s=>{s.forEach(({column:r,config:n})=>{n.attributeType===Z.AggregationAttribute&&n.aggregationConfig?.aggregationFunction===at.Count&&(r.dataValueType=A.r.Integer),e.addAttribute(r,n)})}),(0,l.map)(()=>e))}_createAttributesFromInitialConfig(e,t={}){const s=[];return Object.entries(t).forEach(([r,n])=>{const a=n;a.type===Z.ForwardReferenceAttribute&&s.push({attributeName:r,attributeType:Z.ForwardReferenceAttribute,attributePath:a.path}),a.type===Z.AggregationAttribute&&s.push({attributeName:r,attributeType:Z.AggregationAttribute,attributePath:a.path,aggregationConfig:a.aggregationConfig}),a.type===Z.FunctionAttribute&&s.push({attributeName:r,attributeType:Z.FunctionAttribute,attributePath:a.path,functionConfig:a.functionConfig})}),this._createReferenceAttributes(e,s).pipe((0,l.catchError)(r=>{const n=r.message&&r.toString(),a=new zd(this,n);return this._errors.push(a),s.forEach(u=>{this._errorReferenceAttributes.push(u)}),(0,o.of)(e)}))}_shouldSkipLoad(e){return e.some(t=>t.type===B.Never)}_setValidValuesForLookupAttributes(e,t){return Object.keys(t).forEach(s=>{const r=e.attributes.find(n=>n.name===s);r&&(r.dataValueType===A.r.Lookup||r.dataValueType===A.r.IMAGELOOKUP)&&t[s]===""&&(t[s]=null)}),t}_throwErrorResponse(e){const t=typeof e=="string"?e:e?.message;return(0,o.throwError)(()=>({success:!1,rowsAffected:0,errorInfo:t}))}_mapOperationResult(e){return{success:e.success,rowsAffected:e.rowsAffected}}_getIsAffectedAttributeStored(e){return this._affectedAttributes.some(t=>t.path===e.path&&t.schemaName===e.schemaName)}_collectUsedAttributes(e){let t=e._getUsedColumns();t=t.filter(s=>!this._getIsAffectedAttributeStored(s)),this._affectedAttributes.push(...t)}_findErrorReferenceAttribute(e){const t=typeof e=="string"?e:e.name;return this._errorReferenceAttributes.find(s=>s.attributeName===t)}_load(e,t,s,r){if(this.hasErrors){if(this.hasCriticalErrors)return(0,o.throwError)(()=>this.getLastError());if(e.length!==0&&e.every(a=>this._findErrorReferenceAttribute(a)!=null))return(0,o.throwError)(()=>this.getLastError())}return this._shouldSkipLoad(t)?(0,o.of)([]):this._buildSelectEsq(e,t,s||{}).pipe((0,l.tap)(n=>this._collectUsedAttributes(n)),(0,l.switchMap)(n=>{let a;const u={throttled:s?.throttled};return r?(n.queryId=r.id,a=this._queryExecutor.executeSelectQuery(n,u,r.transactionId),r.markAsReady()):a=this._queryExecutor.executeSelectQuery(n,u),a.pipe(this._measurePerformanceService.measure$(`EntityDataSource.load.executeSelectQuery.${this.dataSourceName}`),(0,l.catchError)(d=>d instanceof Jn?(0,o.throwError)(()=>d):(0,o.throwError)(()=>new Error(this.translateService.instant("BaseViewModel.LoadingModelErrorMessage")))))}),(0,l.map)(n=>n),(0,l.mergeMap)(n=>this.getSchema().pipe((0,l.map)(a=>(a.attributes&&n.forEach(u=>{this._setValidValuesForLookupAttributes(a,u)}),n)))))}_save(e,t,s){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._checkOwnAttributes(t).pipe((0,l.switchMap)(()=>this._buildUpdateEsq(e,t)),(0,l.switchMap)(r=>{if(s){r.queryId=s.id;const n=this._queryExecutor.executeUpdateQuery(r,s.transactionId);return s.markAsReady(),n}return this._queryExecutor.executeUpdateQuery(r)}),(0,l.map)(r=>this._mapOperationResult(r)),(0,l.catchError)(r=>this._throwErrorResponse(r)))}_insert(e,t){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._checkOwnAttributes(e).pipe((0,l.map)(()=>this._buildInsertEsq(e)),(0,l.switchMap)(s=>{let r;return t?(s.queryId=t.id,r=this._queryExecutor.executeInsertQuery(s,t.transactionId),t.markAsReady()):r=this._queryExecutor.executeInsertQuery(s),(0,o.forkJoin)({response:r,dataSchema:this.getSchema()})}),(0,l.map)(({response:s,dataSchema:r})=>({...this._mapOperationResult(s),primaryAttributes:[{[r.primaryAttributeName]:s.id}]})),(0,l.catchError)(s=>this._throwErrorResponse(s)))}_delete(e,t){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._buildDeleteEsq(e).pipe((0,l.tap)(s=>{s.queryId=t?.id}),(0,l.switchMap)(s=>{if(t){s.queryId=t.id;const r=this._queryExecutor.executeDeleteQuery(s,t.transactionId);return t.markAsReady(),r}return this._queryExecutor.executeDeleteQuery(s)}),(0,l.map)(s=>this._mapOperationResult(s)),(0,l.catchError)(s=>this._throwErrorResponse(s)))}innerLoad(e,t,s){return this._load(e,t,s)}innerSave(e,t){return this._save(e,t)}innerInsert(e){return this._insert(e)}innerDelete(e){return this._delete(e)}innerGetSchema(){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this.dataSchemaRepository.get(this._entitySchemaName).pipe((0,l.map)(e=>new Iu(e)),(0,l.switchMap)(e=>this._createAttributesFromInitialConfig(e,this.initialConfig.attributes)),(0,l.tap)(e=>{const t=this._getDefaultValues(this._entitySchemaName).pipe((0,l.shareReplay)({bufferSize:1,refCount:!0}));e.setAttributesDefaultValue(t)}),(0,l.map)(e=>e.build()))}innerGetLookupDataSchema(e){if(this.hasCriticalErrors)return(0,o.throwError)(()=>this.getLastError());const s=e.split(".")[0],r=this._findEntitySchemaColumn(s);return r?r.dataValueType!==A.r.Lookup?(0,o.throwError)(()=>new Error(`DataValueType for column '${s}' isn't lookup`)):r.referenceSchemaName?this.dataSchemaRepository.get(r.referenceSchemaName):(0,o.throwError)(()=>new Error(`referenceSchemaName for column '${s}' is absent`)):(0,o.throwError)(()=>new Error(`Can't find column with name '${s}'`))}innerGetDefaultValues(){return this.hasCriticalErrors?(0,o.throwError)(()=>this.getLastError()):this._getDefaultValues(this._entitySchemaName)}innerCanDelete(e){return this.hasCriticalErrors?(0,o.of)({result:!1}):this._rightsService.getCanDelete({schemaName:this.initialConfig.entitySchemaName,primaryColumnValue:e.primaryColumnValue})}innerCanCreate(e){if(this.hasCriticalErrors)return(0,o.of)({result:!1});const t={isNew:!0,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}innerCanEdit(e){if(this.hasCriticalErrors)return(0,o.of)({result:!1});const t={primaryColumnValue:e.primaryColumnValue,isNew:!1,schemaName:this.initialConfig.entitySchemaName};return this._rightsService.getCanEdit(t)}getEmptySchema(){return this._entitySchemaName?new vt({name:this._entitySchemaName}):super.getEmptySchema()}init(e,t){return super.init(e,t).pipe((0,l.mergeMap)(s=>{if(!this.initialConfig.entitySchemaName){const r=new eh(this);return this._errors.push(r),(0,o.throwError)(()=>r)}return(0,o.of)(s)}),(0,l.tap)(()=>this._entitySchemaName=this.initialConfig.entitySchemaName),(0,l.mergeMap)(s=>this._entitySchemaRepository.getSchemaByName(this.initialConfig.entitySchemaName).pipe((0,l.tap)(r=>this._entitySchema=r),(0,l.catchError)(()=>{this._entitySchema=new bu,this._entitySchema.name=this._entitySchemaName,this._entitySchema.columns=[];const r=new Qd(this,this._entitySchemaName);return this._errors.push(r),(0,o.throwError)(()=>r)}),(0,l.map)(()=>s))))}getOwnLoadParameters(){return this.initialConfig?.loadParameters}getAllowCopyingRecords(){return this.initialConfig?.allowCopyingRecords}loadInTransaction(e,t,s,r){return this._load(t,s,r,e)}saveInTransaction(e,t,s){return this._save(t,s,e)}insertInTransaction(e,t){return this._insert(t,e)}deleteInTransaction(e,t){return this._delete(t,e)}}class fh extends qr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotActionDataSource",this._intentManager=this.injector.get(zt)}_getActionUId(e){return e.filter(s=>s.type===B.PrimaryColumnValue)[0]?.value}innerDelete(e){return(0,o.of)(void 0)}innerInsert(e){const t=e;return(0,o.forkJoin)([this._intentManager.createAction(t),this.getSchema()]).pipe((0,o.map)(([s,r])=>({success:s.success,rowsAffected:1,errorInfo:s.errorInfo?.message,primaryAttributes:s.success?[{[r.primaryAttributeName]:t.Id}]:null})))}innerLoad(e,t,s){const r=this._getActionUId(t);return r?this._intentManager.getActionByUId(r).pipe((0,o.map)(n=>[n])):(0,o.of)([])}innerSave(e,t){const s=this._getActionUId(e),r=t;return r.Id=s,this._intentManager.updateAction(r).pipe((0,o.map)(n=>({success:n.success,rowsAffected:1,errorInfo:n.errorInfo?.message})))}}class Du{}const gh="CopilotIntentStatus",_h=new Map([["InDevelopment","4670b068-ad03-4364-9350-6cc61efd1b7f"],["Active","1d73b111-07a9-49e2-aa15-c9415cce7470"],["Deactivated","2c547e71-7a05-42e1-8b65-2bf63f200156"]]),yh="CopilotIntentMode",bh={Chat:"Chat",Api:"API"},Sh=new Map([["Chat","326bba59-302a-4a5e-857c-2576e1a38ab0"],["API","5f2dc095-4543-4972-b6bc-6599bf6bc3fd"]]),Tu={System:{value:"35f3b644-4fa3-4d1e-8e62-5c3fdc4d3e52",displayValue:"System",primaryColorValue:"#22AC14"},Skill:{value:"6d940b75-21c8-4a90-89ab-9867e6e4a045",displayValue:"Skill",primaryColorValue:"#7848EE"},Agent:{value:"a8fbe253-be1b-4ec4-bc58-65b8047013da",displayValue:"Agent",primaryColorValue:"#E67E22"}};function Ch(){return(0,o.of)(Object.values(Tu))}class Hr{constructor(e){this._entitySchemaService=e}_loadPrimaryColumns(e){return this._entitySchemaService.getEntitySchemaByName(e).pipe((0,l.map)(t=>{const s=t.entitySchema.getPrimaryColumn(),r=t.entitySchema.getPrimaryDisplayColumn();if((0,P.isEmpty)(r))throw new Error(`Entity ${e} should have primary display column`);return{primaryColumnName:s.name,primaryDisplayColumnName:r?.name}}))}getColumnLookupValues(e){if((0,P.isEmpty)(e))return(0,o.of)(null);const t=this._loadPrimaryColumns(e),s=(0,o.from)(nt.create(e));return(0,o.forkJoin)([t,s]).pipe((0,l.switchMap)(([r,n])=>(0,o.from)(n.load({attributes:[r.primaryColumnName,r.primaryDisplayColumnName]})).pipe((0,l.map)(u=>u.map(d=>({value:d[r.primaryColumnName],displayValue:d[r.primaryDisplayColumnName]}))))))}static{this.\u0275fac=function(t){return new(t||Hr)(c.\u0275\u0275inject(At))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Hr,factory:Hr.\u0275fac,providedIn:"root"})}}class Kr{constructor(e,t){this._columnLookupValuesService=e,this._injector=t,this._intentStatuses=_h,this._intentModes=Sh}convertToDataSourceModel(e){const t=this._injector.get(Du);return(0,o.combineLatest)([this._columnLookupValuesService.getColumnLookupValues(gh),this._columnLookupValuesService.getColumnLookupValues(yh),Ch(),t.getAllLlmModels()]).pipe((0,o.map)(([s,r,n])=>{const a=this._intentStatuses.get(e.Status),u=s.find(X=>X.value===a),d=this._intentModes.get(e.Mode)??this._intentModes.get(bh.Chat),p=r.find(X=>X.value===d),g=n.find(X=>X.displayValue===e.Type),C=t.getModelByCodeSync(e.LlmModel),I={Id:e.UId,Code:e.Code,Description:e.Description,Prompt:e.Prompt,Type:g,Name:e.Title,Status:u,PackageUId:e.PackageUId,LlmModel:C?{value:C.Id,displayValue:C.Name}:null,ResponseFormatJsonSchema:e.ResponseFormatJsonSchema};return e.Type==="Agent"?{...I,Restrictions:e.Restrictions,RoleDescription:e.RoleDescription}:{...I,Mode:p}}))}convertToModel(e){const t={};for(const[s,r]of Object.entries(e)){let n=s,a=r;s==="Name"&&(n="Title"),s==="Id"&&(n="UId"),s==="Status"&&(a=[...this._intentStatuses].filter(([,u])=>u===e.Status.value).map(([u])=>u).shift()),s==="Mode"&&(a=[...this._intentModes].filter(([,u])=>u===e.Mode.value).map(([u])=>u).shift()),s==="Type"&&(a=Object.values(Tu).filter(u=>u.value===e.Type.value).map(u=>u.displayValue).shift()),s==="LlmModel"&&(a=this._injector.get(Du).getModelByNameSync(e.LlmModel?.displayValue)?.Code),t[n]=a}return t}static{this.\u0275fac=function(t){return new(t||Kr)(c.\u0275\u0275inject(Hr),c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Kr,factory:Kr.\u0275fac,providedIn:"root"})}}class Ah extends qr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this._defaultValuesMap=new Map,this.type="crt.CopilotIntentDataSource",this._intentManager=this.injector.get(zt),this._copilotIntentDataSourceModelConvertor=this.injector.get(Kr),this._initDefaultValuesMap()}_initDefaultValuesMap(){this._defaultValuesMap.set("CopilotIntent",{UId:(0,j.qv)(),Status:"Active",Mode:"Chat",Type:"Skill",Prompt:this.translateService.instant("CopilotIntentDataSource.DefaultValues.Prompt")}),this._defaultValuesMap.set("CopilotAgent",{UId:(0,j.qv)(),Status:"Active",Type:"Agent"})}innerGetDefaultValues(){const e=this.initialConfig.entitySchemaName,t=this._defaultValuesMap.get(e);return this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(t)}innerInsert(e){const t=this._copilotIntentDataSourceModelConvertor.convertToModel({...e});return(0,o.forkJoin)([this._intentManager.createIntent(t),this.getSchema()]).pipe((0,o.map)(([s,r])=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message,primaryAttributes:[{[r.primaryAttributeName]:s.schemaUid}]})),(0,l.switchMap)(s=>s.success?(0,o.of)(s):(0,o.throwError)(()=>s)))}innerLoad(e,t,s){const r=t.filter(n=>n.type===B.PrimaryColumnValue);if(r.length)return this._intentManager.getIntent(r[0].value).pipe((0,l.switchMap)(n=>this._copilotIntentDataSourceModelConvertor.convertToDataSourceModel(n).pipe((0,o.map)(a=>[a]))))}innerSave(e,t){const r=e.filter(a=>a.type===B.PrimaryColumnValue)[0].value,n=this._copilotIntentDataSourceModelConvertor.convertToModel({...t});return n.UId=r,this._intentManager.updateIntent(n).pipe((0,o.map)(a=>({success:a.success,rowsAffected:a.success?1:0,errorInfo:a.errorInfo?.message})),(0,l.switchMap)(a=>a.success?(0,o.of)(a):(0,o.throwError)(()=>a)))}}class vh{static fromJson(e){throw new Error("not implemented")}}class Eh{static resolve(e){return{[ie.Compare]:Ne,[ie.FilterGroup]:me,[ie.In]:Wt,[ie.IsNull]:it,[ie.Exists]:Gt,[ie.Between]:xr}[e]}}class Mh{static fromJson(e,t){throw new Error("not implemented")}}class Rh{static resolve(e){return{[Me.Macros]:Jt,[Me.Length]:Fr,[Me.Window]:jr,[Me.DatePart]:Zt,[Me.DateAdd]:Zt,[Me.DateDiff]:Zt}[e.functionType]}}class Ih{static resolve(e,t){return{[Ce.SchemaColumn]:se,[Ce.Parameter]:ae,[Ce.SubQuery]:kr,[Ce.ArithmeticOperation]:Lr,[Ce.Function]:Rh.resolve(t)}[e]}}class Sa extends Mh{static fromJson(e,t){const s=e.expressionType;return Ih.resolve(s,e).fromJson(e,t,Sa)}}class Es extends vh{static fromJson(e){const t=e.filterType,s=e.isEnabled,r=e.trimDateTimeParameterToDate,n=Eh.resolve(t).fromJson(e,Es,Sa);return n.isEnabled=s!==!1,n.trimDateTimeParameterToDate=r===!0,n}}class zr{convertToDataSourceModel(e){return(0,o.of)({Id:e.UId,Intent:e.Intent,Code:e.Code,Name:e.Name,Description:e.Description,SourceCollection:e.SourceCollection,DataValueTypeUId:e.DataValueTypeUId})}convertToModel(e){const t={};return Object.entries(e).forEach(([s,r])=>{s==="Id"&&(s="UId"),t[s]=r}),t}static{this.\u0275fac=function(t){return new(t||zr)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:zr,factory:zr.\u0275fac,providedIn:"root"})}}class wh extends qr{constructor(e,t){super(e,t),this.dataSourceName=e,this.injector=t,this.type="crt.CopilotIntentParameterDataSource",this._intentManager=this.injector.get(zt),this._modelConvertor=this.injector.get(zr)}_getPrimaryColumnParameter(e){return e.find(t=>t.type===B.PrimaryColumnValue&&(0,j.n7)(t.value))}_getIsIntentUIdParameter(e){return(e.relationsConfigs??[]).some(t=>t.dataSchemaName==="CopilotIntent"&&t.attributePath==="Intent")}_getSourceCollectionFilterValue(e){const t=e.find(n=>n.type===B.Filter);if(!t?.value)return null;const s=Es.fromJson(t.value);let r;return s.filters.forEach(n=>{n instanceof Ne&&n.leftExpression instanceof se&&n.leftExpression.columnPath==="SourceCollection"&&n.rightExpression instanceof ae&&(r=n.rightExpression.value)}),r}innerGetDefaultValues(){return this._modelConvertor.convertToDataSourceModel({UId:(0,j.qv)()})}innerInsert(e){const t=this._modelConvertor.convertToModel({...e});return this._intentManager.createIntentParameter(t).pipe((0,o.map)(s=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message,primaryAttributes:[{Id:t.UId}]})),(0,o.switchMap)(s=>s.success?(0,o.of)(s):(0,o.throwError)(()=>s)))}innerLoad(e,t,s){const r=this._getPrimaryColumnParameter(t),n=this._getSourceCollectionFilterValue(t)??"InputParameters";return r?(this._getIsIntentUIdParameter(r)?this._intentManager.getIntentParameters(r.value,n):this._intentManager.getIntentParameter(r.value).pipe((0,o.map)(u=>[u]))).pipe((0,o.mergeMap)(u=>(0,o.from)(u).pipe((0,o.mergeMap)(d=>this._modelConvertor.convertToDataSourceModel(d)),(0,o.toArray)())),(0,o.catchError)(()=>(0,o.of)([]))):(0,o.of)([])}innerSave(e,t){const s=this._getPrimaryColumnParameter(e)?.value,r=this._modelConvertor.convertToModel({...t});return r.UId=s,this._intentManager.updateIntentParameter(r).pipe((0,o.map)(n=>({success:n.success,rowsAffected:n.success?1:0,errorInfo:n.errorInfo?.message})),(0,o.switchMap)(n=>n.success?(0,o.of)(n):(0,o.throwError)(()=>n)))}innerDelete(e){const t=this._getPrimaryColumnParameter(e)?.value;return this._intentManager.deleteIntentParameter(t).pipe((0,o.map)(s=>({success:s.success,rowsAffected:s.success?1:0,errorInfo:s.errorInfo?.message})),(0,o.switchMap)(s=>s.success?(0,o.of)(s):(0,o.throwError)(()=>s)))}}class Ph extends qr{innerDelete(e){return(0,o.of)(null)}innerInsert(e){return(0,o.of)(null)}innerLoad(e,t){return(0,o.of)([])}innerSave(e,t){return(0,o.of)(null)}innerGetLookupDataSchema(e){return(0,o.of)(null)}innerGetDefaultValues(){return(0,o.of)(null)}innerCanDelete(e){return(0,o.of)(null)}innerCanEdit(e){return(0,o.of)(null)}innerCanCreate(e){return(0,o.of)(null)}}function qm(i){const e=Object.keys(DataValueTypeGroup).find(t=>DataValueTypeGroup[t].includes(i));return DataValueTypeGroup[e]}function Hm(i){return i===DataValueType.Lookup||i===DataValueType.Guid}function Km(i){return DataValueTypeItems[i]?.icon||null}function Ca(i){return Object.values(Hn.Q).find(e=>e.name===i)?.type}function Dh(i){return!(i&&!i?.value)}var Be;(function(i){i.Create="create",i.Update="update",i.Delete="delete"})(Be||(Be={}));const Aa=window;class Gr{constructor(){this._event$=new o.Subject}static get instance(){return Aa.__modelEventNotificationService||(Aa.__modelEventNotificationService=new Gr),Aa.__modelEventNotificationService}get event$(){return this._event$.asObservable()}notify(e){this._event$.next(e)}}class Wr{constructor(){this.changedValues$=new o.Subject,this._valuesStore={}}setValues(e){if(e){const t={};Object.entries(e).forEach(([s,r])=>{const n=this._valuesStore[s]!==r;this._valuesStore[s]=(0,P.cloneDeep)(r),n&&(t[s]=this._valuesStore[s])}),(0,P.isEmpty)(t)||this.changedValues$.next(t)}}get values(){return this._valuesStore}static{this.\u0275fac=function(t){return new(t||Wr)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Wr,factory:Wr.\u0275fac})}}const Nu="PrimaryValue",xu="DisplayValue",va="PrimaryColorValue";class Jr{constructor(e,t){this._queryExecutor=e,this._entitySchemaRepository=t}_getInFilter(e){const t=new Jt({macrosType:ys.PrimaryColumn});return new Wt(ne.Equal,t,e.map(s=>new ae({value:s})))}_getEsq(e,t){const s=new $r(e);return this._entitySchemaRepository.getSchemaByName(e).pipe((0,l.map)(r=>{s.addMacrosFunctionColumn(ys.PrimaryColumn,Nu),s.addMacrosFunctionColumn(ys.PrimaryDisplayColumn,xu);const n=r.getPrimaryColorColumn();n&&s.addSchemaColumn(n.name,va);const a=this._getInFilter(t);return s.filters.add(a),s}))}_getSchemaLookupData(e,t){const s={};for(let r=0;r<t.length;r++){const n=t[r],[a,u]=e[r];s[a]={};for(const d of u){const p=n.find(g=>g[Nu]===d);if(p){const g=[p[xu]];p[va]&&g.push(p[va]),s[a][d]=p?g:null}}}return s}load(e){const t=Object.entries(e);return(0,o.forkJoin)(t.map(([s,r])=>this._getEsq(s,r))).pipe((0,o.switchMap)(s=>this._queryExecutor.executeBatchSelectQuery(s).pipe((0,l.map)(r=>this._getSchemaLookupData(t,r)))))}static{this.\u0275fac=function(t){return new(t||Jr)(c.\u0275\u0275inject(Le),c.\u0275\u0275inject(rt))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Jr,factory:Jr.\u0275fac,providedIn:"root"})}}class Th extends da{constructor(e,t){super(e,t),this.dataSourceName=e,this._injector=t,this.type=Au,this._schemaParametersStore=this._injector.get(Wr),this._lookupDataLoadService=this._injector.get(Jr),this._featureValues=this._injector.get(F),this._featureValues.DisableCommunicationBetweenSchemas||this._subscribeParametersChanged()}_subscribeParametersChanged(){this._schemaParametersStore.changedValues$.subscribe(e=>{Gr.instance.notify({modelId:(0,j.qv)(),dataSchemaName:this.dataSchema.name,type:Be.Update,payload:{primaryAttributesValues:null,changedAttributes:Object.keys(e)}})})}_getCanSuccessfullyExecuteOperationResult(){return(0,o.of)({result:!0})}_fillLookupValues(e,t,s){Object.entries(s).forEach(([r,[n,a]])=>{(t[r]||[]).forEach(d=>{e[d]=a?{value:r,displayValue:n,primaryColorValue:a}:{value:r,displayValue:n}})})}_fillSchemaParameterValueNameMap(e,t,s,r){const n=r;let a=e[t];a||(a={},e[t]=a);let u=a[n];u||(u=[],a[n]=u),u.push(s)}_fillSchemaNamePrimaryValuesMap(e,t,s){const r=s;let n=e[t];n||(n=[],e[t]=n),n.push(r)}_isLookupValue(e){return!!e?.value}_shouldFillSchemaLookupValueMaps(e,t){return e&&t&&t.referenceSchemaName&&!this._isLookupValue(e)}_load(e,t){const s={},r=this._schemaParametersStore.values,n=t.attributes,a={},u={};for(const p of e){const g=r[p],C=n.find(I=>I.name===p);if(this._shouldFillSchemaLookupValueMaps(g,C)){this._fillSchemaNamePrimaryValuesMap(u,C.referenceSchemaName,g),this._fillSchemaParameterValueNameMap(a,C.referenceSchemaName,p,g);continue}s[p]=g??null}return Object.keys(u).length===0?(0,o.of)([s]):this._lookupDataLoadService.load(u).pipe((0,o.map)(p=>{for(const[g,C]of Object.entries(p)){const I=a[g];this._fillLookupValues(s,I,C)}return[s]}))}_getValuesForStore(e){const t={};return Object.entries(e).forEach(([s,r])=>{const n=this.initialConfig.parameters[s];if(!n)return;Ca(n.dataValueTypeName)===A.r.Lookup?t[s]=r?.value:t[s]=r}),t}innerLoad(e,t,s){return this.getSchema().pipe((0,o.switchMap)(r=>this._load(e,r)))}innerSave(e,t){const s=this._getValuesForStore(t);return this._schemaParametersStore.setValues(s),(0,o.of)({success:!0,rowsAffected:1})}innerInsert(e){const t=this._getValuesForStore(e);return this._schemaParametersStore.setValues(t),(0,o.of)({success:!0,rowsAffected:1,primaryAttributes:[]})}innerDelete(e){return(0,o.of)({success:!0,rowsAffected:1})}innerGetSchema(){const e=[],t=this.initialConfig.parameters;return t&&Object.entries(t).forEach(([s,r])=>{const n=new Vr({name:s,caption:r.caption,dataValueType:Ca(r.dataValueTypeName),attributeType:Z.OwnAttribute,path:s,isRequired:!!r.isRequired,referenceSchemaName:r.referenceSchemaName,isMasked:!1,isFormatValidated:!0});n.addDefaultValidators(),e.push(n)}),(0,o.of)(new vt({name:this.initialConfig.schemaName,type:Ss.ClientUnit,attributes:e}))}innerGetLookupDataSchema(e){return(0,o.of)(null)}innerGetDefaultValues(){return(0,o.of)({})}innerCanEdit(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanDelete(e){return this._getCanSuccessfullyExecuteOperationResult()}innerCanCreate(e){return this._getCanSuccessfullyExecuteOperationResult()}}class Nh extends da{constructor(){super(...arguments),this.type="crt.WebServiceDataSource"}innerLoad(e,t,s){throw new Error("Method not implemented.")}innerSave(e,t){throw new Error("Method not implemented.")}innerInsert(e){throw new Error("Method not implemented.")}innerDelete(e){throw new Error("Method not implemented.")}innerGetSchema(){throw new Error("Method not implemented.")}innerGetLookupDataSchema(e){throw new Error("Method not implemented.")}innerGetDefaultValues(){throw new Error("Method not implemented.")}innerCanDelete(e){throw new Error("Method not implemented.")}innerCanEdit(e){throw new Error("Method not implemented.")}innerCanCreate(e){throw new Error("Method not implemented.")}}class Ms{resolve(e){let t=null;switch(e){case Cu:t=qr;break;case Au:t=Th;break;case"crt.WebServiceDataSource":t=Nh;break;case"crt.CopilotIntentDataSource":t=Ah;break;case"crt.CopilotIntentParameterDataSource":t=wh;break;case"crt.CopilotActionDataSource":t=fh;break;case"crt.DashboardDataSource":t=Ph;break}return(0,o.of)(t)}static{this.\u0275fac=function(t){return new(t||Ms)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ms,factory:Ms.\u0275fac})}}class Rt{constructor(e,t){this.injector=e,this.resolver=t}create(e,t,s){const{type:r,scope:n,config:a}=t;return this.resolver.resolve(r).pipe((0,l.switchMap)(d=>d?new d(e,s||this.injector).init(a,n):(0,o.throwError)(()=>new Error(`Data source type '${r}' not supported.`))),(0,l.catchError)(d=>d instanceof la?(0,o.of)(d.dataSource):(0,o.throwError)(()=>d)))}static{this.\u0275fac=function(t){return new(t||Rt)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(Ms))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Rt,factory:Rt.\u0275fac})}}var D;(function(i){i.Init="init",i.Create="create",i.Update="update",i.Copy="copy",i.Delete="delete",i.Unknown="unknown"})(D||(D={}));class Vu{}var he;(function(i){i.LoadNext="loadNext",i.Load="load",i.Reload="reload"})(he||(he={}));function Ou(i,e,t){return!i||!e||!t}function ku(i,e){return`/img/entity/hash/${i}/${e}/`}function Lu(i,e="SysImage",t="Data"){if(Ou(i,e,t))return"";const s=ku(e,t);return`${Bn()}${s}${i}`}function zm(i,e="SysImage",t="Data"){return Ou(i,e,t)?"":`${ku(e,t)}${i}`}function xh(i){let e="";if(typeof i=="string"){const s=new TextEncoder().encode(i);e=String.fromCharCode(...s)}else if(i instanceof ArrayBuffer){const t=new Uint8Array(i);for(let s=0;s<t?.byteLength;s++)e+=String.fromCharCode(t[s])}return window.btoa(e)}function Gm(i){const e=new DOMParser().parseFromString(i,"text/html"),t=e?.querySelectorAll("svg");return t.length>0&&t.forEach(s=>{const r=e.createElement("img"),n=xh(s.outerHTML);r.src=`data:image/svg+xml;base64,${n}`,s?.parentNode.replaceChild(r,s)}),e?.body.innerHTML||i}class fe{static _setImageLookupTypeUrl(e,t){const s=e[t],r=s?.value;r&&(s.url=Lu(r))}static _setBlobTypeUrl(e,t,s){const r=t[s];if(r){const n=t.Id;t[s]={value:r,url:Lu(n,e,s)}}}static _addImageUrl(e,t,s){t.forEach(r=>{switch(r.dataValueType){case A.r.IMAGELOOKUP:{this._setImageLookupTypeUrl(s,r.name);break}case A.r.Image:{this._setBlobTypeUrl(e,s,r.name);break}default:break}})}static serializeRecordPrimaryAttributesValues(e){return e.map(t=>`${t.name}:${t.value}`).join(";")}static getModelPrimaryAttributeValues(e,t){const s=e.getPrimaryAttributesNames();return t.map(r=>s.map(n=>({name:n,value:r[n]})))}static getOwnColumnsValues(e,t){const s=t??{};if(e.attributes.length){const r=e.attributes.filter(n=>n.attributeType===Z.OwnAttribute).map(n=>n.name).filter(n=>!(0,P.isUndefined)(s[n])).map(n=>[n,s[n]]);return Object.fromEntries(r)}else return s}static getPrimaryAttributeValuesFromParameters(e,t){const s=t.filter(r=>r.type===B.PrimaryColumnValue);return s.length?s.map(r=>({[e.primaryAttributeName]:r.value})):[]}static getPrimaryAttributeValuesFromData(e,t){const s=e.getPrimaryAttributesNames();return s.length?s.filter(r=>t[r]).map(r=>({[r]:t[r]})):[]}static getPrimaryAttributeValues(e,t,s){const r=this.getPrimaryAttributeValuesFromData(e,t);return r.length?r:this.getPrimaryAttributeValuesFromParameters(e,s)}static getDataSourceLoadOptions(e){const t={loadType:e?.loadType||he.Load};return e?.pagingConfig&&(t.pagingConfig=e.pagingConfig),e?.sortingConfig&&(t.sortingConfig=e.sortingConfig),e?.hierarchyConfig&&(t.hierarchyConfig=e.hierarchyConfig),e?.isDistinct&&(t.isDistinct=e.isDistinct),t}static getImageAttributes(e,t){const s=[];return(t||[]).forEach(r=>{const n=e.findAttributeByName(r);n?.isImage&&s.push(n)}),s}static processImageData(e,t,s){const r=fe.getImageAttributes(e,s);return r.length>0&&t.forEach(n=>this._addImageUrl(e.name,r,n)),t}static removeNotRequestedData(e,t){return Object.keys(t).forEach(s=>{e.includes(s)||delete t[s]}),t}static getLoadRequestSignature(e,t,s,r){return JSON.stringify(e)+JSON.stringify(t)+JSON.stringify(s)+JSON.stringify(r)}}const Vh={[D.Init]:[D.Create,D.Copy,D.Update,D.Delete],[D.Copy]:[D.Delete,D.Update],[D.Create]:[D.Copy,D.Delete,D.Update],[D.Delete]:[D.Copy,D.Create,D.Update,D.Init],[D.Update]:[D.Delete],[D.Unknown]:[]};function Ea(i){const e={success:!1,rowsAffected:0,errorInfo:""};return typeof i=="string"?Object.assign(e,{errorInfo:i}):i instanceof Error?Object.assign(e,{errorInfo:i.message}):Object.assign(e,typeof i=="object"?i:{errorInfo:i})}class Rs{get _children(){return this._children$.value}static get instance(){return this._instance||(this._instance=new Rs(null,null)),this._instance}constructor(e,t){this.injector=e,this.dataSource=t,this._lookupDataSourceName="lookupDataSource",this._id=(0,j.qv)(),this._modeChanges=new o.Subject,this._destroyed$=new o.Subject,this._children$=new o.BehaviorSubject([]),this._childrenDirty$=new o.BehaviorSubject(!1),this._childrenModes$=new o.BehaviorSubject([]),this._isCollectionModel=!1,this._isCollectionItemModel=!1,this._mode=D.Init,this._isInitialized=!1,this._isLoaded=!1,this._dirtyAttributes=new Set,this._newLoadingRequestArrived=new o.Subject,this._attributesMap=[],this._selfDirty$=new o.BehaviorSubject(!1),this._isLoading=!1,this._destroyed=!1,this._doNotAllowCancelRequest=!1,this._dirty$=(0,o.combineLatest)([this._selfDirty$,this._childrenDirty$,this._childrenModes$]).pipe((0,l.map)(([s,r,n])=>s||r||n.includes(D.Copy)||n.includes(D.Create)),(0,l.distinctUntilChanged)()),this._loadedData=new Set,this.injector&&(this._dataSourceFactory=this.injector.get(Rt),this._lifecycleHookNotificationService=this.injector.get(Vu,null,{optional:!0}),this._measurePerformanceService=this.injector.get(te.g,null,{optional:!0}),this._doNotAllowCancelRequest=this.injector.get(F,null,{optional:!0})?.DoNotAllowCancelRequest)}get name(){return this.dataSource?this.dataSource.dataSourceName:""}get mode(){return this._isCollectionModel?D.Unknown:this._mode}get _modeChanges$(){return this._modeChanges.asObservable()}get _isChanged(){return!!this._dirtyAttributes?.size}set _isCollection(e){this._isCollectionModel=e,this._isCollectionModel&&(this._mode=D.Unknown)}get isLoaded(){return this._isLoaded}get event$(){return Gr.instance.event$.pipe((0,l.filter)(()=>this._isInitialized),(0,l.filter)(()=>!this._isCollectionItemModel),(0,l.filter)(({dataSchemaName:e})=>e===this._dataSchemaName),(0,l.tap)(({type:e,modelId:t,payload:s})=>this._updateLoadedData(e,t,s)),(0,l.filter)(({modelId:e})=>e!==this._id&&!this._isChild(e)),(0,l.map)(e=>({event:e,ownPrimaryAttributesValues:e.payload?.primaryAttributesValues?.filter(t=>{const s=fe.serializeRecordPrimaryAttributesValues(t);return this._loadedData.has(s)})})),(0,l.filter)(({event:e,ownPrimaryAttributesValues:t})=>e.type===Be.Update||e.type===Be.Delete?!t||t.length!==0:!0),(0,l.map)(({event:e,ownPrimaryAttributesValues:t})=>({event:e,primaryAttributesValues:e.type===Be.Create?e.payload.primaryAttributesValues:t})),(0,l.map)(({event:e,primaryAttributesValues:t})=>({modelId:e.modelId,dataSchemaName:e.dataSchemaName,type:e.type,payload:{...e.payload,primaryAttributesValues:t}})),(0,l.takeUntil)(this._destroyed$))}get dataSchemaName(){return this._dataSchemaName}get allowSync(){return!this._disableSync}get disableSync(){return this._disableSync}set disableSync(e){this._disableSync=e}get isLoading(){return this._isLoading}get hasErrors(){return this.dataSource?this.dataSource.hasErrors:!0}get hasCriticalErrors(){return this.dataSource?this.dataSource.hasCriticalErrors:!0}get affectedAttributes(){return this.dataSource?this.dataSource.affectedAttributes:[]}get isAggregate(){return this.dataSource?this.dataSource.isAggregate:!1}get supportsTransactions(){return!1}get isCollectionItemModel(){return this._isCollectionItemModel}get isInitialized(){return this._isInitialized}_isChild(e){return this._children.some(t=>t?._id===e)}_subscribeChildrenModeChanges(){this._children$.pipe((0,l.map)(e=>e.map(t=>(0,o.merge)((0,o.of)(t.mode),t._modeChanges$))),(0,l.switchMap)(e=>e?.length?(0,o.combineLatest)(e):(0,o.of)([])),(0,l.tap)(e=>this._childrenModes$.next(e)),(0,l.takeUntil)(this._destroyed$)).subscribe()}_subscribeChildrenDirtyChanges(){this._children$.pipe((0,l.map)(e=>e.map(t=>t._dirty$)),(0,l.switchMap)(e=>e?.length?(0,o.combineLatest)(e):(0,o.of)([])),(0,l.map)(e=>e.some(t=>t)),(0,l.tap)(e=>this._childrenDirty$.next(e)),(0,l.takeUntil)(this._destroyed$)).subscribe()}_updateLoadedData(e,t,s){this._isCollectionModel&&e===Be.Create&&this._isChild(t)&&s.primaryAttributesValues.forEach(r=>{const n=fe.serializeRecordPrimaryAttributesValues(r);this._loadedData.add(n)})}_setMode(e){if(this._mode===e)return;if(!Vh[this._mode]?.includes(e))throw Error(`Unable to mark model with '${this._mode}' mode for '${e}'.`);const s=this._mode;this._mode=e,e===D.Delete&&this._selfDirty$.next(s!==D.Create)}_markForNotCollection(e){this._isCollectionModel||this.markFor(e)}_registerPrimaryAttributeValues(e){e.forEach(t=>{this._loadedData.add(fe.serializeRecordPrimaryAttributesValues(t))})}_getDependentAttributesNames(e){return this._attributesMap.filter(t=>e.includes(t.name)).filter(t=>t.dependentAttributes.length!==0).map(t=>t.dependentAttributes).flat()}_getDefaultLoadAttributes(){return this.getSchema().pipe((0,l.map)(e=>e.getPrimaryLoadAttributes()))}_checkAttributesInDataSchema(e){return this.getSchema().pipe((0,l.tap)(t=>{const s=e.filter(r=>t.findAttributeByName(r)==null);if(s.length>0)throw new Error(`data has unknown attributes names: ${s.join(", ")}`)}))}_createDataSource(e,t,s=null){const r=s??t.dataSourceConfig;return this._dataSourceFactory.create(e,r)}_notifyEventByParameters(e,t){return this.getSchema().pipe((0,l.map)(s=>fe.getPrimaryAttributeValuesFromParameters(s,e)),(0,l.mergeMap)(s=>this._notifyDataChange(s,t)))}_notifyDataChange(e,t){return this.getSchema().pipe((0,l.map)(s=>fe.getModelPrimaryAttributeValues(s,e)),(0,l.tap)(s=>{Gr.instance.notify({modelId:this._id,dataSchemaName:this._dataSchemaName,type:t,payload:{primaryAttributesValues:s}})}),(0,l.map)(()=>null))}_mapSaveResult(e,t,s){return this.getSchema().pipe((0,l.map)(r=>({result:e,actionType:Be.Update,data:fe.getPrimaryAttributeValues(r,t,s)})))}_mapInsertResult(e){return{data:e.primaryAttributes??[],result:e,actionType:Be.Create}}_getLoadAttributes(e){if(e&&e.length!==0){let t=null;if(e.every(r=>(0,P.isString)(r)))return t=this._getDependentAttributesNames(e),(0,o.of)([...e,...t]);{const r=e.map(n=>n.name);return t=this._getDependentAttributesNames(r),this.getSchema().pipe((0,l.map)(n=>(t=t.map(a=>n.findAttributeByName(a)).map(a=>({name:a.name,path:a.path,caption:a.caption,dataValueType:a.dataValueType,aggregationConfig:a.aggregationConfig})),[...e,...t])))}}return this._getDefaultLoadAttributes()}_getChangedAttributesValues(e){return this._persistedState?Object.entries({...this._persistedState,...e}).filter(([t])=>this._dirtyAttributes.has(t)).reduce((t,[s,r])=>Object.assign(t,{[s]:r}),{}):e}_load(e,t,s,r,n=D.Update){const a={attributes:t,parameters:s,options:r,mode:n},u=(0,P.cloneDeep)(this._lastRequestPayload),d=(0,P.isEqual)((0,P.omit)(a,"options.loadType"),(0,P.omit)(u,"options.loadType"));return this._loadingRequest&&d?this._loadingRequest:(this._lastRequestPayload&&!d&&(this._newLoadingRequestArrived.next(null),this._newLoadingRequestArrived=new o.Subject),this._lastRequestPayload=a,this._loadingRequest=this._getLoadAttributes(t).pipe((0,O.pR)(()=>this._onBeforeLoad(a,u)),(0,l.switchMap)(p=>e(p,s,r)),(0,l.raceWith)(this._newLoadingRequestArrived.pipe((0,l.switchMap)(()=>(0,o.throwError)(()=>new Jn)))),(0,l.tap)(()=>this._markForNotCollection(n)),(0,O.BB)(()=>this.getSchema()),(0,l.tap)(([p,g])=>{this._registerPrimaryAttributeValues(fe.getModelPrimaryAttributeValues(g,p))}),(0,l.tap)(()=>this._persistedState={}),(0,l.map)(([p,g])=>fe.processImageData(g,p,t)),(0,l.tap)(()=>this._isLoaded=!0),(0,O.pR)(()=>this._onAfterLoad(a,u)),(0,l.catchError)(p=>(this._isLoaded=!1,(0,o.throwError)(()=>p))),(0,l.tap)(()=>{this._dirtyAttributes.size===0&&this._markAsPristine(),this._loadingRequest=null}),(0,l.share)()),(0,o.iif)(()=>!this._doNotAllowCancelRequest,this._loadingRequest.pipe((0,l.takeUntil)(this._destroyed$)),this._loadingRequest))}_updateAttributesDependencies(){this._attributesMap.forEach(t=>t.dependentAttributes=[]),this._attributesMap.filter(t=>t.attributeType!==Z.OwnAttribute).forEach(t=>{const s=t.path.split(".");if(s.length===1)return;const r=s.shift(),n=this._attributesMap.find(a=>a.path===r);n?.dependentAttributes.push(t.name)})}_buildAttributesMap(e){const t=e.attributes??[];this._attributesMap=t.map(s=>({name:s.name,path:s.path,attributeType:s.attributeType,dependentAttributes:[],isSchemaAttribute:!0})),this._updateAttributesDependencies()}_loadDependentDataForCreate(e){return this.getSchema().pipe((0,l.map)(t=>t.attributes.filter(s=>s.dataValueType===A.r.Lookup).filter(s=>s.name in e).map(s=>s.name)),(0,l.switchMap)(t=>{if(t.length===0)return(0,o.of)([]);const s=t.map(r=>this.reloadDependentData(r,e[r]));return(0,o.forkJoin)(s)}),(0,l.map)(t=>{let s={};return t.forEach(r=>{s={...s,...r[0]||{}}}),{...s,...e}}))}_getDependentAttributesInfo(e){return this.getSchema().pipe((0,l.map)(t=>e.map(s=>{const r=t.findAttributeByName(s),n=r?.path??s,a=r?.name??s,u=r?.aggregationConfig??null,d=r?.dataValueType??null,p=r?.attributeType??null,g=n.split(".");g.shift();const C=g.length===1?g[0]:a;let I;return p===Z.AggregationAttribute?I=Z.AggregationAttribute:I=g.length===1?Z.OwnAttribute:Z.ForwardReferenceAttribute,{alias:C,attributeName:a,config:{path:g.join("."),aggregationConfig:u,dataValueType:d,type:I},type:I}})))}_markAsPristine(){this._selfDirty$.next(!1)}_onBeforeLoad(e,t){return this._lifecycleHookNotificationService?.onBeforeLoad?(0,o.from)(this._lifecycleHookNotificationService.onBeforeLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})).pipe((0,l.map)(s=>{if(s===!1)throw Error('Loading is disallowed by a "OnBeforeLoad" model lifecycle event')})):(0,o.of)(void 0)}_onAfterLoad(e,t){return this._lifecycleHookNotificationService?.onAfterLoad?(0,o.from)(this._lifecycleHookNotificationService.onAfterLoad({model:this,payload:{attributes:e?.attributes,options:e?.options,parameters:e?.parameters},previousPayload:{attributes:t?.attributes,options:t?.options,parameters:t?.parameters}})):(0,o.of)(void 0)}_onBeforeInsert(e){return this._lifecycleHookNotificationService?.onBeforeInsert?this.getSchema().pipe((0,l.map)(t=>fe.getModelPrimaryAttributeValues(t,[e])),(0,l.map)(t=>t.pop()),(0,l.switchMap)(t=>this._lifecycleHookNotificationService.onBeforeInsert({model:this,payload:{data:e,primaryAttributesValues:t}})),(0,l.map)(t=>{if(t===!1)throw Error('Inserting is disallowed by a "OnBeforeInsert" model lifecycle event')})):(0,o.of)(void 0)}_insert(e,t){return t(e).pipe((0,l.map)(s=>this._mapInsertResult(s)),(0,l.tap)(()=>this._persistedState={}),(0,l.tap)(()=>this._markAsPristine()),(0,l.tap)(()=>this._markForNotCollection(D.Update)),(0,O.BB)(()=>this.getSchema()),(0,l.tap)(([,s])=>{this._registerPrimaryAttributeValues(fe.getModelPrimaryAttributeValues(s,[e]))}),(0,l.map)(([s])=>s),(0,O.hk)(({data:s,actionType:r})=>this._notifyDataChange(s,r)),(0,l.map)(({result:s})=>s))}_onAfterInsert(e){return this._lifecycleHookNotificationService?.onAfterInsert?(0,o.from)(this._lifecycleHookNotificationService.onAfterInsert({model:this,payload:{data:e}})):(0,o.of)(void 0)}_onBeforeUpdate(e,t){return this._lifecycleHookNotificationService?.onBeforeUpdate?(0,o.from)(this._lifecycleHookNotificationService.onBeforeUpdate({model:this,payload:{data:e,parameters:t}})).pipe((0,l.map)(s=>{if(s===!1)throw Error('Updating is disallowed by a "OnBeforeUpdate" model lifecycle event')})):(0,o.of)(void 0)}_update(e,t,s){return s(t,e).pipe((0,l.mergeMap)(r=>this._mapSaveResult(r,e,t)),(0,O.hk)(()=>this._notifyEventByParameters(t,Be.Update)),(0,l.map)(({result:r})=>r),(0,l.tap)(()=>this.setLoadedState()))}_onAfterUpdate(e,t){return this._lifecycleHookNotificationService?.onAfterUpdate?(0,o.from)(this._lifecycleHookNotificationService.onAfterUpdate({model:this,payload:{data:e,parameters:t}})):(0,o.of)(void 0)}_onBeforeDelete(e){return this._lifecycleHookNotificationService?.onBeforeDelete?(0,o.from)(this._lifecycleHookNotificationService.onBeforeDelete({model:this,payload:{parameters:e}})).pipe((0,l.map)(t=>{if(t===!1)throw Error('Deleting is disallowed by a "OnBeforeDelete" model lifecycle event')})):(0,o.of)(void 0)}_delete(e,t){return t(e).pipe((0,l.tap)(()=>this._markAsPristine()),(0,l.tap)(()=>this._markForNotCollection(D.Init)),(0,O.hk)(()=>this._notifyEventByParameters(e,Be.Delete)))}_onAfterDelete(e){return this._lifecycleHookNotificationService?.onAfterDelete?(0,o.from)(this._lifecycleHookNotificationService.onAfterDelete({model:this,payload:{parameters:e}})):(0,o.of)(void 0)}innerInsert(e,t){const r=this.getSchema().pipe((0,l.map)(n=>({dataSchema:n,data:{...this._persistedState??{},...t}})),(0,l.map)(({data:n,dataSchema:a})=>fe.getOwnColumnsValues(a,n))).pipe((0,O.pR)(n=>this._onBeforeInsert(n)),(0,O.DH)(n=>this._insert(n,e)),(0,O.pR)(([n])=>this._onAfterInsert(n)),(0,l.map)(([,n])=>n),(0,l.tap)(()=>{this._isLoaded=!0}),(0,l.catchError)(n=>(0,o.of)(Ea(n))));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,l.takeUntil)(this._destroyed$)),r)}innerUpdate(e,t,s){const n=this.getSchema().pipe((0,l.map)(a=>fe.getOwnColumnsValues(a,t)),(0,l.map)(a=>this._getChangedAttributesValues(a))).pipe((0,O.pR)(a=>this._onBeforeUpdate(a,s)),(0,O.DH)(a=>this._update(a,s,e)),(0,O.pR)(([a])=>this._onAfterUpdate(a,s)),(0,l.map)(([,a])=>a),(0,l.catchError)(a=>(0,o.of)(Ea(a))));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,n.pipe((0,l.takeUntil)(this._destroyed$)),n)}innerDelete(e,t){return this._onBeforeDelete(t).pipe((0,l.switchMap)(()=>this._delete(t,e)),(0,O.pR)(()=>this._onAfterDelete(t)),(0,l.catchError)(s=>(0,o.of)(Ea(s))))}innerLoad(e,t){if(this._destroyed)return(0,o.of)([]);this._isLoading=!0;const s=t?.attributes,r=t?.parameters||[],n=fe.getDataSourceLoadOptions(t?.options),a=this._load(e,s,r,n).pipe((0,l.tap)(()=>this._isLoading=!1),(0,l.catchError)(u=>(this._isLoading=!1,(0,o.throwError)(()=>u))));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,a.pipe((0,l.takeUntil)(this._destroyed$)),a)}createChildModel(){return new Rs(this.injector,this.dataSource)}static create(e){return(0,o.from)(this.instance._create({type:"crt.EntityDataSource",config:{entitySchemaName:e}},""))}init(){return this.getSchema().pipe((0,l.tap)(e=>this._dataSchemaName=e.name),(0,l.tap)(e=>this._buildAttributesMap(e)),(0,l.map)(()=>this),(0,l.tap)(()=>this._isInitialized=!this.hasCriticalErrors),(0,l.tap)(()=>{this._subscribeChildrenModeChanges(),this._subscribeChildrenDirtyChanges()}),(0,l.take)(1))}getSchema(){if(!this.dataSource)return(0,o.of)(null);if(this.hasCriticalErrors)return(0,o.of)(this.dataSource.getEmptySchema());const e=this.dataSource.getSchema();return this._measurePerformanceService?e.pipe(this._measurePerformanceService.measure$(`model.getSchema.${this.name}`)):e}getDataSource(){return this.dataSource}load(e){return this.innerLoad((t,s,r)=>this.dataSource.load(t,s,r),e)}updateDependentAttributes(e){this._attributesMap=this._attributesMap.filter(r=>r.isSchemaAttribute);const t=this._attributesMap.map(r=>r.name),s=e.filter(r=>!t.includes(r.path)).map(r=>({name:r.path,path:r.path,attributeType:r.type??Z.ForwardReferenceAttribute,dependentAttributes:[],isSchemaAttribute:!1}));this._attributesMap.push(...s),this._updateAttributesDependencies()}canReloadDependentData(e){return this._getDependentAttributesNames([e]).length!==0}getDependentAttributesNames(e){return this._getDependentAttributesNames([e])}reloadDependentData(e,t){const s=this._getDependentAttributesNames([e]);if(s.length===0)return(0,o.of)([]);if(t==null)return(0,o.of)([Object.fromEntries(s.map(a=>[a,null]))]);const r=[{type:B.PrimaryColumnValue,value:t}],n=[];return(0,o.forkJoin)([this._getDependentAttributesInfo(s),this.dataSource.getLookupDataSchema(e)]).pipe((0,l.switchMap)(([a,u])=>{const d=a.filter(g=>g.type!==Z.OwnAttribute).map(g=>[g.alias,g.config]),p={type:u.dataSourceConfig.type,config:{...u.dataSourceConfig.config,attributes:Object.fromEntries(d)}};return a.forEach(g=>{n.push({ownAttributeName:g.attributeName,alias:g.alias})}),this._createDataSource(`${this.name}_reloadData`,u,p)}),(0,l.switchMap)(a=>a.load([...new Set(n.map(u=>u.alias))],r,{throttled:!0})),(0,l.map)(a=>a.map(u=>{const d={};return n.forEach(p=>{d[p.ownAttributeName]=u[p.alias]}),d})))}create(e={}){return this._isLoading=!0,this.getSchema().pipe((0,l.map)(t=>fe.getOwnColumnsValues(t,e)),(0,l.switchMap)(t=>(0,o.forkJoin)([(0,o.of)(t),this.dataSource.getDefaultValues()])),(0,l.tap)(()=>this._markForNotCollection(D.Create)),(0,l.map)(([t,s])=>(this._persistedState={...s,...t},this._persistedState)),(0,l.switchMap)(t=>this._loadDependentDataForCreate(t)),(0,l.tap)(()=>this._isLoading=!1))}copy(e,t={}){return this._isLoading=!0,this.getSchema().pipe((0,l.map)(s=>({schema:s,attributes:s.attributes.filter(r=>r.attributeType===Z.OwnAttribute&&r.isValueCloneable).map(r=>r.name),parameters:typeof e=="string"?[{type:B.PrimaryColumnValue,value:e}]:s.getPrimaryAttributesNames().filter(r=>e[r]).map(r=>({type:B.PrimaryColumnValue,value:{[r]:e[r]}}))})),(0,l.mergeMap)(({schema:s,attributes:r,parameters:n})=>this._load((a,u,d)=>this.dataSource.load(a,u,d),r,n,{},D.Copy).pipe((0,l.tap)(()=>{this._isLoaded=!1}),(0,l.tap)(a=>{if(a.length>1)throw new Error("More than one record loaded for copy");if(a.length===0)throw new Error("No records loaded for copy")}),(0,l.map)(a=>fe.removeNotRequestedData(r,{...a[0]})),(0,l.map)(a=>{s.getPrimaryAttributesNames().forEach(d=>delete a[d]);const u=fe.getOwnColumnsValues(s,t);return{...a,...u}}),(0,l.switchMap)(a=>this.dataSource.getDefaultValues().pipe((0,l.map)(u=>({...u,...a})))),(0,l.tap)(a=>{this._persistedState={...a}}),(0,l.switchMap)(a=>this._loadDependentDataForCreate(a)),(0,l.tap)(()=>{this._isLoaded=!0,this._isLoading=!1}),(0,l.catchError)(a=>(this._isLoading=!1,this._markForNotCollection(D.Update),(0,o.throwError)(()=>new Error(a)))))))}insert(e){return this.innerInsert(t=>this.dataSource.insert(t),e)}update(e,t){return this.innerUpdate((s,r)=>this.dataSource.save(s,r),e,t)}insertOrUpdate(e,t){return this._mode===D.Update?this.update(e,t):this.insert(e)}delete(e){return this.innerDelete(t=>this.dataSource.delete(t),e)}setValue(e){const t=Object.keys(e);return this._checkAttributesInDataSchema(t).pipe((0,l.tap)(()=>{t.length>0&&(this._dirtyAttributes=new Set([...this._dirtyAttributes,...t]),this._persistedState={...this._persistedState??{},...e})}),(0,l.map)(()=>null))}_getPersistedState(){return{...this._persistedState??{}}}markFor(e){this.mode!==e&&(this._setMode(e),this._modeChanges.next(e))}resetMode(){this._mode!==D.Init&&(this._mode=D.Init,this._modeChanges.next(this._mode))}loadLookupList(e,t,s={}){if(!this.dataSource)throw Error("DataSource is null");const r=this.dataSource.getLookupDataSchema(e).pipe((0,l.switchMap)(n=>{const a=n.getPrimaryLoadAttributes();return this._createDataSource(this._lookupDataSourceName,n).pipe((0,l.switchMap)(u=>u.load(a,t,s)),(0,l.map)(u=>({primaryAttributeName:n.primaryAttributeName,primaryDisplayAttributeName:n.primaryDisplayAttributeName,data:u})))}));return(0,o.iif)(()=>!this._doNotAllowCancelRequest,r.pipe((0,l.takeUntil)(this._destroyed$)),r)}canDelete(e){return(0,o.lastValueFrom)(this.dataSource.canDelete(e),{defaultValue:null})}canSave(e){switch(this._mode){case D.Init:return Promise.resolve({result:!1});case D.Create:case D.Copy:return(0,o.lastValueFrom)(this.dataSource.canCreate(e),{defaultValue:null});case D.Update:return(0,o.lastValueFrom)(this.dataSource.canEdit(e),{defaultValue:null});case D.Delete:return this.canDelete(e);default:throw Error(`Unable to verify the possibility of operation executing: the '${this._mode}' is not supported.`)}}attributeChanged(e,t){t||this._selfDirty$.next(!0),this._dirtyAttributes.add(e)}setLoadedState(e=null){if(this._isCollectionModel||!e){this._dirtyAttributes.clear(),this._markAsPristine();return}e.forEach(t=>this._dirtyAttributes.delete(t)),this._dirtyAttributes.size||this._markAsPristine()}createCollectionItemModel(e){const t=this.createChildModel();return t._isCollectionItemModel=!0,t._isLoaded=!0,t._isInitialized=!0,t._persistedState={},t._dataSchemaName=this._dataSchemaName,t._attributesMap=this._attributesMap,e!=null&&(t._setMode(e),t._selfDirty$.next(!1)),this._children.push(t),t}childrenChange(){this._children$.next(this._children)}removeChild(e){const t=e?._id,s=this._children.findIndex(r=>r?._id===t);s!==-1&&this._children.splice(s,1)}_getAsyncResult(e){return(0,o.firstValueFrom)(e)}getLastError(){return this.dataSource?this.dataSource.getLastError():new Error("DataSource is null")}destroy(){this._isInitialized=!1,this._destroyed$.next(),this._destroyed$.complete(),this._selfDirty$.complete(),this._children$.complete(),this._childrenDirty$.complete(),this._childrenModes$.complete(),this._destroyed=!0}getOwnLoadParameters(){return this.dataSource.getOwnLoadParameters()}getAllowCopyingRecords(){return this.dataSource.getAllowCopyingRecords()}}(0,h.__decorate)([Ze({requestType:"crt.ModelGenerator",methodName:"generateOne"}),(0,h.__metadata)("design:type",Function)],Rs.prototype,"_create",void 0);class Yn extends Rs{get supportsTransactions(){return this.dataSource?this.dataSource.supportTransactions:!1}createChildModel(){return new Yn(this.injector,this.dataSource)}loadInTransaction(e,t){return e.createOperation(s=>(0,o.firstValueFrom)(this.innerLoad((r,n,a)=>this.dataSource.loadInTransaction(s,r,n,a),t)))}insertInTransaction(e,t){return e.createOperation(s=>(0,o.firstValueFrom)(this.innerInsert(r=>this.dataSource.insertInTransaction(s,r),t)))}updateInTransaction(e,t,s){return e.createOperation(r=>(0,o.firstValueFrom)(this.innerUpdate((n,a)=>this.dataSource.saveInTransaction(r,n,a),t,s)))}insertOrUpdateInTransaction(e,t,s){return this.mode===D.Update?this.updateInTransaction(e,t,s):this.insertInTransaction(e,t)}deleteInTransaction(e,t){return e.createOperation(s=>(0,o.firstValueFrom)(this.innerDelete(r=>this.dataSource.deleteInTransaction(s,r),t)))}}let Zr=class Bi{constructor(e,t,s,r){this.dataSourceFactory=e,this.entitySchemaRepository=t,this._featureValues=s,this._injector=r}get _transactionsEnabled(){return this._featureValues["DataSource-DisableTransactions"]!==!0}_createModel(e=null,t=!1,s){const r=e.supportTransactions&&this._transactionsEnabled?new Yn(s||this._injector,e):new Rs(s||this._injector,e);return r.disableSync=t,r.init()}_validateModelConfig(e){if(e.primaryDataSourceName&&!e.dataSources[e.primaryDataSourceName])throw new Error(`Data source "${e.primaryDataSourceName}" cannot be primary data source. Data source "${e.primaryDataSourceName}" not found in model config.`);if(e.primaryDataSourceName&&e.dataSources[e.primaryDataSourceName]?.scope===Oe.ViewElement)throw new Error(`Data source "${e.primaryDataSourceName}" with scope "viewElement" cannot be primary. Only data sources with scope "page" can be primary`)}_getEntitySchemesRequest(e){return e.map(([,t])=>t).filter(t=>t.type==="crt.EntityDataSource").map(t=>t.config).filter(t=>!!t.entitySchemaName).map(t=>{let s=[];return t.attributes&&(s=Object.entries(t.attributes).filter(([,r])=>r.type===Z.ForwardReferenceAttribute).map(([,r])=>r.path)),{name:t.entitySchemaName,loadLookupColumns:!0,forwardReferencePaths:s}})}_generateFromConfig(e,t){let s,r;const n=t?.get(te.g,null,{optional:!0});return n?(s=Object.entries(e?.dataSources||{}).filter(([a,u])=>u.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),s.length===0?(0,o.of)([]):(this._validateModelConfig(e),r=s.map(([a,u])=>this.generateOne(u,a,t)),this.preInitializeDataSources(s).pipe(n.measure$("modelGenerator.generateFromConfig"),(0,o.switchMap)(()=>(0,o.forkJoin)(r))))):(s=Object.entries(e?.dataSources||{}).filter(([a,u])=>u.type?!0:(console.warn(`Data source ${a} without type not supported.`),!1)),s.length===0?(0,o.of)([]):(this._validateModelConfig(e),r=s.map(([a,u])=>this.generateOne(u,a,t)),this.preInitializeDataSources(s).pipe((0,o.switchMap)(()=>(0,o.forkJoin)(r)))))}preInitializeDataSources(e){if(this._featureValues["DataSource-DontUseOneRequestForEntitySchemes"])return(0,o.of)(null);const t=this._getEntitySchemesRequest(e);return this.entitySchemaRepository.getSchemes(t).pipe((0,l.catchError)(s=>(0,o.of)([])),(0,l.map)(s=>null))}generate(e,t){return this._generateFromConfig(e,t)}generateOne(e,t,s){const r=s?.get(te.g,null,{optional:!0});return r?this.dataSourceFactory.create(t,e,s).pipe(r.measure$(`modelGenerator.generateOne.${t}`),(0,l.mergeMap)(n=>this._createModel(n,e.disableSync,s))):this.dataSourceFactory.create(t,e,s).pipe((0,l.mergeMap)(n=>this._createModel(n,e.disableSync,s)))}static{this.\u0275fac=function(t){return new(t||Bi)(c.\u0275\u0275inject(Rt),c.\u0275\u0275inject(rt),c.\u0275\u0275inject(F),c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Bi,factory:Bi.\u0275fac})}};Zr=(0,h.__decorate)([(0,O.op)({requestType:"crt.ModelGenerator"}),(0,h.__metadata)("design:paramtypes",[Rt,rt,ua,c.Injector])],Zr);class Yr{get contextService(){return this._contextService===void 0&&(this._contextService=this._injector.get(du,null)),this._contextService}constructor(e,t,s){this._modelGenerator=e,this._window=t,this._injector=s,this._schemaName="AcademyUrlData"}_createAcademyHelpUrlDataItem(e){return{configurationVersion:e.ConfigurationVersion,contextHelpCode:e.Code,contextHelpId:e.ContextHelpId,enableContextHelp:e.EnableContextHelp,lmsUrl:e.LMSUrl,productEdition:e.ProductEdition,useLmsDocumentation:e.UseLmsDocumentation}}_getSchemaColumns(){return["ContextHelpId","EnableContextHelp","Code","ProductEdition","ConfigurationVersion","UseLmsDocumentation","LMSUrl"]}_createDataSourceParameters(e){return[{type:B.Filter,value:this._getContextHelpCodeFilter(e)}]}_getContextHelpCodeFilter(e){return new Ne(ne.Equal,new se({columnPath:"Code"}),new ae({value:e}))}_getAcademyHelpUrlData(e){return this._modelGenerator.generateOne({type:"crt.EntityDataSource",config:{entitySchemaName:this._schemaName}},"").pipe((0,l.switchMap)(t=>t.load({attributes:this._getSchemaColumns(),parameters:e})),(0,l.map)(t=>t.length===1?this._createAcademyHelpUrlDataItem(t[0]):null))}_buildUrl(e){let t="#";return e&&(t=e.useLmsDocumentation?this._getLmsDocumentationUrl(e):Ct.String.empty),t}_getLmsDocumentationUrl(e){const t=[],s=e.productEdition;s&&t.push("product="+encodeURIComponent(s));const r=e.configurationVersion;r&&t.push("ver="+encodeURIComponent(r));const n=e.enableContextHelp,a=e.contextHelpId;return n&&a&&t.push("id="+encodeURIComponent(a)),`${e.lmsUrl}?${t.join("&")}`}getAcademyHelpUrl(e){if(e===Ct.String.empty)return(0,o.of)(Ct.String.empty);const t=this._createDataSourceParameters(e);return this._getAcademyHelpUrlData(t).pipe((0,l.map)(s=>s?this._buildUrl(s):Ct.String.empty))}openContextHelp(){const e=this.contextService;if(!e)throw new Error(`${du.toString()} was not provided`);const t=e.getContextCode();this.getAcademyHelpUrl(t).subscribe(s=>{this._window.open(s)})}static{this.\u0275fac=function(t){return new(t||Yr)(c.\u0275\u0275inject(Zr),c.\u0275\u0275inject(O.ZP),c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Yr,factory:Yr.\u0275fac,providedIn:"root"})}}class It{constructor(e,t,s,r){this._dialogService=e,this._translateService=t,this._academyHelpUrlService=s,this._domSanitizer=r,this._codeErrorDataSchema={columns:[new pd({name:"errorTypeIcon",formatter:(n,a)=>a.warning?$t.Warning:$t.Error}),{name:"fileName",caption:this._translateService.instant("ErrorListDialogService.FileNameColumn"),valueType:A.r.Text},{name:"errorText",caption:this._translateService.instant("ErrorListDialogService.ErrorTextColumn"),valueType:A.r.Text},{name:"errorNumber",caption:this._translateService.instant("ErrorListDialogService.ErrorNumberColumn"),valueType:A.r.Text},{name:"line",caption:this._translateService.instant("ErrorListDialogService.LineColumn"),valueType:A.r.Text}]},this._savePackagePropertiesErrorDataSchema={columns:[new fd({name:"itemType",caption:this._translateService.instant("ErrorListDialogService.ItemTypeColumn"),formatter:(n,a)=>this._getTypeIconName(a)},""),{name:"itemName",caption:this._translateService.instant("ErrorListDialogService.ItemNameColumn"),valueType:A.r.Text},{name:"message",caption:this._translateService.instant("ErrorListDialogService.DescriptionColumn"),valueType:A.r.Text},{name:"packageName",caption:this._translateService.instant("ErrorListDialogService.PackageNameColumn"),valueType:A.r.Text}]},this._codeValidationErrorDataSchema={columns:[{name:"type",caption:this._translateService.instant("ErrorListDialogService.TypeColumn"),valueType:A.r.Text},{name:"source",caption:this._translateService.instant("ErrorListDialogService.SourceColumn"),valueType:A.r.Text},{name:"reference",caption:this._translateService.instant("ErrorListDialogService.ReferenceColumn"),valueType:A.r.Text},{name:"package",caption:this._translateService.instant("ErrorListDialogService.PackageColumn"),valueType:A.r.Text}]},this._typeIconMap={ClientUnitSchemaManager:"workspace-item-client-unit-schema",EntitySchemaManager:"workspace-item-entity-schema",AddonSchemaManager:"workspace-item-addon-schema"}}_getCompilationErrorsDialogData(e){return{title:this._translateService.instant("ErrorListDialogService.CodeErrorListDialogCaption"),dataSchema:this._codeErrorDataSchema,data:e,sortColumn:"fileName"}}_getPackagePropertiesErrorDialogData(e){return{title:this._translateService.instant("ErrorListDialogService.PackagePropertiesErrorDialogCaption"),additionalText:this._translateService.instant("ErrorListDialogService.PackagePropertiesErrorMessage"),dataSchema:this._savePackagePropertiesErrorDataSchema,data:e,sortColumn:"itemType"}}_getValidationErrorsDialogData(e,t){return{title:this._translateService.instant("ErrorListDialogService.CodeValidationErrorListDialogCaption"),dataSchema:this._codeValidationErrorDataSchema,data:this._convertWorkspaceValidationDialog(t),sortColumn:"source",additionalText:e,helpLinkUrl:this._getHelpLinkUrl()}}_convertWorkspaceValidationDialog(e){return e.map(t=>{const s=(t.source||"").split(".");return{type:s.length>1?s[0]:"",source:s.length>1?s.slice(1).join("."):t.source,reference:t.reference,package:t.package}})}_getTypeIconName(e){switch(e.itemType){case Ut.Schema:return this._typeIconMap[e.itemManagerName]||"workspace-item-entity-schema";case Ut.Assembly:return"workspace-item-assembly";case Ut.SqlScript:return"workspace-item-sql-script";case Ut.SchemaData:return"workspace-item-schema-data";case Ut.Package:return"workspace-item-package";default:return""}}_getHelpLinkUrl(){return{url:this._domSanitizer.bypassSecurityTrustUrl(this._academyUrl),caption:this._translateService.instant("ErrorListDialogService.AcademyHelpUrlCaption")}}_getAcademyHelpUrl(){return this._academyHelpUrlService.getAcademyHelpUrl("PackageHierarchyLoops")}showCompilationErrors(e){return this._dialogService.open(ds,{data:this._getCompilationErrorsDialogData(e),panelClass:"compilation-error-dialog",disableClose:!0})}showValidationErrors(e,t,s=[]){return this._getAcademyHelpUrl().pipe((0,l.switchMap)(r=>(this._academyUrl=r,this._dialogService.open(ds,{data:this._getValidationErrorsDialogData(e,t),panelClass:["validation-error-dialog",...s],disableClose:!0}))))}showSavePackagePropertiesErrors(e){return this._dialogService.open(ds,{data:this._getPackagePropertiesErrorDialogData(e),panelClass:"save-package-properties-error-dialog",disableClose:!0})}static{this.\u0275fac=function(t){return new(t||It)(c.\u0275\u0275inject(qt),c.\u0275\u0275inject(T.TranslateService),c.\u0275\u0275inject(Yr),c.\u0275\u0275inject(y.DomSanitizer))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:It,factory:It.\u0275fac})}}class Xr{constructor(e){this._errorListDialogService=e,this._subscription=new o.Subscription}ngOnInit(){this.validationErrorsList?.length>0?this._subscription.add(this._errorListDialogService.showValidationErrors(this.validationErrorMessage,this.validationErrorsList).subscribe()):this._errorListDialogService.showCompilationErrors(this.errorsList)}ngOnDestroy(){this._subscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||Xr)(c.\u0275\u0275directiveInject(It))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:Xr,selectors:[["ts-error-list-dialog-proxy"]],inputs:{errorsList:"errorsList",validationErrorsList:"validationErrorsList",validationErrorMessage:"validationErrorMessage"},decls:0,vars:0,template:function(t,s){},encapsulation:2})}}class ut extends Kn{constructor(){super(...arguments),this.requestType="crt.FeatureService"}}(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],ut.prototype,"getFeatureState",void 0),(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],ut.prototype,"getFeaturesState",void 0);const Oh="DataService/json/SyncReply",kh="DataService/ssp/json/SyncReply",Xn=new c.InjectionToken("DataServiceUri"),Bu={provide:Xn,useFactory:i=>i?.isSSP?kh:Oh,deps:[[new c.Optional,We.oq]]},Qn=new c.InjectionToken("TransactionFactory");class Is{_getEntitySchemaColumnsDataValueTypesMap(e){return e.columns.reduce((t,s)=>(t[s.name]=s.dataValueType,t),{})}_getEntityColumnsDataValueTypesMap(e){return Object.keys(e).reduce((t,s)=>(t[s]=e[s].dataValueType,t),{})}_parseRawColumnValue(e,t){switch(t){case A.r.Date:case A.r.Time:case A.r.DateTime:return Ru(e);default:return e}}_parseRawEntityObject(e,t){const s={};return Object.keys(e).forEach(r=>{const n=e[r];s[r]=t[r]?this._parseRawColumnValue(n,t[r]):n}),s}deserializeEntity(e,t){H.checkArgumentEmpty("columnsConfig",e),H.checkArgumentEmpty("rawEntity",t);const s=this._getEntityColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,s)}deserializeEntities(e,t){H.checkArgumentEmpty("columnsConfig",e),H.checkArgumentEmpty("rawEntities",t);const s=this._getEntityColumnsDataValueTypesMap(e);return t.map(r=>this._parseRawEntityObject(r,s))}deserializeEntitySchemaRecord(e,t){H.checkArgumentEmpty("entitySchema",e),H.checkArgumentEmpty("rawEntities",t);const s=this._getEntitySchemaColumnsDataValueTypesMap(e);return this._parseRawEntityObject(t,s)}deserializeEntitySchemaRecords(e,t){H.checkArgumentEmpty("entitySchema",e),H.checkArgumentEmpty("rawEntities",t);const s=this._getEntitySchemaColumnsDataValueTypesMap(e);return t.map(r=>this._parseRawEntityObject(r,s))}static{this.\u0275fac=function(t){return new(t||Is)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Is,factory:Is.\u0275fac,providedIn:"root"})}}class Lh extends $r{}var Qr;(function(i){i[i.General=0]="General",i[i.Limited=1]="Limited"})(Qr||(Qr={}));var Ma;(function(i){i[i.Undefined=0]="Undefined",i[i.Filter=1]="Filter",i[i.FilterSummary=2]="FilterSummary"})(Ma||(Ma={}));var Ra;(function(i){i[i.Session=0]="Session",i[i.Workspace=1]="Workspace",i[i.Application=2]="Application"})(Ra||(Ra={}));class Bh{constructor(e=Ra.Session,t="",s=""){this._cacheLevel=e,this._cacheGroup=t,this._cacheItemName=s}getMetadata(){return{cacheLevel:this._cacheLevel,cacheGroup:this._cacheGroup,cacheItemName:this._cacheItemName}}}class en extends Error{constructor(e){const t=e?.error?.responseStatus?.Message||e?.responseStatus?.Message||e?.message;super(t),this.errorCode=e?.error?.responseStatus?.ErrorCode}}class Fu extends Error{constructor(e){super(`Query with config
${JSON.stringify(e.getMetadata())}
finished with error.`)}}let ei=class extends Le{constructor(e,t,s,r){super(),this._sysSettingsService=e,this._httpClient=t,this._dataServiceUri=s,this._featureService=r,this._defaultDSQueryTimeoutMs=12e4,this._defaultDebounceTime=200,this._debounceTimeSysSettingName="QueryExecutorDebounceTime",this._requests=new o.Subject,H.checkArgumentEmpty("_httpClient",t),H.checkArgumentEmpty("_dataServiceUri",s),this._transactions=new Map,this._transactions$=new Map}_getDataServiceQueryTimeout8xFeature(){return this._featureService?(0,o.from)(this._featureService.getFeatureState("EnableDataServiceQueryTimeout8x")):(0,o.of)(!1)}_getDataServiceQueryTimeout(){var e=this;return(0,S.A)(function*(){return e._sysSettingsService&&(yield e._sysSettingsService.getByCode("DataServiceQueryTimeout"))?.value||e._defaultDSQueryTimeoutMs})()}_withTimeout(e){return this._getDataServiceQueryTimeout8xFeature().pipe((0,l.switchMap)(t=>t?(0,o.from)(this._getDataServiceQueryTimeout()).pipe((0,l.switchMap)(s=>e.pipe((0,l.timeout)(s),(0,l.catchError)(r=>{throw r instanceof o.TimeoutError?new Jn(r.message):r})))):e))}_executeWritableQuery(e,t){const r={...e.getMetadata(),queryKind:Qr.General};return this._withTimeout(this._httpClient.post(t,r).pipe((0,l.catchError)(n=>{throw new en(n)}),(0,l.tap)(n=>{if(!(n&&n.success))throw new Fu(e)})))}_getQueryUri(e){if(e instanceof Lh)return`${this._dataServiceUri}/SelectLocalizationQuery`;if(e instanceof $r)return`${this._dataServiceUri}/SelectQuery`;if(e instanceof ma)return`${this._dataServiceUri}/InsertQuery`;if(e instanceof pa)return`${this._dataServiceUri}/UpdateQuery`;if(e instanceof Mu)return`${this._dataServiceUri}/DeleteQuery`;throw new Error("Unsupported query type")}_getBundleSettings(){var e=this;return(0,S.A)(function*(){return e._sysSettingsService?{executionDebounceTime:(yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName])).values[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime}:Promise.resolve({executionDebounceTime:e._defaultDebounceTime})})()}_prepareDebouncedResponsesStream(){if(this._responses)return;let e=0;const t=(0,l.buffer)(this._requests.pipe((0,l.switchMap)(()=>(0,o.from)(this._getBundleSettings())),(0,l.tap)(s=>e=s.executionDebounceTime),(0,l.debounceTime)(e)));this._responses=this._requests.pipe(t,(0,l.filter)(s=>!!s.length),(0,l.mergeMap)(s=>{const r=s.map(a=>a.id),n=s.map(a=>a.query);return this.executeBatchSelectQuery(n).pipe((0,l.map)(a=>r.reduce((u,d,p)=>u.set(d,a[p]),new Map)))}),(0,l.share)())}_executeThrottled(e){this._prepareDebouncedResponsesStream();const t={id:(0,j.qv)(),query:e},s=this._responses.pipe((0,l.filter)(r=>r.has(t.id)),(0,l.map)(r=>r.get(t.id)),(0,l.take)(1));return s.subscribe(),this._requests.next(t),s}_executeImmediate(e){H.checkArgumentEmpty("query",e);const t=this._getQueryUri(e),s=this._getQueryRequest(e);return this._withTimeout(this._httpClient.post(t,s).pipe((0,l.catchError)(r=>{throw new en(r)}),(0,l.tap)(r=>{if(!r?.rows)throw new Fu(e)}),(0,l.map)(r=>this._toSelectQueryResponse(r))))}_toSelectQueryResponse(e){const t=this.getRowsFromResponse(e);return t.rowsAffected=e.rowsAffected,e.errorInfo&&(t.errorInfo=e.errorInfo),t}_getQueryRequest(e){const t=e.getMetadata();return e instanceof $r?{...t,queryKind:Qr.General,serverESQCacheParameters:new Bh().getMetadata(),queryOptimize:!1,useMetrics:!1,querySource:Ma.Undefined}:{...t,queryKind:Qr.General}}_getTransactionQueries(e){return this._transactions.has(e)||this._transactions.set(e,[]),this._transactions.get(e)}_executeInTransaction(e,t){H.checkArgumentEmpty("transactionId",t),this._getTransactionQueries(t).push(e);const r=new o.Subject;return this._transactions$.set(e.queryId,r),r.asObservable()}_executeBatchQuery(e){if(H.checkArgumentEmpty("config",e),H.checkArgumentEmpty("queries",e.queries),e.queries.length===0)return e.throwIfNoQueries===!0?(0,o.throwError)(()=>new Error("Queries array is empty")):(0,o.of)({hasErrors:!1,queryResults:[]});const t=`${this._dataServiceUri}/BatchQuery`,s={items:e.queries.map(r=>this._getQueryRequest(r))};return e.continueIfError!=null&&(s.continueIfError=e.continueIfError),this._withTimeout(this._httpClient.post(t,s).pipe((0,l.catchError)(r=>{throw new en(r)}),(0,l.tap)(r=>{if(!r||r.hasErrors)throw new en(r);for(const n of r.queryResults)if(!n?.success)throw new en(n)})))}getRowsFromResponse(e){return e.rows}executeSelectQuery(e,t={throttled:!1},s){return s?(0,o.throwError)(()=>new Error("Not implemented")):t.throttled?this._executeThrottled(e):this._executeImmediate(e)}executeInsertQuery(e,t){return this.execute(e,t)}executeUpdateQuery(e,t){return this.execute(e,t)}executeDeleteQuery(e,t){return this.execute(e,t)}execute(e,t){if(H.checkArgumentEmpty("query",e),t)return this._executeInTransaction(e,t);const s=this._getQueryUri(e);return this._executeWritableQuery(e,s)}executeBatchSelectQuery(e){return this._executeBatchQuery({queries:e}).pipe((0,l.map)(t=>t.queryResults.map(s=>this._toSelectQueryResponse(s))))}commitTransaction(e){const t=this._getTransactionQueries(e);return this._executeBatchQuery({queries:t,continueIfError:!1,throwIfNoQueries:!0}).pipe((0,l.catchError)(s=>(t.forEach(r=>{const n=r.queryId;this._transactions$.get(n).error(s),this._transactions$.delete(n)}),(0,o.throwError)(()=>s))),(0,l.map)(s=>{const r={};return s.queryResults.forEach(n=>{const a=n.queryId,u=this._transactions$.get(a);u.next(n),u.complete(),this._transactions$.delete(a),r[a]=n}),r}),(0,l.tap)(()=>{this._transactions.delete(e)}))}rollbackTransaction(e){const t=this._getTransactionQueries(e),s={};return t.forEach(r=>{const n=r.queryId,a=this._transactions$.get(n),u={success:!1,rowsAffected:0,errorInfo:{message:"Transaction rollback",errorCode:"TransactionRollback",stackTrace:null}};s[n]=u,a.error(u),this._transactions$.delete(n)}),this._transactions.delete(e),(0,o.of)(s)}};ei=(0,h.__decorate)([(0,h.__param)(0,(0,c.Optional)()),(0,h.__param)(2,(0,c.Inject)(Xn)),(0,h.__param)(3,(0,c.Optional)()),(0,h.__metadata)("design:paramtypes",[De,N.HttpClient,String,ut])],ei);let Ia=class Fi extends ei{constructor(e,t,s,r,n){super(e,t,r,n),this._entityDeserializer=s}getRowsFromResponse(e){return this._entityDeserializer.deserializeEntities(e.rowConfig,e.rows)}static{this.\u0275fac=function(t){return new(t||Fi)(c.\u0275\u0275inject(De,8),c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(Is),c.\u0275\u0275inject(Xn),c.\u0275\u0275inject(ut,8))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Fi,factory:Fi.\u0275fac})}};Ia=(0,h.__decorate)([(0,O.op)({requestType:"crt.DataServiceQueryExecutor"}),(0,h.__metadata)("design:paramtypes",[De,N.HttpClient,Is,String,ut])],Ia);class ju{constructor(e,t){this._transaction=e,this._action=t,this._id=(0,j.qv)(),this._payload={},this._ready=new Promise(s=>{this._readyResolve=s,this._asyncResult=this._action(this)})}get id(){return this._id}get transactionId(){return this._transaction.id}get asyncResult(){return this._asyncResult}get ready(){return this._ready}get payload(){return this._payload}markAsReady(){this._readyResolve()}}class Fh{get id(){return this._id}constructor(e){this._queryExecutor=e,this._id=(0,j.qv)(),this._transactionOperations=[]}createOperation(e){const t=new ju(this,e);return this._transactionOperations.push(t),t}createFailureOperation(e){const t=new ju(this,s=>(s.markAsReady(),Promise.reject(e)));return this._transactionOperations.push(t),t}commit(){var e=this;return(0,S.A)(function*(){yield Promise.all(e._transactionOperations.map(r=>r.ready));let t=null;try{yield(0,o.firstValueFrom)(e._queryExecutor.commitTransaction(e._id))}catch(r){t=r}const s={};for(const r of e._transactionOperations)s[r.id]=yield r.asyncResult;if(t)throw t;return s})()}rollback(){var e=this;return(0,S.A)(function*(){yield(0,o.firstValueFrom)(e._queryExecutor.rollbackTransaction(e._id))})()}}let ti=class ji{constructor(e){this._queryExecutor=e}create(){return Promise.resolve(new Fh(this._queryExecutor))}static{this.\u0275fac=function(t){return new(t||ji)(c.\u0275\u0275inject(Le))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ji,factory:ji.\u0275fac})}};ti=(0,h.__decorate)([(0,O.op)({requestType:"crt.TransactionFactoryService"}),(0,h.__metadata)("design:paramtypes",[Le])],ti);class tn{static{this.\u0275fac=function(t){return new(t||tn)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:tn})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Bu,{provide:Le,useClass:Ia},{provide:Qn,useClass:ti}]})}}class wa{static{this.\u0275fac=function(t){return new(t||wa)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:wa})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Bu,{provide:Le,useFactory:(e,t,s,r)=>new ei(e,t,s,r),deps:[[new c.Optional,De],N.HttpClient,Xn,[new c.Optional,ut]]},{provide:Qn,useClass:ti}]})}}var $u=_(27075);class sn{constructor(e){this.data=e}static{this.\u0275fac=function(t){return new(t||sn)(c.\u0275\u0275directiveInject(re.MAT_DIALOG_DATA))}}static{this.\u0275cmp=c.\u0275\u0275defineComponent({type:sn,selectors:[["ts-info-with-header-dialog"]],decls:9,vars:10,consts:[[1,"header-message"],[1,"message"],[1,"action-button",3,"mat-dialog-close"]],template:function(t,s){t&1&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275text(4),c.\u0275\u0275pipe(5,"translate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(6,"button",2),c.\u0275\u0275text(7),c.\u0275\u0275pipe(8,"translate"),c.\u0275\u0275elementEnd()),t&2&&(c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(2,4,s.data==null?null:s.data.headerMessage)),c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate(c.\u0275\u0275pipeBind1(5,6,s.data==null?null:s.data.message)),c.\u0275\u0275advance(2),c.\u0275\u0275property("mat-dialog-close",s.data==null||s.data.button==null?null:s.data.button.result),c.\u0275\u0275advance(),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind1(8,8,s.data==null||s.data.button==null?null:s.data.button.caption),`
`))},dependencies:[re.MatDialogClose,T.TranslatePipe],styles:[".header-message[_ngcontent-%COMP%]{margin-bottom:24px}.message[_ngcontent-%COMP%]{margin-bottom:40px;white-space:pre-wrap}.action-button[_ngcontent-%COMP%]{float:right;text-transform:none;border-radius:16px;padding:0 16px}"]})}}class ws{static{this.\u0275fac=function(t){return new(t||ws)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:ws})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[qt,{provide:$u.FocusTrapFactory,useClass:$u.ConfigurableFocusTrapFactory}],imports:[w.CommonModule,ls.MatButtonModule,re.MatDialogModule,T.TranslateModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(ws,{declarations:[ps,ms,fs,sn],imports:[w.CommonModule,ls.MatButtonModule,re.MatDialogModule,T.TranslateModule],exports:[ps,fs,sn,ms]})})();class jh{processResponse(e,t){return e.skipUnsuccessfulResponse||(t=t.pipe((0,l.tap)(s=>this.processUnsuccessfulResponse(s)))),t}processUnsuccessfulResponse(e){const{success:t,errorInfo:s}=e||{};!t&&s&&this.processErrorMessage(s.message)}handleRequest(e,t={}){let s=e;return s=this.processResponse(t,s),s.pipe((0,l.catchError)(r=>{let n;return r instanceof Error?n=r.message:(typeof r.error?.errorInfo=="object"&&(n=r.error.errorInfo.message),typeof r.error=="string"&&(n=r.error)),n||(n=JSON.stringify(r.message)),this.processErrorMessage(n),(0,o.throwError)(()=>new Error(n))}))}}class $h extends jh{constructor(){super(...arguments),this._accumulatedErrorResponses=[]}_accumulateError(e){const t=(0,P.cloneDeep)(e);this._accumulatedErrorResponses.push(t)}_stopAccumulatingErrors(){this._accumulatedErrorResponses=[]}get accumulatedErrorResponses(){return this._accumulatedErrorResponses}processUnsuccessfulResponse(e){if(this._accumulateErrors&&this.canAccumulate(e)){this._accumulateError(e),this.processAccumulatedResponse(e);return}this.processSeparatedResponse(e)}handleRequestWithAccumulation(e,t){let s=!1;return this._accumulateErrors||(this._accumulateErrors=!0,s=!0),this.handleRequest(e,t).pipe((0,l.tap)(()=>{s&&(this.showAccumulatedErrors(),this._stopAccumulatingErrors())}),(0,l.catchError)(r=>{throw this._stopAccumulatingErrors(),r}))}}class rn extends $h{constructor(e,t){super(),this._dialogService=e,this._errorListDialogService=t,this._subscription=new o.Subscription}_showValidationErrors(e,t){this._subscription.add(this._errorListDialogService.showValidationErrors(e,t).subscribe())}processAccumulatedResponse(e){const t=e;t.success=!0,delete t.errorInfo,delete t.validationErrors}canAccumulate(e){return e?.errorInfo?.errorCode==="AutoAddPackageDependenciesValidateException"}showAccumulatedErrors(){const e=(0,P.cloneDeep)(this.accumulatedErrorResponses),t=e.shift();if(e.forEach(s=>{const r=s,n=t.validationErrors??[],a=r.validationErrors,u=n.some(d=>a?.find(p=>(0,P.isEqual)(p,d)));!(0,P.isEmpty)(a)&&!u&&(t.validationErrors=[...n,...a])}),t){const s=t.errorInfo?.message;this._showValidationErrors(s,t.validationErrors)}}processSeparatedResponse(e){const{validationErrors:t,errorInfo:s,success:r}=e||{};t?.length>0?this._showValidationErrors(s.message,t):!r&&s?.message&&this.processErrorMessage(s.message)}processErrorMessage(e){this._dialogService.openErrorDialog(e)}ngOnDestroy(){this._subscription.unsubscribe()}static{this.\u0275fac=function(t){return new(t||rn)(c.\u0275\u0275inject(qt),c.\u0275\u0275inject(It))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:rn,factory:rn.\u0275fac})}}class Ps{static{this.\u0275fac=function(t){return new(t||Ps)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:Ps})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[It,rn],imports:[w.CommonModule,ws]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Ps,{imports:[w.CommonModule,ws]})})();var Fe=_(59247);function Uu(i){return e=>Ui(i,e)}const qu="crt-business-rules-cache";var oe;(function(i){i.ChangeAttributeValue="ChangeAttributeValue",i.ChangeAttributeProperty="ChangeAttributeProperty",i.DataLoaded="DataLoaded",i.ContextReady="ContextReady"})(oe||(oe={}));var je;(function(i){i.Model="Model",i.ViewModel="ViewModel"})(je||(je={}));var wt;(function(i){i.Unknown="Unknown",i.Init="Init",i.Create="Create",i.Copy="Copy",i.Update="Update"})(wt||(wt={}));const Hu=new Map([[0,oe.ChangeAttributeValue],[1,oe.ChangeAttributeProperty],[2,oe.DataLoaded]]);function si(i){return Hu.has(i)?Hu.get(i):oe.DataLoaded}class Ds{canExecute(e,t,s){const r=s.map(a=>a.triggers).flat();return r.length===0?!1:(e?.triggers??[]).some(a=>a.type===oe.ContextReady)?s.some(a=>a.triggers.some(u=>si(u.type)===oe.DataLoaded&&!u.name)):r.some(a=>{const u=si(a.type);if(u===oe.DataLoaded&&e.scopeType===je.Model)return e.triggers.some(p=>p.type===oe.DataLoaded);if(!a.scopeId)return e.triggers.some(p=>p.name===a.name&&p.type===u);const d=t.find(p=>p.scopeId===a.scopeId);return d==null?!1:d.triggers.some(p=>p.name===a.name&&p.type===u)})}static{this.\u0275fac=function(t){return new(t||Ds)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ds,factory:Ds.\u0275fac})}}const Uh="Terrasoft.Core.BusinessRules.Models.Conditions.BusinessRuleGroupCondition";function Ku(i){return i&&"path"in i?i.path:""}function qh(i){const e=[];return i.conditions&&i.conditions.forEach(t=>{const s=zu(t);e.push(...s)}),e}function zu(i){if(Gu(i))return qh(i);const e=i;return[Ku(e.leftExpression),Ku(e.rightExpression)].filter(t=>t)}function Hh(i,e){return i.flatMap(t=>e.get(t).getRequiredItems()).map(t=>t.name)}function Gu(i){return i.typeName===Uh}function Wu(i){return i.map(e=>zu(e)).flat().filter(e=>e!=null)}function Kh(i,e){return i.flatMap(t=>t.cases.flatMap(s=>Hh(s.actions,e)))}function zh(i){return!i.cases||i.cases.length===0?[]:i.cases.map(e=>e.condition).filter(e=>e!=null)}function Ju(i){return i.map(e=>zh(e)).flat()}var Xt;(function(i){i.Const="Const",i.SysValue="SysValue",i.SysSetting="SysSetting",i.AttributeValue="AttributeValue",i.AttributeProperty="AttributeProperty",i.Formula="Formula"})(Xt||(Xt={}));const Gh=[Xt.Const,Xt.SysValue,Xt.SysSetting],Wh=new Set(Gh);function Zu(i){return i?!!i.type&&Wh.has(i.type):!0}function Jh(i){return i.conditions?i.conditions.every(e=>Yu(e)):!1}function Yu(i){if(!i)return!1;if(Gu(i))return Jh(i);const e=i;return(0,P.isNil)(e.leftExpression)&&(0,P.isNil)(e.rightExpression)?!1:Zu(e.leftExpression)&&Zu(e.rightExpression)}function Xu(i){return i.some(e=>e.type===oe.ContextReady)}function Zh(i,e){return Xu(i)?e.some(t=>Yu(t)):!1}function Yh(i,e){return Xu(i)?e.some(t=>t.cases?.some(s=>!s.condition)):!1}class Ts{_canExecuteByConditionsAttributePaths(e,t){const s=e.filter(n=>n.type!==oe.DataLoaded).map(n=>n.name);if(!s||s.length===0)return!1;const r=new Set(Wu(t));return s.some(n=>r.has(n))}canExecute(e,t){if(!t||t.length===0)return!1;const s=Ju(t),r=Zh(e.triggers,s),n=Yh(e.triggers,t);return r||n?!0:this._canExecuteByConditionsAttributePaths(e.triggers,s)}static{this.\u0275fac=function(t){return new(t||Ts)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ts,factory:Ts.\u0275fac})}}class lt{static{this._actionAppliers=new Map}static register(e,t){lt._actionAppliers.set(e,t)}get(e){const t=lt._actionAppliers.get(e.typeName);if(!t)throw new Error(`Business rule applier for change type ${e.typeName} not found.`);return new t(e)}static{this.\u0275fac=function(t){return new(t||lt)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:lt,factory:lt.\u0275fac})}}class Ns{constructor(e){this._actionApplierFactory=e}_applyBusinessRuleAction(e,t,s){const r=this._actionApplierFactory.get(s);return(0,o.firstValueFrom)(r.apply(e,t))}_applyBusinessRule(e,t){var s=this;return(0,S.A)(function*(){const r={id:t.scopeId,name:t.scopeName,type:t.scopeType,triggers:t.triggers};if(t.actions.length===0)return Promise.resolve(null);const n=[];for(const a of t.actions){const u=yield s._applyBusinessRuleAction(e,r,a);n.push(u)}return n})()}_applyBusinessRules(e,t){var s=this;return(0,S.A)(function*(){const r=[];for(const n of t){const a=yield s._applyBusinessRule(e,n);r.push(a)}return r})()}applyRules(e,t){return t&&t.length>0?(0,o.from)(this._applyBusinessRules(e,t)):(0,o.of)(null)}static{this.\u0275fac=function(t){return new(t||Ns)(c.\u0275\u0275inject(lt))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ns,factory:Ns.\u0275fac})}}class Qu{constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.enabled=!0,this.uId=e?.uId||(0,j.qv)(),e&&(this.enabled=e.enabled)}toMetadata(){return{typeName:this.typeName,uId:this.uId,enabled:this.enabled}}getTypeName(){return this.typeName}getApplicability(){return[]}isValid(){return!0}onDataSourceAttributeNameChanged(e,t,s){}isAttributeUsed(e,t){return!1}getAffectedItems(){return[]}getRequiredItems(){return[]}hasScopeAttributes(e){return!1}}const Xh="businessRuleActionDesignerType";function xe(i){return function(e){Reflect.defineMetadata(Xh,i,e)}}class Qt{get dataValueTypeName(){return this._dataValueTypeName}set dataValueTypeName(e){this._dataValueTypeName=e}get isLookup(){return this.dataValueTypeName===Hn.Q[A.r.Lookup].name}get referenceSchemaName(){return this._referenceSchemaName}set referenceSchemaName(e){this._referenceSchemaName!==e&&(this._referenceSchemaName=e)}constructor(e){this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleExpression",this._dataValueTypeName="",this._referenceSchemaName="",this.type=Xt.Const,this.uId=e?.uId||(0,j.qv)(),e&&(this._dataValueTypeName=e.dataValueTypeName??"",this.type=e.type||this.type,this._referenceSchemaName=e.referenceSchemaName??"")}toMetadata(){return{typeName:this.typeName,uId:this.uId,type:this.type,dataValueTypeName:this.dataValueTypeName,referenceSchemaName:this.referenceSchemaName}}copy(){return new Qt({...this.toMetadata(),uId:(0,j.qv)()})}isValid(){return!!this.uId}onDataSourceAttributeNameChanged(e,t,s){}getAffectedItem(){return null}clear(){throw new Error(`clear not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}setValue(e){throw new Error(`setValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}getValue(){throw new Error(`getValue not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isEmpty(){throw new Error(`isEmpty not implemented for BusinessRuleDesignExpression ${this.constructor.name}`)}isAttributeUsed(e,t){return!1}hasScopeAttributes(e){return!1}}class ri{static{this._expressionsTypes=new Map}static register(e,t){this._expressionsTypes.set(e,t)}static _getExpressionType(e){return this._expressionsTypes.get(e)??null}get(e){if(!e)return new Qt;const t=ri._getExpressionType(e.typeName);return t?new t(e):new Qt(e)}}function Qh(i,e){return!!e?.find(s=>!s.scopeId&&s.triggers.find(r=>r.name===i.name))}function ep(i,e){return!!e?.find(s=>s.scopeName===i.scopeName&&s.triggers?.find(r=>r.name===i.name))}function tp(i,e,t){if(e.scopeName===i){if(Qh(e,t))return!1}else if(ep(e,t))return!1;return!0}function ni(i,e){return i===e||el(i)&&el(e)}function el(i){return!i||i==="null"}function Pa(i){return function(e){ri.register(i.typeName,e)}}var Da;let Ta=Da=class extends Qt{get displayValue(){return this._displayValue}set displayValue(e){this._displayValue=e}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression",this._displayValue="",this.path="",this.scopeId="",this.type=Xt.AttributeValue,e&&(this.path=e.path,this.scopeId=e.scopeId==="null"?"":e.scopeId)}toMetadata(){return{...super.toMetadata(),path:this.path,scopeId:this.scopeId}}copy(){return new Da({...this.toMetadata(),uId:(0,j.qv)()})}isValid(){return super.isValid()&&!!this.path}onDataSourceAttributeNameChanged(e,t,s){this.scopeId===e&&this.path===t&&(this.path=s)}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t&&ni(this.scopeId,e)}hasScopeAttributes(e){return ni(this.scopeId,e)}isEmpty(){return!this.path}getValue(){return{value:this.path,displayValue:this.displayValue}}};Ta=Da=(0,h.__decorate)([Pa({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleAttributeExpression"}),(0,h.__metadata)("design:paramtypes",[Object])],Ta);var ii;let Pt=ii=class extends Qu{constructor(e){super(e),this._expressionFactory=new ri,this.typeName="Terrasoft.Core.BusinessRules.Models.BusinessRuleAction",this.executorName="",e&&(this.executorName=e.executorName,this.expression=new Ta(e.expression),e.value&&(this.value=this._expressionFactory.get(e.value)))}getExpressionAffectedItems(){const e=this.expression?.getAffectedItem()??null;return e?[e]:[]}toMetadata(){return{...super.toMetadata(),executorName:this.executorName,expression:this.expression?.toMetadata(),value:this.value?.toMetadata()}}clone(){return new ii(this.toMetadata())}copy(){const e=new ii({...this.toMetadata(),uId:(0,j.qv)()});return e.expression=this.expression?.copy(),e.value=this.value?.copy(),e}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();return t?[{path:t}]:[]}isValid(){return super.isValid()&&!!this.expression?.isValid()&&!!this.value?.isValid()}getAffectedItems(){const e=this.getExpressionAffectedItems();return[...super.getAffectedItems(),...e]}};Pt=ii=(0,h.__decorate)([xe("BusinessRuleDesignAction"),(0,h.__metadata)("design:paramtypes",[Object])],Pt);class sp extends Qu{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetProperty"}}class xs extends sp{constructor(e){super(e),this.items=[],e&&(Array.isArray(e.items)?this.items=e.items:this.items=e.items?.length>0?e.items.split(","):[])}_getAffectedItems(){return(this.items??[]).map(t=>({name:t}))}toMetadata(){return{...super.toMetadata(),items:this.items?.length>0?this.items.join(","):""}}getApplicability(){return this.isValid()?this.items.map(e=>({path:e})):[]}isValid(){return super.isValid()&&this.items?.length>0}getAffectedItems(){return[...super.getAffectedItems(),...this._getAffectedItems()]}isAttributeUsed(e,t){return this.items.includes(t)}}var ai;const rp="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement";let Na=ai=class extends xs{constructor(){super(...arguments),this.typeName=rp}clone(){return new ai(this.toMetadata())}copy(){return new ai({...this.toMetadata(),uId:(0,j.qv)()})}};Na=ai=(0,h.__decorate)([xe("BusinessRuleEditableElementDesignAction")],Na);var xa;let oi=xa=class extends Qt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression",this.path="",this.filterExpression="",e&&(this.path=e.path,this.filterExpression=e.filterExpression==="null"?"":e.filterExpression)}toMetadata(){return{...super.toMetadata(),path:this.path,filterExpression:this.filterExpression}}copy(){return new xa({...this.toMetadata(),uId:(0,j.qv)()})}isValid(){return super.isValid()&&!!this.path&&!!this.filterExpression}getAffectedItem(){return{name:this.path}}isAttributeUsed(e,t){return this.path===t}hasScopeAttributes(e){return!1}};oi=xa=(0,h.__decorate)([Pa({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleFilterLookupExpression"}),(0,h.__metadata)("design:paramtypes",[Object])],oi);var ci;let Va=ci=class extends Pt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup",this.clearValue=!1,this.populateValue=!1,e?(this.clearValue=e.clearValue??!1,this.populateValue=e.populateValue??!1):(this.clearValue=!0,this.populateValue=!0),this._processMetadata(e)}_isOldMetadataFormat(e){const t=!!e.expression?.path&&e.expression.path!=="null",s=e.value,r=!!s?.value&&s.value!=="null";return t&&r}_convertOldMetadata(e){const t={...e},s=e.expression?.path||"",n=e.value?.value,a={path:n,filterExpression:""},u={path:s,filterExpression:""};if(n.includes(".")){const[d,...p]=n.split(".");a.path=d,a.filterExpression=p.join(".")}return{...t,leftExpression:a,rightExpression:u}}_processMetadata(e){e&&(this._isOldMetadataFormat(e)&&(e=this._convertOldMetadata(e)),delete this.expression,delete this.value,this.leftExpression=new oi(e?.leftExpression),this.rightExpression=new oi(e?.rightExpression))}toMetadata(){return{...super.toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue}}clone(){return new ci({...this.toMetadata()})}copy(){return new ci({...super.copy().toMetadata(),leftExpression:this.leftExpression?.toMetadata(),rightExpression:this.rightExpression?.toMetadata(),clearValue:this.clearValue,populateValue:this.populateValue})}getApplicability(){return this.leftExpression?.path?[{path:this.leftExpression.path}]:[]}isValid(){return!!this.leftExpression?.isValid()&&!!this.rightExpression?.path}getAffectedItems(){const e=this.leftExpression?.getAffectedItem()??null,t=[...super.getAffectedItems()];return e&&t.push(e),t}getRequiredItems(){return[this.rightExpression?.getAffectedItem()].filter(e=>e)}isAttributeUsed(e,t){return this.leftExpression.isAttributeUsed(e,t)||this.rightExpression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.leftExpression.hasScopeAttributes(e)||this.rightExpression.hasScopeAttributes(e)}};Va=ci=(0,h.__decorate)([xe("BusinessRuleFilterLookupAction"),(0,h.__metadata)("design:paramtypes",[Object])],Va);var ui;let Oa=ui=class extends xs{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"}clone(){return new ui(this.toMetadata())}copy(){return new ui({...this.toMetadata(),uId:(0,j.qv)()})}};Oa=ui=(0,h.__decorate)([xe("BusinessRuleHideElementDesignAction")],Oa);var li;const tl="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionOptionalElement";let ka=li=class extends xs{constructor(){super(...arguments),this.typeName=tl}clone(){return new li(this.toMetadata())}copy(){return new li({...this.toMetadata(),uId:(0,j.qv)()})}};ka=li=(0,h.__decorate)([xe("BusinessRuleOptionalElementDesignAction")],ka);var di;const np="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement";let La=di=class extends xs{constructor(){super(...arguments),this.typeName=np}clone(){return new di(this.toMetadata())}copy(){return new di({...this.toMetadata(),uId:(0,j.qv)()})}};La=di=(0,h.__decorate)([xe("BusinessRuleReadOnlyElementDesignAction")],La);var hi;const sl="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionRequiredElement";let Ba=hi=class extends xs{constructor(){super(...arguments),this.typeName=sl}clone(){return new hi(this.toMetadata())}copy(){return new hi({...this.toMetadata(),uId:(0,j.qv)()})}};Ba=hi=(0,h.__decorate)([xe("BusinessRuleRequiredElementDesignAction")],Ba);class rl{static _getPrimaryDisplayAttributeName(e){return(0,S.A)(function*(){return(yield e.getSchema()).primaryDisplayAttributeName})()}static getLookupValue(e,t){var s=this;return(0,S.A)(function*(){const r=yield nt.create(e),n=yield r.getSchema(),a=[n.primaryAttributeName,n.primaryDisplayAttributeName];n.primaryColorAttributeName&&a.push(n.primaryColorAttributeName);const u=yield r.load({parameters:[{type:B.PrimaryColumnValue,value:t}],attributes:a});if(!u||u.length===0)throw new Error(`Can't find value for '${t}'`);if(u.length>1)throw new Error(`Load more than 1 data row for '${t}'`);const d=u[0],p=yield s._getPrimaryDisplayAttributeName(r),g={value:t,displayValue:d[p]};return n.primaryColorAttributeName&&(g.primaryColorValue=d[n.primaryColorAttributeName]),g})()}}var Fa;let ja=Fa=class extends Qt{get value(){return this._value}set value(e){this._value!==e&&(this._displayValueInitialized=!1,this._value=e)}get referenceSchemaName(){return super.referenceSchemaName}set referenceSchemaName(e){this.referenceSchemaName!==e&&(super.referenceSchemaName=e,this._displayValueInitialized=!1)}get displayValue(){return this.isLookup&&this.referenceSchemaName?this._displayValueInitialized?this._displayValue:null:(this._displayValue=this.value,this._displayValueInitialized=!0,this._displayValue)}set displayValue(e){this._displayValue=e??"",this._displayValueInitialized=e!=null}get dataValueTypeName(){return super.dataValueTypeName}set dataValueTypeName(e){this.dataValueTypeName!==e&&(super.dataValueTypeName=e,this._displayValueInitialized=!1)}constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression",this._value="",this._displayValue="",this._displayValueInitialized=!1,e&&(this._value=e.value)}initDisplayValue(){var e=this;return(0,S.A)(function*(){if(e._displayValueInitialized)return Promise.resolve(e._displayValue);if(e.isLookup&&e.referenceSchemaName&&e._value){const t=yield rl.getLookupValue(e.referenceSchemaName,e._value);e._displayValue=t.displayValue}else e._displayValue=e.value;return e._displayValueInitialized=!0,Promise.resolve(e._displayValue)})()}toMetadata(){return{...super.toMetadata(),value:this.value}}copy(){return new Fa({...this.toMetadata(),uId:(0,j.qv)()})}isValid(){return super.isValid()?this.isLookup?(0,j.n7)(this.value):this.value!=null&&this.value!=="":!1}clear(){this._value="",this._displayValue="",this._displayValueInitialized=!1}setValue(e){e?(this.value=e.value,this.displayValue=e.displayValue):this.clear()}getValue(){return{value:this.value,displayValue:this.displayValue}}isEmpty(){return!this.value}};ja=Fa=(0,h.__decorate)([Pa({typeName:"Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleValueExpression"}),(0,h.__metadata)("design:paramtypes",[Object])],ja);var pi;let $a=pi=class extends Pt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter",e&&(this.value=new ja(e.value))}clone(){return new pi(this.toMetadata())}copy(){return new pi(super.copy().toMetadata())}getApplicability(){return this.expression?.path?[{path:this.expression.path}]:[]}isAttributeUsed(e,t){return this.expression.isAttributeUsed(e,t)}hasScopeAttributes(e){return this.expression.hasScopeAttributes(e)}};$a=pi=(0,h.__decorate)([xe("BusinessRuleSetFilterAction"),(0,h.__metadata)("design:paramtypes",[Object])],$a);var mi;let Ua=mi=class extends Pt{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"}clone(){return new mi(this.toMetadata())}copy(){return new mi(super.copy().toMetadata())}};Ua=mi=(0,h.__decorate)([xe("BusinessRuleSetValueDesignAction")],Ua);var qa;(function(i){i.DataSource="DataSource",i.Page="Page"})(qa||(qa={}));var fi;let Ha=fi=class extends Pt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Expressions.BusinessRuleSetValueItem",this.scope=e?.scopeId??"",this.scope==="null"&&(this.scope="")}clone(){return new fi(this.toMetadata())}copy(){return new fi({...super.copy().toMetadata(),scopeId:this.scope})}toMetadata(){return{...super.toMetadata(),scopeId:this.scope}}getApplicability(){if(!this.expression?.path)return[];const t=this.expression.path.split(".").shift();if(!t)return[];const s={path:t};return this.scope!==""&&(s.applicability=qa.DataSource,s.scope=this.scope),[s]}isAttributeUsed(e,t){return this.expression.path===t&&ni(this.scope,e)}hasScopeAttributes(e){return ni(this.scope,e)}};Ha=fi=(0,h.__decorate)([xe("BusinessRuleSetValueItem"),(0,h.__metadata)("design:paramtypes",[Object])],Ha);var gi;let Ka=gi=class extends Pt{constructor(e){super(e),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues",this.items=[],e&&(this.items=e.items?.map(t=>new Ha(t)))}getExpressionAffectedItems(){return[]}clone(){return new gi(this.toMetadata())}copy(){return new gi({...super.copy().toMetadata(),items:this.items.map(e=>e.toMetadata())})}toMetadata(){const e={...super.toMetadata(),items:this.items?.length>0?this.items.map(t=>t.toMetadata()):[]};return this.items?.length>0&&(delete e.expression,delete e.value),e}getApplicability(){return this.items?.length?this.items.flatMap(e=>e.getApplicability()):[]}isValid(){return this.items?.length>0&&this.items.every(e=>e.isValid())}getAffectedItems(){const t=(this.items??[]).map(s=>s.getAffectedItems()).flat();return[...super.getAffectedItems(),...t]}getRequiredItems(){return this.getAffectedItems()}isAttributeUsed(e,t){return this.items.some(s=>s.isAttributeUsed(e,t))}hasScopeAttributes(e){return this.items.some(t=>t.hasScopeAttributes(e))}};Ka=gi=(0,h.__decorate)([xe("BusinessRuleSetValuesDesignAction"),(0,h.__metadata)("design:paramtypes",[Object])],Ka);var _i;let za=_i=class extends xs{constructor(){super(...arguments),this.typeName="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"}clone(){return new _i(this.toMetadata())}copy(){return new _i({...this.toMetadata(),uId:(0,j.qv)()})}};za=_i=(0,h.__decorate)([xe("BusinessRuleShowElementDesignAction")],za);class Vs{get(e){return e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionShowElement"?new za(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionHideElement"?new Oa(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionReadonlyElement"?new La(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionEditableElement"?new Na(e):e.typeName===tl?new ka(e):e.typeName===sl?new Ba(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionFilterLookup"?new Va(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetFilter"?new $a(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValue"?new Ua(e):e.typeName==="Terrasoft.Core.BusinessRules.Models.Actions.BusinessRuleActionSetValues"?new Ka(e):new Pt(e)}static{this.\u0275fac=function(t){return new(t||Vs)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Vs,factory:Vs.\u0275fac,providedIn:"root"})}}var yi;(function(i){i[i.Condition=0]="Condition",i[i.Action=1]="Action",i[i.Trigger=2]="Trigger",i[i.Context=3]="Context",i[i.Unknown=4]="Unknown"})(yi||(yi={}));class ip{}class Os extends ip{constructor(e,t,s){super(),this._httpClient=e,this._cacheManager=t,this._measurePerformanceService=s,this._cachedLoadScopesRequests=new Map,this.serviceEndpoint="/ServiceModel/BusinessRulesManagerService.svc/",this.getBusinessRulesConfigMethodName="GetBusinessRules"}_getBusinessRulesCache(){return this._cache?(0,o.of)(this._cache):(0,o.from)(this._cacheManager.get(qu)).pipe((0,o.tap)(e=>this._cache=e))}_getCachedBusinessRulesScopes(e){return e.length?this._getBusinessRulesCache().pipe((0,o.switchMap)(t=>{const s=e.map(r=>{const n=this._getContextCacheKey(r.scopeType,r.scopeName);return(0,o.from)(t.get(n)).pipe((0,o.map)(a=>a?{rules:a,scopeName:r.scopeName,scopeType:r.scopeType}:null))});return(0,o.forkJoin)(s)}),this._measurePerformanceService.measure$("BusinessRulesManager: get business rules from cache")):(0,o.of)([])}_getScopeType(e){return e==="Model"?je.Model:je.ViewModel}_mapResponseToBusinessRules(e){return!e?.businessRules||e.businessRules.length===0?[]:e.businessRules.map(t=>{const s=JSON.parse(t.businessRulesConfig);return{scopeName:t.schemaName,scopeType:this._getScopeType(t.type),rules:s}})}_getContextsScopeNames(e){return e.map(t=>t.scopeName)}_getContextCacheKey(e,t){return`Type:#${e}#-Name:#${t}#`}_getContextsScopeNamesRequestKey(e){return e.map(s=>this._getContextCacheKey(s.scopeType,s.scopeName)).join("_")}_getCachedLoadScopesRequest(e){const t=e.map(r=>this._getContextCacheKey(r.scopeType,r.scopeName)),s=[...this._cachedLoadScopesRequests.keys()].find(r=>t.every(n=>r.includes(n)));return this._cachedLoadScopesRequests.get(s)}_getNotLoadedBusinessRulesScopes(e){if(e.length===0)return(0,o.of)([]);const t=this._getContextsScopeNames(e),s=this._getCachedLoadScopesRequest(e);if(s)return s.request$.pipe((0,o.map)(u=>u.filter(d=>t.includes(d.scopeName))));const r=`${this.serviceEndpoint}${this.getBusinessRulesConfigMethodName}`,n={scopes:Array.from(new Map(e.map(u=>[this._getContextCacheKey(u.scopeType,u.scopeName),{name:u.scopeName,type:u.scopeType,modelType:u.modelType}])).values())},a=this._httpClient.post(r,n).pipe((0,o.map)(u=>this._mapResponseToBusinessRules(u)),(0,o.switchMap)(u=>u.length?this._getBusinessRulesCache().pipe((0,o.switchMap)(d=>{const p=u.map(g=>{const C=this._getContextCacheKey(g.scopeType,g.scopeName);return(0,o.from)(d.set(C,g.rules))});return(0,o.forkJoin)(p).pipe((0,o.map)(()=>u))}),this._measurePerformanceService.measure$("BusinessRulesManager: set loaded business rules to cache")):(0,o.of)(u)),(0,o.tap)(()=>{const u=this._getContextsScopeNamesRequestKey(e);this._cachedLoadScopesRequests.delete(u)}),(0,o.share)());return this._cachedLoadScopesRequests.set(this._getContextsScopeNamesRequestKey(e),{request$:a,scopeNames:t}),a}getBusinessRulesByContexts(e){const t=e.filter(s=>s.scopeName&&s.modelType!=="crt.PageParametersDataSource");return this._getCachedBusinessRulesScopes(t).pipe((0,o.switchMap)(s=>{const r=t.filter(a=>!s?.some(u=>u?.scopeName===a.scopeName&&u.scopeType===a.scopeType));return this._getNotLoadedBusinessRulesScopes(r).pipe((0,o.map)(a=>[...s,...a].filter(Boolean)),(0,o.catchError)(a=>{const u=t?.map(d=>d.scopeName).join(", ");return console.warn(`An error occurred during getting business rules execution for scopes: ${u}.`,a),(0,o.of)([])}))}))}clearCachedBusinessRules(){return this._getBusinessRulesCache().pipe((0,o.switchMap)(e=>(0,o.from)(e.clear())),(0,o.map)(()=>!0),this._measurePerformanceService.measure$("BusinessRulesManager: clear business rules from cache"))}static{this.\u0275fac=function(t){return new(t||Os)(c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(ge.G),c.\u0275\u0275inject(te.g))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Os,factory:Os.\u0275fac,providedIn:"root"})}}class nn{constructor(e,t){this._businessRulesManager=e,this._businessRuleDesignActionFactory=t,this._scopeAttributes=[]}_filterTriggers(e,t){const s=t.filter(a=>a.scopeName===e.parentScopeId),n=t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules.map(a=>a.triggers).flat();return e.triggers.filter(a=>{if(a.type===oe.ContextReady||a.type===oe.DataLoaded)return!0;const u=n?.some(g=>g&&g.name===a.name&&si(g.type)===a.type),p=s.flatMap(g=>g.rules.flatMap(C=>C.triggers)).some(g=>g.name===a.name&&si(g.type)===a.type);return u||p})}_filterAttributes(e){const s=this._scopeAttributes.filter(a=>a.scopeName===e.scopeName).map(a=>a.attributes).flat(),r=this._scopeAttributes.filter(a=>a.scopeName!==e.scopeName).flatMap(a=>[...a.attributes]);return e.attributes.filter(a=>s.includes(a.attributeName)||r.includes(a.attributeName)||a.isSignificant)}_cacheUsedAttributes(e){e.forEach(t=>{if(!this._scopeAttributes.find(s=>s.scopeName===t.scopeName&&s.scopeType===t.scopeType)){const s=Ju(t.rules),r=Wu(s),n=Kh(t.rules,this._businessRuleDesignActionFactory),a=t.rules.flatMap(u=>u.triggers?.map(d=>d.name)).filter(Boolean);this._scopeAttributes.push({scopeName:t.scopeName,scopeType:t.scopeType,attributes:[...r,...n,...a]})}})}_hasActiveRules(e,t){return(t.find(a=>a.scopeName===e.scopeName&&a.scopeType===e.scopeType)?.rules??[]).filter(a=>a.enabled===!0).length>0}clearCachedScopeAttributes(){this._scopeAttributes=[]}filter(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,o.tap)(t=>this._cacheUsedAttributes(t)),(0,o.map)(t=>e.map(r=>({...r,attributes:this._filterAttributes(r),triggers:this._filterTriggers(r,t)})).filter(r=>this._hasActiveRules(r,t)?!0:r.attributes.length>0)))}static{this.\u0275fac=function(t){return new(t||nn)(c.\u0275\u0275inject(Os),c.\u0275\u0275inject(Vs))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:nn,factory:nn.\u0275fac,providedIn:"root"})}}class ks{constructor(e,t,s,r,n,a,u){this._businessRulesManager=e,this._businessRulesTriggerExecutor=t,this._businessRulesConditionExecutor=s,this._httpClient=r,this._messageChannelService=n,this._featureService=a,this._contextFilter=u,this._businessRulesResponseEventName="BusinessRuleExecutionResponse",this._serviceUrl="ServiceModel/BusinessRulesEngineService.svc/Execute",this._businessRulesRequestEventName="BusinessRuleExecutionRequest",this._businessRuleDesignActionFactory=new Vs,this._configurationStructureChangedSubscribe()}_configurationStructureChangedSubscribe(){this._messageChannelService.getMessages("ConfigurationStructureChanged").pipe((0,l.switchMap)(()=>(this._contextFilter.clearCachedScopeAttributes(),this._businessRulesManager.clearCachedBusinessRules()))).subscribe()}_featureStates(){return(0,o.from)(this._featureService.getFeaturesState(["BRules-UseWebSocketChannel","BRules-DisableContextOptimization"])).pipe((0,l.map)(([e,t])=>({useHttpChannel:!e,disableContextOptimization:t})))}_sendWebSocketMessage(e){const t=(0,j.qv)();return e.businessRulesSessionId=t,new o.Observable(s=>{const r=this._messageChannelService.messageEvent$.pipe((0,l.map)(n=>n.body),(0,l.filter)(n=>n!=null),(0,l.filter)(n=>n.eventName===this._businessRulesResponseEventName),(0,l.filter)(n=>n.businessRulesSessionId===t),(0,l.map)(n=>n.payload)).subscribe({next:n=>{r.unsubscribe(),n.success?s.next(n.businessRulesResponse):(console.error("An error occurred during business rules execution. "+n.errorInfo.errorCode+": "+n.errorInfo.message),s.next([])),s.complete()},error:n=>{r.unsubscribe(),console.error("An error occurred during business rules execution. "+n.errorCode+": "+n.message),s.next([]),s.complete()},complete:()=>{r.unsubscribe(),s.error("WebSocket channel closed")}});this._messageChannelService.sendMessage(e,Ar.PTP).pipe((0,o.take)(1)).subscribe()})}_createWebSocketRequest(e){return{eventName:this._businessRulesRequestEventName,contexts:e}}_executeUsingWebSocket(e){const t=this._createWebSocketRequest(e);return this._sendWebSocketMessage(t)}_logErrorMessageAndReturnDefBusinessRuleResponse(e){return console.error("An error occurred during business rules execution. "+e.errorCode+": "+e.message),(0,o.of)([])}_executeUsingHttp(e){return this._httpClient.post(this._serviceUrl,{contexts:e},{headers:new N.HttpHeaders({"Content-Type":"application/json"})}).pipe((0,l.mergeMap)(t=>t.success?(0,o.of)(t.businessRulesResponse):this._logErrorMessageAndReturnDefBusinessRuleResponse(t.errorInfo)),(0,l.catchError)(t=>this._logErrorMessageAndReturnDefBusinessRuleResponse(t)))}_canExecuteBusinessRulesByContexts(e){return this._businessRulesManager.getBusinessRulesByContexts(e).pipe((0,l.map)(t=>{const s=t.filter(r=>r.rules&&r.rules.length>0);return s.length===0?!1:s.some(r=>{const n=e.find(p=>p.scopeName===r.scopeName&&p.scopeType===r.scopeType),a=e.filter(p=>p.parentScopeId===n.scopeId),u=this._businessRulesTriggerExecutor.canExecute(n,a,r.rules),d=this._businessRulesConditionExecutor.canExecute(n,r.rules);return u||d})}))}_getContextsWithScope(e){return e.filter(t=>t.scopeName&&t.scopeId)}_getBusinessRuleActions(e){return e.cases.map(t=>t.actions).flat().filter(t=>t.enabled).map(t=>this._businessRuleDesignActionFactory.get(t))}_getBusinessRuleAffectedAttributes(e){return this._getBusinessRuleActions(e).map(s=>s.getAffectedItems()).flat()}_getAffectedAttributes(e){let t=e.rules.filter(s=>s.enabled).map(s=>this._getBusinessRuleAffectedAttributes(s)).flat();return t=this._getUniqueAffectedAttributes(t),t.forEach(s=>{s.scopeName=e.scopeName}),t}_getUniqueAffectedAttributes(e){const t=e.map(r=>[r.name,r]);return[...new Map(t).values()]}_execute(e){return this._featureStates().pipe((0,l.switchMap)(({useHttpChannel:t,disableContextOptimization:s})=>(0,o.forkJoin)({useHttpChannel:(0,o.of)(t),executionContexts:s?(0,o.of)(e):this._contextFilter.filter(e)})),(0,l.switchMap)(({useHttpChannel:t,executionContexts:s})=>(t?this._executeUsingHttp(s):this._executeUsingWebSocket(s)).pipe((0,l.map)(r=>({executionResults:r,executionContexts:s})))),(0,l.switchMap)(({executionResults:t,executionContexts:s})=>this._logUnsuccessfulBusinessRulesExecution(t,s).pipe((0,l.map)(()=>t))))}_logUnsuccessfulBusinessRulesExecution(e,t){const s=e?.filter(r=>r?.errors?.length>0).map(r=>r.errors).flat();return s?.length===0?(0,o.of)(void 0):(0,o.from)(this._featureService.getFeatureState("BRules-ShowChildRules")).pipe((0,l.switchMap)(r=>this._businessRulesManager.getBusinessRulesByContexts(t).pipe((0,l.map)(n=>n.map(a=>a.rules).flat()),(0,l.tap)(n=>{s.map(a=>this._getUnsuccessfulBusinessRuleExecutionMessage(a,n,r)).forEach(a=>{console.error(a)})}),(0,l.map)(()=>{}))))}_getUnsuccessfulBusinessRuleExecutionMessage(e,t,s){const r="Business rule execution error: ",n=`Error message: "${e.message}"`,a=e.type===yi.Unknown?"":`The error occurred in the business rule ${yi[e.type]?.toLocaleLowerCase()}s.`;let u=t.find(I=>I.uId===e.businessRuleId);if(!u)return`${r}Rule id - "${e.businessRuleId}". ${n}. ${a}`;!(0,j.gZ)(u.parentUId)&&!s&&(u=t.find(I=>I.uId===u.parentUId));const d=u.caption||"",p=u.name,g=`Rule Title - "${d}"`,C=`Rule Code - "${p}"`;return`${r}${g}, ${C}. ${n}. ${a}`}execute(e){const t=this._getContextsWithScope(e);return t.length===0?(0,o.of)([]):this._canExecuteBusinessRulesByContexts(e).pipe((0,l.switchMap)(s=>s?this._execute(t):(0,o.of)([])),(0,l.catchError)(s=>(console.warn(`An error occurred during business rules execution for scopes: ${e?.map(r=>r.scopeName).join(", ")}.`,s),(0,o.of)([]))))}getAffectedAttributes(e){var t=this;return(0,S.A)(function*(){if(e.length===0)return[];const s=e.filter(a=>a.scopeName!=null),n=(yield(0,o.firstValueFrom)(t._businessRulesManager.getBusinessRulesByContexts(s))).filter(a=>a.rules&&a.rules.length>0);return n.length===0?[]:n.map(a=>t._getAffectedAttributes(a)).flat()})()}static{this.\u0275fac=function(t){return new(t||ks)(c.\u0275\u0275inject(Os),c.\u0275\u0275inject(Ds),c.\u0275\u0275inject(Ts),c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject($n),c.\u0275\u0275inject(ut),c.\u0275\u0275inject(nn))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ks,factory:ks.\u0275fac})}}function Ls(i){return function(e){Pe(i.type,"BusinessRulesActionApplierTypeName"),Ke(i.type),lt.register(i.type,e)}}class bi{constructor(e){this.action=e}_logError(e){return console.error("Error when applying business rule",this.action),console.error(e),(0,o.of)(null)}apply(e,t){let s;try{s=this.innerApply(e,t)}catch(r){return this._logError(r)}return s.pipe((0,o.catchError)(r=>this._logError(r)))}}function ap(i){return`${i}_List`}function op(i){return`${i}_BusinessRule_Filter`}function nl(i,e){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,S.A)(function*(i,e){let t=yield i[e];return t instanceof me||(t=new me,i[e]=t),t}),Ga.apply(this,arguments)}function cp(i,e,t){return Wa.apply(this,arguments)}function Wa(){return Wa=(0,S.A)(function*(i,e,t){return(yield nl(i,e)).filters.get(t)||new me(_s.And)}),Wa.apply(this,arguments)}function up(i,e,t,s){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,S.A)(function*(i,e,t,s){const r=yield nl(i,e);r.add(s,t),i[e]=r}),Ja.apply(this,arguments)}function lp(i,e,t){return(i.getViewModelAttributePaths(e,t)??[]).map(n=>ap(n)).map(n=>op(n))}function Za(i,e,t,s,r,n){return Ya.apply(this,arguments)}function Ya(){return Ya=(0,S.A)(function*(i,e,t,s,r,n){const a=lp(i,e,t);for(const u of a){const d=yield cp(i,u,r);d.add(s,n),yield up(i,u,r,d)}}),Ya.apply(this,arguments)}let Xa=class extends bi{_createLookupFilterGroup(e,t){const s=new me(_s.And),r=new Ne(ne.Equal,new se({columnPath:e}),new ae({value:t}));return s.add(r,"lookupFilter"),s}_setFilterForScope(e,t){const s=this.action,r=s.path;if(s.value){const{leftExpression:n,rightExpression:a}=s.value,u=this._createLookupFilterGroup(n,a.value);return Za(e,t,r,u,s.businessRuleUId,s.actionUId)}return Za(e,t,r,new me,s.businessRuleUId,s.actionUId)}innerApply(e,t){const s=this._setFilterForScope(e,t.id);return(0,o.from)(s)}};Xa=(0,h.__decorate)([Ls({type:"crt.FilterLookup"})],Xa);let Qa=class extends bi{_getFilter(e){if(e){const t=e.value,s=JSON.parse(t);return Es.fromJson(s)}else return new me}innerApply(e,t){const s=this.action,r=this._getFilter(s.value),n=Za(e,t.id,s.path,r,s.businessRuleUId,s.actionUId);return(0,o.from)(n)}};Qa=(0,h.__decorate)([Ls({type:"crt.SetFilter"})],Qa);let eo=class extends bi{_getValue(e){const t=e.value,s=t.value;if(s==null)return(0,o.of)(s);const r=t.dataValueTypeName,a=Object.values(Hn.Q).find(d=>d.name===r)?.type??A.r.Text,u=_a(s,a);return a===A.r.Lookup?(0,o.from)(rl.getLookupValue(t.referenceSchemaName,t.value)):(0,o.of)(u)}_setValue(e,t,s){const r=this.action.path,n=e.getViewModelAttributePath(t,r);return n?e.setValue({[n]:s}):e.setModelValues(t,{[r]:s})}innerApply(e,t){const s=this.action,r=s.value;return s.skip===!0?(0,o.of)(null):this._getValue(s).pipe((0,o.switchMap)(n=>{if(t.type===je.Model)return this._setValue(e,t.id,n);if(r.scope)return this._setValue(e,r.scope,n);const a=e.getAttributeNameByViewItemName(s.path);return a?e.setValue({[a]:n}):e.setValue({[s.path]:n})}))}};eo=(0,h.__decorate)([Ls({type:"crt.SetValue"})],eo);const dp=i=>i.replace(/\./g,"")+"_PropertiesBindingAttribute";class to extends bi{_getAttributeNames(e,t,s){if(t.type===je.Model)return e.getViewModelAttributePaths(t.id,s);let r=e.getAttributeNameByViewItemName(s);return r||(r=dp(s)),[r]}setAttributePropertyValue(e,t,s){e.setAttributePropertyValue(t,this.propertyName,s)}resetAttributePropertyValue(e,t){e.resetAttributePropertyValue(t,this.propertyName)}innerApply(e,t){const s=this.action.path;if(!s)return(0,o.of)(!0);const n=s.split(":")[0],a=this._getAttributeNames(e,t,n);return a&&a.forEach(u=>{this.action.resetToDefault?this.resetAttributePropertyValue(e,u):this.setAttributePropertyValue(e,u,this.action.value)}),(0,o.of)(!0)}}let so=class extends to{constructor(){super(...arguments),this.propertyName="readonly"}_getPropertyName(e,t){return e.getInvariabilityPropertyName(t)??this.propertyName}setAttributePropertyValue(e,t,s){const r=this._getPropertyName(e,t);e.setAttributePropertyValue(t,r,s)}resetAttributePropertyValue(e,t){const s=this._getPropertyName(e,t);e.resetAttributePropertyValue(t,s)}};so=(0,h.__decorate)([Ls({type:"crt.SetReadonlyPropertyActionApplier"})],so);let ro=class extends to{constructor(){super(...arguments),this.propertyName="required"}};ro=(0,h.__decorate)([Ls({type:"crt.SetRequiredPropertyActionApplier"})],ro);let no=class extends to{constructor(){super(...arguments),this.propertyName="visible"}};no=(0,h.__decorate)([Ls({type:"crt.SetVisibilityPropertyActionApplier"})],no);function hp(){const i=[Xa,Qa,eo,so,ro,no]}hp();class an{static{this.\u0275fac=function(t){return new(t||an)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:an})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[ks,Ns,lt,Ds,Ts,{provide:Zi.P,useValue:{name:qu,type:z.P.PersistentAndMemory,options:{tableName:Yi.w.BusinessRules}},multi:!0}]})}}var Bs;(function(i){i.string="Strings",i.image="Images"})(Bs||(Bs={}));const on="Resources";class cn extends Array{constructor(e){super(),Object.setPrototypeOf(this,Object.create(cn.prototype)),Array.isArray(e)&&this._fillFromSource(e)}_fillFromSource(e){e.filter(t=>t?.cultureName!=null).forEach(t=>{this.setValueLocalizableString(t.cultureName,t.value)})}getValue(e){const t=this.getLocalizableString(e);return t?t.value:""}hasCultureValue(e,t=!1){const s=this.getLocalizableString(e);return t?(s?.value||null)!=null:s?.value!=null}getLocalizableString(e){return this.find(t=>t.cultureName===e)||null}setValueLocalizableString(e,t){const s=this.getLocalizableString(e);return s?s.value=t:this.push({cultureName:e,value:t}),this}setValues(e,t=!1){return e.forEach(s=>{this.hasCultureValue(s.cultureName)&&t||this.setValueLocalizableString(s.cultureName,s.value)}),this}clone(){return new cn(this)}}class Fs{constructor(e){this.userInfo=e,this._resourceMacrosRegExpPattern="(?<macrosBody>#ResourceString\\((?<macrosArgs>[^)]*)\\)#)",this._viewModelAttributeRegExpPattern=`\\$${on}.${Bs.string}.(?<macrosArgs>[\\S\\s]*)`,this._sysCultureName=this.userInfo.cultureInfo.sysCultureName,this._defCultureName=this.userInfo.defCultureInfo.sysCultureName}_getLczResource(e){const t={};return e.forEach(s=>t[s.cultureName]=s.value),t}_getResourceValueMatches(e){const t=new RegExp(this._resourceMacrosRegExpPattern,"g"),s=new RegExp(this._viewModelAttributeRegExpPattern,"g");let r=[...(e??"").matchAll(s)];return r.length||(r=[...(e??"").matchAll(t)]),r}_findStringPropertyResource(e,t){const{resourceName:s,useMacrosTemplate:r}=this.findResourcesName(e);if(s)return{path:t,resourceName:s,useMacrosTemplate:r}}_findArrayPropertyResources(e,t=""){return e.flatMap((s,r)=>this.findPropertyResources(s,t?`${t}.${r}`:`${r}`))}_findObjectPropertyResources(e,t=""){return Object.entries(e).flatMap(([s,r])=>this.findPropertyResources(r,t?`${t}.${s}`:s))}findLocalizableValue(e){if(typeof e=="string")return e;if(!e||typeof e!="object")return null;let t;return Array.isArray(e)?t=e?.filter(s=>s.value).reduce((s,r)=>Object.assign(s,{[r.cultureName]:r.value}),{}):t=e,(t[this._sysCultureName]??t[this._defCultureName])?.toString()??null}findResourcesName(e){const s=this._getResourceValueMatches(e)[0]?.groups.macrosArgs,r=e?.startsWith("#MacrosTemplateString");return{resourceName:s,useMacrosTemplate:r}}findLocalizationFromResourceString(e,t,s=""){const{resourceName:r}=this.findResourcesName(e),n=r!==void 0&&t.strings[r];if(n){const d=Object.entries(n).map(([p,g])=>({cultureName:p,value:g}));return new cn(d)}const a=r===void 0&&e||s,u=this._sysCultureName||this._defCultureName;return new cn([{cultureName:u,value:a}])}findValueFromResource(e,t){const s=this.findLocalizationFromResourceString(e,t),r=this._getLczResource(s);return this.findLocalizableValue(r)}findViewModelResourceValue(e,t,s){var r=this;return(0,S.A)(function*(){const{resourceName:n}=r.findResourcesName(e);let a;return n&&(a=yield t.Strings[n]),a||s||e})()}findPropertyResources(e,t=""){return e?Array.isArray(e)?this._findArrayPropertyResources(e,t):typeof e=="object"?this._findObjectPropertyResources(e,t):typeof e=="string"?[this._findStringPropertyResource(e,t)].filter(Boolean):[]:[]}static{this.\u0275fac=function(t){return new(t||Fs)(c.\u0275\u0275inject(We.oq))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Fs,factory:Fs.\u0275fac,providedIn:"root"})}}var Dt;(function(i){i.Root="root",i.Angular="angular"})(Dt||(Dt={}));const pp=new c.InjectionToken("CrtNavigationLock");class io{static{this.instance=new io}wait(e){return e()}}class Tt{static{this.\u0275fac=function(t){return new(t||Tt)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:Tt})}static{this.\u0275inj=c.\u0275\u0275defineInjector({imports:[w.CommonModule]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Tt,{imports:[w.CommonModule]})})();function mp(i){return i?function(e){const t=typeof i=="string"?i:i.type;Pe(t,"converterTypeName"),Hc({type:t,typeRef:e},e)}:e=>{}}let ao=class{convert(e,t){const s={type:"crt.ExecuteExpressionRequest",$context:t,metadata:e};return Se.instance.process(s).then(r=>r).catch(r=>({success:!1,result:null,errorInfo:r}))}};ao=(0,h.__decorate)([mp({type:"crt.ToExpressionResult"})],ao);class G{}class Nt{static{this._requestsMap=new Map}static{this._requestsRegistrationInfos=new Map}static get requestsRegistrationInfos(){return this._requestsRegistrationInfos}static register(e,t){const s=e.type;Nt._requestsMap.set(s,t),Nt._requestsRegistrationInfos.set(s,e)}static get(e){const t=Nt._requestsMap.get(e);return kn(e,t),t&&new t}}function L(i){return function(e){Pe(i.type,"RequestTypeName"),Ke(i.type),Nt.register(i,e)}}function Re(i){return i?function(e){Pe(i.type,"RequestHandlerTypeName"),Ke(i.type),Yc(i,e)}:e=>{}}class js{_getDataValueTypeName(e){switch(e){case A.r.FLOAT0:return"Float0";case A.r.FLOAT1:return"Float1";case A.r.FLOAT2:return"Float2";case A.r.FLOAT3:return"Float3";case A.r.FLOAT4:return"Float4";case A.r.FLOAT8:return"Float8";case A.r.MONEY0:return"Money0";case A.r.MONEY1:return"Money1";case A.r.MONEY3:return"Money3";case A.r.CUSTOM_OBJECT:return"Object";case A.r.COMPOSITE_OBJECT_LIST:return"CompositeObjectList";default:return A.r[e]}}_getRequestParameterValueDto(e){const t=e.value;if(Array.isArray(t)){const s=t[0];return Array.isArray(s)?t.map(r=>r.map(n=>({...n,value:this._encodeValue(n.value,n.dataValueType),dataValueType:this._getDataValueTypeName(n.dataValueType)}))):t.map(r=>({...r,value:this._encodeValue(r.value,r.dataValueType),dataValueType:this._getDataValueTypeName(r.dataValueType)}))}return this._encodeValue(t,e.dataValueType)}_encodeValue(e,t){return[A.r.Date,A.r.Time,A.r.DateTime].includes(t)?sa(e):e}decodeValue(e,t){return[A.r.Date,A.r.Time,A.r.DateTime].includes(t)?new Date(e):e}getExecutionMetadata(e){const t=e.parameters.map(r=>({...r,dataValueType:this._getDataValueTypeName(r.dataValueType),value:this._getRequestParameterValueDto(r)})),s=e.expressionVariables.map(r=>({...r,dataValueType:this._getDataValueTypeName(r.dataValueType)}));return JSON.stringify({...e,parameters:t,expressionVariables:s,resultDataValueType:this._getDataValueTypeName(e.resultDataValueType)})}static{this.\u0275fac=function(t){return new(t||js)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:js,factory:js.\u0275fac,providedIn:"root"})}}class $s{constructor(e,t,s,r){this._httpClient=e,this._featureService=t,this._sysSettingsService=s,this._expressionMetadataAdapter=r,this._expressionEngineEndpoint="ServiceModel/ExpressionService.svc/Execute",this._expressionsEngineEndpoint="ServiceModel/ExpressionService.svc/ExecuteMany",this._expressionEngineValidationEndpoint="ServiceModel/ExpressionService.svc/Validate",this._defaultDebounceTime=200,this._defaultBundleCount=20,this._debounceTimeSysSettingName="ExpressionEngineDebounceTime",this._bundleCountSysSettingName="ExpressionEngineBundleCount",this._requests=new o.Subject}_executeImmediate(e){const t={metadata:e};return(0,o.lastValueFrom)(this._httpClient.post(this._expressionEngineEndpoint,t,{headers:new N.HttpHeaders({"Content-Type":"application/json"})}))}_getBundleSettings(){var e=this;return(0,S.A)(function*(){const{values:t}=yield e._sysSettingsService.getByCodes([e._debounceTimeSysSettingName,e._bundleCountSysSettingName]),s=t[e._debounceTimeSysSettingName]?.value||e._defaultDebounceTime,r=t[e._bundleCountSysSettingName]?.value||e._defaultBundleCount;return{executionDebounceTime:s,bundleCount:r}})()}_prepareDebouncedResponsesStream(){var e=this;return(0,S.A)(function*(){const{executionDebounceTime:t,bundleCount:s}=yield e._getBundleSettings();if(e._responses)return;const r=new o.BehaviorSubject(0),n=(0,o.merge)(r.pipe((0,o.filter)(a=>a>=s)),e._requests.pipe((0,o.tap)(()=>{r.next(r.value+1)}),(0,o.debounceTime)(t)));e._responses=e._requests.pipe((0,o.buffer)(n),(0,o.filter)(({length:a})=>!!a),(0,o.mergeMap)(a=>(r.next(0),e._httpClient.post(e._expressionsEngineEndpoint,a,{headers:new N.HttpHeaders({"Content-Type":"application/json"})}))),(0,o.share)())})()}_executeThrottled(e){var t=this;return(0,S.A)(function*(){yield t._prepareDebouncedResponsesStream();const s=(0,j.qv)(),r=(0,o.firstValueFrom)(t._responses.pipe((0,o.filter)(n=>n.some(a=>a.executionId===s)),(0,o.map)(n=>n.find(a=>a.executionId===s).result)));return t._requests.next({executionId:s,metadata:e}),r})()}safeExecute(e){var t=this;return(0,S.A)(function*(s,r={immediate:!1}){try{return yield t.execute(s,r)}catch(n){return{success:!1,errorInfo:n instanceof N.HttpErrorResponse?{errorCode:n.name,message:n.message,stackTrace:n.url}:n,result:null}}}).apply(this,arguments)}execute(e){var t=this;return(0,S.A)(function*(s,r={immediate:!1}){let n;const a=t._expressionMetadataAdapter.getExecutionMetadata(s),u=yield t._featureService.getFeatureState("ExpressionEngineDisableBundling");return r.immediate||u?n=yield t._executeImmediate(a):n=yield t._executeThrottled(a),n.success?{...n,result:t._expressionMetadataAdapter.decodeValue(n.result,s.resultDataValueType)}:Promise.reject(n.errorInfo)}).apply(this,arguments)}validate(e){const t={metadata:this._expressionMetadataAdapter.getExecutionMetadata(e)};return(0,o.lastValueFrom)(this._httpClient.post(this._expressionEngineValidationEndpoint,t))}static{this.\u0275fac=function(t){return new(t||$s)(c.\u0275\u0275inject(N.HttpClient),c.\u0275\u0275inject(ut),c.\u0275\u0275inject(De),c.\u0275\u0275inject(js))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:$s,factory:$s.\u0275fac,providedIn:"root"})}}let il=class extends G{constructor(){super(...arguments),this.type="crt.ExecuteExpressionRequest"}};il=(0,h.__decorate)([L({type:"crt.ExecuteExpressionRequest"})],il);let oo=class extends E{constructor(e){super(),this._engine=e}handle(e){return this._engine.safeExecute(e.metadata)}};oo=(0,h.__decorate)([Re({type:"crt.ExecuteExpressionHandler",requestType:"crt.ExecuteExpressionRequest"}),(0,h.__metadata)("design:paramtypes",[$s])],oo);let Us=class Bc{static{this.\u0275fac=function(t){return new(t||Bc)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:Bc})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[$s,js],imports:[w.CommonModule,Tt,Tt]})}};Us=(0,h.__decorate)([Uu({converters:[ao],requestHandlers:[oo]})],Us),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Us,{imports:[w.CommonModule,Tt],exports:[Tt]})}();class co{convert(e){const{name:t,path:s,caption:r,dataValueType:n}=e||{};return{name:t,path:s||t,caption:r,dataValueType:n}}}class qs extends co{convert(e){const{aggregationConfig:t}=e||{};return{...super.convert(e),type:"aggregation",aggregationConfig:{filter:t?.filter,aggregationFunction:t?.aggregationFunction,sortByColumn:t?.sortByColumn,sortByDirection:t?.sortByDirection}}}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(qs)))(s||qs)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:qs,factory:qs.\u0275fac,providedIn:"root"})}}class Hs extends co{convert(e){const{functionConfig:t}=e||{};return{...super.convert(e),type:"function",functionConfig:t}}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Hs)))(s||Hs)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Hs,factory:Hs.\u0275fac,providedIn:"root"})}}class Ks extends co{convert(e){return{...super.convert(e),type:"default"}}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Ks)))(s||Ks)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ks,factory:Ks.\u0275fac,providedIn:"root"})}}const fp=O.gX.create({token:Pu,mappings:[{predicate:Z.AggregationAttribute,injectable:qs},{predicate:Z.FunctionAttribute,injectable:Hs}],default:{injectable:Ks}});var dt;(function(i){i[i.None=0]="None",i[i.Count=1]="Count",i[i.Sum=2]="Sum",i[i.Avg=3]="Avg",i[i.Min=4]="Min",i[i.Max=5]="Max",i[i.TopOne=6]="TopOne"})(dt||(dt={}));function al(i){switch(i){case at.Count:return dt.Count;case at.Sum:return dt.Sum;case at.Avg:return dt.Avg;case at.Min:return dt.Min;case at.Max:return dt.Max;case at.TopOne:return dt.TopOne;default:return dt.None}}function Wm(i){switch(i){case AggregationType.Count:return AggregationFunction.Count;case AggregationType.Sum:return AggregationFunction.Sum;case AggregationType.Avg:return AggregationFunction.Avg;case AggregationType.Min:return AggregationFunction.Min;case AggregationType.Max:return AggregationFunction.Max;case AggregationType.TopOne:return AggregationFunction.TopOne;default:return AggregationFunction.None}}function gp(i){switch(i){case"all":return Yt.All;case"distinct":return Yt.Distinct;default:return Yt.None}}function Jm(i){switch(i){case AggregationEvalType.All:return"all";case AggregationEvalType.Distinct:return"distinct";default:return"none"}}class Si{addColumnCaption(e,t){const{name:s,caption:r}=t;if(!r)return;const n=e.findColumn(s);n&&n.withCaption(r)}addColumn(e,t){!e||!t||(this.addColumnInternal(e,t),this.addColumnCaption(e,t))}}class zs extends Si{addColumnInternal(e,t){const{name:s,path:r,aggregationConfig:n}=t;e.addAggregationSubQueryColumn(r,al(n?.aggregationFunction),n,s)}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(zs)))(s||zs)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:zs,factory:zs.\u0275fac,providedIn:"root"})}}class Gs extends Si{addColumnInternal(e,t){const{name:s,path:r}=t||{},n=t?.functionConfig;e.addAggregationFunctionColumn(r,al(n?.aggregation),s,gp(n?.aggregationEval))}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Gs)))(s||Gs)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Gs,factory:Gs.\u0275fac,providedIn:"root"})}}var Ye;(function(i){i[i.None=0]="None",i[i.Day=1]="Day",i[i.Week=2]="Week",i[i.Month=3]="Month",i[i.Year=4]="Year",i[i.WeekDay=5]="WeekDay",i[i.Hour=6]="Hour",i[i.HourMinute=7]="HourMinute"})(Ye||(Ye={}));function _p(i){switch(i){case"minute":return Ye.HourMinute;case"hour":return Ye.Hour;case"day":return Ye.Day;case"weekday":return Ye.WeekDay;case"week":return Ye.Week;case"month":return Ye.Month;case"year":return Ye.Year;default:return Ye.None}}function Zm(i){switch(i){case DatePartType.HourMinute:return"minute";case DatePartType.Hour:return"hour";case DatePartType.Day:return"day";case DatePartType.WeekDay:return"weekday";case DatePartType.Week:return"week";case DatePartType.Month:return"month";case DatePartType.Year:return"year";default:return"none"}}class Ws extends Si{addColumnInternal(e,t){const{name:s,path:r}=t||{},n=t?.functionConfig;e.addDatePartFunctionColumn(r,_p(n?.datePart),s)}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Ws)))(s||Ws)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ws,factory:Ws.\u0275fac,providedIn:"root"})}}class Js extends Si{addColumnInternal(e,t){e.addSchemaColumn(t.path,t.name)}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(Js)))(s||Js)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Js,factory:Js.\u0275fac,providedIn:"root"})}}const yp=O.gX.create({token:wu,mappings:[{predicate:i=>i.type==="aggregation",injectable:zs},{predicate:i=>i.type==="function"&&i.functionConfig?.type==="aggregation",injectable:Gs},{predicate:i=>i.type==="function"&&i.functionConfig?.type==="datePart",injectable:Ws}],default:{injectable:Js}});function ol(i){Object.values(i.controls||{}).forEach(e=>{e instanceof Fe.FormGroup||e instanceof Fe.FormArray?ol(e):e.updateValueAndValidity({onlySelf:!0})})}function uo(i){i?.markAsPristine(),i?.markAsUntouched(),i?.updateValueAndValidity()}function Ym(i){return Object.values(i?.errors||{}).map(e=>e?.message).filter(Boolean)}function cl(i){return i.statusChanges.pipe((0,l.startWith)(i.status),(0,l.first)(()=>i.status.toLowerCase()!=="pending"),(0,l.map)(()=>{}))}let lo=class extends E{constructor(e){super(),this._ngZone=e}_validateRequest(e){const{$context:t,collectionAttributeName:s}=e;if(!t)throw new Error('The "$context" request property is not specified.');if(!s)throw new Error('The "collectionAttributeName" request property is not specified.');const r=t._attributeConfigs[s];if(!(("viewModelConfig"in r||"viewModelName"in r)&&r.isCollection))throw new Error(`There is no view model collection for the specified "${s}" attribute.`)}_canCancelPrimaryDataChanges(e,t){var s=this;return(0,S.A)(function*(){if(!t)return!0;const r=yield s._getPrimaryAttributeValue(e);return t.includes(r)})()}_getPrimaryAttributeValue(e){return(0,S.A)(function*(){const t=yield e.getPrimaryModelName(),s=yield e.getPrimaryDataSchema(),r=e.getViewModelAttributePath(t,s.primaryAttributeName);return e[r]})()}_resetFormApiModel(e){this._ngZone.run((0,S.A)(function*(){const t=yield e.getPrimaryModelName();e.getBoundDataSourceAttributeControls(t)?.forEach(r=>{uo(r)})}))}_cancelPrimaryDataChanges(e){var t=this;return(0,S.A)(function*(){try{const s={type:"crt.CancelPrimaryDataChangesRequest",$context:e};return yield t.handlerChain.process(s)}catch(s){return[{success:!1,errorInfo:s?.message}]}})()}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const{$context:s,collectionAttributeName:r,primaryAttributeValues:n}=e??{},a=yield s.attributes[r],u=a.getChangedItems(),d=[];for(const g of u)(yield t._canCancelPrimaryDataChanges(g,n))&&d.push(t._cancelPrimaryDataChanges(g));for(const g of a)u.includes(g)||t._resetFormApiModel(g);return(yield Promise.all(d)).flat()})()}};lo=(0,h.__decorate)([Re({type:"crt.CancelCollectionPrimaryDataHandler",requestType:"crt.CancelCollectionPrimaryDataChangesRequest"}),(0,h.__metadata)("design:paramtypes",[c.NgZone])],lo);let ho=class extends E{_validateRequest(e){const{$context:t}=e;if(!t)throw new Error('The "$context" request property is not specified.')}_cancelCurrentDataChanges(e){var t=this;return(0,S.A)(function*(){const s=e.getPrimaryModelMode();if(s===D.Create){const r=yield e.getPrimaryModelName();return e.getModelByName(r).getDataSource().scope===Oe.ViewElement&&e.markPrimaryModelFor(D.Delete),Promise.resolve({success:!0})}return s===D.Delete&&e.markPrimaryModelFor(D.Update),(yield e.IsChanged)?t._reloadCurrentDataChanges(e):Promise.resolve({success:!0})})()}_reloadCurrentDataChanges(e){var t=this;return(0,S.A)(function*(){try{return yield t._loadPrimaryData(e),yield t._onSuccessCancelPrimaryData(e),{success:!0}}catch(s){const r=s?.message;return t._onFailCancelPrimaryData(e,r),{success:!1,errorInfo:r}}})()}_loadPrimaryData(e){var t=this;return(0,S.A)(function*(){const s=yield e.getPrimaryModelName(),r=yield e.getPrimaryDataSchema(),n=e.getViewModelAttributePath(s,r.primaryAttributeName);yield t.handlerChain.process({type:"crt.LoadDataRequest",$context:e,dataSourceName:s,parameters:[{type:B.PrimaryColumnValue,value:n}]})})()}_onFailCancelPrimaryData(e,t){e.formApiModel.setErrors({cancel:{message:t}})}_onSuccessCancelPrimaryData(e){return(0,S.A)(function*(){const t=yield e.getPrimaryModelName();e.getBoundDataSourceAttributeControls(t)?.forEach(r=>{uo(r)})})()}_cancelNestedDataChanges(e){var t=this;return(0,S.A)(function*(){const s=[],r=Object.entries(e._attributeConfigs);for(const[a,u]of r)if(!(!("viewModelConfig"in u)&&!("viewModelName"in u)))if(u.isCollection)s.push(t._cancelPrimaryDataSafely(()=>t._cancelCollectionPrimaryDataChanges(e,a)));else{const d=yield e[a];s.push(t._cancelPrimaryDataSafely(()=>t._cancelPrimaryDataChanges(d)))}return(yield Promise.all(s)).flat()})()}_cancelPrimaryDataChanges(e){var t=this;return(0,S.A)(function*(){const s={type:"crt.CancelPrimaryDataChangesRequest",$context:e};return yield t.handlerChain.process(s)})()}_cancelCollectionPrimaryDataChanges(e,t){var s=this;return(0,S.A)(function*(){const r={type:"crt.CancelCollectionPrimaryDataChangesRequest",$context:e,collectionAttributeName:t};return yield s.handlerChain.process(r)})()}_cancelPrimaryDataSafely(e){return e().catch(t=>[{success:!1,errorInfo:t?.message}])}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const s=e.$context,r=yield t._cancelNestedDataChanges(s);return[yield t._cancelCurrentDataChanges(s),...r]})()}};ho=(0,h.__decorate)([Re({type:"crt.CancelPrimaryDataChangesHandler",requestType:"crt.CancelPrimaryDataChangesRequest"})],ho);let ul=class extends G{};ul=(0,h.__decorate)([L({type:"crt.LoadLookupListRequest"})],ul);let po=class extends E{handle(e){const t={control:e.valueAttributeName,items:e.itemsAttributeName},s=e.filterValue??null,r=[{type:B.PrimaryDisplayValueFilter,value:"@requestPayload.lookupFilterValue"},...e.parameters||[]],n={...e.payload,lookupFilterValue:s};return e.$context.loadLookupList(t,r,n),Promise.resolve()}};po=(0,h.__decorate)([Re({type:"crt.LoadLookupListHandler",requestType:"crt.LoadLookupListRequest"})],po);const Xm="crtInput:",Qm="crtOutput:",ef="crtValidationInput:",bp="crtInject:";function mo(i){return function(e,t,s){Reflect.defineMetadata(bp+s,i,e)}}const Sp="DisableShowSuccessMessageAfterLoadDataRequest";class xt extends G{}var fo;(function(i){i.RefreshAll="RefreshAll",i.RefreshSpecific="RefreshSpecific"})(fo||(fo={}));class Cp extends xt{}let go=class extends E{constructor(e,t){super(),this._translateService=e,this._featureValues=t}_isDynamicDS(e){const t=e.config||{};return!!(t.dataSourceConfig&&t.attributeName)}_loadDynamicDS(e){const t=e.$context,s=e.config;return(0,o.lastValueFrom)(t.load(s),{defaultValue:null})}_load(e){if(!e.dataSourceName)return;const t=e.$context;let s=e.parameters;s=this._addPrimaryDisplayValueFilterIfNeed(e,s);const r=e.config;return this._trySubscribeToLoadedData(e),(0,o.lastValueFrom)(t.load(e.dataSourceName,s,r),{defaultValue:null})}_trySubscribeToLoadedData(e){e?.showSuccessMessage&&this._subscribeToLoadedData(e,[e.dataSourceName])}_subscribeToLoadedData(e,t){if(this._featureValues[Sp]||t.length===0)return;const s=e.$context,r=t.map(d=>s._modelsMap.get(d)),n=new Set(t);r.forEach(d=>{const p=d.affectedAttributes.map(C=>C.path);s._getDependentModelsForLoad(d,p).forEach(C=>{n.add(C)})});const a=new Set,u=s._modelLoaded$.subscribe(d=>{if(n.has(d)&&a.add(d),a.size===n.size){u.unsubscribe();const p={$context:e.$context,type:"crt.NotificationRequest",message:this._translateService.instant("LoadDataRequest.SuccessMessage")};this.handlerChain.process(p)}})}_addPrimaryDisplayValueFilterIfNeed(e,t){return e.primaryDisplayFilterValue?(t=t||[],[...t,{type:B.PrimaryDisplayValueFilter,value:e.primaryDisplayFilterValue}]):t}_isDynamicModel(e,t){return e._dynamicModelNames.has(t)}_refreshData(e){const t=e.refreshDataConfig,s=e.$context;let r;if(t.mode===fo.RefreshAll){const a=t.excludedDataSourceNames||[];r=[...s._modelsMap.values()].map(u=>u.name).filter(u=>!a.includes(u)).filter(u=>!this._isDynamicModel(s,u)).filter(u=>s._getDependOnModelsNames(u).length===0)}else if(r=t.targetDataSourceNames||[],r.length===0)throw new Error("'RefreshSpecific' option requires at least one target data source name");r=r.filter(a=>{const u=s._getDependOnModelsNames(a);return!r.some(d=>u.includes(d))}),r=[...new Set(r)];const n=r.map(a=>({$context:e.$context,type:e.type,showSuccessMessage:!1,dataSourceName:a,config:{loadType:he.Reload,useLastLoadParameters:!0}}));return e.showSuccessMessage===!0&&this._subscribeToLoadedData(e,r),Promise.all(n.map(a=>this.handlerChain.process(a)))}handle(e){if(!e.$context)throw new Error("Property '$context' should be specified");return e.refreshDataConfig?this._refreshData(e):this._isDynamicDS(e)?this._loadDynamicDS(e):this._load(e)}};go=(0,h.__decorate)([Re({type:"crt.LoadDataSourceHandler",requestType:"crt.LoadDataRequest"}),(0,h.__param)(1,(0,c.Inject)(F)),(0,h.__param)(1,mo(F)),(0,h.__metadata)("design:paramtypes",[T.TranslateService,ua])],go);let ll=class extends xt{};ll=(0,h.__decorate)([L({type:"crt.LoadDefaultValuesRequest"})],ll);let _o=class extends E{handle(e){const t=e.$context;return(0,o.lastValueFrom)(t.loadDefaultValues(e.dataSourceName),{defaultValue:null})}};_o=(0,h.__decorate)([Re({type:"crt.LoadDefaultValuesHandler",requestType:"crt.LoadDefaultValuesRequest"})],_o);let dl=class extends xt{};dl=(0,h.__decorate)([L({type:"crt.SaveDataRequest"})],dl);let yo=class extends E{handle(e){const t=e.$context,{dataSourceName:s,options:r,parameters:n,transactionOperation:a}=e,u=a?t.commitTransaction(s,n,r,a):t.save(s,n,r);return(0,o.lastValueFrom)(u,{defaultValue:null})}};yo=(0,h.__decorate)([Re({type:"crt.SaveDataHandler",requestType:"crt.SaveDataRequest"})],yo);let hl=class extends xt{};hl=(0,h.__decorate)([L({type:"crt.SaveInTransactionDataRequest"})],hl);let bo=class extends E{handle(e){const t=e.$context,{dataSourceName:s,options:r,parameters:n,transaction:a}=e,u=t.saveInTransaction(s,n,r,a);return(0,o.lastValueFrom)(u,{defaultValue:null})}};bo=(0,h.__decorate)([Re({type:"crt.SaveInTransactionDataHandler",requestType:"crt.SaveInTransactionDataRequest"})],bo);let So=class extends E{_validateRequest(e){const{$context:t,collectionAttributeName:s}=e;if(!t)throw new Error('The "$context" request property is not specified.');if(!s)throw new Error('The "collectionAttributeName" request property is not specified.');const r=t._attributeConfigs[s];if(!(("viewModelConfig"in r||"viewModelName"in r)&&r.isCollection))throw new Error(`There is no view model collection for the specified "${s}" attribute.`)}_canSavePrimaryData(e,t){var s=this;return(0,S.A)(function*(){if(!t)return!0;const r=yield s._getPrimaryAttributeValue(e);return t.includes(r)})()}_getPrimaryAttributeValue(e){return(0,S.A)(function*(){const t=yield e.getPrimaryModelName(),s=yield e.getPrimaryDataSchema(),r=e.getViewModelAttributePath(t,s.primaryAttributeName);return e[r]})()}_savePrimaryData(e){var t=this;return(0,S.A)(function*(){try{const s={type:"crt.SavePrimaryDataRequest",$context:e};return yield t.handlerChain.process(s)}catch(s){return[{success:!1,rowsAffected:0,errorInfo:s?.message}]}})()}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const{$context:s,collectionAttributeName:r,primaryAttributeValues:n}=e??{},u=s.attributes[r].getChangedItems(),d=[];for(const p of u)(yield t._canSavePrimaryData(p,n))&&d.push(yield t._savePrimaryData(p));return d.flat()})()}};So=(0,h.__decorate)([Re({type:"crt.SaveCollectionPrimaryDataHandler",requestType:"crt.SaveCollectionPrimaryDataRequest"})],So);function pl(i,e){const t=e.map(s=>{const r=i._attributeConfigs[s];return r&&r.caption?Promise.resolve(r.caption):i[on][Bs.string][s].then(n=>n||s)});return Promise.all(t)}class Zs{constructor(e){this._translateService=e}_getFirstValidationError(e){const t=Object.entries(e??{});if(t.length===0)return null;const s=t[0][1];return Object.entries(s)[0]}getValidationErrorMessage(e,t){var s=this;return(0,S.A)(function*(){const r=s._getFirstValidationError(t);if(!r)return"";const n=r[0],a=r[1].message,d=Object.entries(t).filter(([C,I])=>Object.keys(I).includes(n)).map(([C,I])=>C),p=(yield pl(e,d)).map(C=>`"${C}"`),g=d.length===1?s._translateService.instant("BaseViewModel.ValidationErrorMessageSingleErrorField"):s._translateService.instant("BaseViewModel.ValidationErrorMessageSeveralErrorFields");return Ct.String.format(g,p.join(", "),a)})()}static{this.\u0275fac=function(t){return new(t||Zs)(c.\u0275\u0275inject(T.TranslateService))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Zs,factory:Zs.\u0275fac})}}var Y;(function(i){i.None="None",i.OneToMany="OneToMany",i.ManyToOne="ManyToOne",i.ManyToMany="ManyToMany",i.CircularDependency="CircularDependency"})(Y||(Y={}));function ml(i,e){return!!i?.some(t=>t.relationPath.split(".").shift()===e)}function fl(i){return i.dataValueType===A.r.Guid}function gl(i,e){return fl(e)&&i.primaryAttributeName===e.name}function Co(i,e,t,s){const r=t.findAttributeByName(s),n=i.findAttributeByName(e);return(n.isLookup||fl(n))&&gl(t,r)?Y.OneToMany:gl(i,n)&&r.isLookup?Y.ManyToOne:Y.ManyToMany}function Ao(i){const e=i.split("."),t=e.shift(),s=e.shift();return{dependOnModelName:t,dependOnAttributeName:s}}class Ys{constructor(){}_getDataSchema(e,t){return e.dataSchemas[t]}_getRelationData(e,t){const s=t.attributePath;if(s.split(".").length!==1)throw new Error(["Transition relation is not allowed.",`Model name: '${e}', attribute path: '${s}'`].join(" "));const r=t.relationPath.split(".");if(r.length!==2)throw new Error(["Transition relation is not allowed.",`Model name: '${e}', relation path: '${t.relationPath}'`].join(" "));const[n,a]=r;return{modelAttributeName:s,dependOnModelName:n,dependOnModelAttributeName:a}}_mergeRelationTypes(e,t){if(e===Y.None)return t;if(t===Y.None)return e;if(e===Y.CircularDependency||t===Y.CircularDependency)return Y.CircularDependency;if(e===t)return e;if(e===Y.OneToMany&&t===Y.ManyToOne||e===Y.ManyToOne&&t===Y.OneToMany)return Y.CircularDependency;if(e===Y.ManyToMany||t===Y.ManyToMany)return Y.ManyToMany}_saveBefore(e,t,s){const r=s.find(n=>n.name===t);r.dependsOn.includes(e)||r.dependsOn.push(e)}_saveAfter(e,t,s){const r=s.find(n=>n.name===e);r.dependsOn.includes(t)||r.dependsOn.push(t)}_sort(e,t){const s=t.map(r=>({name:r,dependsOn:[]}));return t.forEach(r=>{const n=e._getModelDependencies(r);if(!n||n.length===0)return;const a=new Map;for(const u of n){const{modelAttributeName:d,dependOnModelName:p,dependOnModelAttributeName:g}=this._getRelationData(r,u),C=Co(this._getDataSchema(e,r),d,this._getDataSchema(e,p),g);let I=a.get(p)??Y.None;I=this._mergeRelationTypes(I,C),a.set(p,I)}a.forEach((u,d)=>{switch(u){case Y.ManyToOne:this._saveBefore(r,d,s);break;case Y.OneToMany:this._saveAfter(r,d,s);break;case Y.ManyToMany:throw new Error("Many-to-many relation is not supported");case Y.CircularDependency:throw new Error("Circular dependency detected")}})}),(0,O.Bo)(s)}sort(e,t){return t.every(r=>e.getModelMode(r)===D.Update)?t:this._sort(e,t).flat()}static{this.\u0275fac=function(t){return new(t||Ys)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Ys,factory:Ys.\u0275fac})}}function _l(i,e){const{dots:t}=e??{};return i?.replace(/\.+/g,t??"").replace(/\[+/g,"").replace(/\]+/g,"").replace(/:+/g,"")??""}const Ap="DS",vp="DYN";function Ci(i){for(;i?.parent;)i=i.parent;return i}function es(i){return i?.getDataSource()?.scope===Oe.Page}function Ep(i){const e=[];return i?._modelsMap.forEach((t,s)=>{es(t)&&e.push(s)}),e}class Xs{static{this._dataCache=new WeakMap}static _getDataSourceColumns(e){const t={};let s=!1;for(const[r,n]of Object.entries(e.dataSourceConfig.config.attributes)){const a=n.path;t[_l(r)]=a,a==="Id"&&(s=!0)}return!s&&e.includePrimaryAttributes!==!1&&(t.Id="Id"),t}static _createAttributesConfigMap(e,t,s,r,n){const a={},u=this.getAttributeDataSourceOldName(e,r);for(const[d]of Object.entries(t)){const p=n.config?.useOriginalAttributesName?`${d}`:`${u}_${d}`,g=n.config.attributes[d],C={path:`${s}.${d}`,type:g?.type,functionConfig:g?.functionConfig,aggregationConfig:g?.aggregationConfig};a[p]={modelConfig:C}}return a}static _createAttributePagingConfig(e){return e.pagingConfig||{rowCount:30}}static _createAttributeSortingConfig(e){return e.sortingConfig||{attributeName:e.attributeName+"Sorting"}}static _createAttributeFiltersConfig(e){return e.filtersConfig?.map(t=>{const s={...t};return delete s.value,s})||[]}static _getDataSourceNameForDynamicModel(e,t){return e.getBoundDataSourceNameByAttributePath(t)||this._getAttributeDataSourceDefaultName(t)}static _getDynamicDataSourceNamePrefix(){return`${vp}_`}static _isDynamicDataSourceName(e){return e.startsWith(this._getDynamicDataSourceNamePrefix())}static _getAttributeDataSourceDefaultName(e){return`${e}${Ap}`}static _getLoadData(e,t,s,r){let n;return this._dataCache.has(e)?n=this._dataCache.get(e):(n=t.load(s,[]).pipe((0,l.share)(),(0,l.tap)(()=>this._dataCache.delete(e))),this._dataCache.set(e,n)),(0,o.lastValueFrom)(n.pipe((0,o.map)(()=>r())),{defaultValue:null})}static createAttributeConfig(e,t,s){const r=s.attributeName,n=s.dataSourceConfig,a=this._getDataSourceColumns(s),u=this._createAttributesConfigMap(e,a,t,r,n),d=this._createAttributePagingConfig(s),p=this._createAttributeSortingConfig(s),g=this._createAttributeFiltersConfig(s);return{isCollection:!0,modelConfig:{path:t,pagingConfig:d,sortingConfig:p,filterAttributes:g,hierarchyConfig:s.hierarchyConfig},viewModelConfig:{attributes:u}}}static getAttributeDataSourceOldName(e,t){let s=this._getDataSourceNameForDynamicModel(e,t);return(!s||this._isDynamicDataSourceName(s))&&(s=this._getAttributeDataSourceDefaultName(t)),s}static createDynamicDataSourceNameFromAttributeName(e,t){const s=this._getDynamicDataSourceNamePrefix(),r=this._getDataSourceNameForDynamicModel(e,t);return this._isDynamicDataSourceName(r)?r:`${s}${r}`}static defineAsyncAttribute(e,t,s,r,n){const a=s.modelConfig?.path?.split(".")[0],u=e.getModelByName(a),d="isLookup"in s&&s.isLookup,p="isCollection"in s&&s.isCollection;Object.defineProperty(e,t,{get:()=>u&&p&&!d&&!u?.isLoaded?this._getLoadData(u,e,a,r):Promise.resolve(r()),set:n,configurable:!0})}static deferUpdatingValueAndValidity(e,t,s){if(s?.["ViewModel.DontDeferUpdatingValueAndValidity"])return t();const r=e.formApiModel.updateValueAndValidity;if(r.callbackCount)r.callbackCount++;else{const u=(0,O.S)();u.callbackCount=1,u.originalFn=r.bind(e.formApiModel),e.formApiModel.updateValueAndValidity=u}const n=t(),a=()=>{const u=e.formApiModel.updateValueAndValidity;u.callbackCount===1?(e.formApiModel.updateValueAndValidity=u.originalFn,e.formApiModel.updateValueAndValidity()):u.callbackCount--};return n instanceof Promise?n.finally(a):n.pipe((0,l.finalize)(a))}}let vo=class extends E{constructor(e,t,s,r,n){super(),this._baseViewModelProcessValidationResultService=e,this.modelSaveOrderSorterService=t,this._featureValues=s,this._transactionFactory=r,this._translateService=n}_validateRequest(e){const{$context:t}=e;if(!t)throw new Error('The "$context" request property is not specified.')}_saveModel(e,t,s){var r=this;return(0,S.A)(function*(){const n=e.dataSchemas[t],a=e.getViewModelAttributePath(t,n.primaryAttributeName);try{const u=yield r._saveData(e,t,a,s);return u?.success&&r._onSuccessSaveRootData(e,t,u),u}catch(u){const d=u?.message;return r._createFailedSaveResult(d)}})()}_queueSaveDataInTransaction(e,t,s,r){var n=this;return(0,S.A)(function*(){const a={type:"crt.SaveInTransactionDataRequest",$context:e,parameters:[{type:B.PrimaryColumnValue,value:s}],transaction:r,dataSourceName:t};return yield n.handlerChain.process(a)})()}_queueSaveModelInTransaction(e,t,s){const r=e.dataSchemas[t],a=e.getViewModelAttributePaths(t,r.primaryAttributeName)[0];return this._queueSaveDataInTransaction(e,t,a,s)}_validateModel(e,t){var s=this;return(0,S.A)(function*(){if(!(yield e.isValid(t))){const n=yield e.validate(t),a=yield s._baseViewModelProcessValidationResultService.getValidationErrorMessage(e,n);return s._createFailedSaveResult(a)}return null})()}_getModels(e){var t=this;return(0,S.A)(function*(){const s=yield e.getPrimaryModelName();let r=Ep(e);return r=r.filter(n=>e.getModelMode(n)!==D.Init),s&&!r.includes(s)&&r.unshift(s),t._featureValues.DisableMultipleDataSources?r:t.modelSaveOrderSorterService.sort(e,r)})()}_canSaveDataResult(e,t){var s=this;return(0,S.A)(function*(){const r=e.dataSchemas[t],n=e.getViewModelAttributePath(t,r.primaryAttributeName),a=yield s._canSaveData(e,t,n);if(a&&!a?.result)return s._createFailedSaveResult(a.message)})()}_checkPdsGroupValidationResults(e,t){var s=this;return(0,S.A)(function*(){const r=yield Promise.all(t.map(a=>s._validateModel(e,a)));if(r.some(a=>a&&!a.success))return r;const n=yield Promise.all(t.map(a=>s._canSaveDataResult(e,a)));return n.some(a=>a&&!a.success)?n:[]})()}_saveModelChanges(e,t,s){var r=this;return(0,S.A)(function*(){let n;return(yield r._shouldSkipSavingUnchangedPageModel(e,t))||(n=yield r._saveModel(e,t,s)),n})()}_queueModelChangesInTransaction(e,t,s){var r=this;return(0,S.A)(function*(){let n;return(yield r._shouldSkipSavingUnchangedPageModel(e,t))||(n=yield r._queueSaveModelInTransaction(e,t,s)),n})()}_saveInChain(e,t){var s=this;return(0,S.A)(function*(){const r=[];for(const n of t)r.push(yield s._saveModelChanges(e,n));return r})()}_saveInTransaction(e,t){var s=this;return(0,S.A)(function*(){const r=[],n=[],a=yield s._transactionFactory.create();for(const d of t){const p=yield s._queueModelChangesInTransaction(e,d,a),g=s._saveModelChanges(e,d,p);n.push(g)}try{yield a.commit()}catch(d){return[s._createFailedSaveResult(d?.message)]}const u=yield Promise.all(n);return r.push(...u),r})()}_saveRootData(e){var t=this;return(0,S.A)(function*(){const s=yield t._getModels(e),r=yield e.getPrimaryModelName();let n=[...r?[r]:[],...s.filter(g=>ml(e._getModelDependencies(g),r))];t._featureValues.DisableMultipleDataSources&&(n=[]);const a=(yield Promise.all(n.map(function(){var g=(0,S.A)(function*(C){return(yield t._shouldSkipValidationAndSavingPageModel(e,C))?null:C});return function(C){return g.apply(this,arguments)}}()))).filter(Boolean);let u=yield t._checkPdsGroupValidationResults(e,a);if(!u.length){const g=!t._featureValues["DataSource-DisableTransactions"],C=a.map(I=>e.getModelByName(I)).every(I=>I.supportsTransactions);g&&C&&a.length>1?u=yield t._saveInTransaction(e,a):u=yield t._saveInChain(e,a)}const d=s.filter(g=>!n.includes(g));for(const g of d){const C=yield t._validateModel(e,g),I=yield t._canSaveDataResult(e,g);!C&&!I?u.push(yield t._saveModelChanges(e,g)):u.push(C||I)}u=u.filter(Boolean);const p=u.filter(g=>!g.success).map(g=>g.errorInfo);return p.length&&t._onFailSaveRootData(e,p.join(", ")),u})()}_shouldSkipSavingUnchangedPageModel(e,t){var s=this;return(0,S.A)(function*(){if(s._featureValues.DisableMultipleDataSources)return!1;const r=e.getModelByName(t),n=e._getModelDependencies(t),a=!n?.length,u=r?._isChanged,d=yield e.getPrimaryModelName();return a?t!==d&&!u:r?.getDataSource()?.isForceUpdateUnchangedData?!1:ml(n,d)&&!u})()}_canSaveData(e,t,s){return(0,S.A)(function*(){const n={primaryColumnValue:yield e[s]};return e.canSave(t,n)})()}_saveData(e,t,s,r){var n=this;return(0,S.A)(function*(){const a={type:"crt.SaveDataRequest",$context:e,parameters:[{type:B.PrimaryColumnValue,value:s}],transactionOperation:r,dataSourceName:t};return yield n.handlerChain.process(a)})()}_onFailSaveRootData(e,t){e.formApiModel.setErrors({save:{message:t}})}_updateAttributesOnSaveResult(e,t,s){if(s?.primaryAttributes?.length)for(const r of s.primaryAttributes)for(const[n,a]of Object.entries(r)){const u=e.getViewModelAttributePath(t,n);e[u]=a}}_onSuccessSaveRootData(e,t,s){this._updateAttributesOnSaveResult(e,t,s),e.getBoundDataSourceAttributeControls(t)?.forEach(n=>{uo(n)})}_saveNestedData(e,t){var s=this;return(0,S.A)(function*(){const r=[],n=Object.entries(e._attributeConfigs);for(const[u,d]of n)if(!(!("viewModelConfig"in d)&&!("viewModelName"in d)))if(d.isCollection)r.push(s._saveDataSafely(()=>s._saveInnerViewModelCollection(e,u,t)));else{const p=yield e[u];r.push(s._saveDataSafely(()=>s._saveInnerViewModel(p)))}return(yield Promise.all(r)).flat()})()}_saveInnerViewModel(e){var t=this;return(0,S.A)(function*(){const s={type:"crt.SavePrimaryDataRequest",$context:e};return yield t.handlerChain.process(s)})()}_saveInnerViewModelCollection(e,t,s){var r=this;return(0,S.A)(function*(){const n={type:"crt.SaveCollectionPrimaryDataRequest",$context:e,collectionAttributeName:t,scopes:s};return yield r.handlerChain.process(n)})()}_saveDataSafely(e){return e().catch(t=>[this._createFailedSaveResult(t?.message)])}_createFailedSaveResult(e){return{success:!1,rowsAffected:0,errorInfo:e}}_shouldSkipValidationAndSavingPageModel(e,t){var s=this;return(0,S.A)(function*(){const r=yield e.getPrimaryModelName();if(t===r)return!1;const n=e._getModelDependencies(t);if(!n?.length)return!1;const[{relationPath:a,attributePath:u}]=n,[,d]=a.split("."),p=Co(e.dataSchemas[t],u,e.dataSchemas[r],d);if(p===Y.OneToMany)return!1;if(p===Y.ManyToOne){const g=e.getViewModelAttributePaths(r,d);if(!g.length)return!0;if(!(yield e[g[0]])){if(!e.getBoundDataSourceAttributeControls(t).every(X=>X.value===null)){const X=yield pl(e,[g[0]]),U={type:"crt.NotificationRequest",$context:e,message:s._translateService.instant("BaseViewModel.ErrorMessageOnEmptyRelationColumn",{caption:X})};yield s.handlerChain.process(U)}return!0}}return!1})()}handle(e){var t=this;return(0,S.A)(function*(){t._validateRequest(e);const s=e.$context,r=yield t._saveRootData(s);if(r.some(a=>!a.success))return r;const n=yield t._saveNestedData(s,e.scopes);return[...r,...n]})()}};vo=(0,h.__decorate)([Re({type:"crt.SavePrimaryDataHandler",requestType:"crt.SavePrimaryDataRequest"}),(0,h.__param)(2,(0,c.Inject)(F)),(0,h.__param)(2,mo(F)),(0,h.__param)(3,(0,c.Inject)(Qn)),(0,h.__param)(3,mo(Qn)),(0,h.__metadata)("design:paramtypes",[Zs,Ys,ua,Object,T.TranslateService])],vo);let yl=class extends xt{};yl=(0,h.__decorate)([L({type:"crt.DeleteDataRequest"})],yl);let Eo=class extends E{handle(e){const t=e.$context;return(0,o.lastValueFrom)(t.delete(e.dataSourceName,e.parameters,e.config),{defaultValue:null})}};Eo=(0,h.__decorate)([Re({type:"crt.DeleteDataHandler",requestType:"crt.DeleteDataRequest"})],Eo);let bl=class extends xt{};bl=(0,h.__decorate)([L({type:"crt.CopyDataRequest"})],bl);let Mo=class extends E{handle(e){const t=e.$context,{dataSourceName:s,recordId:r,copiedValues:n}=e;return(0,o.lastValueFrom)(t.copy(s,r,n),{defaultValue:null})}};Mo=(0,h.__decorate)([Re({type:"crt.CopyDataHandler",requestType:"crt.CopyDataRequest"})],Mo);let Sl=class extends xt{};Sl=(0,h.__decorate)([L({type:"crt.SortDataRequest"})],Sl);let Ro=class extends E{handle(e){const t=e.$context;return(0,o.lastValueFrom)(t.setSorting(e.dataSourceName,e.config),{defaultValue:null})}};Ro=(0,h.__decorate)([Re({type:"crt.SortDataHandler",requestType:"crt.SortDataRequest"})],Ro);let Cl=class extends xt{};Cl=(0,h.__decorate)([L({type:"crt.GetDataSourceLoadFiltersRequest"})],Cl);let Io=class extends E{constructor(e){super(),this._entitySchemaQueryBuilder=e}handle(e){var t=this;return(0,S.A)(function*(){const s=e.$context;if(!s)throw new Error("Property '$context' should be specified");const r=e.dataSourceName;if(!r)throw new Error("Property 'dataSourceName' should be specified");const n=s.dataSchemas[r];if(!n)throw new Error(`Schema for data source with name ${r} not found`);const a=yield s.getDataSourceLoadParameters(r);return a.parameters.some(u=>u.type===B.Never)?null:(0,o.lastValueFrom)(t._entitySchemaQueryBuilder.build(n,[],a.parameters).pipe((0,o.map)(u=>u.getMetadata().filters)))})()}};Io=(0,h.__decorate)([Re({type:"crt.GetDataSourceLoadFiltersHandler",requestType:"crt.GetDataSourceLoadFiltersRequest"}),(0,h.__metadata)("design:paramtypes",[vs])],Io);const Ai=new c.InjectionToken("SCOPE_NAME"),Al=new c.InjectionToken("VIEW_EVENT_ZONE_NAME"),Mp=new c.InjectionToken("INJECTION_CONTEXT");class Qs{selectData(){return null}static{this.\u0275fac=function(t){return new(t||Qs)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Qs,factory:Qs.\u0275fac,providedIn:"root"})}}class er extends Qs{constructor(){super(...arguments),this._elon={FirstName:"Elon",Account:{Name:"SpaceX",Ships:[{Id:"Falcon 9"},{Id:"Falcon Heavy"}],Employee:{Name:"Mask",Age:49}},Employees:["Elon"]}}selectData(){return(0,o.of)(this._elon).pipe((0,l.delay)(50))}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(er)))(s||er)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:er,factory:er.\u0275fac,providedIn:"root"})}}class vi{constructor(e){this.injector=e}}function Ve(i){return i?function(e){Pe(i.type,"ValidatorTypeName");const t={...i,typeRef:e};Uc(t,e)}:e=>{}}class wo{static{this._instanceOfKey="devkit_BaseValidator"}get isAsync(){return this.async}get validateFn(){return this.validate.bind(this)}static[Symbol.hasInstance](e){return e?.constructor?._instanceOfKey===wo._instanceOfKey}}let Te=class extends wo{constructor(e){super(),this.injector=e}defaultValidationError(e){const t=this.injector?.get(T.TranslateService),s=e??{},r=t?.instant(this.i18nMessageKey,s);return{message:e?.message||r||""}}};Te=(0,h.__decorate)([Ve(),(0,h.__metadata)("design:paramtypes",[c.Injector])],Te);let Po=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.Required.Message",this.async=!1}validateLczValue(e){return e?!!e.find(t=>t.value&&t.value.trim()):!1}validate(e,t){const s=e.value;return(typeof s=="string"?!!(e&&e.value?.trim()):this.validateLczValue(s))?null:{required:this.defaultValidationError(t)}}};Po=(0,h.__decorate)([Ve({type:"crt.EmptyOrWhiteSpace"})],Po);let Do=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.Max.Message",this.async=!1}validate(e,t){const r=Fe.Validators.max(t.max)(e);return r?{max:this.defaultValidationError({...t,...r.max})}:null}};Do=(0,h.__decorate)([Ve({type:"crt.Max"})],Do);function vl(i){return typeof i=="string"}function Rp(i){const e=i.substring(1,i.length-1);return parseInt(e,10)}function tf(i,e){return i.replace(/{[0-9]}/g,t=>{const s=Rp(t);return e[s]?e[s].toString():""})}function sf(i){return i.charAt(0).toUpperCase()+i.slice(1)}function rf(i){return i.charAt(0).toLowerCase()+i.slice(1)}function Ip(i){let e=0;if(!vl(i)||i.length===0)return e;for(let t=0;t<i.length;t++)e=i.charCodeAt(t)+(e<<5)-e,e|=0;return e}function wp(i){return Ip(JSON.stringify(i))}function nf(i){return wp(i).toString(16)}function af(i,e=null){try{return JSON.parse(i)}catch{return e}}class $e{static _trimValueIfNeeded(e,t){return t?.trimValue&&!$e.isEmptyInputValue(e)&&vl(e)?e.trim():e}static isEmptyInputValue(e){return e==null||(typeof e=="string"||Array.isArray(e))&&e.length===0}static hasValidLength(e){return e!=null&&typeof e.length=="number"}static getControlValueAndTrimIfNeeded(e,t){return $e._trimValueIfNeeded(e.value,t)}}let To=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.MaxLength.Message",this.async=!1}_maxLengthValidator(e,t){return $e.hasValidLength(e)&&e.length>t.maxLength?{maxlength:this.defaultValidationError({...t,requiredLength:t.maxLength,actualLength:e.length})}:null}validate(e,t){const s=$e.getControlValueAndTrimIfNeeded(e,t);return this._maxLengthValidator(s,t)}};To=(0,h.__decorate)([Ve({type:"crt.MaxLength"})],To);let No=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.Min.Message",this.async=!1}validate(e,t){const r=Fe.Validators.min(t.min)(e);return r?{min:this.defaultValidationError({...t,...r.min})}:null}};No=(0,h.__decorate)([Ve({type:"crt.Min"})],No);let xo=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.MinLength.Message",this.async=!1}_minLengthValidator(e,t){return $e.isEmptyInputValue(e)||!$e.hasValidLength(e)?null:e.length<t.minLength?{minlength:this.defaultValidationError({...t,requiredLength:t.minLength,actualLength:e.length})}:null}validate(e,t){const s=$e.getControlValueAndTrimIfNeeded(e,t);return this._minLengthValidator(s,t)}};xo=(0,h.__decorate)([Ve({type:"crt.MinLength"})],xo);let Ei=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.RegExp.Message",this.async=!1}validate(e,t){typeof t.regex=="string"&&(t.regex=new RegExp(t.regex));const s=t.regex.test(e.value);return this.i18nMessageKey=t.message||this.i18nMessageKey,s?null:{[t.errorCode]:this.defaultValidationError({...t})}}};Ei=(0,h.__decorate)([Ve({type:"crt.RegExp"})],Ei);let Vo=class extends Te{constructor(e){super(e),this.injector=e,this.async=!1,this.i18nMessageKey="Validators.PhoneNumber.Message",this._phoneValidationService=e.get(Et)}validate(e,t){return!e.value||this._phoneValidationService.isValidPhoneNumber(e.value)?null:{invalidPhoneNumber:this.defaultValidationError(t)}}};Vo=(0,h.__decorate)([Ve({type:"crt.PhoneNumber"}),(0,h.__metadata)("design:paramtypes",[c.Injector])],Vo);let Oo=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.Required.Message",this.async=!1}_requiredValidator(e,t){return $e.isEmptyInputValue(e)?{required:this.defaultValidationError(t)}:null}validate(e,t){const s=$e.getControlValueAndTrimIfNeeded(e,t);return this._requiredValidator(s,t)}};Oo=(0,h.__decorate)([Ve({type:"crt.Required"})],Oo);let ko=class extends Te{constructor(e){super(e),this.injector=e,this._messageKey="Validators.SchemaNamePrefix.",this.async=!0,this._sysSettingsService=e.get(De)}_getSchemaNamePrefix(){var e=this;return(0,S.A)(function*(){return(yield e._sysSettingsService.getByCode("SchemaNamePrefix")).value})()}validate(e,t){var s=this;return(0,S.A)(function*(){if((0,P.isObject)(e.value))return null;const r=$e.getControlValueAndTrimIfNeeded(e,{trimValue:!0}),n=yield s._getSchemaNamePrefix();if(n){const a=!r?.startsWith(n);if(a||r===n)return s.i18nMessageKey=a?s._messageKey+"NoSchemaNamePrefixMessage":s._messageKey+"OnlySchemaNamePrefixMessage",{namePrefixError:s.defaultValidationError({...t,schemaNamePrefix:n})}}return null})()}};ko=(0,h.__decorate)([Ve({type:"crt.SchemaNamePrefix"}),(0,h.__metadata)("design:paramtypes",[c.Injector])],ko);let Lo=class extends Ei{constructor(){super(...arguments),this._params={regex:/^[a-zA-Z]+[a-zA-Z0-9-_]*$/,errorCode:"allowedSymbolsErrorCode"},this.i18nMessageKey="Validators.SchemaNameAllowedSymbols.Message",this.async=!1}validate(e){return super.validate(e,this._params)}};Lo=(0,h.__decorate)([Ve({type:"crt.SchemaNameAllowedSymbols"})],Lo);let Bo=class extends Te{constructor(){super(...arguments),this.i18nMessageKey="Validators.UniqueCodeColumnValue.Message",this.async=!1,this._windowCodeList="_copilotCodeList"}validate(e,t){const s=e.value;if(!s)return null;const r=window[this._windowCodeList];return r&&r.filter(a=>a===s).length>1?{uniqueColumnValue:this.defaultValidationError({...t,controlValue:s})}:null}};Bo=(0,h.__decorate)([Ve({type:"crt.UniqueCodeColumnValue"})],Bo);const El="calculated";function Pp(i){let e=[];return typeof i=="string"&&(e=[i]),Array.isArray(i)&&(e=i),e.map(t=>typeof t=="string"&&t?.trim()).filter(Boolean)}function Dp(i){return(i??[]).filter(e=>Rl(e)||Ml(e))}function Tp(i,e){const t=i.map(n=>e.has(n)),s=t.includes(!0),r=t.includes(!1);return s&&r}function Ml(i){return!!i&&"attribute"in i&&!!i.attribute}function Rl(i){return!!i&&"request"in i&&!!i.request}function Np(i,e){const t=Pp(i.from),s=Dp(i.triggers),{from:r,filter:n,converter:a,change:u,triggersOptions:d}=i;return t.length===0&&s.length===0&&!a?(console.error("At least one of the properties 'converter', 'from', or 'triggers' must be specified: "+JSON.stringify(i)+"."),null):t.length===0&&!a?(console.error(`Converter is required in a calculated attribute if there are 'triggers' and no 'from': ${JSON.stringify(i)}.`),null):Tp(t,e)?(console.error(`Simultaneous specification of attributes and request in the "from" property of calculated attribute is not supported: ${JSON.stringify(i)}.`),null):(t.length===0&&n&&console.warn(`Filter is skipped in a calculated attribute if there are 'triggers' and no 'from': ${JSON.stringify(i)}.`),{from:t,originalFrom:r,filter:t.length?n:void 0,converter:a,triggers:s,triggersOptions:{debounce:d?.debounce??0},change:u})}const Il=new c.InjectionToken("Represents a factory of calculated attribute source changes providers"),wl=new c.InjectionToken("Represents a factory of calculated attribute trigger providers"),ht=Symbol("InternalViewModelInjector"),xp=new c.InjectionToken("A factory of expression interpreter");class pt{constructor(e){this._expressionInterpreterFactory=e}_getInterpreter(e){return this._expressionInterpreterFactory?.create("converter",e)}_getConverterFn(e,t,s){const r=this._getInterpreter(t?.[ht]);if(!e||!r)return(0,o.of)(s);const n={viewModel$:(0,o.of)(t),parent:null};return r.evaluate(e,n)}evaluate(e){const{args:t,expression:s,context:r,defaultEvaluationFn:n}=e;return this._getConverterFn(s,r,n).pipe((0,l.switchMap)(a=>{const u=a(t);return u instanceof Promise?u:Promise.resolve(u)}))}static{this.\u0275fac=function(t){return new(t||pt)(c.\u0275\u0275inject(xp,8))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:pt,factory:pt.\u0275fac})}}class Fo{}const Vp=i=>!0,Op=i=>i;class tr{constructor(e,t,s,r,n){this._converterEvaluator=e,this._attributeSourcesChangesProviderFactory=t,this._attributeTriggerProviderFactory=s,this._measurePerformanceService=r,this._requestsResolver=n}_createCalculateAttributeValueFn(e,t){const{viewModel:s,attribute:r,generateOptions:n}=e,{originalFrom:a,filter:u,converter:d}=t,p=Array.isArray(a);return g=>g.pipe((0,l.map)(C=>p?C:C?.[0]),(0,O.Ny)(C=>this._converterEvaluator.evaluate({args:C,expression:u,context:s,defaultEvaluationFn:Vp})),(0,l.filter)(([,C])=>!!C),(0,l.concatMap)(([C])=>this._converterEvaluator.evaluate({args:C,expression:d,context:s,defaultEvaluationFn:Op})),(0,l.map)(C=>{const I=s.attributes[r];return[(0,P.cloneDeep)(C),(0,P.cloneDeep)(I)]}),(0,l.filter)(([C,I])=>!(0,P.isEqual)(C,I)),(0,l.tap)(([C,I])=>{s.attributes[r]=C,n?.onChangeAttributeValue(r,C,I)}),(0,l.map)(([C])=>C))}_createGetAttributeValueFn(e){const{viewModel:t,attributeName:s,attributeConfig:r,calculateAttributeFn:n}=e;let a;const u=this._getAttributeSourcesStream(r,t);return()=>{const d=s in t.attributes;return a?d?(0,o.of)(t.attributes[s]):a:(a=n(u).pipe((0,l.shareReplay)({bufferSize:1,refCount:!0})),t._subscriptions.add(a.subscribe()),a)}}_getAttributeSourcesStream(e,t){const s=this._getAttributeTriggers(e,t),r=this._getAttributeSourcesChanges(e,t);if(!s)return r||(0,o.of)(void 0);const n=e.triggersOptions.debounce;return r?(0,o.merge)(s.pipe((0,l.debounceTime)(n)),r).pipe((0,l.withLatestFrom)(r),(0,l.map)(([,a])=>a)):s.pipe((0,l.startWith)(void 0),(0,l.debounceTime)(n))}_getAttributeTriggers(e,t){const{triggers:s}=e,r=s.map(n=>this._attributeTriggerProviderFactory.create(n)?.getTrigger(n,t)).filter(Boolean);return r.length===0?null:(0,o.merge)(...r)}_getAttributeSourcesChanges(e,t){const{from:s}=e;return s.length===0?null:this._attributeSourcesChangesProviderFactory.create({attributeSources:s,requestsResolver:this._requestsResolver}).getChanges(s,e,t)}_defineCalculatedAttribute(e,t,s){Object.defineProperty(s,e,{get:()=>(0,o.firstValueFrom)(t(),{defaultValue:null}),configurable:!0})}defineAttribute(e){this._measurePerformanceService.measure(`CalculatedAttributeCreator.defineAttribute.${e.attribute}`,()=>{const{viewModel:t,attribute:s,attributeConfig:r}=e,n=Np(r,this._requestsResolver);if(n===null)return;const a=this._createCalculateAttributeValueFn(e,n),u=this._createGetAttributeValueFn({attributeName:s,attributeConfig:n,calculateAttributeFn:a,viewModel:t});this._defineCalculatedAttribute(s,u,t)})}static{this.\u0275fac=function(t){return new(t||tr)(c.\u0275\u0275inject(pt),c.\u0275\u0275inject(Il),c.\u0275\u0275inject(wl),c.\u0275\u0275inject(te.g),c.\u0275\u0275inject(Fo))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:tr,factory:tr.\u0275fac})}}class un{constructor(e,t){this.ngZone=e,this.measurePerformanceService=t}innerDefineAttribute(e,t){this.measurePerformanceService.measure(`DefaultAttributeCreator.defineAttribute.${e.attribute}`,()=>{const s=e.viewModel,r=s.attributes,n=e.attribute,a=e.attributeConfig,u=e.control,d=g=>{r[n]=g,this.ngZone.run(()=>{const C=s._viewModelAttributeChangeEventOptions?.getAsSilent();u.setValue(g,C),t?.call(this,g)})},p=()=>u.value;Xs.defineAsyncAttribute(s,n,a,p,d)})}defineAttribute(e){this.innerDefineAttribute(e)}static{this.\u0275fac=function(t){return new(t||un)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(te.g))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:un,factory:un.\u0275fac,providedIn:"root"})}}const ln="maskState",Mi="maskedValue",Ri="unMaskedValue";var dn;(function(i){i.Unmasked="unmasked",i.Masked="masked"})(dn||(dn={}));const Pl=Symbol("isAttributeValueMasked"),kp=Symbol("getMaskedValue"),Lp=Symbol("getUnmaskedValue"),Bp=Symbol("setMaskedState"),Fp=Symbol("getMaskedState");class ts extends un{_setMaskData(e,t){const s=e.viewModel,r=e.attribute;if(!e.attributeConfig.isValueMasked)return;const a=s._viewModelAttributeChangeEventOptions?.getIsMaskedValue(),u=a?dn.Masked:dn.Unmasked,d=a?Mi:Ri;s.setAttributePropertyValue(r,ln,u),s.setAttributePropertyValue(r,d,t)}afterDefineAttribute(e,t){this._setMaskData(e,t)}defineAttribute(e){this.innerDefineAttribute(e,t=>this.afterDefineAttribute(e,t))}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ts)))(s||ts)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ts,factory:ts.\u0275fac,providedIn:"root"})}}class hn extends ts{constructor(e,t){super(e,t)}afterDefineAttribute(e,t){super.afterDefineAttribute(e,t),e?.viewModel?.setAttributePropertyValue(e?.attribute,"displayColor",t?.primaryColorValue)}static{this.\u0275fac=function(t){return new(t||hn)(c.\u0275\u0275inject(c.NgZone),c.\u0275\u0275inject(te.g))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:hn,factory:hn.\u0275fac,providedIn:"root"})}}const Dl=new c.InjectionToken("View model attribute creator factory"),jp=O.gX.create({token:Dl,mappings:[{predicate:A.r.Lookup,injectable:hn},{predicate:El,injectable:tr}],default:{injectable:ts}});class ss{transform(e){return function(t){const{instance:s,params:r}=e,n={value:t.value};return s.validate(n,r)}}static{this.\u0275fac=function(t){return new(t||ss)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ss,factory:ss.\u0275fac,providedIn:"root"})}}class rs{resolveModelConfig(e){return null}static{this.\u0275fac=function(t){return new(t||rs)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:rs,factory:rs.\u0275fac,providedIn:"root"})}}class pn{constructor(){this.account={attributes:{Name:{},Ships:{isCollection:!0,viewModelConfig:"ship"},Employee:{viewModelConfig:"employee"}}},this.ship={attributes:{Id:{}}},this.employee={attributes:{Name:{},Age:{}}}}resolveModelConfig(e){return(0,o.of)(this[e]).pipe((0,l.delay)(50))}static{this.\u0275fac=function(t){return new(t||pn)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:pn,factory:pn.\u0275fac,providedIn:"root"})}}class ns{constructor(e){this.injector=e,this.initDependencies()}initDependencies(){this.repository=this.injector.get(rs),this.ngZone=this.injector.get(c.NgZone)}static{this.\u0275fac=function(t){return new(t||ns)(c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ns,factory:ns.\u0275fac})}}class $p{create(e){const{validator:t,...s}=e,r=s.params.map(({name:n})=>n);return class extends Te{constructor(n){super(n),this.async=s.async}_getMessageFromParams(n){return{[s.type]:{message:n.message}}}_setParamsProxy(n){return new Proxy(n,{get(a,u){if(r.includes(u))return a[u];throw new Error(`Property ${u} is not defined in validator params config`)}})}_toPromise(n){let a;return n instanceof Promise?a=n:n instanceof o.Observable?a=(0,o.lastValueFrom)(n,{defaultValue:null}):a=Promise.resolve(n),a}validate(n,a){let u=a;a&&(u=this._setParamsProxy(a));const p=t(u)(n,u);return this.isAsync?this._toPromise(p).then(g=>g&&u?.message?this._getMessageFromParams(u):g):u?.message&&p?this._getMessageFromParams(u):p}}}}class of{}const Up="ValidatorRegistry";class Ii extends et{static{this.registryKey=Up}static _hasWithAnotherTypeRef(e,t){const s=Ii.items.get(e);return!s||s.lazy&&!s.typeRef?!1:s.typeRef!==t}static validate(e){if(Pe(e.type,"ValidatorTypeName"),e.typeRef&&Ii._hasWithAnotherTypeRef(e.type,e.typeRef))throw new Error(`Error when register ${e.type}. Element with this type has already exist`)}static get items(){return this.store.typeInfos}static register(e){const t=this.items.get(e.type);this.items.set(e.type,{...t??{},...e})}}class mn extends vi{constructor(e){super(e)}getValidator(e,t){const s=Ii.items.get(e);if(!s)throw new Error(`Validator '${e}' was not registered`);if(s.lazy&&!s.instantiate)throw new Error(`Lazy module with ${e} validator is not loaded`);return s.instantiate(t?.injectionContext)}static{this.\u0275fac=function(t){return new(t||mn)(c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:mn,factory:mn.\u0275fac})}}class qp extends Fo{get(e){return Nt.requestsRegistrationInfos.get(e)}getAll(){return Nt.requestsRegistrationInfos}has(e){return Nt.requestsRegistrationInfos.has(e)}}var _e;(function(i){i.ChangeAttributeValue="change-attribute-value",i.ModelDataLoaded="model-data-loaded-event",i.BeforeModelLoad="before-model-load",i.LoadDefaultValues="load-default-values",i.StartLoadModelAttributes="start-load-model-attributes",i.FinishLoadModelAttributes="finish-load-model-attributes",i.ViewEvent="view-event"})(_e||(_e={}));function Tl(i,e){if(!i||!e)return o.EMPTY;const t=e.events$.pipe((0,l.filter)(s=>s.type===_e.ChangeAttributeValue),(0,l.filter)(s=>s.payload.attributeName===i),(0,l.switchMap)(()=>e[i]));return new o.Observable(s=>(i in e?(0,o.merge)((0,o.from)(e[i]),t):t).subscribe(s))}class Nl{}class is extends Nl{getChanges(e,t,s){const r=e.map(n=>Tl(n,s));return(0,o.combineLatest)(r)}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(is)))(s||is)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:is,factory:is.\u0275fac})}}function xl(i,e){if(!i||!e)return o.EMPTY;const t=new o.ReplaySubject(1),s=Se.instance.subscribe(r=>{r.type===i&&t.next(r)},e);return e._subscriptions.add(s),t}const Hp=100;class sr extends Nl{constructor(e){super(),this._converterEvaluator=e}_accumulateRequests(e,t,s){const r=new o.BehaviorSubject([]),n=this._accumulateRequestsCombinations(e,r,t,s).subscribe();return new o.Observable(a=>(r.complete(),n.unsubscribe(),this._findAcceptableRequestsCombination(r.value,t,s).pipe((0,l.switchMap)(u=>u?(0,o.merge)((0,o.of)(u),e):e)).subscribe(a)))}_accumulateRequestsCombinations(e,t,s,r){return e.pipe((0,l.map)(n=>[n,...t.value]),(0,l.switchMap)(n=>n.length<Hp?(0,o.of)(n):this._findAcceptableRequestsCombination(n,s,r).pipe((0,l.map)(a=>a?[a]:[]))),(0,l.tap)(n=>t.next(n)),(0,l.map)(()=>{}))}_findAcceptableRequestsCombination(e,t,s){if(!e.length)return(0,o.of)(null);const{filter:r,originalFrom:n}=t;return(0,o.from)(e).pipe((0,O.Ny)(a=>this._converterEvaluator.evaluate({args:Array.isArray(n)?a:a[0],context:s,expression:r})),(0,l.first)(([,a])=>!!a,[null]),(0,l.map)(([a])=>a))}getChanges(e,t,s){const r=e.map(a=>xl(a,s)),n=(0,o.combineLatest)(r);return t.filter?this._accumulateRequests(n,t,s):n}static{this.\u0275fac=function(t){return new(t||sr)(c.\u0275\u0275inject(pt))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:sr,factory:sr.\u0275fac})}}const Kp=O.gX.create({token:Il,mappings:[{predicate:i=>i.attributeSources.every(e=>i.requestsResolver.has(e)),injectable:sr}],default:{injectable:is}});class zp{}class Vl extends zp{constructor(e){super(),this._converterEvaluator=e}getTrigger(e,t){return this.getTriggerInternal(e,t).pipe((0,O.Ny)(s=>this._converterEvaluator.evaluate({args:s,expression:e?.filter,context:t,defaultEvaluationFn:()=>!0})),(0,l.filter)(([,s])=>!!s),(0,l.map)(()=>{}))}}class rr extends Vl{constructor(e){super(e)}getTriggerInternal(e,t){return Tl(e?.attribute,t)}static{this.\u0275fac=function(t){return new(t||rr)(c.\u0275\u0275inject(pt))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:rr,factory:rr.\u0275fac})}}class nr extends Vl{constructor(e){super(e)}getTriggerInternal(e,t){return new o.Observable(s=>xl(e?.request,t).subscribe(s))}static{this.\u0275fac=function(t){return new(t||nr)(c.\u0275\u0275inject(pt))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:nr,factory:nr.\u0275fac})}}const Gp=O.gX.create({token:wl,mappings:[{predicate:Ml,injectable:rr},{predicate:Rl,injectable:nr}]});class fn{static{this.\u0275fac=function(t){return new(t||fn)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:fn})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[tr,pt,rr,nr,is,sr,Kp,Gp,{provide:Fo,useClass:qp}]})}}class Ol{constructor(e,t,s=!1){this.name=e,this._value=t,this._locked=s,this._isValueInitialized=!1,this._pendingValue=void 0,this._onChanged=new c.EventEmitter,this._hasInitialValue=!1,t!=null&&(this._isValueInitialized=!0,this._hasInitialValue=!0,this._initialValue=t,this._value=(0,P.cloneDeep)(t),this._oldValue=(0,P.cloneDeep)(t))}get onChanged(){return this._onChanged}get value(){return this.getValue()}set value(e){this.setValue(e)}get initialValue(){return this._initialValue}set initialValue(e){this.setInitialValue(e)}get hasInitialValue(){return this._hasInitialValue}get isLocked(){return this._locked}emitValueChanged(e){this.onChanged.emit(e)}areValuesEqual(e,t){return(0,P.isEqual)(e,t)}getValue(){return this._value}setValue(e,t=!1){if(this._locked)return;this._isValueInitialized=!0,this._pendingValue=e;const s=this._oldValue;this.areValuesEqual(this._oldValue,e)||(this._oldValue=(0,P.cloneDeep)(e),this._value=(0,P.cloneDeep)(e),!t&&this.emitValueChanged({name:this.name,value:e,oldValue:s}))}resetValue(){this.hasInitialValue&&(this._oldValue=null,this.setValue(this.initialValue))}setInitialValue(e){this._hasInitialValue=!0,this._initialValue=e,this._isValueInitialized||this.setValue(e,!0)}setPending(e){const t=typeof this._pendingValue>"u"?this.value:this._pendingValue;this.value=e,this._pendingValue=t}resetPending(){this._oldValue=null,this.value=this._pendingValue,this._pendingValue=void 0}}class jo extends Ol{constructor(e,t,s,r,n=!1){super(e,t,n),this._validatorTypeResolver=s,this._injectionContext=r,this._onValidatorChanged=new c.EventEmitter}get onValidatorChanged(){return this._onValidatorChanged}_createValidatorInfo(){return{name:this.validatorTypeName,instance:this._validatorTypeResolver.getValidator(this.validatorTypeName,{injectionContext:this._injectionContext}),disabled:!0}}emitValueChanged(e){super.emitValueChanged(e),this.hasValidator&&this.updateValidator(e)&&this._onValidatorChanged.emit()}get hasValidator(){return!1}updateValidator(e){return!1}setValidatorInfo(e,t=!1){this.validatorInfo=e}initializeValidator(e,t=!1){if(!this.hasValidator||this._validatorTypeResolver==null)return e;let s=e.find(n=>n.name===this.validatorTypeName),r=!1;return s==null&&(s=this._createValidatorInfo(),r=!0),this.setValidatorInfo(s,t),r?[...e,s]:e}}class kl{static{this._properties=new Map}static _get(e){if(!e)return jo;if(this._properties.has(e))return this._properties.get(e);throw new Error(`CrtControlProperty with type ${e} doesn't registered`)}static register(e,t){this._properties.set(e,t)}static create(e){const t=this._get(e.typeName);return new t(e.name,e.value,e.validatorTypeResolver,e.injectionContext,e.locked===!0)}}function Wp(i){return function(e){Pe(i.name,"PropertyName"),kl.register(i.name,e)}}let $o=class extends jo{constructor(){super(...arguments),this.validatorTypeName="crt.Required"}get hasValidator(){return!0}updateValidator(e){return this.validatorInfo&&(this.validatorInfo.disabled=!e.value),!0}setValidatorInfo(e,t=!1){super.setValidatorInfo(e,t),this.initialValue=!e.disabled,this.setValue(!e.disabled,t)}};$o=(0,h.__decorate)([Wp({name:"crt.Required"})],$o);let Uo=class extends G{};Uo=(0,h.__decorate)([L({type:"crt.AddCommunicationOptionsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.Add\u0421ommunicationOptionsRequest",propertiesPanelComponentTypeName:"crt.AddCommunicationOptionsRequestPropertiesPanel",position:740})],Uo);var Ue;(function(i){i.Selection="selection",i.Filtration="filtration"})(Ue||(Ue={}));class Ll extends G{}class Bl extends Ll{}let qo=class extends Bl{};qo=(0,h.__decorate)([L({type:"crt.AddRecordsInStaticFoldersRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddRecordsInStaticFoldersRequest",propertiesPanelComponentTypeName:"crt.AddRecordsInStaticFoldersRequestPropertiesPanel",position:706,compatibleAPIs:{[Ue.Selection]:!0}})],qo);class Jp extends G{}let Ho=class extends Jp{};Ho=(0,h.__decorate)([L({type:"crt.AddTagsInRecordRequest"})],Ho);let Ko=class extends G{};Ko=(0,h.__decorate)([L({type:"crt.ContinueInOtherPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ContinueInOtherPageRequest",position:1e3})],Ko);let zo=class extends G{};zo=(0,h.__decorate)([L({type:"crt.CopilotActionRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CopilotActionRequest",propertiesPanelComponentTypeName:"crt.CopilotActionRequestPropertiesPanelComponent",position:3001})],zo);class Zp extends G{}let Go=class extends Zp{};Go=(0,h.__decorate)([L({type:"crt.CreateRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CreateRecordRequest",propertiesPanelComponentTypeName:"crt.CreateRecordRequestPropertiesPanel",position:200})],Go);let Wo=class extends G{};Wo=(0,h.__decorate)([L({type:"crt.DeleteRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.DeleteRecordsRequest",propertiesPanelComponentTypeName:"crt.DeleteRecordsRequestPropertiesPanel",position:701,compatibleAPIs:{[Ue.Selection]:!0}})],Wo);let Jo=class extends G{};Jo=(0,h.__decorate)([L({type:"crt.ExportDataGridToExcelRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ExportDataGridToExcelRequest",propertiesPanelComponentTypeName:"crt.ExportDataGridToExcelRequestPropertiesPanel",position:800,compatibleAPIs:{[Ue.Selection]:!0}})],Jo);let Zo=class extends G{};Zo=(0,h.__decorate)([L({type:"crt.ImportDataRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ImportDataRequest",propertiesPanelComponentTypeName:"crt.ImportDataRequestPropertiesPanel",position:750})],Zo);let Yo=class extends G{};Yo=(0,h.__decorate)([L({type:"crt.MoveSelectedItemsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.MoveSelectedItemsRequest",propertiesPanelComponentTypeName:"crt.MoveSelectedItemsRequestPropertiesPanel",position:1e3,compatibleAPIs:{[Ue.Selection]:!0}})],Yo);var Fl;(function(i){i.Root="root",i.Item="item",i.Const="const"})(Fl||(Fl={}));class cf{}let Xo=class extends G{};Xo=(0,h.__decorate)([L({type:"crt.OpenChangeLogRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenChangeLogRequest",propertiesPanelComponentTypeName:"crt.OpenChangeLogRequestPropertiesPanel",position:370})],Xo);let Qo=class extends G{};Qo=(0,h.__decorate)([L({type:"crt.OpenDuplicatesPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenDuplicatesPageRequest",propertiesPanelComponentTypeName:"crt.OpenDuplicatesPageRequestPropertiesPanel",position:360})],Qo);class Yp extends G{}let ec=class extends Yp{};ec=(0,h.__decorate)([L({type:"crt.OpenPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.OpenPageRequest",propertiesPanelComponentTypeName:"crt.OpenPageRequestPropertiesPanel",position:350})],ec);let tc=class extends G{};tc=(0,h.__decorate)([L({type:"crt.PrintablesRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.PrintablesRequest",propertiesPanelComponentTypeName:"crt.PrintablesRequestPropertiesPanel",position:3e3,compatibleAPIs:{[Ue.Selection]:!0}})],tc);let sc=class extends Bl{};sc=(0,h.__decorate)([L({type:"crt.RemoveRecordsInStaticFoldersRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RemoveRecordsInStaticFoldersRequest",propertiesPanelComponentTypeName:"crt.RemoveRecordsInStaticFoldersRequestPropertiesPanel",position:705,compatibleAPIs:{[Ue.Selection]:!0}})],sc);class jl extends Ll{}let rc=class extends jl{};rc=(0,h.__decorate)([L({type:"crt.RemoveTagsInRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RemoveTagsInRecordsRequest",propertiesPanelComponentTypeName:"crt.RemoveTagsInRecordsRequestPropertiesPanel",position:704,compatibleAPIs:{[Ue.Selection]:!0}})],rc);let nc=class extends G{};nc=(0,h.__decorate)([L({type:"crt.RunBusinessProcessRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.RunBusinessProcessRequest",propertiesPanelComponentTypeName:"crt.RunBusinessProcessRequestPropertiesPanel",position:700,compatibleAPIs:{[Ue.Selection]:!0}})],nc);let ic=class extends G{};ic=(0,h.__decorate)([L({type:"crt.SaveRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SaveRecordRequest",propertiesPanelComponentTypeName:"crt.SaveRecordRequestPropertiesPanel",position:400})],ic);let ac=class extends G{};ac=(0,h.__decorate)([L({type:"crt.SelectLookupPageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SelectLookupPageRequest",propertiesPanelComponentTypeName:"crt.SelectLookupPageRequestPropertiesPanel",scopes:["BaseLookupPageTemplate"],position:2e3})],ac);let oc=class extends G{};oc=(0,h.__decorate)([L({type:"crt.SetRecordRightsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.SetRecordRightsRequest",propertiesPanelComponentTypeName:"crt.SetRecordRightsRequestPropertiesPanel",position:800})],oc);let cc=class extends G{};cc=(0,h.__decorate)([L({type:"crt.ShowRelationshipsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ShowRelationshipsRequest",propertiesPanelComponentTypeName:"crt.ShowRelationshipsRequestPropertiesPanel",position:900})],cc);class Xp extends G{}let uc=class extends Xp{};uc=(0,h.__decorate)([L({type:"crt.UpdateRecordRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.UpdateRecordRequest",propertiesPanelComponentTypeName:"crt.UpdateRecordRequestPropertiesPanel",position:300})],uc);class Qp extends G{}let lc=class extends Qp{};lc=(0,h.__decorate)([L({type:"crt.UploadFileRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.UploadFileRequest",propertiesPanelComponentTypeName:"crt.UploadFileRequestPropertiesPanel",position:702})],lc);let dc=class extends G{constructor(){super(...arguments),this.type="crt.CancelRecordChangesRequest"}};dc=(0,h.__decorate)([L({type:"crt.CancelRecordChangesRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.CancelRecordChangesRequest",position:500})],dc);let hc=class extends G{constructor(){super(...arguments),this.type="crt.ClosePageRequest"}};hc=(0,h.__decorate)([L({type:"crt.ClosePageRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.ClosePageRequest",position:600})],hc);let pc=class extends Cp{};pc=(0,h.__decorate)([L({type:"crt.LoadDataRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.LoadDataRequest",propertiesPanelComponentTypeName:"crt.LoadDataRequestPropertiesPanel",position:500})],pc);class Vt extends G{}let mc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleAfterModelDeleteRequest"}};mc=(0,h.__decorate)([L({type:"crt.HandleAfterModelDeleteRequest"})],mc);let fc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleAfterModelInsertRequest"}};fc=(0,h.__decorate)([L({type:"crt.HandleAfterModelInsertRequest"})],fc);let gc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleAfterModelLoadRequest"}};gc=(0,h.__decorate)([L({type:"crt.HandleAfterModelLoadRequest"})],gc);let _c=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleAfterModelUpdateRequest"}};_c=(0,h.__decorate)([L({type:"crt.HandleAfterModelUpdateRequest"})],_c);let yc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelDeleteRequest"}};yc=(0,h.__decorate)([L({type:"crt.HandleBeforeModelDeleteRequest"})],yc);let bc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelInsertRequest"}};bc=(0,h.__decorate)([L({type:"crt.HandleBeforeModelInsertRequest"})],bc);let Sc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelLoadRequest"}};Sc=(0,h.__decorate)([L({type:"crt.HandleBeforeModelLoadRequest"})],Sc);let Cc=class extends Vt{constructor(){super(...arguments),this.type="crt.HandleBeforeModelUpdateRequest"}};Cc=(0,h.__decorate)([L({type:"crt.HandleBeforeModelUpdateRequest"})],Cc);let Ac=class extends jl{};Ac=(0,h.__decorate)([L({type:"crt.AddTagsInRecordsRequest",title:"InterfaceDesigner.PropertiesPages.ViewElementEventPropertiesPanel.Requests.AddTagsInRecordsRequest",propertiesPanelComponentTypeName:"crt.AddTagsInRecordsRequestPropertiesPanel",position:703,compatibleAPIs:{[Ue.Selection]:!0}})],Ac);function em(){const i=[$o,Uo,qo,Ho,Ko,zo,Go,Wo,Jo,Zo,Yo,Xo,Qo,ec,tc,sc,rc,nc,ic,ac,oc,cc,uc,lc,dc,hc,pc,mc,fc,gc,_c,yc,bc,Sc,Cc,Ac]}let vc=class extends G{constructor(e){super(),this.type="crt.HandleViewModelAttributeChangeRequest",this.attributeName=e.attributeName,this.value=e.value,this.oldValue=e.oldValue,this.silent=!!e.silent,this.preventAttributeChangeRequest=!!e.preventAttributeChangeRequest,this.preventStateChange=!!e.preventStateChange,this.preventRunBusinessRules=!!e.preventRunBusinessRules}};vc=(0,h.__decorate)([L({type:"crt.HandleViewModelAttributeChangeRequest"}),(0,h.__metadata)("design:paramtypes",[Object])],vc);var mt;(function(i){i.DebouncingBusinessRules="DebouncingBusinessRules",i.RunningBusinessRules="RunningBusinessRules",i.ProcessingAttributeChangeRequest="ProcessingAttributeChangeRequest",i.AttributeLoading="AttributeLoading"})(mt||(mt={}));let Ec=class extends G{constructor(){super(...arguments),this.type="crt.HandleViewModelInitRequest"}};Ec=(0,h.__decorate)([L({type:"crt.HandleViewModelInitRequest"})],Ec);let Mc=class extends G{constructor(){super(...arguments),this.type="crt.HandleViewModelResumeRequest"}};Mc=(0,h.__decorate)([L({type:"crt.HandleViewModelResumeRequest"})],Mc);let Rc=class extends G{constructor(){super(...arguments),this.type="crt.HandleViewModelPauseRequest"}};Rc=(0,h.__decorate)([L({type:"crt.HandleViewModelPauseRequest"})],Rc);let Ic=class extends G{constructor(){super(...arguments),this.type="crt.HandleViewModelDestroyRequest"}};Ic=(0,h.__decorate)([L({type:"crt.HandleViewModelDestroyRequest"})],Ic);class ir extends Vu{processRequest(e,t){return(0,S.A)(function*(){const{model:s,payload:r}=t??{},n={...e,model:s&&nt[vu](s),payload:r};return yield Se.instance.process(n)})()}onBeforeLoad(e){return this.processRequest({type:"crt.HandleBeforeModelLoadRequest",previousPayload:e?.previousPayload},e)}onAfterLoad(e){var t=this;return(0,S.A)(function*(){yield t.processRequest({type:"crt.HandleAfterModelLoadRequest",previousPayload:e?.previousPayload},e)})()}onBeforeInsert(e){return this.processRequest({type:"crt.HandleBeforeModelInsertRequest"},e)}onAfterInsert(e){var t=this;return(0,S.A)(function*(){yield t.processRequest({type:"crt.HandleAfterModelInsertRequest"},e)})()}onBeforeUpdate(e){return this.processRequest({type:"crt.HandleBeforeModelUpdateRequest"},e)}onAfterUpdate(e){var t=this;return(0,S.A)(function*(){yield t.processRequest({type:"crt.HandleAfterModelUpdateRequest"},e)})()}onBeforeDelete(e){return this.processRequest({type:"crt.HandleBeforeModelDeleteRequest"},e)}onAfterDelete(e){var t=this;return(0,S.A)(function*(){yield t.processRequest({type:"crt.HandleAfterModelDeleteRequest"},e)})()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ir)))(s||ir)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ir,factory:ir.\u0275fac,providedIn:"root"})}}class ar extends ir{processRequest(e,t){return super.processRequest({...e,$context:this._context?.deref()},t)}setContext(e){this._context||(this._context=new WeakRef(e))}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ar)))(s||ar)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ar,factory:ar.\u0275fac})}}class tm{constructor(e={preventAttributeChangeRequest:!1,preventRunBusinessRules:!1,preventStateChange:!1,isMaskedValue:!1}){this._preventAttributeChangeRequest=!1,this._preventStateChange=!1,this._preventRunBusinessRules=!1,this._isMaskedValue=!1,this._setOptions(e)}_setUsingSilent(e){this._preventStateChange=e,this._preventRunBusinessRules=e,this._preventAttributeChangeRequest=!1}_setOptions(e){this._preventAttributeChangeRequest=e?.preventAttributeChangeRequest??this._preventAttributeChangeRequest,this._preventStateChange=e?.preventStateChange??this._preventStateChange,this._preventRunBusinessRules=e?.preventRunBusinessRules??this._preventRunBusinessRules,this._isMaskedValue=e?.isMaskedValue??this._isMaskedValue}getAsSilent(){return this._preventRunBusinessRules&&this._preventStateChange}getIsMaskedValue(){return this._isMaskedValue}setOptions(e){if((0,P.isUndefined)(e?.silent)){const t=(0,P.pick)(e,"preventAttributeChangeRequest","preventStateChange","preventRunBusinessRules","isMaskedValue");this._setOptions(t)}else this._setUsingSilent(e?.silent)}getOptions(){return{preventAttributeChangeRequest:this._preventAttributeChangeRequest,preventRunBusinessRules:this._preventRunBusinessRules,preventStateChange:this._preventStateChange,isMaskedValue:this._isMaskedValue}}reset(){this._preventAttributeChangeRequest=!1,this._preventRunBusinessRules=!1,this._preventStateChange=!1,this._isMaskedValue=!1}}var wi;(function(i){i.EntityDataSource="crt.EntityDataSource",i.WebServiceDataSource="crt.WebServiceDataSource",i.PageParametersDataSource="crt.PageParametersDataSource"})(wi||(wi={}));var or;(function(i){i.Reload="reload",i.Merge="merge"})(or||(or={}));function sm(i){let e=!1;const t=[];return Object.keys(i).forEach(s=>{$l(s,i)&&(e=!0,t.push(s))}),{hasCycles:e,cycledModelsNames:t}}function $l(i,e,t=[]){if(!e[i])return!1;const s=Object.values(e[i]);return s.some(n=>t.includes(Ul(n)))?!0:(t.push(i),!s.every(n=>!$l(Ul(n),e,t)))}function Ul(i){return i.relationPath.split(".")[0]}var Pi;(function(i){i.AddTask="addTask",i.RemoveTask="removeTask"})(Pi||(Pi={}));class ql extends G{constructor(e,t,s){super(),this.action=e,this.taskName=t,this.$context=s,this.type="crt.SchemaViewMaskRequest"}}class wc extends Kn{constructor(){super(...arguments),this.requestType="crt.MaskService"}showMask(e,t){return(0,S.A)(function*(){const s=new ql(Pi.AddTask,e,t);yield Se.instance.process(s)})()}hideMask(e,t){return(0,S.A)(function*(){const s=new ql(Pi.RemoveTask,e,t);yield Se.instance.process(s)})()}}(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],wc.prototype,"showBodyMask",void 0),(0,h.__decorate)([Ze(),(0,h.__metadata)("design:type",Function)],wc.prototype,"hideBodyMask",void 0);const rm=new c.InjectionToken("DEVKIT_MASK_SERVICE",{providedIn:"root",factory:()=>new wc});class Hl{constructor(e){this.ngZone=e}run(e,t,s){return this.ngZone.runOutsideAngular(e)}}class nm extends Hl{constructor(e){super(e)}run(e,t,s){return this.ngZone.run(e,t,s)}}var Pc;(function(i){i.Root="root",i.Angular="angular",i.ExecutionTracking="executionTracking"})(Pc||(Pc={}));var gn;(function(i){i[i.Busy=0]="Busy",i[i.Idle=1]="Idle"})(gn||(gn={}));var Di;(function(i){i.ReadyStateChange="readystatechange"})(Di||(Di={}));class im{constructor(e){this._trackedTasks=[],this._trackedEventTasks=[],this._enableDebugTracking=!1,this._disableWaits=!1,this._pendingFunctions=new Map,this.onStateChange$=new c.EventEmitter(!1),this._parentZone=Zone.current,this._rootZone=Zone.root,this._isBusy=!1,this._ignoredTaskSources=["setInterval","requestAnimationFrame"],this._eventTaskFilters=[t=>t.source.startsWith("XMLHttpRequest")&&t.source.endsWith(Di.ReadyStateChange)],this._zone=this._parentZone.fork({name:e,properties:{currentExecutionZone:this},onInvokeTask:this._onInvokeTask.bind(this),onCancelTask:this._onCancelTask.bind(this),onScheduleTask:this._onScheduleTask.bind(this),onHasTask:this._onHasTask.bind(this)})}wait(e){if(this._disableWaits)return e();this._isBusy||(this._isBusy=!0,this.onStateChange$.next(gn.Busy));const t=(0,j.qv)();return this._pendingFunctions.set(t,this._enableDebugTracking?e:null),e().finally(()=>{this._pendingFunctions.delete(t),!this._pendingFunctions.size&&this._zone.run(()=>new Promise(s=>setTimeout(s)))}).catch(s=>{throw s})}_cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(e,t){if(e.type==="eventTask"&&(e.state==="running"||e.state==="scheduled")){const s=e;s.eventName===Di.ReadyStateChange&&s.target.readyState===XMLHttpRequest.DONE&&t.cancelTask(s)}}_onInvokeTask(e,t,s,r,n,a){this._unTrackTask(r);let u;try{u=e.invokeTask(s,r,n,a),this._cancelXMLHttpRequestReadyStateChangeTaskOnRequestComplete(r,t)}catch(d){console.error(d),t.cancelTask(r)}return u}_onCancelTask(e,t,s,r){return this._unTrackTask(r),e.zone.runGuarded(()=>e.cancelTask(s,r))}_onScheduleTask(e,t,s,r){return this._getCanScheduleTask(r)?(this._trackTask(r),e.scheduleTask(s,r)):(r.cancelScheduleRequest(),this._parentZone.scheduleTask(r))}_onHasTask(e,t,s,r){e.hasTask(s,r);const n=r.eventTask||r.macroTask||r.microTask||this._pendingFunctions.size>0;this._isBusy!==n&&(this._rootZone.run(()=>this.onStateChange$.next(n?gn.Busy:gn.Idle)),this._isBusy=n)}_trackTask(e){this._enableDebugTracking&&(e.type==="eventTask"&&this._trackedEventTasks.push(e),this._trackedTasks.push(e))}_unTrackTask(e){if(!this._enableDebugTracking)return;const t=this._trackedTasks.indexOf(e);t>-1&&this._trackedTasks.splice(t,1)}_getCanScheduleTask(e){return e.type==="eventTask"?this._eventTaskFilters.some(t=>t(e)):this._ignoredTaskSources.indexOf(e.source)===-1}run(e,t,s){return this._zone.run(e,t,s)}}class cr{constructor(e){this._ngZone=e}createDefaultZones(){return{root:new Hl(this._ngZone),angular:new nm(this._ngZone)}}createZone(e,t){if(t===Pc.ExecutionTracking)return new im(e);throw new Error(`Zone ${e} with type ${t} is not supported`)}static{this.\u0275fac=function(t){return new(t||cr)(c.\u0275\u0275inject(c.NgZone))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:cr,factory:cr.\u0275fac,providedIn:"root"})}}let Dc=class $i{constructor(e){this._zoneProvider=e,this._zones=e.createDefaultZones()}init(e){var t=this;return(0,S.A)(function*(){t._disableExecutionTrackingZone=yield(0,o.lastValueFrom)(e("DisableExecutionTrackingZone"))})()}runInZone(e,t,s,r){return this._disableExecutionTrackingZone&&e!==Dt.Angular&&(e=Dt.Root),(this._zones[e]??this._zones[Dt.Root]).run(t,s,r)}register(e,t){if(this._zones[e])throw new Error(`Zone ${e} already registered`);const s=this._zoneProvider.createZone(e,t);return this._zones[e]=s,s}get(e){return this._zones[e]}runOutside(e){return this.runInZone(Dt.Root,e)}static{this.\u0275fac=function(t){return new(t||$i)(c.\u0275\u0275inject(cr))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:$i,factory:$i.\u0275fac,providedIn:"root"})}};Dc=(0,h.__decorate)([(0,O.op)({requestType:"crt.ZoneService"}),(0,h.__metadata)("design:paramtypes",[cr])],Dc);const Kl=new c.InjectionToken("CRT_METADATA_PREPROCESSOR");class am{constructor(e,t){this.id=e,this._baseHostInjector=t,this._hostModuleTypes=[],this._hostModuleRefs=[],this._lazyModulesBySource=new Map,this._hostInjector=this._baseHostInjector}_createDynamicNgModule(e){const s=this._hostInjector.get(Kl,[]).map(a=>({provide:Kl,useValue:a,multi:!0})),r=(0,c.NgModule)({providers:s})(class{}),n=(0,c.NgModule)({imports:[r,...e]})(class{});return(0,c.createNgModule)(n,this._hostInjector)}inject(e){return this._hostInjector.get(e)}addLazyModule(e){const t=gr.get(e);if(!t)throw new Error("Module was not bootstrapped");const{source:s}=t;this._lazyModulesBySource.has(s)||this._lazyModulesBySource.set(s,new Set),this._lazyModulesBySource.get(s).add(e)}getLazyModules(e){return[...this._lazyModulesBySource.get(e)??[]]}connectHostLazyModules(){const e=this.getLazyModules("host");if((0,P.isEqual)(e,this._hostModuleTypes))return;const t=this._createDynamicNgModule(e);this._hostModuleTypes=e,this._hostModuleRefs.push(t),this._hostInjector=t.injector}destroy(){for(const e of this._hostModuleRefs)e.destroy();this._hostModuleRefs=[]}}var Tc=_(74975);class ur extends Tc.S{constructor(){super(...arguments),this._injectionContextsMap=new Map}createContext(e,t){const s=new am(e,t);return this._injectionContextsMap.set(e,s),s}injectFromContext(e,t){return this._injectionContextsMap.get(e)?.inject(t)}removeContext(e){return this._injectionContextsMap.get(e)?.destroy(),this._injectionContextsMap.delete(e)}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(ur)))(s||ur)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:ur,factory:ur.\u0275fac,providedIn:"root"})}}const om=new c.InjectionToken("IS_DESIGN_TIME"),cm=new c.InjectionToken("Terrasoft global object",{providedIn:"root",factory:()=>(0,P.get)((0,c.inject)(O.ZP),["Terrasoft"])||{}}),um=new c.InjectionToken("Flag indicating that this is an angular host",{providedIn:"root",factory:()=>(0,P.get)((0,c.inject)(cm),["isAngularHost"])}),zl=100;class lr extends Tc.S{constructor(){super(...arguments),this._window=(0,c.inject)(O.ZP),this._requestBuffer=[],this._requestIter=0,this._cachedRequestIter=0,this._compressedRequestIter=0}_onRequest(e){const t=e.getEntries();for(const s of t){if(!s.name.startsWith(this._window.location.origin))return;this._requestIter++,s.transferSize||this._cachedRequestIter++,s.encodedBodySize!==s.decodedBodySize&&this._compressedRequestIter++,s.fetchStart&&s.responseStart&&s.responseEnd&&this._requestBuffer.push({name:s.name,initiatorType:s.initiatorType,transferSize:s.transferSize,responseStart:s.responseStart,responseEnd:s.responseEnd,fetchStart:s.fetchStart})}}_calculateLatency(e,t){return e/(t/1e3)/1e3/1e3||0}_normalizeUrl(e,t){try{return(e+new URL(t)?.pathname.replace("/0/","/")).slice(0,zl)}catch{return t?.slice(0,zl)}}_reset(){this._resourcePerformanceObserver?.disconnect(),this._markPerformanceObserver?.disconnect(),this._requestBuffer=[],this._compressedRequestIter=0,this._cachedRequestIter=0,this._requestIter=0}_downlink(){let e=0,t=0;return this._requestBuffer.forEach(r=>{r.initiatorType==="xmlhttprequest"&&(e+=r.transferSize,t+=r.responseEnd-r.responseStart)}),+this._calculateLatency(e,t).toFixed(1)}_withCache(){return Math.round(this._cachedRequestIter/this._requestIter*100)||0}_withCompression(){return Math.round(this._compressedRequestIter/this._requestIter*100)||0}_topRequests(e){const t=[];for(let s=this._requestBuffer.length-1;s>=0;s--){const r=this._requestBuffer[s],n=Math.round(r.responseEnd-r.fetchStart);if(n>=e.topRequestThreshold&&t.length<e.topRequestCount){const a=this._normalizeUrl(n,r.name);if(t.push(a),t.length===e.topRequestThreshold)return t}}return t}start(){this._reset(),this._resourcePerformanceObserver=this._resourcePerformanceObserver??new PerformanceObserver(this._onRequest.bind(this)),this._resourcePerformanceObserver.observe({type:"resource",buffered:!this._firstStart}),this._firstStart=!0}measure(e={topRequestThreshold:400,topRequestCount:5}){const t={transferred:0};return this._requestBuffer.sort((s,r)=>s.fetchStart-r.fetchStart),t.duration=this._calculateDuration(),t.transferred=this._calculateTransferred(),t.downlink=this._downlink(),t.cache=this._withCache(),t.compression=this._withCompression(),t.topRequests=this._topRequests(e),this._reset(),t}_calculateDuration(){let e=this._requestBuffer[0]?.responseEnd,t=this._requestBuffer[0]?.responseEnd-this._requestBuffer[0]?.fetchStart;return this._requestBuffer.forEach(s=>{e<s.fetchStart?t+=s.responseEnd-s.fetchStart:e<s.responseEnd&&(t+=s.responseEnd-e),e=Math.max(e,s.responseEnd)}),Math.round(t)||0}_calculateTransferred(){let e=this._requestBuffer.reduce((t,s)=>t+s.transferSize,0);return e=Math.round(e/1e3)||0,e}ngOnDestroy(){this._reset()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(lr)))(s||lr)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:lr,factory:lr.\u0275fac,providedIn:"root"})}}var Xe;(function(i){i.PageStartLoading="PageStartLoading",i.PageFinishLoading="PageFinishLoading"})(Xe||(Xe={}));class _n extends Tc.S{constructor(){super(),this._ngZone=(0,c.inject)(c.NgZone),this._window=(0,c.inject)(O.ZP),this._featureValues=(0,c.inject)(F,{optional:!0}),this._isAngularHost=(0,c.inject)(um,{optional:!0}),this._performanceNetworkObserver=(0,c.inject)(lr),this._measureName="PageLoadDuration",this._debounceTime=100,this._subscriptions=new o.Subscription,this._measurements=[],this._tasks=new Set,this._loadingStarted=!1,this._loadingStartedCount=new Set,this._loadingFinishedCount=new Set,this._tasksQueueSubject=new o.Subject,this._pageLoadLifeCycleSubject=new o.Subject,this._iterationCounter=0,this.pageLoadDuration$=new o.Subject,this._enableMeasurement=!!this._isAngularHost&&!this._featureValues?.DisablePerformancePageLoadMeasurement,this._initSubscriptions(),(0,P.set)(this._window,"creatio.performance.measurePerformancePageLoadService",this)}_initSubscriptions(){this._enableMeasurement&&(this._subscriptions.add(this._tasksQueueSubject.pipe((0,o.debounceTime)(this._debounceTime),(0,l.filter)(e=>this._loadingStartedCount.size===this._loadingFinishedCount.size&&this._loadingStarted&&e.size===1&&e.has(Xe.PageStartLoading))).subscribe({next:()=>this._pageLoadLifeCycleSubject.next(Xe.PageFinishLoading)})),this._subscriptions.add(this._pageLoadLifeCycleSubject.subscribe({next:e=>{this._ngZone.runOutsideAngular(()=>{e===Xe.PageStartLoading&&this._onStartPageLoadMeasure(),e===Xe.PageFinishLoading&&this._onEndPageLoadMeasure()})}})))}_onStartPageLoadMeasure(){this.addTask(Xe.PageStartLoading)}_getLocationInfo(){const e=this._window.location.hash,[t,s]=e.slice(1).split("/");return{moduleName:t,schemaName:s,hash:e}}_getMeasurementDetail(){const t=((0,P.get)(this._window,"creatio.performance")??{}).focusLossDuringLoad,s={iteration:this._iterationCounter++,location:this._getLocationInfo(),isReuse:!!this._isReuseMode,focusLossDuringLoad:!!t};return this._featureValues.DisablePerformancePageNetworkMeasurement||(s.network=this._performanceNetworkObserver.measure()),s}_onEndPageLoadMeasure(){this.removeTask(Xe.PageFinishLoading),this.removeTask(Xe.PageStartLoading);const e={start:this._startTime,detail:this._getMeasurementDetail(),end:this._window.performance.now()};this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this.pageLoadDuration$.next(e),this._reset()}_reset(){const e=(0,P.get)(this._window,"creatio.performance");e.initialLoad?e.initialLoad=!1:e.focusLossDuringLoad=null,this._startTime=null,this._tasks.clear(),this._loadingStarted=!1,this._loadingStartedCount.clear(),this._loadingFinishedCount.clear(),this._isReuseMode=null}setReuseMode(e){this._enableMeasurement&&this._isReuseMode===null&&(this._isReuseMode=e)}startPageLoadMeasure(e=performance.now()){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{this._reset(),this._startTime=e,this._pageLoadLifeCycleSubject.next(Xe.PageStartLoading),this._featureValues.DisablePerformancePageNetworkMeasurement||this._performanceNetworkObserver.start()})}addTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&(this._loadingStartedCount.add(e),this._loadingStarted=!0),this._tasks.add(e),this._tasksQueueSubject.next(this._tasks)})}removeTask(e,t={}){this._enableMeasurement&&this._ngZone.runOutsideAngular(()=>{t.targetTask&&this._loadingFinishedCount.add(e),this._tasks.delete(e),this._tasksQueueSubject.next(this._tasks)})}getMeasurements(){const e=this._measurements.map(t=>t());return this._measurements=[],e}getMeasureDataOnTimeout$(){const e={start:this._startTime,end:this._window.performance.now(),detail:this._getMeasurementDetail(),timeout:!0};return this._measurements.push(()=>this._window.performance.measure(this._measureName,e)),this._reset(),(0,o.of)(e)}ngOnDestroy(){this._reset(),this._subscriptions.unsubscribe(),this._tasksQueueSubject.complete(),this._pageLoadLifeCycleSubject.complete(),this.pageLoadDuration$.complete()}static{this.\u0275fac=function(t){return new(t||_n)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:_n,factory:_n.\u0275fac,providedIn:"root"})}}var Q;(function(i){i.Add="add",i.Remove="remove",i.Move="move",i.Reload="reload"})(Q||(Q={}));class ft extends Array{constructor(...e){return super(),this._changed=new o.Subject,this._createdItems=[],this._deletedItems=[],this._itemsChanged=new o.Subject,this._itemAttributeChanged=new o.Subject,this._destroyed$=new o.Subject,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[],this._trackChanges=!0,this._isDestroyed=!1,typeof e[0]=="number"?new Array(e[0]):([this._viewModelGenerator,this._viewModelConfig={},this._model,this._host,this._hostAttributeName]=e,this._measurePerformanceService=this._host?.[ht]?.get(te.g,null,{optional:!0}),this._featureValues=this._host?.[ht]?.get(F,{},{optional:!0})??{},this._ngZone=this._host?.[ht]?.get(c.NgZone,null,{optional:!0}),Object.setPrototypeOf(this,Object.create(ft.prototype)),this._subscribeItemsModelModesChanges(),this._subscribeItemsAttributesChanges(),new Proxy(this,{set:(t,s,r,n)=>{const a=t[s];if(t[s]=r,this._trackChanges){const u=s==="length"&&r!==a,d=!isNaN(parseInt(s));(u||d)&&this._onItemsChanged()}return!0}}))}get changed(){return this._changed.asObservable().pipe((0,O.BV)(this._ngZone),(0,l.takeUntil)(this._destroyed$))}get itemAttributeChanged(){return this._itemAttributeChanged.asObservable().pipe((0,l.takeUntil)(this._destroyed$))}get isChanged(){return this.getChangedItems().length>0}get formApiModel(){return this._formApiModel||this._updateFormApiModelValues({emitEvent:!1}),this._formApiModel}_isItemPrimaryAttributeEqual(e,t){return(0,S.A)(function*(){if(!e)return!1;const s=yield e[e.primaryAttributeName];return t.includes(s)})()}_getNewCallbacksMap(){return new Map([[Q.Add,[]],[Q.Remove,[]],[Q.Move,[]],[Q.Reload,[]]])}_insertItem(e,t){typeof t!="number"&&(t=this.length),t=Math.max(t,0),t=Math.min(t,this.length),this._triggerChangesAfter(()=>super.splice(t,0,e))}_generateItem(e){const t=()=>{const s=this._model?.createCollectionItemModel(D.Create),r=this._host?.[ht]?c.Injector.create({providers:[{provide:Ai,useValue:null}],parent:this._host?.[ht]}):null,n={viewModelConfig:this._viewModelConfig,modelConfig:s?{primaryDataSourceName:s.name}:void 0,models:s?[s]:void 0,parentViewModel:this._host,businessRulesActive:e.businessRulesActive??!1},a=g=>{s?.name&&(g.dataSchemas[s.name]=this._host.dataSchemas[s.name])},u=g=>s?.name?g.create(s.name,e.initialModelValues).pipe((0,l.map)(()=>g)):(0,o.of)(g),d=g=>{Object.entries(e.initialAttributeValues??{}).forEach(([C,I])=>g[C]=I),g._markAsPristine(e.initialAttributeValues??{}),this._model?.childrenChange()},p=this._viewModelGenerator.generate(n,r).pipe((0,l.tap)(a),(0,l.switchMap)(u),(0,l.tap)(d));return(0,o.lastValueFrom)(p)};return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.generateItem",()=>t()):t()}_mergeItems(e,t){const s=()=>{const r=(e[0]||t[0])?.primaryAttributeName;for(const n of t){const a=e.findIndex(u=>{const d=u.attributes?.[r],p=n.attributes?.[r];return d&&d===p});a===-1?e.push(n):e.splice(a,1,n)}return e};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.mergeItems",()=>s()):s()}_triggerChangesAfter(e,t){this._trackChanges=!1;const s=e.call(this);return this._trackChanges=!0,this._isDestroyed||(this._onItemsChanged(),t&&this._executeChangesCallbacksWhenReady(t)),s}_executeChangesCallbacks(e){this._onCollectionChangeCallbacksMap.get(e.action).forEach(s=>{this._safeExecuteCallback(s,{...e,collection:[...this]},e.action)})}_executeChangesCallbacksWhenReady(e){Promise.resolve().then(()=>this._executeChangesCallbacks(e))}_onItemsChanged(){const e=this.map(t=>({item:t,itemModelMode:t?.getPrimaryModelMode?.()}));this._updateCollectionState(e,!0)}_subscribeItemsModelModesChanges(){this._itemsChanged.pipe((0,l.switchMap)(()=>this._getItemsModelModesChanges()),(0,l.tap)(e=>this._updateCollectionState([e],!1)),(0,l.takeUntil)(this._destroyed$)).subscribe()}_subscribeItemsAttributesChanges(){const e=t=>{this._onItemAttributesChangesCallbacks.forEach(s=>{try{s(t)}catch(r){console.error("An error occurred during execution of item attributes change callback:",r)}})};this._itemsChanged.pipe((0,l.switchMap)(()=>this._getItemsWithAttributesChanges()),(0,l.tap)(t=>e(t)),(0,l.tap)(()=>this._itemAttributeChanged.next()),(0,l.takeUntil)(this._destroyed$)).subscribe()}_getItemsWithAttributesChanges(){const e=t=>{const s=t.events$?.pipe((0,l.map)(r=>r.type===_e.ChangeAttributeValue&&!r.payload.silent));return t?.events$?s.pipe((0,l.map)(r=>r?t:null)):(0,o.of)(null)};return(0,o.merge)(...this.map(e)).pipe((0,l.filter)(Boolean))}_getItemsModelModesChanges(){const e=[...this,...this._deletedItems].map(t=>t?._getPrimaryModelModeChanges?.()?.pipe((0,l.map)(s=>({item:t,itemModelMode:s})))).filter(Boolean);return e.length?(0,o.merge)(...e):o.EMPTY}_updateCollectionState(e,t){this._trackChanges=!1;const s=e.map(r=>this._onItemModelModeChanged(r)).some(r=>!!r);this._trackChanges=!0,!(!t&&!s)&&(this._updateFormApiModelValues(),this._updateFormApiModelPristineState(),this._changed.next(),this._itemsChanged.next())}_onItemModelModeChanged(e){const{item:t,itemModelMode:s}=e;if(!t||s==null)return!1;switch(s){case D.Create:return this._onCreateItem(t);case D.Update:return this._onUpdateItem(t);case D.Delete:return this._onDeleteItem(t);default:return!1}}_onCreateItem(e){const t=this._deletedItems.indexOf(e);return t!==-1?(this._deletedItems.splice(t,1),!0):(this._createdItems.indexOf(e)===-1&&this._createdItems.push(e),!1)}_onUpdateItem(e){const t=this._createdItems.indexOf(e);if(t!==-1)return this._createdItems.splice(t,1),!1;const s=this._deletedItems.indexOf(e);if(s!==-1){const r=this._deletedItems.splice(s,1);super.push(...r)}return!0}_onDeleteItem(e){const t=this._createdItems.indexOf(e),s=this._deletedItems.indexOf(e);t!==-1?this._createdItems.splice(t,1):s===-1&&this._deletedItems.push(e);const r=this.indexOf(e);return r===-1?!1:(super.splice(r,1),this._executeChangesCallbacks({collection:[],affectedElements:[e],action:Q.Remove,index:r}),!0)}_updateFormApiModelValues(e){if(this._featureValues.DisableBaseViewModelCollectionOptimization){this._formApiModel??=new Fe.FormArray([]),this._formApiModel.clear({emitEvent:!1}),this.filter(s=>s?.formApiModel).forEach(s=>{this._formApiModel.push(s.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity();return}if(!this._formApiModel||!this._formApiModel.length){const s=new Fe.FormArray(this.filter(r=>r?.formApiModel)?.map(r=>r.formApiModel));this._formApiModel||(this._formApiModel=s),this._formApiModel.length||this._host?.formApiModel?.setControl(this._hostAttributeName,s)}else this._formApiModel.clear({emitEvent:!1}),this.filter(s=>s?.formApiModel).forEach(s=>{this._formApiModel.push(s.formApiModel,{emitEvent:!1})}),e?.emitEvent!==!1&&this._formApiModel.updateValueAndValidity()}_updateFormApiModelPristineState(){const e=this.formApiModel.pristine,t=this.some(s=>s?.formApiModel?.dirty);if(t&&e){this.formApiModel.markAsDirty();return}!t&&!e&&this.formApiModel.markAsPristine()}_reload(e){const t=()=>{for(const n of[...this._deletedItems,...this])this.removeChildModel(n,{triggerNotification:!1});this._model?.childrenChange();const s=[],r=n=>s.push(n.destroy());return this._createdItems.forEach(r),this._createdItems.splice(0,this._createdItems.length),this._deletedItems.forEach(r),this._deletedItems.splice(0,this._deletedItems.length),this.forEach(r),this.splice(0,this.length,...e),(0,o.forkJoin)(s).pipe((0,l.defaultIfEmpty)(void 0),(0,l.map)(()=>{}))};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.reload",()=>t()):t()}_unregisterCallbackByAction(e,t){if(!this._onCollectionChangeCallbacksMap.get(e).find(n=>n===t))return!1;const r=this._onCollectionChangeCallbacksMap.get(e).filter(n=>n!==t);return this._onCollectionChangeCallbacksMap.set(e,r),!0}_safeExecuteCallback(e,t,s){const r=()=>{try{e(t)}catch(n){console.error(`An error occurred during execution of collection ${s} callback:`,n)}};if(this._ngZone){this._ngZone.run(r);return}r()}registerOnCollectionChangeCallback(e,t){const s=this._onCollectionChangeCallbacksMap.get(t);if(t&&!s)throw new Error(`Action type ${t} is not supported. Please use one of: ${Object.values(Q).join(", ")} or empty value for all actions`);if(t){const r=[...s,e];this._onCollectionChangeCallbacksMap.set(t,r);return}this._onCollectionChangeCallbacksMap.forEach((r,n)=>{const a=[...r,e];this._onCollectionChangeCallbacksMap.set(n,a)})}unregisterOnCollectionChangeCallback(e,t){if(t){if(!this._unregisterCallbackByAction(t,e))throw new Error("The provided callback is not registered.");return}if(![...this._onCollectionChangeCallbacksMap.keys()].map(r=>this._unregisterCallbackByAction(r,e)).some(r=>r))throw new Error("The provided callback is not registered.")}registerOnItemAttributesChangesCallback(e){this._onItemAttributesChangesCallbacks.push(e)}unregisterOnItemAttributesChangesCallback(e){if(!this._onItemAttributesChangesCallbacks.includes(e))throw new Error("The provided callback is not registered.");this._onItemAttributesChangesCallbacks=this._onItemAttributesChangesCallbacks.filter(t=>t!==e)}removeChildModel(e,t){const s=t?.triggerNotification??!0,r=this._model?.name,n=e.getModelByName(r);this._model?.removeChild(n),s&&this._model?.childrenChange()}copyWithin(e,t,s){const r={collection:[],affectedElements:this.slice(t,s),action:Q.Move,index:e};return this._triggerChangesAfter(()=>super.copyWithin(e,t,s),r)}fill(e,t,s){const r=s??this.length-1-(t??0),n={collection:[],affectedElements:new Array(r).fill(e),action:Q.Add,index:t};return this._triggerChangesAfter(()=>super.fill(e,t,s),n)}push(...e){const t={collection:[],affectedElements:[...e],action:Q.Add,index:this.length};return this._triggerChangesAfter(()=>super.push(...e),t)}reverse(){const e={collection:[],affectedElements:this.slice(),action:Q.Add,index:0};return this._triggerChangesAfter(()=>super.reverse(),e)}shift(){const e={collection:[],affectedElements:this.length?[this[0]]:[],action:Q.Remove,index:0};return this._triggerChangesAfter(()=>super.shift(),e)}sort(e){const t={collection:[],affectedElements:this.slice(),action:Q.Move};return this._triggerChangesAfter(()=>super.sort(e),t)}splice(e,t,...s){const r=typeof t=="number"?t:this.length-e,n=r>0?this.slice(e,e+r):[],a=n.length>0,u={collection:[],affectedElements:a?n:[...s],action:a?Q.Remove:Q.Add,index:e};return this._triggerChangesAfter(()=>super.splice(e,t,...s),u)}pop(){const e=this.length?this.length-1:void 0,t={collection:[],affectedElements:e!==void 0?[this[e]]:[],action:Q.Remove,index:e};return this._triggerChangesAfter(()=>super.pop(),t)}unshift(...e){const t={collection:[],affectedElements:[...e],action:Q.Add,index:0};return this._triggerChangesAfter(()=>super.unshift(...e),t)}getChangedItems(){const e=[...this._deletedItems];return this.filter(s=>{if(s.attributes.IsChanged)return!0;const r=s.getPrimaryModelMode();return r&&r!==D.Update}).concat(e)}createItem(e){var t=this;const s=function(){var r=(0,S.A)(function*(){const n=yield t._generateItem(e||{});t._insertItem(n,e?.index);const a={collection:[...t],affectedElements:[n],action:Q.Add,index:t.indexOf(n)};return t._executeChangesCallbacksWhenReady(a),n});return function(){return r.apply(this,arguments)}}();return this._measurePerformanceService?this._measurePerformanceService.measureCallback("ViewModelCollection.createItem",()=>s()):s()}getPrimaryAttributeValues(){return Promise.all(this.map(e=>e?.[e?.primaryAttributeName]))}findByPrimaryAttribute(e){var t=this;return(0,S.A)(function*(){for(const s of t)if(yield t._isItemPrimaryAttributeEqual(s,[e]))return s})()}filterByPrimaryAttributes(e){var t=this;return(0,S.A)(function*(){const s=[];for(const r of t)(yield t._isItemPrimaryAttributeEqual(r,e))&&s.push(r);return s})()}merge(e){const t=()=>{this._triggerChangesAfter(()=>{const s=this._mergeItems([...this],e),r=s.length>this.length;super.splice(0,this.length,...s),this._createdItems.splice(0,this._createdItems.length),e instanceof ft&&this._mergeItems(this._deletedItems,e._deletedItems);const n={collection:[...this],affectedElements:e,action:r?Q.Add:Q.Reload};this._executeChangesCallbacksWhenReady(n)})};return this._measurePerformanceService?this._measurePerformanceService.measure("ViewModelCollection.merge",()=>t()):t()}reload(e,t=Q.Reload){const s=[...this],r={collection:[],affectedElements:t===Q.Reload?[...e]:s,action:t};return(0,o.lastValueFrom)(this._reload(e).pipe((0,l.finalize)(()=>this._executeChangesCallbacksWhenReady(r))))}remove(e){const[t,s]=typeof e=="number"?[e,this[e]]:[this.indexOf(e),e];if(t>=0&&t<this.length){this.splice(t,1);const r={collection:[],affectedElements:[s],action:Q.Remove,index:t};return this._executeChangesCallbacksWhenReady(r),(0,o.lastValueFrom)(s.destroy())}return Promise.resolve()}clear(){return this.reload([],Q.Remove)}moveTo(e,t){if(t>=this.length)throw new jn("Target index cannot be greater than collection length");const s=this.indexOf(e);if(s===t||t<0)return;const r={collection:[],affectedElements:[e],action:Q.Move,index:t};this._triggerChangesAfter(()=>super.splice(t,0,super.splice(s,1)[0]),r)}destroy(){this._isDestroyed=!0,this._host=null,this._onCollectionChangeCallbacksMap=this._getNewCallbacksMap(),this._onItemAttributesChangesCallbacks=[];const e=this._reload([]);return this._formApiModel.clear({emitEvent:!1}),this._itemAttributeChanged.complete(),this._itemsChanged.complete(),this._destroyed$.next(),this._destroyed$.complete(),(0,o.lastValueFrom)(e)}}var Ti;(function(i){i.Readonly="READONLY_PROPERTY",i.Disabled="DISABLED_PROPERTY"})(Ti||(Ti={}));const lm="DataValueType";class Ni extends Ol{get propertiesConfig(){return[{name:"visible",defaultValue:!0},{name:"displayColor"},{name:"required",typeName:"crt.Required",defaultValue:!1}]}get formControl(){return this._formControl||(this._formControl=new Fe.FormControl(this.value),this._subscribeOnFormControl(this._formControl)),this._formControl}set formControl(e){this._formControl=e,this._subscribeOnFormControl(this._formControl)}get properties(){return this._properties}get onPropertyChanged(){return this._onPropertyChanged}get visible(){return this.getPropertyByName("visible").getValue()}set visible(e){const t=this.getPropertyByName("visible");t.value=e}get required(){return this.getPropertyByName("required").getValue()}set required(e){const t=this.getPropertyByName("required");t.value=e}get displayColor(){return this.getPropertyByName("displayColor").getValue()}set displayColor(e){const t=this.getPropertyByName("displayColor");t.value=e}get isDirty(){return this.formControl.dirty}constructor(e=null,t,s=null,r=!1,n="",a=[],u,d,p,g){super(n,e),this._featureValues=t,this.validationState=s,this.disabled=r,this._subscription=new o.Subscription,this._appliedValidatorsCache=new Map,this._onPropertyChanged=new c.EventEmitter,this._crtControlStateAdapter=u,this._validatorTypeResolver=d,this._injectionContext=g,this._initProperties(a),this._subscribeOnPropertiesEvents(),this._initializeValidators(p??[],!0)}_subscribeOnFormControl(e){this._formControlSubscription?.unsubscribe(),this._formControlSubscription=e.valueChanges.pipe((0,l.startWith)(e.value),(0,l.distinctUntilChanged)((t,s)=>this.areValuesEqual(t,s))).subscribe(t=>{this.setValue(t)})}_initProperties(e){const t=[...this.propertiesConfig,...e];this._properties=new Map,t.forEach(s=>{const r=kl.create({typeName:s.typeName,name:s.name,value:s.defaultValue,locked:s.locked===!0,validatorTypeResolver:this._validatorTypeResolver,injectionContext:this._injectionContext});this._properties.set(s.name,r)})}_subscribeOnPropertyEvents(e){this._subscription.add(e.onChanged.subscribe(({name:t,value:s,oldValue:r})=>{this.onPropertyChanged.emit({name:t,value:s,oldValue:r})})),this._subscription.add(e.onValidatorChanged.subscribe(()=>{this._refreshValidators()}))}_subscribeOnPropertiesEvents(){this.properties.forEach(e=>{this._subscribeOnPropertyEvents(e)})}_initializeValidators(e,t=!1){this._validatorInfo=e,this._properties.forEach(s=>{this._validatorInfo=s.initializeValidator(this._validatorInfo,t)}),this._refreshValidators()}_useValidatorsMerging(){return!this._featureValues.DisableControlValidatorsMerging}_getEnabledValidatorFns(e=!1){return this._validatorInfo.filter(t=>!t.disabled&&t.instance.isAsync===e).map(t=>{if(this._useValidatorsMerging()){const r=this._appliedValidatorsCache.get(t.name);if(r)return r.validatorFn}const s=this._crtControlStateAdapter.transform(t);return this._useValidatorsMerging()&&this._appliedValidatorsCache.set(t.name,{validatorInfo:t,validatorFn:s}),s})??[]}_mergeValidators(e,t){for(const s of this._appliedValidatorsCache.values())if(s.validatorInfo.instance.isAsync){const n=s.validatorFn;t.includes(n)?this.formControl.hasAsyncValidator(n)||this.formControl.addAsyncValidators(n):this.formControl.removeAsyncValidators(n)}else{const n=s.validatorFn;e.includes(n)?this.formControl.hasValidator(n)||this.formControl.addValidators(n):this.formControl.removeValidators(n)}}_refreshValidators(){const e=this._getEnabledValidatorFns(),t=this._getEnabledValidatorFns(!0);this._useValidatorsMerging()?this._mergeValidators(e,t):(this.formControl.setValidators(e),this.formControl.setAsyncValidators(t)),this.formControl.updateValueAndValidity()}_updateValidator(e,t=!1){const s=this._validatorInfo.find(r=>r.name===e);if(!s)throw new Error(`Validator ${e} does not exist on ${this.name} attribute.`);s.disabled!==t&&(s.disabled=t,this._refreshValidators())}findPropertyByName(e){return this.properties.has(e)?this.properties.get(e):null}static create(e){return new Ni(e.value,e.featureValues,null,!1,e.name,e.propertiesConfig??[],e.crtControlStateAdapter,e.validatorTypeResolver,e.validatorsInfo,e.injectionContext)}setValue(e,t){const s=this.formControl;this.areValuesEqual(e,s.value)||(s.dirty||s.markAsDirty(),s.setValue(e,{onlySelf:!!t})),super.setValue(e,t)}enableValidator(e){this._updateValidator(e,!1)}disableValidator(e){this._updateValidator(e,!0)}change(e){this.setValue(e)}getPropertyByName(e,t=!1){let s=this.findPropertyByName(e);return!s&&t&&(s=new jo(e,null,this._validatorTypeResolver,this._injectionContext),this._properties.set(e,s),this._subscribeOnPropertyEvents(s)),s}hasPropertyValue(e){return!!this.getPropertyByName(e)}getPropertyValue(e){const t=this.getPropertyByName(e);return t?t.getValue():null}setPropertyValue(e,t,s=!1){this.getPropertyByName(e,!0).setValue(t,s)}setPropertyInitialValue(e,t){this.getPropertyByName(e,!0).setInitialValue(t)}getPropertyInitialValue(e){return this.getPropertyByName(e)?.initialValue}getValue(){return this._formControl?this._formControl.value:super.getValue()}destroy(){this._formControlSubscription?.unsubscribe(),this._subscription.unsubscribe()}getInvariabilityPropertyName(){const e=this.getPropertyValue(Ti.Readonly),t=this.getPropertyValue(Ti.Disabled);return e??t}toggle(e){const t=this.getInvariabilityPropertyName(),s=this.getPropertyByName(t);s&&(e?s.resetPending():s.setPending(!0))}}function uf(i){const e=i;return e?!!e?.modelConfig||!!e?.embeddedModel||!!e?.value:!1}function Gl(i){const e=i;return e?!!e.from||!!e.triggers||!!e.converter:!1}const dm=_(85088);class yn{sort(e,t){const s=[];let r=[];Object.entries(e||{}).forEach(([a,u])=>{if(Gl(u)){let d=u.from;d=Array.isArray(d)?d:[d];const p=d.map(g=>[a,g]);r=r.concat(p)}else s.push(a)});const n=dm(r).reverse();return[...s,...n].filter(Boolean).filter((a,u,d)=>d.indexOf(a)===u).map(a=>{const u=n.includes(a)?e[a]??t[a]:e[a];return[a,u]})}static{this.\u0275fac=function(t){return new(t||yn)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:yn,factory:yn.\u0275fac,providedIn:"root"})}}class bn{constructor(e,t,s,r,n,a,u){this._crtControlStateAdapter=e,this._validatorTypeResolver=t,this._viewModelGenerator=s,this._attributeCreator=r,this._viewModelRepository=n,this._attributesTopologicalSorting=a,this._injector=u,this._featureValues=this._injector.get(F,null,{optional:!0}),this._measurePerformanceService=this._injector.get(te.g)}_generateAttributes(e,t,s){const r=this._attributesTopologicalSorting.sort(t,e._attributeConfigs);return Promise.all(r.map(([n,a])=>e._systemAttributes.includes(n)?(console.warn(`Overriding of system attributes is denied. Attribute name:"${n}"`),Promise.resolve()):(s.disableDefaultConfig||(a??={}),e._attributeConfigs[n]=a,a?"viewModelConfig"in a||"viewModelName"in a?a.isCollection?this._generateNestedModelCollectionAttribute(e,n,a,s):this._generateNestedModelAttribute(e,n,a,s):Gl(a)?this._generateCalculatedAttribute(e,n,a,s):this._generateModelAttribute(e,n,a,s):this._removeViewModelAttribute(e,n))))}_generateNestedModelCollectionAttribute(e,t,s,r){var n=this;return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedCollectionAttribute.${t}`,(0,S.A)(function*(){const a=e.getBoundDataSourceNameByAttributePath(t),u=e.getModelByName(a),d="viewModelConfig"in s?s.viewModelConfig:yield(0,o.lastValueFrom)(n._viewModelRepository.resolveModelConfig(s.viewModelName)),p=new ft(n._viewModelGenerator,d,u,e,t);n._registerOrSetFormControl(e.formApiModel,t,p.formApiModel);const g=e.attributes[t];e.attributes[t]=p,n._defineNestedModelAttribute(e,t,s,r),n._subscribeOnCollectionChanged(e,t,p,r),g!==void 0&&r.onChangeAttributeValue(t,p,g)}))}_defineNestedModelAttribute(e,t,s,r){const n=u=>{const d=e.attributes[t];e.attributes[t]=u,d instanceof ft&&u instanceof ft&&this._subscribeOnCollectionChanged(e,t,u,r),r.onChangeAttributeValue(t,u,d)},a=()=>e.attributes[t];Xs.defineAsyncAttribute(e,t,s,a,n)}_generateNestedModelAttribute(e,t,s,r){return this._measurePerformanceService.measureCallback(`BaseViewModelAttributeGenerator.nestedModelAttribute.${t}`,()=>{const n="viewModelConfig"in s?s.viewModelConfig:s.viewModelName,a=e?.[ht];return(0,o.lastValueFrom)(this._viewModelGenerator.generate({viewModelConfig:n,parentViewModel:e},a?c.Injector.create({providers:[{provide:Ai,useValue:null}],parent:a}):null).pipe((0,o.map)(u=>{this._registerOrSetFormControl(e.formApiModel,t,u.formApiModel);const d=e.attributes[t];e.attributes[t]=u,this._defineNestedModelAttribute(e,t,s,r),d!==void 0&&r.onChangeAttributeValue(t,u,d)})))})}_subscribeOnCollectionChanged(e,t,s,r){if(e._collectionSubscription.has(t)){const a=e._collectionSubscription.get(t);a.unsubscribe(),e._subscriptions.remove(a)}const n=new o.Subscription;n.add(s.changed.subscribe(()=>{r.onChangeAttributeValue(t,s,null)})),n.add(s.itemAttributeChanged.subscribe(()=>{r.onChangeAttributeValue(t,s,null)})),e._collectionSubscription.set(t,n),e._subscriptions.add(n)}_generateCalculatedAttribute(e,t,s,r){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateCalculatedAttribute.${t}`,()=>{this._attributeCreator.create(El,e?.[ht])?.defineAttribute({viewModel:e,attribute:t,attributeConfig:s,generateOptions:r})})}_getCrtControlPropertiesConfig(e,t,s){const r=Object.entries(s.properties??[]).map(([n,a])=>({name:n,defaultValue:a.defaultValue,locked:a.locked===!0}));return this._addDataValueTypePropertyConfig(r,s),this._addMaskedPropertyConfig(e,t,r,s),this._disableSystemAttributes(e,t,r),r}_addDataValueTypePropertyConfig(e,t){t.dataValueTypeName&&e.push({name:lm,defaultValue:A.r[t.dataValueTypeName]})}_addMaskedPropertyConfig(e,t,s,r){this._isNotAllowMaskedPropertyConfig(e,t,r)||(r.isValueMasked=!0,this._getOrCreatePropertyConfig(s,ln),this._getOrCreatePropertyConfig(s,Mi),this._getOrCreatePropertyConfig(s,Ri))}_isNotAllowMaskedPropertyConfig(e,t,s){const n=e.getBoundDataSchemaAttributeByAttributePath(t)?.isValueMasked,a=s.isValueMasked;return n&&a===!1||!n&&!a}_disableSystemAttributes(e,t,s){if(this._featureValues?.DisableBlockingSystemColumns===!0)return;if(e.getBoundDataSchemaAttributeByAttributePath(t)?.isSystem){const n=this._getOrCreatePropertyConfig(s,"readonly");n.locked=!0,n.defaultValue=!0}}_getOrCreatePropertyConfig(e,t){let s=this._findPropertyConfigByName(e,t);return s||(s={name:t},e.push(s)),s}_findPropertyConfigByName(e,t){return e.find(s=>s.name===t)}_generateModelAttribute(e,t,s,r){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.generateModelAttribute.${t}`,()=>{const n=e.attributes[t],a=s?.value,u=this._getCrtControlPropertiesConfig(e,t,s),d=Ni.create({name:t,value:a,crtControlStateAdapter:this._crtControlStateAdapter,validatorTypeResolver:this._validatorTypeResolver,validatorsInfo:e._validators[t],propertiesConfig:u,injectionContext:e._injectionContext??Ci(e)?._injectionContext,featureValues:this._featureValues});e._subscriptions.add(d.onChanged.subscribe(C=>{e.attributes[t]=C.value,r.onChangeAttributeValue(C.name,C.value,C.oldValue)})),e._subscriptions.add(d.onPropertyChanged.subscribe(({name:C,value:I,oldValue:W})=>{r.onChangeAttributeValue(`${t}:${C}`,I,W)})),e._crtControls.set(t,d),this._registerOrSetFormControl(e.formApiModel,t,d.formControl),e.attributes[t]=a??null;const p=e._getDataSourceAttributeDataValueType(t);this._attributeCreator.create(p).defineAttribute({viewModel:e,attribute:t,attributeConfig:s,control:d}),n!==void 0&&r.onChangeAttributeValue(t,a,n)})}_registerOrSetFormControl(e,t,s){this._measurePerformanceService.measure(`BaseViewModelAttributeGenerator.registerOrSetFormControl.${t}`,()=>{if(this._featureValues?.DisableAttributeOnlyRegisteringControl){e.setControl(t,s);return}e.contains(t)?e.setControl(t,s):e.registerControl(t,s)})}_removeViewModelAttribute(e,t){return delete e._attributeConfigs[t],delete e.attributes[t],delete e[t],Promise.resolve()}generate(e,t,s){var r=this;return this._measurePerformanceService.measureCallback("BaseViewModelAttributeGenerator.generateAttributes",()=>Xs.deferUpdatingValueAndValidity(e,(0,S.A)(function*(){yield r._generateAttributes(e,t,s),!r._featureValues?.DisableAttributeOnlyRegisteringControl&&e.formApiModel.updateValueAndValidity()}),this._featureValues))}static{this.\u0275fac=function(t){return new(t||bn)(c.\u0275\u0275inject(ss),c.\u0275\u0275inject(vi),c.\u0275\u0275inject(ns),c.\u0275\u0275inject(Dl),c.\u0275\u0275inject(rs),c.\u0275\u0275inject(yn),c.\u0275\u0275inject(c.Injector))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:bn,factory:bn.\u0275fac,providedIn:"root"})}}class Sn{_defineResourceAttribute(e,t,s,r,n){return new o.Observable(a=>{const u=e._getDataSourceAttributeCaption(r,n);if(this._defineResourceProperty(t,s,u),r.includes(".")){const d=r.split(".")[1];this._defineResourceProperty(t,d,u)}a.next(),a.complete()})}_defineResourceProperty(e,t,s){e[t]||Object.defineProperty(e,t,{get:()=>Promise.resolve(s??""),configurable:!0})}_getResourceNameByPath(e){const t=e.split(".");return t.length>1?t.join("_"):e}generate(e,t){return Object.entries(t||{}).map(([s,r])=>{const n=e[on][Bs.string],a=this._getResourceNameByPath(s);return this._defineResourceAttribute(e,n,a,s,r)})}static{this.\u0275fac=function(t){return new(t||Sn)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Sn,factory:Sn.\u0275fac,providedIn:"root"})}}const xi="HasUnsavedData",Cn="IsChanged",Nc="PrimaryModelMode",xc="BusinessRulesActivated",Vi="State";var Vc;(function(i){i.Paused="Paused",i.Active="Active"})(Vc||(Vc={}));class An{constructor(e,t,s){this._sysSettingsService=e,this._dataSchemaRepository=t,this._featureValues=s,this._searchComparisonTypeSysSettingCode="StringColumnSearchComparisonType"}_getParameterValue(e,t,s){if(typeof t=="string"){if(t.startsWith("@requestPayload")){const r=t.replace("@requestPayload.","");return(0,P.get)(s,r)}if(t.startsWith("$"))return e.attributes[t.substring(1)];if(e.attributes[t])return e.attributes[t]}return t}_applyFilterMacros(e,t){let s=null;switch(typeof t){case"object":s=JSON.stringify((0,de.classToPlain)(t));break;case"string":s=t;break;default:return t}const r=/##ViewModelMacro\.\$([^#]+)##/g;let n=!1;return[...s.matchAll(r)].forEach(a=>{const u=a[1],d=(0,P.get)(e.attributes,u);let p=d?.toString();typeof d=="object"&&(n=!0,p=JSON.stringify(d)),s=s.replace(a[0],p)}),typeof t=="object"||n?JSON.parse(s):s}_createPrimaryDisplayColumnValueFilter(e){var t=this;return(0,S.A)(function*(){const s=t._searchComparisonTypeSysSettingCode,n=(yield t._sysSettingsService.getByCode(s))?.value===1?ne.Contain:ne.Start_with;return{type:B.PrimaryDisplayValueFilter,value:e,comparisonType:n}})()}_createColumnValueFilter(e,t,s){const r=t;return Promise.resolve({type:B.ColumnValue,value:{attributePath:r.attributePath,attributeValue:this._getParameterValue(e,r.attributeValue,s)}})}_getOwnLoadParameters(e,t){return e.getModelByName(t)?.getOwnLoadParameters()}_getDataSourceFilteringParameters(e,t){return(0,S.A)(function*(){const r=e._dataSourcesInfos.get(t).getFilteringConfig();return e._checkFilteringAttributes(t,r),r.length?(yield Promise.all(r.map(a=>e[a.name]))).map(a=>({type:B.Filter,value:a})):Promise.resolve([])})()}_getDataSourceOwnFilteringParameters(e,t){return this._getOwnLoadParameters(e,t)?.parameters??[]}_getPrimaryAttributeName(e,t){var s=this;return(0,S.A)(function*(){if(!t)return null;let r=Object.values(e.dataSchemas).find(n=>n.name===t);return r||(r=yield(0,o.lastValueFrom)(s._dataSchemaRepository.get(t))),r?.primaryAttributeName})()}_getParameterRelationsConfigs(e){return e.relationsConfigs||[]}_createRelationParameter(e,t){const s={...e},r=this._getParameterRelationsConfigs(s);return s.relationsConfigs=[{dataSchemaName:t.dataSchemaName,attributePath:t.attributePath,relationPath:t.relationPath},...r],s}_validateAllowedRelations(e,t,s){const n=s?.relationPath?.split(".")?.shift(),a=e.dataSchemas[t],u=a?.findAttributeByName(n);if(a&&u&&a.primaryAttributeName!==n&&u.dataValueType!==A.r.Lookup&&!this._featureValues.DataSourceAllowRelationsByNonLookupColumn){const d="Filtration of data sources by page data is currently supported by lookup and primaryAttribute fields only",p=new Error(`${d}, please see the console for more details`);throw p.stack=`${d} , data source name: ${t}, relation config: ${JSON.stringify(s)}`,p}}_createRelationParameterWithAttributeValue(e,t,s,r){var n=this;return(0,S.A)(function*(){const a={...s},u=n._getParameterRelationsConfigs(a),d=e.dataSchemas[t],p=r.relationPath.split("."),g=p.shift(),C=d.findAttributeByName(g);if(C.dataValueType!==A.r.Lookup&&(n._featureValues.DataSourceAllowRelationsByNonLookupColumn||d.primaryAttributeName===g))return a.type=B.ColumnValue,a.value={attributePath:r.attributePath,attributeValue:r.value},a.relationsConfigs=u,a;const I={dataSchemaName:r.dataSchemaName,attributePath:r.attributePath,relationPath:r.relationPath};a.value=r.value,a.type=B.PrimaryColumnValue,d.primaryAttributeName!==g&&(I.dataSchemaName=C.referenceSchemaName);const W=d.type!==Ss.Entity?I.dataSchemaName:r.dataSchemaName;return I.relationPath=p.length===0?yield n._getPrimaryAttributeName(e,W):p.join("."),a.relationsConfigs=[I,...u],a})()}_convertToRelationParameters(e,t,s,r){var n=this;return(0,S.A)(function*(){const a=[];n._validateAllowedRelations(e,t,r);for(const u of s){const d=r.useAttributeValue?yield n._createRelationParameterWithAttributeValue(e,t,u,r):n._createRelationParameter(u,r);a.push(d)}return a})()}_getRelationParameters(e,t,s){var r=this;return(0,S.A)(function*(){const n=e._modelDependencies[t]||[];if(n.length===0)return Promise.resolve([]);const a=n.map(p=>r.getLoadParametersByRelation(e,p,t,s)),d=(yield Promise.all(a)).flat();return r._featureValues.DisableDsDepsJoinOptimization?d:r._selectOptimizedParametersForJoin(d)})()}_getPagingConfigRowCount(e,t,s,r){return typeof t=="string"&&(t=(0,P.isNil)(e.attributes[t])?0:e.attributes[t]),r&&(!t||t+s>r)&&(t=r-s),t}_getPagingConfigRowsOffset(e,t,s,r){const n=e._dataSourcesInfos.get(r).collectionViewModelAttributeName,a=e.attributes[n]?.length??0;if(typeof t=="number")throw new Error("Rows offset parameter cannot be set to number");return!t&&s===he.LoadNext?a:!t&&s===he.Reload?0:(e.attributes[t]=(0,P.isNil)(e.attributes[t])?0:e.attributes[t],s===he.Reload?e.attributes[t]:e.attributes[t]+a)}_getModelPagingConfig(e,t,s,r){if(!t){const u=this._getOwnLoadParameters(e,r);return Promise.resolve(u?.options?.pagingConfig??null)}const n=this._getPagingConfigRowsOffset(e,t.rowsOffset,s,r),a=this._getPagingConfigRowCount(e,t.rowCount,n,t.rowsLimit);return Promise.resolve({rowCount:a,rowsOffset:n})}_mergeSorting(e,t){return(0,P.unionBy)(e??[],t??[],"columnName")??null}_getModelSortingConfig(e,t,s){var r=this;return(0,S.A)(function*(){const a=r._getOwnLoadParameters(e,s)?.options?.sortingConfig,u=t?.attributeName;if(!u||!e.attributes[u])return a?Promise.resolve(a):Promise.resolve(null);const d=yield Promise.all(e.attributes[u].map(function(){var p=(0,S.A)(function*(g){return{columnName:yield g.columnName,direction:yield g.direction}});return function(g){return p.apply(this,arguments)}}()));return{columns:r._mergeSorting(d,a?.columns)}})()}_getHierarchyFilterAttributeValues(e,t){return(0,S.A)(function*(){if(!t?.length)return Promise.resolve(null);let s;for(const r of t){const n=yield e[r.name];if(!n)continue;const a=typeof n=="string"?me.fromJson(JSON.parse(n),Es):"filters"in n?n:me.fromJson(n,Es);a&&(s?a.filters.forEach(u=>{s.add(u)}):s=a)}return s?.filters?.size>0?s:null})()}_getHierarchyColumnValue(e,t){return(0,S.A)(function*(){if(!t)return Promise.resolve(null);const s=yield e[t];return(typeof s=="string"?s:s?.value)??null})()}_getModelHierarchyConfig(e,t,s,r){var n=this;return(0,S.A)(function*(){const a={},d=n._getOwnLoadParameters(e,s)?.options?.hierarchyConfig;if(!d||!d.hierarchicalFullDataLoad)return Promise.resolve(null);const p=yield n._getHierarchyFilterAttributeValues(r,t?.hierarchicalFilterAttributes),g=yield n._getHierarchyColumnValue(r,t?.hierarchicalColumnValueAttributeName);return a.hierarchicalFullDataLoad=d.hierarchicalFullDataLoad,a.hierarchicalColumnName=d.hierarchicalColumnName,a.hierarchicalMaxDepth=d.hierarchicalMaxDepth,a.hierarchicalColumnValue=g??null,a.hierarchicalColumnFiltersValue=p??null,Promise.resolve(a)})()}_updateLastEventLoadParameters(e,t,s,r){s&&s.length!==0?e._lastEventLoadParameters.set(t,s):r!==!0&&e._lastEventLoadParameters.set(t,[{type:B.Empty,value:""}])}_getModelLoadParameters(e,t,s,r,n,a,u){var d=this;return(0,S.A)(function*(){const p=yield d.getModelParameters(e,s,r);a!==!0&&d._updateLastEventLoadParameters(e,t,p,n);const g=n!==!0?p:e._lastEventLoadParameters.get(t)||[{type:B.Never,value:""}],[C,I,W]=yield Promise.all([d._getDataSourceFilteringParameters(e,t),d._getDataSourceOwnFilteringParameters(e,t),d._getRelationParameters(e,t,u)]);return[...g,...I,...C,...W]})()}_selectOptimizedParametersForJoin(e){if(e.every(({type:a})=>a===B.Empty))return e;const s=e.filter(({type:a,value:u})=>a!==B.Empty&&(a!==B.Filter||!!u)),r=e.filter(({type:a,relationsConfigs:u})=>a===B.Empty&&u?.length);if(!r.length)return s;const[n]=[...r].sort((a,u)=>u.relationsConfigs.length-a.relationsConfigs.length);return[...s,n]}getLoadParametersByRelation(e,t,s,r){var n=this;return(0,S.A)(function*(){const a=t.relationPath.split("."),u=a.shift(),d=e.dataSchemas[u],p={dataSchemaName:d.name,attributePath:t.attributePath,relationPath:a.join(".")},g=a.shift(),I=e._dataSourcesInfos.get(u).getMappedAttributeNames(g)?.[0]??null,W=e.getModelMode(u),X=r?.[u]?.[p.relationPath];if(e.getModelByName(s)?.getAllowCopyingRecords()&&X)p.value=X,p.useAttributeValue=!0;else{const kc=e.getIsDirty(I)||W===D.Create||W===D.Copy||d.type!==Ss.Entity;if(I&&kc){p.useAttributeValue=!0;const ye=e.attributes[I];if(p.value=ye?.value?ye.value:ye,p.value)return n._validateAllowedRelations(e,u,p),Promise.resolve([{type:B.ColumnValue,value:{attributePath:p.attributePath,attributeValue:p.value},relationsConfigs:[]}])}}const In=yield n._getModelLoadParameters(e,u,null,null,!0,!1);return n._convertToRelationParameters(e,u,In,p)})()}getModelParameters(e,t,s){if(s?.parameters&&(t=[...t,...s.parameters]),!t||t.length===0)return Promise.resolve([]);const r=t.map(n=>{switch(n.type){case B.PrimaryColumnValue:return Promise.resolve({type:n.type,value:this._getParameterValue(e,n.value,s)});case B.Filter:return Promise.resolve({type:n.type,value:this._applyFilterMacros(e,n.value)});case B.PrimaryDisplayValueFilter:return this._createPrimaryDisplayColumnValueFilter(this._getParameterValue(e,n.value,s));case B.ColumnValue:return this._createColumnValueFilter(e,n.value,s)}});return Promise.all(r)}getModelLoadParameters(e,t,s,r=he.Load,{payload:n,useLastLoadParameters:a,doNotUpdateLastLoadParameters:u,modelLoadConfiguration:d}={}){const p=t.name,g=r??he.Load,C=g===he.Load?null:t.getPagingConfig(),I=t.getSortingConfig(),W=t.getHierarchyConfig();return Promise.all([this._getModelLoadParameters(e,p,s,n,a,u,d),this._getModelPagingConfig(e,C,g,p),this._getModelSortingConfig(e,I,p),this._getModelHierarchyConfig(e,W,p,e)])}static{this.\u0275fac=function(t){return new(t||An)(c.\u0275\u0275inject(De),c.\u0275\u0275inject(ct),c.\u0275\u0275inject(F))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:An,factory:An.\u0275fac,providedIn:"root"})}}class gt{get attributesMap(){return this._attributesMap}get mappedViewModelAttributes(){return this._mappedViewModelAttributes}get isCollection(){return this._isCollection}get collectionViewModelAttributeName(){return this._collectionViewModelAttributeName}constructor(e){this._attributesMap=new Map,this._mappedViewModelAttributes=new Set,this.attributes=[],this.includePrimaryAttributes=!0,this.name=e}static _getDataSourceInfo(e,t){if(!e.has(t)){const s=new gt(t);return e.set(t,s),s}return e.get(t)}static _extractViewModelAttributeMapInfo(e){const t=e.split(".");return{dataSourceName:t.shift(),dataSourceAttributePath:t.join(".")}}static _getByDefaultAttribute(e,t,s,r=""){const n=t.modelConfig;if(!n||!n.path)return;const a=this._extractViewModelAttributeMapInfo(n.path);if(!a.dataSourceAttributePath){this._getByViewModelCollectionAttribute(e,t,s);return}if(r&&r!==a.dataSourceName)throw new Error(`Attribute '${e}' mapped on a few DataSources`);const u=this._getDataSourceInfo(s,a.dataSourceName),d=n.aggregationConfig?.aggregationFunction?_l(a.dataSourceAttributePath):a.dataSourceAttributePath;u.attributes.push({path:d,type:n.type,functionConfig:n.functionConfig,aggregationConfig:n.aggregationConfig}),u._mappedViewModelAttributes.add(e),u._attributesMap.set(e,a.dataSourceAttributePath)}static _getByInlineViewModelAttribute(e,t,s,r=""){const n=t.viewModelConfig||{};Object.entries(n.attributes||{}).forEach(([a,u])=>{const d=`${e}.${a}`;this._processViewModelAttribute(d,u,s,r)})}static _getByViewModelCollectionAttribute(e,t,s){const r=t.modelConfig;if(!r||!r.path)return;const a=this._extractViewModelAttributeMapInfo(r.path).dataSourceName,u=this._getDataSourceInfo(s,a);u._isCollection=!0,u._collectionViewModelAttributeName=e,u._pagingConfig=r.pagingConfig,u._sortingConfig=r.sortingConfig,u._hierarchyConfig=r.hierarchyConfig,u._filteringConfig=r.filterAttributes,u.includePrimaryAttributes=r.includePrimaryAttributes===void 0?!0:r.includePrimaryAttributes;const d=t?.viewModelConfig;Object.entries(d?.attributes||{}).forEach(([p,g])=>{this._processViewModelAttribute(`${e}.${p}`,g,s,a)})}static _processViewModelAttribute(e,t,s,r=""){"viewModelConfig"in t||"viewModelName"in t?t.isCollection?this._getByViewModelCollectionAttribute(e,t,s):this._getByInlineViewModelAttribute(e,t,s,r):"from"in t||this._getByDefaultAttribute(e,t,s,r)}static getFromViewModelConfig(e,t=[]){const s=new Map;return Object.entries(e?.attributes||{}).forEach(([r,n])=>{this._processViewModelAttribute(r,n,s)}),t.filter(r=>!s.has(r.name)).forEach(({name:r})=>{const n=new gt(r);s.set(r,n)}),s}static getLookupListDataSourceInfo(e,t){const s=new gt("");return s._isCollection=!0,s._collectionViewModelAttributeName=e,Object.entries(t).forEach(([r,n])=>{s.attributes.push({path:n}),s._mappedViewModelAttributes.add(r),s._attributesMap.set(r,n)}),s}_getRowModelDto(e){const t=e.length>0?e[0]:{},s={};return Object.entries(t).forEach(([r,n])=>{this.getMappedAttributeNames(r).forEach(u=>{const d=u.split(".");this.isCollection&&d.length>1&&d.shift(),(0,P.set)(s,d.join("."),n)})}),s}_getCollectionModelDto(e){const t=this._collectionViewModelAttributeName,s=e.map(r=>this._getRowModelDto([r]));return{[t]:s}}getMappedAttributes(){return Array.from(this._mappedViewModelAttributes.values())}getMappedAttributeNames(e){return Array.from(this._attributesMap.entries()).filter(([,t])=>t===e).map(([t])=>t)}getDataSourceAttributePath(e){return this._attributesMap.has(e)?this._attributesMap.get(e):""}getIsMapOnCollection(e){return this._isCollection&&this._collectionViewModelAttributeName===e}getPagingConfig(){return this._pagingConfig}getSortingConfig(){return this._sortingConfig}getHierarchyConfig(){return this._hierarchyConfig}getFilteringConfig(){return this._filteringConfig||[]}getModelDto(e){return this._isCollection?this._getCollectionModelDto(e):this._getRowModelDto(e)}addNewAttribute(e,t,s){const r=new Map;r.set(this.name,this),gt._getByDefaultAttribute(e,t,r,s)}getIsDataSourceAttributePathExists(e){return this.attributes.find(t=>t.path===e)!==void 0}}class hm{}function pm(i,e){return Oc.apply(this,arguments)}function Oc(){return Oc=(0,S.A)(function*(i,e){const t=typeof e=="string"?e.split("."):e;let s=t.shift(),r=i;for(;s;)r=yield r[s],s=t.shift();return r}),Oc.apply(this,arguments)}const mm=500;class Ot{static{this._skippedProperties=["schedule","then"]}constructor(e,t,s,r,n,a,u,d){this.viewModelGenerator=e,this.injector=t,this.viewModelConfig=s,this.resources=r,this._eventScopes=a,this._modelsInitConfig=u,this._defaultPrimaryAttributeName="Id",this._models$=new o.BehaviorSubject([]),this._businessRulesActive=!0,this._dropdownPageSizeSettingsCode="DropdownPageSize",this._dataSourcesInfos=new Map,this._attributesToDataSourceNameMap=new Map,this._dropdownPageSize=null,this._replayEvents$=new o.ReplaySubject,this._loadedDataSources=new Set,this._conflictedModels=[],this.__destroyed=!1,this._disableViewModelWaitingForAsyncTasks=!1,this._disableViewModelLoadUnblockingThread=!1,this._blockFieldsAffectedByBusinessRules=!1,this._asyncTasksExecutingSubject=new o.BehaviorSubject(new Set),this._modelsRequestedToLoad=new Set,this._attributesAffectedByBusinessRules=[],this._businessRulesAreActivated=!1,this._destroySubject=new o.Subject,this._modelSourceRecordId={},this._modelLoadParametersSetted$=new o.Subject,this._modelsNamesWithParameters=new Set,this.saveModelTaskName="MODEL_SAVING",this._modelLoaded$=new o.Subject,this._viewModelAttributeChangeEventOptions=new tm({preventAttributeChangeRequest:!1,preventStateChange:!0,preventRunBusinessRules:!0}),this._dynamicModelNames=new Set,this._attributeConfigs={},this._eventsSubject$=new o.Subject,this._collectionSubscription=new Map,this._crtControls=new Map,this._subscriptions=new o.Subscription,this._destroy$=this._destroySubject.asObservable(),this._businessRulesActivated$=new o.BehaviorSubject(!1),this.attributes={},this.dataSchemas={},this.events$=(0,o.merge)(this._eventsSubject$,this._replayEvents$),this._systemAttributes=[],this.initDependencies(),this._subscribeModelsChanges(),this.handlerChain=Se.instance,n?this.formApiModel=n:this.formApiModel=this.formBuilder.group({}),this.parent=d;const p=this._appInfo?.isDebugEnabled?this._createProxy(this):this;return this._viewModelDataDelayerService&&!this.parent&&this._viewModelDataDelayerService.setViewModel(p),p}get models(){return this._models$.value}get IsChanged(){return Promise.resolve(this.attributes[Cn])}set IsChanged(e){}get HasUnsavedData(){return Promise.resolve(this.attributes[xi])}set HasUnsavedData(e){}set BusinessRulesActivated(e){}get BusinessRulesActivated(){return Promise.resolve(this._businessRulesAreActivated)}get _isChanged(){return console.warn("Warning: The `_isChanged` property of the view-model is deprecated. It will be removed in future versions. Use `IsChanged` or `HasUnsavedData` attribute instead."),Object.keys(this._attributeConfigs).filter(e=>!(0,P.isEmpty)(this._attributeConfigs[e].modelConfig)).some(e=>this.formApiModel.controls[e]?.dirty)}get _scopes(){return[...this._eventScopes??[]]}get _injectionContext(){return this._context}get[ht](){return this.injector}get primaryAttributeName(){if(!this._primaryModelName)return this._defaultPrimaryAttributeName in this._attributeConfigs?this._defaultPrimaryAttributeName:null;const t=this.dataSchemas[this._primaryModelName].primaryAttributeName,s=this._dataSourcesInfos.get(this._primaryModelName);return this._getMappedAttributeName(s,t)}get PrimaryModelMode(){return this.getPrimaryModelMode()}get State(){return Ci(this).attributes[Vi]}get _destroyed(){return this.__destroyed}get modelInitConfigs(){return this._modelsInitConfig}_createProxy(e){return new Proxy(e,{get(t,s){return!(typeof s=="string")||s in t||Ot._skippedProperties.includes(s)||console.debug(`Attribute ${s} not found.`),t[s]}})}_executeWithOptions(e,t){let s;try{return s=this._viewModelAttributeChangeEventOptions.getOptions(),this._viewModelAttributeChangeEventOptions.setOptions(t),e()}finally{this._viewModelAttributeChangeEventOptions.setOptions(s)}}_setSystemAttributeValue(e,t){const s=this.attributes[e];this.attributes[e]=t,this._executeWithOptions(()=>{this._fireChangeAttributeEvent({type:_e.ChangeAttributeValue,payload:{attributeName:e,oldValue:s,value:t}})},{preventStateChange:!0,preventRunBusinessRules:!0})}_fireChangeAttributeEvent(e){e.payload.silent??=this._viewModelAttributeChangeEventOptions.getAsSilent(),Object.assign(e.payload,this._viewModelAttributeChangeEventOptions.getOptions()),this._eventsSubject$.next(e)}_getViewModelValidators(e){const t=this.viewModelConfig.attributes[e]??{};return("validators"in t&&t.validators)??{}}_initDataSourceValidators(){return this._measurePerformanceService?.measure(`ViewModel.initDataSourceValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._validators={},this._dataSourcesInfos.forEach(e=>{e.attributesMap.forEach((t,s)=>{const r=this.viewModelConfig.attributes[s]??{};if("modelConfig"in r&&r.modelConfig?.ignoreValidators)return;this._validators[s]=this._validators[s]||[];const n=this._getDataSourceAttributeSchema(e,t);if(n?.validators){for(const[a,u]of Object.entries(n.validators))if(u?.type){const d=this._injectionContext??Ci(this)?._injectionContext,p=this.validatorTypeResolver.getValidator(u.type,{validationParameters:u?.params,injectionContext:d}),g=this._getViewModelValidators(s),C=Object.values(g).find(I=>I.type===u.type);this._validators[s].push({name:a,instance:p,disabled:!!C?.disabled,params:u?.params})}}})}),(0,o.of)(null)))}_initSchemaValidators(e){this._measurePerformanceService.measure(`ViewModel.initSchemaValidators.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{Object.entries(e||{}).forEach(([t])=>{const s=this._getViewModelValidators(t);this._validators[t]=this._validators[t]||[];for(const[r,n]of Object.entries(s))if(n?.type){const a=this._injectionContext??Ci(this)?._injectionContext,u=this.validatorTypeResolver.getValidator(n.type,{validationParameters:n.params,injectionContext:a});this._validators[t].push({name:r,instance:u,disabled:n.disabled,params:n?.params})}})})}_waitAsyncValidation(){return(0,o.from)(this.waitAsyncTasksFinish()).pipe((0,l.switchMap)(()=>this.formApiModel.statusChanges.pipe((0,l.startWith)(this.formApiModel.status),(0,l.filter)(e=>e.toLowerCase()!=="pending"),(0,l.first)(),(0,l.map)(()=>null))))}_getResourcesStrings(){const e=this.resources?.strings??{};return{...e,...this._getResourceStringsByAttributes(e)}}_getChangedResourcesStrings(e){const t=Object.entries(e).reduce((r,[n,a])=>{const u=this.resources?.strings[n]||{},d=a&&{...u,...a};return{...r,[n]:d}},{}),s={...this.resources?.strings,...t};return JSON.parse(JSON.stringify(s))}_generateResourceAttribute(){this[on]={},this[on][Bs.string]={};const e=this._getResourcesStrings();return this._attributeResourceGenerator.generate(this,e)}_getBoundAttributeNames(){const e=new Set;return this._dataSourcesInfos.forEach(t=>{for(const s of t.mappedViewModelAttributes)e.add(s)}),Array.from(e.values())}_getDataSourceInfoByViewModelAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e);return this._dataSourcesInfos.has(t)?this._dataSourcesInfos.get(t):null}_getResourceStringsByAttributes(e){const t=Object.keys(e);return this._getBoundAttributeNames().filter(r=>!t.includes(r)).reduce((r,n)=>(r[n]={},r),{})}_getDataSourceAttributeSchema(e,t){return this.dataSchemas[e.name]?.attributes?.find(s=>s.name===t)}_generatePrimaryAttributes(){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>{const e=Array.from(this._dataSourcesInfos.values()).map(t=>{const s=t.name,r=this.dataSchemas[s],a=(t.includePrimaryAttributes?[r?.primaryAttributeName,r?.primaryDisplayAttributeName]:[]).filter(u=>u&&!t.getIsDataSourceAttributePathExists(u)).map(u=>{const d=(0,j.qv)(),p=`${s}_${u}_${d}`,g=r.findAttributeByName(u),C={modelConfig:{path:`${s}.${u}`},dataValueTypeName:A.r[g.dataValueType]};return this._attributeConfigs[p]=C,t.addNewAttribute(p,C),this._attributeGenerate({[p]:C})});return a.length===0?(0,o.of)(null):(0,o.forkJoin)(a)});return e.length===0?(0,o.of)(null):(0,o.forkJoin)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.forkJoin.${this._injectionContext?.id}.parent.${!!this.parent}`))})}_getDataSourceDto(e){const t={},s=this._dataSourcesInfos.get(e);return s.attributesMap.forEach((r,n)=>{if(!s.getIsMapOnCollection(n)){const a=this.attributes[n],u=this._getDataSourceAttributeSchema(s,r);!a&&u?.dataValueType===A.r.Lookup?t[r]=null:t[r]=a}}),(0,o.of)(t)}_checkFilteringAttributes(e,t){if(t.some(r=>(0,P.isNil)(r.name)))throw new Error(`Filtering attributes for ${e} are not valid!`)}_attributeGenerate(e,t){return this._attributeGenerator.generate(this,e,{...t,onChangeAttributeValue:(s,r,n)=>{this._fireChangeAttributeEvent({type:_e.ChangeAttributeValue,payload:{attributeName:s,value:r,oldValue:n,silent:this._viewModelAttributeChangeEventOptions.getAsSilent()}})}})}_getDataSourceNamesAffectedByFilteringAttribute(e,t){return[...this._dataSourcesInfos.entries()].filter(([,s])=>s.isCollection).filter(([s])=>{const r=this.getModelByName(s);return t.has(r?.name)||r?.isLoaded||r?.isLoading}).filter(([s,r])=>this._getIsAnyFilterAttributesChanged(r,e,s)?!0:this._getIsAnyHierarchyFilterAttributesChanged(r,e,s)).map(([s])=>s)}_getIsAnyFilterAttributesChanged(e,t,s){const r=e.getFilteringConfig(),n=r.some(a=>a?.name===t&&a?.loadOnChange);return n&&this._checkFilteringAttributes(s,r),n}_getIsAnyHierarchyFilterAttributesChanged(e,t,s){const r=e.getHierarchyConfig();if(!r?.hierarchicalFilterAttributes&&!r?.hierarchicalColumnValueAttributeName)return!1;if(t===r?.hierarchicalColumnValueAttributeName)return!0;const n=r.hierarchicalFilterAttributes;if(n?.some(u=>u?.name===t&&u?.loadOnChange))return this._checkFilteringAttributes(s,n),!0}_createRequestsForReloadingDataSources(e){return e.map(t=>({type:"crt.LoadDataRequest",$context:this,dataSourceName:t,config:{loadType:he.Reload}}))}_dispatchStartLoadModelAttributes(e){const t=`${mt.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.addTask(t,{targetTask:!0}),this._replayEvents$.next({type:_e.StartLoadModelAttributes,payload:e})}_dispatchFinishLoadModelAttributes(e){const t=`${mt.AttributeLoading}_${this._context?.id}_${Object.keys(e)}`;this._measurePerformancePageLoadService?.removeTask(t,{targetTask:!0}),this._replayEvents$.next({type:_e.FinishLoadModelAttributes,payload:e})}_processEmptyLoadDataForCollection(e,t){var s=this;return(0,S.A)(function*(){if(!e.isCollection||!e.collectionViewModelAttributeName)return;const r=t.find(d=>d.type===B.PrimaryColumnValue);if(!r)return;const n=r.value?.value,a=s.attributes[e.collectionViewModelAttributeName];if(!n||!a)return;const u=yield a.findByPrimaryAttribute(n);u&&a.remove(u)})()}_loadDynamicModel(e){const t=e.attributeName,s=e.dataSourceConfig,r=e.dataSourceName||Xs.createDynamicDataSourceNameFromAttributeName(this,t),n=Xs.createAttributeConfig(this,r,e),a=this._createAndSetDataSourceInfo(r,t,n);return this._defineOrUpdateAttribute(t,n),this._setupSortingAttribute(e.sortingConfig),this._setupFiltersAttributes(e.filtersConfig),this._modelGenerator.generateOne(s,r).pipe((0,l.tap)(u=>this._markModelAsCollection(u,a)),(0,l.tap)(u=>this._dynamicModelNames.add(u.name)),(0,l.tap)(u=>this._upsertModel(r,u)),(0,l.tap)(u=>this._addModelDependencies(u,e.dependencies)),(0,l.switchMap)(u=>(0,o.forkJoin)([(0,o.of)(u),this._addDataSchemaToDataSchemas(u)])),(0,l.switchMap)(([u])=>(0,o.forkJoin)([(0,o.of)(u),(0,o.of)(this._replaceAttributesToDataSourceNameMap(a))])),(0,l.switchMap)(([u])=>(0,o.forkJoin)([(0,o.of)(u),this._reGenerateResourcesAttributes()])),(0,l.switchMap)(([u])=>this._loadModelData({model:u,dataSourceInfo:a,parametersConfig:[],loadType:he.Reload,useLastLoadParameters:e.useLastLoadParameters}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${e.dataSourceName}`))))}_defineOrUpdateAttribute(e,t){this.attributes[e]?this._attributeConfigs[e]=t:this._attributeGenerate({[e]:t})}_createAndSetDataSourceInfo(e,t,s){const n=gt.getFromViewModelConfig({attributes:{[t]:s}}).get(e);return this._dataSourcesInfos.set(e,n),n}_setupSortingAttribute(e){if(!e?.default)return;const t=e.attributeName;this.attributes[t]=e.default}_setupFiltersAttributes(e){e?.forEach(t=>{if(!t.value)return;const s=t.name,r=t.value;this[s]=r.value||r})}_addModelDependencies(e,t){this._modelDependencies[e.name]=t||[]}_addDataSchemaToDataSchemas(e){return e.getSchema().pipe((0,l.tap)(t=>this.dataSchemas[e.name]=t))}_reGenerateResourcesAttributes(){return(0,o.forkJoin)([...this._generateResourceAttribute(),(0,o.of)(null)])}_replaceAttributesToDataSourceNameMap(e){const t=this._getDataSourceAttributesMap(e),s=[...Array.from(this._attributesToDataSourceNameMap.entries()),...t];this._initializeAttributesToDataSourceNameMap(s)}_getMappedAttributeName(e,t){if(!e)return"";const s=e.getMappedAttributeNames(t);return!s||s.length===0?"":s[0]}_getMappedAttributeNames(e,t){return e?e.getMappedAttributeNames(t):[]}_getModelAttributesToLoad(e,t){const s=this._dataSourcesInfos.get(e.name);if(t?.attributes){const r=t.attributes.filter(n=>{const a=this._getMappedAttributeName(s,n);return!this.getIsDirty(a)});return this._getModelDependentAttributes(e,r)}return s?.attributes.map(r=>r.path)}_loadStaticModel(e,t,s,r,n,a){const u=this.getModelByName(e),d=this._dataSourcesInfos.get(u.name);return this._loadModelData({model:u,dataSourceInfo:d,parametersConfig:t,loadType:s,payload:r,useLastLoadParameters:n,doNotUpdateLastLoadParameters:a})}_waitDataDelay(e){return this._viewModelDataDelayerService?.shouldBeDelayed()?(0,o.of)(e).pipe((0,l.delayWhen)(()=>this._viewModelDataDelayerService.loadTrigger$)):(0,o.of)(e)}_updateTrackedAttributes(e){const t=this._modelDependencies[e.name];if(!t||!e.isAggregate)return;const s=/^.{0,2}\[\w+:\w+(:\w+)?]/;t.forEach(r=>{const n=r.relationPath.split(".")[0],a=this.getModelByName(n),u=e.affectedAttributes.filter(p=>p.schemaName===a.dataSchemaName).map(p=>p.path.split(".")[0]).filter(p=>!s.test(p)),d=new Set([...r.trackByAttributes??[],...u]);r.trackByAttributes=[...d.values()]})}_waitForModelLoad(e){var t=this;return(0,S.A)(function*(){const s=t.getModelByName(e);!s||s?.isLoaded||s.mode===D.Create||s.mode===D.Copy||(yield(0,o.firstValueFrom)(t._modelLoaded$.pipe((0,l.filter)(r=>r===e),(0,l.take)(1))))})()}_waitForModelsLoad(e){var t=this;return(0,S.A)(function*(){if(e.length===0||t._isDesignTime)return;const s=e.map(r=>t._waitForModelLoad(r));yield Promise.all(s)})()}_waitForModelsLoadParameters(e,t){var s=this;return(0,S.A)(function*(){if(e.length===0||s._isDesignTime||!t||t.mode===D.Create||t.mode===D.Copy)return;const r=e.map(n=>s._waitForModelLoadParameters(n));yield Promise.all(r)})()}_waitForModelLoadParameters(e){var t=this;return(0,S.A)(function*(){t._lastEventLoadParameters.has(e)||t._modelsNamesWithParameters.has(e)||(yield(0,o.firstValueFrom)(t._modelLoadParametersSetted$.pipe((0,l.filter)(()=>t._modelsNamesWithParameters.has(e)),(0,l.take)(1))))})()}_getAffectedAttributes(e,t,s){const n=this.dataSchemas[e].primaryAttributeName,a=[...t];return n&&!t.includes(n)&&s?.length>0&&s?.[0][n]&&a.push(n),a}_getModelLoadParameters(e,t,s,r,n,a){return this._modelParametersBuilder.getModelLoadParameters(this,e,t,s,{payload:r,useLastLoadParameters:n,doNotUpdateLastLoadParameters:a}).catch(u=>(console.error(u),this._showNotification({message:u.message}),[[{type:B.Never}],{},{},{}]))}_getRelationTypeForRootModel(e){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return null;const t=this._modelDependencies[e],s=es(this.getModelByName(e));if(t?.length!==1||!this._primaryModelName||!s)return null;const r=this.dataSchemas[this._primaryModelName],n=t[0],{dependOnModelName:a,dependOnAttributeName:u}=Ao(n.relationPath);return a!==this._primaryModelName?null:Co(this.dataSchemas[e],n.attributePath,r,u)}_isManyToOneRootModelRelation(e){return this._getRelationTypeForRootModel(e)===Y.ManyToOne}_isOneToManyRootModelRelation(e){return this._getRelationTypeForRootModel(e)===Y.OneToMany}_getOneToManyRelationDefaultValues(e){const t=this._modelDependencies[e]?.[0];if(!t)return{};const s=this.dataSchemas[this._primaryModelName],r=this.getViewModelAttributePaths(this._primaryModelName,s.primaryAttributeName)?.[0],n=this.getViewModelAttributePaths(this._primaryModelName,s.primaryDisplayAttributeName)?.[0];return{[t.attributePath]:{value:this.attributes[r],displayValue:this.attributes[n]}}}_getDependOnModelLoadConfiguration(e){const t=this._getDependOnModelsNames(e),s={};return t.forEach(r=>{this._modelSourceRecordId[r]&&(s[r]={[this.dataSchemas[r].primaryAttributeName??"Id"]:this._modelSourceRecordId[r]})}),s}_isPrimaryModel(e){return this._primaryModelName===e}_isIndependentRootModel(e){return es(e)?this._getDependOnModelsNames(e.name).length===0:!1}_checkAndProcessPageDataSourceData(e,t){if(this._featureValues.DisableMultipleDataSources||this._isDesignTime)return(0,o.of)(t);if(this._isManyToOneRootModelRelation(e.name)&&t.length===0)return this._clearModelValues(e.name),e.setLoadedState(),(0,o.of)(t);const r=this._isOneToManyRootModelRelation(e.name),n=this._isIndependentRootModel(e);if(!(r&&t.length===0||n&&t.length===0&&!this._isPrimaryModel(e.name)))return(0,o.of)(t);e.resetMode();const u=this._getOneToManyRelationDefaultValues(e.name);if(this.PrimaryModelMode===D.Copy){const d=this.dataSchemas[e.name].primaryAttributeName??"Id",p=this._getDependOnModelLoadConfiguration(e.name);return(0,o.from)(this.getDataSourceLoadParameters(e.name,p)).pipe((0,l.switchMap)(({parameters:g,options:C})=>e.load({attributes:[d],parameters:g,options:{loadType:he.Reload,pagingConfig:C.pagingConfig,sortingConfig:C.sortingConfig,hierarchyConfig:C.hierarchyConfig}})),(0,l.switchMap)(g=>{e.resetMode();const C=g?.length?g[0][d]:null;return C?this.copy(e.name,C,u):this.create(e.name,u)}),(0,l.map)(()=>t))}return this.create(e.name,u).pipe((0,l.map)(()=>t))}_isRowsLimitReached(e){var t=this;return(0,S.A)(function*(){const s=e.collectionViewModelAttributeName,r=e.getPagingConfig()?.rowsLimit;return!r||!s?!1:(yield t[s])?.length>=r})()}_setDataSourceLoaded(e,t,s,r){var n=this;return(0,S.A)(function*(){s.length<r?.rowCount||(yield n._isRowsLimitReached(t))?n._loadedDataSources.add(e):n._loadedDataSources.delete(e)})()}_getModelDependedOnEntityDataSource(e){return e.filter(t=>this.models.find(n=>n.name===t).getDataSource().type===wi.EntityDataSource)}_loadModelData({model:e,dataSourceInfo:t,parametersConfig:s,loadType:r,payload:n,useLastLoadParameters:a,doNotUpdateLastLoadParameters:u}){const d=e.name;this._modelsRequestedToLoad.add(d);const p=this._getModelAttributesToLoad(e,n),g=n?.attributes;if(!t)return(0,o.of)([]);if(g&&p.length===0)return(0,o.of)([]);if(this._conflictedModels.includes(d))return(0,o.of)([]);const C=this._getDataSourceMappingAttributes(t,p),I=this._getLoadTypeForDataSource(t,r);if(I===he.LoadNext&&this._loadedDataSources.has(d))return(0,o.of)([]);this._dispatchStartLoadModelAttributes(C);const W=!this._isSyncForModelAllowed(e)||g===null||e.mode===D.Init,X=this._getDependOnModelsNames(d);this._checkAndLoadUnloadedDependOnModels(X);const U=this._getModelDependedOnEntityDataSource(X),In=X.filter(ye=>!U.includes(ye)),kc=Promise.all([this._waitForModelsLoad(In),this._waitForModelsLoadParameters(U,e)]);return(0,o.from)(this._featureValues.DisableSequentialLoadDependentDS?this._waitForModelsLoad(X):kc).pipe((0,l.switchMap)(ye=>(0,o.from)(this._getModelLoadParameters(t,s,I,n,a,u)).pipe((0,l.tap)(()=>{!this._featureValues.DisableSequentialLoadDependentDS&&!t.isCollection&&(this._modelDependencies[d]?.map(wn=>wn.relationPath)||[]).forEach(wn=>{const{dependOnModelName:be,dependOnAttributeName:fr}=Ao(wn),[Lc]=this.getViewModelAttributePaths(be,fr);this.getAttributeControl(Lc).markAsPristine()})}),(0,l.tap)(()=>{if(!this._featureValues.DisableSequentialLoadDependentDS){this._setModalLoadParameters(d);const Qe=this._getAffectedAttributes(d,p,[]);this._reloadDependentModels(e,Qe,Oe.Page)}}))),(0,l.mergeMap)(ye=>this._waitDataDelay(ye)),(0,l.switchMap)(([ye,Qe,Wl,wn])=>e.load({attributes:p,parameters:ye,options:{loadType:r,pagingConfig:Qe,sortingConfig:Wl,hierarchyConfig:wn}}).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.model.load.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${d}`),(0,l.catchError)(be=>this._handleLoadErrorResponse(be,[])),(0,l.tap)(()=>this._updateTrackedAttributes(e)),(0,l.tap)(be=>{be.length===0&&this._dispatchFinishLoadModelAttributes(C)}),(0,l.mergeMap)(be=>be.length===0?(0,o.from)(this._processEmptyLoadDataForCollection(t,ye)).pipe((0,l.map)(()=>be)):(0,o.of)(be)),(0,l.switchMap)(be=>this._checkAndProcessPageDataSourceData(e,be)),(0,l.map)(be=>({data:be,viewModelAttributes:t.getModelDto(be)})),(0,l.switchMap)(({data:be,viewModelAttributes:fr})=>this.setValue(fr,{collectionLoadType:I===he.Reload?or.Reload:or.Merge,silent:!0,isMaskedValue:!0}).pipe((0,O.pR)(()=>!t.isCollection||!fr?(0,o.of)(void 0):(Object.keys(fr).forEach(Lc=>{this.attributes[Lc]?.forEach(bm=>{bm.formApiModel.updateValueAndValidity()})}),(0,o.from)(this._setDataSourceLoaded(d,t,be,Qe)))),(0,l.tap)(()=>this._markAsPristine(fr)),(0,l.map)(()=>be))))),(0,l.tap)(()=>this._modelLoaded$.next(d)),(0,l.switchMap)(ye=>this._runBusinessRulesForModel(e,ye)),(0,l.tap)(ye=>{const Qe=this._getAffectedAttributes(d,p,ye);this._featureValues.DisableSequentialLoadDependentDS&&this._reloadDependentModels(e,Qe,Oe.Page),W||this._reloadDependentModels(e,Qe,Oe.ViewElement)}),(0,l.tap)(ye=>{const Qe=ye[0]??{};e.setLoadedState(Object.keys(Qe)),this._dispatchFinishLoadModelAttributes(C)}),(0,l.takeUntil)(this._destroy$))}_checkAndLoadUnloadedDependOnModels(e){const t=e.filter(s=>{const r=!this._modelsRequestedToLoad.has(s),n=!es(this.getModelByName(s));return r&&n});this._requestReloadModels(t)}_createChangeAttributeTriggers(e){return e.map(t=>({type:oe.ChangeAttributeValue,name:t,scopeId:""}))}_runBusinessRulesForModel(e,t,s=!1,r=[]){const n=this._dataSourcesInfos.get(e.name);if(n.isCollection||!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,o.of)(t);const a=t[0]??{},u=s?[...n.mappedViewModelAttributes]:Object.keys(a).flatMap(C=>this._getMappedAttributeNames(n,C)).filter(C=>C!=null),d=this._createChangeAttributeTriggers(u),p={type:oe.DataLoaded,name:e.name,scopeId:""},g=this.models.filter(C=>C!==e).filter(C=>C.mode!==D.Init).filter(C=>C.getDataSource().scope===Oe.Page).map(C=>this._getModelBusinessRuleContext(C.name,[]));return(0,o.forkJoin)([this._getModelBusinessRuleContext(n.name,[p,...r]),...g,(0,o.of)(this._getViewModelBusinessRuleContext([...d,...r,p]))]).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRulesForModel.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,l.switchMap)(C=>this._runBusinessRulesForContexts(C)),(0,l.map)(()=>t))}_runInitialBusinessRules(){if(!this._businessRulesProcessingEnabled||!this._businessRulesActive)return(0,o.of)(null);const e={type:oe.ContextReady,name:null,scopeId:""};return this._prepareBusinessRulesContexts([e]).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitialBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,l.mergeMap)(t=>t.length===0?(0,o.of)(null):this._runBusinessRulesForContexts(t)))}_createViewModelAttributesValues(e,t){const s=Object.entries(this.dataSchemas),[,r]=s.find(([a])=>a===e),n={};for(const a of r.attributes){const u=t[a.name],d=this.getViewModelAttributePath(e,a.name);d&&(n[d]=u??null)}return n}_createModelData(e,t){const s=this._dataSourcesInfos.get(e),r=this._getDataSourceMappingAttributes(s);this._dispatchStartLoadModelAttributes(r);const n=this.getModelByName(e),a=n.disableSync,u=this._getModelAttributesToLoad(n,null);return n.disableSync=!0,n.create(t).pipe((0,l.switchMap)(d=>{const p=this._createViewModelAttributesValues(e,d),g=this._isOneToManyRootModelRelation(e)?{silent:!0}:null;return this.setValue(p,g).pipe((0,l.tap)(()=>this._forEachControl(p,C=>{C.markAsPristine(),C.markAsUntouched()})))}),(0,l.tap)(()=>{n.disableSync=a,this._modelLoaded$.next(e),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e)}),(0,l.switchMap)(()=>this._runBusinessRulesForModel(n,[],!0)),(0,l.tap)(()=>{this._isSyncForModelAllowed(n)&&this._reloadDependentModels(n,u)}),(0,l.tap)(()=>{this._dispatchFinishLoadModelAttributes(r),n.setLoadedState()}),(0,l.map)(()=>null))}_copyModelData(e,t,s){const r=this._dataSourcesInfos.get(e),n=this._getDataSourceMappingAttributes(r);this._dispatchStartLoadModelAttributes(n);let a;const u=this.getModelByName(e),d=this._getModelAttributesToLoad(u,null),p=u.disableSync;return u.disableSync=!0,this._modelSourceRecordId[e]=t,u.copy(t,s).pipe((0,l.catchError)(g=>this._handleLoadErrorResponse(g,{})),(0,l.map)(g=>({data:[g],viewModelAttributes:r.getModelDto([g])})),(0,l.switchMap)(({data:g,viewModelAttributes:C})=>this.setValue(C).pipe((0,l.tap)(()=>this._markAsPristine(C)),(0,l.map)(()=>g))),(0,l.tap)(()=>{u.disableSync=p,this._modelLoaded$.next(e)}),(0,l.switchMap)(g=>this._runBusinessRulesForModel(u,g,!0)),(0,l.tap)(()=>{this._isSyncForModelAllowed(u)&&(this._reloadDependentModels(u,d),this._featureValues.DisableSequentialLoadDependentDS||this._setModalLoadParameters(e))}),(0,l.tap)(()=>{this._dispatchFinishLoadModelAttributes(n),u.setLoadedState()}),(0,l.mergeMap)(()=>(0,o.of)(a)))}_getDataSourceMappingAttributes(e,t=null){const s=t??e?.attributes.map(n=>n.path);if(!s)return{};const r=Object.fromEntries(s.map(n=>[this._getMappedAttributeName(e,n),!0]));return e.collectionViewModelAttributeName&&(r[e.collectionViewModelAttributeName]=!0),r}_handleLoadErrorResponse(e,t){if(e instanceof Jn)return(0,o.of)(t);const s=1e4;return console.error(e),this._showNotification({message:e.message,duration:s}),(0,o.of)(t)}_canExecuteBusinessRulesByModelAttributeValue(e,t,s){return t&&e?this._isModelAttributeValueValid(e,t,s):!0}_canExecuteBusinessRulesByViewModelAttributeValue(e,t){const s=this._getDataSourceInfoByViewModelAttributePath(e);if(s){const r=s.getDataSourceAttributePath(e);return this._canExecuteBusinessRulesByModelAttributeValue(s,r,t)}return!0}_getContextAttributeValue(e){return e instanceof Date?sa(e):e}_getNormalizedContextAttributeValue(e,t,s){const r=e;return A.r[t]===A.r.Lookup||r?.displayValue?r?.value??e:s===!0||!t?e:[A.r.RICH_TEXT,A.r.Image].includes(A.r[t])?null:A.r[t]===A.r.MAXSIZE_TEXT&&e?e.slice(0,500):e}_getHasValueContextAttributeValue(e,t){return!!(t&&A.r[t]===A.r.Boolean||e!=null&&e!=="")}_getViewModelAttributeInfos(e,t,s){return Object.keys(t).filter(r=>!(t[r]instanceof ft)).map(r=>{if(t[r]instanceof Ot)return this._getViewModelAttributeInfos(e?`${e}.${r}`:r,t[r]?.attributes??{},s);const n=this._attributeConfigs[r]?.dataValueTypeName,a=this._getContextAttributeValue(t[r]),u=this._getNormalizedContextAttributeValue(a,n,s);return{name:e?`${e}.${r}`:r,value:u??null,displayValue:t[r]?.displayValue,dataValueTypeName:n,hasValue:this._getHasValueContextAttributeValue(a,n)}}).flat()}_runBusinessRulesForContexts(e){const t=`${mt.RunningBusinessRules}-${(0,j.qv)()}`;return this._onAsyncTaskStarted(t),(0,o.of)(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,l.map)(s=>s?.filter(r=>!(0,P.isNil)(r))??[]),(0,l.mergeMap)(s=>{if(s.length===0)return(0,o.of)(null);const r=s.map(n=>({scopeName:n.scopeName,scopeId:n.scopeId,scopeType:n.scopeType,triggers:n.triggers}));return this._toggleControlsAffectedByBusinessRules(!1,r),this._businessRulesEngine.execute(s).pipe(this._measurePerformanceService.measure$(`ViewModel.runBusinessRules.execute.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,l.tap)(n=>{n.forEach(a=>{const u=r.find(d=>d.scopeId===a.scopeId&&d.scopeName===a.scopeName&&d.scopeType===a.scopeType);a.triggers=u?.triggers??[]})}),(0,l.switchMap)(n=>n?this._businessRulesApplier.applyRules(this,n):(0,o.of)(null)),(0,l.tap)(()=>{this._toggleControlsAffectedByBusinessRules(!0,r)}))}),(0,l.tap)(()=>this._onAsyncTaskFinished(t)))}_createViewModelContext(e,t){return{scopeType:je.ViewModel,scopeName:this._scopeName,scopeId:this._scopeName,scopeState:wt.Unknown,parentScopeId:null,attributes:t,triggers:e}}_getViewModelBusinessRuleContext(e){const t=this._featureValues["BRules-EnableCompareLargeAttributeValues"],s=this._getViewModelAttributeInfos(null,this.attributes,t);return this._createViewModelContext(e,[...s].map(r=>({attributeName:r.name,value:r.value,displayValue:r.displayValue,dataValueTypeName:r.dataValueTypeName,hasValue:r.hasValue})))}_prepareModelBusinessRuleTrigger(e,t){return t.map(s=>{if(s.type===oe.DataLoaded||s.type===oe.ContextReady)return s;const r=this._getDataSourceInfoByViewModelAttributePath(s.name);return!r||r.name!==e?null:{type:oe.ChangeAttributeValue,name:r.getDataSourceAttributePath(s.name),scopeId:""}}).filter(s=>s!=null)}_getModelContextScopeStateType(e){switch(e.mode){case D.Init:return wt.Init;case D.Create:return wt.Create;case D.Copy:return wt.Copy;case D.Update:return wt.Update;default:return wt.Unknown}}_getModelBusinessRuleContext(e,t){const s=this._dataSourcesInfos.get(e),r=this.getModelByName(e),n=this.dataSchemas[e],a=this._prepareModelBusinessRuleTrigger(e,t),u=this._getModelContextScopeStateType(r);return this._getDataSourceDto(e).pipe((0,l.map)(d=>({...r._getPersistedState(),...d})),(0,l.map)(d=>({enableCompareLargeAttributeValues:this._featureValues["BRules-EnableCompareLargeAttributeValues"],modelDto:d})),(0,l.map)(({enableCompareLargeAttributeValues:d,modelDto:p})=>Object.entries(p).map(([g,C])=>{let I;const W=this._getMappedAttributeName(s,g);if(W)I=this._attributeConfigs[W]?.dataValueTypeName;else{const In=n.findAttributeByName(g);I=A.r[In.dataValueType]}const X=this._getContextAttributeValue(C),U=this._getNormalizedContextAttributeValue(X,I,d);return{attributeName:g,value:U,displayValue:C?.displayValue,dataValueTypeName:I,hasValue:this._getHasValueContextAttributeValue(X,I),isSignificant:g===n.primaryAttributeName}})),(0,l.map)(d=>({scopeType:je.Model,scopeName:r.dataSchemaName,scopeId:e,scopeState:u,parentScopeId:this._scopeName,attributes:d,triggers:a,modelType:r.getDataSource()?.type})))}_prepareDataSourceNamesForBusinessRules(){return this._modelsMap.size===0?[]:[...this._modelsMap.values()].filter(e=>!this._dataSourcesInfos.get(e.name).isCollection).map(e=>e.name)}_getModelsBusinessRuleContexts(e){return this._prepareDataSourceNamesForBusinessRules().map(s=>s?this._getModelBusinessRuleContext(s,e):(0,o.of)(null))}_prepareBusinessRulesContexts(e){const t=this._getModelsBusinessRuleContexts(e);if(!this._scopeName)return t.length===0?(0,o.of)([]):(0,o.forkJoin)([...t]);const r=[(0,o.of)(this._getViewModelBusinessRuleContext(e)),...t];return r.length===0?(0,o.of)([]):(0,o.forkJoin)(r)}_isAttributeChange(e){return!e.attributeName?.includes(":")}_businessRulesSubscribeOnChangeAttributes(){if(!this._businessRulesProcessingEnabled||this._isDesignTime)return;const e=this.events$.pipe((0,l.filter)(()=>this._businessRulesActive),(0,l.filter)(s=>s.type===_e.ChangeAttributeValue),(0,l.filter)(s=>this._isAttributeChange(s.payload)),(0,l.filter)(s=>!s.payload.silent),(0,l.filter)(s=>!s.payload?.preventRunBusinessRules),(0,l.filter)(s=>{const r=s.payload;return this._canExecuteBusinessRulesByViewModelAttributeValue(r.attributeName,r.value)}),(0,l.filter)(s=>{const r=s.payload,n=this._getAttributeDataValueTypeName(r.attributeName);return n&&Ca(n)===A.r.Lookup?r.value?.value!==r.oldValue?.value:!0}),(0,l.map)(s=>s.payload.attributeName)),t=e.pipe((0,l.tap)(()=>this._onAsyncTaskStarted(mt.DebouncingBusinessRules)),(0,l.buffer)(e.pipe((0,l.debounceTime)(mm))),(0,l.map)(s=>Array.from(new Set(s))),(0,l.map)(s=>this._createChangeAttributeTriggers(s)),(0,l.mergeMap)(s=>this._prepareBusinessRulesContexts(s)),(0,l.tap)(()=>this._onAsyncTaskFinished(mt.DebouncingBusinessRules)),(0,l.filter)(s=>s.length>0),(0,l.mergeMap)(s=>this._runBusinessRulesForContexts(s)));this._subscriptions.add(t.subscribe())}_subscribeOnChangeAttributes(){const e=this.events$.pipe((0,l.filter)(t=>t.type===_e.ChangeAttributeValue),(0,l.map)(t=>t),(0,l.map)(t=>{const s=this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),r=this._dataSourcesInfos.get(s)?.attributesMap.get(t.payload.attributeName),n=this.getBoundDataSchemaAttributeByAttributePath(t.payload.attributeName);return{changeEvent:t,model:this.getModelByName(s),modelAttributeInfo:{name:n?.name??r,isLookup:!!n?.isLookup}}}),(0,l.filter)(({model:t,modelAttributeInfo:s})=>!!(t&&s.name)),(0,l.tap)(({changeEvent:t,model:s,modelAttributeInfo:r})=>{const n=t.payload,a=r.isLookup,u=a?n.oldValue?.value:n.oldValue,d=a?n.value?.value:n.value;u!==d&&s?.attributeChanged(r.name,n?.preventStateChange??n?.silent)}));this._subscriptions.add(e.subscribe())}_getHasRelation(e=[],t,s){return e.map(n=>{const a=n.trackByAttributes??[],{dependOnModelName:u,dependOnAttributeName:d}=Ao(n.relationPath);return a.push(d),{rootModelName:u,trackedAttributes:d}}).filter(({rootModelName:n})=>n===t).filter(({trackedAttributes:n})=>this._dataSourcesInfos.get(t).isCollection?!0:s.some(a=>n.includes(a))).length!==0}_getDependentModelsNames(e,t=[]){return e?Object.entries(this._modelDependencies).filter(([s])=>s!==e).filter(([,s])=>this._getHasRelation(s,e,t)).map(([s])=>s).map(s=>[s,...this._getDependentModelsNames(s)]).flat():[]}_getIsModelDataChanged(e){if(!this.getModelByName(e)?.isLoaded)return!1;const s=this._dataSourcesInfos.get(e);if(s.isCollection){const n=s.collectionViewModelAttributeName,a=this.attributes[n];return a?a.isChanged:!1}return s.getMappedAttributes().some(n=>this.getIsDirty(n))}_requestReloadModels(e){this._createRequestsForReloadingDataSources(e).forEach(s=>{this._ngZone.runOutsideAngular(()=>this.processRequest(s))})}_isModelAttributeValueValid(e,t,s){return this._getDataSourceAttributeSchema(e,t)?.dataValueType===A.r.Lookup?Dh(s):!0}_canReloadModelDependentData(e,t){return e.canReloadDependentData(t)?!0:this._conflictedModels.includes(e.name)?!1:this._getDependentModelsNames(e.name,[t]).length>0}_getModelDependentAttributes(e,t){return[...t,...t.map(s=>e.getDependentAttributesNames(s)).flat()]}_getChangedModelsNames(e){return e.filter(t=>this._getIsModelDataChanged(t))}_showNotification(e){this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.NotificationRequest",$context:this,...e}))}_isSyncForModelAllowed(e){return e.allowSync}_subscribeOnReloadDataEvents(){if(this._isDesignTime)return;const e=this.events$.pipe((0,l.filter)(()=>this._modelSynchronizationEnabled),(0,l.filter)(t=>t.type===_e.ChangeAttributeValue),(0,l.filter)(t=>t.payload.silent!==!0),(0,l.map)(t=>({modelName:this.getBoundDataSourceNameByAttributePath(t.payload.attributeName),attributeName:t.payload.attributeName,attributeValue:t.payload.value})),(0,l.filter)(({modelName:t})=>t!=null),(0,l.map)(({modelName:t,attributeName:s,attributeValue:r})=>{const n=this._dataSourcesInfos.get(t),a=n?.attributesMap.get(s);return{model:this.getModelByName(t),dataSourceInfo:n,modelAttribute:a,attributeValue:r}})).pipe((0,l.filter)(({model:t})=>t!=null),(0,l.filter)(({dataSourceInfo:t})=>!t.isCollection),(0,l.filter)(({model:t})=>this._isSyncForModelAllowed(t)),(0,l.filter)(({dataSourceInfo:t,modelAttribute:s,attributeValue:r})=>this._isModelAttributeValueValid(t,s,r)),(0,l.filter)(({model:t,modelAttribute:s})=>this._canReloadModelDependentData(t,s))).pipe((0,l.tap)(({model:t,dataSourceInfo:s,modelAttribute:r,attributeValue:n})=>{const a=this._getModelDependentAttributes(t,[r]),u=Object.fromEntries(a.map(d=>[this._getMappedAttributeName(s,d),!0]));this._dispatchStartLoadModelAttributes(u),t.reloadDependentData(r,n).pipe((0,l.switchMap)(d=>{if(d.length===0)return(0,o.of)(d);const p=s.getModelDto(d);return this.setValue(p,{silent:!0,isMaskedValue:!0}).pipe((0,l.switchMap)(()=>this._runBusinessRulesForModel(t,d)))}),(0,l.tap)(()=>this._reloadDependentModels(t,[r])),(0,l.tap)(()=>this._dispatchFinishLoadModelAttributes(u))).subscribe()}));this._subscriptions.add(e.subscribe())}_subscribeOnChangeRequests(){const e=this.events$.pipe((0,l.filter)(t=>t.type===_e.ChangeAttributeValue),(0,l.mergeMap)(t=>{const s=t.payload.attributeName,r=this._attributeConfigs[s];return Array.isArray(r?.change)?r.change:[r?.change]}),(0,l.filter)(t=>t!=null),(0,l.map)(t=>({type:t.request,$context:this,scopes:this._scopeName?[this._scopeName]:[],...t.params})),(0,l.tap)(t=>this._ngZone.runOutsideAngular(()=>this.handlerChain.process(t))));this._subscriptions.add(e.subscribe())}_subscribeOnFilteringEvents(){const e=new Set;this._subscriptions.add(this._modelLoaded$.pipe((0,l.tap)(s=>{e.add(s)})).subscribe());const t=this.events$.pipe((0,l.filter)(s=>s.type===_e.ChangeAttributeValue),(0,l.map)(s=>{const r=s.payload.attributeName;return this._getDataSourceNamesAffectedByFilteringAttribute(r,e)}),(0,l.map)(s=>this._createRequestsForReloadingDataSources(s)),(0,l.tap)(s=>{s.forEach(r=>{this._ngZone.runOutsideAngular(()=>this.processRequest(r))})}));this._subscriptions.add(t.subscribe())}_saveModel(e,t,s){const r=this.getModelByName(e),n=r.mode,a=this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(u,d)=>r.insertOrUpdate(u,d),onSavedAction:(u,d)=>this._updateLastLoadParameters(e,n,u,d),getInvalidAction:u=>(0,o.of)(u)});return this.handleSaveModelStream(a,s)}_initSubscriptions(){return this._measurePerformanceService.measure(`ViewModel.initSubscriptions.${this._injectionContext?.id}.parent.${!!this.parent}`,()=>(this._subscribeOnFilteringEvents(),this._subscribeModelsEvents(),this._subscribeOnChangeAttributes(),this._subscribeOnChangeRequests(),this._subscribeOnReloadDataEvents(),this._businessRulesSubscribeOnChangeAttributes(),this._subscribeOnChangeAttributesToHandleModelDependenciesConstrains(),this._subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(),(0,o.of)(null)))}_subscribeOnPrimaryDisplayAttributeChangeForOneToManyRelation(){if(this._featureValues.DisableMultipleDataSources)return;const e=this.events$.pipe((0,l.filter)(t=>this._primaryModelName!=null),(0,l.filter)(t=>t.type===_e.ChangeAttributeValue),(0,l.map)(t=>t),(0,l.map)(({payload:t})=>{const s=t.attributeName,r=t.value;return{modelName:this.getBoundDataSourceNameByAttributePath(s),attributeName:s,attributeValue:r}}),(0,l.filter)(({modelName:t})=>this._isPrimaryModel(t)),(0,l.filter)(({attributeName:t})=>{const s=this.getBoundDataSchemaByAttributePath(t),r=this.getBoundDataSchemaAttributeByAttributePath(t);return!s||!r?!1:s.primaryDisplayAttributeName===r.name}),(0,l.map)(({modelName:t,attributeValue:s})=>{const r=this.dataSchemas[this._primaryModelName],a=this._getDependentModelsNames(t,[r.primaryAttributeName]).filter(u=>this._isOneToManyRootModelRelation(u));return{primaryDisplayValue:s,dependentModelsNames:a}}),(0,l.filter)(({dependentModelsNames:t})=>t.length>0),(0,l.tap)(({dependentModelsNames:t,primaryDisplayValue:s})=>{const r=this.dataSchemas[this._primaryModelName],n=this.getViewModelAttributePaths(this._primaryModelName,r.primaryAttributeName)[0],a=this.attributes[n],u={};t.map(d=>{const g=this._modelDependencies[d][0].attributePath;return this.getViewModelAttributePaths(d,g)}).flat().forEach(d=>{u[d]={value:a,displayValue:s}}),this.setValue(u,{silent:!0,preventAttributeChangeRequest:!0,preventRunBusinessRules:!1,preventStateChange:!0})}));this._subscriptions.add(e.subscribe())}_getDataSchemas(){if(this.models&&this.models.length!==0){const e=this.models.map(t=>t.getSchema().pipe((0,l.map)(s=>[t.name,s])));return(0,o.combineLatest)(e).pipe((0,l.take)(1),(0,l.map)(t=>Object.fromEntries(t)))}return(0,o.of)({})}_setAttributesDefaultValues(e){var t=this;return(0,o.from)((0,S.A)(function*(){let s=Object.entries(t.dataSchemas);e&&(s=s.filter(([r])=>r===e));for(const[r,n]of s){const a={};for(const u of n.attributes){const d=yield(0,o.lastValueFrom)(u.defaultValue,{defaultValue:null});if(!(0,P.isNil)(d)){const p=t.getViewModelAttributePath(r,u.name);p&&(a[p]=d)}}t.setValue(a).subscribe()}})())}_generateDataSourcesInfo(){return this._dataSourcesInfos=gt.getFromViewModelConfig(this.viewModelConfig,this.models),(0,o.of)(this._dataSourcesInfos)}_generateAttributesToDataSourceNameMap(e){const t=Array.from(e.values()).map(s=>this._getDataSourceAttributesMap(s)).flat();return this._initializeAttributesToDataSourceNameMap(t),(0,o.of)(this._attributesToDataSourceNameMap)}_initializeAttributesToDataSourceNameMap(e){this._attributesToDataSourceNameMap=new Map(e)}_getDataSourceAttributesMap(e){const s=e.getMappedAttributes().map(r=>[r,e.name]);return e.isCollection&&s.push([e.collectionViewModelAttributeName,e.name]),s}_getDataSourceLoadType(e){return e?e||he.Reload:null}_getLoadTypeForDataSource(e,t){if(t===he.Load)return t;const s=e.getPagingConfig();return!t&&s?he.LoadNext:t}_loadDefaultSorting(e){this._measurePerformanceService.measure(`ViewModel._loadDefaultSorting.${this._injectionContext?.id}.parent.${!!this.parent}.dsNames.${e?.toString()}`,()=>{const t=Array.from(this._dataSourcesInfos.entries()).filter(([s])=>!e?.length||e.includes(s)).map(([,s])=>s.getSortingConfig()).filter(s=>!!s?.default).reduce((s,r)=>(s[r.attributeName]=r.default,s),{});this.setValue(t,{silent:!0}).subscribe()})}_getDropdownPageSize(){var e=this;return(0,S.A)(function*(){if(!(0,P.isEmpty)(e._dropdownPageSize))return e._dropdownPageSize;const t=yield e.sysSettingsService.getByCode(e._dropdownPageSizeSettingsCode);return e._dropdownPageSize={pagingConfig:{rowCount:t?.value,rowsOffset:0}},e._dropdownPageSize})()}_mergeCollectionModels(e,t){this._measurePerformanceService.measure(`ViewModel.mergeCollectionModels.${this._injectionContext?.id}.parent.${!!this.parent}.collection.${e}`,()=>{const s=this.attributes[e];this._featureValues.DisableBaseViewModelCollectionOptimization||s.length?s.merge(t):s.push(...t)})}_getEmbeddedModels(){const e=Object.entries(this.viewModelConfig?.attributes??{}).filter(([,r])=>r&&"embeddedModel"in r&&r.embeddedModel).map(([r,n])=>({attributeName:r,embeddedModel:n.embeddedModel}));if(e.length===0)return(0,o.of)([]);const t={},s=[];if(e.forEach(({attributeName:r,embeddedModel:{name:n,config:a}})=>{n?t[n]&&s.push(`Duplicated embedded model : ${n}.`):s.push(`Embedded model name is not provided for ${r}.`),t[n]=a}),s.length>0)throw new Error(s.join(" "));return this._modelGenerator.generate({dataSources:t},this.injector)}_concatModelsWithEmbedded(e=null){return this._getEmbeddedModels().pipe((0,l.map)(t=>{const s=[...e??[],...t??[]],r=s.map(n=>n.name).filter((n,a,u)=>u.indexOf(n)!==a);if(r.length>0)throw new Error(`Duplicated model names found : ${r.join(",")}.`);return s}))}_updateModelsMap(){const e=this.models.map(t=>[t.name,t]);this._modelsMap=new Map(e)}_subscribeModelsChanges(){this._subscriptions.add(this._models$.subscribe(()=>this._updateModelsMap()))}_subscribeModelsEvents(){this._isDesignTime||this.models.forEach(e=>this._subscribeModelEvents(e))}_subscribeModelEvents(e){this._subscriptions.add(e.event$.pipe((0,l.mergeMap)(t=>this._waitDataDelay(t)),(0,l.mergeMap)(t=>this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.HandleModelEventRequest",$context:this,scopes:this._eventScopes,modelName:e.name,modelEvent:t})),1)).subscribe())}_upsertModel(e,t){const s=[...this.models],r=s.findIndex(({name:n})=>n===e);r===-1?s.push(t):s.splice(r,1,t).forEach(n=>n.destroy()),this._subscribeModelEvents(t),this._models$.next(s)}_replaceDataSourceInfo(e,t){!e||!t||(this._loadedDataSources.has(e)&&this._loadedDataSources.delete(e),this._dataSourcesInfos.set(e,t),this._replaceAttributesToDataSourceNameMap(t))}_updateModels(e){e.forEach((t,s)=>{const r=this.getModelByName(s);r&&(this._markModelAsCollection(r,t),this._updateModelDependentAttributes(r,t))})}_markModelAsCollection(e,t){t.isCollection&&(e._isCollection=!0)}_setModalLoadParameters(e){this._modelsNamesWithParameters.add(e),this._modelLoadParametersSetted$.next()}_updateModelDependentAttributes(e,t){const s=t.attributes.map(r=>({path:r.path,type:r.type}));e.updateDependentAttributes(s)}_initIsChangedAttribute(){this._systemAttributes.push(Cn),this.attributes[Cn]=!1;const e=this._models$.pipe((0,l.switchMap)(t=>t?.length?(0,o.combineLatest)(t.map(s=>s._dirty$)):(0,o.of)([])),(0,l.map)(t=>t.some(s=>s)),(0,l.filter)(()=>!this._viewModelAttributeChangeEventOptions.getOptions().preventStateChange),(0,l.distinctUntilChanged)()).subscribe(t=>{this._setSystemAttributeValue(Cn,t)});this._subscriptions.add(e)}_initHasUnsavedDataAttribute(){this._systemAttributes.push(xi),this.attributes[xi]=!1;const e=this.events$.pipe((0,l.filter)(a=>a?.type===_e.ChangeAttributeValue&&a.payload?.attributeName===Cn),(0,l.map)(a=>a.payload.value)),t=(0,o.merge)(this.IsChanged,e),r=this._models$.pipe((0,l.map)(a=>a.map(u=>u._modeChanges$.pipe((0,l.map)(d=>({mode:d,name:u.name})),(0,l.startWith)({mode:u.mode,name:u.name})))),(0,l.switchMap)(a=>a?.length?(0,o.combineLatest)(a):(0,o.of)([]))).pipe((0,l.map)(a=>a.some(({mode:u,name:d})=>{const p=!this._isDesignTime&&!this._featureValues.DisableMultipleDataSources&&!this._isPrimaryModel(d)&&this._isIndependentRootModel(this.getModelByName(d)),g=this._isOneToManyRootModelRelation(d);return(u===D.Create||u===D.Copy)&&!g&&!p}))),n=(0,o.combineLatest)([t,r]).pipe((0,l.map)(([a,u])=>!!(a||u)),(0,l.distinctUntilChanged)()).subscribe(a=>{this._setSystemAttributeValue(xi,a)});this._subscriptions.add(n)}_initPrimaryModelModeAttribute(){const e=this._getPrimaryModelModeChanges();if(!e)return;this._systemAttributes.push(Nc),this.attributes[Nc]=this.getPrimaryModelMode();const t=e.pipe((0,l.startWith)(this.getPrimaryModelMode())).subscribe(s=>this._setSystemAttributeValue(Nc,s));this._subscriptions.add(t)}_initStateAttribute(){this._systemAttributes.push(Vi),this.attributes[Vi]=Vc.Active}_initBusinessRulesActivatedAttribute(){if(this._systemAttributes.push(xc),this.attributes[xc]=this._businessRulesAreActivated,this._businessRulesAreActivated)return;const e=this._businessRulesActivated$.pipe((0,l.filter)(t=>t===!0)).subscribe(t=>{this._setSystemAttributeValue(xc,t)});this._subscriptions.add(e)}_initSystemAttributes(){var e=this;return(0,S.A)(function*(){yield e._measurePerformanceService.measureCallback(`ViewModel.initSystemAttributes.${e._injectionContext?.id}.parent.${!!e.parent}`,()=>(e._initIsChangedAttribute(),e._initPrimaryModelModeAttribute(),e._initHasUnsavedDataAttribute(),e._featureValues.DisableDelayingModelEvents||e._initStateAttribute(),e._initBusinessRulesActivatedAttribute(),Promise.resolve()))})()}_handleCircularDependencies(){const e=sm(this._modelDependencies);if(e.hasCycles){const t=this._translateService.instant("BaseViewModel.WarningModelsWithCircularDependencies");this._showNotification({message:t,duration:1e4}),console.warn(t,e.cycledModelsNames)}this._conflictedModels=e?.cycledModelsNames}_forEachControl(e,t){Object.keys(e).forEach(r=>{if(this.attributes[r]instanceof ft){const n=this.attributes[r],a=e[r];n.forEach(u=>{const d=u.primaryAttributeName,p=u.attributes[d],g=a.find(C=>C[d]===p);g&&u._forEachControl(g,t)})}else if(this.attributes[r]instanceof Ot)this.attributes[r]._forEachControl(e[r],t);else{const n=this.getControl(r);t(n.formControl)}})}_getModelsErrors(e){return(e??[]).filter(t=>!t.isCollectionItemModel&&t.hasErrors).map(t=>t.getLastError())}_notifyAboutModelsErrors(e){const t=this._getModelsErrors(e);if(t.length>0){const s=t.map(r=>r.message).join(" ");this._showNotification({message:s})}}_initFeaturesStates(){this._disableViewModelWaitingForAsyncTasks=this._featureValues.DisableViewModelWaitingForAsyncTasks,this._disableViewModelLoadUnblockingThread=this._featureValues.DisableViewModelLoadUnblockingThread,this._blockFieldsAffectedByBusinessRules=this._featureValues.BlockFieldsWhileRunBusinessRules,this._modelSynchronizationEnabled=!this._featureValues.ModelSynchronizationDisabled}_handleAsyncTasksCycle(e){let t=null;const s=100,r=Array.from(e).filter(n=>n.startsWith(mt.ProcessingAttributeChangeRequest));if(!(!e.size||!r.length))return r.length&&(t=setTimeout(()=>{console.warn("[ViewModel]: Clearing executing tasks by exceeded timeout",r),r.forEach(n=>e.delete(n)),this._asyncTasksExecutingSubject.next(e)},s)),t}_getAffectedViewModelAttributes(e,t){return this.models.filter(r=>r.dataSchemaName===e).map(r=>r.name).flatMap(r=>this.getViewModelAttributePaths(r,t))}_toggleControlsAffectedByBusinessRules(e,t){if(!this._blockFieldsAffectedByBusinessRules)return;this._attributesAffectedByBusinessRules?.filter(r=>tp(this._scopeName,r,t))?.forEach(r=>{r.scopeName===this._scopeName?this.getControl(r.name).toggle(e):this._getAffectedViewModelAttributes(r.scopeName,r.name).forEach(a=>{this.getControl(a).toggle(e)})})}_initAttributesAffectedByBusinessRules(){var e=this;return(0,S.A)(function*(){const s=e._prepareDataSourceNamesForBusinessRules().filter(n=>!!n).map(n=>e.getModelByName(n)).map(n=>({scopeId:n.name,scopeName:n.dataSchemaName,scopeType:je.Model,modelType:n.getDataSource()?.type})),r={scopeName:e._scopeName,scopeType:je.ViewModel,scopeId:e._scopeName};e._attributesAffectedByBusinessRules=yield e._businessRulesEngine.getAffectedAttributes([r,...s])})()}_initBusinessRules(){var e=this;return this._measurePerformanceService.measureCallback(`ViewModel.initBusinessRules.${this._injectionContext?.id}.parent.${!!this.parent}`,(0,S.A)(function*(){e._businessRulesProcessingEnabled=!e._featureValues.BusinessRulesProcessingDisabled&&e.viewModelConfig.supportBusinessRules!==!1,e._businessRulesProcessingEnabled&&(yield e._initAttributesAffectedByBusinessRules()),e._businessRulesAreActivated=e._businessRulesProcessingEnabled&&e._businessRulesActive!==!1,e._businessRulesActivated$.next(e._businessRulesAreActivated)}))}_attributeGenerate$(e,t){return(0,o.of)(this._featureValues.UseDesignerHotSwapViewModel).pipe((0,l.switchMap)(s=>s&&this._isDesignTime?this._initDataSourceValidators().pipe((0,l.tap)(()=>{this._initSchemaValidators(e)}),(0,l.switchMap)(()=>this._attributeGenerate(e,t))):this._attributeGenerate(e,t)))}_validateByDataSourceName(e){var t=this;return(0,S.A)(function*(){const s={},r=t._getBoundDataSourceAttributeControls(e);return yield Promise.all(Object.entries(r).map(([n,a])=>(a.markAsTouched(),a.updateValueAndValidity(),(0,o.lastValueFrom)(cl(a).pipe((0,l.tap)(()=>{a.errors&&(s[n]=a.errors)})))))),s})()}_validateAll(){var e=this;return(0,S.A)(function*(){const t={};return e.formApiModel.markAllAsTouched(),e.formApiModel.updateValueAndValidity(),ol(e.formApiModel),yield(0,o.lastValueFrom)(cl(e.formApiModel).pipe((0,l.tap)(()=>{Object.entries(e.formApiModel.controls).forEach(([r,n])=>{n.errors&&(t[r]=n.errors)})}))),t})()}_getDependentModelsNamesOnRelationAttributeName(e){const t=this.getBoundDataSourceNameByAttributePath(e),r=this._dataSourcesInfos.get(t)?.attributesMap.get(e);return this._getDependentModelsNames(t,[r])}_setAttributeValue(e,t,s){this._executeWithOptions(()=>this[e]=t,s)}_subscribeOnChangeAttributesToHandleModelDependenciesConstrains(){if(this._isDesignTime)return;const e=this.events$.pipe((0,l.filter)(t=>t.type===_e.ChangeAttributeValue),(0,l.filter)(t=>this._isAttributeChange(t.payload)),(0,l.tap)(t=>{const s=t;!s?.payload?.value&&s.payload?.attributeName&&this._clearValuesForManyToOne(s.payload.attributeName)}));this._subscriptions.add(e.subscribe())}_clearValuesForManyToOne(e){this._getDependentModelsNamesOnRelationAttributeName(e).forEach(s=>{this._isManyToOneRootModelRelation(s)&&this._clearModelValues(s)})}_clearModelValues(e){const t=this._dataSourcesInfos.get(e),s=t?.isCollection?[]:t.getMappedAttributes();if(s.length){const r=s.reduce((n,a)=>({...n,[a]:null}),{});this.setValue(r).subscribe(()=>{this._markAsPristine(r),this._markAsUntouched(r)})}}_markAsUntouched(e){this._forEachControl(e,t=>{t.markAsUntouched()})}_setSingleSubmodelValue(e,t,s){return this.attributes[e].setValue(t[e],{silent:s?.silent,isMaskedValue:s?.isMaskedValue,preventAttributeChangeRequest:s?.preventAttributeChangeRequest,preventStateChange:s?.preventStateChange,preventRunBusinessRules:s?.preventRunBusinessRules})}_setCollectionSubmodelValue(e,t,s){const r=this._attributeConfigs[e],n=r.viewModelConfig||r.viewModelName,a=!this._featureValues.DisableDataGridEditingMode,u=(t[e]||[]).map(d=>{const p=this.getBoundDataSourceName(e),C=this._getDataSourceInfoByViewModelAttributePath(e)?.isCollection&&this.getModelByName(p)?.createCollectionItemModel(D.Update);return this.viewModelGenerator.generate({viewModelConfig:n,modelConfig:a&&C?{primaryDataSourceName:C.name}:void 0,models:a&&C?[C]:void 0,parentViewModel:this,businessRulesActive:!1},c.Injector.create({providers:[{provide:Ai,useValue:null}],parent:this.injector})).pipe(this._measurePerformanceService.measure$(`ViewModel.setValue.generateViewModel.${this._injectionContext?.id}.parent.${!!this.parent}.modelName.${C?.name}`),(0,l.tap)(I=>{p&&(I.dataSchemas[p]=this.dataSchemas[p])}),(0,l.tap)(I=>{I.deactivateBusinessRules()}),(0,l.switchMap)(I=>I.setValue(d,{silent:s?.silent,isMaskedValue:s?.isMaskedValue,preventAttributeChangeRequest:s?.preventAttributeChangeRequest,preventStateChange:s?.preventStateChange,preventRunBusinessRules:s?.preventRunBusinessRules}).pipe((0,l.tap)(()=>C&&C.setLoadedState()),(0,l.map)(()=>I))))});return!u.length&&s?.collectionLoadType===or.Reload&&this.attributes[e].clear(),u.length===0?(0,o.of)(null):(0,o.forkJoin)([...u]).pipe((0,l.tap)(d=>{const p=this.getBoundDataSourceName(e);this.getModelByName(p)?.childrenChange(),this._executeWithOptions(()=>{s?.collectionLoadType===or.Reload||!s?.collectionLoadType?this.attributes[e].reload(d):this.getBoundDataSchema(e)?this._mergeCollectionModels(e,d):this.attributes[e].push(...d)},s)}))}_setSubmodelValues(e,t,s){return(0,o.forkJoin)([...e.filter(r=>t?.[r]).map(r=>this.attributes[r]instanceof Ot?this._setSingleSubmodelValue(r,t,s):this._setCollectionSubmodelValue(r,t,s)),(0,o.of)(this)])}_findAttributePathInDataSourceNameMap(e){for(const t of this._attributesToDataSourceNameMap.keys()){const s=t.indexOf(".");if(s<0)continue;const r=s+1,n=e.length;if(t.startsWith(e,r)&&(t.length===r+n||t.charAt(r+n)==="."))return t}}_getBoundDataSourceAttributeControls(e){return Object.fromEntries(Array.from(this._attributesToDataSourceNameMap.entries()).filter(([t,s])=>s===e).map(([t])=>[t,this.getAttributeControl(t)]))}_resetMaskDataForAttribute(e){this[Pl](e)&&(this.setAttributePropertyValue(e,ln,null),this.setAttributePropertyValue(e,Mi,null),this.setAttributePropertyValue(e,Ri,null))}_staticLoader(e){const t=e[0],s=e[1],r=e[2];this._checkDataSourceName(t);const n=this._getDataSourceLoadType(r?.loadType);return this._loadStaticModel(t,s,n,r?.payload,r?.useLastLoadParameters,r?.doNotUpdateLastLoadParameters).pipe(this._measurePerformanceService.measure$(`ViewModel.loadStaticModel.${this._injectionContext?.id}.parent.${!!this.parent}.datasourceName.${t}`))}_dynamicLoader(e){const t=e[0];return this._loadDynamicModel(t).pipe(this._measurePerformanceService.measure$(`ViewModel.loadDynamicModel.${this._injectionContext?.id}.parent.${!!this.parent}.model.${t.dataSourceName}`))}showLoadMaskAndValidateFields(e){this.maskService.showMask(this.saveModelTaskName,this);const t=this._getBoundDataSourceAttributeControls(e);Object.keys(t).forEach(s=>this.formApiModel.controls[s].updateValueAndValidity())}deleteModel(e,t,s,r){return(0,o.from)(this._modelParametersBuilder.getModelParameters(this,t,r?.payload)).pipe((0,l.switchMap)(n=>s(e,n)))}handleSaveModelStream(e,t){return e.pipe((0,l.finalize)(()=>this.maskService.hideMask(this.saveModelTaskName,this)),(0,l.catchError)(s=>{const r=typeof s=="string"?s:s?.message||s?.errorInfo;return t?.silent===!0?(0,o.of)({success:!1,rowsAffected:0,errorInfo:r}):(0,o.throwError)(()=>new Error(r))}))}_updateLastLoadParameters(e,t,s,r){const n=t===D.Create||t===D.Copy,a=this.dataSchemas[e],u=a.dataSourceConfig?.type===wi.EntityDataSource;if(r.success&&n&&u){const d=a.primaryAttributeName,p=s[d];this._loadedDataSources.add(e),this._lastEventLoadParameters.set(e,[{type:B.PrimaryColumnValue,value:p}])}}getSaveParameters(e,t){return(0,o.forkJoin)({parameters:this._modelParametersBuilder.getModelParameters(this,t),dto:this._getDataSourceDto(e)})}getSaveModelStream$(e){return this.showLoadMaskAndValidateFields(e.dataSourceName),(0,o.from)(this.isValid(e.dataSourceName)).pipe((0,l.switchMap)(t=>{if(!t){const s=this.injector.get(T.TranslateService);return e.getInvalidAction({success:!1,rowsAffected:0,errorInfo:s.instant("HomePage.DialogMessages.RequiredFieldsAreNotFilled")})}return this.getSaveParameters(e.dataSourceName,e.parametersConfig).pipe((0,l.mergeMap)(({parameters:s,dto:r})=>(0,o.forkJoin)({result:e.saveAction(r,s),dto:(0,o.of)(r)})),(0,l.tap)(({result:s,dto:r})=>e.onSavedAction(r,s)),(0,l.map)(({result:s})=>s))}))}_checkDataSourceName(e){if(!e)throw new Error("Data source name is not provided")}innerSave(e,t,s){return(0,o.from)(this.waitAsyncTasksFinish()).pipe((0,l.switchMap)(()=>(this._checkDataSourceName(s),this.getModelMode(s)===D.Delete?t():e())))}initDependencies(){this.formBuilder=this.injector.get(Fe.FormBuilder),this.resourceFinderService=this.injector.get(Fs),this.validatorTypeResolver=this.injector.get(vi),this.maskService=this.injector.get(rm),this.sysSettingsService=this.injector.get(De),this.crtControlStateAdapter=this.injector.get(ss),this._businessRulesEngine=this.injector.get(ks),this._businessRulesApplier=this.injector.get(Ns),this._featureValues=this.injector.get(F),this._modelGenerator=this.injector.get(Zr),this._ngZone=this.injector.get(c.NgZone),this._translateService=this.injector.get(T.TranslateService),this._scopeName=this.injector.get(Ai,null),this._attributeGenerator=this.injector.get(bn),this._attributeResourceGenerator=this.injector.get(Sn),this._crtZoneService=this.injector.get(Dc),this._viewEventZoneName=this.injector.get(Al,Dt.Root),this._modelParametersBuilder=this.injector.get(An),this._context=this.injector.get(Mp,null),this._crtInjectionContextService=this.injector.get(ur),this._viewModelDataDelayerService=this.injector.get(hm,null),this._isDesignTime=this.injector.get(om,null),this._measurePerformanceService=this.injector.get(te.g,null),this._measurePerformancePageLoadService=this.injector.get(_n),this._appInfo=this.injector.get(ke,null)}processRequest(e){return this.handlerChain.process(e)}runInitFlow(e=null){return this._concatModelsWithEmbedded(e).pipe(this._measurePerformanceService.measure$(`ViewModel.runInitFlow.${this._injectionContext?.id}.parent.${!!this.parent}`),(0,l.tap)(t=>this._notifyAboutModelsErrors(t)),(0,l.tap)(t=>this._models$.next(t)),(0,l.tap)(()=>this._initFeaturesStates()),(0,l.mergeMap)(()=>this._generateDataSourcesInfo()),(0,l.tap)(t=>this._updateModels(t)),(0,l.mergeMap)(t=>this._generateAttributesToDataSourceNameMap(t)),(0,l.mergeMap)(t=>this._getDataSchemas()),(0,l.tap)(t=>this.dataSchemas=t),(0,l.mergeMap)(()=>this._initDataSourceValidators()),(0,l.switchMap)(()=>this._initBusinessRules()),(0,l.tap)(()=>{this._initSchemaValidators(this.viewModelConfig.attributes)}),(0,l.mergeMap)(()=>(0,o.forkJoin)([...this._generateResourceAttribute(),this._initSystemAttributes(),this._attributeGenerate(this.viewModelConfig.attributes),(0,o.of)(this),this._initSubscriptions()])),(0,l.mergeMap)(()=>this._generatePrimaryAttributes()),(0,l.tap)(()=>this._loadDefaultSorting()),(0,l.mergeMap)(()=>this._runInitialBusinessRules()),(0,l.tap)(()=>this._viewModelAttributeChangeEventOptions.reset())).pipe((0,l.switchMap)(()=>(0,o.of)(this)))}[Pl](e){return this._attributeConfigs[e]?.isValueMasked??!1}[kp](e){return this.getAttributePropertyValue(e,Mi)}[Lp](e){return this.getAttributePropertyValue(e,Ri)}[Bp](e,t){this.setAttributePropertyValue(e,ln,t)}[Fp](e){return this.getAttributePropertyValue(e,ln)||dn.Unmasked}init(e,t){return this._primaryModelName=t?.primaryModelName,this._modelDependencies=t?.modelDependencies||{},this._modelsLoadingConfig=t?.modelsLoadingConfig||{},this._lastEventLoadParameters=new Map,t?.businessRulesActive||this.deactivateBusinessRules(),this._modelDependencies&&this._handleCircularDependencies(),this._ngZone.runOutsideAngular(()=>this.runInitFlow(e))}setValue(e,t){const s=[],r=[];for(const n of Object.keys(this._attributeConfigs))"viewModelConfig"in this._attributeConfigs[n]||"viewModelName"in this._attributeConfigs[n]?r.push(n):s.push(n);return this._executeWithOptions(()=>{this._measurePerformanceService.measure(`ViewModel.setValue.updateViewModelModelAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.data.${Object.keys(e).toString()}`,()=>{for(const n in e)s.includes(n)&&(this._resetMaskDataForAttribute(n),this.set(n,e[n],{isMaskedValue:t?.isMaskedValue}))})},t),Xs.deferUpdatingValueAndValidity(this,()=>this._setSubmodelValues(r,e,t),this._featureValues)}deactivateBusinessRules(){this._businessRulesActive=!1}activateBusinessRules(){const e=this._businessRulesActive;if(this._businessRulesActive=!0,e)return(0,o.of)(null);const t=this.models.filter(s=>s.isLoaded);if(t.length>0){const s={type:oe.ContextReady,name:null,scopeId:""};return(0,o.forkJoin)(t.map(r=>this._runBusinessRulesForModel(r,[],!0,[s]))).pipe((0,l.tap)(()=>this._businessRulesAreActivated=this._businessRulesProcessingEnabled),(0,l.tap)(()=>this._businessRulesActivated$.next(this._businessRulesAreActivated)))}}_getDependOnModelsNames(e){const t=this._modelDependencies[e];if(!t)return[];const s=t.map(r=>r.relationPath.split(".")[0]);return[...new Set(s)]}_getModelDependencies(e){return this._modelDependencies[e]??[]}_getIsAffectedByBusinessRules(e){if(!this._businessRulesProcessingEnabled)return Promise.resolve(!1);const t=e.name,s=this._attributesAffectedByBusinessRules;if(s.length===0||!t)return Promise.resolve(!1);const r=s.some(d=>d.name===t),n=this.getBoundDataSchemaByAttributePath(t),a=this.getBoundDataSchemaAttributeByAttributePath(t);if(!a)return Promise.resolve(r);const u=s.filter(d=>d.scopeName===n.name).some(d=>d.name===a.name);return Promise.resolve(u||r)}executeRequest(e){return e.scopes=e.scopes||this._eventScopes,this._crtZoneService.runInZone(this._viewEventZoneName,()=>this.processRequest(e))}getAttributeControl(e){let t=this.formApiModel;pm(this,e).then(P.noop);for(const s of e.split("."))t=t.get(s);return t??new Fe.FormControl}loadLookupList(e,t=[],s){const r=e.control,n=e.items,a=this._getDataSourceInfoByViewModelAttributePath(n);if(a){const u=this._ngZone.runOutsideAngular(()=>this.processRequest({type:"crt.LoadDataRequest",$context:this,dataSourceName:a.name,parameters:t,config:{payload:s}}));Promise.resolve(u)}else{const u=this._getDataSourceInfoByViewModelAttributePath(r);if(u){const d=u.getDataSourceAttributePath(r);(0,o.forkJoin)([this._getDropdownPageSize(),this._modelParametersBuilder.getModelParameters(this,t,s)]).pipe((0,l.mergeMap)(([p,g])=>this.getModelByName(u.name).loadLookupList(d,g,p)),(0,l.map)(p=>gt.getLookupListDataSourceInfo(n,{value:p.primaryAttributeName,displayValue:p.primaryDisplayAttributeName}).getModelDto(p.data)),(0,l.mergeMap)(p=>this.setValue(p,{silent:!0}))).subscribe()}}}load(...e){const t=this._disableViewModelLoadUnblockingThread?(0,o.of)(null):(0,o.timer)(0,o.asyncScheduler),s=typeof e[0]=="string"?this._staticLoader(e):this._dynamicLoader(e);return t.pipe((0,l.switchMap)(()=>this.__destroyed?(0,o.of)([]):s))}setSorting(e,t){const r=this._dataSourcesInfos.get(e).getSortingConfig(),n=r&&r.attributeName;return n&&(this[n]=t),(0,o.of)(null)}create(e,t){return this._checkDataSourceName(e),this._createModelData(e,t)}copy(e,t,s){return this._checkDataSourceName(e),this._copyModelData(e,t,s)}loadDefaultValues(e){return this._setAttributesDefaultValues(e)}save(e,t,s){return this.innerSave(()=>this._saveModel(e,t,s),()=>this.delete(e,t,s),e)}delete(e,t,s){return this._checkDataSourceName(e),this.deleteModel(e,t,(r,n)=>this.getModelByName(r).delete(n),s)}resume(){return(0,o.of)(void 0)}pause(){return(0,o.of)(void 0)}destroy(){this._subscriptions.unsubscribe(),Array.from(this._collectionSubscription.values()).forEach(t=>t.unsubscribe()),this._collectionSubscription.clear(),this._crtControls.forEach(t=>{t.destroy()}),this.models?.forEach(t=>t.destroy()),this._crtControls.clear(),this._eventsSubject$.complete(),this._replayEvents$.complete(),this._modelLoaded$.complete();const e=[];for(const t of Object.values(this.attributes))t instanceof Ot&&e.push(t.destroy()),t instanceof ft&&e.push((0,o.from)(t.destroy()));return(0,o.forkJoin)(e).pipe((0,l.defaultIfEmpty)(void 0),(0,l.map)(()=>{}),(0,l.finalize)(()=>{this.parent||(this._crtInjectionContextService.removeContext(this._injectionContext?.id),us(this._injectionContext),this._context=null,this._viewModelDataDelayerService?.destroy(),this._viewModelDataDelayerService=null),this._asyncTasksExecutingSubject.complete(),this._dataSourcesInfos.clear(),this.__destroyed=!0,this._destroySubject.next(),this._destroySubject.complete()}))}getBoundDataSourceName(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(t!==null)return t;if(!e)return null;const s=this._findAttributePathInDataSourceNameMap(e);return this.getBoundDataSourceNameByAttributePath(s)}getBoundDataSourceAttributeControls(e){return Object.values(this._getBoundDataSourceAttributeControls(e))}getBoundDataSourceNameByAttributePath(e){return this._attributesToDataSourceNameMap.get(e)??null}getBoundDataSchema(e){return this.dataSchemas[this.getBoundDataSourceName(e)]}getBoundDataSchemaByAttributePath(e){return this.dataSchemas[this.getBoundDataSourceNameByAttributePath(e)]??null}getBoundDataSchemaAttributeByAttributePath(e){const t=this.getBoundDataSourceNameByAttributePath(e),s=this.getBoundDataSchemaByAttributePath(e),r=this._getDataSourceInfoByViewModelAttributePath(e);if(!t||!s||!r)return null;const n=r.getDataSourceAttributePath(e);return s.findAttributeByName(n)}getPrimaryModelName(){return Promise.resolve(this._primaryModelName)}getPrimaryDataSchema(){return this.getPrimaryModelName().then(e=>this.dataSchemas[e])}isValid(e){const t=this._waitAsyncValidation().pipe((0,l.map)(()=>e?this.getBoundDataSourceAttributeControls(e).every(s=>!s.invalid):this.formApiModel.valid));return(0,o.lastValueFrom)(t)}validate(e){return this._ngZone.run(()=>e?this._validateByDataSourceName(e):this._validateAll())}getViewModelAttributePath(e,t){const s=this._dataSourcesInfos.get(e);return this._getMappedAttributeName(s,t)}getViewModelAttributePaths(e,t){return this._dataSourcesInfos.get(e)?.getMappedAttributeNames(t)}getCollectionViewModelAttributePath(e){return this._dataSourcesInfos.get(e)?.collectionViewModelAttributeName}canDelete(e,t){var s=this;return(0,S.A)(function*(){return s.getModelByName(e).canDelete(t)})()}canSave(e,t){var s=this;return(0,S.A)(function*(){return s.getModelByName(e).canSave(t)})()}enableAttributeValidator(e,t){this.getControl(e).enableValidator(t)}disableAttributeValidator(e,t){this.getControl(e).disableValidator(t)}_hotSwap(e){return this._measurePerformanceService.measure(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap`,()=>{const t=e?.attributes?.changed||[],s=(0,P.isEmpty)(e.resources?.strings);if((0,P.isEmpty)(t)&&s)return(0,o.of)(!1);s||(this.resources={strings:this._getChangedResourcesStrings(e.resources.strings)}),this.viewModelConfig=e.actualViewModelConfig;const r=gt.getFromViewModelConfig(this.viewModelConfig),n=Object.fromEntries(t.map(C=>[C,this.viewModelConfig.attributes[C]])),a=e?.models?.changed??[],u=a.map(C=>C.name),d=this.models.filter(C=>C.isLoaded||C.isLoading).filter(C=>u.includes(C.name)).map(C=>C.name),p=a.map(C=>{const I=r.get(C.name);return this._upsertModel(C.name,C),this._replaceDataSourceInfo(C.name,I),this._addDataSchemaToDataSchemas(C)}),g=this._attributeGenerate$(n,{disableDefaultConfig:!0});return(0,o.forkJoin)([...p,g]).pipe(this._measurePerformanceService.measure$(`ViewModel.generatePrimaryAttributes.${this._injectionContext?.id}.parent.${!!this.parent}.hotSwap.forkJoin`),(0,l.switchMap)(()=>this._reGenerateResourcesAttributes()),(0,l.tap)(()=>this._loadDefaultSorting(u)),(0,l.tap)(()=>this._requestReloadModels(d)),(0,l.map)(()=>!0))})}set(e,t,s){return this._setAttributeValue(e,t,s),Promise.resolve()}_markAsPristine(e){this._forEachControl(e,t=>{t.markAsPristine()})}getAttributeNameByViewItemName(e){return Object.keys(this._attributeConfigs).find(t=>this._attributeConfigs[t].viewItemName===e)}getControl(e){return this._crtControls.has(e)?this._crtControls.get(e):Ni.create({name:e,value:null,propertiesConfig:[],featureValues:this._featureValues})}getAttributePropertyValue(...e){let t,s;if(e.length===2)t=e[0],s=e[1];else if(e.length===1){const n=e[0].split(":");t=n[0],s=n[1]}else throw new Error("ArgumentException");return this.getControl(t).getPropertyValue(s)}setAttributePropertyValue(...e){let t,s,r;if(e.length===3)t=e[0],s=e[1],r=e[2];else if(e.length===2){const a=e[0].split(":");t=a[0],s=a[1],r=e[1]}else throw new Error("ArgumentException");return this.getControl(t).setPropertyValue(s,r)}resetAttributePropertyValue(...e){let t,s;if(e.length===1)[t,s]=e[0].split(":");else if(e.length===2)t=e[0],s=e[1];else throw new Error("ArgumentException");this.getControl(t).getPropertyByName(s)?.resetValue()}getInvariabilityPropertyName(e){return this.getControl(e).getInvariabilityPropertyName()}setModelValues(e,t){return this.getModelByName(e).setValue(t)}_getBoundAttributesNames(e){const t=this.getBoundDataSourceNameByAttributePath(e);if(!t)return null;const s=this._dataSourcesInfos.get(t),r=s.attributesMap.get(e);return Array.from(s.attributesMap.entries()).filter(([n,a])=>a===r&&n!==e).map(([n])=>n)}_getAttributeDataValueTypeName(e){return this._attributeConfigs[e].dataValueTypeName}getDataSourceLoadParameters(e,t){const s=this._dataSourcesInfos.get(e);return s?this._modelParametersBuilder.getModelLoadParameters(this,s,[],he.Load,{modelLoadConfiguration:t}).then(([r,n,a,u])=>({parameters:r,options:{pagingConfig:n,sortingConfig:a,hierarchyConfig:u}})):null}getAttributeViewModelConfig(e){return this._attributeConfigs[e]?.viewModelConfig?.attributes}isDataSourceForCollection(e){return!!this._dataSourcesInfos.get(e)?.isCollection}_getDataSourceAttributeDataValueType(e){const t=this._getDataSourceInfoByViewModelAttributePath(e);let s=null;if(t){const r=t.getDataSourceAttributePath(e);r&&(s=this._getDataSourceAttributeSchema(t,r)?.dataValueType)}return s}_getModelNamesByLoadType(e){return Object.entries(this._modelsLoadingConfig).filter(([t,s])=>s.type===e).map(([t,s])=>t)}_reloadDependentModels(e,t=[],s=null){const r=this._getDependentModelsForLoad(e,t);this._requestReloadModels(r.filter(n=>{const a=es(this.getModelByName(n));return!s||a&&s===Oe.Page||!a&&s===Oe.ViewElement}))}_getDependentModelsForLoad(e,t=[]){const s=this._getDependentModelsNames(e.name,t),r=this._getChangedModelsNames(s).filter(n=>!es(this.getModelByName(n)));return r.length!==0&&this._showNotification({message:"BaseViewModel.RefreshModelDataConflict"}),s.filter(n=>!r.includes(n)).filter(n=>this._modelsRequestedToLoad.has(n)||es(this.getModelByName(n)))}_getDataSourceAttributeCaption(e,t){let s=this.resourceFinderService.findLocalizableValue(t);const r=this._getDataSourceInfoByViewModelAttributePath(e);if(s==null&&r){const n=r.getDataSourceAttributePath(e),a=n?this._getDataSourceAttributeSchema(r,n):"";s=a?a.caption:this._translateService.instant("BaseViewModel.DataSourceAttributeRemoved")}return s}getIsDirty(e){return this.getControl(e).isDirty}getModelByName(e){return this._modelsMap.get(e)}getModelMode(e){return this.getModelByName(e)?.mode}getPrimaryModelMode(){return this.getModelMode(this._primaryModelName)}_getModelModeChanges(e){return this.getModelByName(e)?._modeChanges$}_getPrimaryModelModeChanges(){return this._getModelModeChanges(this._primaryModelName)}markModelFor(e,t){this.getModelByName(e)?.markFor(t)}markPrimaryModelFor(e){this.markModelFor(this._primaryModelName,e)}_setStateAttribute(e){this._setSystemAttributeValue(Vi,e)}_onAsyncTaskStarted(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.add(e),this._asyncTasksExecutingSubject.next(t)}_onAsyncTaskFinished(e){if(this._disableViewModelWaitingForAsyncTasks)return;const t=this._asyncTasksExecutingSubject.value;t.delete(e),this._asyncTasksExecutingSubject.next(t)}waitAsyncTasksFinish(){let e;return(0,o.firstValueFrom)(this._asyncTasksExecutingSubject.pipe((0,l.tap)(t=>{clearTimeout(e),e=this._handleAsyncTasksCycle(t)}),(0,l.filter)(t=>t.size===0),(0,l.take)(1),(0,l.map)(()=>{})))}destroyModel(e){const t=this.getModelByName(e);t&&t.destroy();const s=this.models.filter(r=>r.name!==e);this._models$.next(s),this._dataSourcesInfos.delete(e),[...this._attributesToDataSourceNameMap.entries()].filter(([r,n])=>e===n).forEach(([r])=>this._attributesToDataSourceNameMap.delete(r))}}class fm extends Ot{_getTransactionalModelByName(e){const t=this.getModelByName(e);if(!(t instanceof Yn))throw new Error(`Model with name "${e}" is not a TransactionalModel.`);return t}_saveModelInTransaction(e,t,s,r){const n=this._getTransactionalModelByName(e),a=n.mode;return this.getSaveModelStream$({dataSourceName:e,parametersConfig:t,saveAction:(u,d)=>(0,o.of)(n.insertOrUpdateInTransaction(r,u,d)),onSavedAction:(u,d)=>{d.payload.dto=u,d.payload.modelMode=a},getInvalidAction:u=>(0,o.of)(r.createFailureOperation(u))})}saveInTransaction(e,t,s,r){return this.innerSave(()=>this._saveModelInTransaction(e,t,s,r),()=>this.deleteInTransaction(e,t,s,r),e)}deleteInTransaction(e,t,s,r){return this._checkDataSourceName(e),this.deleteModel(e,t,(n,a)=>{const u=this._getTransactionalModelByName(n);return(0,o.of)(u.deleteInTransaction(r,a))},s)}commitTransaction(e,t,s,r){const n=(0,o.from)(r.asyncResult).pipe((0,l.tap)(a=>{const u=r.payload.modelMode,d=r.payload.dto;this._updateLastLoadParameters(e,u,d,a)}));return this.handleSaveModelStream(n,s)}}class dr{constructor(e){this._featureValues=e,this.viewModelConstructor=null}_getViewModelConstructor(){return this.viewModelConstructor?this.viewModelConstructor:this._featureValues?.["DataSource-DisableTransactions"]?Ot:fm}static useClass(e){return new class extends dr{constructor(){super(...arguments),this.viewModelConstructor=e}}(null)}create(e,t,s,r,n,a,u,d){const p=this._getViewModelConstructor();return new p(e,t,s,r,n,a,u,d)}static{this.\u0275fac=function(t){return new(t||dr)(c.\u0275\u0275inject(F,8))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:dr,factory:dr.\u0275fac,providedIn:"root"})}}class hr extends ns{constructor(){super(...arguments),this._lifecycleHooksRequests={init:Ec,resume:Mc,pause:Rc,destroy:Ic},this.handlerChain=Se.instance}_processRequest(e,t,s){return this.ngZone.runOutsideAngular(()=>this.sendRequest({...e,scopes:s,$context:t}))}_processViewModelAttributeChanges(e,t){e.events$.pipe((0,l.filter)(s=>s.type===_e.ChangeAttributeValue&&!s.payload?.preventAttributeChangeRequest)).subscribe({next:s=>{const r=`${mt.ProcessingAttributeChangeRequest}-${(0,j.qv)()}`;e._onAsyncTaskStarted(r),this._processRequest(new vc(s.payload),e,t).then(()=>e._onAsyncTaskFinished(r))}})}_generateFromConfig(e,t){const s=t||this.injector,{viewModelConfig:r,modelConfig:n,resources:a,models:u,scopes:d,modelInitConfigs:p,modelConfig:{primaryDataSourceName:g}={},parentViewModel:C,businessRulesActive:I}=e,W=this.viewModelFactory.create(this,s,this._trimEmptyAttributes(r),a,null,d,p,C);return this._featureValues?.DisableImmediateModelLifecycleContext||W._injectionContext?.inject(ar,null)?.setContext(W),this.generateLifecycleHooks(W,e),this._processViewModelAttributeChanges(W,d),W.init(u,{modelDependencies:n?.dependencies,primaryModelName:g,modelsLoadingConfig:n?.loadingConfig,businessRulesActive:I})}_trimEmptyAttributes(e){const t=e?.attributes??{};return Object.keys(t).forEach(s=>{t[s]||delete t[s]}),{...e,attributes:t}}_generateFromString(e,t){return this.repository.resolveModelConfig(e.viewModelConfig).pipe((0,l.switchMap)(s=>this._generateFromConfig({...e,viewModelConfig:s},t)))}initDependencies(){super.initDependencies(),this._featureValues=this.injector.get(F),this.viewModelFactory=this.injector.get(dr)}generateLifecycleHooks(e,t){Object.entries(this._lifecycleHooksRequests).forEach(([s,r])=>{e[s]=new Proxy(e[s],{apply:(n,a,u)=>{const d=n.apply(a,u);if(!(d instanceof o.Observable))throw new Error(`Method ${s} should return Observable`);return d.pipe((0,l.switchMap)(p=>(0,o.from)(this._processRequest(new r,e,t.scopes)).pipe((0,o.map)(()=>p))))}})})}sendRequest(e){return this.handlerChain.process(e)}generate(e,t){const s=t?.get(te.g);return typeof e.viewModelConfig=="string"?s?this._generateFromString(e,t).pipe(s.measure$("viewModelGenerator.generateFromString")):this._generateFromString(e,t):s?this._generateFromConfig(e,t).pipe(s.measure$("viewModelGenerator.generateFromConfig")):this._generateFromConfig(e,t)}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(hr)))(s||hr)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:hr,factory:hr.\u0275fac,providedIn:"root"})}}em();let vn=class Fc{static{this.\u0275fac=function(t){return new(t||Fc)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:Fc})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[Rt,Ms,Zr,ss,ut,{provide:ns,useClass:hr},{provide:rs,useClass:pn},{provide:Qs,useClass:er},We.vn,ct,Fs,$p,{provide:vi,useClass:mn},{provide:Al,useValue:Dt.Root},{provide:pp,useValue:io.instance},jp,Zs,Ys,fp,yp],imports:[w.CommonModule,Fe.ReactiveFormsModule,fn,an,Us,T.TranslateModule]})}};vn=(0,h.__decorate)([Uu({includes:[Us],requestHandlers:[lo,ho,po,go,_o,yo,bo,So,vo,Eo,Mo,Ro,Io],validators:[Po,Do,To,No,xo,Ei,Vo,Oo,ko,Lo,Bo]})],vn),function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(vn,{imports:[w.CommonModule,Fe.ReactiveFormsModule,fn,an,Us,T.TranslateModule]})}();class pr{static{this.\u0275fac=function(t){return new(t||pr)}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:pr})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[It,We.vn,At],imports:[Ps,vn,tn]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(pr,{declarations:[Xr],imports:[Ps,vn,tn]})})();class En{_buildRequestUrl(e){return this._isAbsoluteUrl(e)?e:w.Location.joinWithSlash(this.getUrl(),e)}_isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}getUrl(){return Bn()}intercept(e,t){return e=e.clone({url:this._buildRequestUrl(e.url)}),t.handle(e).pipe((0,l.catchError)(s=>(console.log(s),(0,o.throwError)(s))))}static{this.\u0275fac=function(t){return new(t||En)}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:En,factory:En.\u0275fac})}}class mr extends En{getUrl(){return bt()}static{this.\u0275fac=(()=>{let e;return function(s){return(e||(e=c.\u0275\u0275getInheritedFactory(mr)))(s||mr)}})()}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:mr,factory:mr.\u0275fac})}}class Mn extends T.TranslateLoader{constructor(e){super(),this._nestedTranslateLoader=e}_getDefaultTranslation(){return{ErrorListDialogService:{CodeErrorListDialogCaption:"Compilation errors",FileNameColumn:"File name",ErrorTextColumn:"Description",ErrorNumberColumn:"Code",LineColumn:"Line",CodeValidationErrorListDialogCaption:"Cyclic dependencies detected",SourceColumn:"Element that references",ReferenceColumn:"Element being referenced",TypeColumn:"Element type",PackageColumn:"Package",AcademyHelpUrlCaption:" Learn more in the Academy"},TableDialog:{Close:"Close"}}}_getRussianTranslation(){return{ErrorListDialogService:{CodeErrorListDialogCaption:"\u041E\u0442\u0447\u0435\u0442 \u043E\u0448\u0438\u0431\u043E\u043A \u043A\u043E\u043C\u043F\u0438\u043B\u044F\u0446\u0438\u0438",FileNameColumn:"\u0418\u043C\u044F \u0444\u0430\u0439\u043B\u0430",ErrorTextColumn:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",ErrorNumberColumn:"\u041A\u043E\u0434",LineColumn:"\u0421\u0442\u0440\u043E\u043A\u0430",CodeValidationErrorListDialogCaption:"\u041E\u0448\u0438\u0431\u043A\u0430: \u0446\u0438\u043A\u043B\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C \u0437\u0430\u0432\u0438\u0441\u0438\u043C\u043E\u0441\u0442\u0438 \u043F\u0430\u043A\u0435\u0442\u043E\u0432",SourceColumn:"\u0418\u0441\u0442\u043E\u0447\u043D\u0438\u043A",ReferenceColumn:"\u0421\u0441\u044B\u043B\u043A\u0430",PackageColumn:"\u041F\u0430\u043A\u0435\u0442",AcademyHelpUrlCaption:" \u041F\u043E\u0434\u0440\u043E\u0431\u043D\u0435\u0435 \u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0432 \u0410\u043A\u0430\u0434\u0435\u043C\u0438\u0438"},TableDialog:{Close:"\u0417\u0430\u043A\u0440\u044B\u0442\u044C"}}}getTranslation(e){let t=this._getDefaultTranslation();return e==="ru-RU"&&(t=Object.assign(t,this._getRussianTranslation())),(this._nestedTranslateLoader?this._nestedTranslateLoader.getTranslation(e):(0,o.of)({})).pipe((0,o.map)(s=>Object.assign(t,s)))}static{this.\u0275fac=function(t){return new(t||Mn)(c.\u0275\u0275inject(au,8))}}static{this.\u0275prov=c.\u0275\u0275defineInjectable({token:Mn,factory:Mn.\u0275fac})}}const gm=_.p+"assets/i18n/libs/";function _m(i,e){return()=>(0,o.lastValueFrom)(i.loadCurrentUserInfo().pipe((0,l.switchMap)(t=>e.use(t?.userInfo?.cultureInfo?.sysCultureName).pipe((0,l.catchError)(()=>(0,o.of)(null))))),{defaultValue:null})}class Rn{constructor(e,t,s){this._injector=e,this._customElementsBootstrapService=t,this._translateService=s}ngDoBootstrap(){this._translateService.use(this._translateService.defaultLang).subscribe(()=>{this._customElementsBootstrapService.defineComponent("ts-error-list-dialog-proxy",Xr,this._injector)})}static{this.\u0275fac=function(t){return new(t||Rn)(c.\u0275\u0275inject(c.Injector),c.\u0275\u0275inject(O.SH),c.\u0275\u0275inject(T.TranslateService))}}static{this.\u0275mod=c.\u0275\u0275defineNgModule({type:Rn})}static{this.\u0275inj=c.\u0275\u0275defineInjector({providers:[O.rK,{provide:c.APP_INITIALIZER,useFactory:_m,deps:[We.fv,T.TranslateService],multi:!0},M,b,We.vn,{provide:w.APP_BASE_HREF,useValue:"/"},{provide:N.HTTP_INTERCEPTORS,useClass:mr,multi:!0},rd,ed,(0,N.provideHttpClient)((0,N.withInterceptorsFromDi)(),(0,N.withXsrfConfiguration)({cookieName:q,headerName:q}))],imports:[y.BrowserModule,V.BrowserAnimationsModule,_r.forNested({defaultLanguage:"en-US",useDefaultLang:!0,loader:{provide:T.TranslateLoader,useClass:Mn},resourceSources:[{prefix:gm,suffix:".json"}]}),$.RouterModule.forRoot([],{}),pr]})}}(function(){(typeof ngJitMode>"u"||ngJitMode)&&c.\u0275\u0275setNgModuleScope(Rn,{imports:[y.BrowserModule,V.BrowserAnimationsModule,T.TranslateModule,$.RouterModule,pr]})})(),y.platformBrowser().bootstrapModule(Rn).catch(i=>console.error(i))},86464:(x,K,_)=>{_.d(K,{r:()=>y});var y;(function(m){m[m.Guid=0]="Guid",m[m.Text=1]="Text",m[m.Integer=4]="Integer",m[m.Float=5]="Float",m[m.Money=6]="Money",m[m.DateTime=7]="DateTime",m[m.Date=8]="Date",m[m.Time=9]="Time",m[m.Lookup=10]="Lookup",m[m.Enum=11]="Enum",m[m.Boolean=12]="Boolean",m[m.Blob=13]="Blob",m[m.Image=14]="Image",m[m.CUSTOM_OBJECT=15]="CUSTOM_OBJECT",m[m.IMAGELOOKUP=16]="IMAGELOOKUP",m[m.COLLECTION=17]="COLLECTION",m[m.Color=18]="Color",m[m.LOCALIZABLE_STRING=19]="LOCALIZABLE_STRING",m[m.ENTITY=20]="ENTITY",m[m.ENTITY_COLLECTION=21]="ENTITY_COLLECTION",m[m.ENTITY_COLUMN_MAPPING_COLLECTION=22]="ENTITY_COLUMN_MAPPING_COLLECTION",m[m.HASH_TEXT=23]="HASH_TEXT",m[m.SECURE_TEXT=24]="SECURE_TEXT",m[m.FILE=25]="FILE",m[m.MAPPING=26]="MAPPING",m[m.SHORT_TEXT=27]="SHORT_TEXT",m[m.MEDIUM_TEXT=28]="MEDIUM_TEXT",m[m.MAXSIZE_TEXT=29]="MAXSIZE_TEXT",m[m.LONG_TEXT=30]="LONG_TEXT",m[m.FLOAT1=31]="FLOAT1",m[m.FLOAT2=32]="FLOAT2",m[m.FLOAT3=33]="FLOAT3",m[m.FLOAT4=34]="FLOAT4",m[m.LOCALIZABLE_PARAMETER_VALUES_LIST=35]="LOCALIZABLE_PARAMETER_VALUES_LIST",m[m.METADATA_TEXT=36]="METADATA_TEXT",m[m.STAGE_INDICATOR=37]="STAGE_INDICATOR",m[m.OBJECT_LIST=38]="OBJECT_LIST",m[m.COMPOSITE_OBJECT_LIST=39]="COMPOSITE_OBJECT_LIST",m[m.FLOAT8=40]="FLOAT8",m[m.FILE_LOCATOR=41]="FILE_LOCATOR",m[m.PHONE_TEXT=42]="PHONE_TEXT",m[m.RICH_TEXT=43]="RICH_TEXT",m[m.WEB_TEXT=44]="WEB_TEXT",m[m.EMAIL_TEXT=45]="EMAIL_TEXT",m[m.COMPOSITE_OBJECT=46]="COMPOSITE_OBJECT",m[m.FLOAT0=47]="FLOAT0",m[m.MONEY0=48]="MONEY0",m[m.MONEY1=49]="MONEY1",m[m.MONEY3=50]="MONEY3"})(y||(y={}))},6530:(x,K,_)=>{_.d(K,{gZ:()=>V,n7:()=>c,qv:()=>N});const y="00000000-0000-0000-0000-000000000000",m=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");function w($){let T="";for(let q=0;q<$;q++)T+=((1+Math.random())*65536|0).toString(16).substring(1);return T}function N(){return[w(2),w(1),w(1),w(1),w(3)].join("-")}function c($){return!!$&&m.test($)}function V($){return!$||$===y}},23176:(x,K,_)=>{_.d(K,{Vx:()=>R,op:()=>qc,SH:()=>Lt,gX:()=>qi,sj:()=>Bt,$A:()=>Hi,rK:()=>zi,ZP:()=>os,Bo:()=>Ji,Ny:()=>Kc,S:()=>et,BB:()=>zc,hk:()=>Gc,BV:()=>Zc,DH:()=>Wc,pR:()=>Jc});var y=_(67057),m=_(22307),w=_(62278),N=_(36486);const c=new m.InjectionToken("CustomEventApplicationIdToken"),V=new m.InjectionToken("CustomEventServiceToken");class ${constructor(o,b=null){this.document=o,this.appId=b,this.customEventName="TSCustomEventChannel",this.appId=b||Math.random().toString()}subscribe(o){return this.customEventObserver$=this.customEventObserver$||(0,w.fromEvent)(document,this.customEventName),this.customEventObserver$.pipe((0,N.filter)(b=>b.detail.eventName===o&&b.detail.sender!==this.appId),(0,N.map)(b=>b.detail.payload))}createOutboundChannel(o){const b=new w.Subject;return b.asObservable().subscribe(M=>{const h=new CustomEvent(this.customEventName,{detail:{eventName:o,sender:this.appId,payload:M}});this.document.dispatchEvent(h)}),b}getDataViaEvent(o,b={}){return new w.Observable(M=>{this.subscribe(o).pipe((0,N.first)()).subscribe(h=>{M.next(h),M.complete()}),this.createOutboundChannel(o).next(b)})}getDataStreamViaEvent(o,b={}){return new w.Observable(M=>{const h=this.subscribe(o).subscribe(F=>{M.next(F)},w.noop,()=>M.complete());return this.createOutboundChannel(o).next(b),()=>{h.unsubscribe()}})}static{this.\u0275fac=function(b){return new(b||$)(m.\u0275\u0275inject(y.DOCUMENT),m.\u0275\u0275inject(c,8))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:$,factory:$.\u0275fac,providedIn:"root"})}}var T=_(34268),q=_.n(T);const ue="(?=^.{1,250}$)^[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?\\.)+[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9](?:[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9-]*[\u0430-\u044F\u0410-\u042Fa-zA-Z0-9])?$",Ie=()=>new RegExp(ue,"g"),pe=()=>new RegExp(CONTAINS_EMAIL_PATTERN,"g");function O(E){return Ie().test(E)}function S(E){return CONTAINS_EMAIL_REGEXP().test(E)}const j={name:"uponSanitizeElement",func:(E,o)=>{const b=o.tagName;O(b)&&E.insertAdjacentText("afterbegin",`<${b}>`)}},qe={name:"afterSanitizeAttributes",func:(E,o)=>{const b=window?.location?.origin;if(E.nodeName==="A"&&!E.getAttribute("href")?.toLowerCase().startsWith(b)){E.setAttribute("target","_blank");let M=E.getAttribute("rel")||"";["noopener","noreferrer"].forEach(h=>{M.includes(h)||(M+=" "+h)}),E.setAttribute("rel",M.trim())}}},P=new m.InjectionToken("Represents a DOM purifier",{factory:()=>(q().addHook(j.name,j.func),q().addHook(qe.name,qe.func),q()),providedIn:"platform"});function Ae(E){return E?Array.isArray(E)?E:[E]:[]}function ve(E){return E||{}}function we(){}function et(){return()=>{}}var as=_(26714);class tt{static create(o){return new o}}class le{constructor(){this.speechResult=new w.Subject,this.speechEnd=new w.Subject}static _getInternalApiClass(){return window.SpeechRecognition||window.webkitSpeechRecognition}static isSupported(){return le._getInternalApiClass()!==void 0}_subscribeEvents(){this._internalApi.addEventListener("result",this.onResult.bind(this)),this._internalApi.addEventListener("speechend",this.onSpeechEnd.bind(this))}_unsubscribeEvents(){this._internalApi.removeEventListener("result",this.onResult),this._internalApi.removeEventListener("speechend",this.onSpeechEnd)}init(o){const b=le._getInternalApiClass();this._internalApi=tt.create(b),this._internalApi.continuous=!0,this._internalApi.lang=o.lang||"en-US",this._subscribeEvents()}onResult(o){const{resultIndex:b,results:M}=o,h=M[b][0];if(!h)throw new Error("No results to transcript");this.speechResult.next(h.transcript)}onSpeechEnd(){this.speechEnd.next()}destroy(){this._unsubscribeEvents(),this._internalApi=null}startRecognition(){this._internalApi.start()}stopRecognition(){this._internalApi.stop()}static{this.\u0275fac=function(b){return new(b||le)}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:le,factory:le.\u0275fac})}}var f=_(73436);class v{get messages$(){return this._messages$}constructor(o,b){this._ngZone=b;const M=new w.Subject;this._messages$=M.pipe(this._runInZone(this._ngZone)),this._broadcastChannel=new f.BroadcastChannel(o),this._broadcastChannel.onmessage=h=>M.next(h)}_runInZone(o){return b=>new w.Observable(M=>{b.subscribe(h=>o.run(()=>M.next(h)))})}publish(o){return(0,w.from)(this._broadcastChannel.postMessage(o))}}class R{constructor(o){this._ngZone=o}createInstance(o){return new v(o,this._ngZone)}static{this.\u0275fac=function(b){return new(b||R)(m.\u0275\u0275inject(m.NgZone))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:R,factory:R.\u0275fac,providedIn:"root"})}}class k{static toColdObservable(o){return new Observable(b=>{o().subscribe(h=>{b.next(h),b.complete()})})}}class J{log(o,b,...M){console.log(o,...M)}warn(o,b,...M){console.warn(o,...M)}error(o,b,...M){console.error(o,...M)}exception(o,b,...M){(console.exception||console.error)(o,...M)}static{this.\u0275fac=function(b){return new(b||J)}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:J,factory:J.\u0275fac})}}const Ee={dataAccess:"data-access",feature:"feature",ui:"ui",util:"util",components:"components",deprecated:"deprecated"},_t={studioFree:"studio-free",studioEnterprise:"studio-enterprise",sdk:"sdk"};var st=_(73308);class kt{constructor(o,b,M=null){this._injector=o,this._registrationMap=b,this._defaultInstanceType=M}_getInstance(o,b,M){return b?"injectable"in b&&b.injectable!=null?M.get(b.injectable):"useFactory"in b&&typeof b.useFactory=="function"?b.useFactory(o):"useValue"in b?b.useValue:null:null}_getDefaultInstance(o,b){return this._getInstance(o,this._defaultInstanceType,b)}_getInstanceByType(o,b){if(this._registrationMap.has(o)){const M=this._registrationMap.get(o);return this._getInstance(o,M,b)}}_getInstanceByPredicate(o,b){for(const[M,h]of this._registrationMap){if(typeof M!="function")continue;if(M(o,this._injector))return this._getInstance(o,h,b)}}_getInstanceByPredicateAsync(o,b){var M=this;return(0,st.A)(function*(){for(const[h,F]of M._registrationMap){if(typeof h!="function")continue;const ce=h(o,M._injector);if(ce instanceof Promise?yield ce:ce)return M._getInstance(o,F,b)}return null})()}create(o=null,b){const M=b??this._injector;return o==null?this._getDefaultInstance(o,M):this._getInstanceByType(o,M)??this._getInstanceByPredicate(o,M)??this._getDefaultInstance(o,M)}createAsync(){var o=this;return(0,st.A)(function*(b=null,M){const h=M??o._injector;return b==null?o._getDefaultInstance(b,h):o._getInstanceByType(b,h)??(yield o._getInstanceByPredicateAsync(b,h))??o._getDefaultInstance(b,h)}).apply(this,arguments)}static{this.\u0275fac=function(b){m.\u0275\u0275invalidFactory()}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:kt,factory:kt.\u0275fac,providedIn:"root"})}}var Ui=_(28399);class qi{static _createMappings(o){const b=new Map;return o=o??[],o.forEach(M=>{const h=M.predicate,F=(0,Ui.omit)(M,"predicate");b.set(h,F)}),b}static create(o){const{mappings:b,default:M,token:h,predicateToken:F}=o??{};return{provide:h,useFactory:z=>{const ce=F?z.get(F,[],{optional:!0}):[],ge=this._createMappings([...b??[],...ce??[]]);return new kt(z,ge,M)},deps:[m.Injector]}}static createForPredicates(o){const{mappings:b,predicateToken:M}=o??{};return!M&&!b?.length?[]:b.map(h=>({provide:M,useValue:h,multi:!0}))}}function Dn(E){return Array.isArray(E)?E:[E]}function jc(E,o){return o.forEach(({replaceMacros:b,replaceValue:M})=>{E=E.map(h=>h===b?M??"":h)}),E}function Jl(E,o){if(!E)return"";if(!o)return E;let b=[E];return o=Dn(o),b=$c(b,o),b=jc(b,o),b.join("")}function $c(E,o){if(!E)return[];let b=Dn(E);if(!o)return b;const M=Dn(o),h=M.map(({replaceMacros:F})=>F);return M.forEach(({searchValue:F,replaceMacros:z})=>{if(F&&z){const ce=new RegExp(`(${z})`,"g"),ge=b.map(te=>h.includes(te)?te:te.split(F).join(z).split(ce));b=flatten(ge)}}),b}var Uc=_(4930);function qc(E){return function(o){Reflect.defineMetadata("requestType",E.requestType,o)}}function Hc(E){return o=>{const b=o.pipe(share()),M=b.pipe(tap(E),take(1));return concat(M,b)}}function Kc(E){return o=>o.pipe((0,N.concatMap)((b,M)=>E(b,M).pipe((0,N.map)(h=>[b,h]))))}function zc(E){return o=>o.pipe((0,N.mergeMap)((b,M)=>E(b,M).pipe((0,N.map)(h=>[b,h]))))}function Gc(E){return o=>o.pipe((0,N.mergeMap)((b,M)=>E(b,M).pipe((0,N.map)(()=>b))))}function Wc(E){return o=>o.pipe((0,N.switchMap)((b,M)=>E(b,M).pipe((0,N.map)(h=>[b,h]))))}function Jc(E){return o=>o.pipe((0,N.switchMap)((b,M)=>E(b,M).pipe((0,N.map)(()=>b))))}function Zc(E){return o=>E?new w.Observable(b=>{const M=z=>E.run(()=>b.next(z)),h=z=>E.run(()=>b.error(z)),F=()=>E.run(()=>b.complete());return o.subscribe({next:M,error:h,complete:F})}):o}function Zl(E){return o=>E?new Observable(b=>{const M=z=>E.runOutsideAngular(()=>b.next(z)),h=z=>E.runOutsideAngular(()=>b.error(z)),F=()=>E.runOutsideAngular(()=>b.complete());return o.subscribe({next:M,error:h,complete:F})}):o}var Tn=_(23710);class Hi{static initialize(){Tn.config({disableDefaultAlphabetLength:!0,disableDefaultIdLength:!0,idLength:7}),Tn.characters("0123456789abcdefghijklmnopqrstuvwxyz")}static generateUnique(o,b="",M="_"){const h=new RegExp(`^${b}`);return b+o.replace(h,"")+M+Tn.generate()}static getUniqueIncrementalName(o,b){if(!b.includes(o))return o;let M;for(let h=1;h<=b.length;h++)if(M=`${o}-${h}`,!b.includes(M))return M;return M}}Hi.initialize();const Yc=new m.InjectionToken("An abstraction over window.navigator object",{factory:()=>window.navigator,providedIn:"root"});var Xc=_(6530);const Ki=new m.InjectionToken("CURRENT_TAB_ID_TOKEN"),Yl={provide:Ki,useValue:(0,Xc.qv)()},Xl=new m.InjectionToken("Dialog token"),os=new m.InjectionToken("WindowToken",{providedIn:"root",factory:Nn});function Nn(){return window}const zi={provide:os,useFactory:Nn};class cs{constructor(o){this._window=o,this._hasFocus=!1,this._window.addEventListener("focus",()=>{this._hasFocus=!0}),this._window.addEventListener("blur",()=>{this._hasFocus=!1})}_getIsDocumentVisible(){return document.visibilityState!=="hidden"}get hasFocus(){return this._hasFocus}get isActive(){return this._getIsDocumentVisible()}focus(){this._window.focus()}static{this.\u0275fac=function(b){return new(b||cs)(m.\u0275\u0275inject(os))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:cs,factory:cs.\u0275fac,providedIn:"root"})}}var Gi=_(40409);class Lt{constructor(o){this._injector=o}defineComponent(o,b,M=null){const h=(0,Gi.createCustomElement)(b,{injector:M||this._injector});customElements.get(o)||customElements.define(o,h)}static{this.\u0275fac=function(b){return new(b||Lt)(m.\u0275\u0275inject(m.Injector))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:Lt,factory:Lt.\u0275fac,providedIn:"root"})}}function Wi(E,o){return E.creatio.tabId=o,(0,w.of)(void 0)}const xn={provide:m.APP_INITIALIZER,multi:!0,useFactory:(E,o)=>()=>Wi(E,o),deps:[os,Ki]},gr=new m.InjectionToken("LOCAL_STORAGE_SERVICE_CONFIG");class yt{static forRoot(o={}){return{ngModule:yt,providers:[{provide:gr,useValue:o}]}}static{this.\u0275fac=function(b){return new(b||yt)}}static{this.\u0275mod=m.\u0275\u0275defineNgModule({type:yt})}static{this.\u0275inj=m.\u0275\u0275defineInjector({})}}const Vn="LOCAL_STORAGE_NOT_SUPPORTED";class Bt{constructor(o={}){this._isSupported=!1,this._prefix="ls",this._storageType="localStorage";const{prefix:b,storageType:M}=o||{};b!=null&&this._setPrefix(b),M!=null&&this._setStorageType(M),this._isSupported=this._checkSupport()}_deriveKey(o){return`${this._prefix}${o}`}_checkSupport(){try{const o=this._storageType in window&&window[this._storageType]!==null;if(o){this._webStorage=window[this._storageType];const b=this._deriveKey(`__${Math.round(Math.random()*1e7)}`);this._webStorage.setItem(b,""),this._webStorage.removeItem(b)}return o}catch(o){return console.error(o.message),!1}}_setPrefix(o){this._prefix=o;const b=".";this._prefix&&!this._prefix.endsWith(b)&&(this._prefix=this._prefix?`${this._prefix}${b}`:"")}_setStorageType(o){this._storageType=o}get(o){if(!this._isSupported)return console.warn(Vn),null;const b=this._webStorage?this._webStorage.getItem(this._deriveKey(o)):null;if(!b||b==="null")return null;try{return JSON.parse(b)}catch{return null}}set(o,b){const M=b===void 0?null:JSON.stringify(b);if(!this._isSupported)return console.warn(Vn),!1;try{this._webStorage&&this._webStorage.setItem(this._deriveKey(o),M)}catch(h){return console.error(h.message),!1}return!0}remove(...o){let b=!0;return o.forEach(M=>{this._isSupported||(console.warn(Vn),b=!1);try{this._webStorage.removeItem(this._deriveKey(M))}catch(h){console.error(h.message),b=!1}}),b}static{this.\u0275fac=function(b){return new(b||Bt)(m.\u0275\u0275inject(gr,8))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:Bt,factory:Bt.\u0275fac,providedIn:"root"})}}class us{playFromSource(o){return(0,st.A)(function*(b,M=!1){const h=new Audio(b),F=h.play();if(F!==void 0)try{yield F}catch(z){if(h.muted=!0,M)throw z}}).apply(this,arguments)}static{this.\u0275fac=function(b){return new(b||us)}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:us,factory:us.\u0275fac,providedIn:"root"})}}var He;(function(E){E.Small="small",E.Medium="medium",E.Large="large",E.XL="xl",E.XXL="xxl"})(He||(He={}));class Ft{constructor(o,b){this._window=o,this._document=b,this._minScreenSize=600,this._mediumScreenSize=790,this._largeScreenSize=1079,this._xlScreenSize=1280,this._screenSizeChanges$=new w.BehaviorSubject(this._currentScreenSizeType),this._changeScreenSizeType()}get currentScreenSizeType(){return this._currentScreenSizeType}get currentScreenSize(){return this._currentScreenSize}get isSmallScreen(){return this._currentScreenSizeType===He.Small}_setScreenSizeTypeAttribute(o){this._document.body.setAttribute("screen-size-type",o)}_getScreenSizeType(){return this._currentScreenSize=this._window.innerWidth,this._currentScreenSize<=this._minScreenSize?He.Small:this._currentScreenSize<=this._mediumScreenSize?He.Medium:this._currentScreenSize<=this._largeScreenSize?He.Large:this._currentScreenSize<=this._xlScreenSize?He.XL:He.XXL}_changeScreenSizeType(){const o=this._getScreenSizeType();return o===this._currentScreenSizeType?!1:(this._currentScreenSizeType=o,this._setScreenSizeTypeAttribute(o),!0)}screenSizeTypeChangeNotifier(){return this._screenSizeChanges$.asObservable()}refreshCurrentScreenSizeType(){this._changeScreenSizeType()&&this._screenSizeChanges$.next(this._currentScreenSizeType)}static{this.\u0275fac=function(b){return new(b||Ft)(m.\u0275\u0275inject(os),m.\u0275\u0275inject(y.DOCUMENT))}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:Ft,factory:Ft.\u0275fac,providedIn:"root"})}}const Se=new m.InjectionToken("DESKTOP_NOTIFICATION_SENDER_PROVIDER");var Pe;(function(E){E[E.StayLoggedIn=0]="StayLoggedIn",E[E.Exit=1]="Exit",E[E.NotSet=2]="NotSet"})(Pe||(Pe={}));var Qc=_(27075),eu=_(79772);class Ke{constructor(){this._liveAnnouncer=(0,m.inject)(Qc.LiveAnnouncer),this._translateService=(0,m.inject)(eu.TranslateService)}announce(o,b){var M=this;return(0,st.A)(function*(h,F,z=200){const ce=M._translateService.instant(h);yield M._liveAnnouncer.announce(ce,F,z)}).apply(this,arguments)}static{this.\u0275fac=function(b){return new(b||Ke)}}static{this.\u0275prov=m.\u0275\u0275defineInjectable({token:Ke,factory:Ke.\u0275fac,providedIn:"root"})}}function On(E){return E.map(o=>({name:o.name,dependsOn:[...o.dependsOn]}))}function kn(E){return E.filter(o=>o.dependsOn.length===0).map(o=>o.name)}function Ji(E){if(!E||E.length===0)return[];const o=On(E),b=o.map(ce=>ce.dependsOn).flat().length;let M=0;const h=kn(o);if(h.length===0)throw new Error("Cyclic dependencies detected");const F=[[...h]];let z=o.filter(ce=>ce.dependsOn.length!==0);for(;z.length!==0;){if(M>b)throw new Error("Process is hanging while build order");M++,z=z.map(ge=>({name:ge.name,dependsOn:ge.dependsOn.filter(te=>!h.includes(te))}));const ce=kn(z);if(ce.length===0)throw new Error("Cyclic dependencies detected");h.push(...ce),F.push(ce),z=z.filter(ge=>ge.dependsOn.length!==0)}return F}function tu(E){return Ji(E).flat()}},91592:(x,K,_)=>{_.d(K,{X:()=>w});var y=_(22307),m=_.n(y);class w{constructor(){this.getRegisteredEvents=()=>[]}set eventHandlers(c){this._eventHandlers=c,this._validateEventHandlers()}get eventHandlers(){return this._eventHandlers}_stringify(c){const V=[()=>JSON.stringify(c),()=>c.toString()];for(let $=0;$<V.length;$++){const T=V[$];try{return T()}catch{}}return""}_checkEventCanBeHandled(c){const V=this.getRegisteredEvents();if(!V||V.some(q=>q.name===c))return;const $=V.map(q=>q.name).join(", ");let T=`Handler for event "${c}" can not be specified because the event was not registered in table cell class. Registered table column events to subscribe: ${$}.`;throw this.columnDataSchema&&(T+=` Column name: "${this.columnDataSchema.name}".`),new Error(T)}_checkHandlerIsFunction(c,V){if(typeof V!="function")throw new TypeError(`Handler for event with name "${c}" must be a function, but actual is"${this._stringify(V)}".`)}_validateEventHandlers(){if(!this.eventHandlers)return;Object.keys(this.eventHandlers).forEach(V=>{this._checkEventCanBeHandled(V),this._checkHandlerIsFunction(V,this.eventHandlers[V])})}_checkEventDataType(c,V){return c instanceof V||c.constructor===V}_validateFiringEvent(c,V){const $=this._registeredEvents.find(q=>q.name===c);if(!$)throw new Error(`Event with name "${c}" is not registered in the cell class and can not be fired.`);const T=$.dataType;if(V&&(!T||!this._checkEventDataType(V,T)))throw new TypeError(`Type of the data in the event "${c}" must be "${T}", but actual data is "${this._stringify(V)}".`)}_getValidEventHandler(c){const V=this.eventHandlers&&this.eventHandlers[c];if(V)return this._checkHandlerIsFunction(c,V),V}isEmpty(){return!(this.columnDataSchema&&this.record)}fireEvent(c,V){this._validateFiringEvent(c,V);const $=this._getValidEventHandler(c);return $&&$(this.record,V)}ngOnInit(){this._registeredEvents=this.getRegisteredEvents()}getValue(){const c=this.record[this.columnDataSchema.name],V=this.columnDataSchema.formatter;return V?V(c,this.record):c}static{this.\u0275fac=function(V){return new(V||w)}}static{this.\u0275dir=y.\u0275\u0275defineDirective({type:w,inputs:{columnDataSchema:"columnDataSchema",record:"record",eventHandlers:"eventHandlers"}})}}},93248:(x,K,_)=>{_.d(K,{Fg:()=>m,HO:()=>w,Oi:()=>y,oy:()=>N});const y="user-info-cache",m="currentUserInfo",w="application-info-cache",N="applicationInfo"},61843:(x,K,_)=>{_.d(K,{dJ:()=>m,fX:()=>w});const y="A5420246-0A8E-E111-84A3-00155D054C03",m="en-US";class w{constructor(c){Object.assign(this,c)}static getDefaultCulture(){return new w({sysCultureId:y,sysCultureName:m,decimalSeparator:".",thousandSeparator:","})}}},47149:(x,K,_)=>{_.d(K,{P:()=>N,Q:()=>w});var y=_(86464);const m="DataValueType",w={[y.r.Date]:{type:y.r.Date,id:"603d4960-a1a2-45e9-b232-206a54421b01",name:"Date",icon:"data-type-date-icon.svg",designerIcon:_(26861),translateKey:`${m}.DateCaption`},[y.r.Time]:{type:y.r.Time,id:"04cc757b-8f06-482c-8a1a-0c0e171d2410",name:"Time",icon:"data-type-time-icon.svg",designerIcon:_(8510),translateKey:`${m}.TimeCaption`},[y.r.DateTime]:{type:y.r.DateTime,id:"d21e9ef4-c064-4012-b286-fa1a8171da44",name:"DateTime",icon:"data-type-datetime-icon.svg",designerIcon:_(55146),translateKey:`${m}.DateTimeCaption`},[y.r.Text]:{type:y.r.Text,id:"8b3f29bb-ea14-4ce5-a5c5-293a929b6ba2",name:"Text",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:_(97180),designerAutonumberIcon:_(78683),translateKey:`${m}.TextCaption`},[y.r.SHORT_TEXT]:{type:y.r.SHORT_TEXT,id:"325a73b8-0f47-44a0-8412-7606f78003ac",name:"ShortText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:_(97180),designerAutonumberIcon:_(78683),translateKey:`${m}.ShortTextCaption`},[y.r.PHONE_TEXT]:{type:y.r.PHONE_TEXT,id:"26cba63c-daf1-4f36-b2ea-73c0d675d90c",name:"PhoneText",icon:"data-type-phone-icon.svg",designerIcon:_(59155),translateKey:`${m}.PhoneTextCaption`},[y.r.WEB_TEXT]:{type:y.r.WEB_TEXT,id:"26cba64c-daf1-4f36-b2ea-73c0d695d90c",name:"WebText",icon:"data-type-text-icon.svg",designerIcon:_(64337),translateKey:`${m}.WebTextCaption`},[y.r.EMAIL_TEXT]:{type:y.r.EMAIL_TEXT,id:"66cba64c-daf1-4f36-b8ea-73c0d695d90c",name:"EmailText",icon:"data-type-text-icon.svg",designerIcon:_(71011),translateKey:`${m}.EmailTextCaption`},[y.r.MEDIUM_TEXT]:{type:y.r.MEDIUM_TEXT,id:"ddb3a1ee-07e8-4d62-b7a9-d0e618b00fbd",name:"MediumText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:_(97180),designerAutonumberIcon:_(78683),translateKey:`${m}.MediumTextCaption`},[y.r.LONG_TEXT]:{type:y.r.LONG_TEXT,id:"5ca35f10-a101-4c67-a96a-383da6afacfc",name:"LongText",icon:"data-type-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:_(97180),designerAutonumberIcon:_(78683),translateKey:`${m}.LongTextCaption`},[y.r.MAXSIZE_TEXT]:{type:y.r.MAXSIZE_TEXT,id:"c0f04627-4620-4bc0-84e5-9419dc8516b1",name:"MaxSizeText",icon:"data-type-unlimited-text-icon.svg",autonumberIcon:"data-type-autonumber-icon.svg",designerIcon:_(97180),designerAutonumberIcon:_(78683),translateKey:`${m}.MaxSizeTextCaption`},[y.r.Integer]:{type:y.r.Integer,id:"6b6b74e2-820d-490e-a017-2b73d4ccf2b0",name:"Integer",icon:"data-type-integer-icon.svg",designerIcon:_(60521),translateKey:`${m}.IntegerCaption`},[y.r.FLOAT0]:{type:y.r.FLOAT0,id:"60532cfd-8645-4a54-be81-bef507aa2339",name:"Float0",icon:"data-type-float0-icon.svg",designerIcon:_(68877),translateKey:`${m}.FLOAT0Caption`},[y.r.FLOAT1]:{type:y.r.FLOAT1,id:"07ba84ce-0bf7-44b4-9f2c-7b15032eb98c",name:"Float1",icon:"data-type-float1-icon.svg",designerIcon:_(68877),translateKey:`${m}.FLOAT1Caption`},[y.r.FLOAT2]:{type:y.r.FLOAT2,id:"5cc8060d-6d10-4773-89fc-8c12d6f659a6",name:"Float2",icon:"data-type-float2-icon.svg",designerIcon:_(68877),translateKey:`${m}.FLOAT2Caption`},[y.r.FLOAT3]:{type:y.r.FLOAT3,id:"3f62414e-6c25-4182-bcef-a73c9e396f31",name:"Float3",icon:"data-type-float3-icon.svg",designerIcon:_(68877),translateKey:`${m}.FLOAT3Caption`},[y.r.FLOAT4]:{type:y.r.FLOAT4,id:"ff22e049-4d16-46ee-a529-92d8808932dc",name:"Float4",icon:"data-type-float4-icon.svg",designerIcon:_(68877),translateKey:`${m}.FLOAT4Caption`},[y.r.FLOAT8]:{type:y.r.FLOAT8,id:"a4aaf398-3531-4a0d-9d75-a587f5b5b59e",name:"Float8",icon:"data-type-float8-icon.svg",designerIcon:_(68877),translateKey:`${m}.FLOAT8Caption`},[y.r.Guid]:{type:y.r.Guid,id:"23018567-a13c-4320-8687-fd6f9e3699bd",name:"Guid",icon:"data-type-guid-icon.svg",designerIcon:_(92458),translateKey:`${m}.GuidCaption`},[y.r.Lookup]:{type:y.r.Lookup,id:"b295071f-7ea9-4e62-8d1a-919bf3732ff2",name:"Lookup",icon:"data-type-lookup-icon.svg",designerIcon:_(61631),translateKey:`${m}.LookupCaption`},[y.r.Boolean]:{type:y.r.Boolean,id:"90b65bf8-0ffc-4141-8779-2420877af907",name:"Boolean",icon:"data-type-boolean-icon.svg",designerIcon:_(36659),translateKey:`${m}.BooleanCaption`},[y.r.HASH_TEXT]:{type:y.r.HASH_TEXT,id:"ecbcce18-2a17-4ead-829a-9d02fa9578a4",name:"HashText",icon:"data-type-crs-text-icon.svg",designerIcon:_(97180),translateKey:`${m}.HashTextCaption`},[y.r.SECURE_TEXT]:{type:y.r.SECURE_TEXT,id:"3509b9dd-2c90-4540-b82e-8f6ae85d8248",name:"SecureText",icon:"data-type-encrypted-text-icon.svg",designerIcon:_(28010),translateKey:`${m}.SecureTextCaption`},[y.r.IMAGELOOKUP]:{type:y.r.IMAGELOOKUP,id:"b039feb0-ee7c-4884-8aa6-d6d45d84316f",name:"ImageLookup",icon:"data-type-image-link-icon.svg",designerIcon:_(65689),translateKey:`${m}.ImageLookupCaption`},[y.r.Money]:{type:y.r.Money,id:"969093e2-2b4e-463b-883a-3d3b8c61f0cd",name:"Money",icon:"data-type-currency-icon.svg",designerIcon:_(32643),translateKey:`${m}.MoneyCaption`},[y.r.MONEY0]:{type:y.r.MONEY0,id:"6cc9cbe3-a486-4ed3-bea6-5c96f36d77ff",name:"Money0",icon:"data-type-currency-icon.svg",designerIcon:_(32643),translateKey:`${m}.Money0Caption`},[y.r.MONEY1]:{type:y.r.MONEY1,id:"8842ed44-069a-4fae-b1a2-ee17384689eb",name:"Money1",icon:"data-type-currency-icon.svg",designerIcon:_(32643),translateKey:`${m}.Money1Caption`},[y.r.MONEY3]:{type:y.r.MONEY3,id:"85ff33ce-d57d-4197-9e9b-c2dcb1cfc35e",name:"Money3",icon:"data-type-currency-icon.svg",designerIcon:_(32643),translateKey:`${m}.Money3Caption`},[y.r.Float]:{type:y.r.Float,id:"57ee4c31-5ec4-45fa-b95d-3a2868aa89a8",name:"Float",icon:"data-type-float1-icon.svg",designerIcon:_(68877),translateKey:`${m}.FloatCaption`},[y.r.FILE]:{type:y.r.FILE,id:"a33c9252-d401-453e-949d-169157067ed9",name:"File",icon:"data-type-file-icon.svg",designerIcon:_(55039),translateKey:`${m}.FileCaption`},[y.r.Image]:{type:y.r.Image,id:"fa6e6e49-b996-475e-a77e-73904e4c5a88",name:"Image",icon:"data-type-image-icon.svg",designerIcon:_(55039),translateKey:`${m}.ImageCaption`},[y.r.Blob]:{type:y.r.Blob,id:"b7342b7a-5dde-40de-aa7c-24d2a57b3202",name:"Blob",icon:"data-type-blob-icon.svg",designerIcon:_(55039),translateKey:`${m}.BlobCaption`},[y.r.Color]:{type:y.r.Color,id:"dafb71f9-ee9f-4e0b-a4d7-37aa15987155",name:"Color",icon:"data-type-color-icon.svg",designerIcon:_(39078),translateKey:`${m}.ColorCaption`},[y.r.RICH_TEXT]:{type:y.r.RICH_TEXT,id:"79bccffa-8c8b-4863-b376-a69d2244182b",name:"RichText",icon:"data-type-rich-text-icon.svg",designerIcon:_(67021),translateKey:`${m}.RichCaption`},[y.r.ENTITY]:{type:y.r.ENTITY,id:"ebd85d37-0abf-4bbf-bb32-97dc3dffcc8c",name:"Entity",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.Entity`},[y.r.ENTITY_COLLECTION]:{type:y.r.ENTITY_COLLECTION,id:"51fb23ba-3eb2-11e2-b7d5-b0c76188709b",name:"EntityCollection",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.EntityCollection`},[y.r.ENTITY_COLUMN_MAPPING_COLLECTION]:{type:y.r.ENTITY_COLUMN_MAPPING_COLLECTION,id:"b53eaa2a-4bb7-4a6b-9f4f-58ccab293e31",name:"EntityColumnMappingCollection",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.EntityColumnMappingCollection`},[y.r.CUSTOM_OBJECT]:{type:y.r.CUSTOM_OBJECT,id:"84ed6865-9692-4c98-aaed-4d15b96a95c2",name:"CustomObject",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.CustomObject`},[y.r.OBJECT_LIST]:{type:y.r.OBJECT_LIST,id:"4b51a8b5-1ee9-4437-9d58-f35e083cbcdf",name:"ObjectList",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.ObjectList`},[y.r.COMPOSITE_OBJECT_LIST]:{type:y.r.COMPOSITE_OBJECT_LIST,id:"651ec16f-d140-46db-b9e2-825c985a8ac2",name:"CompositeObjectList",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.CompositeObjectList`},[y.r.COMPOSITE_OBJECT]:{type:y.r.COMPOSITE_OBJECT,id:"632e4371-0a7f-46cd-a284-a623b3933027",name:"CompositeObject",icon:"data-type-composite-object-icon.svg",designerIcon:_(97180),translateKey:`${m}.CompositeObject`},[y.r.COLLECTION]:{type:y.r.COLLECTION,name:"Collection",icon:"data-type-other-icon.svg",designerIcon:_(97180),translateKey:`${m}.Collection`},[y.r.LOCALIZABLE_STRING]:{type:y.r.LOCALIZABLE_STRING,id:"95c6e6c4-2cc8-46be-a1cb-96f942655f86",name:"LocalizableString",icon:"data-type-text-icon.svg",designerIcon:_(97180),translateKey:`${m}.LocalizableString`},[y.r.METADATA_TEXT]:{type:y.r.METADATA_TEXT,id:"394e160f-c8e0-46fa-9c0d-75d97e9e9169",name:"MetaDataText",icon:"data-type-text-icon.svg",designerIcon:_(97180),translateKey:`${m}.MetaDataText`}},N={DateTime:[y.r.Date,y.r.Time,y.r.DateTime],Text:[y.r.Text,y.r.SHORT_TEXT,y.r.MEDIUM_TEXT,y.r.LONG_TEXT,y.r.PHONE_TEXT,y.r.WEB_TEXT,y.r.EMAIL_TEXT,y.r.MAXSIZE_TEXT,y.r.LOCALIZABLE_STRING,y.r.RICH_TEXT],Number:[y.r.FLOAT0,y.r.FLOAT1,y.r.FLOAT2,y.r.FLOAT3,y.r.FLOAT4,y.r.FLOAT8,y.r.Integer,y.r.MONEY0,y.r.MONEY1,y.r.Money,y.r.MONEY3,y.r.Float],Lookup:[y.r.Lookup,y.r.IMAGELOOKUP]}},74975:(x,K,_)=>{_.d(K,{S:()=>w});var y=_(22307),m=_.n(y);class w{constructor(){const c=this.constructor;if((0,y.inject)(c,y.InjectFlags.Optional|y.InjectFlags.SkipSelf))throw Error(`[${c.name}]: trying to create multiple instances,
			but this service should be a singleton.`)}}},90964:(x,K,_)=>{_.d(K,{g:()=>V});var y=_(73308),m=_(62278),w=_(36486),N=_(22307);const c=new N.InjectionToken("USE_MEASURE_PERFORMANCE_TOOLS",{providedIn:"root",factory:()=>!!window.__useMeasurePerformanceTools});class V{constructor(T){this._useMeasurePerformanceTools=T,this._consequentMeasureStartTimeCorrection=.001,this._lastNowStartTime=0,this.rendering$=new m.BehaviorSubject(null)}_getNowStartTimeWithCorrection(){const T=performance.now(),q=T<=this._lastNowStartTime?this._lastNowStartTime+this._consequentMeasureStartTimeCorrection:T;return this._lastNowStartTime=q,q}measure(T,q,ee){if(!this._useMeasurePerformanceTools)return q();const ue=ee||this._getNowStartTimeWithCorrection(),Ie=q();return performance.measure(T,{start:ue}),Ie}measureCallback(T,q){var ee=this;return(0,y.A)(function*(){if(!ee._useMeasurePerformanceTools)return q();const ue=ee._getNowStartTimeWithCorrection(),Ie=yield q();return performance.measure(T,{start:ue}),Ie})()}measure$(T){if(!this._useMeasurePerformanceTools)return ee=>ee;let q;return ee=>(0,m.of)(null).pipe((0,w.tap)(()=>q=this._getNowStartTimeWithCorrection()),(0,m.switchMap)(()=>ee),(0,w.tap)(()=>{const ue=typeof T=="string"?T:T();performance.measure(ue,{start:q})}))}static{this.\u0275fac=function(q){return new(q||V)(N.\u0275\u0275inject(c,8))}}static{this.\u0275prov=N.\u0275\u0275defineInjectable({token:V,factory:V.\u0275fac,providedIn:"root"})}}},23092:(x,K,_)=>{_.d(K,{fv:()=>P,oq:()=>Ie,vn:()=>qe});var y=_(5757),m=_.n(y),w=_(22307),N=_.n(w),c=_(62278),V=_.n(c),$=_(93248),T=_(61843),q=_(74975),ee=_(89720),ue=_(90964);class Ie{constructor(){this.cultureInfo=new T.fX,this.defCultureInfo=new T.fX}}const pe="Information about the current user is not initialized yet. Use UserInfoService to load current user information.";function O(){return{get id(){throw new ReferenceError(pe)},get contactId(){throw new ReferenceError(pe)},get contactName(){throw new ReferenceError(pe)},get accountId(){throw new ReferenceError(pe)},get accountName(){throw new ReferenceError(pe)},get isSSP(){throw new ReferenceError(pe)},get timeZoneId(){throw new ReferenceError(pe)},get cultureInfo(){throw new ReferenceError(pe)},get defCultureInfo(){throw new ReferenceError(pe)},get timeZoneOffsetHours(){throw new ReferenceError(pe)},get photoId(){throw new ReferenceError(pe)},get accessType(){throw new ReferenceError(pe)},get sessionId(){throw new ReferenceError(pe)}}}const S=O(),j={get id(){return S.id},get contactId(){return S.contactId},get contactName(){return S.contactName},get accountId(){return S.accountId},get accountName(){return S.accountName},get isSSP(){return S.isSSP},get timeZoneId(){return S.timeZoneId},get cultureInfo(){return S.cultureInfo},get defCultureInfo(){return S.defCultureInfo},get timeZoneOffsetHours(){return S.timeZoneOffsetHours},get photoId(){return S.photoId},get accessType(){return S.accessType},get sessionId(){return S.sessionId}};Object.freeze(j);const qe={provide:Ie,useFactory:()=>j};class P extends q.S{constructor(ve,we,et){super(),this._httpClient=ve,this._cacheManager=we,this._measurePerformanceService=et,this._serviceEndpoint="/ServiceModel/UserInfoService.svc"}_applyUserInfo(ve){Object.keys(S).forEach(we=>{delete S[we]}),Object.assign(S,ve)}loadCurrentUserInfo(){if(!this._userInfo$){const ve=`${this._serviceEndpoint}/GetCurrentUserInfo`;this._userInfo$=this._cacheManager.executeWithCache($.Oi,$.Fg,this._httpClient.post(ve,null)).pipe(this._measurePerformanceService.measure$("UserInfoService: load current user info with cache"),(0,c.tap)(we=>this._applyUserInfo(we?.userInfo)),(0,c.shareReplay)({bufferSize:1,refCount:!1}))}return this._userInfo$}static{this.\u0275fac=function(we){return new(we||P)(w.\u0275\u0275inject(y.HttpClient),w.\u0275\u0275inject(ee.G),w.\u0275\u0275inject(ue.g))}}static{this.\u0275prov=w.\u0275\u0275defineInjectable({token:P,factory:P.\u0275fac,providedIn:"root"})}}},89720:(x,K,_)=>{_.d(K,{G:()=>tt});var y=_(22307),m=_(73308),w=_(5757),N=_(23176),c=_(62278),V=_(36486),$=_(30293),T=_(40234);const q={name:"crt-shell-db",version:15,objectStoresMeta:Object.values($.w).map(le=>({store:le,storeConfig:{keyPath:"id",autoIncrement:!0},storeSchema:[{name:"key",keypath:"key",options:{unique:!0}},{name:"data",keypath:"data",options:{unique:!1}}]})),isDefault:!0};class ee{constructor(f){this.dbService=f,this._shouldRemoveDataBaseErrorNames=["VersionError","InvalidStateError","UnknownError"],this._dbReady=!0,this.dbService||(this._dbReady=!1,console.info("For using persistent cache, you need to register NgxIndexedDBService."))}_getErrorMessage(f){return f instanceof Error?`Name: ${f.name}, Message: ${f.message}`:f instanceof Event&&f.target&&"error"in f.target?`${f.target.error?.message}`:typeof f=="string"?f:JSON.stringify(f)}_handleError(f){const v=typeof f=="string"||f instanceof Error&&this._shouldRemoveDataBaseErrorNames.includes(f.name);return this._dbReady&&v?(indexedDB.deleteDatabase(q.name),console.warn(`IndexedDB has been refreshed. ${this._getErrorMessage(f)}`),this._dbReady=!1,(0,c.of)(void 0)):(console.warn(`IndexedDB request error. ${this._getErrorMessage(f)}`),(0,c.of)(void 0))}_executeIndexedDBOperation(f,v){return this._dbReady?f():(0,c.of)(v)}get dbReady(){return this._dbReady}add(f,v){return this._executeIndexedDBOperation(()=>this.dbService.add(f,v),void 0).pipe((0,c.catchError)(R=>this._handleError(R)))}bulkAdd(f,v){return this._executeIndexedDBOperation(()=>this.dbService.bulkAdd(f,v),[]).pipe((0,c.catchError)(R=>this._handleError(R)))}getByKey(f,v){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(f,"key",v),null).pipe((0,c.catchError)(R=>this._handleError(R)))}getByKeys(f,v){if(v.length===0)return(0,c.of)([]);const R=v.map(k=>this._executeIndexedDBOperation(()=>this.getByKey(f,k),null));return(0,c.forkJoin)(R).pipe((0,c.map)(k=>k.filter(Boolean)),(0,c.catchError)(k=>this._handleError(k)))}clear(f){return this._executeIndexedDBOperation(()=>this.dbService.clear(f),!1).pipe((0,c.catchError)(v=>this._handleError(v)))}update(f,v){return this._executeIndexedDBOperation(()=>this.dbService.update(f,v),void 0).pipe((0,c.catchError)(R=>this._handleError(R)))}bulkUpdate(f,v){return this._executeIndexedDBOperation(()=>this.dbService.bulkPut(f,v),[]).pipe((0,c.catchError)(R=>this._handleError(R)))}delete(f,v){return this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(f,v),!0).pipe((0,c.catchError)(R=>this._handleError(R)))}deleteByIndex(f,v){return this._executeIndexedDBOperation(()=>this.dbService.getByIndex(f,"key",v),null).pipe((0,c.switchMap)(R=>R?this._executeIndexedDBOperation(()=>this.dbService.deleteByKey(f,R.id),!1):(0,c.of)(!0)),(0,c.catchError)(R=>this._handleError(R)))}getAll(f){return this._executeIndexedDBOperation(()=>this.dbService.getAll(f),null).pipe((0,c.catchError)(v=>this._handleError(v)))}static{this.\u0275fac=function(v){return new(v||ee)(y.\u0275\u0275inject(T.NgxIndexedDBService,8))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:ee,factory:ee.\u0275fac,providedIn:"root"})}}function ue(le){const f=document.cookie.match(new RegExp("(^| )"+le+"=([^;]+)"));return f?f[2]:null}function Ie(){return ue("UserType")==="SSP"?"ssp/":""}class pe{constructor(f,v,R){this._indexedDBService=f,this.memoryCache=R,this._tableName=v.tableName,this._keyPrefix=v.keyPrefix}_getPrefixedKey(f){return this._keyPrefix?`${this._keyPrefix}_${f}`:f}_getIndexedDBRecord(f){return(0,c.firstValueFrom)(this._indexedDBService.getByKey(this._tableName,f))}_getIndexedDBRecords(f){return(0,c.firstValueFrom)(this._indexedDBService.getByKeys(this._tableName,f))}has(f){var v=this;return(0,m.A)(function*(){if(yield v.memoryCache?.has(v._getPrefixedKey(f)))return!0;const R=yield v._getIndexedDBRecord(v._getPrefixedKey(f));return yield v.memoryCache?.set(v._getPrefixedKey(f),R?.data),!!R?.data})()}get(f){var v=this;return(0,m.A)(function*(){if(yield v.memoryCache?.has(v._getPrefixedKey(f)))return v.memoryCache.get(v._getPrefixedKey(f));const R=yield v._getIndexedDBRecord(v._getPrefixedKey(f));return yield v.memoryCache?.set(v._getPrefixedKey(f),R?.data),R?.data??null})()}getAll(){var f=this;return(0,m.A)(function*(){const v=yield f.memoryCache?.getAll();return v?.length>0?v:yield(0,c.firstValueFrom)(f._indexedDBService.getAll(f._tableName).pipe((0,c.map)(R=>R.map(k=>({key:k.key,value:k.data}))),(0,c.tap)(R=>f.memoryCache?.bulkSet(R))))})()}set(f,v){var R=this;return(0,m.A)(function*(){const k=yield R._getIndexedDBRecord(R._getPrefixedKey(f));k?yield(0,c.firstValueFrom)(R._indexedDBService.update(R._tableName,{id:k.id,key:R._getPrefixedKey(f),data:v})):yield(0,c.firstValueFrom)(R._indexedDBService.add(R._tableName,{key:R._getPrefixedKey(f),data:v})),yield R.memoryCache?.set(R._getPrefixedKey(f),v)})()}bulkSet(f){var v=this;return(0,m.A)(function*(){if(!f||f.length===0)return;const R=(yield v._getIndexedDBRecords(f.map(J=>v._getPrefixedKey(J.key))))||[],k=f.map(J=>{const Ee=R.filter(Boolean).find(st=>st.key===v._getPrefixedKey(J.key)),_t={key:v._getPrefixedKey(J.key),data:J.value};return Ee?.id?{..._t,id:Ee.id}:_t});yield(0,c.firstValueFrom)(v._indexedDBService.bulkUpdate(v._tableName,k)),yield v.memoryCache?.bulkSet(f)})()}delete(f){var v=this;return(0,m.A)(function*(){yield(0,c.firstValueFrom)(v._indexedDBService.deleteByIndex(v._tableName,v._getPrefixedKey(f))),yield v.memoryCache?.delete(v._getPrefixedKey(f))})()}clear(){var f=this;return(0,m.A)(function*(){yield(0,c.firstValueFrom)(f._indexedDBService.clear(f._tableName)),yield f.memoryCache?.clear()})()}}class O{constructor(){this._cache=new Map}has(f){return Promise.resolve(this._cache.has(f))}get(f){return Promise.resolve(this._cache.get(f))}getAll(){return Promise.resolve([...this._cache].map(([f,v])=>({key:f,value:v})))}set(f,v){return this._cache.set(f,v),Promise.resolve()}bulkSet(f){return f.forEach(v=>{this._cache.set(v.key,v.value)}),Promise.resolve()}delete(f){return this._cache.delete(f),Promise.resolve()}clear(){return this._cache.clear(),Promise.resolve()}}var S=_(41483);class j{constructor(f){this._indexedDBService=f}create(f){switch(f.type){case S.P.Memory:return new O;case S.P.Persistent:return new pe(this._indexedDBService,f.options);case S.P.PersistentAndMemory:return new pe(this._indexedDBService,f.options,new O);default:throw new Error(`Unsupported cache type: ${f.type}`)}}static{this.\u0275fac=function(v){return new(v||j)(y.\u0275\u0275inject(ee))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:j,factory:j.\u0275fac,providedIn:"root"})}}const qe="ClientCacheVersion";class P{constructor(f,v,R,k){this._injector=f,this._systemCaches=v,this._useSystemClientCache=R,this._usePersistentCache=k,this._caches=new Map}_getPersistentCacheRegistryItems(){var f=this;return(0,m.A)(function*(){return(yield(0,c.firstValueFrom)(f._indexedDBService.getAll($.w.CacheRegistry)))?.map(R=>R.data)??[]})()}_initializePersistentCacheRegistry(){var f=this;return(0,m.A)(function*(){if(!f._usePersistentCache){f._persistentCacheRegistry=new Map;return}const R=(yield f._getPersistentCacheRegistryItems()).map(k=>[k.name,k]);f._persistentCacheRegistry=new Map(R)})()}_initializeRegisteredCaches(){this._persistentCacheRegistry.forEach(f=>{const v=this._cacheFactory.create({name:f.name,type:f.useMemoryCache?S.P.PersistentAndMemory:S.P.Persistent,options:{tableName:f.tableName}});this._caches.set(f.name,v)})}_registerPersistentCache(f){var v=this;return(0,m.A)(function*(){if(!v._usePersistentCache)return;const R={name:f.name,tableName:f.options.tableName,useMemoryCache:f.type===S.P.PersistentAndMemory,hash:""};yield(0,c.firstValueFrom)(v._indexedDBService.add($.w.CacheRegistry,{key:f.name,data:R})),v._persistentCacheRegistry.set(f.name,R)})()}_updatePersistentCacheHash(f,v){var R=this;return(0,m.A)(function*(){const k=R._persistentCacheRegistry.get(f);k.hash=v,R._persistentCacheRegistry.set(f,k);const J=yield(0,c.firstValueFrom)(R._indexedDBService.getByKey($.w.CacheRegistry,f));J?.data&&(J.data.hash=v,yield(0,c.firstValueFrom)(R._indexedDBService.update($.w.CacheRegistry,{id:J.id,key:f,data:k})))})()}_isPersistentCache(f){return f===S.P.Persistent||f===S.P.PersistentAndMemory}_initializeSystemCaches(){var f=this;return(0,m.A)(function*(){const v=f._systemCaches||[];if(v.length===0)return;const R=v.filter(k=>!f._caches.has(k.name));yield Promise.all(R.map(k=>f._create(k)))})()}_create(f){var v=this;return(0,m.A)(function*(){if(v._caches.has(f.name))throw new Error(`Cache instance with name "${f.name}" already exists.`);const R=v._cacheFactory.create({...f,type:v._usePersistentCache?f.type:S.P.Memory});return v._caches.set(f.name,R),v._isPersistentCache(f.type)&&(yield v._registerPersistentCache(f)),R})()}_internalInitialize(){var f=this;return(0,m.A)(function*(){f._indexedDBService=f._injector.get(ee),f._cacheFactory=f._injector.get(j),f._httpClient=f._injector.get(w.HttpClient),f._caches.clear(),yield f._initializePersistentCacheRegistry(),f._initializeRegisteredCaches(),yield f._initializeSystemCaches(),yield f._validateSystemCaches()})()}_validateSystemCaches(){var f=this;return(0,m.A)(function*(){if(!f._caches.size||!f._indexedDBService.dbReady||!f._usePersistentCache)return;const v=Ie(),{hashes:R=[],cacheVersion:k=0}=yield(0,c.lastValueFrom)(f._httpClient.get(`${v}api/ClientCache/Hashes`).pipe((0,V.catchError)(()=>(console.warn("Failed to get system hashes"),(0,c.of)({hashes:[],cacheVersion:0})))));if(f._getIsNeedForceClearCache(k)){yield f._innerClearAll();return}yield Promise.all(R.map(({name:Ee,value:_t})=>f._internalValidateCache(Ee,_t)))})()}_getIsNeedForceClearCache(f){const v=this._injector.get(N.sj),R=v.get(qe),k=f&&f!==R;return k&&v.set(qe,f),k}_internalValidateCache(f,v){var R=this;return(0,m.A)(function*(){if(!R._persistentCacheRegistry.has(f)||!R._usePersistentCache)return;if(R._persistentCacheRegistry.get(f).hash!==v){const J=R._caches.get(f);J&&(yield J.clear(),yield R._updatePersistentCacheHash(f,v))}})()}_innerClearAll(){var f=this;return(0,m.A)(function*(){yield Promise.all([...f._caches.values()].map(v=>v.clear()))})()}whenInitialized(){return this._initialized??=this._internalInitialize(),this._initialized}get(f){var v=this;return(0,m.A)(function*(){yield v.whenInitialized();const R=v._caches.get(f);if(!R)throw new Error(`Cache instance with name "${f}" does not exist.`);return R})()}getOrCreate(f){var v=this;return(0,m.A)(function*(){if(yield v.whenInitialized(),!v._caches.has(f.name)){if(!f.type)throw new Error(`Cache type must be specified for cache "${f.name}".`);yield v._create({...f,type:f.type})}return v._caches.get(f.name)})()}clearAll(){var f=this;return(0,m.A)(function*(){yield f.whenInitialized(),yield f._innerClearAll()})()}validateCache(f,v){var R=this;return(0,m.A)(function*(){yield R.whenInitialized(),yield R._internalValidateCache(f,v)})()}executeWithCache(f,v,R){return this._useSystemClientCache?(0,c.from)(this.whenInitialized()).pipe((0,c.map)(()=>this._caches.get(f)),(0,c.switchMap)(function(){var k=(0,m.A)(function*(J){return{cacheValue:yield J?.get(v),cacheInstance:J}});return function(J){return k.apply(this,arguments)}}()),(0,c.switchMap)(({cacheValue:k,cacheInstance:J})=>k!=null?(0,c.of)(k):R.pipe((0,c.tap)(Ee=>J?.set(v,Ee))))):R}executeWithBulkCache(f,v){return this._useSystemClientCache?(0,c.from)(this.whenInitialized()).pipe((0,c.map)(()=>this._caches.get(f)),(0,c.switchMap)(function(){var R=(0,m.A)(function*(k){return{cachedItems:yield k?.getAll(),cacheInstance:k}});return function(k){return R.apply(this,arguments)}}()),(0,c.switchMap)(({cachedItems:R,cacheInstance:k})=>R?.length?(0,c.of)(R):v.pipe((0,c.switchMap)(function(){var J=(0,m.A)(function*(Ee){return yield k?.bulkSet(Ee),Ee});return function(Ee){return J.apply(this,arguments)}}())))):v}}var Ae;(function(le){le.Share="Share",le.Own="Own",le.TryConnectToShared="TryConnectToShared"})(Ae||(Ae={}));var ve=_(72051),we=_(13875);const et=new y.InjectionToken("CACHE_MODE"),as=window;class tt{get _cacheManager(){switch(this._cacheMode){case Ae.Share:return as.cacheManager;case Ae.Own:return this._innerCacheManager;case Ae.TryConnectToShared:return as.cacheManager??this._innerCacheManager;default:throw new Error("Unknown cache mode")}}set _cacheManager(f){switch(this._cacheMode){case Ae.Share:as.cacheManager=f;break;case Ae.Own:case Ae.TryConnectToShared:this._innerCacheManager=f;break;default:throw new Error("Unknown cache mode")}}constructor(f,v,R,k){this._innerCacheManager=null,this._cacheMode=k||Ae.TryConnectToShared;const J=this._cacheMode!==Ae.TryConnectToShared;this._cacheManager||(this._cacheManager=new P(f,v??[],R===!0,J))}whenInitialized(){return this._cacheManager.whenInitialized()}get(f){return this._cacheManager.get(f)}getOrCreate(f){return this._cacheManager.getOrCreate(f)}clearAll(){return this._cacheManager.clearAll()}validateCache(f,v){return this._cacheManager.validateCache(f,v)}executeWithCache(f,v,R){return this._cacheManager.executeWithCache(f,v,R)}executeWithBulkCache(f,v){return this._cacheManager.executeWithBulkCache(f,v)}static{this.\u0275fac=function(v){return new(v||tt)(y.\u0275\u0275inject(y.Injector),y.\u0275\u0275inject(ve.P,8),y.\u0275\u0275inject(we.X,8),y.\u0275\u0275inject(et,8))}}static{this.\u0275prov=y.\u0275\u0275defineInjectable({token:tt,factory:tt.\u0275fac,providedIn:"root"})}}},41483:(x,K,_)=>{_.d(K,{P:()=>y});var y;(function(m){m.Memory="Memory",m.Persistent="Persistent",m.PersistentAndMemory="PersistentAndMemory"})(y||(y={}))},72051:(x,K,_)=>{_.d(K,{P:()=>w});var y=_(22307),m=_.n(y);const w=new y.InjectionToken("SYSTEM_CACHE")},13875:(x,K,_)=>{_.d(K,{X:()=>w});var y=_(22307),m=_.n(y);const w=new y.InjectionToken("USE_SYSTEM_CLIENT_CACHE",{providedIn:"root",factory:()=>!!window.__useSystemClientCache})},30293:(x,K,_)=>{_.d(K,{w:()=>y});var y;(function(m){m.CacheRegistry="cache-registry",m.Images="images",m.BusinessRules="business-rules",m.RuntimeEntitySchema="runtime-entity-schema",m.RuntimeFreedomUISchemas="runtime-freedom-ui-schemas",m.UserInfo="user-info",m.SystemSettingsCache="system-settings",m.ApplicationInfo="application-info",m.Features="features",m.Rights="rights",m.Auth="auth",m.Acl="acl",m.UserLevelSchema="user-level-schema",m.ConfigurationData="configuration-data"})(y||(y={}))},77017:x=>{x.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><defs><style>.error-icon-a{fill:#df1f26;}.error-icon-b,.error-icon-c{fill:none;}.error-icon-b{stroke:#fff;stroke-miterlimit:10;stroke-width:1.5px;}</style></defs><circle class="error-icon-a" cx="7" cy="7" r="7" transform="translate(1 1)"/><line class="error-icon-b" x2="6" y2="6" transform="translate(5 5)"/><line class="error-icon-b" y1="6" x2="6" transform="translate(5 5)"/><rect class="error-icon-c" width="16" height="16"/></svg>'},64207:x=>{x.exports='<svg xmlns="http://www.w3.org/2000/svg" width="16.001" height="16" viewBox="0 0 16.001 16"><defs><style>.warning-icon-a{fill:#ff9800;}.warning-icon-b,.warning-icon-d{fill:none;}.warning-icon-b{stroke:#fff;stroke-linecap:round;stroke-miterlimit:10;stroke-width:2px;}.warning-icon-c{fill:#fff;}</style></defs><g transform="translate(-1330.138 361.759)"><path class="warning-icon-a" d="M1345.172-346.541H1331.1a.964.964,0,0,1-.84-1.438l7.033-12.505a.965.965,0,0,1,1.682,0l7.034,12.505A.965.965,0,0,1,1345.172-346.541Z"/><line class="warning-icon-b" y2="3" transform="translate(1338.139 -355.279)"/><circle class="warning-icon-c" cx="1.25" cy="1.25" r="1.25" transform="translate(1336.889 -350.529)"/></g><rect class="warning-icon-d" width="16" height="16" transform="translate(0.001)"/></svg>'},78683:x=>{x.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 1.49845H0.783829V4.00128H2.48383V0.000488281H0V1.49845Z" fill="#FF4013"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M14 1.00089H5.08699V3.00089H14V1.00089ZM14 6.00052H5.08699V8.00052H14V6.00052ZM0 12.7274V13.9998H3.19044V9.99979H0V11.1761H1.5V11.5073H0.75V12.3962H1.5V12.7274H0ZM14 10.9998H5.08699V12.9998H14V10.9998Z" fill="#FF4013"/>
<path d="M2.14577e-05 7.56383V8.99972L3.15902 8.99977V7.56383L2.26167 7.56378L3.15902 6.86625L3.15902 5.00135L2.14577e-05 5.00128L0 6.43327H1.5L2.14577e-05 7.56383Z" fill="#FF4013"/>
</svg>
`},36659:x=>{x.exports=`<svg id="Boolean_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_12" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-width="2"><rect width="14" height="14" stroke="none"/><rect x="1" y="1" width="12" height="12" fill="none"/></g><path id="Path_30" d="M10.5,4.5,5.912,9,4,7.162" transform="translate(1 0.5)" fill="rgba(0,0,0,0)" stroke="#ff4013" stroke-width="2"/></svg>
`},39078:x=>{x.exports=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M8.183.779c2.084.007 2.813.35 4.468 1.861l-1.875 2.424-2.95-1.229Z" fill="#ff1c06"/><path d="M7.643 14.846c-2.083-.006-2.813-.35-4.467-1.861l1.875-2.424L8 11.79Z" fill="#ffc6b8"/><path d="M15.024 8.156c-.064 2.22-.431 3.006-2 4.809l-2.4-1.931 1.322-3.175Z" fill="#ff4013"/><path d="M13.074 3.143c1.5 1.443 1.8 2.195 1.949 4.431l-3.03.46-1.286-2.925Z" fill="#ff320e"/><path d="M3.224 12.86c-1.5-1.443-1.795-2.195-1.948-4.43l3.029-.46 1.287 2.925Z" fill="#ffe8e3"/><path d="M12.999 12.98c-1.578 1.562-2.386 1.878-4.769 2.1l-.4-3.055 3.149-1.384Z" fill="#ff795a"/><g transform="translate(-798.326 92.909)" fill="none"><path d="M798.326-92.909h16v16h-16z"/><circle cx="7" cy="7" r="7" transform="translate(799.326 -91.909)" stroke="#ff4013" stroke-width="2"/><circle cx="3" cy="3" r="3" transform="translate(803.326 -87.909)" stroke="#ff4013" stroke-width="2"/><g stroke="#ff4013" stroke-width="2"><path d="M806.326-81.454v3.686"/><path d="M806.326-88.519v-3.386"/><path d="M803.211-84.909h-3.685"/><path d="M812.826-84.909h-3.387"/><path d="M804.126-87.162c-.8-.8-2.306-2.252-3.1-3.05"/><path d="M811.628-79.605c-.729-.73-2.31-2.2-3.04-2.926"/><path d="m804.02-82.6-3 3"/><path d="m811.629-90.213-3.088 2.978"/></g></g></svg>
`},26861:x=>{x.exports=`<svg id="Date_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Rectangle_6448" transform="translate(1 3)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="14" height="12" stroke="none"/><rect x="1" y="1" width="12" height="10" fill="none"/></g><line id="Line_764" x2="12" transform="translate(2 7)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_11729" d="M176.171,1073.754v3" transform="translate(-171.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/><path id="Path_11730" d="M176.171,1073.754v3" transform="translate(-165.171 -1072.754)" fill="none" stroke="#ff4013" stroke-width="2"/></svg>
`},55146:x=>{x.exports=`<svg id="Datetime_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Icon_left_panel_date_time_16x16_heavy" transform="translate(0)"><rect id="Rectangle_6448" width="16" height="16" fill="none"/><path id="Path_6271" d="M1895.033,260.278h-4.149v-9h12v2" transform="translate(-1889.884 -248.278)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7772" d="M0,0H4.5" transform="translate(1 6)" fill="none" stroke="#ff4013" stroke-width="2"/><line id="Line_771" y2="4" transform="translate(4)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_772" y2="4" transform="translate(10)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Path_6272" transform="translate(-1889.764 -248.582)" fill="none" stroke-miterlimit="10"><path d="M1905.764,258.584a5,5,0,1,1-5-5A5,5,0,0,1,1905.764,258.584Z" stroke="none"/><path d="M 1900.7626953125 261.5840454101562 C 1902.417602539062 261.5840454101562 1903.763916015625 260.23828125 1903.763916015625 258.5840759277344 C 1903.763916015625 256.9292602539062 1902.417602539062 255.5829772949219 1900.7626953125 255.5829772949219 C 1899.109130859375 255.5829772949219 1897.763916015625 256.9292602539062 1897.763916015625 258.5840759277344 C 1897.763916015625 260.23828125 1899.109130859375 261.5840454101562 1900.7626953125 261.5840454101562 M 1900.7626953125 263.5840454101562 C 1898.000244140625 263.5840454101562 1895.763916015625 261.3454284667969 1895.763916015625 258.5840759277344 C 1895.763916015625 255.8215942382812 1898.000244140625 253.5829772949219 1900.7626953125 253.5829772949219 C 1903.524169921875 253.5829772949219 1905.763916015625 255.8215942382812 1905.763916015625 258.5840759277344 C 1905.763916015625 261.3454284667969 1903.524169921875 263.5840454101562 1900.7626953125 263.5840454101562 Z" stroke="none" fill="#ff4013"/></g><path id="Path_6273" d="M1900.1,255.194v4h2.5" transform="translate(-1889.098 -249.194)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},71011:x=>{x.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M2 3.5H14V12C14 12.1326 13.9473 12.2598 13.8536 12.3536C13.7598 12.4473 13.6326 12.5 13.5 12.5H2.5C2.36739 12.5 2.24021 12.4473 2.14645 12.3536C2.05268 12.2598 2 12.1326 2 12V3.5Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14 3.5L8 9L2 3.5" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},55039:x=>{x.exports=`<svg id="File_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Group_7055" transform="translate(-733.278 92.545)"><g id="Rectangle_6454" transform="translate(735.278 -91.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><rect width="12" height="14" stroke="none"/><rect x="1" y="1" width="10" height="12" fill="none"/></g><line id="Line_774" x2="6" transform="translate(738.278 -87.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_775" x2="6" transform="translate(738.278 -84.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><line id="Line_777" x2="4" transform="translate(738.278 -81.545)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></g></svg>
`},68877:x=>{x.exports=`<svg id="Float_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_14515" transform="translate(-144 -422)"><rect id="Rectangle_39433" width="16" height="16" transform="translate(144 422)" fill="none"/></g><path id="Path_11302" d="M6.957-4.64a6.469,6.469,0,0,1-.8,3.6A2.764,2.764,0,0,1,3.707.127,2.732,2.732,0,0,1,1.285-1.079,6.377,6.377,0,0,1,.47-4.64a6.53,6.53,0,0,1,.793-3.621A2.752,2.752,0,0,1,3.707-9.426,2.739,2.739,0,0,1,6.135-8.208,6.39,6.39,0,0,1,6.957-4.64Zm-4.539,0a7.22,7.22,0,0,0,.3,2.447,1.022,1.022,0,0,0,.993.74A1.033,1.033,0,0,0,4.7-2.2,7.02,7.02,0,0,0,5-4.64a7,7,0,0,0-.308-2.453,1.034,1.034,0,0,0-.987-.746,1.025,1.025,0,0,0-.99.746A7.208,7.208,0,0,0,2.418-4.64ZM7.759-.908a1.064,1.064,0,0,1,.286-.806,1.158,1.158,0,0,1,.832-.273,1.125,1.125,0,0,1,.816.279,1.061,1.061,0,0,1,.289.8,1.061,1.061,0,0,1-.292.79,1.105,1.105,0,0,1-.812.289,1.138,1.138,0,0,1-.825-.282A1.057,1.057,0,0,1,7.759-.908ZM13.69,0H11.728V-5.37l.019-.882.032-.965q-.489.489-.679.641l-1.066.857L9.088-6.9l2.99-2.38H13.69Z" transform="translate(0.53 12.426)" fill="#ff4013"/></svg>
`},92458:x=>{x.exports=`<svg id="Guid_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_42308" width="16" height="16" fill="none"/><path id="Path_11737" d="M1.162,0H3.43V-9.8H1.162Zm9.926-10.388v3.654a2.894,2.894,0,0,0-2.254-.91A3.661,3.661,0,0,0,5.068-3.766,3.661,3.661,0,0,0,8.834.112a2.9,2.9,0,0,0,2.352-.98V0h2.086V-10.388ZM9.212-1.68A1.911,1.911,0,0,1,7.28-3.766,1.911,1.911,0,0,1,9.212-5.852,1.908,1.908,0,0,1,11.13-3.766,1.908,1.908,0,0,1,9.212-1.68Z" transform="translate(0.838 13)" fill="#ff4013" stroke="rgba(0,0,0,0)" stroke-width="1"/></svg>
`},65689:x=>{x.exports=`<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1742_819)">
<path d="M10.913 8.99277L7.40833 13.0074H13.0074V11.2395L10.913 8.99277ZM10.8641 6.00745L15.0074 10.4519V15.0074H3.00745L10.8641 6.00745Z" fill="#ff4013"/>
<path d="M3.43597 9.72806C2.87697 10.2871 2.20496 9.92807 1.64496 9.37007C1.08596 8.81107 0.726988 8.13807 1.28699 7.57907L3.07794 5.78806C3.63694 5.22906 4.30898 5.58806 4.86798 6.14606C5.42798 6.70506 5.78595 7.37706 5.22595 7.93706L3.43597 9.72806Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M7.93689 5.22705C7.37689 5.78605 6.70591 5.42704 6.14691 4.86804C5.58691 4.30904 5.22894 3.63704 5.78894 3.07804L7.57892 1.28704C8.13892 0.728043 8.80993 1.08704 9.36993 1.64604C9.92993 2.20504 10.2879 2.87704 9.72888 3.43704L7.93689 5.22705Z" stroke="#ff4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M4.70691 6.51907L6.51791 4.70807" stroke="#ff4013" stroke-width="2"/>
<path d="M11.301 2.00702H14.0079V14.007H2.00793V11.581" stroke="#ff4013" stroke-width="2"/>
</g>
<defs>
<clipPath id="clip0_1742_819">
<rect width="16.007" height="16.007" fill="#ff4013"/>
</clipPath>
</defs>
</svg>
`},60521:x=>{x.exports=`<svg id="Integer_icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M8.99433 4.65198C9.48732 5.09802 9.74027 5.69781 9.74027 6.39946C9.74027 7.11039 9.46186 7.74386 8.95863 8.29085L8.95331 8.29664C8.68048 8.58037 8.17318 8.98047 7.44252 9.47417L7.44143 9.4749C7.00788 9.76552 6.67964 10.0338 6.4484 10.2773C6.39755 10.3308 6.35224 10.3822 6.31202 10.4316H9.03463C9.42976 10.4316 9.75009 10.7519 9.75009 11.1471C9.75009 11.5422 9.42976 11.8625 9.03463 11.8625H4.36201V11.5055C4.36201 10.774 4.62396 10.1113 5.14954 9.53003C5.45393 9.18287 5.98212 8.74216 6.73359 8.22779C7.28336 7.835 7.61754 7.57002 7.77738 7.40238C8.08169 7.07198 8.22096 6.73348 8.22096 6.38964C8.22096 6.03409 8.11952 5.81409 7.95289 5.66027C7.78277 5.50324 7.51683 5.40148 7.12478 5.40148C6.72877 5.40148 6.47218 5.52561 6.29884 5.75228L6.29169 5.76164L6.28392 5.77051C6.13055 5.94579 6.0142 6.20942 5.96505 6.5873C5.91679 6.95826 5.61042 7.29659 5.18377 7.29659C4.7751 7.29659 4.39395 6.95656 4.44447 6.49553C4.51728 5.83108 4.75991 5.26428 5.17392 4.82141C5.68203 4.26788 6.36125 4 7.15424 4C7.87626 4 8.49451 4.21025 8.99122 4.6492L8.99433 4.65198ZM14.8743 4.5961C15.3635 5.01371 15.6083 5.57814 15.6083 6.262C15.6083 6.71398 15.4974 7.12093 15.2526 7.45671C15.1531 7.59318 15.0352 7.71289 14.9008 7.81669C15.0605 7.92572 15.2015 8.0545 15.3211 8.20545C15.6165 8.55303 15.7556 8.98069 15.7556 9.46307C15.7556 10.1963 15.4914 10.8144 14.9713 11.2883C14.4419 11.7715 13.7612 12 12.9634 12C12.2299 12 11.6078 11.8045 11.1119 11.4124L11.1064 11.408C10.628 11.014 10.3332 10.4794 10.2052 9.83055C10.1107 9.35139 10.5042 8.97835 10.9288 8.97835C11.3492 8.97835 11.6378 9.30727 11.7079 9.64478C11.7693 9.94025 11.9002 10.158 12.0891 10.3154C12.3147 10.495 12.5969 10.5985 12.9634 10.5985C13.3872 10.5985 13.6961 10.4769 13.9229 10.2668C14.1282 10.0596 14.2363 9.80805 14.2363 9.49253C14.2363 9.15687 14.1319 8.93882 13.9486 8.7817C13.7609 8.62082 13.483 8.52399 13.0419 8.52399H12.7866C12.4159 8.52399 12.1154 8.22345 12.1154 7.85271C12.1154 7.48197 12.4159 7.18143 12.7866 7.18143H13.0125C13.4306 7.18143 13.6903 7.08609 13.85 6.9535C14.0037 6.81675 14.0989 6.61783 14.0989 6.31109C14.0989 6.00164 14.0017 5.79895 13.8513 5.66111L13.8504 5.66027C13.6842 5.50686 13.4217 5.4113 13.0223 5.4113C12.6106 5.4113 12.3484 5.51295 12.1702 5.68456L12.1656 5.68906C12.0215 5.82278 11.914 6.00455 11.8495 6.25293C11.766 6.57474 11.481 6.87436 11.0816 6.87436C10.6572 6.87436 10.2506 6.49494 10.3668 6.00508C10.4953 5.4634 10.7597 5.01133 11.1524 4.66211C11.6438 4.20736 12.2763 4 13.0125 4C13.739 4 14.3777 4.18225 14.8711 4.59337L14.8743 4.5961ZM3.41307 4.92822V11.1029C3.41307 11.5224 3.07297 11.8625 2.65342 11.8625C2.23388 11.8625 1.89377 11.5224 1.89377 11.1029V6.23307C1.68552 6.37174 1.46266 6.49124 1.22573 6.59268C0.723506 6.80771 0.244141 6.40276 0.244141 5.92406C0.244141 5.5872 0.467589 5.3135 0.755873 5.2089C0.963927 5.13341 1.17934 5.03405 1.39555 4.90741C1.64533 4.74519 1.85627 4.57307 2.04007 4.3863C2.18718 4.23681 2.39336 4.13748 2.62233 4.13748C3.05905 4.13748 3.41307 4.4915 3.41307 4.92822Z" fill="#ff4013"/>
</svg>
`},61631:x=>{x.exports=`<svg id="Lookup_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><g id="Group_6916" transform="translate(2.277 2)"><g id="Group_6915" transform="translate(-0.277)"><circle id="Ellipse_237" cx="4.5" cy="4.5" r="4.5" fill="none" stroke="#ff4013" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path id="Path_6243" d="M.344.344,4.123,4.123" transform="translate(7.877 7.876)" fill="none" stroke="#ff4013" stroke-width="2"/></g></g><rect id="Rectangle_24756" width="16" height="16" fill="none"/></svg>
`},32643:x=>{x.exports=`<svg id="Money_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><path id="Path_7070" d="M-318.645,863.293h-6v-8h14v4" transform="translate(325.645 -852.293)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7071" d="M-322.646,855.292a2,2,0,0,1-2,2" transform="translate(326.646 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7072" d="M-312.246,857.292a2,2,0,0,1-2-2" transform="translate(326.246 -851.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7073" d="M-324.646,861.692a2,2,0,0,1,2,2" transform="translate(326.646 -853.692)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><g id="Ellipse_1363" transform="translate(6 5)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="2" cy="2" r="2" stroke="none"/><circle cx="2" cy="2" r="1" fill="none"/></g><path id="Path_7074" d="M-310.846,861.425c0,.737-1.12,1.333-2.5,1.333s-2.5-.6-2.5-1.333,1.12-1.333,2.5-1.333S-310.846,860.69-310.846,861.425Z" transform="translate(325.846 -851.092)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/><path id="Path_7075" d="M-310.846,863.292c0,.589-1.12,1.333-2.5,1.333s-2.5-.744-2.5-1.333" transform="translate(325.846 -850.292)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},59155:x=>{x.exports=`<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.3353 1.83815L6.26378 1.46676L6.26378 1.46676L5.3353 1.83815ZM6.03813 3.59524L5.10965 3.96663L5.10965 3.96663L6.03813 3.59524ZM5.82454 4.94398L5.05632 4.3038L5.0563 4.30383L5.82454 4.94398ZM5.44629 5.39792L6.21451 6.03811L6.21453 6.03808L5.44629 5.39792ZM5.52758 7.19434L4.82047 7.90144L4.8205 7.90147L5.52758 7.19434ZM6.8057 8.47236L7.5128 7.76526L7.51278 7.76523L6.8057 8.47236ZM8.60205 8.55382L7.96198 7.7855L7.96187 7.78559L8.60205 8.55382ZM9.05613 8.17554L9.69619 8.94386L9.69631 8.94376L9.05613 8.17554ZM10.4048 7.96192L10.7762 7.03345L10.7761 7.03344L10.4048 7.96192ZM12.1617 8.66476L11.7903 9.59322L11.7903 9.59323L12.1617 8.66476ZM12.9999 9.90268H11.9999V9.90272L12.9999 9.90268ZM13 11.7369H14V11.7368L13 11.7369ZM4.09733 2C4.23363 2 4.3562 2.08298 4.40682 2.20954L6.26378 1.46676C5.90943 0.580885 5.05144 0 4.09733 0V2ZM4.40682 2.20953L5.10965 3.96663L6.96661 3.22386L6.26378 1.46676L4.40682 2.20953ZM5.10965 3.96663C5.15517 4.08044 5.13462 4.20985 5.05632 4.3038L6.59277 5.58417C7.14152 4.92566 7.28485 4.01947 6.96661 3.22385L5.10965 3.96663ZM5.0563 4.30383L4.67804 4.75777L6.21453 6.03808L6.59279 5.58414L5.0563 4.30383ZM4.67807 4.75774C3.90567 5.68462 3.96693 7.0479 4.82047 7.90144L6.23468 6.48723C6.11298 6.36552 6.10396 6.17076 6.21451 6.03811L4.67807 4.75774ZM4.8205 7.90147L6.09862 9.17949L7.51278 7.76523L6.23466 6.4872L4.8205 7.90147ZM6.09859 9.17947C6.95196 10.0328 8.31517 10.0946 9.24224 9.32204L7.96187 7.78559C7.82939 7.89599 7.63468 7.88713 7.5128 7.76526L6.09859 9.17947ZM9.24212 9.32213L9.69619 8.94386L8.41606 7.40722L7.96198 7.7855L9.24212 9.32213ZM9.69631 8.94376C9.79033 8.86541 9.91963 8.8449 10.0334 8.8904L10.7761 7.03344C9.98045 6.71516 9.07438 6.85861 8.41594 7.40732L9.69631 8.94376ZM10.0333 8.89039L11.7903 9.59322L12.5331 7.73629L10.7762 7.03345L10.0333 8.89039ZM11.7903 9.59323C11.917 9.64389 11.9999 9.76649 11.9999 9.90268H13.9999C13.9999 8.94847 13.4189 8.09059 12.5331 7.73628L11.7903 9.59323ZM11.9999 9.90272L12 11.7369L14 11.7368L13.9999 9.90264L11.9999 9.90272ZM12 11.7369C12 11.8823 11.8822 12 11.737 12V14C12.987 14 14 12.9867 14 11.7369H12ZM11.737 12C6.35945 12 2 7.64067 2 2.26318H0C0 8.74528 5.25492 14 11.737 14V12ZM2 2.26318C2 2.11782 2.11785 2 2.26316 2V0C1.01322 0 0 1.0133 0 2.26318H2ZM2.26316 2H4.09733V0H2.26316V2Z" fill="#FF4013"/>
</svg>
`},67021:x=>{x.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13 1H3C1.89543 1 1 1.89543 1 3V13C1 14.1046 1.89543 15 3 15H13C14.1046 15 15 14.1046 15 13V3C15 1.89543 14.1046 1 13 1Z" stroke="#FF4013" stroke-width="2" stroke-miterlimit="10"/>
<path d="M9 12H7V6H4V4H12V6H9V12Z" fill="#FF4013"/>
</svg>
`},28010:x=>{x.exports=`<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M5.14 6.90901C5.13775 7.50618 5.25259 8.098 5.478 8.65101L1.5 12.629V15.229H4.1V13.669H5.66V12.109H7.22L8.078 11.251C8.631 11.4764 9.22282 11.5912 9.82 11.589C10.7456 11.589 11.6504 11.3145 12.4201 10.8003C13.1897 10.286 13.7895 9.55512 14.1438 8.69996C14.498 7.84481 14.5907 6.90381 14.4101 5.99598C14.2295 5.08815 13.7838 4.25426 13.1293 3.59975C12.4747 2.94524 11.6409 2.49951 10.733 2.31893C9.82519 2.13835 8.8842 2.23103 8.02904 2.58525C7.17388 2.93947 6.44297 3.53932 5.92872 4.30894C5.41448 5.07856 5.14 5.98339 5.14 6.90901ZM12.4832 5.95178C12.4832 6.84671 11.7577 7.57221 10.8628 7.57221C9.96785 7.57221 9.24236 6.84671 9.24236 5.95178C9.24236 5.05684 9.96785 4.33135 10.8628 4.33135C11.7577 4.33135 12.4832 5.05684 12.4832 5.95178Z" fill="#FF4013"/>
</svg>
`},97180:x=>{x.exports=`<svg id="Text_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_39432" width="16" height="16" fill="none"/><path id="Path_11304" d="M5.113,0H2.994V-8.23H.28V-9.994H7.827V-8.23H5.113Z" transform="translate(4 13)" fill="#ff4013"/></svg>
`},8510:x=>{x.exports=`<svg id="Time_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><rect id="Rectangle_23177" width="16" height="16" fill="none"/><g id="Ellipse_1346" transform="translate(1 1)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"><circle cx="7" cy="7" r="7" stroke="none"/><circle cx="7" cy="7" r="6" fill="none"/></g><path id="Path_6908" d="M1824.814,31.345v6h3" transform="translate(-1816.814 -29.345)" fill="none" stroke="#ff4013" stroke-miterlimit="10" stroke-width="2"/></svg>
`},64337:x=>{x.exports=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2 8H14" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M8 13.8375C9.38071 13.8375 10.5 11.2239 10.5 7.99998C10.5 4.77601 9.38071 2.16248 8 2.16248C6.61929 2.16248 5.5 4.77601 5.5 7.99998C5.5 11.2239 6.61929 13.8375 8 13.8375Z" stroke="#FF4013" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`},73308:(x,K,_)=>{_.d(K,{A:()=>m});function y(w,N,c,V,$,T,q){try{var ee=w[T](q),ue=ee.value}catch(Ie){return void c(Ie)}ee.done?N(ue):Promise.resolve(ue).then(V,$)}function m(w){return function(){var N=this,c=arguments;return new Promise(function(V,$){var T=w.apply(N,c);function q(ue){y(T,V,$,q,ee,"next",ue)}function ee(ue){y(T,V,$,q,ee,"throw",ue)}q(void 0)})}}}}]);
